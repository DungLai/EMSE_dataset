{"url":"https://api.github.com/repos/sktime/sktime/pulls/3435","id":1059271333,"node_id":"PR_kwDOCVKAsc4_IzKl","html_url":"https://github.com/sktime/sktime/pull/3435","diff_url":"https://github.com/sktime/sktime/pull/3435.diff","patch_url":"https://github.com/sktime/sktime/pull/3435.patch","issue_url":"https://api.github.com/repos/sktime/sktime/issues/3435","number":3435,"state":"closed","locked":false,"title":"[ENH] predictive variance and quantiles for naive forecaster","user":{"login":"topher-lo","id":46541035,"node_id":"MDQ6VXNlcjQ2NTQxMDM1","avatar_url":"https://avatars.githubusercontent.com/u/46541035?v=4","gravatar_id":"","url":"https://api.github.com/users/topher-lo","html_url":"https://github.com/topher-lo","followers_url":"https://api.github.com/users/topher-lo/followers","following_url":"https://api.github.com/users/topher-lo/following{/other_user}","gists_url":"https://api.github.com/users/topher-lo/gists{/gist_id}","starred_url":"https://api.github.com/users/topher-lo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/topher-lo/subscriptions","organizations_url":"https://api.github.com/users/topher-lo/orgs","repos_url":"https://api.github.com/users/topher-lo/repos","events_url":"https://api.github.com/users/topher-lo/events{/privacy}","received_events_url":"https://api.github.com/users/topher-lo/received_events","type":"User","site_admin":false},"body":"<!--\r\nThanks for contributing a pull request! Please ensure you have taken a look\r\nat our contribution guide: https://github.com/alan-turing-institute/sktime/blob/main/CONTRIBUTING.md\r\n-->\r\n\r\n#### Reference Issues/PRs\r\nCloses #1905\r\n\r\n#### What does this implement/fix? Explain your changes.\r\n- Implements `predict_var` and `predict_quantile` for `NaiveForecaster`\r\n- We apply the following algorithm from FPP3 Chapter 5. (under the assumption of uncorrelated residuals):\r\n  1. Compute \"past\" residuals (`y - y_pred`)\r\n  2. Compute residuals MSE and residuals SE from \"past\" residuals, with degrees of freedom equal to:\r\n     - number of nans in residuals for \"last\" and \"mean\" strategies\r\n     - number of nans in residuals + 1 (for the drift coefficient SE) for \"drift\" strategy\r\n  3. Compute forecast SE using residuals SE according to formulas from FPP3 Table 5.2 (see screenshot and references below).\r\n     - If `cov == False`, we return a vector of forecast SE squared, otherwise if `cov == True`, we return a diagonal matrix with the vector of forecast SEs squared as the diagonal.\r\n  5. (For quantiles) Assume normality and use z-scores to compute quantiles from forecast SE.\r\n- `_predict_var` and `_predict_quantile` both return `pd.DataFrame` with same shape and schemas as `NaiveVariance`'s corresponding methods \r\n\r\n<img width=\"620\" alt=\"Screenshot 2022-09-17 001240\" src=\"https://user-images.githubusercontent.com/46541035/190845157-d3f86b84-ffbb-473b-aa37-ba81614c3c29.png\">\r\n\r\nTwo unit tests:\r\n1. [x] `test_naive_predict_var_backwards`: For `fh=1` and large `T`, the forecast standard error is approximately equal to the residual standard errors. We use this property and the fact that the equation for computing forecast SE from residuals SE is fully invertible. \r\n2. [x] `test_naive_predict_quantiles_against_R_naive` Compare predicted quantiles with results from R naive forecast library\r\n\r\n#### References\r\n- [FPP3 Table 5.2](https://otexts.com/fpp3/prediction-intervals.html#benchmark-methods)\r\n- [R naive forecast code](https://github.com/robjhyndman/forecast/blob/master/R/naive.R)\r\n\r\n#### Does your contribution introduce a new dependency? If yes, which one?\r\nNo.\r\n\r\n#### What should a reviewer concentrate their feedback on?\r\n1. Check that the logic for `test_naive_predict_var_backwards` passes the smell test. It is not a rigorous test proof-wise, but it applies the \"working backwards\" method for checking computation.\r\n2. Compare the formulas specified in `partial_se_formulas` in `_predict_var` with the equations in FPP3 Table 5.2.\r\n\r\n#### Any other comments?\r\n- Not sure if these methods extend to the multivariate case\r\n- In line 415, I used `np.squeeze(self.predict(fh=1))` to convert the result from `self.predict` into a scalar. Does this always work for all possible return signatures? I am not familar with all of sktime's acceptable datatypes. Does this need to be tested or is this behavior guaranteed according to some design contract (when `fh=1`)?\r\n- R naive also has a \"bootstrap\" option for computing forecast variance and quantiles, but this functionality is already implemented in sktime's `BaggingForecaster`.\r\n\r\n#### PR checklist\r\n<!--\r\nPlease go through the checklist below. Please feel free to remove points if they are not applicable.\r\n-->\r\n\r\n##### For all contributions\r\n- [x] I've added myself to the [list of contributors](https://github.com/alan-turing-institute/sktime/blob/main/.all-contributorsrc).\r\n- [x] I've added unit tests and made sure they pass locally.\r\n- [x] The PR title starts with either [ENH], [MNT], [DOC], or [BUG] indicating whether the PR topic is related to enhancement, maintenance, documentation, or bug.\r\n\r\n<!--\r\nThanks for contributing!\r\n-->\r\n","created_at":"2022-09-17T07:40:38Z","updated_at":"2022-09-22T21:23:04Z","closed_at":"2022-09-22T21:23:03Z","merged_at":"2022-09-22T21:23:03Z","merge_commit_sha":"7029e7800a4360668e70dab323ad4936e3d9c32a","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[],"milestone":null,"draft":false,"commits_url":"https://api.github.com/repos/sktime/sktime/pulls/3435/commits","review_comments_url":"https://api.github.com/repos/sktime/sktime/pulls/3435/comments","review_comment_url":"https://api.github.com/repos/sktime/sktime/pulls/comments{/number}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/3435/comments","statuses_url":"https://api.github.com/repos/sktime/sktime/statuses/61708e78c02a29570bd084c82933ef690508eac9","head":{"label":"topher-lo:naive-pred-var-quantiles","ref":"naive-pred-var-quantiles","sha":"61708e78c02a29570bd084c82933ef690508eac9","user":{"login":"topher-lo","id":46541035,"node_id":"MDQ6VXNlcjQ2NTQxMDM1","avatar_url":"https://avatars.githubusercontent.com/u/46541035?v=4","gravatar_id":"","url":"https://api.github.com/users/topher-lo","html_url":"https://github.com/topher-lo","followers_url":"https://api.github.com/users/topher-lo/followers","following_url":"https://api.github.com/users/topher-lo/following{/other_user}","gists_url":"https://api.github.com/users/topher-lo/gists{/gist_id}","starred_url":"https://api.github.com/users/topher-lo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/topher-lo/subscriptions","organizations_url":"https://api.github.com/users/topher-lo/orgs","repos_url":"https://api.github.com/users/topher-lo/repos","events_url":"https://api.github.com/users/topher-lo/events{/privacy}","received_events_url":"https://api.github.com/users/topher-lo/received_events","type":"User","site_admin":false},"repo":{"id":537726152,"node_id":"R_kgDOIA0MyA","name":"sktime","full_name":"topher-lo/sktime","private":false,"owner":{"login":"topher-lo","id":46541035,"node_id":"MDQ6VXNlcjQ2NTQxMDM1","avatar_url":"https://avatars.githubusercontent.com/u/46541035?v=4","gravatar_id":"","url":"https://api.github.com/users/topher-lo","html_url":"https://github.com/topher-lo","followers_url":"https://api.github.com/users/topher-lo/followers","following_url":"https://api.github.com/users/topher-lo/following{/other_user}","gists_url":"https://api.github.com/users/topher-lo/gists{/gist_id}","starred_url":"https://api.github.com/users/topher-lo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/topher-lo/subscriptions","organizations_url":"https://api.github.com/users/topher-lo/orgs","repos_url":"https://api.github.com/users/topher-lo/repos","events_url":"https://api.github.com/users/topher-lo/events{/privacy}","received_events_url":"https://api.github.com/users/topher-lo/received_events","type":"User","site_admin":false},"html_url":"https://github.com/topher-lo/sktime","description":"A unified framework for machine learning with time series","fork":true,"url":"https://api.github.com/repos/topher-lo/sktime","forks_url":"https://api.github.com/repos/topher-lo/sktime/forks","keys_url":"https://api.github.com/repos/topher-lo/sktime/keys{/key_id}","collaborators_url":"https://api.github.com/repos/topher-lo/sktime/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/topher-lo/sktime/teams","hooks_url":"https://api.github.com/repos/topher-lo/sktime/hooks","issue_events_url":"https://api.github.com/repos/topher-lo/sktime/issues/events{/number}","events_url":"https://api.github.com/repos/topher-lo/sktime/events","assignees_url":"https://api.github.com/repos/topher-lo/sktime/assignees{/user}","branches_url":"https://api.github.com/repos/topher-lo/sktime/branches{/branch}","tags_url":"https://api.github.com/repos/topher-lo/sktime/tags","blobs_url":"https://api.github.com/repos/topher-lo/sktime/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/topher-lo/sktime/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/topher-lo/sktime/git/refs{/sha}","trees_url":"https://api.github.com/repos/topher-lo/sktime/git/trees{/sha}","statuses_url":"https://api.github.com/repos/topher-lo/sktime/statuses/{sha}","languages_url":"https://api.github.com/repos/topher-lo/sktime/languages","stargazers_url":"https://api.github.com/repos/topher-lo/sktime/stargazers","contributors_url":"https://api.github.com/repos/topher-lo/sktime/contributors","subscribers_url":"https://api.github.com/repos/topher-lo/sktime/subscribers","subscription_url":"https://api.github.com/repos/topher-lo/sktime/subscription","commits_url":"https://api.github.com/repos/topher-lo/sktime/commits{/sha}","git_commits_url":"https://api.github.com/repos/topher-lo/sktime/git/commits{/sha}","comments_url":"https://api.github.com/repos/topher-lo/sktime/comments{/number}","issue_comment_url":"https://api.github.com/repos/topher-lo/sktime/issues/comments{/number}","contents_url":"https://api.github.com/repos/topher-lo/sktime/contents/{+path}","compare_url":"https://api.github.com/repos/topher-lo/sktime/compare/{base}...{head}","merges_url":"https://api.github.com/repos/topher-lo/sktime/merges","archive_url":"https://api.github.com/repos/topher-lo/sktime/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/topher-lo/sktime/downloads","issues_url":"https://api.github.com/repos/topher-lo/sktime/issues{/number}","pulls_url":"https://api.github.com/repos/topher-lo/sktime/pulls{/number}","milestones_url":"https://api.github.com/repos/topher-lo/sktime/milestones{/number}","notifications_url":"https://api.github.com/repos/topher-lo/sktime/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/topher-lo/sktime/labels{/name}","releases_url":"https://api.github.com/repos/topher-lo/sktime/releases{/id}","deployments_url":"https://api.github.com/repos/topher-lo/sktime/deployments","created_at":"2022-09-17T06:58:06Z","updated_at":"2022-11-10T15:56:13Z","pushed_at":"2022-11-05T22:55:42Z","git_url":"git://github.com/topher-lo/sktime.git","ssh_url":"git@github.com:topher-lo/sktime.git","clone_url":"https://github.com/topher-lo/sktime.git","svn_url":"https://github.com/topher-lo/sktime","homepage":"https://sktime.org","size":53967,"stargazers_count":0,"watchers_count":0,"language":null,"has_issues":false,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":0,"mirror_url":null,"archived":false,"disabled":true,"open_issues_count":0,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause","node_id":"MDc6TGljZW5zZTU="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":0,"open_issues":0,"watchers":0,"default_branch":"main"}},"base":{"label":"sktime:main","ref":"main","sha":"72e7f618dac8b02ef147ea55f4f119cbe8dfbe15","user":{"login":"sktime","id":56396127,"node_id":"MDEyOk9yZ2FuaXphdGlvbjU2Mzk2MTI3","avatar_url":"https://avatars.githubusercontent.com/u/56396127?v=4","gravatar_id":"","url":"https://api.github.com/users/sktime","html_url":"https://github.com/sktime","followers_url":"https://api.github.com/users/sktime/followers","following_url":"https://api.github.com/users/sktime/following{/other_user}","gists_url":"https://api.github.com/users/sktime/gists{/gist_id}","starred_url":"https://api.github.com/users/sktime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sktime/subscriptions","organizations_url":"https://api.github.com/users/sktime/orgs","repos_url":"https://api.github.com/users/sktime/repos","events_url":"https://api.github.com/users/sktime/events{/privacy}","received_events_url":"https://api.github.com/users/sktime/received_events","type":"Organization","site_admin":false},"repo":{"id":156401841,"node_id":"MDEwOlJlcG9zaXRvcnkxNTY0MDE4NDE=","name":"sktime","full_name":"sktime/sktime","private":false,"owner":{"login":"sktime","id":56396127,"node_id":"MDEyOk9yZ2FuaXphdGlvbjU2Mzk2MTI3","avatar_url":"https://avatars.githubusercontent.com/u/56396127?v=4","gravatar_id":"","url":"https://api.github.com/users/sktime","html_url":"https://github.com/sktime","followers_url":"https://api.github.com/users/sktime/followers","following_url":"https://api.github.com/users/sktime/following{/other_user}","gists_url":"https://api.github.com/users/sktime/gists{/gist_id}","starred_url":"https://api.github.com/users/sktime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sktime/subscriptions","organizations_url":"https://api.github.com/users/sktime/orgs","repos_url":"https://api.github.com/users/sktime/repos","events_url":"https://api.github.com/users/sktime/events{/privacy}","received_events_url":"https://api.github.com/users/sktime/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/sktime/sktime","description":"A unified framework for machine learning with time series","fork":false,"url":"https://api.github.com/repos/sktime/sktime","forks_url":"https://api.github.com/repos/sktime/sktime/forks","keys_url":"https://api.github.com/repos/sktime/sktime/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sktime/sktime/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sktime/sktime/teams","hooks_url":"https://api.github.com/repos/sktime/sktime/hooks","issue_events_url":"https://api.github.com/repos/sktime/sktime/issues/events{/number}","events_url":"https://api.github.com/repos/sktime/sktime/events","assignees_url":"https://api.github.com/repos/sktime/sktime/assignees{/user}","branches_url":"https://api.github.com/repos/sktime/sktime/branches{/branch}","tags_url":"https://api.github.com/repos/sktime/sktime/tags","blobs_url":"https://api.github.com/repos/sktime/sktime/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sktime/sktime/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sktime/sktime/git/refs{/sha}","trees_url":"https://api.github.com/repos/sktime/sktime/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sktime/sktime/statuses/{sha}","languages_url":"https://api.github.com/repos/sktime/sktime/languages","stargazers_url":"https://api.github.com/repos/sktime/sktime/stargazers","contributors_url":"https://api.github.com/repos/sktime/sktime/contributors","subscribers_url":"https://api.github.com/repos/sktime/sktime/subscribers","subscription_url":"https://api.github.com/repos/sktime/sktime/subscription","commits_url":"https://api.github.com/repos/sktime/sktime/commits{/sha}","git_commits_url":"https://api.github.com/repos/sktime/sktime/git/commits{/sha}","comments_url":"https://api.github.com/repos/sktime/sktime/comments{/number}","issue_comment_url":"https://api.github.com/repos/sktime/sktime/issues/comments{/number}","contents_url":"https://api.github.com/repos/sktime/sktime/contents/{+path}","compare_url":"https://api.github.com/repos/sktime/sktime/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sktime/sktime/merges","archive_url":"https://api.github.com/repos/sktime/sktime/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sktime/sktime/downloads","issues_url":"https://api.github.com/repos/sktime/sktime/issues{/number}","pulls_url":"https://api.github.com/repos/sktime/sktime/pulls{/number}","milestones_url":"https://api.github.com/repos/sktime/sktime/milestones{/number}","notifications_url":"https://api.github.com/repos/sktime/sktime/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sktime/sktime/labels{/name}","releases_url":"https://api.github.com/repos/sktime/sktime/releases{/id}","deployments_url":"https://api.github.com/repos/sktime/sktime/deployments","created_at":"2018-11-06T15:08:24Z","updated_at":"2023-01-26T19:26:46Z","pushed_at":"2023-01-26T23:01:42Z","git_url":"git://github.com/sktime/sktime.git","ssh_url":"git@github.com:sktime/sktime.git","clone_url":"https://github.com/sktime/sktime.git","svn_url":"https://github.com/sktime/sktime","homepage":"https://sktime.org","size":57239,"stargazers_count":6065,"watchers_count":6065,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":1009,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":648,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause","node_id":"MDc6TGljZW5zZTU="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["data-mining","data-science","forecasting","machine-learning","scikit-learn","time-series","time-series-analysis","time-series-classification","time-series-regression"],"visibility":"public","forks":1009,"open_issues":648,"watchers":6065,"default_branch":"main"}},"_links":{"self":{"href":"https://api.github.com/repos/sktime/sktime/pulls/3435"},"html":{"href":"https://github.com/sktime/sktime/pull/3435"},"issue":{"href":"https://api.github.com/repos/sktime/sktime/issues/3435"},"comments":{"href":"https://api.github.com/repos/sktime/sktime/issues/3435/comments"},"review_comments":{"href":"https://api.github.com/repos/sktime/sktime/pulls/3435/comments"},"review_comment":{"href":"https://api.github.com/repos/sktime/sktime/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/sktime/sktime/pulls/3435/commits"},"statuses":{"href":"https://api.github.com/repos/sktime/sktime/statuses/61708e78c02a29570bd084c82933ef690508eac9"}},"author_association":"CONTRIBUTOR","auto_merge":null,"active_lock_reason":null,"merged":true,"mergeable":null,"rebaseable":null,"mergeable_state":"unknown","merged_by":{"login":"fkiraly","id":7985502,"node_id":"MDQ6VXNlcjc5ODU1MDI=","avatar_url":"https://avatars.githubusercontent.com/u/7985502?v=4","gravatar_id":"","url":"https://api.github.com/users/fkiraly","html_url":"https://github.com/fkiraly","followers_url":"https://api.github.com/users/fkiraly/followers","following_url":"https://api.github.com/users/fkiraly/following{/other_user}","gists_url":"https://api.github.com/users/fkiraly/gists{/gist_id}","starred_url":"https://api.github.com/users/fkiraly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkiraly/subscriptions","organizations_url":"https://api.github.com/users/fkiraly/orgs","repos_url":"https://api.github.com/users/fkiraly/repos","events_url":"https://api.github.com/users/fkiraly/events{/privacy}","received_events_url":"https://api.github.com/users/fkiraly/received_events","type":"User","site_admin":false},"comments":6,"review_comments":0,"maintainer_can_modify":false,"commits":18,"additions":278,"deletions":1,"changed_files":3}