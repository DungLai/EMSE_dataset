{"url":"https://api.github.com/repos/sktime/sktime/pulls/3912","id":1154796760,"node_id":"PR_kwDOCVKAsc5E1MzY","html_url":"https://github.com/sktime/sktime/pull/3912","diff_url":"https://github.com/sktime/sktime/pull/3912.diff","patch_url":"https://github.com/sktime/sktime/pull/3912.patch","issue_url":"https://api.github.com/repos/sktime/sktime/issues/3912","number":3912,"state":"closed","locked":false,"title":"[ENH] MLflow custom flavor for `sktime` forecasting","user":{"login":"benjaminbluhm","id":40917599,"node_id":"MDQ6VXNlcjQwOTE3NTk5","avatar_url":"https://avatars.githubusercontent.com/u/40917599?v=4","gravatar_id":"","url":"https://api.github.com/users/benjaminbluhm","html_url":"https://github.com/benjaminbluhm","followers_url":"https://api.github.com/users/benjaminbluhm/followers","following_url":"https://api.github.com/users/benjaminbluhm/following{/other_user}","gists_url":"https://api.github.com/users/benjaminbluhm/gists{/gist_id}","starred_url":"https://api.github.com/users/benjaminbluhm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benjaminbluhm/subscriptions","organizations_url":"https://api.github.com/users/benjaminbluhm/orgs","repos_url":"https://api.github.com/users/benjaminbluhm/repos","events_url":"https://api.github.com/users/benjaminbluhm/events{/privacy}","received_events_url":"https://api.github.com/users/benjaminbluhm/received_events","type":"User","site_admin":false},"body":"#### Reference Issues/PRs\r\nResolves #1215\r\n\r\n#### What does this implement/fix? Explain your changes.\r\nThis PR adds mlflow custom model flavor for sktime. The implementation closely follows the approach of mlflow built-in model flavors, see [`pmdarima`](https://www.mlflow.org/docs/latest/models.html#pmdarima-pmdarima) as an example in mlflow repo (for more details see [mlflow.pmdarima](https://github.com/mlflow/mlflow/blob/master/mlflow/pmdarima.py) and [tests.pmdarima.test_pmdarima_model_export](https://github.com/mlflow/mlflow/blob/master/tests/pmdarima/test_pmdarima_model_export.py)). I also added a mlflow notebook under examples which could be added to the sphinx docs. \r\n\r\n#### Does your contribution introduce a new dependency? If yes, which one?\r\nNew dependencies introduced: `boto3, mlflow, moto`\r\n\r\nI tried to add all dependencies as soft dependencies but ran into a challenge for mlflow. We need to import `pyfunc` from mlflow at the module level to enable loading sktime model as pyfunc flavor. This will not work if we import pyfunc inside the functions. \r\n\r\nWould it be acceptable to have mlflow as core dependency or do you have another suggestion?\r\n\r\n#### What should a reviewer concentrate their feedback on?\r\n\r\n- how we want to handle the open dependency question\r\n- check the `_SktimeModelWrapper`class which contains the sktime custom inference logic \r\n- predict method of `_SktimeModelWrapper` is only allowed to take a single  DataFrame as an input (see [mlflow documentation](https://www.mlflow.org/docs/latest/python_api/mlflow.pyfunc.html) for more details) - thus we can pass exogenous regressor only as 2D or 3D numpy array. Based on my understanding this would cover all forecasters utilizing scitypes `Series` and `Panel` - can you confirm this?\r\n- whether you see the need to add more unit tests\r\n- should we add example notebook to sphinx docs? Is there anything in the code that needs to be modified for this inclusion?  \r\n\r\n#### Any other comments?\r\n<!--\r\nPlease be aware that we are a loose team of volunteers so patience is necessary; assistance handling other issues is very welcome. We value all user contributions, no matter how minor they are. If we are slow to review, either the pull request needs some benchmarking, tinkering, convincing, etc. or more likely the reviewers are simply busy. In either case, we ask for your understanding during the review process.\r\n-->\r\n\r\n#### PR checklist\r\n<!--\r\nPlease go through the checklist below. Please feel free to remove points if they are not applicable.\r\n-->\r\n\r\n##### For all contributions\r\n- [x] I've added myself to the [list of contributors](https://github.com/sktime/sktime/blob/main/.all-contributorsrc).\r\n- [x] Optionally, I've updated sktime's [CODEOWNERS](https://github.com/sktime/sktime/blob/main/CODEOWNERS) to receive notifications about future changes to these files.\r\n- [x] I've added unit tests and made sure they pass locally.\r\n- [x] The PR title starts with either [ENH], [MNT], [DOC], or [BUG] indicating whether the PR topic is related to enhancement, maintenance, documentation, or bug.\r\n\r\n##### For new estimators\r\n- [ ] I've added the estimator to the online documentation.\r\n- [ ] I've updated the existing example notebooks or provided a new one to showcase how my estimator works.\r\n\r\n\r\n<!--\r\nThanks for contributing!\r\n-->\r\n","created_at":"2022-12-08T20:58:51Z","updated_at":"2022-12-21T19:03:07Z","closed_at":"2022-12-21T19:02:56Z","merged_at":"2022-12-21T19:02:56Z","merge_commit_sha":"3e8fe8cd3b6bf2ac287653bf16585ca214ce717e","assignee":null,"assignees":[],"requested_reviewers":[{"login":"lmmentel","id":8989838,"node_id":"MDQ6VXNlcjg5ODk4Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/8989838?v=4","gravatar_id":"","url":"https://api.github.com/users/lmmentel","html_url":"https://github.com/lmmentel","followers_url":"https://api.github.com/users/lmmentel/followers","following_url":"https://api.github.com/users/lmmentel/following{/other_user}","gists_url":"https://api.github.com/users/lmmentel/gists{/gist_id}","starred_url":"https://api.github.com/users/lmmentel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lmmentel/subscriptions","organizations_url":"https://api.github.com/users/lmmentel/orgs","repos_url":"https://api.github.com/users/lmmentel/repos","events_url":"https://api.github.com/users/lmmentel/events{/privacy}","received_events_url":"https://api.github.com/users/lmmentel/received_events","type":"User","site_admin":false},{"login":"freddyaboulton","id":41651716,"node_id":"MDQ6VXNlcjQxNjUxNzE2","avatar_url":"https://avatars.githubusercontent.com/u/41651716?v=4","gravatar_id":"","url":"https://api.github.com/users/freddyaboulton","html_url":"https://github.com/freddyaboulton","followers_url":"https://api.github.com/users/freddyaboulton/followers","following_url":"https://api.github.com/users/freddyaboulton/following{/other_user}","gists_url":"https://api.github.com/users/freddyaboulton/gists{/gist_id}","starred_url":"https://api.github.com/users/freddyaboulton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/freddyaboulton/subscriptions","organizations_url":"https://api.github.com/users/freddyaboulton/orgs","repos_url":"https://api.github.com/users/freddyaboulton/repos","events_url":"https://api.github.com/users/freddyaboulton/events{/privacy}","received_events_url":"https://api.github.com/users/freddyaboulton/received_events","type":"User","site_admin":false},{"login":"GuzalBulatova","id":73598322,"node_id":"MDQ6VXNlcjczNTk4MzIy","avatar_url":"https://avatars.githubusercontent.com/u/73598322?v=4","gravatar_id":"","url":"https://api.github.com/users/GuzalBulatova","html_url":"https://github.com/GuzalBulatova","followers_url":"https://api.github.com/users/GuzalBulatova/followers","following_url":"https://api.github.com/users/GuzalBulatova/following{/other_user}","gists_url":"https://api.github.com/users/GuzalBulatova/gists{/gist_id}","starred_url":"https://api.github.com/users/GuzalBulatova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GuzalBulatova/subscriptions","organizations_url":"https://api.github.com/users/GuzalBulatova/orgs","repos_url":"https://api.github.com/users/GuzalBulatova/repos","events_url":"https://api.github.com/users/GuzalBulatova/events{/privacy}","received_events_url":"https://api.github.com/users/GuzalBulatova/received_events","type":"User","site_admin":false}],"requested_teams":[],"labels":[{"id":3105906374,"node_id":"MDU6TGFiZWwzMTA1OTA2Mzc0","url":"https://api.github.com/repos/sktime/sktime/labels/module:forecasting","name":"module:forecasting","color":"35FCCE","default":false,"description":""}],"milestone":null,"draft":false,"commits_url":"https://api.github.com/repos/sktime/sktime/pulls/3912/commits","review_comments_url":"https://api.github.com/repos/sktime/sktime/pulls/3912/comments","review_comment_url":"https://api.github.com/repos/sktime/sktime/pulls/comments{/number}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/3912/comments","statuses_url":"https://api.github.com/repos/sktime/sktime/statuses/a066ddb6f7269fed662d5dd57a4a335cb4d5921a","head":{"label":"benjaminbluhm:mlflow-custom-flavor","ref":"mlflow-custom-flavor","sha":"a066ddb6f7269fed662d5dd57a4a335cb4d5921a","user":{"login":"benjaminbluhm","id":40917599,"node_id":"MDQ6VXNlcjQwOTE3NTk5","avatar_url":"https://avatars.githubusercontent.com/u/40917599?v=4","gravatar_id":"","url":"https://api.github.com/users/benjaminbluhm","html_url":"https://github.com/benjaminbluhm","followers_url":"https://api.github.com/users/benjaminbluhm/followers","following_url":"https://api.github.com/users/benjaminbluhm/following{/other_user}","gists_url":"https://api.github.com/users/benjaminbluhm/gists{/gist_id}","starred_url":"https://api.github.com/users/benjaminbluhm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benjaminbluhm/subscriptions","organizations_url":"https://api.github.com/users/benjaminbluhm/orgs","repos_url":"https://api.github.com/users/benjaminbluhm/repos","events_url":"https://api.github.com/users/benjaminbluhm/events{/privacy}","received_events_url":"https://api.github.com/users/benjaminbluhm/received_events","type":"User","site_admin":false},"repo":{"id":570925832,"node_id":"R_kgDOIgejCA","name":"sktime","full_name":"benjaminbluhm/sktime","private":false,"owner":{"login":"benjaminbluhm","id":40917599,"node_id":"MDQ6VXNlcjQwOTE3NTk5","avatar_url":"https://avatars.githubusercontent.com/u/40917599?v=4","gravatar_id":"","url":"https://api.github.com/users/benjaminbluhm","html_url":"https://github.com/benjaminbluhm","followers_url":"https://api.github.com/users/benjaminbluhm/followers","following_url":"https://api.github.com/users/benjaminbluhm/following{/other_user}","gists_url":"https://api.github.com/users/benjaminbluhm/gists{/gist_id}","starred_url":"https://api.github.com/users/benjaminbluhm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benjaminbluhm/subscriptions","organizations_url":"https://api.github.com/users/benjaminbluhm/orgs","repos_url":"https://api.github.com/users/benjaminbluhm/repos","events_url":"https://api.github.com/users/benjaminbluhm/events{/privacy}","received_events_url":"https://api.github.com/users/benjaminbluhm/received_events","type":"User","site_admin":false},"html_url":"https://github.com/benjaminbluhm/sktime","description":"A unified framework for machine learning with time series","fork":true,"url":"https://api.github.com/repos/benjaminbluhm/sktime","forks_url":"https://api.github.com/repos/benjaminbluhm/sktime/forks","keys_url":"https://api.github.com/repos/benjaminbluhm/sktime/keys{/key_id}","collaborators_url":"https://api.github.com/repos/benjaminbluhm/sktime/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/benjaminbluhm/sktime/teams","hooks_url":"https://api.github.com/repos/benjaminbluhm/sktime/hooks","issue_events_url":"https://api.github.com/repos/benjaminbluhm/sktime/issues/events{/number}","events_url":"https://api.github.com/repos/benjaminbluhm/sktime/events","assignees_url":"https://api.github.com/repos/benjaminbluhm/sktime/assignees{/user}","branches_url":"https://api.github.com/repos/benjaminbluhm/sktime/branches{/branch}","tags_url":"https://api.github.com/repos/benjaminbluhm/sktime/tags","blobs_url":"https://api.github.com/repos/benjaminbluhm/sktime/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/benjaminbluhm/sktime/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/benjaminbluhm/sktime/git/refs{/sha}","trees_url":"https://api.github.com/repos/benjaminbluhm/sktime/git/trees{/sha}","statuses_url":"https://api.github.com/repos/benjaminbluhm/sktime/statuses/{sha}","languages_url":"https://api.github.com/repos/benjaminbluhm/sktime/languages","stargazers_url":"https://api.github.com/repos/benjaminbluhm/sktime/stargazers","contributors_url":"https://api.github.com/repos/benjaminbluhm/sktime/contributors","subscribers_url":"https://api.github.com/repos/benjaminbluhm/sktime/subscribers","subscription_url":"https://api.github.com/repos/benjaminbluhm/sktime/subscription","commits_url":"https://api.github.com/repos/benjaminbluhm/sktime/commits{/sha}","git_commits_url":"https://api.github.com/repos/benjaminbluhm/sktime/git/commits{/sha}","comments_url":"https://api.github.com/repos/benjaminbluhm/sktime/comments{/number}","issue_comment_url":"https://api.github.com/repos/benjaminbluhm/sktime/issues/comments{/number}","contents_url":"https://api.github.com/repos/benjaminbluhm/sktime/contents/{+path}","compare_url":"https://api.github.com/repos/benjaminbluhm/sktime/compare/{base}...{head}","merges_url":"https://api.github.com/repos/benjaminbluhm/sktime/merges","archive_url":"https://api.github.com/repos/benjaminbluhm/sktime/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/benjaminbluhm/sktime/downloads","issues_url":"https://api.github.com/repos/benjaminbluhm/sktime/issues{/number}","pulls_url":"https://api.github.com/repos/benjaminbluhm/sktime/pulls{/number}","milestones_url":"https://api.github.com/repos/benjaminbluhm/sktime/milestones{/number}","notifications_url":"https://api.github.com/repos/benjaminbluhm/sktime/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/benjaminbluhm/sktime/labels{/name}","releases_url":"https://api.github.com/repos/benjaminbluhm/sktime/releases{/id}","deployments_url":"https://api.github.com/repos/benjaminbluhm/sktime/deployments","created_at":"2022-11-26T15:25:32Z","updated_at":"2022-12-29T09:40:28Z","pushed_at":"2022-12-29T09:40:07Z","git_url":"git://github.com/benjaminbluhm/sktime.git","ssh_url":"git@github.com:benjaminbluhm/sktime.git","clone_url":"https://github.com/benjaminbluhm/sktime.git","svn_url":"https://github.com/benjaminbluhm/sktime","homepage":"https://sktime.org","size":48461,"stargazers_count":0,"watchers_count":0,"language":"Python","has_issues":false,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":0,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":0,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause","node_id":"MDc6TGljZW5zZTU="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":0,"open_issues":0,"watchers":0,"default_branch":"main"}},"base":{"label":"sktime:main","ref":"main","sha":"8c725145afa56778761d18c20044400ebbf5c3d8","user":{"login":"sktime","id":56396127,"node_id":"MDEyOk9yZ2FuaXphdGlvbjU2Mzk2MTI3","avatar_url":"https://avatars.githubusercontent.com/u/56396127?v=4","gravatar_id":"","url":"https://api.github.com/users/sktime","html_url":"https://github.com/sktime","followers_url":"https://api.github.com/users/sktime/followers","following_url":"https://api.github.com/users/sktime/following{/other_user}","gists_url":"https://api.github.com/users/sktime/gists{/gist_id}","starred_url":"https://api.github.com/users/sktime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sktime/subscriptions","organizations_url":"https://api.github.com/users/sktime/orgs","repos_url":"https://api.github.com/users/sktime/repos","events_url":"https://api.github.com/users/sktime/events{/privacy}","received_events_url":"https://api.github.com/users/sktime/received_events","type":"Organization","site_admin":false},"repo":{"id":156401841,"node_id":"MDEwOlJlcG9zaXRvcnkxNTY0MDE4NDE=","name":"sktime","full_name":"sktime/sktime","private":false,"owner":{"login":"sktime","id":56396127,"node_id":"MDEyOk9yZ2FuaXphdGlvbjU2Mzk2MTI3","avatar_url":"https://avatars.githubusercontent.com/u/56396127?v=4","gravatar_id":"","url":"https://api.github.com/users/sktime","html_url":"https://github.com/sktime","followers_url":"https://api.github.com/users/sktime/followers","following_url":"https://api.github.com/users/sktime/following{/other_user}","gists_url":"https://api.github.com/users/sktime/gists{/gist_id}","starred_url":"https://api.github.com/users/sktime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sktime/subscriptions","organizations_url":"https://api.github.com/users/sktime/orgs","repos_url":"https://api.github.com/users/sktime/repos","events_url":"https://api.github.com/users/sktime/events{/privacy}","received_events_url":"https://api.github.com/users/sktime/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/sktime/sktime","description":"A unified framework for machine learning with time series","fork":false,"url":"https://api.github.com/repos/sktime/sktime","forks_url":"https://api.github.com/repos/sktime/sktime/forks","keys_url":"https://api.github.com/repos/sktime/sktime/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sktime/sktime/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sktime/sktime/teams","hooks_url":"https://api.github.com/repos/sktime/sktime/hooks","issue_events_url":"https://api.github.com/repos/sktime/sktime/issues/events{/number}","events_url":"https://api.github.com/repos/sktime/sktime/events","assignees_url":"https://api.github.com/repos/sktime/sktime/assignees{/user}","branches_url":"https://api.github.com/repos/sktime/sktime/branches{/branch}","tags_url":"https://api.github.com/repos/sktime/sktime/tags","blobs_url":"https://api.github.com/repos/sktime/sktime/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sktime/sktime/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sktime/sktime/git/refs{/sha}","trees_url":"https://api.github.com/repos/sktime/sktime/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sktime/sktime/statuses/{sha}","languages_url":"https://api.github.com/repos/sktime/sktime/languages","stargazers_url":"https://api.github.com/repos/sktime/sktime/stargazers","contributors_url":"https://api.github.com/repos/sktime/sktime/contributors","subscribers_url":"https://api.github.com/repos/sktime/sktime/subscribers","subscription_url":"https://api.github.com/repos/sktime/sktime/subscription","commits_url":"https://api.github.com/repos/sktime/sktime/commits{/sha}","git_commits_url":"https://api.github.com/repos/sktime/sktime/git/commits{/sha}","comments_url":"https://api.github.com/repos/sktime/sktime/comments{/number}","issue_comment_url":"https://api.github.com/repos/sktime/sktime/issues/comments{/number}","contents_url":"https://api.github.com/repos/sktime/sktime/contents/{+path}","compare_url":"https://api.github.com/repos/sktime/sktime/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sktime/sktime/merges","archive_url":"https://api.github.com/repos/sktime/sktime/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sktime/sktime/downloads","issues_url":"https://api.github.com/repos/sktime/sktime/issues{/number}","pulls_url":"https://api.github.com/repos/sktime/sktime/pulls{/number}","milestones_url":"https://api.github.com/repos/sktime/sktime/milestones{/number}","notifications_url":"https://api.github.com/repos/sktime/sktime/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sktime/sktime/labels{/name}","releases_url":"https://api.github.com/repos/sktime/sktime/releases{/id}","deployments_url":"https://api.github.com/repos/sktime/sktime/deployments","created_at":"2018-11-06T15:08:24Z","updated_at":"2023-01-26T19:26:46Z","pushed_at":"2023-01-26T23:01:42Z","git_url":"git://github.com/sktime/sktime.git","ssh_url":"git@github.com:sktime/sktime.git","clone_url":"https://github.com/sktime/sktime.git","svn_url":"https://github.com/sktime/sktime","homepage":"https://sktime.org","size":57239,"stargazers_count":6065,"watchers_count":6065,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":1009,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":648,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause","node_id":"MDc6TGljZW5zZTU="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["data-mining","data-science","forecasting","machine-learning","scikit-learn","time-series","time-series-analysis","time-series-classification","time-series-regression"],"visibility":"public","forks":1009,"open_issues":648,"watchers":6065,"default_branch":"main"}},"_links":{"self":{"href":"https://api.github.com/repos/sktime/sktime/pulls/3912"},"html":{"href":"https://github.com/sktime/sktime/pull/3912"},"issue":{"href":"https://api.github.com/repos/sktime/sktime/issues/3912"},"comments":{"href":"https://api.github.com/repos/sktime/sktime/issues/3912/comments"},"review_comments":{"href":"https://api.github.com/repos/sktime/sktime/pulls/3912/comments"},"review_comment":{"href":"https://api.github.com/repos/sktime/sktime/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/sktime/sktime/pulls/3912/commits"},"statuses":{"href":"https://api.github.com/repos/sktime/sktime/statuses/a066ddb6f7269fed662d5dd57a4a335cb4d5921a"}},"author_association":"CONTRIBUTOR","auto_merge":null,"active_lock_reason":null,"merged":true,"mergeable":null,"rebaseable":null,"mergeable_state":"unknown","merged_by":{"login":"fkiraly","id":7985502,"node_id":"MDQ6VXNlcjc5ODU1MDI=","avatar_url":"https://avatars.githubusercontent.com/u/7985502?v=4","gravatar_id":"","url":"https://api.github.com/users/fkiraly","html_url":"https://github.com/fkiraly","followers_url":"https://api.github.com/users/fkiraly/followers","following_url":"https://api.github.com/users/fkiraly/following{/other_user}","gists_url":"https://api.github.com/users/fkiraly/gists{/gist_id}","starred_url":"https://api.github.com/users/fkiraly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkiraly/subscriptions","organizations_url":"https://api.github.com/users/fkiraly/orgs","repos_url":"https://api.github.com/users/fkiraly/repos","events_url":"https://api.github.com/users/fkiraly/events{/privacy}","received_events_url":"https://api.github.com/users/fkiraly/received_events","type":"User","site_admin":false},"comments":52,"review_comments":37,"maintainer_can_modify":false,"commits":50,"additions":2465,"deletions":40,"changed_files":10}