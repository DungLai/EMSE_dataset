{"url":"https://api.github.com/repos/lufficc/SSD/issues/134","repository_url":"https://api.github.com/repos/lufficc/SSD","labels_url":"https://api.github.com/repos/lufficc/SSD/issues/134/labels{/name}","comments_url":"https://api.github.com/repos/lufficc/SSD/issues/134/comments","events_url":"https://api.github.com/repos/lufficc/SSD/issues/134/events","html_url":"https://github.com/lufficc/SSD/issues/134","id":568669577,"node_id":"MDU6SXNzdWU1Njg2Njk1Nzc=","number":134,"title":"Training COCO on subset","user":{"login":"giuordy","id":25106320,"node_id":"MDQ6VXNlcjI1MTA2MzIw","avatar_url":"https://avatars.githubusercontent.com/u/25106320?v=4","gravatar_id":"","url":"https://api.github.com/users/giuordy","html_url":"https://github.com/giuordy","followers_url":"https://api.github.com/users/giuordy/followers","following_url":"https://api.github.com/users/giuordy/following{/other_user}","gists_url":"https://api.github.com/users/giuordy/gists{/gist_id}","starred_url":"https://api.github.com/users/giuordy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/giuordy/subscriptions","organizations_url":"https://api.github.com/users/giuordy/orgs","repos_url":"https://api.github.com/users/giuordy/repos","events_url":"https://api.github.com/users/giuordy/events{/privacy}","received_events_url":"https://api.github.com/users/giuordy/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-02-21T00:50:15Z","updated_at":"2020-05-26T18:26:37Z","closed_at":"2020-05-26T18:26:37Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, I would like to train model on a subset of COCO, like using less classes (e.g. 4) instead of all classes. I modified the init code of COCO like that:\r\n\r\n\r\nfrom pycocotools.coco import COCO\r\n        self.coco = COCO(ann_file)\r\n        self.data_dir = data_dir\r\n        self.transform = transform\r\n        self.target_transform = target_transform\r\n        self.remove_empty = remove_empty\r\n        if class_ids:\r\n            self.ids = []\r\n            for id in class_ids:\r\n                self.ids.extend(list(self.coco.getImgIds(catIds=[id])))\r\n            # Remove duplicates\r\n            self.ids = list(set(self.ids))\r\n        else:\r\n            if self.remove_empty:\r\n                # when training, images without annotations are removed.\r\n                self.ids = list(self.coco.imgToAnns.keys())\r\n            else:\r\n                # when testing, all images used.\r\n                self.ids = list(self.coco.imgs.keys())\r\n        print(self.ids)\r\n        if class_ids:\r\n            coco_categories = class_ids\r\n        else:\r\n            coco_categories = sorted(self.coco.getCatIds())\r\n        self.coco_id_to_contiguous_id = {coco_id: i + 1 for i, coco_id in enumerate(coco_categories)}\r\n        self.contiguous_id_to_coco_id = {v: k for k, v in self.coco_id_to_contiguous_id.items()}\r\n\r\nWhen I try to train I have this error:\r\n\r\nTraceback (most recent call last):\r\n  File \"train.py\", line 118, in <module>\r\n    main()\r\n  File \"train.py\", line 109, in main\r\n    model = train(cfg, args, class_ids=[1, 3, 62, 67])\r\n  File \"train.py\", line 48, in train\r\n    model = do_train(cfg, model, train_loader, optimizer, scheduler, checkpointer, device, arguments, args)\r\n  File \"F:\\GIORDANO\\SSD\\SSD\\ssd\\engine\\trainer.py\", line 74, in do_train\r\n    for iteration, (images, targets, _) in enumerate(data_loader, start_iter):\r\n  File \"C:\\Users\\Tesista\\Miniconda3\\envs\\SSD\\lib\\site-packages\\torch\\utils\\data\\dataloader.py\", line 345, in __next__\r\n    data = self._next_data()\r\n  File \"C:\\Users\\Tesista\\Miniconda3\\envs\\SSD\\lib\\site-packages\\torch\\utils\\data\\dataloader.py\", line 856, in _next_data\r\n    return self._process_data(data)\r\n  File \"C:\\Users\\Tesista\\Miniconda3\\envs\\SSD\\lib\\site-packages\\torch\\utils\\data\\dataloader.py\", line 881, in _process_data\r\n    data.reraise()\r\n  File \"C:\\Users\\Tesista\\Miniconda3\\envs\\SSD\\lib\\site-packages\\torch\\_utils.py\", line 394, in reraise\r\n    raise self.exc_type(msg)\r\nKeyError: Caught KeyError in DataLoader worker process 0.\r\nOriginal Traceback (most recent call last):\r\n  File \"C:\\Users\\Tesista\\Miniconda3\\envs\\SSD\\lib\\site-packages\\torch\\utils\\data\\_utils\\worker.py\", line 178, in _worker_loop\r\n    data = fetcher.fetch(index)\r\n  File \"C:\\Users\\Tesista\\Miniconda3\\envs\\SSD\\lib\\site-packages\\torch\\utils\\data\\_utils\\fetch.py\", line 44, in fetch\r\n    data = [self.dataset[idx] for idx in possibly_batched_index]\r\n  File \"C:\\Users\\Tesista\\Miniconda3\\envs\\SSD\\lib\\site-packages\\torch\\utils\\data\\_utils\\fetch.py\", line 44, in <listcomp>\r\n    data = [self.dataset[idx] for idx in possibly_batched_index]\r\n  File \"F:\\GIORDANO\\SSD\\SSD\\ssd\\data\\datasets\\coco.py\", line 60, in __getitem__\r\n    boxes, labels = self._get_annotation(image_id)\r\n  File \"F:\\GIORDANO\\SSD\\SSD\\ssd\\data\\datasets\\coco.py\", line 88, in _get_annotation\r\n    labels = np.array([self.coco_id_to_contiguous_id[obj[\"category_id\"]] for obj in ann], np.int64).reshape((-1,))\r\n  File \"F:\\GIORDANO\\SSD\\SSD\\ssd\\data\\datasets\\coco.py\", line 88, in <listcomp>\r\n    labels = np.array([self.coco_id_to_contiguous_id[obj[\"category_id\"]] for obj in ann], np.int64).reshape((-1,))\r\nKeyError: 49\r\n\r\nCan someone help me? \r\n\r\n","closed_by":{"login":"lufficc","id":20706332,"node_id":"MDQ6VXNlcjIwNzA2MzMy","avatar_url":"https://avatars.githubusercontent.com/u/20706332?v=4","gravatar_id":"","url":"https://api.github.com/users/lufficc","html_url":"https://github.com/lufficc","followers_url":"https://api.github.com/users/lufficc/followers","following_url":"https://api.github.com/users/lufficc/following{/other_user}","gists_url":"https://api.github.com/users/lufficc/gists{/gist_id}","starred_url":"https://api.github.com/users/lufficc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lufficc/subscriptions","organizations_url":"https://api.github.com/users/lufficc/orgs","repos_url":"https://api.github.com/users/lufficc/repos","events_url":"https://api.github.com/users/lufficc/events{/privacy}","received_events_url":"https://api.github.com/users/lufficc/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/lufficc/SSD/issues/134/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/lufficc/SSD/issues/134/timeline","performed_via_github_app":null,"state_reason":"completed"}