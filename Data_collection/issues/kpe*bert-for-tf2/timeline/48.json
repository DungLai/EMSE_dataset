[{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/578126715","html_url":"https://github.com/kpe/bert-for-tf2/issues/48#issuecomment-578126715","issue_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/48","id":578126715,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODEyNjcxNQ==","user":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false},"created_at":"2020-01-24T13:20:09Z","updated_at":"2020-01-24T13:20:09Z","author_association":"OWNER","body":"@fakerbrother - I guess you might have to provide the `custom_objects` argument, i.e.\r\n```\r\ntf.keras.models.load_model(path, custom_objects={\"BertModelLayer\": bert.BertModelLayer})\r\n```\r\ncheck https://www.tensorflow.org/tutorials/keras/save_and_load#saving_custom_objects","reactions":{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/578126715/reactions","total_count":4,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":2,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false}},{"id":2977198473,"node_id":"MDExOkNsb3NlZEV2ZW50Mjk3NzE5ODQ3Mw==","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/2977198473","actor":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-01-24T13:20:09Z","state_reason":null,"performed_via_github_app":null},{"id":2977198478,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjk3NzE5ODQ3OA==","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/2977198478","actor":{"login":"fakerbrother","id":42272100,"node_id":"MDQ6VXNlcjQyMjcyMTAw","avatar_url":"https://avatars.githubusercontent.com/u/42272100?v=4","gravatar_id":"","url":"https://api.github.com/users/fakerbrother","html_url":"https://github.com/fakerbrother","followers_url":"https://api.github.com/users/fakerbrother/followers","following_url":"https://api.github.com/users/fakerbrother/following{/other_user}","gists_url":"https://api.github.com/users/fakerbrother/gists{/gist_id}","starred_url":"https://api.github.com/users/fakerbrother/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fakerbrother/subscriptions","organizations_url":"https://api.github.com/users/fakerbrother/orgs","repos_url":"https://api.github.com/users/fakerbrother/repos","events_url":"https://api.github.com/users/fakerbrother/events{/privacy}","received_events_url":"https://api.github.com/users/fakerbrother/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-24T13:20:09Z","performed_via_github_app":null},{"id":2977198479,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5NzcxOTg0Nzk=","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/2977198479","actor":{"login":"fakerbrother","id":42272100,"node_id":"MDQ6VXNlcjQyMjcyMTAw","avatar_url":"https://avatars.githubusercontent.com/u/42272100?v=4","gravatar_id":"","url":"https://api.github.com/users/fakerbrother","html_url":"https://github.com/fakerbrother","followers_url":"https://api.github.com/users/fakerbrother/followers","following_url":"https://api.github.com/users/fakerbrother/following{/other_user}","gists_url":"https://api.github.com/users/fakerbrother/gists{/gist_id}","starred_url":"https://api.github.com/users/fakerbrother/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fakerbrother/subscriptions","organizations_url":"https://api.github.com/users/fakerbrother/orgs","repos_url":"https://api.github.com/users/fakerbrother/repos","events_url":"https://api.github.com/users/fakerbrother/events{/privacy}","received_events_url":"https://api.github.com/users/fakerbrother/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-24T13:20:09Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/616598108","html_url":"https://github.com/kpe/bert-for-tf2/issues/48#issuecomment-616598108","issue_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/48","id":616598108,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNjU5ODEwOA==","user":{"login":"ptamas88","id":36891268,"node_id":"MDQ6VXNlcjM2ODkxMjY4","avatar_url":"https://avatars.githubusercontent.com/u/36891268?v=4","gravatar_id":"","url":"https://api.github.com/users/ptamas88","html_url":"https://github.com/ptamas88","followers_url":"https://api.github.com/users/ptamas88/followers","following_url":"https://api.github.com/users/ptamas88/following{/other_user}","gists_url":"https://api.github.com/users/ptamas88/gists{/gist_id}","starred_url":"https://api.github.com/users/ptamas88/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptamas88/subscriptions","organizations_url":"https://api.github.com/users/ptamas88/orgs","repos_url":"https://api.github.com/users/ptamas88/repos","events_url":"https://api.github.com/users/ptamas88/events{/privacy}","received_events_url":"https://api.github.com/users/ptamas88/received_events","type":"User","site_admin":false},"created_at":"2020-04-20T14:41:10Z","updated_at":"2020-04-21T11:32:48Z","author_association":"NONE","body":"Hello @kpe,\r\nI saved the model in h5 format with the following code\r\n`model.save('bert_finetuned.h5', save_format='h5')`\r\nThen try to load it with the recommended settings:\r\n`model_2 = tf.keras.models.load_model('bert_finetuned.h5', custom_objects={\"BertModelLayer\": bert.model.BertModelLayer})`\r\nI get the following error:\r\n```\r\n.../venv/lib/python3.6/site-packages/tensorflow_core/python/framework/tensor_shape.py in assert_is_compatible_with(self, other)\r\n   1113     \"\"\"\r\n   1114     if not self.is_compatible_with(other):\r\n-> 1115       raise ValueError(\"Shapes %s and %s are incompatible\" % (self, other))\r\n   1116 \r\n   1117   def most_specific_compatible_shape(self, other):\r\n\r\nValueError: Shapes (119547, 768) and (768, 768) are incompatible\r\n```\r\nI think it's because I use the bert tokenizer vocab (the 119547 size refers to it). How to handle this?\r\nHere is the model architecture:\r\n```\r\nbert_params = bert_tf2.params_from_pretrained_ckpt('multi_cased_L-12_H-768_A-12')\r\nbert_layer = bert_tf2.BertModelLayer.from_params(bert_params, name=\"bert\")\r\ninput = tf.keras.layers.Input(shape=(200))\r\noutput = bert_layer(input)\r\noutput = tf.keras.layers.TimeDistributed(tf.keras.layers.Dense(units=len(tag2idx), activation='softmax'))(output)\r\nmodel = tf.keras.models.Model(inputs=input, outputs=output)\r\n```","reactions":{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/616598108/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ptamas88","id":36891268,"node_id":"MDQ6VXNlcjM2ODkxMjY4","avatar_url":"https://avatars.githubusercontent.com/u/36891268?v=4","gravatar_id":"","url":"https://api.github.com/users/ptamas88","html_url":"https://github.com/ptamas88","followers_url":"https://api.github.com/users/ptamas88/followers","following_url":"https://api.github.com/users/ptamas88/following{/other_user}","gists_url":"https://api.github.com/users/ptamas88/gists{/gist_id}","starred_url":"https://api.github.com/users/ptamas88/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptamas88/subscriptions","organizations_url":"https://api.github.com/users/ptamas88/orgs","repos_url":"https://api.github.com/users/ptamas88/repos","events_url":"https://api.github.com/users/ptamas88/events{/privacy}","received_events_url":"https://api.github.com/users/ptamas88/received_events","type":"User","site_admin":false}},{"id":3255807978,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI1NTgwNzk3OA==","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/3255807978","actor":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-21T11:32:48Z","performed_via_github_app":null},{"id":3255807980,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyNTU4MDc5ODA=","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/3255807980","actor":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-21T11:32:48Z","performed_via_github_app":null}]