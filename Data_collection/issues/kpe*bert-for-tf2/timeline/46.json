[{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/576952978","html_url":"https://github.com/kpe/bert-for-tf2/issues/46#issuecomment-576952978","issue_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/46","id":576952978,"node_id":"MDEyOklzc3VlQ29tbWVudDU3Njk1Mjk3OA==","user":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false},"created_at":"2020-01-22T00:34:37Z","updated_at":"2020-01-22T00:34:37Z","author_association":"OWNER","body":"@fakerbrother - can you post the code used to create the model? Is it the same as in #44? If yes, try something like (instead of what's in #44 )\r\n```\r\nself.model_dir =\"PretrainedModels/multilingual_L-12_H-768_A-12\" \r\nself.max_seq_len = 64\r\nbert_params = bert.params_from_pretrained_ckpt(self.model_dir)\r\nl_bert = bert.BertModelLayer.from_params(bert_params, name=\"bert\")\r\n\r\nself.model = keras.Sequential([\r\n    keras.layers.InputLayer(input_shape=(self.max_seq_len,), dtype='int32'),\r\n    l_bert,\r\n    keras.layers.GlobalAveragePooling1D()\r\n])\r\n\r\nself.model.build(input_shape=(None, self.max_seq_len))\r\nbert_ckpt_file   = os.path.join(self.model_dir, \"bert_model.ckpt\")\r\nbert.load_stock_weights(l_bert, bert_ckpt_file)\r\n```\r\n\r\nPlease, reopen, if this does not help.","reactions":{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/576952978/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false}},{"id":2968293912,"node_id":"MDExOkNsb3NlZEV2ZW50Mjk2ODI5MzkxMg==","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/2968293912","actor":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-01-22T00:34:37Z","state_reason":null,"performed_via_github_app":null},{"id":2968293925,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjk2ODI5MzkyNQ==","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/2968293925","actor":{"login":"fakerbrother","id":42272100,"node_id":"MDQ6VXNlcjQyMjcyMTAw","avatar_url":"https://avatars.githubusercontent.com/u/42272100?v=4","gravatar_id":"","url":"https://api.github.com/users/fakerbrother","html_url":"https://github.com/fakerbrother","followers_url":"https://api.github.com/users/fakerbrother/followers","following_url":"https://api.github.com/users/fakerbrother/following{/other_user}","gists_url":"https://api.github.com/users/fakerbrother/gists{/gist_id}","starred_url":"https://api.github.com/users/fakerbrother/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fakerbrother/subscriptions","organizations_url":"https://api.github.com/users/fakerbrother/orgs","repos_url":"https://api.github.com/users/fakerbrother/repos","events_url":"https://api.github.com/users/fakerbrother/events{/privacy}","received_events_url":"https://api.github.com/users/fakerbrother/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-22T00:34:38Z","performed_via_github_app":null},{"id":2968293928,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5NjgyOTM5Mjg=","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/2968293928","actor":{"login":"fakerbrother","id":42272100,"node_id":"MDQ6VXNlcjQyMjcyMTAw","avatar_url":"https://avatars.githubusercontent.com/u/42272100?v=4","gravatar_id":"","url":"https://api.github.com/users/fakerbrother","html_url":"https://github.com/fakerbrother","followers_url":"https://api.github.com/users/fakerbrother/followers","following_url":"https://api.github.com/users/fakerbrother/following{/other_user}","gists_url":"https://api.github.com/users/fakerbrother/gists{/gist_id}","starred_url":"https://api.github.com/users/fakerbrother/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fakerbrother/subscriptions","organizations_url":"https://api.github.com/users/fakerbrother/orgs","repos_url":"https://api.github.com/users/fakerbrother/repos","events_url":"https://api.github.com/users/fakerbrother/events{/privacy}","received_events_url":"https://api.github.com/users/fakerbrother/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-22T00:34:38Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/577666202","html_url":"https://github.com/kpe/bert-for-tf2/issues/46#issuecomment-577666202","issue_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/46","id":577666202,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NzY2NjIwMg==","user":{"login":"fakerbrother","id":42272100,"node_id":"MDQ6VXNlcjQyMjcyMTAw","avatar_url":"https://avatars.githubusercontent.com/u/42272100?v=4","gravatar_id":"","url":"https://api.github.com/users/fakerbrother","html_url":"https://github.com/fakerbrother","followers_url":"https://api.github.com/users/fakerbrother/followers","following_url":"https://api.github.com/users/fakerbrother/following{/other_user}","gists_url":"https://api.github.com/users/fakerbrother/gists{/gist_id}","starred_url":"https://api.github.com/users/fakerbrother/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fakerbrother/subscriptions","organizations_url":"https://api.github.com/users/fakerbrother/orgs","repos_url":"https://api.github.com/users/fakerbrother/repos","events_url":"https://api.github.com/users/fakerbrother/events{/privacy}","received_events_url":"https://api.github.com/users/fakerbrother/received_events","type":"User","site_admin":false},"created_at":"2020-01-23T12:44:57Z","updated_at":"2020-01-23T12:44:57Z","author_association":"NONE","body":"Thanks for your response，this problem I have resolved. I used to using PyTorch, I am a rookie in TensorFlow2. So I build model by below code:\r\nimport tensorflow.keras as keras\r\n\r\nimport bert\r\n\r\n\r\nclass BertModel(keras.Model):\r\n    def __init__(self, model_dir, max_seq_len, num_labels=6):\r\n        super(BertModel, self).__init__()\r\n        self.model_dir = model_dir\r\n        self.max_seq_len = max_seq_len\r\n        self.bert_layer = self._get_bert_layer()\r\n        self.flatten_layer = keras.layers.Flatten()\r\n        self.linear = keras.layers.Dense(units=num_labels, input_shape=(768*max_seq_len, ), activation='sigmoid')\r\n\r\n    def _get_bert_layer(self):\r\n        bert_params = bert.params_from_pretrained_ckpt(self.model_dir)\r\n        bert_layer = bert.BertModelLayer.from_params(bert_params, name=\"bert\")\r\n        return bert_layer\r\n\r\n    def call(self, inputs, training=None, mask=None):\r\n        bert_output = self.bert_layer(inputs)\r\n        flatten_output = self.flatten_layer(bert_output)\r\n        logits = self.linear(flatten_output)\r\n        return logitsmodel = BertModel(bert_path, max_seq_len)\r\nmodel.build(input_shape=(None, max_seq_len))\r\nbert_ckpt_file = os.path.join(bert_path, \"bert_model.ckpt\")\r\nbert.load_stock_weights(model.bert_layer, bert_ckpt_file)\r\nFinally, thanks for your help, bset wishes, :) !\r\n\r\n\r\n\r\n\r\n------------------&nbsp;原始邮件&nbsp;------------------\r\n发件人:&nbsp;\"kpe\"<notifications@github.com&gt;;\r\n发送时间:&nbsp;2020年1月22日(星期三) 上午8:34\r\n收件人:&nbsp;\"kpe/bert-for-tf2\"<bert-for-tf2@noreply.github.com&gt;;\r\n抄送:&nbsp;\"李小李\"<960829614@qq.com&gt;;\"Mention\"<mention@noreply.github.com&gt;;\r\n主题:&nbsp;Re: [kpe/bert-for-tf2] Gradients do not exist for variables (#46)\r\n\r\n\r\n\r\n\r\n@fakerbrother - can you post the code used to create the model? Is it the same as in #44? If yes, try something like (instead of what's in #44 )\r\n self.model_dir =\"PretrainedModels/multilingual_L-12_H-768_A-12\"  self.max_seq_len = 64 bert_params = bert.params_from_pretrained_ckpt(self.model_dir) l_bert = bert.BertModelLayer.from_params(bert_params, name=\"bert\") self.model = keras.Sequential([     keras.layers.InputLayer(input_shape=(self.max_seq_len,), dtype='int32'),     l_bert,     keras.layers.GlobalAveragePooling1D() ]) self.model.build(input_shape=(None, self.max_seq_len)) bert_ckpt_file   = os.path.join(self.model_dir, \"bert_model.ckpt\") bert.load_stock_weights(l_bert, bert_ckpt_file)  \r\nPlease, reopen, if this does not help.\r\n \r\n—\r\nYou are receiving this because you were mentioned.\r\nReply to this email directly, view it on GitHub, or unsubscribe.","reactions":{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/577666202/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fakerbrother","id":42272100,"node_id":"MDQ6VXNlcjQyMjcyMTAw","avatar_url":"https://avatars.githubusercontent.com/u/42272100?v=4","gravatar_id":"","url":"https://api.github.com/users/fakerbrother","html_url":"https://github.com/fakerbrother","followers_url":"https://api.github.com/users/fakerbrother/followers","following_url":"https://api.github.com/users/fakerbrother/following{/other_user}","gists_url":"https://api.github.com/users/fakerbrother/gists{/gist_id}","starred_url":"https://api.github.com/users/fakerbrother/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fakerbrother/subscriptions","organizations_url":"https://api.github.com/users/fakerbrother/orgs","repos_url":"https://api.github.com/users/fakerbrother/repos","events_url":"https://api.github.com/users/fakerbrother/events{/privacy}","received_events_url":"https://api.github.com/users/fakerbrother/received_events","type":"User","site_admin":false}},{"id":2973590405,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjk3MzU5MDQwNQ==","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/2973590405","actor":{"login":"fakerbrother","id":42272100,"node_id":"MDQ6VXNlcjQyMjcyMTAw","avatar_url":"https://avatars.githubusercontent.com/u/42272100?v=4","gravatar_id":"","url":"https://api.github.com/users/fakerbrother","html_url":"https://github.com/fakerbrother","followers_url":"https://api.github.com/users/fakerbrother/followers","following_url":"https://api.github.com/users/fakerbrother/following{/other_user}","gists_url":"https://api.github.com/users/fakerbrother/gists{/gist_id}","starred_url":"https://api.github.com/users/fakerbrother/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fakerbrother/subscriptions","organizations_url":"https://api.github.com/users/fakerbrother/orgs","repos_url":"https://api.github.com/users/fakerbrother/repos","events_url":"https://api.github.com/users/fakerbrother/events{/privacy}","received_events_url":"https://api.github.com/users/fakerbrother/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-23T12:44:58Z","performed_via_github_app":null},{"id":2973590408,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5NzM1OTA0MDg=","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/2973590408","actor":{"login":"fakerbrother","id":42272100,"node_id":"MDQ6VXNlcjQyMjcyMTAw","avatar_url":"https://avatars.githubusercontent.com/u/42272100?v=4","gravatar_id":"","url":"https://api.github.com/users/fakerbrother","html_url":"https://github.com/fakerbrother","followers_url":"https://api.github.com/users/fakerbrother/followers","following_url":"https://api.github.com/users/fakerbrother/following{/other_user}","gists_url":"https://api.github.com/users/fakerbrother/gists{/gist_id}","starred_url":"https://api.github.com/users/fakerbrother/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fakerbrother/subscriptions","organizations_url":"https://api.github.com/users/fakerbrother/orgs","repos_url":"https://api.github.com/users/fakerbrother/repos","events_url":"https://api.github.com/users/fakerbrother/events{/privacy}","received_events_url":"https://api.github.com/users/fakerbrother/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-23T12:44:58Z","performed_via_github_app":null}]