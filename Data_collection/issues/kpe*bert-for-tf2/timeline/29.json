[{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/567047616","html_url":"https://github.com/kpe/bert-for-tf2/issues/29#issuecomment-567047616","issue_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/29","id":567047616,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NzA0NzYxNg==","user":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false},"created_at":"2019-12-18T14:11:11Z","updated_at":"2019-12-18T14:11:11Z","author_association":"OWNER","body":"@fakerbrother - try calling the `apply_adapter_freeze()` only after `model.build()` as before `build()` the parameter shapes are in general unknown (and therefore could get instantiated by keras only after `build()` or a similar operation providing the input shapes).","reactions":{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/567047616/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false}},{"id":2893686113,"node_id":"MDExOkNsb3NlZEV2ZW50Mjg5MzY4NjExMw==","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/2893686113","actor":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-12-18T14:11:11Z","state_reason":null,"performed_via_github_app":null},{"id":2893686120,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjg5MzY4NjEyMA==","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/2893686120","actor":{"login":"fakerbrother","id":42272100,"node_id":"MDQ6VXNlcjQyMjcyMTAw","avatar_url":"https://avatars.githubusercontent.com/u/42272100?v=4","gravatar_id":"","url":"https://api.github.com/users/fakerbrother","html_url":"https://github.com/fakerbrother","followers_url":"https://api.github.com/users/fakerbrother/followers","following_url":"https://api.github.com/users/fakerbrother/following{/other_user}","gists_url":"https://api.github.com/users/fakerbrother/gists{/gist_id}","starred_url":"https://api.github.com/users/fakerbrother/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fakerbrother/subscriptions","organizations_url":"https://api.github.com/users/fakerbrother/orgs","repos_url":"https://api.github.com/users/fakerbrother/repos","events_url":"https://api.github.com/users/fakerbrother/events{/privacy}","received_events_url":"https://api.github.com/users/fakerbrother/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-12-18T14:11:11Z","performed_via_github_app":null},{"id":2893686122,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI4OTM2ODYxMjI=","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/2893686122","actor":{"login":"fakerbrother","id":42272100,"node_id":"MDQ6VXNlcjQyMjcyMTAw","avatar_url":"https://avatars.githubusercontent.com/u/42272100?v=4","gravatar_id":"","url":"https://api.github.com/users/fakerbrother","html_url":"https://github.com/fakerbrother","followers_url":"https://api.github.com/users/fakerbrother/followers","following_url":"https://api.github.com/users/fakerbrother/following{/other_user}","gists_url":"https://api.github.com/users/fakerbrother/gists{/gist_id}","starred_url":"https://api.github.com/users/fakerbrother/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fakerbrother/subscriptions","organizations_url":"https://api.github.com/users/fakerbrother/orgs","repos_url":"https://api.github.com/users/fakerbrother/repos","events_url":"https://api.github.com/users/fakerbrother/events{/privacy}","received_events_url":"https://api.github.com/users/fakerbrother/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-12-18T14:11:11Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/567053803","html_url":"https://github.com/kpe/bert-for-tf2/issues/29#issuecomment-567053803","issue_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/29","id":567053803,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NzA1MzgwMw==","user":{"login":"fakerbrother","id":42272100,"node_id":"MDQ6VXNlcjQyMjcyMTAw","avatar_url":"https://avatars.githubusercontent.com/u/42272100?v=4","gravatar_id":"","url":"https://api.github.com/users/fakerbrother","html_url":"https://github.com/fakerbrother","followers_url":"https://api.github.com/users/fakerbrother/followers","following_url":"https://api.github.com/users/fakerbrother/following{/other_user}","gists_url":"https://api.github.com/users/fakerbrother/gists{/gist_id}","starred_url":"https://api.github.com/users/fakerbrother/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fakerbrother/subscriptions","organizations_url":"https://api.github.com/users/fakerbrother/orgs","repos_url":"https://api.github.com/users/fakerbrother/repos","events_url":"https://api.github.com/users/fakerbrother/events{/privacy}","received_events_url":"https://api.github.com/users/fakerbrother/received_events","type":"User","site_admin":false},"created_at":"2019-12-18T14:26:59Z","updated_at":"2019-12-18T14:26:59Z","author_association":"NONE","body":"okï¼ŒI will try it, thanks for your response, :)","reactions":{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/567053803/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fakerbrother","id":42272100,"node_id":"MDQ6VXNlcjQyMjcyMTAw","avatar_url":"https://avatars.githubusercontent.com/u/42272100?v=4","gravatar_id":"","url":"https://api.github.com/users/fakerbrother","html_url":"https://github.com/fakerbrother","followers_url":"https://api.github.com/users/fakerbrother/followers","following_url":"https://api.github.com/users/fakerbrother/following{/other_user}","gists_url":"https://api.github.com/users/fakerbrother/gists{/gist_id}","starred_url":"https://api.github.com/users/fakerbrother/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fakerbrother/subscriptions","organizations_url":"https://api.github.com/users/fakerbrother/orgs","repos_url":"https://api.github.com/users/fakerbrother/repos","events_url":"https://api.github.com/users/fakerbrother/events{/privacy}","received_events_url":"https://api.github.com/users/fakerbrother/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/596140119","html_url":"https://github.com/kpe/bert-for-tf2/issues/29#issuecomment-596140119","issue_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/29","id":596140119,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NjE0MDExOQ==","user":{"login":"ck37","id":50770,"node_id":"MDQ6VXNlcjUwNzcw","avatar_url":"https://avatars.githubusercontent.com/u/50770?v=4","gravatar_id":"","url":"https://api.github.com/users/ck37","html_url":"https://github.com/ck37","followers_url":"https://api.github.com/users/ck37/followers","following_url":"https://api.github.com/users/ck37/following{/other_user}","gists_url":"https://api.github.com/users/ck37/gists{/gist_id}","starred_url":"https://api.github.com/users/ck37/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ck37/subscriptions","organizations_url":"https://api.github.com/users/ck37/orgs","repos_url":"https://api.github.com/users/ck37/repos","events_url":"https://api.github.com/users/ck37/events{/privacy}","received_events_url":"https://api.github.com/users/ck37/received_events","type":"User","site_admin":false},"created_at":"2020-03-07T21:39:20Z","updated_at":"2020-03-07T21:40:19Z","author_association":"NONE","body":"I also see no effect from calling `apply_adapter_freeze()` after `model.build()`. Here is example code using tensorflow 2.1:\r\n\r\n```python\r\nmodel_name = \"uncased_L-12_H-768_A-12\"\r\nmodel_dir = bert.fetch_google_bert_model(model_name, \".models\")\r\nmodel_ckpt = os.path.join(model_dir, \"bert_model.ckpt\")\r\n\r\nbert_params = bert.params_from_pretrained_ckpt(model_dir)\r\nl_bert = bert.BertModelLayer.from_params(bert_params, name=\"bert\")\r\n\r\nmax_seq_len = 128\r\nl_input_ids      = keras.layers.Input(shape=(max_seq_len,), dtype='int32')\r\nl_token_type_ids = keras.layers.Input(shape=(max_seq_len,), dtype='int32')\r\n\r\n# using the default token_type/segment id 0\r\noutput = l_bert(l_input_ids)                              # output: [batch_size, max_seq_len, hidden_size]\r\n\r\noutput = layers.Dense(64, activation = 'relu')(output)\r\noutput = Dropout(0.4)(output)\r\noutput = Dense(1, activation = \"linear\")(output)\r\n\r\nmodel = keras.Model(inputs = l_input_ids, outputs = output)\r\n\r\nmodel.build(input_shape = (None, max_seq_len))\r\n\r\n# Needs to be after model.build().\r\nl_bert.apply_adapter_freeze()\r\n\r\nbert.load_bert_weights(l_bert, model_ckpt)      # should be called after model.build()\r\n\r\nopt_adam = tf.keras.optimizers.Adam()\r\n\r\nmodel.compile(loss = tf.keras.losses.MeanSquaredError(), optimizer = opt_adam)\r\nmodel.summary()\r\n```\r\n\r\n![image](https://user-images.githubusercontent.com/50770/76152760-6ed4c000-6078-11ea-9c4d-1507497c09a1.png)\r\n","reactions":{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/596140119/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ck37","id":50770,"node_id":"MDQ6VXNlcjUwNzcw","avatar_url":"https://avatars.githubusercontent.com/u/50770?v=4","gravatar_id":"","url":"https://api.github.com/users/ck37","html_url":"https://github.com/ck37","followers_url":"https://api.github.com/users/ck37/followers","following_url":"https://api.github.com/users/ck37/following{/other_user}","gists_url":"https://api.github.com/users/ck37/gists{/gist_id}","starred_url":"https://api.github.com/users/ck37/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ck37/subscriptions","organizations_url":"https://api.github.com/users/ck37/orgs","repos_url":"https://api.github.com/users/ck37/repos","events_url":"https://api.github.com/users/ck37/events{/privacy}","received_events_url":"https://api.github.com/users/ck37/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/615264309","html_url":"https://github.com/kpe/bert-for-tf2/issues/29#issuecomment-615264309","issue_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/29","id":615264309,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNTI2NDMwOQ==","user":{"login":"ptamas88","id":36891268,"node_id":"MDQ6VXNlcjM2ODkxMjY4","avatar_url":"https://avatars.githubusercontent.com/u/36891268?v=4","gravatar_id":"","url":"https://api.github.com/users/ptamas88","html_url":"https://github.com/ptamas88","followers_url":"https://api.github.com/users/ptamas88/followers","following_url":"https://api.github.com/users/ptamas88/following{/other_user}","gists_url":"https://api.github.com/users/ptamas88/gists{/gist_id}","starred_url":"https://api.github.com/users/ptamas88/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptamas88/subscriptions","organizations_url":"https://api.github.com/users/ptamas88/orgs","repos_url":"https://api.github.com/users/ptamas88/repos","events_url":"https://api.github.com/users/ptamas88/events{/privacy}","received_events_url":"https://api.github.com/users/ptamas88/received_events","type":"User","site_admin":false},"created_at":"2020-04-17T14:07:00Z","updated_at":"2020-04-17T14:07:00Z","author_association":"NONE","body":"you may set it with l_bert.trainable = False. but it's just a wild guess, I Don't know what apply_adapter_freeze() function does.","reactions":{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/615264309/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ptamas88","id":36891268,"node_id":"MDQ6VXNlcjM2ODkxMjY4","avatar_url":"https://avatars.githubusercontent.com/u/36891268?v=4","gravatar_id":"","url":"https://api.github.com/users/ptamas88","html_url":"https://github.com/ptamas88","followers_url":"https://api.github.com/users/ptamas88/followers","following_url":"https://api.github.com/users/ptamas88/following{/other_user}","gists_url":"https://api.github.com/users/ptamas88/gists{/gist_id}","starred_url":"https://api.github.com/users/ptamas88/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptamas88/subscriptions","organizations_url":"https://api.github.com/users/ptamas88/orgs","repos_url":"https://api.github.com/users/ptamas88/repos","events_url":"https://api.github.com/users/ptamas88/events{/privacy}","received_events_url":"https://api.github.com/users/ptamas88/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/615310314","html_url":"https://github.com/kpe/bert-for-tf2/issues/29#issuecomment-615310314","issue_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/29","id":615310314,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNTMxMDMxNA==","user":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false},"created_at":"2020-04-17T15:29:20Z","updated_at":"2020-04-17T15:36:48Z","author_association":"OWNER","body":"@ck37 - ``apply_adapter_freeze()`` is used together with the ``adapter_size`` parameter, i.e. it will freeze all but the adapter layers for training; in the case you use plan bert (i.e. without adapter layers), the method will not have an effect.\r\n\r\n\r\nTo freeze your layers, you might use the standard keras mechanisms:\r\n```\r\nl_bert.trainable = False\r\n```\r\n\r\njust like @ptamas88  have suggested!","reactions":{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments/615310314/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false}},{"id":3244897377,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI0NDg5NzM3Nw==","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/3244897377","actor":{"login":"ck37","id":50770,"node_id":"MDQ6VXNlcjUwNzcw","avatar_url":"https://avatars.githubusercontent.com/u/50770?v=4","gravatar_id":"","url":"https://api.github.com/users/ck37","html_url":"https://github.com/ck37","followers_url":"https://api.github.com/users/ck37/followers","following_url":"https://api.github.com/users/ck37/following{/other_user}","gists_url":"https://api.github.com/users/ck37/gists{/gist_id}","starred_url":"https://api.github.com/users/ck37/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ck37/subscriptions","organizations_url":"https://api.github.com/users/ck37/orgs","repos_url":"https://api.github.com/users/ck37/repos","events_url":"https://api.github.com/users/ck37/events{/privacy}","received_events_url":"https://api.github.com/users/ck37/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-17T15:29:20Z","performed_via_github_app":null},{"id":3244897381,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyNDQ4OTczODE=","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/3244897381","actor":{"login":"ck37","id":50770,"node_id":"MDQ6VXNlcjUwNzcw","avatar_url":"https://avatars.githubusercontent.com/u/50770?v=4","gravatar_id":"","url":"https://api.github.com/users/ck37","html_url":"https://github.com/ck37","followers_url":"https://api.github.com/users/ck37/followers","following_url":"https://api.github.com/users/ck37/following{/other_user}","gists_url":"https://api.github.com/users/ck37/gists{/gist_id}","starred_url":"https://api.github.com/users/ck37/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ck37/subscriptions","organizations_url":"https://api.github.com/users/ck37/orgs","repos_url":"https://api.github.com/users/ck37/repos","events_url":"https://api.github.com/users/ck37/events{/privacy}","received_events_url":"https://api.github.com/users/ck37/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-17T15:29:20Z","performed_via_github_app":null},{"id":3244897391,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI0NDg5NzM5MQ==","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/3244897391","actor":{"login":"ptamas88","id":36891268,"node_id":"MDQ6VXNlcjM2ODkxMjY4","avatar_url":"https://avatars.githubusercontent.com/u/36891268?v=4","gravatar_id":"","url":"https://api.github.com/users/ptamas88","html_url":"https://github.com/ptamas88","followers_url":"https://api.github.com/users/ptamas88/followers","following_url":"https://api.github.com/users/ptamas88/following{/other_user}","gists_url":"https://api.github.com/users/ptamas88/gists{/gist_id}","starred_url":"https://api.github.com/users/ptamas88/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptamas88/subscriptions","organizations_url":"https://api.github.com/users/ptamas88/orgs","repos_url":"https://api.github.com/users/ptamas88/repos","events_url":"https://api.github.com/users/ptamas88/events{/privacy}","received_events_url":"https://api.github.com/users/ptamas88/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-17T15:29:20Z","performed_via_github_app":null},{"id":3244897394,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyNDQ4OTczOTQ=","url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events/3244897394","actor":{"login":"ptamas88","id":36891268,"node_id":"MDQ6VXNlcjM2ODkxMjY4","avatar_url":"https://avatars.githubusercontent.com/u/36891268?v=4","gravatar_id":"","url":"https://api.github.com/users/ptamas88","html_url":"https://github.com/ptamas88","followers_url":"https://api.github.com/users/ptamas88/followers","following_url":"https://api.github.com/users/ptamas88/following{/other_user}","gists_url":"https://api.github.com/users/ptamas88/gists{/gist_id}","starred_url":"https://api.github.com/users/ptamas88/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptamas88/subscriptions","organizations_url":"https://api.github.com/users/ptamas88/orgs","repos_url":"https://api.github.com/users/ptamas88/repos","events_url":"https://api.github.com/users/ptamas88/events{/privacy}","received_events_url":"https://api.github.com/users/ptamas88/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-17T15:29:20Z","performed_via_github_app":null},{"actor":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false},"created_at":"2020-04-17T16:09:14Z","updated_at":"2020-04-17T16:09:14Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/58","repository_url":"https://api.github.com/repos/kpe/bert-for-tf2","labels_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/58/labels{/name}","comments_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/58/comments","events_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/58/events","html_url":"https://github.com/kpe/bert-for-tf2/issues/58","id":599209667,"node_id":"MDU6SXNzdWU1OTkyMDk2Njc=","number":58,"title":"Error using Bert with GlobalAveragePooling1D: IndexError: list index out of range using GlobalAveragePooling1D","user":{"login":"nectario","id":22030060,"node_id":"MDQ6VXNlcjIyMDMwMDYw","avatar_url":"https://avatars.githubusercontent.com/u/22030060?v=4","gravatar_id":"","url":"https://api.github.com/users/nectario","html_url":"https://github.com/nectario","followers_url":"https://api.github.com/users/nectario/followers","following_url":"https://api.github.com/users/nectario/following{/other_user}","gists_url":"https://api.github.com/users/nectario/gists{/gist_id}","starred_url":"https://api.github.com/users/nectario/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nectario/subscriptions","organizations_url":"https://api.github.com/users/nectario/orgs","repos_url":"https://api.github.com/users/nectario/repos","events_url":"https://api.github.com/users/nectario/events{/privacy}","received_events_url":"https://api.github.com/users/nectario/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":14,"created_at":"2020-04-14T00:12:51Z","updated_at":"2020-04-17T16:18:23Z","closed_at":"2020-04-14T10:24:28Z","author_association":"NONE","active_lock_reason":null,"repository":{"id":187989988,"node_id":"MDEwOlJlcG9zaXRvcnkxODc5ODk5ODg=","name":"bert-for-tf2","full_name":"kpe/bert-for-tf2","private":false,"owner":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false},"html_url":"https://github.com/kpe/bert-for-tf2","description":"A Keras TensorFlow 2.0 implementation of BERT, ALBERT and adapter-BERT.","fork":false,"url":"https://api.github.com/repos/kpe/bert-for-tf2","forks_url":"https://api.github.com/repos/kpe/bert-for-tf2/forks","keys_url":"https://api.github.com/repos/kpe/bert-for-tf2/keys{/key_id}","collaborators_url":"https://api.github.com/repos/kpe/bert-for-tf2/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/kpe/bert-for-tf2/teams","hooks_url":"https://api.github.com/repos/kpe/bert-for-tf2/hooks","issue_events_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/events{/number}","events_url":"https://api.github.com/repos/kpe/bert-for-tf2/events","assignees_url":"https://api.github.com/repos/kpe/bert-for-tf2/assignees{/user}","branches_url":"https://api.github.com/repos/kpe/bert-for-tf2/branches{/branch}","tags_url":"https://api.github.com/repos/kpe/bert-for-tf2/tags","blobs_url":"https://api.github.com/repos/kpe/bert-for-tf2/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/kpe/bert-for-tf2/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/kpe/bert-for-tf2/git/refs{/sha}","trees_url":"https://api.github.com/repos/kpe/bert-for-tf2/git/trees{/sha}","statuses_url":"https://api.github.com/repos/kpe/bert-for-tf2/statuses/{sha}","languages_url":"https://api.github.com/repos/kpe/bert-for-tf2/languages","stargazers_url":"https://api.github.com/repos/kpe/bert-for-tf2/stargazers","contributors_url":"https://api.github.com/repos/kpe/bert-for-tf2/contributors","subscribers_url":"https://api.github.com/repos/kpe/bert-for-tf2/subscribers","subscription_url":"https://api.github.com/repos/kpe/bert-for-tf2/subscription","commits_url":"https://api.github.com/repos/kpe/bert-for-tf2/commits{/sha}","git_commits_url":"https://api.github.com/repos/kpe/bert-for-tf2/git/commits{/sha}","comments_url":"https://api.github.com/repos/kpe/bert-for-tf2/comments{/number}","issue_comment_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/comments{/number}","contents_url":"https://api.github.com/repos/kpe/bert-for-tf2/contents/{+path}","compare_url":"https://api.github.com/repos/kpe/bert-for-tf2/compare/{base}...{head}","merges_url":"https://api.github.com/repos/kpe/bert-for-tf2/merges","archive_url":"https://api.github.com/repos/kpe/bert-for-tf2/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/kpe/bert-for-tf2/downloads","issues_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues{/number}","pulls_url":"https://api.github.com/repos/kpe/bert-for-tf2/pulls{/number}","milestones_url":"https://api.github.com/repos/kpe/bert-for-tf2/milestones{/number}","notifications_url":"https://api.github.com/repos/kpe/bert-for-tf2/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/kpe/bert-for-tf2/labels{/name}","releases_url":"https://api.github.com/repos/kpe/bert-for-tf2/releases{/id}","deployments_url":"https://api.github.com/repos/kpe/bert-for-tf2/deployments","created_at":"2019-05-22T07:51:33Z","updated_at":"2022-12-20T12:48:07Z","pushed_at":"2023-01-13T10:12:34Z","git_url":"git://github.com/kpe/bert-for-tf2.git","ssh_url":"git@github.com:kpe/bert-for-tf2.git","clone_url":"https://github.com/kpe/bert-for-tf2.git","svn_url":"https://github.com/kpe/bert-for-tf2","homepage":"https://github.com/kpe/bert-for-tf2","size":290,"stargazers_count":782,"watchers_count":782,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":189,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":30,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["bert","keras","tensorflow","transformer"],"visibility":"public","forks":189,"open_issues":30,"watchers":782,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"I am trying to use Bert to encode chunks of text. I get the 3D output from Bert, and trying to apply GlobalAveragePooling1D. I get list index out of range. Here's a snippet:\r\n\r\n`\r\ndef bert_model(self, max_seq_len, number_of_labels=130, adapter_size=64, bert_config_file=None, bert_ckpt_file=None, bert_model_name=None):\r\n\r\n        with tf.io.gfile.GFile(bert_config_file, \"r\") as reader:\r\n            bc = StockBertConfig.from_json_string(reader.read())\r\n            bert_params = map_stock_config_to_params(bc)\r\n            bert_params.adapter_size = adapter_size\r\n            bert = BertModelLayer.from_params(bert_params, name=\"bert\")\r\n\r\n        sentence_input = Input(shape=(max_seq_len,), dtype='float32', name=\"sentence_input_ids\")\r\n        subtitles_input = Input(shape=(self.max_shape[1], max_seq_len), dtype='int32', name=\"SubtitlesInput\")\r\n\r\n        bert_output = bert(sentence_input)\r\n        bert_output = GlobalAveragePooling1D()(bert_output)\r\n\r\n\r\n`\r\n\r\n\r\nTraceback (most recent call last):\r\n  File \"C:/Development/Projects/GenrePrediction/GenrePredictionModel.py\", line 765, in <module>\r\n    validation_labels=genre_prediction.validation_labels, epochs=1000, batch_size=1)\r\n  File \"C:/Development/Projects/GenrePrediction/GenrePredictionModel.py\", line 468, in fit_bert\r\n    self.sentence_model, self.model = self.bert_model(max_sentence_length, bert_ckpt_file=\"D:/Development/Projects/bert_models/\"+self.bert_model_name+\"/bert_model.ckpt\", bert_config_file=\"D:/Development/Projects/bert_models/\"+self.bert_model_name+\"/bert_config.json\", number_of_labels=len(self.genres))\r\n  File \"C:/Development/Projects/GenrePrediction/GenrePredictionModel.py\", line 336, in bert_model\r\n    subtitles_timedistributed = segment_time_distributed(subtitles_input)\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\tensorflow_core\\python\\keras\\engine\\base_layer.py\", line 773, in __call__\r\n    outputs = call_fn(cast_inputs, *args, **kwargs)\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\tensorflow_core\\python\\keras\\layers\\wrappers.py\", line 270, in call\r\n    output_shape = self.compute_output_shape(input_shape).as_list()\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\tensorflow_core\\python\\keras\\layers\\wrappers.py\", line 212, in compute_output_shape\r\n    child_output_shape = self.layer.compute_output_shape(child_input_shape)\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\tensorflow_core\\python\\keras\\engine\\network.py\", line 768, in compute_output_shape\r\n    layer_output_shapes = layer.compute_output_shape(layer_input_shapes)\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\tensorflow_core\\python\\keras\\layers\\pooling.py\", line 591, in compute_output_shape\r\n    return tensor_shape.TensorShape([input_shape[0], input_shape[2]])\r\nIndexError: list index out of range","reactions":{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/58/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/58/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"}]