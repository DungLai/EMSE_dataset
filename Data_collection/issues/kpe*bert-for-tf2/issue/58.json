{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/58","repository_url":"https://api.github.com/repos/kpe/bert-for-tf2","labels_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/58/labels{/name}","comments_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/58/comments","events_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/58/events","html_url":"https://github.com/kpe/bert-for-tf2/issues/58","id":599209667,"node_id":"MDU6SXNzdWU1OTkyMDk2Njc=","number":58,"title":"Error using Bert with GlobalAveragePooling1D: IndexError: list index out of range using GlobalAveragePooling1D","user":{"login":"nectario","id":22030060,"node_id":"MDQ6VXNlcjIyMDMwMDYw","avatar_url":"https://avatars.githubusercontent.com/u/22030060?v=4","gravatar_id":"","url":"https://api.github.com/users/nectario","html_url":"https://github.com/nectario","followers_url":"https://api.github.com/users/nectario/followers","following_url":"https://api.github.com/users/nectario/following{/other_user}","gists_url":"https://api.github.com/users/nectario/gists{/gist_id}","starred_url":"https://api.github.com/users/nectario/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nectario/subscriptions","organizations_url":"https://api.github.com/users/nectario/orgs","repos_url":"https://api.github.com/users/nectario/repos","events_url":"https://api.github.com/users/nectario/events{/privacy}","received_events_url":"https://api.github.com/users/nectario/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":14,"created_at":"2020-04-14T00:12:51Z","updated_at":"2020-04-17T16:18:23Z","closed_at":"2020-04-14T10:24:28Z","author_association":"NONE","active_lock_reason":null,"body":"I am trying to use Bert to encode chunks of text. I get the 3D output from Bert, and trying to apply GlobalAveragePooling1D. I get list index out of range. Here's a snippet:\r\n\r\n`\r\ndef bert_model(self, max_seq_len, number_of_labels=130, adapter_size=64, bert_config_file=None, bert_ckpt_file=None, bert_model_name=None):\r\n\r\n        with tf.io.gfile.GFile(bert_config_file, \"r\") as reader:\r\n            bc = StockBertConfig.from_json_string(reader.read())\r\n            bert_params = map_stock_config_to_params(bc)\r\n            bert_params.adapter_size = adapter_size\r\n            bert = BertModelLayer.from_params(bert_params, name=\"bert\")\r\n\r\n        sentence_input = Input(shape=(max_seq_len,), dtype='float32', name=\"sentence_input_ids\")\r\n        subtitles_input = Input(shape=(self.max_shape[1], max_seq_len), dtype='int32', name=\"SubtitlesInput\")\r\n\r\n        bert_output = bert(sentence_input)\r\n        bert_output = GlobalAveragePooling1D()(bert_output)\r\n\r\n\r\n`\r\n\r\n\r\nTraceback (most recent call last):\r\n  File \"C:/Development/Projects/GenrePrediction/GenrePredictionModel.py\", line 765, in <module>\r\n    validation_labels=genre_prediction.validation_labels, epochs=1000, batch_size=1)\r\n  File \"C:/Development/Projects/GenrePrediction/GenrePredictionModel.py\", line 468, in fit_bert\r\n    self.sentence_model, self.model = self.bert_model(max_sentence_length, bert_ckpt_file=\"D:/Development/Projects/bert_models/\"+self.bert_model_name+\"/bert_model.ckpt\", bert_config_file=\"D:/Development/Projects/bert_models/\"+self.bert_model_name+\"/bert_config.json\", number_of_labels=len(self.genres))\r\n  File \"C:/Development/Projects/GenrePrediction/GenrePredictionModel.py\", line 336, in bert_model\r\n    subtitles_timedistributed = segment_time_distributed(subtitles_input)\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\tensorflow_core\\python\\keras\\engine\\base_layer.py\", line 773, in __call__\r\n    outputs = call_fn(cast_inputs, *args, **kwargs)\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\tensorflow_core\\python\\keras\\layers\\wrappers.py\", line 270, in call\r\n    output_shape = self.compute_output_shape(input_shape).as_list()\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\tensorflow_core\\python\\keras\\layers\\wrappers.py\", line 212, in compute_output_shape\r\n    child_output_shape = self.layer.compute_output_shape(child_input_shape)\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\tensorflow_core\\python\\keras\\engine\\network.py\", line 768, in compute_output_shape\r\n    layer_output_shapes = layer.compute_output_shape(layer_input_shapes)\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\tensorflow_core\\python\\keras\\layers\\pooling.py\", line 591, in compute_output_shape\r\n    return tensor_shape.TensorShape([input_shape[0], input_shape[2]])\r\nIndexError: list index out of range","closed_by":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/58/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/58/timeline","performed_via_github_app":null,"state_reason":"completed"}