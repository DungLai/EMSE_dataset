{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/74","repository_url":"https://api.github.com/repos/kpe/bert-for-tf2","labels_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/74/labels{/name}","comments_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/74/comments","events_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/74/events","html_url":"https://github.com/kpe/bert-for-tf2/issues/74","id":702590830,"node_id":"MDU6SXNzdWU3MDI1OTA4MzA=","number":74,"title":"How to get the outputs of albert model","user":{"login":"iamweiweishi","id":23145532,"node_id":"MDQ6VXNlcjIzMTQ1NTMy","avatar_url":"https://avatars.githubusercontent.com/u/23145532?v=4","gravatar_id":"","url":"https://api.github.com/users/iamweiweishi","html_url":"https://github.com/iamweiweishi","followers_url":"https://api.github.com/users/iamweiweishi/followers","following_url":"https://api.github.com/users/iamweiweishi/following{/other_user}","gists_url":"https://api.github.com/users/iamweiweishi/gists{/gist_id}","starred_url":"https://api.github.com/users/iamweiweishi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iamweiweishi/subscriptions","organizations_url":"https://api.github.com/users/iamweiweishi/orgs","repos_url":"https://api.github.com/users/iamweiweishi/repos","events_url":"https://api.github.com/users/iamweiweishi/events{/privacy}","received_events_url":"https://api.github.com/users/iamweiweishi/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-09-16T09:05:28Z","updated_at":"2020-09-16T09:29:11Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Hi, I am tring to get the outputs of the albert model given an input,\r\n\r\n`\r\ndef load_pretrained_albert():\r\n\r\n\r\n    albert_dir = \"albert_base\"\r\n    model_params = bert.params_from_pretrained_ckpt(albert_dir)\r\n    l_bert = bert.BertModelLayer.from_params(model_params, name=\"albert\")\r\n\r\n    # use in Keras Model here, and call model.build()\r\n    max_seq_len = 128\r\n\r\n    l_input_ids = Input(shape=(max_seq_len,), dtype='float32', name=\"l_input_ids\")\r\n\r\n    output = l_bert(l_input_ids)\r\n    pooled_output = AveragePooling1D(pool_size=max_seq_len, data_format=\"channels_last\")(output)\r\n    pooled_output = Flatten()(pooled_output)   # poooled_output: [batch_size, embedding_dimension=768]\r\n\r\n    model = Model(inputs=[l_input_ids], outputs=[pooled_output])\r\n    model.build(input_shape=(None, max_seq_len))\r\n\r\n    l_bert.embeddings_layer.trainable = False\r\n\r\n    bert_ckpt_file = os.path.join(albert_dir, \"model.ckpt-best\")\r\n    bert.load_albert_weights(l_bert, bert_ckpt_file)\r\n\r\n    vocab_file = os.path.join(albert_dir, \"vocab_chinese.txt\")\r\n    tokenizer = bert.albert_tokenization.FullTokenizer(vocab_file=vocab_file)\r\n\r\n    return model, tokenizer\r\n\r\n\r\nalbert_model, tokenizer = load_pretrained_albert()\r\n\r\ntokens = tokenizer.tokenize(u\"你好世界\")\r\ntoken_ids = tokenizer.convert_tokens_to_ids(tokens)\r\nprint(token_ids)\r\n\r\nprint(albert_model(inputs=np.array([token_ids])))\r\n`\r\n\r\nBut, the final output is 'tf.Tensor([], shape=(768, 0), dtype=float32)'\r\nHow to fetch the output correctly?\r\nAnother question is, could I get the K, V values of the last layer? \r\nThank you.\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/74/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/74/timeline","performed_via_github_app":null,"state_reason":null}