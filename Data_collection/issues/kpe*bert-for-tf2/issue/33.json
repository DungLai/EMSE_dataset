{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/33","repository_url":"https://api.github.com/repos/kpe/bert-for-tf2","labels_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/33/labels{/name}","comments_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/33/comments","events_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/33/events","html_url":"https://github.com/kpe/bert-for-tf2/issues/33","id":544196839,"node_id":"MDU6SXNzdWU1NDQxOTY4Mzk=","number":33,"title":"bert-for-tf2 for Sentiment Analysis","user":{"login":"muhammadfahid51","id":57350797,"node_id":"MDQ6VXNlcjU3MzUwNzk3","avatar_url":"https://avatars.githubusercontent.com/u/57350797?v=4","gravatar_id":"","url":"https://api.github.com/users/muhammadfahid51","html_url":"https://github.com/muhammadfahid51","followers_url":"https://api.github.com/users/muhammadfahid51/followers","following_url":"https://api.github.com/users/muhammadfahid51/following{/other_user}","gists_url":"https://api.github.com/users/muhammadfahid51/gists{/gist_id}","starred_url":"https://api.github.com/users/muhammadfahid51/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muhammadfahid51/subscriptions","organizations_url":"https://api.github.com/users/muhammadfahid51/orgs","repos_url":"https://api.github.com/users/muhammadfahid51/repos","events_url":"https://api.github.com/users/muhammadfahid51/events{/privacy}","received_events_url":"https://api.github.com/users/muhammadfahid51/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-12-31T14:05:51Z","updated_at":"2020-01-06T10:30:16Z","closed_at":"2020-01-06T10:30:16Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\r\nCan anyone provide me with a guide on how to use bert-for-tf2 for a custom task like sentiment analysis. \r\nI have been trying but to no avail. My model is training but its not giving me any accuracy. \r\n\r\nBelow is the method I am using\r\n\r\n```\r\nmodel_name = \"multi_cased_L-12_H-768_A-12\"\r\nmodel_dir = \"models/multi_cased_L-12_H-768_A-12\"\r\nmodel_ckpt = os.path.join(model_dir, \"bert_model.ckpt\")\r\nbert_params = bert.params_from_pretrained_ckpt(model_dir)\r\nl_bert = bert.BertModelLayer.from_params(bert_params, name=\"bert\", trainable=True)\r\n\r\nl_input_ids      = tf.keras.layers.Input(shape=(max_seq_len,), dtype='int32')\r\nl_token_type_ids = tf.keras.layers.Input(shape=(max_seq_len,), dtype='int32')\r\n\r\nl_bert_o = l_bert(l_input_ids)\r\nconv_blocks = []\r\nfor k_size in FILTER_SIZES:\r\n    conv = tf.keras.layers.Conv1D(filters=NUM_FILTERS,\r\n                         kernel_size=k_size,\r\n                         padding=\"valid\",\r\n                         activation=\"relu\",\r\n                         strides=1)(l_bert_o)\r\n    conv = tf.keras.layers.MaxPooling1D(pool_size=max_seq_len - k_size + 1)(conv)\r\n    conv = tf.keras.layers.Flatten()(conv)\r\n    conv_blocks.append(conv)\r\nconcat = tf.keras.layers.Concatenate()(conv_blocks) if len(conv_blocks) > 1 else conv_blocks[0]\r\nconcat = tf.keras.layers.Dropout(0.2)(concat)\r\nx = tf.keras.layers.Dense(256, activation=\"relu\")(concat)\r\noutput = tf.keras.layers.Dense(3, activation=\"softmax\")(x)\r\nmodel = tf.keras.models.Model(inputs=l_input_ids, outputs=output)\r\n\r\nmodel.compile(loss=\"categorical_crossentropy\", optimizer=\"rmsprop\",\r\n              metrics=[\"accuracy\"])\r\n\r\nbert.load_bert_weights(l_bert, model_ckpt)\r\nmodel.summary()\r\n\r\n```\r\n","closed_by":{"login":"kpe","id":2535923,"node_id":"MDQ6VXNlcjI1MzU5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/2535923?v=4","gravatar_id":"","url":"https://api.github.com/users/kpe","html_url":"https://github.com/kpe","followers_url":"https://api.github.com/users/kpe/followers","following_url":"https://api.github.com/users/kpe/following{/other_user}","gists_url":"https://api.github.com/users/kpe/gists{/gist_id}","starred_url":"https://api.github.com/users/kpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpe/subscriptions","organizations_url":"https://api.github.com/users/kpe/orgs","repos_url":"https://api.github.com/users/kpe/repos","events_url":"https://api.github.com/users/kpe/events{/privacy}","received_events_url":"https://api.github.com/users/kpe/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/33/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/kpe/bert-for-tf2/issues/33/timeline","performed_via_github_app":null,"state_reason":"completed"}