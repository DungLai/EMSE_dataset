[{"url":"https://api.github.com/repos/xingyul/flownet3d/issues/comments/531793057","html_url":"https://github.com/xingyul/flownet3d/issues/21#issuecomment-531793057","issue_url":"https://api.github.com/repos/xingyul/flownet3d/issues/21","id":531793057,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMTc5MzA1Nw==","user":{"login":"anjingde","id":30194061,"node_id":"MDQ6VXNlcjMwMTk0MDYx","avatar_url":"https://avatars.githubusercontent.com/u/30194061?v=4","gravatar_id":"","url":"https://api.github.com/users/anjingde","html_url":"https://github.com/anjingde","followers_url":"https://api.github.com/users/anjingde/followers","following_url":"https://api.github.com/users/anjingde/following{/other_user}","gists_url":"https://api.github.com/users/anjingde/gists{/gist_id}","starred_url":"https://api.github.com/users/anjingde/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anjingde/subscriptions","organizations_url":"https://api.github.com/users/anjingde/orgs","repos_url":"https://api.github.com/users/anjingde/repos","events_url":"https://api.github.com/users/anjingde/events{/privacy}","received_events_url":"https://api.github.com/users/anjingde/received_events","type":"User","site_admin":false},"created_at":"2019-09-16T14:07:06Z","updated_at":"2019-09-16T14:07:06Z","author_association":"NONE","body":"disp_noc or disp_occ  ?  ","reactions":{"url":"https://api.github.com/repos/xingyul/flownet3d/issues/comments/531793057/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"anjingde","id":30194061,"node_id":"MDQ6VXNlcjMwMTk0MDYx","avatar_url":"https://avatars.githubusercontent.com/u/30194061?v=4","gravatar_id":"","url":"https://api.github.com/users/anjingde","html_url":"https://github.com/anjingde","followers_url":"https://api.github.com/users/anjingde/followers","following_url":"https://api.github.com/users/anjingde/following{/other_user}","gists_url":"https://api.github.com/users/anjingde/gists{/gist_id}","starred_url":"https://api.github.com/users/anjingde/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anjingde/subscriptions","organizations_url":"https://api.github.com/users/anjingde/orgs","repos_url":"https://api.github.com/users/anjingde/repos","events_url":"https://api.github.com/users/anjingde/events{/privacy}","received_events_url":"https://api.github.com/users/anjingde/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/xingyul/flownet3d/issues/comments/531835710","html_url":"https://github.com/xingyul/flownet3d/issues/21#issuecomment-531835710","issue_url":"https://api.github.com/repos/xingyul/flownet3d/issues/21","id":531835710,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMTgzNTcxMA==","user":{"login":"anjingde","id":30194061,"node_id":"MDQ6VXNlcjMwMTk0MDYx","avatar_url":"https://avatars.githubusercontent.com/u/30194061?v=4","gravatar_id":"","url":"https://api.github.com/users/anjingde","html_url":"https://github.com/anjingde","followers_url":"https://api.github.com/users/anjingde/followers","following_url":"https://api.github.com/users/anjingde/following{/other_user}","gists_url":"https://api.github.com/users/anjingde/gists{/gist_id}","starred_url":"https://api.github.com/users/anjingde/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anjingde/subscriptions","organizations_url":"https://api.github.com/users/anjingde/orgs","repos_url":"https://api.github.com/users/anjingde/repos","events_url":"https://api.github.com/users/anjingde/events{/privacy}","received_events_url":"https://api.github.com/users/anjingde/received_events","type":"User","site_admin":false},"created_at":"2019-09-16T15:44:04Z","updated_at":"2019-09-16T15:44:04Z","author_association":"NONE","body":"I have got the ground truth of kitti by my code. but it is different from yours. .the ground truth generated by optical flow is different from the frame2 and the ground truth you submit.I need your help,  \r\nthe parameters: focal length=(721 or 718)cx and cy  is from calib. ","reactions":{"url":"https://api.github.com/repos/xingyul/flownet3d/issues/comments/531835710/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"anjingde","id":30194061,"node_id":"MDQ6VXNlcjMwMTk0MDYx","avatar_url":"https://avatars.githubusercontent.com/u/30194061?v=4","gravatar_id":"","url":"https://api.github.com/users/anjingde","html_url":"https://github.com/anjingde","followers_url":"https://api.github.com/users/anjingde/followers","following_url":"https://api.github.com/users/anjingde/following{/other_user}","gists_url":"https://api.github.com/users/anjingde/gists{/gist_id}","starred_url":"https://api.github.com/users/anjingde/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anjingde/subscriptions","organizations_url":"https://api.github.com/users/anjingde/orgs","repos_url":"https://api.github.com/users/anjingde/repos","events_url":"https://api.github.com/users/anjingde/events{/privacy}","received_events_url":"https://api.github.com/users/anjingde/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/xingyul/flownet3d/issues/comments/554166053","html_url":"https://github.com/xingyul/flownet3d/issues/21#issuecomment-554166053","issue_url":"https://api.github.com/repos/xingyul/flownet3d/issues/21","id":554166053,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NDE2NjA1Mw==","user":{"login":"KevinYuk","id":20220399,"node_id":"MDQ6VXNlcjIwMjIwMzk5","avatar_url":"https://avatars.githubusercontent.com/u/20220399?v=4","gravatar_id":"","url":"https://api.github.com/users/KevinYuk","html_url":"https://github.com/KevinYuk","followers_url":"https://api.github.com/users/KevinYuk/followers","following_url":"https://api.github.com/users/KevinYuk/following{/other_user}","gists_url":"https://api.github.com/users/KevinYuk/gists{/gist_id}","starred_url":"https://api.github.com/users/KevinYuk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KevinYuk/subscriptions","organizations_url":"https://api.github.com/users/KevinYuk/orgs","repos_url":"https://api.github.com/users/KevinYuk/repos","events_url":"https://api.github.com/users/KevinYuk/events{/privacy}","received_events_url":"https://api.github.com/users/KevinYuk/received_events","type":"User","site_admin":false},"created_at":"2019-11-15T01:22:39Z","updated_at":"2019-11-15T01:22:39Z","author_association":"NONE","body":"Hi @anjingde ,\r\n\r\nI have done this.\r\n\r\nOrigin kitti dataset looks like below:\r\n```\r\ngt\r\n[[-6.50606757e-01 -7.71165091e-03 -3.62864930e-02]\r\n [-6.50809720e-01 -7.30375763e-03 -3.70871616e-02]\r\n [-6.50674281e-01 -7.18719799e-03 -3.67654337e-02]\r\n ...\r\n [-6.55581403e-01  8.44116230e-04 -3.59173445e-02]\r\n [-6.55385991e-01  5.79053468e-04 -3.66829281e-02]\r\n [-6.55479329e-01  7.85820204e-04 -3.61007760e-02]]\r\npos2\r\n[[ 4.180698 -3.539728  0.444983]\r\n [ 4.307996 -3.632413  0.450001]\r\n [ 4.286587 -3.650779  0.447844]\r\n ...\r\n [ 4.354905 -3.593129 -1.096776]\r\n [ 4.336965 -3.593943 -1.093356]\r\n [ 4.329097 -3.59527  -1.091642]]\r\npos1\r\n[[ 4.83130534 -3.532016    0.48126939]\r\n [ 4.95880602 -3.62510927  0.48708832]\r\n [ 4.93726086 -3.64359158  0.48460908]\r\n ...\r\n [ 5.03660353 -3.57625679 -1.10740632]\r\n [ 5.00526341 -3.59551057 -1.10095203]\r\n [ 4.956746   -3.60848824 -1.09762046]]\r\n```\r\n\r\nHowever, we could convert it to something like below :\r\n```\r\npoints1\r\nlen:  8192\r\nshape:  (8192, 3)\r\n[[ 32.89994602 -21.54203147   0.56550137]\r\n [ 14.09534998  -4.2294481    0.35370887]\r\n [ 24.83187046   8.32069612  -0.17390744]\r\n ...\r\n [ 23.21345089  13.56470163   0.92837002]\r\n [ 14.26954007  -3.94390863   0.24294891]\r\n [ 14.2666964   -5.4370993   -0.36596146]]\r\ncolor2\r\nlen:  8192\r\nshape:  (8192, 3)\r\n[[0. 0. 0.]\r\n [0. 0. 0.]\r\n [0. 0. 0.]\r\n ...\r\n [0. 0. 0.]\r\n [0. 0. 0.]\r\n [0. 0. 0.]]\r\nflow\r\nlen:  8192\r\nshape:  (8192, 3)\r\n[[ 0.10617779  0.88679647 -0.03811332]\r\n [-0.44350357  0.79123925 -0.03079318]\r\n [-0.68674987  0.66008707 -0.03754272]\r\n ...\r\n [-0.8204942   0.61661119 -0.0367588 ]\r\n [-0.44902221  0.79157176 -0.03023025]\r\n [-0.41408755  0.79796613 -0.02728917]]\r\npoints2\r\nlen:  8192\r\nshape:  (8192, 3)\r\n[[ 14.03455843  -4.34205603   0.5828345 ]\r\n [ 13.89293276  -4.25363464   0.41936948]\r\n [ 22.52683529  14.04049128  -0.40132041]\r\n ...\r\n [ 31.62114953 -15.78595999   0.24209763]\r\n [  8.56035903  -6.42638545  -0.70365567]\r\n [ 26.94402805  -0.68263973   0.03776928]]\r\ncolor1\r\nlen:  8192\r\nshape:  (8192, 3)\r\n[[0. 0. 0.]\r\n [0. 0. 0.]\r\n [0. 0. 0.]\r\n ...\r\n [0. 0. 0.]\r\n [0. 0. 0.]\r\n [0. 0. 0.]]\r\nvalid_mask1\r\nlen:  8192\r\nshape:  (8192,)\r\n[ True  True  True ...  True  True  True]\r\n```\r\n\r\nTrans code:\r\n```\r\n'''\r\n    Provider for duck dataset from xingyu liu\r\n'''\r\n\r\nimport os\r\nimport os.path\r\nimport json\r\nimport numpy as np\r\nimport sys\r\nimport pickle\r\nimport glob\r\n\r\n\r\nclass SceneflowDataset():\r\n    def __init__(self, root='./', npoints=2048, train=True):\r\n        self.npoints = npoints\r\n        self.train = train\r\n        self.root = root\r\n        self.datapath = glob.glob(os.path.join(self.root, '*.npz'))\r\n        self.cache = {}\r\n        self.cache_size = 30000\r\n\r\n        ###### deal with one bad datapoint with nan value\r\n        #self.datapath = [d for d in self.datapath if 'TRAIN_C_0140_left_0006-0' not in d]\r\n        ######\r\n\r\n    def __getitem__(self, index):\r\n        if index in self.cache:\r\n            #pos1, pos2, color1, color2, flow, mask1 = self.cache[index]\r\n            pos1, pos2, gt = self.cache[index]\r\n        else:\r\n            fn = self.datapath[index]\r\n            with open(fn, 'rb') as fp:\r\n                data = np.load(fp)\r\n                pos1 = data['pos1']\r\n                pos2 = data['pos2']\r\n                color1 = np.zeros(pos1.shape)\r\n                color2 = np.zeros(pos2.shape)\r\n                flow = data['gt']\r\n                mask1 = np.ones(len(pos1), dtype = bool)\r\n\r\n            if len(self.cache) < self.cache_size:\r\n                self.cache[index] = (pos1, pos2, color1, color2, flow, mask1)\r\n\r\n            if self.train:\r\n                n1 = pos1.shape[0]\r\n                sample_idx1 = np.random.choice(n1, self.npoints, replace=False)\r\n                n2 = pos2.shape[0]\r\n                sample_idx2 = np.random.choice(n2, self.npoints, replace=False)\r\n\r\n                pos1 = pos1[sample_idx1, :]\r\n                pos2 = pos2[sample_idx2, :]\r\n                color1 = color1[sample_idx1, :]\r\n                color2 = color2[sample_idx2, :]\r\n                flow = flow[sample_idx1, :]\r\n                mask1 = mask1[sample_idx1]\r\n            else:\r\n                pos1 = pos1[:self.npoints, :]\r\n                pos2 = pos2[:self.npoints, :]\r\n                color1 = color1[:self.npoints, :]\r\n                color2 = color2[:self.npoints, :]\r\n                flow = flow[:self.npoints, :]\r\n                mask1 = mask1[:self.npoints]\r\n\r\n        return pos1, pos2, color1, color2, flow, mask1\r\n\r\n    def __len__(self):\r\n        return len(self.datapath)\r\n\r\n\r\nif __name__ == '__main__':\r\n    d = SceneflowDataset(npoints=2048*4)\r\n    print('len of SceneflowDataset: ', len(d))\r\n    import time\r\n    tic = time.time()\r\n    for i in range(len(d)):\r\n        print('i: ', i)\r\n        pc1, pc2, c1, c2, flow, m1 = d[i]\r\n\r\n        npz_file = 'trans/trans_' + str(i) + '.npz'\r\n        np.savez(npz_file, points1 = pc1, points2 = pc2, color1 = c1, color2 = c2, flow = flow, valid_mask1 = m1)\r\n        print(npz_file + ' DONE!')\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/xingyul/flownet3d/issues/comments/554166053/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"KevinYuk","id":20220399,"node_id":"MDQ6VXNlcjIwMjIwMzk5","avatar_url":"https://avatars.githubusercontent.com/u/20220399?v=4","gravatar_id":"","url":"https://api.github.com/users/KevinYuk","html_url":"https://github.com/KevinYuk","followers_url":"https://api.github.com/users/KevinYuk/followers","following_url":"https://api.github.com/users/KevinYuk/following{/other_user}","gists_url":"https://api.github.com/users/KevinYuk/gists{/gist_id}","starred_url":"https://api.github.com/users/KevinYuk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KevinYuk/subscriptions","organizations_url":"https://api.github.com/users/KevinYuk/orgs","repos_url":"https://api.github.com/users/KevinYuk/repos","events_url":"https://api.github.com/users/KevinYuk/events{/privacy}","received_events_url":"https://api.github.com/users/KevinYuk/received_events","type":"User","site_admin":false}},{"id":2801137860,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjgwMTEzNzg2MA==","url":"https://api.github.com/repos/xingyul/flownet3d/issues/events/2801137860","actor":{"login":"anjingde","id":30194061,"node_id":"MDQ6VXNlcjMwMTk0MDYx","avatar_url":"https://avatars.githubusercontent.com/u/30194061?v=4","gravatar_id":"","url":"https://api.github.com/users/anjingde","html_url":"https://github.com/anjingde","followers_url":"https://api.github.com/users/anjingde/followers","following_url":"https://api.github.com/users/anjingde/following{/other_user}","gists_url":"https://api.github.com/users/anjingde/gists{/gist_id}","starred_url":"https://api.github.com/users/anjingde/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anjingde/subscriptions","organizations_url":"https://api.github.com/users/anjingde/orgs","repos_url":"https://api.github.com/users/anjingde/repos","events_url":"https://api.github.com/users/anjingde/events{/privacy}","received_events_url":"https://api.github.com/users/anjingde/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-11-15T01:22:39Z","performed_via_github_app":null},{"id":2801137862,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI4MDExMzc4NjI=","url":"https://api.github.com/repos/xingyul/flownet3d/issues/events/2801137862","actor":{"login":"anjingde","id":30194061,"node_id":"MDQ6VXNlcjMwMTk0MDYx","avatar_url":"https://avatars.githubusercontent.com/u/30194061?v=4","gravatar_id":"","url":"https://api.github.com/users/anjingde","html_url":"https://github.com/anjingde","followers_url":"https://api.github.com/users/anjingde/followers","following_url":"https://api.github.com/users/anjingde/following{/other_user}","gists_url":"https://api.github.com/users/anjingde/gists{/gist_id}","starred_url":"https://api.github.com/users/anjingde/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anjingde/subscriptions","organizations_url":"https://api.github.com/users/anjingde/orgs","repos_url":"https://api.github.com/users/anjingde/repos","events_url":"https://api.github.com/users/anjingde/events{/privacy}","received_events_url":"https://api.github.com/users/anjingde/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-11-15T01:22:39Z","performed_via_github_app":null}]