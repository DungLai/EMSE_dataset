{"url":"https://api.github.com/repos/molecularsets/moses/issues/91","repository_url":"https://api.github.com/repos/molecularsets/moses","labels_url":"https://api.github.com/repos/molecularsets/moses/issues/91/labels{/name}","comments_url":"https://api.github.com/repos/molecularsets/moses/issues/91/comments","events_url":"https://api.github.com/repos/molecularsets/moses/issues/91/events","html_url":"https://github.com/molecularsets/moses/issues/91","id":774887650,"node_id":"MDU6SXNzdWU3NzQ4ODc2NTA=","number":91,"title":"Training ORGAN on cuda error","user":{"login":"Binbose","id":25252778,"node_id":"MDQ6VXNlcjI1MjUyNzc4","avatar_url":"https://avatars.githubusercontent.com/u/25252778?v=4","gravatar_id":"","url":"https://api.github.com/users/Binbose","html_url":"https://github.com/Binbose","followers_url":"https://api.github.com/users/Binbose/followers","following_url":"https://api.github.com/users/Binbose/following{/other_user}","gists_url":"https://api.github.com/users/Binbose/gists{/gist_id}","starred_url":"https://api.github.com/users/Binbose/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Binbose/subscriptions","organizations_url":"https://api.github.com/users/Binbose/orgs","repos_url":"https://api.github.com/users/Binbose/repos","events_url":"https://api.github.com/users/Binbose/events{/privacy}","received_events_url":"https://api.github.com/users/Binbose/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-12-26T14:52:11Z","updated_at":"2020-12-26T14:52:44Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Hey,\r\n\r\nwhen I train ORGAN via \r\n`python scripts/run.py --model organ --train_path ./my_organ/data/hce_smiles.smi --checkpoint_dir ./my_orgapt --device cuda:0 --metrics ./my_organ/metrics`\r\nit throws the error \r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"scripts/run.py\", line 219, in <module>\r\n    main(config)\r\n  File \"scripts/run.py\", line 199, in main\r\n    train_model(config, model, train_path, test_path)\r\n  File \"scripts/run.py\", line 127, in train_model\r\n    trainer_script.main(model, trainer_config)\r\n  File \"/home/luca/Projects/benchmark_level_up/local/moses/scripts/train.py\", line 62, in main\r\n    trainer.fit(model, train_data, val_data)\r\n  File \"/home/luca/anaconda3/envs/moses/lib/python3.6/site-packages/molsets-1.0-py3.6.egg/moses/organ/trainer.py\", line 370, in fit\r\n    gen_val_loader, logger)\r\n  File \"/home/luca/anaconda3/envs/moses/lib/python3.6/site-packages/molsets-1.0-py3.6.egg/moses/organ/trainer.py\", line 104, in _pretrain_generator\r\n    criterion, optimizer)\r\n  File \"/home/luca/anaconda3/envs/moses/lib/python3.6/site-packages/molsets-1.0-py3.6.egg/moses/organ/trainer.py\", line 70, in _pretrain_generator_epoch\r\n    outputs, _, _ = model.generator_forward(prevs, lens)\r\n  File \"/home/luca/anaconda3/envs/moses/lib/python3.6/site-packages/molsets-1.0-py3.6.egg/moses/organ/model.py\", line 94, in generator_forward\r\n    return self.generator(*args, **kwargs)\r\n  File \"/home/luca/anaconda3/envs/moses/lib/python3.6/site-packages/torch-1.7.1-py3.6-linux-x86_64.egg/torch/nn/modules/module.py\", line 727, in _call_impl\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/home/luca/anaconda3/envs/moses/lib/python3.6/site-packages/molsets-1.0-py3.6.egg/moses/organ/model.py\", line 23, in forward\r\n    x = pack_padded_sequence(x, lengths, batch_first=True)\r\n  File \"/home/luca/anaconda3/envs/moses/lib/python3.6/site-packages/torch-1.7.1-py3.6-linux-x86_64.egg/torch/nn/utils/rnn.py\", line 244, in pack_padded_sequence\r\n    _VF._pack_padded_sequence(input, lengths, batch_first)\r\nRuntimeError: 'lengths' argument should be a 1D CPU int64 tensor, but got 1D cuda:0 Long tensor\r\n```\r\n\r\nSeems like changing line 23 in moses/organ/model.py from\r\n`x = pack_padded_sequence(x, lengths.cpu(), batch_first=True)`\r\nto \r\n`x = pack_padded_sequence(x, lengths.cpu(), batch_first=True)`\r\nfixes the problem though","closed_by":null,"reactions":{"url":"https://api.github.com/repos/molecularsets/moses/issues/91/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/molecularsets/moses/issues/91/timeline","performed_via_github_app":null,"state_reason":null}