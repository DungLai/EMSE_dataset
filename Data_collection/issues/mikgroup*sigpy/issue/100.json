{"url":"https://api.github.com/repos/mikgroup/sigpy/issues/100","repository_url":"https://api.github.com/repos/mikgroup/sigpy","labels_url":"https://api.github.com/repos/mikgroup/sigpy/issues/100/labels{/name}","comments_url":"https://api.github.com/repos/mikgroup/sigpy/issues/100/comments","events_url":"https://api.github.com/repos/mikgroup/sigpy/issues/100/events","html_url":"https://github.com/mikgroup/sigpy/issues/100","id":1046778439,"node_id":"I_kwDOCFKrHc4-ZJJH","number":100,"title":"Cupy cudnn and nccl failed imports should be a warning, not exception","user":{"login":"ad12","id":12801331,"node_id":"MDQ6VXNlcjEyODAxMzMx","avatar_url":"https://avatars.githubusercontent.com/u/12801331?v=4","gravatar_id":"","url":"https://api.github.com/users/ad12","html_url":"https://github.com/ad12","followers_url":"https://api.github.com/users/ad12/followers","following_url":"https://api.github.com/users/ad12/following{/other_user}","gists_url":"https://api.github.com/users/ad12/gists{/gist_id}","starred_url":"https://api.github.com/users/ad12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ad12/subscriptions","organizations_url":"https://api.github.com/users/ad12/orgs","repos_url":"https://api.github.com/users/ad12/repos","events_url":"https://api.github.com/users/ad12/events{/privacy}","received_events_url":"https://api.github.com/users/ad12/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-11-07T15:39:20Z","updated_at":"2021-11-17T23:35:42Z","closed_at":"2021-11-17T23:35:42Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Similar to #77 - Newer versions of cupy don't fail on `import cupy` but rather when cudnn and nccl libraries are fetched.\r\n\r\nBecause cupy is an optional dependency, and there are use cases where users share virtualenv's on a cluster, but each machine on the cluster has different hardware, it may make sense to make failed package importing a warning.\r\n\r\n## Solution\r\nAdd try/except to protect the import of cudnn and nccl components\r\nhttps://github.com/mikgroup/sigpy/blob/dde242de4d3fe71195e0c0a17cf647b66c316443/sigpy/config.py#L22-L23\r\n\r\n```python\r\n# in sigpy.config\r\nfrom importlib import util\r\nimport warnings\r\n\r\ncupy_enabled = util.find_spec(\"cupy\") is not None\r\nif cupy_enabled:\r\n    try:\r\n        import cupy\r\n    except ImportError as e:\r\n        warnings.warn(e)\r\n        cupy_enabled=False\r\nif cupy_enabled:  # pragma: no cover\r\n    try:\r\n        cudnn_enabled = util.find_spec(\"cupy.cuda.cudnn\") is not None\r\n    except ImportError as e:\r\n        warnings.warn(e)\r\n        cudnn_enabled = False\r\n    try:\r\n        nccl_enabled = util.find_spec(\"cupy.cuda.nccl\") is not None\r\n    except ImportError as e:\r\n        warnings.warn(e)\r\n        nccl_enabled = False\r\nelse:\r\n    cudnn_enabled = False\r\n    nccl_enabled = False","closed_by":{"login":"sidward","id":7364812,"node_id":"MDQ6VXNlcjczNjQ4MTI=","avatar_url":"https://avatars.githubusercontent.com/u/7364812?v=4","gravatar_id":"","url":"https://api.github.com/users/sidward","html_url":"https://github.com/sidward","followers_url":"https://api.github.com/users/sidward/followers","following_url":"https://api.github.com/users/sidward/following{/other_user}","gists_url":"https://api.github.com/users/sidward/gists{/gist_id}","starred_url":"https://api.github.com/users/sidward/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidward/subscriptions","organizations_url":"https://api.github.com/users/sidward/orgs","repos_url":"https://api.github.com/users/sidward/repos","events_url":"https://api.github.com/users/sidward/events{/privacy}","received_events_url":"https://api.github.com/users/sidward/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mikgroup/sigpy/issues/100/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mikgroup/sigpy/issues/100/timeline","performed_via_github_app":null,"state_reason":"completed"}