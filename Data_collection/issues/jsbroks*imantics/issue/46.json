{"url":"https://api.github.com/repos/jsbroks/imantics/issues/46","repository_url":"https://api.github.com/repos/jsbroks/imantics","labels_url":"https://api.github.com/repos/jsbroks/imantics/issues/46/labels{/name}","comments_url":"https://api.github.com/repos/jsbroks/imantics/issues/46/comments","events_url":"https://api.github.com/repos/jsbroks/imantics/issues/46/events","html_url":"https://github.com/jsbroks/imantics/issues/46","id":936438321,"node_id":"MDU6SXNzdWU5MzY0MzgzMjE=","number":46,"title":"dataset.add() method do not work as expect ","user":{"login":"WangHuancheng","id":9625870,"node_id":"MDQ6VXNlcjk2MjU4NzA=","avatar_url":"https://avatars.githubusercontent.com/u/9625870?v=4","gravatar_id":"","url":"https://api.github.com/users/WangHuancheng","html_url":"https://github.com/WangHuancheng","followers_url":"https://api.github.com/users/WangHuancheng/followers","following_url":"https://api.github.com/users/WangHuancheng/following{/other_user}","gists_url":"https://api.github.com/users/WangHuancheng/gists{/gist_id}","starred_url":"https://api.github.com/users/WangHuancheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WangHuancheng/subscriptions","organizations_url":"https://api.github.com/users/WangHuancheng/orgs","repos_url":"https://api.github.com/users/WangHuancheng/repos","events_url":"https://api.github.com/users/WangHuancheng/events{/privacy}","received_events_url":"https://api.github.com/users/WangHuancheng/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-07-04T11:41:09Z","updated_at":"2021-07-04T11:41:09Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Hi, it's really great to find the project, I have being searching this for several days and almost give up. I sincerely thank you developing this awesome tool, but i meet with a problem using it to build my dataset.\r\n\r\nbelow is my code, basically i loop twice and for each time I read a image and mask, then create annoation, then use `Dataset.add` method adding them to the dataset\r\n```\r\ndata = imantics.Dataset(name='allen_342')`\r\nfor i in tqdm(range(2)):`\r\n    image = imantics.Image.from_path('/mydir/image_{}.png'.format(i))\r\n    mask_array =cv2.imread(/mydir/mask_{}.png'.format(i),cv2.IMREAD_GRAYSCALE)\r\n    mask=imantics.Mask(mask_array)\r\n    ann=(imantics.Annotation.from_mask(mask,image,imantics.Category('cell')))\r\n    data.add(image)\r\n    data.add(ann)\r\n    out = data.coco()\r\n```\r\n\r\nthe problem is , i got very strange output which is \r\nfor `i==0`\r\n```\r\n{'annotations': [{'area': 2915,\r\n                  'bbox': (201, 33, 271, 444),\r\n                  'category_id': 0,\r\n                  'color': '#214596',\r\n                  'height': 512,\r\n                  'id': 1,\r\n                  'image_id': 0,\r\n                  'isbbox': False,\r\n                  'iscrowd': 0,\r\n                  'metadata': {},\r\n                  'width': 512}],\r\n 'categories': [{'color': '#c81940',\r\n                 'id': 0,\r\n                 'metadata': {},\r\n                 'name': 'cell',\r\n                 'supercategory': None}],\r\n 'images': [{'coco_url': None,\r\n             'date_captured': None,\r\n             'fickr_url': None,\r\n             'file_name': 'image_951980471.png',\r\n             'height': 512,\r\n             'id': 0,\r\n             'license': None,\r\n             'metadata': {},\r\n             'path': '/home/seeker/Swin-Transformer-Object-Detection/image/image_951980471.png',\r\n             'width': 512}],\r\n 'info': {}}\r\n```\r\nfor `i==1`\r\n```\r\n{'annotations': [{'area': 2915,\r\n                  'bbox': (201, 33, 271, 444),\r\n                  'category_id': 0,\r\n                  'color': '#214596',\r\n                  'height': 512,\r\n                  'id': 1,\r\n                  'image_id': 0,\r\n                  'isbbox': False,\r\n                  'iscrowd': 0,\r\n                  'metadata': {},\r\n                  'width': 512},\r\n                 {'area': 1583,\r\n                  'bbox': (95, 52, 324, 446),\r\n                  'category_id': 0,\r\n                  'color': '#3d1ea0',\r\n                  'height': 512,\r\n                  'id': 2,\r\n                  'image_id': 0,\r\n                  'isbbox': False,\r\n                  'iscrowd': 0,\r\n                  'metadata': {},\r\n                  'width': 512}],\r\n 'categories': [{'color': '#c81940',\r\n                 'id': 0,\r\n                 'metadata': {},\r\n                 'name': 'cell',\r\n                 'supercategory': None}],\r\n 'images': [{'coco_url': None,\r\n             'date_captured': None,\r\n             'fickr_url': None,\r\n             'file_name': 'image_951980484.png',\r\n             'height': 512,\r\n             'id': 0,\r\n             'license': None,\r\n             'metadata': {},\r\n             'path': '/home/seeker/Swin-Transformer-Object-Detection/image/image_951980484.png',\r\n             'width': 512}],\r\n 'info': {}}\r\n```\r\nallow me to point out the problems.\r\n\r\n1. The image do no add, there are still one image\r\n2. the annotations add, but there are only one annotation for each loop, the origin mask have multiple area for each image.\r\n3. the `annotation['image_id']` and  the `images['id']` always 0, however, the file_name did change\r\n\r\nI read about the docus, maybe the Dataset is not a \"dataset\" but a handle to iterator the image and annos? but even though this doesn't make sense anyway. For,example, the new add anno has the same `image_id` with the previous one.\r\n\r\nHow can I make ONE json file with images contains multiple object in each one for future train ? Thank you,","closed_by":null,"reactions":{"url":"https://api.github.com/repos/jsbroks/imantics/issues/46/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jsbroks/imantics/issues/46/timeline","performed_via_github_app":null,"state_reason":null}