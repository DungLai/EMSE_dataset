{"url":"https://api.github.com/repos/jsbroks/imantics/issues/48","repository_url":"https://api.github.com/repos/jsbroks/imantics","labels_url":"https://api.github.com/repos/jsbroks/imantics/issues/48/labels{/name}","comments_url":"https://api.github.com/repos/jsbroks/imantics/issues/48/comments","events_url":"https://api.github.com/repos/jsbroks/imantics/issues/48/events","html_url":"https://github.com/jsbroks/imantics/issues/48","id":1045903972,"node_id":"I_kwDOCdyYB84-Vzpk","number":48,"title":"bug: polygon notation from mask ","user":{"login":"chrbrgst","id":87496633,"node_id":"MDQ6VXNlcjg3NDk2NjMz","avatar_url":"https://avatars.githubusercontent.com/u/87496633?v=4","gravatar_id":"","url":"https://api.github.com/users/chrbrgst","html_url":"https://github.com/chrbrgst","followers_url":"https://api.github.com/users/chrbrgst/followers","following_url":"https://api.github.com/users/chrbrgst/following{/other_user}","gists_url":"https://api.github.com/users/chrbrgst/gists{/gist_id}","starred_url":"https://api.github.com/users/chrbrgst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrbrgst/subscriptions","organizations_url":"https://api.github.com/users/chrbrgst/orgs","repos_url":"https://api.github.com/users/chrbrgst/repos","events_url":"https://api.github.com/users/chrbrgst/events{/privacy}","received_events_url":"https://api.github.com/users/chrbrgst/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-11-05T14:21:51Z","updated_at":"2021-11-05T14:23:16Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"the algorithm that is used to create the polygon notation from a mask sometimes creates single-point polygons.\r\nWhen using pycocotools' annToMask, this throws an exception:\r\n\r\n`import imantics as imt`\r\n`import numpy as np`\r\n`from pycocotools.coco import COCO`\r\n`import json`\r\n\r\n`mask = [[0, 0, 0, 0, 0, 0], [0, 1, 1, 0, 0, 0], [0, 1, 1, 1, 0, 0], [1, 1, 1, 0, 0, 0], [1, 1, 0, 0, 1, 0], [1, 0, 0, 0, 0, 0]]`\r\n`mask = np.array(mask, dtype='uint8')`\r\n\r\n\r\n`dataset = imt.Dataset('dataset')`\r\n`catt = imt.Category('dummy', id=1)`\r\n\r\n`maskk = imt.Mask(mask)`\r\n\r\n`img = np.reshape(np.array([mask, mask, mask]), [6, 6, 3])`\r\n`imgg = imt.Image(img, path='hello/world.png')`\r\n`dataset.add(imgg)`\r\n\r\n`ann = imt.Annotation.from_mask(maskk, image=imgg, category=catt)`\r\n\r\n`dataset.add(ann)`\r\n`with open('dummy.json', 'w') as f:`\r\n`    f.write(json.dumps(dataset.coco()))`\r\n`coco = COCO('dummy.json')`\r\n`new_mask = coco.annToMask(coco.anns[1])`\r\n\r\n\r\nby rejecting those single(or two)-point polygons, this can be solved:\r\njust edit the polygon- method in the Mask-Class and replace:\r\n`polygons = [polygon.flatten() for polygon in polygons]`\r\nwith\r\n`polygons = [polygon.flatten() for polygon in polygons if polygon.shape[0] > 2]`","closed_by":null,"reactions":{"url":"https://api.github.com/repos/jsbroks/imantics/issues/48/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jsbroks/imantics/issues/48/timeline","performed_via_github_app":null,"state_reason":null}