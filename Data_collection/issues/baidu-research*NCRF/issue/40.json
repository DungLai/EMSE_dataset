{"url":"https://api.github.com/repos/baidu-research/NCRF/issues/40","repository_url":"https://api.github.com/repos/baidu-research/NCRF","labels_url":"https://api.github.com/repos/baidu-research/NCRF/issues/40/labels{/name}","comments_url":"https://api.github.com/repos/baidu-research/NCRF/issues/40/comments","events_url":"https://api.github.com/repos/baidu-research/NCRF/issues/40/events","html_url":"https://github.com/baidu-research/NCRF/issues/40","id":511135899,"node_id":"MDU6SXNzdWU1MTExMzU4OTk=","number":40,"title":"利用CAMELYON16提供的Annotations在測試時無法正確計算FROC","user":{"login":"christinesu12","id":50400404,"node_id":"MDQ6VXNlcjUwNDAwNDA0","avatar_url":"https://avatars.githubusercontent.com/u/50400404?v=4","gravatar_id":"","url":"https://api.github.com/users/christinesu12","html_url":"https://github.com/christinesu12","followers_url":"https://api.github.com/users/christinesu12/followers","following_url":"https://api.github.com/users/christinesu12/following{/other_user}","gists_url":"https://api.github.com/users/christinesu12/gists{/gist_id}","starred_url":"https://api.github.com/users/christinesu12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/christinesu12/subscriptions","organizations_url":"https://api.github.com/users/christinesu12/orgs","repos_url":"https://api.github.com/users/christinesu12/repos","events_url":"https://api.github.com/users/christinesu12/events{/privacy}","received_events_url":"https://api.github.com/users/christinesu12/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2019-10-23T07:38:08Z","updated_at":"2021-02-06T11:54:00Z","closed_at":"2020-01-31T06:37:06Z","author_association":"NONE","active_lock_reason":null,"body":"每個xml所產生的mask.tif經過computeEvaluationMask皆只有返回一個腫瘤 \r\nex . test_004.xml具有3個腫瘤註釋，但是生成的mask tif文件返回1個腫瘤\r\nxml to tif\r\nreader = mir.MultiResolutionImageReader()\r\nmr_image = reader.open('../images/test_021.tif')\r\nannotation_list = mir.AnnotationList()\r\nxml_repository = mir.XmlRepository(annotation_list)\r\nxml_repository.setSource('test_021.xml')\r\nxml_repository.load()\r\nannotation_mask = mir.AnnotationToMask()\r\ncamelyon17_type_mask = False\r\nlabel_map = {'metastases': 1, 'normal': 2} if camelyon17_type_mask else {'_0': 1, '_1': 1, '_2': 0}\r\nconversion_order = ['metastases', 'normal'] if camelyon17_type_mask else  ['_0', '_1', '_2']\r\noutput_path = \"test_021_mask.tif\"\r\nannotation_mask.convert(annotation_list, output_path, mr_image.getDimensions(), mr_image.getSpacing(), label_map, conversion_order)\r\n\r\nevaluation mask\r\ndef computeEvaluationMask(maskDIR, resolution, level):\r\n    \"\"\"Computes the evaluation mask.\r\n    \r\n    Args:\r\n        maskDIR:    the directory of the ground truth mask\r\n        resolution: Pixel resolution of the image at level 0\r\n        level:      The level at which the evaluation mask is made\r\n        \r\n    Returns:\r\n        evaluation_mask\r\n    \"\"\"\r\n    slide = openslide.open_slide(maskDIR)\r\n    dims = slide.level_dimensions[level]\r\n    pixelarray = np.zeros(dims[0]*dims[1], dtype='uint')\r\n    pixelarray = np.array(slide.read_region((0,0), level, dims))\r\n    distance = nd.distance_transform_edt(255 - pixelarray[:,:,0])\r\n    Threshold = 75/(resolution * pow(2, level) * 2) # 75µm is the equivalent size of 5 tumor cells\r\n    binary = distance < Threshold\r\n    filled_image = nd.morphology.binary_fill_holes(binary)\r\n    evaluation_mask = measure.label(filled_image, connectivity = 2) \r\n    return evaluation_mask\r\n\r\n\r\n","closed_by":{"login":"yil8","id":1263739,"node_id":"MDQ6VXNlcjEyNjM3Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1263739?v=4","gravatar_id":"","url":"https://api.github.com/users/yil8","html_url":"https://github.com/yil8","followers_url":"https://api.github.com/users/yil8/followers","following_url":"https://api.github.com/users/yil8/following{/other_user}","gists_url":"https://api.github.com/users/yil8/gists{/gist_id}","starred_url":"https://api.github.com/users/yil8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yil8/subscriptions","organizations_url":"https://api.github.com/users/yil8/orgs","repos_url":"https://api.github.com/users/yil8/repos","events_url":"https://api.github.com/users/yil8/events{/privacy}","received_events_url":"https://api.github.com/users/yil8/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/baidu-research/NCRF/issues/40/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/baidu-research/NCRF/issues/40/timeline","performed_via_github_app":null,"state_reason":"completed"}