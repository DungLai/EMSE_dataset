{"url":"https://api.github.com/repos/zvtvz/zvt/issues/68","repository_url":"https://api.github.com/repos/zvtvz/zvt","labels_url":"https://api.github.com/repos/zvtvz/zvt/issues/68/labels{/name}","comments_url":"https://api.github.com/repos/zvtvz/zvt/issues/68/comments","events_url":"https://api.github.com/repos/zvtvz/zvt/issues/68/events","html_url":"https://github.com/zvtvz/zvt/issues/68","id":617241021,"node_id":"MDU6SXNzdWU2MTcyNDEwMjE=","number":68,"title":"从3月31日版本升级到4月最新的版本，出现结构异常","user":{"login":"wisfern","id":1068193,"node_id":"MDQ6VXNlcjEwNjgxOTM=","avatar_url":"https://avatars.githubusercontent.com/u/1068193?v=4","gravatar_id":"","url":"https://api.github.com/users/wisfern","html_url":"https://github.com/wisfern","followers_url":"https://api.github.com/users/wisfern/followers","following_url":"https://api.github.com/users/wisfern/following{/other_user}","gists_url":"https://api.github.com/users/wisfern/gists{/gist_id}","starred_url":"https://api.github.com/users/wisfern/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wisfern/subscriptions","organizations_url":"https://api.github.com/users/wisfern/orgs","repos_url":"https://api.github.com/users/wisfern/repos","events_url":"https://api.github.com/users/wisfern/events{/privacy}","received_events_url":"https://api.github.com/users/wisfern/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-05-13T08:14:04Z","updated_at":"2020-05-14T01:48:01Z","closed_at":"2020-05-14T01:48:01Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"AttributeError: 'Stock' object has no attribute 'industries'\r\n\r\n请问，是否有如下东西：\r\n1、模型升级的sql文件\r\n2、migration脚本？\r\n\r\n如东财，有一段更数账务数据，会遇到判断这个票是什么类型的东西，更新后的代码就没有这个归属关系，导致跑数异常\r\ndef get_company_type(stock_domain: StockDetail):\r\n    industries = stock_domain.industries.split(',')\r\n    if ('银行' in industries) or ('信托' in industries):\r\n        return CompanyType.yinhang\r\n    if '保险' in industries:\r\n        return CompanyType.baoxian\r\n    if '证券' in industries:\r\n        return CompanyType.quanshang\r\n    return CompanyType.qiye\r\n\r\n\r\ndef company_type_flag(security_item):\r\n    try:\r\n        company_type = get_company_type(security_item)\r\n\r\n        if company_type == CompanyType.qiye:\r\n            return \"4\"\r\n        if company_type == CompanyType.quanshang:\r\n            return \"1\"\r\n        if company_type == CompanyType.baoxian:\r\n            return \"2\"\r\n        if company_type == CompanyType.yinhang:\r\n            return \"3\"\r\n    except Exception as e:\r\n        logger.exception(f\"id{security_item.code}-{security_item.industries}\", e)\r\n\r\n    param = {\r\n        \"color\": \"w\",\r\n        \"fc\": get_fc(security_item)\r\n    }\r\n\r\n    resp = requests.post('https://emh5.eastmoney.com/api/CaiWuFenXi/GetCompanyType', json=param)\r\n\r\n    ct = resp.json().get('Result').get('CompanyType')\r\n\r\n    logger.warning(\"{} not catching company type:{}\".format(security_item, ct))\r\n\r\n    return ct","closed_by":{"login":"wisfern","id":1068193,"node_id":"MDQ6VXNlcjEwNjgxOTM=","avatar_url":"https://avatars.githubusercontent.com/u/1068193?v=4","gravatar_id":"","url":"https://api.github.com/users/wisfern","html_url":"https://github.com/wisfern","followers_url":"https://api.github.com/users/wisfern/followers","following_url":"https://api.github.com/users/wisfern/following{/other_user}","gists_url":"https://api.github.com/users/wisfern/gists{/gist_id}","starred_url":"https://api.github.com/users/wisfern/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wisfern/subscriptions","organizations_url":"https://api.github.com/users/wisfern/orgs","repos_url":"https://api.github.com/users/wisfern/repos","events_url":"https://api.github.com/users/wisfern/events{/privacy}","received_events_url":"https://api.github.com/users/wisfern/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/zvtvz/zvt/issues/68/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/zvtvz/zvt/issues/68/timeline","performed_via_github_app":null,"state_reason":"completed"}