{"url":"https://api.github.com/repos/zvtvz/zvt/issues/117","repository_url":"https://api.github.com/repos/zvtvz/zvt","labels_url":"https://api.github.com/repos/zvtvz/zvt/issues/117/labels{/name}","comments_url":"https://api.github.com/repos/zvtvz/zvt/issues/117/comments","events_url":"https://api.github.com/repos/zvtvz/zvt/issues/117/events","html_url":"https://github.com/zvtvz/zvt/issues/117","id":732459391,"node_id":"MDU6SXNzdWU3MzI0NTkzOTE=","number":117,"title":"(sqlite3.IntegrityError) column id is not unique ","user":{"login":"ranglang","id":12862508,"node_id":"MDQ6VXNlcjEyODYyNTA4","avatar_url":"https://avatars.githubusercontent.com/u/12862508?v=4","gravatar_id":"","url":"https://api.github.com/users/ranglang","html_url":"https://github.com/ranglang","followers_url":"https://api.github.com/users/ranglang/followers","following_url":"https://api.github.com/users/ranglang/following{/other_user}","gists_url":"https://api.github.com/users/ranglang/gists{/gist_id}","starred_url":"https://api.github.com/users/ranglang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ranglang/subscriptions","organizations_url":"https://api.github.com/users/ranglang/orgs","repos_url":"https://api.github.com/users/ranglang/repos","events_url":"https://api.github.com/users/ranglang/events{/privacy}","received_events_url":"https://api.github.com/users/ranglang/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-10-29T16:18:17Z","updated_at":"2020-10-30T10:08:59Z","closed_at":"2020-10-30T10:08:59Z","author_association":"NONE","active_lock_reason":null,"body":" \r\n```\r\n\r\n   timestamps=timestamps)\r\n  File \"/usr/local/lib/python3.7/site-packages/zvt-0.9.1-py3.7.egg/zvt/recorders/joinquant/quotes/jq_stock_kdata_recorder.py\", line 143, in record\r\n    df_to_db(df=df, data_schema=self.data_schema, provider=self.provider, force_update=self.force_update)\r\n  File \"/usr/local/lib/python3.7/site-packages/zvt-0.9.1-py3.7.egg/zvt/contract/api.py\", line 454, in df_to_db\r\n    df_current.to_sql(data_schema.__tablename__, db_engine, index=False, if_exists='append')\r\n  File \"/usr/local/lib/python3.7/site-packages/pandas/core/generic.py\", line 2615, in to_sql\r\n    method=method,\r\n  File \"/usr/local/lib/python3.7/site-packages/pandas/io/sql.py\", line 598, in to_sql\r\n    method=method,\r\n  File \"/usr/local/lib/python3.7/site-packages/pandas/io/sql.py\", line 1406, in to_sql\r\n    raise err\r\n  File \"/usr/local/lib/python3.7/site-packages/pandas/io/sql.py\", line 1398, in to_sql\r\n    table.insert(chunksize, method=method)\r\n  File \"/usr/local/lib/python3.7/site-packages/pandas/io/sql.py\", line 830, in insert\r\n    exec_insert(conn, keys, chunk_iter)\r\n  File \"/usr/local/lib/python3.7/site-packages/pandas/io/sql.py\", line 747, in _execute_insert\r\n    conn.execute(self.table.insert(), data)\r\n  File \"/usr/local/lib/python3.7/site-packages/sqlalchemy/engine/base.py\", line 948, in execute\r\n    return meth(self, multiparams, params)\r\n  File \"/usr/local/lib/python3.7/site-packages/sqlalchemy/sql/elements.py\", line 269, in _execute_on_connection\r\n    return connection._execute_clauseelement(self, multiparams, params)\r\n  File \"/usr/local/lib/python3.7/site-packages/sqlalchemy/engine/base.py\", line 1060, in _execute_clauseelement\r\n    compiled_sql, distilled_params\r\n  File \"/usr/local/lib/python3.7/site-packages/sqlalchemy/engine/base.py\", line 1200, in _execute_context\r\n    context)\r\n  File \"/usr/local/lib/python3.7/site-packages/sqlalchemy/engine/base.py\", line 1413, in _handle_dbapi_exception\r\n    exc_info\r\n  File \"/usr/local/lib/python3.7/site-packages/sqlalchemy/util/compat.py\", line 265, in raise_from_cause\r\n    reraise(type(exception), exception, tb=exc_tb, cause=cause)\r\n  File \"/usr/local/lib/python3.7/site-packages/sqlalchemy/util/compat.py\", line 248, in reraise\r\n    raise value.with_traceback(tb)\r\n  File \"/usr/local/lib/python3.7/site-packages/sqlalchemy/engine/base.py\", line 1170, in _execute_context\r\n    context)\r\n  File \"/usr/local/lib/python3.7/site-packages/sqlalchemy/engine/default.py\", line 506, in do_executemany\r\n    cursor.executemany(statement, parameters)\r\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) column id is not unique [SQL: 'INSERT INTO stock_1d_kdata (level, name, entity_id, close, timestamp, volume, code, provider, open, id, low, high, turnover) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'] [parameters: (('1d', '奥马电器', 'stock_sz_002668', 4.7, '2020-10-16 00:00:00.000000', 18536575, '002668', 'joinquant', 4.66, 'stock_sz_002668_2020-10-16', 4.61, 4.7, 86227186.86), ('1d', '奥马电器', 'stock_sz_002668', 4.7, '2020-10-19 00:00:00.000000', 0, '002668', 'joinquant', 4.7, 'stock_sz_002668_2020-10-19', 4.7, 4.7, 0.0), ('1d', '奥马电器', 'stock_sz_002668', 4.7, '2020-10-20 00:00:00.000000', 0, '002668', 'joinquant', 4.7, 'stock_sz_002668_2020-10-20', 4.7, 4.7, 0.0), ('1d', '奥马电器', 'stock_sz_002668', 4.7, '2020-10-21 00:00:00.000000', 0, '002668', 'joinquant', 4.7, 'stock_sz_002668_2020-10-21', 4.7, 4.7, 0.0), ('1d', '奥马电器', 'stock_sz_002668', 4.7, '2020-10-21 00:00:00.000000', 0, '002668', 'joinquant', 4.7, 'stock_sz_002668_2020-10-21', 4.7, 4.7, 0.0), ('1d', '奥马电器', 'stock_sz_002668', 4.7, '2020-10-23 00:00:00.000000', 0, '002668', 'joinquant', 4.7, 'stock_sz_002668_2020-10-23', 4.7, 4.7, 0.0), ('1d', '奥马电器', 'stock_sz_002668', 4.84, '2020-10-26 00:00:00.000000', 54935175, '002668', 'joinquant', 4.84, 'stock_sz_002668_2020-10-26', 4.79, 5.08, 269399105.34), ('1d', '奥马电器', 'stock_sz_002668', 4.68, '2020-10-27 00:00:00.000000', 28395532, '002668', 'joinquant', 4.77, 'stock_sz_002668_2020-10-27', 4.65, 4.84, 134329336.16), ('1d', '奥马电器', 'stock_sz_002668', 4.57, '2020-10-28 00:00:00.000000', 23822369, '002668', 'joinquant', 4.64, 'stock_sz_002668_2020-10-28', 4.51, 4.64, 108758590.8), ('1d', '奥马电器', 'stock_sz_002668', 4.5, '2020-10-29 00:00:00.000000', 20219276, '002668', 'joinquant', 4.49, 'stock_sz_002668_2020-10-29', 4.46, 4.53, 90971480.08))] (Background on this error at: http://sqlalche.me/e/gkpj)\r\n2020-10-29 21:30:21,484  INFO  MainThread  count 4145\r\n\r\n```","closed_by":{"login":"ranglang","id":12862508,"node_id":"MDQ6VXNlcjEyODYyNTA4","avatar_url":"https://avatars.githubusercontent.com/u/12862508?v=4","gravatar_id":"","url":"https://api.github.com/users/ranglang","html_url":"https://github.com/ranglang","followers_url":"https://api.github.com/users/ranglang/followers","following_url":"https://api.github.com/users/ranglang/following{/other_user}","gists_url":"https://api.github.com/users/ranglang/gists{/gist_id}","starred_url":"https://api.github.com/users/ranglang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ranglang/subscriptions","organizations_url":"https://api.github.com/users/ranglang/orgs","repos_url":"https://api.github.com/users/ranglang/repos","events_url":"https://api.github.com/users/ranglang/events{/privacy}","received_events_url":"https://api.github.com/users/ranglang/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/zvtvz/zvt/issues/117/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/zvtvz/zvt/issues/117/timeline","performed_via_github_app":null,"state_reason":"completed"}