{"url":"https://api.github.com/repos/autonomio/talos/issues/87","repository_url":"https://api.github.com/repos/autonomio/talos","labels_url":"https://api.github.com/repos/autonomio/talos/issues/87/labels{/name}","comments_url":"https://api.github.com/repos/autonomio/talos/issues/87/comments","events_url":"https://api.github.com/repos/autonomio/talos/issues/87/events","html_url":"https://github.com/autonomio/talos/issues/87","id":356614428,"node_id":"MDU6SXNzdWUzNTY2MTQ0Mjg=","number":87,"title":"Talos scans and custom models showing very different performance","user":{"login":"vascosa","id":32845478,"node_id":"MDQ6VXNlcjMyODQ1NDc4","avatar_url":"https://avatars.githubusercontent.com/u/32845478?v=4","gravatar_id":"","url":"https://api.github.com/users/vascosa","html_url":"https://github.com/vascosa","followers_url":"https://api.github.com/users/vascosa/followers","following_url":"https://api.github.com/users/vascosa/following{/other_user}","gists_url":"https://api.github.com/users/vascosa/gists{/gist_id}","starred_url":"https://api.github.com/users/vascosa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vascosa/subscriptions","organizations_url":"https://api.github.com/users/vascosa/orgs","repos_url":"https://api.github.com/users/vascosa/repos","events_url":"https://api.github.com/users/vascosa/events{/privacy}","received_events_url":"https://api.github.com/users/vascosa/received_events","type":"User","site_admin":false},"labels":[{"id":994489876,"node_id":"MDU6TGFiZWw5OTQ0ODk4NzY=","url":"https://api.github.com/repos/autonomio/talos/labels/investigation","name":"investigation","color":"d3d3d3","default":false,"description":"gathering information"}],"state":"closed","locked":false,"assignee":{"login":"matthewcarbone","id":26401020,"node_id":"MDQ6VXNlcjI2NDAxMDIw","avatar_url":"https://avatars.githubusercontent.com/u/26401020?v=4","gravatar_id":"","url":"https://api.github.com/users/matthewcarbone","html_url":"https://github.com/matthewcarbone","followers_url":"https://api.github.com/users/matthewcarbone/followers","following_url":"https://api.github.com/users/matthewcarbone/following{/other_user}","gists_url":"https://api.github.com/users/matthewcarbone/gists{/gist_id}","starred_url":"https://api.github.com/users/matthewcarbone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matthewcarbone/subscriptions","organizations_url":"https://api.github.com/users/matthewcarbone/orgs","repos_url":"https://api.github.com/users/matthewcarbone/repos","events_url":"https://api.github.com/users/matthewcarbone/events{/privacy}","received_events_url":"https://api.github.com/users/matthewcarbone/received_events","type":"User","site_admin":false},"assignees":[{"login":"matthewcarbone","id":26401020,"node_id":"MDQ6VXNlcjI2NDAxMDIw","avatar_url":"https://avatars.githubusercontent.com/u/26401020?v=4","gravatar_id":"","url":"https://api.github.com/users/matthewcarbone","html_url":"https://github.com/matthewcarbone","followers_url":"https://api.github.com/users/matthewcarbone/followers","following_url":"https://api.github.com/users/matthewcarbone/following{/other_user}","gists_url":"https://api.github.com/users/matthewcarbone/gists{/gist_id}","starred_url":"https://api.github.com/users/matthewcarbone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matthewcarbone/subscriptions","organizations_url":"https://api.github.com/users/matthewcarbone/orgs","repos_url":"https://api.github.com/users/matthewcarbone/repos","events_url":"https://api.github.com/users/matthewcarbone/events{/privacy}","received_events_url":"https://api.github.com/users/matthewcarbone/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2018-09-03T23:47:41Z","updated_at":"2018-09-18T07:53:52Z","closed_at":"2018-09-18T07:53:52Z","author_association":"NONE","active_lock_reason":null,"body":"Hello,\r\n\r\nI don't quite understand how Talos is optimizing the Keras models it produces and as such I'm having trouble replicating the results outside of Talos. \r\n\r\nI build a Talos model with different parameters did 14 scans, a 0.01 grid downsample. Accuracy results ranged from 68% to 89% (mean 81%), and fmeasures ranging from 0.25 to 0.86 (mean 0.67). The best measures results from \r\n\r\n```\r\np = {'first_neuron':[ 8],\r\n     'hidden_layers':[2],\r\n     'batch_size': [30],\r\n     'epochs': [200],\r\n     'dropout': [00.5],\r\n     'kernel_initializer': ['normal'],\r\n     'shape':['brick'],\r\n     'optimizer': [Nadam],\r\n     'losses': [sparse_categorical_crossentropy],\r\n     'activation':[relu],\r\n     'last_activation': [sigmoid]}\r\n```\r\n\r\nThen I tried to build a model to replicate this on the same data:\r\n```\r\nX, Y = import_data()\r\nX = preprocessing.scale(X)\r\nx, X_test, y, y_test = train_test_split(X, Y, test_size = 0.2, random_state=44)\r\n\r\nbest_model=Sequential()\r\nbest_model.add(Dense(8, activation='relu', input_dim=X_test.shape[1]))\r\nbest_model.add(Dropout(0.5))\r\nbest_model.add(Dense(8, activation='relu'))\r\nbest_model.add(Dense(8, activation='relu'))\r\nbest_model.add(Dense(2, activation='sigmoid'))\r\n\r\nbest_model.compile(loss='sparse_categorical_crossentropy',\r\n                      optimizer='Nadam',\r\n                      metrics=['accuracy',fmeasure])\r\n\r\nbest_model.fit(x, y, epochs=200, batch_size=30)\r\nscore = best_model.evaluate(X_test, y_test, verbose=0)\r\nprint(score)\r\n```\r\n\r\nThis model never surpasses  80% accuracy or 0. 7fmeasure. Neither does the model created based on the worst scan. For both models I got accuracies as low as 50%, meaning the range is really different from what that of the scans indicate. I would expect at least one scan to be low as well, but that's not the case. What is causing the difference in performance between my test model and the Talos model?\r\n\r\nFor reference, this is my Talos model:\r\n\r\n\r\n```\r\ndef newmodel(x_train, y_train, x_val, y_val, params):\r\n\r\n    model = Sequential()\r\n    model.add(Dense(params['first_neuron'], input_dim=x_train.shape[1],\r\n                    activation=params['activation'],\r\n                    kernel_initializer=params['kernel_initializer']))    \r\n    model.add(Dropout(params['dropout'])) \r\n    hidden_layers(model, params, 1)\r\n    model.add(Dense(2, activation=params['last_activation'],\r\n                    kernel_initializer=params['kernel_initializer']))  \r\n   model.compile(loss=params['losses'],\r\n                  optimizer=params['optimizer'](),\r\n                  metrics=['acc', fmeasure])  \r\n    history = model.fit(x_train, y_train, \r\n                        validation_data=[x_val, y_val],\r\n                        batch_size=params['batch_size'],\r\n                        epochs=params['epochs'],\r\n                        verbose=0)\r\n\r\n    return history, model\r\n\r\n\r\np = {'first_neuron':[4, 8, 16, 32, 64],\r\n     'hidden_layers':[0, 1, 2],\r\n     'batch_size': [2, 30],\r\n     'epochs': [50, 200],\r\n     'dropout': [0.2, 0.5],\r\n     'kernel_initializer': ['normal'],\r\n     'shape':['brick','long_funnel'],\r\n     'optimizer': [Nadam, Adam, RMSprop],\r\n     'losses': [sparse_categorical_crossentropy],\r\n     'activation':[relu, elu],\r\n     'last_activation': [sigmoid]}\r\n\r\n\r\nt = ta.Scan(x=X,\r\n            y=Y,\r\n            model=newmodel,\r\n            grid_downsample=0.01, \r\n            params=p,\r\n            dataset_name='LA5s',\r\n            val_split = 0.2,\r\n            save_best_model = True,\r\n            experiment_no='1')\r\n```\r\n\r\n\r\nThank you so much for your help.\r\n\r\nBest,\r\nVasco\r\n","closed_by":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/autonomio/talos/issues/87/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/autonomio/talos/issues/87/timeline","performed_via_github_app":null,"state_reason":"completed"}