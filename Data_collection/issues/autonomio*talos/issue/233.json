{"url":"https://api.github.com/repos/autonomio/talos/issues/233","repository_url":"https://api.github.com/repos/autonomio/talos","labels_url":"https://api.github.com/repos/autonomio/talos/issues/233/labels{/name}","comments_url":"https://api.github.com/repos/autonomio/talos/issues/233/comments","events_url":"https://api.github.com/repos/autonomio/talos/issues/233/events","html_url":"https://github.com/autonomio/talos/issues/233","id":413813431,"node_id":"MDU6SXNzdWU0MTM4MTM0MzE=","number":233,"title":"Key error, 'not in index' with model","user":{"login":"shbfy","id":26031153,"node_id":"MDQ6VXNlcjI2MDMxMTUz","avatar_url":"https://avatars.githubusercontent.com/u/26031153?v=4","gravatar_id":"","url":"https://api.github.com/users/shbfy","html_url":"https://github.com/shbfy","followers_url":"https://api.github.com/users/shbfy/followers","following_url":"https://api.github.com/users/shbfy/following{/other_user}","gists_url":"https://api.github.com/users/shbfy/gists{/gist_id}","starred_url":"https://api.github.com/users/shbfy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shbfy/subscriptions","organizations_url":"https://api.github.com/users/shbfy/orgs","repos_url":"https://api.github.com/users/shbfy/repos","events_url":"https://api.github.com/users/shbfy/events{/privacy}","received_events_url":"https://api.github.com/users/shbfy/received_events","type":"User","site_admin":false},"labels":[{"id":1040763409,"node_id":"MDU6TGFiZWwxMDQwNzYzNDA5","url":"https://api.github.com/repos/autonomio/talos/labels/user%20support","name":"user support","color":"59db8b","default":false,"description":"nothing is wrong with Talos"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2019-02-24T11:54:13Z","updated_at":"2019-02-25T12:34:50Z","closed_at":"2019-02-25T12:34:50Z","author_association":"NONE","active_lock_reason":null,"body":"\r\n- [x] I'm up-to-date with the latest release (v 0.4.7:\r\n    \r\n      pip install -U talos\r\n\r\n- [x] I've confirmed that my Keras model works outside of Talos.\r\n\r\n- input shape (4000, 1000) output shape (4000, 3)\r\n- Talos params dictionary\r\n\r\n```\r\np = {'lr': (0.5, 5, 10),\r\n     'first_neuron':[4, 8, 16, 32, 64],\r\n     'batch_size': (2, 30, 10),\r\n     'epochs': [3, 5, 10],\r\n     'dropout': (0, 0.5, 5),\r\n     'optimizer': [Adam, Nadam, RMSprop],\r\n     'activation':[relu, elu, sigmoid],\r\n     'last_activation': [sigmoid]}\r\n```\r\n\r\n- The Keras model wired for Talos\r\nCNN GRU. Input is a set of padded sequences represented as numpy ndarrays\r\n\r\n- Description of extra variables in the model\r\nEarly stopping callback\r\nReduced learning rate callback\r\n\r\n```\r\ndef cnn_gru_model(X_train, y_train, max_words, params):\r\n    model = Sequential()\r\n    model.add(Embedding(max_words, 4000))\r\n    model.add(Dropout(params['dropout']))\r\n    model.add(Conv1D(params['first_neuron'], 5, activation=params['activation']))\r\n    model.add(MaxPooling1D(pool_size=5))\r\n\r\n    model.add(Bidirectional(GRU(16)))\r\n    model.add(BatchNormalization())\r\n\r\n    model.add(Dense(3, activation=params['last_activation']))\r\n\r\n    model.compile(loss='binary_crossentropy', \r\n                  optimizer=params['optimizer'](lr=lr_normalizer(params['lr'], params['optimizer'])),\r\n                                                metrics=['accuracy'])\r\n    out = model.fit(X_train, y_train.values, batch_size=params['batch_size'],\r\n                    epochs=params['epochs'],\r\n                    verbose=0,\r\n                    callbacks=[early_stop, reduce_lr])\r\n    return out, model\r\n```\r\n\r\nTalos scan\r\n\r\n```\r\nh = ta.Scan(X_train, y_train, seed=7, params=p, model=cnn_gru_model, grid_downsample=.01)\r\n```\r\n\r\nTraceback\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nKeyError                                  Traceback (most recent call last)\r\n<ipython-input-11-ef172bafecb3> in <module>\r\n----> 1 h = ta.Scan(X_train, y_train, seed=7, params=p, model=cnn_gru_model, grid_downsample=.01)\r\n\r\n/anaconda3/lib/python3.6/site-packages/talos/scan/Scan.py in __init__(self, x, y, params, model, dataset_name, experiment_no, x_val, y_val, val_split, shuffle, round_limit, grid_downsample, random_method, seed, search_method, reduction_method, reduction_interval, reduction_window, reduction_threshold, reduction_metric, reduce_loss, last_epoch_value, clear_tf_session, disable_progress_bar, print_params, debug)\r\n    163         # input parameters section ends\r\n    164 \r\n--> 165         self._null = self.runtime()\r\n    166 \r\n    167     def runtime(self):\r\n\r\n/anaconda3/lib/python3.6/site-packages/talos/scan/Scan.py in runtime(self)\r\n    167     def runtime(self):\r\n    168 \r\n--> 169         self = scan_prepare(self)\r\n    170         self = scan_run(self)\r\n\r\n/anaconda3/lib/python3.6/site-packages/talos/scan/scan_prepare.py in scan_prepare(self)\r\n     57     # create the data asset\r\n     58     self.y_max = self.y.max()\r\n---> 59     self = validation_split(self)\r\n     60     self.shape = classify(self.y)\r\n     61     self.last_neuron = last_neuron(self)\r\n\r\n/anaconda3/lib/python3.6/site-packages/talos/utils/validation_split.py in validation_split(self)\r\n     16     else:\r\n     17         if self.shuffle:\r\n---> 18             random_shuffle(self)\r\n     19 \r\n     20         limit = int(len(self.x) * (1 - self.val_split))\r\n\r\n/anaconda3/lib/python3.6/site-packages/talos/utils/validation_split.py in random_shuffle(self)\r\n     60         self.x = self.x[ix]\r\n     61 \r\n---> 62     self.y = self.y[ix]\r\n     63 \r\n     64 \r\n\r\n/anaconda3/lib/python3.6/site-packages/pandas/core/frame.py in __getitem__(self, key)\r\n   2680         if isinstance(key, (Series, np.ndarray, Index, list)):\r\n   2681             # either boolean or fancy integer index\r\n-> 2682             return self._getitem_array(key)\r\n   2683         elif isinstance(key, DataFrame):\r\n   2684             return self._getitem_frame(key)\r\n\r\n/anaconda3/lib/python3.6/site-packages/pandas/core/frame.py in _getitem_array(self, key)\r\n   2724             return self._take(indexer, axis=0)\r\n   2725         else:\r\n-> 2726             indexer = self.loc._convert_to_indexer(key, axis=1)\r\n   2727             return self._take(indexer, axis=1)\r\n   2728 \r\n\r\n/anaconda3/lib/python3.6/site-packages/pandas/core/indexing.py in _convert_to_indexer(self, obj, axis, is_setter)\r\n   1325                 if mask.any():\r\n   1326                     raise KeyError('{mask} not in index'\r\n-> 1327                                    .format(mask=objarr[mask]))\r\n   1328 \r\n   1329                 return com._values_from_object(indexer)\r\n\r\nKeyError: '[2060  933  378 ...  537 1220  175] not in index'\r\n```","closed_by":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/autonomio/talos/issues/233/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/autonomio/talos/issues/233/timeline","performed_via_github_app":null,"state_reason":"completed"}