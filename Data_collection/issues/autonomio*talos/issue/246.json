{"url":"https://api.github.com/repos/autonomio/talos/issues/246","repository_url":"https://api.github.com/repos/autonomio/talos","labels_url":"https://api.github.com/repos/autonomio/talos/issues/246/labels{/name}","comments_url":"https://api.github.com/repos/autonomio/talos/issues/246/comments","events_url":"https://api.github.com/repos/autonomio/talos/issues/246/events","html_url":"https://github.com/autonomio/talos/issues/246","id":415984328,"node_id":"MDU6SXNzdWU0MTU5ODQzMjg=","number":246,"title":"why can't I reproduce results after restoring the best model?","user":{"login":"17laker","id":40563079,"node_id":"MDQ6VXNlcjQwNTYzMDc5","avatar_url":"https://avatars.githubusercontent.com/u/40563079?v=4","gravatar_id":"","url":"https://api.github.com/users/17laker","html_url":"https://github.com/17laker","followers_url":"https://api.github.com/users/17laker/followers","following_url":"https://api.github.com/users/17laker/following{/other_user}","gists_url":"https://api.github.com/users/17laker/gists{/gist_id}","starred_url":"https://api.github.com/users/17laker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/17laker/subscriptions","organizations_url":"https://api.github.com/users/17laker/orgs","repos_url":"https://api.github.com/users/17laker/repos","events_url":"https://api.github.com/users/17laker/events{/privacy}","received_events_url":"https://api.github.com/users/17laker/received_events","type":"User","site_admin":false},"labels":[{"id":1040763409,"node_id":"MDU6TGFiZWwxMDQwNzYzNDA5","url":"https://api.github.com/repos/autonomio/talos/labels/user%20support","name":"user support","color":"59db8b","default":false,"description":"nothing is wrong with Talos"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-03-01T07:59:04Z","updated_at":"2019-03-03T11:03:04Z","closed_at":"2019-03-01T08:55:00Z","author_association":"NONE","active_lock_reason":null,"body":"**Hello, mikkokotila. I think I might face the same problem ever talked about in #187, that is I can't reproduce results that I got from the experiment after restoring the best model. I tried to reprodue results on the training data set, validation data set but I failed. I don't know what I should do now.**\r\n\r\n\r\n**Here are the codes. If you need others please tell me** \r\n### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### \r\nta.Deploy(h,'model_1',metric = 'val_loss',asc=True)\r\nmodel_1 = ta.Restore('model_1.zip')\r\nY_train_hat = model_1.model.predict(X_train) #I have splited data into the trainning, validation, test data set.\r\nY_val_hat = model_1.model.predict(X_val)\r\nY_test_hat = model_1.model.predict(X_test)\r\n\r\n#I calculated the square of e_train, e_val, e_test but they aren't displayed correctly \r\ne_train = Y_train-Y_train_hat\r\nmse_train = sum(e_train**2)/e_train.shape  #output 1.46 but should be 1.85\r\ne_val = Y_val-Y_val_hat\r\nmse_val = sum(e_val**2)/e_val.shape #output 2.89 but should be 2.18\r\ne_test = Y_test-Y_test_hat\r\nmse_test = sum(e_test**2)/e_test.shape \r\n### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### \r\n\r\n\r\n**By the way, I've looked through #187 but I didn't understand the last paragraph you said. Could you clarify it again for me? Thank you for your help in advance!** \r\n### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### \r\nThe way scan_object.data and the accompanying .csv gets the results from metrics is through the history object that comes out from model.fit() in Keras. There are two modes in which Talos can do this:\r\n* based on highest epoch (which is default)\r\n* based on last epoch(you have to set` Scan( ... last_epoch_value=True ... )`)\r\nAs I have seen, in your model you are currently using `last_epoch_value=False` which means you are unlikely to ever get exactly the same result from evaluation as you will get from the Scan() results. I think based on this experience, we will have it True by default going forward. Still then you will end up with the problem, which has to do with Keras, where whatever you have as your last epoch metrics, is not going to be the same as the one you get from evaluate (or accuracy_score from sklearn). For example, I tried with your configuration and made the corresponding Keras model directly instead of using Talos, and the last epoch result is roughly 2% different from what both evaluate and accuracy_score gives.\r\nAs I now know what you are looking for and your data, I can confirm that this is not an issue in Talos, and even though it is something that is known about Keras (there are many issues discussing this), I'm not sure it can be considered an issue because the last epoch training result and evaluation are really not the same thing. **You get exactly the same level of reproducibility with Talos as you get with Keras. There is absolutely no difference.**\r\n### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ","closed_by":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/autonomio/talos/issues/246/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/autonomio/talos/issues/246/timeline","performed_via_github_app":null,"state_reason":"completed"}