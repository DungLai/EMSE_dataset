{"url":"https://api.github.com/repos/autonomio/talos/issues/133","repository_url":"https://api.github.com/repos/autonomio/talos","labels_url":"https://api.github.com/repos/autonomio/talos/issues/133/labels{/name}","comments_url":"https://api.github.com/repos/autonomio/talos/issues/133/comments","events_url":"https://api.github.com/repos/autonomio/talos/issues/133/events","html_url":"https://github.com/autonomio/talos/issues/133","id":381856679,"node_id":"MDU6SXNzdWUzODE4NTY2Nzk=","number":133,"title":"AttributeError: 'Model' object has no attribute 'predict_classes'","user":{"login":"off99555","id":15215732,"node_id":"MDQ6VXNlcjE1MjE1NzMy","avatar_url":"https://avatars.githubusercontent.com/u/15215732?v=4","gravatar_id":"","url":"https://api.github.com/users/off99555","html_url":"https://github.com/off99555","followers_url":"https://api.github.com/users/off99555/followers","following_url":"https://api.github.com/users/off99555/following{/other_user}","gists_url":"https://api.github.com/users/off99555/gists{/gist_id}","starred_url":"https://api.github.com/users/off99555/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/off99555/subscriptions","organizations_url":"https://api.github.com/users/off99555/orgs","repos_url":"https://api.github.com/users/off99555/repos","events_url":"https://api.github.com/users/off99555/events{/privacy}","received_events_url":"https://api.github.com/users/off99555/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2018-11-17T12:00:17Z","updated_at":"2018-11-17T14:35:22Z","closed_at":"2018-11-17T14:35:21Z","author_association":"NONE","active_lock_reason":null,"body":"- [x] I'm up-to-date with the latest release:\r\n    \r\n      pip install -U talos\r\n\r\n\r\n- [x] I've confirmed that my Keras model works outside of Talos.\r\n\r\nI have an error when I run scan. I am suspecting that it's because my model is not Sequential but talos expects it to be Sequential. And it's because my input is a list of numpy arrays, not a numpy array.\r\n\r\nHere is the model code (it works and run until the last line because I saw it printed \"Best val_r2_keras score\"):\r\n```python\r\n# build and train then return the history and the model\r\ndef build_deep_model(X_train, y_train, X_val, y_val, params):\r\n    X_train_keras = wave_df_to_keras_inputs(X_train) # this function converts array of shape (?, 604) to a list of 4 numpy arrays of shape (?,200,1), (?,200,1), (?,200,1), and (?,4)\r\n    X_val_keras = wave_df_to_keras_inputs(X_val)\r\n    input_x = keras.Input(shape=(200,1), name='x')\r\n    input_y = keras.Input(shape=(200,1), name='y')\r\n    input_z = keras.Input(shape=(200,1), name='z')\r\n    input_q = keras.Input(shape=(4,), name='q')\r\n    def compute_wave_features(x, name=None):\r\n        x = keras.layers.Conv1D(32, 5, strides=2, padding='same', activation='relu')(x)\r\n        x = keras.layers.Conv1D(32, 5, strides=2, padding='same', activation='relu')(x)\r\n        x = keras.layers.Conv1D(32, 5, strides=2, padding='same', activation='relu')(x)\r\n        x = keras.layers.Conv1D(32, 5, strides=2, padding='valid', activation='relu')(x)\r\n        x = keras.layers.Flatten()(x)\r\n        x = keras.layers.Dense(64, activation='relu', name=name)(x)\r\n        return x\r\n    feature_x = compute_wave_features(input_x, 'feature_x')\r\n    feature_y = compute_wave_features(input_y, 'feature_y')\r\n    feature_z = compute_wave_features(input_z, 'feature_z')\r\n    features = keras.layers.Concatenate()([feature_x, feature_y, feature_z, input_q])\r\n    features = keras.layers.Dense(32, activation='relu')(features)\r\n    readout = keras.layers.Dense(y_train.shape[1], activation='linear', name='readout')(features)\r\n    deep_model = keras.models.Model(inputs=[input_x, input_y, input_z, input_q], outputs=readout)\r\n    deep_model.compile('adam', loss='mse', metrics=['mae', r2_keras])\r\n    deep_model.summary()\r\n\r\n    callbacks = [\r\n        keras.callbacks.EarlyStopping(patience=3)\r\n    ]\r\n    history = deep_model.fit(X_train_keras, y_train, epochs=500, validation_data=[X_val_keras, y_val], callbacks=callbacks, verbose=2)\r\n    best_r2 = np.max(history.history['val_r2_keras'])\r\n    epochs = history.epoch[-1] + 1\r\n    print(\"Best val_r2_keras score:\", best_r2, 'Epochs:', epochs)\r\n    return history, deep_model\r\n```\r\n\r\nHere is the code that produces the error (no params yet):\r\n```python\r\nparams = {\r\n    \r\n}\r\nh = ta.Scan(X_train.values, y_train.values, params, build_deep_model, val_split=0.2, dataset_name='em-wave-pos', experiment_no='1')\r\n```\r\n\r\nHere is the output:\r\n\r\n```python\r\n__________________________________________________________________________________________________\r\nLayer (type)                    Output Shape         Param #     Connected to                     \r\n==================================================================================================\r\nx (InputLayer)                  (None, 200, 1)       0                                            \r\n__________________________________________________________________________________________________\r\ny (InputLayer)                  (None, 200, 1)       0                                            \r\n__________________________________________________________________________________________________\r\nz (InputLayer)                  (None, 200, 1)       0                                            \r\n__________________________________________________________________________________________________\r\nconv1d_13 (Conv1D)              (None, 100, 32)      192         x[0][0]                          \r\n__________________________________________________________________________________________________\r\nconv1d_17 (Conv1D)              (None, 100, 32)      192         y[0][0]                          \r\n__________________________________________________________________________________________________\r\nconv1d_21 (Conv1D)              (None, 100, 32)      192         z[0][0]                          \r\n__________________________________________________________________________________________________\r\nconv1d_14 (Conv1D)              (None, 50, 32)       5152        conv1d_13[0][0]                  \r\n__________________________________________________________________________________________________\r\nconv1d_18 (Conv1D)              (None, 50, 32)       5152        conv1d_17[0][0]                  \r\n__________________________________________________________________________________________________\r\nconv1d_22 (Conv1D)              (None, 50, 32)       5152        conv1d_21[0][0]                  \r\n__________________________________________________________________________________________________\r\nconv1d_15 (Conv1D)              (None, 25, 32)       5152        conv1d_14[0][0]                  \r\n__________________________________________________________________________________________________\r\nconv1d_19 (Conv1D)              (None, 25, 32)       5152        conv1d_18[0][0]                  \r\n__________________________________________________________________________________________________\r\nconv1d_23 (Conv1D)              (None, 25, 32)       5152        conv1d_22[0][0]                  \r\n__________________________________________________________________________________________________\r\nconv1d_16 (Conv1D)              (None, 11, 32)       5152        conv1d_15[0][0]                  \r\n__________________________________________________________________________________________________\r\nconv1d_20 (Conv1D)              (None, 11, 32)       5152        conv1d_19[0][0]                  \r\n__________________________________________________________________________________________________\r\nconv1d_24 (Conv1D)              (None, 11, 32)       5152        conv1d_23[0][0]                  \r\n__________________________________________________________________________________________________\r\nflatten_4 (Flatten)             (None, 352)          0           conv1d_16[0][0]                  \r\n__________________________________________________________________________________________________\r\nflatten_5 (Flatten)             (None, 352)          0           conv1d_20[0][0]                  \r\n__________________________________________________________________________________________________\r\nflatten_6 (Flatten)             (None, 352)          0           conv1d_24[0][0]                  \r\n__________________________________________________________________________________________________\r\nfeature_x (Dense)               (None, 64)           22592       flatten_4[0][0]                  \r\n__________________________________________________________________________________________________\r\nfeature_y (Dense)               (None, 64)           22592       flatten_5[0][0]                  \r\n__________________________________________________________________________________________________\r\nfeature_z (Dense)               (None, 64)           22592       flatten_6[0][0]                  \r\n__________________________________________________________________________________________________\r\nq (InputLayer)                  (None, 4)            0                                            \r\n__________________________________________________________________________________________________\r\nconcatenate_2 (Concatenate)     (None, 196)          0           feature_x[0][0]                  \r\n                                                                 feature_y[0][0]                  \r\n                                                                 feature_z[0][0]                  \r\n                                                                 q[0][0]                          \r\n__________________________________________________________________________________________________\r\ndense_2 (Dense)                 (None, 32)           6304        concatenate_2[0][0]              \r\n__________________________________________________________________________________________________\r\nreadout (Dense)                 (None, 3)            99          dense_2[0][0]                    \r\n==================================================================================================\r\nTotal params: 121,123\r\nTrainable params: 121,123\r\nNon-trainable params: 0\r\n__________________________________________________________________________________________________\r\nTrain on 9379 samples, validate on 2345 samples\r\nEpoch 1/500\r\n - 3s - loss: 0.0905 - mean_absolute_error: 0.2260 - r2_keras: 0.2083 - val_loss: 0.0542 - val_mean_absolute_error: 0.1868 - val_r2_keras: 0.5264\r\nEpoch 2/500\r\n - 3s - loss: 0.0552 - mean_absolute_error: 0.1869 - r2_keras: 0.5240 - val_loss: 0.0509 - val_mean_absolute_error: 0.1773 - val_r2_keras: 0.5562\r\nEpoch 3/500\r\n - 3s - loss: 0.0517 - mean_absolute_error: 0.1783 - r2_keras: 0.5550 - val_loss: 0.0499 - val_mean_absolute_error: 0.1721 - val_r2_keras: 0.5638\r\nEpoch 4/500\r\n - 3s - loss: 0.0503 - mean_absolute_error: 0.1748 - r2_keras: 0.5664 - val_loss: 0.0509 - val_mean_absolute_error: 0.1757 - val_r2_keras: 0.5543\r\nEpoch 5/500\r\n - 3s - loss: 0.0495 - mean_absolute_error: 0.1728 - r2_keras: 0.5736 - val_loss: 0.0510 - val_mean_absolute_error: 0.1713 - val_r2_keras: 0.5549\r\nEpoch 6/500\r\n - 3s - loss: 0.0481 - mean_absolute_error: 0.1692 - r2_keras: 0.5868 - val_loss: 0.0490 - val_mean_absolute_error: 0.1681 - val_r2_keras: 0.5725\r\nEpoch 7/500\r\n - 3s - loss: 0.0465 - mean_absolute_error: 0.1654 - r2_keras: 0.5999 - val_loss: 0.0528 - val_mean_absolute_error: 0.1785 - val_r2_keras: 0.5370\r\nEpoch 8/500\r\n - 3s - loss: 0.0450 - mean_absolute_error: 0.1626 - r2_keras: 0.6125 - val_loss: 0.0514 - val_mean_absolute_error: 0.1673 - val_r2_keras: 0.5548\r\nEpoch 9/500\r\n - 3s - loss: 0.0432 - mean_absolute_error: 0.1578 - r2_keras: 0.6281 - val_loss: 0.0483 - val_mean_absolute_error: 0.1633 - val_r2_keras: 0.5810\r\nEpoch 10/500\r\n - 3s - loss: 0.0414 - mean_absolute_error: 0.1531 - r2_keras: 0.6436 - val_loss: 0.0507 - val_mean_absolute_error: 0.1640 - val_r2_keras: 0.5581\r\nEpoch 11/500\r\n - 3s - loss: 0.0382 - mean_absolute_error: 0.1460 - r2_keras: 0.6709 - val_loss: 0.0523 - val_mean_absolute_error: 0.1709 - val_r2_keras: 0.5457\r\nEpoch 12/500\r\n - 3s - loss: 0.0360 - mean_absolute_error: 0.1410 - r2_keras: 0.6904 - val_loss: 0.0527 - val_mean_absolute_error: 0.1696 - val_r2_keras: 0.5398\r\nBest val_r2_keras score: 0.5809796204190772 Epochs: 12\r\n---------------------------------------------------------------------------\r\nAttributeError                            Traceback (most recent call last)\r\n<ipython-input-28-c4eaafcd036c> in <module>()\r\n      2 \r\n      3 }\r\n----> 4 h = ta.Scan(X_train.values, y_train.values, params, build_deep_model, val_split=0.2, dataset_name='em-wave-pos', experiment_no='1')\r\n\r\nc:\\users\\admin\\anaconda3\\lib\\site-packages\\talos\\scan\\Scan.py in __init__(self, x, y, params, model, dataset_name, experiment_no, x_val, y_val, val_split, shuffle, round_limit, grid_downsample, random_method, seed, search_method, reduction_method, reduction_interval, reduction_window, reduction_threshold, reduction_metric, reduce_loss, last_epoch_value, talos_log_name, clear_tf_session, functional_model, disable_progress_bar, print_params, debug)\r\n    164         # input parameters section ends\r\n    165 \r\n--> 166         self._null = self.runtime()\r\n    167 \r\n    168     def runtime(self):\r\n\r\nc:\\users\\admin\\anaconda3\\lib\\site-packages\\talos\\scan\\Scan.py in runtime(self)\r\n    169 \r\n    170         self = scan_prepare(self)\r\n--> 171         self = scan_run(self)\r\n\r\nc:\\users\\admin\\anaconda3\\lib\\site-packages\\talos\\scan\\scan_run.py in scan_run(self)\r\n     19                      disable=self.disable_progress_bar)\r\n     20     while len(self.param_log) != 0:\r\n---> 21         self = scan_round(self)\r\n     22         self.pbar.update(1)\r\n     23     self.pbar.close()\r\n\r\nc:\\users\\admin\\anaconda3\\lib\\site-packages\\talos\\scan\\scan_round.py in scan_round(self)\r\n     45 \r\n     46     _hr_out = run_round_results(self, _hr_out)\r\n---> 47     self._val_score = get_score(self)\r\n     48     write_log(self)\r\n     49     self.result.append(_hr_out)\r\n\r\nc:\\users\\admin\\anaconda3\\lib\\site-packages\\talos\\metrics\\score_model.py in get_score(self)\r\n     36         # all other cases\r\n     37         else:\r\n---> 38             y_pred = self.keras_model.predict_classes(self.x_val)\r\n     39 \r\n     40         return Performance(y_pred, self.y_val, self.shape, self.y_max).result\r\n\r\nAttributeError: 'Model' object has no attribute 'predict_classes'\r\n```\r\n\r\nI read a [stackoverflow post](https://stackoverflow.com/questions/44806125/attributeerror-model-object-has-no-attribute-predict-classes) about this error and they said it's because `predict_classes` only exist in `Sequential` model. \r\n\r\nI'm also confused because I'm building a regressor not a classifier, why is talos trying to predict classes?\r\n\r\nHow do I fix this issue?","closed_by":{"login":"off99555","id":15215732,"node_id":"MDQ6VXNlcjE1MjE1NzMy","avatar_url":"https://avatars.githubusercontent.com/u/15215732?v=4","gravatar_id":"","url":"https://api.github.com/users/off99555","html_url":"https://github.com/off99555","followers_url":"https://api.github.com/users/off99555/followers","following_url":"https://api.github.com/users/off99555/following{/other_user}","gists_url":"https://api.github.com/users/off99555/gists{/gist_id}","starred_url":"https://api.github.com/users/off99555/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/off99555/subscriptions","organizations_url":"https://api.github.com/users/off99555/orgs","repos_url":"https://api.github.com/users/off99555/repos","events_url":"https://api.github.com/users/off99555/events{/privacy}","received_events_url":"https://api.github.com/users/off99555/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/autonomio/talos/issues/133/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/autonomio/talos/issues/133/timeline","performed_via_github_app":null,"state_reason":"completed"}