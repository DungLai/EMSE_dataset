{"url":"https://api.github.com/repos/autonomio/talos/issues/319","repository_url":"https://api.github.com/repos/autonomio/talos","labels_url":"https://api.github.com/repos/autonomio/talos/issues/319/labels{/name}","comments_url":"https://api.github.com/repos/autonomio/talos/issues/319/comments","events_url":"https://api.github.com/repos/autonomio/talos/issues/319/events","html_url":"https://github.com/autonomio/talos/issues/319","id":449237986,"node_id":"MDU6SXNzdWU0NDkyMzc5ODY=","number":319,"title":"Error when tuning number of hidden layers","user":{"login":"kateruksha","id":24990402,"node_id":"MDQ6VXNlcjI0OTkwNDAy","avatar_url":"https://avatars.githubusercontent.com/u/24990402?v=4","gravatar_id":"","url":"https://api.github.com/users/kateruksha","html_url":"https://github.com/kateruksha","followers_url":"https://api.github.com/users/kateruksha/followers","following_url":"https://api.github.com/users/kateruksha/following{/other_user}","gists_url":"https://api.github.com/users/kateruksha/gists{/gist_id}","starred_url":"https://api.github.com/users/kateruksha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kateruksha/subscriptions","organizations_url":"https://api.github.com/users/kateruksha/orgs","repos_url":"https://api.github.com/users/kateruksha/repos","events_url":"https://api.github.com/users/kateruksha/events{/privacy}","received_events_url":"https://api.github.com/users/kateruksha/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-05-28T12:22:26Z","updated_at":"2019-06-10T06:59:33Z","closed_at":"2019-06-10T06:59:32Z","author_association":"NONE","active_lock_reason":null,"body":"Hi!\r\n\r\nI faced an error trying when adding hidden_layers to a list of parameters. To replicate it, I followed [Breast Cancer study](https://towardsdatascience.com/hyperparameter-optimization-with-keras-b82e6364ca53), just had to change \"shape\" to \"shapes\" in the parameter list.\r\n\r\n```\r\ndef breast_cancer_model(x_train, y_train, x_val, y_val, params):\r\n    model = Sequential()\r\n    model.add(Dense(10, input_dim=x_train.shape[1],\r\n                    activation=params['activation'],\r\n                    kernel_initializer='normal'))\r\n    \r\n    model.add(Dropout(params['dropout']))\r\n   \r\n    hidden_layers(model, params, 1)\r\n   \r\n    model.add(Dense(1, activation=params['last_activation'],\r\n                    kernel_initializer='normal'))\r\n    \r\n    model.compile(loss=params['losses'],\r\n                  optimizer=params['optimizer'](lr=lr_normalizer(params['lr'],params['optimizer'])),\r\n                  metrics=['acc', fmeasure])\r\n    \r\n    history = model.fit(x_train, y_train, \r\n                        validation_data=[x_val, y_val],\r\n                        batch_size=params['batch_size'],\r\n                        epochs=params['epochs'],\r\n                        verbose=0)\r\n \r\n    return history, model\r\n\r\np = {'lr': (0.5, 5, 10),\r\n     'first_neuron':[4, 8, 16, 32, 64],\r\n     'hidden_layers':[0, 1, 2],\r\n     'batch_size': (2, 30, 10),\r\n     'epochs': [150],\r\n     'dropout': (0, 0.5, 5),\r\n     'weight_regulizer':[None],\r\n     'emb_output_dims': [None],\r\n     'shapes':['brick','long_funnel'],\r\n     'optimizer': [Adam, Nadam],\r\n     'losses': [ binary_crossentropy],\r\n     'activation':[relu, elu],\r\n     'last_activation': [None]}\r\n\r\nt = ta.Scan(x=x,\r\n            y=y,\r\n            model=breast_cancer_model,\r\n            params=p,\r\n            dataset_name='breast_cancer',\r\n            experiment_no='1')\r\n```\r\n\r\nThis returns an error:\r\nIndexError: list index out of range\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nIndexError                                Traceback (most recent call last)\r\n<ipython-input-16-109ab999a0ed> in <module>\r\n      4             params=p,\r\n      5             dataset_name='breast_cancer',\r\n----> 6             experiment_no='1')\r\n\r\n~/.local/lib/python3.5/site-packages/talos/scan/Scan.py in __init__(self, x, y, params, model, dataset_name, experiment_no, x_val, y_val, val_split, shuffle, round_limit, grid_downsample, random_method, seed, search_method, reduction_method, reduction_interval, reduction_window, reduction_threshold, reduction_metric, reduce_loss, last_epoch_value, clear_tf_session, disable_progress_bar, print_params, debug)\r\n    168         # input parameters section ends\r\n    169 \r\n--> 170         self._null = self.runtime()\r\n    171 \r\n    172     def runtime(self):\r\n\r\n~/.local/lib/python3.5/site-packages/talos/scan/Scan.py in runtime(self)\r\n    173 \r\n    174         self = scan_prepare(self)\r\n--> 175         self = scan_run(self)\r\n\r\n~/.local/lib/python3.5/site-packages/talos/scan/scan_run.py in scan_run(self)\r\n     16                      disable=self.disable_progress_bar)\r\n     17     while len(self.param_log) != 0:\r\n---> 18         self = scan_round(self)\r\n     19         self.pbar.update(1)\r\n     20     self.pbar.close()\r\n\r\n~/.local/lib/python3.5/site-packages/talos/scan/scan_round.py in scan_round(self)\r\n     30     # fit the model\r\n     31     try:\r\n---> 32         _hr_out, self.keras_model = ingest_model(self)\r\n     33     except TypeError as err:\r\n     34         if err.args[0] == \"unsupported operand type(s) for +: 'int' and 'numpy.str_'\":\r\n\r\n~/.local/lib/python3.5/site-packages/talos/model/ingest_model.py in ingest_model(self)\r\n      8                       self.x_val,\r\n      9                       self.y_val,\r\n---> 10                       self.round_params)\r\n\r\n<ipython-input-7-7bad7210c65c> in breast_cancer_model(x_train, y_train, x_val, y_val, params)\r\n     10 \r\n     11     # if we want to also test for number of layers and shapes, that's possible\r\n---> 12     hidden_layers(model, params, 1)\r\n     13 \r\n     14     # then we finish again with completely standard Keras way\r\n\r\n~/.local/lib/python3.5/site-packages/talos/model/layers.py in hidden_layers(model, params, last_neuron)\r\n     68     for i in range(params['hidden_layers']):\r\n     69 \r\n---> 70         model.add(Dense(layer_neurons[i],\r\n     71                         activation=params['activation'],\r\n     72                         use_bias=use_bias,\r\nIndexError: list index out of range\r\n```\r\n\r\nThank you!","closed_by":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/autonomio/talos/issues/319/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/autonomio/talos/issues/319/timeline","performed_via_github_app":null,"state_reason":"completed"}