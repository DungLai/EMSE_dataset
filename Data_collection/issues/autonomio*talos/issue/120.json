{"url":"https://api.github.com/repos/autonomio/talos/issues/120","repository_url":"https://api.github.com/repos/autonomio/talos","labels_url":"https://api.github.com/repos/autonomio/talos/issues/120/labels{/name}","comments_url":"https://api.github.com/repos/autonomio/talos/issues/120/comments","events_url":"https://api.github.com/repos/autonomio/talos/issues/120/events","html_url":"https://github.com/autonomio/talos/issues/120","id":374442776,"node_id":"MDU6SXNzdWUzNzQ0NDI3NzY=","number":120,"title":"local variable 'acc_entropy' referenced before assignment","user":{"login":"dambuck","id":43039871,"node_id":"MDQ6VXNlcjQzMDM5ODcx","avatar_url":"https://avatars.githubusercontent.com/u/43039871?v=4","gravatar_id":"","url":"https://api.github.com/users/dambuck","html_url":"https://github.com/dambuck","followers_url":"https://api.github.com/users/dambuck/followers","following_url":"https://api.github.com/users/dambuck/following{/other_user}","gists_url":"https://api.github.com/users/dambuck/gists{/gist_id}","starred_url":"https://api.github.com/users/dambuck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dambuck/subscriptions","organizations_url":"https://api.github.com/users/dambuck/orgs","repos_url":"https://api.github.com/users/dambuck/repos","events_url":"https://api.github.com/users/dambuck/events{/privacy}","received_events_url":"https://api.github.com/users/dambuck/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-10-26T15:48:22Z","updated_at":"2018-10-29T09:50:53Z","closed_at":"2018-10-29T09:50:53Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\r\n\r\nI hope it is appropriate to ask this question here, since I am not able to track the source of the error in my own code. The error occurs after a first scan round.\r\nIt is a variational autoencoder.\r\n\r\nofc_binned is the data and is of the shape (84,100,73)\r\nI implemented two outputs only to test the loss_weights argument, because I got a different behaviour than putting both lost functions into one function. Batch_size is left to Default.\r\n\r\nI must be doing something wrong because of the two outputs two losses and the fact that predict returns a list of length 2 and not directly the prediction array.... It works fine with a single output.\r\n\r\nNo problem with the network outside of Talos.\r\n\r\nThank you\r\n\r\n\r\n\r\n\r\n\r\nsteps=np.linspace(0.99,0.9999,30)\r\nloss= {'weights': steps}\r\n\r\n\r\n_____________________________________________________________\r\n    def test_weights(x_train,y_train,x_val,y_val, params):\r\n        def sampling(args):\r\n            z_mean, z_var = args\r\n            batch_size = K.shape(z_mean)[0]\r\n            epsilon = K.random_normal(shape=(batch_size, latent_rep_size),mean=0.,stddev=epsilon_std)\r\n            return z_mean + K.exp(z_var / 2) * epsilon \r\n\r\n    def LFADS_reg(true,out):\r\n        kl = - 0.5 * K.sum(1 + z_var - K.square(z_mean) - K.exp(z_var), axis=-1)\r\n        return kl\r\n    \r\n    def LFADS_poisson(true, predicted):\r\n        true=K.flatten(true)\r\n        predicted=K.flatten(predicted)\r\n        return 1.*objectives.poisson(true, predicted)\r\n    \r\n    inp = Input(shape=(time_steps, neuron))\r\n    encode = Bidirectional(LSTM(neuron, return_sequences=True, dropout=0.0, name='lstm_1'), merge_mode='concat')(inp)\r\n    encode = Bidirectional(LSTM(neuron,  return_sequences=False, dropout=0.0, name='lstm_2'), merge_mode='concat')(encode)\r\n   \r\n\r\n\r\n    z_mean = Dense(latent_rep_size, name='z_mean', activation='linear')(encode)\r\n    z_var = Dense(latent_rep_size, name='z_var', activation='linear')(encode)\r\n\r\n    \r\n    #sampling and reshaping into sequences\r\n    decode=Lambda(sampling, output_shape=(latent_rep_size,), name='lambda')([z_mean, z_var])\r\n    repeated_context = RepeatVector(time_steps)(decode) #time_steps=number of bins\r\n\r\n    #'generator'\r\n    decode = LSTM(neuron, return_sequences=True,dropout=0.0, name='generator_gt', activation='sigmoid')(repeated_context) \r\n\r\n    #calculate factors\r\n    decode=TimeDistributed(Dense(20, activation='linear'), name='get_factors')(decode)\r\n     decode=TimeDistributed(Dense(neuron,activation='linear'), name= 'pre_rates')(decode)\r\n    decode=TimeDistributed(Dense(neuron, activation= K.exp ),name= 'exp_layer')(decode)\r\n\r\n \r\n    nan=TerminateOnNaN()\r\n    callbacklist=[nan]\r\n\r\n\r\n    adam = optimizers.adam(clipvalue=100)\r\n    Vae=Model(inputs=inp, outputs=[decode,decode])\r\n    Vae.compile(optimizer='adam',loss= [LFADS_poisson,LFADS_reg], loss_weights=[params['weights'],1-params['weights']])\r\n    out=Vae.fit(x_train, [y_train,y_train],epochs=10, callbacks=callbacklist)\r\n    \r\n\r\n    return out, Vae\r\n____________________________________________________________________\r\n\r\ntalos_test = ta.Scan(ofc_binned, ofc_binned, loss,test_weights,functional_model=True)\r\n\r\n____________________________________________________________________\r\nAttributeError                            Traceback (most recent call last)\r\n<ipython-input-110-881a4039c46d> in <module>()\r\n----> 1 talos_test = ta.Scan(ofc_binned, ofc_binned, loss,test_weights,functional_model=True)\r\n\r\n~/.local/lib/python3.5/site-packages/talos/scan/Scan.py in __init__(self, x, y, params, model, dataset_name, experiment_no, x_val, y_val, val_split, shuffle, round_limit, grid_downsample, random_method, seed, search_method, reduction_method, reduction_interval, reduction_window, reduction_threshold, reduction_metric, reduce_loss, last_epoch_value, talos_log_name, clear_tf_session, functional_model, disable_progress_bar, print_params, debug)\r\n    164         # input parameters section ends\r\n    165 \r\n--> 166         self._null = self.runtime()\r\n    167 \r\n    168     def runtime(self):\r\n\r\n~/.local/lib/python3.5/site-packages/talos/scan/Scan.py in runtime(self)\r\n    169 \r\n    170         self = scan_prepare(self)\r\n--> 171         self = scan_run(self)\r\n\r\n~/.local/lib/python3.5/site-packages/talos/scan/scan_run.py in scan_run(self)\r\n     19                      disable=self.disable_progress_bar)\r\n     20     while len(self.param_log) != 0:\r\n---> 21         self = scan_round(self)\r\n     22         self.pbar.update(1)\r\n     23     self.pbar.close()\r\n\r\n~/.local/lib/python3.5/site-packages/talos/scan/scan_round.py in scan_round(self)\r\n     45 \r\n     46     _hr_out = run_round_results(self, _hr_out)\r\n---> 47     self._val_score = get_score(self)\r\n     48     write_log(self)\r\n     49     self.result.append(_hr_out)\r\n\r\n~/.local/lib/python3.5/site-packages/talos/metrics/score_model.py in get_score(self)\r\n     33         # for functional model experimental support\r\n     34         if self.functional_model:\r\n---> 35             y_pred = _functional_predict(self.keras_model, self.x_val)\r\n     36         # all other cases\r\n     37         else:\r\n\r\n~/.local/lib/python3.5/site-packages/talos/metrics/score_model.py in _functional_predict(model, x, batch_size, verbose)\r\n     11                           verbose=verbose)\r\n     12 \r\n---> 13     if proba.shape[-1] > 1:\r\n     14         return proba.argmax(axis=-1)\r\n     15     else:\r\n\r\nAttributeError: 'list' object has no attribute 'shape'\r\n","closed_by":{"login":"dambuck","id":43039871,"node_id":"MDQ6VXNlcjQzMDM5ODcx","avatar_url":"https://avatars.githubusercontent.com/u/43039871?v=4","gravatar_id":"","url":"https://api.github.com/users/dambuck","html_url":"https://github.com/dambuck","followers_url":"https://api.github.com/users/dambuck/followers","following_url":"https://api.github.com/users/dambuck/following{/other_user}","gists_url":"https://api.github.com/users/dambuck/gists{/gist_id}","starred_url":"https://api.github.com/users/dambuck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dambuck/subscriptions","organizations_url":"https://api.github.com/users/dambuck/orgs","repos_url":"https://api.github.com/users/dambuck/repos","events_url":"https://api.github.com/users/dambuck/events{/privacy}","received_events_url":"https://api.github.com/users/dambuck/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/autonomio/talos/issues/120/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/autonomio/talos/issues/120/timeline","performed_via_github_app":null,"state_reason":"completed"}