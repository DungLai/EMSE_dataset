{"url":"https://api.github.com/repos/autonomio/talos/issues/26","repository_url":"https://api.github.com/repos/autonomio/talos","labels_url":"https://api.github.com/repos/autonomio/talos/issues/26/labels{/name}","comments_url":"https://api.github.com/repos/autonomio/talos/issues/26/comments","events_url":"https://api.github.com/repos/autonomio/talos/issues/26/events","html_url":"https://github.com/autonomio/talos/issues/26","id":344503534,"node_id":"MDU6SXNzdWUzNDQ1MDM1MzQ=","number":26,"title":"talos.Scan() returning UnboundLocalError when running","user":{"login":"nbarrios1337","id":29100363,"node_id":"MDQ6VXNlcjI5MTAwMzYz","avatar_url":"https://avatars.githubusercontent.com/u/29100363?v=4","gravatar_id":"","url":"https://api.github.com/users/nbarrios1337","html_url":"https://github.com/nbarrios1337","followers_url":"https://api.github.com/users/nbarrios1337/followers","following_url":"https://api.github.com/users/nbarrios1337/following{/other_user}","gists_url":"https://api.github.com/users/nbarrios1337/gists{/gist_id}","starred_url":"https://api.github.com/users/nbarrios1337/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nbarrios1337/subscriptions","organizations_url":"https://api.github.com/users/nbarrios1337/orgs","repos_url":"https://api.github.com/users/nbarrios1337/repos","events_url":"https://api.github.com/users/nbarrios1337/events{/privacy}","received_events_url":"https://api.github.com/users/nbarrios1337/received_events","type":"User","site_admin":false},"labels":[{"id":994489876,"node_id":"MDU6TGFiZWw5OTQ0ODk4NzY=","url":"https://api.github.com/repos/autonomio/talos/labels/investigation","name":"investigation","color":"d3d3d3","default":false,"description":"gathering information"}],"state":"closed","locked":false,"assignee":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"assignees":[{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2018-07-25T15:51:35Z","updated_at":"2018-07-25T22:10:52Z","closed_at":"2018-07-25T20:07:21Z","author_association":"NONE","active_lock_reason":null,"body":"When running the Scan() method with the following parameters:\r\n\r\n`t = talos.Scan(\r\n    x=x, \r\n    y=y, \r\n    model=model, \r\n    params=p, \r\n    dataset_name=\"ECG Classifier\", \r\n    experiment_no='10'\r\n)`\r\n\r\nand returns the following error:\r\n\r\n> The model needs to have Return in format \"return history, model\"\r\n> ---------------------------------------------------------------------------\r\n> UnboundLocalError                         Traceback (most recent call last)\r\n> <ipython-input-16-b88a13025eb1> in <module>()\r\n>       5     params=p,\r\n>       6     dataset_name=\"ECG Classifier\",\r\n> ----> 7     experiment_no='10'\r\n>       8 )\r\n> \r\n> ~\\Anaconda3\\envs\\ECG-Research\\lib\\site-packages\\talos\\scan.py in __init__(self, x, y, params, dataset_name, experiment_no, model, val_split, shuffle, search_method, save_best_model, reduction_method, reduction_interval, reduction_window, grid_downsample, reduction_metric, talos_log_name, debug)\r\n>      75         self.result = []\r\n>      76         while len(self.param_log) != 0:\r\n> ---> 77             self._null = self._run()\r\n>      78 \r\n>      79         self = result_todf(self)\r\n> \r\n> ~\\Anaconda3\\envs\\ECG-Research\\lib\\site-packages\\talos\\scan.py in _run(self)\r\n>      91             print('The model needs to have Return in format \"return history, model\"')\r\n>      92 \r\n> ---> 93         self.epoch_entropy.append(epoch_entropy((_hr_out)))\r\n>      94         _hr_out = run_round_results(self, _hr_out)\r\n>      95 \r\n> \r\n> UnboundLocalError: local variable '_hr_out' referenced before assignment\r\n\r\nFrom what I can tell, the seeming lack of a return method in my model function is triggering the first error, however the model function does have it:\r\n\r\n```\r\ndef model(x_train, y_train, x_val, y_val, params):\r\nmdl = Sequential()\r\ninput_shape = (10*60*fields.get('fs'), 1)\r\n\r\n#input\r\nmdl.add(Conv1D(params['input_neuron'], \r\n               input_shape=input_shape,\r\n               activation=params['activation'],\r\n               kernel_size=(params['kernel_size'],), \r\n               kernel_regularizer=l2(params['l2_regularizer']),\r\n              )\r\n       )\r\nif params['batch_normalization'] is True:\r\n    mdl.add(BatchNormalization())\r\n\r\nmdl.add(MaxPool1D(1))\r\nmdl.add(Dropout(params['dropout']))\r\n\r\nhidden_layers(mdl, params['hidden_layers'], params)\r\n\r\nmdl.add(Flatten())\r\n\r\n#output\r\nmdl.add(Dense(1, \r\n              kernel_regularizer=l2(params['l2_regularizer']),\r\n              activation=params['last_activation']\r\n             )\r\n       )\r\n\r\n\r\nmdl.compile(loss=params['losses'],\r\n             optimizer=params['optimizer'](),\r\n             metrics=['accuracy'])\r\n\r\ntb_callback = TensorBoard(log_dir='./logs/log80' + str(9) \r\n                          #+ '/' + str(run_num), write_graph=True, write_images=True\r\n                         )\r\n\r\nreduce_lr = ReduceLROnPlateau(monitor='val_loss', \r\n                              factor=0.2, \r\n                              patience=5, min_lr=0.001)\r\n\r\nhistory = mdl.fit(x_train, \r\n        y_train, \r\n        epochs=params['epochs'], \r\n        #batch_size=18, \r\n        verbose=1, \r\n        validation_data=(x_val, y_val),\r\n        callbacks=\r\n                  [\r\n                      tb_callback, \r\n                      reduce_lr\r\n                  ]\r\n                 )\r\n#~~~~return method here~~~~\r\nreturn history, mdl\r\n```\r\n\r\nI'm not sure what the second, _hr_out error is pointing out.\r\nAs reference, the hidden_layers method just add more layers depending on the respective hyperparameter that I listed in the params dictionary, which looks like:\r\n\r\n```\r\np = {\r\n    'input_neuron':(1,5,1),\r\n    'hidden_layers':(1,4,1),\r\n    'dropout':[p/10 for p in range(0, 6)],\r\n    'optimizer':[Adam, SGD, rmsprop, adagrad],\r\n    'losses':[binary_crossentropy],\r\n    'activation':[relu, elu],\r\n    'last_activation':[sigmoid],\r\n    'kernel_size':(75,175,25),\r\n    'l2_regularizer':[p/10 for p in range(0, 10)],\r\n    'filters':(1,9,1),\r\n    'batch_normalization':[True,False],\r\n    'epochs':(50,250,50)\r\n    }\r\n```","closed_by":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/autonomio/talos/issues/26/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/autonomio/talos/issues/26/timeline","performed_via_github_app":null,"state_reason":"completed"}