{"url":"https://api.github.com/repos/autonomio/talos/issues/331","repository_url":"https://api.github.com/repos/autonomio/talos","labels_url":"https://api.github.com/repos/autonomio/talos/issues/331/labels{/name}","comments_url":"https://api.github.com/repos/autonomio/talos/issues/331/comments","events_url":"https://api.github.com/repos/autonomio/talos/issues/331/events","html_url":"https://github.com/autonomio/talos/issues/331","id":458710200,"node_id":"MDU6SXNzdWU0NTg3MTAyMDA=","number":331,"title":"loss_entropy vs acc_entropy referenced before assignment","user":{"login":"prestonbrown-me","id":5788534,"node_id":"MDQ6VXNlcjU3ODg1MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/5788534?v=4","gravatar_id":"","url":"https://api.github.com/users/prestonbrown-me","html_url":"https://github.com/prestonbrown-me","followers_url":"https://api.github.com/users/prestonbrown-me/followers","following_url":"https://api.github.com/users/prestonbrown-me/following{/other_user}","gists_url":"https://api.github.com/users/prestonbrown-me/gists{/gist_id}","starred_url":"https://api.github.com/users/prestonbrown-me/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prestonbrown-me/subscriptions","organizations_url":"https://api.github.com/users/prestonbrown-me/orgs","repos_url":"https://api.github.com/users/prestonbrown-me/repos","events_url":"https://api.github.com/users/prestonbrown-me/events{/privacy}","received_events_url":"https://api.github.com/users/prestonbrown-me/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-06-20T14:59:53Z","updated_at":"2019-06-21T07:46:44Z","closed_at":"2019-06-21T07:46:43Z","author_association":"NONE","active_lock_reason":null,"body":"For models that do not have an accuracy metric, what am I to do when I get the following error?\r\n\r\n`local variable 'acc_entropy' referenced before assignment`\r\n\r\n- [x] I'm up-to-date with the latest release:\r\n    \r\n      pip install -U talos\r\n\r\n- [x] I've confirmed that my Keras model works outside of Talos.\r\n\r\nIf you still have an error, please submit **complete trace** and a code with: \r\n\r\n- output of shape for x and y e.g. (212,12)\r\n- Talos params dictionary\r\n- The Keras model wired for Talos\r\n- Description of extra variables in the model\r\n\r\nYou can provide the code in pastebin / gist or any other format you like. \r\n\r\n-------------------------------------------------------------------------\r\n\r\nTrace:\r\n```\r\n---------------------------------------------------------------------------\r\nUnboundLocalError                         Traceback (most recent call last)\r\n<ipython-input-34-49668748edfd> in <module>()\r\n      1 dummy_x = np.empty((1, num_x_signals))\r\n      2 dummy_y = np.empty((1, num_y_signals))\r\n----> 3 t = ta.Scan(dummy_x, dummy_y, p, generate_model, reduction_metric='val_loss')\r\n\r\n~/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/talos/scan/Scan.py in __init__(self, x, y, params, model, dataset_name, experiment_no, experiment_name, x_val, y_val, val_split, shuffle, round_limit, time_limit, grid_downsample, random_method, seed, search_method, permutation_filter, reduction_method, reduction_interval, reduction_window, reduction_threshold, reduction_metric, reduce_loss, last_epoch_value, clear_tf_session, disable_progress_bar, print_params, debug)\r\n    183         # input parameters section ends\r\n    184 \r\n--> 185         self._null = self.runtime()\r\n    186 \r\n    187     def runtime(self):\r\n\r\n~/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/talos/scan/Scan.py in runtime(self)\r\n    188 \r\n    189         self = scan_prepare(self)\r\n--> 190         self = scan_run(self)\r\n\r\n~/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/talos/scan/scan_run.py in scan_run(self)\r\n     18     # start the main loop of the program\r\n     19     while len(self.param_log) != 0:\r\n---> 20         self = scan_round(self)\r\n     21         self.pbar.update(1)\r\n     22         if self.time_limit is not None:\r\n\r\n~/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/talos/scan/scan_round.py in scan_round(self)\r\n     47     # create log and other stats\r\n     48     try:\r\n---> 49         self.epoch_entropy.append(epoch_entropy(_hr_out))\r\n     50     except (TypeError, AttributeError):\r\n     51         raise TalosReturnError(\"Make sure that input model returns in the order 'out, model'\")\r\n\r\n~/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/talos/metrics/entropy.py in epoch_entropy(history)\r\n     52             loss_entropy = nan\r\n     53 \r\n---> 54     return [acc_entropy, loss_entropy]\r\n\r\nUnboundLocalError: local variable 'acc_entropy' referenced before assignment\r\n```\r\n\r\nModel:\r\n```\r\np = {\r\n'first_neuron': [25, 256, 1024],\r\n'batch_size': [10, 20, 30],\r\n'dropout': [0.1, 0.15, 0.2, 0.25],\r\n'lr': [1e-3, 1e-4, 1e-5, 1e-6]\r\n}\r\n\r\ndef generate_model(x_train, y_train, x_val, y_val, params):\r\n    # replace the hyperparameter inputs with references to params dictionary \r\n    model = Sequential()\r\n    optimizer = RMSprop(lr=params['lr'])\r\n    model.add(CuDNNGRU(units=params['first_neuron'],\r\n                 return_sequences=True,\r\n                 input_shape=(None, num_x_signals)))\r\n    model.add(Dropout(params['dropout']))\r\n    model.add(Dense(num_y_signals, activation='sigmoid'))\r\n    model.compile(loss=loss_mse_warmup, optimizer=optimizer)\r\n\r\n    # make sure history object is returned by model.fit()\r\n    out = model.fit_generator(generator=generator,\r\n                    epochs=30,\r\n                    steps_per_epoch=50,\r\n                    validation_data=validation_data,\r\n                    callbacks=callbacks)\r\n    \r\n    # modify the output model\r\n    return out, model\r\n```\r\n\r\nScan:\r\n`t = ta.Scan(dummy_x, dummy_y, p, generate_model, reduction_metric='val_loss')`","closed_by":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/autonomio/talos/issues/331/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/autonomio/talos/issues/331/timeline","performed_via_github_app":null,"state_reason":"completed"}