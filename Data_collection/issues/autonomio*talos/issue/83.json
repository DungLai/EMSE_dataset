{"url":"https://api.github.com/repos/autonomio/talos/issues/83","repository_url":"https://api.github.com/repos/autonomio/talos","labels_url":"https://api.github.com/repos/autonomio/talos/issues/83/labels{/name}","comments_url":"https://api.github.com/repos/autonomio/talos/issues/83/comments","events_url":"https://api.github.com/repos/autonomio/talos/issues/83/events","html_url":"https://github.com/autonomio/talos/issues/83","id":355400333,"node_id":"MDU6SXNzdWUzNTU0MDAzMzM=","number":83,"title":"Reduction Method not working: AttributeError: 'Scan' object has no attribute '_reduce_keys'","user":{"login":"bml1g12","id":2605767,"node_id":"MDQ6VXNlcjI2MDU3Njc=","avatar_url":"https://avatars.githubusercontent.com/u/2605767?v=4","gravatar_id":"","url":"https://api.github.com/users/bml1g12","html_url":"https://github.com/bml1g12","followers_url":"https://api.github.com/users/bml1g12/followers","following_url":"https://api.github.com/users/bml1g12/following{/other_user}","gists_url":"https://api.github.com/users/bml1g12/gists{/gist_id}","starred_url":"https://api.github.com/users/bml1g12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bml1g12/subscriptions","organizations_url":"https://api.github.com/users/bml1g12/orgs","repos_url":"https://api.github.com/users/bml1g12/repos","events_url":"https://api.github.com/users/bml1g12/events{/privacy}","received_events_url":"https://api.github.com/users/bml1g12/received_events","type":"User","site_admin":false},"labels":[{"id":1040763409,"node_id":"MDU6TGFiZWwxMDQwNzYzNDA5","url":"https://api.github.com/repos/autonomio/talos/labels/user%20support","name":"user support","color":"59db8b","default":false,"description":"nothing is wrong with Talos"}],"state":"closed","locked":false,"assignee":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"assignees":[{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2018-08-30T02:30:54Z","updated_at":"2018-08-30T19:13:04Z","closed_at":"2018-08-30T19:13:04Z","author_association":"NONE","active_lock_reason":null,"body":"Thanks so much for coming here to raise an issue. Please take a moment to 'check' the below boxes:\r\n\r\n- [x ] I'm up-to-date with the latest release:\r\n    \r\nUsing Version: 0.3 from dev branch \r\n\r\n- [ x] I've confirmed that my Keras model works outside of Talos.\r\n\r\nIf you still have an error, please submit **complete trace** and a code with: \r\n\r\n- output of shape for x and y e.g. (212,12)\r\n```\r\nX_train.shape, Y_train.shape, X_test.shape, Y_test.shape\r\n((1800, 1001, 41), (1800, 247, 3), (168, 1001, 41), (168, 247, 3))\r\n```\r\n- Talos params dictionary\r\n```\r\np = {'learning_rate': [15, 10, 1], #0.001 = 1 normalised\r\n     'optimizer': [Adam,Nadam],\r\n     'num_filters': [128,196,256],\r\n     'gru_hidden_units':[32, 64, 128, 196],\r\n     'dropout_rate':[0.2,0.5,0.8],\r\n     'batch_size': [64, 128, 256],\r\n     'second_GRU_layer': [True, False],\r\n     'epochs': [200]}\r\n```\r\n- The Keras model wired for Talos\r\n```\r\ndef keras_nn_model_multi_talos(x_train, y_train, x_val, y_val, params):\r\n        \r\n    X_input = Input(shape = x_train.shape[1:])\r\n\r\n    # Step 1: CONV layer \r\n    X = Conv1D(filters=int(params[\"num_filters\"]), kernel_size=15,strides=4)(X_input)  # CONV1D\r\n    X = BatchNormalization()(X)                               # Batch normalization\r\n    X = Activation('relu')(X)                                 # ReLu activation\r\n    X = Dropout(rate=params[\"dropout_rate\"])(X)      \r\n                           # dropout (use 0.8)\r\n\r\n    # Step 2: First GRU Layer\r\n    X = GRU(units = int(params[\"gru_hidden_units\"]), return_sequences = True)(X)         # GRU (use 128 units and return the sequences)\r\n    X = Dropout(rate=params[\"dropout_rate\"])(X)                                  # dropout (use 0.8)\r\n    X = BatchNormalization()(X)                                 # Batch normalization\r\n    \r\n    if params[\"second_GRU_layer\"]:\r\n        # Step 3: Second GRU Layer \r\n        X = GRU(units = int(params[\"gru_hidden_units\"]), return_sequences = True)(X)                                 # GRU (use 128 units and return the sequences)\r\n        X = Dropout(rate=params[\"dropout_rate\"])(X)                                 # dropout (use 0.8)\r\n        X = BatchNormalization()(X)                                 # Batch normalization\r\n        X = Dropout(rate=params[\"dropout_rate\"])(X)                                   # dropout (use 0.8)\r\n    \r\n    # Step 4: Time-distributed dense layer \r\n    X = TimeDistributed(Dense(3, activation = \"softmax\"))(X) # time distributed  (sigmoid)\r\n\r\n    model = Model(inputs = X_input, outputs = X)\r\n    \r\n    from talos.model import lr_normalizer\r\n    if params[\"optimizer\"] == Adam:\r\n        opt = params[\"optimizer\"](lr=lr_normalizer(params[\"learning_rate\"], params[\"optimizer\"]), beta_1=0.9, beta_2=0.999, decay=0.01)\r\n    else:\r\n        opt = params[\"optimizer\"](lr=lr_normalizer(params[\"learning_rate\"], params[\"optimizer\"]))\r\n        \r\n    model.compile(loss='categorical_crossentropy', optimizer=opt, metrics=[\"acc\"], \r\n                  sample_weight_mode=\"temporal\")\r\n    \r\n    from keras_utils import calculate_weights\r\n    weights, sample_weights = calculate_weights(y_train)\r\n    weights_dev, sample_weights_dev = calculate_weights(y_val)\r\n    \r\n    \r\n    history = model.fit(x_train, y_train, batch_size = int(params[\"batch_size\"]), \r\n          validation_data=(x_val, y_val, sample_weights_dev),\r\n          epochs=int(params[\"epochs\"])) \r\n   \r\n    return history, model  \r\n```\r\n- Description of extra variables in the model\r\n```\r\nfrom models import keras_nn_model_multi_talos\r\nh = ta.Scan(X_train, Y_train, x_val=X_test, y_val=Y_test, params=p, dataset_name=\"test\", experiment_no=\"1\",\r\n            model=keras_nn_model_multi_talos, grid_downsample=0.1,talos_log_name=\"talos.log\", last_epoch_value=True,\r\n             experimental_functional_support=True, reduction_method=\"spear\", reduction_metric=\"val_loss\")\r\n```\r\nYou can provide the code in pastebin / gist or any other format you like. \r\n\r\n-------------------------------------------------------------------------\r\nRunning the above command, I found when the reducation_method kicked in on the begining of the 50th epoch.\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nAttributeError                            Traceback (most recent call last)\r\n<ipython-input-11-3626f94de312> in <module>()\r\n     15 h = ta.Scan(X_train, Y_train, x_val=X_test, y_val=Y_test, params=p, dataset_name=\"test\", experiment_no=\"1\",\r\n     16             model=keras_nn_model_multi_talos, grid_downsample=0.1,talos_log_name=\"talos.log\", last_epoch_value=True,\r\n---> 17              experimental_functional_support=True, reduction_method=\"spear\", reduction_metric=\"val_loss\")\r\n\r\n~/anaconda3/envs/tfgpu-keras/lib/python3.6/site-packages/talos/scan/Scan.py in __init__(self, x, y, params, dataset_name, experiment_no, model, x_val, y_val, val_split, shuffle, search_method, reduction_method, reduction_interval, reduction_window, grid_downsample, reduction_threshold, reduction_metric, reduce_loss, round_limit, talos_log_name, debug, seed, clear_tf_session, disable_progress_bar, experimental_functional_support, last_epoch_value)\r\n    145         # input parameters section ends\r\n    146 \r\n--> 147         self._null = self.runtime()\r\n    148 \r\n    149     def runtime(self):\r\n\r\n~/anaconda3/envs/tfgpu-keras/lib/python3.6/site-packages/talos/scan/Scan.py in runtime(self)\r\n    150 \r\n    151         self = scan_prepare(self)\r\n--> 152         self = scan_run(self)\r\n\r\n~/anaconda3/envs/tfgpu-keras/lib/python3.6/site-packages/talos/scan/scan_run.py in scan_run(self)\r\n     27                      disable=self.disable_progress_bar)\r\n     28     while len(self.param_log) != 0:\r\n---> 29         self = rounds_run(self)\r\n     30         self.pbar.update(1)\r\n     31     self.pbar.close()\r\n\r\n~/anaconda3/envs/tfgpu-keras/lib/python3.6/site-packages/talos/scan/scan_run.py in rounds_run(self)\r\n     68         if (self.round_counter + 1) % self.reduction_interval == 0:\r\n     69             len_before_reduce = len(self.param_log)\r\n---> 70             self = reduce_run(self)\r\n     71             total_reduced = len_before_reduce - len(self.param_log)\r\n     72             # update the progress bar\r\n\r\n~/anaconda3/envs/tfgpu-keras/lib/python3.6/site-packages/talos/reducers/reduce_run.py in reduce_run(self)\r\n     11         self = correlation(self)\r\n     12 \r\n---> 13     if self._reduce_keys is None:\r\n     14         return self\r\n     15     else:\r\n\r\nAttributeError: 'Scan' object has no attribute '_reduce_keys'\r\n```","closed_by":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/autonomio/talos/issues/83/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/autonomio/talos/issues/83/timeline","performed_via_github_app":null,"state_reason":"completed"}