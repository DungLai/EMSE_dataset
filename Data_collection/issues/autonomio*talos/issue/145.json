{"url":"https://api.github.com/repos/autonomio/talos/issues/145","repository_url":"https://api.github.com/repos/autonomio/talos","labels_url":"https://api.github.com/repos/autonomio/talos/issues/145/labels{/name}","comments_url":"https://api.github.com/repos/autonomio/talos/issues/145/comments","events_url":"https://api.github.com/repos/autonomio/talos/issues/145/events","html_url":"https://github.com/autonomio/talos/issues/145","id":384780079,"node_id":"MDU6SXNzdWUzODQ3ODAwNzk=","number":145,"title":"How to pass a dict of data?","user":{"login":"frederikfaye","id":45294294,"node_id":"MDQ6VXNlcjQ1Mjk0Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/45294294?v=4","gravatar_id":"","url":"https://api.github.com/users/frederikfaye","html_url":"https://github.com/frederikfaye","followers_url":"https://api.github.com/users/frederikfaye/followers","following_url":"https://api.github.com/users/frederikfaye/following{/other_user}","gists_url":"https://api.github.com/users/frederikfaye/gists{/gist_id}","starred_url":"https://api.github.com/users/frederikfaye/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/frederikfaye/subscriptions","organizations_url":"https://api.github.com/users/frederikfaye/orgs","repos_url":"https://api.github.com/users/frederikfaye/repos","events_url":"https://api.github.com/users/frederikfaye/events{/privacy}","received_events_url":"https://api.github.com/users/frederikfaye/received_events","type":"User","site_admin":false},"labels":[{"id":1167739181,"node_id":"MDU6TGFiZWwxMTY3NzM5MTgx","url":"https://api.github.com/repos/autonomio/talos/labels/topic:%20data","name":"topic: data","color":"ffffff","default":false,"description":"Has to do with input or output data"}],"state":"closed","locked":false,"assignee":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"assignees":[{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/autonomio/talos/milestones/2","html_url":"https://github.com/autonomio/talos/milestone/2","labels_url":"https://api.github.com/repos/autonomio/talos/milestones/2/labels","id":3943452,"node_id":"MDk6TWlsZXN0b25lMzk0MzQ1Mg==","number":2,"title":"v0.4.7","description":null,"creator":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"open_issues":0,"closed_issues":4,"state":"closed","created_at":"2019-01-05T09:42:30Z","updated_at":"2019-07-28T18:39:09Z","due_on":null,"closed_at":"2019-07-28T18:39:09Z"},"comments":8,"created_at":"2018-11-27T12:50:24Z","updated_at":"2019-02-12T12:31:32Z","closed_at":"2019-01-29T13:25:48Z","author_association":"NONE","active_lock_reason":null,"body":"I have collected all my data in a `dict` called `data`. This is convenient for me since my model takes multiple inputs, let's call them `x_0, x_1`. I can access these numpy arrays as for instance `data['val']['x_0']` for my validation data of `x_0`, or `data['test']['y']` for my test data of targets. \r\n\r\nFurthermore (this shouldn't matter, but let me mention it, so that it is hopefully less confusing), inside the model creation function passed to Talos, I have defined another `dict` called `hp`, which collects all hyperparameters used by my Keras model. This is *not* used as the `params` of the Talos API. \r\n\r\nTo explain what I want to do, let me show a simplified example of what my standard (non-Talos) Keras script does:\r\n\r\n```python\r\n# Imports\r\nimport argparse\r\nimport numpy as np\r\nimport keras as ks\r\nimport talos as ta\r\n# and so on ...\r\n\r\nfrom my_functions import load_data, create_model, train\r\n\r\n# Load data\r\ndata = load_data('./my_data.h5')\r\n\r\n# Set hyperparameters\r\nhp = {'epochs'                     : 1000,\r\n      'batch_size'                 : 256,\r\n      'loss'                       : 'logcosh'}\r\n\r\n# Build model\r\nmodel = create_model(input_shapes=[data['train']['x_0'].shape[1:], data['train']['x_1'].shape[1:]], params=hp)\r\n\r\n# Train\r\nhistory, model = train(model=model, data=data, params=hp)https://lichess.org/Hsz1YtxYjdRM\r\n\r\n# Evaluate (predicting on test set and saving plots)\r\nevaluate(model=model, data=data, params=hp, dirs=dirs, verbose=verbose)\r\n```\r\n\r\n\r\nThe following is how I've tried the integration with Talos:\r\n\r\n```python\r\n# Imports\r\nimport argparse\r\nimport numpy as np\r\nimport keras as ks\r\nimport talos as ta\r\n# and so on ...\r\n\r\nfrom my_functions import load_data, create_model, train\r\n\r\n# Load data\r\ndata = load_data('./my_data.h5')\r\n\r\nparams = {'batch_size'                 : [128, 256, 512],\r\n          'loss'                       : ['mae', 'logcosh']}\r\n\r\ndef talos_model(data, params):\r\n    # Set hyperparameters\r\n    hp = {'epochs'                     : 1000,\r\n          'batch_size'                 : params['batch_size'],\r\n          'loss'                       : params['loss']}\r\n\r\n    # Build model\r\n    model = create_model(input_shapes=[data['train']['x_0'].shape[1:], data['train']['x_1'].shape[1:]], params=hp)\r\n\r\n    # Train\r\n    history, model = train(model=model, data=data, params=hp)\r\n\r\n    # Evaluate (predicting on test set and saving plots)\r\n    evaluate(model=model, data=data, params=hp, dirs=dirs, verbose=verbose)\r\n\r\n    return history, model\r\n\r\nh = ta.Scan(x=[ data['train']['x_0'], data['train']['x_1'] ], # I'm unsure what to put here\r\n            y=data['train']['y'],\r\n            model=talos_model,\r\n            params=params)\r\n\r\n```\r\n\r\n\r\n\r\nHowever, the validation split seems to fail because the data is not structured as Talos expects it to. Here is the traceback:\r\n\r\n```python\r\nUsing TensorFlow backend.\r\nTraceback (most recent call last):\r\n  File \"main.py\", line 102, in <module>\r\n    grid_downsample=0.1)\r\n  File \"/home/ffaye/miniconda3/envs/py3/lib/python3.6/site-packages/talos/scan/Scan.py\", line 166, in __init__\r\n    self._null = self.runtime()\r\n  File \"/home/ffaye/miniconda3/envs/py3/lib/python3.6/site-packages/talos/scan/Scan.py\", line 170, in runtime\r\n    self = scan_prepare(self)\r\n  File \"/home/ffaye/miniconda3/envs/py3/lib/python3.6/site-packages/talos/scan/scan_prepare.py\", line 60, in scan_prepare\r\n    self = validation_split(self)\r\n  File \"/home/ffaye/miniconda3/envs/py3/lib/python3.6/site-packages/talos/utils/validation_split.py\", line 18, in validation_split\r\n    random_shuffle(self)\r\n  File \"/home/ffaye/miniconda3/envs/py3/lib/python3.6/site-packages/talos/utils/validation_split.py\", line 42, in random_shuffle\r\n    self.x = self.x[random_index]\r\nTypeError: only integer scalar arrays can be converted to a scalar index\r\n```\r\n\r\n**Questions:** \r\n\r\n1. How can I input my data in a way that makes sense to Talos (preferably without rewriting all my functions)? What are the rules for what can be the arguments for `talos_model`?\r\n2. How can I specify that I would like to use my `[ data['val'][x_0], data['val'][x_1] ], data['val'][y]` as validation data, instead of Talos making the split from my training data?\r\n\r\n**Other remarks** (forgive me if these are known issues, or non-issues):\r\n1. In the [Talos user manual](https://github.com/autonomio/talos/blob/master/docs/index.rst), `reduction_metric` is not explained anywhere.\r\n2. If `grid_downsample` is too low a Python `IndexError` will be thrown. Maybe it would be better to have a Talos error message explaining what is happening?\r\n3. Thank you very much for writing this amazing piece of software! I really hope my issues can be resolved, so that I can start using it! :)\r\n\r\nEDIT: This may be addressed by https://github.com/autonomio/talos/issues/132#issuecomment-440675546, but the thread was a bit cluttered, and I'm not fully sure it applies to my scenario (or indeed if the mentioned local branch with the potential fix is available at the time of writing). ","closed_by":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/autonomio/talos/issues/145/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/autonomio/talos/issues/145/timeline","performed_via_github_app":null,"state_reason":"completed"}