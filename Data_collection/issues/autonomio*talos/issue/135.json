{"url":"https://api.github.com/repos/autonomio/talos/issues/135","repository_url":"https://api.github.com/repos/autonomio/talos","labels_url":"https://api.github.com/repos/autonomio/talos/issues/135/labels{/name}","comments_url":"https://api.github.com/repos/autonomio/talos/issues/135/comments","events_url":"https://api.github.com/repos/autonomio/talos/issues/135/events","html_url":"https://github.com/autonomio/talos/issues/135","id":382081581,"node_id":"MDU6SXNzdWUzODIwODE1ODE=","number":135,"title":"forced conversion of int parameters to floats bug","user":{"login":"renxida","id":10362952,"node_id":"MDQ6VXNlcjEwMzYyOTUy","avatar_url":"https://avatars.githubusercontent.com/u/10362952?v=4","gravatar_id":"","url":"https://api.github.com/users/renxida","html_url":"https://github.com/renxida","followers_url":"https://api.github.com/users/renxida/followers","following_url":"https://api.github.com/users/renxida/following{/other_user}","gists_url":"https://api.github.com/users/renxida/gists{/gist_id}","starred_url":"https://api.github.com/users/renxida/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/renxida/subscriptions","organizations_url":"https://api.github.com/users/renxida/orgs","repos_url":"https://api.github.com/users/renxida/repos","events_url":"https://api.github.com/users/renxida/events{/privacy}","received_events_url":"https://api.github.com/users/renxida/received_events","type":"User","site_admin":false},"labels":[{"id":923120512,"node_id":"MDU6TGFiZWw5MjMxMjA1MTI=","url":"https://api.github.com/repos/autonomio/talos/labels/priority:%20HIGH","name":"priority: HIGH","color":"b60205","default":false,"description":"highest priority"},{"id":994489876,"node_id":"MDU6TGFiZWw5OTQ0ODk4NzY=","url":"https://api.github.com/repos/autonomio/talos/labels/investigation","name":"investigation","color":"d3d3d3","default":false,"description":"gathering information"}],"state":"closed","locked":false,"assignee":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"assignees":[{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false}],"milestone":null,"comments":15,"created_at":"2018-11-19T06:59:51Z","updated_at":"2018-12-07T16:24:55Z","closed_at":"2018-11-21T11:29:14Z","author_association":"NONE","active_lock_reason":null,"body":"I'm trying to do a really general hyperparameter search, and I have a model function `model_ta` that requires that `params['conv_count']` is an integer, not a float64.\r\n\r\nUnder certain circumstances, talos violates this requirement in a way that dosen't make too much sense.\r\n\r\nCompare:\r\n\r\n```\r\nh = ta.Scan(x=ret_train,\r\n            y=Y_train, \r\n            params={\r\n                'dense_count': [1, 2, 3],\r\n                'dense_units': [50, 100, 150, 200],\r\n                'conv_count': [0],\r\n                'l2reg': [1, 100, 1000],\r\n                'epochs':[4],\r\n                'batch_size':[32]\r\n            },\r\n            model=model_ta,\r\n            grid_downsample=0.1,\r\n            functional_model=True)\r\n```\r\n\r\nand\r\n\r\n```\r\nh = ta.Scan(x=ret_train,\r\n            y=Y_train, \r\n            params={\r\n                'dense_count': [1, 2, 3],\r\n                'dense_units': [50, 100, 150, 200],\r\n                'conv_count': [0],\r\n                'l2reg': [1.0, 100, 1000],\r\n                'epochs':[4],\r\n                'batch_size':[32]\r\n            },\r\n            model=model_ta,\r\n            grid_downsample=0.1,\r\n            functional_model=True)\r\n```\r\n\r\nThe previous results in a perfectly normal hyperparameter search, while the latter results in a bunch of errors. See that `1.0` replacing `1` in the second l2reg? That's what's different between these two.\r\n\r\nIf I run the second scan with my model function, I get:\r\n\r\n> TypeError                                 Traceback (most recent call last)\r\n> ~/anaconda3/lib/python3.6/site-packages/talos/scan/scan_round.py in scan_round(self)\r\n>      27     try:\r\n> ---> 28         _hr_out, self.keras_model = ingest_model(self)\r\n>      29     except TypeError as err:\r\n> \r\n> ~/anaconda3/lib/python3.6/site-packages/talos/model/ingest_model.py in ingest_model(self)\r\n>       9                       self.y_val,\r\n> ---> 10                       self.round_params)\r\n> \r\n> <ipython-input-20-2906a347ea7e> in model_ta(x_train, y_train, x_val, y_val, params)\r\n>       3     # replace the hyperparameter inputs with references to params dictionary\r\n> ----> 4     mdl = model(params)\r\n>       5 \r\n> \r\n> <ipython-input-17-8ef4dd736690> in model(params)\r\n>      91     #merged = Concatenate(subnets)\r\n> ---> 92     net = make_net(returns_input, params)\r\n>      93 \r\n> \r\n> <ipython-input-17-8ef4dd736690> in make_net(input_layer, params)\r\n>      29     if params.get('dense_count', 0) !=0:\r\n> ---> 30         for dense_num in range(params['dense_count']):\r\n>      31             newDense = Dense(\r\n> \r\n> TypeError: 'numpy.float64' object cannot be interpreted as an integer\r\n> \r\n> During handling of the above exception, another exception occurred:\r\n> \r\n> TalosReturnError                          Traceback (most recent call last)\r\n> <ipython-input-34-00ac6b8af142> in <module>()\r\n>      11             model=model_ta,\r\n>      12             grid_downsample=0.1,\r\n> ---> 13             functional_model=True)\r\n> \r\n> ~/anaconda3/lib/python3.6/site-packages/talos/scan/Scan.py in __init__(self, x, y, params, model, dataset_name, experiment_no, x_val, y_val, val_split, shuffle, round_limit, grid_downsample, random_method, seed, search_method, reduction_method, reduction_interval, reduction_window, reduction_threshold, reduction_metric, reduce_loss, last_epoch_value, talos_log_name, clear_tf_session, functional_model, disable_progress_bar, print_params, debug)\r\n>     164         # input parameters section ends\r\n>     165 \r\n> --> 166         self._null = self.runtime()\r\n>     167 \r\n>     168     def runtime(self):\r\n> \r\n> ~/anaconda3/lib/python3.6/site-packages/talos/scan/Scan.py in runtime(self)\r\n>     169 \r\n>     170         self = scan_prepare(self)\r\n> --> 171         self = scan_run(self)\r\n> \r\n> ~/anaconda3/lib/python3.6/site-packages/talos/scan/scan_run.py in scan_run(self)\r\n>      19                      disable=self.disable_progress_bar)\r\n>      20     while len(self.param_log) != 0:\r\n> ---> 21         self = scan_round(self)\r\n>      22         self.pbar.update(1)\r\n>      23     self.pbar.close()\r\n> \r\n> ~/anaconda3/lib/python3.6/site-packages/talos/scan/scan_round.py in scan_round(self)\r\n>      31             raise TalosTypeError(\"Activation should be as object and not string in params\")\r\n>      32         else:\r\n> ---> 33             raise TalosReturnError(\"Make sure that input model returns 'out, model' where out is history object from model.fit()\")\r\n>      34 \r\n>      35     # create log and other stats\r\n> \r\n> TalosReturnError: Make sure that input model returns 'out, model' where out is history object from model.fit()\r\n> \r\n\r\nAnd printing all the parameters in my model function shows that all parameters have been converted to float types, which does not happen when I don't have the float-type `l2reg` value.\r\n\r\n\r\n","closed_by":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/autonomio/talos/issues/135/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/autonomio/talos/issues/135/timeline","performed_via_github_app":null,"state_reason":"completed"}