{"url":"https://api.github.com/repos/autonomio/talos/issues/184","repository_url":"https://api.github.com/repos/autonomio/talos","labels_url":"https://api.github.com/repos/autonomio/talos/issues/184/labels{/name}","comments_url":"https://api.github.com/repos/autonomio/talos/issues/184/comments","events_url":"https://api.github.com/repos/autonomio/talos/issues/184/events","html_url":"https://github.com/autonomio/talos/issues/184","id":402700790,"node_id":"MDU6SXNzdWU0MDI3MDA3OTA=","number":184,"title":"Best model selection issue","user":{"login":"FlorianBury","id":30235130,"node_id":"MDQ6VXNlcjMwMjM1MTMw","avatar_url":"https://avatars.githubusercontent.com/u/30235130?v=4","gravatar_id":"","url":"https://api.github.com/users/FlorianBury","html_url":"https://github.com/FlorianBury","followers_url":"https://api.github.com/users/FlorianBury/followers","following_url":"https://api.github.com/users/FlorianBury/following{/other_user}","gists_url":"https://api.github.com/users/FlorianBury/gists{/gist_id}","starred_url":"https://api.github.com/users/FlorianBury/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/FlorianBury/subscriptions","organizations_url":"https://api.github.com/users/FlorianBury/orgs","repos_url":"https://api.github.com/users/FlorianBury/repos","events_url":"https://api.github.com/users/FlorianBury/events{/privacy}","received_events_url":"https://api.github.com/users/FlorianBury/received_events","type":"User","site_admin":false},"labels":[{"id":994489876,"node_id":"MDU6TGFiZWw5OTQ0ODk4NzY=","url":"https://api.github.com/repos/autonomio/talos/labels/investigation","name":"investigation","color":"d3d3d3","default":false,"description":"gathering information"}],"state":"closed","locked":false,"assignee":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"assignees":[{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/autonomio/talos/milestones/3","html_url":"https://github.com/autonomio/talos/milestone/3","labels_url":"https://api.github.com/repos/autonomio/talos/milestones/3/labels","id":4011349,"node_id":"MDk6TWlsZXN0b25lNDAxMTM0OQ==","number":3,"title":"v0.4.8","description":null,"creator":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"open_issues":0,"closed_issues":4,"state":"closed","created_at":"2019-01-29T13:27:10Z","updated_at":"2019-07-28T18:39:06Z","due_on":null,"closed_at":"2019-07-28T18:39:06Z"},"comments":2,"created_at":"2019-01-24T13:13:18Z","updated_at":"2019-02-21T09:09:11Z","closed_at":"2019-02-21T09:09:11Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\r\n\r\nI was started using the Autom8 command which is very nice for adding the evaluation error. Btw, an interesting \"add-on\" could be to request all the models in the scan to be evaluated, not only the n first. For example by using a simple \r\n`\r\nif n == -1:                                                                                                                                                                                         \r\n     n = len(scan_object.data)\r\n`\r\nBut I digress.\r\n\r\nAnyway I found something strange in the talos file .utils/best_model.py [https://github.com/autonomio/talos/blob/25133d69568e06a6faa6e8071ce32c519e719d4e/talos/utils/best_model.py#L13](url) : why is there a -1 at this line ?\r\n\r\nI realized that when I compared the best model according to 'eval_f1score-mean' and the one that is saved in the json file with the Deploy command. As it was never the same I started looking into it. For example I used a few models with just a different number of neurons \r\n```\r\n>>> data.sort_values('eval_f1score_mean', ascending=True)\r\n   Unnamed: 0  round_epochs  val_loss   val_acc      loss   acc   lr  \\\r\n1           1           141  0.000536  0.863636  0.000188  0.99  0.3   \r\n0           0           127  0.000554  0.863636  0.000219  0.97  0.3   \r\n3           3            87  0.000511  0.863636  0.000661  0.95  0.3   \r\n2           2           125  0.004212  0.909091  0.003878  0.97  0.3   \r\n\r\n   first_neuron                         activation  dropout  hidden_layers  \\\r\n1           300  <function relu at 0x7f7b191bf730>        0              3   \r\n0           100  <function relu at 0x7f7b191bf730>        0              3   \r\n3           200  <function relu at 0x7f7b191bf730>        0              3   \r\n2           400  <function relu at 0x7f7b191bf730>        0              3   \r\n\r\n                   output_activation  l2                        optimizer  \\\r\n1  <function relu at 0x7f7b191bf730>   0  <class 'keras.optimizers.Adam'>   \r\n0  <function relu at 0x7f7b191bf730>   0  <class 'keras.optimizers.Adam'>   \r\n3  <function relu at 0x7f7b191bf730>   0  <class 'keras.optimizers.Adam'>   \r\n2  <function relu at 0x7f7b191bf730>   0  <class 'keras.optimizers.Adam'>   \r\n\r\n   epochs  batch_size                                    loss_function  \\\r\n1   10000           1  <function mean_squared_error at 0x7f7b19218b70>   \r\n0   10000           1  <function mean_squared_error at 0x7f7b19218b70>   \r\n3   10000           1  <function mean_squared_error at 0x7f7b19218b70>   \r\n2   10000           1  <function mean_squared_error at 0x7f7b19218b70>   \r\n\r\n   eval_f1score_mean  eval_f1score_std  \r\n1           0.000199               0.0  \r\n0           0.000463               0.0  \r\n3           0.000481               0.0  \r\n2           0.004016               0.0  \r\n\r\n```\r\nAnd \r\n```\r\n>>> data.sort_values('eval_f1score_mean', ascending=True).iloc[0].name\r\n1\r\n>>> data.iloc[1]\r\nUnnamed: 0                                                         1\r\nround_epochs                                                     141\r\nval_loss                                                 0.000535567\r\nval_acc                                                     0.863636\r\nloss                                                     0.000188321\r\nacc                                                             0.99\r\nlr                                                               0.3\r\nfirst_neuron                                                     300\r\nactivation                         <function relu at 0x7f7b191bf730>\r\ndropout                                                            0\r\nhidden_layers                                                      3\r\noutput_activation                  <function relu at 0x7f7b191bf730>\r\nl2                                                                 0\r\noptimizer                            <class 'keras.optimizers.Adam'>\r\nepochs                                                         10000\r\nbatch_size                                                         1\r\nloss_function        <function mean_squared_error at 0x7f7b19218b70>\r\neval_f1score_mean                                        0.000198904\r\neval_f1score_std                                                   0\r\nName: 1, dtype: object\r\n\r\n```\r\nWhich is exactly the model I want to save.\r\nThus I don't see why you need to have \r\n```\r\nbest = self.data.sort_values(metric, ascending=asc).iloc[0].name\r\nreturn best - 1\r\n```\r\nBecause it will return the non-optimal model \r\n\r\nI remove the -1 and I get the correct model in the json file. \r\n\r\nFeel free to correct me if I'm wrong, this has been bugging (pun intended) me for some time","closed_by":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/autonomio/talos/issues/184/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/autonomio/talos/issues/184/timeline","performed_via_github_app":null,"state_reason":"completed"}