{"url":"https://api.github.com/repos/autonomio/talos/issues/330","repository_url":"https://api.github.com/repos/autonomio/talos","labels_url":"https://api.github.com/repos/autonomio/talos/issues/330/labels{/name}","comments_url":"https://api.github.com/repos/autonomio/talos/issues/330/comments","events_url":"https://api.github.com/repos/autonomio/talos/issues/330/events","html_url":"https://github.com/autonomio/talos/issues/330","id":458171435,"node_id":"MDU6SXNzdWU0NTgxNzE0MzU=","number":330,"title":"ValueError: Tensor(...) must be from same graph as Tensor(...)","user":{"login":"chstarr","id":14944959,"node_id":"MDQ6VXNlcjE0OTQ0OTU5","avatar_url":"https://avatars.githubusercontent.com/u/14944959?v=4","gravatar_id":"","url":"https://api.github.com/users/chstarr","html_url":"https://github.com/chstarr","followers_url":"https://api.github.com/users/chstarr/followers","following_url":"https://api.github.com/users/chstarr/following{/other_user}","gists_url":"https://api.github.com/users/chstarr/gists{/gist_id}","starred_url":"https://api.github.com/users/chstarr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chstarr/subscriptions","organizations_url":"https://api.github.com/users/chstarr/orgs","repos_url":"https://api.github.com/users/chstarr/repos","events_url":"https://api.github.com/users/chstarr/events{/privacy}","received_events_url":"https://api.github.com/users/chstarr/received_events","type":"User","site_admin":false},"labels":[{"id":1040763409,"node_id":"MDU6TGFiZWwxMDQwNzYzNDA5","url":"https://api.github.com/repos/autonomio/talos/labels/user%20support","name":"user support","color":"59db8b","default":false,"description":"nothing is wrong with Talos"}],"state":"closed","locked":false,"assignee":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"assignees":[{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2019-06-19T18:46:22Z","updated_at":"2019-07-05T07:51:23Z","closed_at":"2019-07-05T07:51:23Z","author_association":"NONE","active_lock_reason":null,"body":"I am using talos to do hyperparameter optimization on a keras CNN that I am using to analyze 1D data. I am running into the error described in the title, and can't figure out how to proceed. Below, I have pasted the code that I think might be relevant to the issue. Please let me know if you can spot the issue. Thank you!\r\n\r\nHere is the model definition: \r\ndef cnnMP(x_train, y_train, x_val, y_val, params):\r\n    # initialize the model\r\n    model = Sequential()\r\n\t\t\r\n    # define the first set of CONV => ACTIVATION => POOL layers\r\n    model.add(Conv1D(params['filters1'], params['kernelSize1'], padding=\"same\", input_shape=(params['nBins'],1)))\r\n    model.add(Activation(params['activation']))\r\n    model.add(MaxPooling1D(pool_size=params['poolSize1'], strides=None))\r\n\r\n    # define the second set of CONV => ACTIVATION => POOL layers\r\n    model.add(Conv1D(params['filters2'], params['kernelSize2'], padding=\"same\"))\r\n    model.add(Activation(params['activation']))\r\n    model.add(MaxPooling1D(pool_size=params['poolSize2'], strides=None))\r\n    \r\n    # define the first FC => ACTIVATION layers\r\n    model.add(Flatten())\r\n    model.add(Dense(params['dimFC1']))\r\n    model.add(Activation(params['activation']))\r\n    \r\n    # define the second FC layer\r\n    model.add(Dense(params['nClasses']))\r\n    \r\n    # lastly, define the soft-max classifier\r\n    model.add(Activation(\"softmax\"))\r\n    \r\n    model.compile(loss=params['loss'], optimizer=params['opt'], metrics=[\"accuracy\"])    \r\n    \r\n    # train model \r\n    out = model.fit(x_train, y_train, batch_size=params['batchSize'], epochs=params['epochs'], verbose=params['verbose'],\r\n                    validation_data=[x_val,y_val])\r\n    \r\n    # return the constructed network architecture\r\n    return out, model\r\n\r\nHere is where I set up the hyperparameter scan (just trying to look at batch size for now):\r\np = {\r\n        'nBins': [512],\r\n        'nClasses': [2],\r\n        'batchSize': [32, 64, 128],\r\n        'epochs': [50],\r\n        'activation': ['relu'],\r\n        'filters1': [50],\r\n        'kernelSize1': [5],\r\n        'poolSize1': [2],\r\n        'filters2': [20],\r\n        'kernelSize2': [5],\r\n        'poolSize2': [2],\r\n        'dimFC1': [500],\r\n        'loss': [\"categorical_crossentropy\"],\r\n        'opt': [SGD(lr=0.01)],\r\n        'verbose': [0]\r\n        }\r\n\r\nt = ta.Scan(np.expand_dims(trainHist2,axis=2), trainLabels, params=p, model=mods.cnnMP)\r\n\r\nI needed to use the np.expand(...) function to get my data to pass through keras. By the way, I did confirm that this model works well with keras on its own. The one difference is that I have to remove the [ ] brackets from the parameter list when passing into model.fit() because this function requires actual parameters, not iterable lists. \r\n\r\nFinally, here is the error I get when running ta.Scan(...):\r\n\r\n0%|          | 0/3 [00:00<?, ?it/s]\r\n\r\n\r\n\r\n 33%|███▎      | 1/3 [00:03<00:07,  3.50s/it]Traceback (most recent call last):\r\n\r\n  File \"<ipython-input-24-9082a13a0241>\", line 1, in <module>\r\n    runfile('C:/Users/cstarr/Documents/GitHub/MP_nnDetector/cnnMP_optimHP.py', wdir='C:/Users/cstarr/Documents/GitHub/MP_nnDetector')\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\spyder_kernels\\customize\\spydercustomize.py\", line 786, in runfile\r\n    execfile(filename, namespace)\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\spyder_kernels\\customize\\spydercustomize.py\", line 110, in execfile\r\n    exec(compile(f.read(), filename, 'exec'), namespace)\r\n\r\n  File \"C:/Users/cstarr/Documents/GitHub/MP_nnDetector/cnnMP_optimHP.py\", line 122, in <module>\r\n    t = ta.Scan(np.expand_dims(trainHist2,axis=2), trainLabels, params=p, model=mods.cnnMP)\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\talos\\scan\\Scan.py\", line 170, in __init__\r\n    self._null = self.runtime()\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\talos\\scan\\Scan.py\", line 175, in runtime\r\n    self = scan_run(self)\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\talos\\scan\\scan_run.py\", line 18, in scan_run\r\n    self = scan_round(self)\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\talos\\scan\\scan_round.py\", line 32, in scan_round\r\n    _hr_out, self.keras_model = ingest_model(self)\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\talos\\model\\ingest_model.py\", line 10, in ingest_model\r\n    self.round_params)\r\n\r\n  File \"C:\\Users\\cstarr\\Documents\\GitHub\\MP_nnDetector\\modelDefs.py\", line 38, in cnnMP\r\n    validation_data=[x_val,y_val])\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\keras\\engine\\training.py\", line 1010, in fit\r\n    self._make_train_function()\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\keras\\engine\\training.py\", line 509, in _make_train_function\r\n    loss=self.total_loss)\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\keras\\legacy\\interfaces.py\", line 91, in wrapper\r\n    return func(*args, **kwargs)\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\keras\\optimizers.py\", line 196, in get_updates\r\n    v = self.momentum * m - lr * g  # velocity\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\tensorflow\\python\\ops\\variables.py\", line 935, in _run_op\r\n    return tensor_oper(a.value(), *args, **kwargs)\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 810, in binary_op_wrapper\r\n    with ops.name_scope(None, op_name, [x, y]) as name:\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 6083, in __enter__\r\n    g = _get_graph_from_inputs(self._values)\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 5713, in _get_graph_from_inputs\r\n    _assert_same_graph(original_graph_element, graph_element)\r\n\r\n  File \"C:\\Users\\cstarr\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 5649, in _assert_same_graph\r\n    original_item))\r\n\r\nValueError: Tensor(\"training/SGD/Variable:0\", shape=(5, 1, 50), dtype=float32_ref) must be from the same graph as Tensor(\"SGD_1/momentum/read:0\", shape=(), dtype=float32).","closed_by":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/autonomio/talos/issues/330/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/autonomio/talos/issues/330/timeline","performed_via_github_app":null,"state_reason":"completed"}