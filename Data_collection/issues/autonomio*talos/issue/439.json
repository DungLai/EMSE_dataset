{"url":"https://api.github.com/repos/autonomio/talos/issues/439","repository_url":"https://api.github.com/repos/autonomio/talos","labels_url":"https://api.github.com/repos/autonomio/talos/issues/439/labels{/name}","comments_url":"https://api.github.com/repos/autonomio/talos/issues/439/comments","events_url":"https://api.github.com/repos/autonomio/talos/issues/439/events","html_url":"https://github.com/autonomio/talos/issues/439","id":536191172,"node_id":"MDU6SXNzdWU1MzYxOTExNzI=","number":439,"title":"The order of the output CSV seems to be wrong","user":{"login":"hep-beginner","id":58722092,"node_id":"MDQ6VXNlcjU4NzIyMDky","avatar_url":"https://avatars.githubusercontent.com/u/58722092?v=4","gravatar_id":"","url":"https://api.github.com/users/hep-beginner","html_url":"https://github.com/hep-beginner","followers_url":"https://api.github.com/users/hep-beginner/followers","following_url":"https://api.github.com/users/hep-beginner/following{/other_user}","gists_url":"https://api.github.com/users/hep-beginner/gists{/gist_id}","starred_url":"https://api.github.com/users/hep-beginner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hep-beginner/subscriptions","organizations_url":"https://api.github.com/users/hep-beginner/orgs","repos_url":"https://api.github.com/users/hep-beginner/repos","events_url":"https://api.github.com/users/hep-beginner/events{/privacy}","received_events_url":"https://api.github.com/users/hep-beginner/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-12-11T07:26:57Z","updated_at":"2020-04-07T12:29:14Z","closed_at":"2019-12-20T09:28:50Z","author_association":"NONE","active_lock_reason":null,"body":"Hello, I would like to report a issue I found with the talos package output of the CSV with my current solution.\r\nMy python version is python 3.5.2 (default, Oct 8 2019, 13:06:37) on the WSL and the keras is together with TF2.0 in which the model itself works. My ```talos.__version__``` prints '0.6.3' and it is installed via pip.\r\nI ran the code converted from the example:\r\n```\r\nimport tensorflow as tf\r\nfrom tensorflow import keras\r\nimport talos\r\n\r\nx, y = talos.templates.datasets.iris()\r\ntrain_num = int(len(x)*0.8)\r\ntrain_fea = x[:train_num]\r\ntrain_label = y[:train_num]\r\nval_fea = x[train_num:]\r\nval_label = y[train_num:]\r\n\r\ndef iris_model(x_train, y_train, x_val, y_val, params):\r\n    model = tf.keras.models.Sequential()                            \r\n    model.add(tf.keras.layers.Dense(params['first_neuron'], input_dim=x_train.shape[1], activation='relu'))\r\n    \r\n    model.add(tf.keras.layers.Dropout(params['dropout']))\r\n    model.add(tf.keras.layers.Dense(y_train.shape[1], activation=params['last_activation']))\r\n\r\n    model.compile(optimizer=params['optimizer'](lr=lr_normalizer(params['lr'], params['optimizer'])), loss=params['loss'],\r\n                  metrics=['acc'])\r\n\r\n    out = model.fit(x_train, y_train,\r\n                    batch_size=params['batch_size'],\r\n                    epochs=params['epochs'],\r\n                    verbose=0,\r\n                    validation_data=[x_val, y_val])\r\n    \r\n    return out, model\r\n\r\nfrom talos.utils import lr_normalizer\r\nfrom tensorflow.keras.optimizers import Adam, Nadam\r\nfrom tensorflow.keras.activations import softmax\r\nfrom tensorflow.keras.losses import categorical_crossentropy, logcosh\r\n\r\np = {\r\n     'lr': (0.1, 10, 10),\r\n     'first_neuron':[4, 8, 16, 32, 64, 128],\r\n     'batch_size': [2, 3, 4],\r\n     'epochs': [200],\r\n     'dropout': (0, 0.40, 10),\r\n     'optimizer': [Adam, Nadam],\r\n     'loss': ['categorical_crossentropy'],\r\n     'last_activation': ['softmax'],\r\n     'weight_regulizer': [None]\r\n     }\r\n\r\n\r\nscan_object = talos.Scan(x=train_fea,\r\n                         y=train_label,\r\n                         x_val=val_fea,\r\n                         y_val=val_label,\r\n                         params=p,\r\n                         model=iris_model,\r\n                         fraction_limit=.001,\r\n                         experiment_name='iris',\r\n                         print_params=True)\r\n\r\nscan_object.details\r\n```\r\nThe output CSV looks like\r\n\r\nround_epochs | loss | val_loss | acc | val_acc | batch_size | dropout | epochs | first_neuron | last_activation | loss | lr | optimizer | weight_regulizer\r\n-- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | --\r\n200 | 1.916683 | 2.028089 | 0.35 | 0.266667 | 7.03 | categorical_crossentropy | <class 'tensorflow.python.keras.optimizer_v2.nadam.Nadam'> | 200 | None | 32 | softmax | 0.28 | 3\r\n200 | 3.511631 | 1.842899 | 0.291667 | 0.266667 | 6.04 | categorical_crossentropy | <class 'tensorflow.python.keras.optimizer_v2.adam.Adam'> | 200 | None | 16 | softmax | 0.04 | 2\r\n200 | 1.131929 | 1.112004 | 0.308333 | 0.266667 | 0.1 | categorical_crossentropy | <class 'tensorflow.python.keras.optimizer_v2.adam.Adam'> | 200 | None | 16 | softmax | 0.36 | 2\r\n\r\nfor an example. During differenc trials, the titles always keep the same and the values of the parameters part can go wrong in arbitrary orders.\r\nAfter I investigate the code, I have found that in the **talos/logging/results.py L21**, the looping takes the key of **self.round_params** and this is a dictionary defined in **talos/parameters/ParamSpace.py L187**. Changing the looping item into the sorted fixed order list object **self._param_dict_keys** can solve the problem. \r\nAccording to some brief searching, it seems keep the default order of dictionary is a feature added in python 3.6 and I tested in my python 3.5.2 that it was really the case that the dictionary entries order is not fixed to the default. I hope this change do not cause any potential risks to the packages.\r\nThanks a lot.","closed_by":{"login":"mikkokotila","id":7943188,"node_id":"MDQ6VXNlcjc5NDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7943188?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkokotila","html_url":"https://github.com/mikkokotila","followers_url":"https://api.github.com/users/mikkokotila/followers","following_url":"https://api.github.com/users/mikkokotila/following{/other_user}","gists_url":"https://api.github.com/users/mikkokotila/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkokotila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkokotila/subscriptions","organizations_url":"https://api.github.com/users/mikkokotila/orgs","repos_url":"https://api.github.com/users/mikkokotila/repos","events_url":"https://api.github.com/users/mikkokotila/events{/privacy}","received_events_url":"https://api.github.com/users/mikkokotila/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/autonomio/talos/issues/439/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/autonomio/talos/issues/439/timeline","performed_via_github_app":null,"state_reason":"completed"}