[{"url":"https://api.github.com/repos/waspinator/pycococreator/issues/comments/543811554","html_url":"https://github.com/waspinator/pycococreator/issues/26#issuecomment-543811554","issue_url":"https://api.github.com/repos/waspinator/pycococreator/issues/26","id":543811554,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MzgxMTU1NA==","user":{"login":"Mahi-Mai","id":17129394,"node_id":"MDQ6VXNlcjE3MTI5Mzk0","avatar_url":"https://avatars.githubusercontent.com/u/17129394?v=4","gravatar_id":"","url":"https://api.github.com/users/Mahi-Mai","html_url":"https://github.com/Mahi-Mai","followers_url":"https://api.github.com/users/Mahi-Mai/followers","following_url":"https://api.github.com/users/Mahi-Mai/following{/other_user}","gists_url":"https://api.github.com/users/Mahi-Mai/gists{/gist_id}","starred_url":"https://api.github.com/users/Mahi-Mai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mahi-Mai/subscriptions","organizations_url":"https://api.github.com/users/Mahi-Mai/orgs","repos_url":"https://api.github.com/users/Mahi-Mai/repos","events_url":"https://api.github.com/users/Mahi-Mai/events{/privacy}","received_events_url":"https://api.github.com/users/Mahi-Mai/received_events","type":"User","site_admin":false},"created_at":"2019-10-18T16:03:18Z","updated_at":"2019-10-18T16:05:33Z","author_association":"NONE","body":"So to implement my solution, I used a function for listing files in a directory, and I wrote a small function for stripping the annotation filename:\r\n```\r\ndef strip_annotation_filename(file):\r\n    # Capture filename without extension\r\n    annot_filename = file.split('/')[-1][:-4]\r\n\r\n    # Capture words to strip\r\n    words_to_strip = annot_filename.split('_')[-2:]  # in our case we'll get ['mask', '1']\r\n\r\n    # Get number of characters\r\n    char_sum = 2  # We still need to add 2 to account for the underscore before and after 'mask'.\r\n    for word in words_to_strip:\r\n        char_sum += len(word)\r\n\r\n    # Use the sum to index out the part of the filename we want to compare\r\n    annotation_filename_match = annot_filename[:-char_sum]\r\n\r\n    return annotation_filename_match\r\n```\r\n\r\nThis results in my new base code looking like this:\r\n```\r\nINFO = {\r\n    \"description\": \"Corn cobs on conveyor belt.\",\r\n    \"url\": \"https://github.com/waspinator/pycococreator\",\r\n    \"version\": \"0.1.0\",\r\n    \"year\": 2019,\r\n    \"contributor\": \"Leanne Canessa\",\r\n    \"date_created\": datetime.datetime.utcnow().isoformat(' ')\r\n}\r\n\r\nLICENSES = [\r\n    {\r\n        \"id\": 1,\r\n        \"name\": \"PROPRIETARY\",\r\n        \"url\": \"PROPRIETARY\"\r\n    }\r\n]\r\n\r\nCATEGORIES = [\r\n    {\r\n        'id': 1,\r\n        'name': 'mask',\r\n        'supercategory': 'vegetable',\r\n    }\r\n]\r\n\r\ncoco_output = {\r\n    \"info\": INFO,\r\n    \"licenses\": LICENSES,\r\n    \"categories\": CATEGORIES,\r\n    \"images\": [],\r\n    \"annotations\": []\r\n}\r\n\r\nimage_id = 1\r\nsegmentation_id = 1\r\n\r\nimage_files = list_files('...validation/cob_detector2019')\r\nannotation_files = list_files('...validation/annotations')\r\n\r\n# go through each image\r\nfor image_filename in image_files:\r\n    image = Image.open(image_filename)\r\n    image_info = pycococreatortools.create_image_info(image_id, os.path.basename(image_filename), image.size)\r\n\r\n    coco_output[\"images\"].append(image_info)\r\n\r\n    # gather each associated annotation\r\n    image_basename = image_filename.split('/')[-1][:-4]  # grab image filename without extension\r\n    for annotation_filename in annotation_files:\r\n        # grab annotation filename without category, ID descriptors, and extension\r\n        annotation_basename = strip_annotation_filename(annotation_filename)\r\n        \r\n        # if they match, gather info\r\n        if annotation_basename == image_basename:\r\n            class_id = [x['id'] for x in CATEGORIES if x['name'] in annotation_filename][0]\r\n            category_info = {'id': class_id, 'is_crowd': 'crowd' in image_filename}\r\n            binary_mask = np.asarray(Image.open(annotation_filename)\r\n                .convert('1')).astype(np.uint8)\r\n\r\n            annotation_info = pycococreatortools.create_annotation_info(\r\n                segmentation_id, image_id, category_info, binary_mask,\r\n                image.size, tolerance=2)\r\n\r\n            if annotation_info is not None:\r\n                coco_output[\"annotations\"].append(annotation_info)\r\n\r\n            segmentation_id = segmentation_id + 1\r\n\r\n    image_id = image_id + 1\r\n\r\nwith open('.../validation/instances_validation2019.json', 'w') as output_json_file:\r\n    json.dump(coco_output, output_json_file)\r\n    \r\nprint('Done!')\r\n```\r\n\r\nHowever, now I have a new problem that may be related.  When I look at my resulting json files, I have fewer annotations than I do images, despite confirming that each image has a matching annotation file (see attachment).\r\n\r\n![s](https://user-images.githubusercontent.com/17129394/67109845-f8055c00-f196-11e9-8da2-a4611254e3c9.png)\r\n\r\n@waspinator Do you think this is a naming/file matching thing again?  Or is this an expected behavior I'm not quite getting?\r\n\r\nThanks!","reactions":{"url":"https://api.github.com/repos/waspinator/pycococreator/issues/comments/543811554/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Mahi-Mai","id":17129394,"node_id":"MDQ6VXNlcjE3MTI5Mzk0","avatar_url":"https://avatars.githubusercontent.com/u/17129394?v=4","gravatar_id":"","url":"https://api.github.com/users/Mahi-Mai","html_url":"https://github.com/Mahi-Mai","followers_url":"https://api.github.com/users/Mahi-Mai/followers","following_url":"https://api.github.com/users/Mahi-Mai/following{/other_user}","gists_url":"https://api.github.com/users/Mahi-Mai/gists{/gist_id}","starred_url":"https://api.github.com/users/Mahi-Mai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mahi-Mai/subscriptions","organizations_url":"https://api.github.com/users/Mahi-Mai/orgs","repos_url":"https://api.github.com/users/Mahi-Mai/repos","events_url":"https://api.github.com/users/Mahi-Mai/events{/privacy}","received_events_url":"https://api.github.com/users/Mahi-Mai/received_events","type":"User","site_admin":false}},{"id":2725412182,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjcyNTQxMjE4Mg==","url":"https://api.github.com/repos/waspinator/pycococreator/issues/events/2725412182","actor":{"login":"waspinator","id":100416,"node_id":"MDQ6VXNlcjEwMDQxNg==","avatar_url":"https://avatars.githubusercontent.com/u/100416?v=4","gravatar_id":"","url":"https://api.github.com/users/waspinator","html_url":"https://github.com/waspinator","followers_url":"https://api.github.com/users/waspinator/followers","following_url":"https://api.github.com/users/waspinator/following{/other_user}","gists_url":"https://api.github.com/users/waspinator/gists{/gist_id}","starred_url":"https://api.github.com/users/waspinator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/waspinator/subscriptions","organizations_url":"https://api.github.com/users/waspinator/orgs","repos_url":"https://api.github.com/users/waspinator/repos","events_url":"https://api.github.com/users/waspinator/events{/privacy}","received_events_url":"https://api.github.com/users/waspinator/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-10-18T16:03:19Z","performed_via_github_app":null},{"id":2725412186,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI3MjU0MTIxODY=","url":"https://api.github.com/repos/waspinator/pycococreator/issues/events/2725412186","actor":{"login":"waspinator","id":100416,"node_id":"MDQ6VXNlcjEwMDQxNg==","avatar_url":"https://avatars.githubusercontent.com/u/100416?v=4","gravatar_id":"","url":"https://api.github.com/users/waspinator","html_url":"https://github.com/waspinator","followers_url":"https://api.github.com/users/waspinator/followers","following_url":"https://api.github.com/users/waspinator/following{/other_user}","gists_url":"https://api.github.com/users/waspinator/gists{/gist_id}","starred_url":"https://api.github.com/users/waspinator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/waspinator/subscriptions","organizations_url":"https://api.github.com/users/waspinator/orgs","repos_url":"https://api.github.com/users/waspinator/repos","events_url":"https://api.github.com/users/waspinator/events{/privacy}","received_events_url":"https://api.github.com/users/waspinator/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-10-18T16:03:19Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/waspinator/pycococreator/issues/comments/652370191","html_url":"https://github.com/waspinator/pycococreator/issues/26#issuecomment-652370191","issue_url":"https://api.github.com/repos/waspinator/pycococreator/issues/26","id":652370191,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjM3MDE5MQ==","user":{"login":"anmspro","id":33668152,"node_id":"MDQ6VXNlcjMzNjY4MTUy","avatar_url":"https://avatars.githubusercontent.com/u/33668152?v=4","gravatar_id":"","url":"https://api.github.com/users/anmspro","html_url":"https://github.com/anmspro","followers_url":"https://api.github.com/users/anmspro/followers","following_url":"https://api.github.com/users/anmspro/following{/other_user}","gists_url":"https://api.github.com/users/anmspro/gists{/gist_id}","starred_url":"https://api.github.com/users/anmspro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anmspro/subscriptions","organizations_url":"https://api.github.com/users/anmspro/orgs","repos_url":"https://api.github.com/users/anmspro/repos","events_url":"https://api.github.com/users/anmspro/events{/privacy}","received_events_url":"https://api.github.com/users/anmspro/received_events","type":"User","site_admin":false},"created_at":"2020-07-01T11:45:01Z","updated_at":"2020-07-01T11:45:01Z","author_association":"NONE","body":"@Mahi-Mai, Hey, can you please take a look at this issue - https://github.com/waspinator/pycococreator/issues/34\r\nI need a little help.","reactions":{"url":"https://api.github.com/repos/waspinator/pycococreator/issues/comments/652370191/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"anmspro","id":33668152,"node_id":"MDQ6VXNlcjMzNjY4MTUy","avatar_url":"https://avatars.githubusercontent.com/u/33668152?v=4","gravatar_id":"","url":"https://api.github.com/users/anmspro","html_url":"https://github.com/anmspro","followers_url":"https://api.github.com/users/anmspro/followers","following_url":"https://api.github.com/users/anmspro/following{/other_user}","gists_url":"https://api.github.com/users/anmspro/gists{/gist_id}","starred_url":"https://api.github.com/users/anmspro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anmspro/subscriptions","organizations_url":"https://api.github.com/users/anmspro/orgs","repos_url":"https://api.github.com/users/anmspro/repos","events_url":"https://api.github.com/users/anmspro/events{/privacy}","received_events_url":"https://api.github.com/users/anmspro/received_events","type":"User","site_admin":false}},{"id":3502068628,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzUwMjA2ODYyOA==","url":"https://api.github.com/repos/waspinator/pycococreator/issues/events/3502068628","actor":{"login":"Mahi-Mai","id":17129394,"node_id":"MDQ6VXNlcjE3MTI5Mzk0","avatar_url":"https://avatars.githubusercontent.com/u/17129394?v=4","gravatar_id":"","url":"https://api.github.com/users/Mahi-Mai","html_url":"https://github.com/Mahi-Mai","followers_url":"https://api.github.com/users/Mahi-Mai/followers","following_url":"https://api.github.com/users/Mahi-Mai/following{/other_user}","gists_url":"https://api.github.com/users/Mahi-Mai/gists{/gist_id}","starred_url":"https://api.github.com/users/Mahi-Mai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mahi-Mai/subscriptions","organizations_url":"https://api.github.com/users/Mahi-Mai/orgs","repos_url":"https://api.github.com/users/Mahi-Mai/repos","events_url":"https://api.github.com/users/Mahi-Mai/events{/privacy}","received_events_url":"https://api.github.com/users/Mahi-Mai/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-07-01T11:45:02Z","performed_via_github_app":null},{"id":3502068630,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM1MDIwNjg2MzA=","url":"https://api.github.com/repos/waspinator/pycococreator/issues/events/3502068630","actor":{"login":"Mahi-Mai","id":17129394,"node_id":"MDQ6VXNlcjE3MTI5Mzk0","avatar_url":"https://avatars.githubusercontent.com/u/17129394?v=4","gravatar_id":"","url":"https://api.github.com/users/Mahi-Mai","html_url":"https://github.com/Mahi-Mai","followers_url":"https://api.github.com/users/Mahi-Mai/followers","following_url":"https://api.github.com/users/Mahi-Mai/following{/other_user}","gists_url":"https://api.github.com/users/Mahi-Mai/gists{/gist_id}","starred_url":"https://api.github.com/users/Mahi-Mai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mahi-Mai/subscriptions","organizations_url":"https://api.github.com/users/Mahi-Mai/orgs","repos_url":"https://api.github.com/users/Mahi-Mai/repos","events_url":"https://api.github.com/users/Mahi-Mai/events{/privacy}","received_events_url":"https://api.github.com/users/Mahi-Mai/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-07-01T11:45:02Z","performed_via_github_app":null}]