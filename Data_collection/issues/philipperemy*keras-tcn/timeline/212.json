[{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/comments/890113357","html_url":"https://github.com/philipperemy/keras-tcn/issues/212#issuecomment-890113357","issue_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/212","id":890113357,"node_id":"IC_kwDOB4a3hs41Dg1N","user":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false},"created_at":"2021-07-30T19:40:34Z","updated_at":"2021-07-30T19:40:34Z","author_association":"OWNER","body":"Great question. The TCN is a Temporal Convolutional Network. It's not technically a layer although it inherits from the Keras Layer object. It's closer to a Model. The choice was motivated to be able to easily swap the LSTM and TCN classes for comparison.\r\n\r\nNow, yeah we can add a trainable property. In theory, we have the list of all the layers when we build the TCN layer. So we can just loop over each of them.","reactions":{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/comments/890113357/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/comments/890124059","html_url":"https://github.com/philipperemy/keras-tcn/issues/212#issuecomment-890124059","issue_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/212","id":890124059,"node_id":"IC_kwDOB4a3hs41Djcb","user":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false},"created_at":"2021-07-30T20:02:18Z","updated_at":"2021-07-30T20:02:18Z","author_association":"OWNER","body":"I checked and you can actually just set `.trainable = False` to your TCN layer. All the subsequent layers will be recursively set to trainable=False. They mention about it here:\r\nhttps://keras.io/guides/transfer_learning/\r\nLook for: Recursive setting of the trainable attribute\r\n","reactions":{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/comments/890124059/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/comments/1017242276","html_url":"https://github.com/philipperemy/keras-tcn/issues/212#issuecomment-1017242276","issue_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/212","id":1017242276,"node_id":"IC_kwDOB4a3hs48oeKk","user":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false},"created_at":"2022-01-20T08:46:13Z","updated_at":"2022-01-20T08:46:13Z","author_association":"OWNER","body":"Here is an example.\r\n\r\n- I print the weights before and after training. They are the same for the TCN (I only checked for one block of the TCN).\r\n- The accuracy is stuck at 50%. On this task, you can easily achieve 85%. You can easily check by changing trainable to True.\r\n\r\n\r\n```python\r\n\"\"\"\r\nTrains a TCN on the IMDB sentiment classification task.\r\nOutput after 1 epochs on CPU: ~0.8611\r\nTime per epoch on CPU (Core i7): ~64s.\r\nBased on: https://github.com/keras-team/keras/blob/master/examples/imdb_bidirectional_lstm.py\r\n\"\"\"\r\nimport numpy as np\r\nfrom tensorflow.keras import Sequential\r\nfrom tensorflow.keras.datasets import imdb\r\nfrom tensorflow.keras.layers import Dense, Dropout, Embedding\r\nfrom tensorflow.keras.preprocessing import sequence\r\n\r\nfrom tcn import TCN\r\n\r\nmax_features = 20000\r\n# cut texts after this number of words\r\n# (among top max_features most common words)\r\nmaxlen = 100\r\nbatch_size = 32\r\n\r\nprint('Loading data...')\r\n(x_train, y_train), (x_test, y_test) = imdb.load_data(num_words=max_features)\r\nprint(len(x_train), 'train sequences')\r\nprint(len(x_test), 'test sequences')\r\n\r\nprint('Pad sequences (samples x time)')\r\nx_train = sequence.pad_sequences(x_train, maxlen=maxlen)\r\nx_test = sequence.pad_sequences(x_test, maxlen=maxlen)\r\nprint('x_train shape:', x_train.shape)\r\nprint('x_test shape:', x_test.shape)\r\ny_train = np.array(y_train)\r\ny_test = np.array(y_test)\r\n\r\ntcn2 = TCN(\r\n    nb_filters=64,\r\n    kernel_size=6,\r\n    dilations=[1, 2, 4, 8, 16, 32, 64]\r\n)\r\n\r\ntcn2.trainable = False\r\n\r\nmodel = Sequential()\r\nmodel.add(Embedding(max_features, 128, input_shape=(maxlen,)))\r\nmodel.add(tcn2)\r\nmodel.add(Dropout(0.5))\r\nmodel.add(Dense(1, activation='sigmoid'))\r\n\r\nmodel.summary()\r\n\r\nmodel.compile('adam', 'binary_crossentropy', metrics=['accuracy'])\r\n\r\nprint(tcn2.residual_blocks[0].get_weights()[0])\r\n\r\nprint('Train...')\r\nmodel.fit(\r\n    x_train, y_train,\r\n    batch_size=batch_size,\r\n    validation_data=(x_test, y_test),\r\n    epochs=1\r\n)\r\n\r\nprint(tcn2.residual_blocks[0].get_weights()[0])\r\n```","reactions":{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/comments/1017242276/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false}},{"id":5923098814,"node_id":"CE_lADOB4a3hs44nmutzwAAAAFhC1C-","url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/events/5923098814","actor":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-01-20T08:46:13Z","state_reason":null,"performed_via_github_app":null}]