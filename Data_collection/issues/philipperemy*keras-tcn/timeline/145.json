[{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/comments/640957849","html_url":"https://github.com/philipperemy/keras-tcn/issues/145#issuecomment-640957849","issue_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/145","id":640957849,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MDk1Nzg0OQ==","user":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false},"created_at":"2020-06-09T00:30:36Z","updated_at":"2020-06-09T00:33:39Z","author_association":"OWNER","body":"@bjourne can you run it a bit more than just one epoch?\r\nI guess in terms of comparison you should use nb_stacks=1, nb_filters=128 and a higher kernel_size such as 5 or 7. For dilations you can adjust them to have the same number of parameters as your LSTM. But remember that LSTM have a memory of around 50-100 steps. So make sure your TCN has a receptive field at least equal to this.","reactions":{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/comments/640957849/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false}},{"id":3422521223,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzQyMjUyMTIyMw==","url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/events/3422521223","actor":{"login":"bjourne","id":142475,"node_id":"MDQ6VXNlcjE0MjQ3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/142475?v=4","gravatar_id":"","url":"https://api.github.com/users/bjourne","html_url":"https://github.com/bjourne","followers_url":"https://api.github.com/users/bjourne/followers","following_url":"https://api.github.com/users/bjourne/following{/other_user}","gists_url":"https://api.github.com/users/bjourne/gists{/gist_id}","starred_url":"https://api.github.com/users/bjourne/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bjourne/subscriptions","organizations_url":"https://api.github.com/users/bjourne/orgs","repos_url":"https://api.github.com/users/bjourne/repos","events_url":"https://api.github.com/users/bjourne/events{/privacy}","received_events_url":"https://api.github.com/users/bjourne/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-06-09T00:30:37Z","performed_via_github_app":null},{"id":3422521224,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM0MjI1MjEyMjQ=","url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/events/3422521224","actor":{"login":"bjourne","id":142475,"node_id":"MDQ6VXNlcjE0MjQ3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/142475?v=4","gravatar_id":"","url":"https://api.github.com/users/bjourne","html_url":"https://github.com/bjourne","followers_url":"https://api.github.com/users/bjourne/followers","following_url":"https://api.github.com/users/bjourne/following{/other_user}","gists_url":"https://api.github.com/users/bjourne/gists{/gist_id}","starred_url":"https://api.github.com/users/bjourne/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bjourne/subscriptions","organizations_url":"https://api.github.com/users/bjourne/orgs","repos_url":"https://api.github.com/users/bjourne/repos","events_url":"https://api.github.com/users/bjourne/events{/privacy}","received_events_url":"https://api.github.com/users/bjourne/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-06-09T00:30:37Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/comments/691228305","html_url":"https://github.com/philipperemy/keras-tcn/issues/145#issuecomment-691228305","issue_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/145","id":691228305,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MTIyODMwNQ==","user":{"login":"rjpg","id":22857941,"node_id":"MDQ6VXNlcjIyODU3OTQx","avatar_url":"https://avatars.githubusercontent.com/u/22857941?v=4","gravatar_id":"","url":"https://api.github.com/users/rjpg","html_url":"https://github.com/rjpg","followers_url":"https://api.github.com/users/rjpg/followers","following_url":"https://api.github.com/users/rjpg/following{/other_user}","gists_url":"https://api.github.com/users/rjpg/gists{/gist_id}","starred_url":"https://api.github.com/users/rjpg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjpg/subscriptions","organizations_url":"https://api.github.com/users/rjpg/orgs","repos_url":"https://api.github.com/users/rjpg/repos","events_url":"https://api.github.com/users/rjpg/events{/privacy}","received_events_url":"https://api.github.com/users/rjpg/received_events","type":"User","site_admin":false},"created_at":"2020-09-11T17:44:42Z","updated_at":"2020-09-11T17:44:42Z","author_association":"NONE","body":"Also in my cases studies WaveNet is better ...","reactions":{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/comments/691228305/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rjpg","id":22857941,"node_id":"MDQ6VXNlcjIyODU3OTQx","avatar_url":"https://avatars.githubusercontent.com/u/22857941?v=4","gravatar_id":"","url":"https://api.github.com/users/rjpg","html_url":"https://github.com/rjpg","followers_url":"https://api.github.com/users/rjpg/followers","following_url":"https://api.github.com/users/rjpg/following{/other_user}","gists_url":"https://api.github.com/users/rjpg/gists{/gist_id}","starred_url":"https://api.github.com/users/rjpg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjpg/subscriptions","organizations_url":"https://api.github.com/users/rjpg/orgs","repos_url":"https://api.github.com/users/rjpg/repos","events_url":"https://api.github.com/users/rjpg/events{/privacy}","received_events_url":"https://api.github.com/users/rjpg/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/comments/779691780","html_url":"https://github.com/philipperemy/keras-tcn/issues/145#issuecomment-779691780","issue_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/145","id":779691780,"node_id":"MDEyOklzc3VlQ29tbWVudDc3OTY5MTc4MA==","user":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false},"created_at":"2021-02-16T09:06:27Z","updated_at":"2021-02-16T09:12:57Z","author_association":"OWNER","body":"I am revisiting this issue.\r\n\r\nOn the smaller version of the shakespeare.txt dataset, I could get:\r\n\r\n- TCN: 48.7% accuracy on the test set.\r\n- LSTM: 49.5% accuracy on the test set.\r\n\r\nAlso the speed of the TCN is much faster. I think it took 17s for a LSTM and 26s for a TCN.\r\n\r\nTCN are of course optimized for very long sequences.\r\n\r\nSo the gap observed before is not present anymore.\r\n\r\nHere is the code:\r\n\r\n```python\r\nimport numpy as np\r\nfrom tcn import TCN, tcn_full_summary\r\nfrom tensorflow.keras import Model\r\nfrom tensorflow.keras.layers import Embedding, LSTM, Dense, Input\r\nfrom tensorflow.keras.optimizers import Adam\r\nimport random as python_random\r\nimport tensorflow as tf\r\n\r\nSEQ_LEN = 64\r\ntext = open('shakespeare.txt').read()\r\nch2ix = {ch: i for i, ch in enumerate(sorted(set(text)))}\r\nX = np.array([[ch2ix[ch] for ch in text[i - SEQ_LEN:i]]\r\n              for i in range(SEQ_LEN, len(text))])\r\nY = np.array([ch2ix[text[i]] for i in range(SEQ_LEN, len(text))])\r\n\r\n# mostly the same performance.\r\nuse_lstm = False\r\n\r\n# could reach 48.7%. with:\r\n# nb_filters=64\r\n# dilations=(1, 2, 4, 8, 16, 32),\r\n# kernel_size=2,\r\n# use_skip_connections=True,\r\n# use_layer_norm=True\r\n# lstm could reach 49.5%.\r\n\r\ntcn = TCN(nb_filters=64, dilations=(1, 2, 4, 8, 16, 32), kernel_size=2, use_skip_connections=True, use_layer_norm=True)\r\nprint(tcn.receptive_field)\r\n\r\ni = Input(shape=(SEQ_LEN,))\r\nx = Embedding(len(ch2ix), 32)(i)\r\nx = LSTM(128)(x) if use_lstm else tcn(x)\r\nx = Dense(len(ch2ix), activation='softmax')(x)\r\nm = Model(inputs=[i], outputs=[x])\r\n\r\ntcn_full_summary(m)\r\n\r\nm.compile(\r\n    optimizer=Adam(lr=0.005),\r\n    loss='sparse_categorical_crossentropy',\r\n    metrics=['sparse_categorical_accuracy'])\r\n\r\nnp.random.seed(123)\r\npython_random.seed(123)\r\ntf.random.set_seed(1234)\r\n\r\nm.fit(X, Y, epochs=20, batch_size=32, validation_split=0.2)\r\n```","reactions":{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/comments/779691780/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/comments/779711502","html_url":"https://github.com/philipperemy/keras-tcn/issues/145#issuecomment-779711502","issue_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/145","id":779711502,"node_id":"MDEyOklzc3VlQ29tbWVudDc3OTcxMTUwMg==","user":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false},"created_at":"2021-02-16T09:39:56Z","updated_at":"2021-02-16T09:39:56Z","author_association":"OWNER","body":"I'll close this as the recent PRs have fixed most of the problems described in this PR. The LSTM still outperforms the TCN here (on the shakespeare.txt - 92kb) because the problem is more suitable for LSTM (char[t+1] heavily depends on char[t] and char[t-1] and not much 200 steps behind).","reactions":{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/comments/779711502/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false}},{"id":4335234614,"node_id":"MDExOkNsb3NlZEV2ZW50NDMzNTIzNDYxNA==","url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/events/4335234614","actor":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-02-16T09:39:56Z","state_reason":null,"performed_via_github_app":null}]