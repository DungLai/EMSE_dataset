{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/78","repository_url":"https://api.github.com/repos/philipperemy/keras-tcn","labels_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/78/labels{/name}","comments_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/78/comments","events_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/78/events","html_url":"https://github.com/philipperemy/keras-tcn/issues/78","id":505409108,"node_id":"MDU6SXNzdWU1MDU0MDkxMDg=","number":78,"title":"Loading model h5 files w/ a TCN layer","user":{"login":"connorlbark","id":17440010,"node_id":"MDQ6VXNlcjE3NDQwMDEw","avatar_url":"https://avatars.githubusercontent.com/u/17440010?v=4","gravatar_id":"","url":"https://api.github.com/users/connorlbark","html_url":"https://github.com/connorlbark","followers_url":"https://api.github.com/users/connorlbark/followers","following_url":"https://api.github.com/users/connorlbark/following{/other_user}","gists_url":"https://api.github.com/users/connorlbark/gists{/gist_id}","starred_url":"https://api.github.com/users/connorlbark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/connorlbark/subscriptions","organizations_url":"https://api.github.com/users/connorlbark/orgs","repos_url":"https://api.github.com/users/connorlbark/repos","events_url":"https://api.github.com/users/connorlbark/events{/privacy}","received_events_url":"https://api.github.com/users/connorlbark/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-10-10T17:29:20Z","updated_at":"2020-08-17T05:27:13Z","closed_at":"2019-10-10T17:33:35Z","author_association":"NONE","active_lock_reason":null,"body":"When I am using a TCN model that has been saved to an h5 file, I cannot seem to load it if tcn is imported.\r\n\r\nEverything works as expected w/o importing tcn (minus `tcn.tcn is not loaded`, which makes sense)\r\n```bash\r\n(daemon) 2l4@mac105220:~/Desktop/hfp-tests/backend/ > python\r\nPython 3.7.4 (default, Aug 13 2019, 15:17:50)\r\n[Clang 4.0.1 (tags/RELEASE_401/final)] :: Anaconda, Inc. on darwin\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import tensorflow.keras.models as m\r\n>>> m.load_model('../out.h5')\r\n/Users/2l4/.conda/envs/daemon/lib/python3.7/site-packages/tensorflow_core/python/keras/layers/core.py:901: UserWarning: tcn.tcn is not loaded, but a Lambda layer uses it. It may cause errors.\r\n  , UserWarning)\r\n2019-10-10 13:19:56.423721: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\r\n2019-10-10 13:19:56.435709: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x7fce7683cd90 executing computations on platform Host. Devices:\r\n2019-10-10 13:19:56.435729: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Host, Default Version\r\n<tensorflow.python.keras.engine.training.Model object at 0x1315a4fd0>\r\n```\r\n\r\nHowever, if I import the TCN layer, then try to import, Keras throws an error:\r\n```bash\r\n>>> from tcn import TCN\r\nUsing TensorFlow backend.\r\n>>> m.load_model('../out.h5')\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/Users/2l4/.conda/envs/daemon/lib/python3.7/site-packages/tensorflow_core/python/keras/saving/save.py\", line 146, in load_model\r\n    return hdf5_format.load_model_from_hdf5(filepath, custom_objects, compile)\r\n  File \"/Users/2l4/.conda/envs/daemon/lib/python3.7/site-packages/tensorflow_core/python/keras/saving/hdf5_format.py\", line 168, in load_model_from_hdf5\r\n    custom_objects=custom_objects)\r\n  File \"/Users/2l4/.conda/envs/daemon/lib/python3.7/site-packages/tensorflow_core/python/keras/saving/model_config.py\", line 55, in model_from_config\r\n    return deserialize(config, custom_objects=custom_objects)\r\n  File \"/Users/2l4/.conda/envs/daemon/lib/python3.7/site-packages/tensorflow_core/python/keras/layers/serialization.py\", line 102, in deserialize\r\n    printable_module_name='layer')\r\n  File \"/Users/2l4/.conda/envs/daemon/lib/python3.7/site-packages/tensorflow_core/python/keras/utils/generic_utils.py\", line 191, in deserialize_keras_object\r\n    list(custom_objects.items())))\r\n  File \"/Users/2l4/.conda/envs/daemon/lib/python3.7/site-packages/tensorflow_core/python/keras/engine/network.py\", line 906, in from_config\r\n    config, custom_objects)\r\n  File \"/Users/2l4/.conda/envs/daemon/lib/python3.7/site-packages/tensorflow_core/python/keras/engine/network.py\", line 1842, in reconstruct_from_config\r\n    process_layer(layer_data)\r\n  File \"/Users/2l4/.conda/envs/daemon/lib/python3.7/site-packages/tensorflow_core/python/keras/engine/network.py\", line 1824, in process_layer\r\n    layer = deserialize_layer(layer_data, custom_objects=custom_objects)\r\n  File \"/Users/2l4/.conda/envs/daemon/lib/python3.7/site-packages/tensorflow_core/python/keras/layers/serialization.py\", line 102, in deserialize\r\n    printable_module_name='layer')\r\n  File \"/Users/2l4/.conda/envs/daemon/lib/python3.7/site-packages/tensorflow_core/python/keras/utils/generic_utils.py\", line 191, in deserialize_keras_object\r\n    list(custom_objects.items())))\r\n  File \"/Users/2l4/.conda/envs/daemon/lib/python3.7/site-packages/tensorflow_core/python/keras/layers/core.py\", line 887, in from_config\r\n    return cls(**config)\r\n  File \"/Users/2l4/.conda/envs/daemon/lib/python3.7/site-packages/tensorflow_core/python/keras/layers/core.py\", line 743, in __init__\r\n    super(Lambda, self).__init__(**kwargs)\r\nTypeError: super(type, obj): obj must be an instance or subtype of type\r\n>>>\r\n```\r\n\r\nI can get it all to work fine if I manually change `/Users/2l4/.conda/envs/daemon/lib/python3.7/site-packages/tensorflow_core/python/keras/layers/core.py` to use `super().__init__`, which is (theoretically) functionally equivalent.","closed_by":{"login":"connorlbark","id":17440010,"node_id":"MDQ6VXNlcjE3NDQwMDEw","avatar_url":"https://avatars.githubusercontent.com/u/17440010?v=4","gravatar_id":"","url":"https://api.github.com/users/connorlbark","html_url":"https://github.com/connorlbark","followers_url":"https://api.github.com/users/connorlbark/followers","following_url":"https://api.github.com/users/connorlbark/following{/other_user}","gists_url":"https://api.github.com/users/connorlbark/gists{/gist_id}","starred_url":"https://api.github.com/users/connorlbark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/connorlbark/subscriptions","organizations_url":"https://api.github.com/users/connorlbark/orgs","repos_url":"https://api.github.com/users/connorlbark/repos","events_url":"https://api.github.com/users/connorlbark/events{/privacy}","received_events_url":"https://api.github.com/users/connorlbark/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/78/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/78/timeline","performed_via_github_app":null,"state_reason":"completed"}