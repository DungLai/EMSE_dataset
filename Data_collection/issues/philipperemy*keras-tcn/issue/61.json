{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/61","repository_url":"https://api.github.com/repos/philipperemy/keras-tcn","labels_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/61/labels{/name}","comments_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/61/comments","events_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/61/events","html_url":"https://github.com/philipperemy/keras-tcn/issues/61","id":466343685,"node_id":"MDU6SXNzdWU0NjYzNDM2ODU=","number":61,"title":"Name parameter not used","user":{"login":"beasteers","id":6741720,"node_id":"MDQ6VXNlcjY3NDE3MjA=","avatar_url":"https://avatars.githubusercontent.com/u/6741720?v=4","gravatar_id":"","url":"https://api.github.com/users/beasteers","html_url":"https://github.com/beasteers","followers_url":"https://api.github.com/users/beasteers/followers","following_url":"https://api.github.com/users/beasteers/following{/other_user}","gists_url":"https://api.github.com/users/beasteers/gists{/gist_id}","starred_url":"https://api.github.com/users/beasteers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/beasteers/subscriptions","organizations_url":"https://api.github.com/users/beasteers/orgs","repos_url":"https://api.github.com/users/beasteers/repos","events_url":"https://api.github.com/users/beasteers/events{/privacy}","received_events_url":"https://api.github.com/users/beasteers/received_events","type":"User","site_admin":false},"labels":[{"id":875498553,"node_id":"MDU6TGFiZWw4NzU0OTg1NTM=","url":"https://api.github.com/repos/philipperemy/keras-tcn/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2019-07-10T14:29:54Z","updated_at":"2019-11-29T05:21:46Z","closed_at":"2019-11-29T05:21:46Z","author_association":"NONE","active_lock_reason":null,"body":"The name parameter is currently not being applied to the layer. As a related issue, the current layer implementation dumps all of the model layers into a single flattened list and it's hard to see where one TCN block ends and another begins. I propose that, to solve both of these issues, the TCN layer should inherit from `keras.layers.Layer`\r\n\r\nI patched the layer to implement the desired interface here, but all of this can be factored into the original TCN layer.\r\n\r\n```python\r\nfrom keras.layers import Layer\r\nclass TCN2(Layer):\r\n    def __init__(self, *a, name=None, **kw):\r\n        self.model = TCN(*a, **kw)\r\n        Layer.__init__(self, name=name)\r\n        \r\n    def call(self, x):\r\n        return self.model(x)\r\n    \r\n    def compute_output_shape(self, input_shape):\r\n        return input_shape[:-1] + (self.model.nb_filters,)\r\n```\r\n\r\nHere's a sketch of the changes translated to the original class:\r\n\r\n```python\r\nfrom keras.layers import Layer\r\nclass TCN(Layer):\r\n    # remove name from args here so it is passed in **kw\r\n    def __init__(self, *a, ..., **kw): \r\n        ...\r\n        super().__init__(*a, **kw)\r\n        \r\n    call = __call__ # just change the method name\r\n    \r\n    def compute_output_shape(self, input_shape):\r\n        return input_shape[:-1] + (self.nb_filters,)\r\n```\r\n\r\nNow when I do this:\r\n```python\r\nbatch_size, timesteps, input_ch = None, fs*dur, 1\r\n\r\ni = Input(batch_shape=(batch_size, timesteps, input_ch), name='tcn_in')\r\no = TCN2(16, return_sequences=True, name='tcn1')(i)\r\no = TCN2(16, return_sequences=True, name='tcn2')(o)\r\no = TCN2(16, return_sequences=True, name='tcn3')(o)\r\n\r\nm = Model(inputs=[i], outputs=[o])\r\nm.compile(optimizer='adam', loss='mse')\r\n[l.name for l in m.layers]\r\n```\r\nI get:\r\n```\r\n['tcn_in', 'tcn1', 'tcn2', 'tcn3']\r\n```\r\nInstead of:\r\n```\r\n['tcn_in',\r\n 'conv1d_927',\r\n 'conv1d_928',\r\n 'activation_871',\r\n 'spatial_dropout1d_581',\r\n 'conv1d_929',\r\n 'activation_872',\r\n 'spatial_dropout1d_582',\r\n 'conv1d_930',\r\n 'add_334',\r\n 'activation_873',\r\n 'conv1d_931',\r\n 'activation_874',\r\n 'spatial_dropout1d_583',\r\n 'conv1d_932',\r\n 'activation_875',\r\n 'spatial_dropout1d_584',\r\n 'conv1d_933',\r\n 'add_335',\r\n 'activation_876',\r\n 'conv1d_934',\r\n 'activation_877',\r\n 'spatial_dropout1d_585',\r\n 'conv1d_935',\r\n 'activation_878',\r\n 'spatial_dropout1d_586',\r\n 'conv1d_936',\r\n 'add_336',\r\n 'activation_879',\r\n 'conv1d_937',\r\n 'activation_880',\r\n 'spatial_dropout1d_587',\r\n 'conv1d_938',\r\n 'activation_881',\r\n 'spatial_dropout1d_588',\r\n 'conv1d_939',\r\n 'add_337',\r\n 'activation_882',\r\n 'conv1d_940',\r\n 'activation_883',\r\n 'spatial_dropout1d_589',\r\n 'conv1d_941',\r\n 'activation_884',\r\n 'spatial_dropout1d_590',\r\n 'conv1d_942',\r\n 'add_338',\r\n 'activation_885',\r\n 'conv1d_943',\r\n 'activation_886',\r\n 'spatial_dropout1d_591',\r\n 'conv1d_944',\r\n 'activation_887',\r\n 'spatial_dropout1d_592',\r\n 'add_340',\r\n 'conv1d_946',\r\n 'conv1d_947',\r\n 'activation_889',\r\n 'spatial_dropout1d_593',\r\n 'conv1d_948',\r\n 'activation_890',\r\n 'spatial_dropout1d_594',\r\n 'conv1d_949',\r\n 'add_341',\r\n 'activation_891',\r\n 'conv1d_950',\r\n 'activation_892',\r\n 'spatial_dropout1d_595',\r\n 'conv1d_951',\r\n 'activation_893',\r\n 'spatial_dropout1d_596',\r\n 'conv1d_952',\r\n 'add_342',\r\n 'activation_894',\r\n 'conv1d_953',\r\n 'activation_895',\r\n 'spatial_dropout1d_597',\r\n 'conv1d_954',\r\n 'activation_896',\r\n 'spatial_dropout1d_598',\r\n 'conv1d_955',\r\n 'add_343',\r\n 'activation_897',\r\n 'conv1d_956',\r\n 'activation_898',\r\n 'spatial_dropout1d_599',\r\n 'conv1d_957',\r\n 'activation_899',\r\n 'spatial_dropout1d_600',\r\n 'conv1d_958',\r\n 'add_344',\r\n 'activation_900',\r\n 'conv1d_959',\r\n 'activation_901',\r\n 'spatial_dropout1d_601',\r\n 'conv1d_960',\r\n 'activation_902',\r\n 'spatial_dropout1d_602',\r\n 'conv1d_961',\r\n 'add_345',\r\n 'activation_903',\r\n 'conv1d_962',\r\n 'activation_904',\r\n 'spatial_dropout1d_603',\r\n 'conv1d_963',\r\n 'activation_905',\r\n 'spatial_dropout1d_604',\r\n 'add_347',\r\n 'conv1d_965',\r\n 'conv1d_966',\r\n 'activation_907',\r\n 'spatial_dropout1d_605',\r\n 'conv1d_967',\r\n 'activation_908',\r\n 'spatial_dropout1d_606',\r\n 'conv1d_968',\r\n 'add_348',\r\n 'activation_909',\r\n 'conv1d_969',\r\n 'activation_910',\r\n 'spatial_dropout1d_607',\r\n 'conv1d_970',\r\n 'activation_911',\r\n 'spatial_dropout1d_608',\r\n 'conv1d_971',\r\n 'add_349',\r\n 'activation_912',\r\n 'conv1d_972',\r\n 'activation_913',\r\n 'spatial_dropout1d_609',\r\n 'conv1d_973',\r\n 'activation_914',\r\n 'spatial_dropout1d_610',\r\n 'conv1d_974',\r\n 'add_350',\r\n 'activation_915',\r\n 'conv1d_975',\r\n 'activation_916',\r\n 'spatial_dropout1d_611',\r\n 'conv1d_976',\r\n 'activation_917',\r\n 'spatial_dropout1d_612',\r\n 'conv1d_977',\r\n 'add_351',\r\n 'activation_918',\r\n 'conv1d_978',\r\n 'activation_919',\r\n 'spatial_dropout1d_613',\r\n 'conv1d_979',\r\n 'activation_920',\r\n 'spatial_dropout1d_614',\r\n 'conv1d_980',\r\n 'add_352',\r\n 'activation_921',\r\n 'conv1d_981',\r\n 'activation_922',\r\n 'spatial_dropout1d_615',\r\n 'conv1d_982',\r\n 'activation_923',\r\n 'spatial_dropout1d_616',\r\n 'add_354']\r\n```","closed_by":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/61/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/61/timeline","performed_via_github_app":null,"state_reason":"completed"}