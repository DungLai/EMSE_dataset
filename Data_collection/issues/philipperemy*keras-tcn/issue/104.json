{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/104","repository_url":"https://api.github.com/repos/philipperemy/keras-tcn","labels_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/104/labels{/name}","comments_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/104/comments","events_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/104/events","html_url":"https://github.com/philipperemy/keras-tcn/issues/104","id":528337848,"node_id":"MDU6SXNzdWU1MjgzMzc4NDg=","number":104,"title":"TCN layer config does not account for layer norm","user":{"login":"adamconkey","id":22223086,"node_id":"MDQ6VXNlcjIyMjIzMDg2","avatar_url":"https://avatars.githubusercontent.com/u/22223086?v=4","gravatar_id":"","url":"https://api.github.com/users/adamconkey","html_url":"https://github.com/adamconkey","followers_url":"https://api.github.com/users/adamconkey/followers","following_url":"https://api.github.com/users/adamconkey/following{/other_user}","gists_url":"https://api.github.com/users/adamconkey/gists{/gist_id}","starred_url":"https://api.github.com/users/adamconkey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamconkey/subscriptions","organizations_url":"https://api.github.com/users/adamconkey/orgs","repos_url":"https://api.github.com/users/adamconkey/repos","events_url":"https://api.github.com/users/adamconkey/events{/privacy}","received_events_url":"https://api.github.com/users/adamconkey/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-11-25T21:09:03Z","updated_at":"2019-11-26T00:28:58Z","closed_at":"2019-11-26T00:28:58Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"The new Layer inheritance for the TCN layer does not account for the new option `use_layer_norm` in the configuration in [`get_config`](https://github.com/philipperemy/keras-tcn/blob/1c81970433fb0bd2ea4444edd0ff87b2c5d09464/tcn/tcn.py#L281). This causes deserialization problems as the number of weights in the layer do not match with what was present when the model was serialized. For instance, something like\r\n```\r\nmodel.save_weights(\"my_model.h5\")\r\nmodel = tf.keras.models.load_model(\"my_model.h5\", custom_objects={'TCN': TCN})\r\n```\r\ngave me this error:\r\n```\r\nValueError: Layer #2 (named \"tcn\" in the current model) was found to correspond to layer tcn in the save file. However the new layer tcn expects 24 weights, but the saved weights have 40 elements.\r\n```\r\nThe fix is simple, just add `config['use_layer_norm'] = self.use_layer_norm` in the `get_config` function of the TCN layer. I have submitted PR #105 to fix this.","closed_by":{"login":"philipperemy","id":4516927,"node_id":"MDQ6VXNlcjQ1MTY5Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/4516927?v=4","gravatar_id":"","url":"https://api.github.com/users/philipperemy","html_url":"https://github.com/philipperemy","followers_url":"https://api.github.com/users/philipperemy/followers","following_url":"https://api.github.com/users/philipperemy/following{/other_user}","gists_url":"https://api.github.com/users/philipperemy/gists{/gist_id}","starred_url":"https://api.github.com/users/philipperemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipperemy/subscriptions","organizations_url":"https://api.github.com/users/philipperemy/orgs","repos_url":"https://api.github.com/users/philipperemy/repos","events_url":"https://api.github.com/users/philipperemy/events{/privacy}","received_events_url":"https://api.github.com/users/philipperemy/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/104/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/104/timeline","performed_via_github_app":null,"state_reason":"completed"}