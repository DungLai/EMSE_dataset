{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/152","repository_url":"https://api.github.com/repos/philipperemy/keras-tcn","labels_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/152/labels{/name}","comments_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/152/comments","events_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/152/events","html_url":"https://github.com/philipperemy/keras-tcn/issues/152","id":651673563,"node_id":"MDU6SXNzdWU2NTE2NzM1NjM=","number":152,"title":"Can't train on certain batch shapes","user":{"login":"jdevoldere","id":44088377,"node_id":"MDQ6VXNlcjQ0MDg4Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/44088377?v=4","gravatar_id":"","url":"https://api.github.com/users/jdevoldere","html_url":"https://github.com/jdevoldere","followers_url":"https://api.github.com/users/jdevoldere/followers","following_url":"https://api.github.com/users/jdevoldere/following{/other_user}","gists_url":"https://api.github.com/users/jdevoldere/gists{/gist_id}","starred_url":"https://api.github.com/users/jdevoldere/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdevoldere/subscriptions","organizations_url":"https://api.github.com/users/jdevoldere/orgs","repos_url":"https://api.github.com/users/jdevoldere/repos","events_url":"https://api.github.com/users/jdevoldere/events{/privacy}","received_events_url":"https://api.github.com/users/jdevoldere/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-07-06T16:35:50Z","updated_at":"2020-07-06T16:44:18Z","closed_at":"2020-07-06T16:42:38Z","author_association":"NONE","active_lock_reason":null,"body":"For some reason it's impossible to train on an X and y shape of (48, 24, 6) and (48,) respectively.\r\n\r\n```\r\nimport numpy as np\r\nimport tensorflow as tf\r\nfrom tensorflow.keras.layers import Dense, Input, LSTM\r\nfrom tensorflow.keras.models import Model\r\nfrom tcn import TCN\r\n\r\n\r\ndef batch_generator():\r\n    while True:\r\n        X = np.random.rand(48, 24, 6)\r\n        y = np.random.randint(2, size=48)\r\n        yield X, y\r\n\r\n\r\ni = Input(batch_shape=(None, 48, 6))\r\n\r\no = TCN(return_sequences=True)(i)\r\no = TCN(return_sequences=False)(o)\r\no = Dense(1, activation='sigmoid')(o)\r\n\r\nm = Model(inputs=[i], outputs=[o])\r\nm.compile(optimizer=tf.keras.optimizers.Adam(learning_rate=0.01), loss=\"binary_crossentropy\",\r\n          metrics=[\"binary_accuracy\"])\r\n\r\ngen = batch_generator()\r\n\r\nm.fit(gen, epochs=10, steps_per_epoch=100)\r\n```\r\nResults in the following error:\r\n```\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError:  padded_shape[0]=40 is not divisible by block_shape[0]=16\r\n\t [[node model/tcn/residual_block_4/conv1D_0/SpaceToBatchND (defined at \\Users\\jordy\\PycharmProjects\\virtualenv\\venv\\lib\\site-packages\\tcn\\tcn.py:145) ]] [Op:__inference_train_function_7223]\r\n\r\nFunction call stack:\r\ntrain_function\r\n\r\n2020-07-06 18:27:27.898643: W tensorflow/core/kernels/data/generator_dataset_op.cc:103] Error occurred when finalizing GeneratorDataset iterator: Failed precondition: Python interpreter state is not initialized. The process may be terminated.\r\n\t [[{{node PyFunc}}]]\r\n```\r\nEverything works as it should when replacing the TCN layers with LSTM layers.\r\nWhen using an X and y shape of (64, 48, 6) and (64,) instead, everything works as it should using TCN layers.","closed_by":{"login":"jdevoldere","id":44088377,"node_id":"MDQ6VXNlcjQ0MDg4Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/44088377?v=4","gravatar_id":"","url":"https://api.github.com/users/jdevoldere","html_url":"https://github.com/jdevoldere","followers_url":"https://api.github.com/users/jdevoldere/followers","following_url":"https://api.github.com/users/jdevoldere/following{/other_user}","gists_url":"https://api.github.com/users/jdevoldere/gists{/gist_id}","starred_url":"https://api.github.com/users/jdevoldere/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdevoldere/subscriptions","organizations_url":"https://api.github.com/users/jdevoldere/orgs","repos_url":"https://api.github.com/users/jdevoldere/repos","events_url":"https://api.github.com/users/jdevoldere/events{/privacy}","received_events_url":"https://api.github.com/users/jdevoldere/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/152/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/philipperemy/keras-tcn/issues/152/timeline","performed_via_github_app":null,"state_reason":"completed"}