{"url":"https://api.github.com/repos/namisan/mt-dnn/issues/114","repository_url":"https://api.github.com/repos/namisan/mt-dnn","labels_url":"https://api.github.com/repos/namisan/mt-dnn/issues/114/labels{/name}","comments_url":"https://api.github.com/repos/namisan/mt-dnn/issues/114/comments","events_url":"https://api.github.com/repos/namisan/mt-dnn/issues/114/events","html_url":"https://github.com/namisan/mt-dnn/issues/114","id":510762148,"node_id":"MDU6SXNzdWU1MTA3NjIxNDg=","number":114,"title":"Early detection of not enough hardware requirments","user":{"login":"antgr","id":2175768,"node_id":"MDQ6VXNlcjIxNzU3Njg=","avatar_url":"https://avatars.githubusercontent.com/u/2175768?v=4","gravatar_id":"","url":"https://api.github.com/users/antgr","html_url":"https://github.com/antgr","followers_url":"https://api.github.com/users/antgr/followers","following_url":"https://api.github.com/users/antgr/following{/other_user}","gists_url":"https://api.github.com/users/antgr/gists{/gist_id}","starred_url":"https://api.github.com/users/antgr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antgr/subscriptions","organizations_url":"https://api.github.com/users/antgr/orgs","repos_url":"https://api.github.com/users/antgr/repos","events_url":"https://api.github.com/users/antgr/events{/privacy}","received_events_url":"https://api.github.com/users/antgr/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-10-22T16:13:10Z","updated_at":"2019-12-31T00:02:17Z","closed_at":"2019-12-31T00:02:16Z","author_association":"NONE","active_lock_reason":null,"body":"I wonder if the scripts could be enhanced in order to detect hardware (gpu) and print warning that there is not enough hardware for the experiment (or ideally to suggest settings e.g batch size etc).\r\n\r\nFor example the following run lasted from 08:27:29 to 08:53:12, and then crashed.\r\n\r\nCould you help me understand why the specific experiment needs so much gpu memory?\r\nI used 'init_checkpoint': 'mt_dnn_models/mt_dnn_base_uncased.pt'\r\nand 'init_checkpoint': 'mt_dnn_models/bert_model_base_uncased.pt', with the same result bellow.\r\n\r\nThanks a lot.\r\n\r\n```\r\n10/22/2019 08:27:29 Total number of params: 130194453\r\n10/22/2019 08:27:29 At epoch 0\r\n10/22/2019 08:27:29 Task [ 7] updates[     1] train loss[14.33726] remaining[6:04:43]\r\n10/22/2019 08:28:41 Task [ 0] updates[   500] train loss[1.01641] remaining[4:42:22]\r\n10/22/2019 08:29:54 Task [ 0] updates[  1000] train loss[0.96663] remaining[4:44:18]\r\n10/22/2019 08:31:08 Task [ 2] updates[  1500] train loss[0.98181] remaining[4:45:35]\r\n10/22/2019 08:32:22 Task [ 0] updates[  2000] train loss[0.96799] remaining[4:44:42]\r\n10/22/2019 08:33:36 Task [ 2] updates[  2500] train loss[0.95632] remaining[4:44:22]\r\n10/22/2019 08:34:50 Task [ 0] updates[  3000] train loss[0.95055] remaining[4:43:34]\r\n10/22/2019 08:36:04 Task [ 0] updates[  3500] train loss[0.94487] remaining[4:42:13]\r\n10/22/2019 08:37:17 Task [ 2] updates[  4000] train loss[0.93659] remaining[4:40:50]\r\n10/22/2019 08:38:31 Task [ 0] updates[  4500] train loss[0.93057] remaining[4:39:57]\r\n10/22/2019 08:39:44 Task [ 2] updates[  5000] train loss[0.93538] remaining[4:38:22]\r\n10/22/2019 08:40:57 Task [ 5] updates[  5500] train loss[0.93393] remaining[4:36:56]\r\n10/22/2019 08:42:10 Task [ 2] updates[  6000] train loss[0.93207] remaining[4:35:50]\r\n10/22/2019 08:43:24 Task [ 0] updates[  6500] train loss[0.92663] remaining[4:34:44]\r\n10/22/2019 08:44:37 Task [ 2] updates[  7000] train loss[0.92031] remaining[4:33:15]\r\n10/22/2019 08:45:50 Task [ 0] updates[  7500] train loss[0.91180] remaining[4:31:55]\r\n10/22/2019 08:47:04 Task [ 3] updates[  8000] train loss[0.90517] remaining[4:30:53]\r\n10/22/2019 08:48:18 Task [ 0] updates[  8500] train loss[0.89916] remaining[4:29:47]\r\n10/22/2019 08:49:32 Task [ 2] updates[  9000] train loss[0.89482] remaining[4:28:40]\r\n10/22/2019 08:50:45 Task [ 3] updates[  9500] train loss[0.88491] remaining[4:27:22]\r\n10/22/2019 08:51:59 Task [ 3] updates[ 10000] train loss[0.87999] remaining[4:26:06]\r\n10/22/2019 08:53:12 Task [ 0] updates[ 10500] train loss[0.87275] remaining[4:24:57]\r\n/usr/lib64/python3.7/site-packages/sklearn/externals/six.py:7: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses\r\n  import imp\r\n/usr/lib64/python3.7/site-packages/sklearn/utils/__init__.py:4: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working\r\n  from collections import Sequence\r\nTraceback (most recent call last):\r\n  File \"train.py\", line 434, in <module>\r\n    main()\r\n  File \"train.py\", line 369, in main\r\n    model.update(batch_meta, batch_data)\r\n  File \"/home/user/mt-dnn/mt_dnn/model.py\", line 195, in update\r\n    logits = self.mnetwork(*inputs)\r\n  File \"/home/user/.local/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 493, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/home/user/.local/lib/python3.7/site-packages/torch/nn/parallel/data_parallel.py\", line 150, in forward\r\n    return self.module(*inputs[0], **kwargs[0])\r\n  File \"/home/user/.local/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 493, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/home/user/mt-dnn/mt_dnn/matcher.py\", line 97, in forward\r\n    all_encoder_layers, pooled_output = self.bert(input_ids, token_type_ids, attention_mask)\r\n  File \"/home/user/.local/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 493, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/home/user/.local/lib/python3.7/site-packages/pytorch_pretrained_bert/modeling.py\", line 714, in forward\r\n    output_all_encoded_layers=output_all_encoded_layers)\r\n  File \"/home/user/.local/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 493, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/home/user/.local/lib/python3.7/site-packages/pytorch_pretrained_bert/modeling.py\", line 396, in forward\r\n    hidden_states = layer_module(hidden_states, attention_mask)\r\n  File \"/home/user/.local/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 493, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/home/user/.local/lib/python3.7/site-packages/pytorch_pretrained_bert/modeling.py\", line 382, in forward\r\n    intermediate_output = self.intermediate(attention_output)\r\n  File \"/home/user/.local/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 493, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/home/user/.local/lib/python3.7/site-packages/pytorch_pretrained_bert/modeling.py\", line 355, in forward\r\n    hidden_states = self.intermediate_act_fn(hidden_states)\r\n  File \"/home/user/.local/lib/python3.7/site-packages/pytorch_pretrained_bert/modeling.py\", line 119, in gelu\r\n    return x * 0.5 * (1.0 + torch.erf(x / math.sqrt(2.0)))\r\nRuntimeError: CUDA out of memory. Tried to allocate 48.00 MiB (GPU 0; 10.92 GiB total capacity; 9.53 GiB already allocated; 39.50 MiB free; 771.55 MiB cached)\r\n^C\r\n[1]+  Exit 1                  nohup sh scripts/run_mt_dnn.sh 8 0 > run_mt_dnn.logs\r\n```","closed_by":{"login":"namisan","id":3060273,"node_id":"MDQ6VXNlcjMwNjAyNzM=","avatar_url":"https://avatars.githubusercontent.com/u/3060273?v=4","gravatar_id":"","url":"https://api.github.com/users/namisan","html_url":"https://github.com/namisan","followers_url":"https://api.github.com/users/namisan/followers","following_url":"https://api.github.com/users/namisan/following{/other_user}","gists_url":"https://api.github.com/users/namisan/gists{/gist_id}","starred_url":"https://api.github.com/users/namisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/namisan/subscriptions","organizations_url":"https://api.github.com/users/namisan/orgs","repos_url":"https://api.github.com/users/namisan/repos","events_url":"https://api.github.com/users/namisan/events{/privacy}","received_events_url":"https://api.github.com/users/namisan/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/namisan/mt-dnn/issues/114/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/namisan/mt-dnn/issues/114/timeline","performed_via_github_app":null,"state_reason":"completed"}