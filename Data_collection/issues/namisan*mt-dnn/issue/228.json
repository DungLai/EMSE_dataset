{"url":"https://api.github.com/repos/namisan/mt-dnn/issues/228","repository_url":"https://api.github.com/repos/namisan/mt-dnn","labels_url":"https://api.github.com/repos/namisan/mt-dnn/issues/228/labels{/name}","comments_url":"https://api.github.com/repos/namisan/mt-dnn/issues/228/comments","events_url":"https://api.github.com/repos/namisan/mt-dnn/issues/228/events","html_url":"https://github.com/namisan/mt-dnn/issues/228","id":1128900836,"node_id":"I_kwDOCjnaNM5DSajk","number":228,"title":"Performance using ELECTRA and ROBERTA is significantly different from BERT","user":{"login":"chawannut157","id":8434571,"node_id":"MDQ6VXNlcjg0MzQ1NzE=","avatar_url":"https://avatars.githubusercontent.com/u/8434571?v=4","gravatar_id":"","url":"https://api.github.com/users/chawannut157","html_url":"https://github.com/chawannut157","followers_url":"https://api.github.com/users/chawannut157/followers","following_url":"https://api.github.com/users/chawannut157/following{/other_user}","gists_url":"https://api.github.com/users/chawannut157/gists{/gist_id}","starred_url":"https://api.github.com/users/chawannut157/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chawannut157/subscriptions","organizations_url":"https://api.github.com/users/chawannut157/orgs","repos_url":"https://api.github.com/users/chawannut157/repos","events_url":"https://api.github.com/users/chawannut157/events{/privacy}","received_events_url":"https://api.github.com/users/chawannut157/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-02-09T18:44:41Z","updated_at":"2022-03-22T20:17:23Z","closed_at":"2022-02-12T07:05:45Z","author_association":"NONE","active_lock_reason":null,"body":"Running on an internal data set. Only 1 multi-classification task.\r\n\r\nBERT F1 score: ~85% \r\nELECTRA / ROBERTA F1 score: ~75%\r\n\r\n\r\nmodel.network of ELECTRA (last ~10 lines)\r\n\r\n![Screen Shot 2022-02-09 at 10 34 53 AM](https://user-images.githubusercontent.com/8434571/153267205-c5452f6b-9bcf-4137-8efb-e7b729c1566d.png)\r\n\r\n- Changing learning rates does not help ELECTRA/ROBERTA to match BERT performance\r\n- Calling the model using this config.\r\n```\r\n- !python train.py \\\r\n--task_def config.yml \\\r\n--data_dir data \\\r\n--train_datasets agg_data \\\r\n--test_datasets agg_data \\\r\n--init_checkpoint electra/electra.pt \\\r\n--output_dir result/exp2 \\\r\n--grad_accumulation_step 4 \\\r\n--encoder_type 7`\r\n```\r\n- electra.pt is directly from https://huggingface.co/google/electra-large-discriminator/tree/main (with state and config as keys)\r\n- Similar issue as reported here: https://github.com/namisan/mt-dnn/issues/218\r\n- Full parameters below\r\n`02/09/2022 01:12:40 {'log_file': 'log.log', 'tensorboard': False, 'tensorboard_logdir': 'tensorboard_logdir', 'init_checkpoint': 'electra.pt', 'data_dir': 'data', 'data_sort_on': False, 'name': 'farmer', 'task_def': 'config.yml', 'train_datasets': ['agg_data'], 'test_datasets': ['agg_data'], 'glue_format_on': False, 'mkd_opt': 0, 'do_padding': False, 'update_bert_opt': 0, 'multi_gpu_on': False, 'mem_cum_type': 'simple', 'answer_num_turn': 5, 'answer_mem_drop_p': 0.1, 'answer_att_hidden_size': 128, 'answer_att_type': 'bilinear', 'answer_rnn_type': 'gru', 'answer_sum_att_type': 'bilinear', 'answer_merge_opt': 1, 'answer_mem_type': 1, 'max_answer_len': 10, 'answer_dropout_p': 0.1, 'answer_weight_norm_on': False, 'dump_state_on': False, 'answer_opt': 1, 'pooler_actf': 'tanh', 'mtl_opt': 0, 'ratio': 0, 'mix_opt': 0, 'max_seq_len': 512, 'init_ratio': 1, 'encoder_type': 7, 'num_hidden_layers': -1, 'bert_model_type': 'bert-base-uncased', 'do_lower_case': False, 'masked_lm_prob': 0.15, 'short_seq_prob': 0.2, 'max_predictions_per_seq': 128, 'bin_on': False, 'bin_size': 64, 'bin_grow_ratio': 0.5, 'local_rank': -1, 'world_size': 1, 'master_addr': 'localhost', 'master_port': '6600', 'backend': 'nccl', 'cuda': True, 'log_per_updates': 500, 'save_per_updates': 10000, 'save_per_updates_on': False, 'epochs': 5, 'batch_size': 8, 'batch_size_eval': 8, 'optimizer': 'adamax', 'grad_clipping': 0, 'global_grad_clipping': 1.0, 'weight_decay': 0, 'learning_rate': 5e-05, 'momentum': 0, 'warmup': 0.1, 'warmup_schedule': 'warmup_linear', 'adam_eps': 1e-06, 'vb_dropout': True, 'dropout_p': 0.1, 'dropout_w': 0.0, 'bert_dropout_p': 0.1, 'model_ckpt': 'checkpoints/model_0.pt', 'resume': False, 'have_lr_scheduler': True, 'multi_step_lr': '10,20,30', 'lr_gamma': 0.5, 'scheduler_type': 'ms', 'output_dir': 'result/exp2', 'seed': 2018, 'grad_accumulation_step': 4, 'fp16': False, 'fp16_opt_level': 'O1', 'adv_train': False, 'adv_opt': 0, 'adv_norm_level': 0, 'adv_p_norm': 'inf', 'adv_alpha': 1, 'adv_k': 1, 'adv_step_size': 1e-05, 'adv_noise_var': 1e-05, 'adv_epsilon': 1e-06, 'encode_mode': False, 'debug': False, 'transformer_cache': '.cache', 'task_def_list': [{'adv_loss': '<LossCriterion.SymKlCriterion: 7>', 'kd_loss': '<LossCriterion.MseCriterion: 1>', 'loss': '<LossCriterion.CeCriterion: 0>', 'dropout_p': 'None', 'enable_san': 'False', 'split_names': \"['train', 'dev', 'test']\", 'metric_meta': '(<Metric.F1MAC: 9>, <Metric.F1MIC: 10>)', 'task_type': '<TaskType.Classification: 1>', 'data_type': '<DataFormat.PremiseOnly: 1>', 'n_class': '147', 'label_vocab': '<data_utils.vocab.Vocabulary object at 0x7fe531fc7f98>', 'self': '{}', '__class__': \"<class 'experiments.exp_def.TaskDef'>\"}]}`\r\n\r\nWill try to reproduce on opensource data once I have time.","closed_by":{"login":"namisan","id":3060273,"node_id":"MDQ6VXNlcjMwNjAyNzM=","avatar_url":"https://avatars.githubusercontent.com/u/3060273?v=4","gravatar_id":"","url":"https://api.github.com/users/namisan","html_url":"https://github.com/namisan","followers_url":"https://api.github.com/users/namisan/followers","following_url":"https://api.github.com/users/namisan/following{/other_user}","gists_url":"https://api.github.com/users/namisan/gists{/gist_id}","starred_url":"https://api.github.com/users/namisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/namisan/subscriptions","organizations_url":"https://api.github.com/users/namisan/orgs","repos_url":"https://api.github.com/users/namisan/repos","events_url":"https://api.github.com/users/namisan/events{/privacy}","received_events_url":"https://api.github.com/users/namisan/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/namisan/mt-dnn/issues/228/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/namisan/mt-dnn/issues/228/timeline","performed_via_github_app":null,"state_reason":"completed"}