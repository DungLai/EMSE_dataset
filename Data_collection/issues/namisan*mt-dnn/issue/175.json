{"url":"https://api.github.com/repos/namisan/mt-dnn/issues/175","repository_url":"https://api.github.com/repos/namisan/mt-dnn","labels_url":"https://api.github.com/repos/namisan/mt-dnn/issues/175/labels{/name}","comments_url":"https://api.github.com/repos/namisan/mt-dnn/issues/175/comments","events_url":"https://api.github.com/repos/namisan/mt-dnn/issues/175/events","html_url":"https://github.com/namisan/mt-dnn/issues/175","id":641312157,"node_id":"MDU6SXNzdWU2NDEzMTIxNTc=","number":175,"title":"error when running the scripts/run_mt_dnn.sh file","user":{"login":"shijing001","id":52896762,"node_id":"MDQ6VXNlcjUyODk2NzYy","avatar_url":"https://avatars.githubusercontent.com/u/52896762?v=4","gravatar_id":"","url":"https://api.github.com/users/shijing001","html_url":"https://github.com/shijing001","followers_url":"https://api.github.com/users/shijing001/followers","following_url":"https://api.github.com/users/shijing001/following{/other_user}","gists_url":"https://api.github.com/users/shijing001/gists{/gist_id}","starred_url":"https://api.github.com/users/shijing001/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shijing001/subscriptions","organizations_url":"https://api.github.com/users/shijing001/orgs","repos_url":"https://api.github.com/users/shijing001/repos","events_url":"https://api.github.com/users/shijing001/events{/privacy}","received_events_url":"https://api.github.com/users/shijing001/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-06-18T15:33:58Z","updated_at":"2020-08-26T23:16:26Z","closed_at":"2020-08-26T23:16:25Z","author_association":"NONE","active_lock_reason":null,"body":"I downloaded the codebase and tried to reproduce the results on a linux machine. Here is the bash script:\r\n\r\n#!/bin/bash\r\n#SBATCH -e slurm.err\r\n#SBATCH -p carin-gpu --gres=gpu:1\r\n#SBATCH --mem=30G # adjust as needed\r\n#SBATCH -c 2 # adjust as needed\r\nmodule load Python-GPU/3.6.5\r\n\r\nprefix=\"mt-dnn\"\r\nBATCH_SIZE=2\r\ngpu=0\r\necho \"export CUDA_VISIBLE_DEVICES=${gpu}\"\r\nexport CUDA_VISIBLE_DEVICES=${gpu}\r\ntstr=$(date +\"%FT%H%M\")\r\n\r\ntrain_datasets=\"mnli,rte,qqp,qnli,mrpc,sst,cola,stsb\"\r\ntest_datasets=\"mnli_matched,mnli_mismatched,rte\"\r\nMODEL_ROOT=\"checkpoints\"\r\nBERT_PATH=\"mt_dnn_models/bert_model_base_uncased.pt\"\r\nDATA_DIR=\"data/canonical_data/bert_uncased_lower\"\r\n\r\nanswer_opt=1\r\noptim=\"adamax\"\r\ngrad_clipping=0\r\nglobal_grad_clipping=1\r\nlr=\"5e-5\"\r\n\r\nmodel_dir=\"checkpoints/${prefix}_${optim}_answer_opt${answer_opt}_gc${grad_clipping}_ggc${global_grad_clipping}_${tstr}\"\r\nlog_file=\"${model_dir}/log.log\"\r\npython train.py --data_dir ${DATA_DIR} --init_checkpoint ${BERT_PATH} --batch_size ${BATCH_SIZE} --output_dir ${model_dir} --log_file ${log_file} --answer_opt ${answer_opt} --optimizer ${optim} --train_datasets ${train_datasets} --test_datasets ${test_datasets} --grad_clipping ${grad_clipping} --global_grad_clipping ${global_grad_clipping} --learning_rate ${lr} --grad_accumulation_step 4 --do_lower_case\r\n\r\n\r\nHere is the error:\r\n\r\nCUDA 9.0\r\nPython-GPU 3.6.5\r\n/opt/apps/rhel7/Python-GPU-3.6.5/lib/python3.6/site-packages/h5py/__init__.py:36: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.\r\n  from ._conv import register_converters as _register_converters\r\n/pytorch/aten/src/ATen/native/cuda/LegacyDefinitions.cpp:19: UserWarning: masked_fill_ received a mask with dtype torch.uint8, this behavior is now deprecated,please use a mask with dtype torch.bool instead.\r\n/pytorch/aten/src/ATen/native/cuda/LegacyDefinitions.cpp:19: UserWarning: masked_fill_ received a mask with dtype torch.uint8, this behavior is now deprecated,please use a mask with dtype torch.bool instead.\r\nTraceback (most recent call last):\r\n  File \"train.py\", line 360, in <module>\r\n    main()\r\n  File \"train.py\", line 291, in main\r\n    model.update(batch_meta, batch_data)\r\n  File \"/work/ss1043/mt-dnn/mt_dnn/model.py\", line 168, in update\r\n    logits = self.mnetwork(*inputs)\r\n  File \"/opt/apps/rhel7/Python-GPU-3.6.5/lib/python3.6/site-packages/torch/nn/modules/module.py\", line 541, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/work/ss1043/mt-dnn/mt_dnn/matcher.py\", line 131, in forward\r\n    logits = task_obj.train_forward(sequence_output, pooled_output, premise_mask, hyp_mask, decoder_opt, self.dropout_list[task_id], self.scoring_list[task_id])\r\n  File \"/work/ss1043/mt-dnn/tasks/__init__.py\", line 48, in train_forward\r\n    logits = task_layer(sequence_output, hyp_mem, premise_mask, hyp_mask)\r\n  File \"/opt/apps/rhel7/Python-GPU-3.6.5/lib/python3.6/site-packages/torch/nn/modules/module.py\", line 541, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/work/ss1043/mt-dnn/module/san.py\", line 88, in forward\r\n    att_scores = self.attn(x, h0, x_mask)\r\n  File \"/opt/apps/rhel7/Python-GPU-3.6.5/lib/python3.6/site-packages/torch/nn/modules/module.py\", line 541, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/work/ss1043/mt-dnn/module/similarity.py\", line 463, in forward\r\n    scores = self.score_func(x1, x2, mask)\r\n  File \"/opt/apps/rhel7/Python-GPU-3.6.5/lib/python3.6/site-packages/torch/nn/modules/module.py\", line 541, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/work/ss1043/mt-dnn/module/similarity.py\", line 350, in forward\r\n    xWy.data.masked_fill_(x_mask.data, -float('inf'))\r\nRuntimeError: The expanded size of the tensor (66) must match the existing size (25) at non-singleton dimension 1.  Target sizes: [2, 66].  Tensor sizes: [2, 25]\r\n","closed_by":{"login":"namisan","id":3060273,"node_id":"MDQ6VXNlcjMwNjAyNzM=","avatar_url":"https://avatars.githubusercontent.com/u/3060273?v=4","gravatar_id":"","url":"https://api.github.com/users/namisan","html_url":"https://github.com/namisan","followers_url":"https://api.github.com/users/namisan/followers","following_url":"https://api.github.com/users/namisan/following{/other_user}","gists_url":"https://api.github.com/users/namisan/gists{/gist_id}","starred_url":"https://api.github.com/users/namisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/namisan/subscriptions","organizations_url":"https://api.github.com/users/namisan/orgs","repos_url":"https://api.github.com/users/namisan/repos","events_url":"https://api.github.com/users/namisan/events{/privacy}","received_events_url":"https://api.github.com/users/namisan/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/namisan/mt-dnn/issues/175/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/namisan/mt-dnn/issues/175/timeline","performed_via_github_app":null,"state_reason":"completed"}