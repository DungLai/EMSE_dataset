{"url":"https://api.github.com/repos/CyberZHG/keras-gpt-2/issues/10","repository_url":"https://api.github.com/repos/CyberZHG/keras-gpt-2","labels_url":"https://api.github.com/repos/CyberZHG/keras-gpt-2/issues/10/labels{/name}","comments_url":"https://api.github.com/repos/CyberZHG/keras-gpt-2/issues/10/comments","events_url":"https://api.github.com/repos/CyberZHG/keras-gpt-2/issues/10/events","html_url":"https://github.com/CyberZHG/keras-gpt-2/issues/10","id":525081478,"node_id":"MDU6SXNzdWU1MjUwODE0Nzg=","number":10,"title":"DistilGPT2","user":{"login":"benman1","id":10786684,"node_id":"MDQ6VXNlcjEwNzg2Njg0","avatar_url":"https://avatars.githubusercontent.com/u/10786684?v=4","gravatar_id":"","url":"https://api.github.com/users/benman1","html_url":"https://github.com/benman1","followers_url":"https://api.github.com/users/benman1/followers","following_url":"https://api.github.com/users/benman1/following{/other_user}","gists_url":"https://api.github.com/users/benman1/gists{/gist_id}","starred_url":"https://api.github.com/users/benman1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benman1/subscriptions","organizations_url":"https://api.github.com/users/benman1/orgs","repos_url":"https://api.github.com/users/benman1/repos","events_url":"https://api.github.com/users/benman1/events{/privacy}","received_events_url":"https://api.github.com/users/benman1/received_events","type":"User","site_admin":false},"labels":[{"id":1237524655,"node_id":"MDU6TGFiZWwxMjM3NTI0NjU1","url":"https://api.github.com/repos/CyberZHG/keras-gpt-2/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"},{"id":1237524660,"node_id":"MDU6TGFiZWwxMjM3NTI0NjYw","url":"https://api.github.com/repos/CyberZHG/keras-gpt-2/labels/wontfix","name":"wontfix","color":"ffffff","default":true,"description":"This will not be worked on"}],"state":"closed","locked":false,"assignee":{"login":"CyberZHG","id":853842,"node_id":"MDQ6VXNlcjg1Mzg0Mg==","avatar_url":"https://avatars.githubusercontent.com/u/853842?v=4","gravatar_id":"","url":"https://api.github.com/users/CyberZHG","html_url":"https://github.com/CyberZHG","followers_url":"https://api.github.com/users/CyberZHG/followers","following_url":"https://api.github.com/users/CyberZHG/following{/other_user}","gists_url":"https://api.github.com/users/CyberZHG/gists{/gist_id}","starred_url":"https://api.github.com/users/CyberZHG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CyberZHG/subscriptions","organizations_url":"https://api.github.com/users/CyberZHG/orgs","repos_url":"https://api.github.com/users/CyberZHG/repos","events_url":"https://api.github.com/users/CyberZHG/events{/privacy}","received_events_url":"https://api.github.com/users/CyberZHG/received_events","type":"User","site_admin":false},"assignees":[{"login":"CyberZHG","id":853842,"node_id":"MDQ6VXNlcjg1Mzg0Mg==","avatar_url":"https://avatars.githubusercontent.com/u/853842?v=4","gravatar_id":"","url":"https://api.github.com/users/CyberZHG","html_url":"https://github.com/CyberZHG","followers_url":"https://api.github.com/users/CyberZHG/followers","following_url":"https://api.github.com/users/CyberZHG/following{/other_user}","gists_url":"https://api.github.com/users/CyberZHG/gists{/gist_id}","starred_url":"https://api.github.com/users/CyberZHG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CyberZHG/subscriptions","organizations_url":"https://api.github.com/users/CyberZHG/orgs","repos_url":"https://api.github.com/users/CyberZHG/repos","events_url":"https://api.github.com/users/CyberZHG/events{/privacy}","received_events_url":"https://api.github.com/users/CyberZHG/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2019-11-19T15:27:31Z","updated_at":"2019-12-06T17:00:26Z","closed_at":"2019-12-06T17:00:26Z","author_association":"NONE","active_lock_reason":null,"body":"Hi\r\n\r\nYou guys do fantastic work. I am using your libraries mostly from kashgari. \r\n\r\nI've been looking around for more models to try out, and I was hoping to reduce model size. Huggingface were doing [work distilling models](https://huggingface.co/transformers/pretrained_models.html). I've been trying to load in the [weights from their model](https://s3.amazonaws.com/models.huggingface.co/bert/distilgpt2-tf_model.h5), but couldn't match up the weights.\r\n\r\n\r\n    import h5py\r\n    import numpy as np\r\n\r\n    def get_weights(weight_file_path):\r\n        \"\"\"\r\n        Prints out the structure of HDF5 file.\r\n\r\n        Args:\r\n          weight_file_path (str) : Path to the file to analyze\r\n        \"\"\"\r\n        f = h5py.File(weight_file_path)\r\n        try:\r\n            if len(f.attrs.items()):\r\n                print(\"{} contains: \".format(weight_file_path))\r\n                print(\"Root attributes:\")\r\n            for key, value in f.attrs.items():\r\n                print(\"  {}: {}\".format(key, value))\r\n\r\n            if len(f.items())==0:\r\n                return \r\n\r\n            for layer, g in f.items():\r\n                print(\"  {}\".format(layer))\r\n                print(\"    Attributes:\")\r\n                for key, value in g.attrs.items():\r\n                    print(\"      {}: {}\".format(key, value))\r\n\r\n\r\n                weights = {v: np.array(g[v]) for v in value}\r\n        finally:\r\n            f.close()\r\n\r\n        return weights\r\n\r\n\r\n\r\nI set up my model like this: \r\n\r\n    config = {'n_ctx': 1024, 'n_embd': 768, 'n_head': 12, 'n_layer': 6, 'n_vocab': 50257}\r\n\r\n    model = get_model(\r\n        **config2,\r\n        batch_size=None,\r\n        fixed_input_shape=True,\r\n    )\r\n\r\n... but I really struggle to match up the weights.\r\n\r\nThe first layers match up, but then I get this size mismatch with the Encode-0-MultiHeadAtt layer:\r\n\r\n```\r\nshape new weights: [(768, 2304), (1, 2304), (768, 768), (1, 768), (768,), (768,), (768, 3072), (1, 3072)]\r\nshape old weights: [(768, 768), (768,), (768, 768), (768,), (768, 768), (768,), (768, 768), (768,)]\r\n\r\n```\r\n\r\nIs there something you could suggest to fix this?\r\n\r\nHere's the [code to their (Distil)GPT2](https://github.com/huggingface/transformers/blob/d7d36181fdefdabadc53adf51bed4a2680f5880a/transformers/configuration_gpt2.py\r\n).\r\n\r\nCheers!\r\nBen.","closed_by":{"login":"stale[bot]","id":26384082,"node_id":"MDM6Qm90MjYzODQwODI=","avatar_url":"https://avatars.githubusercontent.com/in/1724?v=4","gravatar_id":"","url":"https://api.github.com/users/stale%5Bbot%5D","html_url":"https://github.com/apps/stale","followers_url":"https://api.github.com/users/stale%5Bbot%5D/followers","following_url":"https://api.github.com/users/stale%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stale%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/stale%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/stale%5Bbot%5D/repos","events_url":"https://api.github.com/users/stale%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/stale%5Bbot%5D/received_events","type":"Bot","site_admin":false},"reactions":{"url":"https://api.github.com/repos/CyberZHG/keras-gpt-2/issues/10/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/CyberZHG/keras-gpt-2/issues/10/timeline","performed_via_github_app":null,"state_reason":"completed"}