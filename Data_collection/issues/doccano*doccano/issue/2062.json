{"url":"https://api.github.com/repos/doccano/doccano/issues/2062","repository_url":"https://api.github.com/repos/doccano/doccano","labels_url":"https://api.github.com/repos/doccano/doccano/issues/2062/labels{/name}","comments_url":"https://api.github.com/repos/doccano/doccano/issues/2062/comments","events_url":"https://api.github.com/repos/doccano/doccano/issues/2062/events","html_url":"https://github.com/doccano/doccano/issues/2062","id":1460449033,"node_id":"I_kwDOB-j9wM5XDK8J","number":2062,"title":"CSRF Failed: login/project management issues and temporary workaround","user":{"login":"FrancescoScandiffio","id":20610941,"node_id":"MDQ6VXNlcjIwNjEwOTQx","avatar_url":"https://avatars.githubusercontent.com/u/20610941?v=4","gravatar_id":"","url":"https://api.github.com/users/FrancescoScandiffio","html_url":"https://github.com/FrancescoScandiffio","followers_url":"https://api.github.com/users/FrancescoScandiffio/followers","following_url":"https://api.github.com/users/FrancescoScandiffio/following{/other_user}","gists_url":"https://api.github.com/users/FrancescoScandiffio/gists{/gist_id}","starred_url":"https://api.github.com/users/FrancescoScandiffio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/FrancescoScandiffio/subscriptions","organizations_url":"https://api.github.com/users/FrancescoScandiffio/orgs","repos_url":"https://api.github.com/users/FrancescoScandiffio/repos","events_url":"https://api.github.com/users/FrancescoScandiffio/events{/privacy}","received_events_url":"https://api.github.com/users/FrancescoScandiffio/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-11-22T19:36:53Z","updated_at":"2022-12-02T05:17:22Z","closed_at":"2022-12-02T05:17:22Z","author_association":"NONE","active_lock_reason":null,"body":"### Short version\r\nInstalled from source, I had an authorization problem solved by adding the local client address to the list of `CORS_ORIGIN_WHITELIST` in the backend configuration file. I think a reference to this in the documentation might help until a solution is found to make the system work out of the box.\r\nRelated to #2032 but not many details were provided there so I preferred to open a new issue to also provide my workaround.\r\n\r\n### Long version\r\nI followed the tutorial [Install from source](https://doccano.github.io/doccano/install_and_upgrade_doccano/#install-from-source) with the only difference being I used pip with virtualenv instead of poetry. \r\nAfter starting both frontend and backend processes, I encountered the following problems:\r\n1. sometimes I could not login because of \"wrong credentials error\" even if the credentials were in fact correct.\r\n2. even when logged in as admin,  the button to create projects did not create anything. I was always redirected to a 404 page\r\n3. projects manually added through the django console were still not displayed by the frontend\r\n\r\n![image](https://user-images.githubusercontent.com/20610941/203400568-9dfe9c97-eb9b-4acc-ba74-3b15247a116a.png)\r\n\r\n\r\n**Network log on client \"bad credentials\" error**\r\n```\r\nRequest URL: http://192.168.1.242:3000/v1/auth/login/\r\nPayload: {\"username\":\"admin\",\"password\":\"password\"}\r\nResponse: Error occured while trying to proxy: 192.168.1.242:3000/v1/auth/login/\r\n```\r\n\r\n**Frontend service log on \"bad credentials\" error**\r\n```\r\nERROR [HPM] Error occurred while proxying request 192.168.1.242:3000/v1/auth/login/ to http://127.0.0.1:8000/\r\n[ECONNREFUSED] (https://nodejs.org/api/errors.html#errors_common_system_errors)\r\n```\r\n\r\n**Backend log after \"create project\" button click**\r\n```\r\nForbidden: /v1/projects\r\n[22/Nov/2022 19:56:21] \"POST /v1/projects HTTP/1.1\" 403 112\r\n```\r\n\r\n**Chrome network log after \"create project\" button click**\r\n```\r\nHost: 192.168.1.242:3000\r\nOrigin: http://192.168.1.242:3000\r\nReferer: http://192.168.1.242:3000/projects/create\r\nRequest URL: http://192.168.1.242:3000/v1/projects\r\nRequest Method: POST\r\nStatus Code: 403 Forbidden\r\nReferrer Policy: strict-origin-when-cross-origin\r\n\r\nResponse: {\"detail\":\"CSRF Failed: Origin checking failed - http://192.168.1.242:3000 does not match any trusted origins.\"}\r\n\r\n```\r\n\r\n------\r\n### Workaround\r\nI have added  the ip shown by the frontend service (here http://192.168.1.242:3000) to `CORS_ORIGIN_WHITELIST` list in  `doccano\\backend\\config\\settings\\development.py`.\r\nHad to do the same for production.\r\n\r\nThis solved all the issues I encountered related to the login and project management.\r\n\r\nYour Environment\r\n---------\r\n<!-- Include details of your environment.-->\r\n*   Operating System: Windows 10 Pro, build  19044\r\n*   Python Version Used: 3.10.4\r\n*   When you install doccano: 22 November 2022 (today)\r\n*   How did you install doccano: from source (packages managed with pip)\r\n","closed_by":{"login":"Hironsan","id":6737785,"node_id":"MDQ6VXNlcjY3Mzc3ODU=","avatar_url":"https://avatars.githubusercontent.com/u/6737785?v=4","gravatar_id":"","url":"https://api.github.com/users/Hironsan","html_url":"https://github.com/Hironsan","followers_url":"https://api.github.com/users/Hironsan/followers","following_url":"https://api.github.com/users/Hironsan/following{/other_user}","gists_url":"https://api.github.com/users/Hironsan/gists{/gist_id}","starred_url":"https://api.github.com/users/Hironsan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hironsan/subscriptions","organizations_url":"https://api.github.com/users/Hironsan/orgs","repos_url":"https://api.github.com/users/Hironsan/repos","events_url":"https://api.github.com/users/Hironsan/events{/privacy}","received_events_url":"https://api.github.com/users/Hironsan/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doccano/doccano/issues/2062/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doccano/doccano/issues/2062/timeline","performed_via_github_app":null,"state_reason":"completed"}