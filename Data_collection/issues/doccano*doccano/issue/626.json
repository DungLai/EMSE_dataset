{"url":"https://api.github.com/repos/doccano/doccano/issues/626","repository_url":"https://api.github.com/repos/doccano/doccano","labels_url":"https://api.github.com/repos/doccano/doccano/issues/626/labels{/name}","comments_url":"https://api.github.com/repos/doccano/doccano/issues/626/comments","events_url":"https://api.github.com/repos/doccano/doccano/issues/626/events","html_url":"https://github.com/doccano/doccano/issues/626","id":583591899,"node_id":"MDU6SXNzdWU1ODM1OTE4OTk=","number":626,"title":"How to open closed _io.TextIoWrapper object in itertools.islice() function ?","user":{"login":"sharmila-polamuri","id":28034607,"node_id":"MDQ6VXNlcjI4MDM0NjA3","avatar_url":"https://avatars.githubusercontent.com/u/28034607?v=4","gravatar_id":"","url":"https://api.github.com/users/sharmila-polamuri","html_url":"https://github.com/sharmila-polamuri","followers_url":"https://api.github.com/users/sharmila-polamuri/followers","following_url":"https://api.github.com/users/sharmila-polamuri/following{/other_user}","gists_url":"https://api.github.com/users/sharmila-polamuri/gists{/gist_id}","starred_url":"https://api.github.com/users/sharmila-polamuri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sharmila-polamuri/subscriptions","organizations_url":"https://api.github.com/users/sharmila-polamuri/orgs","repos_url":"https://api.github.com/users/sharmila-polamuri/repos","events_url":"https://api.github.com/users/sharmila-polamuri/events{/privacy}","received_events_url":"https://api.github.com/users/sharmila-polamuri/received_events","type":"User","site_admin":false},"labels":[{"id":927327728,"node_id":"MDU6TGFiZWw5MjczMjc3Mjg=","url":"https://api.github.com/repos/doccano/doccano/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-03-18T09:32:13Z","updated_at":"2020-03-18T10:01:43Z","closed_at":"2020-03-18T10:01:42Z","author_association":"NONE","active_lock_reason":null,"body":"I am tried some script in that i catch pdf file and then convert that file to txt file . I got type of text file as _io.textIoWrapper . Now i call itertools.isslice() with _io.textIoWrapper object . That produce `ValueError: I/O operation on closed file.` If file format plain io.textIoWrapper didn't give any error. I tried to open textIoWrapper object but that gives `expect only str , bytes or None not TextIoWrapper type` error.\r\n\r\n**app/api/views.py**\r\n\r\n```\r\nfrom .convert import convert_pdf_parser\r\n\r\ndef save_file(cls, user, file, file_format, project_id,file1):\r\n        project = get_object_or_404(Project, pk=project_id)\r\n        parser = cls.select_parser(file_format)\r\n        if file_format == 'pdf':\r\n            path = default_storage.save('text_pdf_file.pdf', ContentFile(file.read()))\r\n            return_file = convert_pdf_txt(path,file_format)\r\n            print(type(return_file))  # _io.textIoWrapper\r\n            file = return_file\r\n        data = parser.parse(file,file_format)\r\n        storage = project.get_storage(data)\r\n        storage.save(user)\r\n```\r\n**app/api/utils.py**\r\n```\r\nclass PlainTextParser(FileParser):\r\n\r\n    def parse(self, file,file_format):\r\n\r\n        if file_format == 'plain':\r\n            file = EncodedIO(file)\r\n            file = io.TextIOWrapper(file, encoding=file.encoding)\r\n\r\n        while True:\r\n            batch = list(itertools.islice(file, settings.IMPORT_BATCH_SIZE))\r\n            if not batch:\r\n                break\r\n            yield [{'text': line.strip()} for line in batch]\r\n```\r\n\r\n**convert.py**\r\n```\r\nimport os\r\nfrom docx import Document\r\nimport pdfplumber as pp\r\nimport io\r\nimport unidecode\r\nimport re\r\n\r\ndef remove_accented_chars(text):\r\n  text = unidecode.unidecode(text)\r\n  return text\r\n\r\ndef remove_extra_spaces(line):\r\n  return re.sub(' +|\\t+',' ',line)\r\n\r\ndef remove_special_char(line):\r\n  return re.sub(r\"[^a-zA-Z0-9%.@]+\",' ', line)\r\n\r\ndef preprocessing(lines,fileExtension):\r\n    example_text_file = \"ex_txt.txt\"\r\n    for line in lines:\r\n        if fileExtension == \"docx\":\r\n            x=str(line.text)\r\n        elif fileExtension == \"pdf\":\r\n            x = line.extract_text()\r\n        else:\r\n            x = line\r\n        x=remove_accented_chars(x)\r\n        x=remove_extra_spaces(x)\r\n        x=remove_special_char(x)\r\n        with open(example_text_file,\"a+\",) as pre:\r\n            if len(x)>=5:\r\n                pre.write(x+\"\\n\")\r\n    return pre\r\n\r\n\r\ndef convert_pdf_txt(path,fileExtension):\r\n    with pp.open(path) as pdf :\r\n        pages = pdf.pages\r\n        pre = preprocessing(pages,fileExtension)\r\n        return pre\r\n```\r\nPlease suggest any steps to fix this error.\r\n\r\nYour Environment\r\n---------\r\n<!-- Include details of your environment. -->\r\n\r\n*   Operating System: Ubuntu 18.04\r\n*   Python Version Used: python 3.6\r\n*   When you install doccano: February 2020\r\n*   How did you install doccano (Heroku button etc): installed from source\r\n","closed_by":{"login":"icoxfog417","id":544269,"node_id":"MDQ6VXNlcjU0NDI2OQ==","avatar_url":"https://avatars.githubusercontent.com/u/544269?v=4","gravatar_id":"","url":"https://api.github.com/users/icoxfog417","html_url":"https://github.com/icoxfog417","followers_url":"https://api.github.com/users/icoxfog417/followers","following_url":"https://api.github.com/users/icoxfog417/following{/other_user}","gists_url":"https://api.github.com/users/icoxfog417/gists{/gist_id}","starred_url":"https://api.github.com/users/icoxfog417/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icoxfog417/subscriptions","organizations_url":"https://api.github.com/users/icoxfog417/orgs","repos_url":"https://api.github.com/users/icoxfog417/repos","events_url":"https://api.github.com/users/icoxfog417/events{/privacy}","received_events_url":"https://api.github.com/users/icoxfog417/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doccano/doccano/issues/626/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doccano/doccano/issues/626/timeline","performed_via_github_app":null,"state_reason":"completed"}