{"url":"https://api.github.com/repos/doccano/doccano/issues/166","repository_url":"https://api.github.com/repos/doccano/doccano","labels_url":"https://api.github.com/repos/doccano/doccano/issues/166/labels{/name}","comments_url":"https://api.github.com/repos/doccano/doccano/issues/166/comments","events_url":"https://api.github.com/repos/doccano/doccano/issues/166/events","html_url":"https://github.com/doccano/doccano/issues/166","id":434658654,"node_id":"MDU6SXNzdWU0MzQ2NTg2NTQ=","number":166,"title":"Upload from JSONL does not work","user":{"login":"mojito317","id":17944122,"node_id":"MDQ6VXNlcjE3OTQ0MTIy","avatar_url":"https://avatars.githubusercontent.com/u/17944122?v=4","gravatar_id":"","url":"https://api.github.com/users/mojito317","html_url":"https://github.com/mojito317","followers_url":"https://api.github.com/users/mojito317/followers","following_url":"https://api.github.com/users/mojito317/following{/other_user}","gists_url":"https://api.github.com/users/mojito317/gists{/gist_id}","starred_url":"https://api.github.com/users/mojito317/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mojito317/subscriptions","organizations_url":"https://api.github.com/users/mojito317/orgs","repos_url":"https://api.github.com/users/mojito317/repos","events_url":"https://api.github.com/users/mojito317/events{/privacy}","received_events_url":"https://api.github.com/users/mojito317/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-04-18T08:49:27Z","updated_at":"2019-08-20T08:58:14Z","closed_at":"2019-04-18T09:04:29Z","author_association":"NONE","active_lock_reason":null,"body":"### System information\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Win10\r\n- **Python version**:  Python 3.6.6\r\n\r\n### Describe the problem\r\nI have a syntactically correct file for uploading as JSONL, but I cannot upload it. The data does not appear in my annotations.\r\n### Source code / logs\r\n\r\n- example  of the file:\r\n```\r\n{\"text\": \"!.It's just a very poor show that may have seemed like an ambitious turn of events back in the mid 1980s; but when viewing the three films together now, Thunderdome just comes across as a director losing his edgy approach whilst sadly getting caught between the mix of comedy and fantasy action.\", \"labels\": [ [127, 132, \"CARDINAL\"] ]}\r\n{\"text\": \"!First of all I watch a lot Lifetime movies and realize they are just that....Lifetime movies.\", \"labels\": [ [28, 36, \"ORG\"], [78, 86, \"ORG\"] ]}\r\n{\"text\": \"1 out of 10.\", \"labels\": [ [9, 11, \"CARDINAL\"], [9, 11, \"CARDINAL\"], [9, 11, \"CARDINAL\"] ]}\r\n```\r\n\r\n- logs from server:\r\n\r\n```\r\nInternal Server Error: /v1/projects/4/docs/upload\r\nTraceback (most recent call last):\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\backends\\utils.py\", line 85, in _execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\backends\\sqlite3\\base.py\", line 298, in execute\r\n    return Database.Cursor.execute(self, query, params)\r\nsqlite3.IntegrityError: UNIQUE constraint failed: server_sequenceannotation.document_id, server_sequenceannotation.user_id, server_sequenceannotation.label_id, server_sequenceannotation.start_offset, server_sequenceannotation.end_offset\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\core\\handlers\\exception.py\", line 34, in inner\r\n    response = get_response(request)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\core\\handlers\\base.py\", line 126, in _get_response\r\n    response = self.process_exception_by_middleware(e, request)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\core\\handlers\\base.py\", line 124, in _get_response\r\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\views\\decorators\\csrf.py\", line 54, in wrapped_view\r\n    return view_func(*args, **kwargs)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\views\\generic\\base.py\", line 68, in view\r\n    return self.dispatch(request, *args, **kwargs)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\rest_framework\\views.py\", line 483, in dispatch\r\n    response = self.handle_exception(exc)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\rest_framework\\views.py\", line 443, in handle_exception\r\n    self.raise_uncaught_exception(exc)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\rest_framework\\views.py\", line 480, in dispatch\r\n    response = handler(request, *args, **kwargs)\r\n  File \"...\\Dev\\doccano\\app\\server\\api.py\", line 187, in post\r\n    storage.save(self.request.user)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\contextlib.py\", line 52, in inner\r\n    return func(*args, **kwds)\r\n  File \"...\\Dev\\doccano\\app\\server\\utils.py\", line 177, in save\r\n    self.save_annotation(annotations, user)\r\n  File \"...\\Dev\\doccano\\app\\server\\utils.py\", line 53, in save_annotation\r\n    annotation = serializer.save(user=user)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\rest_framework\\serializers.py\", line 728, in save\r\n    self.instance = self.create(validated_data)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\rest_framework\\serializers.py\", line 700, in create\r\n    self.child.create(attrs) for attrs in validated_data\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\rest_framework\\serializers.py\", line 700, in <listcomp>\r\n    self.child.create(attrs) for attrs in validated_data\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\rest_framework\\serializers.py\", line 940, in create\r\n    instance = ModelClass.objects.create(**validated_data)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\models\\manager.py\", line 82, in manager_method\r\n    return getattr(self.get_queryset(), name)(*args, **kwargs)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\models\\query.py\", line 413, in create\r\n    obj.save(force_insert=True, using=self.db)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\models\\base.py\", line 718, in save\r\n    force_update=force_update, update_fields=update_fields)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\models\\base.py\", line 748, in save_base\r\n    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\models\\base.py\", line 831, in _save_table\r\n    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\models\\base.py\", line 869, in _do_insert\r\n    using=using, raw=raw)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\models\\manager.py\", line 82, in manager_method\r\n    return getattr(self.get_queryset(), name)(*args, **kwargs)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\models\\query.py\", line 1136, in _insert\r\n    return query.get_compiler(using=using).execute_sql(return_id)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\models\\sql\\compiler.py\", line 1289, in execute_sql\r\n    cursor.execute(sql, params)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\backends\\utils.py\", line 100, in execute\r\n    return super().execute(sql, params)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\backends\\utils.py\", line 68, in execute\r\n    return self._execute_with_wrappers(sql, params, many=False, executor=self._execute)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\backends\\utils.py\", line 77, in _execute_with_wrappers\r\n    return executor(sql, params, many, context)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\backends\\utils.py\", line 85, in _execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\utils.py\", line 89, in __exit__\r\n    raise dj_exc_value.with_traceback(traceback) from exc_value\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\backends\\utils.py\", line 85, in _execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"...\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\django\\db\\backends\\sqlite3\\base.py\", line 298, in execute\r\n    return Database.Cursor.execute(self, query, params)\r\ndjango.db.utils.IntegrityError: UNIQUE constraint failed: server_sequenceannotation.document_id, server_sequenceannotation.user_id, server_sequenceannotation.label_id, server_sequenceannotation.start_offset, server_sequenceannotation.end_offset\r\n[18/Apr/2019 10:11:33] \"POST /v1/projects/4/docs/upload HTTP/1.1\" 500 25551\r\n```","closed_by":{"login":"Hironsan","id":6737785,"node_id":"MDQ6VXNlcjY3Mzc3ODU=","avatar_url":"https://avatars.githubusercontent.com/u/6737785?v=4","gravatar_id":"","url":"https://api.github.com/users/Hironsan","html_url":"https://github.com/Hironsan","followers_url":"https://api.github.com/users/Hironsan/followers","following_url":"https://api.github.com/users/Hironsan/following{/other_user}","gists_url":"https://api.github.com/users/Hironsan/gists{/gist_id}","starred_url":"https://api.github.com/users/Hironsan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hironsan/subscriptions","organizations_url":"https://api.github.com/users/Hironsan/orgs","repos_url":"https://api.github.com/users/Hironsan/repos","events_url":"https://api.github.com/users/Hironsan/events{/privacy}","received_events_url":"https://api.github.com/users/Hironsan/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doccano/doccano/issues/166/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doccano/doccano/issues/166/timeline","performed_via_github_app":null,"state_reason":"completed"}