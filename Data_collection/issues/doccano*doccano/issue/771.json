{"url":"https://api.github.com/repos/doccano/doccano/issues/771","repository_url":"https://api.github.com/repos/doccano/doccano","labels_url":"https://api.github.com/repos/doccano/doccano/issues/771/labels{/name}","comments_url":"https://api.github.com/repos/doccano/doccano/issues/771/comments","events_url":"https://api.github.com/repos/doccano/doccano/issues/771/events","html_url":"https://github.com/doccano/doccano/issues/771","id":617675826,"node_id":"MDU6SXNzdWU2MTc2NzU4MjY=","number":771,"title":"Fail to login using api","user":{"login":"arianpasquali","id":200721,"node_id":"MDQ6VXNlcjIwMDcyMQ==","avatar_url":"https://avatars.githubusercontent.com/u/200721?v=4","gravatar_id":"","url":"https://api.github.com/users/arianpasquali","html_url":"https://github.com/arianpasquali","followers_url":"https://api.github.com/users/arianpasquali/followers","following_url":"https://api.github.com/users/arianpasquali/following{/other_user}","gists_url":"https://api.github.com/users/arianpasquali/gists{/gist_id}","starred_url":"https://api.github.com/users/arianpasquali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arianpasquali/subscriptions","organizations_url":"https://api.github.com/users/arianpasquali/orgs","repos_url":"https://api.github.com/users/arianpasquali/repos","events_url":"https://api.github.com/users/arianpasquali/events{/privacy}","received_events_url":"https://api.github.com/users/arianpasquali/received_events","type":"User","site_admin":false},"labels":[{"id":927327728,"node_id":"MDU6TGFiZWw5MjczMjc3Mjg=","url":"https://api.github.com/repos/doccano/doccano/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-05-13T18:51:14Z","updated_at":"2021-04-21T12:38:27Z","closed_at":"2020-05-13T22:06:36Z","author_association":"NONE","active_lock_reason":null,"body":"I have been trying to use the http api in order to programmatically insert documents and labels.\r\nHowever I didn't find a way to make login work yet. Have been trying a few doccano api clients and a code suggestion in [another issue](https://github.com/chakki-works/doccano/issues/6#issuecomment-489924577) but I get the same error. \r\n\r\nHow to reproduce the behaviour\r\n---------\r\n\r\n```python\r\nimport requests\r\nimport json\r\n\r\nclass Client(object):\r\n    \"\"\"\r\n    Client code was inspired by: https://github.com/chakki-works/doccano/issues/6#issuecomment-489924577\r\n    Endpoints can be found here: https://github.com/chakki-works/doccano/blob/master/app/api/urls.py\r\n    \"\"\"\r\n    def __init__(self, entrypoint, username=None, password=None):\r\n        self.entrypoint = entrypoint\r\n        self.client = requests.Session()\r\n        self._login(username, password)\r\n\r\n    def _login(self, username, password):\r\n        url = f\"{self.entrypoint}/v1/auth-token\"\r\n        login = {\"username\": username, \"password\": password}\r\n        response = self.client.post(url, json=login)\r\n        api_token = response.json()[\"token\"]\r\n        self.client.headers.update({\"Authorization\": f\"Token {api_token}\"})\r\n\r\n\r\ndoccano_client = Client(\"http://localhost:3000\", \"admin\", \"password\")\r\n```\r\n200 http status code as response, but also a JSONDecodeError response\r\n```\r\n---------------------------------------------------------------------------\r\nJSONDecodeError                           Traceback (most recent call last)\r\n<ipython-input-6-512f67c518b4> in <module>\r\n      1 import requests\r\n----> 2 doccano_client = Client(\"http://localhost:3000\", \"admin\", \"password\")\r\n\r\n<ipython-input-4-525fc6bc89a1> in __init__(self, entrypoint, username, password)\r\n      7         self.entrypoint = entrypoint\r\n      8         self.client = requests.Session()\r\n----> 9         self._login(username, password)\r\n     10 \r\n     11     def _login(self, username, password):\r\n\r\n<ipython-input-4-525fc6bc89a1> in _login(self, username, password)\r\n     13         login = {\"username\": username, \"password\": password}\r\n     14         response = self.client.post(url, json=login)\r\n---> 15         api_token = response.json()[\"token\"]\r\n     16         self.client.headers.update({\"Authorization\": f\"Token {api_token}\"})\r\n     17 \r\n\r\n~/anaconda3/lib/python3.7/site-packages/requests/models.py in json(self, **kwargs)\r\n    895                     # used.\r\n    896                     pass\r\n--> 897         return complexjson.loads(self.text, **kwargs)\r\n    898 \r\n    899     @property\r\n\r\n~/anaconda3/lib/python3.7/json/__init__.py in loads(s, encoding, cls, object_hook, parse_float, parse_int, parse_constant, object_pairs_hook, **kw)\r\n    346             parse_int is None and parse_float is None and\r\n    347             parse_constant is None and object_pairs_hook is None and not kw):\r\n--> 348         return _default_decoder.decode(s)\r\n    349     if cls is None:\r\n    350         cls = JSONDecoder\r\n\r\n~/anaconda3/lib/python3.7/json/decoder.py in decode(self, s, _w)\r\n    335 \r\n    336         \"\"\"\r\n--> 337         obj, end = self.raw_decode(s, idx=_w(s, 0).end())\r\n    338         end = _w(s, end).end()\r\n    339         if end != len(s):\r\n\r\n~/anaconda3/lib/python3.7/json/decoder.py in raw_decode(self, s, idx)\r\n    353             obj, end = self.scan_once(s, idx)\r\n    354         except StopIteration as err:\r\n--> 355             raise JSONDecodeError(\"Expecting value\", s, err.value) from None\r\n    356         return obj, end\r\n\r\nJSONDecodeError: Expecting value: line 1 column 1 (char 0)\r\n```\r\nYour Environment\r\n---------\r\n<!-- Include details of your environment. -->\r\n\r\n*   Operating System: ubuntu 20.04\r\n*   Python Version Used: Python 3\r\n*   When you install doccano: May 2020\r\n*   How did you install doccano (Heroku button etc): git clone, docker-compose dev up\r\n","closed_by":{"login":"Hironsan","id":6737785,"node_id":"MDQ6VXNlcjY3Mzc3ODU=","avatar_url":"https://avatars.githubusercontent.com/u/6737785?v=4","gravatar_id":"","url":"https://api.github.com/users/Hironsan","html_url":"https://github.com/Hironsan","followers_url":"https://api.github.com/users/Hironsan/followers","following_url":"https://api.github.com/users/Hironsan/following{/other_user}","gists_url":"https://api.github.com/users/Hironsan/gists{/gist_id}","starred_url":"https://api.github.com/users/Hironsan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hironsan/subscriptions","organizations_url":"https://api.github.com/users/Hironsan/orgs","repos_url":"https://api.github.com/users/Hironsan/repos","events_url":"https://api.github.com/users/Hironsan/events{/privacy}","received_events_url":"https://api.github.com/users/Hironsan/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doccano/doccano/issues/771/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doccano/doccano/issues/771/timeline","performed_via_github_app":null,"state_reason":"completed"}