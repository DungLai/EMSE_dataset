{"url":"https://api.github.com/repos/doccano/doccano/issues/2063","repository_url":"https://api.github.com/repos/doccano/doccano","labels_url":"https://api.github.com/repos/doccano/doccano/issues/2063/labels{/name}","comments_url":"https://api.github.com/repos/doccano/doccano/issues/2063/comments","events_url":"https://api.github.com/repos/doccano/doccano/issues/2063/events","html_url":"https://github.com/doccano/doccano/issues/2063","id":1460514586,"node_id":"I_kwDOB-j9wM5XDa8a","number":2063,"title":"Import dataset - celery: task received but not executed.","user":{"login":"FrancescoScandiffio","id":20610941,"node_id":"MDQ6VXNlcjIwNjEwOTQx","avatar_url":"https://avatars.githubusercontent.com/u/20610941?v=4","gravatar_id":"","url":"https://api.github.com/users/FrancescoScandiffio","html_url":"https://github.com/FrancescoScandiffio","followers_url":"https://api.github.com/users/FrancescoScandiffio/followers","following_url":"https://api.github.com/users/FrancescoScandiffio/following{/other_user}","gists_url":"https://api.github.com/users/FrancescoScandiffio/gists{/gist_id}","starred_url":"https://api.github.com/users/FrancescoScandiffio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/FrancescoScandiffio/subscriptions","organizations_url":"https://api.github.com/users/FrancescoScandiffio/orgs","repos_url":"https://api.github.com/users/FrancescoScandiffio/repos","events_url":"https://api.github.com/users/FrancescoScandiffio/events{/privacy}","received_events_url":"https://api.github.com/users/FrancescoScandiffio/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-11-22T20:33:05Z","updated_at":"2022-11-30T12:58:08Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"How to reproduce the behaviour\r\n---------\r\n<!-- Before submitting an issue, make sure to check the docs and closed issues and FAQ to see if any of the solutions work for you. https://github.com/doccano/doccano/wiki/Frequently-Asked-Questions -->\r\n\r\n<!-- Include a code example or the steps that led to the problem. Please try to be as specific as possible. -->\r\n\r\nFollowing the workaround implemented in #2062, I managed to create a toy project but I encountered another problem when I tried to import the dateset. How to reproduce the issue:\r\n\r\n- create a new project, doesn't matter the type\r\n- try to upload a file. Again, doesn't matter the type nor the size. I have tried uploading files of different types and sizes one at a time, even a simple 100Bytes text file.\r\n- celery receives the input but the task is not executed. The client gets stuck on the loading page\r\n\r\n**Celery log**\r\n```\r\n[2022-11-22 20:19:58 +0100] [1756] [INFO] [django_drf_filepond.apps::ready::61] App init: no django-storages backend configured, using default (local) storage backend if set, otherwise you need to manage file storage independently of this app.\r\n\r\n -------------- celery@DESKTOP-1E01SIG v5.2.7 (dawn-chorus)\r\n--- ***** -----\r\n-- ******* ---- Windows-10-10.0.19044-SP0 2022-11-22 20:19:59\r\n- *** --- * ---\r\n- ** ---------- [config]\r\n- ** ---------- .> app:         config:0x2e596477c10\r\n- ** ---------- .> transport:   sqla+sqlite:///C:\\Users\\scandiffio\\Desktop\\GiustiziaAgile\\doccanoProject\\doccano\\backend\\db.sqlite3\r\n- ** ---------- .> results:\r\n- *** --- * --- .> concurrency: 1 (prefork)\r\n-- ******* ---- .> task events: OFF (enable -E to monitor tasks in this worker)\r\n--- ***** -----\r\n -------------- [queues]\r\n                .> celery           exchange=celery(direct) key=celery\r\n[tasks]\r\n  . data_export.celery_tasks.export_dataset\r\n  . data_import.celery_tasks.import_dataset\r\n  . health_check.contrib.celery.tasks.add\r\n\r\n[2022-11-22 20:19:59,127: INFO/MainProcess] Connected to sqla+sqlite:///C:\\Users\\scandiffio\\Desktop\\GiustiziaAgile\\doccanoProject\\doccano\\backend\\db.sqlite3\r\n[2022-11-22 20:19:59,143: INFO/MainProcess] celery@DESKTOP-1E01SIG ready.\r\n[2022-11-22 20:19:59,360: INFO/SpawnPoolWorker-1] child process 17660 calling self.run()\r\n[2022-11-22 20:20:00 +0100] [17660] [INFO] [django_drf_filepond.apps::ready::61] App init: no django-storages backend configured, using default (local) storage backend if set, otherwise you need to manage file storage independently of this app.\r\n[2022-11-22 20:21:58,738: INFO/MainProcess] Task data_import.celery_tasks.import_dataset[dc9c3291-022d-4173-8eae-bb18c5838651] received\r\n```\r\n\r\n**Client import request**\r\n```\r\nfetch(\"http://192.168.1.242:3000/v1/projects/2/upload\", {\r\n  \"headers\": {\r\n    \"accept\": \"application/json, text/plain, */*\",\r\n    \"accept-language\": \"it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7\",\r\n    \"content-type\": \"application/json\",\r\n    \"x-csrftoken\": _OMISSIS_\r\n    \"cookie\": _OMISSIS_\r\n    \"Referer\": \"http://192.168.1.242:3000/projects/2/dataset/import\",\r\n    \"Referrer-Policy\": \"strict-origin-when-cross-origin\"\r\n  },\r\n  \"body\": \"{\\\"format\\\":\\\"TextFile\\\",\\\"task\\\":\\\"SequenceLabeling\\\",\\\"uploadIds\\\":[\\\"DR527ME54w9FQCP6Mu8HL8\\\"],\\\"column_data\\\":\\\"\\\",\\\"column_label\\\":\\\"\\\",\\\"delimiter\\\":\\\"\\\",\\\"encoding\\\":\\\"utf_8\\\"}\",\r\n  \"method\": \"POST\"\r\n});\r\n```\r\n\r\n![image](https://user-images.githubusercontent.com/20610941/203409550-01809e1a-7b39-4da1-aa9e-89aee1a4be81.png)\r\n\r\n**Backend log**\r\n```\r\n[22/Nov/2022 20:58:32] \"POST /v1/projects/2/upload HTTP/1.1\" 200 50\r\n[22/Nov/2022 20:58:34] \"GET /v1/tasks/status/6747b0d4-3810-465a-8ace-ee210559c847 HTTP/1.1\" 200 42\r\n[22/Nov/2022 20:58:37] \"GET /v1/tasks/status/6747b0d4-3810-465a-8ace-ee210559c847 HTTP/1.1\" 200 42\r\n.\r\n.\r\n.\r\n[22/Nov/2022 21:05:13] \"GET /v1/tasks/status/6747b0d4-3810-465a-8ace-ee210559c847 HTTP/1.1\" 200 42\r\n[22/Nov/2022 21:05:16] \"GET /v1/tasks/status/6747b0d4-3810-465a-8ace-ee210559c847 HTTP/1.1\" 200 42\r\n```\r\nand never ends until client page is reloaded. After reloading the dataset is still empty.\r\n\r\nYour Environment\r\n---------\r\n<!-- Include details of your environment.-->\r\n*   Operating System: Windows 10 Pro, build  19044\r\n*   Python Version Used: 3.10.4\r\n*   When did you install doccano: 22 November 2022 (today)\r\n*   How did you install doccano: from source (packages managed with pip)\r\n\r\n\r\n------\r\nI will look at how feasible it is to solve it myself or avoid using celery and process the data input differently, suggestions are welcome.  These problems - this one and #2062 - are not present in a docker-image I tried a few weeks ago (I don't remember the version right now) but I was hoping to easily add a few features I need and deploy the application without docker. ","closed_by":null,"reactions":{"url":"https://api.github.com/repos/doccano/doccano/issues/2063/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doccano/doccano/issues/2063/timeline","performed_via_github_app":null,"state_reason":null}