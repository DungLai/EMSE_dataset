{"url":"https://api.github.com/repos/doccano/doccano/issues/62","repository_url":"https://api.github.com/repos/doccano/doccano","labels_url":"https://api.github.com/repos/doccano/doccano/issues/62/labels{/name}","comments_url":"https://api.github.com/repos/doccano/doccano/issues/62/comments","events_url":"https://api.github.com/repos/doccano/doccano/issues/62/events","html_url":"https://github.com/doccano/doccano/issues/62","id":397080962,"node_id":"MDU6SXNzdWUzOTcwODA5NjI=","number":62,"title":"Save new predicted annotations in db -- auto-labelling","user":{"login":"chitang1990","id":35554592,"node_id":"MDQ6VXNlcjM1NTU0NTky","avatar_url":"https://avatars.githubusercontent.com/u/35554592?v=4","gravatar_id":"","url":"https://api.github.com/users/chitang1990","html_url":"https://github.com/chitang1990","followers_url":"https://api.github.com/users/chitang1990/followers","following_url":"https://api.github.com/users/chitang1990/following{/other_user}","gists_url":"https://api.github.com/users/chitang1990/gists{/gist_id}","starred_url":"https://api.github.com/users/chitang1990/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chitang1990/subscriptions","organizations_url":"https://api.github.com/users/chitang1990/orgs","repos_url":"https://api.github.com/users/chitang1990/repos","events_url":"https://api.github.com/users/chitang1990/events{/privacy}","received_events_url":"https://api.github.com/users/chitang1990/received_events","type":"User","site_admin":false},"labels":[{"id":927327728,"node_id":"MDU6TGFiZWw5MjczMjc3Mjg=","url":"https://api.github.com/repos/doccano/doccano/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-01-08T20:52:32Z","updated_at":"2019-01-11T06:29:28Z","closed_at":"2019-01-11T06:29:28Z","author_association":"NONE","active_lock_reason":null,"body":"I do notice the auto-labelling #18 is under developing. However, I want to quickly have this function for my own development. \r\nI followed the auto-labelling branch and did some changes. I am not familiar with Django and I have a problem saving the prediction results to Database.  \r\nHere is my AutoLabeling API. Looking forward to any suggestion and help. Very much appreciate it!\r\n\r\n### Source code / logs\r\nclass AutoLabelling(generics.RetrieveUpdateDestroyAPIView):\r\n\r\n    permission_classes = (IsAuthenticated, IsProjectUser)\r\n\r\n    def get_serializer_class(self):\r\n        project = get_object_or_404(Project, pk=self.kwargs['project_id'])\r\n        self.serializer_class = project.get_annotation_serializer()\r\n        return self.serializer_class\r\n\r\n    def get_annotation_class(self):\r\n        project = get_object_or_404(Project, pk=self.kwargs['project_id'])\r\n        self.annotation_class = project.get_annotation_class()\r\n        return self.annotation_class\r\n\r\n    def get_queryset(self):\r\n        '''\r\n        Format:\r\n            {'id': 47, 'prob': 0.0, 'manual': False, 'user_id': 1,\r\n            'document_id': 1, 'label_id': 1, 'start_offset': 11, 'end_offset': 17}\r\n        '''\r\n        document = get_object_or_404(Document, pk=self.kwargs['doc_id'])\r\n        queryset = document.get_annotations()\r\n        queryset = queryset.filter(user=self.request.user)\r\n        return queryset\r\n\r\n    def get(self, request, *args, **kwargs):\r\n        \"\"\" Reinitiate with a list of predicted entities.\r\n\r\n        1. Get the preded_annotations from NERModel\r\n        2. Delete the old annotations in database\r\n        3. Store the prediced results\r\n        \"\"\"\r\n        project = get_object_or_404(Project, pk=self.kwargs['project_id'])\r\n        document = project.documents.get(id=self.kwargs['doc_id'])\r\n\r\n        # Delete the annotations\r\n        queryset = self.get_queryset()\r\n        queryset.delete()\r\n\r\n        preded_annotations = [\r\n            {\"label\": 1, \"start_offset\": 34, \"end_offset\": 41},\r\n            {\"label\": 2, \"start_offset\": 3, \"end_offset\": 10}\r\n        ]\r\n\r\n        # Question:\r\n        # how to save the database with new annotations\r\n        # can I use the AnnotationList to save here?\r\n\r\n        return Response(preded_annotations)","closed_by":{"login":"icoxfog417","id":544269,"node_id":"MDQ6VXNlcjU0NDI2OQ==","avatar_url":"https://avatars.githubusercontent.com/u/544269?v=4","gravatar_id":"","url":"https://api.github.com/users/icoxfog417","html_url":"https://github.com/icoxfog417","followers_url":"https://api.github.com/users/icoxfog417/followers","following_url":"https://api.github.com/users/icoxfog417/following{/other_user}","gists_url":"https://api.github.com/users/icoxfog417/gists{/gist_id}","starred_url":"https://api.github.com/users/icoxfog417/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icoxfog417/subscriptions","organizations_url":"https://api.github.com/users/icoxfog417/orgs","repos_url":"https://api.github.com/users/icoxfog417/repos","events_url":"https://api.github.com/users/icoxfog417/events{/privacy}","received_events_url":"https://api.github.com/users/icoxfog417/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doccano/doccano/issues/62/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doccano/doccano/issues/62/timeline","performed_via_github_app":null,"state_reason":"completed"}