{"url":"https://api.github.com/repos/doccano/doccano/issues/1417","repository_url":"https://api.github.com/repos/doccano/doccano","labels_url":"https://api.github.com/repos/doccano/doccano/issues/1417/labels{/name}","comments_url":"https://api.github.com/repos/doccano/doccano/issues/1417/comments","events_url":"https://api.github.com/repos/doccano/doccano/issues/1417/events","html_url":"https://github.com/doccano/doccano/issues/1417","id":924688129,"node_id":"MDU6SXNzdWU5MjQ2ODgxMjk=","number":1417,"title":"How to connect to a local REST API for auto annotation?","user":{"login":"armsp","id":12681262,"node_id":"MDQ6VXNlcjEyNjgxMjYy","avatar_url":"https://avatars.githubusercontent.com/u/12681262?v=4","gravatar_id":"","url":"https://api.github.com/users/armsp","html_url":"https://github.com/armsp","followers_url":"https://api.github.com/users/armsp/followers","following_url":"https://api.github.com/users/armsp/following{/other_user}","gists_url":"https://api.github.com/users/armsp/gists{/gist_id}","starred_url":"https://api.github.com/users/armsp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/armsp/subscriptions","organizations_url":"https://api.github.com/users/armsp/orgs","repos_url":"https://api.github.com/users/armsp/repos","events_url":"https://api.github.com/users/armsp/events{/privacy}","received_events_url":"https://api.github.com/users/armsp/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":18,"created_at":"2021-06-18T08:48:35Z","updated_at":"2021-09-09T06:26:51Z","closed_at":"2021-06-23T12:05:09Z","author_association":"NONE","active_lock_reason":null,"body":"How to reproduce the behaviour\r\n---------\r\nI want to use a local auto-annotator using spaCy. So I made a simple API using FastAPI as follows -\r\nNOTE: Right now it does not annotate, but the idea is to be able to communicate first. Atleast for now I should get the input text back as it is.\r\nAlso, since the rest api is local, I exposed port 7000 of container to 7000 of my host\r\n```py\r\nfrom fastapi import FastAPI\r\nimport uvicorn\r\nfrom pydantic import BaseModel\r\n\r\n\r\nclass TextToAnnotate(BaseModel):\r\n    text: str\r\n\r\napp = FastAPI()\r\n\r\n@app.post(\"/auto_annotate\")\r\nasync def auto_annotate(doc: TextToAnnotate):\r\n    return {\"message\": doc.text}\r\n\r\nif __name__==\"__main__\":\r\n    uvicorn.run(\"auto_annotate:app\", host='0.0.0.0', port=7000)\r\n```\r\nI checked this API from Postman by sending a simple text from body and was able to get the message back -\r\n![image](https://user-images.githubusercontent.com/12681262/122534084-d0d3f180-d03f-11eb-8a7f-df5a62fc7ea2.png)\r\n\r\nThen in doccano, I tried to setup the Auto Annotator as follows -\r\n1. Config Template - Custom REST Request\r\n![image](https://user-images.githubusercontent.com/12681262/122531370-0cb98780-d03d-11eb-88ad-8a9dcbae667a.png)\r\n2. Parameters, headers, Body and Testing\r\nurl         -` 0.0.0.0:7000/auto_annotate`\r\nmethod - `POST`\r\n![image](https://user-images.githubusercontent.com/12681262/122533523-4b504180-d03f-11eb-92f0-30acfd4b24fa.png)\r\n\r\n3. Params  - Nothing\r\n4. Headers - `Content-Type` - `application/json`\r\n5. Body      - Just provided the key as `text`\r\n![image](https://user-images.githubusercontent.com/12681262/122533586-602cd500-d03f-11eb-968c-7d4478fb978a.png)\r\n\r\n6. Test the parameters - Sample Text - \"Does this work?\"\r\n![image](https://user-images.githubusercontent.com/12681262/122531656-573b0400-d03d-11eb-805d-4af67c4dec1e.png)\r\nI don't get any output. it says that it **Failed to establish a connection**\r\n\r\n\r\nYour Environment\r\n---------\r\n<!-- Include details of your environment. -->\r\n\r\n*   Operating System: Windows 10\r\n*   Python Version Used: Whatever ships with the Docker image\r\n*   When you install doccano: 17th June 2021\r\n*   How did you install doccano (Heroku button etc): Dockerfile\r\n","closed_by":{"login":"armsp","id":12681262,"node_id":"MDQ6VXNlcjEyNjgxMjYy","avatar_url":"https://avatars.githubusercontent.com/u/12681262?v=4","gravatar_id":"","url":"https://api.github.com/users/armsp","html_url":"https://github.com/armsp","followers_url":"https://api.github.com/users/armsp/followers","following_url":"https://api.github.com/users/armsp/following{/other_user}","gists_url":"https://api.github.com/users/armsp/gists{/gist_id}","starred_url":"https://api.github.com/users/armsp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/armsp/subscriptions","organizations_url":"https://api.github.com/users/armsp/orgs","repos_url":"https://api.github.com/users/armsp/repos","events_url":"https://api.github.com/users/armsp/events{/privacy}","received_events_url":"https://api.github.com/users/armsp/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doccano/doccano/issues/1417/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doccano/doccano/issues/1417/timeline","performed_via_github_app":null,"state_reason":"completed"}