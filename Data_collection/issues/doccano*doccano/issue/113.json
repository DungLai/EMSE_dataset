{"url":"https://api.github.com/repos/doccano/doccano/issues/113","repository_url":"https://api.github.com/repos/doccano/doccano","labels_url":"https://api.github.com/repos/doccano/doccano/issues/113/labels{/name}","comments_url":"https://api.github.com/repos/doccano/doccano/issues/113/comments","events_url":"https://api.github.com/repos/doccano/doccano/issues/113/events","html_url":"https://github.com/doccano/doccano/issues/113","id":421382108,"node_id":"MDU6SXNzdWU0MjEzODIxMDg=","number":113,"title":"Alignment for import data format and export data format","user":{"login":"BrambleXu","id":10768193,"node_id":"MDQ6VXNlcjEwNzY4MTkz","avatar_url":"https://avatars.githubusercontent.com/u/10768193?v=4","gravatar_id":"","url":"https://api.github.com/users/BrambleXu","html_url":"https://github.com/BrambleXu","followers_url":"https://api.github.com/users/BrambleXu/followers","following_url":"https://api.github.com/users/BrambleXu/following{/other_user}","gists_url":"https://api.github.com/users/BrambleXu/gists{/gist_id}","starred_url":"https://api.github.com/users/BrambleXu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BrambleXu/subscriptions","organizations_url":"https://api.github.com/users/BrambleXu/orgs","repos_url":"https://api.github.com/users/BrambleXu/repos","events_url":"https://api.github.com/users/BrambleXu/events{/privacy}","received_events_url":"https://api.github.com/users/BrambleXu/received_events","type":"User","site_admin":false},"labels":[{"id":927327721,"node_id":"MDU6TGFiZWw5MjczMjc3MjE=","url":"https://api.github.com/repos/doccano/doccano/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"Improvement on existing feature"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-03-15T07:10:30Z","updated_at":"2019-06-11T12:53:35Z","closed_at":"2019-06-11T12:53:35Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Right row doccano support for importing labeled dataset, and it is a wonderful feature for the [human in the loop](https://github.com/chakki-works/doccano/issues/11#issuecomment-464106275). \r\n\r\nBut I noticed that the import data format is different from the export data format. Take the sequence labeling task as an example.\r\n\r\nThe labeled data format is like below. \r\n```\r\n{\"text\": \"EU rejects German call to boycott British lamb.\", \"labels\": [ [0, 2, \"ORG\"], [11, 17, \"MISC\"]]}\r\n{\"text\": \"Peter Blackburn\", \"labels\": [ [0, 15, \"PERSON\"] ]}\r\n{\"text\": \"President Obama\", \"labels\": [ [10, 15, \"PERSON\"] ]}\r\n```\r\nThe output data format looks like this. I will call it `format 0` in below.\r\n```\r\n{\"id\": 15, \"text\": \"EU rejects German call to boycott British lamb.\", \"annotations\": [{\"label\": 7, \"start_offset\": 0, \"end_offset\": 2, \"user\": 1}, {\"label\": 6, \"start_offset\": 11, \"end_offset\": 17, \"user\": 1}], \"meta\": {}}\r\n{\"id\": 16, \"text\": \"Peter Blackburn\", \"annotations\": [{\"label\": 8, \"start_offset\": 0, \"end_offset\": 15, \"user\": 1}], \"meta\": {}}\r\n{\"id\": 17, \"text\": \"President Obama\", \"annotations\": [{\"label\": 8, \"start_offset\": 10, \"end_offset\": 15, \"user\": 1}], \"meta\": {}}\r\n```\r\nThe major problem is that the output only show the label id, rather than the label name. So if I want to import this data into doccano again, I have to figure out which label belong to which word. And the output key name is `annotations` instead of `labels`. It would be better to make them use the same key name for the consistency.  We can use `labels` as the key for import data, export data and in classification task and sequecne to sequence task. \r\n\r\n# Method 1\r\n\r\nThe output format could like this, `format 1`:\r\n```\r\n{\r\n\"doc_id\": 15, \"text\": \"EU rejects German call to boycott British lamb.\",  \r\n\"labels\": [[0, 2, \"ORG\"], [11, 17, \"MISC\"]], \r\n\"meta\": {}\r\n}\r\n```\r\nThis format can **derectly import to doccano again**, and can be read by spaCy easliy. \r\n\r\n![image](https://user-images.githubusercontent.com/10768193/54412012-882c8000-4734-11e9-9da8-b8bdc1456203.png)\r\n\r\nThe output is like this\r\n```\r\n{\r\n\"doc_id\": 18, \r\n\"text\": \"EU rejects German call to boycott British lamb.\",  \r\n\"labels\": [[0, 2, \"ORG\"], [11, 17, \"MISC\"], [34, 41, \"ORG\"], \r\n\"meta\": {}\r\n}\r\n```\r\nThis is the most simple format. We only need to change the export code.\r\n\r\nAnother format for this is using the dictionary to save the label information, just like `format 0`. It would make the export data more readable and we need to change the format of import data to be the same with `format 0`. \r\n\r\n```\r\n{\r\n\"text\": \"EU rejects German call to boycott British lamb.\", \r\n\"annotations\": [{\"label_name\": \"label1\", \"start_offset\": 0, \"end_offset\": 2}, {\"label_name\": \"label2\", \"start_offset\": 11, \"end_offset\": 17, \"user\": 1}], \r\n\"meta\": {}\r\n}\r\n```\r\n\r\nBut we can't know who annotate which label in this way.\r\n\r\n# Method 2\r\n\r\nWe can save the `doc_id`, `label_id`, `user_id` in `meta` key. \r\n\r\nThe output data `format 2`\r\n\r\n```\r\n{\r\n\"doc_id\": 18, \"text\": \"EU rejects German call to boycott British lamb.\",  \r\n \"labels\": [[0, 2, \"ORG\", \"user1\"], [11, 17, \"MISC\", \"user2\"]], \r\n \"meta\": {\"label_id\": {\"MISC\": 6, \"ORG\":8,}, \"user_id\": {\"user1\": 1, \"user2\":2}}\r\n}\r\n```\r\n\r\nBut this format needs to change the import data code to deal with the \"user1\" value in `[0, 2, \"ORG\", \"user1\"]` if the user provides this value. \r\n\r\nThe goal is directly to import this data format to doccano again. \r\n\r\n# Method 3\r\n\r\nThe user can write the script to translate the export format to import format. But still, we should provide enough information in the export data. We should include the label name into `format 0` and the `labels` or `annotations` key name should be consistent. \r\n\r\n# Method 4 \r\n\r\nTwo download buttons, one button for the simple export format (`format 1`) so the user can directly import the data into doccano again, and use spaCy deal with data easily. The second button for the detailed export format (`format 0` with label name). Users should write the script by themselves. \r\n","closed_by":{"login":"Hironsan","id":6737785,"node_id":"MDQ6VXNlcjY3Mzc3ODU=","avatar_url":"https://avatars.githubusercontent.com/u/6737785?v=4","gravatar_id":"","url":"https://api.github.com/users/Hironsan","html_url":"https://github.com/Hironsan","followers_url":"https://api.github.com/users/Hironsan/followers","following_url":"https://api.github.com/users/Hironsan/following{/other_user}","gists_url":"https://api.github.com/users/Hironsan/gists{/gist_id}","starred_url":"https://api.github.com/users/Hironsan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hironsan/subscriptions","organizations_url":"https://api.github.com/users/Hironsan/orgs","repos_url":"https://api.github.com/users/Hironsan/repos","events_url":"https://api.github.com/users/Hironsan/events{/privacy}","received_events_url":"https://api.github.com/users/Hironsan/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doccano/doccano/issues/113/reactions","total_count":7,"+1":7,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doccano/doccano/issues/113/timeline","performed_via_github_app":null,"state_reason":"completed"}