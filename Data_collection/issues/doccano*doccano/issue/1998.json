{"url":"https://api.github.com/repos/doccano/doccano/issues/1998","repository_url":"https://api.github.com/repos/doccano/doccano","labels_url":"https://api.github.com/repos/doccano/doccano/issues/1998/labels{/name}","comments_url":"https://api.github.com/repos/doccano/doccano/issues/1998/comments","events_url":"https://api.github.com/repos/doccano/doccano/issues/1998/events","html_url":"https://github.com/doccano/doccano/issues/1998","id":1371674986,"node_id":"I_kwDOB-j9wM5Rwhlq","number":1998,"title":"Installation using mysql","user":{"login":"SemGa92","id":50732146,"node_id":"MDQ6VXNlcjUwNzMyMTQ2","avatar_url":"https://avatars.githubusercontent.com/u/50732146?v=4","gravatar_id":"","url":"https://api.github.com/users/SemGa92","html_url":"https://github.com/SemGa92","followers_url":"https://api.github.com/users/SemGa92/followers","following_url":"https://api.github.com/users/SemGa92/following{/other_user}","gists_url":"https://api.github.com/users/SemGa92/gists{/gist_id}","starred_url":"https://api.github.com/users/SemGa92/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SemGa92/subscriptions","organizations_url":"https://api.github.com/users/SemGa92/orgs","repos_url":"https://api.github.com/users/SemGa92/repos","events_url":"https://api.github.com/users/SemGa92/events{/privacy}","received_events_url":"https://api.github.com/users/SemGa92/received_events","type":"User","site_admin":false},"labels":[{"id":927327719,"node_id":"MDU6TGFiZWw5MjczMjc3MTk=","url":"https://api.github.com/repos/doccano/doccano/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":927327728,"node_id":"MDU6TGFiZWw5MjczMjc3Mjg=","url":"https://api.github.com/repos/doccano/doccano/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-09-13T15:55:39Z","updated_at":"2022-09-14T06:32:02Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Hello, \r\n\r\nthank you for the great work on doccano project!\r\n\r\nFrom documentation:  **_\"You can also use other database systems like PostgreSQL, MySQL, and so on\"_** but I don't find anywhere a guide, as written for Postegre, about how I can init doccano with mysql instead of sqlite.\r\n\r\nIf there is a way to easily activate it, can you leave it in the comments? Thank you.\r\n\r\nMeanwhile, I am trying to configure it by myself but I keep getting the same error..\r\n\r\n\r\n<!-- Before submitting an issue, make sure to check the docs and closed issues and FAQ to see if any of the solutions work for you. https://github.com/doccano/doccano/wiki/Frequently-Asked-Questions -->\r\n\r\nHow to reproduce the problem\r\n---------\r\n```bash\r\npip install mysqlclient==2.1.1\r\npip install doccano==1.8.0\r\nexport DATABASE_URL=\"mysql://username:password@host:port/db_name\"\r\ndoccano init\r\n```\r\n<!-- Include the details of how the problem occurred. Which option did you choose to install doccano? Did you come across an error? What else did you try? -->\r\n\r\n```bash\r\nSetup Database.\r\nOperations to perform:\r\n  Apply all migrations: admin, api, auth, authtoken, auto_labeling, contenttypes, data_export, data_import, django_celery_results, django_drf_filepond, examples, label_types, labels, projects, roles, sessions\r\nRunning migrations:\r\n  Applying contenttypes.0001_initial... OK\r\n  Applying auth.0001_initial... OK\r\n  Applying admin.0001_initial... OK\r\n  Applying admin.0002_logentry_remove_auto_add... OK\r\n  Applying admin.0003_logentry_add_action_flag_choices... OK\r\n  Applying contenttypes.0002_remove_content_type_name... OK\r\n  Applying api.0001_initial... OK\r\n  Applying api.0002_speech2text... OK\r\n  Applying api.0002_project_single_class_classification... OK\r\n  Applying api.0003_merge_20200612_0205... OK\r\n  Applying api.0002_comment... OK\r\n  Applying api.0004_merge_20210114_1117... OK\r\n  Applying api.0005_auto_20210201_0603... OK\r\n  Applying api.0005_auto_20210120_1730... OK\r\n  Applying api.0006_merge_20210221_1258... OK\r\n  Applying api.0007_auto_20210301_0302... OK\r\n  Applying api.0008_auto_20210302_1013... OK\r\n  Applying api.0009_auto_20210411_2330... OK\r\n  Applying api.0010_auto_20210413_0249... OK\r\n  Applying api.0009_tag... OK\r\n  Applying api.0011_merge_0009_tag_0010_auto_20210413_0249... OK\r\n  Applying api.0012_auto_20210514_0654...Traceback (most recent call last):\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/db/backends/utils.py\", line 89, in _execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/db/backends/mysql/base.py\", line 75, in execute\r\n    return self.cursor.execute(query, args)\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/MySQLdb/cursors.py\", line 206, in execute\r\n    res = self._query(query)\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/MySQLdb/cursors.py\", line 319, in _query\r\n    db.query(q)\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/MySQLdb/connections.py\", line 254, in query\r\n    _mysql.connection.query(self, query)\r\nMySQLdb.OperationalError: (1170, \"BLOB/TEXT column 'text' used in key specification without a key length\")\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/samuele/.local/bin/doccano\", line 8, in <module>\r\n    sys.exit(main())\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/backend/cli.py\", line 160, in main\r\n    args.handler(args)\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/backend/cli.py\", line 75, in command_db_init\r\n    management.call_command(\"migrate\")\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/core/management/__init__.py\", line 198, in call_command\r\n    return command.execute(*args, **defaults)\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/core/management/base.py\", line 460, in execute\r\n    output = self.handle(*args, **options)\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/core/management/base.py\", line 98, in wrapped\r\n    res = handle_func(*args, **kwargs)\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/core/management/commands/migrate.py\", line 290, in handle\r\n    post_migrate_state = executor.migrate(\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/db/migrations/executor.py\", line 131, in migrate\r\n    state = self._migrate_all_forwards(\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/db/migrations/executor.py\", line 163, in _migrate_all_forwards\r\n    state = self.apply_migration(\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/db/migrations/executor.py\", line 245, in apply_migration\r\n    with self.connection.schema_editor(\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/db/backends/base/schema.py\", line 157, in __exit__\r\n    self.execute(sql)\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/db/backends/base/schema.py\", line 192, in execute\r\n    cursor.execute(sql, params)\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/db/backends/utils.py\", line 67, in execute\r\n    return self._execute_with_wrappers(\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/db/backends/utils.py\", line 80, in _execute_with_wrappers\r\n    return executor(sql, params, many, context)\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/db/backends/utils.py\", line 84, in _execute\r\n    with self.db.wrap_database_errors:\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/db/utils.py\", line 91, in __exit__\r\n    raise dj_exc_value.with_traceback(traceback) from exc_value\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/db/backends/utils.py\", line 89, in _execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/django/db/backends/mysql/base.py\", line 75, in execute\r\n    return self.cursor.execute(query, args)\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/MySQLdb/cursors.py\", line 206, in execute\r\n    res = self._query(query)\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/MySQLdb/cursors.py\", line 319, in _query\r\n    db.query(q)\r\n  File \"/home/samuele/.local/lib/python3.10/site-packages/MySQLdb/connections.py\", line 254, in query\r\n    _mysql.connection.query(self, query)\r\ndjango.db.utils.OperationalError: (1170, \"BLOB/TEXT column 'text' used in key specification without a key length\")\r\n\r\n```\r\nI thought that there was something wrong with my local configuration, so I tried the same approach inside docker container.\r\nBy default, doccano/doccano image seems not to support mysqlclient, so I have modified a little the Dockerfile installing **default-libmysqlclient-dev** at system level and **mysqlclient==2.1.1** at pip level. But running the container I still get the same error...\r\n\r\n```bash\r\ndocker container create --name doccano   \\\r\n-e \"ADMIN_USERNAME=admin\"  \\\r\n-e \"ADMIN_EMAIL=admin@example.com\"  \\\r\n-e \"ADMIN_PASSWORD=password\"  \\\r\n-e \"DATABASE_URL=mysql://username:password@host:port/db_name\"  \\\r\n-p 8000:8000 doccano\r\n\r\ndocker container start doccano\r\n```\r\n\r\n```bash\r\nMaking staticfiles\r\nInitializing database\r\nOperations to perform:\r\n  Apply all migrations: admin, api, auth, authtoken, auto_labeling, contenttypes, data_export, data_import, django_celery_results, django_drf_filepond, examples, label_types, labels, projects, roles, sessions\r\nRunning migrations:\r\n  Applying contenttypes.0001_initial... OK\r\n  Applying auth.0001_initial... OK\r\n  Applying admin.0001_initial... OK\r\n  Applying admin.0002_logentry_remove_auto_add... OK\r\n  Applying admin.0003_logentry_add_action_flag_choices... OK\r\n  Applying contenttypes.0002_remove_content_type_name... OK\r\n  Applying api.0001_initial... OK\r\n  Applying api.0002_speech2text... OK\r\n  Applying api.0002_project_single_class_classification... OK\r\n  Applying api.0003_merge_20200612_0205... OK\r\n  Applying api.0002_comment... OK\r\n  Applying api.0004_merge_20210114_1117... OK\r\n  Applying api.0005_auto_20210201_0603... OK\r\n  Applying api.0005_auto_20210120_1730... OK\r\n  Applying api.0006_merge_20210221_1258... OK\r\n  Applying api.0007_auto_20210301_0302... OK\r\n  Applying api.0008_auto_20210302_1013... OK\r\n  Applying api.0009_auto_20210411_2330... OK\r\n  Applying api.0010_auto_20210413_0249... OK\r\n  Applying api.0009_tag... OK\r\n  Applying api.0011_merge_0009_tag_0010_auto_20210413_0249... OK\r\nSystem check identified some issues:\r\n\r\nWARNINGS:\r\nlabels.BoundingBox: (models.W027) MySQL does not support check constraints.\r\n\tHINT: A constraint won't be created. Silence this warning if you don't care about it.\r\nlabels.Span: (models.W027) MySQL does not support check constraints.\r\n\tHINT: A constraint won't be created. Silence this warning if you don't care about it.\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/backends/utils.py\", line 89, in _execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/backends/mysql/base.py\", line 75, in execute\r\n    return self.cursor.execute(query, args)\r\n  File \"/usr/local/lib/python3.8/site-packages/MySQLdb/cursors.py\", line 206, in execute\r\n    res = self._query(query)\r\n  File \"/usr/local/lib/python3.8/site-packages/MySQLdb/cursors.py\", line 319, in _query\r\n    db.query(q)\r\n  File \"/usr/local/lib/python3.8/site-packages/MySQLdb/connections.py\", line 254, in query\r\n    _mysql.connection.query(self, query)\r\nMySQLdb.OperationalError: (1170, \"BLOB/TEXT column 'text' used in key specification without a key length\")\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"manage.py\", line 15, in <module>\r\n    execute_from_command_line(sys.argv)\r\n  File \"/usr/local/lib/python3.8/site-packages/django/core/management/__init__.py\", line 446, in execute_from_command_line\r\n    utility.execute()\r\n  File \"/usr/local/lib/python3.8/site-packages/django/core/management/__init__.py\", line 440, in execute\r\n    self.fetch_command(subcommand).run_from_argv(self.argv)\r\n  File \"/usr/local/lib/python3.8/site-packages/django/core/management/base.py\", line 414, in run_from_argv\r\n    self.execute(*args, **cmd_options)\r\n  File \"/usr/local/lib/python3.8/site-packages/django/core/management/base.py\", line 460, in execute\r\n    output = self.handle(*args, **options)\r\n  File \"/usr/local/lib/python3.8/site-packages/django/core/management/base.py\", line 98, in wrapped\r\n    res = handle_func(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.8/site-packages/django/core/management/commands/migrate.py\", line 290, in handle\r\n    post_migrate_state = executor.migrate(\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/migrations/executor.py\", line 131, in migrate\r\n    state = self._migrate_all_forwards(\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/migrations/executor.py\", line 163, in _migrate_all_forwards\r\n    state = self.apply_migration(\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/migrations/executor.py\", line 251, in apply_migration\r\n    migration_recorded = True\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/backends/base/schema.py\", line 157, in __exit__\r\n    self.execute(sql)\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/backends/base/schema.py\", line 192, in execute\r\n    cursor.execute(sql, params)\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/backends/utils.py\", line 67, in execute\r\n    return self._execute_with_wrappers(\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/backends/utils.py\", line 80, in _execute_with_wrappers\r\n    return executor(sql, params, many, context)\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/backends/utils.py\", line 89, in _execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/utils.py\", line 91, in __exit__\r\n    raise dj_exc_value.with_traceback(traceback) from exc_value\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/backends/utils.py\", line 89, in _execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/backends/mysql/base.py\", line 75, in execute\r\n    return self.cursor.execute(query, args)\r\n  File \"/usr/local/lib/python3.8/site-packages/MySQLdb/cursors.py\", line 206, in execute\r\n    res = self._query(query)\r\n  File \"/usr/local/lib/python3.8/site-packages/MySQLdb/cursors.py\", line 319, in _query\r\n    db.query(q)\r\n  File \"/usr/local/lib/python3.8/site-packages/MySQLdb/connections.py\", line 254, in query\r\n    _mysql.connection.query(self, query)\r\ndjango.db.utils.OperationalError: (1170, \"BLOB/TEXT column 'text' used in key specification without a key length\")\r\n\r\n```\r\nThe final purpose is to deploy doccano on Kubernetes, but from the issues I cannot find a solution to let doccano work with mysql as expected.\r\n\r\nMy Environment\r\n---------\r\n<!-- Include details of your environment.-->\r\n*   Operating System: Ubuntu 22.04\r\n*   local Mysql version: 5.7, 8\r\n*   local pip version: 22.0.2\r\n*   local python version: 3.10.4\r\n*   How did you install doccano: pip and docker","closed_by":null,"reactions":{"url":"https://api.github.com/repos/doccano/doccano/issues/1998/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doccano/doccano/issues/1998/timeline","performed_via_github_app":null,"state_reason":null}