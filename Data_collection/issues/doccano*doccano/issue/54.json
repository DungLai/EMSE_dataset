{"url":"https://api.github.com/repos/doccano/doccano/issues/54","repository_url":"https://api.github.com/repos/doccano/doccano","labels_url":"https://api.github.com/repos/doccano/doccano/issues/54/labels{/name}","comments_url":"https://api.github.com/repos/doccano/doccano/issues/54/comments","events_url":"https://api.github.com/repos/doccano/doccano/issues/54/events","html_url":"https://github.com/doccano/doccano/issues/54","id":394294040,"node_id":"MDU6SXNzdWUzOTQyOTQwNDA=","number":54,"title":"Cannot delete labels and annoate entities","user":{"login":"jtangchi","id":21078228,"node_id":"MDQ6VXNlcjIxMDc4MjI4","avatar_url":"https://avatars.githubusercontent.com/u/21078228?v=4","gravatar_id":"","url":"https://api.github.com/users/jtangchi","html_url":"https://github.com/jtangchi","followers_url":"https://api.github.com/users/jtangchi/followers","following_url":"https://api.github.com/users/jtangchi/following{/other_user}","gists_url":"https://api.github.com/users/jtangchi/gists{/gist_id}","starred_url":"https://api.github.com/users/jtangchi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtangchi/subscriptions","organizations_url":"https://api.github.com/users/jtangchi/orgs","repos_url":"https://api.github.com/users/jtangchi/repos","events_url":"https://api.github.com/users/jtangchi/events{/privacy}","received_events_url":"https://api.github.com/users/jtangchi/received_events","type":"User","site_admin":false},"labels":[{"id":927327720,"node_id":"MDU6TGFiZWw5MjczMjc3MjA=","url":"https://api.github.com/repos/doccano/doccano/labels/duplicate","name":"duplicate","color":"cfd3d7","default":true,"description":"This issue or pull request already exists"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-12-27T04:53:54Z","updated_at":"2018-12-27T06:28:07Z","closed_at":"2018-12-27T06:28:07Z","author_association":"NONE","active_lock_reason":null,"body":"### System information\r\n- Linux Ubuntu 16.04\r\n- Python version: 3.6\r\n\r\n### Describe the problem\r\nBug report.\r\nI follow the tutorial and try to annotate few simple entities such as Location, Person, etc.\r\nI upload the sample data(text format, each line is a sentence without line break).\r\nTwo bugs are both related to django database (sqlite3 in my case) issue.\r\n1) I cannot delete the labels I created in Label editor section.\r\n2) I cannot annotate entity in Annotate Data section.\r\n\r\nI have spent few hours reading the source code and trying to debug the issue. However, I didn't find the solution. I printed out the some logs. The query indicates a insertion into table 'server_sequenceannotation', however, the error shows django.db.utils.OperationalError: no such table: main.server_label__old which doesnot exist in the sqlite3 tables. The 'using' parameter in the traceback error is 'default'. I suspect this might be the reason but I am not very sure.\r\nPlease help with any suggestion. Very much appreciate it!\r\n\r\n\r\n### Source code / logs\r\nTraceback for case1:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/utils.py\", line 85, in _execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/sqlite3/base.py\", line 303, in execute\r\n    return Database.Cursor.execute(self, query, params)\r\nsqlite3.OperationalError: no such table: main.server_document__old\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/core/handlers/exception.py\", line 35, in inner\r\n    response = get_response(request)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/core/handlers/base.py\", line 128, in _get_response\r\n    response = self.process_exception_by_middleware(e, request)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/core/handlers/base.py\", line 126, in _get_response\r\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/views/decorators/csrf.py\", line 54, in wrapped_view\r\n    return view_func(*args, **kwargs)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/views/generic/base.py\", line 69, in view\r\n    return self.dispatch(request, *args, **kwargs)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/rest_framework/views.py\", line 483, in dispatch\r\n    response = self.handle_exception(exc)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/rest_framework/views.py\", line 443, in handle_exception\r\n    self.raise_uncaught_exception(exc)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/rest_framework/views.py\", line 480, in dispatch\r\n    response = handler(request, *args, **kwargs)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/rest_framework/generics.py\", line 293, in delete\r\n    return self.destroy(request, *args, **kwargs)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/rest_framework/mixins.py\", line 93, in destroy\r\n    self.perform_destroy(instance)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/rest_framework/mixins.py\", line 97, in perform_destroy\r\n    instance.delete()\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/models/base.py\", line 891, in delete\r\n    return collector.delete()\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/models/deletion.py\", line 283, in delete\r\n    count = qs._raw_delete(using=self.using)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/models/query.py\", line 676, in _raw_delete\r\n    return sql.DeleteQuery(self.model).delete_qs(self, using)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/models/sql/subqueries.py\", line 75, in delete_qs\r\n    cursor = self.get_compiler(using).execute_sql(CURSOR)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/models/sql/compiler.py\", line 1066, in execute_sql\r\n    cursor.execute(sql, params)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/utils.py\", line 100, in execute\r\n    return super().execute(sql, params)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/utils.py\", line 68, in execute\r\n    return self._execute_with_wrappers(sql, params, many=False, executor=self._execute)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/utils.py\", line 77, in _execute_with_wrappers\r\n    return executor(sql, params, many, context)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/utils.py\", line 85, in _execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/utils.py\", line 89, in __exit__\r\n    raise dj_exc_value.with_traceback(traceback) from exc_value\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/utils.py\", line 85, in _execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/sqlite3/base.py\", line 303, in execute\r\n    return Database.Cursor.execute(self, query, params)\r\ndjango.db.utils.OperationalError: no such table: main.server_document__old\r\n[27/Dec/2018 04:41:14] \"DELETE /api/projects/1/labels/1 HTTP/1.1\" 500 21810\r\n\r\n-----------------------------------------------------------------------------------------------------------------------\r\nTraceback for case2:\r\n\r\nInternal Server Error: /api/projects/1/docs/1/annotations/\r\nTraceback (most recent call last):\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/utils.py\", line 85, in _execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/sqlite3/base.py\", line 303, in execute\r\n    return Database.Cursor.execute(self, query, params)\r\nsqlite3.OperationalError: no such table: main.server_label__old\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/core/handlers/exception.py\", line 35, in inner\r\n    response = get_response(request)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/core/handlers/base.py\", line 128, in _get_response\r\n    response = self.process_exception_by_middleware(e, request)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/core/handlers/base.py\", line 126, in _get_response\r\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/views/decorators/csrf.py\", line 54, in wrapped_view\r\n    return view_func(*args, **kwargs)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/views/generic/base.py\", line 69, in view\r\n    return self.dispatch(request, *args, **kwargs)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/rest_framework/views.py\", line 483, in dispatch\r\n    response = self.handle_exception(exc)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/rest_framework/views.py\", line 443, in handle_exception\r\n    self.raise_uncaught_exception(exc)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/rest_framework/views.py\", line 480, in dispatch\r\n    response = handler(request, *args, **kwargs)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/rest_framework/generics.py\", line 244, in post\r\n    return self.create(request, *args, **kwargs)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/rest_framework/mixins.py\", line 21, in create\r\n    self.perform_create(serializer)\r\n  File \"/home/chitang/sourcecodes/doccano/app/server/api.py\", line 134, in perform_create\r\n    serializer.save(document=doc, user=self.request.user)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/rest_framework/serializers.py\", line 214, in save\r\n    self.instance = self.create(validated_data)\r\n  File \"/home/chitang/sourcecodes/doccano/app/server/serializers.py\", line 59, in create\r\n    annotation = SequenceAnnotation.objects.create(**validated_data)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/models/manager.py\", line 82, in manager_method\r\n    return getattr(self.get_queryset(), name)(*args, **kwargs)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/models/query.py\", line 417, in create\r\n    obj.save(force_insert=True, using=self.db)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/models/base.py\", line 729, in save\r\n    force_update=force_update, update_fields=update_fields)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/models/base.py\", line 759, in save_base\r\n    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/models/base.py\", line 842, in _save_table\r\n    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/models/base.py\", line 880, in _do_insert\r\n    using=using, raw=raw)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/models/manager.py\", line 82, in manager_method\r\n    return getattr(self.get_queryset(), name)(*args, **kwargs)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/models/query.py\", line 1125, in _insert\r\n    return query.get_compiler(using=using).execute_sql(return_id)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/models/sql/compiler.py\", line 1283, in execute_sql\r\n    cursor.execute(sql, params)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/utils.py\", line 100, in execute\r\n    return super().execute(sql, params)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/utils.py\", line 68, in execute\r\n    return self._execute_with_wrappers(sql, params, many=False, executor=self._execute)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/utils.py\", line 77, in _execute_with_wrappers\r\n    return executor(sql, params, many, context)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/utils.py\", line 85, in _execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/utils.py\", line 89, in __exit__\r\n    raise dj_exc_value.with_traceback(traceback) from exc_value\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/utils.py\", line 85, in _execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"/home/chitang/anaconda3/envs/py3/lib/python3.6/site-packages/django/db/backends/sqlite3/base.py\", line 303, in execute\r\n    return Database.Cursor.execute(self, query, params)\r\ndjango.db.utils.OperationalError: no such table: main.server_label__old\r\n[27/Dec/2018 04:44:44] \"POST /api/projects/1/docs/1/annotations/ HTTP/1.1\" 500 23012\r\n\r\n\r\n\r\n","closed_by":{"login":"jtangchi","id":21078228,"node_id":"MDQ6VXNlcjIxMDc4MjI4","avatar_url":"https://avatars.githubusercontent.com/u/21078228?v=4","gravatar_id":"","url":"https://api.github.com/users/jtangchi","html_url":"https://github.com/jtangchi","followers_url":"https://api.github.com/users/jtangchi/followers","following_url":"https://api.github.com/users/jtangchi/following{/other_user}","gists_url":"https://api.github.com/users/jtangchi/gists{/gist_id}","starred_url":"https://api.github.com/users/jtangchi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtangchi/subscriptions","organizations_url":"https://api.github.com/users/jtangchi/orgs","repos_url":"https://api.github.com/users/jtangchi/repos","events_url":"https://api.github.com/users/jtangchi/events{/privacy}","received_events_url":"https://api.github.com/users/jtangchi/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doccano/doccano/issues/54/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doccano/doccano/issues/54/timeline","performed_via_github_app":null,"state_reason":"completed"}