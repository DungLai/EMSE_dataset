{"url":"https://api.github.com/repos/doccano/doccano/issues/1535","repository_url":"https://api.github.com/repos/doccano/doccano","labels_url":"https://api.github.com/repos/doccano/doccano/issues/1535/labels{/name}","comments_url":"https://api.github.com/repos/doccano/doccano/issues/1535/comments","events_url":"https://api.github.com/repos/doccano/doccano/issues/1535/events","html_url":"https://github.com/doccano/doccano/issues/1535","id":1037310334,"node_id":"I_kwDOB-j9wM491Bl-","number":1535,"title":"ValueError: bulk_create() prohibited to prevent data loss due to unsaved related object 'example'.","user":{"login":"naty88","id":44298164,"node_id":"MDQ6VXNlcjQ0Mjk4MTY0","avatar_url":"https://avatars.githubusercontent.com/u/44298164?v=4","gravatar_id":"","url":"https://api.github.com/users/naty88","html_url":"https://github.com/naty88","followers_url":"https://api.github.com/users/naty88/followers","following_url":"https://api.github.com/users/naty88/following{/other_user}","gists_url":"https://api.github.com/users/naty88/gists{/gist_id}","starred_url":"https://api.github.com/users/naty88/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/naty88/subscriptions","organizations_url":"https://api.github.com/users/naty88/orgs","repos_url":"https://api.github.com/users/naty88/repos","events_url":"https://api.github.com/users/naty88/events{/privacy}","received_events_url":"https://api.github.com/users/naty88/received_events","type":"User","site_admin":false},"labels":[{"id":927327719,"node_id":"MDU6TGFiZWw5MjczMjc3MTk=","url":"https://api.github.com/repos/doccano/doccano/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-10-27T11:35:48Z","updated_at":"2021-11-05T05:12:13Z","closed_at":"2021-11-05T05:12:13Z","author_association":"NONE","active_lock_reason":null,"body":"With the latest Doccano release (v1.5.0) there is a new error by importing of the dataset both in JSON and JSONL format. The same data format works in the release v1.4.1.\r\nFor our use case the problem is that the importing itself works, but the corresponding label is not marked anymore as a label of a particular text like it was in the release  v1.4.1 (s. image \"auto_label_v1 4 1.png\").\r\n\r\nError:\r\n```\r\n[2021-10-27 11:24:33,982: ERROR/ForkPoolWorker-1] Task api.tasks.injest_data[6ac92f0c-558e-4ac4-aac2-739921574989] raised unexpected: ValueError(\"bulk_create() prohibited to prevent data loss due to unsaved related object 'example'.\")\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.8/site-packages/celery/app/trace.py\", line 450, in trace_task\r\n    R = retval = fun(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.8/site-packages/celery/app/trace.py\", line 731, in __protected_call__\r\n    return self.run(*args, **kwargs)\r\n  File \"/doccano/backend/api/tasks.py\", line 124, in injest_data\r\n    factory.create(buffer.data, user, project)\r\n  File \"/doccano/backend/api/tasks.py\", line 85, in create\r\n    self.create_annotation(examples, ids, user, project)\r\n  File \"/doccano/backend/api/tasks.py\", line 80, in create_annotation\r\n    self.annotation_class.objects.bulk_create(annotation)\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/models/manager.py\", line 85, in manager_method\r\n    return getattr(self.get_queryset(), name)(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/models/query.py\", line 498, in bulk_create\r\n    self._prepare_for_bulk_create(objs)\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/models/query.py\", line 461, in _prepare_for_bulk_create\r\n    obj._prepare_related_fields_for_save(operation_name='bulk_create')\r\n  File \"/usr/local/lib/python3.8/site-packages/django/db/models/base.py\", line 932, in _prepare_related_fields_for_save\r\n    raise ValueError(\r\nValueError: bulk_create() prohibited to prevent data loss due to unsaved related object 'example'.\r\n```\r\n\r\nEnvironment:\r\n*   Operating System: Ubuntu 20.04 LTS\r\n*   Python Version Used: Python 3.8.10\r\n*   How did you install doccano (Heroku button etc):  Doccano was deployed with [Helm-Chart ](https://github.com/curie-data-factory/helm-charts/tree/master/charts/doccano).\r\n![auto_label_v1 4 1](https://user-images.githubusercontent.com/44298164/139059258-1320a8a6-ec15-4285-88ac-37119a102dae.png)\r\n","closed_by":{"login":"Hironsan","id":6737785,"node_id":"MDQ6VXNlcjY3Mzc3ODU=","avatar_url":"https://avatars.githubusercontent.com/u/6737785?v=4","gravatar_id":"","url":"https://api.github.com/users/Hironsan","html_url":"https://github.com/Hironsan","followers_url":"https://api.github.com/users/Hironsan/followers","following_url":"https://api.github.com/users/Hironsan/following{/other_user}","gists_url":"https://api.github.com/users/Hironsan/gists{/gist_id}","starred_url":"https://api.github.com/users/Hironsan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hironsan/subscriptions","organizations_url":"https://api.github.com/users/Hironsan/orgs","repos_url":"https://api.github.com/users/Hironsan/repos","events_url":"https://api.github.com/users/Hironsan/events{/privacy}","received_events_url":"https://api.github.com/users/Hironsan/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doccano/doccano/issues/1535/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doccano/doccano/issues/1535/timeline","performed_via_github_app":null,"state_reason":"completed"}