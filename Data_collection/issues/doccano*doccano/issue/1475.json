{"url":"https://api.github.com/repos/doccano/doccano/issues/1475","repository_url":"https://api.github.com/repos/doccano/doccano","labels_url":"https://api.github.com/repos/doccano/doccano/issues/1475/labels{/name}","comments_url":"https://api.github.com/repos/doccano/doccano/issues/1475/comments","events_url":"https://api.github.com/repos/doccano/doccano/issues/1475/events","html_url":"https://github.com/doccano/doccano/issues/1475","id":975513010,"node_id":"MDU6SXNzdWU5NzU1MTMwMTA=","number":1475,"title":"Upload failed when doccano is deployed with 2 replica in kubernetes","user":{"login":"YosuaMichael","id":3679860,"node_id":"MDQ6VXNlcjM2Nzk4NjA=","avatar_url":"https://avatars.githubusercontent.com/u/3679860?v=4","gravatar_id":"","url":"https://api.github.com/users/YosuaMichael","html_url":"https://github.com/YosuaMichael","followers_url":"https://api.github.com/users/YosuaMichael/followers","following_url":"https://api.github.com/users/YosuaMichael/following{/other_user}","gists_url":"https://api.github.com/users/YosuaMichael/gists{/gist_id}","starred_url":"https://api.github.com/users/YosuaMichael/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YosuaMichael/subscriptions","organizations_url":"https://api.github.com/users/YosuaMichael/orgs","repos_url":"https://api.github.com/users/YosuaMichael/repos","events_url":"https://api.github.com/users/YosuaMichael/events{/privacy}","received_events_url":"https://api.github.com/users/YosuaMichael/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-08-20T11:13:36Z","updated_at":"2021-08-27T10:08:43Z","closed_at":"2021-08-27T10:08:43Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, I deployed doccano in kubernetes with 2 replica, connected to same external Postgresql and Rabbitmq.\r\nThen when I tried to upload a dataset I got the following error message:\r\n```\r\n[2021-08-20 09:02:54,137: INFO/MainProcess] celery@doccano-demo-7c94b9d45-4z6v9 ready.\r\n[2021-08-20 10:53:21,827: INFO/MainProcess] Task api.tasks.export_dataset[2300c812-281d-4258-802a-d0bcc5bc1513] received\r\nError moving temporary file to permanent storage location\r\n[2021-08-20 10:56:52,627: INFO/MainProcess] Task api.tasks.injest_data[004c53b6-fe82-45fc-b4db-7ea16691db25] received\r\n[2021-08-20 10:56:52,659: ERROR/ForkPoolWorker-2] Task api.tasks.injest_data[004c53b6-fe82-45fc-b4db-7ea16691db25] raised unexpected: FileNotFoundError(2, 'No such file or directory')\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.8/site-packages/celery/app/trace.py\", line 450, in trace_task\r\n    R = retval = fun(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.8/site-packages/celery/app/trace.py\", line 731, in __protected_call__\r\n    return self.run(*args, **kwargs)\r\n  File \"/doccano/backend/api/tasks.py\", line 111, in injest_data\r\n    example = next(it)\r\n  File \"/doccano/backend/api/views/upload/dataset.py\", line 68, in __iter__\r\n    yield from self.load(filename)\r\n  File \"/doccano/backend/api/views/upload/dataset.py\", line 184, in load\r\n    with open(filename, encoding=encoding) as f:\r\nFileNotFoundError: [Errno 2] No such file or directory: '/doccano/backend/media/5ohBU5hebFUcSo7Qi8Z4gq/YfTPmYLuJCzdFCR62KfVCM/sample_poi.ndjson'\r\n```\r\n\r\nIf I scale down to only 1 replica, then I can upload successfully. (take note that this 1 replica is the exact same replica that failed before without being restarted or anything)\r\nIs there any suggestion on how to scale doccano to more than 1 replica?\r\n\r\nThanks!\r\nYosua\r\n\r\nYour Environment\r\n---------\r\n*   Operating System: According to dockerfile python:3.8.6-slim-buster\r\n*   Python Version Used: 3.8.6\r\n*   When you install doccano: 14 August 2021\r\n*   How did you install doccano (Heroku button etc): in AKS (kubernetes cluster in Azure) with standard docker image (doccano/doccano)\r\n","closed_by":{"login":"YosuaMichael","id":3679860,"node_id":"MDQ6VXNlcjM2Nzk4NjA=","avatar_url":"https://avatars.githubusercontent.com/u/3679860?v=4","gravatar_id":"","url":"https://api.github.com/users/YosuaMichael","html_url":"https://github.com/YosuaMichael","followers_url":"https://api.github.com/users/YosuaMichael/followers","following_url":"https://api.github.com/users/YosuaMichael/following{/other_user}","gists_url":"https://api.github.com/users/YosuaMichael/gists{/gist_id}","starred_url":"https://api.github.com/users/YosuaMichael/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YosuaMichael/subscriptions","organizations_url":"https://api.github.com/users/YosuaMichael/orgs","repos_url":"https://api.github.com/users/YosuaMichael/repos","events_url":"https://api.github.com/users/YosuaMichael/events{/privacy}","received_events_url":"https://api.github.com/users/YosuaMichael/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doccano/doccano/issues/1475/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doccano/doccano/issues/1475/timeline","performed_via_github_app":null,"state_reason":"completed"}