{"url":"https://api.github.com/repos/k4yt3x/video2x/issues/513","repository_url":"https://api.github.com/repos/k4yt3x/video2x","labels_url":"https://api.github.com/repos/k4yt3x/video2x/issues/513/labels{/name}","comments_url":"https://api.github.com/repos/k4yt3x/video2x/issues/513/comments","events_url":"https://api.github.com/repos/k4yt3x/video2x/issues/513/events","html_url":"https://github.com/k4yt3x/video2x/issues/513","id":905841096,"node_id":"MDU6SXNzdWU5MDU4NDEwOTY=","number":513,"title":"Anime4KCPP fails with non .png input extension","user":{"login":"jrobgh","id":84988403,"node_id":"MDQ6VXNlcjg0OTg4NDAz","avatar_url":"https://avatars.githubusercontent.com/u/84988403?v=4","gravatar_id":"","url":"https://api.github.com/users/jrobgh","html_url":"https://github.com/jrobgh","followers_url":"https://api.github.com/users/jrobgh/followers","following_url":"https://api.github.com/users/jrobgh/following{/other_user}","gists_url":"https://api.github.com/users/jrobgh/gists{/gist_id}","starred_url":"https://api.github.com/users/jrobgh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrobgh/subscriptions","organizations_url":"https://api.github.com/users/jrobgh/orgs","repos_url":"https://api.github.com/users/jrobgh/repos","events_url":"https://api.github.com/users/jrobgh/events{/privacy}","received_events_url":"https://api.github.com/users/jrobgh/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"k4yt3x","id":21986859,"node_id":"MDQ6VXNlcjIxOTg2ODU5","avatar_url":"https://avatars.githubusercontent.com/u/21986859?v=4","gravatar_id":"","url":"https://api.github.com/users/k4yt3x","html_url":"https://github.com/k4yt3x","followers_url":"https://api.github.com/users/k4yt3x/followers","following_url":"https://api.github.com/users/k4yt3x/following{/other_user}","gists_url":"https://api.github.com/users/k4yt3x/gists{/gist_id}","starred_url":"https://api.github.com/users/k4yt3x/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/k4yt3x/subscriptions","organizations_url":"https://api.github.com/users/k4yt3x/orgs","repos_url":"https://api.github.com/users/k4yt3x/repos","events_url":"https://api.github.com/users/k4yt3x/events{/privacy}","received_events_url":"https://api.github.com/users/k4yt3x/received_events","type":"User","site_admin":false},"assignees":[{"login":"k4yt3x","id":21986859,"node_id":"MDQ6VXNlcjIxOTg2ODU5","avatar_url":"https://avatars.githubusercontent.com/u/21986859?v=4","gravatar_id":"","url":"https://api.github.com/users/k4yt3x","html_url":"https://github.com/k4yt3x","followers_url":"https://api.github.com/users/k4yt3x/followers","following_url":"https://api.github.com/users/k4yt3x/following{/other_user}","gists_url":"https://api.github.com/users/k4yt3x/gists{/gist_id}","starred_url":"https://api.github.com/users/k4yt3x/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/k4yt3x/subscriptions","organizations_url":"https://api.github.com/users/k4yt3x/orgs","repos_url":"https://api.github.com/users/k4yt3x/repos","events_url":"https://api.github.com/users/k4yt3x/events{/privacy}","received_events_url":"https://api.github.com/users/k4yt3x/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2021-05-28T18:13:29Z","updated_at":"2022-08-15T23:45:38Z","closed_at":"2022-02-06T20:30:05Z","author_association":"NONE","active_lock_reason":null,"body":"## Component Versions\r\n\r\nPlease at least fill in the release version and GUI or CLI version.\r\n\r\n- **Video2X release version**: \r\n4.8.1-win32-full \r\nalso repros on python version from master 37d567f on Mar 13\r\n- **Upscaler version**:\r\n- **GUI version**: 2.8.1\r\n- **CLI version**: 4.3.3\r\n\r\n## Symptom\r\n\r\nWhen Video2X is set to non .png input extension (.bmp, .jpg, etc.) Anime4KCPP does not follow this extension for its output (CLI always generates .png). This causes the subsequent ffmpeg commands to fail because they are looking for the video2x non .png extension.\r\n\r\nOperation with intermediate .png files saves temporary disk space though requires a lot more cpu overhead (on my i7-2600k) and runtime than using .bmp.\r\n\r\nI could work around this by modifying the video2x script to look for .png when converting the extracted frames to video, and also modified the instances in upscaler.py that pointed to upscaled_frames folder to instead use the extracted_frames folder from anime4kcpp.\r\n\r\n## Error Log or Screenshots\r\n\r\nvideo2x:\r\n  video2x_cache_directory: e:\\temp # default: %TEMP%\\video2x, directory where cache files are stored, will be deleted if preserve_frames is not set to true\r\n  extracted_frame_format: bmp # png/jpg intermediate file format used for extracted frames during video processing\r\n  output_file_name_format_string: \"{original_file_name}_output{extension}\" # format string to use for generating output file names\r\n  image_output_extension: .bmp # image output extension during batch processing\r\n\r\n\r\n\r\n[+] INFO: Starting upscaling video/GIF\r\n[+] INFO: Getting total number of frames in the file\r\n2021-05-28 11:06:05.873490 [+] INFO: Executing: C:\\temp\\video2x-4.8.1-win32-full\\video2x-4.8.1-win32-full\\dependencies\\ffmpeg\\bin\\ffprobe -v quiet -count_frames -select_streams v:0 -show_entries stream=nb_read_frames -of default=nokey=1:noprint_wrappers=1 C:\\temp\\video2x-4.8.1-win32-full\\video2x-4.8.1-win32-full\\fff4.mkv\r\n[+] INFO: Calculating scaling parameters\r\n2021-05-28 11:06:21.189045 [+] INFO: Framerate: 23.976023976023978\r\n2021-05-28 11:06:21.189045 [+] INFO: Width: 640\r\n2021-05-28 11:06:21.190045 [+] INFO: Height: 480\r\n2021-05-28 11:06:21.190045 [+] INFO: Total number of frames: 2379\r\n2021-05-28 11:06:21.190045 [+] INFO: Output width: 1280\r\n2021-05-28 11:06:21.191044 [+] INFO: Output height: 960\r\n2021-05-28 11:06:21.191044 [+] INFO: Required scale ratio: 2.0\r\n2021-05-28 11:06:21.191044 [+] INFO: Upscaling jobs queue: [2.0]\r\n2021-05-28 11:06:21.192042 [+] INFO: Executing: C:\\temp\\video2x-4.8.1-win32-full\\video2x-4.8.1-win32-full\\dependencies\\ffmpeg\\bin\\ffmpeg -hwaccel auto -y -i C:\\temp\\video2x-4.8.1-win32-full\\video2x-4.8.1-win32-full\\fff4.mkv -pix_fmt rgb24 -qscale:v 1 e:\\temp\\tmp406ctulo\\extracted_%0d.bmp\r\n2021-05-28 11:06:21.208032 [+] INFO: Main process waiting for subprocesses to exit\r\n2021-05-28 11:07:06.146314 [+] INFO: Subprocess 7316 exited with code 0\r\n[+] INFO: Starting to upscale extracted frames\r\n2021-05-28 11:07:07.020776 [+] INFO: [upscaler] Subprocess 4424 executing: C:\\temp\\video2x-4.8.1-win32-full\\video2x-4.8.1-win32-full\\dependencies\\anime4kcpp\\CLI\\Anime4KCPP_CLI\\Anime4KCPP_CLI --passes 2 --pushColorCount 2 --strengthColor 0.3 --strengthGradient 1.0 --zoomFactor 2.0 --threads 99 --preFilters 4 --postFilters 40 --GPUMode --CNNMode --HDNLevel 1 --platformID 0 --deviceID 0 --codec mp4v --forceFps 0.0 --input e:\\temp\\tmp406ctulo --output e:\\temp\\tmpn6zzs2ix\r\n2021-05-28 11:07:07.118715 [+] INFO: Starting progress monitor\r\n2021-05-28 11:07:07.150694 [+] INFO: Starting upscaled image cleaner\r\n2021-05-28 11:07:07.157691 [+] INFO: Main process waiting for subprocesses to exit\r\nProcessing: fff4.mkv (pass 1/1):   0%|                                                        | 0/2379 [01:22<?, ?it/s]2021-05-28 11:08:29.446021 [+] INFO: Subprocess 14736 exited with code 0\r\nProcessing: fff4.mkv (pass 1/1):   0%|                                                        | 0/2379 [01:23<?, ?it/s]\r\nProcessing: fff4.mkv (pass 1/1):   0%|                                                        | 0/2379 [01:24<?, ?it/s]\r\n2021-05-28 11:08:31.879520 [+] INFO: Killing upscaled image cleaner\r\n[+] INFO: Upscaling completed\r\n[+] INFO: Average processing speed: 27.57657347837965 seconds per frame\r\n[+] INFO: Lanczos downscaling frames\r\nDownscaling: 0it [00:00, ?it/s]\r\n[+] INFO: Converting extracted frames into video\r\n2021-05-28 11:08:34.286037 [+] INFO: Executing: C:\\temp\\video2x-4.8.1-win32-full\\video2x-4.8.1-win32-full\\dependencies\\ffmpeg\\bin\\ffmpeg -r 23.976023976023978 -hwaccel cuda -y -f image2 -i e:\\temp\\tmpn6zzs2ix\\extracted_%d.bmp -vcodec h264_nvenc -pix_fmt yuv420p -crf 17 -vf pad=ceil(iw/2)*2:ceil(ih/2)*2 -tune animation e:\\temp\\tmpn6zzs2ix\\intermediate.mkv\r\n2021-05-28 11:08:34.296031 [+] INFO: Main process waiting for subprocesses to exit\r\n[!] ERROR: Subprocess 11572 exited with code 1\r\n[!] ERROR: Subprocess execution ran into an error\r\n[!] WARNING: Terminating all processes\r\nTraceback (most recent call last):\r\n  File \"video2x_gui.py\", line 105, in run\r\n  File \"upscaler.py\", line 1022, in run\r\n  File \"upscaler.py\", line 941, in run\r\n  File \"upscaler.py\", line 489, in _wait\r\n  File \"upscaler.py\", line 467, in _wait\r\nsubprocess.CalledProcessError: Command '['C:\\\\temp\\\\video2x-4.8.1-win32-full\\\\video2x-4.8.1-win32-full\\\\dependencies\\\\ffmpeg\\\\bin\\\\ffmpeg', '-r', '23.976023976023978', '-hwaccel', 'cuda', '-y', '-f', 'image2', '-i', 'e:\\\\temp\\\\tmpn6zzs2ix\\\\extracted_%d.bmp', '-vcodec', 'h264_nvenc', '-pix_fmt', 'yuv420p', '-crf', '17', '-vf', 'pad=ceil(iw/2)*2:ceil(ih/2)*2', '-tune', 'animation', 'e:\\\\temp\\\\tmpn6zzs2ix\\\\intermediate.mkv']' returned non-zero exit status 1.\r\n\r\n![image](https://user-images.githubusercontent.com/84988403/120025246-41d63b00-bfa5-11eb-88bd-38636e44c082.png)\r\n![image](https://user-images.githubusercontent.com/84988403/120025302-561a3800-bfa5-11eb-88ab-574ac1dd83eb.png)\r\n\r\n![image](https://user-images.githubusercontent.com/84988403/120025568-b90bcf00-bfa5-11eb-88f0-1126b5c2335e.png)\r\n","closed_by":{"login":"k4yt3x","id":21986859,"node_id":"MDQ6VXNlcjIxOTg2ODU5","avatar_url":"https://avatars.githubusercontent.com/u/21986859?v=4","gravatar_id":"","url":"https://api.github.com/users/k4yt3x","html_url":"https://github.com/k4yt3x","followers_url":"https://api.github.com/users/k4yt3x/followers","following_url":"https://api.github.com/users/k4yt3x/following{/other_user}","gists_url":"https://api.github.com/users/k4yt3x/gists{/gist_id}","starred_url":"https://api.github.com/users/k4yt3x/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/k4yt3x/subscriptions","organizations_url":"https://api.github.com/users/k4yt3x/orgs","repos_url":"https://api.github.com/users/k4yt3x/repos","events_url":"https://api.github.com/users/k4yt3x/events{/privacy}","received_events_url":"https://api.github.com/users/k4yt3x/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/k4yt3x/video2x/issues/513/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/k4yt3x/video2x/issues/513/timeline","performed_via_github_app":null,"state_reason":"completed"}