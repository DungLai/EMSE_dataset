{"url":"https://api.github.com/repos/k4yt3x/video2x/issues/201","repository_url":"https://api.github.com/repos/k4yt3x/video2x","labels_url":"https://api.github.com/repos/k4yt3x/video2x/issues/201/labels{/name}","comments_url":"https://api.github.com/repos/k4yt3x/video2x/issues/201/comments","events_url":"https://api.github.com/repos/k4yt3x/video2x/issues/201/events","html_url":"https://github.com/k4yt3x/video2x/issues/201","id":565070065,"node_id":"MDU6SXNzdWU1NjUwNzAwNjU=","number":201,"title":"DockerFile","user":{"login":"crobibero","id":24963659,"node_id":"MDQ6VXNlcjI0OTYzNjU5","avatar_url":"https://avatars.githubusercontent.com/u/24963659?v=4","gravatar_id":"","url":"https://api.github.com/users/crobibero","html_url":"https://github.com/crobibero","followers_url":"https://api.github.com/users/crobibero/followers","following_url":"https://api.github.com/users/crobibero/following{/other_user}","gists_url":"https://api.github.com/users/crobibero/gists{/gist_id}","starred_url":"https://api.github.com/users/crobibero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/crobibero/subscriptions","organizations_url":"https://api.github.com/users/crobibero/orgs","repos_url":"https://api.github.com/users/crobibero/repos","events_url":"https://api.github.com/users/crobibero/events{/privacy}","received_events_url":"https://api.github.com/users/crobibero/received_events","type":"User","site_admin":false},"labels":[{"id":847238630,"node_id":"MDU6TGFiZWw4NDcyMzg2MzA=","url":"https://api.github.com/repos/k4yt3x/video2x/labels/type:Enhancement","name":"type:Enhancement","color":"54aaff","default":false,"description":"New feature or request"}],"state":"closed","locked":false,"assignee":{"login":"k4yt3x","id":21986859,"node_id":"MDQ6VXNlcjIxOTg2ODU5","avatar_url":"https://avatars.githubusercontent.com/u/21986859?v=4","gravatar_id":"","url":"https://api.github.com/users/k4yt3x","html_url":"https://github.com/k4yt3x","followers_url":"https://api.github.com/users/k4yt3x/followers","following_url":"https://api.github.com/users/k4yt3x/following{/other_user}","gists_url":"https://api.github.com/users/k4yt3x/gists{/gist_id}","starred_url":"https://api.github.com/users/k4yt3x/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/k4yt3x/subscriptions","organizations_url":"https://api.github.com/users/k4yt3x/orgs","repos_url":"https://api.github.com/users/k4yt3x/repos","events_url":"https://api.github.com/users/k4yt3x/events{/privacy}","received_events_url":"https://api.github.com/users/k4yt3x/received_events","type":"User","site_admin":false},"assignees":[{"login":"k4yt3x","id":21986859,"node_id":"MDQ6VXNlcjIxOTg2ODU5","avatar_url":"https://avatars.githubusercontent.com/u/21986859?v=4","gravatar_id":"","url":"https://api.github.com/users/k4yt3x","html_url":"https://github.com/k4yt3x","followers_url":"https://api.github.com/users/k4yt3x/followers","following_url":"https://api.github.com/users/k4yt3x/following{/other_user}","gists_url":"https://api.github.com/users/k4yt3x/gists{/gist_id}","starred_url":"https://api.github.com/users/k4yt3x/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/k4yt3x/subscriptions","organizations_url":"https://api.github.com/users/k4yt3x/orgs","repos_url":"https://api.github.com/users/k4yt3x/repos","events_url":"https://api.github.com/users/k4yt3x/events{/privacy}","received_events_url":"https://api.github.com/users/k4yt3x/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2020-02-14T02:48:52Z","updated_at":"2021-09-07T01:03:48Z","closed_at":"2020-03-07T06:11:49Z","author_association":"NONE","active_lock_reason":null,"body":"I have created a dockerfile for Video2x. It's currently uploaded under my repo, but I can transfer it to you after testing. Please let me know if I missed anything or if you would prefer different defaults. \r\n\r\nI haven't gotten Video2x to complete yet as it keeps failing during MKV subtitles.\r\n\r\nOne thing I would like to do is create a much smaller dockerfile as this one decompresses to roughly 8GB,\r\n\r\nhttps://hub.docker.com/r/crobibero/video2x/\r\n\r\nDockerfile:\r\n```\r\nFROM nvidia/cuda:10.2-devel-ubuntu18.04\r\n\r\n# Install deps\r\nRUN apt update && \\\r\n    DEBIAN_FRONTEND=\"noninteractive\" \\\r\n    apt install -y --no-install-recommends \\\r\n        build-essential \\\r\n        git \\\r\n        libboost-all-dev \\\r\n        libgflags-dev \\\r\n        libprotobuf-dev \\\r\n        protobuf-compiler \\\r\n        libgoogle-glog-dev \\\r\n        libhdf5-dev liblmdb-dev \\\r\n        libleveldb-dev \\\r\n        libsnappy-dev \\\r\n        libopencv-dev \\\r\n        libatlas-base-dev \\\r\n        libpython3-all-dev \\\r\n        python3-pip \\\r\n        python3-numpy \\\r\n        python-numpy \\\r\n        doxygen \\\r\n        libmsgpack-dev \\\r\n        ffmpeg \\\r\n        wget \\\r\n        libcudnn7 \\\r\n        libcudnn7-dev \\\r\n        python3-setuptools && \\\r\n        rm -rf /var/lib/apt/lists/* && \\\r\n        # Install OpenSSL\r\n        cd /root/ && \\\r\n        wget https://github.com/openssl/openssl/archive/OpenSSL_1_1_1d.tar.gz && \\\r\n        tar -xvzf OpenSSL_1_1_1d.tar.gz && \\\r\n        cd openssl-OpenSSL_1_1_1d && \\\r\n        ./config --prefix=/usr/lib/openssl --openssldir=/usr/lib/openssl shared zlib && \\\r\n        make -j4 && \\\r\n        make install && \\\r\n        # CMake requires version > 3.12.2\r\n        git clone --branch release https://github.com/Kitware/CMake.git /root/CMake && \\\r\n        cd /root/CMake && \\\r\n        OPENSSL_ROOT_DIR=/usr/lib/openssl ./bootstrap && \\\r\n        make -j4 && \\\r\n        make install \r\n\r\n# Install waifu2x-caffe\r\nRUN git clone --recurse-submodules https://github.com/nagadomi/waifu2x-caffe-ubuntu.git /root/waifu2x-caffe-ubuntu && \\\r\n    cd /root/waifu2x-caffe-ubuntu && \\\r\n    git clone https://github.com/nagadomi/caffe.git && \\\r\n    mkdir build && \\\r\n    cd build && \\\r\n    cmake .. && \\\r\n    make -j4 && \\\r\n    mkdir -p /usr/lit/libcaffe && \\\r\n    cp libcaffe/lib/libcaffe.so /usr/lib/libcaffe && \\\r\n    cp waifu2x-caffe ../bin/\r\n\r\n# Install Video2x\r\nRUN git clone https://github.com/k4yt3x/video2x.git /root/video2x && \\\r\n    cd /root/video2x/src && \\\r\n    cp -r /root/waifu2x-caffe-ubuntu/bin/ waifu2x-caffe && \\\r\n    pip3 install -r requirements.txt\r\n\r\nWORKDIR /root/video2x/src\r\n\r\nENV NVIDIA_DRIVER_CAPABILITIES compute,utility,video\r\nVOLUME [ \"/files\" ]\r\nVOLUME [ \"/cache\" ]\r\nENTRYPOINT [ \"python3\", \"video2x.py\", \"-c\", \"/config/video2x.yaml\", \"-b\" ]\r\n```\r\n\r\nvideo2x.yaml:\r\n```\r\nwaifu2x_caffe:\r\n    path: waifu2x-caffe/waifu2x-caffe\r\n    input_extention_list:\r\n    output_extention:\r\n    mode: noise_scale\r\n    scale_ratio:\r\n    scale_width:\r\n    scale_height:\r\n    noise_level: 3\r\n    process: gpu\r\n    crop_size: 128\r\n    output_quality: -1\r\n    output_depth: 8\r\n    batch_size: 1\r\n    gpu: 0\r\n    tta: 0\r\n    input_path:\r\n    output_path:\r\n    model_dir:\r\n    crop_w:\r\n    crop_h:\r\n  ffmpeg:\r\n    ffmpeg_path: /usr/bin/\r\n    video_to_frames:\r\n      output_options:\r\n        \"-qscale:v\":\r\n        \"-pix_fmt\": rgba64be\r\n      \"-hwaccel\": auto\r\n      \"-y\": true\r\n    frames_to_video:\r\n      input_options:\r\n        \"-qscale:v\":\r\n        \"-qscale:a\":\r\n        \"-f\": image2\r\n      output_options:\r\n        \"-vcodec\": libx264\r\n        \"-crf\": 17\r\n        \"-b:v\":\r\n        \"-pix_fmt\":\r\n      \"-hwaccel\": auto\r\n      \"-y\": true\r\n    migrating_tracks:\r\n      output_options:\r\n        \"-map\":\r\n          - 0:v?\r\n          - 1:a?\r\n          - 1:s?\r\n          - 1:d?\r\n          - 1:t?\r\n        \"-c\": copy\r\n        \"-pix_fmt\":\r\n      \"-hwaccel\": auto\r\n      \"-y\": true\r\n  video2x:\r\n    video2x_cache_directory: /cache/tmp\r\n    image_format: png\r\n    preserve_frames: false\r\n ```\r\n\r\nSample for docker-compose\r\n```\r\nvideo2x:\r\n    container_name: video2x\r\n    image: crobibero/video2x:latest\r\n    volumes:\r\n        - /usr/appdata/video2x:/config\r\n        - /tmp/video2x-cache:/cache\r\n        - /tmp/video:/files\r\n    command: --input /files/sample_input.mp4 --output /files/sample_output.mp4 --width 1920 --height 1080 -m cudnn\r\n```\r\n\r\ndocker run command\r\n```\r\nnvidia-docker run \\\r\n    -v /usr/appdata/video2x:/config \\\r\n    -v /tmp/video:/files \\\r\n    -v/tmp/video2x-cache:/cache \\\r\n    crobibero/video2x:latest  \\\r\n    -i /files/Daria\\ -\\ S01E01\\ -\\ Esteemsters\\ \\[WEBDL-480p\\].mkv -o /files/sample_output.mp4 --width=1920 --height=1080 -m cudnn\r\n```","closed_by":{"login":"k4yt3x","id":21986859,"node_id":"MDQ6VXNlcjIxOTg2ODU5","avatar_url":"https://avatars.githubusercontent.com/u/21986859?v=4","gravatar_id":"","url":"https://api.github.com/users/k4yt3x","html_url":"https://github.com/k4yt3x","followers_url":"https://api.github.com/users/k4yt3x/followers","following_url":"https://api.github.com/users/k4yt3x/following{/other_user}","gists_url":"https://api.github.com/users/k4yt3x/gists{/gist_id}","starred_url":"https://api.github.com/users/k4yt3x/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/k4yt3x/subscriptions","organizations_url":"https://api.github.com/users/k4yt3x/orgs","repos_url":"https://api.github.com/users/k4yt3x/repos","events_url":"https://api.github.com/users/k4yt3x/events{/privacy}","received_events_url":"https://api.github.com/users/k4yt3x/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/k4yt3x/video2x/issues/201/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/k4yt3x/video2x/issues/201/timeline","performed_via_github_app":null,"state_reason":"completed"}