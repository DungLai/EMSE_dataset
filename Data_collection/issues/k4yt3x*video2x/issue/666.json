{"url":"https://api.github.com/repos/k4yt3x/video2x/issues/666","repository_url":"https://api.github.com/repos/k4yt3x/video2x","labels_url":"https://api.github.com/repos/k4yt3x/video2x/issues/666/labels{/name}","comments_url":"https://api.github.com/repos/k4yt3x/video2x/issues/666/comments","events_url":"https://api.github.com/repos/k4yt3x/video2x/issues/666/events","html_url":"https://github.com/k4yt3x/video2x/issues/666","id":1261938983,"node_id":"I_kwDOB1EkMc5LN6kn","number":666,"title":"[Colab] Upscale does not seem to do anything with the file in gdrive, interpolate immediately fails","user":{"login":"Kyle2142","id":19349418,"node_id":"MDQ6VXNlcjE5MzQ5NDE4","avatar_url":"https://avatars.githubusercontent.com/u/19349418?v=4","gravatar_id":"","url":"https://api.github.com/users/Kyle2142","html_url":"https://github.com/Kyle2142","followers_url":"https://api.github.com/users/Kyle2142/followers","following_url":"https://api.github.com/users/Kyle2142/following{/other_user}","gists_url":"https://api.github.com/users/Kyle2142/gists{/gist_id}","starred_url":"https://api.github.com/users/Kyle2142/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Kyle2142/subscriptions","organizations_url":"https://api.github.com/users/Kyle2142/orgs","repos_url":"https://api.github.com/users/Kyle2142/repos","events_url":"https://api.github.com/users/Kyle2142/events{/privacy}","received_events_url":"https://api.github.com/users/Kyle2142/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-06-06T14:38:43Z","updated_at":"2022-06-06T14:38:43Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Good day, I tried out the linked Colab script and ran into issues\r\n\r\nIn both cases I tried\r\n- Spy x Family - 9.mkv (480p, unedited)\r\n- Spy X Family - 9.mp4 (my re-encode of above using handbrake)\r\n\r\n<details><summary>Upscale seems to idle after finding the file and printing some info:</summary>\r\n\r\n```\r\n12:48:39.651979 | INFO     | Reading input video information\r\n12:48:39.801321 | INFO     | Starting video decoder\r\n12:48:39.822143 | INFO     | Starting video encoder\r\n\r\nInput #0, mov,mp4,m4a,3gp,3g2,mj2, from '/mnt/gdrive/MyDrive/Spy X Family - 9.mp4':\r\n  Metadata:\r\n    major_brand     : mp42\r\n    minor_version   : 512\r\n    compatible_brands: mp42iso2avc1mp41\r\n    creation_time   : 2022-06-06T12:34:02.000000Z\r\n    encoder         : HandBrake 1.4.2 2021100300\r\n  Duration: 00:24:10.02, start: 0.000000, bitrate: 1596 kb/s\r\n    Stream #0:0(und): Video: h264 (High) (avc1 / 0x31637661), yuv420p(tv, \r\nsmpte170m/smpte170m/bt709), 848x480 [SAR 160:159 DAR 16:9], 1494 kb/s, 23.98 fps, 23.98 tbr, \r\n90k tbn, 47.95 tbc (default)\r\n    Metadata:\r\n      creation_time   : 2022-06-06T12:34:02.000000Z\r\n      handler_name    : VideoHandler\r\n    Stream #0:1(jpn): Audio: aac (LC) (mp4a / 0x6134706D), 44100 Hz, stereo, fltp, 96 kb/s \r\n(default)\r\n    Metadata:\r\n      creation_time   : 2022-06-06T12:34:02.000000Z\r\n      handler_name    : Stereo\r\n    Stream #0:2(eng): Subtitle: mov_text (tx3g / 0x67337874), 853x72, 0 kb/s (default)\r\n    Metadata:\r\n      creation_time   : 2022-06-06T12:34:02.000000Z\r\n      handler_name    : English subs\r\nStream mapping:\r\n  Stream #0:0 -> #0:0 (h264 (native) -> rawvideo (native))\r\nOutput #0, rawvideo, to 'pipe:1':\r\n  Metadata:\r\n    major_brand     : mp42\r\n    minor_version   : 512\r\n    compatible_brands: mp42iso2avc1mp41\r\n    encoder         : Lavf57.83.100\r\n    Stream #0:0(und): Video: rawvideo (RGB[24] / 0x18424752), rgb24, 848x480 [SAR 160:159 DAR\r\n16:9], q=2-31, 234220 kb/s, 23.98 fps, 23.98 tbn, 23.98 tbc (default)\r\n    Metadata:\r\n      creation_time   : 2022-06-06T12:34:02.000000Z\r\n      handler_name    : VideoHandler\r\n      encoder         : Lavc57.107.100 rawvideo\r\n\r\n```\r\n\r\n</details>\r\n\r\n(it never does anything further, I quit it after 30m+)\r\n\r\n----\r\n\r\n<details><summary>Interpolate fails immediately</summary>\r\n\r\n```\r\nInput #0, rawvideo, from 'pipe:0':\r\n  Duration: N/A, start: 0.000000, bitrate: 468441 kb/s\r\n    Stream #0:0: Video: rawvideo (RGB[24] / 0x18424752), rgb24, 848x480, 468441 kb/s, 47.95 \r\ntbr, 47.95 tbn, 47.95 tbc\r\n\r\nInterpolating ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   0% (1/69531) ? FPS 0:00:10 < -:--:--\r\n\r\n12:48:21.219287 | ERROR    | [Errno 32] Broken pipe\r\nTraceback (most recent call last):\r\n\r\n  File \"/usr/lib/python3.7/threading.py\", line 890, in _bootstrap\r\n    self._bootstrap_inner()\r\n    |    -> <function Thread._bootstrap_inner at 0x7f80935bd710>\r\n    -> <VideoEncoder(Thread-43, started 140189564438272)>\r\n  File \"/usr/lib/python3.7/threading.py\", line 926, in _bootstrap_inner\r\n    self.run()\r\n    |    -> <function VideoEncoder.run at 0x7f806f093a70>\r\n    -> <VideoEncoder(Thread-43, started 140189564438272)>\r\n\r\n> File \"/usr/local/lib/python3.8/dist-packages/video2x/encoder.py\", line 157, in run\r\n    self.encoder.stdin.write(image.tobytes())\r\n    |    |       |     |     |     -> <function Image.tobytes at 0x7f808008ba70>\r\n    |    |       |     |     -> <PIL.Image.Image image mode=RGB size=848x480 at \r\n0x7F806EF2C9D0>\r\n    |    |       |     -> <method 'write' of '_io.BufferedWriter' objects>\r\n    |    |       -> <_io.BufferedWriter name=76>\r\n    |    -> <subprocess.Popen object at 0x7f806ef69550>\r\n    -> <VideoEncoder(Thread-43, started 140189564438272)>\r\n\r\nBrokenPipeError: [Errno 32] Broken pipe\r\n\r\n12:48:22.173183 | ERROR    | encoder died unexpectedly\r\nTraceback (most recent call last):\r\n\r\n  File \"/usr/lib/python3.7/runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n                -> ModuleSpec(name='ipykernel_launcher', \r\nloader=<_frozen_importlib_external.SourceFileLoader object at 0x7f809389c310>, origin='...\r\n  File \"/usr/lib/python3.7/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n         |     -> {'__name__': '__main__', '__doc__': 'Entry point for launching an IPython \r\nkernel.\\n\\nThis is separate from the ipykernel pack...\r\n         -> <code object <module> at 0x7f80938784b0, file \r\n\"/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py\", line 5>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py\", line 16, in <module>\r\n    app.launch_new_instance()\r\n    |   -> <bound method Application.launch_instance of <class \r\n'ipykernel.kernelapp.IPKernelApp'>>\r\n    -> <module 'ipykernel.kernelapp' from \r\n'/usr/local/lib/python3.7/dist-packages/ipykernel/kernelapp.py'>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/traitlets/config/application.py\", line 846, in\r\nlaunch_instance\r\n    app.start()\r\n    |   -> <function IPKernelApp.start at 0x7f808d590b90>\r\n    -> <ipykernel.kernelapp.IPKernelApp object at 0x7f8093a5e290>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/ipykernel/kernelapp.py\", line 499, in start\r\n    self.io_loop.start()\r\n    |    |       -> <function BaseAsyncIOLoop.start at 0x7f808d8d9320>\r\n    |    -> <tornado.platform.asyncio.AsyncIOMainLoop object at 0x7f808bcfaf50>\r\n    -> <ipykernel.kernelapp.IPKernelApp object at 0x7f8093a5e290>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/tornado/platform/asyncio.py\", line 132, in \r\nstart\r\n    self.asyncio_loop.run_forever()\r\n    |    |            -> <function BaseEventLoop.run_forever at 0x7f808d8e5320>\r\n    |    -> <_UnixSelectorEventLoop running=True closed=False debug=False>\r\n    -> <tornado.platform.asyncio.AsyncIOMainLoop object at 0x7f808bcfaf50>\r\n\r\n  File \"/usr/lib/python3.7/asyncio/base_events.py\", line 541, in run_forever\r\n    self._run_once()\r\n    |    -> <function BaseEventLoop._run_once at 0x7f808d8e6dd0>\r\n    -> <_UnixSelectorEventLoop running=True closed=False debug=False>\r\n  File \"/usr/lib/python3.7/asyncio/base_events.py\", line 1786, in _run_once\r\n    handle._run()\r\n    |      -> <function Handle._run at 0x7f808dd364d0>\r\n    -> <Handle BaseAsyncIOLoop._handle_events(14, 1)>\r\n  File \"/usr/lib/python3.7/asyncio/events.py\", line 88, in _run\r\n    self._context.run(self._callback, *self._args)\r\n    |    |            |    |           |    -> <member '_args' of 'Handle' objects>\r\n    |    |            |    |           -> <Handle BaseAsyncIOLoop._handle_events(14, 1)>\r\n    |    |            |    -> <member '_callback' of 'Handle' objects>\r\n    |    |            -> <Handle BaseAsyncIOLoop._handle_events(14, 1)>\r\n    |    -> <member '_context' of 'Handle' objects>\r\n    -> <Handle BaseAsyncIOLoop._handle_events(14, 1)>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/tornado/platform/asyncio.py\", line 122, in \r\n_handle_events\r\n    handler_func(fileobj, events)\r\n    |            |        -> 1\r\n    |            -> <zmq.Socket(zmq.ROUTER) at 0x7f808cf68bb0>\r\n    -> <function wrap.<locals>.null_wrapper at 0x7f808cf65e60>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/tornado/stack_context.py\", line 300, in \r\nnull_wrapper\r\n    return fn(*args, **kwargs)\r\n           |   |       -> {}\r\n           |   -> (<zmq.Socket(zmq.ROUTER) at 0x7f808cf68bb0>, 1)\r\n           -> <bound method ZMQStream._handle_events of <zmq.eventloop.zmqstream.ZMQStream \r\nobject at 0x7f808bcfaad0>>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/zmq/eventloop/zmqstream.py\", line 577, in \r\n_handle_events\r\n    self._handle_recv()\r\n    |    -> <function ZMQStream._handle_recv at 0x7f808d878d40>\r\n    -> <zmq.eventloop.zmqstream.ZMQStream object at 0x7f808bcfaad0>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/zmq/eventloop/zmqstream.py\", line 606, in \r\n_handle_recv\r\n    self._run_callback(callback, msg)\r\n    |    |             |         -> [<zmq.sugar.frame.Frame object at 0x7f806f2a2350>, \r\n<zmq.sugar.frame.Frame object at 0x7f806f2a2c50>, <zmq.sugar.frame.Frame o...\r\n    |    |             -> <function wrap.<locals>.null_wrapper at 0x7f807fff78c0>\r\n    |    -> <function ZMQStream._run_callback at 0x7f808d878c20>\r\n    -> <zmq.eventloop.zmqstream.ZMQStream object at 0x7f808bcfaad0>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/zmq/eventloop/zmqstream.py\", line 556, in \r\n_run_callback\r\n    callback(*args, **kwargs)\r\n    |         |       -> {}\r\n    |         -> ([<zmq.sugar.frame.Frame object at 0x7f806f2a2350>, <zmq.sugar.frame.Frame \r\nobject at 0x7f806f2a2c50>, <zmq.sugar.frame.Frame ...\r\n    -> <function wrap.<locals>.null_wrapper at 0x7f807fff78c0>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/tornado/stack_context.py\", line 300, in \r\nnull_wrapper\r\n    return fn(*args, **kwargs)\r\n           |   |       -> {}\r\n           |   -> ([<zmq.sugar.frame.Frame object at 0x7f806f2a2350>, <zmq.sugar.frame.Frame \r\nobject at 0x7f806f2a2c50>, <zmq.sugar.frame.Frame ...\r\n           -> <function Kernel.start.<locals>.make_dispatcher.<locals>.dispatcher at \r\n0x7f80800a19e0>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/ipykernel/kernelbase.py\", line 283, in \r\ndispatcher\r\n    return self.dispatch_shell(stream, msg)\r\n           |    |              |       -> [<zmq.sugar.frame.Frame object at 0x7f806f2a2350>, \r\n<zmq.sugar.frame.Frame object at 0x7f806f2a2c50>, <zmq.sugar.frame.Frame o...\r\n           |    |              -> <zmq.eventloop.zmqstream.ZMQStream object at \r\n0x7f808bcfaad0>\r\n           |    -> <function Kernel.dispatch_shell at 0x7f808d565d40>\r\n           -> <google.colab._kernel.Kernel object at 0x7f808bd01390>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/ipykernel/kernelbase.py\", line 233, in \r\ndispatch_shell\r\n    handler(stream, idents, msg)\r\n    |       |       |       -> {'header': {'msg_id': '92314fac-a989-440c-e338-eaaf346749d1', \r\n'username': 'username', 'session': '40cfdbc9-4939-4c77-ead1-3b8...\r\n    |       |       -> [b'40cfdbc9-4939-4c77-ead1-3b87fe262f56']\r\n    |       -> <zmq.eventloop.zmqstream.ZMQStream object at 0x7f808bcfaad0>\r\n    -> <bound method Kernel.execute_request of <google.colab._kernel.Kernel object at \r\n0x7f808bd01390>>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/ipykernel/kernelbase.py\", line 399, in \r\nexecute_request\r\n    user_expressions, allow_stdin)\r\n    |                 -> True\r\n    -> {}\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/ipykernel/ipkernel.py\", line 208, in \r\ndo_execute\r\n    res = shell.run_cell(code, store_history=store_history, silent=silent)\r\n          |     |        |                   |                     -> False\r\n          |     |        |                   -> True\r\n          |     |        -> '#@title ## Step 4.2 Interpolate\\n\\n#@markdown Fill in the form \r\nand run this cell to interpolate a video (currently only 2x i...\r\n          |     -> <function ZMQInteractiveShell.run_cell at 0x7f808d584cb0>\r\n          -> <google.colab._shell.Shell object at 0x7f808bd01450>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/ipykernel/zmqshell.py\", line 537, in run_cell\r\n    return super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)\r\n                 |                    |               |       -> {'store_history': True, \r\n'silent': False}\r\n                 |                    |               -> ('#@title ## Step 4.2 \r\nInterpolate\\n\\n#@markdown Fill in the form and run this cell to interpolate a video \r\n(currently only 2x ...\r\n                 |                    -> <google.colab._shell.Shell object at 0x7f808bd01450>\r\n                 -> <class 'ipykernel.zmqshell.ZMQInteractiveShell'>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/IPython/core/interactiveshell.py\", line 2718, \r\nin run_cell\r\n    interactivity=interactivity, compiler=compiler, result=result)\r\n                  |                       |                -> <ExecutionResult object at \r\n7f806ef84610, execution_count=20 error_before_exec=None error_in_exec=None result=None>\r\n                  |                       -> <IPython.core.compilerop.CachingCompiler object \r\nat 0x7f808d4d54d0>\r\n                  -> 'last_expr'\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/IPython/core/interactiveshell.py\", line 2828, \r\nin run_ast_nodes\r\n    if self.run_code(code, result):\r\n       |    |        |     -> <ExecutionResult object at 7f806ef84610, execution_count=20 \r\nerror_before_exec=None error_in_exec=None result=None>\r\n       |    |        -> <code object <module> at 0x7f806efc5390, file \r\n\"<ipython-input-20-45446e35c57a>\", line 32>\r\n       |    -> <function InteractiveShell.run_code at 0x7f8091760710>\r\n       -> <google.colab._shell.Shell object at 0x7f808bd01450>\r\n\r\n  File \"/usr/local/lib/python3.7/dist-packages/IPython/core/interactiveshell.py\", line 2882, \r\nin run_code\r\n    exec(code_obj, self.user_global_ns, self.user_ns)\r\n         |         |    |               |    -> {'__name__': '__main__', '__doc__': \r\n'Automatically created module for IPython interactive environment', '__package__': None, ...\r\n         |         |    |               -> <google.colab._shell.Shell object at \r\n0x7f808bd01450>\r\n         |         |    -> <property object at 0x7f8091750a10>\r\n         |         -> <google.colab._shell.Shell object at 0x7f808bd01450>\r\n         -> <code object <module> at 0x7f806efc5390, file \"<ipython-input-20-45446e35c57a>\", \r\nline 32>\r\n\r\n  File \"<ipython-input-20-45446e35c57a>\", line 37, in <module>\r\n    algorithm,\r\n    -> 'rife'\r\n\r\n  File \"/usr/local/lib/python3.8/dist-packages/video2x/video2x.py\", line 461, in interpolate\r\n    processes,\r\n    -> 4\r\n\r\n> File \"/usr/local/lib/python3.8/dist-packages/video2x/video2x.py\", line 316, in _run\r\n    if not self.encoder.is_alive() and self.encoder.exception is not None:\r\n           |    |       |              |    |       -> BrokenPipeError(32, 'Broken pipe')\r\n           |    |       |              |    -> <VideoEncoder(Thread-43, stopped \r\n140189564438272)>\r\n           |    |       |              -> <video2x.video2x.Video2X object at 0x7f806ef57210>\r\n           |    |       -> <function Thread.is_alive at 0x7f80935bdb90>\r\n           |    -> <VideoEncoder(Thread-43, stopped 140189564438272)>\r\n           -> <video2x.video2x.Video2X object at 0x7f806ef57210>\r\n\r\nException: encoder died unexpectedly\r\n\r\n12:48:22.246086 | INFO     | Stopping processor processes\r\n\r\n12:48:23.256481 | INFO     | Stopping decoder and encoder threads\r\n\r\n12:48:23.317708 | DEBUG    | Decoding queue depleted\r\n\r\n12:48:23.567554 | INFO     | Decoder thread exiting\r\n\r\n---------------------------------------------------------------------------\r\n\r\nException                                 Traceback (most recent call last)\r\n\r\n[<ipython-input-20-45446e35c57a>](https://localhost:8080/#) in <module>()\r\n     35     processes,\r\n     36     threshold,\r\n---> 37     algorithm,\r\n     38 )\r\n\r\n2 frames\r\n\r\n[/usr/local/lib/python3.8/dist-packages/video2x/video2x.py](https://localhost:8080/#) in interpolate(self, input_path, output_path, processes, threshold, algorithm)\r\n    459             Interpolator,\r\n    460             \"interpolate\",\r\n--> 461             processes,\r\n    462             (threshold, algorithm),\r\n    463         )\r\n\r\n[/usr/local/lib/python3.8/dist-packages/video2x/video2x.py](https://localhost:8080/#) in _run(self, input_path, width, height, total_frames, frame_rate, output_path, output_width, output_height, Processor, mode, processes, processing_settings)\r\n    373 \r\n    374             # raise the error if there is any\r\n--> 375             if len(exception) > 0:\r\n    376                 raise exception[0]\r\n    377 \r\n\r\n[/usr/local/lib/python3.8/dist-packages/video2x/video2x.py](https://localhost:8080/#) in _run(self, input_path, width, height, total_frames, frame_rate, output_path, output_width, output_height, Processor, mode, processes, processing_settings)\r\n    314 \r\n    315                 # check encoder health\r\n--> 316                 if not self.encoder.is_alive() and self.encoder.exception is not None:\r\n    317                     raise Exception(\"encoder died unexpectedly\")\r\n    318 \r\n\r\nException: encoder died unexpectedly\r\n```\r\n\r\n</details>\r\n\r\n----\r\n\r\nI'd be happy to provide the file itself (yes, I tested both in a video player) other than copyright issues... \r\nShould I try out the sample videos? That'd be a major regression if those don't work\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/k4yt3x/video2x/issues/666/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/k4yt3x/video2x/issues/666/timeline","performed_via_github_app":null,"state_reason":null}