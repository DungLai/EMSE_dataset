{"url":"https://api.github.com/repos/k4yt3x/video2x/issues/133","repository_url":"https://api.github.com/repos/k4yt3x/video2x","labels_url":"https://api.github.com/repos/k4yt3x/video2x/issues/133/labels{/name}","comments_url":"https://api.github.com/repos/k4yt3x/video2x/issues/133/comments","events_url":"https://api.github.com/repos/k4yt3x/video2x/issues/133/events","html_url":"https://github.com/k4yt3x/video2x/issues/133","id":478293954,"node_id":"MDU6SXNzdWU0NzgyOTM5NTQ=","number":133,"title":"Image is \"in use by another process\"","user":{"login":"HunterAP23","id":14364070,"node_id":"MDQ6VXNlcjE0MzY0MDcw","avatar_url":"https://avatars.githubusercontent.com/u/14364070?v=4","gravatar_id":"","url":"https://api.github.com/users/HunterAP23","html_url":"https://github.com/HunterAP23","followers_url":"https://api.github.com/users/HunterAP23/followers","following_url":"https://api.github.com/users/HunterAP23/following{/other_user}","gists_url":"https://api.github.com/users/HunterAP23/gists{/gist_id}","starred_url":"https://api.github.com/users/HunterAP23/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HunterAP23/subscriptions","organizations_url":"https://api.github.com/users/HunterAP23/orgs","repos_url":"https://api.github.com/users/HunterAP23/repos","events_url":"https://api.github.com/users/HunterAP23/events{/privacy}","received_events_url":"https://api.github.com/users/HunterAP23/received_events","type":"User","site_admin":false},"labels":[{"id":847238628,"node_id":"MDU6TGFiZWw4NDcyMzg2Mjg=","url":"https://api.github.com/repos/k4yt3x/video2x/labels/type:Bug","name":"type:Bug","color":"d80000","default":false,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":{"login":"k4yt3x","id":21986859,"node_id":"MDQ6VXNlcjIxOTg2ODU5","avatar_url":"https://avatars.githubusercontent.com/u/21986859?v=4","gravatar_id":"","url":"https://api.github.com/users/k4yt3x","html_url":"https://github.com/k4yt3x","followers_url":"https://api.github.com/users/k4yt3x/followers","following_url":"https://api.github.com/users/k4yt3x/following{/other_user}","gists_url":"https://api.github.com/users/k4yt3x/gists{/gist_id}","starred_url":"https://api.github.com/users/k4yt3x/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/k4yt3x/subscriptions","organizations_url":"https://api.github.com/users/k4yt3x/orgs","repos_url":"https://api.github.com/users/k4yt3x/repos","events_url":"https://api.github.com/users/k4yt3x/events{/privacy}","received_events_url":"https://api.github.com/users/k4yt3x/received_events","type":"User","site_admin":false},"assignees":[{"login":"k4yt3x","id":21986859,"node_id":"MDQ6VXNlcjIxOTg2ODU5","avatar_url":"https://avatars.githubusercontent.com/u/21986859?v=4","gravatar_id":"","url":"https://api.github.com/users/k4yt3x","html_url":"https://github.com/k4yt3x","followers_url":"https://api.github.com/users/k4yt3x/followers","following_url":"https://api.github.com/users/k4yt3x/following{/other_user}","gists_url":"https://api.github.com/users/k4yt3x/gists{/gist_id}","starred_url":"https://api.github.com/users/k4yt3x/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/k4yt3x/subscriptions","organizations_url":"https://api.github.com/users/k4yt3x/orgs","repos_url":"https://api.github.com/users/k4yt3x/repos","events_url":"https://api.github.com/users/k4yt3x/events{/privacy}","received_events_url":"https://api.github.com/users/k4yt3x/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2019-08-08T07:15:52Z","updated_at":"2019-09-18T23:23:38Z","closed_at":"2019-09-18T23:23:38Z","author_association":"NONE","active_lock_reason":null,"body":"## Environment Information\r\n\r\n|commit e12db41213a87f5dce072373023b393f23b2bcb5|\r\n|`Video2X`||\r\n\r\n## Symptom\r\n\r\nSometimes while running a job, I run into a what seems to be a threading issue where a process is trying to access an image that is in use by another process.\r\nThese can occur both when taking the extracted frames and feeding into the waifu2x programs, or when takign the upscaled images and giving them to ffmpeg to put it back together into a video. The error message I have included below with a screenshot refers to the latter situation.\r\n\r\nThe exact command I'm running is fro ma batch script that loops over all video files in a directory, and it looks like the following:\r\n\r\n```\r\nfor %%a in (*.avi) do (\r\n\tpython D:\\Downloads\\CompTools\\Media\\video2x\\bin\\video2x.py -i \"%%a\" -o \"%%~na_VULKAN_CUDNN.mp4\" -m cudnn -d waifu2x_ncnn_vulkan -r 2 -b\r\n)\r\n```\r\nYou can substitute the `-m cudnn` with `-m gpu`, and `-d waifu2x_ncnn_vulkan` with the other possible choices for waifu2x, but the error still occurs.\r\n\r\n## Screenshots or Error Messages\r\n\r\n![image](https://user-images.githubusercontent.com/14364070/62682173-7c628400-b989-11e9-922a-28f5e1cd67fd.png)\r\n\r\n\r\nPlease paste your error message in the code block down below:\r\n\r\n```\r\nUpscaling Progress: 100%|#########################################################9| 1438/1439 [05:28<00:00,  4.36it/s]2019-08-08 03:03:39.891448 [+] INFO: [upscaler] Thread 0 exiting\r\n2019-08-08 03:03:39.894448 [+] INFO: Killing upscaled image cleaner\r\n\r\n[+] INFO: Upscaling completed\r\n[+] INFO: Converting extracted frames into video\r\n[!] ERROR: An exception has occurred\r\nTraceback (most recent call last):\r\n  File \"D:\\Downloads\\CompTools\\Media\\video2x\\bin\\video2x.py\", line 379, in <module>\r\n    upscaler.run()\r\n  File \"D:\\Downloads\\CompTools\\Media\\video2x\\bin\\upscaler.py\", line 351, in run\r\n    fm.convert_video(framerate, f'{self.scale_width}x{self.scale_height}', self.upscaled_frames)\r\n  File \"D:\\Downloads\\CompTools\\Media\\video2x\\bin\\ffmpeg.py\", line 164, in convert_video\r\n    (upscaled_frames / frame_name).rename(upscaled_frames / regex.sub('.png', str(frame_name)))\r\n  File \"c:\\python37\\lib\\pathlib.py\", line 1319, in rename\r\n    self._accessor.rename(self, target)\r\nPermissionError: [WinError 32] The process cannot access the file because it is being used by another process: 'D:\\\\Downloads\\\\CompTools\\\\Media\\\\video2x\\\\cache\\\\tmpw20rrxou\\\\extracted_1158.png.png' -> 'D:\\\\Downloads\\\\CompTools\\\\Media\\\\video2x\\\\cache\\\\tmpw20rrxou\\\\extracted_1158.png'\r\nPress any key to continue . . .\r\n```\r\n\r\nMy suggestion for fixes:\r\n1. Add a delay between the different tasks so the next task does not throw this exception when the previous task is still seemingly using the images.\r\n2. Add exception handling to retry the job if this issue throws an exception.","closed_by":{"login":"k4yt3x","id":21986859,"node_id":"MDQ6VXNlcjIxOTg2ODU5","avatar_url":"https://avatars.githubusercontent.com/u/21986859?v=4","gravatar_id":"","url":"https://api.github.com/users/k4yt3x","html_url":"https://github.com/k4yt3x","followers_url":"https://api.github.com/users/k4yt3x/followers","following_url":"https://api.github.com/users/k4yt3x/following{/other_user}","gists_url":"https://api.github.com/users/k4yt3x/gists{/gist_id}","starred_url":"https://api.github.com/users/k4yt3x/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/k4yt3x/subscriptions","organizations_url":"https://api.github.com/users/k4yt3x/orgs","repos_url":"https://api.github.com/users/k4yt3x/repos","events_url":"https://api.github.com/users/k4yt3x/events{/privacy}","received_events_url":"https://api.github.com/users/k4yt3x/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/k4yt3x/video2x/issues/133/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/k4yt3x/video2x/issues/133/timeline","performed_via_github_app":null,"state_reason":"completed"}