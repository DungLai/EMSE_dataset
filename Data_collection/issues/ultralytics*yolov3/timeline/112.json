[{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/467473566","html_url":"https://github.com/ultralytics/yolov3/issues/112#issuecomment-467473566","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/112","id":467473566,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzQ3MzU2Ng==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2019-02-26T15:05:44Z","updated_at":"2019-02-26T15:05:44Z","author_association":"MEMBER","body":"@iadfy recommend you run lineprofiler to find the slow areas and then respond. COCO test.py runs on 5000 images in about 2 minutes on a P100, so unless its reproducible in COCO or you specify profiler results I can't help you.","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/467473566/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"id":2165132446,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjE2NTEzMjQ0Ng==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2165132446","actor":{"login":"iadfy","id":31213819,"node_id":"MDQ6VXNlcjMxMjEzODE5","avatar_url":"https://avatars.githubusercontent.com/u/31213819?v=4","gravatar_id":"","url":"https://api.github.com/users/iadfy","html_url":"https://github.com/iadfy","followers_url":"https://api.github.com/users/iadfy/followers","following_url":"https://api.github.com/users/iadfy/following{/other_user}","gists_url":"https://api.github.com/users/iadfy/gists{/gist_id}","starred_url":"https://api.github.com/users/iadfy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iadfy/subscriptions","organizations_url":"https://api.github.com/users/iadfy/orgs","repos_url":"https://api.github.com/users/iadfy/repos","events_url":"https://api.github.com/users/iadfy/events{/privacy}","received_events_url":"https://api.github.com/users/iadfy/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-02-26T15:05:44Z","performed_via_github_app":null},{"id":2165132447,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIxNjUxMzI0NDc=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2165132447","actor":{"login":"iadfy","id":31213819,"node_id":"MDQ6VXNlcjMxMjEzODE5","avatar_url":"https://avatars.githubusercontent.com/u/31213819?v=4","gravatar_id":"","url":"https://api.github.com/users/iadfy","html_url":"https://github.com/iadfy","followers_url":"https://api.github.com/users/iadfy/followers","following_url":"https://api.github.com/users/iadfy/following{/other_user}","gists_url":"https://api.github.com/users/iadfy/gists{/gist_id}","starred_url":"https://api.github.com/users/iadfy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iadfy/subscriptions","organizations_url":"https://api.github.com/users/iadfy/orgs","repos_url":"https://api.github.com/users/iadfy/repos","events_url":"https://api.github.com/users/iadfy/events{/privacy}","received_events_url":"https://api.github.com/users/iadfy/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-02-26T15:05:44Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/467846650","html_url":"https://github.com/ultralytics/yolov3/issues/112#issuecomment-467846650","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/112","id":467846650,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2Nzg0NjY1MA==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2019-02-27T12:38:38Z","updated_at":"2019-02-27T12:38:38Z","author_association":"MEMBER","body":"@iadfy another option is to modify your NMS style in `non_maximum_suppression()` in utils.py. You can try swapping between `OR` and `MERGE` methods. `MERGE` returns slightly higher mAP at the expense of higher computation time. You may need to git clone the latest repo in order to do this, as there have been many recent changes in this area of the code:\r\n\r\nhttps://github.com/ultralytics/yolov3/blob/324dc6af6e795135ea4e0f32ffb080ca91913977/utils/utils.py#L380-L419\r\n\r\n","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/467846650/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"id":2167849077,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjE2Nzg0OTA3Nw==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2167849077","actor":{"login":"iadfy","id":31213819,"node_id":"MDQ6VXNlcjMxMjEzODE5","avatar_url":"https://avatars.githubusercontent.com/u/31213819?v=4","gravatar_id":"","url":"https://api.github.com/users/iadfy","html_url":"https://github.com/iadfy","followers_url":"https://api.github.com/users/iadfy/followers","following_url":"https://api.github.com/users/iadfy/following{/other_user}","gists_url":"https://api.github.com/users/iadfy/gists{/gist_id}","starred_url":"https://api.github.com/users/iadfy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iadfy/subscriptions","organizations_url":"https://api.github.com/users/iadfy/orgs","repos_url":"https://api.github.com/users/iadfy/repos","events_url":"https://api.github.com/users/iadfy/events{/privacy}","received_events_url":"https://api.github.com/users/iadfy/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-02-27T12:38:38Z","performed_via_github_app":null},{"id":2167849078,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIxNjc4NDkwNzg=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2167849078","actor":{"login":"iadfy","id":31213819,"node_id":"MDQ6VXNlcjMxMjEzODE5","avatar_url":"https://avatars.githubusercontent.com/u/31213819?v=4","gravatar_id":"","url":"https://api.github.com/users/iadfy","html_url":"https://github.com/iadfy","followers_url":"https://api.github.com/users/iadfy/followers","following_url":"https://api.github.com/users/iadfy/following{/other_user}","gists_url":"https://api.github.com/users/iadfy/gists{/gist_id}","starred_url":"https://api.github.com/users/iadfy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iadfy/subscriptions","organizations_url":"https://api.github.com/users/iadfy/orgs","repos_url":"https://api.github.com/users/iadfy/repos","events_url":"https://api.github.com/users/iadfy/events{/privacy}","received_events_url":"https://api.github.com/users/iadfy/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-02-27T12:38:38Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/467878445","html_url":"https://github.com/ultralytics/yolov3/issues/112#issuecomment-467878445","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/112","id":467878445,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2Nzg3ODQ0NQ==","user":{"login":"pprp","id":29230784,"node_id":"MDQ6VXNlcjI5MjMwNzg0","avatar_url":"https://avatars.githubusercontent.com/u/29230784?v=4","gravatar_id":"","url":"https://api.github.com/users/pprp","html_url":"https://github.com/pprp","followers_url":"https://api.github.com/users/pprp/followers","following_url":"https://api.github.com/users/pprp/following{/other_user}","gists_url":"https://api.github.com/users/pprp/gists{/gist_id}","starred_url":"https://api.github.com/users/pprp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pprp/subscriptions","organizations_url":"https://api.github.com/users/pprp/orgs","repos_url":"https://api.github.com/users/pprp/repos","events_url":"https://api.github.com/users/pprp/events{/privacy}","received_events_url":"https://api.github.com/users/pprp/received_events","type":"User","site_admin":false},"created_at":"2019-02-27T14:19:00Z","updated_at":"2019-02-27T14:19:00Z","author_association":"NONE","body":"It took about 20 seconds to compute the mAP of 4 pictures. Why is it so slowï¼Ÿ","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/467878445/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pprp","id":29230784,"node_id":"MDQ6VXNlcjI5MjMwNzg0","avatar_url":"https://avatars.githubusercontent.com/u/29230784?v=4","gravatar_id":"","url":"https://api.github.com/users/pprp","html_url":"https://github.com/pprp","followers_url":"https://api.github.com/users/pprp/followers","following_url":"https://api.github.com/users/pprp/following{/other_user}","gists_url":"https://api.github.com/users/pprp/gists{/gist_id}","starred_url":"https://api.github.com/users/pprp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pprp/subscriptions","organizations_url":"https://api.github.com/users/pprp/orgs","repos_url":"https://api.github.com/users/pprp/repos","events_url":"https://api.github.com/users/pprp/events{/privacy}","received_events_url":"https://api.github.com/users/pprp/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/467885870","html_url":"https://github.com/ultralytics/yolov3/issues/112#issuecomment-467885870","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/112","id":467885870,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2Nzg4NTg3MA==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2019-02-27T14:38:34Z","updated_at":"2019-02-27T14:38:46Z","author_association":"MEMBER","body":"@iadfy @pprp: On a P100 instance on GCP, `test.py` computes mAP at about 0.45s per 32-image batch:\r\n\r\n```\r\nultralytics@instance-1:~/yolov3$ python3 test.py\r\nNamespace(batch_size=32, cfg='cfg/yolov3.cfg', conf_thres=0.3, data_cfg='cfg/coco.data', img_size=416, iou_thres=0.5, nms_thres=0.45, save_json=False, weights='weights/yolov3.weights')\r\n\r\nUsing cuda _CudaDeviceProperties(name='Tesla P100-PCIE-16GB', major=6, minor=0, total_memory=16280MB, multi_processor_count=56)\r\n\r\n      Image      Total          P          R        mAP\r\n         32       5000      0.635      0.581       0.57      0.551s\r\n         64       5000       0.63      0.591      0.578       0.43s\r\n         96       5000      0.659      0.629      0.619      0.453s\r\n        128       5000      0.657       0.63      0.621      0.434s\r\n        160       5000      0.663      0.639      0.631      0.442s\r\n        192       5000      0.659      0.635      0.629      0.444s\r\n        224       5000      0.648      0.624      0.618      0.452s\r\n        256       5000       0.65       0.62      0.615      0.441s\r\n...\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/467885870/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"id":2168170585,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjE2ODE3MDU4NQ==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2168170585","actor":{"login":"pprp","id":29230784,"node_id":"MDQ6VXNlcjI5MjMwNzg0","avatar_url":"https://avatars.githubusercontent.com/u/29230784?v=4","gravatar_id":"","url":"https://api.github.com/users/pprp","html_url":"https://github.com/pprp","followers_url":"https://api.github.com/users/pprp/followers","following_url":"https://api.github.com/users/pprp/following{/other_user}","gists_url":"https://api.github.com/users/pprp/gists{/gist_id}","starred_url":"https://api.github.com/users/pprp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pprp/subscriptions","organizations_url":"https://api.github.com/users/pprp/orgs","repos_url":"https://api.github.com/users/pprp/repos","events_url":"https://api.github.com/users/pprp/events{/privacy}","received_events_url":"https://api.github.com/users/pprp/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-02-27T14:38:35Z","performed_via_github_app":null},{"id":2168170586,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIxNjgxNzA1ODY=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2168170586","actor":{"login":"pprp","id":29230784,"node_id":"MDQ6VXNlcjI5MjMwNzg0","avatar_url":"https://avatars.githubusercontent.com/u/29230784?v=4","gravatar_id":"","url":"https://api.github.com/users/pprp","html_url":"https://github.com/pprp","followers_url":"https://api.github.com/users/pprp/followers","following_url":"https://api.github.com/users/pprp/following{/other_user}","gists_url":"https://api.github.com/users/pprp/gists{/gist_id}","starred_url":"https://api.github.com/users/pprp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pprp/subscriptions","organizations_url":"https://api.github.com/users/pprp/orgs","repos_url":"https://api.github.com/users/pprp/repos","events_url":"https://api.github.com/users/pprp/events{/privacy}","received_events_url":"https://api.github.com/users/pprp/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-02-27T14:38:35Z","performed_via_github_app":null},{"id":2168170592,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjE2ODE3MDU5Mg==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2168170592","actor":{"login":"iadfy","id":31213819,"node_id":"MDQ6VXNlcjMxMjEzODE5","avatar_url":"https://avatars.githubusercontent.com/u/31213819?v=4","gravatar_id":"","url":"https://api.github.com/users/iadfy","html_url":"https://github.com/iadfy","followers_url":"https://api.github.com/users/iadfy/followers","following_url":"https://api.github.com/users/iadfy/following{/other_user}","gists_url":"https://api.github.com/users/iadfy/gists{/gist_id}","starred_url":"https://api.github.com/users/iadfy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iadfy/subscriptions","organizations_url":"https://api.github.com/users/iadfy/orgs","repos_url":"https://api.github.com/users/iadfy/repos","events_url":"https://api.github.com/users/iadfy/events{/privacy}","received_events_url":"https://api.github.com/users/iadfy/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-02-27T14:38:35Z","performed_via_github_app":null},{"id":2168170593,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIxNjgxNzA1OTM=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2168170593","actor":{"login":"iadfy","id":31213819,"node_id":"MDQ6VXNlcjMxMjEzODE5","avatar_url":"https://avatars.githubusercontent.com/u/31213819?v=4","gravatar_id":"","url":"https://api.github.com/users/iadfy","html_url":"https://github.com/iadfy","followers_url":"https://api.github.com/users/iadfy/followers","following_url":"https://api.github.com/users/iadfy/following{/other_user}","gists_url":"https://api.github.com/users/iadfy/gists{/gist_id}","starred_url":"https://api.github.com/users/iadfy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iadfy/subscriptions","organizations_url":"https://api.github.com/users/iadfy/orgs","repos_url":"https://api.github.com/users/iadfy/repos","events_url":"https://api.github.com/users/iadfy/events{/privacy}","received_events_url":"https://api.github.com/users/iadfy/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-02-27T14:38:35Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/467891963","html_url":"https://github.com/ultralytics/yolov3/issues/112#issuecomment-467891963","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/112","id":467891963,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2Nzg5MTk2Mw==","user":{"login":"iadfy","id":31213819,"node_id":"MDQ6VXNlcjMxMjEzODE5","avatar_url":"https://avatars.githubusercontent.com/u/31213819?v=4","gravatar_id":"","url":"https://api.github.com/users/iadfy","html_url":"https://github.com/iadfy","followers_url":"https://api.github.com/users/iadfy/followers","following_url":"https://api.github.com/users/iadfy/following{/other_user}","gists_url":"https://api.github.com/users/iadfy/gists{/gist_id}","starred_url":"https://api.github.com/users/iadfy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iadfy/subscriptions","organizations_url":"https://api.github.com/users/iadfy/orgs","repos_url":"https://api.github.com/users/iadfy/repos","events_url":"https://api.github.com/users/iadfy/events{/privacy}","received_events_url":"https://api.github.com/users/iadfy/received_events","type":"User","site_admin":false},"created_at":"2019-02-27T14:53:43Z","updated_at":"2019-02-27T14:54:35Z","author_association":"NONE","body":"my line_profiler on non_max_suppression is on below. i don't know where to see. could you help?\r\n\r\n--------------------------------------------------------\r\n      Image      Total          P          R        mAP\r\nTimer unit: 3.09179e-07 s\r\n\r\nTotal time: 92.4133 s\r\nFile: D:\\CS\\yolov3\\utils\\utils.py\r\nFunction: non_max_suppression at line 287\r\n\r\nLine #      Hits         Time  Per Hit   % Time  Line Contents\r\n==============================================================\r\n   287                                           def non_max_suppression(prediction, conf_thres=0.5, nms_thres=0.4):\r\n   288                                               \"\"\"\r\n   289                                               Removes detections with lower object confidence score than 'conf_thres'\r\n   290                                               Non-Maximum Suppression to further filter detections.\r\n   291                                               Returns detections with shape:\r\n   292                                                   (x1, y1, x2, y2, object_conf, class_score, class_pred)\r\n   293                                               \"\"\"\r\n   294\r\n   295         1         50.0     50.0      0.0      output = [None for _ in range(len(prediction))]\r\n   296         7        707.0    101.0      0.0      for image_i, pred in enumerate(prediction):\r\n   297                                                   # Filter out confidence scores below threshold\r\n   298                                                   # Get score and class with highest confidence\r\n   299\r\n   300                                                   # cross-class NMS (experimental)\r\n   301         6         60.0     10.0      0.0          cross_class_nms = False\r\n   302         6         17.0      2.8      0.0          if cross_class_nms:\r\n   303                                                       a = pred.clone()\r\n   304                                                       _, indices = torch.sort(-a[:, 4], 0)  # sort best to worst\r\n   305                                                       a = a[indices]\r\n   306                                                       radius = 30  # area to search for cross-class ious\r\n   307                                                       for i in range(len(a)):\r\n   308                                                           if i >= len(a) - 1:\r\n   309                                                               break\r\n   310\r\n   311                                                           close = (torch.abs(a[i, 0] - a[i + 1:, 0]) < radius) & (torch.abs(a[i, 1] - a[i + 1:, 1]\r\n) < radius)\r\n   312                                                           close = close.nonzero()\r\n   313\r\n   314                                                           if len(close) > 0:\r\n   315                                                               close = close + i + 1\r\n   316                                                               iou = bbox_iou(a[i:i + 1, :4], a[close.squeeze(), :4].reshape(-1, 4), x1y1x2y2=False\r\n)\r\n   317                                                               bad = close[iou > nms_thres]\r\n   318\r\n   319                                                               if len(bad) > 0:\r\n   320                                                                   mask = torch.ones(len(a)).type(torch.ByteTensor)\r\n   321                                                                   mask[bad] = 0\r\n   322                                                                   a = a[mask]\r\n   323                                                       pred = a\r\n   324\r\n   325                                                   # Experiment: Prior class size rejection\r\n   326                                                   # x, y, w, h = pred[:, 0], pred[:, 1], pred[:, 2], pred[:, 3]\r\n   327                                                   # a = w * h  # area\r\n   328                                                   # ar = w / (h + 1e-16)  # aspect ratio\r\n   329                                                   # n = len(w)\r\n   330                                                   # log_w, log_h, log_a, log_ar = torch.log(w), torch.log(h), torch.log(a), torch.log(ar)\r\n   331                                                   # shape_likelihood = np.zeros((n, 60), dtype=np.float32)\r\n   332                                                   # x = np.concatenate((log_w.reshape(-1, 1), log_h.reshape(-1, 1)), 1)\r\n   333                                                   # from scipy.stats import multivariate_normal\r\n   334                                                   # for c in range(60):\r\n   335                                                   # shape_likelihood[:, c] =\r\n   336                                                   #   multivariate_normal.pdf(x, mean=mat['class_mu'][c, :2], cov=mat['class_cov'][c, :2, :2])\r\n   337\r\n   338         6       4742.0    790.3      0.0          class_prob, class_pred = torch.max(F.softmax(pred[:, 5:], 1), 1)\r\n   339\r\n   340         6       3035.0    505.8      0.0          v = ((pred[:, 4] > conf_thres) & (class_prob > .4))  # TODO examine arbitrary 0.4 thres here\r\n   341         6       4364.0    727.3      0.0          v = v.nonzero().squeeze()\r\n   342         6        106.0     17.7      0.0          if len(v.shape) == 0:\r\n   343                                                       v = v.unsqueeze(0)\r\n   344\r\n   345         6       1884.0    314.0      0.0          pred = pred[v]\r\n   346         6       1577.0    262.8      0.0          class_prob = class_prob[v]\r\n   347         6       1620.0    270.0      0.0          class_pred = class_pred[v]\r\n   348\r\n   349                                                   # If none are remaining => process next image\r\n   350         6         47.0      7.8      0.0          nP = pred.shape[0]\r\n   351         6         21.0      3.5      0.0          if not nP:\r\n   352                                                       continue\r\n   353\r\n   354                                                   # From (center x, center y, width, height) to (x1, y1, x2, y2)\r\n   355         6      31972.0   5328.7      0.0          pred[:, :4] = xywh2xyxy(pred[:, :4])\r\n   356\r\n   357                                                   # Detections ordered as (x1, y1, x2, y2, obj_conf, class_prob, class_pred)\r\n   358         6       4978.0    829.7      0.0          detections = torch.cat((pred[:, :5], class_prob.float().unsqueeze(1), class_pred.float().unsquee\r\nze(1)), 1)\r\n   359                                                   # Iterate through all predicted classes\r\n   360         6      16816.0   2802.7      0.0          unique_labels = detections[:, -1].cpu().unique()\r\n   361         6         38.0      6.3      0.0          if prediction.is_cuda:\r\n   362         6       2088.0    348.0      0.0              unique_labels = unique_labels.cuda(prediction.device)\r\n   363\r\n   364         6         23.0      3.8      0.0          nms_style = 'MERGE'  # 'OR' (default), 'AND', 'MERGE' (experimental)\r\n   365        18       1542.0     85.7      0.0          for c in unique_labels:\r\n   366                                                       # Get the detections with class c\r\n   367        12      14759.0   1229.9      0.0              dc = detections[detections[:, -1] == c]\r\n   368                                                       # Sort the detections by maximum object confidence\r\n   369        12      27957.0   2329.8      0.0              _, conf_sort_index = torch.sort(dc[:, 4] * dc[:, 5], descending=True)\r\n   370        12       3313.0    276.1      0.0              dc = dc[conf_sort_index]\r\n   371\r\n   372                                                       # Non-maximum suppression\r\n   373        12         81.0      6.8      0.0              det_max = []\r\n   374        12         41.0      3.4      0.0              if nms_style == 'OR':  # default\r\n   375                                                           while dc.shape[0]:\r\n   376                                                               det_max.append(dc[:1])  # save highest conf detection\r\n   377                                                               if len(dc) == 1:  # Stop if we're at the last detection\r\n   378                                                                   break\r\n   379                                                               iou = bbox_iou(det_max[-1], dc[1:])  # iou with other boxes\r\n   380                                                               dc = dc[1:][iou < nms_thres]  # remove ious > threshold\r\n   381\r\n   382                                                           # Image      Total          P          R        mAP\r\n   383                                                           #  4964       5000      0.629      0.594      0.586\r\n   384\r\n   385        12         37.0      3.1      0.0              elif nms_style == 'AND':  # requires overlap, single boxes erased\r\n   386                                                           while len(dc) > 1:\r\n   387                                                               iou = bbox_iou(dc[:1], dc[1:])  # iou with other boxes\r\n   388                                                               if iou.max() > 0.5:\r\n   389                                                                   det_max.append(dc[:1])\r\n   390                                                               dc = dc[1:][iou < nms_thres]  # remove ious > threshold\r\n   391\r\n   392        12         35.0      2.9      0.0              elif nms_style == 'MERGE':  # weighted mixture box\r\n   393     37474     777619.0     20.8      0.3                  while len(dc) > 0:\r\n   394     37462  133808018.0   3571.8     44.8                      iou = bbox_iou(dc[:1], dc[0:])  # iou with other boxes\r\n   395     37462    5326260.0    142.2      1.8                      i = iou > nms_thres\r\n   396\r\n   397     37462   62382452.0   1665.2     20.9                      weights = dc[i, 4:5] * dc[i, 5:6]\r\n   398     37462   61213291.0   1634.0     20.5                      dc[0, :4] = (weights * dc[i, :4]).sum(0) / weights.sum()\r\n   399     37462    2288985.0     61.1      0.8                      det_max.append(dc[:1])\r\n   400     37462   32763676.0    874.6     11.0                      dc = dc[iou < nms_thres]\r\n   401\r\n   402                                                           # Image      Total          P          R        mAP\r\n   403                                                           #  4964       5000      0.633      0.598      0.589  # normal\r\n   404\r\n   405        12         53.0      4.4      0.0              if len(det_max) > 0:\r\n   406        12     212907.0  17742.2      0.1                  det_max = torch.cat(det_max)\r\n   407                                                           # Add max detections to outputs\r\n   408        12       3952.0    329.3      0.0                  output[image_i] = det_max if output[image_i] is None else torch.cat((output[image_i], det_max))\r\n   409\r\n   410         1         50.0     50.0      0.0      return output\r\n\r\n","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/467891963/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"iadfy","id":31213819,"node_id":"MDQ6VXNlcjMxMjEzODE5","avatar_url":"https://avatars.githubusercontent.com/u/31213819?v=4","gravatar_id":"","url":"https://api.github.com/users/iadfy","html_url":"https://github.com/iadfy","followers_url":"https://api.github.com/users/iadfy/followers","following_url":"https://api.github.com/users/iadfy/following{/other_user}","gists_url":"https://api.github.com/users/iadfy/gists{/gist_id}","starred_url":"https://api.github.com/users/iadfy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iadfy/subscriptions","organizations_url":"https://api.github.com/users/iadfy/orgs","repos_url":"https://api.github.com/users/iadfy/repos","events_url":"https://api.github.com/users/iadfy/events{/privacy}","received_events_url":"https://api.github.com/users/iadfy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/467905720","html_url":"https://github.com/ultralytics/yolov3/issues/112#issuecomment-467905720","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/112","id":467905720,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzkwNTcyMA==","user":{"login":"iadfy","id":31213819,"node_id":"MDQ6VXNlcjMxMjEzODE5","avatar_url":"https://avatars.githubusercontent.com/u/31213819?v=4","gravatar_id":"","url":"https://api.github.com/users/iadfy","html_url":"https://github.com/iadfy","followers_url":"https://api.github.com/users/iadfy/followers","following_url":"https://api.github.com/users/iadfy/following{/other_user}","gists_url":"https://api.github.com/users/iadfy/gists{/gist_id}","starred_url":"https://api.github.com/users/iadfy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iadfy/subscriptions","organizations_url":"https://api.github.com/users/iadfy/orgs","repos_url":"https://api.github.com/users/iadfy/repos","events_url":"https://api.github.com/users/iadfy/events{/privacy}","received_events_url":"https://api.github.com/users/iadfy/received_events","type":"User","site_admin":false},"created_at":"2019-02-27T15:26:58Z","updated_at":"2019-02-27T15:29:03Z","author_association":"NONE","body":"I found something interesting.\r\nwhat I was using is customized .cfg file which has classes=2, filters=21 that derived from (2 classes +4+1 ) *3 =21 and each testing tooks about 99.3 sec for test.py (non_max_suppression exactly).\r\n-----------------------------------------------------------\r\n    Image      Total          P          R        mAP       time\r\n          6        202   0.000239      0.417    0.00304       99.3\r\n------------------------------------------------------------------\r\nhowever, with yolov3.cfg, which has 80 classes and 255 filters, testing (after training 1 epoch with same dataset as i used for 2 classes and 21 filters) tooks around 0.15 sec!\r\n----------------------------------------------------------------------\r\n  Image      Total          P          R        mAP       time\r\n          4        202          0          0          0      0.229\r\n          8        202          0          0          0      0.109\r\n         12        202          0          0          0       0.14\r\n         16        202          0          0          0      0.151\r\n         20        202          0          0          0      0.157\r\n------------------------------------------------------------------\r\nit seems that smaller number of classes with smaller filters takes longer time to testing but i have no idea where to figure out... any idea would be helpful.\r\n\r\nthanks in advance\r\n\r\n","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/467905720/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"iadfy","id":31213819,"node_id":"MDQ6VXNlcjMxMjEzODE5","avatar_url":"https://avatars.githubusercontent.com/u/31213819?v=4","gravatar_id":"","url":"https://api.github.com/users/iadfy","html_url":"https://github.com/iadfy","followers_url":"https://api.github.com/users/iadfy/followers","following_url":"https://api.github.com/users/iadfy/following{/other_user}","gists_url":"https://api.github.com/users/iadfy/gists{/gist_id}","starred_url":"https://api.github.com/users/iadfy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iadfy/subscriptions","organizations_url":"https://api.github.com/users/iadfy/orgs","repos_url":"https://api.github.com/users/iadfy/repos","events_url":"https://api.github.com/users/iadfy/events{/privacy}","received_events_url":"https://api.github.com/users/iadfy/received_events","type":"User","site_admin":false}},{"id":2175652295,"node_id":"MDExOkNsb3NlZEV2ZW50MjE3NTY1MjI5NQ==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2175652295","actor":{"login":"iadfy","id":31213819,"node_id":"MDQ6VXNlcjMxMjEzODE5","avatar_url":"https://avatars.githubusercontent.com/u/31213819?v=4","gravatar_id":"","url":"https://api.github.com/users/iadfy","html_url":"https://github.com/iadfy","followers_url":"https://api.github.com/users/iadfy/followers","following_url":"https://api.github.com/users/iadfy/following{/other_user}","gists_url":"https://api.github.com/users/iadfy/gists{/gist_id}","starred_url":"https://api.github.com/users/iadfy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iadfy/subscriptions","organizations_url":"https://api.github.com/users/iadfy/orgs","repos_url":"https://api.github.com/users/iadfy/repos","events_url":"https://api.github.com/users/iadfy/events{/privacy}","received_events_url":"https://api.github.com/users/iadfy/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-03-02T08:12:39Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"wtiandong","id":7546978,"node_id":"MDQ6VXNlcjc1NDY5Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/7546978?v=4","gravatar_id":"","url":"https://api.github.com/users/wtiandong","html_url":"https://github.com/wtiandong","followers_url":"https://api.github.com/users/wtiandong/followers","following_url":"https://api.github.com/users/wtiandong/following{/other_user}","gists_url":"https://api.github.com/users/wtiandong/gists{/gist_id}","starred_url":"https://api.github.com/users/wtiandong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wtiandong/subscriptions","organizations_url":"https://api.github.com/users/wtiandong/orgs","repos_url":"https://api.github.com/users/wtiandong/repos","events_url":"https://api.github.com/users/wtiandong/events{/privacy}","received_events_url":"https://api.github.com/users/wtiandong/received_events","type":"User","site_admin":false},"created_at":"2019-03-05T01:12:28Z","updated_at":"2019-03-05T01:12:28Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/117","repository_url":"https://api.github.com/repos/ultralytics/yolov3","labels_url":"https://api.github.com/repos/ultralytics/yolov3/issues/117/labels{/name}","comments_url":"https://api.github.com/repos/ultralytics/yolov3/issues/117/comments","events_url":"https://api.github.com/repos/ultralytics/yolov3/issues/117/events","html_url":"https://github.com/ultralytics/yolov3/issues/117","id":417067053,"node_id":"MDU6SXNzdWU0MTcwNjcwNTM=","number":117,"title":"Explaination on Why NMS Is Slow During Custom Dataset Training And How to Solve it","user":{"login":"wtiandong","id":7546978,"node_id":"MDQ6VXNlcjc1NDY5Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/7546978?v=4","gravatar_id":"","url":"https://api.github.com/users/wtiandong","html_url":"https://github.com/wtiandong","followers_url":"https://api.github.com/users/wtiandong/followers","following_url":"https://api.github.com/users/wtiandong/following{/other_user}","gists_url":"https://api.github.com/users/wtiandong/gists{/gist_id}","starred_url":"https://api.github.com/users/wtiandong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wtiandong/subscriptions","organizations_url":"https://api.github.com/users/wtiandong/orgs","repos_url":"https://api.github.com/users/wtiandong/repos","events_url":"https://api.github.com/users/wtiandong/events{/privacy}","received_events_url":"https://api.github.com/users/wtiandong/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-03-05T01:12:28Z","updated_at":"2019-03-21T10:39:20Z","closed_at":"2019-03-16T09:52:46Z","author_association":"NONE","active_lock_reason":null,"repository":{"id":146165888,"node_id":"MDEwOlJlcG9zaXRvcnkxNDYxNjU4ODg=","name":"yolov3","full_name":"ultralytics/yolov3","private":false,"owner":{"login":"ultralytics","id":26833451,"node_id":"MDEyOk9yZ2FuaXphdGlvbjI2ODMzNDUx","avatar_url":"https://avatars.githubusercontent.com/u/26833451?v=4","gravatar_id":"","url":"https://api.github.com/users/ultralytics","html_url":"https://github.com/ultralytics","followers_url":"https://api.github.com/users/ultralytics/followers","following_url":"https://api.github.com/users/ultralytics/following{/other_user}","gists_url":"https://api.github.com/users/ultralytics/gists{/gist_id}","starred_url":"https://api.github.com/users/ultralytics/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ultralytics/subscriptions","organizations_url":"https://api.github.com/users/ultralytics/orgs","repos_url":"https://api.github.com/users/ultralytics/repos","events_url":"https://api.github.com/users/ultralytics/events{/privacy}","received_events_url":"https://api.github.com/users/ultralytics/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/ultralytics/yolov3","description":"YOLOv3 in PyTorch > ONNX > CoreML > TFLite","fork":false,"url":"https://api.github.com/repos/ultralytics/yolov3","forks_url":"https://api.github.com/repos/ultralytics/yolov3/forks","keys_url":"https://api.github.com/repos/ultralytics/yolov3/keys{/key_id}","collaborators_url":"https://api.github.com/repos/ultralytics/yolov3/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/ultralytics/yolov3/teams","hooks_url":"https://api.github.com/repos/ultralytics/yolov3/hooks","issue_events_url":"https://api.github.com/repos/ultralytics/yolov3/issues/events{/number}","events_url":"https://api.github.com/repos/ultralytics/yolov3/events","assignees_url":"https://api.github.com/repos/ultralytics/yolov3/assignees{/user}","branches_url":"https://api.github.com/repos/ultralytics/yolov3/branches{/branch}","tags_url":"https://api.github.com/repos/ultralytics/yolov3/tags","blobs_url":"https://api.github.com/repos/ultralytics/yolov3/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/ultralytics/yolov3/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/ultralytics/yolov3/git/refs{/sha}","trees_url":"https://api.github.com/repos/ultralytics/yolov3/git/trees{/sha}","statuses_url":"https://api.github.com/repos/ultralytics/yolov3/statuses/{sha}","languages_url":"https://api.github.com/repos/ultralytics/yolov3/languages","stargazers_url":"https://api.github.com/repos/ultralytics/yolov3/stargazers","contributors_url":"https://api.github.com/repos/ultralytics/yolov3/contributors","subscribers_url":"https://api.github.com/repos/ultralytics/yolov3/subscribers","subscription_url":"https://api.github.com/repos/ultralytics/yolov3/subscription","commits_url":"https://api.github.com/repos/ultralytics/yolov3/commits{/sha}","git_commits_url":"https://api.github.com/repos/ultralytics/yolov3/git/commits{/sha}","comments_url":"https://api.github.com/repos/ultralytics/yolov3/comments{/number}","issue_comment_url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments{/number}","contents_url":"https://api.github.com/repos/ultralytics/yolov3/contents/{+path}","compare_url":"https://api.github.com/repos/ultralytics/yolov3/compare/{base}...{head}","merges_url":"https://api.github.com/repos/ultralytics/yolov3/merges","archive_url":"https://api.github.com/repos/ultralytics/yolov3/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/ultralytics/yolov3/downloads","issues_url":"https://api.github.com/repos/ultralytics/yolov3/issues{/number}","pulls_url":"https://api.github.com/repos/ultralytics/yolov3/pulls{/number}","milestones_url":"https://api.github.com/repos/ultralytics/yolov3/milestones{/number}","notifications_url":"https://api.github.com/repos/ultralytics/yolov3/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/ultralytics/yolov3/labels{/name}","releases_url":"https://api.github.com/repos/ultralytics/yolov3/releases{/id}","deployments_url":"https://api.github.com/repos/ultralytics/yolov3/deployments","created_at":"2018-08-26T08:57:20Z","updated_at":"2023-01-19T02:45:28Z","pushed_at":"2023-01-02T20:48:03Z","git_url":"git://github.com/ultralytics/yolov3.git","ssh_url":"git@github.com:ultralytics/yolov3.git","clone_url":"https://github.com/ultralytics/yolov3.git","svn_url":"https://github.com/ultralytics/yolov3","homepage":"https://ultralytics.com","size":9609,"stargazers_count":9265,"watchers_count":9265,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":3359,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":7,"license":{"key":"gpl-3.0","name":"GNU General Public License v3.0","spdx_id":"GPL-3.0","url":"https://api.github.com/licenses/gpl-3.0","node_id":"MDc6TGljZW5zZTk="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["coreml","deep-learning","ios","machine-learning","ml","object-detection","onnx","pytorch","tflite","yolo","yolov3","yolov4","yolov5"],"visibility":"public","forks":3359,"open_issues":7,"watchers":9265,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"In issue #112 , @iadfy says that NMS is slow when training a yolov3 network with just two classes. This happen to me too. It takes 2 seconds to forward and backward a batch but 99 seconds to NMS the same batch. @iadfy says that _it seems that smaller number of classes with smaller filters takes longer time to testing but i have no idea where to figure out... any idea would be helpful._ Smaller filters takes longer time is just a result, not the cause.\r\n\r\nThe real cause is NMS is a slow algorithm with time complexity of O(N^2). When you training a new network, the weights are just random initialized. The output of YOLOLayer is just random number centered at 0.5. NMS threshold for testing during training is 0.3, so thousands of bounding box candidates needs for NMS, depend on your input image size and configuration of YOLOLayer Input. And what's worse, the candidates IOU is small with a large probability due to randomization, so the cancellation of high IOU boxes won't work. All these lead to wasting O(N^2) time on NMS on meaningless random box candidates.\r\n\r\nHow to solve it? Well you can just skip testing of few epoch on the begining. Here's the code:\r\n\r\n```python\r\n# Calculate mAP\r\nwith torch.no_grad():\r\n    if(epoch > 40):\r\n        mAP, R, P = test.test(cfg, data_cfg, weights=latest, batch_size=batch_size, img_size=img_size)\r\n\r\n# Write epoch results\r\nif(epoch > 40):\r\n    with open('results.txt', 'a') as file:\r\n        file.write(s + '%11.3g' * 3 % (mAP, P, R) + '\\n')\r\n```\r\nOn train.py, line 169 to 178.\r\n\r\nGood Luck.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/117/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ultralytics/yolov3/issues/117/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/469744692","html_url":"https://github.com/ultralytics/yolov3/issues/112#issuecomment-469744692","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/112","id":469744692,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTc0NDY5Mg==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2019-03-05T16:20:47Z","updated_at":"2019-03-05T16:20:47Z","author_association":"MEMBER","body":"@iadfy @pprp It occured to me that the SGD burn-in functionality might be causing this, since it is hard-coded for a slow LR ramp during the first epoch, from lr=0.0 to lr=0.001 over the first 1000 batches (like darknet). If custom datasets have <1000 batches their parameters may not update substantially by the time NMS needs to be run during testing the epoch 0 results. I've added code to dynamically adapt the burn-in length now to a max of 1/5 of the number of batches in the first epoch.\r\nhttps://github.com/ultralytics/yolov3/blob/6fb14fc903fcea68239541a3de0fca5e6dc036e7/train.py#L90\r\n\r\nI've also switched the default NMS method from MERGE (slightly more accurate, but possibly slightly slower), to OR, the default method used by darknet.\r\nhttps://github.com/ultralytics/yolov3/blob/6fb14fc903fcea68239541a3de0fca5e6dc036e7/utils/utils.py#L382\r\n\r\nHopefully these changes help alleviate the NMS speed issue on custom datasets.","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/469744692/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"id":2181473452,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjE4MTQ3MzQ1Mg==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2181473452","actor":{"login":"pprp","id":29230784,"node_id":"MDQ6VXNlcjI5MjMwNzg0","avatar_url":"https://avatars.githubusercontent.com/u/29230784?v=4","gravatar_id":"","url":"https://api.github.com/users/pprp","html_url":"https://github.com/pprp","followers_url":"https://api.github.com/users/pprp/followers","following_url":"https://api.github.com/users/pprp/following{/other_user}","gists_url":"https://api.github.com/users/pprp/gists{/gist_id}","starred_url":"https://api.github.com/users/pprp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pprp/subscriptions","organizations_url":"https://api.github.com/users/pprp/orgs","repos_url":"https://api.github.com/users/pprp/repos","events_url":"https://api.github.com/users/pprp/events{/privacy}","received_events_url":"https://api.github.com/users/pprp/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-03-05T16:20:48Z","performed_via_github_app":null},{"id":2181473457,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIxODE0NzM0NTc=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2181473457","actor":{"login":"pprp","id":29230784,"node_id":"MDQ6VXNlcjI5MjMwNzg0","avatar_url":"https://avatars.githubusercontent.com/u/29230784?v=4","gravatar_id":"","url":"https://api.github.com/users/pprp","html_url":"https://github.com/pprp","followers_url":"https://api.github.com/users/pprp/followers","following_url":"https://api.github.com/users/pprp/following{/other_user}","gists_url":"https://api.github.com/users/pprp/gists{/gist_id}","starred_url":"https://api.github.com/users/pprp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pprp/subscriptions","organizations_url":"https://api.github.com/users/pprp/orgs","repos_url":"https://api.github.com/users/pprp/repos","events_url":"https://api.github.com/users/pprp/events{/privacy}","received_events_url":"https://api.github.com/users/pprp/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-03-05T16:20:48Z","performed_via_github_app":null},{"id":2181473465,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjE4MTQ3MzQ2NQ==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2181473465","actor":{"login":"iadfy","id":31213819,"node_id":"MDQ6VXNlcjMxMjEzODE5","avatar_url":"https://avatars.githubusercontent.com/u/31213819?v=4","gravatar_id":"","url":"https://api.github.com/users/iadfy","html_url":"https://github.com/iadfy","followers_url":"https://api.github.com/users/iadfy/followers","following_url":"https://api.github.com/users/iadfy/following{/other_user}","gists_url":"https://api.github.com/users/iadfy/gists{/gist_id}","starred_url":"https://api.github.com/users/iadfy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iadfy/subscriptions","organizations_url":"https://api.github.com/users/iadfy/orgs","repos_url":"https://api.github.com/users/iadfy/repos","events_url":"https://api.github.com/users/iadfy/events{/privacy}","received_events_url":"https://api.github.com/users/iadfy/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-03-05T16:20:48Z","performed_via_github_app":null},{"id":2181473468,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIxODE0NzM0Njg=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2181473468","actor":{"login":"iadfy","id":31213819,"node_id":"MDQ6VXNlcjMxMjEzODE5","avatar_url":"https://avatars.githubusercontent.com/u/31213819?v=4","gravatar_id":"","url":"https://api.github.com/users/iadfy","html_url":"https://github.com/iadfy","followers_url":"https://api.github.com/users/iadfy/followers","following_url":"https://api.github.com/users/iadfy/following{/other_user}","gists_url":"https://api.github.com/users/iadfy/gists{/gist_id}","starred_url":"https://api.github.com/users/iadfy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iadfy/subscriptions","organizations_url":"https://api.github.com/users/iadfy/orgs","repos_url":"https://api.github.com/users/iadfy/repos","events_url":"https://api.github.com/users/iadfy/events{/privacy}","received_events_url":"https://api.github.com/users/iadfy/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-03-05T16:20:48Z","performed_via_github_app":null}]