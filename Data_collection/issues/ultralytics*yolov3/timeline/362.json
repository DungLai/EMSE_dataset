[{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/508711515","html_url":"https://github.com/ultralytics/yolov3/issues/362#issuecomment-508711515","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/362","id":508711515,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODcxMTUxNQ==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2019-07-05T10:21:57Z","updated_at":"2019-07-05T10:21:57Z","author_association":"MEMBER","body":"@GoogleWiki hello, thank you for your idea! Can you submit a PR with your proposed changes as well as mAP results using the original version as well as your proposed changes? Thank you! \r\n\r\nThe code you can use to test the before and after mAP is here:\r\n```bash\r\n!python3 test.py\r\n```","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/508711515/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"id":2462346744,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjQ2MjM0Njc0NA==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2462346744","actor":{"login":"GoogleWiki","id":6838021,"node_id":"MDQ6VXNlcjY4MzgwMjE=","avatar_url":"https://avatars.githubusercontent.com/u/6838021?v=4","gravatar_id":"","url":"https://api.github.com/users/GoogleWiki","html_url":"https://github.com/GoogleWiki","followers_url":"https://api.github.com/users/GoogleWiki/followers","following_url":"https://api.github.com/users/GoogleWiki/following{/other_user}","gists_url":"https://api.github.com/users/GoogleWiki/gists{/gist_id}","starred_url":"https://api.github.com/users/GoogleWiki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GoogleWiki/subscriptions","organizations_url":"https://api.github.com/users/GoogleWiki/orgs","repos_url":"https://api.github.com/users/GoogleWiki/repos","events_url":"https://api.github.com/users/GoogleWiki/events{/privacy}","received_events_url":"https://api.github.com/users/GoogleWiki/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-07-05T10:21:57Z","performed_via_github_app":null},{"id":2462346745,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI0NjIzNDY3NDU=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2462346745","actor":{"login":"GoogleWiki","id":6838021,"node_id":"MDQ6VXNlcjY4MzgwMjE=","avatar_url":"https://avatars.githubusercontent.com/u/6838021?v=4","gravatar_id":"","url":"https://api.github.com/users/GoogleWiki","html_url":"https://github.com/GoogleWiki","followers_url":"https://api.github.com/users/GoogleWiki/followers","following_url":"https://api.github.com/users/GoogleWiki/following{/other_user}","gists_url":"https://api.github.com/users/GoogleWiki/gists{/gist_id}","starred_url":"https://api.github.com/users/GoogleWiki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GoogleWiki/subscriptions","organizations_url":"https://api.github.com/users/GoogleWiki/orgs","repos_url":"https://api.github.com/users/GoogleWiki/repos","events_url":"https://api.github.com/users/GoogleWiki/events{/privacy}","received_events_url":"https://api.github.com/users/GoogleWiki/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-07-05T10:21:57Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/509067921","html_url":"https://github.com/ultralytics/yolov3/issues/362#issuecomment-509067921","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/362","id":509067921,"node_id":"MDEyOklzc3VlQ29tbWVudDUwOTA2NzkyMQ==","user":{"login":"GoogleWiki","id":6838021,"node_id":"MDQ6VXNlcjY4MzgwMjE=","avatar_url":"https://avatars.githubusercontent.com/u/6838021?v=4","gravatar_id":"","url":"https://api.github.com/users/GoogleWiki","html_url":"https://github.com/GoogleWiki","followers_url":"https://api.github.com/users/GoogleWiki/followers","following_url":"https://api.github.com/users/GoogleWiki/following{/other_user}","gists_url":"https://api.github.com/users/GoogleWiki/gists{/gist_id}","starred_url":"https://api.github.com/users/GoogleWiki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GoogleWiki/subscriptions","organizations_url":"https://api.github.com/users/GoogleWiki/orgs","repos_url":"https://api.github.com/users/GoogleWiki/repos","events_url":"https://api.github.com/users/GoogleWiki/events{/privacy}","received_events_url":"https://api.github.com/users/GoogleWiki/received_events","type":"User","site_admin":false},"created_at":"2019-07-08T03:40:43Z","updated_at":"2019-07-08T03:40:43Z","author_association":"CONTRIBUTOR","body":"Sorry I can't get access to google drive. Thanks for your quick reply. Your help is very appreciated.","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/509067921/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GoogleWiki","id":6838021,"node_id":"MDQ6VXNlcjY4MzgwMjE=","avatar_url":"https://avatars.githubusercontent.com/u/6838021?v=4","gravatar_id":"","url":"https://api.github.com/users/GoogleWiki","html_url":"https://github.com/GoogleWiki","followers_url":"https://api.github.com/users/GoogleWiki/followers","following_url":"https://api.github.com/users/GoogleWiki/following{/other_user}","gists_url":"https://api.github.com/users/GoogleWiki/gists{/gist_id}","starred_url":"https://api.github.com/users/GoogleWiki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GoogleWiki/subscriptions","organizations_url":"https://api.github.com/users/GoogleWiki/orgs","repos_url":"https://api.github.com/users/GoogleWiki/repos","events_url":"https://api.github.com/users/GoogleWiki/events{/privacy}","received_events_url":"https://api.github.com/users/GoogleWiki/received_events","type":"User","site_admin":false}},{"id":2464825504,"node_id":"MDExOkNsb3NlZEV2ZW50MjQ2NDgyNTUwNA==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2464825504","actor":{"login":"GoogleWiki","id":6838021,"node_id":"MDQ6VXNlcjY4MzgwMjE=","avatar_url":"https://avatars.githubusercontent.com/u/6838021?v=4","gravatar_id":"","url":"https://api.github.com/users/GoogleWiki","html_url":"https://github.com/GoogleWiki","followers_url":"https://api.github.com/users/GoogleWiki/followers","following_url":"https://api.github.com/users/GoogleWiki/following{/other_user}","gists_url":"https://api.github.com/users/GoogleWiki/gists{/gist_id}","starred_url":"https://api.github.com/users/GoogleWiki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GoogleWiki/subscriptions","organizations_url":"https://api.github.com/users/GoogleWiki/orgs","repos_url":"https://api.github.com/users/GoogleWiki/repos","events_url":"https://api.github.com/users/GoogleWiki/events{/privacy}","received_events_url":"https://api.github.com/users/GoogleWiki/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-07-08T03:40:49Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/509218380","html_url":"https://github.com/ultralytics/yolov3/issues/362#issuecomment-509218380","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/362","id":509218380,"node_id":"MDEyOklzc3VlQ29tbWVudDUwOTIxODM4MA==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2019-07-08T13:09:42Z","updated_at":"2019-07-08T13:09:42Z","author_association":"MEMBER","body":"I added your recommended line at the end of the soft-nms block like this. I'll try to get new test results this way.\r\n\r\n```python\r\nelif nms_style == 'SOFT':  # soft-NMS https://arxiv.org/abs/1704.04503\r\n    sigma = 0.5  # soft-nms sigma parameter\r\n    while len(dc):\r\n        if len(dc) == 1:\r\n            det_max.append(dc)\r\n            break\r\n        det_max.append(dc[:1])\r\n        iou = bbox_iou(dc[0], dc[1:])  # iou with other boxes\r\n        dc = dc[1:]\r\n        dc[:, 4] *= torch.exp(-iou ** 2 / sigma)  # decay confidences\r\n        dc = dc[dc[:, 4] > nms_thres]  # new line per https://github.com/ultralytics/yolov3/issues/362\r\n```","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/509218380/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/509229157","html_url":"https://github.com/ultralytics/yolov3/issues/362#issuecomment-509229157","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/362","id":509229157,"node_id":"MDEyOklzc3VlQ29tbWVudDUwOTIyOTE1Nw==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2019-07-08T13:39:42Z","updated_at":"2019-07-08T13:39:42Z","author_association":"MEMBER","body":"@GoogleWiki It seems the recommended change was not successful. Here are my before and after results. The original code for `nms_style == 'SOFT'` did not produce better results either. There seems to be a problem in the soft nms implementation in general, though I can't spot it when comparing the current code to the paper unfortunately. Let me know if you get better results.\r\n\r\n```bash\r\n!python3 test.py --save-json  # before (nms_style == 'MERGE')\r\n Average Precision  (AP) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.336\r\n Average Precision  (AP) @[ IoU=0.50      | area=   all | maxDets=100 ] = 0.568\r\n Average Precision  (AP) @[ IoU=0.75      | area=   all | maxDets=100 ] = 0.349\r\n```\r\n\r\n```bash\r\n!python3 test.py --save-json  # after (nms_style == 'SOFT' with proposed changes)\r\n Average Precision  (AP) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.284\r\n Average Precision  (AP) @[ IoU=0.50      | area=   all | maxDets=100 ] = 0.453\r\n Average Precision  (AP) @[ IoU=0.75      | area=   all | maxDets=100 ] = 0.308\r\n```","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/509229157/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"id":2466182556,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjQ2NjE4MjU1Ng==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2466182556","actor":{"login":"GoogleWiki","id":6838021,"node_id":"MDQ6VXNlcjY4MzgwMjE=","avatar_url":"https://avatars.githubusercontent.com/u/6838021?v=4","gravatar_id":"","url":"https://api.github.com/users/GoogleWiki","html_url":"https://github.com/GoogleWiki","followers_url":"https://api.github.com/users/GoogleWiki/followers","following_url":"https://api.github.com/users/GoogleWiki/following{/other_user}","gists_url":"https://api.github.com/users/GoogleWiki/gists{/gist_id}","starred_url":"https://api.github.com/users/GoogleWiki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GoogleWiki/subscriptions","organizations_url":"https://api.github.com/users/GoogleWiki/orgs","repos_url":"https://api.github.com/users/GoogleWiki/repos","events_url":"https://api.github.com/users/GoogleWiki/events{/privacy}","received_events_url":"https://api.github.com/users/GoogleWiki/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-07-08T13:39:42Z","performed_via_github_app":null},{"id":2466182558,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI0NjYxODI1NTg=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2466182558","actor":{"login":"GoogleWiki","id":6838021,"node_id":"MDQ6VXNlcjY4MzgwMjE=","avatar_url":"https://avatars.githubusercontent.com/u/6838021?v=4","gravatar_id":"","url":"https://api.github.com/users/GoogleWiki","html_url":"https://github.com/GoogleWiki","followers_url":"https://api.github.com/users/GoogleWiki/followers","following_url":"https://api.github.com/users/GoogleWiki/following{/other_user}","gists_url":"https://api.github.com/users/GoogleWiki/gists{/gist_id}","starred_url":"https://api.github.com/users/GoogleWiki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GoogleWiki/subscriptions","organizations_url":"https://api.github.com/users/GoogleWiki/orgs","repos_url":"https://api.github.com/users/GoogleWiki/repos","events_url":"https://api.github.com/users/GoogleWiki/events{/privacy}","received_events_url":"https://api.github.com/users/GoogleWiki/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-07-08T13:39:42Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/560981691","html_url":"https://github.com/ultralytics/yolov3/issues/362#issuecomment-560981691","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/362","id":560981691,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MDk4MTY5MQ==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2019-12-03T03:26:03Z","updated_at":"2019-12-03T03:26:03Z","author_association":"MEMBER","body":"NMS updates posted to https://github.com/ultralytics/yolov3/issues/679","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/560981691/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}}]