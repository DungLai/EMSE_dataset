[{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/572312342","html_url":"https://github.com/ultralytics/yolov3/issues/764#issuecomment-572312342","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/764","id":572312342,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MjMxMjM0Mg==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2020-01-08T23:45:10Z","updated_at":"2020-01-08T23:48:41Z","author_association":"MEMBER","body":"@sebastian-sz yes, the ONNX output created by setting `ONNX_EXPORT=True` in models.py and running detect.py may be slightly different than the PyTorch output, as the ONNX output has a softmax operation builtin, though I'm actually not certain how this would affect single-class models.\r\n\r\nhttps://github.com/ultralytics/yolov3/blob/11ce877bdff2a355cc25a0c96fd5c23eb47a644b/models.py#L177-L189\r\n\r\nIf you remove the Softmax operator this may get you closer to the PyTorch output results. Can you try that and confirm? \r\n\r\nEdit: On second though, if you remove the Softmax there you must replace it with a Sigmoid:\r\n\r\n     p_cls = torch.sigmoid(p[:, 5:self.no]) * torch.sigmoid(p[:, 4:5])  # Softmax(,1) replaced by Sigmoid\r\n","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/572312342/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"id":2933114125,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjkzMzExNDEyNQ==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2933114125","actor":{"login":"sebastian-sz","id":58402418,"node_id":"MDQ6VXNlcjU4NDAyNDE4","avatar_url":"https://avatars.githubusercontent.com/u/58402418?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastian-sz","html_url":"https://github.com/sebastian-sz","followers_url":"https://api.github.com/users/sebastian-sz/followers","following_url":"https://api.github.com/users/sebastian-sz/following{/other_user}","gists_url":"https://api.github.com/users/sebastian-sz/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastian-sz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastian-sz/subscriptions","organizations_url":"https://api.github.com/users/sebastian-sz/orgs","repos_url":"https://api.github.com/users/sebastian-sz/repos","events_url":"https://api.github.com/users/sebastian-sz/events{/privacy}","received_events_url":"https://api.github.com/users/sebastian-sz/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-08T23:45:10Z","performed_via_github_app":null},{"id":2933114130,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5MzMxMTQxMzA=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2933114130","actor":{"login":"sebastian-sz","id":58402418,"node_id":"MDQ6VXNlcjU4NDAyNDE4","avatar_url":"https://avatars.githubusercontent.com/u/58402418?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastian-sz","html_url":"https://github.com/sebastian-sz","followers_url":"https://api.github.com/users/sebastian-sz/followers","following_url":"https://api.github.com/users/sebastian-sz/following{/other_user}","gists_url":"https://api.github.com/users/sebastian-sz/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastian-sz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastian-sz/subscriptions","organizations_url":"https://api.github.com/users/sebastian-sz/orgs","repos_url":"https://api.github.com/users/sebastian-sz/repos","events_url":"https://api.github.com/users/sebastian-sz/events{/privacy}","received_events_url":"https://api.github.com/users/sebastian-sz/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-08T23:45:10Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/572523180","html_url":"https://github.com/ultralytics/yolov3/issues/764#issuecomment-572523180","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/764","id":572523180,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MjUyMzE4MA==","user":{"login":"sebastian-sz","id":58402418,"node_id":"MDQ6VXNlcjU4NDAyNDE4","avatar_url":"https://avatars.githubusercontent.com/u/58402418?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastian-sz","html_url":"https://github.com/sebastian-sz","followers_url":"https://api.github.com/users/sebastian-sz/followers","following_url":"https://api.github.com/users/sebastian-sz/following{/other_user}","gists_url":"https://api.github.com/users/sebastian-sz/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastian-sz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastian-sz/subscriptions","organizations_url":"https://api.github.com/users/sebastian-sz/orgs","repos_url":"https://api.github.com/users/sebastian-sz/repos","events_url":"https://api.github.com/users/sebastian-sz/events{/privacy}","received_events_url":"https://api.github.com/users/sebastian-sz/received_events","type":"User","site_admin":false},"created_at":"2020-01-09T11:37:37Z","updated_at":"2020-01-09T11:37:37Z","author_association":"NONE","body":"Thank you for your quick response. I managed to resolve the issue. \r\n\r\nThe received scores are strongly correlated with the shape of the input image. If I set it to original (416, 416) (so the same as in training/inference) in case of onnx export the result is close to what I expect. The further I change the input image on the line\r\nhttps://github.com/ultralytics/yolov3/blob/11ce877bdff2a355cc25a0c96fd5c23eb47a644b/detect.py#L8-L10\r\n\r\nthe less reliable results. I guess it should have been more obvious to me :) \r\n\r\n> Edit: On second thought, if you remove the Softmax there you must replace it with a Sigmoid (...)\r\n\r\nNo matter what image size I export to onnx with, this operation lowers the score to 24% (instead of expected 84). So I didn't play around with this approach that much.\r\n\r\nAnyway, my problem is solved. Thank you for your time and help. I really appreciate it. The issue can be closed from my perspective. \r\n\r\n","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/572523180/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sebastian-sz","id":58402418,"node_id":"MDQ6VXNlcjU4NDAyNDE4","avatar_url":"https://avatars.githubusercontent.com/u/58402418?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastian-sz","html_url":"https://github.com/sebastian-sz","followers_url":"https://api.github.com/users/sebastian-sz/followers","following_url":"https://api.github.com/users/sebastian-sz/following{/other_user}","gists_url":"https://api.github.com/users/sebastian-sz/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastian-sz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastian-sz/subscriptions","organizations_url":"https://api.github.com/users/sebastian-sz/orgs","repos_url":"https://api.github.com/users/sebastian-sz/repos","events_url":"https://api.github.com/users/sebastian-sz/events{/privacy}","received_events_url":"https://api.github.com/users/sebastian-sz/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/572935360","html_url":"https://github.com/ultralytics/yolov3/issues/764#issuecomment-572935360","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/764","id":572935360,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MjkzNTM2MA==","user":{"login":"sebastian-sz","id":58402418,"node_id":"MDQ6VXNlcjU4NDAyNDE4","avatar_url":"https://avatars.githubusercontent.com/u/58402418?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastian-sz","html_url":"https://github.com/sebastian-sz","followers_url":"https://api.github.com/users/sebastian-sz/followers","following_url":"https://api.github.com/users/sebastian-sz/following{/other_user}","gists_url":"https://api.github.com/users/sebastian-sz/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastian-sz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastian-sz/subscriptions","organizations_url":"https://api.github.com/users/sebastian-sz/orgs","repos_url":"https://api.github.com/users/sebastian-sz/repos","events_url":"https://api.github.com/users/sebastian-sz/events{/privacy}","received_events_url":"https://api.github.com/users/sebastian-sz/received_events","type":"User","site_admin":false},"created_at":"2020-01-10T08:52:04Z","updated_at":"2020-01-10T08:52:04Z","author_association":"NONE","body":"There is however some mismatch between the current version of the repository and older versions (particularly one from around exactly month ago) regarding one class predictions.\r\n\r\nThe two versions of the repository will yield different results for a single class prediction.\r\n\r\nCurrent repository results:\r\n![zidane](https://user-images.githubusercontent.com/58402418/72138630-784dee80-338d-11ea-9c7a-d8a853c211ef.jpg)\r\n\r\nOlder repository results:\r\n![zidane](https://user-images.githubusercontent.com/58402418/72138657-87cd3780-338d-11ea-8e19-e6e1f5c825cd.jpg)\r\n\r\nThe code for the model looks the same, and the only difference I could spot was in the function for calculating `non_max_suppression`. And more importantly this part:\r\n\r\nhttps://github.com/ultralytics/yolov3/blob/11ce877bdff2a355cc25a0c96fd5c23eb47a644b/utils/utils.py#L525-L529\r\n\r\nIn the older versions, this used to be\r\n```\r\n        class_conf, class_pred = pred[:, 5:].max(1)                                                                                       \r\n        pred[:, 4] *= class_conf\r\n```\r\nWhich is more suitable for the one class prediction?","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/572935360/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sebastian-sz","id":58402418,"node_id":"MDQ6VXNlcjU4NDAyNDE4","avatar_url":"https://avatars.githubusercontent.com/u/58402418?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastian-sz","html_url":"https://github.com/sebastian-sz","followers_url":"https://api.github.com/users/sebastian-sz/followers","following_url":"https://api.github.com/users/sebastian-sz/following{/other_user}","gists_url":"https://api.github.com/users/sebastian-sz/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastian-sz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastian-sz/subscriptions","organizations_url":"https://api.github.com/users/sebastian-sz/orgs","repos_url":"https://api.github.com/users/sebastian-sz/repos","events_url":"https://api.github.com/users/sebastian-sz/events{/privacy}","received_events_url":"https://api.github.com/users/sebastian-sz/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/573146497","html_url":"https://github.com/ultralytics/yolov3/issues/764#issuecomment-573146497","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/764","id":573146497,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzE0NjQ5Nw==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2020-01-10T18:13:51Z","updated_at":"2020-01-10T18:13:51Z","author_association":"MEMBER","body":"@sebastian-sz let me see. Using the current repo I get this. Everything is operating correctly currently.\r\n\r\n`python3 detect.py`\r\n![zidane](https://user-images.githubusercontent.com/26833433/72175468-12fbfc80-3391-11ea-854a-470f53f9ed8a.jpg)\r\n\r\n`python3 detect.py --classes 0`\r\n![zidane](https://user-images.githubusercontent.com/26833433/72175780-d250b300-3391-11ea-831d-259136512ed2.jpg)\r\n\r\n","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/573146497/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"id":2939409625,"node_id":"MDExOkNsb3NlZEV2ZW50MjkzOTQwOTYyNQ==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2939409625","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-01-10T18:13:51Z","state_reason":null,"performed_via_github_app":null},{"id":2939409630,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjkzOTQwOTYzMA==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2939409630","actor":{"login":"sebastian-sz","id":58402418,"node_id":"MDQ6VXNlcjU4NDAyNDE4","avatar_url":"https://avatars.githubusercontent.com/u/58402418?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastian-sz","html_url":"https://github.com/sebastian-sz","followers_url":"https://api.github.com/users/sebastian-sz/followers","following_url":"https://api.github.com/users/sebastian-sz/following{/other_user}","gists_url":"https://api.github.com/users/sebastian-sz/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastian-sz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastian-sz/subscriptions","organizations_url":"https://api.github.com/users/sebastian-sz/orgs","repos_url":"https://api.github.com/users/sebastian-sz/repos","events_url":"https://api.github.com/users/sebastian-sz/events{/privacy}","received_events_url":"https://api.github.com/users/sebastian-sz/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-10T18:13:51Z","performed_via_github_app":null},{"id":2939409633,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5Mzk0MDk2MzM=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/2939409633","actor":{"login":"sebastian-sz","id":58402418,"node_id":"MDQ6VXNlcjU4NDAyNDE4","avatar_url":"https://avatars.githubusercontent.com/u/58402418?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastian-sz","html_url":"https://github.com/sebastian-sz","followers_url":"https://api.github.com/users/sebastian-sz/followers","following_url":"https://api.github.com/users/sebastian-sz/following{/other_user}","gists_url":"https://api.github.com/users/sebastian-sz/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastian-sz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastian-sz/subscriptions","organizations_url":"https://api.github.com/users/sebastian-sz/orgs","repos_url":"https://api.github.com/users/sebastian-sz/repos","events_url":"https://api.github.com/users/sebastian-sz/events{/privacy}","received_events_url":"https://api.github.com/users/sebastian-sz/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-10T18:13:51Z","performed_via_github_app":null}]