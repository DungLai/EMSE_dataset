[{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/420988162","html_url":"https://github.com/ultralytics/yolov3/issues/12#issuecomment-420988162","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/12","id":420988162,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMDk4ODE2Mg==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2018-09-13T12:25:19Z","updated_at":"2018-09-13T12:25:19Z","author_association":"MEMBER","body":"@okanlv 1 and 2 yes you are right there is a bug here. For some reason I was using `lambda_obj=1.5` and `lambda_noobj=1.0` rather than `lambda_obj=1.0` and `lambda_noobj=0.5`. I've corrected this in commit 68de92f1a118ddc2f5b117c6421bc4827c6c9f1f.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/420988162/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"id":1843482323,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTg0MzQ4MjMyMw==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1843482323","actor":{"login":"okanlv","id":29547397,"node_id":"MDQ6VXNlcjI5NTQ3Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/29547397?v=4","gravatar_id":"","url":"https://api.github.com/users/okanlv","html_url":"https://github.com/okanlv","followers_url":"https://api.github.com/users/okanlv/followers","following_url":"https://api.github.com/users/okanlv/following{/other_user}","gists_url":"https://api.github.com/users/okanlv/gists{/gist_id}","starred_url":"https://api.github.com/users/okanlv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/okanlv/subscriptions","organizations_url":"https://api.github.com/users/okanlv/orgs","repos_url":"https://api.github.com/users/okanlv/repos","events_url":"https://api.github.com/users/okanlv/events{/privacy}","received_events_url":"https://api.github.com/users/okanlv/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-09-13T12:25:19Z","performed_via_github_app":null},{"id":1843482324,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE4NDM0ODIzMjQ=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1843482324","actor":{"login":"okanlv","id":29547397,"node_id":"MDQ6VXNlcjI5NTQ3Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/29547397?v=4","gravatar_id":"","url":"https://api.github.com/users/okanlv","html_url":"https://github.com/okanlv","followers_url":"https://api.github.com/users/okanlv/followers","following_url":"https://api.github.com/users/okanlv/following{/other_user}","gists_url":"https://api.github.com/users/okanlv/gists{/gist_id}","starred_url":"https://api.github.com/users/okanlv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/okanlv/subscriptions","organizations_url":"https://api.github.com/users/okanlv/orgs","repos_url":"https://api.github.com/users/okanlv/repos","events_url":"https://api.github.com/users/okanlv/events{/privacy}","received_events_url":"https://api.github.com/users/okanlv/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-09-13T12:25:19Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/420995560","html_url":"https://github.com/ultralytics/yolov3/issues/12#issuecomment-420995560","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/12","id":420995560,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMDk5NTU2MA==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2018-09-13T12:52:32Z","updated_at":"2018-09-13T13:46:48Z","author_association":"MEMBER","body":"@okanlv 3 has to do with balancing the objectness loss term that is split into two (`obj` and `noobj`). `noobj` will always contain more samples than `obj`, so this imbalance would cause the training loss to always favor `noobj` (i.e. no objects would ever be detected) if we leave it alone.\r\n\r\nThe current version tries to balance them equally by averaging the loss term for `noobj` multiplied by target count `nM`. `obj` is not averaged, but since it consists of `nM` samples this should help the two terms attain equal weight. I'll try and follow your steps here.\r\n\r\nIf I start training, and debug models.py I see that `pred_conf` shape `[nB, nA, nG, nG]`, target count `nM`, and background count used in `noobj` loss term are:\r\n```python\r\npred_conf.shape\r\nOut[2]: torch.Size([12, 3, 13, 13])\r\n\r\nnM\r\nOut[3]: tensor(47.)\r\n\r\n(~mask).sum()\r\nOut[4]: tensor(6037)\r\n```\r\n\r\nIf I apply the same `BCEWithLogitsLoss1` term to both objectness lines 160 and 167 I see imbalanced losses for the two terms naturally, since the first has 47 samples and the second has 6037 samples. This will cause `loss_noobj` to dominate the gradient, and `loss_obj` will be practically ignored for training purposes, which is bad.\r\n```python\r\nloss_obj = BCEWithLogitsLoss1(pred_conf[mask], mask[mask].float())\r\nOut[14]: tensor(32.41945, grad_fn=<SumBackward0>)\r\n\r\nloss_noobj = 0.5 * BCEWithLogitsLoss1(pred_conf[~mask], mask[~mask].float())\r\nOut[16]: tensor(2089.89233, grad_fn=<MulBackward0>)\r\n```\r\n\r\nIf I use the current code though for line 167 then you can see that the loss terms are now roughly equal in magnitude, so they both influence the gradient to similar degrees:\r\n\r\n```python\r\nloss_noobj = 0.5 * nM * BCEWithLogitsLoss2(pred_conf[~mask], mask[~mask].float())\r\nOut[17]: tensor(16.27049, grad_fn=<MulBackward1>)\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/420995560/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"id":1843538656,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTg0MzUzODY1Ng==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1843538656","actor":{"login":"okanlv","id":29547397,"node_id":"MDQ6VXNlcjI5NTQ3Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/29547397?v=4","gravatar_id":"","url":"https://api.github.com/users/okanlv","html_url":"https://github.com/okanlv","followers_url":"https://api.github.com/users/okanlv/followers","following_url":"https://api.github.com/users/okanlv/following{/other_user}","gists_url":"https://api.github.com/users/okanlv/gists{/gist_id}","starred_url":"https://api.github.com/users/okanlv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/okanlv/subscriptions","organizations_url":"https://api.github.com/users/okanlv/orgs","repos_url":"https://api.github.com/users/okanlv/repos","events_url":"https://api.github.com/users/okanlv/events{/privacy}","received_events_url":"https://api.github.com/users/okanlv/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-09-13T12:52:32Z","performed_via_github_app":null},{"id":1843538657,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE4NDM1Mzg2NTc=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1843538657","actor":{"login":"okanlv","id":29547397,"node_id":"MDQ6VXNlcjI5NTQ3Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/29547397?v=4","gravatar_id":"","url":"https://api.github.com/users/okanlv","html_url":"https://github.com/okanlv","followers_url":"https://api.github.com/users/okanlv/followers","following_url":"https://api.github.com/users/okanlv/following{/other_user}","gists_url":"https://api.github.com/users/okanlv/gists{/gist_id}","starred_url":"https://api.github.com/users/okanlv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/okanlv/subscriptions","organizations_url":"https://api.github.com/users/okanlv/orgs","repos_url":"https://api.github.com/users/okanlv/repos","events_url":"https://api.github.com/users/okanlv/events{/privacy}","received_events_url":"https://api.github.com/users/okanlv/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-09-13T12:52:32Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/420997603","html_url":"https://github.com/ultralytics/yolov3/issues/12#issuecomment-420997603","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/12","id":420997603,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMDk5NzYwMw==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2018-09-13T12:59:41Z","updated_at":"2018-09-13T13:06:52Z","author_association":"MEMBER","body":"@okanlv question 4 is related to issue #3. For some reason `nn.CrossEntropyLoss()` seems to produce better results during training than `nn.BCEWithLogitsLoss()`. I don't know why this is the case, as YOLOv3 officially uses CE (though YOLOv2 did use BCE). **I've observed similar improvements when training MNIST in PyTorch using CE vs BCE, so it may be a PyTorch issue.**\r\n\r\nQuestion 5 is valid though. I don't have a good answer. Are there some examples you could point to that show the loss term divided by the batch size?","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/420997603/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"id":1843554434,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTg0MzU1NDQzNA==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1843554434","actor":{"login":"okanlv","id":29547397,"node_id":"MDQ6VXNlcjI5NTQ3Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/29547397?v=4","gravatar_id":"","url":"https://api.github.com/users/okanlv","html_url":"https://github.com/okanlv","followers_url":"https://api.github.com/users/okanlv/followers","following_url":"https://api.github.com/users/okanlv/following{/other_user}","gists_url":"https://api.github.com/users/okanlv/gists{/gist_id}","starred_url":"https://api.github.com/users/okanlv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/okanlv/subscriptions","organizations_url":"https://api.github.com/users/okanlv/orgs","repos_url":"https://api.github.com/users/okanlv/repos","events_url":"https://api.github.com/users/okanlv/events{/privacy}","received_events_url":"https://api.github.com/users/okanlv/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-09-13T12:59:41Z","performed_via_github_app":null},{"id":1843554435,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE4NDM1NTQ0MzU=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1843554435","actor":{"login":"okanlv","id":29547397,"node_id":"MDQ6VXNlcjI5NTQ3Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/29547397?v=4","gravatar_id":"","url":"https://api.github.com/users/okanlv","html_url":"https://github.com/okanlv","followers_url":"https://api.github.com/users/okanlv/followers","following_url":"https://api.github.com/users/okanlv/following{/other_user}","gists_url":"https://api.github.com/users/okanlv/gists{/gist_id}","starred_url":"https://api.github.com/users/okanlv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/okanlv/subscriptions","organizations_url":"https://api.github.com/users/okanlv/orgs","repos_url":"https://api.github.com/users/okanlv/repos","events_url":"https://api.github.com/users/okanlv/events{/privacy}","received_events_url":"https://api.github.com/users/okanlv/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-09-13T12:59:41Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/421350870","html_url":"https://github.com/ultralytics/yolov3/issues/12#issuecomment-421350870","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/12","id":421350870,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTM1MDg3MA==","user":{"login":"okanlv","id":29547397,"node_id":"MDQ6VXNlcjI5NTQ3Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/29547397?v=4","gravatar_id":"","url":"https://api.github.com/users/okanlv","html_url":"https://github.com/okanlv","followers_url":"https://api.github.com/users/okanlv/followers","following_url":"https://api.github.com/users/okanlv/following{/other_user}","gists_url":"https://api.github.com/users/okanlv/gists{/gist_id}","starred_url":"https://api.github.com/users/okanlv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/okanlv/subscriptions","organizations_url":"https://api.github.com/users/okanlv/orgs","repos_url":"https://api.github.com/users/okanlv/repos","events_url":"https://api.github.com/users/okanlv/events{/privacy}","received_events_url":"https://api.github.com/users/okanlv/received_events","type":"User","site_admin":false},"created_at":"2018-09-14T13:00:35Z","updated_at":"2018-09-14T13:00:35Z","author_association":"NONE","body":"@glenn-jocher thanks, Q3 & Q4 makes sense now. \r\nQ5 -> I have not have a good reference in original YOLO code, but this [function](https://github.com/pjreddie/darknet/blob/680d3bde1924c8ee2d1c1dea54d3e56a05ca9a26/src/yolo_layer.c#L132) returns the loss term. In addition, we should probably divide the loss term by the number of detected objects `(nM)` too since it is undesirable to scale the loss by the number of detected objects. \r\n\r\n**-->** `loss_noobj = 0.5 * nM * BCEWithLogitsLoss2(pred_conf[~mask], mask[~mask].float())` gives 0 loss when `nM = 0`.  We could use `loss_noobj = 0.5 * BCEWithLogitsLoss2(pred_conf[~mask], mask[~mask].float())` instead when `nM = 0`.","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/421350870/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"okanlv","id":29547397,"node_id":"MDQ6VXNlcjI5NTQ3Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/29547397?v=4","gravatar_id":"","url":"https://api.github.com/users/okanlv","html_url":"https://github.com/okanlv","followers_url":"https://api.github.com/users/okanlv/followers","following_url":"https://api.github.com/users/okanlv/following{/other_user}","gists_url":"https://api.github.com/users/okanlv/gists{/gist_id}","starred_url":"https://api.github.com/users/okanlv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/okanlv/subscriptions","organizations_url":"https://api.github.com/users/okanlv/orgs","repos_url":"https://api.github.com/users/okanlv/repos","events_url":"https://api.github.com/users/okanlv/events{/privacy}","received_events_url":"https://api.github.com/users/okanlv/received_events","type":"User","site_admin":false}},{"id":1846051644,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTg0NjA1MTY0NA==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1846051644","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-09-14T13:00:35Z","performed_via_github_app":null},{"id":1846051646,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE4NDYwNTE2NDY=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1846051646","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-09-14T13:00:35Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/422911231","html_url":"https://github.com/ultralytics/yolov3/issues/12#issuecomment-422911231","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/12","id":422911231,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjkxMTIzMQ==","user":{"login":"okanlv","id":29547397,"node_id":"MDQ6VXNlcjI5NTQ3Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/29547397?v=4","gravatar_id":"","url":"https://api.github.com/users/okanlv","html_url":"https://github.com/okanlv","followers_url":"https://api.github.com/users/okanlv/followers","following_url":"https://api.github.com/users/okanlv/following{/other_user}","gists_url":"https://api.github.com/users/okanlv/gists{/gist_id}","starred_url":"https://api.github.com/users/okanlv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/okanlv/subscriptions","organizations_url":"https://api.github.com/users/okanlv/orgs","repos_url":"https://api.github.com/users/okanlv/repos","events_url":"https://api.github.com/users/okanlv/events{/privacy}","received_events_url":"https://api.github.com/users/okanlv/received_events","type":"User","site_admin":false},"created_at":"2018-09-19T18:32:56Z","updated_at":"2018-09-19T18:32:56Z","author_association":"NONE","body":"@glenn-jocher I think the cost is divided by the batch size at [this line](https://github.com/pjreddie/darknet/blob/61c9d02ec461e30d55762ec7669d6a1d3c356fb2/src/network.c#L327)","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/422911231/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"okanlv","id":29547397,"node_id":"MDQ6VXNlcjI5NTQ3Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/29547397?v=4","gravatar_id":"","url":"https://api.github.com/users/okanlv","html_url":"https://github.com/okanlv","followers_url":"https://api.github.com/users/okanlv/followers","following_url":"https://api.github.com/users/okanlv/following{/other_user}","gists_url":"https://api.github.com/users/okanlv/gists{/gist_id}","starred_url":"https://api.github.com/users/okanlv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/okanlv/subscriptions","organizations_url":"https://api.github.com/users/okanlv/orgs","repos_url":"https://api.github.com/users/okanlv/repos","events_url":"https://api.github.com/users/okanlv/events{/privacy}","received_events_url":"https://api.github.com/users/okanlv/received_events","type":"User","site_admin":false}},{"id":1855818639,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTg1NTgxODYzOQ==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1855818639","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-09-19T18:32:56Z","performed_via_github_app":null},{"id":1855818640,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE4NTU4MTg2NDA=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1855818640","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-09-19T18:32:56Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/422980711","html_url":"https://github.com/ultralytics/yolov3/issues/12#issuecomment-422980711","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/12","id":422980711,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjk4MDcxMQ==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2018-09-19T22:33:33Z","updated_at":"2018-09-19T22:34:57Z","author_association":"MEMBER","body":"@okanlv I was just thinking about this. Currently the loss increases with the number of detected objects `nM`, and the `batch_size`. I think increasing with `nM` is ok, because it makes sense that an image with 10 objects would influence the gradient more than an image with 1 object, no?\r\n\r\nBut the `batch_size` itself I'm not sure. If we divide by the `batch_size`, larger batches will take longer to train the model. i.e. `batch_size=16` will train twice as slow with same size loss as `batch_size=8`. Currently loss increases with `batch_size`, so training speed would be similar I think irrespective of `batch_size`.\r\n\r\nBut I see your link. `n` looks like the batch size there, and the code divides loss by `n`. Do you think I should leave `nM` in place and divide by the batch size then?","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/422980711/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"id":1856296962,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTg1NjI5Njk2Mg==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1856296962","actor":{"login":"okanlv","id":29547397,"node_id":"MDQ6VXNlcjI5NTQ3Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/29547397?v=4","gravatar_id":"","url":"https://api.github.com/users/okanlv","html_url":"https://github.com/okanlv","followers_url":"https://api.github.com/users/okanlv/followers","following_url":"https://api.github.com/users/okanlv/following{/other_user}","gists_url":"https://api.github.com/users/okanlv/gists{/gist_id}","starred_url":"https://api.github.com/users/okanlv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/okanlv/subscriptions","organizations_url":"https://api.github.com/users/okanlv/orgs","repos_url":"https://api.github.com/users/okanlv/repos","events_url":"https://api.github.com/users/okanlv/events{/privacy}","received_events_url":"https://api.github.com/users/okanlv/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-09-19T22:33:33Z","performed_via_github_app":null},{"id":1856296963,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE4NTYyOTY5NjM=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1856296963","actor":{"login":"okanlv","id":29547397,"node_id":"MDQ6VXNlcjI5NTQ3Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/29547397?v=4","gravatar_id":"","url":"https://api.github.com/users/okanlv","html_url":"https://github.com/okanlv","followers_url":"https://api.github.com/users/okanlv/followers","following_url":"https://api.github.com/users/okanlv/following{/other_user}","gists_url":"https://api.github.com/users/okanlv/gists{/gist_id}","starred_url":"https://api.github.com/users/okanlv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/okanlv/subscriptions","organizations_url":"https://api.github.com/users/okanlv/orgs","repos_url":"https://api.github.com/users/okanlv/repos","events_url":"https://api.github.com/users/okanlv/events{/privacy}","received_events_url":"https://api.github.com/users/okanlv/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-09-19T22:33:33Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/422981782","html_url":"https://github.com/ultralytics/yolov3/issues/12#issuecomment-422981782","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/12","id":422981782,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjk4MTc4Mg==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2018-09-19T22:38:40Z","updated_at":"2018-09-19T22:38:40Z","author_association":"MEMBER","body":"Oh, by the way, `nM` would probably never be zero, because the loop in `train.py` currently skips batches that don't have any targets (though `nM` does get set 3 times per batch, once for each YOLO stride):\r\n\r\nhttps://github.com/ultralytics/yolov3/blob/1cfde4aba83ba549ca5290ea1cb42a7f7bea40ed/train.py#L116-L119","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/422981782/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/423148398","html_url":"https://github.com/ultralytics/yolov3/issues/12#issuecomment-423148398","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/12","id":423148398,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzE0ODM5OA==","user":{"login":"okanlv","id":29547397,"node_id":"MDQ6VXNlcjI5NTQ3Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/29547397?v=4","gravatar_id":"","url":"https://api.github.com/users/okanlv","html_url":"https://github.com/okanlv","followers_url":"https://api.github.com/users/okanlv/followers","following_url":"https://api.github.com/users/okanlv/following{/other_user}","gists_url":"https://api.github.com/users/okanlv/gists{/gist_id}","starred_url":"https://api.github.com/users/okanlv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/okanlv/subscriptions","organizations_url":"https://api.github.com/users/okanlv/orgs","repos_url":"https://api.github.com/users/okanlv/repos","events_url":"https://api.github.com/users/okanlv/events{/privacy}","received_events_url":"https://api.github.com/users/okanlv/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T11:25:55Z","updated_at":"2018-09-20T11:25:55Z","author_association":"NONE","body":">  I was just thinking about this. Currently the loss increases with the number of detected objects `nM`, and the `batch_size`. I think increasing with `nM` is ok, because it makes sense that an image with 10 objects would influence the gradient more than an image with 1 object, no?\r\n\r\n@glenn-jocher I am not sure about this. You might be right.\r\n\r\n> But the `batch_size` itself I'm not sure. If we divide by the `batch_size`, larger batches will take longer to train the model. i.e. `batch_size=16` will train twice as slow with same size loss as `batch_size=8`. Currently loss increases with batch_size, so training speed would be similar I think irrespective of `batch_size`.\r\n\r\nTraining speed should not depend on the batch size imo too. You can adjust learning rate to speed up the training.  Why do you think dividing by  the `batch_size` affects the training speed? If we divide by `batch_size`, the loss will stay the same (on average) regardless of the `batch_size`. If you are talking about the speed change because of `total_samples/batch_size`, it is normal. For instance, in the current loss calculation if the batch size is too large, then the loss might not converge.\r\n\r\n> But I see your link. `n` looks like the batch size there, and the code divides loss by `n`. Do you think I should leave `nM` in place and divide by the batch size then?\r\n\r\nActually `n = subdivisions * ngpus = ` and `batch = batch_size`. So, you should divide the loss only by the batch size as you suggested.\r\n","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/423148398/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"okanlv","id":29547397,"node_id":"MDQ6VXNlcjI5NTQ3Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/29547397?v=4","gravatar_id":"","url":"https://api.github.com/users/okanlv","html_url":"https://github.com/okanlv","followers_url":"https://api.github.com/users/okanlv/followers","following_url":"https://api.github.com/users/okanlv/following{/other_user}","gists_url":"https://api.github.com/users/okanlv/gists{/gist_id}","starred_url":"https://api.github.com/users/okanlv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/okanlv/subscriptions","organizations_url":"https://api.github.com/users/okanlv/orgs","repos_url":"https://api.github.com/users/okanlv/repos","events_url":"https://api.github.com/users/okanlv/events{/privacy}","received_events_url":"https://api.github.com/users/okanlv/received_events","type":"User","site_admin":false}},{"id":1857426475,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTg1NzQyNjQ3NQ==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1857426475","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-09-20T11:25:55Z","performed_via_github_app":null},{"id":1857426477,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE4NTc0MjY0Nzc=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1857426477","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-09-20T11:25:55Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/423240988","html_url":"https://github.com/ultralytics/yolov3/issues/12#issuecomment-423240988","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/12","id":423240988,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzI0MDk4OA==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T16:07:52Z","updated_at":"2018-09-20T16:07:52Z","author_association":"MEMBER","body":"Ok, I've switched from Adam to SGD with burn-in (which exponentially ramps up the learning rate from 0 to 0.001 over the first 1000 iterations) in commit a722601ef61149cc9e5135f58c762310627c970a. I included the loss division by the batch size as well:\r\n\r\nhttps://github.com/ultralytics/yolov3/blob/a722601ef61149cc9e5135f58c762310627c970a/models.py#L178","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/423240988/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/423438196","html_url":"https://github.com/ultralytics/yolov3/issues/12#issuecomment-423438196","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/12","id":423438196,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzQzODE5Ng==","user":{"login":"ydixon","id":22487836,"node_id":"MDQ6VXNlcjIyNDg3ODM2","avatar_url":"https://avatars.githubusercontent.com/u/22487836?v=4","gravatar_id":"","url":"https://api.github.com/users/ydixon","html_url":"https://github.com/ydixon","followers_url":"https://api.github.com/users/ydixon/followers","following_url":"https://api.github.com/users/ydixon/following{/other_user}","gists_url":"https://api.github.com/users/ydixon/gists{/gist_id}","starred_url":"https://api.github.com/users/ydixon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ydixon/subscriptions","organizations_url":"https://api.github.com/users/ydixon/orgs","repos_url":"https://api.github.com/users/ydixon/repos","events_url":"https://api.github.com/users/ydixon/events{/privacy}","received_events_url":"https://api.github.com/users/ydixon/received_events","type":"User","site_admin":false},"created_at":"2018-09-21T07:17:03Z","updated_at":"2018-09-21T07:38:18Z","author_association":"NONE","body":"@glenn-jocher Thanks for this excellent repo. I've been scratching my head trying to figure out how to balance the loss weight properly. Thanks for the explanation. I still have a few questions:\r\n\r\n1. Why are we doing mseloss on sigmoid(tx) instead of tx?\r\n2. How did you come up with power method for w,h? Is it just by experimentation?\r\n3. How are the loss weight values (5, 0.5) obtained? Trial and error?\r\n4. Any idea why doing bceloss(size_average=True) on confidence and cls loss wouldn't work? (I tried and it didn't converge)\r\n","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/423438196/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ydixon","id":22487836,"node_id":"MDQ6VXNlcjIyNDg3ODM2","avatar_url":"https://avatars.githubusercontent.com/u/22487836?v=4","gravatar_id":"","url":"https://api.github.com/users/ydixon","html_url":"https://github.com/ydixon","followers_url":"https://api.github.com/users/ydixon/followers","following_url":"https://api.github.com/users/ydixon/following{/other_user}","gists_url":"https://api.github.com/users/ydixon/gists{/gist_id}","starred_url":"https://api.github.com/users/ydixon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ydixon/subscriptions","organizations_url":"https://api.github.com/users/ydixon/orgs","repos_url":"https://api.github.com/users/ydixon/repos","events_url":"https://api.github.com/users/ydixon/events{/privacy}","received_events_url":"https://api.github.com/users/ydixon/received_events","type":"User","site_admin":false}},{"id":1859451166,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTg1OTQ1MTE2Ng==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1859451166","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-09-21T07:17:03Z","performed_via_github_app":null},{"id":1859451167,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE4NTk0NTExNjc=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1859451167","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-09-21T07:17:03Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/423531011","html_url":"https://github.com/ultralytics/yolov3/issues/12#issuecomment-423531011","issue_url":"https://api.github.com/repos/ultralytics/yolov3/issues/12","id":423531011,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzUzMTAxMQ==","user":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"created_at":"2018-09-21T13:28:45Z","updated_at":"2018-09-21T13:36:16Z","author_association":"MEMBER","body":"@ydixon don't thank me yet. The model works near-perfectly for inference, **but there seem to remain issues with training.** To answer your questions, the model attempts to replicate yolov3 with darknet, so most all design choices come from there. Definitely read the paper:\r\nhttps://pjreddie.com/media/files/papers/YOLOv3.pdf\r\n\r\n1. **Why are we doing mseloss on sigmoid(tx) instead of tx?** \r\nThe box `x` and `y` values are defined in the paper in anchor space (i.e. 0-13 across the image width) as sigmoid(tx) + anchor location (0-13). This way an anchor at location 5 for example can vary from 5-6, but not outside this range. Current losses are computed from these box locations in anchor space... **are you saying we could try to compute the losses prior to sigmoiding (we would need to logit the target values then)?**\r\n\r\n2. **How did you come up with power method for w,h? Is it just by experimentation?** \r\nSort of by experimenting, but I was constrained that I needed `output=1` from `input=0` (i.e. `f(0)=1`) to match existing output there. Both the exp and power methods of width and height do this well, but the power method keeps the output from exploding at the high end. I only placed the power method there because SGD with burn-in would not converge using the normal method, hinting at a problem somewhere in the training code. The power method approaches 4 at the positive limit.\r\n<img src=\"https://user-images.githubusercontent.com/26833433/45832408-197ce580-bd02-11e8-99e3-fc929d5e059d.png\" width=\"400\">\r\n\r\n3. **How are the loss weight values (5, 0.5) obtained? Trial and error?**\r\nNo. These are specified in the YOLO paper. `lambda_noobj = 0.5` and `lambda_coord = 5`.\r\n\r\n4. **Any idea why doing bceloss(size_average=True) on confidence and cls loss wouldn't work? (I tried and it didn't converge).**\r\nThe `obj` and `noobj` halves of the `conf` loss term need to be balanced, since `noobj` will always have many more samples than `obj` (most anchors will be empty). The current method does this by size-averaging `noobj` and multiplying it by `nM`, the number of samples in `obj`. This comment has a more detailed explanation: https://github.com/ultralytics/yolov3/issues/12#issuecomment-420995560. The alternative is to size-average both conf terms and them divide `noobj` by `nM`.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/comments/423531011/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false}},{"id":1860182515,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTg2MDE4MjUxNQ==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1860182515","actor":{"login":"ydixon","id":22487836,"node_id":"MDQ6VXNlcjIyNDg3ODM2","avatar_url":"https://avatars.githubusercontent.com/u/22487836?v=4","gravatar_id":"","url":"https://api.github.com/users/ydixon","html_url":"https://github.com/ydixon","followers_url":"https://api.github.com/users/ydixon/followers","following_url":"https://api.github.com/users/ydixon/following{/other_user}","gists_url":"https://api.github.com/users/ydixon/gists{/gist_id}","starred_url":"https://api.github.com/users/ydixon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ydixon/subscriptions","organizations_url":"https://api.github.com/users/ydixon/orgs","repos_url":"https://api.github.com/users/ydixon/repos","events_url":"https://api.github.com/users/ydixon/events{/privacy}","received_events_url":"https://api.github.com/users/ydixon/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-09-21T13:28:45Z","performed_via_github_app":null},{"id":1860182519,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE4NjAxODI1MTk=","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1860182519","actor":{"login":"ydixon","id":22487836,"node_id":"MDQ6VXNlcjIyNDg3ODM2","avatar_url":"https://avatars.githubusercontent.com/u/22487836?v=4","gravatar_id":"","url":"https://api.github.com/users/ydixon","html_url":"https://github.com/ydixon","followers_url":"https://api.github.com/users/ydixon/followers","following_url":"https://api.github.com/users/ydixon/following{/other_user}","gists_url":"https://api.github.com/users/ydixon/gists{/gist_id}","starred_url":"https://api.github.com/users/ydixon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ydixon/subscriptions","organizations_url":"https://api.github.com/users/ydixon/orgs","repos_url":"https://api.github.com/users/ydixon/repos","events_url":"https://api.github.com/users/ydixon/events{/privacy}","received_events_url":"https://api.github.com/users/ydixon/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-09-21T13:28:45Z","performed_via_github_app":null},{"id":1861739372,"node_id":"MDExOkNsb3NlZEV2ZW50MTg2MTczOTM3Mg==","url":"https://api.github.com/repos/ultralytics/yolov3/issues/events/1861739372","actor":{"login":"okanlv","id":29547397,"node_id":"MDQ6VXNlcjI5NTQ3Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/29547397?v=4","gravatar_id":"","url":"https://api.github.com/users/okanlv","html_url":"https://github.com/okanlv","followers_url":"https://api.github.com/users/okanlv/followers","following_url":"https://api.github.com/users/okanlv/following{/other_user}","gists_url":"https://api.github.com/users/okanlv/gists{/gist_id}","starred_url":"https://api.github.com/users/okanlv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/okanlv/subscriptions","organizations_url":"https://api.github.com/users/okanlv/orgs","repos_url":"https://api.github.com/users/okanlv/repos","events_url":"https://api.github.com/users/okanlv/events{/privacy}","received_events_url":"https://api.github.com/users/okanlv/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2018-09-22T20:17:32Z","state_reason":null,"performed_via_github_app":null}]