{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/1887","repository_url":"https://api.github.com/repos/ultralytics/yolov3","labels_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1887/labels{/name}","comments_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1887/comments","events_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1887/events","html_url":"https://github.com/ultralytics/yolov3/issues/1887","id":1105478145,"node_id":"I_kwDOCLZQgM5B5EIB","number":1887,"title":"TFLite export issue from yolov3.pt weights (works for yolov3-spp.pt)","user":{"login":"corehalt","id":46298335,"node_id":"MDQ6VXNlcjQ2Mjk4MzM1","avatar_url":"https://avatars.githubusercontent.com/u/46298335?v=4","gravatar_id":"","url":"https://api.github.com/users/corehalt","html_url":"https://github.com/corehalt","followers_url":"https://api.github.com/users/corehalt/followers","following_url":"https://api.github.com/users/corehalt/following{/other_user}","gists_url":"https://api.github.com/users/corehalt/gists{/gist_id}","starred_url":"https://api.github.com/users/corehalt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/corehalt/subscriptions","organizations_url":"https://api.github.com/users/corehalt/orgs","repos_url":"https://api.github.com/users/corehalt/repos","events_url":"https://api.github.com/users/corehalt/events{/privacy}","received_events_url":"https://api.github.com/users/corehalt/received_events","type":"User","site_admin":false},"labels":[{"id":1035696370,"node_id":"MDU6TGFiZWwxMDM1Njk2Mzcw","url":"https://api.github.com/repos/ultralytics/yolov3/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":26,"created_at":"2022-01-17T07:31:24Z","updated_at":"2022-08-17T07:17:07Z","closed_at":"2022-02-16T09:14:23Z","author_association":"NONE","active_lock_reason":null,"body":"### Search before asking\n\n- [X] I have searched the YOLOv3 [issues](https://github.com/ultralytics/yolov3/issues) and found no similar bug report.\n\n\n### YOLOv3 Component\n\nExport\n\n### Bug\n\n```\r\npython export.py --weights yolov3.pt --include saved_model pb tflite --int8 --img 416\r\nexport: data=data/coco128.yaml, weights=yolov3.pt, imgsz=[416], batch_size=1, device=cpu, half=False, inplace=False, train=False, optimize=False, int8=True, dynamic=False, simplify=False, opset=13, topk_per_class=100, topk_all=100, iou_thres=0.45, conf_thres=0.25, include=['saved_model', 'pb', 'tflite']\r\nYOLOv3 ðŸš€ v9.6.0-6-g0f80f2f torch 1.10.1+cu102 CPU\r\n\r\nFusing layers... \r\nModel Summary: 261 layers, 61922845 parameters, 0 gradients, 156.1 GFLOPs\r\n\r\nPyTorch: starting from yolov3.pt (124.3 MB)\r\n2022-01-17 16:05:01.871223: W tensorflow/stream_executor/platform/default/dso_loader.cc:60] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /home/corehalt/src/yolov3_test/venv/lib/python3.8/site-packages/cv2/../../lib64:\r\n2022-01-17 16:05:01.871262: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\r\n\r\nTensorFlow saved_model: starting export with tensorflow 2.4.1...\r\n\r\n                 from  n    params  module                                  arguments                     \r\n  0                -1  1       928  models.common.Conv                      [3, 32, 3, 1]                 \r\n2022-01-17 16:05:03.584306: I tensorflow/compiler/jit/xla_cpu_device.cc:41] Not creating XLA devices, tf_xla_enable_xla_devices not set\r\n2022-01-17 16:05:03.584784: W tensorflow/stream_executor/platform/default/dso_loader.cc:60] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /home/corehalt/src/yolov3_test/venv/lib/python3.8/site-packages/cv2/../../lib64:\r\n2022-01-17 16:05:03.584829: W tensorflow/stream_executor/cuda/cuda_driver.cc:326] failed call to cuInit: UNKNOWN ERROR (303)\r\n2022-01-17 16:05:03.584867: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (pop-os): /proc/driver/nvidia/version does not exist\r\n2022-01-17 16:05:03.585266: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA\r\nTo enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\r\n2022-01-17 16:05:03.585612: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set\r\n  1                -1  1     18560  models.common.Conv                      [32, 64, 3, 2]                \r\n  2                -1  1     20672  models.common.Bottleneck                [64, 64]                      \r\n  3                -1  1     73984  models.common.Conv                      [64, 128, 3, 2]               \r\n  4                -1  2    164608  models.common.Bottleneck                [128, 128]                    \r\n  5                -1  1    295424  models.common.Conv                      [128, 256, 3, 2]              \r\n  6                -1  8   2627584  models.common.Bottleneck                [256, 256]                    \r\n  7                -1  1   1180672  models.common.Conv                      [256, 512, 3, 2]              \r\n  8                -1  8  10498048  models.common.Bottleneck                [512, 512]                    \r\n  9                -1  1   4720640  models.common.Conv                      [512, 1024, 3, 2]             \r\n 10                -1  4  20983808  models.common.Bottleneck                [1024, 1024]                  \r\n 11                -1  1   5245952  models.common.Bottleneck                [1024, 1024, False]           \r\n\r\nTensorFlow saved_model: export failure: Convolution with multiple kernels are not allowed.\r\n\r\nTensorFlow GraphDef: starting export with tensorflow 2.4.1...\r\n\r\nTensorFlow GraphDef: export failure: 'NoneType' object has no attribute 'inputs'\r\n\r\nTensorFlow Lite: starting export with tensorflow 2.4.1...\r\n\r\nTensorFlow Lite: export failure: 'NoneType' object has no attribute 'call'\r\n\r\nExport complete (5.98s)\r\nResults saved to /home/corehalt/src/yolov3_test/yolov3\r\nVisualize with https://netron.app\r\n```\n\n### Environment\n\n- YOLO: YOLOv3 ðŸš€ v9.6.0-6-g0f80f2f torch 1.10.1+cu102 CPU\r\n- OS: Ubuntu 20.04 (Pop OS)\r\n- Python: Python 3.8.1\n\n### Minimal Reproducible Example\n\n```\r\npython export.py --weights yolov3.pt --include saved_model pb tflite --int8 --img 416\r\n```\n\n### Additional\n\nI'm trying to export the `yolov3` model to TFLite.\r\nI installed the requirements in a clean virtualenv with Python 3.8.10 (uncommenting the tflite export section in the file) and run the export command:\r\n\r\n```bash\r\n# works with `yolov3-spp.pt` (automatically downloaded previously by detect.py)\r\npython export.py --weights yolov3-spp.pt --include saved_model pb tflite --int8 --img 416\r\n```\r\n\r\nbut, on the other hand, it fails to export the standard `yolov3.pt` model. It fails with the specified error:\r\n```bash\r\n# Fails with `yolov3.pt` (automatically downloaded previously by detect.py)\r\npython export.py --weights yolov3.pt --include saved_model pb tflite --int8 --img 416\r\n```\r\n\r\nI also tried to to use different versions of TensorFlow (2.7.0, 2.6.1, 2.4.1) but doesn't work as well.\r\n\r\nThank you.\n\n### Are you willing to submit a PR?\n\n- [ ] Yes I'd like to help by submitting a PR!","closed_by":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/1887/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1887/timeline","performed_via_github_app":null,"state_reason":"completed"}