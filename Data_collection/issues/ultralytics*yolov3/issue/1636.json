{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/1636","repository_url":"https://api.github.com/repos/ultralytics/yolov3","labels_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1636/labels{/name}","comments_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1636/comments","events_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1636/events","html_url":"https://github.com/ultralytics/yolov3/issues/1636","id":777645557,"node_id":"MDU6SXNzdWU3Nzc2NDU1NTc=","number":1636,"title":"How do I convert the PT model to the libtorch readable PT model","user":{"login":"WANGCHAO1996","id":51087601,"node_id":"MDQ6VXNlcjUxMDg3NjAx","avatar_url":"https://avatars.githubusercontent.com/u/51087601?v=4","gravatar_id":"","url":"https://api.github.com/users/WANGCHAO1996","html_url":"https://github.com/WANGCHAO1996","followers_url":"https://api.github.com/users/WANGCHAO1996/followers","following_url":"https://api.github.com/users/WANGCHAO1996/following{/other_user}","gists_url":"https://api.github.com/users/WANGCHAO1996/gists{/gist_id}","starred_url":"https://api.github.com/users/WANGCHAO1996/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WANGCHAO1996/subscriptions","organizations_url":"https://api.github.com/users/WANGCHAO1996/orgs","repos_url":"https://api.github.com/users/WANGCHAO1996/repos","events_url":"https://api.github.com/users/WANGCHAO1996/events{/privacy}","received_events_url":"https://api.github.com/users/WANGCHAO1996/received_events","type":"User","site_admin":false},"labels":[{"id":1035696376,"node_id":"MDU6TGFiZWwxMDM1Njk2Mzc2","url":"https://api.github.com/repos/ultralytics/yolov3/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"},{"id":1890885613,"node_id":"MDU6TGFiZWwxODkwODg1NjEz","url":"https://api.github.com/repos/ultralytics/yolov3/labels/Stale","name":"Stale","color":"ededed","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-01-03T14:10:29Z","updated_at":"2021-02-09T00:29:38Z","closed_at":"2021-02-09T00:29:38Z","author_association":"NONE","active_lock_reason":null,"body":"## ❔Question\r\n\r\nthanks for your work ,How do I convert the PT model to the libtorch readable PT model?@glenn-jocher\r\n## Additional context\r\nimport torch\r\n# import torchsnooper\r\nfrom models_out import Darknet\r\ndevice = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\r\n# with torch.jit.optimized_execution(True):\r\n\r\ndef save_pytorch_model(darknet_model,pytorch_model,config_file):\r\n\r\n    model = Darknet(config_file).to(device)\r\n    model.load_darknet_weights(darknet_model)\r\n    torch.save(model.state_dict(), pytorch_model)\r\n\r\n    print('pytorch model saved!')\r\n\r\ndef convert_pytorch_model_to_libtorch(config_file,pytorch_model,libtorch_model):\r\n    model = Darknet(config_file).to(device)\r\n    model.load_state_dict(torch.load(pytorch_model),False)\r\n    model.eval()\r\n    example = torch.rand(1,3,608,608).cuda()\r\n    with torch.jit.optimized_execution(True):\r\n        print('ppa')\r\n        # example 报错 Expected type 'tuple', got 'Tensor' instead ，可能是input没有放cuda上\r\n        traced_script_module = torch.jit.trace(model, example,check_trace=False)# save the converted model\r\n        print('oo')\r\n        traced_script_module.save(libtorch_model)\r\n        output = traced_script_module(torch.rand(1,3,608,608).cuda())\r\n        print(output)\r\n    print('trace model saved!')\r\n\r\nconvert_pytorch_model_to_libtorch('cfg/yolov3.cfg','weights/best.pt','bestout.pt')","closed_by":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/1636/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1636/timeline","performed_via_github_app":null,"state_reason":"completed"}