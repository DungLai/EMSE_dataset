{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/245","repository_url":"https://api.github.com/repos/ultralytics/yolov3","labels_url":"https://api.github.com/repos/ultralytics/yolov3/issues/245/labels{/name}","comments_url":"https://api.github.com/repos/ultralytics/yolov3/issues/245/comments","events_url":"https://api.github.com/repos/ultralytics/yolov3/issues/245/events","html_url":"https://github.com/ultralytics/yolov3/issues/245","id":438163514,"node_id":"MDU6SXNzdWU0MzgxNjM1MTQ=","number":245,"title":"Error reported when using Torch script to make the trained model callable by C++ ","user":{"login":"shadyatscu","id":5959212,"node_id":"MDQ6VXNlcjU5NTkyMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5959212?v=4","gravatar_id":"","url":"https://api.github.com/users/shadyatscu","html_url":"https://github.com/shadyatscu","followers_url":"https://api.github.com/users/shadyatscu/followers","following_url":"https://api.github.com/users/shadyatscu/following{/other_user}","gists_url":"https://api.github.com/users/shadyatscu/gists{/gist_id}","starred_url":"https://api.github.com/users/shadyatscu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shadyatscu/subscriptions","organizations_url":"https://api.github.com/users/shadyatscu/orgs","repos_url":"https://api.github.com/users/shadyatscu/repos","events_url":"https://api.github.com/users/shadyatscu/events{/privacy}","received_events_url":"https://api.github.com/users/shadyatscu/received_events","type":"User","site_admin":false},"labels":[{"id":1035696372,"node_id":"MDU6TGFiZWwxMDM1Njk2Mzcy","url":"https://api.github.com/repos/ultralytics/yolov3/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":14,"created_at":"2019-04-29T06:17:49Z","updated_at":"2020-12-23T07:40:49Z","closed_at":"2019-09-26T11:13:02Z","author_association":"NONE","active_lock_reason":null,"body":"Thanks for your teams great work! I tried to make the trained yolov3 model callable by C++, from the official reference there are two methods: trace and script annotation. When i use the script annotation method, i modified the model function follow the instructions like this:\r\n\r\n#class Darknet(nn.Module):\r\nclass Darknet(torch.jit.ScriptModule):\r\n    def __init__(self, cfg, img_size=(416, 416)):\r\n        super(Darknet, self).__init__()\r\n\r\n        self.module_defs = parse_model_cfg(cfg)\r\n        self.module_defs[0]['cfg'] = cfg\r\n        self.module_defs[0]['height'] = img_size\r\n        self.hyperparams, self.module_list = create_modules(self.module_defs)\r\n        self.yolo_layers = get_yolo_layers(self)\r\n\r\n        # Needed to write header when saving weights\r\n        self.header_info = np.zeros(5, dtype=np.int32)  # First five are header values\r\n        self.seen = self.header_info[3]  # number of images seen during training\r\n\r\n    @torch.jit.script_method\r\n    def forward(self, x, var=None):\r\n        img_size = max(x.shape[-2:])\r\n        layer_outputs = []\r\n        output = []\r\n\r\n , at the same time i  modified some statements unsupported by torch.jit. However a error\"RuntimeError: cannot instantiate class object (ModuleList) inside jit.script'' can not be fixed all the time. Could you give me some advices to fix it and is anybody also tries to make the model callable by c++?\r\n","closed_by":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/245/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ultralytics/yolov3/issues/245/timeline","performed_via_github_app":null,"state_reason":"completed"}