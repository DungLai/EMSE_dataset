{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/1988","repository_url":"https://api.github.com/repos/ultralytics/yolov3","labels_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1988/labels{/name}","comments_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1988/comments","events_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1988/events","html_url":"https://github.com/ultralytics/yolov3/issues/1988","id":1458867473,"node_id":"I_kwDOCLZQgM5W9I0R","number":1988,"title":"Question on Model's Output require_grad being False instead of True","user":{"login":"justinyue1643","id":30033925,"node_id":"MDQ6VXNlcjMwMDMzOTI1","avatar_url":"https://avatars.githubusercontent.com/u/30033925?v=4","gravatar_id":"","url":"https://api.github.com/users/justinyue1643","html_url":"https://github.com/justinyue1643","followers_url":"https://api.github.com/users/justinyue1643/followers","following_url":"https://api.github.com/users/justinyue1643/following{/other_user}","gists_url":"https://api.github.com/users/justinyue1643/gists{/gist_id}","starred_url":"https://api.github.com/users/justinyue1643/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinyue1643/subscriptions","organizations_url":"https://api.github.com/users/justinyue1643/orgs","repos_url":"https://api.github.com/users/justinyue1643/repos","events_url":"https://api.github.com/users/justinyue1643/events{/privacy}","received_events_url":"https://api.github.com/users/justinyue1643/received_events","type":"User","site_admin":false},"labels":[{"id":1035696370,"node_id":"MDU6TGFiZWwxMDM1Njk2Mzcw","url":"https://api.github.com/repos/ultralytics/yolov3/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2022-11-22T01:46:53Z","updated_at":"2022-11-22T22:28:19Z","closed_at":"2022-11-22T22:28:19Z","author_association":"NONE","active_lock_reason":null,"body":"### Search before asking\n\n- [X] I have searched the YOLOv3 [issues](https://github.com/ultralytics/yolov3/issues) and found no similar bug report.\n\n\n### YOLOv3 Component\n\nDetection\n\n### Bug\n\nI've created a modified copy of detect.py where I create 2 `DetectMultiBackend` models. I use their 2 outputs to generate a loss which I would then pass into the `torch.autograd.grad()` function. This yields the following error. \r\n\r\n![image](https://user-images.githubusercontent.com/30033925/203193348-c57821b6-d0c8-4fc2-9865-242bac4d192c.png)\r\n\r\nI suspect that this is because the outputs' `requires_grad` attribute is False, even when I set the models' inputs to have `requires_grad` to be true. Another thing I did was running the following code for each model.\r\n\r\n```\r\nfor k, v in model.parameters():\r\n  v.requires_grad = True\r\n```\r\n\r\nIs there a way to change the model such that its outputs' `requires_grad` is True.\n\n### Environment\n\nI cloned  and ran this repo and my modified detect.py in Google Colab. \n\n### Minimal Reproducible Example\n\nPseudocode:\r\n```\r\na_img, b_img = ... # provided by DataLoader\r\n\r\na_model = DetectMultiBackend(weights, device, dnn)\r\nb_model = DetectMultiBackend(weights, device, dnn)\r\n\r\nfor k, v in a_model.parameters():\r\n  v.requires_grad = True\r\n\r\nfor k, v in b_model.parameters():\r\n  v.requires_grad = True\r\n\r\na_output = a_model(a_img, augment=False, visualize=False)\r\nb_output = b_model(b_img, augment=False, visualize=False)\r\n\r\nq = convert_to_q(a_output) # perform some torch operations that returns a tensor of shape (1,3)\r\nq_prime = convert_to_q_prime(b_output) # perform some torch operations that returns a tensor of shape (1,3)\r\n\r\nq /= q.sum()\r\nq_prime /= q_prime.sum()\r\nloss_f = torch.pow((q - q_prime), 2).sum()\r\nloss = torch.mean(0.01 * (loss_f ** -1))\r\n\r\nloss_grad = torch.autograd.grad(loss, a_img, retain_graph=False, create_graph=False)\r\n```\n\n### Additional\n\n_No response_\n\n### Are you willing to submit a PR?\n\n- [ ] Yes I'd like to help by submitting a PR!","closed_by":{"login":"justinyue1643","id":30033925,"node_id":"MDQ6VXNlcjMwMDMzOTI1","avatar_url":"https://avatars.githubusercontent.com/u/30033925?v=4","gravatar_id":"","url":"https://api.github.com/users/justinyue1643","html_url":"https://github.com/justinyue1643","followers_url":"https://api.github.com/users/justinyue1643/followers","following_url":"https://api.github.com/users/justinyue1643/following{/other_user}","gists_url":"https://api.github.com/users/justinyue1643/gists{/gist_id}","starred_url":"https://api.github.com/users/justinyue1643/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinyue1643/subscriptions","organizations_url":"https://api.github.com/users/justinyue1643/orgs","repos_url":"https://api.github.com/users/justinyue1643/repos","events_url":"https://api.github.com/users/justinyue1643/events{/privacy}","received_events_url":"https://api.github.com/users/justinyue1643/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/1988/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1988/timeline","performed_via_github_app":null,"state_reason":"completed"}