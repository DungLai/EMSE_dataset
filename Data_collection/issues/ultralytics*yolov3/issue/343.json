{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/343","repository_url":"https://api.github.com/repos/ultralytics/yolov3","labels_url":"https://api.github.com/repos/ultralytics/yolov3/issues/343/labels{/name}","comments_url":"https://api.github.com/repos/ultralytics/yolov3/issues/343/comments","events_url":"https://api.github.com/repos/ultralytics/yolov3/issues/343/events","html_url":"https://github.com/ultralytics/yolov3/issues/343","id":459628123,"node_id":"MDU6SXNzdWU0NTk2MjgxMjM=","number":343,"title":"OpenCV error upon mAP calculation","user":{"login":"bigrobinson","id":42244176,"node_id":"MDQ6VXNlcjQyMjQ0MTc2","avatar_url":"https://avatars.githubusercontent.com/u/42244176?v=4","gravatar_id":"","url":"https://api.github.com/users/bigrobinson","html_url":"https://github.com/bigrobinson","followers_url":"https://api.github.com/users/bigrobinson/followers","following_url":"https://api.github.com/users/bigrobinson/following{/other_user}","gists_url":"https://api.github.com/users/bigrobinson/gists{/gist_id}","starred_url":"https://api.github.com/users/bigrobinson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bigrobinson/subscriptions","organizations_url":"https://api.github.com/users/bigrobinson/orgs","repos_url":"https://api.github.com/users/bigrobinson/repos","events_url":"https://api.github.com/users/bigrobinson/events{/privacy}","received_events_url":"https://api.github.com/users/bigrobinson/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2019-06-23T23:03:52Z","updated_at":"2020-01-27T17:45:28Z","closed_at":"2019-07-25T00:13:16Z","author_association":"NONE","active_lock_reason":null,"body":"First of all, thank you for the hard work and the great documentation. Can you help with this error? It occurs upon calculation of the mAP and appears related to an opencv rendering. I have 4 classes I am training with 1720 labeled training images. Any help is much appreciated.\r\n\r\n******* cfg file hyperparameters\r\n[net]\r\nbatch=64\r\nsubdivisions=8\r\nwidth=608\r\nheight=608\r\nchannels=3\r\nmomentum=0.9\r\ndecay=0.0005\r\nangle=0\r\nsaturation = 1.5\r\nexposure = 1.5\r\nhue=.1\r\nlearning_rate=0.001\r\nburn_in=2000\r\nmax_batches=500200\r\npolicy=steps\r\nsteps=400000,450000\r\nscales=.1,.1\r\n\r\n********** cfg file pre-yolo layer parameters\r\n[convolutional]\r\nsize=1\r\nstride=1\r\npad=1\r\nfilters=27\r\nactivation=linear\r\n\r\n************Error out\r\n\r\nOpenCV(3.4.1) Error: Assertion failed (top >= 0 && bottom >= 0 && left >= 0 && right >= 0) in copyMakeBorder, file /opt/conda/conda-bld/opencv-suite_1527005194613/work/modules/core/src/copy.cpp, line 1182\r\nTraceback (most recent call last):\r\n  File \"train.py\", line 347, in <module>\r\n    accumulate=opt.accumulate,\r\n  File \"train.py\", line 260, in train\r\n    conf_thres=0.1)\r\n  File \"/home/brian/yolov3/test.py\", line 60, in test\r\n    for batch_i, (imgs, targets, paths, shapes) in enumerate(tqdm(dataloader, desc='Computing mAP')):\r\n  File \"/home/brian/anaconda3/lib/python3.6/site-packages/tqdm/_tqdm.py\", line 1005, in __iter__\r\n    for obj in iterable:\r\n  File \"/home/brian/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 582, in __next__\r\n    return self._process_next_batch(batch)\r\n  File \"/home/brian/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 608, in _process_next_batch\r\n    raise batch.exc_type(batch.exc_msg)\r\ncv2.error: Traceback (most recent call last):\r\n  File \"/home/brian/anaconda3/lib/python3.6/site-packages/torch/utils/data/_utils/worker.py\", line 99, in _worker_loop\r\n    samples = collate_fn([dataset[i] for i in batch_indices])\r\n  File \"/home/brian/anaconda3/lib/python3.6/site-packages/torch/utils/data/_utils/worker.py\", line 99, in <listcomp>\r\n    samples = collate_fn([dataset[i] for i in batch_indices])\r\n  File \"/home/brian/yolov3/utils/datasets.py\", line 269, in __getitem__\r\n    img, ratio, padw, padh = letterbox(img, new_shape=shape, mode='rect')\r\n  File \"/home/brian/yolov3/utils/datasets.py\", line 359, in letterbox\r\n    img = cv2.copyMakeBorder(img, top, bottom, left, right, cv2.BORDER_CONSTANT, value=color)  # padded square\r\ncv2.error: OpenCV(3.4.1) /opt/conda/conda-bld/opencv-suite_1527005194613/work/modules/core/src/copy.cpp:1182: error: (-215) top >= 0 && bottom >= 0 && left >= 0 && right >= 0 in function copyMakeBorder\r\n","closed_by":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/343/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ultralytics/yolov3/issues/343/timeline","performed_via_github_app":null,"state_reason":"completed"}