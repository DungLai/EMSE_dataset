{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/915","repository_url":"https://api.github.com/repos/ultralytics/yolov3","labels_url":"https://api.github.com/repos/ultralytics/yolov3/issues/915/labels{/name}","comments_url":"https://api.github.com/repos/ultralytics/yolov3/issues/915/comments","events_url":"https://api.github.com/repos/ultralytics/yolov3/issues/915/events","html_url":"https://github.com/ultralytics/yolov3/issues/915","id":578991493,"node_id":"MDU6SXNzdWU1Nzg5OTE0OTM=","number":915,"title":"COCOAPI mAP results and test.py misalign / mismatch","user":{"login":"AlphaGoMK","id":24295596,"node_id":"MDQ6VXNlcjI0Mjk1NTk2","avatar_url":"https://avatars.githubusercontent.com/u/24295596?v=4","gravatar_id":"","url":"https://api.github.com/users/AlphaGoMK","html_url":"https://github.com/AlphaGoMK","followers_url":"https://api.github.com/users/AlphaGoMK/followers","following_url":"https://api.github.com/users/AlphaGoMK/following{/other_user}","gists_url":"https://api.github.com/users/AlphaGoMK/gists{/gist_id}","starred_url":"https://api.github.com/users/AlphaGoMK/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlphaGoMK/subscriptions","organizations_url":"https://api.github.com/users/AlphaGoMK/orgs","repos_url":"https://api.github.com/users/AlphaGoMK/repos","events_url":"https://api.github.com/users/AlphaGoMK/events{/privacy}","received_events_url":"https://api.github.com/users/AlphaGoMK/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-03-11T03:51:12Z","updated_at":"2020-03-12T07:02:37Z","closed_at":"2020-03-12T07:02:36Z","author_association":"NONE","active_lock_reason":null,"body":"## üêõ Bug\r\nA clear and concise description of what the bug is.  \r\nThanks for your awesome project!üëèüëè\r\nThe map results produced by cocoapi and test.py are mismatched at a large margin.\r\n\r\n\r\n## To Reproduce\r\nSteps to reproduce the behavior:\r\n1. Download official pretrained model at [pjreddie's webpage](https://pjreddie.com/darknet/yolo/)\r\n2. Run `python test.py --weights yolov3-spp.weights --data ../../data/coco2017.data --cfg cfg/yolov3-spp.cfg --save-json`\r\n\r\n## Expected behavior\r\nA clear and concise description of what you expected to happen.\r\nThe mAPs produced by two methods should equal or close to each other.\r\n\r\n## Environment\r\nIf applicable, add screenshots to help explain your problem.\r\n```\r\n(pytorch)  ‚ö° root@lab ÓÇ∞ master ‚óè ÓÇ∞ python test.py --weights yolov3-spp.weights --data ../../data/coco2017.data --cfg cfg/yolov3-spp.cfg --save-json\r\nNamespace(batch_size=32, cfg='cfg/yolov3-spp.cfg', conf_thres=0.001, data='../../data/coco2017.data', device='', img_size=416, iou_thres=0.6, save_json=True, single_cls=False, task='test', weights='yolov3-spp.weights')\r\nUsing CUDA device0 _CudaDeviceProperties(name='GeForce RTX 2080 Ti', total_memory=10989MB)\r\n           device1 _CudaDeviceProperties(name='GeForce RTX 2080 Ti', total_memory=10989MB)\r\n\r\nCaching labels (4952 found, 0 missing, 48 empty, 0 duplicate, for 5000 images): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 5000/5000 [00:00<00:00, 12290.42it/s]\r\n               Class    Images   Targets         P         R   mAP@0.5        F1: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 157/157 [02:28<00:00,  1.55it/s]\r\n                 all     5e+03  3.68e+04    0.0088   0.00419  0.000991   0.00551\r\n              person     5e+03   1.1e+04   0.00658   0.00418   0.00046   0.00511\r\n             bicycle     5e+03       316         0         0  0.000672         0\r\n                 car     5e+03  1.93e+03   0.00657   0.00362  0.000587   0.00467\r\n          motorcycle     5e+03       371   0.00541    0.0027   0.00127    0.0036\r\n            airplane     5e+03       143    0.0095   0.00699  0.000666   0.00806\r\n                 bus     5e+03       285   0.00485   0.00351  0.000342   0.00407\r\n               train     5e+03       190         0         0     4e-06         0\r\n               truck     5e+03       415         0         0  0.000265         0\r\n                boat     5e+03       430         0         0   0.00084         0\r\n       traffic light     5e+03       637   0.00354   0.00157  0.000196   0.00217\r\n        fire hydrant     5e+03       101         0         0  3.85e-05         0\r\n           stop sign     5e+03        75         0         0         0         0\r\n       parking meter     5e+03        60         0         0         0         0\r\n               bench     5e+03       413         0         0  0.000145         0\r\n                bird     5e+03       440   0.00494   0.00227  0.000613   0.00311\r\n                 cat     5e+03       202   0.00552   0.00495   7.1e-05   0.00522\r\n                 dog     5e+03       218         0         0  4.59e-05         0\r\n               horse     5e+03       273         0         0  0.000179         0\r\n               sheep     5e+03       361    0.0222    0.0139   0.00218    0.0171\r\n                 cow     5e+03       380   0.00795   0.00526   0.00069   0.00633\r\n            elephant     5e+03       255   0.00918   0.00784  0.000519   0.00846\r\n                bear     5e+03        71         0         0         0         0\r\n               zebra     5e+03       268    0.0149    0.0112   0.00103    0.0128\r\n             giraffe     5e+03       232   0.00542   0.00431  0.000592    0.0048\r\n            backpack     5e+03       371         0         0  0.000188         0\r\n            umbrella     5e+03       413    0.0107   0.00484  0.000588   0.00666\r\n             handbag     5e+03       540    0.0122   0.00185  0.000441   0.00322\r\n                 tie     5e+03       254         0         0   0.00021         0\r\n            suitcase     5e+03       303   0.00769    0.0033  0.000997   0.00462\r\n             frisbee     5e+03       115         0         0         0         0\r\n                skis     5e+03       241         0         0  0.000555         0\r\n           snowboard     5e+03        69         0         0  2.08e-05         0\r\n         sports ball     5e+03       263    0.0162    0.0114  0.000326    0.0134\r\n                kite     5e+03       336   0.00519   0.00298  0.000393   0.00378\r\n        baseball bat     5e+03       146         0         0   0.00128         0\r\n      baseball glove     5e+03       148         0         0  0.000122         0\r\n          skateboard     5e+03       179         0         0  0.000141         0\r\n           surfboard     5e+03       269   0.00778   0.00372  0.000302   0.00503\r\n       tennis racket     5e+03       225         0         0  8.64e-05         0\r\n              bottle     5e+03  1.02e+03   0.00408   0.00195  0.000274   0.00264\r\n          wine glass     5e+03       343   0.00714   0.00292   0.00107   0.00414\r\n                 cup     5e+03       899   0.00214   0.00111  0.000478   0.00146\r\n                fork     5e+03       215         0         0  0.000165         0\r\n               knife     5e+03       326    0.0431    0.0092   0.00219    0.0152\r\n               spoon     5e+03       253         0         0  0.000445         0\r\n                bowl     5e+03       626   0.00688   0.00319  0.000409   0.00436\r\n              banana     5e+03       379    0.0327   0.00792   0.00368    0.0127\r\n               apple     5e+03       239    0.0245   0.00837   0.00279    0.0125\r\n            sandwich     5e+03       177         0         0   0.00155         0\r\n              orange     5e+03       287    0.0637    0.0348   0.00785     0.045\r\n            broccoli     5e+03       316    0.0251   0.00633   0.00347    0.0101\r\n              carrot     5e+03       371    0.0453    0.0108   0.00243    0.0174\r\n             hot dog     5e+03       127     0.135     0.063    0.0145    0.0859\r\n               pizza     5e+03       285   0.00587   0.00351   0.00099   0.00439\r\n               donut     5e+03       338    0.0652    0.0414   0.00791    0.0507\r\n                cake     5e+03       316    0.0137   0.00633    0.0029   0.00866\r\n               chair     5e+03  1.79e+03   0.00711   0.00223  0.000712    0.0034\r\n               couch     5e+03       261    0.0142   0.00766  0.000186   0.00994\r\n        potted plant     5e+03       343         0         0   0.00015         0\r\n                 bed     5e+03       163    0.0101   0.00613  0.000186   0.00763\r\n        dining table     5e+03       697         0         0  0.000119         0\r\n              toilet     5e+03       179         0         0   0.00022         0\r\n                  tv     5e+03       288         0         0  3.59e-05         0\r\n              laptop     5e+03       231    0.0123   0.00866  0.000872    0.0102\r\n               mouse     5e+03       106         0         0  6.83e-05         0\r\n              remote     5e+03       283         0         0  0.000159         0\r\n            keyboard     5e+03       153         0         0  0.000219         0\r\n          cell phone     5e+03       262         0         0  0.000124         0\r\n           microwave     5e+03        55         0         0  2.46e-05         0\r\n                oven     5e+03       143         0         0  0.000135         0\r\n             toaster     5e+03         9         0         0         0         0\r\n                sink     5e+03       225    0.0101   0.00444  0.000468   0.00617\r\n        refrigerator     5e+03       126         0         0  0.000382         0\r\n                book     5e+03  1.16e+03   0.00295  0.000861  0.000144   0.00133\r\n               clock     5e+03       267         0         0  3.18e-06         0\r\n                vase     5e+03       277   0.00683   0.00361  0.000488   0.00472\r\n            scissors     5e+03        36         0         0  7.65e-05         0\r\n          teddy bear     5e+03       191         0         0   0.00211         0\r\n          hair drier     5e+03        11         0         0   0.00109         0\r\n          toothbrush     5e+03        57         0         0   0.00122         0\r\nSpeed: 8.5/0.8/9.3 ms inference/NMS/total per 416x416 image at batch-size 32\r\n\r\nCOCO mAP with pycocotools...\r\nloading annotations into memory...\r\nDone (t=0.77s)\r\ncreating index...\r\nindex created!\r\nLoading and preparing results...\r\nDONE (t=5.20s)\r\ncreating index...\r\nindex created!\r\nRunning per image evaluation...\r\nEvaluate annotation type *bbox*\r\nDONE (t=112.24s).\r\nAccumulating evaluation results...\r\nDONE (t=11.89s).\r\n Average Precision  (AP) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.404\r\n Average Precision  (AP) @[ IoU=0.50      | area=   all | maxDets=100 ] = 0.672\r\n Average Precision  (AP) @[ IoU=0.75      | area=   all | maxDets=100 ] = 0.425\r\n Average Precision  (AP) @[ IoU=0.50:0.95 | area= small | maxDets=100 ] = 0.210\r\n Average Precision  (AP) @[ IoU=0.50:0.95 | area=medium | maxDets=100 ] = 0.440\r\n Average Precision  (AP) @[ IoU=0.50:0.95 | area= large | maxDets=100 ] = 0.592\r\n Average Recall     (AR) @[ IoU=0.50:0.95 | area=   all | maxDets=  1 ] = 0.312\r\n Average Recall     (AR) @[ IoU=0.50:0.95 | area=   all | maxDets= 10 ] = 0.505\r\n Average Recall     (AR) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.550\r\n Average Recall     (AR) @[ IoU=0.50:0.95 | area= small | maxDets=100 ] = 0.360\r\n Average Recall     (AR) @[ IoU=0.50:0.95 | area=medium | maxDets=100 ] = 0.603\r\n Average Recall     (AR) @[ IoU=0.50:0.95 | area= large | maxDets=100 ] = 0.721\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: ubuntu\r\n - Version 18.04\r\n\r\n\r\n## Additional context\r\nI've tried with commit #d55dbc1 and #65eeb1b , both of them got same issue.  \r\nI modified paths in `coco2017.data` and cocoGt path in `test.py`, the others remain unchanged.  \r\nCould you please provide any advice about this problem or any supply material about model evalution.  \r\nThanks in advance :)\r\n","closed_by":{"login":"AlphaGoMK","id":24295596,"node_id":"MDQ6VXNlcjI0Mjk1NTk2","avatar_url":"https://avatars.githubusercontent.com/u/24295596?v=4","gravatar_id":"","url":"https://api.github.com/users/AlphaGoMK","html_url":"https://github.com/AlphaGoMK","followers_url":"https://api.github.com/users/AlphaGoMK/followers","following_url":"https://api.github.com/users/AlphaGoMK/following{/other_user}","gists_url":"https://api.github.com/users/AlphaGoMK/gists{/gist_id}","starred_url":"https://api.github.com/users/AlphaGoMK/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlphaGoMK/subscriptions","organizations_url":"https://api.github.com/users/AlphaGoMK/orgs","repos_url":"https://api.github.com/users/AlphaGoMK/repos","events_url":"https://api.github.com/users/AlphaGoMK/events{/privacy}","received_events_url":"https://api.github.com/users/AlphaGoMK/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/915/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ultralytics/yolov3/issues/915/timeline","performed_via_github_app":null,"state_reason":"completed"}