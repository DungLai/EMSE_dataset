{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/1866","repository_url":"https://api.github.com/repos/ultralytics/yolov3","labels_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1866/labels{/name}","comments_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1866/comments","events_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1866/events","html_url":"https://github.com/ultralytics/yolov3/issues/1866","id":1061278527,"node_id":"I_kwDOCLZQgM4_QdM_","number":1866,"title":"Issues exporting custom model","user":{"login":"HampusAstrom","id":17680461,"node_id":"MDQ6VXNlcjE3NjgwNDYx","avatar_url":"https://avatars.githubusercontent.com/u/17680461?v=4","gravatar_id":"","url":"https://api.github.com/users/HampusAstrom","html_url":"https://github.com/HampusAstrom","followers_url":"https://api.github.com/users/HampusAstrom/followers","following_url":"https://api.github.com/users/HampusAstrom/following{/other_user}","gists_url":"https://api.github.com/users/HampusAstrom/gists{/gist_id}","starred_url":"https://api.github.com/users/HampusAstrom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HampusAstrom/subscriptions","organizations_url":"https://api.github.com/users/HampusAstrom/orgs","repos_url":"https://api.github.com/users/HampusAstrom/repos","events_url":"https://api.github.com/users/HampusAstrom/events{/privacy}","received_events_url":"https://api.github.com/users/HampusAstrom/received_events","type":"User","site_admin":false},"labels":[{"id":1035696376,"node_id":"MDU6TGFiZWwxMDM1Njk2Mzc2","url":"https://api.github.com/repos/ultralytics/yolov3/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"},{"id":1890885613,"node_id":"MDU6TGFiZWwxODkwODg1NjEz","url":"https://api.github.com/repos/ultralytics/yolov3/labels/Stale","name":"Stale","color":"ededed","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2021-11-23T13:17:59Z","updated_at":"2021-12-30T00:08:10Z","closed_at":"2021-12-30T00:08:10Z","author_association":"NONE","active_lock_reason":null,"body":"### Search before asking\n\n- [X] I have searched the YOLOv3 [issues](https://github.com/ultralytics/yolov3/issues) and [discussions](https://github.com/ultralytics/yolov3/discussions) and found no similar questions.\n\n\n### Question\n\nI have trained a model using the command `python train.py --img 400 --epochs 100 --data tless-synthetic.yaml --weights yolov3.pt --batch 8`, and this works fine (data was setup correctly and defined in .yaml mentioned above).\r\n\r\nBut now that I try to export the model so in can import it in another repo (repo contrains own utils folder, had trouble importing using torch.hub). When I run the export command `python export.py --data tless-synthetic.yaml --weights runs/train/exp4/weights/best.pt` I get the following error:\r\n```\r\npython export.py --data tless-synthetic.yaml --weights runs/train/exp4/weights/best.pt\r\nexport: data=tless-synthetic.yaml, weights=runs/train/exp4/weights/best.pt, imgsz=[640, 640], batch_size=1, device=cpu, half=False, inplace=False, train=False, optimize=False, int8=False, dynamic=False, simplify=False, opset=13, topk_per_class=100, topk_all=100, iou_thres=0.45, conf_thres=0.25, include=['torchscript', 'onnx']\r\nYOLOv3 ðŸš€ v9.6.0-4-g6bf59c9 torch 1.7.1 CPU\r\n\r\nFusing layers... \r\nModel Summary: 261 layers, 61653595 parameters, 0 gradients, 155.2 GFLOPs\r\n\r\nPyTorch: starting from runs/train/exp4/weights/best.pt (123.7 MB)\r\n\r\nTorchScript: starting export with torch 1.7.1...\r\n/home/hampus/vision/yolov3/models/yolo.py:58: TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!\r\n  if self.onnx_dynamic or self.grid[i].shape[2:4] != x[i].shape[2:4]:\r\nTorchScript: export failure: save(): incompatible function arguments. The following argument types are supported:\r\n    1. (self: torch._C.ScriptModule, filename: str, _extra_files: Dict[str, str] = {}) -> None\r\n\r\nInvoked with: <torch._C.ScriptModule object at 0x7f37a822c8b0>, PosixPath('runs/train/exp4/weights/best.torchscript.pt'); kwargs: _extra_files={'config.txt': '{\"shape\": [1, 3, 640, 640], \"stride\": 32, \"names\": [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\", \"13\", \"14\", \"15\", \"16\", \"17\", \"18\", \"19\", \"20\", \"21\", \"22\", \"23\", \"24\", \"25\", \"26\", \"27\", \"28\", \"29\", \"30\"]}'}\r\n\r\nONNX: starting export with onnx 1.10.2...\r\nONNX: export failure: Unsupported ONNX opset version: 13\r\n\r\n```\r\n\r\nDo you have any suggestions on how I can get it to export in either TorchScript or ONNX format so I can import it in my other repo without reference issues like with torch.hub?\r\n\r\nI am running on Ubuntu 16.\n\n### Additional\n\n_No response_","closed_by":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/1866/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1866/timeline","performed_via_github_app":null,"state_reason":"completed"}