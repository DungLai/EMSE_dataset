{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/117","repository_url":"https://api.github.com/repos/ultralytics/yolov3","labels_url":"https://api.github.com/repos/ultralytics/yolov3/issues/117/labels{/name}","comments_url":"https://api.github.com/repos/ultralytics/yolov3/issues/117/comments","events_url":"https://api.github.com/repos/ultralytics/yolov3/issues/117/events","html_url":"https://github.com/ultralytics/yolov3/issues/117","id":417067053,"node_id":"MDU6SXNzdWU0MTcwNjcwNTM=","number":117,"title":"Explaination on Why NMS Is Slow During Custom Dataset Training And How to Solve it","user":{"login":"wtiandong","id":7546978,"node_id":"MDQ6VXNlcjc1NDY5Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/7546978?v=4","gravatar_id":"","url":"https://api.github.com/users/wtiandong","html_url":"https://github.com/wtiandong","followers_url":"https://api.github.com/users/wtiandong/followers","following_url":"https://api.github.com/users/wtiandong/following{/other_user}","gists_url":"https://api.github.com/users/wtiandong/gists{/gist_id}","starred_url":"https://api.github.com/users/wtiandong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wtiandong/subscriptions","organizations_url":"https://api.github.com/users/wtiandong/orgs","repos_url":"https://api.github.com/users/wtiandong/repos","events_url":"https://api.github.com/users/wtiandong/events{/privacy}","received_events_url":"https://api.github.com/users/wtiandong/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-03-05T01:12:28Z","updated_at":"2019-03-21T10:39:20Z","closed_at":"2019-03-16T09:52:46Z","author_association":"NONE","active_lock_reason":null,"body":"In issue #112 , @iadfy says that NMS is slow when training a yolov3 network with just two classes. This happen to me too. It takes 2 seconds to forward and backward a batch but 99 seconds to NMS the same batch. @iadfy says that _it seems that smaller number of classes with smaller filters takes longer time to testing but i have no idea where to figure out... any idea would be helpful._ Smaller filters takes longer time is just a result, not the cause.\r\n\r\nThe real cause is NMS is a slow algorithm with time complexity of O(N^2). When you training a new network, the weights are just random initialized. The output of YOLOLayer is just random number centered at 0.5. NMS threshold for testing during training is 0.3, so thousands of bounding box candidates needs for NMS, depend on your input image size and configuration of YOLOLayer Input. And what's worse, the candidates IOU is small with a large probability due to randomization, so the cancellation of high IOU boxes won't work. All these lead to wasting O(N^2) time on NMS on meaningless random box candidates.\r\n\r\nHow to solve it? Well you can just skip testing of few epoch on the begining. Here's the code:\r\n\r\n```python\r\n# Calculate mAP\r\nwith torch.no_grad():\r\n    if(epoch > 40):\r\n        mAP, R, P = test.test(cfg, data_cfg, weights=latest, batch_size=batch_size, img_size=img_size)\r\n\r\n# Write epoch results\r\nif(epoch > 40):\r\n    with open('results.txt', 'a') as file:\r\n        file.write(s + '%11.3g' * 3 % (mAP, P, R) + '\\n')\r\n```\r\nOn train.py, line 169 to 178.\r\n\r\nGood Luck.\r\n\r\n","closed_by":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/117/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ultralytics/yolov3/issues/117/timeline","performed_via_github_app":null,"state_reason":"completed"}