{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/1631","repository_url":"https://api.github.com/repos/ultralytics/yolov3","labels_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1631/labels{/name}","comments_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1631/comments","events_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1631/events","html_url":"https://github.com/ultralytics/yolov3/issues/1631","id":776095988,"node_id":"MDU6SXNzdWU3NzYwOTU5ODg=","number":1631,"title":"Fluctuating mAP on validation set despite freezing all parameters","user":{"login":"vaynonym","id":34941454,"node_id":"MDQ6VXNlcjM0OTQxNDU0","avatar_url":"https://avatars.githubusercontent.com/u/34941454?v=4","gravatar_id":"","url":"https://api.github.com/users/vaynonym","html_url":"https://github.com/vaynonym","followers_url":"https://api.github.com/users/vaynonym/followers","following_url":"https://api.github.com/users/vaynonym/following{/other_user}","gists_url":"https://api.github.com/users/vaynonym/gists{/gist_id}","starred_url":"https://api.github.com/users/vaynonym/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vaynonym/subscriptions","organizations_url":"https://api.github.com/users/vaynonym/orgs","repos_url":"https://api.github.com/users/vaynonym/repos","events_url":"https://api.github.com/users/vaynonym/events{/privacy}","received_events_url":"https://api.github.com/users/vaynonym/received_events","type":"User","site_admin":false},"labels":[{"id":1035696376,"node_id":"MDU6TGFiZWwxMDM1Njk2Mzc2","url":"https://api.github.com/repos/ultralytics/yolov3/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"},{"id":1890885613,"node_id":"MDU6TGFiZWwxODkwODg1NjEz","url":"https://api.github.com/repos/ultralytics/yolov3/labels/Stale","name":"Stale","color":"ededed","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-12-29T21:31:42Z","updated_at":"2021-02-04T00:29:11Z","closed_at":"2021-02-04T00:29:11Z","author_association":"NONE","active_lock_reason":null,"body":"## ‚ùîQuestion\r\nHello! I was trying to test whether freezing the (Yolov3) network during training works, using the following segment to freeze every parameter (subsequently unfreezing a single layer that is just an identity function) after loading existing weights:\r\n\r\n```\r\nfor param in model.parameters():\r\n    param.requires_grad = False\r\n```\r\n\r\nThis appears to work - when I take the sum of every parameter, the result remains constant across epochs. **However, the validation results do not actually remain constant and change with each epoch, albeit only slightly (+ or - 0.01 mAP, slightly different precision and recall each time).** I use standard settings/hyperparameters for validation and training, as in I didn't touch a thing. It should be noted that I forked the master branch (recently pulled), but no changes that I made should have any influence on the training - I just added some new modules that replace the Detect module and seem to work fine, and which are either frozen too or are modified to be the identity function, i.e. have a gradient of 0 for every parameter. As such, and coupled with the fact that the parameters _do_ remain constant across epochs, I believe this should have no relevant difference to the current Master branch.\r\n\r\nInterestingly, when I test twice in a row during the same epoch, I get the exact same results for both tests and there are no fluctuations on mAP, so I believe the data loader is not to blame for this.\r\n\r\n**Basically, my question is this: Is there anything I'm missing that affects the mAP on validation during the epoch other than parameter changes in the network? Any random elements that might be responsible for this shift that would impact the result even when every parameter remains constant?**\r\n\r\nThis occurs even when I comment out the only lines I find that may change parameters during training:\r\n\r\n```\r\n# Backward\r\n            scaler.scale(loss).backward()\r\n\r\n            # Optimize\r\n            if ni % accumulate == 0:\r\n                scaler.step(optimizer)  # optimizer.step\r\n                scaler.update()\r\n                optimizer.zero_grad()\r\n                if ema:\r\n                    ema.update(model)\r\n```\r\n\r\n### Additional Information:\r\n\r\nI do not believe this should be relevant, but just in case: as this was just meant to be a test, I'm training on Coco128 with a slightly modified Yolov3.yaml. The weights I loaded were pre-trained on Coco128 and are then trained again on Coco128, both times with standard hyperparameters. As I mentioned, after loading the pre-trained weights I freeze every parameter as described above, unfreeze a couple of identity modules, and the sum of parameters remains constant across epochs, while the validation results do not remain constant.\r\n\r\nI hope the lengthy explanation makes it easier to parse my problem rather than more difficult. \r\n\r\n","closed_by":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/1631/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1631/timeline","performed_via_github_app":null,"state_reason":"completed"}