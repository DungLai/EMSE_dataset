{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/766","repository_url":"https://api.github.com/repos/ultralytics/yolov3","labels_url":"https://api.github.com/repos/ultralytics/yolov3/issues/766/labels{/name}","comments_url":"https://api.github.com/repos/ultralytics/yolov3/issues/766/comments","events_url":"https://api.github.com/repos/ultralytics/yolov3/issues/766/events","html_url":"https://github.com/ultralytics/yolov3/issues/766","id":547336606,"node_id":"MDU6SXNzdWU1NDczMzY2MDY=","number":766,"title":"Convert onnx successfully but has TracerWarnings","user":{"login":"cbing88","id":9246255,"node_id":"MDQ6VXNlcjkyNDYyNTU=","avatar_url":"https://avatars.githubusercontent.com/u/9246255?v=4","gravatar_id":"","url":"https://api.github.com/users/cbing88","html_url":"https://github.com/cbing88","followers_url":"https://api.github.com/users/cbing88/followers","following_url":"https://api.github.com/users/cbing88/following{/other_user}","gists_url":"https://api.github.com/users/cbing88/gists{/gist_id}","starred_url":"https://api.github.com/users/cbing88/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbing88/subscriptions","organizations_url":"https://api.github.com/users/cbing88/orgs","repos_url":"https://api.github.com/users/cbing88/repos","events_url":"https://api.github.com/users/cbing88/events{/privacy}","received_events_url":"https://api.github.com/users/cbing88/received_events","type":"User","site_admin":false},"labels":[{"id":1035696370,"node_id":"MDU6TGFiZWwxMDM1Njk2Mzcw","url":"https://api.github.com/repos/ultralytics/yolov3/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2020-01-09T08:55:06Z","updated_at":"2020-09-25T06:07:56Z","closed_at":"2020-01-16T19:19:00Z","author_association":"NONE","active_lock_reason":null,"body":"## üêõ Bug\r\nI pulled docker image \"ultralytics/yolov3:v196\" and trained a yolov3 model \"best.pt\", and got many TracerWarnings when I convert to onnx.\r\nDo you have any code available that does the conversion?\r\n\r\n## To Reproduce\r\nSteps to reproduce the behavior:\r\nbelow is Convert Code:\r\n\r\n```\r\nimport os\r\nimport torch\r\nimport models\r\n\r\ndef main():\r\n    cur_path = os.path.dirname(os.path.abspath(__file__))\r\n    torch_model_path = os.path.join(cur_path, 'weights/best.pt')\r\n    onnx_model_path = os.path.join(cur_path, 'weights/yolov3.onnx')\r\n    cfg_path = os.path.join(cur_path, 'cfg/yolov3.cfg')\r\n\r\n    dummy_input = torch.randn(1, 3, 416, 416)\r\n    model = models.Darknet(cfg_path)\r\n    model.load_state_dict(torch.load(torch_model_path, map_location='cpu')['model'], False)\r\n    torch.onnx.export(model, dummy_input, onnx_model_path, opset_version=10)\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n```\r\n \r\nI got the following warnings:\r\n```\r\n/usr/src/app/models.py:168: TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!\r\n  if (self.nx, self.ny) != (nx, ny):\r\n/usr/src/app/models.py:299: TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!\r\n  self.img_size = max(img_size)\r\n/usr/src/app/models.py:300: TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!\r\n  self.stride = self.img_size / max(ng)\r\n/usr/src/app/models.py:309: TracerWarning: torch.Tensor results are registered as constants in the trace. You can safely ignore this warning if you use this function to create tensors out of constant variables that would be the same every time you call this function. In any other case, this might cause the trace to be incorrect.\r\n  self.ng = torch.Tensor(ng).to(device)\r\n/usr/src/app/models.py:309: TracerWarning: Converting a tensor to a Python float might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!\r\n  self.ng = torch.Tensor(ng).to(device)\r\n/usr/src/app/models.py:205: TracerWarning: There are 2 live references to the data region being modified when tracing in-place operator copy_ (possibly due to an assignment). This might cause the trace to be incorrect, because all other views that also reference this data will not reflect this change in the trace! On the other hand, if all other views use the same memory chunk, but are disjoint (e.g. are outputs of torch.split), this might still be safe.\r\n  io[..., :2] = torch.sigmoid(io[..., :2]) + self.grid_xy  # xy\r\n/usr/src/app/models.py:206: TracerWarning: There are 2 live references to the data region being modified when tracing in-place operator copy_ (possibly due to an assignment). This might cause the trace to be incorrect, because all other views that also reference this data will not reflect this change in the trace! On the other hand, if all other views use the same memory chunk, but are disjoint (e.g. are outputs of torch.split), this might still be safe.\r\n  io[..., 2:4] = torch.exp(io[..., 2:4]) * self.anchor_wh  # wh yolo method\r\n/usr/src/app/models.py:208: TracerWarning: There are 2 live references to the data region being modified when tracing in-place operator mul_. This might cause the trace to be incorrect, because all other views that also reference this data will not reflect this change in the trace! On the other hand, if all other views use the same memory chunk, but are disjoint (e.g. are outputs of torch.split), this might still be safe.\r\n  io[..., :4] *= self.stride\r\n/usr/src/app/models.py:208: TracerWarning: There are 4 live references to the data region being modified when tracing in-place operator copy_ (possibly due to an assignment). This might cause the trace to be incorrect, because all other views that also reference this data will not reflect this change in the trace! On the other hand, if all other views use the same memory chunk, but are disjoint (e.g. are outputs of torch.split), this might still be safe.\r\n  io[..., :4] *= self.stride\r\n/usr/src/app/models.py:211: TracerWarning: There are 2 live references to the data region being modified when tracing in-place operator sigmoid_. This might cause the trace to be incorrect, because all other views that also reference this data will not reflect this change in the trace! On the other hand, if all other views use the same memory chunk, but are disjoint (e.g. are outputs of torch.split), this might still be safe.\r\n  torch.sigmoid_(io[..., 4])\r\n/opt/conda/lib/python3.6/site-packages/torch/onnx/symbolic_helper.py:246: UserWarning: You are trying to export the model with onnx:Resize for ONNX opset version 10. This operator might cause results to not match the expected results by PyTorch.\r\nONNX's Upsample/Resize operator did not match Pytorch's Interpolation until opset 11. Attributes to determine how to transform the input were added in onnx:Resize in opset 11 to support Pytorch's behavior (like coordinate_transformation_mode and nearest_mode).\r\nWe recommend using opset 11 and above for models using this operator. \r\n  \"\" + str(_export_onnx_opset_version) + \". \"\r\n```\r\n\r\nI could still export onnx model, I'm wondering if I cloud ignore these warnings?\r\n\r\n## Expected behavior\r\nNo warnings or errors.\r\n\r\n## Environment\r\ndocker image: ultralytics/yolov3:v196","closed_by":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/766/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ultralytics/yolov3/issues/766/timeline","performed_via_github_app":null,"state_reason":"completed"}