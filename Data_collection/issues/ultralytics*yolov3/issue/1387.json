{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/1387","repository_url":"https://api.github.com/repos/ultralytics/yolov3","labels_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1387/labels{/name}","comments_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1387/comments","events_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1387/events","html_url":"https://github.com/ultralytics/yolov3/issues/1387","id":656522593,"node_id":"MDU6SXNzdWU2NTY1MjI1OTM=","number":1387,"title":"Why yolo-tiny predictions on video are all from the first class label? ","user":{"login":"masouduut94","id":21217928,"node_id":"MDQ6VXNlcjIxMjE3OTI4","avatar_url":"https://avatars.githubusercontent.com/u/21217928?v=4","gravatar_id":"","url":"https://api.github.com/users/masouduut94","html_url":"https://github.com/masouduut94","followers_url":"https://api.github.com/users/masouduut94/followers","following_url":"https://api.github.com/users/masouduut94/following{/other_user}","gists_url":"https://api.github.com/users/masouduut94/gists{/gist_id}","starred_url":"https://api.github.com/users/masouduut94/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/masouduut94/subscriptions","organizations_url":"https://api.github.com/users/masouduut94/orgs","repos_url":"https://api.github.com/users/masouduut94/repos","events_url":"https://api.github.com/users/masouduut94/events{/privacy}","received_events_url":"https://api.github.com/users/masouduut94/received_events","type":"User","site_admin":false},"labels":[{"id":1035696376,"node_id":"MDU6TGFiZWwxMDM1Njk2Mzc2","url":"https://api.github.com/repos/ultralytics/yolov3/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-07-14T10:56:23Z","updated_at":"2020-07-18T06:46:26Z","closed_at":"2020-07-18T06:46:25Z","author_association":"NONE","active_lock_reason":null,"body":"Great work and awesome tools @glenn-jocher . the scripts provided by this repository are really useful.\r\n\r\nWhat I want to do is to detect and classify hand gestures based on my dataset.\r\nDataset consists of 11 hand gestures. I followed these steps to modify the code to train YOLO on my dataset.\r\n\r\n1- I used yolo-tiny and therefore I modified the `yolo-tiny.cfg` to the `classes=12` and `filters=51` (5+ 12) * 3 . After running `kmeans_analysis_on_data.py` on my dataset I also changed the \r\n`anchors = 89,127,  126,180,  165,231,  217,263,  205,335,  272,339,  269,427,  355,467,  454,594`.\r\n\r\n2- In train.py:\r\n\r\n    batch-size=16\r\n    epochs=200\r\n    img-size= [288, 960]\r\n    freeze-layers=False\r\n    single-cls=False\r\n    multi-scale=True\r\n\r\nand these are the Hyperparameters:\r\n\r\n       hyp = {'giou': 3.54,  # giou loss gain\r\n       'cls': 37.4,  # cls loss gain\r\n       'cls_pw': 1.0,  # cls BCELoss positive_weight\r\n       'obj': 64.3,  # obj loss gain (*=img_size/320 if img_size != 320)\r\n       'obj_pw': 1.0,  # obj BCELoss positive_weight\r\n       'iou_t': 0.20,  # iou training threshold\r\n       'lr0': 0.001,  # initial learning rate (SGD=5E-3, Adam=5E-4)`\r\n       'lrf': 0.0005,  # final learning rate (with cos scheduler)\r\n       'momentum': 0.937,  # SGD momentum\r\n       'weight_decay': 0.0005,  # optimizer weight decay\r\n       'fl_gamma': 0.0,  # focal loss gamma (efficientDet default is gamma=1.5)\r\n       'hsv_h': 0.0138,  # image HSV-Hue augmentation (fraction)\r\n       'hsv_s': 0.678,  # image HSV-Saturation augmentation (fraction)\r\n       'hsv_v': 0.36,  # image HSV-Value augmentation (fraction)\r\n       'degrees': 1.98 * 0,  # image rotation (+/- deg)\r\n       'translate': 0.05 * 0,  # image translation (+/- fraction)\r\n       'scale': 0.05 * 0,  # image scale (+/- gain)\r\n       'shear': 0.641 * 0}  # image shear (+/- deg)\r\n\r\n3- hands.names\r\n\r\n    punch\r\n    one\r\n    two\r\n    three_up\r\n    four\r\n    palm\r\n    OK\r\n    thumb_up\r\n    thumb_down\r\n    pinky\r\n    three_bottom\r\n    call_me\r\n\r\n\r\n4- detect.py\r\n    classify = False in https://github.com/ultralytics/yolov3/blob/8241bf67bb0cc1c11634bdb4cc76e06ac072192b/detect.py#L30\r\n\r\nI train the yolo successfully.\r\n\r\nThe stats for first epoch:\r\n\r\n     Epoch   gpu_mem      GIoU       obj       cls     total   targets  img_size\r\n     1/399    0.627G      1.46      1.07   0.00267      2.54        15       512: 100%|█████████| 476/476 [00:38<00:00, 12.52it/s]\r\n               Class    Images   Targets         P         R   mAP@0.5        F1: 100%|█████████| 119/119 [00:12<00:00,  9.51it/s]\r\n                 all   1.9e+03   1.9e+03     0.641      0.97     0.956     0.772\r\n\r\n\r\nThe stats for last epoch:\r\n\r\n    Epoch   gpu_mem      GIoU       obj       cls     total   targets  img_size\r\n    399/399  6G     0.419      0.18  1.11e-07       0.6        15       384: 100%|█████████| 476/476 [00:36<00:00, 12.97it/s]\r\n               Class    Images   Targets         P         R   mAP@0.5        F1: 100%|█████████| 119/119 [00:11<00:00, 10.12it/s]\r\n                 all   1.9e+03   1.9e+03      0.94     0.983      0.99     0.961\r\n\r\nQuestion:\r\n\r\n1 - **I always get `0` for `cls` in this part of code. why?**\r\n\r\nhttps://github.com/ultralytics/yolov3/blob/8241bf67bb0cc1c11634bdb4cc76e06ac072192b/detect.py#L124\r\n\r\n**Is it because classifier is weak or it's a simple problem with code?**\r\n\r\n2- And also the results with yolo-tiny in inference in `detect.py` shows multiple bboxes for a detection like this image:\r\n\r\n![2](https://user-images.githubusercontent.com/21217928/87416381-df21be00-c5e3-11ea-8719-03ae3d5c3008.png)\r\n![1](https://user-images.githubusercontent.com/21217928/87416397-e3e67200-c5e3-11ea-8648-ce375abc537f.png)\r\n\r\nAs you can see the image contains a hand but none of images belong to a punch class.\r\n\r\nIs this caused by **`anchors` parameters?**\r\n\r\nif so, can you help me refine the parameters to do a better training?\r\nhow can I solve these issues?\r\n\r\n\r\n\r\n\r\n\r\n","closed_by":{"login":"masouduut94","id":21217928,"node_id":"MDQ6VXNlcjIxMjE3OTI4","avatar_url":"https://avatars.githubusercontent.com/u/21217928?v=4","gravatar_id":"","url":"https://api.github.com/users/masouduut94","html_url":"https://github.com/masouduut94","followers_url":"https://api.github.com/users/masouduut94/followers","following_url":"https://api.github.com/users/masouduut94/following{/other_user}","gists_url":"https://api.github.com/users/masouduut94/gists{/gist_id}","starred_url":"https://api.github.com/users/masouduut94/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/masouduut94/subscriptions","organizations_url":"https://api.github.com/users/masouduut94/orgs","repos_url":"https://api.github.com/users/masouduut94/repos","events_url":"https://api.github.com/users/masouduut94/events{/privacy}","received_events_url":"https://api.github.com/users/masouduut94/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/1387/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ultralytics/yolov3/issues/1387/timeline","performed_via_github_app":null,"state_reason":"completed"}