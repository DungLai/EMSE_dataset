{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/750","repository_url":"https://api.github.com/repos/ultralytics/yolov3","labels_url":"https://api.github.com/repos/ultralytics/yolov3/issues/750/labels{/name}","comments_url":"https://api.github.com/repos/ultralytics/yolov3/issues/750/comments","events_url":"https://api.github.com/repos/ultralytics/yolov3/issues/750/events","html_url":"https://github.com/ultralytics/yolov3/issues/750","id":543837923,"node_id":"MDU6SXNzdWU1NDM4Mzc5MjM=","number":750,"title":"Question concerning exporting to ONNX","user":{"login":"gillmac13","id":46053569,"node_id":"MDQ6VXNlcjQ2MDUzNTY5","avatar_url":"https://avatars.githubusercontent.com/u/46053569?v=4","gravatar_id":"","url":"https://api.github.com/users/gillmac13","html_url":"https://github.com/gillmac13","followers_url":"https://api.github.com/users/gillmac13/followers","following_url":"https://api.github.com/users/gillmac13/following{/other_user}","gists_url":"https://api.github.com/users/gillmac13/gists{/gist_id}","starred_url":"https://api.github.com/users/gillmac13/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gillmac13/subscriptions","organizations_url":"https://api.github.com/users/gillmac13/orgs","repos_url":"https://api.github.com/users/gillmac13/repos","events_url":"https://api.github.com/users/gillmac13/events{/privacy}","received_events_url":"https://api.github.com/users/gillmac13/received_events","type":"User","site_admin":false},"labels":[{"id":1035696370,"node_id":"MDU6TGFiZWwxMDM1Njk2Mzcw","url":"https://api.github.com/repos/ultralytics/yolov3/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-12-30T10:56:27Z","updated_at":"2020-01-16T19:20:36Z","closed_at":"2020-01-16T19:20:36Z","author_association":"NONE","active_lock_reason":null,"body":"@glenn-jocher \r\n\r\nI have been using your repo time and again with excellent results for 1-class detection with yolov3-spp. I am now working on different ways to deploy some models which need a .onnx format.\r\nHowever, when applying the suggested conversion method to the letter, I get an unexpected output ...\r\n\r\nFor example, if I download a yolov3-spp.weights model (80 classes) from [ https://pjreddie.com/darknet/yolo/ ](url), and:\r\n- change to ONNX_EXPORT = True in models.py\r\n- run the command: python3 detect.py --cfg cfg/yolov3-spp.cfg --weights weights/yolov3-spp.weights\r\n\r\nI get an export.onnx file in return with no warning or error.\r\nNow if I inspect this export.onnx with netron, I find that the output of the model is 2 tensors, 1 of shape 10647x80 and 1 of shape 10647x1. I was under the impression that an 80-class model would produce 85 columns, not 84.\r\n\r\nUsing the code snippet:\r\n`model_onnx = onnxruntime.InferenceSession(\"weights/export.onnx\") \r\nort_inputs = {model_onnx.get_inputs()[0].name: img_t.numpy()}   \r\nort_outs = model_onnx.run(None, ort_inputs) \r\nx_out = ort_outs[0] \r\nprint(x_out.shape)`\r\n\r\nconfirms what I get in terms of output format. \r\nAnd applying this procedure to my 1-class models, I get 4+1 columns instead of the expected 6, such as in the \"pred\" variable in \"detect.py\".\r\n\r\nMy questions are simple: is what I get in terms of output normal, in which case how should I interpret the results, or is something wrong?\r\n\r\n\r\n","closed_by":{"login":"glenn-jocher","id":26833433,"node_id":"MDQ6VXNlcjI2ODMzNDMz","avatar_url":"https://avatars.githubusercontent.com/u/26833433?v=4","gravatar_id":"","url":"https://api.github.com/users/glenn-jocher","html_url":"https://github.com/glenn-jocher","followers_url":"https://api.github.com/users/glenn-jocher/followers","following_url":"https://api.github.com/users/glenn-jocher/following{/other_user}","gists_url":"https://api.github.com/users/glenn-jocher/gists{/gist_id}","starred_url":"https://api.github.com/users/glenn-jocher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glenn-jocher/subscriptions","organizations_url":"https://api.github.com/users/glenn-jocher/orgs","repos_url":"https://api.github.com/users/glenn-jocher/repos","events_url":"https://api.github.com/users/glenn-jocher/events{/privacy}","received_events_url":"https://api.github.com/users/glenn-jocher/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ultralytics/yolov3/issues/750/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ultralytics/yolov3/issues/750/timeline","performed_via_github_app":null,"state_reason":"completed"}