[{"url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/comments/581278096","html_url":"https://github.com/mseitzer/pytorch-fid/issues/26#issuecomment-581278096","issue_url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/26","id":581278096,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MTI3ODA5Ng==","user":{"login":"mseitzer","id":16725193,"node_id":"MDQ6VXNlcjE2NzI1MTkz","avatar_url":"https://avatars.githubusercontent.com/u/16725193?v=4","gravatar_id":"","url":"https://api.github.com/users/mseitzer","html_url":"https://github.com/mseitzer","followers_url":"https://api.github.com/users/mseitzer/followers","following_url":"https://api.github.com/users/mseitzer/following{/other_user}","gists_url":"https://api.github.com/users/mseitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/mseitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mseitzer/subscriptions","organizations_url":"https://api.github.com/users/mseitzer/orgs","repos_url":"https://api.github.com/users/mseitzer/repos","events_url":"https://api.github.com/users/mseitzer/events{/privacy}","received_events_url":"https://api.github.com/users/mseitzer/received_events","type":"User","site_admin":false},"created_at":"2020-02-03T07:39:25Z","updated_at":"2020-02-03T07:39:25Z","author_association":"OWNER","body":"It might be the case that the list of images in both cases is not ordered in the same way, thus giving slight differences when computing feature mean and covariance.\r\n\r\nYou can try to insert a `sorted(...)` at this line to avoid this problem:\r\nhttps://github.com/mseitzer/pytorch-fid/blob/f9cdfd32af6bbb3ed0a484746b401f085457d9a8/fid_score.py#L219\r\n\r\nAnother possibility is that certain Pytorch functions are non-deterministic on the GPU (see https://pytorch.org/docs/stable/notes/randomness.html#pytorch) and this can obviously impact results. Were you running on GPU? You can try running on CPU instead.\r\n\r\nAlternatively, you can insert the following lines somewhere and try again on GPU (although this does not remove all sources of non-determinism as far as I understood):\r\n```\r\ntorch.backends.cudnn.deterministic = True\r\ntorch.backends.cudnn.benchmark = False\r\n```\r\n\r\nIf would be very interested to hear if my proposed changes result in different numbers. I could then make the appropriate changes to the code.","reactions":{"url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/comments/581278096/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mseitzer","id":16725193,"node_id":"MDQ6VXNlcjE2NzI1MTkz","avatar_url":"https://avatars.githubusercontent.com/u/16725193?v=4","gravatar_id":"","url":"https://api.github.com/users/mseitzer","html_url":"https://github.com/mseitzer","followers_url":"https://api.github.com/users/mseitzer/followers","following_url":"https://api.github.com/users/mseitzer/following{/other_user}","gists_url":"https://api.github.com/users/mseitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/mseitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mseitzer/subscriptions","organizations_url":"https://api.github.com/users/mseitzer/orgs","repos_url":"https://api.github.com/users/mseitzer/repos","events_url":"https://api.github.com/users/mseitzer/events{/privacy}","received_events_url":"https://api.github.com/users/mseitzer/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/comments/581389842","html_url":"https://github.com/mseitzer/pytorch-fid/issues/26#issuecomment-581389842","issue_url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/26","id":581389842,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MTM4OTg0Mg==","user":{"login":"ogencoglu","id":8182738,"node_id":"MDQ6VXNlcjgxODI3Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/8182738?v=4","gravatar_id":"","url":"https://api.github.com/users/ogencoglu","html_url":"https://github.com/ogencoglu","followers_url":"https://api.github.com/users/ogencoglu/followers","following_url":"https://api.github.com/users/ogencoglu/following{/other_user}","gists_url":"https://api.github.com/users/ogencoglu/gists{/gist_id}","starred_url":"https://api.github.com/users/ogencoglu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ogencoglu/subscriptions","organizations_url":"https://api.github.com/users/ogencoglu/orgs","repos_url":"https://api.github.com/users/ogencoglu/repos","events_url":"https://api.github.com/users/ogencoglu/events{/privacy}","received_events_url":"https://api.github.com/users/ogencoglu/received_events","type":"User","site_admin":false},"created_at":"2020-02-03T12:23:48Z","updated_at":"2020-02-03T12:23:48Z","author_association":"NONE","body":"Yes, I am using GPU. \r\n\r\nPyTorch and other frameworks are non-deterministic during _train time_, they can also act non-deterministic on inference time _for different environments/GPUs_ but it does not make sense that a model is non-deterministic during **inference time on the same environment**. This is the situation here.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/comments/581389842/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ogencoglu","id":8182738,"node_id":"MDQ6VXNlcjgxODI3Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/8182738?v=4","gravatar_id":"","url":"https://api.github.com/users/ogencoglu","html_url":"https://github.com/ogencoglu","followers_url":"https://api.github.com/users/ogencoglu/followers","following_url":"https://api.github.com/users/ogencoglu/following{/other_user}","gists_url":"https://api.github.com/users/ogencoglu/gists{/gist_id}","starred_url":"https://api.github.com/users/ogencoglu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ogencoglu/subscriptions","organizations_url":"https://api.github.com/users/ogencoglu/orgs","repos_url":"https://api.github.com/users/ogencoglu/repos","events_url":"https://api.github.com/users/ogencoglu/events{/privacy}","received_events_url":"https://api.github.com/users/ogencoglu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/comments/581403440","html_url":"https://github.com/mseitzer/pytorch-fid/issues/26#issuecomment-581403440","issue_url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/26","id":581403440,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MTQwMzQ0MA==","user":{"login":"mseitzer","id":16725193,"node_id":"MDQ6VXNlcjE2NzI1MTkz","avatar_url":"https://avatars.githubusercontent.com/u/16725193?v=4","gravatar_id":"","url":"https://api.github.com/users/mseitzer","html_url":"https://github.com/mseitzer","followers_url":"https://api.github.com/users/mseitzer/followers","following_url":"https://api.github.com/users/mseitzer/following{/other_user}","gists_url":"https://api.github.com/users/mseitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/mseitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mseitzer/subscriptions","organizations_url":"https://api.github.com/users/mseitzer/orgs","repos_url":"https://api.github.com/users/mseitzer/repos","events_url":"https://api.github.com/users/mseitzer/events{/privacy}","received_events_url":"https://api.github.com/users/mseitzer/received_events","type":"User","site_admin":false},"created_at":"2020-02-03T13:03:08Z","updated_at":"2020-02-03T13:03:08Z","author_association":"OWNER","body":"Do you have a reference for CUDA/cuDNN behaving different between training and inference? If some operations are implemented in a non-deterministic way (this is the case), and those operations are used during inference, surely inference can be non-deterministic too.","reactions":{"url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/comments/581403440/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mseitzer","id":16725193,"node_id":"MDQ6VXNlcjE2NzI1MTkz","avatar_url":"https://avatars.githubusercontent.com/u/16725193?v=4","gravatar_id":"","url":"https://api.github.com/users/mseitzer","html_url":"https://github.com/mseitzer","followers_url":"https://api.github.com/users/mseitzer/followers","following_url":"https://api.github.com/users/mseitzer/following{/other_user}","gists_url":"https://api.github.com/users/mseitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/mseitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mseitzer/subscriptions","organizations_url":"https://api.github.com/users/mseitzer/orgs","repos_url":"https://api.github.com/users/mseitzer/repos","events_url":"https://api.github.com/users/mseitzer/events{/privacy}","received_events_url":"https://api.github.com/users/mseitzer/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/comments/581465578","html_url":"https://github.com/mseitzer/pytorch-fid/issues/26#issuecomment-581465578","issue_url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/26","id":581465578,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MTQ2NTU3OA==","user":{"login":"ogencoglu","id":8182738,"node_id":"MDQ6VXNlcjgxODI3Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/8182738?v=4","gravatar_id":"","url":"https://api.github.com/users/ogencoglu","html_url":"https://github.com/ogencoglu","followers_url":"https://api.github.com/users/ogencoglu/followers","following_url":"https://api.github.com/users/ogencoglu/following{/other_user}","gists_url":"https://api.github.com/users/ogencoglu/gists{/gist_id}","starred_url":"https://api.github.com/users/ogencoglu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ogencoglu/subscriptions","organizations_url":"https://api.github.com/users/ogencoglu/orgs","repos_url":"https://api.github.com/users/ogencoglu/repos","events_url":"https://api.github.com/users/ogencoglu/events{/privacy}","received_events_url":"https://api.github.com/users/ogencoglu/received_events","type":"User","site_admin":false},"created_at":"2020-02-03T15:22:02Z","updated_at":"2020-02-03T15:22:31Z","author_association":"NONE","body":"Inception is a basic CNN and inference is just bunch of matrix multiplication. No test-time dropout, no nothing. There is nothing non-deterministic about it. \r\n\r\nCUDA giving slightly different inference/training results across different hardware architectures is due to floating point calculations etc., not because convolution operation is non-deterministic. That's why same device/environment should give the same result in this project. ","reactions":{"url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/comments/581465578/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ogencoglu","id":8182738,"node_id":"MDQ6VXNlcjgxODI3Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/8182738?v=4","gravatar_id":"","url":"https://api.github.com/users/ogencoglu","html_url":"https://github.com/ogencoglu","followers_url":"https://api.github.com/users/ogencoglu/followers","following_url":"https://api.github.com/users/ogencoglu/following{/other_user}","gists_url":"https://api.github.com/users/ogencoglu/gists{/gist_id}","starred_url":"https://api.github.com/users/ogencoglu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ogencoglu/subscriptions","organizations_url":"https://api.github.com/users/ogencoglu/orgs","repos_url":"https://api.github.com/users/ogencoglu/repos","events_url":"https://api.github.com/users/ogencoglu/events{/privacy}","received_events_url":"https://api.github.com/users/ogencoglu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/comments/581470071","html_url":"https://github.com/mseitzer/pytorch-fid/issues/26#issuecomment-581470071","issue_url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/26","id":581470071,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MTQ3MDA3MQ==","user":{"login":"mseitzer","id":16725193,"node_id":"MDQ6VXNlcjE2NzI1MTkz","avatar_url":"https://avatars.githubusercontent.com/u/16725193?v=4","gravatar_id":"","url":"https://api.github.com/users/mseitzer","html_url":"https://github.com/mseitzer","followers_url":"https://api.github.com/users/mseitzer/followers","following_url":"https://api.github.com/users/mseitzer/following{/other_user}","gists_url":"https://api.github.com/users/mseitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/mseitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mseitzer/subscriptions","organizations_url":"https://api.github.com/users/mseitzer/orgs","repos_url":"https://api.github.com/users/mseitzer/repos","events_url":"https://api.github.com/users/mseitzer/events{/privacy}","received_events_url":"https://api.github.com/users/mseitzer/received_events","type":"User","site_admin":false},"created_at":"2020-02-03T15:31:37Z","updated_at":"2020-02-03T15:31:37Z","author_association":"OWNER","body":"Okay, now I see where you are coming from, but I think you may not have the full picture here. The way some operations are implemented in CUDA may involve non-determinism to improve performance, *even if the operations mathematically do not involve randomness* (see https://pytorch.org/docs/stable/notes/randomness.html#pytorch)\r\n\r\nIndeed, this even affects convolution, see the note in the documentation:\r\nhttps://pytorch.org/docs/stable/nn.html#torch.nn.Conv2d\r\n\r\nYou can disable this behavior by setting\r\n```\r\ntorch.backends.cudnn.deterministic = True\r\ntorch.backends.cudnn.benchmark = False\r\n```","reactions":{"url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/comments/581470071/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mseitzer","id":16725193,"node_id":"MDQ6VXNlcjE2NzI1MTkz","avatar_url":"https://avatars.githubusercontent.com/u/16725193?v=4","gravatar_id":"","url":"https://api.github.com/users/mseitzer","html_url":"https://github.com/mseitzer","followers_url":"https://api.github.com/users/mseitzer/followers","following_url":"https://api.github.com/users/mseitzer/following{/other_user}","gists_url":"https://api.github.com/users/mseitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/mseitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mseitzer/subscriptions","organizations_url":"https://api.github.com/users/mseitzer/orgs","repos_url":"https://api.github.com/users/mseitzer/repos","events_url":"https://api.github.com/users/mseitzer/events{/privacy}","received_events_url":"https://api.github.com/users/mseitzer/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/comments/581486700","html_url":"https://github.com/mseitzer/pytorch-fid/issues/26#issuecomment-581486700","issue_url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/26","id":581486700,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MTQ4NjcwMA==","user":{"login":"ogencoglu","id":8182738,"node_id":"MDQ6VXNlcjgxODI3Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/8182738?v=4","gravatar_id":"","url":"https://api.github.com/users/ogencoglu","html_url":"https://github.com/ogencoglu","followers_url":"https://api.github.com/users/ogencoglu/followers","following_url":"https://api.github.com/users/ogencoglu/following{/other_user}","gists_url":"https://api.github.com/users/ogencoglu/gists{/gist_id}","starred_url":"https://api.github.com/users/ogencoglu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ogencoglu/subscriptions","organizations_url":"https://api.github.com/users/ogencoglu/orgs","repos_url":"https://api.github.com/users/ogencoglu/repos","events_url":"https://api.github.com/users/ogencoglu/events{/privacy}","received_events_url":"https://api.github.com/users/ogencoglu/received_events","type":"User","site_admin":false},"created_at":"2020-02-03T16:04:37Z","updated_at":"2020-02-03T16:04:37Z","author_association":"NONE","body":"Really interesting. Thanks.\r\n\r\nAfter setting PyTorch determinism to `True` and sorting the lists, I am getting the _same_ result over and over now. It is still a small, non-zero number though. So I believe this is simply a numerical approximation error on the scipy/numpy side.\r\n\r\nYou can close this now.","reactions":{"url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/comments/581486700/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ogencoglu","id":8182738,"node_id":"MDQ6VXNlcjgxODI3Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/8182738?v=4","gravatar_id":"","url":"https://api.github.com/users/ogencoglu","html_url":"https://github.com/ogencoglu","followers_url":"https://api.github.com/users/ogencoglu/followers","following_url":"https://api.github.com/users/ogencoglu/following{/other_user}","gists_url":"https://api.github.com/users/ogencoglu/gists{/gist_id}","starred_url":"https://api.github.com/users/ogencoglu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ogencoglu/subscriptions","organizations_url":"https://api.github.com/users/ogencoglu/orgs","repos_url":"https://api.github.com/users/ogencoglu/repos","events_url":"https://api.github.com/users/ogencoglu/events{/privacy}","received_events_url":"https://api.github.com/users/ogencoglu/received_events","type":"User","site_admin":false}},{"id":3003065621,"node_id":"MDExOkNsb3NlZEV2ZW50MzAwMzA2NTYyMQ==","url":"https://api.github.com/repos/mseitzer/pytorch-fid/issues/events/3003065621","actor":{"login":"mseitzer","id":16725193,"node_id":"MDQ6VXNlcjE2NzI1MTkz","avatar_url":"https://avatars.githubusercontent.com/u/16725193?v=4","gravatar_id":"","url":"https://api.github.com/users/mseitzer","html_url":"https://github.com/mseitzer","followers_url":"https://api.github.com/users/mseitzer/followers","following_url":"https://api.github.com/users/mseitzer/following{/other_user}","gists_url":"https://api.github.com/users/mseitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/mseitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mseitzer/subscriptions","organizations_url":"https://api.github.com/users/mseitzer/orgs","repos_url":"https://api.github.com/users/mseitzer/repos","events_url":"https://api.github.com/users/mseitzer/events{/privacy}","received_events_url":"https://api.github.com/users/mseitzer/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-02-03T17:14:04Z","state_reason":null,"performed_via_github_app":null}]