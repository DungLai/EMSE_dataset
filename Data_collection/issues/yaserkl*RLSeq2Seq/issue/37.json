{"url":"https://api.github.com/repos/yaserkl/RLSeq2Seq/issues/37","repository_url":"https://api.github.com/repos/yaserkl/RLSeq2Seq","labels_url":"https://api.github.com/repos/yaserkl/RLSeq2Seq/issues/37/labels{/name}","comments_url":"https://api.github.com/repos/yaserkl/RLSeq2Seq/issues/37/comments","events_url":"https://api.github.com/repos/yaserkl/RLSeq2Seq/issues/37/events","html_url":"https://github.com/yaserkl/RLSeq2Seq/issues/37","id":558782357,"node_id":"MDU6SXNzdWU1NTg3ODIzNTc=","number":37,"title":"Error when decoding","user":{"login":"theago-ls","id":42914577,"node_id":"MDQ6VXNlcjQyOTE0NTc3","avatar_url":"https://avatars.githubusercontent.com/u/42914577?v=4","gravatar_id":"","url":"https://api.github.com/users/theago-ls","html_url":"https://github.com/theago-ls","followers_url":"https://api.github.com/users/theago-ls/followers","following_url":"https://api.github.com/users/theago-ls/following{/other_user}","gists_url":"https://api.github.com/users/theago-ls/gists{/gist_id}","starred_url":"https://api.github.com/users/theago-ls/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theago-ls/subscriptions","organizations_url":"https://api.github.com/users/theago-ls/orgs","repos_url":"https://api.github.com/users/theago-ls/repos","events_url":"https://api.github.com/users/theago-ls/events{/privacy}","received_events_url":"https://api.github.com/users/theago-ls/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-02-03T00:18:23Z","updated_at":"2020-03-02T00:13:44Z","closed_at":"2020-03-02T00:13:44Z","author_association":"NONE","active_lock_reason":null,"body":"When I'm execute this command: \r\n\r\n`CUDA_VISIBLE_DEVICES=0 python src/run_summarization.py --mode=decode --data_path=$HOME/data/cnn_dm/finished_files/chunked/test_* --vocab_path=$HOME/data/cnn_dm/finished_files/vocab --log_root=$HOME/working_dir/cnn_dm/RLSeq2Seq/ --exp_name=intradecoder-temporalattention-withpretraining --rl_training=True --intradecoder=True --use_temporal_attention=True --single_pass=1 --beam_size=4 --decode_after=0`\r\n\r\nI'm getting this error:\r\n\r\nTraceback (most recent call last):\r\n  File \"src/run_summarization.py\", line 795, in <module>\r\n    tf.app.run()\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 125, in run\r\n    _sys.exit(main(argv))\r\n  File \"src/run_summarization.py\", line 792, in main\r\n    seq2seq.main(unused_argv)\r\n  File \"src/run_summarization.py\", line 762, in main\r\n    decoder.decode() # decode indefinitely (unless single_pass=True, in which case deocde the dataset exactly once)\r\n  File \"/content/drive/My Drive/Colab Notebooks/Artigo-5/RLSeq2Seq-master/src/decode.py\", line 109, in decode\r\n    best_hyp = beam_search.run_beam_search(self._sess, self._model, self._vocab, batch)\r\n  File \"/content/drive/My Drive/Colab Notebooks/Artigo-5/RLSeq2Seq-master/src/beam_search.py\", line 143, in run_beam_search\r\n    prev_encoder_es = encoder_es if FLAGS.use_temporal_attention else tf.stack([], axis=0))\r\n  File \"/content/drive/My Drive/Colab Notebooks/Artigo-5/RLSeq2Seq-master/src/model.py\", line 855, in decode_onestep\r\n    results = sess.run(to_return, feed_dict=feed) # run the decoder step\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 877, in run\r\n    run_metadata_ptr)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1100, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1272, in _do_run\r\n    run_metadata)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1291, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Incompatible shapes: [5,10,1,1] vs. [5,2,1,400]\r\n\t [[Node: seq2seq/decoder/attention_decoder/attention_decoder/DecoderAttention/mul_1 = Mul[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](seq2seq/decoder/attention_decoder/attention_decoder/DecoderAttention/Reshape_3, seq2seq/decoder/attention_decoder/attention_decoder/ExpandDims)]]\r\n\r\nCaused by op u'seq2seq/decoder/attention_decoder/attention_decoder/DecoderAttention/mul_1', defined at:\r\n  File \"src/run_summarization.py\", line 795, in <module>\r\n    tf.app.run()\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 125, in run\r\n    _sys.exit(main(argv))\r\n  File \"src/run_summarization.py\", line 792, in main\r\n    seq2seq.main(unused_argv)\r\n  File \"src/run_summarization.py\", line 761, in main\r\n    decoder = BeamSearchDecoder(model, self.batcher, self.vocab, dqn = dqn_target)\r\n  File \"/content/drive/My Drive/Colab Notebooks/Artigo-5/RLSeq2Seq-master/src/decode.py\", line 47, in __init__\r\n    self._model.build_graph()\r\n  File \"/content/drive/My Drive/Colab Notebooks/Artigo-5/RLSeq2Seq-master/src/model.py\", line 463, in build_graph\r\n    self._add_seq2seq()\r\n  File \"/content/drive/My Drive/Colab Notebooks/Artigo-5/RLSeq2Seq-master/src/model.py\", line 274, in _add_seq2seq\r\n    self.sampling_rewards, self.greedy_rewards) = self._add_decoder(emb_dec_inputs, embedding)\r\n  File \"/content/drive/My Drive/Colab Notebooks/Artigo-5/RLSeq2Seq-master/src/model.py\", line 207, in _add_decoder\r\n    prev_encoder_es = prev_encoder_es)\r\n  File \"/content/drive/My Drive/Colab Notebooks/Artigo-5/RLSeq2Seq-master/src/attention_decoder.py\", line 350, in attention_decoder\r\n    context_decoder_vector, _ = intra_decoder_attention(state, tf.stack(prev_decoder_outputs,axis=0))\r\n  File \"/content/drive/My Drive/Colab Notebooks/Artigo-5/RLSeq2Seq-master/src/attention_decoder.py\", line 297, in intra_decoder_attention\r\n    context_decoder_vector = math_ops.reduce_sum(array_ops.reshape(decoder_attn_dist, [batch_size, -1, 1, 1]) * _decoder_states, [1, 2]) # (batch_size, attn_size)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/math_ops.py\", line 850, in binary_op_wrapper\r\n    return func(x, y, name=name)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/math_ops.py\", line 1094, in _mul_dispatch\r\n    return gen_math_ops.mul(x, y, name=name)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_math_ops.py\", line 4936, in mul\r\n    \"Mul\", x=x, y=y, name=name)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/util/deprecation.py\", line 454, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 3155, in create_op\r\n    op_def=op_def)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1717, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\nInvalidArgumentError (see above for traceback): Incompatible shapes: [5,10,1,1] vs. [5,2,1,400]\r\n\t [[Node: seq2seq/decoder/attention_decoder/attention_decoder/DecoderAttention/mul_1 = Mul[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](seq2seq/decoder/attention_decoder/attention_decoder/DecoderAttention/Reshape_3, seq2seq/decoder/attention_decoder/attention_decoder/ExpandDims)]]\r\n\r\nCan you help me, please?","closed_by":{"login":"theago-ls","id":42914577,"node_id":"MDQ6VXNlcjQyOTE0NTc3","avatar_url":"https://avatars.githubusercontent.com/u/42914577?v=4","gravatar_id":"","url":"https://api.github.com/users/theago-ls","html_url":"https://github.com/theago-ls","followers_url":"https://api.github.com/users/theago-ls/followers","following_url":"https://api.github.com/users/theago-ls/following{/other_user}","gists_url":"https://api.github.com/users/theago-ls/gists{/gist_id}","starred_url":"https://api.github.com/users/theago-ls/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theago-ls/subscriptions","organizations_url":"https://api.github.com/users/theago-ls/orgs","repos_url":"https://api.github.com/users/theago-ls/repos","events_url":"https://api.github.com/users/theago-ls/events{/privacy}","received_events_url":"https://api.github.com/users/theago-ls/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yaserkl/RLSeq2Seq/issues/37/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yaserkl/RLSeq2Seq/issues/37/timeline","performed_via_github_app":null,"state_reason":"completed"}