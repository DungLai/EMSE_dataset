[{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/comments/841560337","html_url":"https://github.com/BindsNET/bindsnet/issues/487#issuecomment-841560337","issue_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/487","id":841560337,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MTU2MDMzNw==","user":{"login":"Hananel-Hazan","id":3954715,"node_id":"MDQ6VXNlcjM5NTQ3MTU=","avatar_url":"https://avatars.githubusercontent.com/u/3954715?v=4","gravatar_id":"","url":"https://api.github.com/users/Hananel-Hazan","html_url":"https://github.com/Hananel-Hazan","followers_url":"https://api.github.com/users/Hananel-Hazan/followers","following_url":"https://api.github.com/users/Hananel-Hazan/following{/other_user}","gists_url":"https://api.github.com/users/Hananel-Hazan/gists{/gist_id}","starred_url":"https://api.github.com/users/Hananel-Hazan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hananel-Hazan/subscriptions","organizations_url":"https://api.github.com/users/Hananel-Hazan/orgs","repos_url":"https://api.github.com/users/Hananel-Hazan/repos","events_url":"https://api.github.com/users/Hananel-Hazan/events{/privacy}","received_events_url":"https://api.github.com/users/Hananel-Hazan/received_events","type":"User","site_admin":false},"created_at":"2021-05-14T23:57:41Z","updated_at":"2021-05-14T23:57:41Z","author_association":"COLLABORATOR","body":"Thank you for using BindsNET. \r\nCool project!\r\n\r\nIts seems you are correct , the Conv2d dimension is not correct . \r\nPlease take a look on the documentation and the examples in particular [batch](https://github.com/BindsNET/bindsnet/blob/master/examples/mnist/batch_eth_mnist.py) and on the [convolution example](https://github.com/BindsNET/bindsnet/blob/master/examples/mnist/conv_mnist.py) lines 80 to 90 on how to calculate the right size of the layer. ","reactions":{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/comments/841560337/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Hananel-Hazan","id":3954715,"node_id":"MDQ6VXNlcjM5NTQ3MTU=","avatar_url":"https://avatars.githubusercontent.com/u/3954715?v=4","gravatar_id":"","url":"https://api.github.com/users/Hananel-Hazan","html_url":"https://github.com/Hananel-Hazan","followers_url":"https://api.github.com/users/Hananel-Hazan/followers","following_url":"https://api.github.com/users/Hananel-Hazan/following{/other_user}","gists_url":"https://api.github.com/users/Hananel-Hazan/gists{/gist_id}","starred_url":"https://api.github.com/users/Hananel-Hazan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hananel-Hazan/subscriptions","organizations_url":"https://api.github.com/users/Hananel-Hazan/orgs","repos_url":"https://api.github.com/users/Hananel-Hazan/repos","events_url":"https://api.github.com/users/Hananel-Hazan/events{/privacy}","received_events_url":"https://api.github.com/users/Hananel-Hazan/received_events","type":"User","site_admin":false}},{"id":4749330145,"node_id":"MDExOkNsb3NlZEV2ZW50NDc0OTMzMDE0NQ==","url":"https://api.github.com/repos/BindsNET/bindsnet/issues/events/4749330145","actor":{"login":"Hananel-Hazan","id":3954715,"node_id":"MDQ6VXNlcjM5NTQ3MTU=","avatar_url":"https://avatars.githubusercontent.com/u/3954715?v=4","gravatar_id":"","url":"https://api.github.com/users/Hananel-Hazan","html_url":"https://github.com/Hananel-Hazan","followers_url":"https://api.github.com/users/Hananel-Hazan/followers","following_url":"https://api.github.com/users/Hananel-Hazan/following{/other_user}","gists_url":"https://api.github.com/users/Hananel-Hazan/gists{/gist_id}","starred_url":"https://api.github.com/users/Hananel-Hazan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hananel-Hazan/subscriptions","organizations_url":"https://api.github.com/users/Hananel-Hazan/orgs","repos_url":"https://api.github.com/users/Hananel-Hazan/repos","events_url":"https://api.github.com/users/Hananel-Hazan/events{/privacy}","received_events_url":"https://api.github.com/users/Hananel-Hazan/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-05-14T23:57:42Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/comments/841592109","html_url":"https://github.com/BindsNET/bindsnet/issues/487#issuecomment-841592109","issue_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/487","id":841592109,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MTU5MjEwOQ==","user":{"login":"AptX395","id":44229751,"node_id":"MDQ6VXNlcjQ0MjI5NzUx","avatar_url":"https://avatars.githubusercontent.com/u/44229751?v=4","gravatar_id":"","url":"https://api.github.com/users/AptX395","html_url":"https://github.com/AptX395","followers_url":"https://api.github.com/users/AptX395/followers","following_url":"https://api.github.com/users/AptX395/following{/other_user}","gists_url":"https://api.github.com/users/AptX395/gists{/gist_id}","starred_url":"https://api.github.com/users/AptX395/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AptX395/subscriptions","organizations_url":"https://api.github.com/users/AptX395/orgs","repos_url":"https://api.github.com/users/AptX395/repos","events_url":"https://api.github.com/users/AptX395/events{/privacy}","received_events_url":"https://api.github.com/users/AptX395/received_events","type":"User","site_admin":false},"created_at":"2021-05-15T03:29:52Z","updated_at":"2021-05-15T03:29:52Z","author_association":"NONE","body":"> Thank you for using BindsNET.\r\n> Cool project!\r\n> \r\n> Its seems you are correct , the Conv2d dimension is not correct .\r\n> Please take a look on the documentation and the examples in particular [batch](https://github.com/BindsNET/bindsnet/blob/master/examples/mnist/batch_eth_mnist.py) and on the [convolution example](https://github.com/BindsNET/bindsnet/blob/master/examples/mnist/conv_mnist.py) lines 80 to 90 on how to calculate the right size of the layer.\r\n\r\nThanks for your reply!\r\n\r\nI still have my doubts. The code I've shown above for building the network uses parameters calculated in exactly the same way as in the [convolution example](https://github.com/BindsNET/bindsnet/blob/master/examples/mnist/conv_mnist.py) lines 80 to 90.\r\n\r\nSpecifically, it looks like this:\r\n\r\nThe input to the network is a batch of preprocessed images with the shape `(32, 4, 84, 84)`, corresponding to `(batch_size, channel, height, width)`.\r\n\r\nThe formula for the output of the convolutional layer is as follows: (copied from the [convolution example](https://github.com/BindsNET/bindsnet/blob/master/examples/mnist/conv_mnist.py) lines 80 to 90)\r\n\r\n```python\r\nconv_size = int((28 - kernel_size + 2 * padding) / stride) + 1\r\n```\r\n\r\nThe calculation process is as follows:\r\n\r\n```python\r\nconv_size1 = int((84 - 8 + 2 * 0) / 4) + 1    # conv_size1 = 20\r\nconv_size2 = int((20 - 4 + 2 * 0) / 2) + 1    # conv_size2 = 9\r\nconv_size3 = int((9 - 3 + 2 * 0) / 1) + 1      #conv_size3 = 7\r\n```\r\n\r\nSo I set up the network parameters like this:\r\n\r\n```python\r\n# The number of filters in the three convolution layers are 32, 64, 64, respectively.\r\nself._net = Network(self._dt)\r\nself._input = nodes.Input(shape = (history_len, 84, 84))\r\nself._conv_layer1 = nodes.LIFNodes(shape = (32, 20, 20))\r\nself._conv1 = topology.Conv2dConnection(self._input, self._conv_layer1, kernel_size = 8, stride = 4, update_rule = MSTDP, nu = learning_rate, wmin = 0, wmax = 1)\r\nself._conv_layer2 = nodes.LIFNodes(shape = (64, 9, 9))\r\nself._conv2 = topology.Conv2dConnection(self._conv_layer1, self._conv_layer2, kernel_size = 4, stride = 2, update_rule = MSTDP, nu = learning_rate, wmin = 0, wmax = 1)\r\nself._conv_layer3 = nodes.LIFNodes(shape = (64, 7, 7))\r\nself._conv3 = topology.Conv2dConnection(self._conv_layer2, self._conv_layer3, kernel_size = 3, stride = 1, update_rule = MSTDP, nu = learning_rate, wmin = 0, wmax = 1)\r\nself._fc_layer1 = nodes.LIFNodes(n = 512)\r\nself._fc1 = topology.Connection(self._conv_layer3, self._fc_layer1, update_rule = MSTDP, nu = learning_rate, wmin = 0, wmax = 1)\r\nself._fc_layer2 = Non_Firing_LIF_Nodes(n = action_num)\r\nself._fc2 = topology.Connection(self._fc_layer1, self._fc_layer2, update_rule = MSTDP, nu = learning_rate, wmin = 0, wmax = 1)\r\n```\r\n\r\nThe above calculation procedure does not seem to have an error. Could there be other reasons for the RuntimeError?\r\n\r\nThank you for your help!\r\n","reactions":{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/comments/841592109/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"AptX395","id":44229751,"node_id":"MDQ6VXNlcjQ0MjI5NzUx","avatar_url":"https://avatars.githubusercontent.com/u/44229751?v=4","gravatar_id":"","url":"https://api.github.com/users/AptX395","html_url":"https://github.com/AptX395","followers_url":"https://api.github.com/users/AptX395/followers","following_url":"https://api.github.com/users/AptX395/following{/other_user}","gists_url":"https://api.github.com/users/AptX395/gists{/gist_id}","starred_url":"https://api.github.com/users/AptX395/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AptX395/subscriptions","organizations_url":"https://api.github.com/users/AptX395/orgs","repos_url":"https://api.github.com/users/AptX395/repos","events_url":"https://api.github.com/users/AptX395/events{/privacy}","received_events_url":"https://api.github.com/users/AptX395/received_events","type":"User","site_admin":false}},{"actor":{"login":"AptX395","id":44229751,"node_id":"MDQ6VXNlcjQ0MjI5NzUx","avatar_url":"https://avatars.githubusercontent.com/u/44229751?v=4","gravatar_id":"","url":"https://api.github.com/users/AptX395","html_url":"https://github.com/AptX395","followers_url":"https://api.github.com/users/AptX395/followers","following_url":"https://api.github.com/users/AptX395/following{/other_user}","gists_url":"https://api.github.com/users/AptX395/gists{/gist_id}","starred_url":"https://api.github.com/users/AptX395/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AptX395/subscriptions","organizations_url":"https://api.github.com/users/AptX395/orgs","repos_url":"https://api.github.com/users/AptX395/repos","events_url":"https://api.github.com/users/AptX395/events{/privacy}","received_events_url":"https://api.github.com/users/AptX395/received_events","type":"User","site_admin":false},"created_at":"2021-05-17T11:20:35Z","updated_at":"2021-05-17T11:20:35Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/488","repository_url":"https://api.github.com/repos/BindsNET/bindsnet","labels_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/488/labels{/name}","comments_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/488/comments","events_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/488/events","html_url":"https://github.com/BindsNET/bindsnet/issues/488","id":893228150,"node_id":"MDU6SXNzdWU4OTMyMjgxNTA=","number":488,"title":"An error occurred while updating the network with MSTDP learning rule","user":{"login":"AptX395","id":44229751,"node_id":"MDQ6VXNlcjQ0MjI5NzUx","avatar_url":"https://avatars.githubusercontent.com/u/44229751?v=4","gravatar_id":"","url":"https://api.github.com/users/AptX395","html_url":"https://github.com/AptX395","followers_url":"https://api.github.com/users/AptX395/followers","following_url":"https://api.github.com/users/AptX395/following{/other_user}","gists_url":"https://api.github.com/users/AptX395/gists{/gist_id}","starred_url":"https://api.github.com/users/AptX395/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AptX395/subscriptions","organizations_url":"https://api.github.com/users/AptX395/orgs","repos_url":"https://api.github.com/users/AptX395/repos","events_url":"https://api.github.com/users/AptX395/events{/privacy}","received_events_url":"https://api.github.com/users/AptX395/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2021-05-17T11:20:35Z","updated_at":"2021-05-28T20:51:51Z","closed_at":"2021-05-28T20:51:51Z","author_association":"NONE","active_lock_reason":null,"repository":{"id":120948040,"node_id":"MDEwOlJlcG9zaXRvcnkxMjA5NDgwNDA=","name":"bindsnet","full_name":"BindsNET/bindsnet","private":false,"owner":{"login":"BindsNET","id":39340698,"node_id":"MDEyOk9yZ2FuaXphdGlvbjM5MzQwNjk4","avatar_url":"https://avatars.githubusercontent.com/u/39340698?v=4","gravatar_id":"","url":"https://api.github.com/users/BindsNET","html_url":"https://github.com/BindsNET","followers_url":"https://api.github.com/users/BindsNET/followers","following_url":"https://api.github.com/users/BindsNET/following{/other_user}","gists_url":"https://api.github.com/users/BindsNET/gists{/gist_id}","starred_url":"https://api.github.com/users/BindsNET/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BindsNET/subscriptions","organizations_url":"https://api.github.com/users/BindsNET/orgs","repos_url":"https://api.github.com/users/BindsNET/repos","events_url":"https://api.github.com/users/BindsNET/events{/privacy}","received_events_url":"https://api.github.com/users/BindsNET/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/BindsNET/bindsnet","description":"Simulation of spiking neural networks (SNNs) using PyTorch.","fork":false,"url":"https://api.github.com/repos/BindsNET/bindsnet","forks_url":"https://api.github.com/repos/BindsNET/bindsnet/forks","keys_url":"https://api.github.com/repos/BindsNET/bindsnet/keys{/key_id}","collaborators_url":"https://api.github.com/repos/BindsNET/bindsnet/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/BindsNET/bindsnet/teams","hooks_url":"https://api.github.com/repos/BindsNET/bindsnet/hooks","issue_events_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/events{/number}","events_url":"https://api.github.com/repos/BindsNET/bindsnet/events","assignees_url":"https://api.github.com/repos/BindsNET/bindsnet/assignees{/user}","branches_url":"https://api.github.com/repos/BindsNET/bindsnet/branches{/branch}","tags_url":"https://api.github.com/repos/BindsNET/bindsnet/tags","blobs_url":"https://api.github.com/repos/BindsNET/bindsnet/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/BindsNET/bindsnet/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/BindsNET/bindsnet/git/refs{/sha}","trees_url":"https://api.github.com/repos/BindsNET/bindsnet/git/trees{/sha}","statuses_url":"https://api.github.com/repos/BindsNET/bindsnet/statuses/{sha}","languages_url":"https://api.github.com/repos/BindsNET/bindsnet/languages","stargazers_url":"https://api.github.com/repos/BindsNET/bindsnet/stargazers","contributors_url":"https://api.github.com/repos/BindsNET/bindsnet/contributors","subscribers_url":"https://api.github.com/repos/BindsNET/bindsnet/subscribers","subscription_url":"https://api.github.com/repos/BindsNET/bindsnet/subscription","commits_url":"https://api.github.com/repos/BindsNET/bindsnet/commits{/sha}","git_commits_url":"https://api.github.com/repos/BindsNET/bindsnet/git/commits{/sha}","comments_url":"https://api.github.com/repos/BindsNET/bindsnet/comments{/number}","issue_comment_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/comments{/number}","contents_url":"https://api.github.com/repos/BindsNET/bindsnet/contents/{+path}","compare_url":"https://api.github.com/repos/BindsNET/bindsnet/compare/{base}...{head}","merges_url":"https://api.github.com/repos/BindsNET/bindsnet/merges","archive_url":"https://api.github.com/repos/BindsNET/bindsnet/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/BindsNET/bindsnet/downloads","issues_url":"https://api.github.com/repos/BindsNET/bindsnet/issues{/number}","pulls_url":"https://api.github.com/repos/BindsNET/bindsnet/pulls{/number}","milestones_url":"https://api.github.com/repos/BindsNET/bindsnet/milestones{/number}","notifications_url":"https://api.github.com/repos/BindsNET/bindsnet/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/BindsNET/bindsnet/labels{/name}","releases_url":"https://api.github.com/repos/BindsNET/bindsnet/releases{/id}","deployments_url":"https://api.github.com/repos/BindsNET/bindsnet/deployments","created_at":"2018-02-09T19:42:37Z","updated_at":"2023-01-15T22:32:23Z","pushed_at":"2023-01-16T01:03:38Z","git_url":"git://github.com/BindsNET/bindsnet.git","ssh_url":"git@github.com:BindsNET/bindsnet.git","clone_url":"https://github.com/BindsNET/bindsnet.git","svn_url":"https://github.com/BindsNET/bindsnet","homepage":"","size":30518,"stargazers_count":1187,"watchers_count":1187,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":308,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":14,"license":{"key":"agpl-3.0","name":"GNU Affero General Public License v3.0","spdx_id":"AGPL-3.0","url":"https://api.github.com/licenses/agpl-3.0","node_id":"MDc6TGljZW5zZTE="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["dynamic","gpu-computing","machine-learning","neurons","pytorch","reinforcement-learning","simulation","snn","spiking-neural-networks","stdp","synapse"],"visibility":"public","forks":308,"open_issues":14,"watchers":1187,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"I submitted an issue #487 that explained an error I had encountered.\r\n\r\nAfter investigation, I think it is not because the network parameters were set incorrectly. I replied the [specific disgussion](https://github.com/BindsNET/bindsnet/issues/487#issuecomment-841592109) in #487.\r\n\r\nI think this problem may have occurred in the update phase of the network rather than in the forward propagation phase of the network.\r\n\r\nMy code logic is to separate forward propagation from network updates. That is, I set `self._net.train(mode = False)` before calling `self._net.run()` as follows:\r\n\r\n```python\r\nself._net.train(mode = False)\r\nspike = self._encoder(x)    # PoissonEncoder\r\ninput = {\"input\": spike}\r\nself._net.run(input, self._time, one_step = True)\r\n```\r\n\r\nto make the network behave like:\r\n\r\n```python\r\nwith torch.no_grad():\r\n    model.forward(x)\r\n```\r\n\r\nin PyTorch.\r\n\r\n---\r\n\r\nMy code works fine for forward propagation without any errors. But when I update network parameters as follows:\r\n\r\n```python\r\nself._net.train(mode = True)\r\n\r\nfor connection in self._net.connections:\r\n    self._net.connections[connection].update(reward = reward)\r\n```\r\n\r\nI get the error mentioned in #487.\r\n\r\nThe most critical error message is:\r\n\r\n```python\r\n  File \"/usr/local/anaconda3/envs/snn_rl/lib/python3.7/site-packages/bindsnet/learning/learning.py\", line 669, in _conv2d_connection_update\r\n    self.eligibility = self.eligibility.view(self.connection.w.size())\r\nRuntimeError: shape '[32, 4, 8, 8]' is invalid for input of size 262144\r\n```\r\n\r\nWhat is the cause of this error?\r\n\r\nI really appreciate your help!","reactions":{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/488/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/488/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"}]