[{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/comments/835829706","html_url":"https://github.com/BindsNET/bindsnet/issues/485#issuecomment-835829706","issue_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/485","id":835829706,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNTgyOTcwNg==","user":{"login":"Hananel-Hazan","id":3954715,"node_id":"MDQ6VXNlcjM5NTQ3MTU=","avatar_url":"https://avatars.githubusercontent.com/u/3954715?v=4","gravatar_id":"","url":"https://api.github.com/users/Hananel-Hazan","html_url":"https://github.com/Hananel-Hazan","followers_url":"https://api.github.com/users/Hananel-Hazan/followers","following_url":"https://api.github.com/users/Hananel-Hazan/following{/other_user}","gists_url":"https://api.github.com/users/Hananel-Hazan/gists{/gist_id}","starred_url":"https://api.github.com/users/Hananel-Hazan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hananel-Hazan/subscriptions","organizations_url":"https://api.github.com/users/Hananel-Hazan/orgs","repos_url":"https://api.github.com/users/Hananel-Hazan/repos","events_url":"https://api.github.com/users/Hananel-Hazan/events{/privacy}","received_events_url":"https://api.github.com/users/Hananel-Hazan/received_events","type":"User","site_admin":false},"created_at":"2021-05-09T15:34:05Z","updated_at":"2021-05-09T15:34:05Z","author_association":"COLLABORATOR","body":"Hi Nicolas. Welcome to BindsNET. \r\n\r\nWithout sharing your code, I can only guess that your code is fairly straightforward without any other optimizations issue . \r\n\r\nFor 150 neurons there is not supposed to be any benefit for using the GPU. The computational overhead for using GPU is high, but when using more neurons it becomes worth it. \r\n\r\nPlease look at the figure on the BindsNET front page, where you can see that below 500 neurons CPU is faster, but for about 500 the situation reversed and GPU usage becomes faster than CPU. Of course, this is a specific example that we use, and every code uses BindsNET differently so your mileage may vary.\r\n\r\nGood luck","reactions":{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/comments/835829706/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Hananel-Hazan","id":3954715,"node_id":"MDQ6VXNlcjM5NTQ3MTU=","avatar_url":"https://avatars.githubusercontent.com/u/3954715?v=4","gravatar_id":"","url":"https://api.github.com/users/Hananel-Hazan","html_url":"https://github.com/Hananel-Hazan","followers_url":"https://api.github.com/users/Hananel-Hazan/followers","following_url":"https://api.github.com/users/Hananel-Hazan/following{/other_user}","gists_url":"https://api.github.com/users/Hananel-Hazan/gists{/gist_id}","starred_url":"https://api.github.com/users/Hananel-Hazan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hananel-Hazan/subscriptions","organizations_url":"https://api.github.com/users/Hananel-Hazan/orgs","repos_url":"https://api.github.com/users/Hananel-Hazan/repos","events_url":"https://api.github.com/users/Hananel-Hazan/events{/privacy}","received_events_url":"https://api.github.com/users/Hananel-Hazan/received_events","type":"User","site_admin":false}},{"id":4711155358,"node_id":"MDExOkNsb3NlZEV2ZW50NDcxMTE1NTM1OA==","url":"https://api.github.com/repos/BindsNET/bindsnet/issues/events/4711155358","actor":{"login":"Hananel-Hazan","id":3954715,"node_id":"MDQ6VXNlcjM5NTQ3MTU=","avatar_url":"https://avatars.githubusercontent.com/u/3954715?v=4","gravatar_id":"","url":"https://api.github.com/users/Hananel-Hazan","html_url":"https://github.com/Hananel-Hazan","followers_url":"https://api.github.com/users/Hananel-Hazan/followers","following_url":"https://api.github.com/users/Hananel-Hazan/following{/other_user}","gists_url":"https://api.github.com/users/Hananel-Hazan/gists{/gist_id}","starred_url":"https://api.github.com/users/Hananel-Hazan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hananel-Hazan/subscriptions","organizations_url":"https://api.github.com/users/Hananel-Hazan/orgs","repos_url":"https://api.github.com/users/Hananel-Hazan/repos","events_url":"https://api.github.com/users/Hananel-Hazan/events{/privacy}","received_events_url":"https://api.github.com/users/Hananel-Hazan/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-05-09T15:34:05Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/comments/835839969","html_url":"https://github.com/BindsNET/bindsnet/issues/485#issuecomment-835839969","issue_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/485","id":835839969,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNTgzOTk2OQ==","user":{"login":"nico1as","id":10497115,"node_id":"MDQ6VXNlcjEwNDk3MTE1","avatar_url":"https://avatars.githubusercontent.com/u/10497115?v=4","gravatar_id":"","url":"https://api.github.com/users/nico1as","html_url":"https://github.com/nico1as","followers_url":"https://api.github.com/users/nico1as/followers","following_url":"https://api.github.com/users/nico1as/following{/other_user}","gists_url":"https://api.github.com/users/nico1as/gists{/gist_id}","starred_url":"https://api.github.com/users/nico1as/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nico1as/subscriptions","organizations_url":"https://api.github.com/users/nico1as/orgs","repos_url":"https://api.github.com/users/nico1as/repos","events_url":"https://api.github.com/users/nico1as/events{/privacy}","received_events_url":"https://api.github.com/users/nico1as/received_events","type":"User","site_admin":false},"created_at":"2021-05-09T16:34:15Z","updated_at":"2021-05-09T16:34:15Z","author_association":"NONE","body":"Thanks for your quick answer. \r\n\r\nOk for CPU uses under 500, indeed with 150 neurons, i will keep CPU.\r\n\r\nFor the \"potential\" optimisation, please find below my code. Each `run()` call tooks 20 seconds : I'm wide open to any tips, suggestions, improvements.\r\n\r\nThanks again for the great lib!\r\n\r\n```\r\nCHANNEL = 3\r\nWIDTH = 320\r\nHEIGHT = 190\r\nDT = 1\r\nN_NEURONS = 150\r\nTIME = 100\r\nINTENSITY = 100\r\nGPU = False\r\nBATCH_SIZE = 1\r\n\r\nclass LsmReservoir_kuka_env2:\r\n    def __init__(self, height, width, channel, dt, n_neurons, time, intensity, n_goal, gpu):\r\n        super().__init__()\r\n        self._height = height\r\n        self._width = width\r\n        self._channel = channel\r\n        self._dt = dt\r\n        self._n_neurons = n_neurons\r\n        self._time = time\r\n        self._intensity = intensity\r\n        self._n_joint_angles = 5\r\n\r\n        # Sets up Gpu use\r\n        device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\r\n        if gpu and torch.cuda.is_available():\r\n            torch.cuda.manual_seed_all(SEED)\r\n        else:\r\n            torch.manual_seed(SEED)\r\n            device = \"cpu\"\r\n            if gpu:\r\n                gpu = False\r\n        torch.set_num_threads(os.cpu_count() - 1)\r\n        print(\"Running on Device =\", device, \", nb thread =\", os.cpu_count() - 1)\r\n\r\n        # build liquid network\r\n        self.network = Network(dt=dt)\r\n\r\n        inpt_image_top = Input(channel * height * width, shape=(channel, height, width))\r\n        self.network.add_layer(inpt_image_top, name=\"I_image_top\")\r\n\r\n        inpt_joint_angles = Input(self._n_joint_angles, shape=(1, self._n_joint_angles))\r\n        self.network.add_layer(inpt_joint_angles, name=\"I_joint_angles\")\r\n\r\n        inpt_goal = Input(n_goal, shape=(1, n_goal))\r\n        self.network.add_layer(inpt_goal, name=\"I_goal\")\r\n\r\n        liquid = LIFNodes(n_neurons, thresh=-52 + np.random.randn(n_neurons).astype(float))\r\n        self.network.add_layer(liquid, name=\"L\")\r\n\r\n        c_image_top_liquid = Connection(source=inpt_image_top, target=liquid, w=0.5 * torch.randn(inpt_image_top.n, liquid.n))\r\n        c_joint_angles_liquid = Connection(source=inpt_joint_angles, target=liquid, w=0.5 * torch.randn(inpt_joint_angles.n, liquid.n))\r\n        c_goal_liquid = Connection(source=inpt_goal, target=liquid, w=0.5 * torch.randn(inpt_goal.n, liquid.n))\r\n        c_liquid_liquid = Connection(source=liquid, target=liquid, w=0.5 * torch.randn(liquid.n, liquid.n) )\r\n\r\n        self.network.add_connection(c_image_top_liquid, source=\"I_image_top\", target=\"L\")\r\n        self.network.add_connection(c_joint_angles_liquid, source=\"I_joint_angles\", target=\"L\")\r\n        self.network.add_connection(c_goal_liquid, source=\"I_goal\", target=\"L\")\r\n        self.network.add_connection(c_liquid_liquid, source=\"L\", target=\"L\")\r\n\r\n        self.spikes = {}\r\n        for l in self.network.layers:\r\n            self.spikes[l] = Monitor(self.network.layers[l], [\"s\"], time=self._time)\r\n            self.network.add_monitor(self.spikes[l], name=\"%s_spikes\" % l)\r\n\r\n        voltages = {\"L\": Monitor(self.network.layers[\"L\"], [\"v\"], time=self._time)}\r\n        self.network.add_monitor(voltages[\"L\"], name=\"L_voltages\")\r\n\r\n        # Directs network to GPU\r\n        if gpu:\r\n            self.network.to(\"cuda\")\r\n\r\n    def run(self, im_top, joint_angles, goal, plot=True):\r\n        \"\"\"\r\n        one run over the liquid network\r\n        :return: the spikes for each neurons\r\n        \"\"\"\r\n       \r\n        camera_top_t = torch.FloatTensor(camera_top)\r\n        joint_angles_t = torch.FloatTensor(joint_angles)\r\n        goal_t = torch.FloatTensor(goal)\r\n\r\n        camera_top = poisson(camera_top_t, time=self._time)\r\n        j_angles = poisson(joint_angles_t, time=self._time)\r\n        goal = poisson(goal_t, time=self._time)\r\n\r\n        self.network.run(\r\n            inputs={\r\n                \"I_image_top\": camera_top.view(self._time, 1, self._channel, self._height, self._width),\r\n                \"I_joint_angles\": j_angles.view(self._time, -1),\r\n                \"I_goal\": goal.view(self._time, -1),\r\n            },\r\n            time=self._time,\r\n            input_time_dim=1\r\n        )\r\n\r\n        return self.spikes[\"L\"].get(\"s\").sum(0)\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/comments/835839969/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nico1as","id":10497115,"node_id":"MDQ6VXNlcjEwNDk3MTE1","avatar_url":"https://avatars.githubusercontent.com/u/10497115?v=4","gravatar_id":"","url":"https://api.github.com/users/nico1as","html_url":"https://github.com/nico1as","followers_url":"https://api.github.com/users/nico1as/followers","following_url":"https://api.github.com/users/nico1as/following{/other_user}","gists_url":"https://api.github.com/users/nico1as/gists{/gist_id}","starred_url":"https://api.github.com/users/nico1as/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nico1as/subscriptions","organizations_url":"https://api.github.com/users/nico1as/orgs","repos_url":"https://api.github.com/users/nico1as/repos","events_url":"https://api.github.com/users/nico1as/events{/privacy}","received_events_url":"https://api.github.com/users/nico1as/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/comments/835938119","html_url":"https://github.com/BindsNET/bindsnet/issues/485#issuecomment-835938119","issue_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/485","id":835938119,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNTkzODExOQ==","user":{"login":"Hananel-Hazan","id":3954715,"node_id":"MDQ6VXNlcjM5NTQ3MTU=","avatar_url":"https://avatars.githubusercontent.com/u/3954715?v=4","gravatar_id":"","url":"https://api.github.com/users/Hananel-Hazan","html_url":"https://github.com/Hananel-Hazan","followers_url":"https://api.github.com/users/Hananel-Hazan/followers","following_url":"https://api.github.com/users/Hananel-Hazan/following{/other_user}","gists_url":"https://api.github.com/users/Hananel-Hazan/gists{/gist_id}","starred_url":"https://api.github.com/users/Hananel-Hazan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hananel-Hazan/subscriptions","organizations_url":"https://api.github.com/users/Hananel-Hazan/orgs","repos_url":"https://api.github.com/users/Hananel-Hazan/repos","events_url":"https://api.github.com/users/Hananel-Hazan/events{/privacy}","received_events_url":"https://api.github.com/users/Hananel-Hazan/received_events","type":"User","site_admin":false},"created_at":"2021-05-09T23:29:14Z","updated_at":"2021-05-09T23:29:14Z","author_association":"COLLABORATOR","body":"Thank you for sharing your code. At first glance, I don't see something terrible in your code. But, In case you are switching to GPU, many variables and objects should use the device parameter for placing them on the GPU, for example, the network object, network monitors object, dataset that you use, and the input to the network, all need to use the device parameter and need to be place on the GPU explicitly. Otherwise you still use the CPU. \r\n\r\nAlso, as I mentioned earlier, the network size of 500 neurons in the example on the BindsNET front page is relevant only to the example code we use. Each code utilizes the memory bandwidth differently, some will benefit from using the GPU from 100 neurons, and others will see the benefit only at 1000. \r\n","reactions":{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/comments/835938119/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Hananel-Hazan","id":3954715,"node_id":"MDQ6VXNlcjM5NTQ3MTU=","avatar_url":"https://avatars.githubusercontent.com/u/3954715?v=4","gravatar_id":"","url":"https://api.github.com/users/Hananel-Hazan","html_url":"https://github.com/Hananel-Hazan","followers_url":"https://api.github.com/users/Hananel-Hazan/followers","following_url":"https://api.github.com/users/Hananel-Hazan/following{/other_user}","gists_url":"https://api.github.com/users/Hananel-Hazan/gists{/gist_id}","starred_url":"https://api.github.com/users/Hananel-Hazan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hananel-Hazan/subscriptions","organizations_url":"https://api.github.com/users/Hananel-Hazan/orgs","repos_url":"https://api.github.com/users/Hananel-Hazan/repos","events_url":"https://api.github.com/users/Hananel-Hazan/events{/privacy}","received_events_url":"https://api.github.com/users/Hananel-Hazan/received_events","type":"User","site_admin":false}}]