{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/460","repository_url":"https://api.github.com/repos/BindsNET/bindsnet","labels_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/460/labels{/name}","comments_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/460/comments","events_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/460/events","html_url":"https://github.com/BindsNET/bindsnet/issues/460","id":814528981,"node_id":"MDU6SXNzdWU4MTQ1Mjg5ODE=","number":460,"title":"\"Matrices expected, got 3D tensor\" when working with SparseConnections","user":{"login":"Afstkla","id":9075380,"node_id":"MDQ6VXNlcjkwNzUzODA=","avatar_url":"https://avatars.githubusercontent.com/u/9075380?v=4","gravatar_id":"","url":"https://api.github.com/users/Afstkla","html_url":"https://github.com/Afstkla","followers_url":"https://api.github.com/users/Afstkla/followers","following_url":"https://api.github.com/users/Afstkla/following{/other_user}","gists_url":"https://api.github.com/users/Afstkla/gists{/gist_id}","starred_url":"https://api.github.com/users/Afstkla/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Afstkla/subscriptions","organizations_url":"https://api.github.com/users/Afstkla/orgs","repos_url":"https://api.github.com/users/Afstkla/repos","events_url":"https://api.github.com/users/Afstkla/events{/privacy}","received_events_url":"https://api.github.com/users/Afstkla/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-02-23T14:41:53Z","updated_at":"2021-02-24T22:44:07Z","closed_at":"2021-02-24T22:44:07Z","author_association":"NONE","active_lock_reason":null,"body":"Hi there,\r\n\r\nI'm trying to replicate [LSNN](https://github.com/IGITUGraz/LSNN-official) (see figure below) in BindsNET, but I'm running into some problems with SparseConnections.\r\n![IMG_9336](https://user-images.githubusercontent.com/9075380/108858740-c7d09780-75ec-11eb-8abe-acd369222beb.png)\r\n\r\nThe code below shows a small example of what I'm experiencing\r\n```python\r\nimport torch\r\nfrom bindsnet.network import Network\r\nfrom bindsnet.network.nodes import Input, LIFNodes\r\nfrom bindsnet.network.topology import SparseConnection\r\nfrom torchneuromorphic.nmnist.nmnist_dataloaders import create_datasets\r\n\r\nbatch_size = 4\r\ntime = 300\r\n\r\n# Build network.\r\nnetwork = Network()\r\nx_layer = Input(32 * 32 * 2)\r\ne_layer = LIFNodes(10)\r\n\r\nnetwork.add_layer(\r\n    layer=x_layer,\r\n    name='X'\r\n)\r\nnetwork.add_layer(\r\n    layer=e_layer,\r\n    name='E'\r\n)\r\n\r\n\r\nx_e_conn = SparseConnection(\r\n    source=x_layer,\r\n    target=e_layer,\r\n    sparsity=0.15\r\n)\r\n\r\nnetwork.add_connection(\r\n    connection=x_e_conn,\r\n    source=\"X\",\r\n    target=\"E\"\r\n)\r\n\r\ntrain_dataset, test_dataset = create_datasets()\r\nn_test = test_dataset.n\r\n\r\nnetwork.train(mode=False)\r\n\r\ntest_dataloader = torch.utils.data.DataLoader(\r\n    test_dataset, batch_size=batch_size, shuffle=True\r\n)\r\n\r\nfor step, batch in enumerate(test_dataloader):\r\n    if step > n_test:\r\n        break\r\n    # Get next input sample, shape [time, batch_size, x * y * channels], with x = 32, y = 32, channels = 2 (one\r\n    # positive, one negative).\r\n    inputs = {\"X\": batch[0].permute(1, 0, 2, 3, 4).view(time, batch_size, 1, 1, -1).squeeze()}\r\n\r\n    # Run the network on the input.\r\n    network.run(inputs=inputs, time=time, input_time_dim=1)\r\n```\r\n\r\nThis gives me the following error:\r\n```python\r\nTraceback (most recent call last):\r\n  File \"/Users/me/PycharmProjects/BindsNETLayers/min_example.py\", line 54, in <module>\r\n    network.run(inputs=inputs, time=time, input_time_dim=1)\r\n  File \"/Users/me/PycharmProjects/BindsNETLayers/venv/lib/python3.8/site-packages/bindsnet/network/network.py\", line 354, in run\r\n    current_inputs.update(self._get_inputs())\r\n  File \"/Users/me/PycharmProjects/BindsNETLayers/venv/lib/python3.8/site-packages/bindsnet/network/network.py\", line 245, in _get_inputs\r\n    inputs[c[1]] += self.connections[c].compute(source.s)\r\n  File \"/Users/me/PycharmProjects/BindsNETLayers/venv/lib/python3.8/site-packages/bindsnet/network/topology.py\", line 822, in compute\r\n    return torch.mm(self.w, s.unsqueeze(-1).float()).squeeze(-1)\r\nRuntimeError: addmm: matrices expected, got 3D tensor\r\n```\r\n\r\nIt seems that the dimensions of `s` and `self.w` are not matching up. When I try to play around with the dimensions I can fix the unexpected 3D tensor, but I'm greeted with another error: `RuntimeError: sparse tensors do not have strides`. `self.w` is a sparse tensor, so it doesn't seem to be possible to use `torch.mm` on that tensor at all?\r\n\r\nPlease tell me if I'm missing something.\r\n\r\nBest","closed_by":{"login":"Hananel-Hazan","id":3954715,"node_id":"MDQ6VXNlcjM5NTQ3MTU=","avatar_url":"https://avatars.githubusercontent.com/u/3954715?v=4","gravatar_id":"","url":"https://api.github.com/users/Hananel-Hazan","html_url":"https://github.com/Hananel-Hazan","followers_url":"https://api.github.com/users/Hananel-Hazan/followers","following_url":"https://api.github.com/users/Hananel-Hazan/following{/other_user}","gists_url":"https://api.github.com/users/Hananel-Hazan/gists{/gist_id}","starred_url":"https://api.github.com/users/Hananel-Hazan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hananel-Hazan/subscriptions","organizations_url":"https://api.github.com/users/Hananel-Hazan/orgs","repos_url":"https://api.github.com/users/Hananel-Hazan/repos","events_url":"https://api.github.com/users/Hananel-Hazan/events{/privacy}","received_events_url":"https://api.github.com/users/Hananel-Hazan/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/460/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/460/timeline","performed_via_github_app":null,"state_reason":"completed"}