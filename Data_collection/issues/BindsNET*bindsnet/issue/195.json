{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/195","repository_url":"https://api.github.com/repos/BindsNET/bindsnet","labels_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/195/labels{/name}","comments_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/195/comments","events_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/195/events","html_url":"https://github.com/BindsNET/bindsnet/issues/195","id":411243975,"node_id":"MDU6SXNzdWU0MTEyNDM5NzU=","number":195,"title":"Multiple inference on a single image in reservoir.py","user":{"login":"giorgionanfa","id":44408221,"node_id":"MDQ6VXNlcjQ0NDA4MjIx","avatar_url":"https://avatars.githubusercontent.com/u/44408221?v=4","gravatar_id":"","url":"https://api.github.com/users/giorgionanfa","html_url":"https://github.com/giorgionanfa","followers_url":"https://api.github.com/users/giorgionanfa/followers","following_url":"https://api.github.com/users/giorgionanfa/following{/other_user}","gists_url":"https://api.github.com/users/giorgionanfa/gists{/gist_id}","starred_url":"https://api.github.com/users/giorgionanfa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/giorgionanfa/subscriptions","organizations_url":"https://api.github.com/users/giorgionanfa/orgs","repos_url":"https://api.github.com/users/giorgionanfa/repos","events_url":"https://api.github.com/users/giorgionanfa/events{/privacy}","received_events_url":"https://api.github.com/users/giorgionanfa/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-02-17T22:31:55Z","updated_at":"2019-02-19T09:30:41Z","closed_at":"2019-02-19T09:30:41Z","author_association":"NONE","active_lock_reason":null,"body":"Hello, i would like to use the network present in reservoir.py to compute, for a single image, the output probabilities associated to each class. \r\nFirst of all, i perform the training of the network and then i save the weights and the state of the network with:\r\n\r\n torch.save(model.state_dict(), 'weights_res.pkl')\r\n network.save('Network.pt')\r\n\r\nHence, i comment the code relative to the training phase and i load the pre-trained network in this way:\r\n\r\nnetwork = load('Network.pt', learning=False)\r\nmodel.load_state_dict(torch.load('weights_res.pkl')) \r\n\r\nThe purpose of my analysis is to execute the inference on a single image of the MNIST dataset multiple times. I don't need to evaluate the accuracy of all the test images. So, when i perform the test phase, i modify the code in the following way:\r\n\r\nloader = zip(poisson_loader(images, time=250), iter(labels))\r\n\r\nn_iters = 500\r\ntest_pairs = []\r\nfor i, (datum, label) in enumerate(loader):\r\n    **if i ==IMAGE_NUMBER:**                                                   #instead of if i % 100 == 0\r\n        print('Test progress: (%d / %d)' % (i, n_iters))\r\n    \r\n    network.run(inpts={'I' : datum}, time=250)\r\ntest_pairs.append([spikes['O'].get('s').sum(-1), label])\r\n...\r\n...\r\nfor s, label in test_pairs:\r\n    outputs = model(s)\r\n    _, predicted = torch.max(outputs.data.unsqueeze(0), 1)\r\n    **output_prob = nn.functional.softmax(torch.log(outputs-torch.min(outputs)+torch.max(outputs)))**\r\n\r\nI use **outputs** in order to compute the output probabilities of the image IMAGE_NUMBER. My problem is that i obtain strange results: the output probabilities are often wrong and different every time i perform the test. For example, considering the image number 0, the first of the test set, i obtain the following results:\r\n\r\npredicted tensor([5])\r\noutputs tensor([-0.7257,  0.4272, -0.1043, -0.0577,  0.2966,  0.9772,  0.2493, -0.1010, -0.7273, -0.2445], grad_fn=<ThAddBackward>)\r\noutput probs log tensor([0.0575, 0.1251, 0.0939, 0.0967, 0.1175, 0.1574, 0.1147, 0.0941, 0.0574, 0.0857]\r\n\r\nThe label corresponding to the image number 0 is \"7\", so i don't understand why the probability relative to the class \"7\" is 0.0941, while the network recognizes the image (that is clearly a seven) as a five.\r\nMaybe did i make a mistake during the test phase? Or is not this way correct to compute the output probabilities of an image? I hope i was clear to explain my aim and my problem.\r\nThank you in advance,\r\nGiorgio\r\n","closed_by":{"login":"giorgionanfa","id":44408221,"node_id":"MDQ6VXNlcjQ0NDA4MjIx","avatar_url":"https://avatars.githubusercontent.com/u/44408221?v=4","gravatar_id":"","url":"https://api.github.com/users/giorgionanfa","html_url":"https://github.com/giorgionanfa","followers_url":"https://api.github.com/users/giorgionanfa/followers","following_url":"https://api.github.com/users/giorgionanfa/following{/other_user}","gists_url":"https://api.github.com/users/giorgionanfa/gists{/gist_id}","starred_url":"https://api.github.com/users/giorgionanfa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/giorgionanfa/subscriptions","organizations_url":"https://api.github.com/users/giorgionanfa/orgs","repos_url":"https://api.github.com/users/giorgionanfa/repos","events_url":"https://api.github.com/users/giorgionanfa/events{/privacy}","received_events_url":"https://api.github.com/users/giorgionanfa/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/195/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":1,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/195/timeline","performed_via_github_app":null,"state_reason":"completed"}