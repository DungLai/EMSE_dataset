{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/487","repository_url":"https://api.github.com/repos/BindsNET/bindsnet","labels_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/487/labels{/name}","comments_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/487/comments","events_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/487/events","html_url":"https://github.com/BindsNET/bindsnet/issues/487","id":891075589,"node_id":"MDU6SXNzdWU4OTEwNzU1ODk=","number":487,"title":"RuntimeError: shape '[32, 4, 8, 8]' is invalid for input of size 262144","user":{"login":"AptX395","id":44229751,"node_id":"MDQ6VXNlcjQ0MjI5NzUx","avatar_url":"https://avatars.githubusercontent.com/u/44229751?v=4","gravatar_id":"","url":"https://api.github.com/users/AptX395","html_url":"https://github.com/AptX395","followers_url":"https://api.github.com/users/AptX395/followers","following_url":"https://api.github.com/users/AptX395/following{/other_user}","gists_url":"https://api.github.com/users/AptX395/gists{/gist_id}","starred_url":"https://api.github.com/users/AptX395/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AptX395/subscriptions","organizations_url":"https://api.github.com/users/AptX395/orgs","repos_url":"https://api.github.com/users/AptX395/repos","events_url":"https://api.github.com/users/AptX395/events{/privacy}","received_events_url":"https://api.github.com/users/AptX395/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-05-13T14:11:31Z","updated_at":"2021-05-15T03:29:52Z","closed_at":"2021-05-14T23:57:41Z","author_association":"NONE","active_lock_reason":null,"body":"I built a DQN based on SNN with MSTDP learning rule, like this:\r\n\r\n```python\r\nself._net = Network(self._dt)\r\nself._input = nodes.Input(shape = (history_len, 84, 84))\r\nself._conv_layer1 = nodes.LIFNodes(shape = (32, 20, 20))\r\nself._conv1 = topology.Conv2dConnection(self._input, self._conv_layer1, kernel_size = 8, stride = 4, update_rule = MSTDP, nu = learning_rate, wmin = 0, wmax = 1)\r\nself._conv_layer2 = nodes.LIFNodes(shape = (64, 9, 9))\r\nself._conv2 = topology.Conv2dConnection(self._conv_layer1, self._conv_layer2, kernel_size = 4, stride = 2, update_rule = MSTDP, nu = learning_rate, wmin = 0, wmax = 1)\r\nself._conv_layer3 = nodes.LIFNodes(shape = (64, 7, 7))\r\nself._conv3 = topology.Conv2dConnection(self._conv_layer2, self._conv_layer3, kernel_size = 3, stride = 1, update_rule = MSTDP, nu = learning_rate, wmin = 0, wmax = 1)\r\nself._fc_layer1 = nodes.LIFNodes(n = 512)\r\nself._fc1 = topology.Connection(self._conv_layer3, self._fc_layer1, update_rule = MSTDP, nu = learning_rate, wmin = 0, wmax = 1)\r\nself._fc_layer2 = Non_Firing_LIF_Nodes(n = action_num)\r\nself._fc2 = topology.Connection(self._fc_layer1, self._fc_layer2, update_rule = MSTDP, nu = learning_rate, wmin = 0, wmax = 1)\r\n```\r\n\r\nBut when I run the network as follows:\r\n\r\n```python\r\nspike = self._encoder(x).to(self.device)\r\ninput = {\"input\": spike}\r\nself._net.run(input, self._time, one_step = True)\r\n```\r\n\r\nI get this error:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"run.py\", line 164, in <module>\r\n    main()\r\n  File \"run.py\", line 159, in main\r\n    learn(writer)\r\n  File \"run.py\", line 123, in learn\r\n    model_path = os.path.join(MODEL_DIR, f\"{args.model}_{args.env_id}_{time_str}.pkl\"))\r\n  File \"/home/dwj/Programs/SNN_RL/rl_agent/dqn_agent.py\", line 42, in learn\r\n    self._update_main_net(minibatch[0], minibatch[1], minibatch[2], minibatch[3], minibatch[4])\r\n  File \"/home/dwj/Programs/SNN_RL/rl_agent/dqn_agent.py\", line 137, in _update_main_net\r\n    self._main_net.update(y, q)\r\n  File \"/home/dwj/Programs/SNN_RL/neural_network/dsqn_rstdp.py\", line 67, in update\r\n    self._net.connections[connection].update(reward = loss)\r\n  File \"/usr/local/anaconda3/envs/snn_rl/lib/python3.7/site-packages/bindsnet/network/topology.py\", line 374, in update\r\n    super().update(**kwargs)\r\n  File \"/usr/local/anaconda3/envs/snn_rl/lib/python3.7/site-packages/bindsnet/network/topology.py\", line 102, in update\r\n    self.update_rule.update(**kwargs)\r\n  File \"/usr/local/anaconda3/envs/snn_rl/lib/python3.7/site-packages/bindsnet/learning/learning.py\", line 669, in _conv2d_connection_update\r\n    self.eligibility = self.eligibility.view(self.connection.w.size())\r\nRuntimeError: shape '[32, 4, 8, 8]' is invalid for input of size 262144\r\n```\r\n\r\nIt looks like the layer in the network is not in the right shape. But I set up the network according to the structure of DQN.\r\n\r\nHow should I set the network parameters to solve the above problem?\r\n","closed_by":{"login":"Hananel-Hazan","id":3954715,"node_id":"MDQ6VXNlcjM5NTQ3MTU=","avatar_url":"https://avatars.githubusercontent.com/u/3954715?v=4","gravatar_id":"","url":"https://api.github.com/users/Hananel-Hazan","html_url":"https://github.com/Hananel-Hazan","followers_url":"https://api.github.com/users/Hananel-Hazan/followers","following_url":"https://api.github.com/users/Hananel-Hazan/following{/other_user}","gists_url":"https://api.github.com/users/Hananel-Hazan/gists{/gist_id}","starred_url":"https://api.github.com/users/Hananel-Hazan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hananel-Hazan/subscriptions","organizations_url":"https://api.github.com/users/Hananel-Hazan/orgs","repos_url":"https://api.github.com/users/Hananel-Hazan/repos","events_url":"https://api.github.com/users/Hananel-Hazan/events{/privacy}","received_events_url":"https://api.github.com/users/Hananel-Hazan/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/BindsNET/bindsnet/issues/487/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/BindsNET/bindsnet/issues/487/timeline","performed_via_github_app":null,"state_reason":"completed"}