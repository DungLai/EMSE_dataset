[{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/827348268","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/27#issuecomment-827348268","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/27","id":827348268,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNzM0ODI2OA==","user":{"login":"farhantandia","id":17233457,"node_id":"MDQ6VXNlcjE3MjMzNDU3","avatar_url":"https://avatars.githubusercontent.com/u/17233457?v=4","gravatar_id":"","url":"https://api.github.com/users/farhantandia","html_url":"https://github.com/farhantandia","followers_url":"https://api.github.com/users/farhantandia/followers","following_url":"https://api.github.com/users/farhantandia/following{/other_user}","gists_url":"https://api.github.com/users/farhantandia/gists{/gist_id}","starred_url":"https://api.github.com/users/farhantandia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farhantandia/subscriptions","organizations_url":"https://api.github.com/users/farhantandia/orgs","repos_url":"https://api.github.com/users/farhantandia/repos","events_url":"https://api.github.com/users/farhantandia/events{/privacy}","received_events_url":"https://api.github.com/users/farhantandia/received_events","type":"User","site_admin":false},"created_at":"2021-04-27T06:27:55Z","updated_at":"2021-04-27T06:37:06Z","author_association":"NONE","body":"how to predict the class probability? when I set the output to arcface output (softmax) w.r.t number of class, I got an error when doing prediction\r\nmodel = Model(inputs=model.input[0], outputs=model.layers[-1].output) ,-1 instead of -3\r\n[-1].output :\r\n<tf.Tensor 'class_output/Softmax_3:0' shape=(None, 10) dtype=float32>\r\nwhile [-3] return feature vectors which suitable for visualization.\r\nthanks.","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/827348268/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"farhantandia","id":17233457,"node_id":"MDQ6VXNlcjE3MjMzNDU3","avatar_url":"https://avatars.githubusercontent.com/u/17233457?v=4","gravatar_id":"","url":"https://api.github.com/users/farhantandia","html_url":"https://github.com/farhantandia","followers_url":"https://api.github.com/users/farhantandia/followers","following_url":"https://api.github.com/users/farhantandia/following{/other_user}","gists_url":"https://api.github.com/users/farhantandia/gists{/gist_id}","starred_url":"https://api.github.com/users/farhantandia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farhantandia/subscriptions","organizations_url":"https://api.github.com/users/farhantandia/orgs","repos_url":"https://api.github.com/users/farhantandia/repos","events_url":"https://api.github.com/users/farhantandia/events{/privacy}","received_events_url":"https://api.github.com/users/farhantandia/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/852805637","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/27#issuecomment-852805637","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/27","id":852805637,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MjgwNTYzNw==","user":{"login":"ozora-ogino","id":63685461,"node_id":"MDQ6VXNlcjYzNjg1NDYx","avatar_url":"https://avatars.githubusercontent.com/u/63685461?v=4","gravatar_id":"","url":"https://api.github.com/users/ozora-ogino","html_url":"https://github.com/ozora-ogino","followers_url":"https://api.github.com/users/ozora-ogino/followers","following_url":"https://api.github.com/users/ozora-ogino/following{/other_user}","gists_url":"https://api.github.com/users/ozora-ogino/gists{/gist_id}","starred_url":"https://api.github.com/users/ozora-ogino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ozora-ogino/subscriptions","organizations_url":"https://api.github.com/users/ozora-ogino/orgs","repos_url":"https://api.github.com/users/ozora-ogino/repos","events_url":"https://api.github.com/users/ozora-ogino/events{/privacy}","received_events_url":"https://api.github.com/users/ozora-ogino/received_events","type":"User","site_admin":false},"created_at":"2021-06-02T07:22:37Z","updated_at":"2021-06-02T07:22:52Z","author_association":"NONE","body":"Hi @almoghitelman ,\r\nHere is my solution,\r\n\r\n```\r\nclass DNN(tf.keras.models.Model):\r\n    def __init__(self, num_classes=10):\r\n        super(DNN, self).__init__()\r\n        weight_decay = 1e-4\r\n        self.layer_1 = tf.keras.layers.Dense(32, activation='relu')\r\n        self.layer_2 = tf.keras.layers.Dense(10)\r\n        self.out = ArcFace(n_classes=num_classes, regularizer=regularizers.l2(weight_decay))\r\n\r\n    def call(self, x, training=False):\r\n        if training:\r\n            x, y = x[0], x[1]\r\n        x = self.layer_1(x)\r\n        x = self.layer_2(x)\r\n        if training:\r\n            out = self.out([x, y])\r\n        else:\r\n            # Prediction \r\n            # Thanks to this, you don't need to pass labels to model when you predict\r\n            out = tf.nn.softmax(x @ self.out.W)\r\n        return out\r\n```\r\n\r\nSample code is following;\r\n\r\n\r\n```\r\nodel = DNN()\r\noptimizer = tf.keras.optimizers.Adam()\r\nloss = tf.keras.losses.categorical_crossentropy\r\n\r\nmodel.compile(loss=loss, optimizer=optimizer, metrics=['acc'])\r\nmodel.fit([x_train, tf.keras.utils.to_categorical(y_train, 10)], tf.keras.utils.to_categorical(y_train, 10), batch_size=512, epochs=10)\r\n\r\npred = model.predict(x_test)\r\n\r\n```\r\n\r\nI hope it works in your situation.","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/852805637/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ozora-ogino","id":63685461,"node_id":"MDQ6VXNlcjYzNjg1NDYx","avatar_url":"https://avatars.githubusercontent.com/u/63685461?v=4","gravatar_id":"","url":"https://api.github.com/users/ozora-ogino","html_url":"https://github.com/ozora-ogino","followers_url":"https://api.github.com/users/ozora-ogino/followers","following_url":"https://api.github.com/users/ozora-ogino/following{/other_user}","gists_url":"https://api.github.com/users/ozora-ogino/gists{/gist_id}","starred_url":"https://api.github.com/users/ozora-ogino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ozora-ogino/subscriptions","organizations_url":"https://api.github.com/users/ozora-ogino/orgs","repos_url":"https://api.github.com/users/ozora-ogino/repos","events_url":"https://api.github.com/users/ozora-ogino/events{/privacy}","received_events_url":"https://api.github.com/users/ozora-ogino/received_events","type":"User","site_admin":false}},{"id":4829954505,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDgyOTk1NDUwNQ==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/4829954505","actor":{"login":"almoghitelman","id":45692101,"node_id":"MDQ6VXNlcjQ1NjkyMTAx","avatar_url":"https://avatars.githubusercontent.com/u/45692101?v=4","gravatar_id":"","url":"https://api.github.com/users/almoghitelman","html_url":"https://github.com/almoghitelman","followers_url":"https://api.github.com/users/almoghitelman/followers","following_url":"https://api.github.com/users/almoghitelman/following{/other_user}","gists_url":"https://api.github.com/users/almoghitelman/gists{/gist_id}","starred_url":"https://api.github.com/users/almoghitelman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/almoghitelman/subscriptions","organizations_url":"https://api.github.com/users/almoghitelman/orgs","repos_url":"https://api.github.com/users/almoghitelman/repos","events_url":"https://api.github.com/users/almoghitelman/events{/privacy}","received_events_url":"https://api.github.com/users/almoghitelman/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-06-02T07:22:37Z","performed_via_github_app":null},{"id":4829954509,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ4Mjk5NTQ1MDk=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/4829954509","actor":{"login":"almoghitelman","id":45692101,"node_id":"MDQ6VXNlcjQ1NjkyMTAx","avatar_url":"https://avatars.githubusercontent.com/u/45692101?v=4","gravatar_id":"","url":"https://api.github.com/users/almoghitelman","html_url":"https://github.com/almoghitelman","followers_url":"https://api.github.com/users/almoghitelman/followers","following_url":"https://api.github.com/users/almoghitelman/following{/other_user}","gists_url":"https://api.github.com/users/almoghitelman/gists{/gist_id}","starred_url":"https://api.github.com/users/almoghitelman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/almoghitelman/subscriptions","organizations_url":"https://api.github.com/users/almoghitelman/orgs","repos_url":"https://api.github.com/users/almoghitelman/repos","events_url":"https://api.github.com/users/almoghitelman/events{/privacy}","received_events_url":"https://api.github.com/users/almoghitelman/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-06-02T07:22:37Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/853047697","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/27#issuecomment-853047697","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/27","id":853047697,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MzA0NzY5Nw==","user":{"login":"ozora-ogino","id":63685461,"node_id":"MDQ6VXNlcjYzNjg1NDYx","avatar_url":"https://avatars.githubusercontent.com/u/63685461?v=4","gravatar_id":"","url":"https://api.github.com/users/ozora-ogino","html_url":"https://github.com/ozora-ogino","followers_url":"https://api.github.com/users/ozora-ogino/followers","following_url":"https://api.github.com/users/ozora-ogino/following{/other_user}","gists_url":"https://api.github.com/users/ozora-ogino/gists{/gist_id}","starred_url":"https://api.github.com/users/ozora-ogino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ozora-ogino/subscriptions","organizations_url":"https://api.github.com/users/ozora-ogino/orgs","repos_url":"https://api.github.com/users/ozora-ogino/repos","events_url":"https://api.github.com/users/ozora-ogino/events{/privacy}","received_events_url":"https://api.github.com/users/ozora-ogino/received_events","type":"User","site_admin":false},"created_at":"2021-06-02T13:53:37Z","updated_at":"2021-06-02T13:53:37Z","author_association":"NONE","body":"I implemented my own ArcFace.\r\nhttps://github.com/ozora-ogino/asoftmax-tf\r\n\r\nThis works correctly and I believe this can solve your problem.","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/853047697/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ozora-ogino","id":63685461,"node_id":"MDQ6VXNlcjYzNjg1NDYx","avatar_url":"https://avatars.githubusercontent.com/u/63685461?v=4","gravatar_id":"","url":"https://api.github.com/users/ozora-ogino","html_url":"https://github.com/ozora-ogino","followers_url":"https://api.github.com/users/ozora-ogino/followers","following_url":"https://api.github.com/users/ozora-ogino/following{/other_user}","gists_url":"https://api.github.com/users/ozora-ogino/gists{/gist_id}","starred_url":"https://api.github.com/users/ozora-ogino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ozora-ogino/subscriptions","organizations_url":"https://api.github.com/users/ozora-ogino/orgs","repos_url":"https://api.github.com/users/ozora-ogino/repos","events_url":"https://api.github.com/users/ozora-ogino/events{/privacy}","received_events_url":"https://api.github.com/users/ozora-ogino/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/1100878215","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/27#issuecomment-1100878215","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/27","id":1100878215,"node_id":"IC_kwDOCtdDX85BnhGH","user":{"login":"scyzz5","id":85928093,"node_id":"MDQ6VXNlcjg1OTI4MDkz","avatar_url":"https://avatars.githubusercontent.com/u/85928093?v=4","gravatar_id":"","url":"https://api.github.com/users/scyzz5","html_url":"https://github.com/scyzz5","followers_url":"https://api.github.com/users/scyzz5/followers","following_url":"https://api.github.com/users/scyzz5/following{/other_user}","gists_url":"https://api.github.com/users/scyzz5/gists{/gist_id}","starred_url":"https://api.github.com/users/scyzz5/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scyzz5/subscriptions","organizations_url":"https://api.github.com/users/scyzz5/orgs","repos_url":"https://api.github.com/users/scyzz5/repos","events_url":"https://api.github.com/users/scyzz5/events{/privacy}","received_events_url":"https://api.github.com/users/scyzz5/received_events","type":"User","site_admin":false},"created_at":"2022-04-17T13:42:25Z","updated_at":"2022-04-17T13:42:25Z","author_association":"NONE","body":"Why not use [0, 0, 0......0] as laber","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/1100878215/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"scyzz5","id":85928093,"node_id":"MDQ6VXNlcjg1OTI4MDkz","avatar_url":"https://avatars.githubusercontent.com/u/85928093?v=4","gravatar_id":"","url":"https://api.github.com/users/scyzz5","html_url":"https://github.com/scyzz5","followers_url":"https://api.github.com/users/scyzz5/followers","following_url":"https://api.github.com/users/scyzz5/following{/other_user}","gists_url":"https://api.github.com/users/scyzz5/gists{/gist_id}","starred_url":"https://api.github.com/users/scyzz5/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scyzz5/subscriptions","organizations_url":"https://api.github.com/users/scyzz5/orgs","repos_url":"https://api.github.com/users/scyzz5/repos","events_url":"https://api.github.com/users/scyzz5/events{/privacy}","received_events_url":"https://api.github.com/users/scyzz5/received_events","type":"User","site_admin":false}}]