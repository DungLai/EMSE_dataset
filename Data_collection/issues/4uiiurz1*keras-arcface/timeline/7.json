[{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/531745127","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/7#issuecomment-531745127","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/7","id":531745127,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMTc0NTEyNw==","user":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"created_at":"2019-09-16T11:53:28Z","updated_at":"2019-09-16T11:53:28Z","author_association":"OWNER","body":"@Liang-yc \r\nDid you set num_features to 3?\r\nIf so, you should increase num_features (ex. 64).\r\nDefault num_features is 3 due to visualize.","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/531745127/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false}},{"id":2636107822,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjYzNjEwNzgyMg==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2636107822","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-09-16T11:53:29Z","performed_via_github_app":null},{"id":2636107825,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI2MzYxMDc4MjU=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2636107825","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-09-16T11:53:29Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/531750688","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/7#issuecomment-531750688","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/7","id":531750688,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMTc1MDY4OA==","user":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"created_at":"2019-09-16T12:12:46Z","updated_at":"2019-09-16T12:12:46Z","author_association":"NONE","body":"> @Liang-yc\r\n> Did you set num_features to 3?\r\n> If so, you should increase num_features (ex. 64).\r\n> Default num_features is 3 due to visualize.\r\n\r\nThanks for your reply. I have increased the `num_features` from 3 to 10. The test accuracy is still insanely low. (Sorry, I cannot reproduce the same results in this moment due to I changed my project several days ago)  In your experiment, does `ArcFace` really work?","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/531750688/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false}},{"id":2636157920,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjYzNjE1NzkyMA==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2636157920","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-09-16T12:12:46Z","performed_via_github_app":null},{"id":2636157921,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI2MzYxNTc5MjE=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2636157921","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-09-16T12:12:46Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532144697","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/7#issuecomment-532144697","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/7","id":532144697,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjE0NDY5Nw==","user":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"created_at":"2019-09-17T09:39:03Z","updated_at":"2019-09-17T09:39:03Z","author_association":"OWNER","body":"@Liang-yc\r\nCould you paste your code?","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532144697/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false}},{"id":2639222272,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjYzOTIyMjI3Mg==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2639222272","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-09-17T09:39:03Z","performed_via_github_app":null},{"id":2639222275,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI2MzkyMjIyNzU=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2639222275","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-09-17T09:39:03Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532225933","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/7#issuecomment-532225933","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/7","id":532225933,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjIyNTkzMw==","user":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"created_at":"2019-09-17T13:40:58Z","updated_at":"2019-09-17T13:40:58Z","author_association":"NONE","body":"> @Liang-yc\r\n> Could you paste your code?\r\n\r\nTry this code:\r\n```\r\n\r\nfrom __future__ import print_function\r\nfrom __future__ import division\r\n\r\nimport os\r\nimport sklearn.metrics as metrics\r\nfrom keras.utils import np_utils\r\nfrom tensorflow.contrib.learn.python.learn.datasets.mnist import read_data_sets\r\nimport keras\r\nfrom keras.optimizers import SGD,Adam\r\nfrom keras.callbacks import ModelCheckpoint, LearningRateScheduler, CSVLogger\r\nfrom keras.preprocessing.image import ImageDataGenerator\r\nfrom keras.models import Model,load_model\r\nfrom extra_loss import ArcFace\r\nfrom keras.layers import Input, Dense, Dropout, Lambda,Reshape,BatchNormalization\r\nfrom keras.callbacks import ModelCheckpoint, ReduceLROnPlateau\r\nfrom scipy import misc\r\nfrom tqdm import tqdm\r\nfrom keras import backend as K\r\nimport tensorflow as tf\r\nfrom keras.applications.mobilenet import MobileNet\r\n\r\n\r\nimport numpy as np\r\n\r\ndef focal_loss(gamma=2., alpha=.25):\r\n\tdef focal_loss_fixed(y_true, y_pred):\r\n\t\tpt_1 = tf.where(tf.equal(y_true, 1), y_pred, tf.ones_like(y_pred))\r\n\t\tpt_0 = tf.where(tf.equal(y_true, 0), y_pred, tf.zeros_like(y_pred))\r\n\t\treturn (-K.mean(alpha * K.pow(1. - pt_1, gamma) * K.log(pt_1)) - K.mean((1 - alpha) * K.pow(pt_0, gamma) * K.log(1. - pt_0)))*0.5+keras.losses.categorical_crossentropy(y_true, y_pred)*0.5\r\n\treturn focal_loss_fixed\r\n\r\ndef arcface_test(trainX,trainY,testX,testY):\r\n    batch_size = 100\r\n    nb_classes = 10\r\n    nb_epoch = 300\r\n\r\n    input =Input(shape=(56,56,1))\r\n    labels = Input((10,))\r\n    input_image_ = Lambda(lambda x: K.repeat_elements(x, 3, 3))(input)\r\n    print(input_image_.shape)\r\n    model = MobileNet(input_shape=(56,56,3),input_tensor=input_image_, include_top=False, pooling='avg')\r\n\r\n    # x = keras.layers.GlobalAveragePooling2D()(model.output)\r\n\r\n    x = keras.layers.Dropout(0.5)(model.output)\r\n    x = keras.layers.PReLU( name='side_out')(x)\r\n    x = keras.layers.Dense(10)(x)\r\n\r\n    real = Dense(10, kernel_initializer='he_normal',\r\n                kernel_regularizer=keras.regularizers.l2(1e-4),name='real_output')(x)\r\n    x = BatchNormalization(name='fcbn1')(real)\r\n\r\n    x = ArcFace(n_classes=10,regularizer=keras.regularizers.l2(1e-4),name='output')([x,labels])\r\n    model =keras.models.Model([input,labels],x)\r\n\r\n    print(\"Model created\")\r\n\r\n    model.summary()\r\n\r\n    optimizer =SGD(1e-3)\r\n    model.compile(loss={'output':'categorical_crossentropy'}, optimizer=optimizer, metrics=[\"accuracy\"])\r\n    # model.compile(loss={'output':'categorical_crossentropy','centerlosslayer':zero_loss},loss_weights=[0.8, 0.2], optimizer=optimizer, metrics=[\"accuracy\"])\r\n\r\n    # model.compile(loss=keras.losses.categorical_crossentropy, optimizer=optimizer, metrics=[\"accuracy\"])\r\n\r\n    print(\"Finished compiling\")\r\n    print(\"Building model...\")\r\n\r\n    # Import data\r\n\r\n    height, width=56,56\r\n\r\n    trainX = trainX.reshape((-1, 28, 28))\r\n    trainX = np.array([misc.imresize(x, (height, width)).astype(float) for x in tqdm(iter(trainX))]) / 255.\r\n    # trainX=np.uint8(trainX*255)\r\n    trainX = trainX.reshape((-1, height, width,1))\r\n    testX = testX.reshape((-1, 28, 28))\r\n\r\n    testX = np.array([misc.imresize(x, (height, width)).astype(float) for x in tqdm(iter(testX))]) / 255.\r\n    testX = testX.reshape((-1, height, width,1))\r\n\r\n    trainX = (trainX-0.1307)/0.3081\r\n    testX = (testX-0.1307)/0.3081\r\n    Y_train = np_utils.to_categorical(trainY, nb_classes)\r\n    Y_test = np_utils.to_categorical(testY, nb_classes)\r\n\r\n    generator = ImageDataGenerator(featurewise_center=True,\r\n                                   featurewise_std_normalization=True,\r\n                                   horizontal_flip=True,\r\n                                    )\r\n    validation_data = ImageDataGenerator(featurewise_center=True,\r\n                                            featurewise_std_normalization=True)\r\n\r\n    # generator = ImageDataGenerator()\r\n\r\n    for data in (generator, validation_data):\r\n        data.fit(trainX, seed=0)\r\n\r\n    # generator.fit(trainX, seed=0)\r\n\r\n    out_dir = \"model/\"\r\n    if not os.path.exists(out_dir):\r\n        os.makedirs(out_dir)\r\n\r\n    # Load model\r\n    weights_file = \"./model/mobilenet.h5\"\r\n    # model.save_weights(weights_file)\r\n    if os.path.exists(weights_file):\r\n        model.load_weights(weights_file,by_name=True)\r\n        print(\"Model loaded.\")\r\n\r\n    lr_reducer = ReduceLROnPlateau(monitor='val_loss', factor=0.5,\r\n                                   cooldown=0, patience=20, min_lr=1e-8)\r\n    model_checkpoint = ModelCheckpoint(weights_file, monitor=\"val_acc\", save_best_only=True,\r\n                                       save_weights_only=True, mode='auto')\r\n    callbacks = [lr_reducer, model_checkpoint]\r\n\r\n    def gen_flow_for_two_inputs_v2(gen,X1, y, dummy,is_train=False):\r\n        genX1 = gen.flow(X1, y, batch_size=batch_size, seed=666)\r\n        # genX2 = gen.flow(X1, y1, batch_size=batch_size, seed=666)\r\n        while True:\r\n            X1i = genX1.__next__()\r\n            # X2i = genX2.__next__()\r\n            # yield X1i[0], X1i[1]\r\n            # if is_train:\r\n            yield [X1i[0], X1i[1]], X1i[1]\r\n            # else:\r\n            #     yield [X1i[0],dummy], X1i[1]\r\n\r\n\r\n    dummy = np.zeros((batch_size, 10))\r\n    model.fit_generator(gen_flow_for_two_inputs_v2(generator,trainX, Y_train,dummy),\r\n                        steps_per_epoch=len(trainX) // batch_size,\r\n                        epochs=10,\r\n                        callbacks=callbacks,\r\n                        validation_data=gen_flow_for_two_inputs_v2(validation_data,testX, Y_test,dummy),\r\n                        validation_steps=testX.shape[0] // batch_size, verbose=1)\r\n\r\n\r\n    # pred = model.evaluate([testX,Y_test])\r\n    # preds = np.argmax(pred,axis=1)\r\n    # yTrue = np.argmax(Y_test)\r\n    # accuracy = metrics.accuracy_score(yTrue, preds) * 100\r\n    # error = 100 - accuracy\r\n    # print(\"Accuracy : \", accuracy)\r\n    # print(\"Error : \", error)\r\n\r\n    # model.fit_generator(generator.flow(trainX, Y_train),\r\n    #                     steps_per_epoch=len(trainX) // batch_size,\r\n    #                     epochs=nb_epoch,\r\n    #                     callbacks=callbacks,\r\n    #                     validation_data=validation_data.flow(testX, Y_test),\r\n    #                     validation_steps=testX.shape[0] // batch_size, verbose=1)\r\n\r\n    # yPreds = model.predict(testX)\r\n    # yPred = np.argmax(yPreds, axis=1)\r\n    # yTrue = testY\r\n    #\r\n    # accuracy = metrics.accuracy_score(yTrue, yPred) * 100\r\n    # error = 100 - accuracy\r\n    # print(\"Accuracy : \", accuracy)\r\n    # print(\"Error : \", error)\r\n\r\n\r\n\r\n    model.save(weights_file)\r\n    arcface_model = load_model(weights_file, custom_objects={'ArcFace': ArcFace})\r\n    genX1 = validation_data.flow(testX, Y_test, batch_size=10000, seed=666)\r\n    X1i = genX1.__next__()\r\n    # x = arcface_model.layers[-3].output\r\n    # x = keras.layers.Dense(10, activation='softmax')(x)\r\n    # arcface_model = Model(inputs=arcface_model.input[0], outputs=x)\r\n    arcface_model = Model(inputs=arcface_model.input[0], outputs=arcface_model.layers[-3].output)\r\n    optimizer = Adam(lr=3e-5)  # Using Adam instead of SGD to speed up training\r\n    arcface_model.compile(loss='categorical_crossentropy', optimizer=optimizer, metrics=[\"accuracy\"])\r\n\r\n    arcface_features = arcface_model.predict(X1i[0], verbose=0)\r\n    arcface_features /= np.linalg.norm(arcface_features, axis=1, keepdims=True)\r\n    yTrue = np.argmax(X1i[1], axis=1)\r\n    yPred = np.argmax(arcface_features, axis=1)\r\n    accuracy = metrics.accuracy_score(yTrue, yPred) * 100\r\n    error = 100 - accuracy\r\n    print(yTrue, yPred, np.max(yPred))\r\n    print(\"Accuracy : \", accuracy)\r\n    print(\"Error : \", error)\r\n    return model\r\n\r\nif __name__ == '__main__':\r\n    mnist = read_data_sets('./data/fashion', reshape=False, validation_size=0,\r\n                           source_url='http://fashion-mnist.s3-website.eu-central-1.amazonaws.com/')\r\n    trainX = mnist.train.images\r\n    trainY = mnist.train.labels\r\n    testX= mnist.test.images\r\n    testY = mnist.test.labels\r\n    arcface_test(trainX,trainY,testX,testY)\r\n\r\n\r\n    # os.system('shutdown -s -f -t 59')\r\n```\r\nThe train epoch number is only 10. But the test accuracy is too low.\r\n```\r\n600/600 [==============================] - 27s 45ms/step - loss: 4.1397 - acc: 0.7342 - val_loss: 4.1501 - val_acc: 0.7358\r\n2019-09-17 21:33:21.360094: E tensorflow/core/grappler/optimizers/dependency_optimizer.cc:697] Iteration = 0, topological sort failed with message: The graph couldn't be sorted in topological order.\r\n2019-09-17 21:33:21.362870: E tensorflow/core/grappler/optimizers/dependency_optimizer.cc:697] Iteration = 1, topological sort failed with message: The graph couldn't be sorted in topological order.\r\n2019-09-17 21:33:21.366107: E tensorflow/core/grappler/optimizers/meta_optimizer.cc:502] layout failed: Invalid argument: The graph couldn't be sorted in topological order.\r\n2019-09-17 21:33:21.392748: E tensorflow/core/grappler/optimizers/meta_optimizer.cc:502] remapper failed: Invalid argument: The graph couldn't be sorted in topological order.\r\n2019-09-17 21:33:21.395162: E tensorflow/core/grappler/optimizers/meta_optimizer.cc:502] arithmetic_optimizer failed: Invalid argument: The graph couldn't be sorted in topological order.\r\n2019-09-17 21:33:21.397450: E tensorflow/core/grappler/optimizers/dependency_optimizer.cc:697] Iteration = 0, topological sort failed with message: The graph couldn't be sorted in topological order.\r\n2019-09-17 21:33:21.400164: E tensorflow/core/grappler/optimizers/dependency_optimizer.cc:697] Iteration = 1, topological sort failed with message: The graph couldn't be sorted in topological order.\r\n[3 9 6 ... 0 9 5] [7 2 1 ... 9 2 5] 9\r\nAccuracy :  10.059999999999999\r\nError :  89.94\r\n```\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532225933/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false}},{"id":2639940502,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjYzOTk0MDUwMg==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2639940502","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-09-17T13:40:58Z","performed_via_github_app":null},{"id":2639940504,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI2Mzk5NDA1MDQ=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2639940504","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-09-17T13:40:58Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532383823","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/7#issuecomment-532383823","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/7","id":532383823,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjM4MzgyMw==","user":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"created_at":"2019-09-17T20:15:41Z","updated_at":"2019-09-17T20:16:46Z","author_association":"OWNER","body":"@Liang-yc\r\nI found the problem.\r\nIn the following code, you are comparing the argmax of arcface_features with the label.\r\nBut, it's **meaningless**.\r\n```python\r\nyTrue = np.argmax(X1i[1], axis=1)\r\nyPred = np.argmax(arcface_features, axis=1)\r\naccuracy = metrics.accuracy_score(yTrue, yPred) * 100\r\n```\r\nYou try this,\r\n1. Predict arcface_features of the master image each class.\r\n```python\r\nmaster_features = arcface_model.predict(master_images, verbose=0)\r\nmaster_features /= np.linalg.norm(master_features, axis=1, keepdims=True) # each feature corresponds to each class\r\n```\r\n2. Predict arcface_features of the query images, and calculate dot product of master_features and query_features.\r\n```python\r\nquery_features = arcface_model.predict(query_images, verbose=0)\r\nquery_features /= np.linalg.norm(query_features, axis=1, keepdims=True) # each feature corresponds to each class\r\ncosine_similarity = query_features @ master_features\r\nyPred = np.argmax(cosine_similarity, axis=1)\r\naccuracy = metrics.accuracy_score(yTrue, yPred) * 100\r\n```\r\nI haven't tried above code, so it might be wrong somewhere!\r\nI'm not familiar with re-identification tasks, so plz refer to the [arcface paper](https://arxiv.org/abs/1801.07698) or other re-identification papers.","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532383823/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false}},{"id":2641197298,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjY0MTE5NzI5OA==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2641197298","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-09-17T20:15:41Z","performed_via_github_app":null},{"id":2641197299,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI2NDExOTcyOTk=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2641197299","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-09-17T20:15:41Z","performed_via_github_app":null},{"actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"created_at":"2019-09-17T20:18:48Z","updated_at":"2019-09-17T20:18:48Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/8","repository_url":"https://api.github.com/repos/4uiiurz1/keras-arcface","labels_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/8/labels{/name}","comments_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/8/comments","events_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/8/events","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/8","id":494124316,"node_id":"MDU6SXNzdWU0OTQxMjQzMTY=","number":8,"title":"Using arcface with other networks?","user":{"login":"s-rog","id":55400948,"node_id":"MDQ6VXNlcjU1NDAwOTQ4","avatar_url":"https://avatars.githubusercontent.com/u/55400948?v=4","gravatar_id":"","url":"https://api.github.com/users/s-rog","html_url":"https://github.com/s-rog","followers_url":"https://api.github.com/users/s-rog/followers","following_url":"https://api.github.com/users/s-rog/following{/other_user}","gists_url":"https://api.github.com/users/s-rog/gists{/gist_id}","starred_url":"https://api.github.com/users/s-rog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s-rog/subscriptions","organizations_url":"https://api.github.com/users/s-rog/orgs","repos_url":"https://api.github.com/users/s-rog/repos","events_url":"https://api.github.com/users/s-rog/events{/privacy}","received_events_url":"https://api.github.com/users/s-rog/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-09-16T15:31:54Z","updated_at":"2019-09-19T10:05:57Z","closed_at":"2019-09-19T10:05:57Z","author_association":"NONE","active_lock_reason":null,"repository":{"id":181879647,"node_id":"MDEwOlJlcG9zaXRvcnkxODE4Nzk2NDc=","name":"keras-arcface","full_name":"4uiiurz1/keras-arcface","private":false,"owner":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"html_url":"https://github.com/4uiiurz1/keras-arcface","description":"Keras implementation of ArcFace, CosFace, and SphereFace","fork":false,"url":"https://api.github.com/repos/4uiiurz1/keras-arcface","forks_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/forks","keys_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/keys{/key_id}","collaborators_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/teams","hooks_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/hooks","issue_events_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events{/number}","events_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/events","assignees_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/assignees{/user}","branches_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/branches{/branch}","tags_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/tags","blobs_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/git/refs{/sha}","trees_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/git/trees{/sha}","statuses_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/statuses/{sha}","languages_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/languages","stargazers_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/stargazers","contributors_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/contributors","subscribers_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/subscribers","subscription_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/subscription","commits_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/commits{/sha}","git_commits_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/git/commits{/sha}","comments_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/comments{/number}","issue_comment_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments{/number}","contents_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/contents/{+path}","compare_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/compare/{base}...{head}","merges_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/merges","archive_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/downloads","issues_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues{/number}","pulls_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/pulls{/number}","milestones_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/milestones{/number}","notifications_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/labels{/name}","releases_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/releases{/id}","deployments_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/deployments","created_at":"2019-04-17T11:43:15Z","updated_at":"2023-01-16T22:55:13Z","pushed_at":"2022-05-09T02:02:47Z","git_url":"git://github.com/4uiiurz1/keras-arcface.git","ssh_url":"git@github.com:4uiiurz1/keras-arcface.git","clone_url":"https://github.com/4uiiurz1/keras-arcface.git","svn_url":"https://github.com/4uiiurz1/keras-arcface","homepage":"","size":453,"stargazers_count":263,"watchers_count":263,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":65,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":17,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["arcface","deep-learning","keras"],"visibility":"public","forks":65,"open_issues":17,"watchers":263,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Hello,\r\n\r\nI'm trying to use this with an existing network that ends with | GAP -> dropout -> softmax | and I'm not sure where to put the arc/cosface layer. I've already tried many combinations (replacing the softmax) but couldn't get any to work. Accuracy is always 0 and loss fluctuates but doesn't go down.\r\n\r\nAny help is appreciated!","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/8/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/8/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532388145","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/7#issuecomment-532388145","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/7","id":532388145,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjM4ODE0NQ==","user":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"created_at":"2019-09-17T20:27:47Z","updated_at":"2019-09-17T20:27:47Z","author_association":"OWNER","body":"@Liang-yc\r\nAnother simple solution (When the train classes and the test classes are the same):\r\n```python\r\narcface_model = load_model(weights_file, custom_objects={'ArcFace': ArcFace})\r\ngenX1 = validation_data.flow(testX, Y_test, batch_size=10000, seed=666)\r\nX1i = genX1.__next__()\r\noutputs = arcface_model.predict(X1i[0], verbose=0)\r\nyPred = np.argmax(outputs, axis=1)\r\naccuracy = metrics.accuracy_score(yTrue, yPred) * 100\r\n \r\n```","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532388145/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false}},{"id":2641229755,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjY0MTIyOTc1NQ==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2641229755","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-09-17T20:27:47Z","performed_via_github_app":null},{"id":2641229756,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI2NDEyMjk3NTY=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2641229756","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-09-17T20:27:47Z","performed_via_github_app":null},{"id":2641283475,"node_id":"MDEyOkxhYmVsZWRFdmVudDI2NDEyODM0NzU=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2641283475","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-09-17T20:47:11Z","label":{"name":"help wanted","color":"008672"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532432217","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/7#issuecomment-532432217","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/7","id":532432217,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjQzMjIxNw==","user":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"created_at":"2019-09-17T22:51:36Z","updated_at":"2019-09-17T22:51:36Z","author_association":"NONE","body":"> @Liang-yc\r\n> Another simple solution (When the train classes and the test classes are the same):\r\n> \r\n> ```python\r\n> arcface_model = load_model(weights_file, custom_objects={'ArcFace': ArcFace})\r\n> genX1 = validation_data.flow(testX, Y_test, batch_size=10000, seed=666)\r\n> X1i = genX1.__next__()\r\n> outputs = arcface_model.predict(X1i[0], verbose=0)\r\n> yPred = np.argmax(outputs, axis=1)\r\n> accuracy = metrics.accuracy_score(yTrue, yPred) * 100\r\n>  \r\n> ```\r\n\r\nIt does not work. Using the train images in testing phase, the accuracy is not consistent with the accuracy in training phase.","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532432217/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false}},{"id":2641572984,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjY0MTU3Mjk4NA==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2641572984","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-09-17T22:51:36Z","performed_via_github_app":null},{"id":2641572986,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI2NDE1NzI5ODY=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2641572986","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-09-17T22:51:36Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532437995","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/7#issuecomment-532437995","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/7","id":532437995,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjQzNzk5NQ==","user":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"created_at":"2019-09-17T23:17:58Z","updated_at":"2019-09-17T23:17:58Z","author_association":"NONE","body":"> 1. master image\r\n\r\nWhat does \"master image\" mean ? All the training images with the same label?","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532437995/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532577054","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/7#issuecomment-532577054","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/7","id":532577054,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjU3NzA1NA==","user":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"created_at":"2019-09-18T08:22:41Z","updated_at":"2019-09-18T08:23:05Z","author_association":"OWNER","body":"@Liang-yc\r\n\r\nSry! I misunderstood!\r\nPlz try this code:\r\n```python\r\nW = arcface_model.get_layer('output').W\r\narcface_model = Model(inputs=arcface_model.input[0], outputs=arcface_model.layers[-3].output)\r\narcface_features = arcface_model.predict(X1i[0], verbose=0)\r\narcface_features /= np.linalg.norm(arcface_features, axis=1, keepdims=True)\r\nyTrue = np.argmax(X1i[1], axis=1)\r\nyPred = np.argmax(K.eval(arcface_features @ W), axis=1)\r\naccuracy = metrics.accuracy_score(yTrue, yPred) * 100\r\nerror = 100 - accuracy\r\nprint(yTrue, yPred, np.max(yPred))\r\nprint(\"Accuracy : \", accuracy)\r\nprint(\"Error : \", error)\r\n```","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532577054/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false}},{"id":2642591118,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjY0MjU5MTExOA==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2642591118","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-09-18T08:23:06Z","performed_via_github_app":null},{"id":2642591119,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI2NDI1OTExMTk=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2642591119","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-09-18T08:23:06Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532922873","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/7#issuecomment-532922873","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/7","id":532922873,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjkyMjg3Mw==","user":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"created_at":"2019-09-19T01:06:03Z","updated_at":"2019-09-19T01:06:03Z","author_association":"NONE","body":"> @Liang-yc\r\n> \r\n> Sry! I misunderstood!\r\n> Plz try this code:\r\n> \r\n> ```python\r\n> W = arcface_model.get_layer('output').W\r\n> arcface_model = Model(inputs=arcface_model.input[0], outputs=arcface_model.layers[-3].output)\r\n> arcface_features = arcface_model.predict(X1i[0], verbose=0)\r\n> arcface_features /= np.linalg.norm(arcface_features, axis=1, keepdims=True)\r\n> yTrue = np.argmax(X1i[1], axis=1)\r\n> yPred = np.argmax(K.eval(arcface_features @ W), axis=1)\r\n> accuracy = metrics.accuracy_score(yTrue, yPred) * 100\r\n> error = 100 - accuracy\r\n> print(yTrue, yPred, np.max(yPred))\r\n> print(\"Accuracy : \", accuracy)\r\n> print(\"Error : \", error)\r\n> ```\r\n\r\nIt works, thx. ","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/532922873/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false}},{"id":2645342801,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjY0NTM0MjgwMQ==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2645342801","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-09-19T01:06:04Z","performed_via_github_app":null},{"id":2645342805,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI2NDUzNDI4MDU=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2645342805","actor":{"login":"Liang-yc","id":25114561,"node_id":"MDQ6VXNlcjI1MTE0NTYx","avatar_url":"https://avatars.githubusercontent.com/u/25114561?v=4","gravatar_id":"","url":"https://api.github.com/users/Liang-yc","html_url":"https://github.com/Liang-yc","followers_url":"https://api.github.com/users/Liang-yc/followers","following_url":"https://api.github.com/users/Liang-yc/following{/other_user}","gists_url":"https://api.github.com/users/Liang-yc/gists{/gist_id}","starred_url":"https://api.github.com/users/Liang-yc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Liang-yc/subscriptions","organizations_url":"https://api.github.com/users/Liang-yc/orgs","repos_url":"https://api.github.com/users/Liang-yc/repos","events_url":"https://api.github.com/users/Liang-yc/events{/privacy}","received_events_url":"https://api.github.com/users/Liang-yc/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-09-19T01:06:04Z","performed_via_github_app":null}]