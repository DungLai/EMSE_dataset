[{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/486892171","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/2#issuecomment-486892171","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/2","id":486892171,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4Njg5MjE3MQ==","user":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false},"created_at":"2019-04-26T01:24:05Z","updated_at":"2019-04-26T01:24:05Z","author_association":"NONE","body":"I think i have wrong programming in those lines, but i still have no idea to deal with it!\r\nplease help me, thx!\r\n@4uiiurz1 \r\n```python\r\n# partition the data into training and testing splits using 75% of\r\n# the data for training and the remaining 25% for testing\r\n(trainX, testX, trainY, testY) = train_test_split(data, labels,\r\n                                                  test_size=0.25, random_state=42)\r\ntrainY = to_categorical(trainY, 2)\r\ntestY = to_categorical(testY, 2)\r\n```","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/486892171/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false}},{"id":2301844615,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjMwMTg0NDYxNQ==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2301844615","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-04-26T01:24:05Z","performed_via_github_app":null},{"id":2301844616,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzMDE4NDQ2MTY=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2301844616","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-04-26T01:24:05Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/486909495","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/2#issuecomment-486909495","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/2","id":486909495,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NjkwOTQ5NQ==","user":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"created_at":"2019-04-26T03:07:25Z","updated_at":"2019-04-26T03:07:25Z","author_association":"OWNER","body":"Hi!\r\nPlease paste your train_liveness.py here.","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/486909495/reactions","total_count":1,"+1":0,"-1":0,"laugh":1,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487026682","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/2#issuecomment-487026682","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/2","id":487026682,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzAyNjY4Mg==","user":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"created_at":"2019-04-26T11:37:34Z","updated_at":"2019-04-26T11:37:49Z","author_association":"OWNER","body":"Did you pass the tuple (X_train, y_train) to the generator? That is not right.\r\nYou must pass the tuple ([X_train, y_train], y_train) to the generator.","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487026682/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487030085","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/2#issuecomment-487030085","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/2","id":487030085,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzAzMDA4NQ==","user":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false},"created_at":"2019-04-26T11:51:51Z","updated_at":"2019-04-26T11:54:32Z","author_association":"NONE","body":"Thanks to your generous help and this is my own `train_liveness.py` copys:\r\n\r\n```python# USAGE\r\n# python train_liveness.py --dataset dataset --model liveness.model --le le.pickle\r\n\r\n# set the matplotlib backend so figures can be saved in the background\r\nimport matplotlib\r\nmatplotlib.use(\"Agg\")\r\n\r\nfrom sklearn.preprocessing import LabelEncoder\r\nfrom sklearn.model_selection import train_test_split\r\nfrom sklearn.metrics import classification_report\r\nfrom keras.preprocessing.image import ImageDataGenerator\r\nfrom keras.utils.vis_utils import plot_model\r\nfrom keras.models import Sequential, Model\r\nfrom keras.layers.normalization import BatchNormalization\r\nfrom keras.layers.convolutional import Conv2D\r\nfrom keras.layers.convolutional import MaxPooling2D\r\nfrom keras.layers.core import Activation, Flatten, Dropout, Dense\r\nfrom arcface.metrics import ArcFace\r\nfrom keras.layers import Input\r\nfrom keras import backend as K\r\nfrom keras.optimizers import Adam\r\nfrom keras.utils import to_categorical\r\nfrom keras.utils import np_utils\r\nfrom imutils import paths\r\nimport matplotlib.pyplot as plt\r\nimport numpy as np\r\nimport argparse\r\nimport pickle\r\nimport cv2\r\nimport os\r\n\r\n# visible GPU devices\r\nos.environ[\"CUDA_VISIBLE_DEVICES\"]=\"0,1\"\r\n\r\n# construct the argument parser and parse the arguments\r\nap = argparse.ArgumentParser()\r\nap.add_argument(\"-d\", \"--dataset\", required=True,\r\n                help=\"path to input dataset\")\r\nap.add_argument(\"-m\", \"--model\", type=str, required=True,\r\n                help=\"path to trained model\")\r\nap.add_argument(\"-l\", \"--le\", type=str, required=True,\r\n                help=\"path to label encoder\")\r\nap.add_argument(\"-p\", \"--plot\", type=str, default=\"plot.png\",\r\n                help=\"path to output loss/accuracy plot\")\r\nargs = vars(ap.parse_args())\r\n\r\n# initialize the initial learning rate, batch size, and number of\r\n# epochs to train for\r\nINIT_LR = 1e-4\r\nBS = 8\r\nEPOCHS = 50\r\n# set image parameter\r\nheight = 64\r\nwidth = 64\r\ndepth = 3\r\nclasses = 2\r\n\r\n# grab the list of images in our dataset directory, then initialize\r\n# the list of data (i.e., images) and class images\r\nprint(\"[INFO] loading images...\")\r\nimagePaths = list(paths.list_images(args[\"dataset\"]))\r\ndata = []\r\nlabels = []\r\n\r\nfor imagePath in imagePaths:\r\n    # extract the class label from the filename, load the image and\r\n    # resize it to be a fixed 32x32 pixels, ignoring aspect ratio\r\n    label = imagePath.split(os.path.sep)[-2]\r\n    image = cv2.imread(imagePath)\r\n    image = cv2.resize(image, (height, width))\r\n\r\n    # update the data and labels lists, respectively\r\n    data.append(image)\r\n    labels.append(label)\r\n\r\n# convert the data into a NumPy array, then preprocess it by scaling\r\n# all pixel intensities to the range [0, 1]\r\ndata = np.array(data, dtype=\"float\") / 255.0\r\n\r\n# encode the labels (which are currently strings) as integers and then\r\n# one-hot encode them\r\nle = LabelEncoder()\r\nlabels = le.fit_transform(labels)\r\nlabels = np_utils.to_categorical(labels, 2)\r\n\r\n# partition the data into training and testing splits using 75% of\r\n# the data for training and the remaining 25% for testing\r\n(trainX, testX, trainY, testY) = train_test_split(data, labels,\r\n                                                  test_size=0.25, random_state=42)\r\ntrainY = to_categorical(trainY, 2)\r\ntestY = to_categorical(testY, 2)\r\n\r\n# construct the training image generator for data augmentation\r\naug = ImageDataGenerator(rotation_range=20, zoom_range=0.15, brightness_range=[0.5, 1.5],\r\n                         width_shift_range=0.2, height_shift_range=0.2,\r\n                         shear_range=0.15, horizontal_flip=True, fill_mode=\"nearest\")\r\n\r\n# initialize the optimizer and model\r\nprint(\"[INFO] compiling model...\")\r\ninput = Input(shape=(height, width, depth))\r\nlabellabel = Input(shape=(classes,))\r\n# if we are using \"channels first\", update the input shape and channels dimension\r\nchanDim = -1\r\nif K.image_data_format() == \"channels_first\":\r\n    inputShape = (depth, height, width)\r\n    chanDim = 1\r\n\r\nx = Conv2D(32, kernel_size=(3, 3), padding=\"same\", activation=\"relu\")(input)\r\nx = BatchNormalization(axis=chanDim)(x)\r\nx = Conv2D(32, kernel_size=(3, 3), padding=\"same\", activation=\"relu\")(x)\r\nx = BatchNormalization(axis=chanDim)(x)\r\nx = MaxPooling2D(pool_size=(2, 2))(x)\r\nx = Dropout(0.25)(x)\r\n\r\nx = Conv2D(64, kernel_size=(3, 3), padding=\"same\", activation=\"relu\")(x)\r\nx = BatchNormalization(axis=chanDim)(x)\r\nx = Conv2D(64, kernel_size=(3, 3), padding=\"same\", activation=\"relu\")(x)\r\nx = BatchNormalization(axis=chanDim)(x)\r\nx = MaxPooling2D(pool_size=(2, 2))(x)\r\nx = Dropout(0.3)(x)\r\n\r\nx = Flatten()(x)\r\nx = Dense(128, activation=\"relu\")(x)\r\nx = BatchNormalization(axis=chanDim)(x)\r\nx = Dropout(0.4)(x)\r\n\r\noutput = ArcFace(classes)([x, labellabel])\r\nmodel = Model([input, labellabel], output)\r\n\r\nopt = Adam(lr=INIT_LR, decay=INIT_LR / EPOCHS)\r\nmodel.compile(loss=\"binary_crossentropy\", optimizer=opt,\r\n              metrics=[\"accuracy\"])\r\n\r\n# visual the architecture of AntiNet\r\nplot_model(model, to_file=r\"models\\\\20190425\\\\AntiNet.png\", show_layer_names=True, show_shapes=True)\r\nprint(model.summary())\r\n\r\n# train the network\r\nprint(\"[INFO] training network for {} epochs...\".format(EPOCHS))\r\nH = model.fit_generator(aug.flow([trainX, trainY], trainY, batch_size=BS),\r\n                        validation_data=([testX, testY], testY), steps_per_epoch=len(trainX) // BS,\r\n                        epochs=EPOCHS)\r\n\r\n# evaluate the network\r\nprint(\"[INFO] evaluating network...\")\r\npredictions = model.predict([testX, testY], batch_size=BS)\r\nprint(classification_report(testY.argmax(axis=1),\r\n                            predictions.argmax(axis=1), target_names=le.classes_))\r\n\r\n# save the network to disk\r\nprint(\"[INFO] serializing network to '{}'...\".format(args[\"model\"]))\r\nmodel.save(args[\"model\"])\r\n\r\n# save the label encoder to disk\r\nf = open(args[\"le\"], \"wb\")\r\nf.write(pickle.dumps(le))\r\nf.close()\r\n\r\n# plot the training loss and accuracy\r\nplt.style.use(\"ggplot\")\r\nplt.figure()\r\nplt.plot(np.arange(0, EPOCHS), H.history[\"loss\"], label=\"train_loss\")\r\nplt.plot(np.arange(0, EPOCHS), H.history[\"val_loss\"], label=\"val_loss\")\r\nplt.plot(np.arange(0, EPOCHS), H.history[\"acc\"], label=\"train_acc\")\r\nplt.plot(np.arange(0, EPOCHS), H.history[\"val_acc\"], label=\"val_acc\")\r\nplt.title(\"Training Loss and Accuracy on Dataset\")\r\nplt.xlabel(\"Epoch #\")\r\nplt.ylabel(\"Loss/Accuracy\")\r\nplt.legend(loc=\"lower left\")\r\nplt.savefig(args[\"plot\"])\r\n```\r\ni just want to add the designed loss (arcface) instead of previous loss, and i debug it for three days but no progress I make. \r\n\r\nthank you once again if you can deal with it smoothly! @4uiiurz1 ","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487030085/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false}},{"id":2302879143,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjMwMjg3OTE0Mw==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2302879143","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-04-26T11:54:32Z","performed_via_github_app":null},{"id":2302879144,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzMDI4NzkxNDQ=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2302879144","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-04-26T11:54:32Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487037647","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/2#issuecomment-487037647","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/2","id":487037647,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzAzNzY0Nw==","user":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"created_at":"2019-04-26T12:22:04Z","updated_at":"2019-04-26T12:22:04Z","author_association":"OWNER","body":"ImageDataGenerator doesn't support the tuple ([X_train, y_train], y_train)...\r\nPlease try following code:\r\n```python\r\nclass MyImageDataGenerator:\r\n    def __init__(self):\r\n        self.datagen = ImageDataGenerator(rotation_range=20, zoom_range=0.15, brightness_range=[0.5, 1.5],\r\n                         width_shift_range=0.2, height_shift_range=0.2,\r\n                         shear_range=0.15, horizontal_flip=True, fill_mode=\"nearest\")\r\n\r\n    def flow(self, x, y=None, batch_size=32, shuffle=True, sample_weight=None,\r\n             seed=None, save_to_dir=None, save_prefix='', save_format='png', subset=None):\r\n        batches = self.datagen.flow(x, y, batch_size, shuffle, sample_weight,\r\n                               seed, save_to_dir, save_prefix, save_format, subset)\r\n\r\n        while True:\r\n            x_batch, y_batch = next(batches)\r\n\r\n            yield [x_batch, y_batch], y_batch\r\n\r\naug = MyImageDataGenerator()\r\n\r\n\r\nH = model.fit_generator(aug.flow(trainX, trainY, batch_size=BS),\r\n                        validation_data=([testX, testY], testY), steps_per_epoch=len(trainX) // BS,\r\n                        epochs=EPOCHS)\r\n```","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487037647/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487040509","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/2#issuecomment-487040509","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/2","id":487040509,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzA0MDUwOQ==","user":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false},"created_at":"2019-04-26T12:32:55Z","updated_at":"2019-04-26T12:34:43Z","author_association":"NONE","body":" @4uiiurz1 I have modified follow your idea, but I got this new issue:\r\n```python\r\n[INFO] training network for 50 epochs...\r\nTraceback (most recent call last):\r\n  File \"train_modified.py\", line 163, in <module>\r\n    epochs=EPOCHS)\r\n  File \"C:\\Users\\Gepeng-Ji\\Anaconda3\\envs\\keras\\lib\\site-packages\\keras\\legacy\\interfaces.py\", line 91, in wrapper\r\n    return func(*args, **kwargs)\r\n  File \"C:\\Users\\Gepeng-Ji\\Anaconda3\\envs\\keras\\lib\\site-packages\\keras\\engine\\training.py\", line 1418, in fit_generator\r\n    initial_epoch=initial_epoch)\r\n  File \"C:\\Users\\Gepeng-Ji\\Anaconda3\\envs\\keras\\lib\\site-packages\\keras\\engine\\training_generator.py\", line 144, in fit_generator\r\n    val_x, val_y, val_sample_weight)\r\n  File \"C:\\Users\\Gepeng-Ji\\Anaconda3\\envs\\keras\\lib\\site-packages\\keras\\engine\\training.py\", line 751, in _standardize_user_data\r\n    exception_prefix='input')\r\n  File \"C:\\Users\\Gepeng-Ji\\Anaconda3\\envs\\keras\\lib\\site-packages\\keras\\engine\\training_utils.py\", line 128, in standardize_input_data\r\n    'with shape ' + str(data_shape))\r\nValueError: Error when checking input: expected input_2 to have 2 dimensions, but got array with shape (78, 2, 2)\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487040509/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false}},{"id":2302959679,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjMwMjk1OTY3OQ==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2302959679","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-04-26T12:32:55Z","performed_via_github_app":null},{"id":2302959681,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzMDI5NTk2ODE=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2302959681","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-04-26T12:32:55Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487154117","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/2#issuecomment-487154117","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/2","id":487154117,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzE1NDExNw==","user":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"created_at":"2019-04-26T18:21:31Z","updated_at":"2019-04-26T18:21:31Z","author_association":"OWNER","body":"It's because that labels are one-hot encoded twice.\r\nPlease try to remove following line:\r\n```python\r\nlabels = np_utils.to_categorical(labels, 2)\r\n```","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487154117/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487230547","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/2#issuecomment-487230547","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/2","id":487230547,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzIzMDU0Nw==","user":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false},"created_at":"2019-04-26T23:26:27Z","updated_at":"2019-04-26T23:26:38Z","author_association":"NONE","body":"I am so careless!\r\nthx your help! good luck to you! @4uiiurz1 ","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487230547/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false}},{"id":2304407632,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjMwNDQwNzYzMg==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2304407632","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-04-26T23:26:38Z","performed_via_github_app":null},{"id":2304407633,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzMDQ0MDc2MzM=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2304407633","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-04-26T23:26:38Z","performed_via_github_app":null},{"id":2305083772,"node_id":"MDExOkNsb3NlZEV2ZW50MjMwNTA4Mzc3Mg==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2305083772","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-04-28T06:14:27Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487472269","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/2#issuecomment-487472269","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/2","id":487472269,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzQ3MjI2OQ==","user":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false},"created_at":"2019-04-29T07:09:46Z","updated_at":"2019-04-29T07:10:12Z","author_association":"NONE","body":"firstly, thank your help last time but today I face another problem when I load the modified training script by Arcface loss function\r\n```python\r\n File \"liveness_demo.py\", line 42, in <module>\r\n    model = load_model(args[\"model\"])\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\engine\\saving.py\", line 419, in load_model\r\n    model = _deserialize_model(f, custom_objects, compile)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\engine\\saving.py\", line 225, in _deserialize_model\r\n    model = model_from_config(model_config, custom_objects=custom_objects)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\engine\\saving.py\", line 458, in model_from_config\r\n    return deserialize(config, custom_objects=custom_objects)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\layers\\__init__.py\", line 55, in deserialize\r\n    printable_module_name='layer')\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\utils\\generic_utils.py\", line 145, in deserialize_keras_object\r\n    list(custom_objects.items())))\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\engine\\network.py\", line 1022, in from_config\r\n    process_layer(layer_data)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\engine\\network.py\", line 1008, in process_layer\r\n    custom_objects=custom_objects)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\layers\\__init__.py\", line 55, in deserialize\r\n    printable_module_name='layer')\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\utils\\generic_utils.py\", line 138, in deserialize_keras_object\r\n    ': ' + class_name)\r\nValueError: Unknown layer: ArcFace\r\n\r\n```\r\n@4uiiurz1 what should I do for it?","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487472269/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false}},{"id":2305860821,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjMwNTg2MDgyMQ==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2305860821","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-04-29T07:10:12Z","performed_via_github_app":null},{"id":2305860823,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzMDU4NjA4MjM=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2305860823","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-04-29T07:10:12Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487526839","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/2#issuecomment-487526839","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/2","id":487526839,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzUyNjgzOQ==","user":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"created_at":"2019-04-29T10:15:05Z","updated_at":"2019-04-29T10:15:05Z","author_association":"OWNER","body":"You can load the model like following:\r\n```python\r\nmodel = load_model(args[\"model\"], custom_objects={'ArcFace': ArcFace})\r\n```","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487526839/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487545380","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/2#issuecomment-487545380","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/2","id":487545380,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzU0NTM4MA==","user":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false},"created_at":"2019-04-29T11:32:44Z","updated_at":"2019-04-29T11:33:22Z","author_association":"NONE","body":"I'm so sorry to disturb you so many times, this is my entire code\r\n```python\r\n# import the necessary packages\r\nfrom imutils.video import VideoStream\r\nfrom keras.preprocessing.image import img_to_array\r\nfrom keras.models import load_model\r\nfrom arcface.metrics import ArcFace\r\nimport numpy as np\r\nimport argparse\r\nimport imutils\r\nimport pickle\r\nimport time\r\nimport cv2\r\nimport os\r\n\r\n# construct the argument parse and parse the arguments\r\nap = argparse.ArgumentParser()\r\nap.add_argument(\"-m\", \"--model\", type=str, required=True,\r\n\thelp=\"path to trained model\")\r\nap.add_argument(\"-l\", \"--le\", type=str, required=True,\r\n\thelp=\"path to label encoder\")\r\nap.add_argument(\"-d\", \"--detector\", type=str, required=True,\r\n\thelp=\"path to OpenCV's deep learning face detector\")\r\nap.add_argument(\"-c\", \"--confidence\", type=float, default=0.7,\r\n\thelp=\"minimum probability to filter weak detections\")\r\nargs = vars(ap.parse_args())\r\n\r\n# load our serialized face detector from disk\r\nprint(\"[INFO] loading face detector...\")\r\nprotoPath = os.path.sep.join([args[\"detector\"], \"deploy.prototxt\"])\r\nmodelPath = os.path.sep.join([args[\"detector\"],\r\n\t\"res10_300x300_ssd_iter_140000.caffemodel\"])\r\nnet = cv2.dnn.readNetFromCaffe(protoPath, modelPath)\r\n\r\n# load the liveness detector model and label encoder from disk\r\nprint(\"[INFO] loading liveness detector...\")\r\n# model = load_model(args[\"model\"])\r\nmodel = load_model(args[\"model\"], custom_objects={\"ArcFace\": ArcFace})\r\nprint(\"[INFO] model loading successfully\")\r\nle = pickle.loads(open(args[\"le\"], \"rb\").read())\r\n\r\n# initialize the video stream and allow the camera sensor to warmup\r\nprint(\"[INFO] starting video stream...\")\r\nvs = VideoStream(src=0).start()\r\ntime.sleep(2.0)\r\n\r\n# loop over the frames from the video stream\r\nwhile True:\r\n\t# grab the frame from the threaded video stream and resize it\r\n\t# to have a maximum width of 600 pixels\r\n\tframe = vs.read()\r\n\tframe = imutils.resize(frame, width=600)\r\n\r\n\t# grab the frame dimensions and convert it to a blob\r\n\t(h, w) = frame.shape[:2]\r\n\tblob = cv2.dnn.blobFromImage(cv2.resize(frame, (300, 300)), 1.0,\r\n\t\t(300, 300), (104.0, 177.0, 123.0))\r\n\r\n\t# pass the blob through the network and obtain the detections and predictions\r\n\tnet.setInput(blob)\r\n\tdetections = net.forward()\r\n\tprint(\"detections {} {} {}\".format(type(detections), detections.shape, detections))\r\n\t# loop over the detections\r\n\tfor i in range(0, detections.shape[2]):\r\n\t\t# extract the confidence (i.e., probability) associated with the\r\n\t\t# prediction\r\n\t\tconfidence = detections[0, 0, i, 2]\r\n\r\n\t\t# filter out weak detections\r\n\t\tif confidence > args[\"confidence\"]:\r\n\t\t\t# compute the (x, y)-coordinates of the bounding box for\r\n\t\t\t# the face and extract the face ROI\r\n\t\t\tbox = detections[0, 0, i, 3:7] * np.array([w, h, w, h])\r\n\t\t\tprint(\"box{},{}\".format(type(box), box.shape))\r\n\t\t\t(startX, startY, endX, endY) = box.astype(\"int\")\r\n\r\n\t\t\t# ensure the detected bounding box does fall outside the\r\n\t\t\t# dimensions of the frame\r\n\t\t\tstartX = max(0, startX)\r\n\t\t\tstartY = max(0, startY)\r\n\t\t\tendX = min(w, endX)\r\n\t\t\tendY = min(h, endY)\r\n\r\n\t\t\t# extract the face ROI and then preproces it in the exact\r\n\t\t\t# same manner as our training data\r\n\t\t\tface = frame[startY:endY, startX:endX]\r\n\t\t\tface = cv2.resize(face, (32, 32))\r\n\t\t\tface = face.astype(\"float\") / 255.0\r\n\t\t\tface = img_to_array(face)\r\n\t\t\tface = np.expand_dims(face, axis=0)\r\n\r\n\t\t\t# pass the face ROI through the trained liveness detector\r\n\t\t\t# model to determine if the face is \"real\" or \"fake\"\r\n\t\t\tpreds = model.predict(face)[0]\r\n\t\t\tj = np.argmax(preds)\r\n\t\t\tLE = le.classes_[j]\r\n\r\n\t\t\t# draw the label and bounding box on the frame\r\n\t\t\tlabel = \"{}: {:.4f}\".format(LE, preds[j])\r\n\t\t\t# print(LE, label, LE == \"real\")\r\n\t\t\tif LE == \"real\":\r\n\t\t\t\tr, g, b = 0, 255, 0\r\n\t\t\telse:\r\n\t\t\t\tr, g, b = 0, 0, 255\r\n\r\n\t\t\tcv2.putText(frame, label, (startX, startY - 10),\r\n\t\t\t\tcv2.FONT_HERSHEY_SIMPLEX, 0.5, (r, g, b), 2)\r\n\t\t\tcv2.rectangle(frame, (startX, startY), (endX, endY),\r\n\t\t\t\t(r, g, b), 2)\r\n\r\n\r\n\t# show the output frame and wait for a key press\r\n\tcv2.imshow(\"Face Anti-spoofing System [WHU-NERCMS]\", frame)\r\n\tkey = cv2.waitKey(1) & 0xFF\r\n\r\n\t# if the `q` key was pressed, break from the loop\r\n\tif key == ord(\"q\"):\r\n\t\tbreak\r\n\r\n# do a bit of cleanup\r\ncv2.destroyAllWindows()\r\nvs.stop()\r\n```\r\nBUT, when I run it after modification that following your suggestions(`model = load_model(args[\"model\"], custom_objects={'ArcFace': ArcFace})`), i get this error:\r\n\r\n```python\r\nTraceback (most recent call last):\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1659, in _create_c_op\r\n    c_op = c_api.TF_FinishOperation(op_desc)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Dimensions must be equal, but are 10 and 2 for 'arc_face_1/mul' (op: 'Mul') with input shapes: [?,10\r\n], [?,2].\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"liveness_demo.py\", line 46, in <module>\r\n    model = load_model(args[\"model\"], custom_objects={\"ArcFace\": ArcFace})\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\engine\\saving.py\", line 419, in load_model\r\n    model = _deserialize_model(f, custom_objects, compile)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\engine\\saving.py\", line 225, in _deserialize_model\r\n    model = model_from_config(model_config, custom_objects=custom_objects)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\engine\\saving.py\", line 458, in model_from_config\r\n    return deserialize(config, custom_objects=custom_objects)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\layers\\__init__.py\", line 55, in deserialize\r\n    printable_module_name='layer')\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\utils\\generic_utils.py\", line 145, in deserialize_keras_object\r\n    list(custom_objects.items())))\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\engine\\network.py\", line 1032, in from_config\r\n    process_node(layer, node_data)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\engine\\network.py\", line 991, in process_node\r\n    layer(unpack_singleton(input_tensors), **kwargs)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\engine\\base_layer.py\", line 457, in __call__\r\n    output = self.call(inputs, **kwargs)\r\n  File \"F:\\0_Research\\0_MyPaper_LivenessDetection\\CodeLib\\Liveness Detection (Adrian Rosebrock)\\liveness-detection-opencv(test)\\arcface\\metrics.py\", line 42, in c\r\nall\r\n    logits = logits * (1 - y) + target_logits * y\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 812, in binary_op_wrapper\r\n    return func(x, y, name=name)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 1078, in _mul_dispatch\r\n    return gen_math_ops.mul(x, y, name=name)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 6175, in mul\r\n    \"Mul\", x=x, y=y, name=name)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 788, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3300, in create_op\r\n    op_def=op_def)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1823, in __init__\r\n    control_input_ops)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1662, in _create_c_op\r\n    raise ValueError(str(e))\r\nValueError: Dimensions must be equal, but are 10 and 2 for 'arc_face_1/mul' (op: 'Mul') with input shapes: [?,10], [?,2].\r\n```\r\nSo I modify it by this [link](https://stackoverflow.com/questions/42407628/valueerror-dimensions-must-be-equal-but-are-784-and-500-for-mul-op-mul) \r\n\r\nthis code block in the 43 lines of `metrics.py files` \r\n```python\r\n        # original \r\n        #logits = logits * (1 - y) + target_logits * y\r\n        # after modified\r\n        logits = tf.add(tf.matmul(logits, (1-y)), tf.matmul(target_logits, y))\r\n```\r\nand another error occurred:\r\n```python\r\nTraceback (most recent call last):\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1659, in _create_c_op\r\n    c_op = c_api.TF_FinishOperation(op_desc)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Dimension 1 in both shapes must be equal, but are 10 and 2. Shapes are [256,10] and [256,2]. for 'As\r\nsign_30' (op: 'Assign') with input shapes: [256,10], [256,2].\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"liveness_demo.py\", line 46, in <module>\r\n    model = load_model(args[\"model\"], custom_objects={\"ArcFace\": ArcFace})\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\engine\\saving.py\", line 419, in load_model\r\n    model = _deserialize_model(f, custom_objects, compile)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\engine\\saving.py\", line 287, in _deserialize_model\r\n    K.batch_set_value(weight_value_tuples)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\keras\\backend\\tensorflow_backend.py\", line 2465, in batch_set_value\r\n    assign_op = x.assign(assign_placeholder)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\ops\\variables.py\", line 1762, in assign\r\n    name=name)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\ops\\state_ops.py\", line 223, in assign\r\n    validate_shape=validate_shape)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\ops\\gen_state_ops.py\", line 67, in assign\r\n    use_locking=use_locking, name=name)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 788, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3300, in create_op\r\n    op_def=op_def)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1823, in __init__\r\n    control_input_ops)\r\n  File \"D:\\Software_01\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1662, in _create_c_op\r\n    raise ValueError(str(e))\r\nValueError: Dimension 1 in both shapes must be equal, but are 10 and 2. Shapes are [256,10] and [256,2]. for 'Assign_30' (op: 'Assign') with input shapes: [256,10\r\n], [256,2].\r\n```\r\nwhat should I do  something for it? thx! 😭 @4uiiurz1 ","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487545380/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false}},{"id":2306416069,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjMwNjQxNjA2OQ==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2306416069","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-04-29T11:33:06Z","performed_via_github_app":null},{"id":2306416070,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzMDY0MTYwNzA=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2306416070","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-04-29T11:33:06Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487546340","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/2#issuecomment-487546340","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/2","id":487546340,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzU0NjM0MA==","user":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"created_at":"2019-04-29T11:36:47Z","updated_at":"2019-06-26T21:05:47Z","author_association":"OWNER","body":"Please try the following code:\r\n```python\r\nx = Conv2D(32, kernel_size=(3, 3), padding=\"same\", activation=\"relu\")(input)\r\nx = BatchNormalization(axis=chanDim)(x)\r\nx = Conv2D(32, kernel_size=(3, 3), padding=\"same\", activation=\"relu\")(x)\r\nx = BatchNormalization(axis=chanDim)(x)\r\nx = MaxPooling2D(pool_size=(2, 2))(x)\r\nx = Dropout(0.25)(x)\r\n\r\nx = Conv2D(64, kernel_size=(3, 3), padding=\"same\", activation=\"relu\")(x)\r\nx = BatchNormalization(axis=chanDim)(x)\r\nx = Conv2D(64, kernel_size=(3, 3), padding=\"same\", activation=\"relu\")(x)\r\nx = BatchNormalization(axis=chanDim)(x)\r\nx = MaxPooling2D(pool_size=(2, 2))(x)\r\nx = Dropout(0.3)(x)\r\n\r\nx = Flatten()(x)\r\nx = Dense(128, activation=\"relu\")(x)\r\nx = BatchNormalization(axis=chanDim)(x)\r\nx = Dropout(0.4)(x)\r\n\r\noutput = ArcFace(classes)([x, label])\r\nmodel = Model([input, label], output)\r\n\r\nmodel.load_weights(args[\"model\"])\r\n```","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487546340/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487548323","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/2#issuecomment-487548323","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/2","id":487548323,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzU0ODMyMw==","user":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false},"created_at":"2019-04-29T11:45:14Z","updated_at":"2019-04-29T11:45:14Z","author_association":"NONE","body":"I must mention that this python script is a new one called `\"liveness_demo.py\"` used for detecting face and judging the genuine/fake face, instead of the previous training script. Therefore, I think we need not add the model architecture before we load it. ","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487548323/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487601485","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/2#issuecomment-487601485","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/2","id":487601485,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzYwMTQ4NQ==","user":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"created_at":"2019-04-29T14:27:10Z","updated_at":"2019-04-29T14:27:10Z","author_association":"OWNER","body":"If the model contains the original layer, you need to pass the original layer class as custom_objects to **load_model**.\r\nHowever, an error occurs because you can't specify the value of the num_classes of the ArcFace layer.\r\nSo, there are two solutions.\r\n1. Use **load_weights**:\r\n```python\r\nx = Conv2D(32, kernel_size=(3, 3), padding=\"same\", activation=\"relu\")(input)\r\nx = BatchNormalization(axis=chanDim)(x)\r\nx = Conv2D(32, kernel_size=(3, 3), padding=\"same\", activation=\"relu\")(x)\r\nx = BatchNormalization(axis=chanDim)(x)\r\nx = MaxPooling2D(pool_size=(2, 2))(x)\r\nx = Dropout(0.25)(x)\r\n\r\nx = Conv2D(64, kernel_size=(3, 3), padding=\"same\", activation=\"relu\")(x)\r\nx = BatchNormalization(axis=chanDim)(x)\r\nx = Conv2D(64, kernel_size=(3, 3), padding=\"same\", activation=\"relu\")(x)\r\nx = BatchNormalization(axis=chanDim)(x)\r\nx = MaxPooling2D(pool_size=(2, 2))(x)\r\nx = Dropout(0.3)(x)\r\n\r\nx = Flatten()(x)\r\nx = Dense(128, activation=\"relu\")(x)\r\nx = BatchNormalization(axis=chanDim)(x)\r\nx = Dropout(0.4)(x)\r\n\r\noutput = ArcFace(classes)([x, labellabel])\r\nmodel = Model([input, labellabel], output)\r\n\r\nmodel.load_weights(args[\"model\"])\r\n```\r\n\r\n2. Change default num_classes of ArcFace and use **load_model**:\r\n```python\r\nclass ArcFace(Layer):\r\n    def __init__(self, n_classes=2, s=30.0, m=0.50, regularizer=None, **kwargs):\r\n        super(ArcFace, self).__init__(**kwargs)\r\n        self.n_classes = n_classes\r\n        self.s = s\r\n        self.m = m\r\n        self.regularizer = regularizers.get(regularizer)\r\n\r\n    def build(self, input_shape):\r\n        super(ArcFace, self).build(input_shape[0])\r\n        self.W = self.add_weight(name='W',\r\n                                shape=(input_shape[0][-1], self.n_classes),\r\n                                initializer='glorot_uniform',\r\n                                trainable=True,\r\n                                regularizer=self.regularizer)\r\n\r\n    def call(self, inputs):\r\n        x, y = inputs\r\n        c = K.shape(x)[-1]\r\n        # normalize feature\r\n        x = tf.nn.l2_normalize(x, axis=1)\r\n        # normalize weights\r\n        W = tf.nn.l2_normalize(self.W, axis=0)\r\n        # dot product\r\n        logits = x @ W\r\n        # add margin\r\n        # clip logits to prevent zero division when backward\r\n        theta = tf.acos(K.clip(logits, -1.0 + K.epsilon(), 1.0 - K.epsilon()))\r\n        target_logits = tf.cos(theta + self.m)\r\n        # sin = tf.sqrt(1 - logits**2)\r\n        # cos_m = tf.cos(logits)\r\n        # sin_m = tf.sin(logits)\r\n        # target_logits = logits * cos_m - sin * sin_m\r\n        #\r\n        logits = logits * (1 - y) + target_logits * y\r\n        # feature re-scale\r\n        logits *= self.s\r\n        out = tf.nn.softmax(logits)\r\n\r\n        return out\r\n\r\n    def compute_output_shape(self, input_shape):\r\n        return (None, self.n_classes)\r\n\r\nmodel = load_model(args[\"model\"], custom_objects={'ArcFace': ArcFace})\r\n```","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/487601485/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false}},{"id":2306873312,"node_id":"MDEzOlJlb3BlbmVkRXZlbnQyMzA2ODczMzEy","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2306873312","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"reopened","commit_id":null,"commit_url":null,"created_at":"2019-04-29T14:28:20Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/489927669","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/2#issuecomment-489927669","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/2","id":489927669,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4OTkyNzY2OQ==","user":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false},"created_at":"2019-05-07T06:34:57Z","updated_at":"2019-05-07T06:34:57Z","author_association":"NONE","body":"Thank you again, I will have a try for it!","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/489927669/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GewelsJI","id":38354957,"node_id":"MDQ6VXNlcjM4MzU0OTU3","avatar_url":"https://avatars.githubusercontent.com/u/38354957?v=4","gravatar_id":"","url":"https://api.github.com/users/GewelsJI","html_url":"https://github.com/GewelsJI","followers_url":"https://api.github.com/users/GewelsJI/followers","following_url":"https://api.github.com/users/GewelsJI/following{/other_user}","gists_url":"https://api.github.com/users/GewelsJI/gists{/gist_id}","starred_url":"https://api.github.com/users/GewelsJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GewelsJI/subscriptions","organizations_url":"https://api.github.com/users/GewelsJI/orgs","repos_url":"https://api.github.com/users/GewelsJI/repos","events_url":"https://api.github.com/users/GewelsJI/events{/privacy}","received_events_url":"https://api.github.com/users/GewelsJI/received_events","type":"User","site_admin":false}},{"id":2334474206,"node_id":"MDExOkNsb3NlZEV2ZW50MjMzNDQ3NDIwNg==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/2334474206","actor":{"login":"4uiiurz1","id":15384866,"node_id":"MDQ6VXNlcjE1Mzg0ODY2","avatar_url":"https://avatars.githubusercontent.com/u/15384866?v=4","gravatar_id":"","url":"https://api.github.com/users/4uiiurz1","html_url":"https://github.com/4uiiurz1","followers_url":"https://api.github.com/users/4uiiurz1/followers","following_url":"https://api.github.com/users/4uiiurz1/following{/other_user}","gists_url":"https://api.github.com/users/4uiiurz1/gists{/gist_id}","starred_url":"https://api.github.com/users/4uiiurz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/4uiiurz1/subscriptions","organizations_url":"https://api.github.com/users/4uiiurz1/orgs","repos_url":"https://api.github.com/users/4uiiurz1/repos","events_url":"https://api.github.com/users/4uiiurz1/events{/privacy}","received_events_url":"https://api.github.com/users/4uiiurz1/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-05-11T00:25:02Z","state_reason":null,"performed_via_github_app":null}]