[{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/852804996","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/28#issuecomment-852804996","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/28","id":852804996,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MjgwNDk5Ng==","user":{"login":"ozora-ogino","id":63685461,"node_id":"MDQ6VXNlcjYzNjg1NDYx","avatar_url":"https://avatars.githubusercontent.com/u/63685461?v=4","gravatar_id":"","url":"https://api.github.com/users/ozora-ogino","html_url":"https://github.com/ozora-ogino","followers_url":"https://api.github.com/users/ozora-ogino/followers","following_url":"https://api.github.com/users/ozora-ogino/following{/other_user}","gists_url":"https://api.github.com/users/ozora-ogino/gists{/gist_id}","starred_url":"https://api.github.com/users/ozora-ogino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ozora-ogino/subscriptions","organizations_url":"https://api.github.com/users/ozora-ogino/orgs","repos_url":"https://api.github.com/users/ozora-ogino/repos","events_url":"https://api.github.com/users/ozora-ogino/events{/privacy}","received_events_url":"https://api.github.com/users/ozora-ogino/received_events","type":"User","site_admin":false},"created_at":"2021-06-02T07:21:31Z","updated_at":"2021-06-02T07:21:31Z","author_association":"NONE","body":"Hi @farhantandia,\r\nHere is my DNN implementation with ASoftmax\r\n\r\n```\r\nclass DNN(tf.keras.models.Model):\r\n    def __init__(self, num_classes=10):\r\n        super(DNN, self).__init__()\r\n        weight_decay = 1e-4\r\n        self.layer_1 = tf.keras.layers.Dense(32, activation='relu')\r\n        self.layer_2 = tf.keras.layers.Dense(10)\r\n        self.out = ArcFace(n_classes=num_classes, regularizer=regularizers.l2(weight_decay))\r\n\r\n    def call(self, x, training=False):\r\n        if training:\r\n            x, y = x[0], x[1]\r\n        x = self.layer_1(x)\r\n        x = self.layer_2(x)\r\n        if training:\r\n            out = self.out([x, y])\r\n        else:\r\n            # Prediction \r\n            # Thanks to this, you don't need to pass labels to model when you predict\r\n            out = tf.nn.softmax(x @ self.out.W)\r\n        return out\r\n```\r\n\r\nSample code is following;\r\n\r\n```\r\nodel = DNN()\r\noptimizer = tf.keras.optimizers.Adam()\r\nloss = tf.keras.losses.categorical_crossentropy\r\n\r\nmodel.compile(loss=loss, optimizer=optimizer, metrics=['acc'])\r\nmodel.fit([x_train, tf.keras.utils.to_categorical(y_train, 10)], tf.keras.utils.to_categorical(y_train, 10), batch_size=512, epochs=10)\r\n\r\npred = model.predict(x_test)\r\n\r\n```\r\n\r\nI hope it works in your situation.","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/852804996/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ozora-ogino","id":63685461,"node_id":"MDQ6VXNlcjYzNjg1NDYx","avatar_url":"https://avatars.githubusercontent.com/u/63685461?v=4","gravatar_id":"","url":"https://api.github.com/users/ozora-ogino","html_url":"https://github.com/ozora-ogino","followers_url":"https://api.github.com/users/ozora-ogino/followers","following_url":"https://api.github.com/users/ozora-ogino/following{/other_user}","gists_url":"https://api.github.com/users/ozora-ogino/gists{/gist_id}","starred_url":"https://api.github.com/users/ozora-ogino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ozora-ogino/subscriptions","organizations_url":"https://api.github.com/users/ozora-ogino/orgs","repos_url":"https://api.github.com/users/ozora-ogino/repos","events_url":"https://api.github.com/users/ozora-ogino/events{/privacy}","received_events_url":"https://api.github.com/users/ozora-ogino/received_events","type":"User","site_admin":false}},{"id":4829949469,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDgyOTk0OTQ2OQ==","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/4829949469","actor":{"login":"farhantandia","id":17233457,"node_id":"MDQ6VXNlcjE3MjMzNDU3","avatar_url":"https://avatars.githubusercontent.com/u/17233457?v=4","gravatar_id":"","url":"https://api.github.com/users/farhantandia","html_url":"https://github.com/farhantandia","followers_url":"https://api.github.com/users/farhantandia/followers","following_url":"https://api.github.com/users/farhantandia/following{/other_user}","gists_url":"https://api.github.com/users/farhantandia/gists{/gist_id}","starred_url":"https://api.github.com/users/farhantandia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farhantandia/subscriptions","organizations_url":"https://api.github.com/users/farhantandia/orgs","repos_url":"https://api.github.com/users/farhantandia/repos","events_url":"https://api.github.com/users/farhantandia/events{/privacy}","received_events_url":"https://api.github.com/users/farhantandia/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-06-02T07:21:31Z","performed_via_github_app":null},{"id":4829949474,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ4Mjk5NDk0NzQ=","url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/events/4829949474","actor":{"login":"farhantandia","id":17233457,"node_id":"MDQ6VXNlcjE3MjMzNDU3","avatar_url":"https://avatars.githubusercontent.com/u/17233457?v=4","gravatar_id":"","url":"https://api.github.com/users/farhantandia","html_url":"https://github.com/farhantandia","followers_url":"https://api.github.com/users/farhantandia/followers","following_url":"https://api.github.com/users/farhantandia/following{/other_user}","gists_url":"https://api.github.com/users/farhantandia/gists{/gist_id}","starred_url":"https://api.github.com/users/farhantandia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farhantandia/subscriptions","organizations_url":"https://api.github.com/users/farhantandia/orgs","repos_url":"https://api.github.com/users/farhantandia/repos","events_url":"https://api.github.com/users/farhantandia/events{/privacy}","received_events_url":"https://api.github.com/users/farhantandia/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-06-02T07:21:31Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/853047553","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/28#issuecomment-853047553","issue_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/28","id":853047553,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MzA0NzU1Mw==","user":{"login":"ozora-ogino","id":63685461,"node_id":"MDQ6VXNlcjYzNjg1NDYx","avatar_url":"https://avatars.githubusercontent.com/u/63685461?v=4","gravatar_id":"","url":"https://api.github.com/users/ozora-ogino","html_url":"https://github.com/ozora-ogino","followers_url":"https://api.github.com/users/ozora-ogino/followers","following_url":"https://api.github.com/users/ozora-ogino/following{/other_user}","gists_url":"https://api.github.com/users/ozora-ogino/gists{/gist_id}","starred_url":"https://api.github.com/users/ozora-ogino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ozora-ogino/subscriptions","organizations_url":"https://api.github.com/users/ozora-ogino/orgs","repos_url":"https://api.github.com/users/ozora-ogino/repos","events_url":"https://api.github.com/users/ozora-ogino/events{/privacy}","received_events_url":"https://api.github.com/users/ozora-ogino/received_events","type":"User","site_admin":false},"created_at":"2021-06-02T13:53:25Z","updated_at":"2021-06-02T13:53:25Z","author_association":"NONE","body":"I implemented my own ArcFace.\r\nhttps://github.com/ozora-ogino/asoftmax-tf\r\n\r\nThis works correctly and I believe this can solve your problem.","reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/comments/853047553/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ozora-ogino","id":63685461,"node_id":"MDQ6VXNlcjYzNjg1NDYx","avatar_url":"https://avatars.githubusercontent.com/u/63685461?v=4","gravatar_id":"","url":"https://api.github.com/users/ozora-ogino","html_url":"https://github.com/ozora-ogino","followers_url":"https://api.github.com/users/ozora-ogino/followers","following_url":"https://api.github.com/users/ozora-ogino/following{/other_user}","gists_url":"https://api.github.com/users/ozora-ogino/gists{/gist_id}","starred_url":"https://api.github.com/users/ozora-ogino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ozora-ogino/subscriptions","organizations_url":"https://api.github.com/users/ozora-ogino/orgs","repos_url":"https://api.github.com/users/ozora-ogino/repos","events_url":"https://api.github.com/users/ozora-ogino/events{/privacy}","received_events_url":"https://api.github.com/users/ozora-ogino/received_events","type":"User","site_admin":false}}]