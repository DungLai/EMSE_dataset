{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/5","repository_url":"https://api.github.com/repos/4uiiurz1/keras-arcface","labels_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/5/labels{/name}","comments_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/5/comments","events_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/5/events","html_url":"https://github.com/4uiiurz1/keras-arcface/issues/5","id":471475671,"node_id":"MDU6SXNzdWU0NzE0NzU2NzE=","number":5,"title":"How to calculate model.predict accuracy?","user":{"login":"SAyaka0122","id":46623711,"node_id":"MDQ6VXNlcjQ2NjIzNzEx","avatar_url":"https://avatars.githubusercontent.com/u/46623711?v=4","gravatar_id":"","url":"https://api.github.com/users/SAyaka0122","html_url":"https://github.com/SAyaka0122","followers_url":"https://api.github.com/users/SAyaka0122/followers","following_url":"https://api.github.com/users/SAyaka0122/following{/other_user}","gists_url":"https://api.github.com/users/SAyaka0122/gists{/gist_id}","starred_url":"https://api.github.com/users/SAyaka0122/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SAyaka0122/subscriptions","organizations_url":"https://api.github.com/users/SAyaka0122/orgs","repos_url":"https://api.github.com/users/SAyaka0122/repos","events_url":"https://api.github.com/users/SAyaka0122/events{/privacy}","received_events_url":"https://api.github.com/users/SAyaka0122/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-07-23T04:01:48Z","updated_at":"2021-04-27T06:44:34Z","closed_at":"2019-07-23T13:35:39Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\r\nThanks for sharing the great code.\r\nI would like to calculate the accuracy score of model.predict as follow but I don't think it work well.\r\nCould you please let me know how to solve this problem??\r\n\r\n```\r\nimport time\r\nimport os\r\nimport math\r\nimport argparse\r\nfrom glob import glob\r\nfrom collections import OrderedDict\r\nimport random\r\nimport warnings\r\nfrom datetime import datetime\r\nimport joblib\r\nimport matplotlib.pyplot as plt\r\nfrom mpl_toolkits.mplot3d import Axes3D\r\n\r\n\r\nimport numpy as np\r\nimport pandas as pd\r\n\r\nfrom sklearn.model_selection import KFold, StratifiedKFold\r\nfrom sklearn.manifold import TSNE\r\nfrom sklearn.decomposition import PCA\r\nfrom sklearn.metrics import accuracy_score\r\nfrom sklearn import metrics\r\nfrom sklearn.metrics import confusion_matrix\r\n\r\nimport keras\r\nfrom keras.datasets import mnist\r\nfrom keras.preprocessing.image import ImageDataGenerator\r\nfrom keras.models import Sequential, load_model, Model\r\nfrom keras.layers import Dense, Dropout, Activation, Flatten\r\nfrom keras.layers import Conv2D, MaxPooling2D\r\nfrom keras.models import load_model\r\nfrom keras.models import model_from_yaml\r\nfrom keras.optimizers import SGD, Adam\r\nfrom keras.callbacks import EarlyStopping, ModelCheckpoint, ReduceLROnPlateau, CSVLogger, LearningRateScheduler\r\nfrom keras.utils import np_utils\r\n\r\nimport archs\r\nfrom metrics import *\r\nfrom scheduler import *\r\n\r\nimport h5py\r\n\r\n(X, y), (X_test, y_test) = mnist.load_data()\r\n\r\nX = X[:, :, :, np.newaxis].astype('float32') / 255\r\nX_test = X_test[:, :, :, np.newaxis].astype('float32') / 255\r\nprint('X:', X.shape) # X: (60000, 28, 28, 1)\r\nprint('X_test.shape:', X_test.shape)# X_test.shape: (10000, 28, 28, 1)\r\nprint('X_test.ndim:', X_test.ndim)# X_test.ndim: 4\r\ny_ohe = keras.utils.to_categorical(y, 10)\r\nprint('y_ohe:', y_ohe.shape)# y_ohe: (60000, 10)\r\ny_ohe_test = keras.utils.to_categorical(y_test, 10)\r\nprint('y_ohe_test.shape:', y_ohe_test.shape)# y_ohe_test.shape: (10000, 10)\r\nprint('y_ohe_test.ndim:', y_ohe_test.ndim)# y_ohe_test.ndim: 2\r\n\r\narcface_model = load_model('./models/mnist_vgg8_arcface_3d/model.hdf5', custom_objects={'ArcFace': ArcFace})\r\narcface_model = Model(inputs=arcface_model.input[0], outputs=arcface_model.layers[-3].output)\r\nprint('arcface_model.inputs:', arcface_model.inputs)# arcface_model.inputs: [<tf.Tensor 'input_1_11:0' shape=(?, 28, 28, 1) dtype=float32>]\r\nprint('arcface_model.outputs:', arcface_model.outputs)# arcface_model.outputs: [<tf.Tensor 'batch_normalization_8_11/cond/Merge:0' shape=(?, 3) dtype=float32>]\r\narcface_features = arcface_model.predict(X_test, verbose=1)\r\narcface_features /= np.linalg.norm(arcface_features, axis=1, keepdims=True)\r\nprint('arcface_features.shape:', arcface_features.shape)# arcface_features.shape: (10000, 3)\r\n\r\ny_pred=np.argmax(arcface_features, axis=1)\r\nprint('y_pred.shape:', y_pred.shape)# y_pred.shape: (10000,)\r\nprint('y_pred:', y_pred)# y_pred: [0 2 1 ... 0 2 2] # I think this is the cause of problem because there are only 3 dims against 10 classes.\r\ntrue_classes = np.argmax(y_ohe_test, axis=1)\r\nprint('true_classes.shape:', true_classes.shape)# true_classes.shape: (10000,)\r\nprint('true_classes:', true_classes)# true_classes: [7 2 1 ... 4 5 6]\r\n\r\n# display the accuracy\r\naccuracy = accuracy_score(true_classes, y_pred)\r\nprint('{:.2%}'.format(accuracy))# 22.85%\r\n```\r\n\r\nThank you!","closed_by":{"login":"SAyaka0122","id":46623711,"node_id":"MDQ6VXNlcjQ2NjIzNzEx","avatar_url":"https://avatars.githubusercontent.com/u/46623711?v=4","gravatar_id":"","url":"https://api.github.com/users/SAyaka0122","html_url":"https://github.com/SAyaka0122","followers_url":"https://api.github.com/users/SAyaka0122/followers","following_url":"https://api.github.com/users/SAyaka0122/following{/other_user}","gists_url":"https://api.github.com/users/SAyaka0122/gists{/gist_id}","starred_url":"https://api.github.com/users/SAyaka0122/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SAyaka0122/subscriptions","organizations_url":"https://api.github.com/users/SAyaka0122/orgs","repos_url":"https://api.github.com/users/SAyaka0122/repos","events_url":"https://api.github.com/users/SAyaka0122/events{/privacy}","received_events_url":"https://api.github.com/users/SAyaka0122/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/5/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/4uiiurz1/keras-arcface/issues/5/timeline","performed_via_github_app":null,"state_reason":"completed"}