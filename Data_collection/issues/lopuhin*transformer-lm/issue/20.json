{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/20","repository_url":"https://api.github.com/repos/lopuhin/transformer-lm","labels_url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/20/labels{/name}","comments_url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/20/comments","events_url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/20/events","html_url":"https://github.com/lopuhin/transformer-lm/issues/20","id":502876799,"node_id":"MDU6SXNzdWU1MDI4NzY3OTk=","number":20,"title":"\"state_dict\" Mismatch","user":{"login":"nitinnairk","id":19323277,"node_id":"MDQ6VXNlcjE5MzIzMjc3","avatar_url":"https://avatars.githubusercontent.com/u/19323277?v=4","gravatar_id":"","url":"https://api.github.com/users/nitinnairk","html_url":"https://github.com/nitinnairk","followers_url":"https://api.github.com/users/nitinnairk/followers","following_url":"https://api.github.com/users/nitinnairk/following{/other_user}","gists_url":"https://api.github.com/users/nitinnairk/gists{/gist_id}","starred_url":"https://api.github.com/users/nitinnairk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nitinnairk/subscriptions","organizations_url":"https://api.github.com/users/nitinnairk/orgs","repos_url":"https://api.github.com/users/nitinnairk/repos","events_url":"https://api.github.com/users/nitinnairk/events{/privacy}","received_events_url":"https://api.github.com/users/nitinnairk/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-10-04T23:00:03Z","updated_at":"2020-07-20T07:19:41Z","closed_at":"2020-07-20T07:19:41Z","author_association":"NONE","active_lock_reason":null,"body":"Building a base GPT2 model with the below paramerters renders a model that is different (state_dict differs number of params).\r\n`{\r\n  \"initializer_range\": 0.02,\r\n  \"layer_norm_epsilon\": 1e-05,\r\n  \"n_ctx\": 1024,\r\n  \"n_embd\": 768,\r\n  \"n_head\": 12,\r\n  \"n_layer\": 12,\r\n  \"n_positions\": 1024,\r\n  \"vocab_size\": 100\r\n}\r\n`\r\nI'm loading the model trained here on https://github.com/huggingface/transformers.\r\nThe layers missing from the model built using this repo are listed below.\r\n`{'blocks.0.attn.bias',\r\n 'blocks.1.attn.bias',\r\n 'blocks.10.attn.bias',\r\n 'blocks.11.attn.bias',\r\n 'blocks.2.attn.bias',\r\n 'blocks.3.attn.bias',\r\n 'blocks.4.attn.bias',\r\n 'blocks.5.attn.bias',\r\n 'blocks.6.attn.bias',\r\n 'blocks.7.attn.bias',\r\n 'blocks.8.attn.bias',\r\n 'blocks.9.attn.bias'}`\r\n\r\nLayers from model using this repo\r\n`['wpe.weight', 'wte.weight', 'blocks.0.ln_1.g', 'blocks.0.ln_1.b', 'blocks.0.ln_2.g', 'blocks.0.ln_2.b', 'blocks.0.mlp.c_fc.weight', 'blocks.0.mlp.c_fc.bias', 'blocks.0.mlp.c_proj.weight', 'blocks.0.mlp.c_proj.bias', 'blocks.0.attn.c_attn.weight', 'blocks.0.attn.c_attn.bias', 'blocks.0.attn.c_proj.weight', 'blocks.0.attn.c_proj.bias', 'blocks.1.ln_1.g', 'blocks.1.ln_1.b', 'blocks.1.ln_2.g', 'blocks.1.ln_2.b', 'blocks.1.mlp.c_fc.weight', 'blocks.1.mlp.c_fc.bias', 'blocks.1.mlp.c_proj.weight', 'blocks.1.mlp.c_proj.bias', 'blocks.1.attn.c_attn.weight', 'blocks.1.attn.c_attn.bias', 'blocks.1.attn.c_proj.weight', 'blocks.1.attn.c_proj.bias', 'blocks.2.ln_1.g', 'blocks.2.ln_1.b', 'blocks.2.ln_2.g', 'blocks.2.ln_2.b', 'blocks.2.mlp.c_fc.weight', 'blocks.2.mlp.c_fc.bias', 'blocks.2.mlp.c_proj.weight', 'blocks.2.mlp.c_proj.bias', 'blocks.2.attn.c_attn.weight', 'blocks.2.attn.c_attn.bias', 'blocks.2.attn.c_proj.weight', 'blocks.2.attn.c_proj.bias', 'blocks.3.ln_1.g', 'blocks.3.ln_1.b', 'blocks.3.ln_2.g', 'blocks.3.ln_2.b', 'blocks.3.mlp.c_fc.weight', 'blocks.3.mlp.c_fc.bias', 'blocks.3.mlp.c_proj.weight', 'blocks.3.mlp.c_proj.bias', 'blocks.3.attn.c_attn.weight', 'blocks.3.attn.c_attn.bias', 'blocks.3.attn.c_proj.weight', 'blocks.3.attn.c_proj.bias', 'blocks.4.ln_1.g', 'blocks.4.ln_1.b', 'blocks.4.ln_2.g', 'blocks.4.ln_2.b', 'blocks.4.mlp.c_fc.weight', 'blocks.4.mlp.c_fc.bias', 'blocks.4.mlp.c_proj.weight', 'blocks.4.mlp.c_proj.bias', 'blocks.4.attn.c_attn.weight', 'blocks.4.attn.c_attn.bias', 'blocks.4.attn.c_proj.weight', 'blocks.4.attn.c_proj.bias', 'blocks.5.ln_1.g', 'blocks.5.ln_1.b', 'blocks.5.ln_2.g', 'blocks.5.ln_2.b', 'blocks.5.mlp.c_fc.weight', 'blocks.5.mlp.c_fc.bias', 'blocks.5.mlp.c_proj.weight', 'blocks.5.mlp.c_proj.bias', 'blocks.5.attn.c_attn.weight', 'blocks.5.attn.c_attn.bias', 'blocks.5.attn.c_proj.weight', 'blocks.5.attn.c_proj.bias', 'blocks.6.ln_1.g', 'blocks.6.ln_1.b', 'blocks.6.ln_2.g', 'blocks.6.ln_2.b', 'blocks.6.mlp.c_fc.weight', 'blocks.6.mlp.c_fc.bias', 'blocks.6.mlp.c_proj.weight', 'blocks.6.mlp.c_proj.bias', 'blocks.6.attn.c_attn.weight', 'blocks.6.attn.c_attn.bias', 'blocks.6.attn.c_proj.weight', 'blocks.6.attn.c_proj.bias', 'blocks.7.ln_1.g', 'blocks.7.ln_1.b', 'blocks.7.ln_2.g', 'blocks.7.ln_2.b', 'blocks.7.mlp.c_fc.weight', 'blocks.7.mlp.c_fc.bias', 'blocks.7.mlp.c_proj.weight', 'blocks.7.mlp.c_proj.bias', 'blocks.7.attn.c_attn.weight', 'blocks.7.attn.c_attn.bias', 'blocks.7.attn.c_proj.weight', 'blocks.7.attn.c_proj.bias', 'blocks.8.ln_1.g', 'blocks.8.ln_1.b', 'blocks.8.ln_2.g', 'blocks.8.ln_2.b', 'blocks.8.mlp.c_fc.weight', 'blocks.8.mlp.c_fc.bias', 'blocks.8.mlp.c_proj.weight', 'blocks.8.mlp.c_proj.bias', 'blocks.8.attn.c_attn.weight', 'blocks.8.attn.c_attn.bias', 'blocks.8.attn.c_proj.weight', 'blocks.8.attn.c_proj.bias', 'blocks.9.ln_1.g', 'blocks.9.ln_1.b', 'blocks.9.ln_2.g', 'blocks.9.ln_2.b', 'blocks.9.mlp.c_fc.weight', 'blocks.9.mlp.c_fc.bias', 'blocks.9.mlp.c_proj.weight', 'blocks.9.mlp.c_proj.bias', 'blocks.9.attn.c_attn.weight', 'blocks.9.attn.c_attn.bias', 'blocks.9.attn.c_proj.weight', 'blocks.9.attn.c_proj.bias', 'blocks.10.ln_1.g', 'blocks.10.ln_1.b', 'blocks.10.ln_2.g', 'blocks.10.ln_2.b', 'blocks.10.mlp.c_fc.weight', 'blocks.10.mlp.c_fc.bias', 'blocks.10.mlp.c_proj.weight', 'blocks.10.mlp.c_proj.bias', 'blocks.10.attn.c_attn.weight', 'blocks.10.attn.c_attn.bias', 'blocks.10.attn.c_proj.weight', 'blocks.10.attn.c_proj.bias', 'blocks.11.ln_1.g', 'blocks.11.ln_1.b', 'blocks.11.ln_2.g', 'blocks.11.ln_2.b', 'blocks.11.mlp.c_fc.weight', 'blocks.11.mlp.c_fc.bias', 'blocks.11.mlp.c_proj.weight', 'blocks.11.mlp.c_proj.bias', 'blocks.11.attn.c_attn.weight', 'blocks.11.attn.c_attn.bias', 'blocks.11.attn.c_proj.weight', 'blocks.11.attn.c_proj.bias', 'ln_f.g', 'ln_f.b']\r\n`\r\nTotal count: 148\r\n\r\n\r\nLayers from the huggingface repo\r\n`[\"wte.weight\", \"wpe.weight\", \"h.0.ln_1.weight\", \"h.0.ln_1.bias\", \"h.0.attn.bias\", \"h.0.attn.c_attn.weight\", \"h.0.attn.c_attn.bias\", \"h.0.attn.c_proj.weight\", \"h.0.attn.c_proj.bias\", \"h.0.ln_2.weight\", \"h.0.ln_2.bias\", \"h.0.mlp.c_fc.weight\", \"h.0.mlp.c_fc.bias\", \"h.0.mlp.c_proj.weight\", \"h.0.mlp.c_proj.bias\", \"h.1.ln_1.weight\", \"h.1.ln_1.bias\", \"h.1.attn.bias\", \"h.1.attn.c_attn.weight\", \"h.1.attn.c_attn.bias\", \"h.1.attn.c_proj.weight\", \"h.1.attn.c_proj.bias\", \"h.1.ln_2.weight\", \"h.1.ln_2.bias\", \"h.1.mlp.c_fc.weight\", \"h.1.mlp.c_fc.bias\", \"h.1.mlp.c_proj.weight\", \"h.1.mlp.c_proj.bias\", \"h.2.ln_1.weight\", \"h.2.ln_1.bias\", \"h.2.attn.bias\", \"h.2.attn.c_attn.weight\", \"h.2.attn.c_attn.bias\", \"h.2.attn.c_proj.weight\", \"h.2.attn.c_proj.bias\", \"h.2.ln_2.weight\", \"h.2.ln_2.bias\", \"h.2.mlp.c_fc.weight\", \"h.2.mlp.c_fc.bias\", \"h.2.mlp.c_proj.weight\", \"h.2.mlp.c_proj.bias\", \"h.3.ln_1.weight\", \"h.3.ln_1.bias\", \"h.3.attn.bias\", \"h.3.attn.c_attn.weight\", \"h.3.attn.c_attn.bias\", \"h.3.attn.c_proj.weight\", \"h.3.attn.c_proj.bias\", \"h.3.ln_2.weight\", \"h.3.ln_2.bias\", \"h.3.mlp.c_fc.weight\", \"h.3.mlp.c_fc.bias\", \"h.3.mlp.c_proj.weight\", \"h.3.mlp.c_proj.bias\", \"h.4.ln_1.weight\", \"h.4.ln_1.bias\", \"h.4.attn.bias\", \"h.4.attn.c_attn.weight\", \"h.4.attn.c_attn.bias\", \"h.4.attn.c_proj.weight\", \"h.4.attn.c_proj.bias\", \"h.4.ln_2.weight\", \"h.4.ln_2.bias\", \"h.4.mlp.c_fc.weight\", \"h.4.mlp.c_fc.bias\", \"h.4.mlp.c_proj.weight\", \"h.4.mlp.c_proj.bias\", \"h.5.ln_1.weight\", \"h.5.ln_1.bias\", \"h.5.attn.bias\", \"h.5.attn.c_attn.weight\", \"h.5.attn.c_attn.bias\", \"h.5.attn.c_proj.weight\", \"h.5.attn.c_proj.bias\", \"h.5.ln_2.weight\", \"h.5.ln_2.bias\", \"h.5.mlp.c_fc.weight\", \"h.5.mlp.c_fc.bias\", \"h.5.mlp.c_proj.weight\", \"h.5.mlp.c_proj.bias\", \"h.6.ln_1.weight\", \"h.6.ln_1.bias\", \"h.6.attn.bias\", \"h.6.attn.c_attn.weight\", \"h.6.attn.c_attn.bias\", \"h.6.attn.c_proj.weight\", \"h.6.attn.c_proj.bias\", \"h.6.ln_2.weight\", \"h.6.ln_2.bias\", \"h.6.mlp.c_fc.weight\", \"h.6.mlp.c_fc.bias\", \"h.6.mlp.c_proj.weight\", \"h.6.mlp.c_proj.bias\", \"h.7.ln_1.weight\", \"h.7.ln_1.bias\", \"h.7.attn.bias\", \"h.7.attn.c_attn.weight\", \"h.7.attn.c_attn.bias\", \"h.7.attn.c_proj.weight\", \"h.7.attn.c_proj.bias\", \"h.7.ln_2.weight\", \"h.7.ln_2.bias\", \"h.7.mlp.c_fc.weight\", \"h.7.mlp.c_fc.bias\", \"h.7.mlp.c_proj.weight\", \"h.7.mlp.c_proj.bias\", \"h.8.ln_1.weight\", \"h.8.ln_1.bias\", \"h.8.attn.bias\", \"h.8.attn.c_attn.weight\", \"h.8.attn.c_attn.bias\", \"h.8.attn.c_proj.weight\", \"h.8.attn.c_proj.bias\", \"h.8.ln_2.weight\", \"h.8.ln_2.bias\", \"h.8.mlp.c_fc.weight\", \"h.8.mlp.c_fc.bias\", \"h.8.mlp.c_proj.weight\", \"h.8.mlp.c_proj.bias\", \"h.9.ln_1.weight\", \"h.9.ln_1.bias\", \"h.9.attn.bias\", \"h.9.attn.c_attn.weight\", \"h.9.attn.c_attn.bias\", \"h.9.attn.c_proj.weight\", \"h.9.attn.c_proj.bias\", \"h.9.ln_2.weight\", \"h.9.ln_2.bias\", \"h.9.mlp.c_fc.weight\", \"h.9.mlp.c_fc.bias\", \"h.9.mlp.c_proj.weight\", \"h.9.mlp.c_proj.bias\", \"h.10.ln_1.weight\", \"h.10.ln_1.bias\", \"h.10.attn.bias\", \"h.10.attn.c_attn.weight\", \"h.10.attn.c_attn.bias\", \"h.10.attn.c_proj.weight\", \"h.10.attn.c_proj.bias\", \"h.10.ln_2.weight\", \"h.10.ln_2.bias\", \"h.10.mlp.c_fc.weight\", \"h.10.mlp.c_fc.bias\", \"h.10.mlp.c_proj.weight\", \"h.10.mlp.c_proj.bias\", \"h.11.ln_1.weight\", \"h.11.ln_1.bias\", \"h.11.attn.bias\", \"h.11.attn.c_attn.weight\", \"h.11.attn.c_attn.bias\", \"h.11.attn.c_proj.weight\", \"h.11.attn.c_proj.bias\", \"h.11.ln_2.weight\", \"h.11.ln_2.bias\", \"h.11.mlp.c_fc.weight\", \"h.11.mlp.c_fc.bias\", \"h.11.mlp.c_proj.weight\", \"h.11.mlp.c_proj.bias\", \"ln_f.weight\", \"ln_f.bias\"]`\r\nTotal count:160\r\n","closed_by":{"login":"lopuhin","id":424613,"node_id":"MDQ6VXNlcjQyNDYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/424613?v=4","gravatar_id":"","url":"https://api.github.com/users/lopuhin","html_url":"https://github.com/lopuhin","followers_url":"https://api.github.com/users/lopuhin/followers","following_url":"https://api.github.com/users/lopuhin/following{/other_user}","gists_url":"https://api.github.com/users/lopuhin/gists{/gist_id}","starred_url":"https://api.github.com/users/lopuhin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lopuhin/subscriptions","organizations_url":"https://api.github.com/users/lopuhin/orgs","repos_url":"https://api.github.com/users/lopuhin/repos","events_url":"https://api.github.com/users/lopuhin/events{/privacy}","received_events_url":"https://api.github.com/users/lopuhin/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/20/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/20/timeline","performed_via_github_app":null,"state_reason":"completed"}