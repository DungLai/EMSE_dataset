[{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/512213934","html_url":"https://github.com/lopuhin/transformer-lm/issues/10#issuecomment-512213934","issue_url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/10","id":512213934,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjIxMzkzNA==","user":{"login":"gooofy","id":6418859,"node_id":"MDQ6VXNlcjY0MTg4NTk=","avatar_url":"https://avatars.githubusercontent.com/u/6418859?v=4","gravatar_id":"","url":"https://api.github.com/users/gooofy","html_url":"https://github.com/gooofy","followers_url":"https://api.github.com/users/gooofy/followers","following_url":"https://api.github.com/users/gooofy/following{/other_user}","gists_url":"https://api.github.com/users/gooofy/gists{/gist_id}","starred_url":"https://api.github.com/users/gooofy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gooofy/subscriptions","organizations_url":"https://api.github.com/users/gooofy/orgs","repos_url":"https://api.github.com/users/gooofy/repos","events_url":"https://api.github.com/users/gooofy/events{/privacy}","received_events_url":"https://api.github.com/users/gooofy/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T11:26:15Z","updated_at":"2019-07-17T11:26:15Z","author_association":"CONTRIBUTOR","body":"humm - interesting! :o) \r\n\r\na bit of debug output could be enlightening here - could you apply this patch and run again?\r\n\r\n```\r\ndiff --git a/lm/inference.py b/lm/inference.py\r\nindex 8768cb7..5a4b78b 100644\r\n--- a/lm/inference.py\r\n+++ b/lm/inference.py\r\n@@ -78,6 +78,8 @@ class ModelWrapper:\r\n \r\n     def generate_tokens(self, tokens_prefix: List[str], tokens_to_generate: int, top_k: int) -> List[str]:\r\n \r\n+        print (\"self.model.hparams.n_ctx: %d, tokens_to_generate: %d\" % (self.model.hparams.n_ctx, tokens_to_generate))\r\n+\r\n         tokens = list(tokens_prefix)\r\n \r\n         for i in range(tokens_to_generate):\r\n@@ -92,7 +94,7 @@ class ModelWrapper:\r\n             # pick next token randomly according to probs distribution\r\n             next_token_n = np.random.choice(top_k, p=probs)\r\n             next_token = ntk[next_token_n][1]\r\n-            # print (next_token)\r\n+            print (\"Token # %d: %s\" % (i, next_token))\r\n             \r\n             tokens.append(next_token)\r\n\r\n``` \r\n\r\n\r\noutput should look similar to this:\r\n\r\n```\r\n(torch) [bofh@hal transformer-lm]$ gpt-2-gen gpt2-german \"Ursula von der Leyen\"\r\nloading model from gpt2-german\r\ngenerating text for prefix Ursula von der Leyen\r\nself.model.hparams.n_ctx: 1024, tokens_to_generate: 42\r\nToken # 0: ▁im\r\nToken # 1: ▁Bundestag\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/512213934/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"gooofy","id":6418859,"node_id":"MDQ6VXNlcjY0MTg4NTk=","avatar_url":"https://avatars.githubusercontent.com/u/6418859?v=4","gravatar_id":"","url":"https://api.github.com/users/gooofy","html_url":"https://github.com/gooofy","followers_url":"https://api.github.com/users/gooofy/followers","following_url":"https://api.github.com/users/gooofy/following{/other_user}","gists_url":"https://api.github.com/users/gooofy/gists{/gist_id}","starred_url":"https://api.github.com/users/gooofy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gooofy/subscriptions","organizations_url":"https://api.github.com/users/gooofy/orgs","repos_url":"https://api.github.com/users/gooofy/repos","events_url":"https://api.github.com/users/gooofy/events{/privacy}","received_events_url":"https://api.github.com/users/gooofy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/512216320","html_url":"https://github.com/lopuhin/transformer-lm/issues/10#issuecomment-512216320","issue_url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/10","id":512216320,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjIxNjMyMA==","user":{"login":"strumke","id":14290984,"node_id":"MDQ6VXNlcjE0MjkwOTg0","avatar_url":"https://avatars.githubusercontent.com/u/14290984?v=4","gravatar_id":"","url":"https://api.github.com/users/strumke","html_url":"https://github.com/strumke","followers_url":"https://api.github.com/users/strumke/followers","following_url":"https://api.github.com/users/strumke/following{/other_user}","gists_url":"https://api.github.com/users/strumke/gists{/gist_id}","starred_url":"https://api.github.com/users/strumke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strumke/subscriptions","organizations_url":"https://api.github.com/users/strumke/orgs","repos_url":"https://api.github.com/users/strumke/repos","events_url":"https://api.github.com/users/strumke/events{/privacy}","received_events_url":"https://api.github.com/users/strumke/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T11:34:52Z","updated_at":"2019-07-17T11:34:52Z","author_association":"NONE","body":"Hi, and thanks a lot for the quick reply. Please see my output below\n\n➜  transformer-lm git:(master) ✗ gpt-2-gen tests/shakespeare-test-run\n\"Artificial intelligence\"\nloading model from tests/shakespeare-test-run\ngenerating text for prefix Artificial intelligence\nself.model.hparams.n_ctx: 48, tokens_to_generate: 42\nToken # 0: <endofline>\nToken # 1: ,\nToken # 2: ▁I\nToken # 3: ,\nToken # 4: '\nToken # 5: .\nToken # 6: ▁the\nToken # 7: ,\nToken # 8: <endofline>\nToken # 9: ,\nToken # 10: ▁and\nToken # 11: .\nToken # 12: <endofline>\nToken # 13: <endofline>\nToken # 14: .\nToken # 15: <endofline>\nToken # 16: ,\nToken # 17: ▁the\nToken # 18: ▁the\nToken # 19: <endofline>\nToken # 20: ▁the\nToken # 21: '\nToken # 22: '\nToken # 23: '\nToken # 24: ,\nToken # 25: <endofline>\nToken # 26: .\nToken # 27: ▁the\nToken # 28: <endofline>\nToken # 29: <endofline>\nToken # 30: ,\nToken # 31: <endofline>\nToken # 32: ▁I\nToken # 33: ,\nToken # 34: <endofline>\nToken # 35: ▁and\nToken # 36: ▁the\nToken # 37: <endofline>\nToken # 38: <endofline>\nToken # 39: ,\nTraceback (most recent call last):\n  File \"/Users/.../anaconda3/bin/gpt-2-gen\", line 11, in <module>\n    load_entry_point('lm', 'console_scripts', 'gpt-2-gen')()\n  File \"/Users/.../transformer-lm/lm/inference.py\", line 123, in\nfire_gen_main\n    fire.Fire(only_allow_defined_args(gen_main))\n  File \"/Users/.../anaconda3/lib/python3.7/site-packages/fire/core.py\",\nline 127, in Fire\n    component_trace = _Fire(component, args, context, name)\n  File \"/Users/.../anaconda3/lib/python3.7/site-packages/fire/core.py\",\nline 366, in _Fire\n    component, remaining_args)\n  File \"/Users/.../anaconda3/lib/python3.7/site-packages/fire/core.py\",\nline 542, in _CallCallable\n    result = fn(*varargs, **kwargs)\n  File \"/Users/.../transformer-lm/lm/fire_utils.py\", line 30, in\n_return_wrapped\n    return function_to_decorate(*args, **kwargs)\n  File \"/Users/.../transformer-lm/lm/inference.py\", line 119, in gen_main\n    tokens_gen = mw.generate_tokens(tokens, tokens_to_generate, top_k)\n  File \"/Users/.../transformer-lm/lm/inference.py\", line 88, in\ngenerate_tokens\n    ntk = self.get_next_top_k(tokens, top_k)\n  File \"/Users/.../transformer-lm/lm/inference.py\", line 74, in\nget_next_top_k\n    next_log_probs = self.get_log_probs(tokens)[-1]\n  File \"/Users/.../transformer-lm/lm/inference.py\", line 51, in\nget_log_probs\n    assert len(tokens) <= self.model.hparams.n_ctx  # TODO\nAssertionError\n\nIt does strike me as strange that there is a #TODO at exactly that place ^^\n\nOn Wed, 17 Jul 2019 at 13:26, Guenter Bartsch <notifications@github.com>\nwrote:\n\n> humm - interesting! :o)\n>\n> a bit of debug output could be enlightening here - could you apply this\n> patch and run again?\n>\n> diff --git a/lm/inference.py b/lm/inference.py\n>\n> index 8768cb7..5a4b78b 100644\n>\n> --- a/lm/inference.py\n>\n> +++ b/lm/inference.py\n>\n> @@ -78,6 +78,8 @@ class ModelWrapper:\n>\n>\n>\n>      def generate_tokens(self, tokens_prefix: List[str], tokens_to_generate: int, top_k: int) -> List[str]:\n>\n>\n>\n> +        print (\"self.model.hparams.n_ctx: %d, tokens_to_generate: %d\" % (self.model.hparams.n_ctx, tokens_to_generate))\n>\n> +\n>\n>          tokens = list(tokens_prefix)\n>\n>\n>\n>          for i in range(tokens_to_generate):\n>\n> @@ -92,7 +94,7 @@ class ModelWrapper:\n>\n>              # pick next token randomly according to probs distribution\n>\n>              next_token_n = np.random.choice(top_k, p=probs)\n>\n>              next_token = ntk[next_token_n][1]\n>\n> -            # print (next_token)\n>\n> +            print (\"Token # %d: %s\" % (i, next_token))\n>\n>\n>\n>              tokens.append(next_token)\n>\n>\n>\n>\n> output should look similar to this:\n>\n> (torch) [bofh@hal transformer-lm]$ gpt-2-gen gpt2-german \"Ursula von der Leyen\"\n>\n> loading model from gpt2-german\n>\n> generating text for prefix Ursula von der Leyen\n>\n> self.model.hparams.n_ctx: 1024, tokens_to_generate: 42\n>\n> Token # 0: ▁im\n>\n> Token # 1: ▁Bundestag\n>\n>\n>\n>\n> —\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/lopuhin/transformer-lm/issues/10?email_source=notifications&email_token=ADNBAKCPLLZ6KITNGTCQJUTP736VPA5CNFSM4IENZY62YY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGOD2D4HLQ#issuecomment-512213934>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/ADNBAKDYED2BKAGGVWNNSNLP736VPANCNFSM4IENZY6Q>\n> .\n>\n\n\n-- \nVennlig hilsen / Kind regards,\nInga Strümke (inga@strumke.com)\n","reactions":{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/512216320/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"strumke","id":14290984,"node_id":"MDQ6VXNlcjE0MjkwOTg0","avatar_url":"https://avatars.githubusercontent.com/u/14290984?v=4","gravatar_id":"","url":"https://api.github.com/users/strumke","html_url":"https://github.com/strumke","followers_url":"https://api.github.com/users/strumke/followers","following_url":"https://api.github.com/users/strumke/following{/other_user}","gists_url":"https://api.github.com/users/strumke/gists{/gist_id}","starred_url":"https://api.github.com/users/strumke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strumke/subscriptions","organizations_url":"https://api.github.com/users/strumke/orgs","repos_url":"https://api.github.com/users/strumke/repos","events_url":"https://api.github.com/users/strumke/events{/privacy}","received_events_url":"https://api.github.com/users/strumke/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/512219212","html_url":"https://github.com/lopuhin/transformer-lm/issues/10#issuecomment-512219212","issue_url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/10","id":512219212,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjIxOTIxMg==","user":{"login":"gooofy","id":6418859,"node_id":"MDQ6VXNlcjY0MTg4NTk=","avatar_url":"https://avatars.githubusercontent.com/u/6418859?v=4","gravatar_id":"","url":"https://api.github.com/users/gooofy","html_url":"https://github.com/gooofy","followers_url":"https://api.github.com/users/gooofy/followers","following_url":"https://api.github.com/users/gooofy/following{/other_user}","gists_url":"https://api.github.com/users/gooofy/gists{/gist_id}","starred_url":"https://api.github.com/users/gooofy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gooofy/subscriptions","organizations_url":"https://api.github.com/users/gooofy/orgs","repos_url":"https://api.github.com/users/gooofy/repos","events_url":"https://api.github.com/users/gooofy/events{/privacy}","received_events_url":"https://api.github.com/users/gooofy/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T11:45:12Z","updated_at":"2019-07-17T11:45:12Z","author_association":"CONTRIBUTOR","body":"not sure about the TODO (my best guess would be that a nicer error message could be an improvement there), but the real issue seems to be the model you're using which has a pretty small context length?\r\n\r\nTry to generate fewer tokens (--tokens-to-generate 38) to see if that works.","reactions":{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/512219212/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"gooofy","id":6418859,"node_id":"MDQ6VXNlcjY0MTg4NTk=","avatar_url":"https://avatars.githubusercontent.com/u/6418859?v=4","gravatar_id":"","url":"https://api.github.com/users/gooofy","html_url":"https://github.com/gooofy","followers_url":"https://api.github.com/users/gooofy/followers","following_url":"https://api.github.com/users/gooofy/following{/other_user}","gists_url":"https://api.github.com/users/gooofy/gists{/gist_id}","starred_url":"https://api.github.com/users/gooofy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gooofy/subscriptions","organizations_url":"https://api.github.com/users/gooofy/orgs","repos_url":"https://api.github.com/users/gooofy/repos","events_url":"https://api.github.com/users/gooofy/events{/privacy}","received_events_url":"https://api.github.com/users/gooofy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/512220080","html_url":"https://github.com/lopuhin/transformer-lm/issues/10#issuecomment-512220080","issue_url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/10","id":512220080,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjIyMDA4MA==","user":{"login":"strumke","id":14290984,"node_id":"MDQ6VXNlcjE0MjkwOTg0","avatar_url":"https://avatars.githubusercontent.com/u/14290984?v=4","gravatar_id":"","url":"https://api.github.com/users/strumke","html_url":"https://github.com/strumke","followers_url":"https://api.github.com/users/strumke/followers","following_url":"https://api.github.com/users/strumke/following{/other_user}","gists_url":"https://api.github.com/users/strumke/gists{/gist_id}","starred_url":"https://api.github.com/users/strumke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strumke/subscriptions","organizations_url":"https://api.github.com/users/strumke/orgs","repos_url":"https://api.github.com/users/strumke/repos","events_url":"https://api.github.com/users/strumke/events{/privacy}","received_events_url":"https://api.github.com/users/strumke/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T11:48:01Z","updated_at":"2019-07-17T11:48:01Z","author_association":"NONE","body":"Great, that works:\nArtificial intelligence, the I and I, and,.,..,, and and',s the\n\nYes, very good, Shakespeare.\n\nOne last thing: what determines the context length of the model (set during\ntraining, I presume?)?\n\nThanks a bunch!\n\nOn Wed, 17 Jul 2019 at 13:45, Guenter Bartsch <notifications@github.com>\nwrote:\n\n> not sure about the TODO (my best guess would be that a nicer error message\n> could be an improvement there), but the real issue seems to be the model\n> you're using which has a pretty small context length?\n>\n> Try to generate fewer tokens (--tokens-to-generate 38) to see if that\n> works.\n>\n> —\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/lopuhin/transformer-lm/issues/10?email_source=notifications&email_token=ADNBAKDUNCMV4HKPYKDGVQLP74A4TA5CNFSM4IENZY62YY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGOD2D5QTA#issuecomment-512219212>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/ADNBAKGCSF4JIJZGFL5ADG3P74A4TANCNFSM4IENZY6Q>\n> .\n>\n\n\n-- \nVennlig hilsen / Kind regards,\nInga Strümke (inga@strumke.com)\n","reactions":{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/512220080/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"strumke","id":14290984,"node_id":"MDQ6VXNlcjE0MjkwOTg0","avatar_url":"https://avatars.githubusercontent.com/u/14290984?v=4","gravatar_id":"","url":"https://api.github.com/users/strumke","html_url":"https://github.com/strumke","followers_url":"https://api.github.com/users/strumke/followers","following_url":"https://api.github.com/users/strumke/following{/other_user}","gists_url":"https://api.github.com/users/strumke/gists{/gist_id}","starred_url":"https://api.github.com/users/strumke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strumke/subscriptions","organizations_url":"https://api.github.com/users/strumke/orgs","repos_url":"https://api.github.com/users/strumke/repos","events_url":"https://api.github.com/users/strumke/events{/privacy}","received_events_url":"https://api.github.com/users/strumke/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/512281463","html_url":"https://github.com/lopuhin/transformer-lm/issues/10#issuecomment-512281463","issue_url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/10","id":512281463,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjI4MTQ2Mw==","user":{"login":"gooofy","id":6418859,"node_id":"MDQ6VXNlcjY0MTg4NTk=","avatar_url":"https://avatars.githubusercontent.com/u/6418859?v=4","gravatar_id":"","url":"https://api.github.com/users/gooofy","html_url":"https://github.com/gooofy","followers_url":"https://api.github.com/users/gooofy/followers","following_url":"https://api.github.com/users/gooofy/following{/other_user}","gists_url":"https://api.github.com/users/gooofy/gists{/gist_id}","starred_url":"https://api.github.com/users/gooofy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gooofy/subscriptions","organizations_url":"https://api.github.com/users/gooofy/orgs","repos_url":"https://api.github.com/users/gooofy/repos","events_url":"https://api.github.com/users/gooofy/events{/privacy}","received_events_url":"https://api.github.com/users/gooofy/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T14:31:59Z","updated_at":"2019-07-17T14:31:59Z","author_association":"CONTRIBUTOR","body":"yes, the context length is a model hyperparameter - see <model>/params.json","reactions":{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/512281463/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"gooofy","id":6418859,"node_id":"MDQ6VXNlcjY0MTg4NTk=","avatar_url":"https://avatars.githubusercontent.com/u/6418859?v=4","gravatar_id":"","url":"https://api.github.com/users/gooofy","html_url":"https://github.com/gooofy","followers_url":"https://api.github.com/users/gooofy/followers","following_url":"https://api.github.com/users/gooofy/following{/other_user}","gists_url":"https://api.github.com/users/gooofy/gists{/gist_id}","starred_url":"https://api.github.com/users/gooofy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gooofy/subscriptions","organizations_url":"https://api.github.com/users/gooofy/orgs","repos_url":"https://api.github.com/users/gooofy/repos","events_url":"https://api.github.com/users/gooofy/events{/privacy}","received_events_url":"https://api.github.com/users/gooofy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/512334416","html_url":"https://github.com/lopuhin/transformer-lm/issues/10#issuecomment-512334416","issue_url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/10","id":512334416,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjMzNDQxNg==","user":{"login":"strumke","id":14290984,"node_id":"MDQ6VXNlcjE0MjkwOTg0","avatar_url":"https://avatars.githubusercontent.com/u/14290984?v=4","gravatar_id":"","url":"https://api.github.com/users/strumke","html_url":"https://github.com/strumke","followers_url":"https://api.github.com/users/strumke/followers","following_url":"https://api.github.com/users/strumke/following{/other_user}","gists_url":"https://api.github.com/users/strumke/gists{/gist_id}","starred_url":"https://api.github.com/users/strumke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strumke/subscriptions","organizations_url":"https://api.github.com/users/strumke/orgs","repos_url":"https://api.github.com/users/strumke/repos","events_url":"https://api.github.com/users/strumke/events{/privacy}","received_events_url":"https://api.github.com/users/strumke/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T15:37:12Z","updated_at":"2019-07-22T06:53:35Z","author_association":"NONE","body":"Great, thank you so much for helping me!","reactions":{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/512334416/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"strumke","id":14290984,"node_id":"MDQ6VXNlcjE0MjkwOTg0","avatar_url":"https://avatars.githubusercontent.com/u/14290984?v=4","gravatar_id":"","url":"https://api.github.com/users/strumke","html_url":"https://github.com/strumke","followers_url":"https://api.github.com/users/strumke/followers","following_url":"https://api.github.com/users/strumke/following{/other_user}","gists_url":"https://api.github.com/users/strumke/gists{/gist_id}","starred_url":"https://api.github.com/users/strumke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strumke/subscriptions","organizations_url":"https://api.github.com/users/strumke/orgs","repos_url":"https://api.github.com/users/strumke/repos","events_url":"https://api.github.com/users/strumke/events{/privacy}","received_events_url":"https://api.github.com/users/strumke/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/562526224","html_url":"https://github.com/lopuhin/transformer-lm/issues/10#issuecomment-562526224","issue_url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/10","id":562526224,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MjUyNjIyNA==","user":{"login":"hbajohr","id":20578427,"node_id":"MDQ6VXNlcjIwNTc4NDI3","avatar_url":"https://avatars.githubusercontent.com/u/20578427?v=4","gravatar_id":"","url":"https://api.github.com/users/hbajohr","html_url":"https://github.com/hbajohr","followers_url":"https://api.github.com/users/hbajohr/followers","following_url":"https://api.github.com/users/hbajohr/following{/other_user}","gists_url":"https://api.github.com/users/hbajohr/gists{/gist_id}","starred_url":"https://api.github.com/users/hbajohr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hbajohr/subscriptions","organizations_url":"https://api.github.com/users/hbajohr/orgs","repos_url":"https://api.github.com/users/hbajohr/repos","events_url":"https://api.github.com/users/hbajohr/events{/privacy}","received_events_url":"https://api.github.com/users/hbajohr/received_events","type":"User","site_admin":false},"created_at":"2019-12-06T10:49:58Z","updated_at":"2019-12-06T10:49:58Z","author_association":"NONE","body":"So does that mean that unless I retrain the model with a higher context length, I cannot generate any output longer than 48 characters? Or is there a way to do that without retraining? ","reactions":{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/562526224/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"hbajohr","id":20578427,"node_id":"MDQ6VXNlcjIwNTc4NDI3","avatar_url":"https://avatars.githubusercontent.com/u/20578427?v=4","gravatar_id":"","url":"https://api.github.com/users/hbajohr","html_url":"https://github.com/hbajohr","followers_url":"https://api.github.com/users/hbajohr/followers","following_url":"https://api.github.com/users/hbajohr/following{/other_user}","gists_url":"https://api.github.com/users/hbajohr/gists{/gist_id}","starred_url":"https://api.github.com/users/hbajohr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hbajohr/subscriptions","organizations_url":"https://api.github.com/users/hbajohr/orgs","repos_url":"https://api.github.com/users/hbajohr/repos","events_url":"https://api.github.com/users/hbajohr/events{/privacy}","received_events_url":"https://api.github.com/users/hbajohr/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/562563256","html_url":"https://github.com/lopuhin/transformer-lm/issues/10#issuecomment-562563256","issue_url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/10","id":562563256,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MjU2MzI1Ng==","user":{"login":"lopuhin","id":424613,"node_id":"MDQ6VXNlcjQyNDYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/424613?v=4","gravatar_id":"","url":"https://api.github.com/users/lopuhin","html_url":"https://github.com/lopuhin","followers_url":"https://api.github.com/users/lopuhin/followers","following_url":"https://api.github.com/users/lopuhin/following{/other_user}","gists_url":"https://api.github.com/users/lopuhin/gists{/gist_id}","starred_url":"https://api.github.com/users/lopuhin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lopuhin/subscriptions","organizations_url":"https://api.github.com/users/lopuhin/orgs","repos_url":"https://api.github.com/users/lopuhin/repos","events_url":"https://api.github.com/users/lopuhin/events{/privacy}","received_events_url":"https://api.github.com/users/lopuhin/received_events","type":"User","site_admin":false},"created_at":"2019-12-06T13:03:53Z","updated_at":"2019-12-06T13:03:53Z","author_association":"OWNER","body":"@ceprun for reference, 48 is number of tokens, not characters, and default values for gpt-2 are much larger than that - 48 is just for the integration test. Still there is some context length, but you can still generate contexts which are larger in length in theory, say context length is 4, so you generate:\r\n```\r\ninput | output\r\n-----------------\r\ns     | a\r\ns a   | b\r\ns a b | c\r\na b c | d\r\nb c d | e\r\n```\r\nI hope idea is clear - you truncate previously generated text on the right when feeding as context.","reactions":{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/562563256/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lopuhin","id":424613,"node_id":"MDQ6VXNlcjQyNDYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/424613?v=4","gravatar_id":"","url":"https://api.github.com/users/lopuhin","html_url":"https://github.com/lopuhin","followers_url":"https://api.github.com/users/lopuhin/followers","following_url":"https://api.github.com/users/lopuhin/following{/other_user}","gists_url":"https://api.github.com/users/lopuhin/gists{/gist_id}","starred_url":"https://api.github.com/users/lopuhin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lopuhin/subscriptions","organizations_url":"https://api.github.com/users/lopuhin/orgs","repos_url":"https://api.github.com/users/lopuhin/repos","events_url":"https://api.github.com/users/lopuhin/events{/privacy}","received_events_url":"https://api.github.com/users/lopuhin/received_events","type":"User","site_admin":false}},{"id":2861294920,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjg2MTI5NDkyMA==","url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/events/2861294920","actor":{"login":"hbajohr","id":20578427,"node_id":"MDQ6VXNlcjIwNTc4NDI3","avatar_url":"https://avatars.githubusercontent.com/u/20578427?v=4","gravatar_id":"","url":"https://api.github.com/users/hbajohr","html_url":"https://github.com/hbajohr","followers_url":"https://api.github.com/users/hbajohr/followers","following_url":"https://api.github.com/users/hbajohr/following{/other_user}","gists_url":"https://api.github.com/users/hbajohr/gists{/gist_id}","starred_url":"https://api.github.com/users/hbajohr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hbajohr/subscriptions","organizations_url":"https://api.github.com/users/hbajohr/orgs","repos_url":"https://api.github.com/users/hbajohr/repos","events_url":"https://api.github.com/users/hbajohr/events{/privacy}","received_events_url":"https://api.github.com/users/hbajohr/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-12-06T13:03:54Z","performed_via_github_app":null},{"id":2861294921,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI4NjEyOTQ5MjE=","url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/events/2861294921","actor":{"login":"hbajohr","id":20578427,"node_id":"MDQ6VXNlcjIwNTc4NDI3","avatar_url":"https://avatars.githubusercontent.com/u/20578427?v=4","gravatar_id":"","url":"https://api.github.com/users/hbajohr","html_url":"https://github.com/hbajohr","followers_url":"https://api.github.com/users/hbajohr/followers","following_url":"https://api.github.com/users/hbajohr/following{/other_user}","gists_url":"https://api.github.com/users/hbajohr/gists{/gist_id}","starred_url":"https://api.github.com/users/hbajohr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hbajohr/subscriptions","organizations_url":"https://api.github.com/users/hbajohr/orgs","repos_url":"https://api.github.com/users/hbajohr/repos","events_url":"https://api.github.com/users/hbajohr/events{/privacy}","received_events_url":"https://api.github.com/users/hbajohr/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-12-06T13:03:54Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/665810102","html_url":"https://github.com/lopuhin/transformer-lm/issues/10#issuecomment-665810102","issue_url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/10","id":665810102,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NTgxMDEwMg==","user":{"login":"hafsabukhary","id":16378547,"node_id":"MDQ6VXNlcjE2Mzc4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/16378547?v=4","gravatar_id":"","url":"https://api.github.com/users/hafsabukhary","html_url":"https://github.com/hafsabukhary","followers_url":"https://api.github.com/users/hafsabukhary/followers","following_url":"https://api.github.com/users/hafsabukhary/following{/other_user}","gists_url":"https://api.github.com/users/hafsabukhary/gists{/gist_id}","starred_url":"https://api.github.com/users/hafsabukhary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hafsabukhary/subscriptions","organizations_url":"https://api.github.com/users/hafsabukhary/orgs","repos_url":"https://api.github.com/users/hafsabukhary/repos","events_url":"https://api.github.com/users/hafsabukhary/events{/privacy}","received_events_url":"https://api.github.com/users/hafsabukhary/received_events","type":"User","site_admin":false},"created_at":"2020-07-29T17:53:39Z","updated_at":"2020-07-29T17:53:39Z","author_association":"NONE","body":"I have n-ctx  = 1024 still facing the assertion error\r\n\r\n`\r\nAssertionError                            Traceback (most recent call last)\r\n<ipython-input-22-1c090fe8fbbf> in <module>()\r\n     25 \r\n     26 #f  = open(output_csv, \"a+\", encoding='utf-8')\r\n---> 27 tokens=mw.generate_tokens(txt,30,3)\r\n     28 \r\n     29 st =mw.sp_model.DecodePieces(tokens)\r\n\r\n10 frames\r\n<ipython-input-21-b8d27b30645b> in generate_tokens(self, tokens_prefix, tokens_to_generate, top_k, top_p, temperature)\r\n    145             if top_p <= 0.0:\r\n    146                 # generate TOP_K potential next tokens\r\n--> 147                 ntk, presents = self._get_next_top_k(tokens, top_k, past=past)\r\n    148 \r\n    149                 # convert log probs to real probs\r\n\r\n<ipython-input-21-b8d27b30645b> in _get_next_top_k(self, tokens, top_k, past)\r\n     98             past: Optional[torch.Tensor],\r\n     99             ) -> Tuple[List[Tuple[float, str]], torch.Tensor]:\r\n--> 100         next_log_probs, presents = self._get_log_probs(tokens, past=past)\r\n    101         next_log_probs = next_log_probs[-1]\r\n    102         result = sorted(\r\n\r\n<ipython-input-21-b8d27b30645b> in _get_log_probs(self, tokens, past)\r\n     71         ctx = torch.LongTensor(ids).unsqueeze(0)\r\n     72         with torch.no_grad():\r\n---> 73             output = self.model(ctx, past=past)\r\n     74             logits = output['logits'].squeeze(0)\r\n     75             return torch.log_softmax(logits, dim=1), output['presents']\r\n\r\n/usr/local/lib/python3.6/dist-packages/torch/nn/modules/module.py in __call__(self, *input, **kwargs)\r\n    548             result = self._slow_forward(*input, **kwargs)\r\n    549         else:\r\n--> 550             result = self.forward(*input, **kwargs)\r\n    551         for hook in self._forward_hooks.values():\r\n    552             hook_result = hook(self, input, result)\r\n\r\n/content/drive/My Drive/Colab Notebooks/transformer-lm/lm/model.py in forward(self, x, past)\r\n     51         for i, block in enumerate(self.blocks):\r\n     52             if self.hparams.gradient_checkpointing:\r\n---> 53                 h, present = torch.utils.checkpoint.checkpoint(block, h, past[:, i] if past is not None else None)\r\n     54             else:\r\n     55                 h, present = block(h, past=past[:, i] if past is not None else None)\r\n\r\n/usr/local/lib/python3.6/dist-packages/torch/utils/checkpoint.py in checkpoint(function, *args, **kwargs)\r\n    153         raise ValueError(\"Unexpected keyword arguments: \" + \",\".join(arg for arg in kwargs))\r\n    154 \r\n--> 155     return CheckpointFunction.apply(function, preserve, *args)\r\n    156 \r\n    157 \r\n\r\n/usr/local/lib/python3.6/dist-packages/torch/utils/checkpoint.py in forward(ctx, run_function, preserve_rng_state, *args)\r\n     72         ctx.save_for_backward(*args)\r\n     73         with torch.no_grad():\r\n---> 74             outputs = run_function(*args)\r\n     75         return outputs\r\n     76 \r\n\r\n/usr/local/lib/python3.6/dist-packages/torch/nn/modules/module.py in __call__(self, *input, **kwargs)\r\n    548             result = self._slow_forward(*input, **kwargs)\r\n    549         else:\r\n--> 550             result = self.forward(*input, **kwargs)\r\n    551         for hook in self._forward_hooks.values():\r\n    552             hook_result = hook(self, input, result)\r\n\r\n/content/drive/My Drive/Colab Notebooks/transformer-lm/lm/model.py in forward(self, x, past)\r\n     77 \r\n     78     def forward(self, x, past):\r\n---> 79         a, present = self.attn(self.ln_1(x), past=past)\r\n     80         x = x + a\r\n     81         m = self.mlp(self.ln_2(x))\r\n\r\n/usr/local/lib/python3.6/dist-packages/torch/nn/modules/module.py in __call__(self, *input, **kwargs)\r\n    548             result = self._slow_forward(*input, **kwargs)\r\n    549         else:\r\n--> 550             result = self.forward(*input, **kwargs)\r\n    551         for hook in self._forward_hooks.values():\r\n    552             hook_result = hook(self, input, result)\r\n\r\n/content/drive/My Drive/Colab Notebooks/transformer-lm/lm/model.py in forward(self, x, past)\r\n    129             # Should be [batch, 2, heads, sequence, features], where 2 is [k, v]\r\n    130             assert len(past.shape) == 5\r\n--> 131             assert past.shape[-1] == self.hparams.n_hidden\r\n    132         c = self.c_attn(x)\r\n    133         q, k, v = map(self.split_heads, torch.split(c, x.shape[-1], dim=2))\r\n\r\nAssertionError: \r\n`","reactions":{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/665810102/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"hafsabukhary","id":16378547,"node_id":"MDQ6VXNlcjE2Mzc4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/16378547?v=4","gravatar_id":"","url":"https://api.github.com/users/hafsabukhary","html_url":"https://github.com/hafsabukhary","followers_url":"https://api.github.com/users/hafsabukhary/followers","following_url":"https://api.github.com/users/hafsabukhary/following{/other_user}","gists_url":"https://api.github.com/users/hafsabukhary/gists{/gist_id}","starred_url":"https://api.github.com/users/hafsabukhary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hafsabukhary/subscriptions","organizations_url":"https://api.github.com/users/hafsabukhary/orgs","repos_url":"https://api.github.com/users/hafsabukhary/repos","events_url":"https://api.github.com/users/hafsabukhary/events{/privacy}","received_events_url":"https://api.github.com/users/hafsabukhary/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/666312991","html_url":"https://github.com/lopuhin/transformer-lm/issues/10#issuecomment-666312991","issue_url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/10","id":666312991,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NjMxMjk5MQ==","user":{"login":"lopuhin","id":424613,"node_id":"MDQ6VXNlcjQyNDYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/424613?v=4","gravatar_id":"","url":"https://api.github.com/users/lopuhin","html_url":"https://github.com/lopuhin","followers_url":"https://api.github.com/users/lopuhin/followers","following_url":"https://api.github.com/users/lopuhin/following{/other_user}","gists_url":"https://api.github.com/users/lopuhin/gists{/gist_id}","starred_url":"https://api.github.com/users/lopuhin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lopuhin/subscriptions","organizations_url":"https://api.github.com/users/lopuhin/orgs","repos_url":"https://api.github.com/users/lopuhin/repos","events_url":"https://api.github.com/users/lopuhin/events{/privacy}","received_events_url":"https://api.github.com/users/lopuhin/received_events","type":"User","site_admin":false},"created_at":"2020-07-30T11:36:14Z","updated_at":"2020-07-30T11:36:14Z","author_association":"OWNER","body":"@hafsabukhary aha this is a different error, assert is not correct indeed, it was fixed recently in https://github.com/lopuhin/transformer-lm/commit/4c18649391826c2b1590e722b9559fa5f72ced8e - so it should work once you update to recent master. Also check out updated ``generate_tokens`` method - now it implements more efficient generation using \"past\" (which is what you are doing here it seems).","reactions":{"url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/comments/666312991/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lopuhin","id":424613,"node_id":"MDQ6VXNlcjQyNDYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/424613?v=4","gravatar_id":"","url":"https://api.github.com/users/lopuhin","html_url":"https://github.com/lopuhin","followers_url":"https://api.github.com/users/lopuhin/followers","following_url":"https://api.github.com/users/lopuhin/following{/other_user}","gists_url":"https://api.github.com/users/lopuhin/gists{/gist_id}","starred_url":"https://api.github.com/users/lopuhin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lopuhin/subscriptions","organizations_url":"https://api.github.com/users/lopuhin/orgs","repos_url":"https://api.github.com/users/lopuhin/repos","events_url":"https://api.github.com/users/lopuhin/events{/privacy}","received_events_url":"https://api.github.com/users/lopuhin/received_events","type":"User","site_admin":false}},{"id":3603398711,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzYwMzM5ODcxMQ==","url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/events/3603398711","actor":{"login":"hafsabukhary","id":16378547,"node_id":"MDQ6VXNlcjE2Mzc4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/16378547?v=4","gravatar_id":"","url":"https://api.github.com/users/hafsabukhary","html_url":"https://github.com/hafsabukhary","followers_url":"https://api.github.com/users/hafsabukhary/followers","following_url":"https://api.github.com/users/hafsabukhary/following{/other_user}","gists_url":"https://api.github.com/users/hafsabukhary/gists{/gist_id}","starred_url":"https://api.github.com/users/hafsabukhary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hafsabukhary/subscriptions","organizations_url":"https://api.github.com/users/hafsabukhary/orgs","repos_url":"https://api.github.com/users/hafsabukhary/repos","events_url":"https://api.github.com/users/hafsabukhary/events{/privacy}","received_events_url":"https://api.github.com/users/hafsabukhary/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-07-30T11:36:14Z","performed_via_github_app":null},{"id":3603398713,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM2MDMzOTg3MTM=","url":"https://api.github.com/repos/lopuhin/transformer-lm/issues/events/3603398713","actor":{"login":"hafsabukhary","id":16378547,"node_id":"MDQ6VXNlcjE2Mzc4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/16378547?v=4","gravatar_id":"","url":"https://api.github.com/users/hafsabukhary","html_url":"https://github.com/hafsabukhary","followers_url":"https://api.github.com/users/hafsabukhary/followers","following_url":"https://api.github.com/users/hafsabukhary/following{/other_user}","gists_url":"https://api.github.com/users/hafsabukhary/gists{/gist_id}","starred_url":"https://api.github.com/users/hafsabukhary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hafsabukhary/subscriptions","organizations_url":"https://api.github.com/users/hafsabukhary/orgs","repos_url":"https://api.github.com/users/hafsabukhary/repos","events_url":"https://api.github.com/users/hafsabukhary/events{/privacy}","received_events_url":"https://api.github.com/users/hafsabukhary/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-07-30T11:36:14Z","performed_via_github_app":null}]