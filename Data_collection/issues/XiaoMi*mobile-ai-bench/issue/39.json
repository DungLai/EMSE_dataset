{"url":"https://api.github.com/repos/XiaoMi/mobile-ai-bench/issues/39","repository_url":"https://api.github.com/repos/XiaoMi/mobile-ai-bench","labels_url":"https://api.github.com/repos/XiaoMi/mobile-ai-bench/issues/39/labels{/name}","comments_url":"https://api.github.com/repos/XiaoMi/mobile-ai-bench/issues/39/comments","events_url":"https://api.github.com/repos/XiaoMi/mobile-ai-bench/issues/39/events","html_url":"https://github.com/XiaoMi/mobile-ai-bench/issues/39","id":590808680,"node_id":"MDU6SXNzdWU1OTA4MDg2ODA=","number":39,"title":"can't use TFLITE NCNN  in a sda845 through adb.","user":{"login":"WangFengtu1996","id":21277368,"node_id":"MDQ6VXNlcjIxMjc3MzY4","avatar_url":"https://avatars.githubusercontent.com/u/21277368?v=4","gravatar_id":"","url":"https://api.github.com/users/WangFengtu1996","html_url":"https://github.com/WangFengtu1996","followers_url":"https://api.github.com/users/WangFengtu1996/followers","following_url":"https://api.github.com/users/WangFengtu1996/following{/other_user}","gists_url":"https://api.github.com/users/WangFengtu1996/gists{/gist_id}","starred_url":"https://api.github.com/users/WangFengtu1996/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WangFengtu1996/subscriptions","organizations_url":"https://api.github.com/users/WangFengtu1996/orgs","repos_url":"https://api.github.com/users/WangFengtu1996/repos","events_url":"https://api.github.com/users/WangFengtu1996/events{/privacy}","received_events_url":"https://api.github.com/users/WangFengtu1996/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-03-31T05:33:21Z","updated_at":"2020-03-31T05:33:21Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"HI,all \r\nI want to run the mobile-ai-bench in android sda845 and use TFlite and NCNN to measure the performance of inference.\r\n```My device:\r\nabi: arm64-v8a,armeabi-v7a,armeabi\r\nsdk:27\r\nandroid version: 8.1.0\r\n```\r\n\r\nwhen I run the command```bash tools/benchmark.sh --benchmark_option=Performance --executors=NCNN  --target_abis=armeabi-v7a,arm64-v8a```, I get the error\r\n```\r\nINFO: Found 1 target...\r\nTarget //aibench/python:benchmark up-to-date:\r\n  bazel-bin/aibench/python/benchmark\r\nINFO: Elapsed time: 0.574s, Critical Path: 0.01s\r\nFind qualcomm adb device:5bc6606e\r\nNo Arm linux device yaml file\r\nPrepare to run models on armeabi-v7a\r\nEqual checksum with output/benchmark.pb and /data/local/tmp/aibench/benchmark.pb\r\nEqual checksum with output/model.pb and /data/local/tmp/aibench/model.pb\r\nEqual checksum with output/mobilenet.param and /data/local/tmp/aibench/mobilenet.param\r\nEqual checksum with output/mobilenet_v2.param and /data/local/tmp/aibench/mobilenet_v2.param\r\nEqual checksum with output/inception_v3.param and /data/local/tmp/aibench/inception_v3.param\r\nEqual checksum with output/squeezenet.param and /data/local/tmp/aibench/squeezenet.param\r\n* Build //aibench/benchmark:model_benchmark for NCNN with ABI armeabi-v7a\r\nWARNING: The major revision of the Android NDK referenced by android_ndk_repository rule 'androidndk' is 15. The major revisions supported by Bazel are [10, 11, 12, 13, 14]. Defaulting to revision 14.\r\nERROR: /home/ubuntu/workspace/benchmark_tool/source_code/mobile-ai-bench/aibench/executors/BUILD:87:1: no such package '@ncnn//': Error extracting /home/ubuntu/.cache/bazel/_bazel_wang/486fc9acf5761970e8f8cbc79af240fd/external/ncnn/ncnn-20180830.zip to /home/ubuntu/.cache/bazel/_bazel_wang/486fc9acf5761970e8f8cbc79af240fd/external/ncnn: Zip entries cannot refer to files outside of their directory: ncnn-20180830.zip has a symlink to ../../squeezenet_v1.1.bin and referenced by '//aibench/executors:ncnn_executor'.\r\nERROR: Analysis of target '//aibench/benchmark:model_benchmark' failed; build aborted.\r\nINFO: Elapsed time: 9.747s\r\nTraceback (most recent call last):\r\n  File \"/home/ubuntu/workspace/benchmark_tool/source_code/mobile-ai-bench/bazel-bin/aibench/python/benchmark.runfiles/aibench/aibench/python/benchmark.py\", line 354, in <module>\r\n    main(unused_args=[sys.argv[0]] + unparsed)\r\n  File \"/home/ubuntu/workspace/benchmark_tool/source_code/mobile-ai-bench/bazel-bin/aibench/python/benchmark.runfiles/aibench/aibench/python/benchmark.py\", line 343, in main\r\n    benchmark_option, benchmark_list, result_files,)\r\n  File \"/home/ubuntu/workspace/benchmark_tool/source_code/mobile-ai-bench/bazel-bin/aibench/python/benchmark.runfiles/aibench/aibench/python/benchmark.py\", line 261, in run_on_device\r\n    avail_device_types)\r\n  File \"/home/ubuntu/workspace/benchmark_tool/source_code/mobile-ai-bench/aibench/python/bench_engine.py\", line 117, in bazel_build\r\n    *bazel_args)\r\n  File \"/home/ubuntu/anaconda3/envs/mobile-ai-bench_env/lib/python2.7/site-packages/sh.py\", line 1413, in __call__\r\n    raise exc\r\nsh.ErrorReturnCode_1: \r\n\r\n  RAN: /home/ubuntu/bin/bazel build //aibench/benchmark:model_benchmark --config android --cpu=armeabi-v7a --action_env=ANDROID_NDK_HOME=/home/ubuntu/Android/ndk/android-ndk-r15c --define ncnn=true\r\n\r\n  STDOUT:\r\n\r\n\r\n  STDERR:\r\n\r\n```\r\nwhen I run the command```bash tools/benchmark.sh --benchmark_option=Performance --executors=TFLITE  --target_abis=armeabi-v7a,arm64-v8a```\r\nI also get the error\r\n```\r\nINFO: Found 1 target...\r\nTarget //aibench/python:benchmark up-to-date:\r\n  bazel-bin/aibench/python/benchmark\r\nINFO: Elapsed time: 0.539s, Critical Path: 0.01s\r\nFind qualcomm adb device:5bc6606e\r\nNo Arm linux device yaml file\r\nPrepare to run models on armeabi-v7a\r\nEqual checksum with output/benchmark.pb and /data/local/tmp/aibench/benchmark.pb\r\nEqual checksum with output/model.pb and /data/local/tmp/aibench/model.pb\r\nEqual checksum with output/mobilenet_v1_1.0_224.tflite and /data/local/tmp/aibench/mobilenet_v1_1.0_224.tflite\r\nEqual checksum with output/mobilenet_v2_1.0_224.tflite and /data/local/tmp/aibench/mobilenet_v2_1.0_224.tflite\r\nEqual checksum with output/inception_v3.tflite and /data/local/tmp/aibench/inception_v3.tflite\r\nEqual checksum with output/mobilenet_quant_v1_224.tflite and /data/local/tmp/aibench/mobilenet_quant_v1_224.tflite\r\nEqual checksum with output/mobilenet_v2_1.0_224_quant.tflite and /data/local/tmp/aibench/mobilenet_v2_1.0_224_quant.tflite\r\nEqual checksum with output/inception_v3_quant.tflite and /data/local/tmp/aibench/inception_v3_quant.tflite\r\n* Build //aibench/benchmark:model_benchmark for TFLITE with ABI armeabi-v7a\r\nWARNING: The major revision of the Android NDK referenced by android_ndk_repository rule 'androidndk' is 15. The major revisions supported by Bazel are [10, 11, 12, 13, 14]. Defaulting to revision 14.\r\nINFO: Found 1 target...\r\nERROR: /home/ubuntu/workspace/benchmark_tool/source_code/mobile-ai-bench/aibench/benchmark/BUILD:52:1: Linking of rule '//aibench/benchmark:model_benchmark' failed (Exit 1): clang failed: error executing command \r\n  (cd /home/ubuntu/.cache/bazel/_bazel_wang/486fc9acf5761970e8f8cbc79af240fd/execroot/aibench && \\\r\n  exec env - \\\r\n    ANDROID_NDK_HOME=/home/ubuntu/Android/ndk/android-ndk-r15c \\\r\n    LD_LIBRARY_PATH=/home/ubuntu/workspace/test_ws/devel/lib:/home/ubuntu/workspace/ros/devel/lib:/opt/ros/kinetic/lib:/home/ubuntu/workspace/awaken_project/demo/libs/x64/ \\\r\n    PATH=/home/ubuntu/.cargo/bin:/opt/ros/kinetic/bin:/home/ubuntu/.cargo/bin:/home/ubuntu/anaconda3/envs/mobile-ai-bench_env/bin:/home/ubuntu/Downloads/DeepLearning/android-ndk-r17c:/home/ubuntu/.cargo/bin:/home/ubuntu/anaconda3/condabin:/home/ubuntu/.cargo/bin:/home/ubuntu/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/usr/lib/gcc/gcc-arm-none-eabi-7-2017-q4-major/bin:/home/ubuntu/Downloads/DeepLearning/android-ndk-r17c:/home/ubuntu/Downloads/DeepLearning/android-ndk-r17c:/home/ubuntu/Downloads/DeepLearning/android-ndk-r17c \\\r\n    PWD=/proc/self/cwd \\\r\n  external/androidndk/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/clang -o bazel-out/arm-linux-androideabi-clang3.8-v7a-gnu-libstdcpp-opt/bin/aibench/benchmark/model_benchmark '-Wl,-rpath,$EXEC_ORIGIN/../../_solib_armeabi-v7a/_U@opencv_S_S_Copencv_Uarmeabi-v7a___Uexternal_Sopencv_Slibs_Sarmeabi-v7a' '-Wl,-rpath,$EXEC_ORIGIN/../../_solib_armeabi-v7a/_U_S_Sthird_Uparty_Stflite_Ctflite_Uarmeabi-v7a___Uthird_Uparty_Stflite_Stensorflow_Slite_Slib_Sarmeabi-v7a' -Lbazel-out/arm-linux-androideabi-clang3.8-v7a-gnu-libstdcpp-opt/bin/_solib_armeabi-v7a/_U@opencv_S_S_Copencv_Uarmeabi-v7a___Uexternal_Sopencv_Slibs_Sarmeabi-v7a -Lbazel-out/arm-linux-androideabi-clang3.8-v7a-gnu-libstdcpp-opt/bin/_solib_armeabi-v7a/_U_S_Sthird_Uparty_Stflite_Ctflite_Uarmeabi-v7a___Uthird_Uparty_Stflite_Stensorflow_Slite_Slib_Sarmeabi-v7a bazel-out/arm-linux-androideabi-clang3.8-v7a-gnu-libstdcpp-opt/bin/aibench/benchmark/_objs/model_benchmark/aibench/benchmark/benchmark_main.o -Wl,-whole-archive bazel-out/arm-linux-androideabi-clang3.8-v7a-gnu-libstdcpp-opt/bin/aibench/benchmark/libbenchmark.lo -Wl,-no-whole-archive bazel-out/arm-linux-androideabi-clang3.8-v7a-gnu-libstdcpp-opt/bin/external/mace/mace/utils/libutils.a -lopencv_java4 bazel-out/arm-linux-androideabi-clang3.8-v7a-gnu-libstdcpp-opt/bin/external/com_github_gflags_gflags/libgflags_nothreads.a bazel-out/arm-linux-androideabi-clang3.8-v7a-gnu-libstdcpp-opt/bin/aibench/executors/libtflite_executor.a bazel-out/arm-linux-androideabi-clang3.8-v7a-gnu-libstdcpp-opt/bin/aibench/executors/libbase_executor.a bazel-out/arm-linux-androideabi-clang3.8-v7a-gnu-libstdcpp-opt/bin/aibench/proto/libaibench_proto_cc.a bazel-out/arm-linux-androideabi-clang3.8-v7a-gnu-libstdcpp-opt/bin/external/com_google_protobuf/libprotobuf_lite.a -ltensorflowLite external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/libs/armeabi-v7a/libgnustl_static.a external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/libs/armeabi-v7a/libsupc++.a -fopenmp -ldl -pie -lm -llog -lz -ldl -lm -llog -static-libgcc -gcc-toolchain external/androidndk/ndk/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64 -no-canonical-prefixes -target armv7-none-linux-androideabi -Wl,--fix-cortex-a8 -Wl,--strip-all -Wl,--gc-sections -Wl,--strip-all -Wl,--gc-sections '--sysroot=external/androidndk/ndk/platforms/android-24/arch-arm')\r\n\r\nUse --sandbox_debug to see verbose messages from the sandbox.\r\naibench/executors/tflite/tflite_executor.cc:47: error: undefined reference to 'tflite::InterpreterBuilder::operator()(std::unique_ptr<tflite::Interpreter, std::default_delete<tflite::Interpreter> >*)'\r\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\r\nTarget //aibench/benchmark:model_benchmark failed to build\r\nINFO: Elapsed time: 2.346s, Critical Path: 0.85s\r\nTraceback (most recent call last):\r\n  File \"/home/ubuntu/workspace/benchmark_tool/source_code/mobile-ai-bench/bazel-bin/aibench/python/benchmark.runfiles/aibench/aibench/python/benchmark.py\", line 354, in <module>\r\n    main(unused_args=[sys.argv[0]] + unparsed)\r\n  File \"/home/ubuntu/workspace/benchmark_tool/source_code/mobile-ai-bench/bazel-bin/aibench/python/benchmark.runfiles/aibench/aibench/python/benchmark.py\", line 343, in main\r\n    benchmark_option, benchmark_list, result_files,)\r\n  File \"/home/ubuntu/workspace/benchmark_tool/source_code/mobile-ai-bench/bazel-bin/aibench/python/benchmark.runfiles/aibench/aibench/python/benchmark.py\", line 261, in run_on_device\r\n    avail_device_types)\r\n  File \"/home/ubuntu/workspace/benchmark_tool/source_code/mobile-ai-bench/aibench/python/bench_engine.py\", line 117, in bazel_build\r\n    *bazel_args)\r\n  File \"/home/ubuntu/anaconda3/envs/mobile-ai-bench_env/lib/python2.7/site-packages/sh.py\", line 1413, in __call__\r\n    raise exc\r\nsh.ErrorReturnCode_1: \r\n\r\n  RAN: /home/ubuntu/bin/bazel build //aibench/benchmark:model_benchmark --config android --cpu=armeabi-v7a --action_env=ANDROID_NDK_HOME=/home/ubuntu/Android/ndk/android-ndk-r15c --define tflite=true\r\n\r\n  STDOUT:\r\n\r\n\r\n  STDERR:\r\n\r\n```\r\nThanks for your time.","closed_by":null,"reactions":{"url":"https://api.github.com/repos/XiaoMi/mobile-ai-bench/issues/39/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/XiaoMi/mobile-ai-bench/issues/39/timeline","performed_via_github_app":null,"state_reason":null}