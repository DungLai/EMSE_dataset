{"url":"https://api.github.com/repos/XiaoMi/mobile-ai-bench/issues/10","repository_url":"https://api.github.com/repos/XiaoMi/mobile-ai-bench","labels_url":"https://api.github.com/repos/XiaoMi/mobile-ai-bench/issues/10/labels{/name}","comments_url":"https://api.github.com/repos/XiaoMi/mobile-ai-bench/issues/10/comments","events_url":"https://api.github.com/repos/XiaoMi/mobile-ai-bench/issues/10/events","html_url":"https://github.com/XiaoMi/mobile-ai-bench/issues/10","id":355132500,"node_id":"MDU6SXNzdWUzNTUxMzI1MDA=","number":10,"title":"Build failed with Mi Note 3","user":{"login":"ysh329","id":7320657,"node_id":"MDQ6VXNlcjczMjA2NTc=","avatar_url":"https://avatars.githubusercontent.com/u/7320657?v=4","gravatar_id":"","url":"https://api.github.com/users/ysh329","html_url":"https://github.com/ysh329","followers_url":"https://api.github.com/users/ysh329/followers","following_url":"https://api.github.com/users/ysh329/following{/other_user}","gists_url":"https://api.github.com/users/ysh329/gists{/gist_id}","starred_url":"https://api.github.com/users/ysh329/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ysh329/subscriptions","organizations_url":"https://api.github.com/users/ysh329/orgs","repos_url":"https://api.github.com/users/ysh329/repos","events_url":"https://api.github.com/users/ysh329/events{/privacy}","received_events_url":"https://api.github.com/users/ysh329/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-08-29T12:15:48Z","updated_at":"2018-08-30T12:14:57Z","closed_at":"2018-08-30T12:14:57Z","author_association":"NONE","active_lock_reason":null,"body":"Thanks in advance. ðŸ™‡ \r\n\r\n## 1. My Installation Step\r\n\r\n1. cloned `mobile-ai-bench` in docker image `registry.cn-hangzhou.aliyuncs.com/xiaomimace/mace-dev` on my cross-compile machine using commands below:\r\n```shell\r\ndocker pull registry.cn-hangzhou.aliyuncs.com/xiaomimace/mace-dev\r\ndocker run -it --privileged -d --name mace-dev \\\r\n           -v /dev/bus/usb:/dev/bus/usb --net=host \\\r\n           -v /local/path:/container/path \\\r\n           -v /usr/bin/docker:/usr/bin/docker \\\r\n           -v /var/run/docker.sock:/var/run/docker.sock \\\r\n           registry.cn-hangzhou.aliyuncs.com/xiaomimace/mace-dev\r\n``` \r\n2. downloaded snpe-1.8.0 and unzip to `/opt` as below:\r\n```shell\r\nroot@cross-compile:/opt# ls\r\nandroid-ndk-r12b  android-ndk-r16   mobile-ai-bench  snpe-1.18.0\r\nandroid-ndk-r15c  android-ndk-r17b  sdk              snpe-1.18.0.zip\r\n```\r\n3. edit snpe in WORKSPACE as below:\r\n```shell\r\n# You need to comment following new_http_archive and uncomment following           \r\n# new_local_repository to benchmark SNPE                                           \r\n#new_http_archive(                                                                 \r\n#    name = \"snpe\",                                                                \r\n#    build_file = \"third_party/snpe/snpe.BUILD\",                                   \r\n#    sha256 = \"b11780e5e7f591e916c69bdface4a1ef75b0c19f7b43c868bd62c0f3747d3fbb\",\r\n#    strip_prefix = \"snpe-1.15.0\",                                                 \r\n#    urls = [                                                                      \r\n#        \"https://cnbj1-fds.api.xiaomi.net/aibench/third_party/snpe-1.15.0.zip\",\r\n#    ],                                                                            \r\n#)                                                                                 \r\n# You need to uncomment following new_local_repository and comment foregoing       \r\n# new_http_archive to benchmark SNPE                                               \r\nnew_local_repository(                                                              \r\n    name = \"snpe\",                                                                 \r\n    build_file = \"third_party/snpe/snpe.BUILD\",                                    \r\n    path = \"/opt/snpe-1.18.0\",                                                     \r\n)\r\n```\r\n\r\n## 2. Issues\r\n\r\nBut build failed with 3 issues:  \r\n1. Does mobile devices need to be root?\r\n```shell\r\nadbd cannot run as root in production builds\r\nNot running as root. Try \"adb root\" first.\r\nstop: must be root\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu7/online: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor: Permission denied\r\n......\r\n......\r\n```\r\n2. No such file or directory\r\n```shell\r\n/system/bin/sh: can't create /sys/class/devfreq/soc:qcom,l3-cdsp/governor: No such file or directory\r\n```\r\n3. unused DT entry: type 0xf arg 0xf81\r\n```shell\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n('snpe', 'CPU', 'MobileNetV2')\r\n```\r\n## 3. Error Logs\r\n\r\nI execute `python ./tools/benchmark.py --frameworks=snpe` in mace-dev container as below:\r\n\r\n```shell\r\nroot@cross-compile:/opt/mobile-ai-bench# python ./tools/benchmark.py --frameworks=snpe\r\nPrepare to run models on armeabi-v7a\r\n* Build //aibench/benchmark:model_benchmark with ABI armeabi-v7a\r\n/system/lib/libcdsprpc.so does not exists! Skip DSP.\r\nINFO: Analysed target //aibench/benchmark:model_benchmark (17 packages loaded).\r\nINFO: Found 1 target...\r\n[6 / 10] no action\r\n\r\nTarget //aibench/benchmark:model_benchmark up-to-date:\r\n  bazel-bin/aibench/benchmark/model_benchmark\r\nINFO: Elapsed time: 55.689s, Critical Path: 0.86s\r\nINFO: 3 processes, local.\r\nINFO: Build completed successfully, 5 total actions\r\nBuild done!\r\n\r\n=====================================================================\r\nTrying to lock device ac516aca\r\nRun on device: ac516aca, sdm660, Mi Note 3\r\nAdjust power to performance mode on ac516aca, sdm660\r\nadbd cannot run as root in production builds\r\nNot running as root. Try \"adb root\" first.\r\nstop: must be root\r\nstop: must be root\r\nstop: must be root\r\nstop: must be root\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu0/online: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu1/online: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu2/online: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu3/online: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu4/online: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu5/online: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu6/online: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu7/online: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu1/cpufreq/scaling_governor: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu3/cpufreq/scaling_governor: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu5/cpufreq/scaling_governor: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu6/cpufreq/scaling_governor: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu7/cpufreq/scaling_governor: Permission denied\r\n/system/bin/sh: can't create /sys/class/devfreq/1d84000.ufshc/governor: No such file or directory\r\n/system/bin/sh: can't create /sys/class/devfreq/5000000.qcom,kgsl-3d0/governor: Permission denied\r\n/system/bin/sh: can't create /sys/class/devfreq/aa00000.qcom,vidc:arm9_bus_ddr/governor: No such file or directory\r\n/system/bin/sh: can't create /sys/class/devfreq/aa00000.qcom,vidc:bus_cnoc/governor: No such file or directory\r\n/system/bin/sh: can't create /sys/class/devfreq/aa00000.qcom,vidc:venus_bus_ddr/governor: No such file or directory\r\n/system/bin/sh: can't create /sys/class/devfreq/aa00000.qcom,vidc:venus_bus_llcc/governor: No such file or directory\r\n/system/bin/sh: can't create /sys/class/devfreq/soc:qcom,cpubw/governor: Permission denied\r\n/system/bin/sh: can't create /sys/class/devfreq/soc:qcom,gpubw/governor: Permission denied\r\n/system/bin/sh: can't create /sys/class/devfreq/soc:qcom,kgsl-busmon/governor: Permission denied\r\n/system/bin/sh: can't create /sys/class/devfreq/soc:qcom,l3-cdsp/governor: No such file or directory\r\n/system/bin/sh: can't create /sys/class/devfreq/soc:qcom,l3-cpu0/governor: No such file or directory\r\n/system/bin/sh: can't create /sys/class/devfreq/soc:qcom,l3-cpu4/governor: No such file or directory\r\n/system/bin/sh: can't create /sys/class/devfreq/soc:qcom,llccbw/governor: No such file or directory\r\n/system/bin/sh: can't create /sys/class/devfreq/soc:qcom,memlat-cpu0/governor: Permission denied\r\n/system/bin/sh: can't create /sys/class/devfreq/soc:qcom,memlat-cpu4/governor: Permission denied\r\n/system/bin/sh: can't create /sys/class/devfreq/soc:qcom,mincpubw/governor: Permission denied\r\n/system/bin/sh: can't create /sys/class/devfreq/soc:qcom,snoc_cnoc_keepalive/governor: No such file or directory\r\n/system/bin/sh: can't create /sys/class/kgsl/kgsl-3d0/min_pwrlevel: Permission denied\r\n/system/bin/sh: can't create /sys/class/kgsl/kgsl-3d0/max_pwrlevel: Permission denied\r\n/system/bin/sh: can't create /sys/class/kgsl/kgsl-3d0/devfreq/governor: Permission denied\r\n266000000\r\n/system/bin/sh: can't create /sys/class/kgsl/kgsl-3d0/idle_timer: Permission denied\r\n/system/bin/sh: can't create /d/dri/0/debug/core_perf/perf_mode: No such file or directory\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu0/core_ctl/min_cpus: Permission denied\r\n/system/bin/sh: can't create /sys/devices/system/cpu/cpu4/core_ctl/min_cpus: Permission denied\r\n/system/bin/sh: can't create /proc/sys/kernel/sched_downmigrate: Permission denied\r\n/system/bin/sh: can't create /sys/block/sda/queue/nr_requests: No such file or directory\r\n/system/bin/sh: can't create /dev/stune/top-app/schedtune.boost: Permission denied\r\n/system/bin/sh: can't create /dev/stune/top-app/schedtune.prefer_idle: Permission denied\r\n/system/bin/sh: can't create /sys/module/lpm_levels/parameters/sleep_disabled: Permission denied\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu0/pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu0/rail-pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu1/pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu1/rail-pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu2/pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu2/rail-pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu3/pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu3/rail-pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu4/pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu4/rail-pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu5/pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu5/rail-pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu6/pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu6/rail-pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu7/pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/cpu7/rail-pc/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/l3-wfi/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/L3/llcc-off/idle_enabled: No such file or directory\r\n/system/bin/sh: can't create /sys/module/lpm_levels/system/perf/cpu4/pc/idle_enabled: Permission denied\r\n/system/bin/sh: can't create /sys/module/lpm_levels/system/perf/cpu5/pc/idle_enabled: Permission denied\r\n/system/bin/sh: can't create /sys/module/lpm_levels/system/perf/cpu6/pc/idle_enabled: Permission denied\r\n/system/bin/sh: can't create /sys/module/lpm_levels/system/perf/cpu7/pc/idle_enabled: Permission denied\r\n/system/bin/sh: can't create /proc/sys/kernel/sched_initial_task_util: No such file or directory\r\n/system/bin/sh: can't create /proc/sys/kernel/sched_init_task_load: Permission denied\r\n/system/bin/sh: can't create /sys/kernel/debug/msm-bus-dbg/shell-client/mas: Permission denied\r\n/system/bin/sh: can't create /sys/kernel/debug/msm-bus-dbg/shell-client/slv: Permission denied\r\n/system/bin/sh: can't create /sys/kernel/debug/msm-bus-dbg/shell-client/ab: Permission denied\r\n/system/bin/sh: can't create /sys/kernel/debug/msm-bus-dbg/shell-client/ib: Permission denied\r\n/system/bin/sh: can't create /sys/kernel/debug/msm-bus-dbg/shell-client/update_request: Permission denied\r\nPush bazel-bin/aibench/benchmark/model_benchmark to /data/local/tmp/aibench\r\nRun /data/local/tmp/aibench/model_benchmark\r\n('snpe', 'CPU', 'MobileNetV1')\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n('snpe', 'CPU', 'MobileNetV2')\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n('snpe', 'CPU', 'SqueezeNetV11')\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n('snpe', 'CPU', 'InceptionV3')\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n('snpe', 'CPU', 'VGG16')\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n('snpe', 'GPU', 'MobileNetV1')\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n('snpe', 'GPU', 'MobileNetV2')\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n('snpe', 'GPU', 'SqueezeNetV11')\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n('snpe', 'GPU', 'InceptionV3')\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n('snpe', 'GPU', 'VGG16')\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n('snpe', 'DSP', 'MobileNetV1')\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n('snpe', 'DSP', 'MobileNetV2')\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n('snpe', 'DSP', 'SqueezeNetV11')\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n('snpe', 'DSP', 'InceptionV3')\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n('snpe', 'DSP', 'VGG16')\r\nWARNING: linker: /data/local/tmp/aibench/model_benchmark: unused DT entry: type 0xf arg 0xf81\r\n```","closed_by":{"login":"ysh329","id":7320657,"node_id":"MDQ6VXNlcjczMjA2NTc=","avatar_url":"https://avatars.githubusercontent.com/u/7320657?v=4","gravatar_id":"","url":"https://api.github.com/users/ysh329","html_url":"https://github.com/ysh329","followers_url":"https://api.github.com/users/ysh329/followers","following_url":"https://api.github.com/users/ysh329/following{/other_user}","gists_url":"https://api.github.com/users/ysh329/gists{/gist_id}","starred_url":"https://api.github.com/users/ysh329/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ysh329/subscriptions","organizations_url":"https://api.github.com/users/ysh329/orgs","repos_url":"https://api.github.com/users/ysh329/repos","events_url":"https://api.github.com/users/ysh329/events{/privacy}","received_events_url":"https://api.github.com/users/ysh329/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/XiaoMi/mobile-ai-bench/issues/10/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/XiaoMi/mobile-ai-bench/issues/10/timeline","performed_via_github_app":null,"state_reason":"completed"}