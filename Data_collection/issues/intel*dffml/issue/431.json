{"url":"https://api.github.com/repos/intel/dffml/issues/431","repository_url":"https://api.github.com/repos/intel/dffml","labels_url":"https://api.github.com/repos/intel/dffml/issues/431/labels{/name}","comments_url":"https://api.github.com/repos/intel/dffml/issues/431/comments","events_url":"https://api.github.com/repos/intel/dffml/issues/431/events","html_url":"https://github.com/intel/dffml/issues/431","id":573332069,"node_id":"MDU6SXNzdWU1NzMzMzIwNjk=","number":431,"title":"ci: docs: Failures of doctests not failing CI","user":{"login":"pdxjohnny","id":5950433,"node_id":"MDQ6VXNlcjU5NTA0MzM=","avatar_url":"https://avatars.githubusercontent.com/u/5950433?v=4","gravatar_id":"","url":"https://api.github.com/users/pdxjohnny","html_url":"https://github.com/pdxjohnny","followers_url":"https://api.github.com/users/pdxjohnny/followers","following_url":"https://api.github.com/users/pdxjohnny/following{/other_user}","gists_url":"https://api.github.com/users/pdxjohnny/gists{/gist_id}","starred_url":"https://api.github.com/users/pdxjohnny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pdxjohnny/subscriptions","organizations_url":"https://api.github.com/users/pdxjohnny/orgs","repos_url":"https://api.github.com/users/pdxjohnny/repos","events_url":"https://api.github.com/users/pdxjohnny/events{/privacy}","received_events_url":"https://api.github.com/users/pdxjohnny/received_events","type":"User","site_admin":false},"labels":[{"id":1062701217,"node_id":"MDU6TGFiZWwxMDYyNzAxMjE3","url":"https://api.github.com/repos/intel/dffml/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1062701224,"node_id":"MDU6TGFiZWwxMDYyNzAxMjI0","url":"https://api.github.com/repos/intel/dffml/labels/good%20first%20issue","name":"good first issue","color":"7057ff","default":true,"description":"Good for newcomers"},{"id":1343769627,"node_id":"MDU6TGFiZWwxMzQzNzY5NjI3","url":"https://api.github.com/repos/intel/dffml/labels/kind/infrastructure","name":"kind/infrastructure","color":"c2e0c6","default":false,"description":"CI related issues"},{"id":1740392441,"node_id":"MDU6TGFiZWwxNzQwMzkyNDQx","url":"https://api.github.com/repos/intel/dffml/labels/p0","name":"p0","color":"b60205","default":false,"description":"Critical Priority"},{"id":1740453954,"node_id":"MDU6TGFiZWwxNzQwNDUzOTU0","url":"https://api.github.com/repos/intel/dffml/labels/tS","name":"tS","color":"4acc74","default":false,"description":"Esitmated Time To Complete: Short"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/intel/dffml/milestones/10","html_url":"https://github.com/intel/dffml/milestone/10","labels_url":"https://api.github.com/repos/intel/dffml/milestones/10/labels","id":5189140,"node_id":"MDk6TWlsZXN0b25lNTE4OTE0MA==","number":10,"title":"0.3.6 Alpha Release","description":"","creator":{"login":"pdxjohnny","id":5950433,"node_id":"MDQ6VXNlcjU5NTA0MzM=","avatar_url":"https://avatars.githubusercontent.com/u/5950433?v=4","gravatar_id":"","url":"https://api.github.com/users/pdxjohnny","html_url":"https://github.com/pdxjohnny","followers_url":"https://api.github.com/users/pdxjohnny/followers","following_url":"https://api.github.com/users/pdxjohnny/following{/other_user}","gists_url":"https://api.github.com/users/pdxjohnny/gists{/gist_id}","starred_url":"https://api.github.com/users/pdxjohnny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pdxjohnny/subscriptions","organizations_url":"https://api.github.com/users/pdxjohnny/orgs","repos_url":"https://api.github.com/users/pdxjohnny/repos","events_url":"https://api.github.com/users/pdxjohnny/events{/privacy}","received_events_url":"https://api.github.com/users/pdxjohnny/received_events","type":"User","site_admin":false},"open_issues":0,"closed_issues":28,"state":"closed","created_at":"2020-03-11T02:58:22Z","updated_at":"2020-04-06T05:31:45Z","due_on":null,"closed_at":"2020-04-06T05:31:45Z"},"comments":0,"created_at":"2020-02-29T16:45:38Z","updated_at":"2020-03-25T22:21:48Z","closed_at":"2020-03-25T22:21:48Z","author_association":"MEMBER","active_lock_reason":null,"body":"For example the following logs show a doctest failing which should have failed the `DOCS` CI target, but didn't.\r\n\r\n```\r\n2020-02-29T10:59:52.6395814Z + ./scripts/doctest.sh\r\n2020-02-29T10:59:53.0709453Z Running Sphinx v2.4.3\r\n2020-02-29T10:59:53.3437537Z making output directory... done\r\n2020-02-29T10:59:53.3440862Z WARNING: html_static_path entry '_static' does not exist\r\n2020-02-29T10:59:53.3484330Z loading intersphinx inventory from https://docs.python.org/3/objects.inv...\r\n2020-02-29T10:59:53.7239569Z building [mo]: targets for 0 po files that are out of date\r\n2020-02-29T10:59:53.7244021Z building [doctest]: targets for 52 source files that are out of date\r\n2020-02-29T10:59:53.7275529Z updating environment: [new config] 52 added, 0 changed, 0 removed\r\n2020-02-29T10:59:53.7280493Z reading sources... [  1%] about\r\n2020-02-29T10:59:53.7923098Z reading sources... [  3%] api/base\r\n2020-02-29T10:59:54.2031345Z reading sources... [  5%] api/db/base\r\n2020-02-29T10:59:54.2922536Z reading sources... [  7%] api/db/index\r\n2020-02-29T10:59:54.2978207Z reading sources... [  9%] api/db/sql\r\n2020-02-29T10:59:54.4495084Z reading sources... [ 11%] api/db/sqlite\r\n2020-02-29T10:59:54.5321578Z reading sources... [ 13%] api/df/base\r\n2020-02-29T10:59:54.9468228Z reading sources... [ 15%] api/df/index\r\n2020-02-29T10:59:54.9517887Z reading sources... [ 17%] api/df/memory\r\n2020-02-29T10:59:55.3604587Z reading sources... [ 19%] api/df/types\r\n2020-02-29T10:59:55.5558899Z reading sources... [ 21%] api/feature\r\n2020-02-29T10:59:55.6169492Z reading sources... [ 23%] api/high_level\r\n2020-02-29T10:59:55.6605946Z reading sources... [ 25%] api/index\r\n2020-02-29T10:59:55.6668436Z reading sources... [ 26%] api/model/base\r\n2020-02-29T10:59:55.7348179Z reading sources... [ 28%] api/model/index\r\n2020-02-29T10:59:55.7402612Z reading sources... [ 30%] api/record\r\n2020-02-29T10:59:55.7651318Z reading sources... [ 32%] api/source/base\r\n2020-02-29T10:59:55.8283875Z reading sources... [ 34%] api/source/file\r\n2020-02-29T10:59:55.9449551Z reading sources... [ 36%] api/source/index\r\n2020-02-29T10:59:55.9522147Z reading sources... [ 38%] api/source/memory\r\n2020-02-29T10:59:55.9805545Z reading sources... [ 40%] api/util/asynchelper\r\n2020-02-29T10:59:56.1297531Z reading sources... [ 42%] api/util/index\r\n2020-02-29T10:59:56.1357642Z reading sources... [ 44%] api/util/net\r\n2020-02-29T10:59:56.1709644Z reading sources... [ 46%] changelog\r\n2020-02-29T10:59:56.2902485Z reading sources... [ 48%] cli\r\n2020-02-29T10:59:57.1107503Z reading sources... [ 50%] contact\r\n2020-02-29T10:59:57.1108891Z reading sources... [ 51%] contributing/codebase\r\n2020-02-29T10:59:57.1109402Z reading sources... [ 53%] contributing/debugging\r\n2020-02-29T10:59:57.1109860Z reading sources... [ 55%] contributing/dev_env\r\n2020-02-29T10:59:57.1110304Z reading sources... [ 57%] contributing/docs\r\n2020-02-29T10:59:57.1110725Z reading sources... [ 59%] contributing/git\r\n2020-02-29T10:59:57.1115268Z reading sources... [ 61%] contributing/index\r\n2020-02-29T10:59:57.1115838Z reading sources... [ 63%] contributing/style\r\n2020-02-29T10:59:57.1116342Z reading sources... [ 65%] contributing/testing\r\n2020-02-29T10:59:57.1116764Z reading sources... [ 67%] index\r\n2020-02-29T10:59:57.1117190Z reading sources... [ 69%] installation\r\n2020-02-29T10:59:57.1117634Z reading sources... [ 71%] plugins/dffml_model\r\n2020-02-29T10:59:57.1118159Z reading sources... [ 73%] plugins/dffml_operation\r\n2020-02-29T10:59:57.1118665Z reading sources... [ 75%] plugins/dffml_service_cli\r\n2020-02-29T10:59:57.1119095Z reading sources... [ 76%] plugins/dffml_source\r\n2020-02-29T10:59:57.1119521Z reading sources... [ 78%] plugins/index\r\n2020-02-29T10:59:57.1119944Z reading sources... [ 80%] publications\r\n2020-02-29T10:59:57.1120661Z reading sources... [ 82%] quickstart/model\r\n2020-02-29T10:59:57.1121112Z reading sources... [ 84%] tutorials/index\r\n2020-02-29T10:59:57.1121549Z reading sources... [ 86%] tutorials/intro\r\n2020-02-29T10:59:57.1121957Z reading sources... [ 88%] tutorials/model\r\n2020-02-29T10:59:57.1122415Z reading sources... [ 90%] tutorials/operations\r\n2020-02-29T10:59:57.1122841Z reading sources... [ 92%] tutorials/source\r\n2020-02-29T10:59:57.1209259Z reading sources... [ 94%] usage/dataflows\r\n2020-02-29T10:59:57.1638010Z reading sources... [ 96%] usage/index\r\n2020-02-29T10:59:57.1699767Z reading sources... [ 98%] usage/integration\r\n2020-02-29T10:59:57.2283252Z reading sources... [100%] usage/mnist\r\n2020-02-29T10:59:57.2365288Z /opt/hostedtoolcache/Python/3.7.6/x64/lib/python3.7/site-packages/recommonmark/parser.py:75: UserWarning: Container node skipped: type=document\r\n2020-02-29T10:59:57.2365733Z \r\n2020-02-29T10:59:57.2366070Z   warn(\"Container node skipped: type={0}\".format(mdnode.t))\r\n2020-02-29T10:59:57.2500536Z looking for now-outdated files... none found\r\n2020-02-29T10:59:57.2635797Z pickling environment... done\r\n2020-02-29T10:59:57.2637027Z checking consistency... done\r\n2020-02-29T10:59:57.2637798Z running tests...\r\n2020-02-29T10:59:57.2670278Z \r\n2020-02-29T10:59:57.2670517Z Document: api/base\r\n2020-02-29T10:59:57.2671063Z ------------------\r\n2020-02-29T10:59:57.2919909Z 1 items passed all tests:\r\n2020-02-29T10:59:57.2920187Z    4 tests in default\r\n2020-02-29T10:59:57.2920446Z 4 tests in 1 items.\r\n2020-02-29T10:59:57.2920707Z 4 passed and 0 failed.\r\n2020-02-29T10:59:57.2920939Z Test passed.\r\n2020-02-29T10:59:57.3798397Z \r\n2020-02-29T10:59:57.3798949Z Document: api/util/net\r\n2020-02-29T10:59:57.3800005Z ----------------------\r\n2020-02-29T10:59:59.0330500Z 1 items passed all tests:\r\n2020-02-29T10:59:59.0331462Z    4 tests in default\r\n2020-02-29T10:59:59.0332220Z 4 tests in 1 items.\r\n2020-02-29T10:59:59.0332489Z 4 passed and 0 failed.\r\n2020-02-29T10:59:59.0332634Z Test passed.\r\n2020-02-29T10:59:59.0608646Z \r\n2020-02-29T10:59:59.0609060Z Document: api/df/base\r\n2020-02-29T10:59:59.0609767Z ---------------------\r\n2020-02-29T10:59:59.0875508Z **********************************************************************\r\n2020-02-29T10:59:59.0875974Z File \"../dffml/df/base.py\", line ?, in default\r\n2020-02-29T10:59:59.0876201Z Failed example:\r\n2020-02-29T10:59:59.0876461Z     async with self.subflow(self.config.dataflow) as octx:\r\n2020-02-29T10:59:59.0876706Z Exception raised:\r\n2020-02-29T10:59:59.0876913Z     Traceback (most recent call last):\r\n2020-02-29T10:59:59.0877270Z       File \"/opt/hostedtoolcache/Python/3.7.6/x64/lib/python3.7/doctest.py\", line 1329, in __run\r\n2020-02-29T10:59:59.0877632Z         compileflags, 1), test.globs)\r\n2020-02-29T10:59:59.0878645Z       File \"/opt/hostedtoolcache/Python/3.7.6/x64/lib/python3.7/site-packages/sphinx/ext/doctest.py\", line 476, in compile\r\n2020-02-29T10:59:59.0878953Z         return compile(code, name, self.type, flags, dont_inherit)\r\n2020-02-29T10:59:59.0879238Z       File \"<doctest default[0]>\", line 1\r\n2020-02-29T10:59:59.0879501Z         async with self.subflow(self.config.dataflow) as octx:\r\n2020-02-29T10:59:59.0879829Z                                                              ^\r\n2020-02-29T10:59:59.0880123Z     SyntaxError: unexpected EOF while parsing\r\n2020-02-29T10:59:59.0884615Z **********************************************************************\r\n2020-02-29T10:59:59.0884936Z 1 items had failures:\r\n2020-02-29T10:59:59.0885148Z    1 of   1 in default\r\n2020-02-29T10:59:59.0885355Z 1 tests in 1 items.\r\n2020-02-29T10:59:59.0885560Z 0 passed and 1 failed.\r\n2020-02-29T10:59:59.0885791Z ***Test Failed*** 1 failures.\r\n2020-02-29T10:59:59.0888005Z \r\n2020-02-29T10:59:59.0888639Z Doctest summary\r\n2020-02-29T10:59:59.0889140Z ===============\r\n2020-02-29T10:59:59.0889617Z     9 tests\r\n2020-02-29T10:59:59.0890081Z     1 failure in tests\r\n2020-02-29T10:59:59.0890548Z     0 failures in setup code\r\n2020-02-29T10:59:59.0891003Z     0 failures in cleanup code\r\n2020-02-29T10:59:59.0891589Z build finished with problems, 62 warnings.\r\n```\r\n\r\nWe might want to use `tee` to dump the output to a file and `exit 1` if we don't see `0 failures in tests` in the output.\r\n\r\nThis is probably a good place to copy from:\r\n\r\nhttps://github.com/intel/dffml/blob/045d2d0612ee71c8d281fdbf1b3d6630635f6d17/.ci/run.sh#L77-L81","closed_by":{"login":"pdxjohnny","id":5950433,"node_id":"MDQ6VXNlcjU5NTA0MzM=","avatar_url":"https://avatars.githubusercontent.com/u/5950433?v=4","gravatar_id":"","url":"https://api.github.com/users/pdxjohnny","html_url":"https://github.com/pdxjohnny","followers_url":"https://api.github.com/users/pdxjohnny/followers","following_url":"https://api.github.com/users/pdxjohnny/following{/other_user}","gists_url":"https://api.github.com/users/pdxjohnny/gists{/gist_id}","starred_url":"https://api.github.com/users/pdxjohnny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pdxjohnny/subscriptions","organizations_url":"https://api.github.com/users/pdxjohnny/orgs","repos_url":"https://api.github.com/users/pdxjohnny/repos","events_url":"https://api.github.com/users/pdxjohnny/events{/privacy}","received_events_url":"https://api.github.com/users/pdxjohnny/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/intel/dffml/issues/431/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/intel/dffml/issues/431/timeline","performed_via_github_app":null,"state_reason":"completed"}