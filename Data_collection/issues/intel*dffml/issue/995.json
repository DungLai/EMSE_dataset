{"url":"https://api.github.com/repos/intel/dffml/issues/995","repository_url":"https://api.github.com/repos/intel/dffml","labels_url":"https://api.github.com/repos/intel/dffml/issues/995/labels{/name}","comments_url":"https://api.github.com/repos/intel/dffml/issues/995/comments","events_url":"https://api.github.com/repos/intel/dffml/issues/995/events","html_url":"https://github.com/intel/dffml/issues/995","id":809763573,"node_id":"MDU6SXNzdWU4MDk3NjM1NzM=","number":995,"title":"model: pytorch: resnet: Tensors are of unequal size","user":{"login":"pdxjohnny","id":5950433,"node_id":"MDQ6VXNlcjU5NTA0MzM=","avatar_url":"https://avatars.githubusercontent.com/u/5950433?v=4","gravatar_id":"","url":"https://api.github.com/users/pdxjohnny","html_url":"https://github.com/pdxjohnny","followers_url":"https://api.github.com/users/pdxjohnny/followers","following_url":"https://api.github.com/users/pdxjohnny/following{/other_user}","gists_url":"https://api.github.com/users/pdxjohnny/gists{/gist_id}","starred_url":"https://api.github.com/users/pdxjohnny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pdxjohnny/subscriptions","organizations_url":"https://api.github.com/users/pdxjohnny/orgs","repos_url":"https://api.github.com/users/pdxjohnny/repos","events_url":"https://api.github.com/users/pdxjohnny/events{/privacy}","received_events_url":"https://api.github.com/users/pdxjohnny/received_events","type":"User","site_admin":false},"labels":[{"id":1062701217,"node_id":"MDU6TGFiZWwxMDYyNzAxMjE3","url":"https://api.github.com/repos/intel/dffml/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1474883282,"node_id":"MDU6TGFiZWwxNDc0ODgzMjgy","url":"https://api.github.com/repos/intel/dffml/labels/kind/ml","name":"kind/ml","color":"0e8a16","default":false,"description":"Issues partaining to machine learning"},{"id":1740392441,"node_id":"MDU6TGFiZWwxNzQwMzkyNDQx","url":"https://api.github.com/repos/intel/dffml/labels/p0","name":"p0","color":"b60205","default":false,"description":"Critical Priority"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/intel/dffml/milestones/12","html_url":"https://github.com/intel/dffml/milestone/12","labels_url":"https://api.github.com/repos/intel/dffml/milestones/12/labels","id":5313485,"node_id":"MDk6TWlsZXN0b25lNTMxMzQ4NQ==","number":12,"title":"0.4.0 Alpha Release","description":"","creator":{"login":"pdxjohnny","id":5950433,"node_id":"MDQ6VXNlcjU5NTA0MzM=","avatar_url":"https://avatars.githubusercontent.com/u/5950433?v=4","gravatar_id":"","url":"https://api.github.com/users/pdxjohnny","html_url":"https://github.com/pdxjohnny","followers_url":"https://api.github.com/users/pdxjohnny/followers","following_url":"https://api.github.com/users/pdxjohnny/following{/other_user}","gists_url":"https://api.github.com/users/pdxjohnny/gists{/gist_id}","starred_url":"https://api.github.com/users/pdxjohnny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pdxjohnny/subscriptions","organizations_url":"https://api.github.com/users/pdxjohnny/orgs","repos_url":"https://api.github.com/users/pdxjohnny/repos","events_url":"https://api.github.com/users/pdxjohnny/events{/privacy}","received_events_url":"https://api.github.com/users/pdxjohnny/received_events","type":"User","site_admin":false},"open_issues":0,"closed_issues":119,"state":"closed","created_at":"2020-04-15T22:17:52Z","updated_at":"2021-02-26T21:58:12Z","due_on":"2021-02-18T08:00:00Z","closed_at":"2021-02-18T23:38:00Z"},"comments":0,"created_at":"2021-02-17T01:01:42Z","updated_at":"2021-02-26T21:58:12Z","closed_at":"2021-02-17T20:30:09Z","author_association":"MEMBER","active_lock_reason":null,"body":"So we had an issue where the CI had been skipping the resnet tests. They don't seem to be working, and it's unclear if they ever worked in CI.\r\n\r\n```test_shell (tests.test_resnet18.TestResNet18Model) ... DEBUG:dffml.JSONSource:FileSourceConfig(filename=PosixPath('~/.cache/dffml.json'), tag='untagged', readwrite=False, allowempty=False)\r\nDEBUG:dffml.JSONSource:FileSourceConfig(filename=PosixPath('~/.cache/dffml.json'), tag='untagged', readwrite=False, allowempty=False)\r\nDEBUG:dffml.JSONSource:FileSourceConfig(filename=PosixPath('~/.cache/dffml.json'), tag='untagged', readwrite=False, allowempty=False)\r\nDEBUG:dffml.JSONSource:FileSourceConfig(filename=PosixPath('~/.cache/dffml.json'), tag='untagged', readwrite=False, allowempty=False)\r\nDEBUG:dffml.JSONSource:FileSourceConfig(filename=PosixPath('~/.cache/dffml.json'), tag='untagged', readwrite=False, allowempty=False)\r\nDEBUG:dffml.JSONSource:FileSourceConfig(filename=PosixPath('~/.cache/dffml.json'), tag='untagged', readwrite=False, allowempty=False)\r\nDEBUG:dffml.JSONSource:FileSourceConfig(filename=PosixPath('~/.cache/dffml.json'), tag='untagged', readwrite=False, allowempty=False)\r\nDEBUG:dffml.JSONSource:FileSourceConfig(filename=PosixPath('~/.cache/dffml.json'), tag='untagged', readwrite=False, allowempty=False)\r\nDEBUG:dffml.JSONSource:FileSourceConfig(filename=PosixPath('~/.cache/dffml.json'), tag='untagged', readwrite=False, allowempty=False)\r\nDEBUG:dffml.cli.ml.Train:Setting model = <class 'dffml.base.ResNet18Model'>\r\nDEBUG:dffml.JSONSource:FileSourceConfig(filename=PosixPath('~/.cache/dffml.json'), tag='untagged', readwrite=False, allowempty=False)\r\nDEBUG:dffml.cli.ml.Train:Setting sources = [<class 'dffml.base.DirectorySource'>]\r\nDEBUG:dffml.CrossEntropyLossFunction:CrossEntropyLossConfig(weight=None, size_average=None, ignore_index=-100, reduce=None, reduction='mean')\r\nDEBUG:dffml.ResNet18Model:ResNet18ModelConfig(predict=label(Feature)[<class 'str'>, 1], features=[image(Feature)[<class 'int'>, '$((500*500))']], directory=PosixPath('tempdir'), classifications=['ants', 'bees'], clstype=<class 'str'>, imageSize=None, enableGPU=True, epochs=5, batch_size=32, validation_split=0.0, patience=5, loss=CrossEntropyLossFunction(CrossEntropyLossConfig(weight=None, size_average=None, ignore_index=-100, reduce=None, reduction='mean')), optimizer='SGD', normalize_mean=None, normalize_std=None, pretrained=True, ...\r\nDEBUG:dffml.DirectorySource:DirectorySourceConfig(foldername='hymenoptera_data/train', feature='image', labels=['ants', 'bees'], save=None)\r\nDEBUG:dffml.cli.ml.Train:Ignored model\r\nDEBUG:dffml.JSONSource:FileSourceConfig(filename=PosixPath('~/.cache/dffml.json'), tag='untagged', readwrite=False, allowempty=False)\r\nDEBUG:dffml.cli.ml.Train:Ignored sources\r\nDEBUG:dffml.util.AsyncContextManagerList.Sources:Entering: DirectorySource(DirectorySourceConfig(foldername=PosixPath('hymenoptera_data/train'), feature='image', labels=['ants', 'bees'], save=None))\r\nDEBUG:dffml.JPGConfigLoader:BaseConfig()\r\nDEBUG:dffml.JPEGConfigLoader:BaseConfig()\r\nDEBUG:dffml.DirectorySource:DirectorySource(DirectorySourceConfig(foldername=PosixPath('hymenoptera_data/train'), feature='image', labels=['ants', 'bees'], save=None)) loaded 244 records\r\nDEBUG:dffml.util.AsyncContextManagerListContext.SourcesContext:Entering context: <dffml.source.memory.MemorySourceContext object at 0x7f5ce5164090>\r\nDEBUG:dffml.ResNet18ModelContext:cids(2): {0: 'ants', 1: 'bees'}\r\nDEBUG:dffml.ResNet18ModelContext:classifications(2): {'ants': 0, 'bees': 1}\r\nINFO:dffml.ResNet18ModelContext:Using CUDA\r\nDEBUG:dffml.ResNet18ModelContext:Loading model with classifications(2): {'ants': 0, 'bees': 1}\r\nDEBUG:dffml.ResNet18ModelContext:Training on features: ['image']\r\n/home/pdxjohnny/Documents/python/dffml/model/pytorch/dffml_model_pytorch/pytorch_base.py:181: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify 'dtype=object' when creating the ndarray\r\n  x_cols[feature] = np.array(x_cols[feature])\r\nINFO:dffml.ResNet18ModelContext:------ Record Data ------\r\nINFO:dffml.ResNet18ModelContext:x_cols:    244\r\nINFO:dffml.ResNet18ModelContext:y_cols:    244\r\nINFO:dffml.ResNet18ModelContext:-----------------------\r\nINFO:dffml.ResNet18ModelContext:Epoch 1/5\r\nINFO:dffml.ResNet18ModelContext:----------\r\nERROR\r\n\r\n======================================================================\r\nERROR: test_shell (tests.test_resnet18.TestResNet18Model)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/home/pdxjohnny/Documents/python/dffml/dffml/util/asynctestcase.py\", line 69, in run_it\r\n    result = self.loop.run_until_complete(coro(*args, **kwargs))\r\n  File \"/home/pdxjohnny/.pyenv/versions/3.7.6/lib/python3.7/asyncio/base_events.py\", line 583, in run_until_complete\r\n    return future.result()\r\n  File \"/home/pdxjohnny/Documents/python/dffml/dffml/util/net.py\", line 215, in wrapper\r\n    return await func(*(list(args) + [directory_path]), **kwds)\r\n  File \"/home/pdxjohnny/Documents/python/dffml/model/pytorch/tests/test_resnet18.py\", line 46, in test_shell\r\n    await CLI.cli(*train_command[1:])\r\n  File \"/home/pdxjohnny/Documents/python/dffml/dffml/util/cli/cmd.py\", line 224, in cli\r\n    return await cmd.do_run()\r\n  File \"/home/pdxjohnny/Documents/python/dffml/dffml/util/cli/cmd.py\", line 203, in do_run\r\n    return await self.run()\r\n  File \"/home/pdxjohnny/Documents/python/dffml/dffml/cli/ml.py\", line 40, in run\r\n    return await train(self.model, self.sources)\r\n  File \"/home/pdxjohnny/Documents/python/dffml/dffml/high_level.py\", line 388, in train\r\n    return await mctx.train(sctx)\r\n  File \"/home/pdxjohnny/Documents/python/dffml/model/pytorch/dffml_model_pytorch/pytorch_base.py\", line 276, in train\r\n    for inputs, labels in dataloaders[phase]:\r\n  File \"/home/pdxjohnny/.pyenv/versions/3.7.6/lib/python3.7/site-packages/torch/utils/data/dataloader.py\", line 435, in __next__\r\n    data = self._next_data()\r\n  File \"/home/pdxjohnny/.pyenv/versions/3.7.6/lib/python3.7/site-packages/torch/utils/data/dataloader.py\", line 1085, in _next_data\r\n    return self._process_data(data)\r\n  File \"/home/pdxjohnny/.pyenv/versions/3.7.6/lib/python3.7/site-packages/torch/utils/data/dataloader.py\", line 1111, in _process_data\r\n    data.reraise()\r\n  File \"/home/pdxjohnny/.pyenv/versions/3.7.6/lib/python3.7/site-packages/torch/_utils.py\", line 428, in reraise\r\n    raise self.exc_type(msg)\r\nRuntimeError: Caught RuntimeError in DataLoader worker process 0.\r\nOriginal Traceback (most recent call last):\r\n  File \"/home/pdxjohnny/.pyenv/versions/3.7.6/lib/python3.7/site-packages/torch/utils/data/_utils/worker.py\", line 198, in _worker_loop\r\n    data = fetcher.fetch(index)\r\n  File \"/home/pdxjohnny/.pyenv/versions/3.7.6/lib/python3.7/site-packages/torch/utils/data/_utils/fetch.py\", line 47, in fetch\r\n    return self.collate_fn(data)\r\n  File \"/home/pdxjohnny/.pyenv/versions/3.7.6/lib/python3.7/site-packages/torch/utils/data/_utils/collate.py\", line 83, in default_collate\r\n    return [default_collate(samples) for samples in transposed]\r\n  File \"/home/pdxjohnny/.pyenv/versions/3.7.6/lib/python3.7/site-packages/torch/utils/data/_utils/collate.py\", line 83, in <listcomp>\r\n    return [default_collate(samples) for samples in transposed]\r\n  File \"/home/pdxjohnny/.pyenv/versions/3.7.6/lib/python3.7/site-packages/torch/utils/data/_utils/collate.py\", line 55, in default_collate\r\n    return torch.stack(batch, 0, out=out)\r\nRuntimeError: stack expects each tensor to be equal size, but got [3, 369, 500] at entry 0 and [3, 333, 500] at entry 1\r\n\r\n\r\n----------------------------------------------------------------------\r\nRan 1 test in 4.418s\r\n\r\nFAILED (errors=1)\r\n```\r\n\r\nWe'll just to `return` out the test for the `0.4.1`\r\n\r\nPinning @sakshamarora1","closed_by":{"login":"pdxjohnny","id":5950433,"node_id":"MDQ6VXNlcjU5NTA0MzM=","avatar_url":"https://avatars.githubusercontent.com/u/5950433?v=4","gravatar_id":"","url":"https://api.github.com/users/pdxjohnny","html_url":"https://github.com/pdxjohnny","followers_url":"https://api.github.com/users/pdxjohnny/followers","following_url":"https://api.github.com/users/pdxjohnny/following{/other_user}","gists_url":"https://api.github.com/users/pdxjohnny/gists{/gist_id}","starred_url":"https://api.github.com/users/pdxjohnny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pdxjohnny/subscriptions","organizations_url":"https://api.github.com/users/pdxjohnny/orgs","repos_url":"https://api.github.com/users/pdxjohnny/repos","events_url":"https://api.github.com/users/pdxjohnny/events{/privacy}","received_events_url":"https://api.github.com/users/pdxjohnny/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/intel/dffml/issues/995/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/intel/dffml/issues/995/timeline","performed_via_github_app":null,"state_reason":"completed"}