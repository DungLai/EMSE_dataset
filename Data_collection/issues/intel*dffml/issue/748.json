{"url":"https://api.github.com/repos/intel/dffml/issues/748","repository_url":"https://api.github.com/repos/intel/dffml","labels_url":"https://api.github.com/repos/intel/dffml/issues/748/labels{/name}","comments_url":"https://api.github.com/repos/intel/dffml/issues/748/comments","events_url":"https://api.github.com/repos/intel/dffml/issues/748/events","html_url":"https://github.com/intel/dffml/issues/748","id":648298023,"node_id":"MDU6SXNzdWU2NDgyOTgwMjM=","number":748,"title":"model: transformers: Update for transformers 3.0.0 compatibility","user":{"login":"pdxjohnny","id":5950433,"node_id":"MDQ6VXNlcjU5NTA0MzM=","avatar_url":"https://avatars.githubusercontent.com/u/5950433?v=4","gravatar_id":"","url":"https://api.github.com/users/pdxjohnny","html_url":"https://github.com/pdxjohnny","followers_url":"https://api.github.com/users/pdxjohnny/followers","following_url":"https://api.github.com/users/pdxjohnny/following{/other_user}","gists_url":"https://api.github.com/users/pdxjohnny/gists{/gist_id}","starred_url":"https://api.github.com/users/pdxjohnny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pdxjohnny/subscriptions","organizations_url":"https://api.github.com/users/pdxjohnny/orgs","repos_url":"https://api.github.com/users/pdxjohnny/repos","events_url":"https://api.github.com/users/pdxjohnny/events{/privacy}","received_events_url":"https://api.github.com/users/pdxjohnny/received_events","type":"User","site_admin":false},"labels":[{"id":1062701217,"node_id":"MDU6TGFiZWwxMDYyNzAxMjE3","url":"https://api.github.com/repos/intel/dffml/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-06-30T16:00:27Z","updated_at":"2020-07-01T23:04:31Z","closed_at":"2020-07-01T23:04:31Z","author_association":"MEMBER","active_lock_reason":null,"body":"https://pypi.org/project/transformers did a release yesterday and changed something we were using. CI is failing for model/transformers now... :(\r\n\r\n```\r\n2020-06-30T04:54:43.5932638Z ======================================================================\r\n2020-06-30T04:54:43.5932920Z ERROR: test_00_train (tests.test_classification_model.TestHFClassificationModel)\r\n2020-06-30T04:54:43.5933721Z ----------------------------------------------------------------------\r\n2020-06-30T04:54:43.5933976Z Traceback (most recent call last):\r\n2020-06-30T04:54:43.6070836Z   File \"/home/runner/work/dffml/dffml/dffml/util/asynctestcase.py\", line 69, in run_it\r\n2020-06-30T04:54:43.6074010Z     result = self.loop.run_until_complete(coro(*args, **kwargs))\r\n2020-06-30T04:54:43.6081891Z   File \"/usr/share/miniconda/lib/python3.7/asyncio/base_events.py\", line 587, in run_until_complete\r\n2020-06-30T04:54:43.6082158Z     return future.result()\r\n2020-06-30T04:54:43.6082487Z   File \"/home/runner/work/dffml/dffml/model/transformers/tests/test_classification_model.py\", line 48, in test_00_train\r\n2020-06-30T04:54:43.6082740Z     await train(self.model, self.sources)\r\n2020-06-30T04:54:43.6082995Z   File \"/home/runner/work/dffml/dffml/dffml/high_level.py\", line 380, in train\r\n2020-06-30T04:54:43.6083325Z     return await mctx.train(sctx)\r\n2020-06-30T04:54:43.6083594Z   File \"/home/runner/work/dffml/dffml/model/transformers/dffml_model_transformers/classification/classification_model.py\", line 310, in train\r\n2020-06-30T04:54:43.6084030Z     trainer.train()\r\n2020-06-30T04:54:43.6084762Z   File \"/usr/share/miniconda/lib/python3.7/site-packages/transformers/trainer_tf.py\", line 287, in train\r\n2020-06-30T04:54:43.6085027Z     train_ds = self.get_train_tfdataset()\r\n2020-06-30T04:54:43.6085547Z   File \"/usr/share/miniconda/lib/python3.7/site-packages/transformers/trainer_tf.py\", line 94, in get_train_tfdataset\r\n2020-06-30T04:54:43.6085854Z     .batch(self.args.train_batch_size, drop_remainder=self.args.dataloader_drop_last)\r\n2020-06-30T04:54:43.6086312Z AttributeError: 'HFClassificationModelConfig' object has no attribute 'dataloader_drop_last'\r\n2020-06-30T04:54:43.6086463Z \r\n2020-06-30T04:54:43.6086696Z ======================================================================\r\n2020-06-30T04:54:43.6086953Z ERROR: test_01_accuracy (tests.test_classification_model.TestHFClassificationModel)\r\n2020-06-30T04:54:43.6087369Z ----------------------------------------------------------------------\r\n2020-06-30T04:54:43.6087614Z Traceback (most recent call last):\r\n2020-06-30T04:54:43.6087899Z   File \"/home/runner/work/dffml/dffml/dffml/util/asynctestcase.py\", line 69, in run_it\r\n2020-06-30T04:54:43.6088170Z     result = self.loop.run_until_complete(coro(*args, **kwargs))\r\n2020-06-30T04:54:43.6088471Z   File \"/usr/share/miniconda/lib/python3.7/asyncio/base_events.py\", line 587, in run_until_complete\r\n2020-06-30T04:54:43.6088734Z     return future.result()\r\n2020-06-30T04:54:43.6089225Z   File \"/home/runner/work/dffml/dffml/model/transformers/tests/test_classification_model.py\", line 51, in test_01_accuracy\r\n2020-06-30T04:54:43.6089592Z     res = await accuracy(self.model, self.sources)\r\n2020-06-30T04:54:43.6089880Z   File \"/home/runner/work/dffml/dffml/dffml/high_level.py\", line 439, in accuracy\r\n2020-06-30T04:54:43.6090142Z     return float(await mctx.accuracy(sctx))\r\n2020-06-30T04:54:43.6090450Z   File \"/home/runner/work/dffml/dffml/model/transformers/dffml_model_transformers/classification/classification_model.py\", line 319, in accuracy\r\n2020-06-30T04:54:43.6090779Z     raise ModelNotTrained(\"Train model before assessing for accuracy.\")\r\n2020-06-30T04:54:43.6091040Z dffml.model.model.ModelNotTrained: Train model before assessing for accuracy.\r\n2020-06-30T04:54:43.6091354Z \r\n2020-06-30T04:54:43.6091608Z ======================================================================\r\n2020-06-30T04:54:43.6091887Z ERROR: test_02_predict (tests.test_classification_model.TestHFClassificationModel)\r\n2020-06-30T04:54:43.6092369Z ----------------------------------------------------------------------\r\n2020-06-30T04:54:43.6092631Z Traceback (most recent call last):\r\n2020-06-30T04:54:43.6092941Z   File \"/home/runner/work/dffml/dffml/dffml/util/asynctestcase.py\", line 69, in run_it\r\n2020-06-30T04:54:43.6093240Z     result = self.loop.run_until_complete(coro(*args, **kwargs))\r\n2020-06-30T04:54:43.6093566Z   File \"/usr/share/miniconda/lib/python3.7/asyncio/base_events.py\", line 587, in run_until_complete\r\n2020-06-30T04:54:43.6093848Z     return future.result()\r\n2020-06-30T04:54:43.6094173Z   File \"/home/runner/work/dffml/dffml/model/transformers/tests/test_classification_model.py\", line 58, in test_02_predict\r\n2020-06-30T04:54:43.6094467Z     async for prediction in predict(self.model, self.sources)\r\n2020-06-30T04:54:43.6094788Z   File \"/home/runner/work/dffml/dffml/model/transformers/tests/test_classification_model.py\", line 57, in <listcomp>\r\n2020-06-30T04:54:43.6095064Z     prediction\r\n2020-06-30T04:54:43.6128587Z   File \"/home/runner/work/dffml/dffml/dffml/high_level.py\", line 504, in predict\r\n2020-06-30T04:54:43.6128906Z     async for record in mctx.predict(sctx.records()):\r\n2020-06-30T04:54:43.6129248Z   File \"/home/runner/work/dffml/dffml/model/transformers/dffml_model_transformers/classification/classification_model.py\", line 351, in predict\r\n2020-06-30T04:54:43.6129760Z     raise ModelNotTrained(\"Train model before prediction.\")\r\n2020-06-30T04:54:43.6130042Z dffml.model.model.ModelNotTrained: Train model before prediction.\r\n2020-06-30T04:54:43.6130194Z \r\n2020-06-30T04:54:43.6130454Z ======================================================================\r\n2020-06-30T04:54:43.6130722Z ERROR: test_run (tests.test_ner_integration.TestNER)\r\n2020-06-30T04:54:43.6131358Z ----------------------------------------------------------------------\r\n2020-06-30T04:54:43.6131638Z Traceback (most recent call last):\r\n2020-06-30T04:54:43.6131949Z   File \"/home/runner/work/dffml/dffml/dffml/util/asynctestcase.py\", line 69, in run_it\r\n2020-06-30T04:54:43.6132248Z     result = self.loop.run_until_complete(coro(*args, **kwargs))\r\n2020-06-30T04:54:43.6132583Z   File \"/usr/share/miniconda/lib/python3.7/asyncio/base_events.py\", line 587, in run_until_complete\r\n2020-06-30T04:54:43.6132867Z     return future.result()\r\n2020-06-30T04:54:43.6133184Z   File \"/home/runner/work/dffml/dffml/model/transformers/tests/test_ner_integration.py\", line 90, in test_run\r\n2020-06-30T04:54:43.6133466Z     train_data_filename,\r\n2020-06-30T04:54:43.6133762Z   File \"/home/runner/work/dffml/dffml/dffml/util/cli/cmd.py\", line 220, in cli\r\n2020-06-30T04:54:43.6134040Z     return await cmd.do_run()\r\n2020-06-30T04:54:43.6134345Z   File \"/home/runner/work/dffml/dffml/dffml/util/cli/cmd.py\", line 202, in do_run\r\n2020-06-30T04:54:43.6134630Z     return await self.run()\r\n2020-06-30T04:54:43.6134922Z   File \"/home/runner/work/dffml/dffml/dffml/cli/ml.py\", line 40, in run\r\n2020-06-30T04:54:43.6135202Z     return await train(self.model, self.sources)\r\n2020-06-30T04:54:43.6135500Z   File \"/home/runner/work/dffml/dffml/dffml/high_level.py\", line 380, in train\r\n2020-06-30T04:54:43.6136114Z     return await mctx.train(sctx)\r\n2020-06-30T04:54:43.6136420Z   File \"/home/runner/work/dffml/dffml/model/transformers/dffml_model_transformers/ner/ner_model.py\", line 364, in train\r\n2020-06-30T04:54:43.6136685Z     trainer.train()\r\n2020-06-30T04:54:43.6137204Z   File \"/usr/share/miniconda/lib/python3.7/site-packages/transformers/trainer_tf.py\", line 287, in train\r\n2020-06-30T04:54:43.6137481Z     train_ds = self.get_train_tfdataset()\r\n2020-06-30T04:54:43.6137990Z   File \"/usr/share/miniconda/lib/python3.7/site-packages/transformers/trainer_tf.py\", line 94, in get_train_tfdataset\r\n2020-06-30T04:54:43.6138454Z     .batch(self.args.train_batch_size, drop_remainder=self.args.dataloader_drop_last)\r\n2020-06-30T04:54:43.6138905Z AttributeError: 'NERModelConfig' object has no attribute 'dataloader_drop_last'\r\n2020-06-30T04:54:43.6139053Z \r\n2020-06-30T04:54:43.6139292Z ======================================================================\r\n2020-06-30T04:54:43.6139550Z ERROR: test_00_train (tests.test_ner_model.TestNERModel)\r\n2020-06-30T04:54:43.6139963Z ----------------------------------------------------------------------\r\n2020-06-30T04:54:43.6140212Z Traceback (most recent call last):\r\n2020-06-30T04:54:43.6140505Z   File \"/home/runner/work/dffml/dffml/dffml/util/asynctestcase.py\", line 69, in run_it\r\n2020-06-30T04:54:43.6140770Z     result = self.loop.run_until_complete(coro(*args, **kwargs))\r\n2020-06-30T04:54:43.6141070Z   File \"/usr/share/miniconda/lib/python3.7/asyncio/base_events.py\", line 587, in run_until_complete\r\n2020-06-30T04:54:43.6141331Z     return future.result()\r\n2020-06-30T04:54:43.6141626Z   File \"/home/runner/work/dffml/dffml/model/transformers/tests/test_ner_model.py\", line 75, in test_00_train\r\n2020-06-30T04:54:43.6141922Z     await mctx.train(sctx)\r\n2020-06-30T04:54:43.6142210Z   File \"/home/runner/work/dffml/dffml/model/transformers/dffml_model_transformers/ner/ner_model.py\", line 364, in train\r\n2020-06-30T04:54:43.6142467Z     trainer.train()\r\n2020-06-30T04:54:43.6142962Z   File \"/usr/share/miniconda/lib/python3.7/site-packages/transformers/trainer_tf.py\", line 287, in train\r\n2020-06-30T04:54:43.6143225Z     train_ds = self.get_train_tfdataset()\r\n2020-06-30T04:54:43.6143925Z   File \"/usr/share/miniconda/lib/python3.7/site-packages/transformers/trainer_tf.py\", line 94, in get_train_tfdataset\r\n2020-06-30T04:54:43.6144227Z     .batch(self.args.train_batch_size, drop_remainder=self.args.dataloader_drop_last)\r\n2020-06-30T04:54:43.6144687Z AttributeError: 'NERModelConfig' object has no attribute 'dataloader_drop_last'\r\n2020-06-30T04:54:43.6144843Z \r\n2020-06-30T04:54:43.6145094Z ======================================================================\r\n2020-06-30T04:54:43.6145369Z ERROR: test_01_accuracy (tests.test_ner_model.TestNERModel)\r\n2020-06-30T04:54:43.6145813Z ----------------------------------------------------------------------\r\n2020-06-30T04:54:43.6146090Z Traceback (most recent call last):\r\n2020-06-30T04:54:43.6146397Z   File \"/home/runner/work/dffml/dffml/dffml/util/asynctestcase.py\", line 69, in run_it\r\n2020-06-30T04:54:43.6146697Z     result = self.loop.run_until_complete(coro(*args, **kwargs))\r\n2020-06-30T04:54:43.6147025Z   File \"/usr/share/miniconda/lib/python3.7/asyncio/base_events.py\", line 587, in run_until_complete\r\n2020-06-30T04:54:43.6147305Z     return future.result()\r\n2020-06-30T04:54:43.6147625Z   File \"/home/runner/work/dffml/dffml/model/transformers/tests/test_ner_model.py\", line 80, in test_01_accuracy\r\n2020-06-30T04:54:43.6147911Z     res = await mctx.accuracy(sctx)\r\n2020-06-30T04:54:43.6148230Z   File \"/home/runner/work/dffml/dffml/model/transformers/dffml_model_transformers/ner/ner_model.py\", line 372, in accuracy\r\n2020-06-30T04:54:43.6148583Z     raise ModelNotTrained(\"Train model before assessing for accuracy.\")\r\n2020-06-30T04:54:43.6148868Z dffml.model.model.ModelNotTrained: Train model before assessing for accuracy.\r\n2020-06-30T04:54:43.6149040Z \r\n2020-06-30T04:54:43.6149288Z ======================================================================\r\n2020-06-30T04:54:43.6149719Z ERROR: test_02_predict (tests.test_ner_model.TestNERModel)\r\n2020-06-30T04:54:43.6150276Z ----------------------------------------------------------------------\r\n2020-06-30T04:54:43.6150522Z Traceback (most recent call last):\r\n2020-06-30T04:54:43.6150812Z   File \"/home/runner/work/dffml/dffml/dffml/util/asynctestcase.py\", line 69, in run_it\r\n2020-06-30T04:54:43.6151081Z     result = self.loop.run_until_complete(coro(*args, **kwargs))\r\n2020-06-30T04:54:43.6151381Z   File \"/usr/share/miniconda/lib/python3.7/asyncio/base_events.py\", line 587, in run_until_complete\r\n2020-06-30T04:54:43.6151642Z     return future.result()\r\n2020-06-30T04:54:43.6151940Z   File \"/home/runner/work/dffml/dffml/model/transformers/tests/test_ner_model.py\", line 87, in test_02_predict\r\n2020-06-30T04:54:43.6152214Z     async for record in mctx.predict(sctx.records()):\r\n2020-06-30T04:54:43.6152516Z   File \"/home/runner/work/dffml/dffml/model/transformers/dffml_model_transformers/ner/ner_model.py\", line 400, in predict\r\n2020-06-30T04:54:43.6152857Z     raise ModelNotTrained(\"Train model before prediction.\")\r\n2020-06-30T04:54:43.6153111Z dffml.model.model.ModelNotTrained: Train model before prediction.\r\n2020-06-30T04:54:43.6153247Z \r\n2020-06-30T04:54:43.6153482Z ======================================================================\r\n2020-06-30T04:54:43.6153736Z ERROR: test_run (tests.test_classification_integration.TestHFClassifier)\r\n2020-06-30T04:54:43.6154154Z ----------------------------------------------------------------------\r\n2020-06-30T04:54:43.6154393Z Traceback (most recent call last):\r\n2020-06-30T04:54:43.6154675Z   File \"/home/runner/work/dffml/dffml/dffml/util/asynctestcase.py\", line 69, in run_it\r\n2020-06-30T04:54:43.6154941Z     result = self.loop.run_until_complete(coro(*args, **kwargs))\r\n2020-06-30T04:54:43.6155244Z   File \"/usr/share/miniconda/lib/python3.7/asyncio/base_events.py\", line 587, in run_until_complete\r\n2020-06-30T04:54:43.6155501Z     return future.result()\r\n2020-06-30T04:54:43.6155888Z   File \"/home/runner/work/dffml/dffml/model/transformers/tests/test_classification_integration.py\", line 112, in test_run\r\n2020-06-30T04:54:43.6156119Z     data_filename,\r\n2020-06-30T04:54:43.6156372Z   File \"/home/runner/work/dffml/dffml/dffml/util/cli/cmd.py\", line 220, in cli\r\n2020-06-30T04:54:43.6158720Z     return await cmd.do_run()\r\n2020-06-30T04:54:43.6159163Z   File \"/home/runner/work/dffml/dffml/dffml/util/cli/cmd.py\", line 202, in do_run\r\n2020-06-30T04:54:43.6159499Z     return await self.run()\r\n2020-06-30T04:54:43.6159858Z   File \"/home/runner/work/dffml/dffml/dffml/cli/ml.py\", line 40, in run\r\n2020-06-30T04:54:43.6160192Z     return await train(self.model, self.sources)\r\n2020-06-30T04:54:43.6160558Z   File \"/home/runner/work/dffml/dffml/dffml/high_level.py\", line 380, in train\r\n2020-06-30T04:54:43.6160880Z     return await mctx.train(sctx)\r\n2020-06-30T04:54:43.6161429Z   File \"/home/runner/work/dffml/dffml/model/transformers/dffml_model_transformers/classification/classification_model.py\", line 310, in train\r\n2020-06-30T04:54:43.6161776Z     trainer.train()\r\n2020-06-30T04:54:43.6162798Z   File \"/usr/share/miniconda/lib/python3.7/site-packages/transformers/trainer_tf.py\", line 287, in train\r\n2020-06-30T04:54:43.6163152Z     train_ds = self.get_train_tfdataset()\r\n2020-06-30T04:54:43.6163842Z   File \"/usr/share/miniconda/lib/python3.7/site-packages/transformers/trainer_tf.py\", line 94, in get_train_tfdataset\r\n2020-06-30T04:54:43.6164198Z     .batch(self.args.train_batch_size, drop_remainder=self.args.dataloader_drop_last)\r\n2020-06-30T04:54:43.6164797Z AttributeError: 'HFClassificationModelConfig' object has no attribute 'dataloader_drop_last'\r\n```","closed_by":{"login":"pdxjohnny","id":5950433,"node_id":"MDQ6VXNlcjU5NTA0MzM=","avatar_url":"https://avatars.githubusercontent.com/u/5950433?v=4","gravatar_id":"","url":"https://api.github.com/users/pdxjohnny","html_url":"https://github.com/pdxjohnny","followers_url":"https://api.github.com/users/pdxjohnny/followers","following_url":"https://api.github.com/users/pdxjohnny/following{/other_user}","gists_url":"https://api.github.com/users/pdxjohnny/gists{/gist_id}","starred_url":"https://api.github.com/users/pdxjohnny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pdxjohnny/subscriptions","organizations_url":"https://api.github.com/users/pdxjohnny/orgs","repos_url":"https://api.github.com/users/pdxjohnny/repos","events_url":"https://api.github.com/users/pdxjohnny/events{/privacy}","received_events_url":"https://api.github.com/users/pdxjohnny/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/intel/dffml/issues/748/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/intel/dffml/issues/748/timeline","performed_via_github_app":null,"state_reason":"completed"}