{"url":"https://api.github.com/repos/intel/dffml/issues/732","repository_url":"https://api.github.com/repos/intel/dffml","labels_url":"https://api.github.com/repos/intel/dffml/issues/732/labels{/name}","comments_url":"https://api.github.com/repos/intel/dffml/issues/732/comments","events_url":"https://api.github.com/repos/intel/dffml/issues/732/events","html_url":"https://github.com/intel/dffml/issues/732","id":644008076,"node_id":"MDU6SXNzdWU2NDQwMDgwNzY=","number":732,"title":"accuracy: Create new plugin type of scoring models","user":{"login":"pdxjohnny","id":5950433,"node_id":"MDQ6VXNlcjU5NTA0MzM=","avatar_url":"https://avatars.githubusercontent.com/u/5950433?v=4","gravatar_id":"","url":"https://api.github.com/users/pdxjohnny","html_url":"https://github.com/pdxjohnny","followers_url":"https://api.github.com/users/pdxjohnny/followers","following_url":"https://api.github.com/users/pdxjohnny/following{/other_user}","gists_url":"https://api.github.com/users/pdxjohnny/gists{/gist_id}","starred_url":"https://api.github.com/users/pdxjohnny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pdxjohnny/subscriptions","organizations_url":"https://api.github.com/users/pdxjohnny/orgs","repos_url":"https://api.github.com/users/pdxjohnny/repos","events_url":"https://api.github.com/users/pdxjohnny/events{/privacy}","received_events_url":"https://api.github.com/users/pdxjohnny/received_events","type":"User","site_admin":false},"labels":[{"id":1062701220,"node_id":"MDU6TGFiZWwxMDYyNzAxMjIw","url":"https://api.github.com/repos/intel/dffml/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"},{"id":1266689488,"node_id":"MDU6TGFiZWwxMjY2Njg5NDg4","url":"https://api.github.com/repos/intel/dffml/labels/project","name":"project","color":"53e097","default":false,"description":"Issues which will take a while to complete"},{"id":1353292251,"node_id":"MDU6TGFiZWwxMzUzMjkyMjUx","url":"https://api.github.com/repos/intel/dffml/labels/arch","name":"arch","color":"006b75","default":false,"description":"Architectural related issues"},{"id":1474883282,"node_id":"MDU6TGFiZWwxNDc0ODgzMjgy","url":"https://api.github.com/repos/intel/dffml/labels/kind/ml","name":"kind/ml","color":"0e8a16","default":false,"description":"Issues partaining to machine learning"},{"id":1740392441,"node_id":"MDU6TGFiZWwxNzQwMzkyNDQx","url":"https://api.github.com/repos/intel/dffml/labels/p0","name":"p0","color":"b60205","default":false,"description":"Critical Priority"},{"id":1740463703,"node_id":"MDU6TGFiZWwxNzQwNDYzNzAz","url":"https://api.github.com/repos/intel/dffml/labels/tXL","name":"tXL","color":"893ddb","default":false,"description":"Esitmated Time To Complete: Extra Long"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/intel/dffml/milestones/14","html_url":"https://github.com/intel/dffml/milestone/14","labels_url":"https://api.github.com/repos/intel/dffml/milestones/14/labels","id":6428395,"node_id":"MDk6TWlsZXN0b25lNjQyODM5NQ==","number":14,"title":"0.4.1 Alpha Release","description":"","creator":{"login":"pdxjohnny","id":5950433,"node_id":"MDQ6VXNlcjU5NTA0MzM=","avatar_url":"https://avatars.githubusercontent.com/u/5950433?v=4","gravatar_id":"","url":"https://api.github.com/users/pdxjohnny","html_url":"https://github.com/pdxjohnny","followers_url":"https://api.github.com/users/pdxjohnny/followers","following_url":"https://api.github.com/users/pdxjohnny/following{/other_user}","gists_url":"https://api.github.com/users/pdxjohnny/gists{/gist_id}","starred_url":"https://api.github.com/users/pdxjohnny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pdxjohnny/subscriptions","organizations_url":"https://api.github.com/users/pdxjohnny/orgs","repos_url":"https://api.github.com/users/pdxjohnny/repos","events_url":"https://api.github.com/users/pdxjohnny/events{/privacy}","received_events_url":"https://api.github.com/users/pdxjohnny/received_events","type":"User","site_admin":false},"open_issues":6,"closed_issues":9,"state":"open","created_at":"2021-02-13T01:22:00Z","updated_at":"2022-04-27T22:07:45Z","due_on":null,"closed_at":null},"comments":0,"created_at":"2020-06-23T17:13:40Z","updated_at":"2021-08-10T16:39:33Z","closed_at":"2021-08-10T16:39:26Z","author_association":"MEMBER","active_lock_reason":null,"body":"We'll do a review at the end of each phase. For each phase, we'll open a PR against the `accuracy_scorer` branch (rather than `master`)\r\n\r\n### Phase 1 - Initial Implementation\r\n\r\n- [x] Create a new plugin type, Accuracy\r\n- [x] Each entry will have a\r\n  - [x] CONFIG\r\n  - [x] Score coroutine method (`async def`)\r\n    - [x] Inputs\r\n      - [x] First is the same as the output of the predict method (an asynciterator of Record objects)\r\n      - [x] Second is list of Feature instances that we did prediction on\r\n    - [x] The method will look at the record.features() for the features we predicted, and the record.predictions() and return it's assessment of the accuracy.\r\n- [x] Change accuracy method of model to no longer be an `abstractmethod`, we'll make it so that it takes a second parameter, the accuracy_scorer (of type `AccuracyContext`). The `accuracy` method within `ModelContext` will\r\n  - [x] check if `self.config.predict` exists using `hasattr`, if not raise `NotImplementedError`\r\n  - [x] return a call to `accuracy_scorer.score(self.predict(sources), [self.config.predict])`\r\n- [x] We will need to modify the high level accuracy function to take accuracy_scorer as the second argument (after `model`)\r\n- [x] We will need to implement at least one of these from scratch within the main package (dffml) so that we can use it for testing and examples and the like\r\n\r\n### Phase 2 - Documentation\r\n\r\n- [x] Add and example with tests for the MSE accuracy scoring plugin\r\n- [x] Modify `dffml/model/slr.py` to remove the accuracy method\r\n- [x] Modify `scripts/docs/care` to add a `dffml.accuracy dffml` line\r\n\r\n### Phase 3 - Update Model Plugins\r\n\r\n  - [x] Remove `accuracy` method from the following models\r\n    - [x] dffml-model-scratch\r\n    - [x] dffml-model-scikit\r\n    - [x] dffml-model-tensorflow\r\n    - [x] dffml-model-vowpalWabbit\r\n    - [x] dffml-model-autosklearn\r\n    - [x] dffml-model-daal4py\r\n  - [x] For NLP models modify accuracy method signature to accept a scorer but log.warning that it won't be used\r\n    - [x] dffml-model-tensorflow-hub\r\n    - [x] dffml-model-transformers\r\n\r\n### Phase 3.33 - Update Model Plugin - Merge New Models from master branch\r\n\r\n- [x] Create PR that merges new models from master into accuracy scorer branch\r\n\r\n### Phase 3.66 - Update Model Plugin - Again\r\n\r\n  - [x] Remove `accuracy` method from the following models\r\n    - [x] dffml-model-pytorch\r\n  - [x] For NLP models modify accuracy method signature to accept a scorer but log.warning that it won't be used\r\n    - [x] dffml-model-spacy\r\n\r\n### Phase 4 - Update Tests and Examples\r\n\r\n- [x] Update `dffml/cli/ml.py` first so that CLI tests and examples will be able to specify which accuracy scorer to use\r\n- [x] Update tests and examples accordingly, use the MSE accuracy scorer for everything except ones where we took out the accuracy method in phase 3\r\n\r\n### Phase 5 - Update AccuracyScorer.score signature\r\n\r\n- [x] Change all of the `score` methods within all the `AccuracyScorer`s so that their signature is as follows\r\n  - `def score(self, mctx: ModelContext, sources: SourcesContext):`\r\n- [x] Remove the `accuracy` method from all of the `ModelContext`s\r\n  - There should one to remove from the base `ModelContext`\r\n  - There should be another to remove in `model/tensorflow_hub/dffml_model_tensorflow_hub/text_classifier.py`\r\n- [x] Modify all of tests that don't use the `high_level:accuracy` function to now use that function\r\n  - Anywhere we were doing the double context entry from when we didn't have the high level function (for example [here](https://github.com/intel/dffml/blob/1969195b1165c1bf9102deb4127b6f5517455d3d/model/tensorflow_hub/tests/test_model.py#L60-L63)) we want to now use the high_level accuracy function.\r\n- [x] Modify the `high_level.py:accuracy` function and the `no_async.py:accuracy` function so that they call the score method appropriately.\r\n\r\n### Phase 6 - Update HTTP Service\r\n\r\n- [x] The HTTP service will need updating to understand accuracy scorers\r\n  - [x] Add `configure_` routes for accuracy scorers\r\n  - [x] Tests for `configure_` routes for accuracy scorers\r\n- [x] Remove model accuracy route. Replace with /scorer/ route\r\n- [x] Add CLI options (update docs/cli.rst)\r\n  - [x] Make sure there are tests with this (tests/test_cli.py)\r\n- [x] Update HTTP API docs\r\n  - https://intel.github.io/dffml/master/plugins/service/http/api.html#accuracy\r\n\r\n### Phase 7 - Rebase master\r\n\r\n- [x] Rebase master branch. We want to avoid a merge commit since that would mess up the history.\r\n  - First we'll merge Phase 6 into accuracy_staging\r\n  - `git fetch origin`\r\n  - `git checkout -b phase7 origin/accuracy_staging`\r\n  - [x] Identify cherry picked patches if necessary\r\n    - **We're not sure if we should to do this**\r\n    - We may want to look through the log to see which commit messages are in both branches.\r\n    - Drop the cherry picked commits from this branch\r\n  - `git rebase origin/master`\r\n\r\n### Phase 8 - Update Documentation (Tutorials, Use Cases, CLI, etc.)\r\n\r\n- [x] Update Documentation that isn't being tested within the CI, check docs in the following locations\r\n  - tutorials\r\n   - Use Cases, CLI, etc.)","closed_by":{"login":"pdxjohnny","id":5950433,"node_id":"MDQ6VXNlcjU5NTA0MzM=","avatar_url":"https://avatars.githubusercontent.com/u/5950433?v=4","gravatar_id":"","url":"https://api.github.com/users/pdxjohnny","html_url":"https://github.com/pdxjohnny","followers_url":"https://api.github.com/users/pdxjohnny/followers","following_url":"https://api.github.com/users/pdxjohnny/following{/other_user}","gists_url":"https://api.github.com/users/pdxjohnny/gists{/gist_id}","starred_url":"https://api.github.com/users/pdxjohnny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pdxjohnny/subscriptions","organizations_url":"https://api.github.com/users/pdxjohnny/orgs","repos_url":"https://api.github.com/users/pdxjohnny/repos","events_url":"https://api.github.com/users/pdxjohnny/events{/privacy}","received_events_url":"https://api.github.com/users/pdxjohnny/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/intel/dffml/issues/732/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/intel/dffml/issues/732/timeline","performed_via_github_app":null,"state_reason":"completed"}