{"url":"https://api.github.com/repos/intel/dffml/issues/882","repository_url":"https://api.github.com/repos/intel/dffml","labels_url":"https://api.github.com/repos/intel/dffml/issues/882/labels{/name}","comments_url":"https://api.github.com/repos/intel/dffml/issues/882/comments","events_url":"https://api.github.com/repos/intel/dffml/issues/882/events","html_url":"https://github.com/intel/dffml/issues/882","id":737158977,"node_id":"MDU6SXNzdWU3MzcxNTg5Nzc=","number":882,"title":"ci: dataclasses package being installed by pytorch for Python 3.7 and 3.8","user":{"login":"pdxjohnny","id":5950433,"node_id":"MDQ6VXNlcjU5NTA0MzM=","avatar_url":"https://avatars.githubusercontent.com/u/5950433?v=4","gravatar_id":"","url":"https://api.github.com/users/pdxjohnny","html_url":"https://github.com/pdxjohnny","followers_url":"https://api.github.com/users/pdxjohnny/followers","following_url":"https://api.github.com/users/pdxjohnny/following{/other_user}","gists_url":"https://api.github.com/users/pdxjohnny/gists{/gist_id}","starred_url":"https://api.github.com/users/pdxjohnny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pdxjohnny/subscriptions","organizations_url":"https://api.github.com/users/pdxjohnny/orgs","repos_url":"https://api.github.com/users/pdxjohnny/repos","events_url":"https://api.github.com/users/pdxjohnny/events{/privacy}","received_events_url":"https://api.github.com/users/pdxjohnny/received_events","type":"User","site_admin":false},"labels":[{"id":1062701217,"node_id":"MDU6TGFiZWwxMDYyNzAxMjE3","url":"https://api.github.com/repos/intel/dffml/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-11-05T18:12:56Z","updated_at":"2020-11-05T19:03:04Z","closed_at":null,"author_association":"MEMBER","active_lock_reason":null,"body":"```console\r\n$ pipdeptree --reverse --packages dataclasses\r\ndataclasses==0.6\r\n  - torch==1.7.0 [requires: dataclasses]\r\n    - dffml-model-pytorch==0.0.1 [requires: torch>=1.6.0]\r\n    - dffml-model-transformers==0.0.3 [requires: torch>=1.5.0]\r\n    - torchvision==0.8.1 [requires: torch==1.7.0]\r\n      - dffml-model-pytorch==0.0.1 [requires: torchvision>=0.7.0]\r\n```\r\n\r\nIn `ericvsmith/dataclasses/setup.py` there is a [`python_requires=\">=3.6, <3.7\",`](https://github.com/ericvsmith/dataclasses/blob/75b24ef6d01d6c7a728b7ce6228b66f14c25db4f/setup.py#L23)\r\n\r\n@yashlamba cloned the repo and installed it but pip correctly does not let us install it\r\n\r\n```console\r\n$ git clone git@github.com:ericvsmith/dataclasses --depth=1\r\nCloning into 'dataclasses'...\r\nremote: Enumerating objects: 18, done.\r\nremote: Counting objects: 100% (18/18), done.\r\nremote: Compressing objects: 100% (15/15), done.\r\nremote: Total 18 (delta 3), reused 8 (delta 3), pack-reused 0\r\nReceiving objects: 100% (18/18), 40.64 KiB | 1.19 MiB/s, done.\r\nResolving deltas: 100% (3/3), done.\r\n$ python -m venv .venv\r\n$ . .venv/bin/activate\r\n$ pip install -U pip setuptools wheel\r\nCollecting pip\r\n  Downloading https://files.pythonhosted.org/packages/cb/28/91f26bd088ce8e22169032100d4260614fc3da435025ff389ef1d396a433/pip-20.2.4-py2.py3-none-any.whl (1.5MB)\r\n     |████████████████████████████████| 1.5MB 2.4MB/s \r\nCollecting setuptools\r\n  Downloading https://files.pythonhosted.org/packages/6d/38/c21ef5034684ffc0412deefbb07d66678332290c14bb5269c85145fbd55e/setuptools-50.3.2-py3-none-any.whl (785kB)\r\n     |████████████████████████████████| 788kB 87.7MB/s \r\nCollecting wheel\r\n  Using cached https://files.pythonhosted.org/packages/a7/00/3df031b3ecd5444d572141321537080b40c1c25e1caa3d86cdd12e5e919c/wheel-0.35.1-py2.py3-none-any.whl\r\nInstalling collected packages: pip, setuptools, wheel\r\n  Found existing installation: pip 19.2.3\r\n    Uninstalling pip-19.2.3:\r\n      Successfully uninstalled pip-19.2.3\r\n  Found existing installation: setuptools 41.2.0\r\n    Uninstalling setuptools-41.2.0:\r\n      Successfully uninstalled setuptools-41.2.0\r\nSuccessfully installed pip-20.2.4 setuptools-50.3.2 wheel-0.35.1\r\n$ pip install -U .\r\nProcessing /tmp/tmp.LPApB7X3ie/dataclasses\r\nERROR: Package 'dataclasses' requires a different Python: 3.7.6 not in '>=3.6, <3.7'\r\n```\r\n\r\nHowever, if one installs torch / torchvision, then dataclasses gets installed.\r\n\r\n```console\r\n pip install -U torch torchvision\r\nCollecting torch\r\n  Using cached torch-1.7.0-cp37-cp37m-manylinux1_x86_64.whl (776.7 MB)\r\nCollecting torchvision\r\n  Using cached torchvision-0.8.1-cp37-cp37m-manylinux1_x86_64.whl (12.7 MB)\r\nCollecting typing-extensions\r\n  Using cached typing_extensions-3.7.4.3-py3-none-any.whl (22 kB)\r\nCollecting numpy\r\n  Downloading numpy-1.19.4-cp37-cp37m-manylinux2010_x86_64.whl (14.5 MB)\r\n     |████████████████████████████████| 14.5 MB 2.1 MB/s \r\nProcessing /home/pdxjohnny/.cache/pip/wheels/56/b0/fe/4410d17b32f1f0c3cf54cdfb2bc04d7b4b8f4ae377e2229ba0/future-0.18.2-py3-none-any.whl\r\nCollecting dataclasses\r\n  Using cached dataclasses-0.6-py3-none-any.whl (14 kB)\r\nCollecting pillow>=4.1.1\r\n  Downloading Pillow-8.0.1-cp37-cp37m-manylinux1_x86_64.whl (2.2 MB)\r\n     |████████████████████████████████| 2.2 MB 106.0 MB/s \r\nInstalling collected packages: typing-extensions, numpy, future, dataclasses, torch, pillow, torchvision\r\nSuccessfully installed dataclasses-0.6 future-0.18.2 numpy-1.19.4 pillow-8.0.1 torch-1.7.0 torchvision-0.8.1 typing-extensions-3.7.4.3\r\n```\r\n\r\ndataclasses 0.6 is not compatible with Python 3.7+, it's just that dataclasses pypi releases prior to 0.7 did not have the `python_requires` version specifier in it's `setup.py`. The fix implemented in https://github.com/pytorch/pytorch/commit/dc53eefd256ad0110fae098be96d403ae7b85a97 is incomplete, see: https://github.com/ericvsmith/dataclasses/issues/153\r\n\r\n```\r\n2020-11-03T19:28:37.0941617Z   File \"/usr/share/miniconda/lib/python3.7/site-packages/dataclasses.py\", line 958, in dataclass\r\n2020-11-03T19:28:37.0943155Z     return wrap(_cls)\r\n2020-11-03T19:28:37.0945139Z   File \"/usr/share/miniconda/lib/python3.7/site-packages/dataclasses.py\", line 950, in wrap\r\n2020-11-03T19:28:37.0946856Z     return _process_class(cls, init, repr, eq, order, unsafe_hash, frozen)\r\n2020-11-03T19:28:37.0949297Z   File \"/usr/share/miniconda/lib/python3.7/site-packages/dataclasses.py\", line 801, in _process_class\r\n2020-11-03T19:28:37.0950864Z     for name, type in cls_annotations.items()]\r\n2020-11-03T19:28:37.0952995Z   File \"/usr/share/miniconda/lib/python3.7/site-packages/dataclasses.py\", line 801, in <listcomp>\r\n2020-11-03T19:28:37.0954526Z     for name, type in cls_annotations.items()]\r\n2020-11-03T19:28:37.0956630Z   File \"/usr/share/miniconda/lib/python3.7/site-packages/dataclasses.py\", line 659, in _get_field\r\n2020-11-03T19:28:37.0958026Z     if (_is_classvar(a_type, typing)\r\n2020-11-03T19:28:37.0959965Z   File \"/usr/share/miniconda/lib/python3.7/site-packages/dataclasses.py\", line 550, in _is_classvar\r\n2020-11-03T19:28:37.0961517Z     return type(a_type) is typing._ClassVar\r\n2020-11-03T19:28:37.0962446Z AttributeError: module 'typing' has no attribute '_ClassVar'\r\n```","closed_by":null,"reactions":{"url":"https://api.github.com/repos/intel/dffml/issues/882/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/intel/dffml/issues/882/timeline","performed_via_github_app":null,"state_reason":null}