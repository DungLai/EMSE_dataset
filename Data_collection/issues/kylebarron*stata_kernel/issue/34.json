{"url":"https://api.github.com/repos/kylebarron/stata_kernel/issues/34","repository_url":"https://api.github.com/repos/kylebarron/stata_kernel","labels_url":"https://api.github.com/repos/kylebarron/stata_kernel/issues/34/labels{/name}","comments_url":"https://api.github.com/repos/kylebarron/stata_kernel/issues/34/comments","events_url":"https://api.github.com/repos/kylebarron/stata_kernel/issues/34/events","html_url":"https://github.com/kylebarron/stata_kernel/issues/34","id":348432316,"node_id":"MDU6SXNzdWUzNDg0MzIzMTY=","number":34,"title":"Notes","user":{"login":"kylebarron","id":15164633,"node_id":"MDQ6VXNlcjE1MTY0NjMz","avatar_url":"https://avatars.githubusercontent.com/u/15164633?v=4","gravatar_id":"","url":"https://api.github.com/users/kylebarron","html_url":"https://github.com/kylebarron","followers_url":"https://api.github.com/users/kylebarron/followers","following_url":"https://api.github.com/users/kylebarron/following{/other_user}","gists_url":"https://api.github.com/users/kylebarron/gists{/gist_id}","starred_url":"https://api.github.com/users/kylebarron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kylebarron/subscriptions","organizations_url":"https://api.github.com/users/kylebarron/orgs","repos_url":"https://api.github.com/users/kylebarron/repos","events_url":"https://api.github.com/users/kylebarron/events{/privacy}","received_events_url":"https://api.github.com/users/kylebarron/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2018-08-07T18:15:46Z","updated_at":"2018-08-08T04:09:14Z","closed_at":"2018-08-08T04:09:14Z","author_association":"OWNER","active_lock_reason":null,"body":"See https://github.com/kylebarron/stata_kernel/issues/22.\r\nIf I use just `\\r\\n\\. ` as the regex, if I run `di \". text\"`, pexpect gets confused because it's looking for the next linesep + dot + space as the prompt, but the first one it finds is the result, and not the next line prompt. I believe all prompts have a full empty line before them, so I made `\\r\\n\\r\\n\\. ` the regex to find the dot prompt, but this failed on Linux on my machine whenever it did a shell command. `!ls` would have the \\x1b ANSI escape code returned from the shell, and wouldn't match the double linesep. The lookbehind instead of just matching them leaves an extra newline between results. Otherwise the next row of [2]: would be right up against [1]:\r\n\r\nNo, `exit` doesn't work. This is because pexpect is waiting for a response from the spawned Stata console, but that has already closed. I need to figure out how to fix this. See https://github.com/kylebarron/stata_kernel/issues/7\r\n\r\nI plan to refactor the code a good amount. I'd say the code is relatively clean for having written it quickly, but I want to step back a minute and try to think through an optimal structure for the package. I'm thinking of moving all the code that deals with validating input into a code_manager.py file (see https://github.com/kylebarron/stata_kernel/issues/32 for initial thoughts). Hopefully that will parse input and not send code to Stata unless it's sure that it can be run safely (once I turn off the timeout option, things will run forever if invalid input is sent to the console). Ideally this would also use tokens for autocompletions, though I'll probably put that into a separate file.\r\n\r\nThen a separate run.py file for sending the validated code to Stata and retrieving output. I'm happy to have devised a function that allows me to abstract the differences between sending code with Windows Automation vs Mac Applescript. But there's still differences on each platform with retrieving output. There are some issues with retrieving graphs, especially, and apparently Stata 14 doesn't export SVG?\r\n\r\n","closed_by":{"login":"kylebarron","id":15164633,"node_id":"MDQ6VXNlcjE1MTY0NjMz","avatar_url":"https://avatars.githubusercontent.com/u/15164633?v=4","gravatar_id":"","url":"https://api.github.com/users/kylebarron","html_url":"https://github.com/kylebarron","followers_url":"https://api.github.com/users/kylebarron/followers","following_url":"https://api.github.com/users/kylebarron/following{/other_user}","gists_url":"https://api.github.com/users/kylebarron/gists{/gist_id}","starred_url":"https://api.github.com/users/kylebarron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kylebarron/subscriptions","organizations_url":"https://api.github.com/users/kylebarron/orgs","repos_url":"https://api.github.com/users/kylebarron/repos","events_url":"https://api.github.com/users/kylebarron/events{/privacy}","received_events_url":"https://api.github.com/users/kylebarron/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/kylebarron/stata_kernel/issues/34/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/kylebarron/stata_kernel/issues/34/timeline","performed_via_github_app":null,"state_reason":"completed"}