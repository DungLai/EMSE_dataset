{"url":"https://api.github.com/repos/kylebarron/stata_kernel/issues/318","repository_url":"https://api.github.com/repos/kylebarron/stata_kernel","labels_url":"https://api.github.com/repos/kylebarron/stata_kernel/issues/318/labels{/name}","comments_url":"https://api.github.com/repos/kylebarron/stata_kernel/issues/318/comments","events_url":"https://api.github.com/repos/kylebarron/stata_kernel/issues/318/events","html_url":"https://github.com/kylebarron/stata_kernel/issues/318","id":517529918,"node_id":"MDU6SXNzdWU1MTc1Mjk5MTg=","number":318,"title":"Space in path breaks log cleaning","user":{"login":"alanzchen","id":2144783,"node_id":"MDQ6VXNlcjIxNDQ3ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2144783?v=4","gravatar_id":"","url":"https://api.github.com/users/alanzchen","html_url":"https://github.com/alanzchen","followers_url":"https://api.github.com/users/alanzchen/followers","following_url":"https://api.github.com/users/alanzchen/following{/other_user}","gists_url":"https://api.github.com/users/alanzchen/gists{/gist_id}","starred_url":"https://api.github.com/users/alanzchen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alanzchen/subscriptions","organizations_url":"https://api.github.com/users/alanzchen/orgs","repos_url":"https://api.github.com/users/alanzchen/repos","events_url":"https://api.github.com/users/alanzchen/events{/privacy}","received_events_url":"https://api.github.com/users/alanzchen/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-11-05T03:36:53Z","updated_at":"2020-02-08T21:03:13Z","closed_at":"2020-02-08T21:03:13Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"#### Problem description\r\n\r\nWhen the current working directory contains white spaces, log cleaning fails and the entire kernel dies.\r\n\r\nJuypter notebook console:\r\n\r\n```\r\n[IPKernelApp] ERROR | Exception in message handler:\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.7/site-packages/ipykernel/kernelbase.py\", line 272, in dispatch_shell\r\n    yield gen.maybe_future(handler(stream, idents, msg))\r\n  File \"/usr/local/lib/python3.7/site-packages/tornado/gen.py\", line 729, in run\r\n    value = future.result()\r\n  File \"/usr/local/lib/python3.7/site-packages/tornado/gen.py\", line 209, in wrapper\r\n    yielded = next(result)\r\n  File \"/usr/local/lib/python3.7/site-packages/ipykernel/kernelbase.py\", line 542, in execute_request\r\n    user_expressions, allow_stdin,\r\n  File \"/usr/local/lib/python3.7/site-packages/stata_kernel/kernel.py\", line 125, in do_execute\r\n    text_to_run, md5, text_to_exclude=text_to_exclude)\r\n  File \"/usr/local/lib/python3.7/site-packages/stata_kernel/stata_session.py\", line 274, in do\r\n    self.kernel.cleanTail(\"`{0}'\".format(md5), self.prompt_dot)\r\n  File \"/usr/local/lib/python3.7/site-packages/stata_kernel/kernel.py\", line 359, in cleanTail\r\n    with open(logfile, 'r+', encoding='utf-8') as fh:\r\nFileNotFoundError: [Errno 2] No such file or directory: '/Users/alan/Library/Mobile'\r\n\r\n```\r\n\r\nI launched Jupyter Lab in `~/Workspace/`, which is a soft-link to `~/Library/Mobile Documents/com~apple~CloudDocs/Workspace/`.\r\n\r\n#### Debugging log\r\n\r\n```\r\n\u001B[?1h\u001B=\r\n  ___  ____  ____  ____  ____ (R)\r\n /__    /   ____/   /   ____/\r\n___/   /   /___/   /   /___/   15.1   Copyright 1985-2017 StataCorp LLC\r\n  Statistics/Data Analysis            StataCorp\r\n                                      4905 Lakeway Drive\r\n     Special Edition                  College Station, Texas 77845 USA\r\n                                      800-STATA-PC        http://www.stata.com\r\n                                      979-696-4600        stata@stata.com\r\n                                      979-696-4601 (fax)\r\n\r\n100-student Stata lab perpetual license:\r\n       Serial number:  401506209499\r\n         Licensed to:  Alan Chen\r\n                       \r\n\r\nNotes:\r\n      1.  Unicode is supported; see help unicode_advice.\r\n      2.  Maximum number of variables is set to 5000; see help set_maxvar.\r\n\r\n. adopath + `\"/usr/local/lib/python3.7/site-packages/stata_kernel/ado\"'\r\ncd `\"/Users/alan/Library/Mobile Documents/com~apple~CloudDocs/Workspace/PA HW\"'\r\nset more on\r\nset pagesize 100\r\nset linesize 255\r\nclear all\r\nglobal stata_kernel_graph_counter = 0\r\n\r\ndi \"$S_DATE, $S_TIME\"\r\ndi \"Stata version: `c(version)'\"\r\ndi \"OS: $S_OS\"\r\n`finished_init_cmd'\r\nadopath + `\"/usr/local/lib/python3.7/site-packages/stata_kernel/ado\"'\r\n  [1]  (BASE)      \"/Applications/Stata/ado/base/\"\r\n  [2]  (SITE)      \"/Applications/ado/\"\r\n  [3]              \".\"\r\n  [4]  (PERSONAL)  \"/Users/alan/Library/Application Support/Stata/ado/personal/\"\r\n  [5]  (PLUS)      \"/Users/alan/Library/Application Support/Stata/ado/plus/\"\r\n  [6]  (OLDPLACE)  \"~/ado/\"\r\n  [7]              \"/usr/local/lib/python3.7/site-packages/stata_kernel/ado\"\r\n\r\n. cd `\"/Users/alan/Library/Mobile Documents/com~apple~CloudDocs/Workspace/PA HW\"'\r\n/Users/alan/Library/Mobile Documents/com~apple~CloudDocs/Workspace/PA HW\r\n\r\n. set more on\r\n\r\n. set pagesize 100\r\n\r\n. set linesize 255\r\n\r\n. clear all\r\n\r\n. global stata_kernel_graph_counter = 0\r\n\r\n. \r\n. di \"$S_DATE, $S_TIME\"\r\n 4 Nov 2019, 21:31:58\r\n\r\n. di \"Stata version: `c(version)'\"\r\nStata version: 15.1\r\n\r\n. di \"OS: $S_OS\"\r\nOS: Unix\r\n\r\n. `finished_init_cmd'\r\n. di \"`c(stata_version)'\"\r\n`done'\r\ndi \"`c(stata_version)'\"\r\n15.1\r\n\r\n. `done'\r\n. _StataKernelCompletions\r\n`bcc4869c9c119320f7af8a3981776720'\r\n_StataKernelCompletions\r\n%mata%\r\n\r\n      # bytes   type                        name and extent\r\n-------------------------------------------------------------------------------\r\n-------------------------------------------------------------------------------\r\n%varlist%\r\n\r\n%globals%\r\nstata_kernel_graph_counter S_ADO S_level F1 F2 F7 F8 S_StataSE S_CONSOLE S_FLAVOR S_OS S_MACH\r\n%logfiles%\r\n%scalars%\r\n\r\n%programs%\r\n  ado      792  _StataKernelCompletions\r\n  ado      242  clear.clearreturn\r\n  ado      603  clear._clear_9\r\n  ado     1622  clear\r\n      --------\r\n          3259\r\n\r\n%matrices%\r\n\r\n\r\n. `bcc4869c9c119320f7af8a3981776720'\r\n. mata : invtokens(st_dir(\"local\", \"macro\", \"*\")')\r\n`08a286cef0dc100f5df674f2b5353f29'\r\nmata : invtokens(st_dir(\"local\", \"macro\", \"*\")')\r\n  \r\n\r\n. `08a286cef0dc100f5df674f2b5353f29'\r\n. include /Users/alan/.stata_kernel_cache/include.do\r\n`84d89c91cc0aa7dd2bfc40d61af9e55b'\r\ninclude /Users/alan/.stata_kernel_cache/include.do\r\n\r\n. cap di \"Set _rc to 0 initially\"\r\n\r\n. . `84d89c91cc0aa7dd2bfc40d61af9e55b'\r\n. set more off\r\n`667775c0ed1c17763bb77a9bd7e24e89'\r\nset more off\r\n\r\n. `667775c0ed1c17763bb77a9bd7e24e89'\r\n. include /Users/alan/.stata_kernel_cache/include.do\r\n`cc64df03024327541235dabb93f09e00'\r\ninclude /Users/alan/.stata_kernel_cache/include.do\r\n\r\n. tempname __user_rc\r\n\r\n. local `__user_rc' = _rc\r\n\r\n. . `cc64df03024327541235dabb93f09e00'\r\n. _StataKernelLog off\r\n`25222c9f47f7fdc660ba522f7a53d380'\r\n_StataKernelLog off\r\n\r\n. `25222c9f47f7fdc660ba522f7a53d380'\r\n. di `c(linesize)'\r\n`83b14c3154752dfbf1b0322b89ffcf55'\r\ndi `c(linesize)'\r\n255\r\n\r\n. `83b14c3154752dfbf1b0322b89ffcf55'\r\n. pwd\r\n`9003d1df22eb4d3820015070385194c8'\r\npwd\r\n/Users/alan/Library/Mobile Documents/com~apple~CloudDocs/Workspace/PA HW\r\n\r\n. `9003d1df22eb4d3820015070385194c8'\r\n. _StataKernelCompletions\r\n`bcc4869c9c119320f7af8a3981776720'\r\n_StataKernelCompletions\r\n%mata%\r\n\r\n      # bytes   type                        name and extent\r\n-------------------------------------------------------------------------------\r\n-------------------------------------------------------------------------------\r\n%varlist%\r\n\r\n%globals%\r\nstata_kernel_graph_counter S_ADO S_level F1 F2 F7 F8 S_StataSE S_CONSOLE S_FLAVOR S_OS S_MACH\r\n%logfiles%\r\n%scalars%\r\n\r\n%programs%\r\n  ado     1271  _StataKernelLog\r\n  ado      792  _StataKernelCompletions\r\n  ado      242  clear.clearreturn\r\n  ado      603  clear._clear_9\r\n  ado     1622  clear\r\n      --------\r\n          4530\r\n\r\n%matrices%\r\n\r\n\r\n. `bcc4869c9c119320f7af8a3981776720'\r\n. mata : invtokens(st_dir(\"local\", \"macro\", \"*\")')\r\n`08a286cef0dc100f5df674f2b5353f29'\r\nmata : invtokens(st_dir(\"local\", \"macro\", \"*\")')\r\n  __000000 __user_rc\r\n\r\n. `08a286cef0dc100f5df674f2b5353f29'\r\n. macro list `:all globals'\r\n`acf5410dffcb668adf37da696e87d400'\r\nmacro list `:all globals'\r\nstata_kernel_graph_counter:\r\n                0\r\nS_ADO:          BASE;SITE;.;PERSONAL;PLUS;OLDPLACE;`\"/usr/local/lib/python3.7/site-packages/stata_kernel/ado\"'\r\nS_level:        95\r\nF1:             help advice;\r\nF2:             describe;\r\nF7:             save\r\nF8:             use\r\nS_StataSE:      SE\r\nS_CONSOLE:      console\r\nS_FLAVOR:       Intercooled\r\nS_OS:           Unix\r\nS_MACH:         Macintosh (Intel 64-bit)\r\n\r\n. `acf5410dffcb668adf37da696e87d400'\r\n. _StataKernelLog on\r\n`d450cfde56d6cad2042c8f0870cc76f5'\r\n_StataKernelLog on\r\n\r\n. `d450cfde56d6cad2042c8f0870cc76f5'\r\n. include /Users/alan/.stata_kernel_cache/include.do\r\n`d1d0b5544eadcba44c5f1aa5695588da'\r\ninclude /Users/alan/.stata_kernel_cache/include.do\r\n\r\n. _StataKernelResetRC, num(``__user_rc'')\r\n\r\n. macro drop _`__user_rc'\r\n\r\n. macro drop ___user_rc\r\n\r\n. . `d1d0b5544eadcba44c5f1aa5695588da'\r\n. use births.dta\r\n`a292eda02922aec1f9f461275f0301bd'\r\nuse births.dta\r\n\r\n. `a292eda02922aec1f9f461275f0301bd'\r\n. include /Users/alan/.stata_kernel_cache/include.do\r\n`cc64df03024327541235dabb93f09e00'\r\ninclude /Users/alan/.stata_kernel_cache/include.do\r\n\r\n. tempname __user_rc\r\n\r\n. local `__user_rc' = _rc\r\n\r\n. . `cc64df03024327541235dabb93f09e00'\r\n. _StataKernelLog off\r\n`25222c9f47f7fdc660ba522f7a53d380'\r\n_StataKernelLog off\r\n\r\n. `25222c9f47f7fdc660ba522f7a53d380'\r\n. di `c(linesize)'\r\n`83b14c3154752dfbf1b0322b89ffcf55'\r\ndi `c(linesize)'\r\n255\r\n\r\n. `83b14c3154752dfbf1b0322b89ffcf55'\r\n. pwd\r\n`9003d1df22eb4d3820015070385194c8'\r\npwd\r\n/Users/alan/Library/Mobile Documents/com~apple~CloudDocs/Workspace/PA HW\r\n\r\n. `9003d1df22eb4d3820015070385194c8'\r\n. _StataKernelCompletions\r\n`bcc4869c9c119320f7af8a3981776720'\r\n_StataKernelCompletions\r\n%mata%\r\n\r\n      # bytes   type                        name and extent\r\n-------------------------------------------------------------------------------\r\n-------------------------------------------------------------------------------\r\n%varlist%\r\nstname state year lnbrate REPEAL unemrate pcinc pctnonwh educ_ba educ_hs lnbrat2034 lnbrat1519 lnbrat3544\r\n%globals%\r\nS_FNDATE S_FN stata_kernel_graph_counter S_ADO S_level F1 F2 F7 F8 S_StataSE S_CONSOLE S_FLAVOR S_OS S_MACH\r\n%logfiles%\r\n%scalars%\r\n\r\n%programs%\r\n  ado      274  _StataKernelResetRC\r\n  ado     1271  _StataKernelLog\r\n  ado      792  _StataKernelCompletions\r\n  ado      242  clear.clearreturn\r\n  ado      603  clear._clear_9\r\n  ado     1622  clear\r\n      --------\r\n          4804\r\n\r\n%matrices%\r\n\r\n\r\n. `bcc4869c9c119320f7af8a3981776720'\r\n. mata : invtokens(st_dir(\"local\", \"macro\", \"*\")')\r\n`08a286cef0dc100f5df674f2b5353f29'\r\nmata : invtokens(st_dir(\"local\", \"macro\", \"*\")')\r\n  __000001 __user_rc\r\n\r\n. `08a286cef0dc100f5df674f2b5353f29'\r\n. macro list `:all globals'\r\n`acf5410dffcb668adf37da696e87d400'\r\nmacro list `:all globals'\r\nS_FNDATE:        3 May 2009 21:18\r\nS_FN:           births.dta\r\nstata_kernel_graph_counter:\r\n                0\r\nS_ADO:          BASE;SITE;.;PERSONAL;PLUS;OLDPLACE;`\"/usr/local/lib/python3.7/site-packages/stata_kernel/ado\"'\r\nS_level:        95\r\nF1:             help advice;\r\nF2:             describe;\r\nF7:             save\r\nF8:             use\r\nS_StataSE:      SE\r\nS_CONSOLE:      console\r\nS_FLAVOR:       Intercooled\r\nS_OS:           Unix\r\nS_MACH:         Macintosh (Intel 64-bit)\r\n\r\n. `acf5410dffcb668adf37da696e87d400'\r\n. _StataKernelLog on\r\n`d450cfde56d6cad2042c8f0870cc76f5'\r\n_StataKernelLog on\r\n\r\n. `d450cfde56d6cad2042c8f0870cc76f5'\r\n. include /Users/alan/.stata_kernel_cache/include.do\r\n`d1d0b5544eadcba44c5f1aa5695588da'\r\ninclude /Users/alan/.stata_kernel_cache/include.do\r\n\r\n. _StataKernelResetRC, num(``__user_rc'')\r\n\r\n. macro drop _`__user_rc'\r\n\r\n. macro drop ___user_rc\r\n\r\n. . `d1d0b5544eadcba44c5f1aa5695588da'\r\n. \r\n\r\n```\r\n\r\n#### Code Sample\r\n\r\n```stata\r\nlog using log.log, text replace\r\n```\r\n\r\n#### Expected Output\r\n\r\n\r\n#### Other information\r\n","closed_by":{"login":"mcaceresb","id":4219197,"node_id":"MDQ6VXNlcjQyMTkxOTc=","avatar_url":"https://avatars.githubusercontent.com/u/4219197?v=4","gravatar_id":"","url":"https://api.github.com/users/mcaceresb","html_url":"https://github.com/mcaceresb","followers_url":"https://api.github.com/users/mcaceresb/followers","following_url":"https://api.github.com/users/mcaceresb/following{/other_user}","gists_url":"https://api.github.com/users/mcaceresb/gists{/gist_id}","starred_url":"https://api.github.com/users/mcaceresb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mcaceresb/subscriptions","organizations_url":"https://api.github.com/users/mcaceresb/orgs","repos_url":"https://api.github.com/users/mcaceresb/repos","events_url":"https://api.github.com/users/mcaceresb/events{/privacy}","received_events_url":"https://api.github.com/users/mcaceresb/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/kylebarron/stata_kernel/issues/318/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/kylebarron/stata_kernel/issues/318/timeline","performed_via_github_app":null,"state_reason":"completed"}