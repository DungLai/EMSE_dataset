[{"url":"https://api.github.com/repos/justinshenk/fer/issues/comments/489768383","html_url":"https://github.com/justinshenk/fer/issues/1#issuecomment-489768383","issue_url":"https://api.github.com/repos/justinshenk/fer/issues/1","id":489768383,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4OTc2ODM4Mw==","user":{"login":"justinshenk","id":10270308,"node_id":"MDQ6VXNlcjEwMjcwMzA4","avatar_url":"https://avatars.githubusercontent.com/u/10270308?v=4","gravatar_id":"","url":"https://api.github.com/users/justinshenk","html_url":"https://github.com/justinshenk","followers_url":"https://api.github.com/users/justinshenk/followers","following_url":"https://api.github.com/users/justinshenk/following{/other_user}","gists_url":"https://api.github.com/users/justinshenk/gists{/gist_id}","starred_url":"https://api.github.com/users/justinshenk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinshenk/subscriptions","organizations_url":"https://api.github.com/users/justinshenk/orgs","repos_url":"https://api.github.com/users/justinshenk/repos","events_url":"https://api.github.com/users/justinshenk/events{/privacy}","received_events_url":"https://api.github.com/users/justinshenk/received_events","type":"User","site_admin":false},"created_at":"2019-05-06T20:40:30Z","updated_at":"2019-05-06T20:40:30Z","author_association":"OWNER","body":"Thanks for your feedback and post @AsbjornOlling! I wasn't able to reproduce the issue with the following modification to `example.py`:\r\n\r\n```python\r\nimage = cv2.imread(\"justin.jpg\")\r\nresult = detector.detect_emotions(image)\r\nprint(result)\r\nresult = detector.detect_emotions(cv2.imread('justin2.png'))\r\nprint(result)\r\n```\r\nThis runs without error on my system. If you can provide the code that caused this error please let me know.","reactions":{"url":"https://api.github.com/repos/justinshenk/fer/issues/comments/489768383/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"justinshenk","id":10270308,"node_id":"MDQ6VXNlcjEwMjcwMzA4","avatar_url":"https://avatars.githubusercontent.com/u/10270308?v=4","gravatar_id":"","url":"https://api.github.com/users/justinshenk","html_url":"https://github.com/justinshenk","followers_url":"https://api.github.com/users/justinshenk/followers","following_url":"https://api.github.com/users/justinshenk/following{/other_user}","gists_url":"https://api.github.com/users/justinshenk/gists{/gist_id}","starred_url":"https://api.github.com/users/justinshenk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinshenk/subscriptions","organizations_url":"https://api.github.com/users/justinshenk/orgs","repos_url":"https://api.github.com/users/justinshenk/repos","events_url":"https://api.github.com/users/justinshenk/events{/privacy}","received_events_url":"https://api.github.com/users/justinshenk/received_events","type":"User","site_admin":false}},{"id":2322121471,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjMyMjEyMTQ3MQ==","url":"https://api.github.com/repos/justinshenk/fer/issues/events/2322121471","actor":{"login":"AsbjornOlling","id":11493130,"node_id":"MDQ6VXNlcjExNDkzMTMw","avatar_url":"https://avatars.githubusercontent.com/u/11493130?v=4","gravatar_id":"","url":"https://api.github.com/users/AsbjornOlling","html_url":"https://github.com/AsbjornOlling","followers_url":"https://api.github.com/users/AsbjornOlling/followers","following_url":"https://api.github.com/users/AsbjornOlling/following{/other_user}","gists_url":"https://api.github.com/users/AsbjornOlling/gists{/gist_id}","starred_url":"https://api.github.com/users/AsbjornOlling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AsbjornOlling/subscriptions","organizations_url":"https://api.github.com/users/AsbjornOlling/orgs","repos_url":"https://api.github.com/users/AsbjornOlling/repos","events_url":"https://api.github.com/users/AsbjornOlling/events{/privacy}","received_events_url":"https://api.github.com/users/AsbjornOlling/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-05-06T20:40:30Z","performed_via_github_app":null},{"id":2322121473,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzMjIxMjE0NzM=","url":"https://api.github.com/repos/justinshenk/fer/issues/events/2322121473","actor":{"login":"AsbjornOlling","id":11493130,"node_id":"MDQ6VXNlcjExNDkzMTMw","avatar_url":"https://avatars.githubusercontent.com/u/11493130?v=4","gravatar_id":"","url":"https://api.github.com/users/AsbjornOlling","html_url":"https://github.com/AsbjornOlling","followers_url":"https://api.github.com/users/AsbjornOlling/followers","following_url":"https://api.github.com/users/AsbjornOlling/following{/other_user}","gists_url":"https://api.github.com/users/AsbjornOlling/gists{/gist_id}","starred_url":"https://api.github.com/users/AsbjornOlling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AsbjornOlling/subscriptions","organizations_url":"https://api.github.com/users/AsbjornOlling/orgs","repos_url":"https://api.github.com/users/AsbjornOlling/repos","events_url":"https://api.github.com/users/AsbjornOlling/events{/privacy}","received_events_url":"https://api.github.com/users/AsbjornOlling/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-05-06T20:40:30Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/justinshenk/fer/issues/comments/493760044","html_url":"https://github.com/justinshenk/fer/issues/1#issuecomment-493760044","issue_url":"https://api.github.com/repos/justinshenk/fer/issues/1","id":493760044,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5Mzc2MDA0NA==","user":{"login":"AsbjornOlling","id":11493130,"node_id":"MDQ6VXNlcjExNDkzMTMw","avatar_url":"https://avatars.githubusercontent.com/u/11493130?v=4","gravatar_id":"","url":"https://api.github.com/users/AsbjornOlling","html_url":"https://github.com/AsbjornOlling","followers_url":"https://api.github.com/users/AsbjornOlling/followers","following_url":"https://api.github.com/users/AsbjornOlling/following{/other_user}","gists_url":"https://api.github.com/users/AsbjornOlling/gists{/gist_id}","starred_url":"https://api.github.com/users/AsbjornOlling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AsbjornOlling/subscriptions","organizations_url":"https://api.github.com/users/AsbjornOlling/orgs","repos_url":"https://api.github.com/users/AsbjornOlling/repos","events_url":"https://api.github.com/users/AsbjornOlling/events{/privacy}","received_events_url":"https://api.github.com/users/AsbjornOlling/received_events","type":"User","site_admin":false},"created_at":"2019-05-19T14:03:30Z","updated_at":"2019-05-19T14:04:50Z","author_association":"NONE","body":"I didn't notice that you responded until just now.\r\n\r\nThis is the relevant code snippet, which bugs out without the tensorflow context manager.\r\nIt's contained inside a function which just takes a `bytes` object as input.\r\nThe first call of my function works fine, but the second call bugs out.\r\n\r\nIt's within a Flask microservice, so I can't load the images as a file, like you do.\r\n\r\nI'm using python 3.6, if that should make any difference.\r\n\r\n```python\r\n    assert isinstance(img, bytes), f\"Img is not bytes. Is: {type(img)}\"\r\n\r\n    # read image bytes to opencv matrix\r\n    img = cv2.imdecode(\r\n        np.asarray(bytearray(img), dtype=np.uint8),\r\n        cv2.IMREAD_COLOR\r\n    )\r\n\r\n    # analyze image with FER\r\n    with tf.Session():\r\n        result = FER().detect_emotions(img)\r\n    assert result != [], \"No faces found in image.\"\r\n```\r\n\r\nThank you for looking into the issue :+1: ","reactions":{"url":"https://api.github.com/repos/justinshenk/fer/issues/comments/493760044/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"AsbjornOlling","id":11493130,"node_id":"MDQ6VXNlcjExNDkzMTMw","avatar_url":"https://avatars.githubusercontent.com/u/11493130?v=4","gravatar_id":"","url":"https://api.github.com/users/AsbjornOlling","html_url":"https://github.com/AsbjornOlling","followers_url":"https://api.github.com/users/AsbjornOlling/followers","following_url":"https://api.github.com/users/AsbjornOlling/following{/other_user}","gists_url":"https://api.github.com/users/AsbjornOlling/gists{/gist_id}","starred_url":"https://api.github.com/users/AsbjornOlling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AsbjornOlling/subscriptions","organizations_url":"https://api.github.com/users/AsbjornOlling/orgs","repos_url":"https://api.github.com/users/AsbjornOlling/repos","events_url":"https://api.github.com/users/AsbjornOlling/events{/privacy}","received_events_url":"https://api.github.com/users/AsbjornOlling/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/justinshenk/fer/issues/comments/493768062","html_url":"https://github.com/justinshenk/fer/issues/1#issuecomment-493768062","issue_url":"https://api.github.com/repos/justinshenk/fer/issues/1","id":493768062,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5Mzc2ODA2Mg==","user":{"login":"justinshenk","id":10270308,"node_id":"MDQ6VXNlcjEwMjcwMzA4","avatar_url":"https://avatars.githubusercontent.com/u/10270308?v=4","gravatar_id":"","url":"https://api.github.com/users/justinshenk","html_url":"https://github.com/justinshenk","followers_url":"https://api.github.com/users/justinshenk/followers","following_url":"https://api.github.com/users/justinshenk/following{/other_user}","gists_url":"https://api.github.com/users/justinshenk/gists{/gist_id}","starred_url":"https://api.github.com/users/justinshenk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinshenk/subscriptions","organizations_url":"https://api.github.com/users/justinshenk/orgs","repos_url":"https://api.github.com/users/justinshenk/repos","events_url":"https://api.github.com/users/justinshenk/events{/privacy}","received_events_url":"https://api.github.com/users/justinshenk/received_events","type":"User","site_admin":false},"created_at":"2019-05-19T15:46:50Z","updated_at":"2019-05-19T15:47:11Z","author_association":"OWNER","body":"I didn't realize this bug was within Flask. I had issues as well due to threading and Flask being single-threaded (see [issue](https://github.com/keras-team/keras/issues/2397)). For a Flask project [deepemotion.io](https://github.com/justinshenk/deepemotion/blob/master/app.py) I did the following (using the `Video` class in combination):\r\n\r\n```python\r\ndetector = FER(emotion_model=os.environ.get('EMOTION_API_URL', None))\r\ncurrent_video = None\r\n...\r\n@app.route('/analyze', methods=['GET'])\r\ndef analyze():\r\n        global current_video\r\n        ...\r\n        df = current_video.analyze(\r\n            detector,\r\n            display=False, ...)\r\n```\r\nGlad to know about the tf.Session() solution! ","reactions":{"url":"https://api.github.com/repos/justinshenk/fer/issues/comments/493768062/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"justinshenk","id":10270308,"node_id":"MDQ6VXNlcjEwMjcwMzA4","avatar_url":"https://avatars.githubusercontent.com/u/10270308?v=4","gravatar_id":"","url":"https://api.github.com/users/justinshenk","html_url":"https://github.com/justinshenk","followers_url":"https://api.github.com/users/justinshenk/followers","following_url":"https://api.github.com/users/justinshenk/following{/other_user}","gists_url":"https://api.github.com/users/justinshenk/gists{/gist_id}","starred_url":"https://api.github.com/users/justinshenk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinshenk/subscriptions","organizations_url":"https://api.github.com/users/justinshenk/orgs","repos_url":"https://api.github.com/users/justinshenk/repos","events_url":"https://api.github.com/users/justinshenk/events{/privacy}","received_events_url":"https://api.github.com/users/justinshenk/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/justinshenk/fer/issues/comments/496286629","html_url":"https://github.com/justinshenk/fer/issues/1#issuecomment-496286629","issue_url":"https://api.github.com/repos/justinshenk/fer/issues/1","id":496286629,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NjI4NjYyOQ==","user":{"login":"justinshenk","id":10270308,"node_id":"MDQ6VXNlcjEwMjcwMzA4","avatar_url":"https://avatars.githubusercontent.com/u/10270308?v=4","gravatar_id":"","url":"https://api.github.com/users/justinshenk","html_url":"https://github.com/justinshenk","followers_url":"https://api.github.com/users/justinshenk/followers","following_url":"https://api.github.com/users/justinshenk/following{/other_user}","gists_url":"https://api.github.com/users/justinshenk/gists{/gist_id}","starred_url":"https://api.github.com/users/justinshenk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinshenk/subscriptions","organizations_url":"https://api.github.com/users/justinshenk/orgs","repos_url":"https://api.github.com/users/justinshenk/repos","events_url":"https://api.github.com/users/justinshenk/events{/privacy}","received_events_url":"https://api.github.com/users/justinshenk/received_events","type":"User","site_admin":false},"created_at":"2019-05-27T19:01:48Z","updated_at":"2019-05-27T19:01:48Z","author_association":"OWNER","body":"Closing issue.","reactions":{"url":"https://api.github.com/repos/justinshenk/fer/issues/comments/496286629/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"justinshenk","id":10270308,"node_id":"MDQ6VXNlcjEwMjcwMzA4","avatar_url":"https://avatars.githubusercontent.com/u/10270308?v=4","gravatar_id":"","url":"https://api.github.com/users/justinshenk","html_url":"https://github.com/justinshenk","followers_url":"https://api.github.com/users/justinshenk/followers","following_url":"https://api.github.com/users/justinshenk/following{/other_user}","gists_url":"https://api.github.com/users/justinshenk/gists{/gist_id}","starred_url":"https://api.github.com/users/justinshenk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinshenk/subscriptions","organizations_url":"https://api.github.com/users/justinshenk/orgs","repos_url":"https://api.github.com/users/justinshenk/repos","events_url":"https://api.github.com/users/justinshenk/events{/privacy}","received_events_url":"https://api.github.com/users/justinshenk/received_events","type":"User","site_admin":false}},{"id":2370029343,"node_id":"MDExOkNsb3NlZEV2ZW50MjM3MDAyOTM0Mw==","url":"https://api.github.com/repos/justinshenk/fer/issues/events/2370029343","actor":{"login":"justinshenk","id":10270308,"node_id":"MDQ6VXNlcjEwMjcwMzA4","avatar_url":"https://avatars.githubusercontent.com/u/10270308?v=4","gravatar_id":"","url":"https://api.github.com/users/justinshenk","html_url":"https://github.com/justinshenk","followers_url":"https://api.github.com/users/justinshenk/followers","following_url":"https://api.github.com/users/justinshenk/following{/other_user}","gists_url":"https://api.github.com/users/justinshenk/gists{/gist_id}","starred_url":"https://api.github.com/users/justinshenk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinshenk/subscriptions","organizations_url":"https://api.github.com/users/justinshenk/orgs","repos_url":"https://api.github.com/users/justinshenk/repos","events_url":"https://api.github.com/users/justinshenk/events{/privacy}","received_events_url":"https://api.github.com/users/justinshenk/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-05-27T19:01:48Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/justinshenk/fer/issues/comments/506695079","html_url":"https://github.com/justinshenk/fer/issues/1#issuecomment-506695079","issue_url":"https://api.github.com/repos/justinshenk/fer/issues/1","id":506695079,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjY5NTA3OQ==","user":{"login":"justinshenk","id":10270308,"node_id":"MDQ6VXNlcjEwMjcwMzA4","avatar_url":"https://avatars.githubusercontent.com/u/10270308?v=4","gravatar_id":"","url":"https://api.github.com/users/justinshenk","html_url":"https://github.com/justinshenk","followers_url":"https://api.github.com/users/justinshenk/followers","following_url":"https://api.github.com/users/justinshenk/following{/other_user}","gists_url":"https://api.github.com/users/justinshenk/gists{/gist_id}","starred_url":"https://api.github.com/users/justinshenk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinshenk/subscriptions","organizations_url":"https://api.github.com/users/justinshenk/orgs","repos_url":"https://api.github.com/users/justinshenk/repos","events_url":"https://api.github.com/users/justinshenk/events{/privacy}","received_events_url":"https://api.github.com/users/justinshenk/received_events","type":"User","site_admin":false},"created_at":"2019-06-28T11:02:54Z","updated_at":"2019-06-28T11:02:54Z","author_association":"OWNER","body":"Found issue in previous version, fixed in `v19.0.2`.","reactions":{"url":"https://api.github.com/repos/justinshenk/fer/issues/comments/506695079/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"justinshenk","id":10270308,"node_id":"MDQ6VXNlcjEwMjcwMzA4","avatar_url":"https://avatars.githubusercontent.com/u/10270308?v=4","gravatar_id":"","url":"https://api.github.com/users/justinshenk","html_url":"https://github.com/justinshenk","followers_url":"https://api.github.com/users/justinshenk/followers","following_url":"https://api.github.com/users/justinshenk/following{/other_user}","gists_url":"https://api.github.com/users/justinshenk/gists{/gist_id}","starred_url":"https://api.github.com/users/justinshenk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinshenk/subscriptions","organizations_url":"https://api.github.com/users/justinshenk/orgs","repos_url":"https://api.github.com/users/justinshenk/repos","events_url":"https://api.github.com/users/justinshenk/events{/privacy}","received_events_url":"https://api.github.com/users/justinshenk/received_events","type":"User","site_admin":false}}]