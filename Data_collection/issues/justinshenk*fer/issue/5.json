{"url":"https://api.github.com/repos/justinshenk/fer/issues/5","repository_url":"https://api.github.com/repos/justinshenk/fer","labels_url":"https://api.github.com/repos/justinshenk/fer/issues/5/labels{/name}","comments_url":"https://api.github.com/repos/justinshenk/fer/issues/5/comments","events_url":"https://api.github.com/repos/justinshenk/fer/issues/5/events","html_url":"https://github.com/justinshenk/fer/issues/5","id":469537323,"node_id":"MDU6SXNzdWU0Njk1MzczMjM=","number":5,"title":"Expression predicts unexpected error","user":{"login":"zhouhao-learning","id":24581773,"node_id":"MDQ6VXNlcjI0NTgxNzcz","avatar_url":"https://avatars.githubusercontent.com/u/24581773?v=4","gravatar_id":"","url":"https://api.github.com/users/zhouhao-learning","html_url":"https://github.com/zhouhao-learning","followers_url":"https://api.github.com/users/zhouhao-learning/followers","following_url":"https://api.github.com/users/zhouhao-learning/following{/other_user}","gists_url":"https://api.github.com/users/zhouhao-learning/gists{/gist_id}","starred_url":"https://api.github.com/users/zhouhao-learning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhouhao-learning/subscriptions","organizations_url":"https://api.github.com/users/zhouhao-learning/orgs","repos_url":"https://api.github.com/users/zhouhao-learning/repos","events_url":"https://api.github.com/users/zhouhao-learning/events{/privacy}","received_events_url":"https://api.github.com/users/zhouhao-learning/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2019-07-18T02:11:24Z","updated_at":"2020-06-09T17:46:44Z","closed_at":"2020-06-09T17:46:44Z","author_association":"NONE","active_lock_reason":null,"body":"Hello, I have another accidental bug when I tested your code. I executed `python example.py` and got the following error:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/zh/sda1/人脸识别/微表情分析/fer/example.py\", line 11, in <module>\r\n    result = detector.detect_emotions(image)\r\n  File \"/home/zh/sda1/人脸识别/微表情分析/fer/src/fer/fer.py\", line 250, in detect_emotions\r\n    x1 = np.clip(x1, a_min=0)\r\nTypeError: clip() missing 1 required positional argument: 'a_max'\r\n```\r\nMy test picture is:\r\n![恐惧2](https://user-images.githubusercontent.com/24581773/61423051-df3f9d00-a940-11e9-9778-12f21a7e423e.jpeg)\r\n\r\nI think the fix for this bug is to modify the `detect_emotions` function of `fer.py`.\r\n```\r\n def detect_emotions(self, img: np.ndarray) -> list:\r\n        if img is None or not hasattr(img, \"shape\"):\r\n            raise InvalidImage(\"Image not valid.\")\r\n\r\n        emotion_labels = self._get_labels()\r\n        face_rectangles = self.find_faces(img, bgr=True)\r\n        gray_img = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)\r\n\r\n        emotions = []\r\n        for face_coordinates in face_rectangles:\r\n            face_coordinates = self.tosquare(face_coordinates)\r\n            x1, x2, y1, y2 = self.__apply_offsets(face_coordinates)\r\n\r\n            if y1 < 0 or x1 < 0:\r\n                gray_img = self.pad(gray_img)\r\n                x1 += 40\r\n                x2 += 40\r\n                y1 += 40\r\n                y2 += 40\r\n                x1 = np.clip(x1, a_min=0,a_max=0)\r\n                y1 = np.clip(y1, a_min=0,a_max=0)\r\n\r\n```\r\nDo you agree?\r\n\r\nAnother problem is that when I set `mtcnn=True`, I will encounter a situation where I can't detect the face:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/zh/sda1/人脸识别/微表情分析/fer/example.py\", line 14, in <module>\r\n    bounding_box = result[0][\"box\"]\r\nIndexError: list index out of range\r\n```\r\nSo is `mtcnn` not accurate enough, not recommended?\r\nThe test image I am using is:\r\n![成龙1](https://user-images.githubusercontent.com/24581773/61423910-33984c00-a944-11e9-8a50-6ed4884ecbd8.jpeg)\r\n\r\nIn addition, I also found other problems. If there are multiple faces in my picture, `mtcnn=True` can detect multiple faces, `mtcnn=False` can only detect one face.","closed_by":{"login":"justinshenk","id":10270308,"node_id":"MDQ6VXNlcjEwMjcwMzA4","avatar_url":"https://avatars.githubusercontent.com/u/10270308?v=4","gravatar_id":"","url":"https://api.github.com/users/justinshenk","html_url":"https://github.com/justinshenk","followers_url":"https://api.github.com/users/justinshenk/followers","following_url":"https://api.github.com/users/justinshenk/following{/other_user}","gists_url":"https://api.github.com/users/justinshenk/gists{/gist_id}","starred_url":"https://api.github.com/users/justinshenk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinshenk/subscriptions","organizations_url":"https://api.github.com/users/justinshenk/orgs","repos_url":"https://api.github.com/users/justinshenk/repos","events_url":"https://api.github.com/users/justinshenk/events{/privacy}","received_events_url":"https://api.github.com/users/justinshenk/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/justinshenk/fer/issues/5/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/justinshenk/fer/issues/5/timeline","performed_via_github_app":null,"state_reason":"completed"}