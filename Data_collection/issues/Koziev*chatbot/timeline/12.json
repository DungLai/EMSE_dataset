[{"url":"https://api.github.com/repos/Koziev/chatbot/issues/comments/489334801","html_url":"https://github.com/Koziev/chatbot/issues/12#issuecomment-489334801","issue_url":"https://api.github.com/repos/Koziev/chatbot/issues/12","id":489334801,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4OTMzNDgwMQ==","user":{"login":"Koziev","id":5499222,"node_id":"MDQ6VXNlcjU0OTkyMjI=","avatar_url":"https://avatars.githubusercontent.com/u/5499222?v=4","gravatar_id":"","url":"https://api.github.com/users/Koziev","html_url":"https://github.com/Koziev","followers_url":"https://api.github.com/users/Koziev/followers","following_url":"https://api.github.com/users/Koziev/following{/other_user}","gists_url":"https://api.github.com/users/Koziev/gists{/gist_id}","starred_url":"https://api.github.com/users/Koziev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Koziev/subscriptions","organizations_url":"https://api.github.com/users/Koziev/orgs","repos_url":"https://api.github.com/users/Koziev/repos","events_url":"https://api.github.com/users/Koziev/events{/privacy}","received_events_url":"https://api.github.com/users/Koziev/received_events","type":"User","site_admin":false},"created_at":"2019-05-04T15:04:29Z","updated_at":"2019-05-04T15:04:29Z","author_association":"OWNER","body":"Привет,\r\nспасибо за сообщение об ошибках.\r\nС переобучением чатбота сейчас не особо практично все. Есть ряд предобученных моделей, которые в репозитории лежат в папке tmp. Я их обучаю на больших датасетах, которые в полном виде в репозиторий пока не выкладываю. Поэтому если, например, модель определения синонимичности или релевантности косячит (это как раз случай с лыжами и скорой помощью), то как  бы ничего исправить нельзя без полного переобучения.\r\n\r\nВсе, что сейчас можно сделать для кастомизации - редактировать базу фактов, это те самые файлы premises*.txt, faq2.txt и orders.txt в папке data, типа как тут описано https://kelijah.livejournal.com/254532.html. \r\n\r\n> Мне кажется правильнее было бы делать несколько классов вопросов, например \"из чего сделано -слот-\" из на месте -слот- делать анализ семантики на основе скажем НКРЯ\r\n\r\nОчень не хотелось бы врукопашную реализовывать семантику в любом виде... Все варианты \"семантического анализа\", которые я видел, крайне сложны под капотом, хрупкие и требуют очень квалифицированного разработчика, чтобы аккуратно и правильно вносить изменения. Ну те самые \"онтоинженеры\". А хотелось бы, чтобы бот обучался на простых, интуитивно понятных датасетах, которые любой русскоязычный нейтив с iq>=80 сможет дополнять под свои нужды :) Лучше конечно вообще в unsupervised режиме. Но пока нормальной language acquisition модели у меня нет, то хотя бы и с ручной разметкой там, где нужно. Отсюда и эти примитивные \"правила\" в https://github.com/Koziev/chatbot/blob/master/data/faq2.txt и т.д. \r\n\r\n","reactions":{"url":"https://api.github.com/repos/Koziev/chatbot/issues/comments/489334801/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Koziev","id":5499222,"node_id":"MDQ6VXNlcjU0OTkyMjI=","avatar_url":"https://avatars.githubusercontent.com/u/5499222?v=4","gravatar_id":"","url":"https://api.github.com/users/Koziev","html_url":"https://github.com/Koziev","followers_url":"https://api.github.com/users/Koziev/followers","following_url":"https://api.github.com/users/Koziev/following{/other_user}","gists_url":"https://api.github.com/users/Koziev/gists{/gist_id}","starred_url":"https://api.github.com/users/Koziev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Koziev/subscriptions","organizations_url":"https://api.github.com/users/Koziev/orgs","repos_url":"https://api.github.com/users/Koziev/repos","events_url":"https://api.github.com/users/Koziev/events{/privacy}","received_events_url":"https://api.github.com/users/Koziev/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/Koziev/chatbot/issues/comments/490582904","html_url":"https://github.com/Koziev/chatbot/issues/12#issuecomment-490582904","issue_url":"https://api.github.com/repos/Koziev/chatbot/issues/12","id":490582904,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MDU4MjkwNA==","user":{"login":"GraphGrailAi","id":4690353,"node_id":"MDQ6VXNlcjQ2OTAzNTM=","avatar_url":"https://avatars.githubusercontent.com/u/4690353?v=4","gravatar_id":"","url":"https://api.github.com/users/GraphGrailAi","html_url":"https://github.com/GraphGrailAi","followers_url":"https://api.github.com/users/GraphGrailAi/followers","following_url":"https://api.github.com/users/GraphGrailAi/following{/other_user}","gists_url":"https://api.github.com/users/GraphGrailAi/gists{/gist_id}","starred_url":"https://api.github.com/users/GraphGrailAi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GraphGrailAi/subscriptions","organizations_url":"https://api.github.com/users/GraphGrailAi/orgs","repos_url":"https://api.github.com/users/GraphGrailAi/repos","events_url":"https://api.github.com/users/GraphGrailAi/events{/privacy}","received_events_url":"https://api.github.com/users/GraphGrailAi/received_events","type":"User","site_admin":false},"created_at":"2019-05-08T17:44:50Z","updated_at":"2019-05-08T17:44:50Z","author_association":"NONE","body":"Я поиграл с параметрами:\r\nself.min_faq_relevancy = 0.83\r\nи пока как костыль это  заставляет бота сказать \"нет необходимой информации\". Я бы еще подумал в сторону гуглового BERT, мне вот реально непонятно почему файл word2vec такой маленький, в то время как на русвекторс они огромные.\r\n\r\nЕсть еще пара вопросов:\r\n1)\r\n\r\n```\r\nB:> нет\r\nH:> кто твои мама и папа?\r\n2019-05-08 20:04:32,465 Question to process=кто твои мама и папа ?\r\n2019-05-08 20:04:32,891 Best premise is \"У меня нет папы, потому что я - компьютерная программа\" with relevancy=0.0051393265165935\r\n2019-05-08 20:04:32,892 Question to process=как тебя зовут\r\n2019-05-08 20:04:33,315 Best premise is \"а ты на машине\" with relevancy=0.7999146021050917\r\n2019-05-08 20:04:33,385 model_selector=1\r\n\r\nB:> не хватает знаний для ответа на вопрос\r\n```\r\nВот тут проблема с релевантностью, ответ-то найдет в фактах верно, как-то можно ее поправить?\r\n\r\n\r\n2) \r\nФайл simple_answering_machine.py https://github.com/Koziev/chatbot/blob/master/PyModels/bot/simple_answering_machine.py 415-431 строки\r\nХотелось бы дописывать к ответу побуждающие реплики, я так понял это в этом месте, но не ясно как этот участок кода работает (после if False видимо код недописан?).\r\nТакже хочется проверять юзера на повторные вопросы и опять же дописывать ему вопрос типа \"зачем повторяешься\" - насколько понял это проверка переменной session.conversation_history[-2], а вот в какой класс лучше добавить?\r\n\r\n```\r\n        else:\r\n            # обрабатываем вопрос\r\n            answers = self.build_answers(bot, interlocutor, interpreted_phrase)\r\n            for answer in answers:\r\n                self.say(session, answer)\r\n\r\n            # Возможно, кроме ответа на вопрос, надо выдать еще какую-то реплику.\r\n            # Например, для смены темы разговора.\r\n            if len(answers) > 0:\r\n                if False:  #bot.has_scripting():\r\n                    additional_speech = bot.scripting.generate_after_answer(bot,\r\n                                                                            self,\r\n                                                                            interlocutor,\r\n                                                                            interpreted_phrase,\r\n                                                                            answers[-1])\r\n                    if additional_speech is not None:\r\n                        self.say(session, additional_speech)\r\n```","reactions":{"url":"https://api.github.com/repos/Koziev/chatbot/issues/comments/490582904/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GraphGrailAi","id":4690353,"node_id":"MDQ6VXNlcjQ2OTAzNTM=","avatar_url":"https://avatars.githubusercontent.com/u/4690353?v=4","gravatar_id":"","url":"https://api.github.com/users/GraphGrailAi","html_url":"https://github.com/GraphGrailAi","followers_url":"https://api.github.com/users/GraphGrailAi/followers","following_url":"https://api.github.com/users/GraphGrailAi/following{/other_user}","gists_url":"https://api.github.com/users/GraphGrailAi/gists{/gist_id}","starred_url":"https://api.github.com/users/GraphGrailAi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GraphGrailAi/subscriptions","organizations_url":"https://api.github.com/users/GraphGrailAi/orgs","repos_url":"https://api.github.com/users/GraphGrailAi/repos","events_url":"https://api.github.com/users/GraphGrailAi/events{/privacy}","received_events_url":"https://api.github.com/users/GraphGrailAi/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/Koziev/chatbot/issues/comments/491273672","html_url":"https://github.com/Koziev/chatbot/issues/12#issuecomment-491273672","issue_url":"https://api.github.com/repos/Koziev/chatbot/issues/12","id":491273672,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MTI3MzY3Mg==","user":{"login":"Koziev","id":5499222,"node_id":"MDQ6VXNlcjU0OTkyMjI=","avatar_url":"https://avatars.githubusercontent.com/u/5499222?v=4","gravatar_id":"","url":"https://api.github.com/users/Koziev","html_url":"https://github.com/Koziev","followers_url":"https://api.github.com/users/Koziev/followers","following_url":"https://api.github.com/users/Koziev/following{/other_user}","gists_url":"https://api.github.com/users/Koziev/gists{/gist_id}","starred_url":"https://api.github.com/users/Koziev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Koziev/subscriptions","organizations_url":"https://api.github.com/users/Koziev/orgs","repos_url":"https://api.github.com/users/Koziev/repos","events_url":"https://api.github.com/users/Koziev/events{/privacy}","received_events_url":"https://api.github.com/users/Koziev/received_events","type":"User","site_admin":false},"created_at":"2019-05-10T12:36:38Z","updated_at":"2019-05-10T12:36:38Z","author_association":"OWNER","body":"Привет,\r\nспасибо за замечания по поводу релевантности и вообще идей.\r\n\r\n>Я бы еще подумал в сторону гуглового BERT\r\nBERT к сожалению очень прожорлив при обучении. Даже сильно упрощенная модель (~5 миллионов параметров против штатных 100 млн. или сколько там их) у меня на 1080Ti обучается по 3 суток.\r\n\r\n> мне вот реально непонятно почему файл word2vec такой маленький, в то время как на русвекторс они огромные.\r\n\r\nНа самом деле w2v файл большой, больше 2 Гб. Вот чтобы такого монстра не пихать в контейнер, да и вообще не портить себе жизнь ожиданиями загрузки при тестах, я делаю следующее. Беру все слова, которые есть в обучающих датасетах. Затем из полного w2v файлы оставляю только векторы для этих слов. Получается 90 Мб файлик, приятный для тестирования и деплоймента. Вся эта подготовка делается тут https://github.com/Koziev/chatbot/blob/master/PyModels/preparation/prepare_word_embeddings.py.\r\n\r\n> Вот тут проблема с релевантностью, ответ-то найдет в фактах верно, как-то можно ее поправить?\r\n\r\nДа, действительно косячит, надо подумать, как с такими вопросами быть.\r\n\r\n> Также хочется проверять юзера на повторные вопросы и опять же дописывать ему вопрос типа \"зачем повторяешься\" - насколько понял это проверка переменной session.conversation_history[-2], а вот в какой класс лучше добавить?\r\n\r\nНаверное, проще всего вклиниться перед этой строкой:\r\n\r\n```\r\n            # обрабатываем вопрос\r\n            answers = self.build_answers(bot, interlocutor, interpreted_phrase)\r\n```\r\nЕсли встать отладчиком на строку answers = ... после заданного вопроса \"Как тебя зовут?\", то в структуре interpreted_phrase будет заданный вопрос со сменой лица \"Как меня зовут?\", а в списке session.conversation_history будет все реплики участников, включая последний заданный вопрос \"Как тебя зовут\". Каждый элемент этого списка имеет флаг is_bot_phrase - с его помощью можно отфильтровать реплики человека, ну и далее сгенерировать какую-то свою реплику. Метод self.build_answers занимается генерацией ответа и может возвращать несколько ответов (например, для вопроса \"Кто летает?\"), остается подмешать свою реплику к этим сгенерированным, или вообще не вызывать генерацию - смотря что хочется получить.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/Koziev/chatbot/issues/comments/491273672/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Koziev","id":5499222,"node_id":"MDQ6VXNlcjU0OTkyMjI=","avatar_url":"https://avatars.githubusercontent.com/u/5499222?v=4","gravatar_id":"","url":"https://api.github.com/users/Koziev","html_url":"https://github.com/Koziev","followers_url":"https://api.github.com/users/Koziev/followers","following_url":"https://api.github.com/users/Koziev/following{/other_user}","gists_url":"https://api.github.com/users/Koziev/gists{/gist_id}","starred_url":"https://api.github.com/users/Koziev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Koziev/subscriptions","organizations_url":"https://api.github.com/users/Koziev/orgs","repos_url":"https://api.github.com/users/Koziev/repos","events_url":"https://api.github.com/users/Koziev/events{/privacy}","received_events_url":"https://api.github.com/users/Koziev/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/Koziev/chatbot/issues/comments/491292000","html_url":"https://github.com/Koziev/chatbot/issues/12#issuecomment-491292000","issue_url":"https://api.github.com/repos/Koziev/chatbot/issues/12","id":491292000,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MTI5MjAwMA==","user":{"login":"GraphGrailAi","id":4690353,"node_id":"MDQ6VXNlcjQ2OTAzNTM=","avatar_url":"https://avatars.githubusercontent.com/u/4690353?v=4","gravatar_id":"","url":"https://api.github.com/users/GraphGrailAi","html_url":"https://github.com/GraphGrailAi","followers_url":"https://api.github.com/users/GraphGrailAi/followers","following_url":"https://api.github.com/users/GraphGrailAi/following{/other_user}","gists_url":"https://api.github.com/users/GraphGrailAi/gists{/gist_id}","starred_url":"https://api.github.com/users/GraphGrailAi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GraphGrailAi/subscriptions","organizations_url":"https://api.github.com/users/GraphGrailAi/orgs","repos_url":"https://api.github.com/users/GraphGrailAi/repos","events_url":"https://api.github.com/users/GraphGrailAi/events{/privacy}","received_events_url":"https://api.github.com/users/GraphGrailAi/received_events","type":"User","site_admin":false},"created_at":"2019-05-10T13:38:49Z","updated_at":"2019-05-10T13:40:11Z","author_association":"NONE","body":"> На самом деле w2v файл большой, больше 2 Гб.\r\n\r\nА, ну понятно, что для тестов. А можно же этот большой файл на мэйл или я.диск залить? Я пробовал приделывать стандартный файл с русвекторс, он не подходит почему-то. Дело в том, что вот я когда сам факты добавляю, то в уменьшенной до 90мб модели наверняка окажется, что многих слов из фактов нет и она не может оценивать их близость.\r\nА вообще как на опертативную память это влияет, сколько занято?\r\nОстальные моменты попробую.\r\n\r\nЕще гляньте в сторону https://habr.com/ru/post/440564/ https://openai.com/blog/better-language-models/ и файнтюнинга https://svilentodorov.xyz/blog/gpt-finetune\r\nуже есть код, чтобы тюнить под специфику. Применение: все общие вопросы типа: Земля это какая по счету планета?\r\nон дополняет до 3","reactions":{"url":"https://api.github.com/repos/Koziev/chatbot/issues/comments/491292000/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GraphGrailAi","id":4690353,"node_id":"MDQ6VXNlcjQ2OTAzNTM=","avatar_url":"https://avatars.githubusercontent.com/u/4690353?v=4","gravatar_id":"","url":"https://api.github.com/users/GraphGrailAi","html_url":"https://github.com/GraphGrailAi","followers_url":"https://api.github.com/users/GraphGrailAi/followers","following_url":"https://api.github.com/users/GraphGrailAi/following{/other_user}","gists_url":"https://api.github.com/users/GraphGrailAi/gists{/gist_id}","starred_url":"https://api.github.com/users/GraphGrailAi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GraphGrailAi/subscriptions","organizations_url":"https://api.github.com/users/GraphGrailAi/orgs","repos_url":"https://api.github.com/users/GraphGrailAi/repos","events_url":"https://api.github.com/users/GraphGrailAi/events{/privacy}","received_events_url":"https://api.github.com/users/GraphGrailAi/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/Koziev/chatbot/issues/comments/491314357","html_url":"https://github.com/Koziev/chatbot/issues/12#issuecomment-491314357","issue_url":"https://api.github.com/repos/Koziev/chatbot/issues/12","id":491314357,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MTMxNDM1Nw==","user":{"login":"Koziev","id":5499222,"node_id":"MDQ6VXNlcjU0OTkyMjI=","avatar_url":"https://avatars.githubusercontent.com/u/5499222?v=4","gravatar_id":"","url":"https://api.github.com/users/Koziev","html_url":"https://github.com/Koziev","followers_url":"https://api.github.com/users/Koziev/followers","following_url":"https://api.github.com/users/Koziev/following{/other_user}","gists_url":"https://api.github.com/users/Koziev/gists{/gist_id}","starred_url":"https://api.github.com/users/Koziev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Koziev/subscriptions","organizations_url":"https://api.github.com/users/Koziev/orgs","repos_url":"https://api.github.com/users/Koziev/repos","events_url":"https://api.github.com/users/Koziev/events{/privacy}","received_events_url":"https://api.github.com/users/Koziev/received_events","type":"User","site_admin":false},"created_at":"2019-05-10T14:44:14Z","updated_at":"2019-05-10T14:44:14Z","author_association":"OWNER","body":"> А можно же этот большой файл на мэйл или я.диск залить? Я пробовал приделывать стандартный файл с русвекторс, он не подходит почему-то.\r\n\r\nhttps://drive.google.com/open?id=1w05QAVU_hoiFXzDg_jG3i9-Dr9DrkQt4\r\n\r\nДругие w2v модели, даже если подобрать такую-же размерность вектора (64), точно не подойдут, потому что на этих векторах обучились нейросетки, и они ожидают вполне определенные значения компонентов векторов для слов. Даже если я сейчас переобучу w2v на этом же корпусе, то из-за рандомной инициализации начальных векторов получатся совершенно новые векторы, и нейросетки будут на них лажать.\r\n\r\n> Еще гляньте в сторону https://habr.com/ru/post/440564/ https://openai.com/blog/better-language-models/ и файнтюнинга https://svilentodorov.xyz/blog/gpt-finetune\r\n\r\nАга, большое спасибо за ссылки, почитаю.","reactions":{"url":"https://api.github.com/repos/Koziev/chatbot/issues/comments/491314357/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Koziev","id":5499222,"node_id":"MDQ6VXNlcjU0OTkyMjI=","avatar_url":"https://avatars.githubusercontent.com/u/5499222?v=4","gravatar_id":"","url":"https://api.github.com/users/Koziev","html_url":"https://github.com/Koziev","followers_url":"https://api.github.com/users/Koziev/followers","following_url":"https://api.github.com/users/Koziev/following{/other_user}","gists_url":"https://api.github.com/users/Koziev/gists{/gist_id}","starred_url":"https://api.github.com/users/Koziev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Koziev/subscriptions","organizations_url":"https://api.github.com/users/Koziev/orgs","repos_url":"https://api.github.com/users/Koziev/repos","events_url":"https://api.github.com/users/Koziev/events{/privacy}","received_events_url":"https://api.github.com/users/Koziev/received_events","type":"User","site_admin":false}}]