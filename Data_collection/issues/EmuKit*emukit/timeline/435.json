[{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1247963795","html_url":"https://github.com/EmuKit/emukit/issues/435#issuecomment-1247963795","issue_url":"https://api.github.com/repos/EmuKit/emukit/issues/435","id":1247963795,"node_id":"IC_kwDOCMd5485KYmqT","user":{"login":"apaleyes","id":2852301,"node_id":"MDQ6VXNlcjI4NTIzMDE=","avatar_url":"https://avatars.githubusercontent.com/u/2852301?v=4","gravatar_id":"","url":"https://api.github.com/users/apaleyes","html_url":"https://github.com/apaleyes","followers_url":"https://api.github.com/users/apaleyes/followers","following_url":"https://api.github.com/users/apaleyes/following{/other_user}","gists_url":"https://api.github.com/users/apaleyes/gists{/gist_id}","starred_url":"https://api.github.com/users/apaleyes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apaleyes/subscriptions","organizations_url":"https://api.github.com/users/apaleyes/orgs","repos_url":"https://api.github.com/users/apaleyes/repos","events_url":"https://api.github.com/users/apaleyes/events{/privacy}","received_events_url":"https://api.github.com/users/apaleyes/received_events","type":"User","site_admin":false},"created_at":"2022-09-15T11:20:01Z","updated_at":"2022-09-15T11:20:01Z","author_association":"COLLABORATOR","body":"Hi Anthony,\r\n\r\nThanks for the questions. I am not a huge expert in MF, so the answers might not be completely satisfactory. Nevertheless, let's try:\r\n\r\n1. It seems to be the latter approach, relevant model update code is here: https://github.com/EmuKit/emukit/blob/main/emukit/multi_fidelity/models/non_linear_multi_fidelity_model.py#L340\r\n2. A lot of times such constraints are added for stability reasons, to ensure the optimization would not crash at some bad random seeds. General advice however is that such parameter priors should come from your knowledge and understanding of the problem, which may or may not be connected to the size of the domain. General rule of thumb \"parameter can be no more than X% of the range\" just does not exist, I am afraid.\r\n3. Variance can certainly be bounded in the same way in GPy, here is one example of that: https://github.com/SheffieldML/GPy/issues/735#issuecomment-573866816 . Again, will refrain from any general advice.\r\n4. In these particular notebooks that would make no difference, since in both cases we don't seem to add any noise to the objective. In more complex situations you would know if your observations are exact or noisy. I believe you are correct about the jitter in GPy\r\n5. Normalization can be beneficial for GP regression, so generally speaking the answer is yes. But it can get tricky, so one needs to apply care.\r\n\r\nTo aid your interest in multi-fidelity, I would suggest to check out this great lecture from Prof. Lawrence: https://mlatcl.github.io/mlphysical/lectures/05-02-multifidelity.html . Also uses Emukit, and goes into many concepts much deeper than I could ever do.","reactions":{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1247963795/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"apaleyes","id":2852301,"node_id":"MDQ6VXNlcjI4NTIzMDE=","avatar_url":"https://avatars.githubusercontent.com/u/2852301?v=4","gravatar_id":"","url":"https://api.github.com/users/apaleyes","html_url":"https://github.com/apaleyes","followers_url":"https://api.github.com/users/apaleyes/followers","following_url":"https://api.github.com/users/apaleyes/following{/other_user}","gists_url":"https://api.github.com/users/apaleyes/gists{/gist_id}","starred_url":"https://api.github.com/users/apaleyes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apaleyes/subscriptions","organizations_url":"https://api.github.com/users/apaleyes/orgs","repos_url":"https://api.github.com/users/apaleyes/repos","events_url":"https://api.github.com/users/apaleyes/events{/privacy}","received_events_url":"https://api.github.com/users/apaleyes/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1252481038","html_url":"https://github.com/EmuKit/emukit/issues/435#issuecomment-1252481038","issue_url":"https://api.github.com/repos/EmuKit/emukit/issues/435","id":1252481038,"node_id":"IC_kwDOCMd5485Kp1gO","user":{"login":"AnthonyLarroque","id":44471624,"node_id":"MDQ6VXNlcjQ0NDcxNjI0","avatar_url":"https://avatars.githubusercontent.com/u/44471624?v=4","gravatar_id":"","url":"https://api.github.com/users/AnthonyLarroque","html_url":"https://github.com/AnthonyLarroque","followers_url":"https://api.github.com/users/AnthonyLarroque/followers","following_url":"https://api.github.com/users/AnthonyLarroque/following{/other_user}","gists_url":"https://api.github.com/users/AnthonyLarroque/gists{/gist_id}","starred_url":"https://api.github.com/users/AnthonyLarroque/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AnthonyLarroque/subscriptions","organizations_url":"https://api.github.com/users/AnthonyLarroque/orgs","repos_url":"https://api.github.com/users/AnthonyLarroque/repos","events_url":"https://api.github.com/users/AnthonyLarroque/events{/privacy}","received_events_url":"https://api.github.com/users/AnthonyLarroque/received_events","type":"User","site_admin":false},"created_at":"2022-09-20T14:55:59Z","updated_at":"2022-09-20T14:55:59Z","author_association":"NONE","body":"Hi apaleyes,\r\n\r\nThank you very much for the answers and the useful documentation ! That helps a lot !\r\n\r\nEven if I saw the tutorial notebook on multi-fidelity, I am not really familiar with the non linear multi-fidelity model. With my first question, I was more referring to the linear multi-fidelity model and linear multi-fidelity kernel. Are there any lines in linear_multi_fidelity_kernel.py or in linear_model.py that show that the hyperparameters are firstly optimized on the low fidelity model then on the error function ?\r\n\r\nI also join a zip file containing a notebook with a small model wrapper that I created for the error function. I sometimes have different results than with the current linear multi-fidelity wrapper in emukit. Sometimes, these results are worst, sometimes better. So, I am pretty confused on the right way to treat the hyperparameters of the multi-fidelity model. Still, it appears faster to optimize the hyperparameters of the multi-fidelity model with the wrapper that I created. \r\n\r\nKind regards,\r\nAnthony Larroque \r\n[hp_mf.zip](https://github.com/EmuKit/emukit/files/9608786/hp_mf.zip)\r\n","reactions":{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1252481038/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"AnthonyLarroque","id":44471624,"node_id":"MDQ6VXNlcjQ0NDcxNjI0","avatar_url":"https://avatars.githubusercontent.com/u/44471624?v=4","gravatar_id":"","url":"https://api.github.com/users/AnthonyLarroque","html_url":"https://github.com/AnthonyLarroque","followers_url":"https://api.github.com/users/AnthonyLarroque/followers","following_url":"https://api.github.com/users/AnthonyLarroque/following{/other_user}","gists_url":"https://api.github.com/users/AnthonyLarroque/gists{/gist_id}","starred_url":"https://api.github.com/users/AnthonyLarroque/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AnthonyLarroque/subscriptions","organizations_url":"https://api.github.com/users/AnthonyLarroque/orgs","repos_url":"https://api.github.com/users/AnthonyLarroque/repos","events_url":"https://api.github.com/users/AnthonyLarroque/events{/privacy}","received_events_url":"https://api.github.com/users/AnthonyLarroque/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1253020725","html_url":"https://github.com/EmuKit/emukit/issues/435#issuecomment-1253020725","issue_url":"https://api.github.com/repos/EmuKit/emukit/issues/435","id":1253020725,"node_id":"IC_kwDOCMd5485Kr5Q1","user":{"login":"apaleyes","id":2852301,"node_id":"MDQ6VXNlcjI4NTIzMDE=","avatar_url":"https://avatars.githubusercontent.com/u/2852301?v=4","gravatar_id":"","url":"https://api.github.com/users/apaleyes","html_url":"https://github.com/apaleyes","followers_url":"https://api.github.com/users/apaleyes/followers","following_url":"https://api.github.com/users/apaleyes/following{/other_user}","gists_url":"https://api.github.com/users/apaleyes/gists{/gist_id}","starred_url":"https://api.github.com/users/apaleyes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apaleyes/subscriptions","organizations_url":"https://api.github.com/users/apaleyes/orgs","repos_url":"https://api.github.com/users/apaleyes/repos","events_url":"https://api.github.com/users/apaleyes/events{/privacy}","received_events_url":"https://api.github.com/users/apaleyes/received_events","type":"User","site_admin":false},"created_at":"2022-09-20T23:37:31Z","updated_at":"2022-09-20T23:37:31Z","author_association":"COLLABORATOR","body":"Hi there!\r\n\r\nThe linear model in Emukit is implemented as a single GP, refer to this notebook for explanation: https://nbviewer.org/github/emukit/emukit/blob/main/notebooks/Emukit-tutorial-multi-fidelity.ipynb . So there are no low and high fidelity models, there is just one model.\r\n\r\nThese models aren't determnistic, so having some stochasiticity in outputs should be expected. That's why, as far as i understand it, GPy has optimisation restarts. Perhaps consider the same thing with MF models?","reactions":{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1253020725/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"apaleyes","id":2852301,"node_id":"MDQ6VXNlcjI4NTIzMDE=","avatar_url":"https://avatars.githubusercontent.com/u/2852301?v=4","gravatar_id":"","url":"https://api.github.com/users/apaleyes","html_url":"https://github.com/apaleyes","followers_url":"https://api.github.com/users/apaleyes/followers","following_url":"https://api.github.com/users/apaleyes/following{/other_user}","gists_url":"https://api.github.com/users/apaleyes/gists{/gist_id}","starred_url":"https://api.github.com/users/apaleyes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apaleyes/subscriptions","organizations_url":"https://api.github.com/users/apaleyes/orgs","repos_url":"https://api.github.com/users/apaleyes/repos","events_url":"https://api.github.com/users/apaleyes/events{/privacy}","received_events_url":"https://api.github.com/users/apaleyes/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1253558444","html_url":"https://github.com/EmuKit/emukit/issues/435#issuecomment-1253558444","issue_url":"https://api.github.com/repos/EmuKit/emukit/issues/435","id":1253558444,"node_id":"IC_kwDOCMd5485Kt8is","user":{"login":"AnthonyLarroque","id":44471624,"node_id":"MDQ6VXNlcjQ0NDcxNjI0","avatar_url":"https://avatars.githubusercontent.com/u/44471624?v=4","gravatar_id":"","url":"https://api.github.com/users/AnthonyLarroque","html_url":"https://github.com/AnthonyLarroque","followers_url":"https://api.github.com/users/AnthonyLarroque/followers","following_url":"https://api.github.com/users/AnthonyLarroque/following{/other_user}","gists_url":"https://api.github.com/users/AnthonyLarroque/gists{/gist_id}","starred_url":"https://api.github.com/users/AnthonyLarroque/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AnthonyLarroque/subscriptions","organizations_url":"https://api.github.com/users/AnthonyLarroque/orgs","repos_url":"https://api.github.com/users/AnthonyLarroque/repos","events_url":"https://api.github.com/users/AnthonyLarroque/events{/privacy}","received_events_url":"https://api.github.com/users/AnthonyLarroque/received_events","type":"User","site_admin":false},"created_at":"2022-09-21T11:16:52Z","updated_at":"2022-09-21T11:16:52Z","author_association":"NONE","body":"Hi,\r\n\r\n\"These models aren't determnistic, so having some stochasiticity in outputs should be expected. That's why, as far as i understand it, GPy has optimisation restarts.\"\r\n\r\nI do understand that the linear model is in the end a GP and that these models are not deterministic and contain a mean and a variance on the prediction. However, I do not really understand regarding the optimization restarts. What I understand is that if GPy has optimization restarts, it is because the optimization of the marginal likelihood of the model to find the hyperparameters is based on the L-BFGS-B algorithm, a gradient-based method. Thus, with several optimization restarts that correspond to different starting points of the optimization, we avoid the L-BFGS-B algorithm being trapped in a local optimum of the marginal likelihood. Isn't it the reason of the optimization restarts ? Could you please explain the link between the stochastic behaviour of the model and the optimization restarts ?\r\n\r\nAlso, my question is more related to the treatment of the hyperparameters of the linear model. What I understand is that with emukit, the multi-fidelity model is considered, as you said as a single GP, and thus all the hyperparameters (the scale, the variances and lengthscales of the kern_low and kern_err in the notebook that I sent) seem to be optimized in an unique step. However, what I read in Kennedy and O'Hagan (2000), is that the hyperparameters of kern_low are optimized with only the low fidelity data, and then the hyperparameters of kern_err and the scale are find by optimizing the marginal likelihood of the linear difference between the high fidelity and low fidelity outputs at common points. Indeed, they insist on the Markov property:\r\n\r\n$cov(f_{high}(x), f_{low}(x^\\prime)|f_{low}(x)) = 0$,\r\nmeaning that if we know $f_{low}$ at $x$, we can learn no more about $f_{high}$ at $x$ with any other run $f_{low}(x^\\prime)$, with $x^\\prime$ being different of $x$. That is why I developed the error model in the notebook that I sent in order to proceed as in the original paper: the data is firstly optimized with the low fidelity data, then the error model and the scale are optimized at common points, and finally the multi-fidelity model is reconstructed with the hyperparameters found. As you can see, we can observe some differences with the current implementation of emukit with some inputs.\r\n\r\nSo. my questions are: could you confirm that the hyperparameters of the linear multi-fidelity model are all optimized in an unique step ? If so, the Markov property is not respected, is-it ? If the Markov property is not respected, do you know some recent developments that could explain why it is not important or relevant to consider the Markov property ?\r\n\r\nKind regards,\r\nAnthony Larroque  \r\n\r\n","reactions":{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1253558444/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"AnthonyLarroque","id":44471624,"node_id":"MDQ6VXNlcjQ0NDcxNjI0","avatar_url":"https://avatars.githubusercontent.com/u/44471624?v=4","gravatar_id":"","url":"https://api.github.com/users/AnthonyLarroque","html_url":"https://github.com/AnthonyLarroque","followers_url":"https://api.github.com/users/AnthonyLarroque/followers","following_url":"https://api.github.com/users/AnthonyLarroque/following{/other_user}","gists_url":"https://api.github.com/users/AnthonyLarroque/gists{/gist_id}","starred_url":"https://api.github.com/users/AnthonyLarroque/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AnthonyLarroque/subscriptions","organizations_url":"https://api.github.com/users/AnthonyLarroque/orgs","repos_url":"https://api.github.com/users/AnthonyLarroque/repos","events_url":"https://api.github.com/users/AnthonyLarroque/events{/privacy}","received_events_url":"https://api.github.com/users/AnthonyLarroque/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1254343899","html_url":"https://github.com/EmuKit/emukit/issues/435#issuecomment-1254343899","issue_url":"https://api.github.com/repos/EmuKit/emukit/issues/435","id":1254343899,"node_id":"IC_kwDOCMd5485Kw8Tb","user":{"login":"apaleyes","id":2852301,"node_id":"MDQ6VXNlcjI4NTIzMDE=","avatar_url":"https://avatars.githubusercontent.com/u/2852301?v=4","gravatar_id":"","url":"https://api.github.com/users/apaleyes","html_url":"https://github.com/apaleyes","followers_url":"https://api.github.com/users/apaleyes/followers","following_url":"https://api.github.com/users/apaleyes/following{/other_user}","gists_url":"https://api.github.com/users/apaleyes/gists{/gist_id}","starred_url":"https://api.github.com/users/apaleyes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apaleyes/subscriptions","organizations_url":"https://api.github.com/users/apaleyes/orgs","repos_url":"https://api.github.com/users/apaleyes/repos","events_url":"https://api.github.com/users/apaleyes/events{/privacy}","received_events_url":"https://api.github.com/users/apaleyes/received_events","type":"User","site_admin":false},"created_at":"2022-09-21T23:50:14Z","updated_at":"2022-09-21T23:50:14Z","author_association":"COLLABORATOR","body":"> Could you please explain the link between the stochastic behaviour of the model and the optimization restarts ?\r\n\r\nOk, I concur, you explanation for restarts is better than mine!\r\n\r\n>So. my questions are: could you confirm that the hyperparameters of the linear multi-fidelity model are all optimized in an unique step ? If so, the Markov property is not respected, is-it ? If the Markov property is not respected, do you know some recent developments that could explain why it is not important or relevant to consider the Markov property ?\r\n\r\nI am not aware of any such developments as I don't follow MF research. But I can see that in the original paper they do the thing also done in Emukit, that is representing linear MF model as a single GP with modified prior (page 4, eq 4), and then comment that the property holds (page 5, top). So I have to assume that the property is still respected in Emukit's implementation as it follows the paper.\r\n\r\nOverall, I am afraid this conversation pushes way beyond my understanding of MF modelling, so I probably won't be of much assistance if you have further concerns.","reactions":{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1254343899/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"apaleyes","id":2852301,"node_id":"MDQ6VXNlcjI4NTIzMDE=","avatar_url":"https://avatars.githubusercontent.com/u/2852301?v=4","gravatar_id":"","url":"https://api.github.com/users/apaleyes","html_url":"https://github.com/apaleyes","followers_url":"https://api.github.com/users/apaleyes/followers","following_url":"https://api.github.com/users/apaleyes/following{/other_user}","gists_url":"https://api.github.com/users/apaleyes/gists{/gist_id}","starred_url":"https://api.github.com/users/apaleyes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apaleyes/subscriptions","organizations_url":"https://api.github.com/users/apaleyes/orgs","repos_url":"https://api.github.com/users/apaleyes/repos","events_url":"https://api.github.com/users/apaleyes/events{/privacy}","received_events_url":"https://api.github.com/users/apaleyes/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1254800743","html_url":"https://github.com/EmuKit/emukit/issues/435#issuecomment-1254800743","issue_url":"https://api.github.com/repos/EmuKit/emukit/issues/435","id":1254800743,"node_id":"IC_kwDOCMd5485Kyr1n","user":{"login":"GranjalCruz","id":86713349,"node_id":"MDQ6VXNlcjg2NzEzMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/86713349?v=4","gravatar_id":"","url":"https://api.github.com/users/GranjalCruz","html_url":"https://github.com/GranjalCruz","followers_url":"https://api.github.com/users/GranjalCruz/followers","following_url":"https://api.github.com/users/GranjalCruz/following{/other_user}","gists_url":"https://api.github.com/users/GranjalCruz/gists{/gist_id}","starred_url":"https://api.github.com/users/GranjalCruz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GranjalCruz/subscriptions","organizations_url":"https://api.github.com/users/GranjalCruz/orgs","repos_url":"https://api.github.com/users/GranjalCruz/repos","events_url":"https://api.github.com/users/GranjalCruz/events{/privacy}","received_events_url":"https://api.github.com/users/GranjalCruz/received_events","type":"User","site_admin":false},"created_at":"2022-09-22T09:59:42Z","updated_at":"2022-09-22T10:02:29Z","author_association":"NONE","body":"Hey, I came across this discussion and though about sharing my 2 cents on it.\r\n\r\nI believe the Markov Property is always respected, otherwise you could not define the autoregressive model proposed by O'Hagan. Notice in the text on his paper between equation 1 (markov property) and equation 2 (the AR model) the text clearly states that the assumption on 1 implies the model in 2. \r\n\r\nI also had the same question on the emukit implementation but I think it's a matter of the interpretation of the paper again. From **my personal interpretation** the derived equations on section 2.4 (and the independence condition that splits the hyperparameters) is done under the assumption that the design points are nested.\r\n\r\n![image](https://user-images.githubusercontent.com/86713349/191717418-e32ee841-5e8e-4ce5-b715-a151e59079ac.png)\r\n\r\nI have tried emukit with design points that are not nested samples so I assume their implementation is general and solves the likelihood optimization for all parameters at the same time. Still from **my personal interpretation** this does not break the Markov property.  \r\n\r\nAlso maybe this paper may be usefull for you: https://arxiv.org/pdf/1210.0686.pdf\r\nThe author develops a recursive estimation for parameters, assuming nested samples","reactions":{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1254800743/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GranjalCruz","id":86713349,"node_id":"MDQ6VXNlcjg2NzEzMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/86713349?v=4","gravatar_id":"","url":"https://api.github.com/users/GranjalCruz","html_url":"https://github.com/GranjalCruz","followers_url":"https://api.github.com/users/GranjalCruz/followers","following_url":"https://api.github.com/users/GranjalCruz/following{/other_user}","gists_url":"https://api.github.com/users/GranjalCruz/gists{/gist_id}","starred_url":"https://api.github.com/users/GranjalCruz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GranjalCruz/subscriptions","organizations_url":"https://api.github.com/users/GranjalCruz/orgs","repos_url":"https://api.github.com/users/GranjalCruz/repos","events_url":"https://api.github.com/users/GranjalCruz/events{/privacy}","received_events_url":"https://api.github.com/users/GranjalCruz/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1260099925","html_url":"https://github.com/EmuKit/emukit/issues/435#issuecomment-1260099925","issue_url":"https://api.github.com/repos/EmuKit/emukit/issues/435","id":1260099925,"node_id":"IC_kwDOCMd5485LG5lV","user":{"login":"AnthonyLarroque","id":44471624,"node_id":"MDQ6VXNlcjQ0NDcxNjI0","avatar_url":"https://avatars.githubusercontent.com/u/44471624?v=4","gravatar_id":"","url":"https://api.github.com/users/AnthonyLarroque","html_url":"https://github.com/AnthonyLarroque","followers_url":"https://api.github.com/users/AnthonyLarroque/followers","following_url":"https://api.github.com/users/AnthonyLarroque/following{/other_user}","gists_url":"https://api.github.com/users/AnthonyLarroque/gists{/gist_id}","starred_url":"https://api.github.com/users/AnthonyLarroque/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AnthonyLarroque/subscriptions","organizations_url":"https://api.github.com/users/AnthonyLarroque/orgs","repos_url":"https://api.github.com/users/AnthonyLarroque/repos","events_url":"https://api.github.com/users/AnthonyLarroque/events{/privacy}","received_events_url":"https://api.github.com/users/AnthonyLarroque/received_events","type":"User","site_admin":false},"created_at":"2022-09-27T22:02:47Z","updated_at":"2022-09-27T22:02:47Z","author_association":"NONE","body":"Hi,\r\n\r\nSorry for the late reply, I have been busy recently.\r\n\r\nThank you @apaleyes for your answers and thank you @GranjalCruz  for joining the conversation and provide your useful insights !\r\n\r\nIndeed, after thinking to your messages, I believe that the Markov property is always automatically respected in the posterior covariance matrix with the model provided.\r\n\r\nStill, the optimization of the hyperparameters makes me think. In all the articles that I read and that use the multi-fidelity model of Kennedy and O'Hagan, they are doing the two-step process of first building the low fidelity model, then building the model of the error function. In the chapter 8 of \"Engineering Design via Surrogate Modelling\" by Forrester et al. (2008), they also do this two-step process and when the low-fidelity samples are not evaluated at high fidelity samples, they instead take the prediction of the low fidelity model in order to build the bridge function.\r\n\r\nAlso, I have experienced, I believe, some strange behaviours with the current implementation of the linear multi-fidelity model regarding the optimization of the hyperparameters. I am joining a zip file with a notebook containing some tests that I ran. In the paragraph 2.1 of this notebook, I ran the current implementation of the linear multi-fidelity model with respectively 6 and 3 low and high fidelity samples. Note that around the points evaluated, the variance and the mean have a rough transition. In the paragraph 2.2, I have added 2 high fidelity samples. In that case, the variance of the multi-fidelity model completely disappear. Note also that the hyperparameters of the cheap kernel changed adding high fidelity samples, so I assume that the hyperparameters are all optimized in an unique step in emukit. In the chapter 8 of Forrester et al., they mention: \"our cheap data is considered to be independent of the expensive data\". If the hyperparameters of the cheap kernel change when we add high fidelity samples, I believe that the cheap data is not considered independent of the expensive data. I also may think that the independence between the low-fidelity model and the model of the error function is no longer maintained with the optimization of the hyperparameters in an unique step (and when the high fidelity samples are a subset of the low-fidelity samples as in the original paper of Kennedy and O'Hagan). Also, for some run, I experienced cases where I had a significant noise on the high-fidelity samples, whereas the noise is fixed to 0.  \r\n\r\nIn the paragraph 3.1 and 3.2, I ran the same experiments but when the hyperparameters are optimized successively. The curves are different compared with the paragraph 2.1 and 2.2. The mean and the variance transitions seem smoother and the results are more reproducible. \r\n\r\nSo, that makes me wonder if optimizing the hyperparameters in an unique step is the right way to do. The optimization process seems more \"unstable\" in the sense that even with several optimization restarts, it can lead to different results. The optimization of the hyperpameters is also more difficult as the domain size increase (especially when the objective function is defined in a design space in several dimensions and ARD is used for the kernels) and the process is longer in time than optimizing the hyperparameters successively. I am also wondering if that may be the reason of the overfit mentioned here (https://github.com/EmuKit/emukit/pull/234) as if the hyperparameters are optimized in an unique step, the hyperparameters of the cheap kernel will try to fit the whole data set (as seem to be shown in the paragraph 2.2 of this notebook).\r\n\r\nKind regards,\r\nAnthony Larroque  \r\n[hp_mf_2.zip](https://github.com/EmuKit/emukit/files/9659861/hp_mf_2.zip)\r\n","reactions":{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1260099925/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"AnthonyLarroque","id":44471624,"node_id":"MDQ6VXNlcjQ0NDcxNjI0","avatar_url":"https://avatars.githubusercontent.com/u/44471624?v=4","gravatar_id":"","url":"https://api.github.com/users/AnthonyLarroque","html_url":"https://github.com/AnthonyLarroque","followers_url":"https://api.github.com/users/AnthonyLarroque/followers","following_url":"https://api.github.com/users/AnthonyLarroque/following{/other_user}","gists_url":"https://api.github.com/users/AnthonyLarroque/gists{/gist_id}","starred_url":"https://api.github.com/users/AnthonyLarroque/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AnthonyLarroque/subscriptions","organizations_url":"https://api.github.com/users/AnthonyLarroque/orgs","repos_url":"https://api.github.com/users/AnthonyLarroque/repos","events_url":"https://api.github.com/users/AnthonyLarroque/events{/privacy}","received_events_url":"https://api.github.com/users/AnthonyLarroque/received_events","type":"User","site_admin":false}},{"id":7472563199,"node_id":"MEE_lADOCMd5485RQXuzzwAAAAG9ZkP_","url":"https://api.github.com/repos/EmuKit/emukit/issues/events/7472563199","actor":{"login":"apaleyes","id":2852301,"node_id":"MDQ6VXNlcjI4NTIzMDE=","avatar_url":"https://avatars.githubusercontent.com/u/2852301?v=4","gravatar_id":"","url":"https://api.github.com/users/apaleyes","html_url":"https://github.com/apaleyes","followers_url":"https://api.github.com/users/apaleyes/followers","following_url":"https://api.github.com/users/apaleyes/following{/other_user}","gists_url":"https://api.github.com/users/apaleyes/gists{/gist_id}","starred_url":"https://api.github.com/users/apaleyes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apaleyes/subscriptions","organizations_url":"https://api.github.com/users/apaleyes/orgs","repos_url":"https://api.github.com/users/apaleyes/repos","events_url":"https://api.github.com/users/apaleyes/events{/privacy}","received_events_url":"https://api.github.com/users/apaleyes/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-09-27T22:02:47Z","performed_via_github_app":null},{"id":7472563205,"node_id":"SE_lADOCMd5485RQXuzzwAAAAG9ZkQF","url":"https://api.github.com/repos/EmuKit/emukit/issues/events/7472563205","actor":{"login":"apaleyes","id":2852301,"node_id":"MDQ6VXNlcjI4NTIzMDE=","avatar_url":"https://avatars.githubusercontent.com/u/2852301?v=4","gravatar_id":"","url":"https://api.github.com/users/apaleyes","html_url":"https://github.com/apaleyes","followers_url":"https://api.github.com/users/apaleyes/followers","following_url":"https://api.github.com/users/apaleyes/following{/other_user}","gists_url":"https://api.github.com/users/apaleyes/gists{/gist_id}","starred_url":"https://api.github.com/users/apaleyes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apaleyes/subscriptions","organizations_url":"https://api.github.com/users/apaleyes/orgs","repos_url":"https://api.github.com/users/apaleyes/repos","events_url":"https://api.github.com/users/apaleyes/events{/privacy}","received_events_url":"https://api.github.com/users/apaleyes/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-09-27T22:02:47Z","performed_via_github_app":null},{"id":7472563211,"node_id":"MEE_lADOCMd5485RQXuzzwAAAAG9ZkQL","url":"https://api.github.com/repos/EmuKit/emukit/issues/events/7472563211","actor":{"login":"GranjalCruz","id":86713349,"node_id":"MDQ6VXNlcjg2NzEzMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/86713349?v=4","gravatar_id":"","url":"https://api.github.com/users/GranjalCruz","html_url":"https://github.com/GranjalCruz","followers_url":"https://api.github.com/users/GranjalCruz/followers","following_url":"https://api.github.com/users/GranjalCruz/following{/other_user}","gists_url":"https://api.github.com/users/GranjalCruz/gists{/gist_id}","starred_url":"https://api.github.com/users/GranjalCruz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GranjalCruz/subscriptions","organizations_url":"https://api.github.com/users/GranjalCruz/orgs","repos_url":"https://api.github.com/users/GranjalCruz/repos","events_url":"https://api.github.com/users/GranjalCruz/events{/privacy}","received_events_url":"https://api.github.com/users/GranjalCruz/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-09-27T22:02:47Z","performed_via_github_app":null},{"id":7472563214,"node_id":"SE_lADOCMd5485RQXuzzwAAAAG9ZkQO","url":"https://api.github.com/repos/EmuKit/emukit/issues/events/7472563214","actor":{"login":"GranjalCruz","id":86713349,"node_id":"MDQ6VXNlcjg2NzEzMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/86713349?v=4","gravatar_id":"","url":"https://api.github.com/users/GranjalCruz","html_url":"https://github.com/GranjalCruz","followers_url":"https://api.github.com/users/GranjalCruz/followers","following_url":"https://api.github.com/users/GranjalCruz/following{/other_user}","gists_url":"https://api.github.com/users/GranjalCruz/gists{/gist_id}","starred_url":"https://api.github.com/users/GranjalCruz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GranjalCruz/subscriptions","organizations_url":"https://api.github.com/users/GranjalCruz/orgs","repos_url":"https://api.github.com/users/GranjalCruz/repos","events_url":"https://api.github.com/users/GranjalCruz/events{/privacy}","received_events_url":"https://api.github.com/users/GranjalCruz/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-09-27T22:02:47Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1266606312","html_url":"https://github.com/EmuKit/emukit/issues/435#issuecomment-1266606312","issue_url":"https://api.github.com/repos/EmuKit/emukit/issues/435","id":1266606312,"node_id":"IC_kwDOCMd5485LfuDo","user":{"login":"GranjalCruz","id":86713349,"node_id":"MDQ6VXNlcjg2NzEzMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/86713349?v=4","gravatar_id":"","url":"https://api.github.com/users/GranjalCruz","html_url":"https://github.com/GranjalCruz","followers_url":"https://api.github.com/users/GranjalCruz/followers","following_url":"https://api.github.com/users/GranjalCruz/following{/other_user}","gists_url":"https://api.github.com/users/GranjalCruz/gists{/gist_id}","starred_url":"https://api.github.com/users/GranjalCruz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GranjalCruz/subscriptions","organizations_url":"https://api.github.com/users/GranjalCruz/orgs","repos_url":"https://api.github.com/users/GranjalCruz/repos","events_url":"https://api.github.com/users/GranjalCruz/events{/privacy}","received_events_url":"https://api.github.com/users/GranjalCruz/received_events","type":"User","site_admin":false},"created_at":"2022-10-04T08:42:30Z","updated_at":"2022-10-04T08:42:30Z","author_association":"NONE","body":"Hey, took a quick look at the script. I think your issue from 2.1 to 2.2 is the fact that the ylim of the plot is on a totally different scale, since when you add the 2 samples they are boosting the uncertainty at low x locations. \r\n\r\nThe only good way to compare 3.1 to 2.1 is if you pass the same dataset, which from a quick look of the plots seems not to be the case. The model of 3.2 is the best since the new samples are 'optimal' based on some acquisition function, therefore it makes sense that it outputs the best model of all the examples.\r\nI suggest you try to compare the models with the same data, there might be a small difference from fixing the likelihood (or not in this simple case) but it should provide a better comparison.\r\n\r\nUnfortunately, I cannot conclude from the examples if the optimization of all hyperparameters together is better or worse (or correct/incorrect)\r\n\r\nP.S: I am not using emukit for multi-fidelity optimization but for multi-fidelity modelling (application case is different than classic GPyOpt framework)","reactions":{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1266606312/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GranjalCruz","id":86713349,"node_id":"MDQ6VXNlcjg2NzEzMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/86713349?v=4","gravatar_id":"","url":"https://api.github.com/users/GranjalCruz","html_url":"https://github.com/GranjalCruz","followers_url":"https://api.github.com/users/GranjalCruz/followers","following_url":"https://api.github.com/users/GranjalCruz/following{/other_user}","gists_url":"https://api.github.com/users/GranjalCruz/gists{/gist_id}","starred_url":"https://api.github.com/users/GranjalCruz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GranjalCruz/subscriptions","organizations_url":"https://api.github.com/users/GranjalCruz/orgs","repos_url":"https://api.github.com/users/GranjalCruz/repos","events_url":"https://api.github.com/users/GranjalCruz/events{/privacy}","received_events_url":"https://api.github.com/users/GranjalCruz/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1270115128","html_url":"https://github.com/EmuKit/emukit/issues/435#issuecomment-1270115128","issue_url":"https://api.github.com/repos/EmuKit/emukit/issues/435","id":1270115128,"node_id":"IC_kwDOCMd5485LtGs4","user":{"login":"AnthonyLarroque","id":44471624,"node_id":"MDQ6VXNlcjQ0NDcxNjI0","avatar_url":"https://avatars.githubusercontent.com/u/44471624?v=4","gravatar_id":"","url":"https://api.github.com/users/AnthonyLarroque","html_url":"https://github.com/AnthonyLarroque","followers_url":"https://api.github.com/users/AnthonyLarroque/followers","following_url":"https://api.github.com/users/AnthonyLarroque/following{/other_user}","gists_url":"https://api.github.com/users/AnthonyLarroque/gists{/gist_id}","starred_url":"https://api.github.com/users/AnthonyLarroque/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AnthonyLarroque/subscriptions","organizations_url":"https://api.github.com/users/AnthonyLarroque/orgs","repos_url":"https://api.github.com/users/AnthonyLarroque/repos","events_url":"https://api.github.com/users/AnthonyLarroque/events{/privacy}","received_events_url":"https://api.github.com/users/AnthonyLarroque/received_events","type":"User","site_admin":false},"created_at":"2022-10-06T14:05:52Z","updated_at":"2022-10-06T14:05:52Z","author_association":"NONE","body":"Hi @GranjalCruz ,\r\n\r\nThank you for your answer !\r\n\r\n\"The only good way to compare 3.1 to 2.1 is if you pass the same dataset, which from a quick look of the plots seems not to be the case.\"\r\n\r\nIt is the case: the dataset from 2.1 and 3.1 are the same. But sorry, my notebook was not optimal regarding the structure to really compare. I join the same notebook where it is easier to compare the results between when the hyperparameters are optimized in an unique step and when they are optimized successively. In this new notebook, the plot of the section 2.3.1 must be compared with the one of the section 2.3.2 and the plot of section 3.3.1 with the plot of 3.3.2. \r\n\r\n\"The model of 3.2 is the best since the new samples are 'optimal' based on some acquisition function, therefore it makes sense that it outputs the best model of all the examples.\"\r\n\r\nI am not using any acquisition function in that notebook. I just study two cases: one with 3 high fidelity samples (section 2 in the new notebook) and another one with 5 high fidelity samples (section 3 in the new notebook). I then compare for the two cases the difference between optimizing the hyperparameters in one step or optimizing them successively.\r\n\r\n\"P.S: I am not using emukit for multi-fidelity optimization but for multi-fidelity modelling (application case is different than classic GPyOpt framework)\"\r\n\r\nEven if I am later interested in multi-fidelity optimization, all the notebooks that I sent are dealing with just multi-fidelity modelling here. When I am talking about optimization, for the moment I just refer to the optimization of the hyperparameters such it fits the best possible the data according to the marginal likelihood. \r\n\r\nRegards,\r\nAnthony Larroque\r\n\r\n\r\n[hp_mf_3.zip](https://github.com/EmuKit/emukit/files/9725363/hp_mf_3.zip)\r\n","reactions":{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/1270115128/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"AnthonyLarroque","id":44471624,"node_id":"MDQ6VXNlcjQ0NDcxNjI0","avatar_url":"https://avatars.githubusercontent.com/u/44471624?v=4","gravatar_id":"","url":"https://api.github.com/users/AnthonyLarroque","html_url":"https://github.com/AnthonyLarroque","followers_url":"https://api.github.com/users/AnthonyLarroque/followers","following_url":"https://api.github.com/users/AnthonyLarroque/following{/other_user}","gists_url":"https://api.github.com/users/AnthonyLarroque/gists{/gist_id}","starred_url":"https://api.github.com/users/AnthonyLarroque/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AnthonyLarroque/subscriptions","organizations_url":"https://api.github.com/users/AnthonyLarroque/orgs","repos_url":"https://api.github.com/users/AnthonyLarroque/repos","events_url":"https://api.github.com/users/AnthonyLarroque/events{/privacy}","received_events_url":"https://api.github.com/users/AnthonyLarroque/received_events","type":"User","site_admin":false}},{"id":7535281603,"node_id":"MEE_lADOCMd5485RQXuzzwAAAAHBI0XD","url":"https://api.github.com/repos/EmuKit/emukit/issues/events/7535281603","actor":{"login":"GranjalCruz","id":86713349,"node_id":"MDQ6VXNlcjg2NzEzMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/86713349?v=4","gravatar_id":"","url":"https://api.github.com/users/GranjalCruz","html_url":"https://github.com/GranjalCruz","followers_url":"https://api.github.com/users/GranjalCruz/followers","following_url":"https://api.github.com/users/GranjalCruz/following{/other_user}","gists_url":"https://api.github.com/users/GranjalCruz/gists{/gist_id}","starred_url":"https://api.github.com/users/GranjalCruz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GranjalCruz/subscriptions","organizations_url":"https://api.github.com/users/GranjalCruz/orgs","repos_url":"https://api.github.com/users/GranjalCruz/repos","events_url":"https://api.github.com/users/GranjalCruz/events{/privacy}","received_events_url":"https://api.github.com/users/GranjalCruz/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-10-06T14:05:52Z","performed_via_github_app":null},{"id":7535281611,"node_id":"SE_lADOCMd5485RQXuzzwAAAAHBI0XL","url":"https://api.github.com/repos/EmuKit/emukit/issues/events/7535281611","actor":{"login":"GranjalCruz","id":86713349,"node_id":"MDQ6VXNlcjg2NzEzMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/86713349?v=4","gravatar_id":"","url":"https://api.github.com/users/GranjalCruz","html_url":"https://github.com/GranjalCruz","followers_url":"https://api.github.com/users/GranjalCruz/followers","following_url":"https://api.github.com/users/GranjalCruz/following{/other_user}","gists_url":"https://api.github.com/users/GranjalCruz/gists{/gist_id}","starred_url":"https://api.github.com/users/GranjalCruz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GranjalCruz/subscriptions","organizations_url":"https://api.github.com/users/GranjalCruz/orgs","repos_url":"https://api.github.com/users/GranjalCruz/repos","events_url":"https://api.github.com/users/GranjalCruz/events{/privacy}","received_events_url":"https://api.github.com/users/GranjalCruz/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-10-06T14:05:52Z","performed_via_github_app":null}]