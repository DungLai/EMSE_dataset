[{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/558168007","html_url":"https://github.com/EmuKit/emukit/issues/269#issuecomment-558168007","issue_url":"https://api.github.com/repos/EmuKit/emukit/issues/269","id":558168007,"node_id":"MDEyOklzc3VlQ29tbWVudDU1ODE2ODAwNw==","user":{"login":"mmahsereci","id":42842079,"node_id":"MDQ6VXNlcjQyODQyMDc5","avatar_url":"https://avatars.githubusercontent.com/u/42842079?v=4","gravatar_id":"","url":"https://api.github.com/users/mmahsereci","html_url":"https://github.com/mmahsereci","followers_url":"https://api.github.com/users/mmahsereci/followers","following_url":"https://api.github.com/users/mmahsereci/following{/other_user}","gists_url":"https://api.github.com/users/mmahsereci/gists{/gist_id}","starred_url":"https://api.github.com/users/mmahsereci/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mmahsereci/subscriptions","organizations_url":"https://api.github.com/users/mmahsereci/orgs","repos_url":"https://api.github.com/users/mmahsereci/repos","events_url":"https://api.github.com/users/mmahsereci/events{/privacy}","received_events_url":"https://api.github.com/users/mmahsereci/received_events","type":"User","site_admin":false},"created_at":"2019-11-25T13:59:56Z","updated_at":"2019-11-25T13:59:56Z","author_association":"CONTRIBUTOR","body":"Hi Tim,\r\n\r\nyes, the github issues are a good place for this. \r\n\r\n1) You are right, the error occurs because you are using ARD=True in the GPy kernel. The quadrature kernel in emukit currently only support a scalar lengthscale for multi-D problems (ARD=False). One way around it for now would be to do a change of variables as you suggest (see also [here](https://en.wikipedia.org/wiki/Integration_by_substitution#Substitution_for_multiple_variables)). \r\nA more direct way would be to implement the appropriate QuadratureRBF (see 2) also since master branch diverged a bit from stable branch). \r\n\r\n2) The example you posted suggests that you are using the stable branch. There is more functionality in the master branch and it might be better for you to work with the master branch (even though it might be changing slightly.) \r\nThe master branch contains integration of the RBF kernel against the standard Lebesgue measure, the multivariate isotropic Gaussian measure, and the multivariate uniform measure. It currently does not support integration against a multivariate Gaussian with a non-scalar covariance though. In case your integration measure is a Gaussian with non-scalar covariance, a (not so pretty but fast) way around this is to reformulate your problem as \\int r(x)f(x)/p(x) dp(x) where p(x) is a multivariate Gaussian with scalar covariance. Then you would model r(x)f(x)/p(x) with a GP and integrate against p(x).\r\n\r\nCurrently there is no tutorial notebook which shows how to do the integration against a probability measure, but I'll post some example code below soon. \r\n\r\nThanks,\r\nMaren","reactions":{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/558168007/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mmahsereci","id":42842079,"node_id":"MDQ6VXNlcjQyODQyMDc5","avatar_url":"https://avatars.githubusercontent.com/u/42842079?v=4","gravatar_id":"","url":"https://api.github.com/users/mmahsereci","html_url":"https://github.com/mmahsereci","followers_url":"https://api.github.com/users/mmahsereci/followers","following_url":"https://api.github.com/users/mmahsereci/following{/other_user}","gists_url":"https://api.github.com/users/mmahsereci/gists{/gist_id}","starred_url":"https://api.github.com/users/mmahsereci/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mmahsereci/subscriptions","organizations_url":"https://api.github.com/users/mmahsereci/orgs","repos_url":"https://api.github.com/users/mmahsereci/repos","events_url":"https://api.github.com/users/mmahsereci/events{/privacy}","received_events_url":"https://api.github.com/users/mmahsereci/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/558182693","html_url":"https://github.com/EmuKit/emukit/issues/269#issuecomment-558182693","issue_url":"https://api.github.com/repos/EmuKit/emukit/issues/269","id":558182693,"node_id":"MDEyOklzc3VlQ29tbWVudDU1ODE4MjY5Mw==","user":{"login":"mmahsereci","id":42842079,"node_id":"MDQ6VXNlcjQyODQyMDc5","avatar_url":"https://avatars.githubusercontent.com/u/42842079?v=4","gravatar_id":"","url":"https://api.github.com/users/mmahsereci","html_url":"https://github.com/mmahsereci","followers_url":"https://api.github.com/users/mmahsereci/followers","following_url":"https://api.github.com/users/mmahsereci/following{/other_user}","gists_url":"https://api.github.com/users/mmahsereci/gists{/gist_id}","starred_url":"https://api.github.com/users/mmahsereci/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mmahsereci/subscriptions","organizations_url":"https://api.github.com/users/mmahsereci/orgs","repos_url":"https://api.github.com/users/mmahsereci/repos","events_url":"https://api.github.com/users/mmahsereci/events{/privacy}","received_events_url":"https://api.github.com/users/mmahsereci/received_events","type":"User","site_admin":false},"created_at":"2019-11-25T14:34:58Z","updated_at":"2019-12-02T18:43:24Z","author_association":"CONTRIBUTOR","body":"here are some code example that might work for you. they will work with master branch only. Dummy function here to make code work.\r\n\r\n```\r\nimport numpy as np\r\nimport GPy\r\nfrom emukit.core.loop.user_function import UserFunctionWrapper\r\n\r\ndef dummy_func(x):\r\n    return np.ones([x.shape[0], 1])\r\n\r\nuser_function = UserFunctionWrapper(dummy_func)\r\n\r\nD = 3 # dimensionality\r\nN = 4 # number of initial observations\r\n\r\n# initial observations\r\nX_init = np.reshape(np.random.randn(N * D), [N, D])\r\nY_init = user_function.f(X_init)\r\n\r\n# GPy model\r\ngpy_model = GPy.models.GPRegression(X=X_init, Y=Y_init, kernel=GPy.kern.RBF(input_dim=D))\r\n\r\n```\r\n\r\nThen chose the appropriate measure and kernel.\r\n```\r\nfrom emukit.model_wrappers.gpy_quadrature_wrappers import BaseGaussianProcessGPy, RBFGPy\r\nfrom emukit.quadrature.kernels.integration_measures import IsotropicGaussianMeasure\r\nfrom emukit.quadrature.kernels import QuadratureRBFIsoGaussMeasure\r\nfrom emukit.quadrature.methods.vanilla_bq import VanillaBayesianQuadrature\r\nfrom emukit.quadrature.loop.vanilla_bq_loop import VanillaBayesianQuadratureLoop\r\n\r\n# Gaussian integration measure\r\nmeasure = IsotropicGaussianMeasure(mean=np.zeros(D), variance=2.)\r\n\r\n# wrap GPy model in emukit\r\nemukit_qrbf = QuadratureRBFIsoGaussMeasure(RBFGPy(gpy_model.kern), measure)\r\nemukit_gp = BaseGaussianProcessGPy(emukit_qrbf, gpy_model)\r\nemukit_model = VanillaBayesianQuadrature(emukit_gp, X=X_init, Y=Y_init)\r\nemukit_loop = VanillaBayesianQuadratureLoop(emukit_model)\r\n\r\n# run the loop \r\nemukit_loop.run_loop(user_function, stopping_condition=20)\r\n\r\n# intgerate the model\r\nintegral_mean, integral_var = emukit_loop.model.integrate()\r\n```\r\nHope that helps,\r\nThanks,\r\nMaren","reactions":{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/558182693/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mmahsereci","id":42842079,"node_id":"MDQ6VXNlcjQyODQyMDc5","avatar_url":"https://avatars.githubusercontent.com/u/42842079?v=4","gravatar_id":"","url":"https://api.github.com/users/mmahsereci","html_url":"https://github.com/mmahsereci","followers_url":"https://api.github.com/users/mmahsereci/followers","following_url":"https://api.github.com/users/mmahsereci/following{/other_user}","gists_url":"https://api.github.com/users/mmahsereci/gists{/gist_id}","starred_url":"https://api.github.com/users/mmahsereci/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mmahsereci/subscriptions","organizations_url":"https://api.github.com/users/mmahsereci/orgs","repos_url":"https://api.github.com/users/mmahsereci/repos","events_url":"https://api.github.com/users/mmahsereci/events{/privacy}","received_events_url":"https://api.github.com/users/mmahsereci/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/558231642","html_url":"https://github.com/EmuKit/emukit/issues/269#issuecomment-558231642","issue_url":"https://api.github.com/repos/EmuKit/emukit/issues/269","id":558231642,"node_id":"MDEyOklzc3VlQ29tbWVudDU1ODIzMTY0Mg==","user":{"login":"tjdodwell","id":16720784,"node_id":"MDQ6VXNlcjE2NzIwNzg0","avatar_url":"https://avatars.githubusercontent.com/u/16720784?v=4","gravatar_id":"","url":"https://api.github.com/users/tjdodwell","html_url":"https://github.com/tjdodwell","followers_url":"https://api.github.com/users/tjdodwell/followers","following_url":"https://api.github.com/users/tjdodwell/following{/other_user}","gists_url":"https://api.github.com/users/tjdodwell/gists{/gist_id}","starred_url":"https://api.github.com/users/tjdodwell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tjdodwell/subscriptions","organizations_url":"https://api.github.com/users/tjdodwell/orgs","repos_url":"https://api.github.com/users/tjdodwell/repos","events_url":"https://api.github.com/users/tjdodwell/events{/privacy}","received_events_url":"https://api.github.com/users/tjdodwell/received_events","type":"User","site_admin":false},"created_at":"2019-11-25T16:25:25Z","updated_at":"2019-11-25T16:25:25Z","author_association":"NONE","body":"Thanks Maren! That is super!","reactions":{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/558231642/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tjdodwell","id":16720784,"node_id":"MDQ6VXNlcjE2NzIwNzg0","avatar_url":"https://avatars.githubusercontent.com/u/16720784?v=4","gravatar_id":"","url":"https://api.github.com/users/tjdodwell","html_url":"https://github.com/tjdodwell","followers_url":"https://api.github.com/users/tjdodwell/followers","following_url":"https://api.github.com/users/tjdodwell/following{/other_user}","gists_url":"https://api.github.com/users/tjdodwell/gists{/gist_id}","starred_url":"https://api.github.com/users/tjdodwell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tjdodwell/subscriptions","organizations_url":"https://api.github.com/users/tjdodwell/orgs","repos_url":"https://api.github.com/users/tjdodwell/repos","events_url":"https://api.github.com/users/tjdodwell/events{/privacy}","received_events_url":"https://api.github.com/users/tjdodwell/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/615263260","html_url":"https://github.com/EmuKit/emukit/issues/269#issuecomment-615263260","issue_url":"https://api.github.com/repos/EmuKit/emukit/issues/269","id":615263260,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNTI2MzI2MA==","user":{"login":"mmahsereci","id":42842079,"node_id":"MDQ6VXNlcjQyODQyMDc5","avatar_url":"https://avatars.githubusercontent.com/u/42842079?v=4","gravatar_id":"","url":"https://api.github.com/users/mmahsereci","html_url":"https://github.com/mmahsereci","followers_url":"https://api.github.com/users/mmahsereci/followers","following_url":"https://api.github.com/users/mmahsereci/following{/other_user}","gists_url":"https://api.github.com/users/mmahsereci/gists{/gist_id}","starred_url":"https://api.github.com/users/mmahsereci/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mmahsereci/subscriptions","organizations_url":"https://api.github.com/users/mmahsereci/orgs","repos_url":"https://api.github.com/users/mmahsereci/repos","events_url":"https://api.github.com/users/mmahsereci/events{/privacy}","received_events_url":"https://api.github.com/users/mmahsereci/received_events","type":"User","site_admin":false},"created_at":"2020-04-17T14:05:00Z","updated_at":"2020-04-17T14:05:00Z","author_association":"CONTRIBUTOR","body":"This seems to be resolved. I am closing the issue.","reactions":{"url":"https://api.github.com/repos/EmuKit/emukit/issues/comments/615263260/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mmahsereci","id":42842079,"node_id":"MDQ6VXNlcjQyODQyMDc5","avatar_url":"https://avatars.githubusercontent.com/u/42842079?v=4","gravatar_id":"","url":"https://api.github.com/users/mmahsereci","html_url":"https://github.com/mmahsereci","followers_url":"https://api.github.com/users/mmahsereci/followers","following_url":"https://api.github.com/users/mmahsereci/following{/other_user}","gists_url":"https://api.github.com/users/mmahsereci/gists{/gist_id}","starred_url":"https://api.github.com/users/mmahsereci/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mmahsereci/subscriptions","organizations_url":"https://api.github.com/users/mmahsereci/orgs","repos_url":"https://api.github.com/users/mmahsereci/repos","events_url":"https://api.github.com/users/mmahsereci/events{/privacy}","received_events_url":"https://api.github.com/users/mmahsereci/received_events","type":"User","site_admin":false}},{"id":3244543068,"node_id":"MDExOkNsb3NlZEV2ZW50MzI0NDU0MzA2OA==","url":"https://api.github.com/repos/EmuKit/emukit/issues/events/3244543068","actor":{"login":"mmahsereci","id":42842079,"node_id":"MDQ6VXNlcjQyODQyMDc5","avatar_url":"https://avatars.githubusercontent.com/u/42842079?v=4","gravatar_id":"","url":"https://api.github.com/users/mmahsereci","html_url":"https://github.com/mmahsereci","followers_url":"https://api.github.com/users/mmahsereci/followers","following_url":"https://api.github.com/users/mmahsereci/following{/other_user}","gists_url":"https://api.github.com/users/mmahsereci/gists{/gist_id}","starred_url":"https://api.github.com/users/mmahsereci/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mmahsereci/subscriptions","organizations_url":"https://api.github.com/users/mmahsereci/orgs","repos_url":"https://api.github.com/users/mmahsereci/repos","events_url":"https://api.github.com/users/mmahsereci/events{/privacy}","received_events_url":"https://api.github.com/users/mmahsereci/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-04-17T14:05:00Z","state_reason":null,"performed_via_github_app":null}]