{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5230","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5230/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5230/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5230/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/5230","id":777544523,"node_id":"MDU6SXNzdWU3Nzc1NDQ1MjM=","number":5230,"title":"DFL training on RTX 3090 produces error \"illegal instruction, core dumped\" Linux but also some Windows installations","user":{"login":"Joe-121","id":76885018,"node_id":"MDQ6VXNlcjc2ODg1MDE4","avatar_url":"https://avatars.githubusercontent.com/u/76885018?v=4","gravatar_id":"","url":"https://api.github.com/users/Joe-121","html_url":"https://github.com/Joe-121","followers_url":"https://api.github.com/users/Joe-121/followers","following_url":"https://api.github.com/users/Joe-121/following{/other_user}","gists_url":"https://api.github.com/users/Joe-121/gists{/gist_id}","starred_url":"https://api.github.com/users/Joe-121/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Joe-121/subscriptions","organizations_url":"https://api.github.com/users/Joe-121/orgs","repos_url":"https://api.github.com/users/Joe-121/repos","events_url":"https://api.github.com/users/Joe-121/events{/privacy}","received_events_url":"https://api.github.com/users/Joe-121/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-01-02T23:51:20Z","updated_at":"2021-01-28T00:19:00Z","closed_at":"2021-01-28T00:19:00Z","author_association":"NONE","active_lock_reason":null,"body":"\r\n## Expected behavior\r\n\r\nTraining SAEHD or XSeg on DFL with RTX 3090, tensorflow 2.4.0\r\n\r\n## Actual behavior\r\n\r\nPython throws Error code of \"illegal instruction, core dumped\" on last line of DFL script which says \"train\"\r\nThis is despite Tensorflow 2.4.0 correctly recognising the RTX 3090, and despite cuda 11.0 or 11.1 and compatible nvidia drivers (455.28) all working correctly.\r\n\r\n## Steps to reproduce\r\n\r\nInstall DFL on Windows or Linux as per Nagadit repository but use python 3.8 instead, and cudnn 8.0.5 and cudatoolkit 11.0 from Conda or 11.1 from Nvidia direct. Tensorflow 2.4.0\r\nAlso same error on my friends Windows 10 installation of DFL for RTX 3090.\r\n\r\n**Solution:**\r\nThis will only apply to some people out there with older CPUs, but here is what I eventually found:\r\n\r\nThis is a Tensorflow 2.4.0 problem. Even if RTX 3090 works with TF 2.4.0, older CPUs do not in Linux and on some Windows builds it seems. TF requires AVX or AVX2 support. TF 2.3 supports AVX and AVX2. The tensorflow guys forgot to include AVX support in 2.4.0, despite it being compatible! Newer CPUs with AVX2 support will be ok.\r\nI therefore compiled my own tensorflow for my machine, and this produced TF 2.5.0 which had AVX support. I can now fully train DFL using RTX 3090!\r\n\r\nI don't have the Windows guide to compiling TF, but for linux TF you can use: https://www.tensorflow.org/install/source\r\nI compiled with cudnn 8.0.5 dev files (filename libcudnn8-dev_8.0.5.39-1+cuda11.1) and cudatoolkit 11.1 installed.\r\n\r\nThis produced tensorflow 2.5.0 and this works great with RTX3090 and current DFL build.\r\n\r\nDon't think this problem is common (less so on Windows machines) but hopefully of some use to someone out there","closed_by":{"login":"Joe-121","id":76885018,"node_id":"MDQ6VXNlcjc2ODg1MDE4","avatar_url":"https://avatars.githubusercontent.com/u/76885018?v=4","gravatar_id":"","url":"https://api.github.com/users/Joe-121","html_url":"https://github.com/Joe-121","followers_url":"https://api.github.com/users/Joe-121/followers","following_url":"https://api.github.com/users/Joe-121/following{/other_user}","gists_url":"https://api.github.com/users/Joe-121/gists{/gist_id}","starred_url":"https://api.github.com/users/Joe-121/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Joe-121/subscriptions","organizations_url":"https://api.github.com/users/Joe-121/orgs","repos_url":"https://api.github.com/users/Joe-121/repos","events_url":"https://api.github.com/users/Joe-121/events{/privacy}","received_events_url":"https://api.github.com/users/Joe-121/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5230/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5230/timeline","performed_via_github_app":null,"state_reason":"completed"}