{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5581","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5581/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5581/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5581/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/5581","id":1435084041,"node_id":"I_kwDOCBuapc5ViaUJ","number":5581,"title":" (0) Resource exhausted: failed to allocate memory","user":{"login":"Sonicsagar","id":117388947,"node_id":"U_kgDOBv82kw","avatar_url":"https://avatars.githubusercontent.com/u/117388947?v=4","gravatar_id":"","url":"https://api.github.com/users/Sonicsagar","html_url":"https://github.com/Sonicsagar","followers_url":"https://api.github.com/users/Sonicsagar/followers","following_url":"https://api.github.com/users/Sonicsagar/following{/other_user}","gists_url":"https://api.github.com/users/Sonicsagar/gists{/gist_id}","starred_url":"https://api.github.com/users/Sonicsagar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sonicsagar/subscriptions","organizations_url":"https://api.github.com/users/Sonicsagar/orgs","repos_url":"https://api.github.com/users/Sonicsagar/repos","events_url":"https://api.github.com/users/Sonicsagar/events{/privacy}","received_events_url":"https://api.github.com/users/Sonicsagar/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-11-03T18:16:46Z","updated_at":"2022-11-03T18:16:46Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"\r\nWhat kind of bug is this? \r\n\r\n======================== Model Summary ========================\r\n==                                                           ==\r\n==            Model name: FF Github iperov_SAEHD             ==\r\n==                                                           ==\r\n==     Current iteration: 315611                             ==\r\n==                                                           ==\r\n==---------------------- Model Options ----------------------==\r\n==                                                           ==\r\n==            resolution: 128                                ==\r\n==             face_type: f                                  ==\r\n==     models_opt_on_gpu: True                               ==\r\n==                 archi: liae                               ==\r\n==               ae_dims: 128                                ==\r\n==                e_dims: 80                                 ==\r\n==                d_dims: 48                                 ==\r\n==           d_mask_dims: 16                                 ==\r\n==       masked_training: True                               ==\r\n==            learn_mask: True                               ==\r\n==            lr_dropout: n                                  ==\r\n==           random_warp: True                               ==\r\n==             gan_power: 0.0                                ==\r\n==       true_face_power: 0.0                                ==\r\n==      face_style_power: 0.0                                ==\r\n==        bg_style_power: 0.0                                ==\r\n==               ct_mode: none                               ==\r\n==              clipgrad: False                              ==\r\n==              pretrain: False                              ==\r\n==       autobackup_hour: 0                                  ==\r\n== write_preview_history: False                              ==\r\n==           target_iter: 0                                  ==\r\n==           random_flip: True                               ==\r\n==            batch_size: 8                                  ==\r\n==       eyes_mouth_prio: True                               ==\r\n==           uniform_yaw: False                              ==\r\n==             adabelief: False                              ==\r\n==        gan_patch_size: 16                                 ==\r\n==              gan_dims: 16                                 ==\r\n==         blur_out_mask: False                              ==\r\n==      random_hsv_power: 0.0                                ==\r\n==                                                           ==\r\n==----------------------- Running On ------------------------==\r\n==                                                           ==\r\n==          Device index: 0                                  ==\r\n==                  Name: NVIDIA GeForce RTX 3070 Laptop GPU ==\r\n==                  VRAM: 5.35GB                             ==\r\n==                                                           ==\r\n===============================================================\r\nStarting. Press \"Enter\" to stop training and save model.\r\nError: 2 root error(s) found.\r\n  (0) Resource exhausted: failed to allocate memory\r\n         [[node mul_49 (defined at C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\optimizers\\RMSprop.py:58) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n         [[concat_3/concat/_477]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n  (1) Resource exhausted: failed to allocate memory\r\n         [[node mul_49 (defined at C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\optimizers\\RMSprop.py:58) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n0 successful operations.\r\n0 derived errors ignored.\r\n\r\nErrors may have originated from an input operation.\r\nInput Source operations connected to node mul_49:\r\n src_dst_opt/acc_encoder/down1/downs_3/conv1/weight_0/read (defined at C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\optimizers\\RMSprop.py:35)\r\n\r\nInput Source operations connected to node mul_49:\r\n src_dst_opt/acc_encoder/down1/downs_3/conv1/weight_0/read (defined at C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\optimizers\\RMSprop.py:35)\r\n\r\nOriginal stack trace for 'mul_49':\r\n  File \"threading.py\", line 884, in _bootstrap\r\n  File \"threading.py\", line 916, in _bootstrap_inner\r\n  File \"threading.py\", line 864, in run\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 58, in trainerThread\r\n    debug=debug)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 193, in __init__\r\n    self.on_initialize()\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 564, in on_initialize\r\n    src_dst_loss_gv_op = self.src_dst_opt.get_update_op (nn.average_gv_list (gpu_G_loss_gvs))\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\optimizers\\RMSprop.py\", line 58, in get_update_op\r\n    new_a = self.rho * a + (1. - self.rho) * tf.square(g)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\variables.py\", line 1076, in _run_op\r\n    return tensor_oper(a.value(), *args, **kwargs)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 1400, in r_binary_op_wrapper\r\n    return func(x, y, name=name)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 1710, in _mul_dispatch\r\n    return multiply(x, y, name=name)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\dispatch.py\", line 206, in wrapper\r\n    return target(*args, **kwargs)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 530, in multiply\r\n    return gen_math_ops.mul(x, y, name)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 6245, in mul\r\n    \"Mul\", x=x, y=y, name=name)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 750, in _apply_op_helper\r\n    attrs=attr_protos, op_def=op_def)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3569, in _create_op_internal\r\n    op_def=op_def)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 2045, in __init__\r\n    self._traceback = tf_stack.extract_stack_for_node(self._c_op)\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1375, in _do_call\r\n    return fn(*args)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1360, in _run_fn\r\n    target_list, run_metadata)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1453, in _call_tf_sessionrun\r\n    run_metadata)\r\ntensorflow.python.framework.errors_impl.ResourceExhaustedError: 2 root error(s) found.\r\n  (0) Resource exhausted: failed to allocate memory\r\n         [[{{node mul_49}}]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n         [[concat_3/concat/_477]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n  (1) Resource exhausted: failed to allocate memory\r\n         [[{{node mul_49}}]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n0 successful operations.\r\n0 derived errors ignored.\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 129, in trainerThread\r\n    iter, iter_time = model.train_one_iter()\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 474, in train_one_iter\r\n    losses = self.onTrainOneIter()\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 774, in onTrainOneIter\r\n    src_loss, dst_loss = self.src_dst_train (warped_src, target_src, target_srcm, target_srcm_em, warped_dst, target_dst, target_dstm, target_dstm_em)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 584, in src_dst_train\r\n    self.target_dstm_em:target_dstm_em,\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 968, in run\r\n    run_metadata_ptr)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1191, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1369, in _do_run\r\n    run_metadata)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1394, in _do_call\r\n    raise type(e)(node_def, op, message)  # pylint: disable=no-value-for-parameter\r\ntensorflow.python.framework.errors_impl.ResourceExhaustedError: 2 root error(s) found.\r\n  (0) Resource exhausted: failed to allocate memory\r\n         [[node mul_49 (defined at C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\optimizers\\RMSprop.py:58) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n         [[concat_3/concat/_477]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n  (1) Resource exhausted: failed to allocate memory\r\n         [[node mul_49 (defined at C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\optimizers\\RMSprop.py:58) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n0 successful operations.\r\n0 derived errors ignored.\r\n\r\nErrors may have originated from an input operation.\r\nInput Source operations connected to node mul_49:\r\n src_dst_opt/acc_encoder/down1/downs_3/conv1/weight_0/read (defined at C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\optimizers\\RMSprop.py:35)\r\n\r\nInput Source operations connected to node mul_49:\r\n src_dst_opt/acc_encoder/down1/downs_3/conv1/weight_0/read (defined at C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\optimizers\\RMSprop.py:35)\r\n\r\nOriginal stack trace for 'mul_49':\r\n  File \"threading.py\", line 884, in _bootstrap\r\n  File \"threading.py\", line 916, in _bootstrap_inner\r\n  File \"threading.py\", line 864, in run\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 58, in trainerThread\r\n    debug=debug)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 193, in __init__\r\n    self.on_initialize()\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 564, in on_initialize\r\n    src_dst_loss_gv_op = self.src_dst_opt.get_update_op (nn.average_gv_list (gpu_G_loss_gvs))\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\optimizers\\RMSprop.py\", line 58, in get_update_op\r\n    new_a = self.rho * a + (1. - self.rho) * tf.square(g)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\variables.py\", line 1076, in _run_op\r\n    return tensor_oper(a.value(), *args, **kwargs)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 1400, in r_binary_op_wrapper\r\n    return func(x, y, name=name)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 1710, in _mul_dispatch\r\n    return multiply(x, y, name=name)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\dispatch.py\", line 206, in wrapper\r\n    return target(*args, **kwargs)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 530, in multiply\r\n    return gen_math_ops.mul(x, y, name)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 6245, in mul\r\n    \"Mul\", x=x, y=y, name=name)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 750, in _apply_op_helper\r\n    attrs=attr_protos, op_def=op_def)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3569, in _create_op_internal\r\n    op_def=op_def)\r\n  File \"C:\\Users\\Sagar\\Downloads\\Programs\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 2045, in __init__\r\n    self._traceback = tf_stack.extract_stack_for_node(self._c_op)\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5581/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5581/timeline","performed_via_github_app":null,"state_reason":null}