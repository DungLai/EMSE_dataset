{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5266","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5266/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5266/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5266/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/5266","id":795423757,"node_id":"MDU6SXNzdWU3OTU0MjM3NTc=","number":5266,"title":"DFL crashed with 3080","user":{"login":"JamiesonDeuel","id":45806406,"node_id":"MDQ6VXNlcjQ1ODA2NDA2","avatar_url":"https://avatars.githubusercontent.com/u/45806406?v=4","gravatar_id":"","url":"https://api.github.com/users/JamiesonDeuel","html_url":"https://github.com/JamiesonDeuel","followers_url":"https://api.github.com/users/JamiesonDeuel/followers","following_url":"https://api.github.com/users/JamiesonDeuel/following{/other_user}","gists_url":"https://api.github.com/users/JamiesonDeuel/gists{/gist_id}","starred_url":"https://api.github.com/users/JamiesonDeuel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JamiesonDeuel/subscriptions","organizations_url":"https://api.github.com/users/JamiesonDeuel/orgs","repos_url":"https://api.github.com/users/JamiesonDeuel/repos","events_url":"https://api.github.com/users/JamiesonDeuel/events{/privacy}","received_events_url":"https://api.github.com/users/JamiesonDeuel/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-01-27T20:33:53Z","updated_at":"2022-02-25T22:09:21Z","closed_at":"2022-02-25T22:09:21Z","author_association":"NONE","active_lock_reason":null,"body":"DFL crash and then I got his error. \r\n=============== Model Summary ===============\r\n==                                         ==\r\n==            Model name: Matt2_SAEHD      ==\r\n==                                         ==\r\n==     Current iteration: 3594             ==\r\n==                                         ==\r\n==------------- Model Options -------------==\r\n==                                         ==\r\n==            resolution: 128              ==\r\n==             face_type: wf               ==\r\n==     models_opt_on_gpu: True             ==\r\n==                 archi: df               ==\r\n==               ae_dims: 128              ==\r\n==                e_dims: 64               ==\r\n==                d_dims: 64               ==\r\n==           d_mask_dims: 22               ==\r\n==       masked_training: True             ==\r\n==       eyes_mouth_prio: True             ==\r\n==           uniform_yaw: False            ==\r\n==             adabelief: True             ==\r\n==            lr_dropout: n                ==\r\n==           random_warp: False            ==\r\n==       true_face_power: 0.01             ==\r\n==      face_style_power: 0.01             ==\r\n==        bg_style_power: 0.0              ==\r\n==               ct_mode: none             ==\r\n==              clipgrad: False            ==\r\n==              pretrain: False            ==\r\n==       autobackup_hour: 0                ==\r\n== write_preview_history: False            ==\r\n==           target_iter: 0                ==\r\n==           random_flip: True             ==\r\n==            batch_size: 8                ==\r\n==             gan_power: 0.1              ==\r\n==        gan_patch_size: 16               ==\r\n==              gan_dims: 16               ==\r\n==                                         ==\r\n==-------------- Running On ---------------==\r\n==                                         ==\r\n==          Device index: 0                ==\r\n==                  Name: GeForce RTX 3080 ==\r\n==                  VRAM: 10.00GB          ==\r\n==                                         ==\r\n=============================================\r\n\r\nError: Input to reshape is a tensor with 8 values, but the requested shape has 334176\r\n         [[node gradients/Mean_11_grad/Reshape (defined at D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py:55) ]]\r\n\r\nOriginal stack trace for 'gradients/Mean_11_grad/Reshape':\r\n  File \"threading.py\", line 884, in _bootstrap\r\n  File \"threading.py\", line 916, in _bootstrap_inner\r\n  File \"threading.py\", line 864, in run\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 58, in trainerThread\r\n    debug=debug,\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 189, in __init__\r\n    self.on_initialize()\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 468, in on_initialize\r\n    gpu_D_code_loss_gvs += [ nn.gradients (gpu_D_code_loss, self.code_discriminator.get_weights() ) ]\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py\", line 55, in tf_gradients\r\n    grads = gradients.gradients(loss, vars, colocate_gradients_with_ops=True )\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 172, in gradients\r\n    unconnected_gradients)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_util.py\", line 684, in _GradientsHelper\r\n    lambda: grad_fn(op, *out_grads))\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_util.py\", line 340, in _MaybeCompile\r\n    return grad_fn()  # Exit early\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_util.py\", line 684, in <lambda>\r\n    lambda: grad_fn(op, *out_grads))\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_grad.py\", line 255, in _MeanGrad\r\n    sum_grad = _SumGrad(op, grad)[0]\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_grad.py\", line 216, in _SumGrad\r\n    grad = array_ops.reshape(grad, output_shape_kept_dims)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\dispatch.py\", line 201, in wrapper\r\n    return target(*args, **kwargs)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\array_ops.py\", line 195, in reshape\r\n    result = gen_array_ops.reshape(tensor, shape, name)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_array_ops.py\", line 8377, in reshape\r\n    \"Reshape\", tensor=tensor, shape=shape, name=name)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 750, in _apply_op_helper\r\n    attrs=attr_protos, op_def=op_def)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3536, in _create_op_internal\r\n    op_def=op_def)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1990, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\n...which was originally created as op 'Mean_11', defined at:\r\n  File \"threading.py\", line 884, in _bootstrap\r\n[elided 3 identical lines from previous traceback]\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 189, in __init__\r\n    self.on_initialize()\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 465, in on_initialize\r\n    gpu_D_code_loss = (DLoss(gpu_src_code_d_ones , gpu_dst_code_d) + \\\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 454, in DLoss\r\n    return tf.reduce_mean( tf.nn.sigmoid_cross_entropy_with_logits(labels=labels, logits=logits), axis=[1,2,3])\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\dispatch.py\", line 201, in wrapper\r\n    return target(*args, **kwargs)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 2312, in reduce_mean_v1\r\n    return reduce_mean(input_tensor, axis, keepdims, name)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\dispatch.py\", line 201, in wrapper\r\n    return target(*args, **kwargs)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 2372, in reduce_mean\r\n    name=name))\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 5781, in mean\r\n    name=name)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 750, in _apply_op_helper\r\n    attrs=attr_protos, op_def=op_def)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3536, in _create_op_internal\r\n    op_def=op_def)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1990, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\nTraceback (most recent call last):\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1375, in _do_call\r\n    return fn(*args)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1360, in _run_fn\r\n    target_list, run_metadata)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1453, in _call_tf_sessionrun\r\n    run_metadata)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Input to reshape is a tensor with 8 values, but the requested shape has 334176\r\n         [[{{node gradients/Mean_11_grad/Reshape}}]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 130, in trainerThread\r\n    iter, iter_time = model.train_one_iter()\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 462, in train_one_iter\r\n    losses = self.onTrainOneIter()\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 701, in onTrainOneIter\r\n    self.D_train (warped_src, warped_dst)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 545, in D_train\r\n    nn.tf_sess.run ([D_loss_gv_op], feed_dict={self.warped_src: warped_src, self.warped_dst: warped_dst})\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 968, in run\r\n    run_metadata_ptr)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1191, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1369, in _do_run\r\n    run_metadata)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1394, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Input to reshape is a tensor with 8 values, but the requested shape has 334176\r\n         [[node gradients/Mean_11_grad/Reshape (defined at D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py:55) ]]\r\n\r\nOriginal stack trace for 'gradients/Mean_11_grad/Reshape':\r\n  File \"threading.py\", line 884, in _bootstrap\r\n  File \"threading.py\", line 916, in _bootstrap_inner\r\n  File \"threading.py\", line 864, in run\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 58, in trainerThread\r\n    debug=debug,\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 189, in __init__\r\n    self.on_initialize()\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 468, in on_initialize\r\n    gpu_D_code_loss_gvs += [ nn.gradients (gpu_D_code_loss, self.code_discriminator.get_weights() ) ]\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py\", line 55, in tf_gradients\r\n    grads = gradients.gradients(loss, vars, colocate_gradients_with_ops=True )\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 172, in gradients\r\n    unconnected_gradients)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_util.py\", line 684, in _GradientsHelper\r\n    lambda: grad_fn(op, *out_grads))\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_util.py\", line 340, in _MaybeCompile\r\n    return grad_fn()  # Exit early\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_util.py\", line 684, in <lambda>\r\n    lambda: grad_fn(op, *out_grads))\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_grad.py\", line 255, in _MeanGrad\r\n    sum_grad = _SumGrad(op, grad)[0]\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_grad.py\", line 216, in _SumGrad\r\n    grad = array_ops.reshape(grad, output_shape_kept_dims)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\dispatch.py\", line 201, in wrapper\r\n    return target(*args, **kwargs)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\array_ops.py\", line 195, in reshape\r\n    result = gen_array_ops.reshape(tensor, shape, name)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_array_ops.py\", line 8377, in reshape\r\n    \"Reshape\", tensor=tensor, shape=shape, name=name)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 750, in _apply_op_helper\r\n    attrs=attr_protos, op_def=op_def)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3536, in _create_op_internal\r\n    op_def=op_def)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1990, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\n...which was originally created as op 'Mean_11', defined at:\r\n  File \"threading.py\", line 884, in _bootstrap\r\n[elided 3 identical lines from previous traceback]\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 189, in __init__\r\n    self.on_initialize()\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 465, in on_initialize\r\n    gpu_D_code_loss = (DLoss(gpu_src_code_d_ones , gpu_dst_code_d) + \\\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 454, in DLoss\r\n    return tf.reduce_mean( tf.nn.sigmoid_cross_entropy_with_logits(labels=labels, logits=logits), axis=[1,2,3])\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\dispatch.py\", line 201, in wrapper\r\n    return target(*args, **kwargs)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 2312, in reduce_mean_v1\r\n    return reduce_mean(input_tensor, axis, keepdims, name)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\dispatch.py\", line 201, in wrapper\r\n    return target(*args, **kwargs)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 2372, in reduce_mean\r\n    name=name))\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 5781, in mean\r\n    name=name)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 750, in _apply_op_helper\r\n    attrs=attr_protos, op_def=op_def)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3536, in _create_op_internal\r\n    op_def=op_def)\r\n  File \"D:\\Downloads\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1990, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\nAny Ideas\r\n\r\n","closed_by":{"login":"JamiesonDeuel","id":45806406,"node_id":"MDQ6VXNlcjQ1ODA2NDA2","avatar_url":"https://avatars.githubusercontent.com/u/45806406?v=4","gravatar_id":"","url":"https://api.github.com/users/JamiesonDeuel","html_url":"https://github.com/JamiesonDeuel","followers_url":"https://api.github.com/users/JamiesonDeuel/followers","following_url":"https://api.github.com/users/JamiesonDeuel/following{/other_user}","gists_url":"https://api.github.com/users/JamiesonDeuel/gists{/gist_id}","starred_url":"https://api.github.com/users/JamiesonDeuel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JamiesonDeuel/subscriptions","organizations_url":"https://api.github.com/users/JamiesonDeuel/orgs","repos_url":"https://api.github.com/users/JamiesonDeuel/repos","events_url":"https://api.github.com/users/JamiesonDeuel/events{/privacy}","received_events_url":"https://api.github.com/users/JamiesonDeuel/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5266/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5266/timeline","performed_via_github_app":null,"state_reason":"completed"}