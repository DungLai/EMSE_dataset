{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5348","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5348/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5348/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5348/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/5348","id":917936322,"node_id":"MDU6SXNzdWU5MTc5MzYzMjI=","number":5348,"title":"Interactive merge takes >30 seconds/frame on 3090","user":{"login":"Zeesy","id":17345935,"node_id":"MDQ6VXNlcjE3MzQ1OTM1","avatar_url":"https://avatars.githubusercontent.com/u/17345935?v=4","gravatar_id":"","url":"https://api.github.com/users/Zeesy","html_url":"https://github.com/Zeesy","followers_url":"https://api.github.com/users/Zeesy/followers","following_url":"https://api.github.com/users/Zeesy/following{/other_user}","gists_url":"https://api.github.com/users/Zeesy/gists{/gist_id}","starred_url":"https://api.github.com/users/Zeesy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Zeesy/subscriptions","organizations_url":"https://api.github.com/users/Zeesy/orgs","repos_url":"https://api.github.com/users/Zeesy/repos","events_url":"https://api.github.com/users/Zeesy/events{/privacy}","received_events_url":"https://api.github.com/users/Zeesy/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-06-10T21:18:04Z","updated_at":"2021-06-16T21:32:08Z","closed_at":"2021-06-16T21:32:08Z","author_association":"NONE","active_lock_reason":null,"body":"## Expected behavior\r\n\r\nI am using the interactive merge tool with SAEHD on an RTX 3090. Expected behaviour from previous merges on my system would take <2s to make a change to the frame or override config to next frame.\r\n\r\n## Actual behavior\r\n\r\nWhen trained at <50K and <100K iterations, merging frames occurs faster. After 150K, each change to merge settings (eg. mask_mode, erode_mask_modifier, sharpen_mode, etc.) takes >30s. Override config to next frame/previous frame also takes >30s.\r\n\r\n## Steps to reproduce\r\n\r\n1) Train model using SAEHD with sot-m color_transfer_mode=1. Settings:\r\n```\r\n==     Current iteration: 150000             ==\r\n==                                           ==\r\n==-------------- Model Options --------------==\r\n==                                           ==\r\n==            resolution: 128                ==\r\n==             face_type: f                  ==\r\n==     models_opt_on_gpu: True               ==\r\n==                 archi: df-ud              ==\r\n==               ae_dims: 256                ==\r\n==                e_dims: 64                 ==\r\n==                d_dims: 64                 ==\r\n==           d_mask_dims: 22                 ==\r\n==       masked_training: True               ==\r\n==       eyes_mouth_prio: True               ==\r\n==           uniform_yaw: True               ==\r\n==             adabelief: True               ==\r\n==            lr_dropout: n                  ==\r\n==           random_warp: True               ==\r\n==       true_face_power: 0.0                ==\r\n==      face_style_power: 0.0                ==\r\n==        bg_style_power: 0.0                ==\r\n==               ct_mode: none               ==\r\n==              clipgrad: False              ==\r\n==              pretrain: False              ==\r\n==       autobackup_hour: 0                  ==\r\n== write_preview_history: False              ==\r\n==           target_iter: 150000             ==\r\n==       random_src_flip: False              ==\r\n==       random_dst_flip: True               ==\r\n==            batch_size: 8                  ==\r\n==             gan_power: 0.0                ==\r\n==        gan_patch_size: 16                 ==\r\n==              gan_dims: 16                 ==\r\n==                                           ==\r\n==--------------- Running On ----------------==\r\n==                                           ==\r\n==          Device index: 0                  ==\r\n==                  Name: GeForce RTX 3090   ==\r\n==                  VRAM: 21.31GB            ==\r\n==                                           ==\r\n===============================================\r\n```\r\n2) Merge SAEHD on GPU using interactive merge with 8 workers (based on 8 cores for Ryzen 7 3800). Example settings:\r\n```\r\nMergerConfig 00131.jpg:\r\nMode: overlay\r\nmask_mode: learned-prd*learned-dst\r\nerode_mask_modifier: 18\r\nblur_mask_modifier: 123\r\nmotion_blur_power: 0\r\noutput_face_scale: 0\r\ncolor_transfer_mode: sot-m\r\nsharpen_mode : box\r\nblursharpen_amount : 1\r\nsuper_resolution_power: 1\r\nimage_denoise_power: 6\r\nbicubic_degrade_power: 7\r\ncolor_degrade_power: 6\r\n================\r\nMerging:  13%|########3                                                         | 131/1037 [1:11:45<8:16:18, 32.87s/it]\r\n```\r\nAbove example is for a completed frame. \r\n\r\n## Other relevant information\r\nWindows 10 v10.0.19043 Build 19043\r\nDeepfacelab build 05_21_2021","closed_by":{"login":"Zeesy","id":17345935,"node_id":"MDQ6VXNlcjE3MzQ1OTM1","avatar_url":"https://avatars.githubusercontent.com/u/17345935?v=4","gravatar_id":"","url":"https://api.github.com/users/Zeesy","html_url":"https://github.com/Zeesy","followers_url":"https://api.github.com/users/Zeesy/followers","following_url":"https://api.github.com/users/Zeesy/following{/other_user}","gists_url":"https://api.github.com/users/Zeesy/gists{/gist_id}","starred_url":"https://api.github.com/users/Zeesy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Zeesy/subscriptions","organizations_url":"https://api.github.com/users/Zeesy/orgs","repos_url":"https://api.github.com/users/Zeesy/repos","events_url":"https://api.github.com/users/Zeesy/events{/privacy}","received_events_url":"https://api.github.com/users/Zeesy/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5348/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5348/timeline","performed_via_github_app":null,"state_reason":"completed"}