{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5577","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5577/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5577/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5577/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/5577","id":1429477410,"node_id":"I_kwDOCBuapc5VNBgi","number":5577,"title":"MemoryError on XSeg train","user":{"login":"GettinOver","id":33653479,"node_id":"MDQ6VXNlcjMzNjUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/33653479?v=4","gravatar_id":"","url":"https://api.github.com/users/GettinOver","html_url":"https://github.com/GettinOver","followers_url":"https://api.github.com/users/GettinOver/followers","following_url":"https://api.github.com/users/GettinOver/following{/other_user}","gists_url":"https://api.github.com/users/GettinOver/gists{/gist_id}","starred_url":"https://api.github.com/users/GettinOver/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GettinOver/subscriptions","organizations_url":"https://api.github.com/users/GettinOver/orgs","repos_url":"https://api.github.com/users/GettinOver/repos","events_url":"https://api.github.com/users/GettinOver/events{/privacy}","received_events_url":"https://api.github.com/users/GettinOver/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-10-31T08:45:48Z","updated_at":"2022-11-01T18:06:04Z","closed_at":"2022-11-01T18:06:04Z","author_association":"NONE","active_lock_reason":null,"body":"## Expected behavior\r\nI'm trying to do the XSeg train but it failes no matter how small I set the batch size. I have a Ryzen 5 3600, 3080 Ti and 16GB RAM. It worked just fine when I used my 1070 and the up to 2080 Ti version. I run it on Windows 11.\r\n\r\n## Actual behavior\r\nAfter filtering I get the following error messages:\r\n\r\nUsing 26519 xseg labeled samples.\r\nTraceback (most recent call last):\r\n  File \"multiprocessing\\queues.py\", line 234, in _feed\r\n  File \"multiprocessing\\reduction.py\", line 51, in dumps\r\nMemoryError\r\nError:\r\nTraceback (most recent call last):\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1375, in _do_call\r\nreturn fn(*args)\r\nTraceback (most recent call last):\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1360, in _run_fn\r\n    target_list, run_metadata)\r\n  File \"multiprocessing\\queues.py\", line 234, in _feed\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1453, in _call_tf_sessionrun\r\n    run_metadata)\r\n  File \"multiprocessing\\reduction.py\", line 51, in dumps\r\ntensorflow.python.framework.errors_impl.InternalError: 2 root error(s) found.\r\n  (0) Internal: Attempting to perform BLAS operation using StreamExecutor without BLAS support\r\n         [[{{node MatMul}}]]\r\n         [[concat_6/concat/_3]]\r\n  (1) Internal: Attempting to perform BLAS operation using StreamExecutor without BLAS support\r\n         [[{{node MatMul}}]]\r\n0 successful operations.\r\n0 derived errors ignored.\r\nMemoryError\r\nDuring handling of the above exception, another exception occurred:\r\nTraceback (most recent call last):\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 263, in update_sample_for_preview\r\nself.get_history_previews()\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 383, in get_history_previews\r\nreturn self.onGetPreview (self.sample_for_preview, for_history=True)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\Model_XSeg\\Model.py\", line 209, in onGetPreview\r\n    I, M, IM, = [ np.clip( nn.to_data_format(x,\"NHWC\", self.model_data_format), 0.0, 1.0) for x in ([image_np,mask_np] + self.view (image_np) ) ]\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\Model_XSeg\\Model.py\", line 141, in view\r\nreturn nn.tf_sess.run ( [pred], feed_dict={self.model.input_t :input_np})\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 968, in run\r\n    run_metadata_ptr)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1191, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1369, in _do_run\r\n    run_metadata)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1394, in _do_call\r\nraise type(e)(node_def, op, message)  # pylint: disable=no-value-for-parameter\r\ntensorflow.python.framework.errors_impl.InternalError: 2 root error(s) found.\r\n  (0) Internal: Attempting to perform BLAS operation using StreamExecutor without BLAS support\r\n         [[node MatMul (defined at E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\layers\\Dense.py:66) ]]\r\n         [[concat_6/concat/_3]]\r\n  (1) Internal: Attempting to perform BLAS operation using StreamExecutor without BLAS support\r\n         [[node MatMul (defined at E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\layers\\Dense.py:66) ]]\r\n0 successful operations.\r\n0 derived errors ignored.\r\nErrors may have originated from an input operation.\r\nInput Source operations connected to node MatMul:\r\n XSeg/dense1/weight/read (defined at E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\layers\\Dense.py:47)\r\nReshape_60 (defined at E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py:182)\r\nInput Source operations connected to node MatMul:\r\n XSeg/dense1/weight/read (defined at E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\layers\\Dense.py:47)\r\nReshape_60 (defined at E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py:182)\r\nOriginal stack trace for 'MatMul':\r\n  File \"threading.py\", line 884, in _bootstrap\r\n  File \"threading.py\", line 916, in _bootstrap_inner\r\n  File \"threading.py\", line 864, in run\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 58, in trainerThread\r\ndebug=debug)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\Model_XSeg\\Model.py\", line 17, in __init__\r\nsuper().__init__(*args, force_model_class_name='XSeg', **kwargs)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 193, in __init__\r\nself.on_initialize()\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\Model_XSeg\\Model.py\", line 103, in on_initialize\r\n    gpu_pred_logits_t, gpu_pred_t = self.model.flow(gpu_input_t, pretrain=self.pretrain)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\facelib\\XSegNet.py\", line 85, in flow\r\nreturn self.model(x, pretrain=pretrain)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\models\\ModelBase.py\", line 117, in __call__\r\nreturn self.forward(*args, **kwargs)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\models\\XSeg.py\", line 124, in forward\r\nx = self.dense1(x)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\layers\\LayerBase.py\", line 14, in __call__\r\nreturn self.forward(*args, **kwargs)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\layers\\Dense.py\", line 66, in forward\r\nx = tf.matmul(x, weight)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\dispatch.py\", line 206, in wrapper\r\nreturn target(*args, **kwargs)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 3655, in matmul\r\n    a, b, transpose_a=transpose_a, transpose_b=transpose_b, name=name)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 5713, in mat_mul\r\nname=name)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 750, in _apply_op_helper\r\nattrs=attr_protos, op_def=op_def)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3569, in _create_op_internal\r\nop_def=op_def)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 2045, in __init__\r\nself._traceback = tf_stack.extract_stack_for_node(self._c_op)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\nTraceback (most recent call last):\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 58, in trainerThread\r\n    debug=debug)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\Model_XSeg\\Model.py\", line 17, in __init__\r\nsuper().__init__(*args, force_model_class_name='XSeg', **kwargs)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 216, in __init__\r\nself.update_sample_for_preview(choose_preview_history=self.choose_preview_history)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 265, in update_sample_for_preview\r\nself.sample_for_preview = self.generate_next_samples()\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 461, in generate_next_samples\r\n    sample.append ( generator.generate_next() )\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\samplelib\\SampleGeneratorBase.py\", line 21, in generate_next\r\nself.last_generation = next(self)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\samplelib\\SampleGeneratorFace.py\", line 112, in __next__\r\nreturn next(generator)\r\n  File \"E:\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\joblib\\SubprocessGenerator.py\", line 73, in __next__\r\n    gen_data = self.cs_queue.get()\r\n  File \"multiprocessing\\queues.py\", line 94, in get\r\n  File \"multiprocessing\\connection.py\", line 216, in recv_bytes\r\n  File \"multiprocessing\\connection.py\", line 318, in _recv_bytes\r\n  File \"multiprocessing\\connection.py\", line 344, in _get_more_data\r\nMemoryError","closed_by":{"login":"GettinOver","id":33653479,"node_id":"MDQ6VXNlcjMzNjUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/33653479?v=4","gravatar_id":"","url":"https://api.github.com/users/GettinOver","html_url":"https://github.com/GettinOver","followers_url":"https://api.github.com/users/GettinOver/followers","following_url":"https://api.github.com/users/GettinOver/following{/other_user}","gists_url":"https://api.github.com/users/GettinOver/gists{/gist_id}","starred_url":"https://api.github.com/users/GettinOver/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GettinOver/subscriptions","organizations_url":"https://api.github.com/users/GettinOver/orgs","repos_url":"https://api.github.com/users/GettinOver/repos","events_url":"https://api.github.com/users/GettinOver/events{/privacy}","received_events_url":"https://api.github.com/users/GettinOver/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5577/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5577/timeline","performed_via_github_app":null,"state_reason":"completed"}