{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5235","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5235/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5235/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5235/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/5235","id":780953807,"node_id":"MDU6SXNzdWU3ODA5NTM4MDc=","number":5235,"title":"Issue during running 6) train SAEHD.bat","user":{"login":"gyloh9210","id":10365776,"node_id":"MDQ6VXNlcjEwMzY1Nzc2","avatar_url":"https://avatars.githubusercontent.com/u/10365776?v=4","gravatar_id":"","url":"https://api.github.com/users/gyloh9210","html_url":"https://github.com/gyloh9210","followers_url":"https://api.github.com/users/gyloh9210/followers","following_url":"https://api.github.com/users/gyloh9210/following{/other_user}","gists_url":"https://api.github.com/users/gyloh9210/gists{/gist_id}","starred_url":"https://api.github.com/users/gyloh9210/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gyloh9210/subscriptions","organizations_url":"https://api.github.com/users/gyloh9210/orgs","repos_url":"https://api.github.com/users/gyloh9210/repos","events_url":"https://api.github.com/users/gyloh9210/events{/privacy}","received_events_url":"https://api.github.com/users/gyloh9210/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-01-07T01:16:40Z","updated_at":"2021-01-08T05:42:09Z","closed_at":"2021-01-07T20:32:16Z","author_association":"NONE","active_lock_reason":null,"body":"Hi guys, I have ran into this issue during running 6) train SAEHD.bat. Please help me. Im using DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier btw.\r\n\r\n```\r\n=============== Model Summary ===============\r\n==                                         ==\r\n==            Model name: new_SAEHD        ==\r\n==                                         ==\r\n==     Current iteration: 0                ==\r\n==                                         ==\r\n==------------- Model Options -------------==\r\n==                                         ==\r\n==            resolution: 128              ==\r\n==             face_type: wf               ==\r\n==     models_opt_on_gpu: True             ==\r\n==                 archi: liae-ud          ==\r\n==               ae_dims: 256              ==\r\n==                e_dims: 64               ==\r\n==                d_dims: 64               ==\r\n==           d_mask_dims: 22               ==\r\n==       masked_training: True             ==\r\n==       eyes_mouth_prio: False            ==\r\n==           uniform_yaw: False            ==\r\n==             adabelief: True             ==\r\n==            lr_dropout: n                ==\r\n==           random_warp: True             ==\r\n==       true_face_power: 0.0              ==\r\n==      face_style_power: 0.0              ==\r\n==        bg_style_power: 0.0              ==\r\n==               ct_mode: none             ==\r\n==              clipgrad: False            ==\r\n==              pretrain: False            ==\r\n==       autobackup_hour: 0                ==\r\n== write_preview_history: False            ==\r\n==           target_iter: 0                ==\r\n==           random_flip: True             ==\r\n==            batch_size: 8                ==\r\n==             gan_power: 0.0              ==\r\n==        gan_patch_size: 16               ==\r\n==              gan_dims: 16               ==\r\n==                                         ==\r\n==-------------- Running On ---------------==\r\n==                                         ==\r\n==          Device index: 0                ==\r\n==                  Name: GeForce GTX 1650 ==\r\n==                  VRAM: 4.00GB           ==\r\n==                                         ==\r\n=============================================\r\nStarting. Press \"Enter\" to stop training and save model.\r\n\r\nTrying to do the first iteration. If an error occurs, reduce the model parameters.\r\n\r\n!!!\r\nWindows 10 users IMPORTANT notice. You should set this setting in order to work correctly.\r\nhttps://i.imgur.com/B7cmDCB.jpg\r\n!!!\r\nYou are training the model from scratch. It is strongly recommended to use a pretrained model to speed up the training and improve the quality.\r\n\r\nError: OOM when allocating tensor with shape[8,128,64,64] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n         [[node LeakyRelu_18 (defined at C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py:69) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n         [[node concat_40 (defined at C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py:517) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n\r\nCaused by op 'LeakyRelu_18', defined at:\r\n  File \"threading.py\", line 884, in _bootstrap\r\n  File \"threading.py\", line 916, in _bootstrap_inner\r\n  File \"threading.py\", line 864, in run\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 58, in trainerThread\r\n    debug=debug,\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 189, in __init__\r\n    self.on_initialize()\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 381, in on_initialize\r\n    gpu_pred_src_src, gpu_pred_src_srcm = self.decoder(gpu_src_code)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\core\\leras\\models\\ModelBase.py\", line 117, in __call__\r\n    return self.forward(*args, **kwargs)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py\", line 158, in forward\r\n    x = self.res2(x)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\core\\leras\\models\\ModelBase.py\", line 117, in __call__\r\n    return self.forward(*args, **kwargs)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py\", line 69, in forward\r\n    x = tf.nn.leaky_relu(x, 0.2)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\nn_ops.py\", line 2086, in leaky_relu\r\n    return gen_nn_ops.leaky_relu(features, alpha=alpha, name=name)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_nn_ops.py\", line 4910, in leaky_relu\r\n    \"LeakyRelu\", features=features, alpha=alpha, name=name)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 788, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3300, in create_op\r\n    op_def=op_def)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1801, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\nResourceExhaustedError (see above for traceback): OOM when allocating tensor with shape[8,128,64,64] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n         [[node LeakyRelu_18 (defined at C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py:69) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n         [[node concat_40 (defined at C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py:517) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1334, in _do_call\r\n    return fn(*args)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1319, in _run_fn\r\n    options, feed_dict, fetch_list, target_list, run_metadata)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1407, in _call_tf_sessionrun\r\n    run_metadata)\r\ntensorflow.python.framework.errors_impl.ResourceExhaustedError: OOM when allocating tensor with shape[8,128,64,64] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n         [[{{node LeakyRelu_18}}]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n         [[{{node concat_40}}]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 130, in trainerThread\r\n    iter, iter_time = model.train_one_iter()\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 462, in train_one_iter\r\n    losses = self.onTrainOneIter()\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 678, in onTrainOneIter\r\n    src_loss, dst_loss = self.src_dst_train (warped_src, target_src, target_srcm, target_srcm_em, warped_dst, target_dst, target_dstm, target_dstm_em)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 538, in src_dst_train\r\n    self.target_dstm_em:target_dstm_em,\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 929, in run\r\n    run_metadata_ptr)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1152, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1328, in _do_run\r\n    run_metadata)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1348, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.ResourceExhaustedError: OOM when allocating tensor with shape[8,128,64,64] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n         [[node LeakyRelu_18 (defined at C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py:69) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n         [[node concat_40 (defined at C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py:517) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n\r\nCaused by op 'LeakyRelu_18', defined at:\r\n  File \"threading.py\", line 884, in _bootstrap\r\n  File \"threading.py\", line 916, in _bootstrap_inner\r\n  File \"threading.py\", line 864, in run\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 58, in trainerThread\r\n    debug=debug,\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 189, in __init__\r\n    self.on_initialize()\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 381, in on_initialize\r\n    gpu_pred_src_src, gpu_pred_src_srcm = self.decoder(gpu_src_code)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\core\\leras\\models\\ModelBase.py\", line 117, in __call__\r\n    return self.forward(*args, **kwargs)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py\", line 158, in forward\r\n    x = self.res2(x)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\core\\leras\\models\\ModelBase.py\", line 117, in __call__\r\n    return self.forward(*args, **kwargs)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py\", line 69, in forward\r\n    x = tf.nn.leaky_relu(x, 0.2)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\nn_ops.py\", line 2086, in leaky_relu\r\n    return gen_nn_ops.leaky_relu(features, alpha=alpha, name=name)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_nn_ops.py\", line 4910, in leaky_relu\r\n    \"LeakyRelu\", features=features, alpha=alpha, name=name)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 788, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3300, in create_op\r\n    op_def=op_def)\r\n  File \"C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1801, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\nResourceExhaustedError (see above for traceback): OOM when allocating tensor with shape[8,128,64,64] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n         [[node LeakyRelu_18 (defined at C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py:69) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n         [[node concat_40 (defined at C:\\DeepFaceLab\\DeepFaceLab_NVIDIA_RTX2080Ti_and_earlier\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py:517) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n```","closed_by":{"login":"iperov","id":8076202,"node_id":"MDQ6VXNlcjgwNzYyMDI=","avatar_url":"https://avatars.githubusercontent.com/u/8076202?v=4","gravatar_id":"","url":"https://api.github.com/users/iperov","html_url":"https://github.com/iperov","followers_url":"https://api.github.com/users/iperov/followers","following_url":"https://api.github.com/users/iperov/following{/other_user}","gists_url":"https://api.github.com/users/iperov/gists{/gist_id}","starred_url":"https://api.github.com/users/iperov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iperov/subscriptions","organizations_url":"https://api.github.com/users/iperov/orgs","repos_url":"https://api.github.com/users/iperov/repos","events_url":"https://api.github.com/users/iperov/events{/privacy}","received_events_url":"https://api.github.com/users/iperov/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5235/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5235/timeline","performed_via_github_app":null,"state_reason":"completed"}