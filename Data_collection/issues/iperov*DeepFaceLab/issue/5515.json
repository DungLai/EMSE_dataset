{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5515","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5515/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5515/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5515/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/5515","id":1230150558,"node_id":"I_kwDOCBuapc5JUpue","number":5515,"title":"device_lib.list_local_devices() doesn't return in the CUDA build up to 2080","user":{"login":"Twenkid","id":23367640,"node_id":"MDQ6VXNlcjIzMzY3NjQw","avatar_url":"https://avatars.githubusercontent.com/u/23367640?v=4","gravatar_id":"","url":"https://api.github.com/users/Twenkid","html_url":"https://github.com/Twenkid","followers_url":"https://api.github.com/users/Twenkid/followers","following_url":"https://api.github.com/users/Twenkid/following{/other_user}","gists_url":"https://api.github.com/users/Twenkid/gists{/gist_id}","starred_url":"https://api.github.com/users/Twenkid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Twenkid/subscriptions","organizations_url":"https://api.github.com/users/Twenkid/orgs","repos_url":"https://api.github.com/users/Twenkid/repos","events_url":"https://api.github.com/users/Twenkid/events{/privacy}","received_events_url":"https://api.github.com/users/Twenkid/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-05-09T19:24:31Z","updated_at":"2022-05-10T13:48:52Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Any batch script hangs, I traced it and it freezes in tensorflow when it calls **device_lib.list_local_devices()**\r\nIn: C:\\DFL\\DeepFaceLab_NVIDIA_up_to_RTX2080Ti\\_internal\\DeepFaceLab\\core\\leras\\device.py\r\nGPU: Geforce 750 Ti\r\nWin 10\r\n\r\n```\r\nimport tensorflow as tf\r\nfrom tensorflow.python.client import device_lib\r\nprint(f\"list_local_devices()={device_lib.list_local_devices()}\")\r\n```\r\n\r\nI tried several things: if there was an incompatibility with the installed newer CUDA, but it shouldn't as the build has its own directory and it's an old tensorflow 1.13. The paths are set by setenv.bat,, but in addition I added them in the system's Path, also I tried with copying the .dll files both in the .bat folder and in the main.py.\r\n\r\n\r\nI've been using the DirectX12 version as an alternative. The GPU is 750 Ti and initially I thought that it was just too old, but I just discovered it's supposed to work as it supports newer CUDA versions. Also there's not an error message, but the call to \"list_local_devices\" doesn't return.\r\n\r\nIf I run setenv.bat and then I call the build's python, then import the tf. and call list_local_devices interactively, the function recognizes the GPU and prints a correct output, but then the CLI session hangs. The system has also an integrated Intel GPU HD530. \r\n\r\nI understand that this seems to be a tensorflow or drivers' issue, but does anyone have solved it? Thanks.\r\n\r\n\r\n```\r\nc:\\DFL\\DeepFaceLab_NVIDIA_up_to_RTX2080Ti\\_internal\\python-3.6.8>python\r\nPython 3.6.8 (tags/v3.6.8:3c6b436a57, Dec 24 2018, 00:16:47) [MSC v.1916 64 bit (AMD64)] on win32\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import tensorflow as tf\r\nc:\\DFL\\DeepFaceLab_NVIDIA_up_to_RTX2080Ti\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\dtypes.py:526: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint8 = np.dtype([(\"qint8\", np.int8, 1)])\r\nc:\\DFL\\DeepFaceLab_NVIDIA_up_to_RTX2080Ti\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\dtypes.py:527: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint8 = np.dtype([(\"quint8\", np.uint8, 1)])\r\nc:\\DFL\\DeepFaceLab_NVIDIA_up_to_RTX2080Ti\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\dtypes.py:528: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint16 = np.dtype([(\"qint16\", np.int16, 1)])\r\nc:\\DFL\\DeepFaceLab_NVIDIA_up_to_RTX2080Ti\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\dtypes.py:529: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint16 = np.dtype([(\"quint16\", np.uint16, 1)])\r\nc:\\DFL\\DeepFaceLab_NVIDIA_up_to_RTX2080Ti\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\dtypes.py:530: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint32 = np.dtype([(\"qint32\", np.int32, 1)])\r\nc:\\DFL\\DeepFaceLab_NVIDIA_up_to_RTX2080Ti\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\dtypes.py:535: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  np_resource = np.dtype([(\"resource\", np.ubyte, 1)])\r\n>>>\r\n>>> from tensorflow.python.client import device_lib\r\n>>> print(f\"list_local_devices()={device_lib.list_local_devices()}\")\r\n2022-05-09 22:11:18.429936: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX AVX2\r\n2022-05-09 22:11:18.551876: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1433] Found device 0 with properties:\r\nname: GeForce GTX 750 Ti major: 5 minor: 0 memoryClockRate(GHz): 1.0845\r\npciBusID: 0000:01:00.0\r\ntotalMemory: 2.00GiB freeMemory: 194.50MiB\r\n2022-05-09 22:11:18.552651: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1512] Adding visible gpu devices: 0\r\n```\r\n\r\n````\r\n  @staticmethod\r\n    def _get_tf_devices_proc(q : multiprocessing.Queue):\r\n        print(\"_get_tf_devices_proc\")\r\n        print(sys.platform[0:3])\r\n        if sys.platform[0:3] == 'win':\r\n            compute_cache_path = Path(os.environ['APPDATA']) / 'NVIDIA' / ('ComputeCache_ALL')\r\n            os.environ['CUDA_CACHE_PATH'] = str(compute_cache_path)\r\n            print(\"CUDA_CACHE_PATH={os.environ['CUDA_CACHE_PATH']}\")\r\n            \r\n            if not compute_cache_path.exists():\r\n                io.log_info(\"Caching GPU kernels...\")\r\n                compute_cache_path.mkdir(parents=True, exist_ok=True)\r\n                \r\n        import tensorflow\r\n        \r\n        tf_version = tensorflow.version.VERSION\r\n        print(f\"tf_version={tf_version}\")\r\n        #if tf_version is None:\r\n        #    tf_version = tensorflow.version.GIT_VERSION\r\n        if tf_version[0] == 'v':\r\n            tf_version = tf_version[1:]\r\n        if tf_version[0] == '2':\r\n            tf = tensorflow.compat.v1\r\n        else:\r\n            tf = tensorflow\r\n                    \r\n        import logging\r\n        # Disable tensorflow warnings\r\n        tf_logger = logging.getLogger('tensorflow')\r\n        tf_logger.setLevel(logging.ERROR)\r\n\r\n        from tensorflow.python.client import device_lib\r\n        print(\"AFTER: from tensorflow.python.client import device_lib\")\r\n        devices = []\r\n\r\n        print(f\"list_local_devices()={device_lib.list_local_devices()}\")  ### HANGS HERE ###\r\n        \r\n        physical_devices = device_lib.list_local_devices()\r\n        physical_devices_f = {}\r\n        print(\"BEFORE: for dev in physical_devices:\")\r\n```\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5515/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5515/timeline","performed_via_github_app":null,"state_reason":null}