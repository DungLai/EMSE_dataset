{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/749","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/749/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/749/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/749/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/749","id":619358497,"node_id":"MDU6SXNzdWU2MTkzNTg0OTc=","number":749,"title":"How to make background stable?","user":{"login":"burning846","id":25949019,"node_id":"MDQ6VXNlcjI1OTQ5MDE5","avatar_url":"https://avatars.githubusercontent.com/u/25949019?v=4","gravatar_id":"","url":"https://api.github.com/users/burning846","html_url":"https://github.com/burning846","followers_url":"https://api.github.com/users/burning846/followers","following_url":"https://api.github.com/users/burning846/following{/other_user}","gists_url":"https://api.github.com/users/burning846/gists{/gist_id}","starred_url":"https://api.github.com/users/burning846/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/burning846/subscriptions","organizations_url":"https://api.github.com/users/burning846/orgs","repos_url":"https://api.github.com/users/burning846/repos","events_url":"https://api.github.com/users/burning846/events{/privacy}","received_events_url":"https://api.github.com/users/burning846/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-05-16T02:28:15Z","updated_at":"2020-05-25T04:59:44Z","closed_at":"2020-05-25T04:59:44Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, when I was trying to reimplement DFL by tensorflow 2.0, I found that the images my decoders generated had a bad background which didn't happened when I run the code in your repo. However, when I reviewed your code, **it seemed that you didn't training the background(hair or something) as well when you set `mask_training = True` and `bg_style_power=False`**, because I thought your code here ignored the background of the reconstruction image by multiplying the image and the mask:\r\n```\r\ngpu_target_src_masked_opt  = gpu_target_src*gpu_target_srcm_blur if masked_training else gpu_target_src\r\ngpu_target_dst_masked_opt  = gpu_target_dst_masked if masked_training else gpu_target_dst\r\n\r\ngpu_pred_src_src_masked_opt = gpu_pred_src_src*gpu_target_srcm_blur if masked_training else gpu_pred_src_src\r\ngpu_pred_dst_dst_masked_opt = gpu_pred_dst_dst*gpu_target_dstm_blur if masked_training else gpu_pred_dst_dst\r\n```\r\nso I wonder how you make the background stable even if your didn't train the background, or did I miss something important?\r\n\r\n\r\n\r\nHere is my settings\r\n```\r\n============ Model Summary ============\r\n==                                   ==\r\n==            Model name: test_SAEHD ==\r\n==                                   ==\r\n==     Current iteration: 60620      ==\r\n==                                   ==\r\n==---------- Model Options ----------==\r\n==                                   ==\r\n==            resolution: 256        ==\r\n==             face_type: f          ==\r\n==     models_opt_on_gpu: True       ==\r\n==                 archi: dfhd       ==\r\n==               ae_dims: 256        ==\r\n==                e_dims: 64         ==\r\n==                d_dims: 48         ==\r\n==           d_mask_dims: 16         ==\r\n==       masked_training: True       ==\r\n==            learn_mask: True       ==\r\n==             eyes_prio: True       ==\r\n==            lr_dropout: False      ==\r\n==           random_warp: True       ==\r\n==             gan_power: 1.0        ==\r\n==       true_face_power: 0.01       ==\r\n==      face_style_power: 0.0        ==\r\n==        bg_style_power: 0.0        ==\r\n==               ct_mode: none       ==\r\n==              clipgrad: True       ==\r\n==              pretrain: False      ==\r\n==       autobackup_hour: 0          ==\r\n== write_preview_history: True       ==\r\n==           target_iter: 0          ==\r\n==           random_flip: True       ==\r\n==            batch_size: 1          ==\r\n==                                   ==\r\n==----------- Running On ------------==\r\n==                                   ==\r\n==          Device index: 0          ==\r\n==                  Name: TITAN RTX  ==\r\n==                  VRAM: 23.65GB    ==\r\n==                                   ==\r\n=======================================\r\n\r\n```\r\n\r\nThis is my output (eyes masked for privacy issue）:\r\n<img width=\"255\" alt=\"WechatIMG53副本\" src=\"https://user-images.githubusercontent.com/25949019/82108064-a178f400-975e-11ea-8166-7e64d70fdf89.png\">\r\nThis is the expected output from this repo:\r\n<img width=\"168\" alt=\"WechatIMG54副本\" src=\"https://user-images.githubusercontent.com/25949019/82108067-a3db4e00-975e-11ea-8611-3fada06b0ae1.png\">\r\n\r\n\r\n## reimplement environment\r\n- Ubuntu 16.04.5 LTS\r\n- TITAN RTX\r\n- tensorflow 2.1.0","closed_by":{"login":"burning846","id":25949019,"node_id":"MDQ6VXNlcjI1OTQ5MDE5","avatar_url":"https://avatars.githubusercontent.com/u/25949019?v=4","gravatar_id":"","url":"https://api.github.com/users/burning846","html_url":"https://github.com/burning846","followers_url":"https://api.github.com/users/burning846/followers","following_url":"https://api.github.com/users/burning846/following{/other_user}","gists_url":"https://api.github.com/users/burning846/gists{/gist_id}","starred_url":"https://api.github.com/users/burning846/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/burning846/subscriptions","organizations_url":"https://api.github.com/users/burning846/orgs","repos_url":"https://api.github.com/users/burning846/repos","events_url":"https://api.github.com/users/burning846/events{/privacy}","received_events_url":"https://api.github.com/users/burning846/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/749/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/749/timeline","performed_via_github_app":null,"state_reason":"completed"}