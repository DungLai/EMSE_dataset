{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5418","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5418/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5418/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5418/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/5418","id":1033998075,"node_id":"I_kwDOCBuapc49oY77","number":5418,"title":"\"MemoryError\" on saving model - not OOM?","user":{"login":"Virtike","id":4611822,"node_id":"MDQ6VXNlcjQ2MTE4MjI=","avatar_url":"https://avatars.githubusercontent.com/u/4611822?v=4","gravatar_id":"","url":"https://api.github.com/users/Virtike","html_url":"https://github.com/Virtike","followers_url":"https://api.github.com/users/Virtike/followers","following_url":"https://api.github.com/users/Virtike/following{/other_user}","gists_url":"https://api.github.com/users/Virtike/gists{/gist_id}","starred_url":"https://api.github.com/users/Virtike/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Virtike/subscriptions","organizations_url":"https://api.github.com/users/Virtike/orgs","repos_url":"https://api.github.com/users/Virtike/repos","events_url":"https://api.github.com/users/Virtike/events{/privacy}","received_events_url":"https://api.github.com/users/Virtike/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-10-22T22:55:57Z","updated_at":"2021-10-30T02:22:22Z","closed_at":"2021-10-30T02:22:22Z","author_association":"NONE","active_lock_reason":null,"body":"## Behavior\r\n\r\nStarting with any pretrained model, training initiates without issue & processes as expected. As soon as the model attempts to save, DFL crashes with \"MemoryError\" - though this does not appear to be OOM?\r\n\r\nStarting with a new model lets the model train & save for a slightly longer period of time, however the same \"MemoryError\" will still occur some time after starting training, usually within 30mins.\r\n\r\n## Hardware / Setup\r\nDeepFaceLab_NVIDIA_RTX3000_series_build_10_11_2021 (DFL stored on SATA-attached 2TB SSD)\r\nRTX 3090 - 24GB VRAM, driver 496.13\r\n32GB RAM (32GB pagefile on NVMe 960 EVO SSD)\r\nIntel i7 8700k\r\nWindows 10 21H1\r\n\r\n## Console Output\r\n\r\n```\r\nRunning trainer.\r\n\r\nChoose one of saved models, or enter a name to create a new model.\r\n[r] : rename\r\n[d] : delete\r\n\r\n[0] : DF-UD384 - latest\r\n :\r\n0\r\nLoading DF-UD384_SAEHD model...\r\n\r\nChoose one or several GPU idxs (separated by comma).\r\n\r\n[CPU] : CPU\r\n  [0] : NVIDIA GeForce RTX 3090\r\n\r\n[0] Which GPU indexes to choose? :\r\n0\r\n\r\nInitializing models: 100%|###############################################################| 5/5 [00:04<00:00,  1.03it/s]\r\nLoading samples: 100%|############################################################| 2034/2034 [00:06<00:00, 324.27it/s]\r\nLoading samples: 100%|##############################################################| 898/898 [00:02<00:00, 404.25it/s]\r\n================== Model Summary ===================\r\n==                                                ==\r\n==            Model name: DF-UD384_SAEHD          ==\r\n==                                                ==\r\n==     Current iteration: 1255930                 ==\r\n==                                                ==\r\n==---------------- Model Options -----------------==\r\n==                                                ==\r\n==            resolution: 384                     ==\r\n==             face_type: f                       ==\r\n==     models_opt_on_gpu: True                    ==\r\n==                 archi: df-ud                   ==\r\n==               ae_dims: 352                     ==\r\n==                e_dims: 88                      ==\r\n==                d_dims: 88                      ==\r\n==           d_mask_dims: 16                      ==\r\n==       masked_training: True                    ==\r\n==       eyes_mouth_prio: True                    ==\r\n==           uniform_yaw: False                   ==\r\n==             adabelief: True                    ==\r\n==            lr_dropout: y                       ==\r\n==           random_warp: False                   ==\r\n==       true_face_power: 0.0                     ==\r\n==      face_style_power: 0.0                     ==\r\n==        bg_style_power: 0.0                     ==\r\n==               ct_mode: none                    ==\r\n==              clipgrad: False                   ==\r\n==              pretrain: False                   ==\r\n==       autobackup_hour: 0                       ==\r\n== write_preview_history: False                   ==\r\n==           target_iter: 0                       ==\r\n==       random_src_flip: False                   ==\r\n==       random_dst_flip: False                   ==\r\n==            batch_size: 6                       ==\r\n==             gan_power: 0.0                     ==\r\n==        gan_patch_size: 48                      ==\r\n==              gan_dims: 16                      ==\r\n==         blur_out_mask: False                   ==\r\n==                                                ==\r\n==------------------ Running On ------------------==\r\n==                                                ==\r\n==          Device index: 0                       ==\r\n==                  Name: NVIDIA GeForce RTX 3090 ==\r\n==                  VRAM: 21.17GB                 ==\r\n==                                                ==\r\n====================================================\r\nStarting. Press \"Enter\" to stop training and save model.\r\nError:\r\nTraceback (most recent call last):\r\n  File \"O:\\DFL\\DFL_RTX3000_series\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 173, in trainerThread\r\n    model_save()\r\n  File \"O:\\DFL\\DFL_RTX3000_series\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 68, in model_save\r\n    model.save()\r\n  File \"O:\\DFL\\DFL_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 393, in save\r\n    self.onSave()\r\n  File \"O:\\DFL\\DFL_RTX3000_series\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 753, in onSave\r\n    model.save_weights ( self.get_strpath_storage_for_file(filename) )\r\n  File \"O:\\DFL\\DFL_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\layers\\Saveable.py\", line 61, in save_weights\r\n    d_dumped = pickle.dumps (d, 4)\r\nMemoryError\r\nDone.\r\nPress any key to continue . . .\r\n```","closed_by":{"login":"Virtike","id":4611822,"node_id":"MDQ6VXNlcjQ2MTE4MjI=","avatar_url":"https://avatars.githubusercontent.com/u/4611822?v=4","gravatar_id":"","url":"https://api.github.com/users/Virtike","html_url":"https://github.com/Virtike","followers_url":"https://api.github.com/users/Virtike/followers","following_url":"https://api.github.com/users/Virtike/following{/other_user}","gists_url":"https://api.github.com/users/Virtike/gists{/gist_id}","starred_url":"https://api.github.com/users/Virtike/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Virtike/subscriptions","organizations_url":"https://api.github.com/users/Virtike/orgs","repos_url":"https://api.github.com/users/Virtike/repos","events_url":"https://api.github.com/users/Virtike/events{/privacy}","received_events_url":"https://api.github.com/users/Virtike/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5418/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5418/timeline","performed_via_github_app":null,"state_reason":"completed"}