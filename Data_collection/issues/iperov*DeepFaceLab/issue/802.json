{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/802","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/802/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/802/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/802/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/802","id":646742479,"node_id":"MDU6SXNzdWU2NDY3NDI0Nzk=","number":802,"title":"Error During SAEHD Training","user":{"login":"Ingsten","id":67519742,"node_id":"MDQ6VXNlcjY3NTE5NzQy","avatar_url":"https://avatars.githubusercontent.com/u/67519742?v=4","gravatar_id":"","url":"https://api.github.com/users/Ingsten","html_url":"https://github.com/Ingsten","followers_url":"https://api.github.com/users/Ingsten/followers","following_url":"https://api.github.com/users/Ingsten/following{/other_user}","gists_url":"https://api.github.com/users/Ingsten/gists{/gist_id}","starred_url":"https://api.github.com/users/Ingsten/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ingsten/subscriptions","organizations_url":"https://api.github.com/users/Ingsten/orgs","repos_url":"https://api.github.com/users/Ingsten/repos","events_url":"https://api.github.com/users/Ingsten/events{/privacy}","received_events_url":"https://api.github.com/users/Ingsten/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2020-06-27T19:15:17Z","updated_at":"2020-07-01T12:19:22Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Hi there , i'm new with deepfacelab , and i got a problem everytime i try to train i got a lot of text error . What can it be?\r\n\r\n>Error: OOM when allocating tensor with shape[8,128,130,130] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n> \r\n>[[node gradients/Conv2D_23_grad/Conv2DBackpropInput (defined at E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py:55) ]]\r\n> Hint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n> \r\n> \r\n> Caused by op 'gradients/Conv2D_23_grad/Conv2DBackpropInput', defined at:\r\n>   File \"threading.py\", line 884, in _bootstrap\r\n>   File \"threading.py\", line 916, in _bootstrap_inner\r\n>   File \"threading.py\", line 864, in run\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 57, in trainerThread\r\n>     debug=debug,\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 188, in __init__\r\n>     self.on_initialize()\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 456, in on_initialize\r\n>     gpu_G_loss_gvs += [ nn.gradients ( gpu_G_loss, self.src_dst_trainable_weights ) ]\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py\", line 55, in tf_gradients\r\n>     grads = gradients.gradients(loss, vars, colocate_gradients_with_ops=True )\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 664, in gradients\r\n>     unconnected_gradients)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 965, in _GradientsHelper\r\n>     lambda: grad_fn(op, *out_grads))\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 420, in _MaybeCompile\r\n>     return grad_fn()  # Exit early\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 965, in <lambda>\r\n>     lambda: grad_fn(op, *out_grads))\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\nn_grad.py\", line 532, in _Conv2DGrad\r\n>     data_format=data_format),\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_nn_ops.py\", line 1307, in conv2d_backprop_input\r\n>     name=name)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 788, in _apply_op_helper\r\n>     op_def=op_def)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py\", line 507, in new_func\r\n>     return func(*args, **kwargs)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3300, in create_op\r\n>     op_def=op_def)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1801, in __init__\r\n>     self._traceback = tf_stack.extract_stack()\r\n> \r\n> ...which was originally created as op 'Conv2D_23', defined at:\r\n>   File \"threading.py\", line 884, in _bootstrap\r\n> [elided 3 identical lines from previous traceback]\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 188, in __init__\r\n>     self.on_initialize()\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 330, in on_initialize\r\n>     gpu_pred_src_src, gpu_pred_src_srcm = self.decoder_src(gpu_src_code)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\models\\ModelBase.py\", line 113, in __call__\r\n>     return self.forward(*args, **kwargs)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py\", line 148, in forward\r\n>     x = self.res2(x)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\models\\ModelBase.py\", line 113, in __call__\r\n>     return self.forward(*args, **kwargs)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py\", line 70, in forward\r\n>     x = self.conv2(x)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\layers\\LayerBase.py\", line 14, in __call__\r\n>     return self.forward(*args, **kwargs)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\layers\\Conv2D.py\", line 99, in forward\r\n>     x = tf.nn.conv2d(x, weight, self.strides, 'VALID', dilations=self.dilations, data_format=nn.data_format)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_nn_ops.py\", line 1026, in conv2d\r\n>     data_format=data_format, dilations=dilations, name=name)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 788, in _apply_op_helper\r\n>     op_def=op_def)\r\n> \r\n> ResourceExhaustedError (see above for traceback): OOM when allocating tensor with shape[8,128,130,130] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n>          [[node gradients/Conv2D_23_grad/Conv2DBackpropInput (defined at E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py:55) ]]\r\n> Hint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n> \r\n> \r\n> Traceback (most recent call last):\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1334, in _do_call\r\n>     return fn(*args)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1319, in _run_fn\r\n>     options, feed_dict, fetch_list, target_list, run_metadata)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1407, in _call_tf_sessionrun\r\n>     run_metadata)\r\n> tensorflow.python.framework.errors_impl.ResourceExhaustedError: OOM when allocating tensor with shape[8,128,130,130] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n>          [[{{node gradients/Conv2D_23_grad/Conv2DBackpropInput}}]]\r\n> Hint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n> \r\n> \r\n> During handling of the above exception, another exception occurred:\r\n> \r\n> Traceback (most recent call last):\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 123, in trainerThread\r\n>     iter, iter_time = model.train_one_iter()\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 453, in train_one_iter\r\n>     losses = self.onTrainOneIter()\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 617, in onTrainOneIter\r\n>     src_loss, dst_loss = self.src_dst_train (warped_src, target_src, target_srcm_all, warped_dst, target_dst, target_dstm_all)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 488, in src_dst_train\r\n>     self.target_dstm_all:target_dstm_all,\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 929, in run\r\n>     run_metadata_ptr)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1152, in _run\r\n>     feed_dict_tensor, options, run_metadata)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1328, in _do_run\r\n>     run_metadata)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1348, in _do_call\r\n>     raise type(e)(node_def, op, message)\r\n> tensorflow.python.framework.errors_impl.ResourceExhaustedError: OOM when allocating tensor with shape[8,128,130,130] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n>          [[node gradients/Conv2D_23_grad/Conv2DBackpropInput (defined at E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py:55) ]]\r\n> Hint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n> \r\n> \r\n> Caused by op 'gradients/Conv2D_23_grad/Conv2DBackpropInput', defined at:\r\n>   File \"threading.py\", line 884, in _bootstrap\r\n>   File \"threading.py\", line 916, in _bootstrap_inner\r\n>   File \"threading.py\", line 864, in run\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 57, in trainerThread\r\n>     debug=debug,\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 188, in __init__\r\n>     self.on_initialize()\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 456, in on_initialize\r\n>     gpu_G_loss_gvs += [ nn.gradients ( gpu_G_loss, self.src_dst_trainable_weights ) ]\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py\", line 55, in tf_gradients\r\n>     grads = gradients.gradients(loss, vars, colocate_gradients_with_ops=True )\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 664, in gradients\r\n>     unconnected_gradients)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 965, in _GradientsHelper\r\n>     lambda: grad_fn(op, *out_grads))\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 420, in _MaybeCompile\r\n>     return grad_fn()  # Exit early\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 965, in <lambda>\r\n>     lambda: grad_fn(op, *out_grads))\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\nn_grad.py\", line 532, in _Conv2DGrad\r\n>     data_format=data_format),\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_nn_ops.py\", line 1307, in conv2d_backprop_input\r\n>     name=name)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 788, in _apply_op_helper\r\n>     op_def=op_def)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py\", line 507, in new_func\r\n>     return func(*args, **kwargs)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3300, in create_op\r\n>     op_def=op_def)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1801, in __init__\r\n>     self._traceback = tf_stack.extract_stack()\r\n> \r\n> ...which was originally created as op 'Conv2D_23', defined at:\r\n>   File \"threading.py\", line 884, in _bootstrap\r\n> [elided 3 identical lines from previous traceback]\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 188, in __init__\r\n>     self.on_initialize()\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 330, in on_initialize\r\n>     gpu_pred_src_src, gpu_pred_src_srcm = self.decoder_src(gpu_src_code)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\models\\ModelBase.py\", line 113, in __call__\r\n>     return self.forward(*args, **kwargs)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py\", line 148, in forward\r\n>     x = self.res2(x)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\models\\ModelBase.py\", line 113, in __call__\r\n>     return self.forward(*args, **kwargs)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py\", line 70, in forward\r\n>     x = self.conv2(x)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\layers\\LayerBase.py\", line 14, in __call__\r\n>     return self.forward(*args, **kwargs)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\layers\\Conv2D.py\", line 99, in forward\r\n>     x = tf.nn.conv2d(x, weight, self.strides, 'VALID', dilations=self.dilations, data_format=nn.data_format)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_nn_ops.py\", line 1026, in conv2d\r\n>     data_format=data_format, dilations=dilations, name=name)\r\n>   File \"E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 788, in _apply_op_helper\r\n>     op_def=op_def)\r\n> \r\n> ResourceExhaustedError (see above for traceback): OOM when allocating tensor with shape[8,128,130,130] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n>          [[node gradients/Conv2D_23_grad/Conv2DBackpropInput (defined at E:\\Downloads\\DeepFaceLab\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py:55) ]]\r\n> Hint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/802/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/802/timeline","performed_via_github_app":null,"state_reason":null}