{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/227","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/227/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/227/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/227/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/227","id":431254074,"node_id":"MDU6SXNzdWU0MzEyNTQwNzQ=","number":227,"title":"Keep getting error when I train: Error: OOM when allocating tensor with shape","user":{"login":"yg2dras1","id":37668306,"node_id":"MDQ6VXNlcjM3NjY4MzA2","avatar_url":"https://avatars.githubusercontent.com/u/37668306?v=4","gravatar_id":"","url":"https://api.github.com/users/yg2dras1","html_url":"https://github.com/yg2dras1","followers_url":"https://api.github.com/users/yg2dras1/followers","following_url":"https://api.github.com/users/yg2dras1/following{/other_user}","gists_url":"https://api.github.com/users/yg2dras1/gists{/gist_id}","starred_url":"https://api.github.com/users/yg2dras1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yg2dras1/subscriptions","organizations_url":"https://api.github.com/users/yg2dras1/orgs","repos_url":"https://api.github.com/users/yg2dras1/repos","events_url":"https://api.github.com/users/yg2dras1/events{/privacy}","received_events_url":"https://api.github.com/users/yg2dras1/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-04-10T00:41:14Z","updated_at":"2019-11-22T14:17:24Z","closed_at":"2019-04-10T04:46:16Z","author_association":"NONE","active_lock_reason":"resolved","body":"**### Hi guys, first time to try DFL here. I was trying out the default src and dst (robert downey jr on shia lebouf's head), and tried both train H64 and train H128 but keep getting this error right at the start.\r\n\r\nI am using GTX 1050ti 6gb\r\nI installed DeepFaceLabCUDA9.2SSE\r\n\r\nI used the following steps:\r\n\r\n2) extract images from video data_src\r\n2) extract images from video data_src\r\n3.2) extract images from video data_dst FULL FPS\r\n5) data_dst extract faces MT all GPU \r\n6) train H164\r\n\r\nHERE IS THE ERROR:\r\n\r\n\r\nModel first run. Enter model options as default for each run.\r\nWrite preview history? (y/n ?:help skip:n) : y\r\nTarget iteration (skip:unlimited/default) : default\r\n0\r\nBatch_size (?:help skip:0) : 64\r\nFeed faces to network sorted by yaw? (y/n ?:help skip:n) : y\r\nFlip faces randomly? (y/n ?:help skip:y) : n\r\nSrc face scale modifier % ( -30...30, ?:help skip:0) : 0\r\nUse lightweight autoencoder? (y/n, ?:help skip:n) : n\r\nUse pixel loss? (y/n, ?:help skip: n/default ) : n\r\nUsing TensorFlow backend.\r\nLoading: 100%|######################################################################| 137/137 [00:00<00:00, 630.03it/s]\r\nSorting: 100%|######################################################################| 64/64 [00:00<00:00, 21299.33it/s]\r\nLoading: 100%|####################################################################| 1434/1434 [00:02<00:00, 705.14it/s]\r\nSorting: 100%|#######################################################################| 64/64 [00:00<00:00, 2376.82it/s]\r\n===== Model summary =====\r\n== Model name: H64\r\n==\r\n== Current iteration: 0\r\n==\r\n== Model options:\r\n== |== write_preview_history : True\r\n== |== batch_size : 64\r\n== |== sort_by_yaw : True\r\n== |== random_flip : False\r\n== |== lighter_ae : False\r\n== |== pixel_loss : False\r\n== Running on:\r\n== |== [0 : GeForce GTX 1050 Ti]\r\n=========================\r\nStarting. Press \"Enter\" to stop training and save model.\r\nError: OOM when allocating tensor with shape[64,1024,16,16] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n         [[{{node model_2/conv2d_7/convolution}} = Conv2D[T=DT_FLOAT, _class=[\"loc:@train...kpropInput\"], data_format=\"NCHW\", dilations=[1, 1, 1, 1], padding=\"SAME\", strides=[1, 1, 1, 1], use_cudnn_on_gpu=true, _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"](model_2/pixel_shuffler_2/NHWC, conv2d_7/kernel/read)]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n         [[{{node loss/model_2_loss_1/Mean_3/_567}} = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device_incarnation=1, tensor_name=\"edge_4382_loss/model_2_loss_1/Mean_3\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"]()]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\nTraceback (most recent call last):\r\n  File \"D:\\Patsoy-Home\\Deepfake\\DeepFaceLabCUDA9.2SSE\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 93, in trainerThread\r\n    iter, iter_time = model.train_one_iter()\r\n  File \"D:\\Patsoy-Home\\Deepfake\\DeepFaceLabCUDA9.2SSE\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 362, in train_one_iter\r\n    losses = self.onTrainOneIter(sample, self.generator_list)\r\n  File \"D:\\Patsoy-Home\\Deepfake\\DeepFaceLabCUDA9.2SSE\\_internal\\DeepFaceLab\\models\\Model_H64\\Model.py\", line 85, in onTrainOneIter\r\n    total, loss_src_bgr, loss_src_mask, loss_dst_bgr, loss_dst_mask = self.ae.train_on_batch( [warped_src, target_src_full_mask, warped_dst, target_dst_full_mask], [target_src, target_src_full_mask, target_dst, target_dst_full_mask] )\r\n  File \"D:\\Patsoy-Home\\Deepfake\\DeepFaceLabCUDA9.2SSE\\_internal\\python-3.6.8\\lib\\site-packages\\keras\\engine\\training.py\", line 1217, in train_on_batch\r\n    outputs = self.train_function(ins)\r\n  File \"D:\\Patsoy-Home\\Deepfake\\DeepFaceLabCUDA9.2SSE\\_internal\\python-3.6.8\\lib\\site-packages\\keras\\backend\\tensorflow_backend.py\", line 2715, in __call__\r\n    return self._call(inputs)\r\n  File \"D:\\Patsoy-Home\\Deepfake\\DeepFaceLabCUDA9.2SSE\\_internal\\python-3.6.8\\lib\\site-packages\\keras\\backend\\tensorflow_backend.py\", line 2675, in _call\r\n    fetched = self._callable_fn(*array_vals)\r\n  File \"D:\\Patsoy-Home\\Deepfake\\DeepFaceLabCUDA9.2SSE\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1439, in __call__\r\n    run_metadata_ptr)\r\n  File \"D:\\Patsoy-Home\\Deepfake\\DeepFaceLabCUDA9.2SSE\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\errors_impl.py\", line 528, in __exit__\r\n    c_api.TF_GetCode(self.status.status))\r\ntensorflow.python.framework.errors_impl.ResourceExhaustedError: OOM when allocating tensor with shape[64,1024,16,16] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n         [[{{node model_2/conv2d_7/convolution}} = Conv2D[T=DT_FLOAT, _class=[\"loc:@train...kpropInput\"], data_format=\"NCHW\", dilations=[1, 1, 1, 1], padding=\"SAME\", strides=[1, 1, 1, 1], use_cudnn_on_gpu=true, _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"](model_2/pixel_shuffler_2/NHWC, conv2d_7/kernel/read)]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n         [[{{node loss/model_2_loss_1/Mean_3/_567}} = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device_incarnation=1, tensor_name=\"edge_4382_loss/model_2_loss_1/Mean_3\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"]()]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.**","closed_by":{"login":"iperov","id":8076202,"node_id":"MDQ6VXNlcjgwNzYyMDI=","avatar_url":"https://avatars.githubusercontent.com/u/8076202?v=4","gravatar_id":"","url":"https://api.github.com/users/iperov","html_url":"https://github.com/iperov","followers_url":"https://api.github.com/users/iperov/followers","following_url":"https://api.github.com/users/iperov/following{/other_user}","gists_url":"https://api.github.com/users/iperov/gists{/gist_id}","starred_url":"https://api.github.com/users/iperov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iperov/subscriptions","organizations_url":"https://api.github.com/users/iperov/orgs","repos_url":"https://api.github.com/users/iperov/repos","events_url":"https://api.github.com/users/iperov/events{/privacy}","received_events_url":"https://api.github.com/users/iperov/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/227/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/227/timeline","performed_via_github_app":null,"state_reason":"completed"}