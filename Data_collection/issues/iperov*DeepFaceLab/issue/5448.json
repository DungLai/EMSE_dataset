{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5448","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5448/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5448/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5448/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/5448","id":1082236343,"node_id":"I_kwDOCBuapc5AgZ23","number":5448,"title":"Preview Crash related to get_loss_history_preview","user":{"login":"BlankFX1","id":26005942,"node_id":"MDQ6VXNlcjI2MDA1OTQy","avatar_url":"https://avatars.githubusercontent.com/u/26005942?v=4","gravatar_id":"","url":"https://api.github.com/users/BlankFX1","html_url":"https://github.com/BlankFX1","followers_url":"https://api.github.com/users/BlankFX1/followers","following_url":"https://api.github.com/users/BlankFX1/following{/other_user}","gists_url":"https://api.github.com/users/BlankFX1/gists{/gist_id}","starred_url":"https://api.github.com/users/BlankFX1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BlankFX1/subscriptions","organizations_url":"https://api.github.com/users/BlankFX1/orgs","repos_url":"https://api.github.com/users/BlankFX1/repos","events_url":"https://api.github.com/users/BlankFX1/events{/privacy}","received_events_url":"https://api.github.com/users/BlankFX1/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-12-16T14:05:43Z","updated_at":"2021-12-16T18:48:17Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"\r\n\r\n## Expected behavior\r\n\r\nTraining continues without giving out an Error.\r\n\r\n## Actual behavior\r\n\r\nThe following error is given out and the preview window stops working (or does not even appear the training was just re-started).\r\nThe training itself *seems* to continue, but instead of giving valid loss values, the cmd-log only shows \"[nan]\".\r\n\r\nThe error does not appear to relate to an OutOfMemory-Issue. Tested this by reducing the batch size.\r\n\r\n`Running trainer.\r\n\r\nChoose one of saved models, or enter a name to create a new model.\r\n[r] : rename\r\n[d] : delete\r\n\r\n[0] : SiaV2 - latest\r\n[1] : SiaV1\r\n :\r\n0\r\nLoading SiaV2_AMP model...\r\n\r\nChoose one or several GPU idxs (separated by comma).\r\n\r\n[CPU] : CPU\r\n  [0] : NVIDIA GeForce RTX 3080 Ti\r\n\r\n[0] Which GPU indexes to choose? :\r\n0\r\n\r\nPress enter in 2 seconds to override model settings.\r\n[1] Autobackup every N hour ( 0..24 ?:help ) :\r\n1\r\n[y] Write preview history ( y/n ?:help ) :\r\ny\r\n[n] Choose image for the preview history ( y/n ) :\r\nn\r\n[0] Target iteration :\r\n0\r\n[n] Flip SRC faces randomly ( y/n ?:help ) :\r\nn\r\n[y] Flip DST faces randomly ( y/n ?:help ) :\r\ny\r\n[10] Batch_size ( ?:help ) : 9\r\n9\r\n[y] Uniform yaw distribution of samples ( y/n ?:help ) :\r\ny\r\n[n] Blur out mask ( y/n ?:help ) :\r\nn\r\n[y] Use learning rate dropout ( n/y/cpu ?:help ) :\r\ny\r\n[y] Place models and optimizer on GPU ( y/n ?:help ) :\r\ny\r\n[n] Enable random warp of samples ( y/n ?:help ) :\r\nn\r\n[0.0] GAN power ( 0.0 .. 5.0 ?:help ) :\r\n0.0\r\n[none] Color transfer for src faceset ( none/rct/lct/mkl/idt/sot ?:help ) :\r\nnone\r\n[n] Enable gradient clipping ( y/n ?:help ) :\r\nn\r\nInitializing models: 100%|###############################################################| 5/5 [00:02<00:00,  2.26it/s]\r\nLoaded 11230 packed faces from S:\\DeepFaceLab3080Ti\\DeepFaceLab_NVIDIA_RTX3000_series\\workspace\\data_src\\aligned\r\nSort by yaw: 100%|##################################################################| 128/128 [00:00<00:00, 463.36it/s]\r\nSort by yaw: 100%|##################################################################| 128/128 [00:00<00:00, 448.71it/s]\r\n==================== Model Summary ====================\r\n==                                                   ==\r\n==            Model name: SiaV2_AMP        ==\r\n==                                                   ==\r\n==     Current iteration: 407587                     ==\r\n==                                                   ==\r\n==------------------ Model Options ------------------==\r\n==                                                   ==\r\n==            resolution: 320                        ==\r\n==             face_type: wf                         ==\r\n==     models_opt_on_gpu: True                       ==\r\n==               ae_dims: 256                        ==\r\n==            inter_dims: 320                        ==\r\n==                e_dims: 72                         ==\r\n==                d_dims: 72                         ==\r\n==           d_mask_dims: 22                         ==\r\n==          morph_factor: 0.5                        ==\r\n==           uniform_yaw: True                       ==\r\n==         blur_out_mask: False                      ==\r\n==            lr_dropout: y                          ==\r\n==           random_warp: False                      ==\r\n==               ct_mode: none                       ==\r\n==              clipgrad: False                      ==\r\n==       autobackup_hour: 1                          ==\r\n== write_preview_history: True                       ==\r\n==           target_iter: 0                          ==\r\n==       random_src_flip: False                      ==\r\n==       random_dst_flip: True                       ==\r\n==            batch_size: 9                          ==\r\n==             gan_power: 0.0                        ==\r\n==        gan_patch_size: 40                         ==\r\n==              gan_dims: 16                         ==\r\n==                                                   ==\r\n==------------------- Running On --------------------==\r\n==                                                   ==\r\n==          Device index: 0                          ==\r\n==                  Name: NVIDIA GeForce RTX 3080 Ti ==\r\n==                  VRAM: 9.22GB                     ==\r\n==                                                   ==\r\n=======================================================\r\nStarting. Press \"Enter\" to stop training and save model.\r\nTraceback (most recent call last):an]\r\n  File \"S:\\DeepFaceLab3080Ti\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\main.py\", line 343, in <module>\r\n    arguments.func(arguments)\r\n  File \"S:\\DeepFaceLab3080Ti\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\main.py\", line 132, in process_train\r\n    Trainer.main(**kwargs)\r\n  File \"S:\\DeepFaceLab3080Ti\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 317, in main\r\n    lh_img = models.ModelBase.get_loss_history_preview(loss_history_to_show, iter, w, c)\r\n  File \"S:\\DeepFaceLab3080Ti\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 627, in get_loss_history_preview\r\n    ph_max = int ( (plist_max[col][p] / plist_abs_max) * (lh_height-1) )\r\nValueError: cannot convert float NaN to integer\r\nProcess Process-36:[0527ms][nan][nan]\r\nTraceback (most recent call last):\r\n  File \"multiprocessing\\process.py\", line 258, in _bootstrap\r\n  File \"multiprocessing\\process.py\", line 93, in run\r\n  File \"S:\\DeepFaceLab3080Ti\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 668, in process\r\n    preview_lh = ModelBase.get_loss_history_preview(loss_history, iter, preview.shape[1], preview.shape[2])\r\n  File \"S:\\DeepFaceLab3080Ti\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 627, in get_loss_history_preview\r\n    ph_max = int ( (plist_max[col][p] / plist_abs_max) * (lh_height-1) )\r\nValueError: cannot convert float NaN to integer\r\n[14:49:18][#407694][0529ms][nan][nan]\r\n`\r\n\r\n## Steps to reproduce\r\n\r\nAfter hours of training it just suddenly gave out this error. Since then the error keeps being given out right after re-starting the training.\r\nThe used parameters are included above.\r\n\r\n## Other relevant information\r\n- Win10/64x, 64 GiByte RAM, 700 GiByte Paging File, Ryzen 9 3950X, RTX 1080Ti\r\n- DeepFaceLab_NVIDIA_RTX3000_series_build_11_20_2021","closed_by":null,"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5448/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5448/timeline","performed_via_github_app":null,"state_reason":null}