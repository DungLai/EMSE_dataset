{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/715","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/715/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/715/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/715/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/715","id":600487612,"node_id":"MDU6SXNzdWU2MDA0ODc2MTI=","number":715,"title":"Subprocesses unable to start during faceset enhancer on Linux","user":{"login":"TalosOfCrete","id":32628941,"node_id":"MDQ6VXNlcjMyNjI4OTQx","avatar_url":"https://avatars.githubusercontent.com/u/32628941?v=4","gravatar_id":"","url":"https://api.github.com/users/TalosOfCrete","html_url":"https://github.com/TalosOfCrete","followers_url":"https://api.github.com/users/TalosOfCrete/followers","following_url":"https://api.github.com/users/TalosOfCrete/following{/other_user}","gists_url":"https://api.github.com/users/TalosOfCrete/gists{/gist_id}","starred_url":"https://api.github.com/users/TalosOfCrete/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TalosOfCrete/subscriptions","organizations_url":"https://api.github.com/users/TalosOfCrete/orgs","repos_url":"https://api.github.com/users/TalosOfCrete/repos","events_url":"https://api.github.com/users/TalosOfCrete/events{/privacy}","received_events_url":"https://api.github.com/users/TalosOfCrete/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-04-15T18:02:25Z","updated_at":"2020-05-21T22:52:50Z","closed_at":"2020-05-21T22:52:50Z","author_association":"NONE","active_lock_reason":null,"body":"## Expected behavior\r\n\r\nThe faceset enhancer is supposed to launch and begin processing the images in the target directory.\r\n\r\n## Actual behavior\r\n\r\nUpon executing, this is the output:\r\n`[CPU] : CPU\r\n  [0] : GeForce GTX 1060 6GB\r\n\r\n[0] Which GPU indexes to choose? : \r\n0\r\n\r\nEnhancing faceset in data_src/aligned\r\nProcessing to data_src/aligned_enhanced\r\nRunning on GeForce GTX 1060 6GB.\r\nTraceback (most recent call last):\r\n  File \"DeepFaceLab/main.py\", line 314, in <module>\r\n    arguments.func(arguments)\r\n  File \"DeepFaceLab/main.py\", line 238, in process_faceset_enhancer\r\n    force_gpu_idxs=arguments.force_gpu_idxs\r\n  File \"/lustre/work/[my group name]/[my name]/DeepFaceLab/mainscripts/FacesetEnhancer.py\", line 143, in process_folder\r\n    result = FacesetEnhancerSubprocessor ( image_paths, output_dirpath, device_config=device_config).run()\r\n  File \"/lustre/work/[my group name]/[my name]/DeepFaceLab/core/joblib/SubprocessorBase.py\", line 219, in run\r\n    raise Exception ( \"Unable to start subprocesses.\" )\r\nException: Unable to start subprocesses.`\r\n\r\n## Steps to reproduce\r\nI recognize that this is an unusual setting for DFL.  However, seeing as this is a Linux release, I expected it to work given the correct dependencies.  The following steps were taken in the creation of the **dfl** Anaconda environment in order to run the software:\r\n\r\n1. The conda environment was created\r\n2. Python 3.6.9 was installed (same as Colab)\r\n3. All dependencies were installed with the versions indicated by the `requirements-cuda.txt` file **except** for the following:\r\n\r\n- Labelme was installed with the highest version afforded by Conda (3.21.1)\r\n- Tensorflow-gpu was installed as version 1.13.1 (the closest Conda offered to 1.13.2)\r\n   - It is possible that this is part of the cause of the issue; however, installing 1.13.2 via pip led even the face extractor to break\r\n- CuDNN and Cuda toolkit were also installed via Conda as early attempts to tackle this issue\r\n- ffmpeg-python was skipped due to its lack of Conda implementation (will consider installing via pip, but did not want to risk breaking environment further)\r\n\r\n4. A SLURM job was requested for a GTX 1060\r\n5. The module for CUDA 10 was loaded (it would otherwise be CUDA 9.2)\r\n6. The Anaconda module was loaded and the **dfl** environment was activated\r\n7. The script to initiate the faceset enhancer was executed with the correct directory entered\r\n\r\n\r\n## Other relevant information\r\n- **Command lined used (if not specified in steps to reproduce)**: `python DeepFaceLab/main.py facesettool enhance --input-dir workspace/data_src/aligned/` \r\n- **Operating system and version:** Linux Scientific release 6.10 (Carbon)\r\n- **Python version:** 3.6.9\r\n- As you could probably surmise, these jobs are taking place at an HPC cluster.  This means that I am submitting requests for GPUs, connecting to them when they become available, giving them access to the relevant directories and Anaconda environments, and running the scripts.  **This worked with no issue in DFL 1.x, and no other scripts in DFL 2.x are having this problem.**\r\n- Note the fact that it is able to correctly read the GPU that it is running on, but seems unable to start the processes anyway\r\n- Earlier tracebacks for this issue also pointed to a Python library relating to multiprocessing and Tensorflow complaining about not being able to colocate nodes and devices (I have not been able to replicate these since)\r\n   - The error about Tensorflow appeared to involve my messed up Conda environment, which I have since deleted and replaced with the process described above\r\n   - The error about multiprocessing took place when I attempted to run this on Python 3.7; after noticing the version on Colab, I downgraded it\r\n   - There are **no** pip-installed packages in my environment","closed_by":{"login":"TalosOfCrete","id":32628941,"node_id":"MDQ6VXNlcjMyNjI4OTQx","avatar_url":"https://avatars.githubusercontent.com/u/32628941?v=4","gravatar_id":"","url":"https://api.github.com/users/TalosOfCrete","html_url":"https://github.com/TalosOfCrete","followers_url":"https://api.github.com/users/TalosOfCrete/followers","following_url":"https://api.github.com/users/TalosOfCrete/following{/other_user}","gists_url":"https://api.github.com/users/TalosOfCrete/gists{/gist_id}","starred_url":"https://api.github.com/users/TalosOfCrete/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TalosOfCrete/subscriptions","organizations_url":"https://api.github.com/users/TalosOfCrete/orgs","repos_url":"https://api.github.com/users/TalosOfCrete/repos","events_url":"https://api.github.com/users/TalosOfCrete/events{/privacy}","received_events_url":"https://api.github.com/users/TalosOfCrete/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/715/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/715/timeline","performed_via_github_app":null,"state_reason":"completed"}