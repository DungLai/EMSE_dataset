{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/257","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/257/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/257/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/257/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/257","id":441641037,"node_id":"MDU6SXNzdWU0NDE2NDEwMzc=","number":257,"title":"Error extracting faces from PNGs ","user":{"login":"IUsedToBeAPygmy","id":35959558,"node_id":"MDQ6VXNlcjM1OTU5NTU4","avatar_url":"https://avatars.githubusercontent.com/u/35959558?v=4","gravatar_id":"","url":"https://api.github.com/users/IUsedToBeAPygmy","html_url":"https://github.com/IUsedToBeAPygmy","followers_url":"https://api.github.com/users/IUsedToBeAPygmy/followers","following_url":"https://api.github.com/users/IUsedToBeAPygmy/following{/other_user}","gists_url":"https://api.github.com/users/IUsedToBeAPygmy/gists{/gist_id}","starred_url":"https://api.github.com/users/IUsedToBeAPygmy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IUsedToBeAPygmy/subscriptions","organizations_url":"https://api.github.com/users/IUsedToBeAPygmy/orgs","repos_url":"https://api.github.com/users/IUsedToBeAPygmy/repos","events_url":"https://api.github.com/users/IUsedToBeAPygmy/events{/privacy}","received_events_url":"https://api.github.com/users/IUsedToBeAPygmy/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-05-08T09:34:29Z","updated_at":"2019-05-12T03:58:21Z","closed_at":"2019-05-12T03:58:21Z","author_association":"NONE","active_lock_reason":null,"body":"## Expected behavior\r\n\r\nI am extracting faces. My source data is a set of manually copied PNG's.\r\nI expect it to create properly aligned faces in the \"aligned\" folder.\r\n\r\n## Actual behavior\r\n\r\nIt crashes on a series of \"No Valid JPG info\" errors.\r\n\r\n## Problem\r\n\r\nThere is a code path that copies the PNG to the \"aligned\" folder, but then it tries to embed data in the file using DFLJPG.\r\n\r\nWhich ofcourse won't work - you can't embed data in a PNG file using a JPG reader/writer :-)\r\n\r\nIf I remove the section that copies the file and instead ALWAYS write the JPG file using cv2_imwrite, it works fine.\r\n\r\n\r\n                        `if src_dflimg is not None and output_file.suffix:\r\n                            #if extracting from dflimg copy it in order not to lose quality\r\n                            output_file = str(self.final_output_path / filename_path.name)\r\n                            if str(filename_path) != str(output_file):\r\n                                shutil.copy ( str(filename_path), str(output_file) )\r\n                        else:\r\n                            output_file = '{}_{}{}'.format(str(self.final_output_path / filename_path.stem), str(face_idx), '.jpg')\r\n                            cv2_imwrite(output_file, face_image, [int(cv2.IMWRITE_JPEG_QUALITY), 85] )\r\n\r\n                        DFLJPG.embed_data(output_file, face_type=FaceType.toString(self.face_type),\r\n                                                       landmarks=face_image_landmarks.tolist(),\r\n                                                       source_filename=filename_path.name,\r\n                                                       source_rect=rect,\r\n                                                       source_landmarks=image_landmarks.tolist(),\r\n                                                       image_to_face_mat=image_to_face_mat,\r\n                                                       pitch_yaw_roll=data.pitch_yaw_roll\r\n                                            )`\r\n","closed_by":{"login":"iperov","id":8076202,"node_id":"MDQ6VXNlcjgwNzYyMDI=","avatar_url":"https://avatars.githubusercontent.com/u/8076202?v=4","gravatar_id":"","url":"https://api.github.com/users/iperov","html_url":"https://github.com/iperov","followers_url":"https://api.github.com/users/iperov/followers","following_url":"https://api.github.com/users/iperov/following{/other_user}","gists_url":"https://api.github.com/users/iperov/gists{/gist_id}","starred_url":"https://api.github.com/users/iperov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iperov/subscriptions","organizations_url":"https://api.github.com/users/iperov/orgs","repos_url":"https://api.github.com/users/iperov/repos","events_url":"https://api.github.com/users/iperov/events{/privacy}","received_events_url":"https://api.github.com/users/iperov/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/257/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/257/timeline","performed_via_github_app":null,"state_reason":"completed"}