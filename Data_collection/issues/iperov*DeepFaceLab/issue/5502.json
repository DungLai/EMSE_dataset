{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5502","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5502/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5502/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5502/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/5502","id":1183692236,"node_id":"I_kwDOCBuapc5GjbXM","number":5502,"title":"Can't get RTX 3090 to work with deepfacelab.","user":{"login":"diegito55","id":73799980,"node_id":"MDQ6VXNlcjczNzk5OTgw","avatar_url":"https://avatars.githubusercontent.com/u/73799980?v=4","gravatar_id":"","url":"https://api.github.com/users/diegito55","html_url":"https://github.com/diegito55","followers_url":"https://api.github.com/users/diegito55/followers","following_url":"https://api.github.com/users/diegito55/following{/other_user}","gists_url":"https://api.github.com/users/diegito55/gists{/gist_id}","starred_url":"https://api.github.com/users/diegito55/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diegito55/subscriptions","organizations_url":"https://api.github.com/users/diegito55/orgs","repos_url":"https://api.github.com/users/diegito55/repos","events_url":"https://api.github.com/users/diegito55/events{/privacy}","received_events_url":"https://api.github.com/users/diegito55/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-03-28T16:32:52Z","updated_at":"2022-09-24T13:44:29Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"THIS IS NOT TECH SUPPORT FOR NEWBIE FAKERS\r\nPOST ONLY ISSUES RELATED TO BUGS OR CODE\r\n\r\n## Expected behavior\r\n\r\nI have the highest specs with an rtx 3090 and a ryzen 5800x cpu. I expect it to run, but it comes up with this error:Error: 2 root error(s) found.\r\n  (0) Resource exhausted: OOM when allocating tensor with shape[5376,34,34] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n         [[node Pad_38 (defined at C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\layers\\Conv2D.py:87) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n         [[concat_4/concat/_1141]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n  (1) Resource exhausted: OOM when allocating tensor with shape[5376,34,34] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n         [[node Pad_38 (defined at C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\layers\\Conv2D.py:87) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n0 successful operations.\r\n0 derived errors ignored.\r\n\r\nErrors may have originated from an input operation.\r\nInput Source operations connected to node Pad_38:\r\n LeakyRelu_28 (defined at C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py:29)\r\n\r\nInput Source operations connected to node Pad_38:\r\n LeakyRelu_28 (defined at C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py:29)\r\n\r\nOriginal stack trace for 'Pad_38':\r\n  File \"threading.py\", line 884, in _bootstrap\r\n  File \"threading.py\", line 916, in _bootstrap_inner\r\n  File \"threading.py\", line 864, in run\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 58, in trainerThread\r\n    debug=debug)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 193, in __init__\r\n    self.on_initialize()\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 410, in on_initialize\r\n    gpu_pred_dst_dst, gpu_pred_dst_dstm = self.decoder_dst(gpu_dst_code)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\models\\ModelBase.py\", line 117, in __call__\r\n    return self.forward(*args, **kwargs)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py\", line 225, in forward\r\n    x = self.upscale2(x)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\models\\ModelBase.py\", line 117, in __call__\r\n    return self.forward(*args, **kwargs)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py\", line 71, in forward\r\n    x = self.conv1(x)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\layers\\LayerBase.py\", line 14, in __call__\r\n    return self.forward(*args, **kwargs)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\layers\\Conv2D.py\", line 87, in forward\r\n    x = tf.pad (x, padding, mode='CONSTANT')\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\dispatch.py\", line 206, in wrapper\r\n    return target(*args, **kwargs)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\array_ops.py\", line 3528, in pad\r\n    result = gen_array_ops.pad(tensor, paddings, name=name)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_array_ops.py\", line 6487, in pad\r\n    \"Pad\", input=input, paddings=paddings, name=name)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 750, in _apply_op_helper\r\n    attrs=attr_protos, op_def=op_def)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3569, in _create_op_internal\r\n    op_def=op_def)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 2045, in __init__\r\n    self._traceback = tf_stack.extract_stack_for_node(self._c_op)\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1375, in _do_call\r\n    return fn(*args)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1360, in _run_fn\r\n    target_list, run_metadata)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1453, in _call_tf_sessionrun\r\n    run_metadata)\r\ntensorflow.python.framework.errors_impl.ResourceExhaustedError: 2 root error(s) found.\r\n  (0) Resource exhausted: OOM when allocating tensor with shape[5376,34,34] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n         [[{{node Pad_38}}]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n         [[concat_4/concat/_1141]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n  (1) Resource exhausted: OOM when allocating tensor with shape[5376,34,34] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n         [[{{node Pad_38}}]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n0 successful operations.\r\n0 derived errors ignored.\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 129, in trainerThread\r\n    iter, iter_time = model.train_one_iter()\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 474, in train_one_iter\r\n    losses = self.onTrainOneIter()\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 774, in onTrainOneIter\r\n    src_loss, dst_loss = self.src_dst_train (warped_src, target_src, target_srcm, target_srcm_em, warped_dst, target_dst, target_dstm, target_dstm_em)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 584, in src_dst_train\r\n    self.target_dstm_em:target_dstm_em,\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 968, in run\r\n    run_metadata_ptr)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1191, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1369, in _do_run\r\n    run_metadata)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1394, in _do_call\r\n    raise type(e)(node_def, op, message)  # pylint: disable=no-value-for-parameter\r\ntensorflow.python.framework.errors_impl.ResourceExhaustedError: 2 root error(s) found.\r\n  (0) Resource exhausted: OOM when allocating tensor with shape[5376,34,34] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n         [[node Pad_38 (defined at C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\layers\\Conv2D.py:87) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n         [[concat_4/concat/_1141]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n  (1) Resource exhausted: OOM when allocating tensor with shape[5376,34,34] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n         [[node Pad_38 (defined at C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\layers\\Conv2D.py:87) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info. This isn't available when running in Eager mode.\r\n\r\n0 successful operations.\r\n0 derived errors ignored.\r\n\r\nErrors may have originated from an input operation.\r\nInput Source operations connected to node Pad_38:\r\n LeakyRelu_28 (defined at C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py:29)\r\n\r\nInput Source operations connected to node Pad_38:\r\n LeakyRelu_28 (defined at C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py:29)\r\n\r\nOriginal stack trace for 'Pad_38':\r\n  File \"threading.py\", line 884, in _bootstrap\r\n  File \"threading.py\", line 916, in _bootstrap_inner\r\n  File \"threading.py\", line 864, in run\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 58, in trainerThread\r\n    debug=debug)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 193, in __init__\r\n    self.on_initialize()\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 410, in on_initialize\r\n    gpu_pred_dst_dst, gpu_pred_dst_dstm = self.decoder_dst(gpu_dst_code)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\models\\ModelBase.py\", line 117, in __call__\r\n    return self.forward(*args, **kwargs)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py\", line 225, in forward\r\n    x = self.upscale2(x)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\models\\ModelBase.py\", line 117, in __call__\r\n    return self.forward(*args, **kwargs)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py\", line 71, in forward\r\n    x = self.conv1(x)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\layers\\LayerBase.py\", line 14, in __call__\r\n    return self.forward(*args, **kwargs)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\DeepFaceLab\\core\\leras\\layers\\Conv2D.py\", line 87, in forward\r\n    x = tf.pad (x, padding, mode='CONSTANT')\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\dispatch.py\", line 206, in wrapper\r\n    return target(*args, **kwargs)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\array_ops.py\", line 3528, in pad\r\n    result = gen_array_ops.pad(tensor, paddings, name=name)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_array_ops.py\", line 6487, in pad\r\n    \"Pad\", input=input, paddings=paddings, name=name)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 750, in _apply_op_helper\r\n    attrs=attr_protos, op_def=op_def)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3569, in _create_op_internal\r\n    op_def=op_def)\r\n  File \"C:\\Users\\Redux\\Downloads\\Reface\\DeepFaceLab_NVIDIA_RTX3000_series\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 2045, in __init__\r\n    self._traceback = tf_stack.extract_stack_for_node(self._c_op) \r\n## Actual behavior\r\nI go through all the settings in SAEHD without changing anything and it comes up with this long paragraph that I can't understand\r\nor it says bad allocation or out of memory.\r\n\r\n## Steps to reproduce\r\n\r\nI cannot recall exactly what i changed but i don't think it would be detrimental because I then used the cpu instead of the gpu and worked fine, but I don't think im getting the quickest result with the cpu.\r\nresolution: 128                     ==\r\n==             face_type: wf                      ==\r\n==     models_opt_on_gpu: True                    ==\r\n==                 archi: df-ud                   ==\r\n==               ae_dims: 256                     ==\r\n==                e_dims: 64                      ==\r\n==                d_dims: 64                      ==\r\n==           d_mask_dims: 22                      ==\r\n==       masked_training: True                    ==\r\n==       eyes_mouth_prio: True                    ==\r\n==           uniform_yaw: True                    ==\r\n==         blur_out_mask: True                    ==\r\n==             adabelief: True                    ==\r\n==            lr_dropout: n                       ==\r\n==           random_warp: False                   ==\r\n==      random_hsv_power: 0.0                     ==\r\n==       true_face_power: 0.0                     ==\r\n==      face_style_power: 0.0                     ==\r\n==        bg_style_power: 0.0                     ==\r\n==               ct_mode: none                    ==\r\n==              clipgrad: True                    ==\r\n==              pretrain: True                    ==\r\n==       autobackup_hour: 1                       ==\r\n== write_preview_history: True                    ==\r\n==           target_iter: 0                       ==\r\n==       random_src_flip: False                   ==\r\n==       random_dst_flip: False                   ==\r\n==            batch_size: 21                      ==\r\n==             gan_power: 0.0                     ==\r\n==        gan_patch_size: 16                      ==\r\n==              gan_dims: 16                      ==\r\n==                                                ==\r\n==------------------ Running On ------------------==\r\n==                                                ==\r\n==          Device index: 0                       ==\r\n==                  Name: NVIDIA GeForce RTX 3090 ==\r\n==                  VRAM: 21.17GB                 ==\r\n==\r\n## Other relevant information\r\n- **Command lined used (if not specified in steps to reproduce)**: main.py ...\r\n- **Operating system and version:** Windows, macOS, Linux \r\n- **Python version:** 3.5, 3.6.4, ... (if you are not using prebuilt windows binary)","closed_by":null,"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5502/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5502/timeline","performed_via_github_app":null,"state_reason":null}