{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5406","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5406/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5406/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5406/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/5406","id":1022705665,"node_id":"I_kwDOCBuapc489UAB","number":5406,"title":"Can't use gpu","user":{"login":"mitko00","id":84527387,"node_id":"MDQ6VXNlcjg0NTI3Mzg3","avatar_url":"https://avatars.githubusercontent.com/u/84527387?v=4","gravatar_id":"","url":"https://api.github.com/users/mitko00","html_url":"https://github.com/mitko00","followers_url":"https://api.github.com/users/mitko00/followers","following_url":"https://api.github.com/users/mitko00/following{/other_user}","gists_url":"https://api.github.com/users/mitko00/gists{/gist_id}","starred_url":"https://api.github.com/users/mitko00/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitko00/subscriptions","organizations_url":"https://api.github.com/users/mitko00/orgs","repos_url":"https://api.github.com/users/mitko00/repos","events_url":"https://api.github.com/users/mitko00/events{/privacy}","received_events_url":"https://api.github.com/users/mitko00/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-10-11T13:24:25Z","updated_at":"2021-10-28T10:32:05Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Hello! I have a gpu mx150 and i can't use it. I have to do cpu, but it is slow. Here is the thing in the sae hd bat Running trainer.\r\n\r\nChoose one of saved models, or enter a name to create a new model.\r\n[r] : rename\r\n[d] : delete\r\n\r\n[0] : capsnaps - latest\r\n : 0\r\n0\r\nLoading capsnaps_SAEHD model...\r\n\r\nChoose one or several GPU idxs (separated by comma).\r\n\r\n[CPU] : CPU\r\n  [0] : NVIDIA GeForce MX150\r\n  [1] : Intel(R) UHD Graphics 620\r\n\r\n[1] Which GPU indexes to choose? : 0\r\n0\r\n\r\nInitializing models: 100%|###############################################################| 5/5 [00:43<00:00,  8.73s/it]\r\nLoading samples: 100%|##############################################################| 768/768 [00:05<00:00, 132.88it/s]\r\nLoading samples: 100%|##############################################################| 709/709 [00:06<00:00, 106.63it/s]\r\n================= Model Summary =================\r\n==                                             ==\r\n==            Model name: capsnaps_SAEHD       ==\r\n==                                             ==\r\n==     Current iteration: 4084                 ==\r\n==                                             ==\r\n==--------------- Model Options ---------------==\r\n==                                             ==\r\n==            resolution: 128                  ==\r\n==             face_type: head                 ==\r\n==     models_opt_on_gpu: True                 ==\r\n==                 archi: liae                 ==\r\n==               ae_dims: 256                  ==\r\n==                e_dims: 64                   ==\r\n==                d_dims: 64                   ==\r\n==           d_mask_dims: 22                   ==\r\n==       masked_training: True                 ==\r\n==       eyes_mouth_prio: True                 ==\r\n==           uniform_yaw: False                ==\r\n==         blur_out_mask: False                ==\r\n==             adabelief: True                 ==\r\n==            lr_dropout: n                    ==\r\n==           random_warp: True                 ==\r\n==       true_face_power: 0.0                  ==\r\n==      face_style_power: 0.0                  ==\r\n==        bg_style_power: 0.0                  ==\r\n==               ct_mode: none                 ==\r\n==              clipgrad: False                ==\r\n==              pretrain: False                ==\r\n==       autobackup_hour: 0                    ==\r\n== write_preview_history: True                 ==\r\n==           target_iter: 10000                ==\r\n==       random_src_flip: False                ==\r\n==       random_dst_flip: False                ==\r\n==            batch_size: 4                    ==\r\n==             gan_power: 0.0                  ==\r\n==        gan_patch_size: 16                   ==\r\n==              gan_dims: 16                   ==\r\n==                                             ==\r\n==---------------- Running On -----------------==\r\n==                                             ==\r\n==          Device index: 0                    ==\r\n==                  Name: NVIDIA GeForce MX150 ==\r\n==                  VRAM: 1.43GB               ==\r\n==                                             ==\r\n=================================================\r\nStarting. Target iteration: 10000. Press \"Enter\" to stop training and save model.\r\nError: 2 root error(s) found.\r\n  (0) Resource exhausted: OOM when allocating tensor with shape[32768] and type float on /job:localhost/replica:0/task:0/device:DML:0 by allocator DmlAllocator\r\n         [[node mul_93 (defined at C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\framework\\ops.py:1762) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n         [[concat_4/concat/_681]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n  (1) Resource exhausted: OOM when allocating tensor with shape[32768] and type float on /job:localhost/replica:0/task:0/device:DML:0 by allocator DmlAllocator\r\n         [[node mul_93 (defined at C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\framework\\ops.py:1762) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n0 successful operations.\r\n0 derived errors ignored.\r\n\r\nOriginal stack trace for 'mul_93':\r\n  File \"threading.py\", line 884, in _bootstrap\r\n  File \"threading.py\", line 916, in _bootstrap_inner\r\n  File \"threading.py\", line 864, in run\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 58, in trainerThread\r\n    debug=debug)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 193, in __init__\r\n    self.on_initialize()\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 557, in on_initialize\r\n    src_dst_loss_gv_op = self.src_dst_opt.get_update_op (nn.average_gv_list (gpu_G_loss_gvs))\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\DeepFaceLab\\core\\leras\\optimizers\\AdaBelief.py\", line 63, in get_update_op\r\n    v_t = self.beta_2*vs + (1.0-self.beta_2) * tf.square(g-m_t)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\ops\\variables.py\", line 1079, in _run_op\r\n    return tensor_oper(a.value(), *args, **kwargs)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\ops\\math_ops.py\", line 925, in r_binary_op_wrapper\r\n    return func(x, y, name=name)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\ops\\math_ops.py\", line 1206, in _mul_dispatch\r\n    return gen_math_ops.mul(x, y, name=name)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\ops\\gen_math_ops.py\", line 7196, in mul\r\n    \"Mul\", x=x, y=y, name=name)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\framework\\op_def_library.py\", line 794, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\util\\deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\framework\\ops.py\", line 3371, in create_op\r\n    attrs, op_def, compute_device)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\framework\\ops.py\", line 3440, in _create_op_internal\r\n    op_def=op_def)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\framework\\ops.py\", line 1762, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\client\\session.py\", line 1365, in _do_call\r\n    return fn(*args)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\client\\session.py\", line 1350, in _run_fn\r\n    target_list, run_metadata)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\client\\session.py\", line 1443, in _call_tf_sessionrun\r\n    run_metadata)\r\ntensorflow.python.framework.errors_impl.ResourceExhaustedError: 2 root error(s) found.\r\n  (0) Resource exhausted: OOM when allocating tensor with shape[32768] and type float on /job:localhost/replica:0/task:0/device:DML:0 by allocator DmlAllocator\r\n         [[{{node mul_93}}]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n         [[concat_4/concat/_681]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n  (1) Resource exhausted: OOM when allocating tensor with shape[32768] and type float on /job:localhost/replica:0/task:0/device:DML:0 by allocator DmlAllocator\r\n         [[{{node mul_93}}]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n0 successful operations.\r\n0 derived errors ignored.\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 129, in trainerThread\r\n    iter, iter_time = model.train_one_iter()\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 474, in train_one_iter\r\n    losses = self.onTrainOneIter()\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 772, in onTrainOneIter\r\n    src_loss, dst_loss = self.src_dst_train (warped_src, target_src, target_srcm, target_srcm_em, warped_dst, target_dst, target_dstm, target_dstm_em)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 577, in src_dst_train\r\n    self.target_dstm_em:target_dstm_em,\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\client\\session.py\", line 956, in run\r\n    run_metadata_ptr)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\client\\session.py\", line 1180, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\client\\session.py\", line 1359, in _do_run\r\n    run_metadata)\r\n  File \"C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\client\\session.py\", line 1384, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.ResourceExhaustedError: 2 root error(s) found.\r\n  (0) Resource exhausted: OOM when allocating tensor with shape[32768] and type float on /job:localhost/replica:0/task:0/device:DML:0 by allocator DmlAllocator\r\n         [[node mul_93 (defined at C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\framework\\ops.py:1762) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n         [[concat_4/concat/_681]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n  (1) Resource exhausted: OOM when allocating tensor with shape[32768] and type float on /job:localhost/replica:0/task:0/device:DML:0 by allocator DmlAllocator\r\n         [[node mul_93 (defined at C:\\Users\\Mitko\\Downloads\\DeepFaceLab_DirectX12\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow_core\\python\\framework\\ops.py:1762) ]]\r\nHint: If you want to see a list of allocated tensors when OOM happens, add report_tensor_allocations_upon_oom to RunOptions for current allocation info.\r\n\r\n0 successful operations.\r\n0 derived errors ignored.","closed_by":null,"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5406/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/5406/timeline","performed_via_github_app":null,"state_reason":null}