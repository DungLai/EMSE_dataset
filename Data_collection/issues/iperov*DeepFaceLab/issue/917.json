{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/917","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/917/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/917/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/917/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/917","id":714374072,"node_id":"MDU6SXNzdWU3MTQzNzQwNzI=","number":917,"title":"Merger(SAEHD) crashes in interactive mode when switching from help screen to main screen.","user":{"login":"sandstrand","id":11724954,"node_id":"MDQ6VXNlcjExNzI0OTU0","avatar_url":"https://avatars.githubusercontent.com/u/11724954?v=4","gravatar_id":"","url":"https://api.github.com/users/sandstrand","html_url":"https://github.com/sandstrand","followers_url":"https://api.github.com/users/sandstrand/followers","following_url":"https://api.github.com/users/sandstrand/following{/other_user}","gists_url":"https://api.github.com/users/sandstrand/gists{/gist_id}","starred_url":"https://api.github.com/users/sandstrand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sandstrand/subscriptions","organizations_url":"https://api.github.com/users/sandstrand/orgs","repos_url":"https://api.github.com/users/sandstrand/repos","events_url":"https://api.github.com/users/sandstrand/events{/privacy}","received_events_url":"https://api.github.com/users/sandstrand/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2020-10-04T18:32:08Z","updated_at":"2022-09-24T19:49:24Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"## Expected behavior\r\n\r\nRunning '_7) merge SAEHD.bat_' launches the merger.   \r\nIf you select 'Yes' on the interactive merger option the merger launches with a GUI which starts on the help screen.  \r\nFrom the help screen you can switch to the main / preview screen by pressing tab. \r\n\r\n## Actual behavior\r\n\r\nWhen attempting to switch from _help_ screen to _main_ screen by pressing tab the merger crashes with a curious error: \r\n```\r\n> Invalid number of channels in input image:\r\n> 'VScn::contains(scn)'\r\n> where\r\n> 'scn' is 5\r\n```\r\nSee full dump and trace below.\r\n\r\nOnly the first merged image is created in data_dst/merged.\r\n\r\nIf I run the merger as non-interactive, the merge is successful.\r\n\r\nThe error seems similar to #645  but that issue is resolved without any solution. \r\n\r\n## Steps to reproduce\r\n\r\nUnable to determine triggers, cannot reproduce in other projects.\r\n\r\n## Other relevant information\r\n\r\n- **Operating system and version:** Windows 10 \r\n- **Application version:** DeepFaceLab_NVIDIA_build_08_02_2020.exe  \r\n- XSeg trained for 40K iterations  \r\n- SAEHD trained for ~70K iterations with different options along the way\r\n\r\n## Full dump\r\n```\r\nRunning merger.\r\n\r\nChoose one of saved models, or enter a name to create a new model.\r\n[r] : rename\r\n[d] : delete\r\n\r\n[0] : 192 liae-ud - latest\r\n : 0\r\n0\r\nLoading 192 liae-ud_SAEHD model...\r\n\r\nChoose one or several GPU idxs (separated by comma).\r\n\r\n[CPU] : CPU\r\n  [0] : GeForce RTX 2060 SUPER\r\n\r\n[0] Which GPU indexes to choose? : 0\r\n0\r\n\r\nInitializing models: 100%|###############################################################| 4/4 [00:01<00:00,  3.74it/s]\r\n================== Model Summary ==================\r\n==                                               ==\r\n==            Model name: 192 liae-ud_SAEHD      ==\r\n==                                               ==\r\n==     Current iteration: 73595                  ==\r\n==                                               ==\r\n==---------------- Model Options ----------------==\r\n==                                               ==\r\n==            resolution: 192                    ==\r\n==             face_type: f                      ==\r\n==     models_opt_on_gpu: True                   ==\r\n==                 archi: liae-ud                ==\r\n==               ae_dims: 256                    ==\r\n==                e_dims: 64                     ==\r\n==                d_dims: 64                     ==\r\n==           d_mask_dims: 22                     ==\r\n==       masked_training: True                   ==\r\n==             eyes_prio: True                   ==\r\n==           uniform_yaw: False                  ==\r\n==            lr_dropout: n                      ==\r\n==           random_warp: False                  ==\r\n==             gan_power: 0.0                    ==\r\n==       true_face_power: 0.0                    ==\r\n==      face_style_power: 0.0                    ==\r\n==        bg_style_power: 0.0                    ==\r\n==               ct_mode: none                   ==\r\n==              clipgrad: True                   ==\r\n==              pretrain: False                  ==\r\n==       autobackup_hour: 2                      ==\r\n== write_preview_history: True                   ==\r\n==           target_iter: 1000000                ==\r\n==           random_flip: True                   ==\r\n==            batch_size: 8                      ==\r\n==                                               ==\r\n==----------------- Running On ------------------==\r\n==                                               ==\r\n==          Device index: 0                      ==\r\n==                  Name: GeForce RTX 2060 SUPER ==\r\n==                  VRAM: 8.00GB                 ==\r\n==                                               ==\r\n===================================================\r\n[y] Use interactive merger? ( y/n ) : y\r\n[12] Number of workers? ( 1-12 ?:help ) : 6\r\n6\r\nCollecting alignments: 100%|#########################################################| 942/942 [00:18<00:00, 52.18it/s]\r\nComputing motion vectors: 100%|##################################################| 2031/2031 [00:00<00:00, 3304.05it/s]\r\nRunning on CPU4.\r\nRunning on CPU0.\r\nRunning on CPU1.\r\nRunning on CPU2.\r\nRunning on CPU3.\r\nRunning on CPU5.\r\nMerging:   0%|                                                                                | 0/2031 [00:00<?, ?it/s]\r\n\r\nno faces found for dst_000_000000.png, copying without faces\r\n\r\n\r\nMergerConfig dst_000_000000.png:\r\nMode: overlay\r\nmask_mode: learned-prd*learned-dst\r\nerode_mask_modifier: 0\r\nblur_mask_modifier: 0\r\nmotion_blur_power: 0\r\noutput_face_scale: 0\r\ncolor_transfer_mode: rct\r\nsharpen_mode : None\r\nblursharpen_amount : 0\r\nsuper_resolution_power: 0\r\nimage_denoise_power: 0\r\nbicubic_degrade_power: 0\r\ncolor_degrade_power: 0\r\n================\r\nTraceback (most recent call last):\r\n  File \"D:\\projects\\DeepFake\\Iamthearm\\DFL_smith_to_midget\\_internal\\DeepFaceLab\\mainscripts\\Merger.py\", line 208, in main\r\n    subprocess_count       = subprocess_count,\r\n  File \"D:\\projects\\DeepFake\\Iamthearm\\DFL_smith_to_midget\\_internal\\DeepFaceLab\\core\\joblib\\SubprocessorBase.py\", line 268, in run\r\n    if self.on_tick() and all ([cli.state == 0 for cli in self.clis]):\r\n  File \"D:\\projects\\DeepFake\\Iamthearm\\DFL_smith_to_midget\\_internal\\DeepFaceLab\\merger\\InteractiveMergerSubprocessor.py\", line 414, in on_tick\r\n    self.screen_manager.switch_screens()\r\n  File \"D:\\projects\\DeepFake\\Iamthearm\\DFL_smith_to_midget\\_internal\\DeepFaceLab\\merger\\MergerScreen\\MergerScreen.py\", line 140, in switch_screens\r\n    self.screens[self.current_screen_id].show(force=True)\r\n  File \"D:\\projects\\DeepFake\\Iamthearm\\DFL_smith_to_midget\\_internal\\DeepFaceLab\\merger\\MergerScreen\\MergerScreen.py\", line 105, in show\r\n    io.show_image(self.scrn_manager.wnd_name, screen)\r\n  File \"D:\\projects\\DeepFake\\Iamthearm\\DFL_smith_to_midget\\_internal\\DeepFaceLab\\core\\interact\\interact.py\", line 131, in show_image\r\n    self.on_show_image(wnd_name,img)\r\n  File \"D:\\projects\\DeepFake\\Iamthearm\\DFL_smith_to_midget\\_internal\\DeepFaceLab\\core\\interact\\interact.py\", line 466, in on_show_image\r\n    cv2.imshow (wnd_name, img)\r\ncv2.error: OpenCV(4.1.0) c:\\projects\\opencv-python\\opencv\\modules\\imgproc\\src\\color.simd_helpers.hpp:92: error: (-2:Unspecified error) in function '__cdecl cv::impl::`anonymous-namespace'::CvtHelper<struct cv::impl::`anonymous namespace'::Set<3,4,-1>,struct cv::impl::A0xe227985e::Set<3,4,-1>,struct cv::impl::A0xe227985e::Set<0,2,5>,2>::CvtHelper(const class cv::_InputArray &,const class cv::_OutputArray &,int)'\r\n> Invalid number of channels in input image:\r\n>     'VScn::contains(scn)'\r\n> where\r\n>     'scn' is 5\r\n\r\nDone.\r\nPress any key to continue . . .\r\n```","closed_by":null,"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/917/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/917/timeline","performed_via_github_app":null,"state_reason":null}