{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/910","repository_url":"https://api.github.com/repos/iperov/DeepFaceLab","labels_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/910/labels{/name}","comments_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/910/comments","events_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/910/events","html_url":"https://github.com/iperov/DeepFaceLab/issues/910","id":709510124,"node_id":"MDU6SXNzdWU3MDk1MTAxMjQ=","number":910,"title":"Training error on rtx 3090","user":{"login":"linhaohoward","id":58726712,"node_id":"MDQ6VXNlcjU4NzI2NzEy","avatar_url":"https://avatars.githubusercontent.com/u/58726712?v=4","gravatar_id":"","url":"https://api.github.com/users/linhaohoward","html_url":"https://github.com/linhaohoward","followers_url":"https://api.github.com/users/linhaohoward/followers","following_url":"https://api.github.com/users/linhaohoward/following{/other_user}","gists_url":"https://api.github.com/users/linhaohoward/gists{/gist_id}","starred_url":"https://api.github.com/users/linhaohoward/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/linhaohoward/subscriptions","organizations_url":"https://api.github.com/users/linhaohoward/orgs","repos_url":"https://api.github.com/users/linhaohoward/repos","events_url":"https://api.github.com/users/linhaohoward/events{/privacy}","received_events_url":"https://api.github.com/users/linhaohoward/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-09-26T10:11:12Z","updated_at":"2020-12-04T13:09:23Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"This is the error i'm getting. It's not an OOM issue since it works totally fine on Colab v100 16gb gpu, however it is not working on my local 24gb gpu.\r\n\r\n=============== Model Summary ===============\r\n==                                         ==\r\n==            Model name: jilamiga_SAEHD   ==\r\n==                                         ==\r\n==     Current iteration: 163395           ==\r\n==                                         ==\r\n==------------- Model Options -------------==\r\n==                                         ==\r\n==            resolution: 224              ==\r\n==             face_type: wf               ==\r\n==     models_opt_on_gpu: True             ==\r\n==                 archi: df               ==\r\n==               ae_dims: 512              ==\r\n==                e_dims: 80               ==\r\n==                d_dims: 80               ==\r\n==           d_mask_dims: 30               ==\r\n==       masked_training: False            ==\r\n==             eyes_prio: False            ==\r\n==           uniform_yaw: False            ==\r\n==            lr_dropout: n                ==\r\n==           random_warp: True             ==\r\n==             gan_power: 0.0              ==\r\n==       true_face_power: 0.0              ==\r\n==      face_style_power: 0.0              ==\r\n==        bg_style_power: 0.0              ==\r\n==               ct_mode: none             ==\r\n==              clipgrad: False            ==\r\n==              pretrain: False            ==\r\n==       autobackup_hour: 0                ==\r\n== write_preview_history: False            ==\r\n==           target_iter: 0                ==\r\n==           random_flip: False            ==\r\n==            batch_size: 4                ==\r\n==                                         ==\r\n==-------------- Running On ---------------==\r\n==                                         ==\r\n==          Device index: 0                ==\r\n==                  Name: GeForce RTX 3090 ==\r\n==                  VRAM: 24.00GB          ==\r\n==                                         ==\r\n=============================================\r\nStarting. Press \"Enter\" to stop training and save model.\r\n2020-09-26 17:59:38.642223: E tensorflow/stream_executor/cuda/cuda_blas.cc:698] failed to run cuBLAS routine cublasSgemm_v2: CUBLAS_STATUS_EXECUTION_FAILED\r\nError: Blas GEMM launch failed : a.shape=(4, 512), b.shape=(4, 100352), m=512, n=100352, k=4\r\n         [[node gradients/MatMul_5_grad/MatMul_1 (defined at D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py:55) ]]\r\n\r\nCaused by op 'gradients/MatMul_5_grad/MatMul_1', defined at:\r\n  File \"threading.py\", line 884, in _bootstrap\r\n  File \"threading.py\", line 916, in _bootstrap_inner\r\n  File \"threading.py\", line 864, in run\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 57, in trainerThread\r\n    debug=debug,\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 189, in __init__\r\n    self.on_initialize()\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 471, in on_initialize\r\n    gpu_G_loss_gvs += [ nn.gradients ( gpu_G_loss, self.src_dst_trainable_weights ) ]\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py\", line 55, in tf_gradients\r\n    grads = gradients.gradients(loss, vars, colocate_gradients_with_ops=True )\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 664, in gradients\r\n    unconnected_gradients)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 965, in _GradientsHelper\r\n    lambda: grad_fn(op, *out_grads))\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 420, in _MaybeCompile\r\n    return grad_fn()  # Exit early\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 965, in <lambda>\r\n    lambda: grad_fn(op, *out_grads))\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_grad.py\", line 1132, in _MatMulGrad\r\n    grad_b = gen_math_ops.mat_mul(a, grad, transpose_a=True)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 5333, in mat_mul\r\n    name=name)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 788, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3300, in create_op\r\n    op_def=op_def)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1801, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\n...which was originally created as op 'MatMul_5', defined at:\r\n  File \"threading.py\", line 884, in _bootstrap\r\n[elided 3 identical lines from previous traceback]\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 189, in __init__\r\n    self.on_initialize()\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 336, in on_initialize\r\n    gpu_dst_code     = self.inter(self.encoder(gpu_warped_dst))\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\models\\ModelBase.py\", line 117, in __call__\r\n    return self.forward(*args, **kwargs)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py\", line 102, in forward\r\n    x = self.dense2(x)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\layers\\LayerBase.py\", line 14, in __call__\r\n    return self.forward(*args, **kwargs)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\layers\\Dense.py\", line 66, in forward\r\n    x = tf.matmul(x, weight)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 2455, in matmul\r\n    a, b, transpose_a=transpose_a, transpose_b=transpose_b, name=name)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 5333, in mat_mul\r\n    name=name)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 788, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3300, in create_op\r\n    op_def=op_def)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1801, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\nInternalError (see above for traceback): Blas GEMM launch failed : a.shape=(4, 512), b.shape=(4, 100352), m=512, n=100352, k=4\r\n         [[node gradients/MatMul_5_grad/MatMul_1 (defined at D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py:55) ]]\r\n\r\nTraceback (most recent call last):\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1334, in _do_call\r\n    return fn(*args)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1319, in _run_fn\r\n    options, feed_dict, fetch_list, target_list, run_metadata)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1407, in _call_tf_sessionrun\r\n    run_metadata)\r\ntensorflow.python.framework.errors_impl.InternalError: Blas GEMM launch failed : a.shape=(4, 512), b.shape=(4, 100352), m=512, n=100352, k=4\r\n         [[{{node gradients/MatMul_5_grad/MatMul_1}}]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 123, in trainerThread\r\n    iter, iter_time = model.train_one_iter()\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 462, in train_one_iter\r\n    losses = self.onTrainOneIter()\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 636, in onTrainOneIter\r\n    src_loss, dst_loss = self.src_dst_train (warped_src, target_src, target_srcm_all, warped_dst, target_dst, target_dstm_all)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 503, in src_dst_train\r\n    self.target_dstm_all:target_dstm_all,\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 929, in run\r\n    run_metadata_ptr)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1152, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1328, in _do_run\r\n    run_metadata)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1348, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InternalError: Blas GEMM launch failed : a.shape=(4, 512), b.shape=(4, 100352), m=512, n=100352, k=4\r\n         [[node gradients/MatMul_5_grad/MatMul_1 (defined at D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py:55) ]]\r\n\r\nCaused by op 'gradients/MatMul_5_grad/MatMul_1', defined at:\r\n  File \"threading.py\", line 884, in _bootstrap\r\n  File \"threading.py\", line 916, in _bootstrap_inner\r\n  File \"threading.py\", line 864, in run\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\mainscripts\\Trainer.py\", line 57, in trainerThread\r\n    debug=debug,\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 189, in __init__\r\n    self.on_initialize()\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 471, in on_initialize\r\n    gpu_G_loss_gvs += [ nn.gradients ( gpu_G_loss, self.src_dst_trainable_weights ) ]\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py\", line 55, in tf_gradients\r\n    grads = gradients.gradients(loss, vars, colocate_gradients_with_ops=True )\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 664, in gradients\r\n    unconnected_gradients)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 965, in _GradientsHelper\r\n    lambda: grad_fn(op, *out_grads))\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 420, in _MaybeCompile\r\n    return grad_fn()  # Exit early\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 965, in <lambda>\r\n    lambda: grad_fn(op, *out_grads))\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_grad.py\", line 1132, in _MatMulGrad\r\n    grad_b = gen_math_ops.mat_mul(a, grad, transpose_a=True)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 5333, in mat_mul\r\n    name=name)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 788, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3300, in create_op\r\n    op_def=op_def)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1801, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\n...which was originally created as op 'MatMul_5', defined at:\r\n  File \"threading.py\", line 884, in _bootstrap\r\n[elided 3 identical lines from previous traceback]\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\ModelBase.py\", line 189, in __init__\r\n    self.on_initialize()\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\models\\Model_SAEHD\\Model.py\", line 336, in on_initialize\r\n    gpu_dst_code     = self.inter(self.encoder(gpu_warped_dst))\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\models\\ModelBase.py\", line 117, in __call__\r\n    return self.forward(*args, **kwargs)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\archis\\DeepFakeArchi.py\", line 102, in forward\r\n    x = self.dense2(x)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\layers\\LayerBase.py\", line 14, in __call__\r\n    return self.forward(*args, **kwargs)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\layers\\Dense.py\", line 66, in forward\r\n    x = tf.matmul(x, weight)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 2455, in matmul\r\n    a, b, transpose_a=transpose_a, transpose_b=transpose_b, name=name)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 5333, in mat_mul\r\n    name=name)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 788, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3300, in create_op\r\n    op_def=op_def)\r\n  File \"D:\\DeepFaceLab_NVIDIA\\_internal\\python-3.6.8\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1801, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\nInternalError (see above for traceback): Blas GEMM launch failed : a.shape=(4, 512), b.shape=(4, 100352), m=512, n=100352, k=4\r\n         [[node gradients/MatMul_5_grad/MatMul_1 (defined at D:\\DeepFaceLab_NVIDIA\\_internal\\DeepFaceLab\\core\\leras\\ops\\__init__.py:55) ]]\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/910/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/iperov/DeepFaceLab/issues/910/timeline","performed_via_github_app":null,"state_reason":null}