[{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440691935","html_url":"https://github.com/f90/Wave-U-Net/issues/13#issuecomment-440691935","issue_url":"https://api.github.com/repos/f90/Wave-U-Net/issues/13","id":440691935,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDY5MTkzNQ==","user":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"created_at":"2018-11-21T14:55:19Z","updated_at":"2018-11-21T14:55:19Z","author_association":"OWNER","body":"A couple of notes on this:\r\n1. CPU is much slower than GPU and this is to be expected, since the required operations run much faster on the GPU. So this has nothing to do with my project specifically\r\n2. If you use 22KHz models instead of the 44KHz one, your speed will double, since there is only half the number of samples in the audio to process, so that might help if you care about speed more\r\n3. I programmed the inference in a very \"safe\" way that is not particularly fast - using only one CPU/GPU with a batch size of 1, so essentially no parallelism. This ensures the model predicts exactly the way I need it to. \r\n\r\nSo I could speed this up by quite a lot, probably bringing it down to only 2-3secs on GPU per song, but I would risk introducing new errors in the process. So the main question would be - how important/sufficient is the prediction speed for people that use this repository? So far I did not get any complaints about speed, but if you show a common use case that requires more speed to be feasible, please present it and, if others also indicate that they would like to have this, I can consider putting in some speed-ups. But Multi-GPU training and prediction for example is not super straightforward to code, so I decided to avoid that in favour of keeping correct, readable code that can be adapted by people to their own needs easily.","reactions":{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440691935/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false}},{"id":1980274365,"node_id":"MDEyOkxhYmVsZWRFdmVudDE5ODAyNzQzNjU=","url":"https://api.github.com/repos/f90/Wave-U-Net/issues/events/1980274365","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-11-21T14:56:19Z","label":{"name":"question","color":"d876e3"},"performed_via_github_app":null},{"id":1980278408,"node_id":"MDEyOkxhYmVsZWRFdmVudDE5ODAyNzg0MDg=","url":"https://api.github.com/repos/f90/Wave-U-Net/issues/events/1980278408","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-11-21T14:57:48Z","label":{"name":"improvement","color":"3647db"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440696260","html_url":"https://github.com/f90/Wave-U-Net/issues/13#issuecomment-440696260","issue_url":"https://api.github.com/repos/f90/Wave-U-Net/issues/13","id":440696260,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDY5NjI2MA==","user":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"created_at":"2018-11-21T15:05:33Z","updated_at":"2018-11-21T15:35:02Z","author_association":"OWNER","body":"The part where prediction for an input song is made is actually here:\r\n\r\nhttps://github.com/f90/Wave-U-Net/blob/master/Evaluate.py#L109\r\n\r\nWhat could be changed without a lot of effort would be to change batch size from 1 to the default (16), however that also means prediction requires more RAM/GPU memory. We would have to make sure though that prediction still works exactly the same way as before. Also I am not so sure how much it speeds up prediction especially on CPU.\r\n\r\nMulti-GPU implementation is also possible, but requires a bit more effort to get right. Keep in mind this is also all supposed to work right out of the gate without people having to configure the GPU setup.\r\n\r\nIn case someone wants to provide such fast implementations, I am all ears.","reactions":{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440696260/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440715369","html_url":"https://github.com/f90/Wave-U-Net/issues/13#issuecomment-440715369","issue_url":"https://api.github.com/repos/f90/Wave-U-Net/issues/13","id":440715369,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDcxNTM2OQ==","user":{"login":"loretoparisi","id":163333,"node_id":"MDQ6VXNlcjE2MzMzMw==","avatar_url":"https://avatars.githubusercontent.com/u/163333?v=4","gravatar_id":"","url":"https://api.github.com/users/loretoparisi","html_url":"https://github.com/loretoparisi","followers_url":"https://api.github.com/users/loretoparisi/followers","following_url":"https://api.github.com/users/loretoparisi/following{/other_user}","gists_url":"https://api.github.com/users/loretoparisi/gists{/gist_id}","starred_url":"https://api.github.com/users/loretoparisi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/loretoparisi/subscriptions","organizations_url":"https://api.github.com/users/loretoparisi/orgs","repos_url":"https://api.github.com/users/loretoparisi/repos","events_url":"https://api.github.com/users/loretoparisi/events{/privacy}","received_events_url":"https://api.github.com/users/loretoparisi/received_events","type":"User","site_admin":false},"created_at":"2018-11-21T15:52:24Z","updated_at":"2018-11-21T15:59:50Z","author_association":"NONE","body":"@f90 thank you, currently I'm using the latest model `cfg.full_44KHz`, and the config was\r\n\r\n```\r\n{u'num_frames': 16384, u'num_sources': 2, u'musdb_path': u'/home/daniel/Datasets/MUSDB18', u'merge_filter_size': 5, u'num_layers': 12, u'duration': 2, u'estimates_path': u'/mnt/windaten/Source_Estimates', u'network': u'unet', u'log_dir': u'logs', u'expected_sr': 44100, u'init_sup_sep_lr': 0.0001, u'worse_epochs': 20, u'num_workers': 6, u'num_initial_filters': 24, u'raw_audio_loss': True, u'augmentation': True, u'batch_size': 16, u'mono_downmix': False, u'task': u'voice', u'filter_size': 15, u'epoch_it': 2000, u'upsampling': u'learned', u'num_channels': 2, u'context': True, u'cache_size': 16, u'output_type': u'difference', u'min_replacement_rate': 16, u'model_base_dir': u'checkpoints'}\r\n```\r\n\r\nSo have a `batch_size` of 16 already. I have tried to change `num_workers` to 12, but the processing time it's the same (CPU):\r\n\r\n```\r\nPre-trained model restored for song prediction\r\nINFO - Waveunet Prediction - Completed after 0:03:31\r\n```","reactions":{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440715369/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"loretoparisi","id":163333,"node_id":"MDQ6VXNlcjE2MzMzMw==","avatar_url":"https://avatars.githubusercontent.com/u/163333?v=4","gravatar_id":"","url":"https://api.github.com/users/loretoparisi","html_url":"https://github.com/loretoparisi","followers_url":"https://api.github.com/users/loretoparisi/followers","following_url":"https://api.github.com/users/loretoparisi/following{/other_user}","gists_url":"https://api.github.com/users/loretoparisi/gists{/gist_id}","starred_url":"https://api.github.com/users/loretoparisi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/loretoparisi/subscriptions","organizations_url":"https://api.github.com/users/loretoparisi/orgs","repos_url":"https://api.github.com/users/loretoparisi/repos","events_url":"https://api.github.com/users/loretoparisi/events{/privacy}","received_events_url":"https://api.github.com/users/loretoparisi/received_events","type":"User","site_admin":false}},{"id":1980432589,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTk4MDQzMjU4OQ==","url":"https://api.github.com/repos/f90/Wave-U-Net/issues/events/1980432589","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-11-21T15:52:24Z","performed_via_github_app":null},{"id":1980432590,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE5ODA0MzI1OTA=","url":"https://api.github.com/repos/f90/Wave-U-Net/issues/events/1980432590","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-11-21T15:52:24Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440720224","html_url":"https://github.com/f90/Wave-U-Net/issues/13#issuecomment-440720224","issue_url":"https://api.github.com/repos/f90/Wave-U-Net/issues/13","id":440720224,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDcyMDIyNA==","user":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"created_at":"2018-11-21T16:06:03Z","updated_at":"2018-11-21T16:07:32Z","author_association":"OWNER","body":"> So have a `batch_size` of 16 already. I have tried to change `num_workers` to 12, but the processing time it's the same (CPU):\r\n\r\nThis is expected. ``num_workers`` is just for fetching input randomly from your music database while training, so this has no effect on prediction. ``batch_size`` is internally always set to 1 for prediction regardless of what you set, so this has currently no effect. It would be possible to change this, and I would expect you to see some speed-up, but maybe mostly when using a GPU since it can process in parallel well.\r\n\r\nOut of interest, what's your CPU usage while predicting? Is it only using a single core, or multiple ones? If it is already using all available cores at 100% then CPU can not be sped up further by changing the code. If not, then maybe using a larger batch size can improve things, but only if Tensorflow is implemented such that it parallelises automatically across multiple CPU cores when processing a whole batch of samples - and I am not sure of that","reactions":{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440720224/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440721876","html_url":"https://github.com/f90/Wave-U-Net/issues/13#issuecomment-440721876","issue_url":"https://api.github.com/repos/f90/Wave-U-Net/issues/13","id":440721876,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDcyMTg3Ng==","user":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"created_at":"2018-11-21T16:10:41Z","updated_at":"2018-11-21T16:11:01Z","author_association":"OWNER","body":"There would also be the issue when implementing support for any ``batch_size`` for prediction that the best value is the largest one that still does not lead your particular GPU/RAM to a memory overflow. So essentially the default would still have to be left at 1 to be sure it works for almost everyone right away, then people would have to increase their values on their own to find out when it breaks. So due to all these issues I am not sure whether this is worth the potential speed improvement when it works fairly quickly on a single GPU already...","reactions":{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440721876/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440742035","html_url":"https://github.com/f90/Wave-U-Net/issues/13#issuecomment-440742035","issue_url":"https://api.github.com/repos/f90/Wave-U-Net/issues/13","id":440742035,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDc0MjAzNQ==","user":{"login":"loretoparisi","id":163333,"node_id":"MDQ6VXNlcjE2MzMzMw==","avatar_url":"https://avatars.githubusercontent.com/u/163333?v=4","gravatar_id":"","url":"https://api.github.com/users/loretoparisi","html_url":"https://github.com/loretoparisi","followers_url":"https://api.github.com/users/loretoparisi/followers","following_url":"https://api.github.com/users/loretoparisi/following{/other_user}","gists_url":"https://api.github.com/users/loretoparisi/gists{/gist_id}","starred_url":"https://api.github.com/users/loretoparisi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/loretoparisi/subscriptions","organizations_url":"https://api.github.com/users/loretoparisi/orgs","repos_url":"https://api.github.com/users/loretoparisi/repos","events_url":"https://api.github.com/users/loretoparisi/events{/privacy}","received_events_url":"https://api.github.com/users/loretoparisi/received_events","type":"User","site_admin":false},"created_at":"2018-11-21T17:09:23Z","updated_at":"2018-11-21T17:09:23Z","author_association":"NONE","body":"@f90 ok just realized that this is hardcoded here\r\n\r\n```python\r\n# Batch size of 1\r\n    sep_input_shape[0] = 1\r\n    sep_output_shape[0] = 1\r\n\r\n    mix_context, sources = Input.get_multitrack_placeholders(sep_output_shape, model_config[\"num_sources\"], sep_input_shape, \"input\")\r\n```\r\n\r\nso to change `batch_size` here I should change the `sep_input_shape`.\r\n","reactions":{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440742035/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"loretoparisi","id":163333,"node_id":"MDQ6VXNlcjE2MzMzMw==","avatar_url":"https://avatars.githubusercontent.com/u/163333?v=4","gravatar_id":"","url":"https://api.github.com/users/loretoparisi","html_url":"https://github.com/loretoparisi","followers_url":"https://api.github.com/users/loretoparisi/followers","following_url":"https://api.github.com/users/loretoparisi/following{/other_user}","gists_url":"https://api.github.com/users/loretoparisi/gists{/gist_id}","starred_url":"https://api.github.com/users/loretoparisi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/loretoparisi/subscriptions","organizations_url":"https://api.github.com/users/loretoparisi/orgs","repos_url":"https://api.github.com/users/loretoparisi/repos","events_url":"https://api.github.com/users/loretoparisi/events{/privacy}","received_events_url":"https://api.github.com/users/loretoparisi/received_events","type":"User","site_admin":false}},{"id":1980642496,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTk4MDY0MjQ5Ng==","url":"https://api.github.com/repos/f90/Wave-U-Net/issues/events/1980642496","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-11-21T17:09:23Z","performed_via_github_app":null},{"id":1980642497,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE5ODA2NDI0OTc=","url":"https://api.github.com/repos/f90/Wave-U-Net/issues/events/1980642497","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-11-21T17:09:23Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440744519","html_url":"https://github.com/f90/Wave-U-Net/issues/13#issuecomment-440744519","issue_url":"https://api.github.com/repos/f90/Wave-U-Net/issues/13","id":440744519,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDc0NDUxOQ==","user":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"created_at":"2018-11-21T17:16:42Z","updated_at":"2018-11-21T17:16:42Z","author_association":"OWNER","body":"> @f90 ok just realized that this is hardcoded here\r\n> \r\n> ```python\r\n> # Batch size of 1\r\n>     sep_input_shape[0] = 1\r\n>     sep_output_shape[0] = 1\r\n> \r\n>     mix_context, sources = Input.get_multitrack_placeholders(sep_output_shape, model_config[\"num_sources\"], sep_input_shape, \"input\")\r\n> ```\r\n> \r\n> so to change `batch_size` here I should change the `sep_input_shape`.\r\n\r\nBe aware that changing the code there means that the internal code further down has to be adapted as well though, since it assumes that we insert one audio segment and get predictions for one back, not multiple. \r\nI am talking about the ``predict_track`` method in particular, where I am basically iterating over the input audio, taking a chunk, predicting the sources, and append the output chunk to the overall output audio. If we do that in batches, we need to collect a bunch of these segments in a loop to fill a batch, predict a batch, then append the outputs in the correct order, and then continue iterating over the input audio, until we have nothing left. However we might end up with only a few segments at the end that do not fill up a complete batch, in that case we would have to pad the batch with zeros...\r\n\r\nIf i have some time for this, and there is sufficient need indicated from all of you (leave a like/comment here to show that) then I will come around to implement that. I would keep the standard setting to a batch size of 1 though to make sure prediction still works even on small systems.","reactions":{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440744519/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false}},{"id":1980660499,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTk4MDY2MDQ5OQ==","url":"https://api.github.com/repos/f90/Wave-U-Net/issues/events/1980660499","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-11-21T17:16:42Z","performed_via_github_app":null},{"id":1980660500,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE5ODA2NjA1MDA=","url":"https://api.github.com/repos/f90/Wave-U-Net/issues/events/1980660500","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-11-21T17:16:42Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440746599","html_url":"https://github.com/f90/Wave-U-Net/issues/13#issuecomment-440746599","issue_url":"https://api.github.com/repos/f90/Wave-U-Net/issues/13","id":440746599,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDc0NjU5OQ==","user":{"login":"loretoparisi","id":163333,"node_id":"MDQ6VXNlcjE2MzMzMw==","avatar_url":"https://avatars.githubusercontent.com/u/163333?v=4","gravatar_id":"","url":"https://api.github.com/users/loretoparisi","html_url":"https://github.com/loretoparisi","followers_url":"https://api.github.com/users/loretoparisi/followers","following_url":"https://api.github.com/users/loretoparisi/following{/other_user}","gists_url":"https://api.github.com/users/loretoparisi/gists{/gist_id}","starred_url":"https://api.github.com/users/loretoparisi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/loretoparisi/subscriptions","organizations_url":"https://api.github.com/users/loretoparisi/orgs","repos_url":"https://api.github.com/users/loretoparisi/repos","events_url":"https://api.github.com/users/loretoparisi/events{/privacy}","received_events_url":"https://api.github.com/users/loretoparisi/received_events","type":"User","site_admin":false},"created_at":"2018-11-21T17:22:44Z","updated_at":"2018-11-21T17:22:44Z","author_association":"NONE","body":"@f90 ok thank you very much it makes sense.","reactions":{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/440746599/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"loretoparisi","id":163333,"node_id":"MDQ6VXNlcjE2MzMzMw==","avatar_url":"https://avatars.githubusercontent.com/u/163333?v=4","gravatar_id":"","url":"https://api.github.com/users/loretoparisi","html_url":"https://github.com/loretoparisi","followers_url":"https://api.github.com/users/loretoparisi/followers","following_url":"https://api.github.com/users/loretoparisi/following{/other_user}","gists_url":"https://api.github.com/users/loretoparisi/gists{/gist_id}","starred_url":"https://api.github.com/users/loretoparisi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/loretoparisi/subscriptions","organizations_url":"https://api.github.com/users/loretoparisi/orgs","repos_url":"https://api.github.com/users/loretoparisi/repos","events_url":"https://api.github.com/users/loretoparisi/events{/privacy}","received_events_url":"https://api.github.com/users/loretoparisi/received_events","type":"User","site_admin":false}},{"id":1980674563,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTk4MDY3NDU2Mw==","url":"https://api.github.com/repos/f90/Wave-U-Net/issues/events/1980674563","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-11-21T17:22:44Z","performed_via_github_app":null},{"id":1980674565,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE5ODA2NzQ1NjU=","url":"https://api.github.com/repos/f90/Wave-U-Net/issues/events/1980674565","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-11-21T17:22:44Z","performed_via_github_app":null},{"id":1980764088,"node_id":"MDEyOkxhYmVsZWRFdmVudDE5ODA3NjQwODg=","url":"https://api.github.com/repos/f90/Wave-U-Net/issues/events/1980764088","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-11-21T18:01:06Z","label":{"name":"feedback wanted","color":"008672"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/446879713","html_url":"https://github.com/f90/Wave-U-Net/issues/13#issuecomment-446879713","issue_url":"https://api.github.com/repos/f90/Wave-U-Net/issues/13","id":446879713,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Njg3OTcxMw==","user":{"login":"radkoff","id":2755667,"node_id":"MDQ6VXNlcjI3NTU2Njc=","avatar_url":"https://avatars.githubusercontent.com/u/2755667?v=4","gravatar_id":"","url":"https://api.github.com/users/radkoff","html_url":"https://github.com/radkoff","followers_url":"https://api.github.com/users/radkoff/followers","following_url":"https://api.github.com/users/radkoff/following{/other_user}","gists_url":"https://api.github.com/users/radkoff/gists{/gist_id}","starred_url":"https://api.github.com/users/radkoff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/radkoff/subscriptions","organizations_url":"https://api.github.com/users/radkoff/orgs","repos_url":"https://api.github.com/users/radkoff/repos","events_url":"https://api.github.com/users/radkoff/events{/privacy}","received_events_url":"https://api.github.com/users/radkoff/received_events","type":"User","site_admin":false},"created_at":"2018-12-13T08:16:07Z","updated_at":"2018-12-13T08:16:07Z","author_association":"NONE","body":"I'm also interested in a speed-up, but I'm not sure it's possible since my CPU is already using all cores","reactions":{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/446879713/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"radkoff","id":2755667,"node_id":"MDQ6VXNlcjI3NTU2Njc=","avatar_url":"https://avatars.githubusercontent.com/u/2755667?v=4","gravatar_id":"","url":"https://api.github.com/users/radkoff","html_url":"https://github.com/radkoff","followers_url":"https://api.github.com/users/radkoff/followers","following_url":"https://api.github.com/users/radkoff/following{/other_user}","gists_url":"https://api.github.com/users/radkoff/gists{/gist_id}","starred_url":"https://api.github.com/users/radkoff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/radkoff/subscriptions","organizations_url":"https://api.github.com/users/radkoff/orgs","repos_url":"https://api.github.com/users/radkoff/repos","events_url":"https://api.github.com/users/radkoff/events{/privacy}","received_events_url":"https://api.github.com/users/radkoff/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/447020032","html_url":"https://github.com/f90/Wave-U-Net/issues/13#issuecomment-447020032","issue_url":"https://api.github.com/repos/f90/Wave-U-Net/issues/13","id":447020032,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzAyMDAzMg==","user":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"created_at":"2018-12-13T15:57:00Z","updated_at":"2018-12-13T15:57:00Z","author_association":"OWNER","body":"OK so i looked into this a bit more, I implemented a batched variant of prediction and compared running times for a 3 minute input piece. Results:\r\n\r\nGPU (1x GTX1080)\r\n- Current version: 5.71s\r\n- Batched version: 4.57s\r\n\r\nCPU\r\n- Current version: 161.15s\r\n- Batched version: 157.21s\r\n\r\nThese numbers give the time spent within the ``predict_track`` method. \r\n\r\nThe batched version also gave memory warnings for CPU, and was using all my CPU cores at once, so it is not surprising a speedup cannot be achieved this way.\r\n\r\nSo, to summarise:\r\n- GPU is MUCH faster than CPU\r\n- CPU implementation is already parallelised, so no performance gains possible by batched prediction\r\n- GPU implementation doesn't really benefit from batching either\r\n\r\nIf prediction time is an issue for you, it can be reduced by\r\n1) switching to GPU from CPU\r\n2) using a model at a lower sampling rate (e.g. if using 22KHz model instead of 44KHz, it will also predict twice as fast)\r\n3) maybe some fancy neural network distillation/compression methods? This is definitely out of the scope of this project though...\r\n\r\nGoing to close this soon unless there are some good ideas how to improve this otherwise.","reactions":{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/447020032/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/447040772","html_url":"https://github.com/f90/Wave-U-Net/issues/13#issuecomment-447040772","issue_url":"https://api.github.com/repos/f90/Wave-U-Net/issues/13","id":447040772,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzA0MDc3Mg==","user":{"login":"shoegazerstella","id":22822597,"node_id":"MDQ6VXNlcjIyODIyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/22822597?v=4","gravatar_id":"","url":"https://api.github.com/users/shoegazerstella","html_url":"https://github.com/shoegazerstella","followers_url":"https://api.github.com/users/shoegazerstella/followers","following_url":"https://api.github.com/users/shoegazerstella/following{/other_user}","gists_url":"https://api.github.com/users/shoegazerstella/gists{/gist_id}","starred_url":"https://api.github.com/users/shoegazerstella/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shoegazerstella/subscriptions","organizations_url":"https://api.github.com/users/shoegazerstella/orgs","repos_url":"https://api.github.com/users/shoegazerstella/repos","events_url":"https://api.github.com/users/shoegazerstella/events{/privacy}","received_events_url":"https://api.github.com/users/shoegazerstella/received_events","type":"User","site_admin":false},"created_at":"2018-12-13T16:52:06Z","updated_at":"2018-12-13T16:53:57Z","author_association":"NONE","body":"Hi @f90 ,\r\nI am using GPU + the 44kHz model but I am only predicting 30s of audio at a time. So my times are around 2.66 seconds.\r\nAny chances you could share the batched variant you mentioned above? \r\nThanks a lot for your help and advices!","reactions":{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/447040772/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"shoegazerstella","id":22822597,"node_id":"MDQ6VXNlcjIyODIyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/22822597?v=4","gravatar_id":"","url":"https://api.github.com/users/shoegazerstella","html_url":"https://github.com/shoegazerstella","followers_url":"https://api.github.com/users/shoegazerstella/followers","following_url":"https://api.github.com/users/shoegazerstella/following{/other_user}","gists_url":"https://api.github.com/users/shoegazerstella/gists{/gist_id}","starred_url":"https://api.github.com/users/shoegazerstella/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shoegazerstella/subscriptions","organizations_url":"https://api.github.com/users/shoegazerstella/orgs","repos_url":"https://api.github.com/users/shoegazerstella/repos","events_url":"https://api.github.com/users/shoegazerstella/events{/privacy}","received_events_url":"https://api.github.com/users/shoegazerstella/received_events","type":"User","site_admin":false}},{"id":2024758353,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjAyNDc1ODM1Mw==","url":"https://api.github.com/repos/f90/Wave-U-Net/issues/events/2024758353","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-12-13T16:52:06Z","performed_via_github_app":null},{"id":2024758354,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIwMjQ3NTgzNTQ=","url":"https://api.github.com/repos/f90/Wave-U-Net/issues/events/2024758354","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-12-13T16:52:06Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/447071350","html_url":"https://github.com/f90/Wave-U-Net/issues/13#issuecomment-447071350","issue_url":"https://api.github.com/repos/f90/Wave-U-Net/issues/13","id":447071350,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzA3MTM1MA==","user":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"created_at":"2018-12-13T18:28:32Z","updated_at":"2018-12-13T18:28:32Z","author_association":"OWNER","body":"I am curious why you expect any improvements with the batched version. But if you want to experiment with it, replace the ``predict_track`` function with this version of it in the code. If it turns out better, just tell me and I can push it to the repository for everyone.\r\n\r\nAlso you have to comment out\r\n```\r\n    # Batch size of 1\r\n    sep_input_shape[0] = 1\r\n    sep_output_shape[0] = 1\r\n```\r\n\r\nfound in ``predict`` function.\r\n\r\n```\r\ndef predict_track(model_config, sess, mix_audio, mix_sr, sep_input_shape, sep_output_shape, separator_sources, mix_context):\r\n    '''\r\n    Outputs source estimates for a given input mixture signal mix_audio [n_frames, n_channels] and a given Tensorflow session and placeholders belonging to the prediction network.\r\n    It iterates through the track, collecting segment-wise predictions to form the output.\r\n    :param model_config: Model configuration dictionary\r\n    :param sess: Tensorflow session used to run the network inference\r\n    :param mix_audio: [n_frames, n_channels] audio signal (numpy array). Can have higher sampling rate or channels than the model supports, will be downsampled correspondingly.\r\n    :param mix_sr: Sampling rate of mix_audio\r\n    :param sep_input_shape: Input shape of separator ([batch_size, num_samples, num_channels])\r\n    :param sep_output_shape: Input shape of separator ([batch_size, num_samples, num_channels])\r\n    :param separator_sources: List of Tensorflow tensors that represent the output of the separator network\r\n    :param mix_context: Input tensor of the network\r\n    :return: \r\n    '''\r\n    # Load mixture, convert to mono and downsample then\r\n    assert(len(mix_audio.shape) == 2)\r\n    if model_config[\"mono_downmix\"]:\r\n        mix_audio = np.mean(mix_audio, axis=1, keepdims=True)\r\n    else:\r\n        if mix_audio.shape[1] == 1:# Duplicate channels if input is mono but model is stereo\r\n            mix_audio = np.tile(mix_audio, [1, 2])\r\n    mix_audio = Utils.resample(mix_audio, mix_sr, model_config[\"expected_sr\"])\r\n\r\n    # Preallocate source predictions (same shape as input mixture)\r\n    source_time_frames = mix_audio.shape[0]\r\n    source_preds = [np.zeros(mix_audio.shape, np.float32) for _ in range(model_config[\"num_sources\"])]\r\n\r\n    input_time_frames = sep_input_shape[1]\r\n    output_time_frames = sep_output_shape[1]\r\n\r\n    # Pad mixture across time at beginning and end so that neural network can make prediction at the beginning and end of signal\r\n    pad_time_frames = (input_time_frames - output_time_frames) / 2\r\n    mix_audio_padded = np.pad(mix_audio, [(pad_time_frames, pad_time_frames), (0,0)], mode=\"constant\", constant_values=0.0)\r\n\r\n    # Iterate over mixture magnitudes, fetch network predictions\r\n    mixes = list()\r\n    start_end_times = list()\r\n    for source_pos in range(0, source_time_frames, output_time_frames):\r\n        # If this output patch would reach over the end of the source spectrogram, set it so we predict the very end of the output, then stop\r\n        if source_pos + output_time_frames > source_time_frames:\r\n            source_pos = source_time_frames - output_time_frames\r\n\r\n        # Prepare mixture excerpt by selecting time interval\r\n        mix_part = mix_audio_padded[source_pos:source_pos + input_time_frames,:]\r\n        mixes.append(mix_part)\r\n        start_end_times.append((source_pos, source_pos + output_time_frames))\r\n\r\n    # Make predictions\r\n    for mix_num in range(0, len(mixes), model_config[\"batch_size\"]):\r\n        if mix_num + model_config[\"batch_size\"] < len(mixes):\r\n            batch = np.stack(mixes[mix_num:mix_num + model_config[\"batch_size\"]])\r\n        else:\r\n            batch = np.stack(mixes[mix_num:] + [np.zeros(mixes[0].shape) for _ in range(mix_num + model_config[\"batch_size\"] - len(mixes))])\r\n\r\n        source_parts = sess.run(separator_sources, feed_dict={mix_context: batch})\r\n\r\n        # Save predictions\r\n        # source_shape = [1, freq_bins, acc_mag_part.shape[2], num_chan]\r\n        for out_num in range(mix_num, min(mix_num + model_config[\"batch_size\"], len(mixes))):\r\n            batch_num = out_num - mix_num\r\n            for i in range(model_config[\"num_sources\"]):\r\n                source_preds[i][start_end_times[out_num][0] : start_end_times[out_num][1]] = source_parts[i][batch_num, :, :]\r\n                \r\n    return source_preds\r\n```","reactions":{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/447071350/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/448799111","html_url":"https://github.com/f90/Wave-U-Net/issues/13#issuecomment-448799111","issue_url":"https://api.github.com/repos/f90/Wave-U-Net/issues/13","id":448799111,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODc5OTExMQ==","user":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"created_at":"2018-12-20T00:07:41Z","updated_at":"2018-12-20T00:07:41Z","author_association":"OWNER","body":"Going to close this issue soon if I don't get any reports on the above code snippet bringing much benefit in terms of prediction speed...","reactions":{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/448799111/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/448919670","html_url":"https://github.com/f90/Wave-U-Net/issues/13#issuecomment-448919670","issue_url":"https://api.github.com/repos/f90/Wave-U-Net/issues/13","id":448919670,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODkxOTY3MA==","user":{"login":"loretoparisi","id":163333,"node_id":"MDQ6VXNlcjE2MzMzMw==","avatar_url":"https://avatars.githubusercontent.com/u/163333?v=4","gravatar_id":"","url":"https://api.github.com/users/loretoparisi","html_url":"https://github.com/loretoparisi","followers_url":"https://api.github.com/users/loretoparisi/followers","following_url":"https://api.github.com/users/loretoparisi/following{/other_user}","gists_url":"https://api.github.com/users/loretoparisi/gists{/gist_id}","starred_url":"https://api.github.com/users/loretoparisi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/loretoparisi/subscriptions","organizations_url":"https://api.github.com/users/loretoparisi/orgs","repos_url":"https://api.github.com/users/loretoparisi/repos","events_url":"https://api.github.com/users/loretoparisi/events{/privacy}","received_events_url":"https://api.github.com/users/loretoparisi/received_events","type":"User","site_admin":false},"created_at":"2018-12-20T08:47:56Z","updated_at":"2018-12-20T08:47:56Z","author_association":"NONE","body":"@f90 thanks a lot, we are going to try this asap!","reactions":{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/448919670/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"loretoparisi","id":163333,"node_id":"MDQ6VXNlcjE2MzMzMw==","avatar_url":"https://avatars.githubusercontent.com/u/163333?v=4","gravatar_id":"","url":"https://api.github.com/users/loretoparisi","html_url":"https://github.com/loretoparisi","followers_url":"https://api.github.com/users/loretoparisi/followers","following_url":"https://api.github.com/users/loretoparisi/following{/other_user}","gists_url":"https://api.github.com/users/loretoparisi/gists{/gist_id}","starred_url":"https://api.github.com/users/loretoparisi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/loretoparisi/subscriptions","organizations_url":"https://api.github.com/users/loretoparisi/orgs","repos_url":"https://api.github.com/users/loretoparisi/repos","events_url":"https://api.github.com/users/loretoparisi/events{/privacy}","received_events_url":"https://api.github.com/users/loretoparisi/received_events","type":"User","site_admin":false}},{"id":2037773090,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjAzNzc3MzA5MA==","url":"https://api.github.com/repos/f90/Wave-U-Net/issues/events/2037773090","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-12-20T08:47:56Z","performed_via_github_app":null},{"id":2037773092,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIwMzc3NzMwOTI=","url":"https://api.github.com/repos/f90/Wave-U-Net/issues/events/2037773092","actor":{"login":"f90","id":23065103,"node_id":"MDQ6VXNlcjIzMDY1MTAz","avatar_url":"https://avatars.githubusercontent.com/u/23065103?v=4","gravatar_id":"","url":"https://api.github.com/users/f90","html_url":"https://github.com/f90","followers_url":"https://api.github.com/users/f90/followers","following_url":"https://api.github.com/users/f90/following{/other_user}","gists_url":"https://api.github.com/users/f90/gists{/gist_id}","starred_url":"https://api.github.com/users/f90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/f90/subscriptions","organizations_url":"https://api.github.com/users/f90/orgs","repos_url":"https://api.github.com/users/f90/repos","events_url":"https://api.github.com/users/f90/events{/privacy}","received_events_url":"https://api.github.com/users/f90/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-12-20T08:47:56Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/449716433","html_url":"https://github.com/f90/Wave-U-Net/issues/13#issuecomment-449716433","issue_url":"https://api.github.com/repos/f90/Wave-U-Net/issues/13","id":449716433,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0OTcxNjQzMw==","user":{"login":"shoegazerstella","id":22822597,"node_id":"MDQ6VXNlcjIyODIyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/22822597?v=4","gravatar_id":"","url":"https://api.github.com/users/shoegazerstella","html_url":"https://github.com/shoegazerstella","followers_url":"https://api.github.com/users/shoegazerstella/followers","following_url":"https://api.github.com/users/shoegazerstella/following{/other_user}","gists_url":"https://api.github.com/users/shoegazerstella/gists{/gist_id}","starred_url":"https://api.github.com/users/shoegazerstella/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shoegazerstella/subscriptions","organizations_url":"https://api.github.com/users/shoegazerstella/orgs","repos_url":"https://api.github.com/users/shoegazerstella/repos","events_url":"https://api.github.com/users/shoegazerstella/events{/privacy}","received_events_url":"https://api.github.com/users/shoegazerstella/received_events","type":"User","site_admin":false},"created_at":"2018-12-24T10:34:07Z","updated_at":"2018-12-24T10:34:07Z","author_association":"NONE","body":"You were right, this does not bring improvements in terms of speed.\r\nBy 'batch' I thought you meant a batch of multiple signals, not 1 single audio in batch, that's why I thought the prediction could be speeded up.\r\nNot sure I'll have time soon to experiment more with this, I'll let you know if I have some improvements, feel free to close the issue.","reactions":{"url":"https://api.github.com/repos/f90/Wave-U-Net/issues/comments/449716433/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"shoegazerstella","id":22822597,"node_id":"MDQ6VXNlcjIyODIyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/22822597?v=4","gravatar_id":"","url":"https://api.github.com/users/shoegazerstella","html_url":"https://github.com/shoegazerstella","followers_url":"https://api.github.com/users/shoegazerstella/followers","following_url":"https://api.github.com/users/shoegazerstella/following{/other_user}","gists_url":"https://api.github.com/users/shoegazerstella/gists{/gist_id}","starred_url":"https://api.github.com/users/shoegazerstella/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shoegazerstella/subscriptions","organizations_url":"https://api.github.com/users/shoegazerstella/orgs","repos_url":"https://api.github.com/users/shoegazerstella/repos","events_url":"https://api.github.com/users/shoegazerstella/events{/privacy}","received_events_url":"https://api.github.com/users/shoegazerstella/received_events","type":"User","site_admin":false}}]