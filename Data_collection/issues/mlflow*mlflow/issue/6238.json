{"url":"https://api.github.com/repos/mlflow/mlflow/issues/6238","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/6238/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/6238/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/6238/events","html_url":"https://github.com/mlflow/mlflow/issues/6238","id":1303197184,"node_id":"I_kwDOCB5Jx85NrTYA","number":6238,"title":"FileNotFoundError when running mlflow sagemaker deploy ","user":{"login":"hollytb","id":36595840,"node_id":"MDQ6VXNlcjM2NTk1ODQw","avatar_url":"https://avatars.githubusercontent.com/u/36595840?v=4","gravatar_id":"","url":"https://api.github.com/users/hollytb","html_url":"https://github.com/hollytb","followers_url":"https://api.github.com/users/hollytb/followers","following_url":"https://api.github.com/users/hollytb/following{/other_user}","gists_url":"https://api.github.com/users/hollytb/gists{/gist_id}","starred_url":"https://api.github.com/users/hollytb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hollytb/subscriptions","organizations_url":"https://api.github.com/users/hollytb/orgs","repos_url":"https://api.github.com/users/hollytb/repos","events_url":"https://api.github.com/users/hollytb/events{/privacy}","received_events_url":"https://api.github.com/users/hollytb/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2022-07-13T09:57:18Z","updated_at":"2022-07-15T13:49:40Z","closed_at":"2022-07-15T13:49:40Z","author_association":"NONE","active_lock_reason":null,"body":"I run the following command:   \r\n\r\n```\r\nmlflow sagemaker deploy --app-name xformer -m mlruns/6/2172c74308064a98bb0fcfe124ef66a8/artifacts/rf_model --execution-role-arn arn:aws:iam::354640567064:role/hb_mlflow --image-url 354640567064.dkr.ecr.us-east-1.amazonaws.com/mlflow-pyfunc:1.27.0 --region-name us-east-1 --mode create`\r\nAnd receive the error:\r\n`Traceback (most recent call last):\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\Scripts\\mlflow.exe\\__main__.py\", line 7, in <module>\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\site-packages\\click\\core.py\", line 1130, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\site-packages\\click\\core.py\", line 1055, in main\r\n    rv = self.invoke(ctx)\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\site-packages\\click\\core.py\", line 1657, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\site-packages\\click\\core.py\", line 1657, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\site-packages\\click\\core.py\", line 1404, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\site-packages\\click\\core.py\", line 760, in invoke\r\n    return __callback(*args, **kwargs)\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\site-packages\\mlflow\\sagemaker\\cli.py\", line 160, in deploy\r\n    timeout_seconds=timeout,\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\site-packages\\mlflow\\sagemaker\\__init__.py\", line 368, in deploy\r\n    **assume_role_credentials,\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\site-packages\\mlflow\\sagemaker\\__init__.py\", line 1220, in _upload_s3\r\n    _make_tarfile(model_data_file, local_model_path)\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\site-packages\\mlflow\\sagemaker\\__init__.py\", line 1202, in _make_tarfile\r\n    tar.add(os.path.join(source_dir, f), arcname=f)\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\tarfile.py\", line 1951, in add\r\n    recursive, filter=filter)\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\tarfile.py\", line 1951, in add\r\n    recursive, filter=filter)\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\tarfile.py\", line 1951, in add\r\n    recursive, filter=filter)\r\n  [Previous line repeated 1 more time]\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\tarfile.py\", line 1928, in add\r\n    tarinfo = self.gettarinfo(name, arcname)\r\n  File \"C:\\Users\\bakerh\\Anaconda3\\envs\\env_py3.7\\lib\\tarfile.py\", line 1807, in gettarinfo\r\n    statres = os.lstat(name)\r\nFileNotFoundError: [WinError 3] The system cannot find the path specified: 'C:\\\\Users\\\\bakerh\\\\OneDrive\\\\Documents\\\\Projects\\\\audit-risk-model\\\\mlruns\\\\6\\\\2172c74308064a98bb0fcfe124ef66a8\\\\artifacts\\\\rf_model\\\\sparkml\\\\stages\\\\1_RandomForestRegressor_84bd4fc3b124\\\\data\\\\.part-00000-6027ef68-fad1-422e-8c17-fe45116bdfbb-c000.snappy.parquet.crc'\r\n```\r\n\r\nMy current conda env looks like:\r\n\r\n```\r\n# Name                    Version                   Build  Channel\r\nalembic                   1.8.0                    pypi_0    pypi\r\nboto3                     1.24.27                  pypi_0    pypi\r\nca-certificates           2022.4.26            haa95532_0\r\ncertifi                   2022.6.15        py37haa95532_0\r\ncharset-normalizer        2.1.0                    pypi_0    pypi\r\nclick                     8.1.3                    pypi_0    pypi\r\ncloudpickle               2.1.0                    pypi_0    pypi\r\ndatabricks-cli            0.17.0                   pypi_0    pypi\r\ndocker                    5.0.3                    pypi_0    pypi\r\nentrypoints               0.4                      pypi_0    pypi\r\nflask                     2.1.2                    pypi_0    pypi\r\ngitdb                     4.0.9                    pypi_0    pypi\r\ngitpython                 3.1.27                   pypi_0    pypi\r\ngreenlet                  1.1.2                    pypi_0    pypi\r\nidna                      3.3                      pypi_0    pypi\r\nimportlib-metadata        4.12.0                   pypi_0    pypi\r\nimportlib-resources       5.8.0                    pypi_0    pypi\r\nitsdangerous              2.1.2                    pypi_0    pypi\r\njinja2                    3.1.2                    pypi_0    pypi\r\njoblib                    1.1.0                    pypi_0    pypi\r\nmako                      1.2.1                    pypi_0    pypi\r\nmarkupsafe                2.1.1                    pypi_0    pypi\r\nmlflow                    1.27.0                   pypi_0    pypi\r\nnumpy                     1.21.6                   pypi_0    pypi\r\noauthlib                  3.2.0                    pypi_0    pypi\r\nopenssl                   1.1.1q               h2bbff1b_0\r\npackaging                 21.3                     pypi_0    pypi\r\npandas                    1.3.5                    pypi_0    pypi\r\npip                       22.1.2           py37haa95532_0\r\nprometheus-client         0.14.1                   pypi_0    pypi\r\nprometheus-flask-exporter 0.20.2                   pypi_0    pypi\r\nprotobuf                  4.21.2                   pypi_0    pypi\r\npyjwt                     2.4.0                    pypi_0    pypi\r\npyparsing                 3.0.9                    pypi_0    pypi\r\npython                    3.7.13               h6244533_0\r\npython-dateutil           2.8.2                    pypi_0    pypi\r\npytz                      2022.1                   pypi_0    pypi\r\npywin32                   227                      pypi_0    pypi\r\npyyaml                    6.0                      pypi_0    pypi\r\nquerystring-parser        1.2.4                    pypi_0    pypi\r\nrequests                  2.28.1                   pypi_0    pypi\r\nscikit-learn              1.0.2                    pypi_0    pypi\r\nscipy                     1.7.3                    pypi_0    pypi\r\nsetuptools                61.2.0           py37haa95532_0\r\nsix                       1.16.0                   pypi_0    pypi\r\nsmmap                     5.0.0                    pypi_0    pypi\r\nsqlalchemy                1.4.39                   pypi_0    pypi\r\nsqlite                    3.38.5               h2bbff1b_0\r\nsqlparse                  0.4.2                    pypi_0    pypi\r\ntabulate                  0.8.10                   pypi_0    pypi\r\nthreadpoolctl             3.1.0                    pypi_0    pypi\r\ntyping-extensions         4.3.0                    pypi_0    pypi\r\nurllib3                   1.26.10                  pypi_0    pypi\r\nvc                        14.2                 h21ff451_1\r\nvs2015_runtime            14.27.29016          h5e58377_2\r\nwaitress                  2.1.2                    pypi_0    pypi\r\nwebsocket-client          1.3.3                    pypi_0    pypi\r\nwerkzeug                  2.1.2                    pypi_0    pypi\r\nwheel                     0.37.1             pyhd3eb1b0_0\r\nwincertstore              0.2              py37haa95532_2\r\nzipp                      3.8.0                    pypi_0    pypi\r\n```\r\n\r\nI've researched online but no luck, anybody know the issue?\r\nAlso to note my current pipeline is as follows: build a docker env with two main services pyspark and mlflow ui (in the docker compose file) . Start up jupyter lab from within the pyspark cli, open the mlflow ui in the browser. Run the relative notebooks where metrics and the model is logged etc. The models artifact then appears in the mlflow ui. After this stage, I create a separate conda env with the necessary packages(listed above) to run:\r\n`mlflow sagemaker build-and-push-container` \r\n_cd into the mlruns/6/217.../artifacts/rf_model_\r\n\r\nAfter this the ECR service looks like:\r\n![image](https://user-images.githubusercontent.com/36595840/178706756-88c422ad-fc7c-4463-8085-46824ae89ed7.png)\r\nI then continue to run:\r\n`mlfllow sagemaker deploy..` \r\nThe command that is causes the above error. \r\n\r\nFor more context on this approach I took, I followed this tutorial but rather than creating a conda env in the first step, I create a docker env [https://github.com/vb100/deploy-ml-mlflow-aws/blob/main/README.md](url)","closed_by":{"login":"hollytb","id":36595840,"node_id":"MDQ6VXNlcjM2NTk1ODQw","avatar_url":"https://avatars.githubusercontent.com/u/36595840?v=4","gravatar_id":"","url":"https://api.github.com/users/hollytb","html_url":"https://github.com/hollytb","followers_url":"https://api.github.com/users/hollytb/followers","following_url":"https://api.github.com/users/hollytb/following{/other_user}","gists_url":"https://api.github.com/users/hollytb/gists{/gist_id}","starred_url":"https://api.github.com/users/hollytb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hollytb/subscriptions","organizations_url":"https://api.github.com/users/hollytb/orgs","repos_url":"https://api.github.com/users/hollytb/repos","events_url":"https://api.github.com/users/hollytb/events{/privacy}","received_events_url":"https://api.github.com/users/hollytb/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/6238/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/6238/timeline","performed_via_github_app":null,"state_reason":"completed"}