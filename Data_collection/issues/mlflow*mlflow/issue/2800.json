{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2800","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2800/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2800/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2800/events","html_url":"https://github.com/mlflow/mlflow/issues/2800","id":614620638,"node_id":"MDU6SXNzdWU2MTQ2MjA2Mzg=","number":2800,"title":"[FR] Add support for cluster library definition in MLflow project execution","user":{"login":"Shmuma","id":66154,"node_id":"MDQ6VXNlcjY2MTU0","avatar_url":"https://avatars.githubusercontent.com/u/66154?v=4","gravatar_id":"","url":"https://api.github.com/users/Shmuma","html_url":"https://github.com/Shmuma","followers_url":"https://api.github.com/users/Shmuma/followers","following_url":"https://api.github.com/users/Shmuma/following{/other_user}","gists_url":"https://api.github.com/users/Shmuma/gists{/gist_id}","starred_url":"https://api.github.com/users/Shmuma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shmuma/subscriptions","organizations_url":"https://api.github.com/users/Shmuma/orgs","repos_url":"https://api.github.com/users/Shmuma/repos","events_url":"https://api.github.com/users/Shmuma/events{/privacy}","received_events_url":"https://api.github.com/users/Shmuma/received_events","type":"User","site_admin":false},"labels":[{"id":955449434,"node_id":"MDU6TGFiZWw5NTU0NDk0MzQ=","url":"https://api.github.com/repos/mlflow/mlflow/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"},{"id":2022848510,"node_id":"MDU6TGFiZWwyMDIyODQ4NTEw","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/projects","name":"area/projects","color":"48eabc","default":false,"description":"MLproject format, project running backends"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2020-05-08T09:19:14Z","updated_at":"2020-05-21T23:35:19Z","closed_at":"2020-05-19T03:12:33Z","author_association":"NONE","active_lock_reason":null,"body":"Hi!\r\n\r\nMLFlow redefines library dependencies on databricks cluster creation. In my project, extra libraries are needed on cluster nodes, but when I'm specifying them in cluster json file, they are ignored and replaced by the single mlflow dependency. \r\n\r\nI suppose this happens in this line of code: https://github.com/mlflow/mlflow/blob/58a6053cad8d6c01f095a4e3dac8a1b560dc4a61/mlflow/projects/databricks.py#L182\r\n\r\nThis is not very flexible and doesn't allow me to install extra libraries on mlflow cluster nodes.\r\nSo, better behaviour would be to add mlflow dependency to dependency given in cluster specification file.\r\n\r\nBelow is the example of my cluster.json:\r\n```\r\n{\r\n  \"spark_conf\": {\r\n    \"spark.databricks.hive.metastore.glueCatalog.enabled\": \"true\"\r\n  },\r\n  \"libraries\": [\r\n    {\r\n      \"whl\": \"dbfs:/path_to_my_lib.whl\"\r\n    }\r\n  ],\r\n  \"num_workers\": 20\r\n}\r\n```\r\n\r\nBut my whl dependency is ignored on cluster creation. Below is the resulting cluster properties:\r\n```\r\n  \"cluster_spec\": {\r\n    \"new_cluster\": {\r\n    \"libraries\": [\r\n      {\r\n        \"pypi\": {\r\n          \"package\": \"'mlflow<=1.7.2'\"\r\n        }\r\n      }\r\n    ]\r\n  },\r\n```\r\nThanks!","closed_by":{"login":"smurching","id":2358483,"node_id":"MDQ6VXNlcjIzNTg0ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2358483?v=4","gravatar_id":"","url":"https://api.github.com/users/smurching","html_url":"https://github.com/smurching","followers_url":"https://api.github.com/users/smurching/followers","following_url":"https://api.github.com/users/smurching/following{/other_user}","gists_url":"https://api.github.com/users/smurching/gists{/gist_id}","starred_url":"https://api.github.com/users/smurching/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smurching/subscriptions","organizations_url":"https://api.github.com/users/smurching/orgs","repos_url":"https://api.github.com/users/smurching/repos","events_url":"https://api.github.com/users/smurching/events{/privacy}","received_events_url":"https://api.github.com/users/smurching/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2800/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2800/timeline","performed_via_github_app":null,"state_reason":"completed"}