{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2606","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2606/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2606/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2606/events","html_url":"https://github.com/mlflow/mlflow/issues/2606","id":584238544,"node_id":"MDU6SXNzdWU1ODQyMzg1NDQ=","number":2606,"title":"[FR] Support range requests in mlflow server","user":{"login":"ahirner","id":6055037,"node_id":"MDQ6VXNlcjYwNTUwMzc=","avatar_url":"https://avatars.githubusercontent.com/u/6055037?v=4","gravatar_id":"","url":"https://api.github.com/users/ahirner","html_url":"https://github.com/ahirner","followers_url":"https://api.github.com/users/ahirner/followers","following_url":"https://api.github.com/users/ahirner/following{/other_user}","gists_url":"https://api.github.com/users/ahirner/gists{/gist_id}","starred_url":"https://api.github.com/users/ahirner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ahirner/subscriptions","organizations_url":"https://api.github.com/users/ahirner/orgs","repos_url":"https://api.github.com/users/ahirner/repos","events_url":"https://api.github.com/users/ahirner/events{/privacy}","received_events_url":"https://api.github.com/users/ahirner/received_events","type":"User","site_admin":false},"labels":[{"id":955449434,"node_id":"MDU6TGFiZWw5NTU0NDk0MzQ=","url":"https://api.github.com/repos/mlflow/mlflow/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-03-19T08:17:29Z","updated_at":"2020-03-20T20:54:02Z","closed_at":"2020-03-20T20:54:02Z","author_association":"NONE","active_lock_reason":null,"body":"## Describe the proposal\r\nArtifact links should support range requests. `mlflow server` with a file-system store (1.7.0) errors with `fsspec`s `HTTPFileSystem` if `block_size` is None or smaller than the file (https://github.com/intake/filesystem_spec/issues/160). `fsspec` is also used by `dask`.\r\n```\r\nfrom fsspec.implementations.http import HTTPFileSystem\r\nfs = HTTPFileSystem()\r\nf = fs.open(\"http://localhost:5000/get-artifact?path=test%2Fyour_file.zip&run_uuid=4156145406a242128b30bf749a16fad0\")\r\nf.seek(10)\r\nf.read(10)\r\n```\r\nRaises:\r\n```\r\nTraceback (most recent call last):\r\n  File \"fs.py\", line 6, in <module>\r\n    f.read(10)\r\n  File \"/Users/abc/miniconda3/lib/python3.6/site-packages/fsspec/implementations/http.py\", line 278, in read\r\n    return super().read(length)\r\n  File \"/Users/abc/miniconda3/lib/python3.6/site-packages/fsspec/spec.py\", line 1130, in read\r\n    out = self.cache._fetch(self.loc, self.loc + length)\r\n  File \"/Users/abc/miniconda3/lib/python3.6/site-packages/fsspec/caching.py\", line 339, in _fetch\r\n    self.cache = self.fetcher(start, bend)\r\n  File \"/Users/abc/miniconda3/lib/python3.6/site-packages/fsspec/implementations/http.py\", line 319, in _fetch_range\r\n    \"Got more bytes (%i) than requested (%i)\" % (cl, end - start)\r\nValueError: Got more bytes (22467554) than requested (5242890)\r\n```\r\n\r\n### Motivation\r\nWe load learning models by seeking/reading zip files. In general, random seek is beneficial for media files.\r\n\r\n### Proposed Changes\r\nIdeally there is a canonical way to respond to range requests in `Flask`. However, there might be complications depending on mlflow storage backends.\r\n","closed_by":{"login":"tomasatdatabricks","id":33237569,"node_id":"MDQ6VXNlcjMzMjM3NTY5","avatar_url":"https://avatars.githubusercontent.com/u/33237569?v=4","gravatar_id":"","url":"https://api.github.com/users/tomasatdatabricks","html_url":"https://github.com/tomasatdatabricks","followers_url":"https://api.github.com/users/tomasatdatabricks/followers","following_url":"https://api.github.com/users/tomasatdatabricks/following{/other_user}","gists_url":"https://api.github.com/users/tomasatdatabricks/gists{/gist_id}","starred_url":"https://api.github.com/users/tomasatdatabricks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tomasatdatabricks/subscriptions","organizations_url":"https://api.github.com/users/tomasatdatabricks/orgs","repos_url":"https://api.github.com/users/tomasatdatabricks/repos","events_url":"https://api.github.com/users/tomasatdatabricks/events{/privacy}","received_events_url":"https://api.github.com/users/tomasatdatabricks/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2606/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2606/timeline","performed_via_github_app":null,"state_reason":"completed"}