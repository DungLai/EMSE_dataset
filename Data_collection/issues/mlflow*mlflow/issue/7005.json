{"url":"https://api.github.com/repos/mlflow/mlflow/issues/7005","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/7005/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/7005/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/7005/events","html_url":"https://github.com/mlflow/mlflow/issues/7005","id":1402765581,"node_id":"I_kwDOCB5Jx85TnIEN","number":7005,"title":"[BUG] Registry image id not stored in tracking server","user":{"login":"subramaniam20jan","id":6160977,"node_id":"MDQ6VXNlcjYxNjA5Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/6160977?v=4","gravatar_id":"","url":"https://api.github.com/users/subramaniam20jan","html_url":"https://github.com/subramaniam20jan","followers_url":"https://api.github.com/users/subramaniam20jan/followers","following_url":"https://api.github.com/users/subramaniam20jan/following{/other_user}","gists_url":"https://api.github.com/users/subramaniam20jan/gists{/gist_id}","starred_url":"https://api.github.com/users/subramaniam20jan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/subramaniam20jan/subscriptions","organizations_url":"https://api.github.com/users/subramaniam20jan/orgs","repos_url":"https://api.github.com/users/subramaniam20jan/repos","events_url":"https://api.github.com/users/subramaniam20jan/events{/privacy}","received_events_url":"https://api.github.com/users/subramaniam20jan/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022848510,"node_id":"MDU6TGFiZWwyMDIyODQ4NTEw","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/projects","name":"area/projects","color":"48eabc","default":false,"description":"MLproject format, project running backends"},{"id":2022851725,"node_id":"MDU6TGFiZWwyMDIyODUxNzI1","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/docker","name":"area/docker","color":"ede978","default":false,"description":"Docker use anywhere, such as MLprojects and MLmodels"}],"state":"closed","locked":false,"assignee":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"assignees":[{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2022-10-10T08:09:52Z","updated_at":"2022-10-20T07:26:21Z","closed_at":"2022-10-20T07:22:45Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### Issues Policy acknowledgement\n\n- [X] I have read and agree to submit bug reports in accordance with the [issues policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md)\n\n### Willingness to contribute\n\nYes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\n\n### MLflow version\n\n1.29.0\n\n### System information\n\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 20.04.5 LTS\r\n- **Python version**: 3.10\n\n### Describe the problem\n\nWhen running mlflow on the kubernetes backend, mlflow pushes two image related tags to the tracking server, namely, mlflow.docker.image.id and mlflow.docker.image.uri.\r\n\r\nWhile the mlflow.docker.image.uri is correct and corresponds the right image registry, it looks like the image.id tag corresponds to the local image digest and not the image digest corresponding to the remote docker registry which is actually what is deployed to the kubernetes.\r\n\r\nIt can be seen that this image_id is actually obtained and returned from the [mlflow.projects.kubernetes. push_image_to_registry](https://github.com/mlflow/mlflow/blob/master/mlflow/projects/kubernetes.py#L31). Then it is [used](https://github.com/mlflow/mlflow/blob/83295954a64d67ee46fccaf8cbbca66669dfcd0b/mlflow/projects/__init__.py#L165) to actually generate the kubernetes job definition, but isnt tagged to mlflow tracking server in any way.\n\n### Tracking information\n\n_No response_\n\n### Code to reproduce issue\n\nAny successful deployment with a kubernetes backend(including the [default example](https://github.com/mlflow/mlflow/tree/master/examples/docker) listed)  can be seen to reproduce this issue.\n\n### Stack trace\n\nNo stacktrace since it is simply omitted metadata tag. Results in no error directly.\n\n### Other info / logs\n\n_No response_\n\n### What component(s) does this bug affect?\n\n- [ ] `area/artifacts`: Artifact stores and artifact logging\n- [ ] `area/build`: Build and test infrastructure for MLflow\n- [ ] `area/docs`: MLflow documentation pages\n- [ ] `area/examples`: Example code\n- [ ] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\n- [ ] `area/pipelines`: Pipelines, Pipeline APIs, Pipeline configs, Pipeline Templates\n- [X] `area/projects`: MLproject format, project running backends\n- [ ] `area/scoring`: MLflow Model server, model deployment tools, Spark UDFs\n- [ ] `area/server-infra`: MLflow Tracking server backend\n- [ ] `area/tracking`: Tracking Service, tracking client APIs, autologging\n\n### What interface(s) does this bug affect?\n\n- [ ] `area/uiux`: Front-end, user experience, plotting, JavaScript, JavaScript dev server\n- [X] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\n- [ ] `area/windows`: Windows support\n\n### What language(s) does this bug affect?\n\n- [ ] `language/r`: R APIs and clients\n- [ ] `language/java`: Java APIs and clients\n- [ ] `language/new`: Proposals for new client languages\n\n### What integration(s) does this bug affect?\n\n- [ ] `integrations/azure`: Azure and Azure ML integrations\n- [ ] `integrations/sagemaker`: SageMaker integrations\n- [ ] `integrations/databricks`: Databricks integrations","closed_by":{"login":"subramaniam20jan","id":6160977,"node_id":"MDQ6VXNlcjYxNjA5Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/6160977?v=4","gravatar_id":"","url":"https://api.github.com/users/subramaniam20jan","html_url":"https://github.com/subramaniam20jan","followers_url":"https://api.github.com/users/subramaniam20jan/followers","following_url":"https://api.github.com/users/subramaniam20jan/following{/other_user}","gists_url":"https://api.github.com/users/subramaniam20jan/gists{/gist_id}","starred_url":"https://api.github.com/users/subramaniam20jan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/subramaniam20jan/subscriptions","organizations_url":"https://api.github.com/users/subramaniam20jan/orgs","repos_url":"https://api.github.com/users/subramaniam20jan/repos","events_url":"https://api.github.com/users/subramaniam20jan/events{/privacy}","received_events_url":"https://api.github.com/users/subramaniam20jan/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/7005/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/7005/timeline","performed_via_github_app":null,"state_reason":"completed"}