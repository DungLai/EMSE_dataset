{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2657","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2657/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2657/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2657/events","html_url":"https://github.com/mlflow/mlflow/issues/2657","id":592452183,"node_id":"MDU6SXNzdWU1OTI0NTIxODM=","number":2657,"title":"[BUG] Segmentation fault caused by mlflow models serve","user":{"login":"mohammedi-haroune","id":23096288,"node_id":"MDQ6VXNlcjIzMDk2Mjg4","avatar_url":"https://avatars.githubusercontent.com/u/23096288?v=4","gravatar_id":"","url":"https://api.github.com/users/mohammedi-haroune","html_url":"https://github.com/mohammedi-haroune","followers_url":"https://api.github.com/users/mohammedi-haroune/followers","following_url":"https://api.github.com/users/mohammedi-haroune/following{/other_user}","gists_url":"https://api.github.com/users/mohammedi-haroune/gists{/gist_id}","starred_url":"https://api.github.com/users/mohammedi-haroune/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mohammedi-haroune/subscriptions","organizations_url":"https://api.github.com/users/mohammedi-haroune/orgs","repos_url":"https://api.github.com/users/mohammedi-haroune/repos","events_url":"https://api.github.com/users/mohammedi-haroune/events{/privacy}","received_events_url":"https://api.github.com/users/mohammedi-haroune/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-04-02T08:30:34Z","updated_at":"2020-04-08T18:58:13Z","closed_at":"2020-04-08T18:58:13Z","author_association":"NONE","active_lock_reason":null,"body":"Thank you for submitting an issue. Please refer to our [issue policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md)\r\nfor information on what types of issues we address. For help with debugging your code, please refer to [Stack Overflow](https://stackoverflow.com/questions/tagged/mlflow).\r\n\r\nPlease fill in this template and do not delete it unless you are sure your issue is outside its scope.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 19.10\r\n- **MLflow installed from (source or binary)**: binary\r\n- **MLflow version (run ``mlflow --version``)**: 1.7.2 (same result with 1.7.0 and 1.5.0)\r\n- **Python version**: 3.7.3\r\n- **npm version, if running the dev UI**:\r\n- **Exact command to reproduce**: `mlflow models serve -m [S3_URI]` \r\n\r\n### Describe the problem\r\nCalling `mlflow models serve -m [S3_URI]` or `_get_flavor_backend(s3_uri)` produces a **Segmentation fault (core dumped)**\r\n\r\n### Code to reproduce issue\r\nTwo ways to reproduce:\r\n1. `mlflow models serve -m [S3_URI]`\r\n2. Using the code below\r\n```python\r\nfrom dotenv import load_dotenv, find_dotenv \r\nfrom mlflow.models.cli import _get_flavor_backend                                                                                               \r\nimport faulthandler                                                                                                                             \r\nenv_file = 'path/to/.env/file'\r\nload_dotenv(env_file)                                                                                                         \r\nmodel_uri = 's3://path/to/model\"                                                                   \r\nfaulthandler.enable()                                                                                                                           \r\n_get_flavor_backend(model_uri) \r\n```\r\n### Other info / logs\r\n<details>\r\n<summary>Log</summary>\r\n<pre>\r\nenviron({'SHELL': '/bin/bash', 'SUDO_GID': '1005', 'LC_ADDRESS': 'en_US.UTF-8', 'LC_NAME': 'en_US.UTF-8', 'SUDO_COMMAND': '/usr/bin/su', 'LC_MONETARY': 'en_US.UTF-8', 'SUDO_USER': 'mohammedi', 'PWD': '/home/mohammedi', 'LOGNAME': 'root', 'HOME': '/root', 'LANG': 'C.UTF-8', 'LC_PAPER': 'en_US.UTF-8', 'LS_COLORS': 'rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:', 'VIRTUAL_ENV': '/home/pravda/pravda/venv', 'LESSCLOSE': '/usr/bin/lesspipe %s %s', 'LC_IDENTIFICATION': 'en_US.UTF-8', 'TERM': 'xterm-256color', 'LESSOPEN': '| /usr/bin/lesspipe %s', 'USER': 'root', 'SHLVL': '1', 'LC_TELEPHONE': 'en_US.UTF-8', 'LC_MEASUREMENT': 'en_US.UTF-8', 'PYTHONDONTWRITEBYTECODE': '1', 'LC_CTYPE': 'en_US.UTF-8', 'PS1': '[pravda]\\\\[\\\\e]0;\\\\u@\\\\h: \\\\w\\\\a\\\\]${debian_chroot:+($debian_chroot)}\\\\u@\\\\h:\\\\w\\\\$ ', 'LC_TIME': 'en_US.UTF-8', 'PATH': '/home/pravda/pravda/venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games', 'SUDO_UID': '1003', 'MAIL': '/var/mail/root', 'LC_NUMERIC': 'en_US.UTF-8', '_': '/home/pravda/pravda/venv/bin/python'})\r\nFatal Python error: Segmentation fault\r\n\r\nCurrent thread 0x00007fbb32d44740 (most recent call first):\r\n  File \"/home/pravda/pravda/venv/lib/python3.7/weakref.py\", line 364 in remove\r\n  File \"/home/pravda/pravda/venv/lib/python3.7/site-packages/mlflow/store/artifact/s3_artifact_repo.py\", line 102 in _download_file\r\n  File \"/home/pravda/pravda/venv/lib/python3.7/site-packages/mlflow/store/artifact/artifact_repo.py\", line 105 in download_file\r\n  File \"/home/pravda/pravda/venv/lib/python3.7/site-packages/mlflow/store/artifact/artifact_repo.py\", line 140 in download_artifacts\r\n  File \"/home/pravda/pravda/venv/lib/python3.7/site-packages/mlflow/tracking/artifact_utils.py\", line 76 in _download_artifact_from_uri\r\n  File \"/home/pravda/pravda/venv/lib/python3.7/site-packages/mlflow/models/cli.py\", line 163 in _get_flavor_backend\r\n  File \"segfault.py\", line 10 in <module>\r\n</pre>\r\n</details>\r\n\r\nI increased the values of all `ulimit`s without success.\r\n\r\n<details>\r\n<summary>`ulimit -a`</summary>\r\n<pre>\r\ncore file size          (blocks, -c) unlimited\r\ndata seg size           (kbytes, -d) unlimited\r\nscheduling priority             (-e) unlimited\r\nfile size               (blocks, -f) unlimited\r\npending signals                 (-i) unlimited\r\nmax locked memory       (kbytes, -l) unlimited\r\nmax memory size         (kbytes, -m) unlimited\r\nopen files                      (-n) 100000\r\npipe size            (512 bytes, -p) 8\r\nPOSIX message queues     (bytes, -q) unlimited\r\nreal-time priority              (-r) unlimited\r\nstack size              (kbytes, -s) unlimited\r\ncpu time               (seconds, -t) unlimited\r\nmax user processes              (-u) unlimited\r\nvirtual memory          (kbytes, -v) unlimited\r\nfile locks                      (-x) unlimited\r\n</pre>\r\n</details>\r\n\r\nI'm available any information needed to debug, maybe even give access to the server that caused the problem. ","closed_by":{"login":"mohammedi-haroune","id":23096288,"node_id":"MDQ6VXNlcjIzMDk2Mjg4","avatar_url":"https://avatars.githubusercontent.com/u/23096288?v=4","gravatar_id":"","url":"https://api.github.com/users/mohammedi-haroune","html_url":"https://github.com/mohammedi-haroune","followers_url":"https://api.github.com/users/mohammedi-haroune/followers","following_url":"https://api.github.com/users/mohammedi-haroune/following{/other_user}","gists_url":"https://api.github.com/users/mohammedi-haroune/gists{/gist_id}","starred_url":"https://api.github.com/users/mohammedi-haroune/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mohammedi-haroune/subscriptions","organizations_url":"https://api.github.com/users/mohammedi-haroune/orgs","repos_url":"https://api.github.com/users/mohammedi-haroune/repos","events_url":"https://api.github.com/users/mohammedi-haroune/events{/privacy}","received_events_url":"https://api.github.com/users/mohammedi-haroune/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2657/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2657/timeline","performed_via_github_app":null,"state_reason":"completed"}