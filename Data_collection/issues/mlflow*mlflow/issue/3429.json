{"url":"https://api.github.com/repos/mlflow/mlflow/issues/3429","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/3429/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/3429/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/3429/events","html_url":"https://github.com/mlflow/mlflow/issues/3429","id":703577316,"node_id":"MDU6SXNzdWU3MDM1NzczMTY=","number":3429,"title":"[BUG] Default experiment is not created when root directory already exists","user":{"login":"dniku","id":1315874,"node_id":"MDQ6VXNlcjEzMTU4NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1315874?v=4","gravatar_id":"","url":"https://api.github.com/users/dniku","html_url":"https://github.com/dniku","followers_url":"https://api.github.com/users/dniku/followers","following_url":"https://api.github.com/users/dniku/following{/other_user}","gists_url":"https://api.github.com/users/dniku/gists{/gist_id}","starred_url":"https://api.github.com/users/dniku/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dniku/subscriptions","organizations_url":"https://api.github.com/users/dniku/orgs","repos_url":"https://api.github.com/users/dniku/repos","events_url":"https://api.github.com/users/dniku/events{/privacy}","received_events_url":"https://api.github.com/users/dniku/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022849295,"node_id":"MDU6TGFiZWwyMDIyODQ5Mjk1","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/tracking","name":"area/tracking","color":"48eabc","default":false,"description":"Tracking service, tracking client APIs, autologging"},{"id":2022863969,"node_id":"MDU6TGFiZWwyMDIyODYzOTY5","url":"https://api.github.com/repos/mlflow/mlflow/labels/priority/important-soon","name":"priority/important-soon","color":"534cb5","default":false,"description":"The issue is worked on by the community currently or will be very soon, ideally in time for the"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-09-17T13:14:17Z","updated_at":"2021-11-10T15:27:44Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### Willingness to contribute\r\nThe MLflow Community encourages bug fix contributions. Would you or another member of your organization be willing to contribute a fix for this bug to the MLflow code base?\r\n\r\n- [ ] Yes. I can contribute a fix for this bug independently.\r\n- [ ] Yes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\r\n- [x] No. I cannot contribute a bug fix at this time.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: yes\r\n\r\nAll versions are irrelevant, since the problem is in current `master`.\r\n\r\n- **Exact command to reproduce**:\r\n\r\n1. `mkdir /tmp/mlruns`\r\n2. Run the following script:\r\n\r\n```python\r\nimport mlflow\r\n\r\nmlflow.set_tracking_uri(f'file:/tmp/mlruns')\r\nmlflow.log_param(\"my int param\", 6)\r\n```\r\n\r\n### Describe the problem\r\n\r\n`FileStore` [creates a default experiment](https://github.com/mlflow/mlflow/blob/d743a40426d5dedbde395a4e6bbdeebadbccd4dc/mlflow/store/tracking/file_store.py#L138-L142) only if `self.root_directory` does not exist yet. However, if it does exist but is empty, this leads to an exception, which is difficult to interpret for those who encounter MLFlow for the first time:\r\n\r\n```python\r\nTraceback (most recent call last):\r\n  File \"test_mlflow.py\", line 4, in <module>\r\n    mlflow.log_param(\"my int param\", 6)\r\n  File \"/home/ser/.miniconda3/envs/mlflow/lib/python3.8/site-packages/mlflow/tracking/fluent.py\", line 175, in log_param\r\n    run_id = _get_or_start_run().info.run_id\r\n  File \"/home/ser/.miniconda3/envs/mlflow/lib/python3.8/site-packages/mlflow/tracking/fluent.py\", line 416, in _get_or_start_run\r\n    return start_run()\r\n  File \"/home/ser/.miniconda3/envs/mlflow/lib/python3.8/site-packages/mlflow/tracking/fluent.py\", line 141, in start_run\r\n    active_run_obj = MlflowClient().create_run(\r\n  File \"/home/ser/.miniconda3/envs/mlflow/lib/python3.8/site-packages/mlflow/tracking/client.py\", line 84, in create_run\r\n    return self.store.create_run(\r\n  File \"/home/ser/.miniconda3/envs/mlflow/lib/python3.8/site-packages/mlflow/store/file_store.py\", line 360, in create_run\r\n    experiment = self.get_experiment(experiment_id)\r\n  File \"/home/ser/.miniconda3/envs/mlflow/lib/python3.8/site-packages/mlflow/store/file_store.py\", line 270, in get_experiment\r\n    experiment = self._get_experiment(experiment_id)\r\n  File \"/home/ser/.miniconda3/envs/mlflow/lib/python3.8/site-packages/mlflow/store/file_store.py\", line 245, in _get_experiment\r\n    raise MlflowException(\"Could not find experiment with ID %s\" % experiment_id,\r\nmlflow.exceptions.MlflowException: Could not find experiment with ID 0\r\n```\r\n\r\nPerhaps `FileStore.__init__()` should create a default experiment if it is not present yet, instead of only creating it if the directory itself does not exist?\r\n\r\n### What component(s), interfaces, languages, and integrations does this bug affect?\r\nComponents \r\n- [ ] `area/artifacts`: Artifact stores and artifact logging\r\n- [ ] `area/build`: Build and test infrastructure for MLflow\r\n- [ ] `area/docs`: MLflow documentation pages\r\n- [ ] `area/examples`: Example code\r\n- [ ] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\r\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\r\n- [ ] `area/projects`: MLproject format, project running backends\r\n- [ ] `area/scoring`: Local serving, model deployment tools, spark UDFs\r\n- [ ] `area/server-infra`: MLflow server, JavaScript dev server\r\n- [x] `area/tracking`: Tracking Service, tracking client APIs, autologging\r\n\r\nInterface \r\n- [ ] `area/uiux`: Front-end, user experience, JavaScript, plotting\r\n- [ ] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\r\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\r\n- [ ] `area/windows`: Windows support\r\n\r\nLanguage \r\n- [ ] `language/r`: R APIs and clients\r\n- [ ] `language/java`: Java APIs and clients\r\n- [ ] `language/new`: Proposals for new client languages\r\n\r\nIntegrations\r\n- [ ] `integrations/azure`: Azure and Azure ML integrations\r\n- [ ] `integrations/sagemaker`: SageMaker integrations\r\n- [ ] `integrations/databricks`: Databricks integrations\r\n\r\nGuys, your issue template is really long, this somewhat discourages reporting and contributions :/","closed_by":null,"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/3429/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/3429/timeline","performed_via_github_app":null,"state_reason":null}