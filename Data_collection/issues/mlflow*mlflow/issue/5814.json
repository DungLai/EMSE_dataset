{"url":"https://api.github.com/repos/mlflow/mlflow/issues/5814","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/5814/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/5814/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/5814/events","html_url":"https://github.com/mlflow/mlflow/issues/5814","id":1223902219,"node_id":"I_kwDOCB5Jx85I80QL","number":5814,"title":"[BUG] Delete temporary directory and its content created by mlflow.pytorch.load_state_dict","user":{"login":"agarfau","id":47793684,"node_id":"MDQ6VXNlcjQ3NzkzNjg0","avatar_url":"https://avatars.githubusercontent.com/u/47793684?v=4","gravatar_id":"","url":"https://api.github.com/users/agarfau","html_url":"https://github.com/agarfau","followers_url":"https://api.github.com/users/agarfau/followers","following_url":"https://api.github.com/users/agarfau/following{/other_user}","gists_url":"https://api.github.com/users/agarfau/gists{/gist_id}","starred_url":"https://api.github.com/users/agarfau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agarfau/subscriptions","organizations_url":"https://api.github.com/users/agarfau/orgs","repos_url":"https://api.github.com/users/agarfau/repos","events_url":"https://api.github.com/users/agarfau/events{/privacy}","received_events_url":"https://api.github.com/users/agarfau/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-05-03T10:02:57Z","updated_at":"2022-05-03T18:26:41Z","closed_at":"2022-05-03T18:26:41Z","author_association":"NONE","active_lock_reason":null,"body":"### Willingness to contribute\r\n\r\nYes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\r\n\r\n### System information\r\n\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Debian Buster (docker image python:3.9-slim-buster)\r\n- **MLflow installed from (source or binary)**: pip\r\n- **MLflow version (run ``mlflow --version``)**: 1.24.0\r\n- **Python version**: 3.9.10\r\n\r\n\r\n### Describe the problem\r\n\r\n**Actual behaviour**\r\nThe function `mlflow.pytorch.load_state_dict(...)` always creates a temporary directory using `tempfile.mkdtemp`. The latter's documentation says:\r\n>Caller is responsible for deleting the directory when done with it.\r\n\r\nThis deletion is not carried out in mlflow, which in my case resulted in filling up disk space because of accumulated temporary directories.\r\n\r\n**Expected behaviour**\r\nAfter calling `torch.load(state_dict_path, **kwargs)` within `mlflow.pytorch.load_state_dict(...)`, the temporary directory and all its content should be automatically deleted, since the user does not have access to these files.\r\n\r\n### Code to reproduce issue\r\n\r\n```python\r\nwith mlflow.start_run():\r\n    artifact_path = \"model\"\r\n    mlflow.pytorch.log_state_dict(model.state_dict(), artifact_path)\r\n    state_dict_uri = mlflow.get_artifact_uri(artifact_path)\r\n\r\nstate_dict = mlflow.pytorch.load_state_dict(state_dict_uri)\r\n```\r\n","closed_by":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/5814/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/5814/timeline","performed_via_github_app":null,"state_reason":"completed"}