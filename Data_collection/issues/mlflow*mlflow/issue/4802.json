{"url":"https://api.github.com/repos/mlflow/mlflow/issues/4802","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/4802/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/4802/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/4802/events","html_url":"https://github.com/mlflow/mlflow/issues/4802","id":996878743,"node_id":"I_kwDOCB5Jx847aymX","number":4802,"title":"[BUG] mlflow models build-docker fails to create environment","user":{"login":"flaviolisdero","id":85546382,"node_id":"MDQ6VXNlcjg1NTQ2Mzgy","avatar_url":"https://avatars.githubusercontent.com/u/85546382?v=4","gravatar_id":"","url":"https://api.github.com/users/flaviolisdero","html_url":"https://github.com/flaviolisdero","followers_url":"https://api.github.com/users/flaviolisdero/followers","following_url":"https://api.github.com/users/flaviolisdero/following{/other_user}","gists_url":"https://api.github.com/users/flaviolisdero/gists{/gist_id}","starred_url":"https://api.github.com/users/flaviolisdero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flaviolisdero/subscriptions","organizations_url":"https://api.github.com/users/flaviolisdero/orgs","repos_url":"https://api.github.com/users/flaviolisdero/repos","events_url":"https://api.github.com/users/flaviolisdero/events{/privacy}","received_events_url":"https://api.github.com/users/flaviolisdero/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-09-15T09:48:26Z","updated_at":"2021-09-16T08:40:23Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"I am using mlflow version 1.20.2 and docker version 20.10.7. I am able to serve my mlflow model\r\n\r\n`mlflow models serve -m models:/my_model/Staging\r\n`\r\n\r\nhowever when I run\r\n\r\n`mlflow models build-docker -m models:/my_model/Staging -n \"model_name\" --install-mlflow\r\n`\r\n\r\nI get the following error\r\n\r\n```\r\n#17 51.50 Installing pip dependencies: ...working... Traceback (most recent call last):\r\n#17 197.4   File \"<string>\", line 1, in <module>\r\n#17 197.4   File \"/miniconda/lib/python3.9/site-packages/mlflow/models/container/__init__.py\", line 101, in _install_pyfunc_deps\r\n#17 197.4     raise Exception(\"Failed to create model environment.\")\r\n#17 197.4 Exception: Failed to create model environment.\r\n#17 197.5 creating and activating custom environment\r\n#17 ERROR: executor failed running [/bin/sh -c python -c                 'from mlflow.models.container import _install_pyfunc_deps;                _install_pyfunc_deps(\"/opt/ml/model\", install_mlflow=True)']: exit code: 1\r\n------\r\n > [12/12] RUN python -c                 'from mlflow.models.container import _install_pyfunc_deps;                _install_pyfunc_deps(\"/opt/ml/model\", install_mlflow=True)':\r\n------\r\nexecutor failed running [/bin/sh -c python -c                 'from mlflow.models.container import _install_pyfunc_deps;                _install_pyfunc_deps(\"/opt/ml/model\", install_mlflow=True)']: exit code: 1\r\nTraceback (most recent call last):\r\n  File \"/Users/flavio.lisdero/Desktop/MPRNet_lightning/.venv/bin/mlflow\", line 8, in <module>\r\n    sys.exit(cli())\r\n  File \"/Users/flavio.lisdero/Desktop/MPRNet_lightning/.venv/lib/python3.8/site-packages/click/core.py\", line 1137, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/Users/flavio.lisdero/Desktop/MPRNet_lightning/.venv/lib/python3.8/site-packages/click/core.py\", line 1062, in main\r\n    rv = self.invoke(ctx)\r\n  File \"/Users/flavio.lisdero/Desktop/MPRNet_lightning/.venv/lib/python3.8/site-packages/click/core.py\", line 1668, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/Users/flavio.lisdero/Desktop/MPRNet_lightning/.venv/lib/python3.8/site-packages/click/core.py\", line 1668, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/Users/flavio.lisdero/Desktop/MPRNet_lightning/.venv/lib/python3.8/site-packages/click/core.py\", line 1404, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"/Users/flavio.lisdero/Desktop/MPRNet_lightning/.venv/lib/python3.8/site-packages/click/core.py\", line 763, in invoke\r\n    return __callback(*args, **kwargs)\r\n  File \"/Users/flavio.lisdero/Desktop/MPRNet_lightning/.venv/lib/python3.8/site-packages/mlflow/models/cli.py\", line 159, in build_docker\r\n    _get_flavor_backend(model_uri, docker_build=True).build_image(\r\n  File \"/Users/flavio.lisdero/Desktop/MPRNet_lightning/.venv/lib/python3.8/site-packages/mlflow/pyfunc/backend.py\", line 137, in build_image\r\n    _build_image(\r\n  File \"/Users/flavio.lisdero/Desktop/MPRNet_lightning/.venv/lib/python3.8/site-packages/mlflow/models/docker_utils.py\", line 132, in _build_image\r\n    raise RuntimeError(\"Docker build failed.\")\r\n```\r\n\r\nThe main problem is that is almost impossible to debug this error","closed_by":null,"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/4802/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/4802/timeline","performed_via_github_app":null,"state_reason":null}