{"url":"https://api.github.com/repos/mlflow/mlflow/issues/5083","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/5083/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/5083/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/5083/events","html_url":"https://github.com/mlflow/mlflow/issues/5083","id":1057342059,"node_id":"I_kwDOCB5Jx84_BcJr","number":5083,"title":"[BUG] 'log_artifact' and 'log_model' methods does not support files bigger than 5GB when using databricks artifact repository on S3.","user":{"login":"piotrkolanowski","id":2010933,"node_id":"MDQ6VXNlcjIwMTA5MzM=","avatar_url":"https://avatars.githubusercontent.com/u/2010933?v=4","gravatar_id":"","url":"https://api.github.com/users/piotrkolanowski","html_url":"https://github.com/piotrkolanowski","followers_url":"https://api.github.com/users/piotrkolanowski/followers","following_url":"https://api.github.com/users/piotrkolanowski/following{/other_user}","gists_url":"https://api.github.com/users/piotrkolanowski/gists{/gist_id}","starred_url":"https://api.github.com/users/piotrkolanowski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/piotrkolanowski/subscriptions","organizations_url":"https://api.github.com/users/piotrkolanowski/orgs","repos_url":"https://api.github.com/users/piotrkolanowski/repos","events_url":"https://api.github.com/users/piotrkolanowski/events{/privacy}","received_events_url":"https://api.github.com/users/piotrkolanowski/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1893072438,"node_id":"MDU6TGFiZWwxODkzMDcyNDM4","url":"https://api.github.com/repos/mlflow/mlflow/labels/help%20wanted","name":"help wanted","color":"c5def5","default":true,"description":"We would like help from the community to add this support"},{"id":2022847714,"node_id":"MDU6TGFiZWwyMDIyODQ3NzE0","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/model-registry","name":"area/model-registry","color":"48eabc","default":false,"description":"Model registry, model registry APIs, and the fluent client calls for model registry"},{"id":2022849295,"node_id":"MDU6TGFiZWwyMDIyODQ5Mjk1","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/tracking","name":"area/tracking","color":"48eabc","default":false,"description":"Tracking service, tracking client APIs, autologging"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2021-11-18T13:12:28Z","updated_at":"2022-08-17T01:26:25Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### Willingness to contribute\r\nThe MLflow Community encourages bug fix contributions. Would you or another member of your organization be willing to contribute a fix for this bug to the MLflow code base?\r\n\r\n- [ ] Yes. I can contribute a fix for this bug independently.\r\n- [ ] Yes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\r\n- [x] No. I cannot contribute a bug fix at this time.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Mac OS 11.6\r\n- **MLflow installed from (source or binary)**: binary\r\n- **MLflow version (run ``mlflow --version``)**: mlflow, version 1.20.2\r\n- **Python version**: 3.8.8\r\n- **npm version, if running the dev UI**: --\r\n- **Exact command to reproduce**: --\r\n\r\n### Describe the problem\r\nIf you try to log_model or log_artifact bigger than 5 GB when using databricks artifact repository on S3 it fails with \r\n```\r\nmlflow.exceptions.MlflowException: API request failed with exception 400 Client Error\r\n```\r\nIt doesn't happen for files that are smaller than 5 GB (even slightly like 4.9 GB file).\r\n\r\nThis probably happens due to use of \"upload_file\" method from boto3 in \r\n```\r\nmlflow.store.artifact.artifact_repo.S3ArtifactRepository._upload_file \r\n```\r\nmethod, which seems to upload the file with single PUT method.\r\n\r\nThe size of the file uploaded in the single put method is limited to 5GB.\r\nA solution would be to use multipart upload for bigger files: https://stackoverflow.com/questions/43021266/aws-s3-max-file-and-upload-sizes\r\n\r\nUploading files bigger than 5GB is required for speech recognition models for example.\r\n\r\n\r\n### Code to reproduce issue\r\nmlflow.log_artifact(\"/file/bigger/than/5/GB.txt\", \"model\")\r\n\r\n### Other info / logs\r\nImplementation is in mlflow/store/artifact/databricks_artifact_repo.py.\r\n\r\n### What component(s), interfaces, languages, and integrations does this bug affect?\r\nComponents \r\n- [ ] `area/artifacts`: Artifact stores and artifact logging\r\n- [ ] `area/build`: Build and test infrastructure for MLflow\r\n- [ ] `area/docs`: MLflow documentation pages\r\n- [ ] `area/examples`: Example code\r\n- [x] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\r\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\r\n- [ ] `area/projects`: MLproject format, project running backends\r\n- [ ] `area/scoring`: MLflow Model server, model deployment tools, Spark UDFs\r\n- [ ] `area/server-infra`: MLflow Tracking server backend\r\n- [x] `area/tracking`: Tracking Service, tracking client APIs, autologging\r\n\r\nInterface \r\n- [ ] `area/uiux`: Front-end, user experience, plotting, JavaScript, JavaScript dev server\r\n- [ ] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\r\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\r\n- [ ] `area/windows`: Windows support\r\n\r\nLanguage \r\n- [ ] `language/r`: R APIs and clients\r\n- [ ] `language/java`: Java APIs and clients\r\n- [ ] `language/new`: Proposals for new client languages\r\n\r\nIntegrations\r\n- [ ] `integrations/azure`: Azure and Azure ML integrations\r\n- [ ] `integrations/sagemaker`: SageMaker integrations\r\n- [ ] `integrations/databricks`: Databricks integrations\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/5083/reactions","total_count":16,"+1":16,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/5083/timeline","performed_via_github_app":null,"state_reason":null}