{"url":"https://api.github.com/repos/mlflow/mlflow/issues/3933","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/3933/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/3933/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/3933/events","html_url":"https://github.com/mlflow/mlflow/issues/3933","id":777501911,"node_id":"MDU6SXNzdWU3Nzc1MDE5MTE=","number":3933,"title":"[SETUP-BUG] Error initializing backend store: MS-SQL ALTER COLUMN operations with NULL or NOT NULL require the existing_type or a new type_ be passed","user":{"login":"pauldj54","id":706754,"node_id":"MDQ6VXNlcjcwNjc1NA==","avatar_url":"https://avatars.githubusercontent.com/u/706754?v=4","gravatar_id":"","url":"https://api.github.com/users/pauldj54","html_url":"https://github.com/pauldj54","followers_url":"https://api.github.com/users/pauldj54/followers","following_url":"https://api.github.com/users/pauldj54/following{/other_user}","gists_url":"https://api.github.com/users/pauldj54/gists{/gist_id}","starred_url":"https://api.github.com/users/pauldj54/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pauldj54/subscriptions","organizations_url":"https://api.github.com/users/pauldj54/orgs","repos_url":"https://api.github.com/users/pauldj54/repos","events_url":"https://api.github.com/users/pauldj54/events{/privacy}","received_events_url":"https://api.github.com/users/pauldj54/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-01-02T18:10:33Z","updated_at":"2021-01-03T05:03:15Z","closed_at":"2021-01-03T05:03:15Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Please fill in this installation issue template to ensure a timely and thorough response.**\r\n\r\n### System information\r\n- **Docker python:3.7-slim-buster**:\r\n- **binary**:\r\n- **1.13.0**:\r\n- **3.7**:\r\n- **mlflow server --backend-store-uri mssql+pyodbc://<user>:<password>@myhost:port/databasename?driver=ODBC+Driver+17+for+SQL+Server --default-artifact-root \"$MLFLOW_SERVER_DEFAULT_ARTIFACT_ROOT\" --host 0.0.0.0**:\r\n\r\n### Describe the problem\r\nI created an Azure SQL Database.\r\nI also added the SQL Server ODBC Driver 17 for Ubuntu 18.04 in the docker file for the mlflow server\r\nI added the command above to the start script of the docker container.\r\nI checked the connectivity with a local client using the same credentials, driver and connection string.\r\n\r\nWhen I started the container (docker run) I got the eror: \r\n\r\n> ERROR mlflow.cli: MS-SQL ALTER COLUMN operations with NULL or NOT NULL require the existing_type or a new type_ be passed.\r\n\r\nThe curious thing is, the backend tables are created in the database:\r\n![image](https://user-images.githubusercontent.com/706754/103463626-fe490f00-4d2d-11eb-98a7-e4c6dc508f07.png)\r\n\r\nAfter that some database migration methods are called and it failed.\r\n\r\n### Other info / logs\r\nInclude any logs or source code that would be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached.\r\n\r\nComplete error trace:\r\n`2021/01/02 17:52:58 ERROR mlflow.cli: Error initializing backend store\r\n2021/01/02 17:52:58 ERROR mlflow.cli: MS-SQL ALTER COLUMN operations with NULL or NOT NULL require the existing_type or a new type_ be passed.\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/cli.py\", line 385, in server\r\n    initialize_backend_stores(backend_store_uri, default_artifact_root)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/server/handlers.py\", line 146, in initialize_backend_stores\r\n    _get_tracking_store(backend_store_uri, default_artifact_root)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/server/handlers.py\", line 131, in _get_tracking_store\r\n    _tracking_store = _tracking_store_registry.get_store(store_uri, artifact_root)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/tracking/_tracking_service/registry.py\", line 38, in get_store\r\n    return builder(store_uri=store_uri, artifact_uri=artifact_uri)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/server/handlers.py\", line 102, in _get_sqlalchemy_store\r\n    return SqlAlchemyStore(store_uri, artifact_uri)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/store/tracking/sqlalchemy_store.py\", line 118, in __init__\r\n    mlflow.store.db.utils._initialize_tables(self.engine)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/store/db/utils.py\", line 33, in _initialize_tables\r\n    _upgrade_db(engine)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/store/db/utils.py\", line 146, in _upgrade_db\r\n    command.upgrade(config, \"heads\")\r\n  File \"/usr/local/lib/python3.7/site-packages/alembic/command.py\", line 298, in upgrade\r\n    script.run_env()\r\n  File \"/usr/local/lib/python3.7/site-packages/alembic/script/base.py\", line 489, in run_env\r\n    util.load_python_file(self.dir, \"env.py\")\r\n  File \"/usr/local/lib/python3.7/site-packages/alembic/util/pyfiles.py\", line 98, in load_python_file\r\n    module = load_module_py(module_id, path)\r\n  File \"/usr/local/lib/python3.7/site-packages/alembic/util/compat.py\", line 184, in load_module_py\r\n    spec.loader.exec_module(module)\r\n  File \"<frozen importlib._bootstrap_external>\", line 728, in exec_module\r\n  File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/store/db_migrations/env.py\", line 84, in <module>\r\n    run_migrations_online()\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/store/db_migrations/env.py\", line 78, in run_migrations_online\r\n    context.run_migrations()\r\n  File \"<string>\", line 8, in run_migrations\r\n  File \"/usr/local/lib/python3.7/site-packages/alembic/runtime/environment.py\", line 846, in run_migrations\r\n    self.get_context().run_migrations(**kw)\r\n  File \"/usr/local/lib/python3.7/site-packages/alembic/runtime/migration.py\", line 518, in run_migrations\r\n    step.migration_fn(**kw)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/store/db_migrations/versions/a8c4a736bde6_allow_nulls_for_run_id.py\", line 22, in upgrade\r\n    batch_op.alter_column(\"run_id\", nullable=True)\r\n  File \"/usr/local/lib/python3.7/contextlib.py\", line 119, in __exit__\r\n    next(self.gen)\r\n  File \"/usr/local/lib/python3.7/site-packages/alembic/operations/base.py\", line 354, in batch_alter_table\r\n    impl.flush()\r\n  File \"/usr/local/lib/python3.7/site-packages/alembic/operations/batch.py\", line 83, in flush\r\n    fn(*arg, **kw)\r\n  File \"/usr/local/lib/python3.7/site-packages/alembic/ddl/mssql.py\", line 72, in alter_column\r\n    \"MS-SQL ALTER COLUMN operations \"\r\nalembic.util.exc.CommandError: MS-SQL ALTER COLUMN operations with NULL or NOT NULL require the existing_type or a new type_ be passed.`\r\n","closed_by":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/3933/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/3933/timeline","performed_via_github_app":null,"state_reason":"completed"}