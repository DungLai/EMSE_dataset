{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2429","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2429/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2429/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2429/events","html_url":"https://github.com/mlflow/mlflow/issues/2429","id":564914672,"node_id":"MDU6SXNzdWU1NjQ5MTQ2NzI=","number":2429,"title":"[BUG] cloudpickle version specification","user":{"login":"clyman23","id":16906331,"node_id":"MDQ6VXNlcjE2OTA2MzMx","avatar_url":"https://avatars.githubusercontent.com/u/16906331?v=4","gravatar_id":"","url":"https://api.github.com/users/clyman23","html_url":"https://github.com/clyman23","followers_url":"https://api.github.com/users/clyman23/followers","following_url":"https://api.github.com/users/clyman23/following{/other_user}","gists_url":"https://api.github.com/users/clyman23/gists{/gist_id}","starred_url":"https://api.github.com/users/clyman23/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clyman23/subscriptions","organizations_url":"https://api.github.com/users/clyman23/orgs","repos_url":"https://api.github.com/users/clyman23/repos","events_url":"https://api.github.com/users/clyman23/events{/privacy}","received_events_url":"https://api.github.com/users/clyman23/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022848043,"node_id":"MDU6TGFiZWwyMDIyODQ4MDQz","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/models","name":"area/models","color":"48eabc","default":false,"description":"MLmodel format, model serialization/deserialization, flavors"},{"id":2022848902,"node_id":"MDU6TGFiZWwyMDIyODQ4OTAy","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/scoring","name":"area/scoring","color":"48eabc","default":false,"description":"MLflow Model server, model deployment tools, Spark UDFs"}],"state":"closed","locked":false,"assignee":{"login":"andychow-db","id":58712524,"node_id":"MDQ6VXNlcjU4NzEyNTI0","avatar_url":"https://avatars.githubusercontent.com/u/58712524?v=4","gravatar_id":"","url":"https://api.github.com/users/andychow-db","html_url":"https://github.com/andychow-db","followers_url":"https://api.github.com/users/andychow-db/followers","following_url":"https://api.github.com/users/andychow-db/following{/other_user}","gists_url":"https://api.github.com/users/andychow-db/gists{/gist_id}","starred_url":"https://api.github.com/users/andychow-db/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andychow-db/subscriptions","organizations_url":"https://api.github.com/users/andychow-db/orgs","repos_url":"https://api.github.com/users/andychow-db/repos","events_url":"https://api.github.com/users/andychow-db/events{/privacy}","received_events_url":"https://api.github.com/users/andychow-db/received_events","type":"User","site_admin":false},"assignees":[{"login":"andychow-db","id":58712524,"node_id":"MDQ6VXNlcjU4NzEyNTI0","avatar_url":"https://avatars.githubusercontent.com/u/58712524?v=4","gravatar_id":"","url":"https://api.github.com/users/andychow-db","html_url":"https://github.com/andychow-db","followers_url":"https://api.github.com/users/andychow-db/followers","following_url":"https://api.github.com/users/andychow-db/following{/other_user}","gists_url":"https://api.github.com/users/andychow-db/gists{/gist_id}","starred_url":"https://api.github.com/users/andychow-db/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andychow-db/subscriptions","organizations_url":"https://api.github.com/users/andychow-db/orgs","repos_url":"https://api.github.com/users/andychow-db/repos","events_url":"https://api.github.com/users/andychow-db/events{/privacy}","received_events_url":"https://api.github.com/users/andychow-db/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2020-02-13T19:53:49Z","updated_at":"2020-09-24T16:00:18Z","closed_at":"2020-07-20T10:15:39Z","author_association":"NONE","active_lock_reason":null,"body":"### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: MacOS 10.15 and Linux\r\n- **MLflow installed from (source or binary)**: pip\r\n- **MLflow version (run ``mlflow --version``)**: 1.6.0\r\n- **Python version**: 3.6.8 \r\n- **npm version, if running the dev UI**: N/A\r\n- **Exact command to reproduce**: mlflow.pyfunc.load_model(model_path)\r\n\r\n### Describe the problem\r\n\r\nMLflow does not call out a specific version of cloudpickle in its requirements. This creates a problem with the introduction of cloudpickle 1.3.0. Now, MLflow models that were created using cloudpickle 1.2.2 (the last version) produce an error when loaded if MLflow was installed by a user after cloudpickle upgraded to 1.3.0. \r\n\r\n### Code to reproduce issue\r\n\r\n1. Create an MLflow Model using the latest version of mlflow (1.6.0) and cloudpickle 1.2.2\r\n    * Alternatively, use an MLflow Model that was created with the latest version of mlflow (1.6.0) before 10 February 2020 (when cloudpickle published 1.3.0)\r\n1. Upgrade cloudpickle to 1.3.0\r\n1. Load the MLflow Model with `mlflow.pyfunc.load_model()`\r\n    * Should produce warning similar to: `2020/02/13 19:19:57 WARNING mlflow.pyfunc: The version of CloudPickle that was used to save the model, `CloudPickle 1.2.2`, differs from the version of CloudPickle that is currently running, `CloudPickle 1.3.0`, and may be incompatible`\r\n    * Should give error: \r\n```python\r\nFile \"/usr/local/lib/python3.6/site-packages/cloudpickle/cloudpickle.py\", line 415, in _builtin_type\r\n     return getattr(types, name)\r\n AttributeError: module 'types' has no attribute 'ClassType'\r\n```\r\n\r\n### Other info / logs\r\n\r\nThis error was found while running our CI pipeline on an MLflow Model that had been created using the latest version of mlflow (1.6.0) before cloudpickle was upgraded from 1.2.2 to 1.3.0. When cloudpickle upgraded to 1.3.0, our pipeline failed with the error described above. This is most likely because MLflow does not call out a specific version of cloudpickle in the requirements, so older MLflow Models are subject to issues from new releases of dependent packages. \r\n","closed_by":{"login":"juntai-zheng","id":39497939,"node_id":"MDQ6VXNlcjM5NDk3OTM5","avatar_url":"https://avatars.githubusercontent.com/u/39497939?v=4","gravatar_id":"","url":"https://api.github.com/users/juntai-zheng","html_url":"https://github.com/juntai-zheng","followers_url":"https://api.github.com/users/juntai-zheng/followers","following_url":"https://api.github.com/users/juntai-zheng/following{/other_user}","gists_url":"https://api.github.com/users/juntai-zheng/gists{/gist_id}","starred_url":"https://api.github.com/users/juntai-zheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juntai-zheng/subscriptions","organizations_url":"https://api.github.com/users/juntai-zheng/orgs","repos_url":"https://api.github.com/users/juntai-zheng/repos","events_url":"https://api.github.com/users/juntai-zheng/events{/privacy}","received_events_url":"https://api.github.com/users/juntai-zheng/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2429/reactions","total_count":11,"+1":11,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2429/timeline","performed_via_github_app":null,"state_reason":"completed"}