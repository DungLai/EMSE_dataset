{"url":"https://api.github.com/repos/mlflow/mlflow/issues/4479","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/4479/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/4479/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/4479/events","html_url":"https://github.com/mlflow/mlflow/issues/4479","id":924867407,"node_id":"MDU6SXNzdWU5MjQ4Njc0MDc=","number":4479,"title":"[FR] mlflow.pytorch.log_model add the option to only save model state_dict","user":{"login":"jhoareau","id":12410322,"node_id":"MDQ6VXNlcjEyNDEwMzIy","avatar_url":"https://avatars.githubusercontent.com/u/12410322?v=4","gravatar_id":"","url":"https://api.github.com/users/jhoareau","html_url":"https://github.com/jhoareau","followers_url":"https://api.github.com/users/jhoareau/followers","following_url":"https://api.github.com/users/jhoareau/following{/other_user}","gists_url":"https://api.github.com/users/jhoareau/gists{/gist_id}","starred_url":"https://api.github.com/users/jhoareau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhoareau/subscriptions","organizations_url":"https://api.github.com/users/jhoareau/orgs","repos_url":"https://api.github.com/users/jhoareau/repos","events_url":"https://api.github.com/users/jhoareau/events{/privacy}","received_events_url":"https://api.github.com/users/jhoareau/received_events","type":"User","site_admin":false},"labels":[{"id":955449434,"node_id":"MDU6TGFiZWw5NTU0NDk0MzQ=","url":"https://api.github.com/repos/mlflow/mlflow/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"},{"id":2022848043,"node_id":"MDU6TGFiZWwyMDIyODQ4MDQz","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/models","name":"area/models","color":"48eabc","default":false,"description":"MLmodel format, model serialization/deserialization, flavors"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-06-18T12:41:51Z","updated_at":"2022-01-12T08:37:35Z","closed_at":"2022-01-12T08:37:35Z","author_association":"NONE","active_lock_reason":null,"body":"## Willingness to contribute\r\n- [X] Yes. I would be willing to contribute this feature with guidance from the MLflow community.\r\n\r\n## Proposal Summary\r\nWe are currently experiencing an issue while upgrading to Pytorch 1.9 where they broke backwards compatibility between the Transformer class instances (see https://github.com/pytorch/pytorch/issues/60165). In the response to the issue, they mentioned that the only fully supported way to save models is to call `torch.save(model.state_dict())`.\r\n\r\nThis proposal aims at adding the option to serialize models as such, as well as providing proper deserialization tools for this specific checkpoint format. In particular, the model class should be pickled separately in order to rebuild the original `nn.Module` instance.\r\n\r\nCurrently, models are only saved \"whole\" using the `torch.save(model)` method: https://github.com/mlflow/mlflow/blob/9a857b2d7733c276632d85d71036b76c4da9d845/mlflow/pytorch/__init__.py#L484\r\n\r\n## Motivation\r\n- What is the use case for this feature? - Following PyTorch best practice guidelines.\r\n- Why is this use case valuable to support for MLflow users in general? - Other users might stumble upon similar cases as we did.\r\n- Why is this use case valuable to support for your project(s) or organization? - We cannot upgrade to PyTorch 1.9 because our models saved in MLFlow cannot be unpickled at all under a PyTorch 1.9 environment.\r\n- Why is it currently difficult to achieve this use case? (please be as specific as possible about why related MLflow features and components are insufficient) - unpickling the models generated under Pytorch 1.8 and saved using MLFlow are completely unrecoverable under Pytorch 1.9.\r\n\r\n### What component(s), interfaces, languages, and integrations does this feature affect?\r\nComponents \r\n- [X] `area/models`: MLmodel format, model serialization/deserialization, flavors","closed_by":{"login":"jhoareau","id":12410322,"node_id":"MDQ6VXNlcjEyNDEwMzIy","avatar_url":"https://avatars.githubusercontent.com/u/12410322?v=4","gravatar_id":"","url":"https://api.github.com/users/jhoareau","html_url":"https://github.com/jhoareau","followers_url":"https://api.github.com/users/jhoareau/followers","following_url":"https://api.github.com/users/jhoareau/following{/other_user}","gists_url":"https://api.github.com/users/jhoareau/gists{/gist_id}","starred_url":"https://api.github.com/users/jhoareau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhoareau/subscriptions","organizations_url":"https://api.github.com/users/jhoareau/orgs","repos_url":"https://api.github.com/users/jhoareau/repos","events_url":"https://api.github.com/users/jhoareau/events{/privacy}","received_events_url":"https://api.github.com/users/jhoareau/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/4479/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/4479/timeline","performed_via_github_app":null,"state_reason":"completed"}