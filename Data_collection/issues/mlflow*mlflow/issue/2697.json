{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2697","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2697/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2697/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2697/events","html_url":"https://github.com/mlflow/mlflow/issues/2697","id":599114381,"node_id":"MDU6SXNzdWU1OTkxMTQzODE=","number":2697,"title":"[BUG] Remote Tracking server with Docker env throws 'ConnectionError'","user":{"login":"ksanjeevan","id":12011058,"node_id":"MDQ6VXNlcjEyMDExMDU4","avatar_url":"https://avatars.githubusercontent.com/u/12011058?v=4","gravatar_id":"","url":"https://api.github.com/users/ksanjeevan","html_url":"https://github.com/ksanjeevan","followers_url":"https://api.github.com/users/ksanjeevan/followers","following_url":"https://api.github.com/users/ksanjeevan/following{/other_user}","gists_url":"https://api.github.com/users/ksanjeevan/gists{/gist_id}","starred_url":"https://api.github.com/users/ksanjeevan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ksanjeevan/subscriptions","organizations_url":"https://api.github.com/users/ksanjeevan/orgs","repos_url":"https://api.github.com/users/ksanjeevan/repos","events_url":"https://api.github.com/users/ksanjeevan/events{/privacy}","received_events_url":"https://api.github.com/users/ksanjeevan/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022848510,"node_id":"MDU6TGFiZWwyMDIyODQ4NTEw","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/projects","name":"area/projects","color":"48eabc","default":false,"description":"MLproject format, project running backends"},{"id":2022849295,"node_id":"MDU6TGFiZWwyMDIyODQ5Mjk1","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/tracking","name":"area/tracking","color":"48eabc","default":false,"description":"Tracking service, tracking client APIs, autologging"},{"id":2022863969,"node_id":"MDU6TGFiZWwyMDIyODYzOTY5","url":"https://api.github.com/repos/mlflow/mlflow/labels/priority/important-soon","name":"priority/important-soon","color":"534cb5","default":false,"description":"The issue is worked on by the community currently or will be very soon, ideally in time for the"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-04-13T20:24:09Z","updated_at":"2020-12-18T07:26:29Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 18.04\r\n- **MLflow installed from (source or binary)**: binary\r\n- **MLflow version (run ``mlflow --version``)**: 1.7.2\r\n- **Python version**: 3.7.4\r\n- **npm version, if running the dev UI**: N/A\r\n\r\n### Describe the problem\r\nWhen using a remote tracking server and a project with `MLproject` using a Docker env, I get an error thrown when `mlflow.start_run()` is called.\r\n\r\n### Code to reproduce issue\r\n1) Run `mlflow server` in a remote instance.\r\n2) Run `ssh -L 5000:127.0.0.1:5000 remote_server`.\r\n3) Run `export MLFLOW_TRACKING_URI=http://127.0.0.1:5000`.\r\n4) Run the [examples/docker](https://github.com/mlflow/mlflow/tree/master/examples/docker) mlflow example.\r\n\r\nOutput I get is:\r\n```\r\nkiran[@boira]:mlflow>mlflow run examples/docker -P alpha=0.5\r\n2020/04/13 13:20:50 INFO mlflow.projects: === Building docker image docker-example:aeaca67 ===\r\n2020/04/13 13:20:50 INFO mlflow.projects: === Created directory /tmp/tmpr47gl3ca for downloading remote URIs passed to arguments of type 'path' ===\r\n2020/04/13 13:20:50 INFO mlflow.projects: === Running command 'docker run --rm -v /home/kiran/.aws:/.aws -e MLFLOW_RUN_ID=27fe6853cbda4df080abd0c0c7fa681a -e MLFLOW_TRACKING_URI=http://127.0.0.1:5000 -e MLFLOW_EXPERIMENT_ID=0 docker-example:aeaca67 python train.py --alpha 0.5 --l1-ratio 0.1' in run with ID '27fe6853cbda4df080abd0c0c7fa681a' === \r\n/opt/conda/lib/python2.7/site-packages/mlflow/__init__.py:55: DeprecationWarning: MLflow support for Python 2 is deprecated and will be dropped in a future release. At that point, existing Python 2 workflows that use MLflow will continue to work without modification, but Python 2 users will no longer get access to the latest MLflow features and bugfixes. We recommend that you upgrade to Python 3 - see https://docs.python.org/3/howto/pyporting.html for a migration guide.\r\n  \"for a migration guide.\", DeprecationWarning)\r\nTraceback (most recent call last):\r\n  File \"train.py\", line 53, in <module>\r\n    with mlflow.start_run():\r\n  File \"/opt/conda/lib/python2.7/site-packages/mlflow/tracking/fluent.py\", line 122, in start_run\r\n    active_run_obj = MlflowClient().get_run(existing_run_id)\r\n  File \"/opt/conda/lib/python2.7/site-packages/mlflow/tracking/client.py\", line 96, in get_run\r\n    return self._tracking_client.get_run(run_id)\r\n  File \"/opt/conda/lib/python2.7/site-packages/mlflow/tracking/_tracking_service/client.py\", line 49, in get_run\r\n    return self.store.get_run(run_id)\r\n  File \"/opt/conda/lib/python2.7/site-packages/mlflow/store/tracking/rest_store.py\", line 92, in get_run\r\n    response_proto = self._call_endpoint(GetRun, req_body)\r\n  File \"/opt/conda/lib/python2.7/site-packages/mlflow/store/tracking/rest_store.py\", line 32, in _call_endpoint\r\n    return call_endpoint(self.get_host_creds(), endpoint, method, json_body, response_proto)\r\n  File \"/opt/conda/lib/python2.7/site-packages/mlflow/utils/rest_utils.py\", line 133, in call_endpoint\r\n    host_creds=host_creds, endpoint=endpoint, method=method, params=json_body)\r\n  File \"/opt/conda/lib/python2.7/site-packages/mlflow/utils/rest_utils.py\", line 70, in http_request\r\n    url=url, headers=headers, verify=verify, **kwargs)\r\n  File \"/opt/conda/lib/python2.7/site-packages/mlflow/utils/rest_utils.py\", line 51, in request_with_ratelimit_retries\r\n    response = requests.request(**kwargs)\r\n  File \"/opt/conda/lib/python2.7/site-packages/requests/api.py\", line 58, in request\r\n    return session.request(method=method, url=url, **kwargs)\r\n  File \"/opt/conda/lib/python2.7/site-packages/requests/sessions.py\", line 508, in request\r\n    resp = self.send(prep, **send_kwargs)\r\n  File \"/opt/conda/lib/python2.7/site-packages/requests/sessions.py\", line 618, in send\r\n    r = adapter.send(request, **kwargs)\r\n  File \"/opt/conda/lib/python2.7/site-packages/requests/adapters.py\", line 508, in send\r\n    raise ConnectionError(e, request=request)\r\nrequests.exceptions.ConnectionError: HTTPConnectionPool(host='127.0.0.1', port=5000): Max retries exceeded with url: /api/2.0/mlflow/runs/get?run_uuid=27fe6853cbda4df080abd0c0c7fa681a&run_id=27fe6853cbda4df080abd0c0c7fa681a (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fad1b41cb90>: Failed to establish a new connection: [Errno 111] Connection refused',))\r\n2020/04/13 13:20:52 ERROR mlflow.cli: === Run (ID '27fe6853cbda4df080abd0c0c7fa681a') failed ===\r\n```\r\n\r\nI've tested projects with a conda environment and they work perfectly fine, which makes me think it's an issue with how Docker talks to the remote tracking server? Does it need some permissions? Is my approach wrong?\r\n\r\nThanks.","closed_by":null,"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2697/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2697/timeline","performed_via_github_app":null,"state_reason":null}