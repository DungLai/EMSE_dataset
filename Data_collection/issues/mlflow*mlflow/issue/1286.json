{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1286","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/1286/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/1286/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/1286/events","html_url":"https://github.com/mlflow/mlflow/issues/1286","id":445157090,"node_id":"MDU6SXNzdWU0NDUxNTcwOTA=","number":1286,"title":"JSON serialization in scoring server changes input data types","user":{"login":"avflor","id":18666312,"node_id":"MDQ6VXNlcjE4NjY2MzEy","avatar_url":"https://avatars.githubusercontent.com/u/18666312?v=4","gravatar_id":"","url":"https://api.github.com/users/avflor","html_url":"https://github.com/avflor","followers_url":"https://api.github.com/users/avflor/followers","following_url":"https://api.github.com/users/avflor/following{/other_user}","gists_url":"https://api.github.com/users/avflor/gists{/gist_id}","starred_url":"https://api.github.com/users/avflor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/avflor/subscriptions","organizations_url":"https://api.github.com/users/avflor/orgs","repos_url":"https://api.github.com/users/avflor/repos","events_url":"https://api.github.com/users/avflor/events{/privacy}","received_events_url":"https://api.github.com/users/avflor/received_events","type":"User","site_admin":true},"labels":[{"id":955449434,"node_id":"MDU6TGFiZWw5NTU0NDk0MzQ=","url":"https://api.github.com/repos/mlflow/mlflow/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"},{"id":2022848902,"node_id":"MDU6TGFiZWwyMDIyODQ4OTAy","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/scoring","name":"area/scoring","color":"48eabc","default":false,"description":"MLflow Model server, model deployment tools, Spark UDFs"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":23,"created_at":"2019-05-16T20:58:31Z","updated_at":"2020-07-21T21:34:03Z","closed_at":"2020-07-21T21:34:03Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"The scoring server uses JSON serialization to serialize/deserialize input dataframes before passing them to the `predict` function for scoring. However, this way of serializing the data might result in data type changes.  Please see code below:\r\n\r\n```\r\nimport pandas as pd\r\nimport numpy as np\r\n\r\ndf = pd.DataFrame([[1.0, 2.1], [3.1, 4.0]], columns=['col 1', 'col 2'])\r\nprint(df.dtypes)\r\ndf = df.astype(np.float32)\r\nprint(df.dtypes)\r\nprint(df.to_json())\r\ndf2 = pd.read_json(df.to_json(),orient='records', dtype=False)\r\nprint(df2)\r\nprint(df2.dtypes)\r\n```\r\n\r\nOutput:\r\n```\r\nPython 3.6.1 (default, Dec 2015, 13:05:11)\r\n[GCC 4.8.2] on linux\r\ncol 1    float64\r\ncol 2    float64\r\ndtype: object\r\ncol 1    float32\r\ncol 2    float32\r\ndtype: object\r\n{\"col 1\":{\"0\":1.0,\"1\":3.0999999046},\"col 2\":{\"0\":2.0999999046,\"1\":4.0}}\r\n   col 1  col 2\r\n0    1.0    2.1\r\n1    3.1    4.0\r\ncol 1    float64\r\ncol 2    float64\r\ndtype: object\r\n```\r\n\r\nAs you see the datatype  after deserializing from json is float64 even if the type was explicitly set to float32 before the serialization. The scoring server has similar behavior which can create problems for some models such as ONNX (see #1127).\r\n\r\nI think we should use another serialization framework that preserves the representation. Maybe pickle?","closed_by":{"login":"tomasatdatabricks","id":33237569,"node_id":"MDQ6VXNlcjMzMjM3NTY5","avatar_url":"https://avatars.githubusercontent.com/u/33237569?v=4","gravatar_id":"","url":"https://api.github.com/users/tomasatdatabricks","html_url":"https://github.com/tomasatdatabricks","followers_url":"https://api.github.com/users/tomasatdatabricks/followers","following_url":"https://api.github.com/users/tomasatdatabricks/following{/other_user}","gists_url":"https://api.github.com/users/tomasatdatabricks/gists{/gist_id}","starred_url":"https://api.github.com/users/tomasatdatabricks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tomasatdatabricks/subscriptions","organizations_url":"https://api.github.com/users/tomasatdatabricks/orgs","repos_url":"https://api.github.com/users/tomasatdatabricks/repos","events_url":"https://api.github.com/users/tomasatdatabricks/events{/privacy}","received_events_url":"https://api.github.com/users/tomasatdatabricks/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1286/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/1286/timeline","performed_via_github_app":null,"state_reason":"completed"}