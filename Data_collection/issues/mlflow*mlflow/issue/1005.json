{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1005","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/1005/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/1005/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/1005/events","html_url":"https://github.com/mlflow/mlflow/issues/1005","id":421867795,"node_id":"MDU6SXNzdWU0MjE4Njc3OTU=","number":1005,"title":"Remains many zombie processes","user":{"login":"ike-dai","id":137471,"node_id":"MDQ6VXNlcjEzNzQ3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/137471?v=4","gravatar_id":"","url":"https://api.github.com/users/ike-dai","html_url":"https://github.com/ike-dai","followers_url":"https://api.github.com/users/ike-dai/followers","following_url":"https://api.github.com/users/ike-dai/following{/other_user}","gists_url":"https://api.github.com/users/ike-dai/gists{/gist_id}","starred_url":"https://api.github.com/users/ike-dai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ike-dai/subscriptions","organizations_url":"https://api.github.com/users/ike-dai/orgs","repos_url":"https://api.github.com/users/ike-dai/repos","events_url":"https://api.github.com/users/ike-dai/events{/privacy}","received_events_url":"https://api.github.com/users/ike-dai/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-03-17T00:34:56Z","updated_at":"2019-03-28T03:11:50Z","closed_at":"2019-03-28T03:11:50Z","author_association":"NONE","active_lock_reason":null,"body":"### System information\r\n- **OS Linux Debian 9.5 docker container**\r\n- **MLflow installed from binary (pip install)** \r\n- **MLflow version (run ``mlflow --version``) 0.8.2**\r\n- **Python version 3.6.6**\r\n\r\n### Describe the problem\r\n\r\nI have a question.\r\n\r\nI implements mlflow in my REST API Web application.\r\n\r\nAPI is written in the following POST API for predicting data with mlflow and Flask framework.\r\n\r\n```\r\n@app.route('/predict/to-metrics/ar-ch' , methods=['POST'])\r\ndef predict_metrics_ar_ch():\r\n    if 'mon_id' not in request.json:\r\n        abort(400, 'Bad request')\r\n\r\n    if 'interval' not in request.json:\r\n        abort(400, 'Bad request')\r\n\r\n    mon_id = str(request.json['mon_id'])\r\n    interval = str(request.json['interval'])\r\n\r\n    experiment_name = 'predict_metrics_ar_cf_{}'.format(mon_id)\r\n    experiment_id = _get_experiment_id(experiment_name)\r\n    if experiment_id is None:\r\n        return jsonify({'result': 'Cannot get mlflow experiment id'}), 500\r\n    mlflow.start_run(experiment_id=experiment_id)\r\n    mlflow.set_tag('pattern', 'predict_metrics_ar_cf')\r\n    try:\r\n        result = mlflow.projects.run(\r\n            uri='./jobs',\r\n            entry_point='predict_metrics_ar_cf',\r\n            experiment_id=experiment_id,\r\n            block=False,\r\n            use_conda=False,\r\n            mode='local',\r\n            parameters={'mon_id': mon_id, 'interval': interval}\r\n        )\r\n    except mlflow.exceptions.ExecutionException as e:\r\n        mlflow.end_run()\r\n        return jsonify({'result': 'Failed predict process({})'.format(e)}), 500\r\n    mlflow.end_run()\r\n    return jsonify({'result': 'Successful. Start processing.'}), 202\r\n```\r\n\r\nBy setting block False, POST API processes asynchronously.\r\n\r\nAfter start mlflow projects run\r\n\r\n```\r\n$ ps -o stat,user,group,pid,ppid,comm,args,etime,time\r\n... other procsses\r\nS    root     readproc 11884 11824 python3          /usr/local/bin/python3 -c from multiprocessing.semaphore_tracker import main;main(3)\r\n... othre processes\r\n```\r\n\r\nAfter finish mlflow projects run.\r\nA zombie process remains for each runs.\r\nSo, Executint projects.run many times, remain many zombie processes.\r\n\r\n```\r\n$ ps -o stat,user,group,pid,ppid,comm,args,etime,time\r\nZ    root     readproc 11884 17383 python3          [python3]\r\n```\r\n\r\nMLproject job successes correctly.\r\nAnd python job program process finishes correctrly.\r\n\r\nMLproject file\r\n```\r\nname: predictor\r\n\r\nentry_points:\r\n  predict_metrics_ar_cf:\r\n    parameters:\r\n      mon_id: {type: string, default: ''}\r\n      interval: {type: int, default: 15*60}\r\n    command: \"python3 predict_metrics_ar_cf_job.py {mon_id} {interval}\"\r\n```\r\n\r\nWhen I executed predict_ar_cf_job.py without mlflow, there is no zombie process.\r\n\r\nI want to know the cause of zombie process.\r\n\r\nBest regards.\r\n","closed_by":{"login":"ike-dai","id":137471,"node_id":"MDQ6VXNlcjEzNzQ3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/137471?v=4","gravatar_id":"","url":"https://api.github.com/users/ike-dai","html_url":"https://github.com/ike-dai","followers_url":"https://api.github.com/users/ike-dai/followers","following_url":"https://api.github.com/users/ike-dai/following{/other_user}","gists_url":"https://api.github.com/users/ike-dai/gists{/gist_id}","starred_url":"https://api.github.com/users/ike-dai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ike-dai/subscriptions","organizations_url":"https://api.github.com/users/ike-dai/orgs","repos_url":"https://api.github.com/users/ike-dai/repos","events_url":"https://api.github.com/users/ike-dai/events{/privacy}","received_events_url":"https://api.github.com/users/ike-dai/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1005/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/1005/timeline","performed_via_github_app":null,"state_reason":"completed"}