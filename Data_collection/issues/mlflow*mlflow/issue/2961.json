{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2961","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2961/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2961/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2961/events","html_url":"https://github.com/mlflow/mlflow/issues/2961","id":641154895,"node_id":"MDU6SXNzdWU2NDExNTQ4OTU=","number":2961,"title":"[BUG] TypeError: can't pickle fasttext_pybind.fasttext objects ","user":{"login":"GJAE-nv","id":56383189,"node_id":"MDQ6VXNlcjU2MzgzMTg5","avatar_url":"https://avatars.githubusercontent.com/u/56383189?v=4","gravatar_id":"","url":"https://api.github.com/users/GJAE-nv","html_url":"https://github.com/GJAE-nv","followers_url":"https://api.github.com/users/GJAE-nv/followers","following_url":"https://api.github.com/users/GJAE-nv/following{/other_user}","gists_url":"https://api.github.com/users/GJAE-nv/gists{/gist_id}","starred_url":"https://api.github.com/users/GJAE-nv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GJAE-nv/subscriptions","organizations_url":"https://api.github.com/users/GJAE-nv/orgs","repos_url":"https://api.github.com/users/GJAE-nv/repos","events_url":"https://api.github.com/users/GJAE-nv/events{/privacy}","received_events_url":"https://api.github.com/users/GJAE-nv/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022848043,"node_id":"MDU6TGFiZWwyMDIyODQ4MDQz","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/models","name":"area/models","color":"48eabc","default":false,"description":"MLmodel format, model serialization/deserialization, flavors"},{"id":2022866842,"node_id":"MDU6TGFiZWwyMDIyODY2ODQy","url":"https://api.github.com/repos/mlflow/mlflow/labels/priority/awaiting-more-evidence","name":"priority/awaiting-more-evidence","color":"534cb5","default":false,"description":"Lowest priority. Possibly useful, but not yet enough support to actually get it done."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2020-06-18T12:08:48Z","updated_at":"2021-07-09T19:00:12Z","closed_at":"2020-08-06T09:34:38Z","author_association":"NONE","active_lock_reason":null,"body":"Thank you for submitting an issue. Please refer to our [issue policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md) for additional information about bug reports. For help with debugging your code, please refer to [Stack Overflow](https://stackoverflow.com/questions/tagged/mlflow).\r\n\r\n**Please fill in this bug report template to ensure a timely and thorough response.**\r\n\r\n### Willingness to contribute\r\nThe MLflow Community encourages bug fix contributions. Would you or another member of your organization be willing to contribute a fix for this bug to the MLflow code base?\r\n\r\n- [ ] Yes. I can contribute a fix for this bug independently.\r\n- [ ] Yes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\r\n- [x] No. I cannot contribute a bug fix at this time.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**:\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: mac\r\n- **MLflow installed from (source or binary)**: source\r\n- **MLflow version (run ``mlflow --version``)**: version 1.8.0\r\n- **Python version**: Python 3.7.6\r\n- **npm version, if running the dev UI**:\r\n- **Exact command to reproduce**: \r\n\r\n### Describe the problem\r\nI can't use fasttext inside of mlflow because it can't be pickled, is there a workaround? \r\n\r\nRead 0M words\r\nNumber of words:  3794\r\nNumber of labels: 2\r\nProgress: 100.0% words/sec/thread:  208674 lr:  0.000000 avg.loss:  0.694504 ETA:   0h 0m 0s\r\nTraceback (most recent call last):\r\n  File \"adore_test_model.py\", line 32, in <module>\r\n    custom_model.log_model(python_model=CustomModel(model_sup), artifact_path = \"artifact_test\", registered_model_name='adore-test-model')\r\n  File \"/Users/gertjan.vanlook/Documents/GitHub/ADORE/models/env/lib/python3.7/site-packages/mlflow/pyfunc/__init__.py\", line 699, in log_model\r\n    registered_model_name=registered_model_name)\r\n  File \"/Users/gertjan.vanlook/Documents/GitHub/ADORE/models/env/lib/python3.7/site-packages/mlflow/models/__init__.py\", line 101, in log\r\n    flavor.save_model(path=local_path, mlflow_model=mlflow_model, **kwargs)\r\n  File \"/Users/gertjan.vanlook/Documents/GitHub/ADORE/models/env/lib/python3.7/site-packages/mlflow/pyfunc/__init__.py\", line 609, in save_model\r\n    code_paths=code_path, mlflow_model=mlflow_model)\r\n  File \"/Users/gertjan.vanlook/Documents/GitHub/ADORE/models/env/lib/python3.7/site-packages/mlflow/pyfunc/model.py\", line 141, in _save_model_with_class_artifacts_params\r\n    cloudpickle.dump(python_model, out)\r\n  File \"/Users/gertjan.vanlook/Documents/GitHub/ADORE/models/env/lib/python3.7/site-packages/cloudpickle/cloudpickle.py\", line 1067, in dump\r\n    CloudPickler(file, protocol=protocol).dump(obj)\r\n  File \"/Users/gertjan.vanlook/Documents/GitHub/ADORE/models/env/lib/python3.7/site-packages/cloudpickle/cloudpickle.py\", line 477, in dump\r\n    return Pickler.dump(self, obj)\r\n  File \"/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/pickle.py\", line 437, in dump\r\n    self.save(obj)\r\n  File \"/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/pickle.py\", line 549, in save\r\n    self.save_reduce(obj=obj, *rv)\r\n  File \"/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/pickle.py\", line 662, in save_reduce\r\n    save(state)\r\n  File \"/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/pickle.py\", line 504, in save\r\n    f(self, obj) # Call unbound method with explicit self\r\n  File \"/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/pickle.py\", line 859, in save_dict\r\n    self._batch_setitems(obj.items())\r\n  File \"/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/pickle.py\", line 890, in _batch_setitems\r\n    save(v)\r\n  File \"/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/pickle.py\", line 549, in save\r\n    self.save_reduce(obj=obj, *rv)\r\n  File \"/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/pickle.py\", line 662, in save_reduce\r\n    save(state)\r\n  File \"/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/pickle.py\", line 504, in save\r\n    f(self, obj) # Call unbound method with explicit self\r\n  File \"/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/pickle.py\", line 859, in save_dict\r\n    self._batch_setitems(obj.items())\r\n  File \"/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/pickle.py\", line 885, in _batch_setitems\r\n    save(v)\r\n  File \"/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/pickle.py\", line 524, in save\r\n    rv = reduce(self.proto)\r\nTypeError: can't pickle fasttext_pybind.fasttext objects\r\n\r\n### Code to reproduce issue\r\n\r\n```python\r\nimport mlflow\r\nimport os \r\nimport fasttext.util\r\nimport mlflow.pyfunc as custom_model\r\nimport pickle\r\n\r\nos.environ['MLFLOW_TRACKING_URI'] = 'yourtrackuri'\r\nmlflow.set_experiment('your_name')\r\n\r\nclass CustomModel(custom_model.PythonModel):\r\n    def __init__(self, model):\r\n        self.model = model\r\n\r\n    def predict(self, context, X):\r\n        return self.model.predict(X)\r\n\r\nwith mlflow.start_run():\r\n    model_sup = fasttext.train_supervised('data/data.train.txt')\r\n    custom_model.log_model(python_model=CustomModel(model_sup), artifact_path = \"artifact_test\", registered_model_name='modelname')\r\n    \r\n    mlflow.log_param(\"alpha\", 1)\r\n    mlflow.log_param(\"l1_ratio\", 2)\r\n    mlflow.log_metric(\"rmse\", 3)\r\n    mlflow.log_metric(\"r2\", 4)\r\n    mlflow.log_metric(\"mae\", 5)\r\n```","closed_by":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2961/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2961/timeline","performed_via_github_app":null,"state_reason":"completed"}