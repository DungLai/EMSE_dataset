{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2673","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2673/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2673/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2673/events","html_url":"https://github.com/mlflow/mlflow/issues/2673","id":594462853,"node_id":"MDU6SXNzdWU1OTQ0NjI4NTM=","number":2673,"title":"[BUG] stderr is duplicated in mlflow::mlflow_run() in R","user":{"login":"lorenzwalthert","id":10477073,"node_id":"MDQ6VXNlcjEwNDc3MDcz","avatar_url":"https://avatars.githubusercontent.com/u/10477073?v=4","gravatar_id":"","url":"https://api.github.com/users/lorenzwalthert","html_url":"https://github.com/lorenzwalthert","followers_url":"https://api.github.com/users/lorenzwalthert/followers","following_url":"https://api.github.com/users/lorenzwalthert/following{/other_user}","gists_url":"https://api.github.com/users/lorenzwalthert/gists{/gist_id}","starred_url":"https://api.github.com/users/lorenzwalthert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorenzwalthert/subscriptions","organizations_url":"https://api.github.com/users/lorenzwalthert/orgs","repos_url":"https://api.github.com/users/lorenzwalthert/repos","events_url":"https://api.github.com/users/lorenzwalthert/events{/privacy}","received_events_url":"https://api.github.com/users/lorenzwalthert/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1041183632,"node_id":"MDU6TGFiZWwxMDQxMTgzNjMy","url":"https://api.github.com/repos/mlflow/mlflow/labels/language/r","name":"language/r","color":"349cd8","default":false,"description":"R APIs and clients"},{"id":1893072438,"node_id":"MDU6TGFiZWwxODkzMDcyNDM4","url":"https://api.github.com/repos/mlflow/mlflow/labels/help%20wanted","name":"help wanted","color":"c5def5","default":true,"description":"We would like help from the community to add this support"},{"id":2022848510,"node_id":"MDU6TGFiZWwyMDIyODQ4NTEw","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/projects","name":"area/projects","color":"48eabc","default":false,"description":"MLproject format, project running backends"},{"id":2022865338,"node_id":"MDU6TGFiZWwyMDIyODY1MzM4","url":"https://api.github.com/repos/mlflow/mlflow/labels/priority/important-longterm","name":"priority/important-longterm","color":"534cb5","default":false,"description":"Important over the long term, but may not be staffed or may need multiple releases to complete."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-04-05T13:43:04Z","updated_at":"2020-10-09T14:38:17Z","closed_at":"2020-10-09T14:38:17Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: MacOs 10.15.3\r\n- **MLflow installed from (source or binary)**: binary\r\n- **MLflow version (run ``mlflow --version``)**: 1.7.0\r\n- **Python version**: 3.6\r\n- **npm version, if running the dev UI**:\r\n- **Exact command to reproduce**:\r\n\r\n```r\r\nmlflow::mlflow_run('.', entry_point = 'R/script.R', parameters = list(\r\n  large_dbl = 2,\r\n  other = 3\r\n))\r\n```\r\n\r\n### Describe the problem\r\n\r\nRunning the above code returns \r\n```r\r\n2020/04/05 15:10:05 INFO mlflow.projects: === Created directory /var/folders/6g/bg5mcmsj7s51r33snbxhm1400000gn/T/tmpq2y52qgo for downloading remote URIs passed to arguments of type 'path' ===\r\n2020/04/05 15:10:05 INFO mlflow.projects: === Running command 'source /Users/lorenz/opt/miniconda3/bin/../etc/profile.d/conda.sh && conda activate mlflow-da39a3ee5e6b4b0d3255bfef95601890afd80709 1>&2 && Rscript -e \"mlflow::mlflow_source('R/script.R')\" --args --large_dbl 2 --other 3' in run with ID '6e9154ec335c42c2930e46f8233bd18a' === \r\n2020/04/05 15:10:05 INFO mlflow.projects: === Created directory /var/folders/6g/bg5mcmsj7s51r33snbxhm1400000gn/T/tmpq2y52qgo for downloading remote URIs passed to arguments of type 'path' ===\r\n2020/04/05 15:10:05 INFO mlflow.projects: === Running command 'source /Users/lorenz/opt/miniconda3/bin/../etc/profile.d/conda.sh && conda activate mlflow-da39a3ee5e6b4b0d3255bfef95601890afd80709 1>&2 && Rscript -e \"mlflow::mlflow_source('R/script.R')\" --args --large_dbl 2 --other 3' in run with ID '6e9154ec335c42c2930e46f8233bd18a' === \r\n2020/04/05 15:10:06 INFO mlflow.projects: === Run (ID '6e9154ec335c42c2930e46f8233bd18a') succeeded ===\r\n2020/04/05 15:10:06 INFO mlflow.projects: === Run (ID '6e9154ec335c42c2930e46f8233bd18a') succeeded ===\r\n```\r\n\r\nThe same problem can be observed in CI/CD output, e.g [here](https://travis-ci.org/github/mlflow/mlflow/jobs/670792545?utm_medium=notification&utm_source=github_status). Investigating, we see that in `mlflow:::mlflow_cli()`, the CLI is invoked with the `run` command from {processx} (substituting relevant arguments from the debugger):\r\n```r\r\nrun(mlflow_bin, args = unlist(args), echo = TRUE, \r\n        echo_cmd = FALSE, stderr_callback = function(x, p) cat(x, file = stderr()))\r\n```\r\n\r\nRunning this in debugging mode, we see that ~apparently, stdout and stderr are for some reason interchanged.~ this output comes from stderr. The return value of the above command (without echo):\r\n```\r\n$status\r\n[1] 0\r\n\r\n$stdout\r\n[1] \"\"\r\n\r\n$stderr\r\n[1] \"2020/04/05 15:23:02 INFO mlflow.projects: === Created directory /var/folders/6g/bg5mcmsj7s51r33snbxhm1400000gn/T/tmpjb_u9bvr for downloading remote URIs passed to arguments of type 'path' ===\\n2020/04/05 15:23:02 INFO mlflow.projects: === Running command 'source /Users/lorenz/opt/miniconda3/bin/../etc/profile.d/conda.sh && conda activate mlflow-da39a3ee5e6b4b0d3255bfef95601890afd80709 1>&2 && Rscript -e \\\"mlflow::mlflow_source('R/script.R')\\\" --args --large_dbl 2 --other 3' in run with ID '5a7e4782051c40ed85dd630709afa882' === \\n2020/04/05 15:23:03 INFO mlflow.projects: === Run (ID '5a7e4782051c40ed85dd630709afa882') succeeded ===\\n\"\r\n\r\n$timeout\r\n[1] FALSE\r\n```\r\n\r\nBecause `echo = TRUE` and the `stderr_callback` is printing to the console, we get all output twice. I believe ~this is a problem with the {processx} package in the first place, so I filed an issue there too (https://github.com/r-lib/processx/issues/250). For the time being,~ we could set the stderr callback to `function(x, p) NULL` when calling `mlflow:::mlflow_cli()` from `mlflow::mlflow_runs()`. Maybe you can clarify why the output does not go to stdout in the first place because to me, it would make more sense to send the output to stdout.\r\n\r\n\r\n### Code to reproduce issue\r\n\r\nRun the above command in [this](https://github.com/lorenzwalthert/mlflow-r-casting-bug/tree/master/R) minimally reproducible git repo, file `R/runner.R`.\r\n","closed_by":{"login":"lorenzwalthert","id":10477073,"node_id":"MDQ6VXNlcjEwNDc3MDcz","avatar_url":"https://avatars.githubusercontent.com/u/10477073?v=4","gravatar_id":"","url":"https://api.github.com/users/lorenzwalthert","html_url":"https://github.com/lorenzwalthert","followers_url":"https://api.github.com/users/lorenzwalthert/followers","following_url":"https://api.github.com/users/lorenzwalthert/following{/other_user}","gists_url":"https://api.github.com/users/lorenzwalthert/gists{/gist_id}","starred_url":"https://api.github.com/users/lorenzwalthert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorenzwalthert/subscriptions","organizations_url":"https://api.github.com/users/lorenzwalthert/orgs","repos_url":"https://api.github.com/users/lorenzwalthert/repos","events_url":"https://api.github.com/users/lorenzwalthert/events{/privacy}","received_events_url":"https://api.github.com/users/lorenzwalthert/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2673/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2673/timeline","performed_via_github_app":null,"state_reason":"completed"}