{"url":"https://api.github.com/repos/mlflow/mlflow/issues/6572","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/6572/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/6572/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/6572/events","html_url":"https://github.com/mlflow/mlflow/issues/6572","id":1349055154,"node_id":"I_kwDOCB5Jx85QaPKy","number":6572,"title":"[BUG] Problems with protobuf:  Descriptors cannot not be created directly","user":{"login":"ibobak","id":8807043,"node_id":"MDQ6VXNlcjg4MDcwNDM=","avatar_url":"https://avatars.githubusercontent.com/u/8807043?v=4","gravatar_id":"","url":"https://api.github.com/users/ibobak","html_url":"https://github.com/ibobak","followers_url":"https://api.github.com/users/ibobak/followers","following_url":"https://api.github.com/users/ibobak/following{/other_user}","gists_url":"https://api.github.com/users/ibobak/gists{/gist_id}","starred_url":"https://api.github.com/users/ibobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ibobak/subscriptions","organizations_url":"https://api.github.com/users/ibobak/orgs","repos_url":"https://api.github.com/users/ibobak/repos","events_url":"https://api.github.com/users/ibobak/events{/privacy}","received_events_url":"https://api.github.com/users/ibobak/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022849295,"node_id":"MDU6TGFiZWwyMDIyODQ5Mjk1","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/tracking","name":"area/tracking","color":"48eabc","default":false,"description":"Tracking service, tracking client APIs, autologging"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-08-24T08:19:45Z","updated_at":"2022-08-24T09:01:04Z","closed_at":"2022-08-24T08:31:39Z","author_association":"NONE","active_lock_reason":null,"body":"### Willingness to contribute\n\nNo. I cannot contribute a bug fix at this time.\n\n### MLflow version\n\n1.25.0\n\n### System information\n\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:  Ubuntu 20.04\r\n- **Python version**:  3.9\r\n- **yarn version, if running the dev UI**:\r\n\n\n### Describe the problem\n\nThis code\r\n```\r\nimport mlflow\r\n```\r\nproduces this exception - see stacktrace below.\r\nI had the latest protobuf, and for me the workaround was this:\r\n```\r\npip insrtall protobuf==3.20.0\r\n```\r\nbased on what google found, and it worked. \r\n\r\nHowever, it would be good if you check and try to fix the dependencies.\n\n### Tracking information\n\n_No response_\n\n### Code to reproduce issue\n\nimport mlflow\n\n### Stack trace\n\n\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\nInput In [1248], in <module>\r\n----> 1 import mlflow\r\n      2 from mlflow.tracking.fluent import ActiveRun, end_run, get_run\r\n      3 from tempfile import TemporaryDirectory\r\n\r\nFile /opt/anaconda3/envs/spark32/lib/python3.9/site-packages/mlflow/__init__.py:32, in <module>\r\n     30 from mlflow.version import VERSION as __version__  # pylint: disable=unused-import\r\n     31 from mlflow.utils.logging_utils import _configure_mlflow_loggers\r\n---> 32 import mlflow.tracking._model_registry.fluent\r\n     33 import mlflow.tracking.fluent\r\n     35 # Filter annoying Cython warnings that serve no good purpose, and so before\r\n     36 # importing other modules.\r\n     37 # See: https://github.com/numpy/numpy/pull/432/commits/170ed4e33d6196d7\r\n\r\nFile /opt/anaconda3/envs/spark32/lib/python3.9/site-packages/mlflow/tracking/__init__.py:8, in <module>\r\n      1 \"\"\"\r\n      2 The ``mlflow.tracking`` module provides a Python CRUD interface to MLflow experiments\r\n      3 and runs. This is a lower level API that directly translates to MLflow\r\n      4 `REST API <../rest-api.html>`_ calls.\r\n      5 For a higher level API for managing an \"active run\", use the :py:mod:`mlflow` module.\r\n      6 \"\"\"\r\n----> 8 from mlflow.tracking.client import MlflowClient\r\n      9 from mlflow.tracking._tracking_service.utils import (\r\n     10     set_tracking_uri,\r\n     11     get_tracking_uri,\r\n   (...)\r\n     14     _TRACKING_URI_ENV_VAR,\r\n     15 )\r\n     16 from mlflow.tracking._model_registry.utils import (\r\n     17     set_registry_uri,\r\n     18     get_registry_uri,\r\n     19 )\r\n\r\nFile /opt/anaconda3/envs/spark32/lib/python3.9/site-packages/mlflow/tracking/client.py:16, in <module>\r\n     13 import yaml\r\n     14 from typing import Any, Dict, Sequence, List, Optional, Union, TYPE_CHECKING\r\n---> 16 from mlflow.entities import Experiment, Run, RunInfo, Param, Metric, RunTag, FileInfo, ViewType\r\n     17 from mlflow.store.entities.paged_list import PagedList\r\n     18 from mlflow.entities.model_registry import RegisteredModel, ModelVersion\r\n\r\nFile /opt/anaconda3/envs/spark32/lib/python3.9/site-packages/mlflow/entities/__init__.py:6, in <module>\r\n      1 \"\"\"\r\n      2 The ``mlflow.entities`` module defines entities returned by the MLflow\r\n      3 `REST API <../rest-api.html>`_.\r\n      4 \"\"\"\r\n----> 6 from mlflow.entities.experiment import Experiment\r\n      7 from mlflow.entities.experiment_tag import ExperimentTag\r\n      8 from mlflow.entities.file_info import FileInfo\r\n\r\nFile /opt/anaconda3/envs/spark32/lib/python3.9/site-packages/mlflow/entities/experiment.py:2, in <module>\r\n      1 from mlflow.entities._mlflow_object import _MLflowObject\r\n----> 2 from mlflow.entities.experiment_tag import ExperimentTag\r\n      3 from mlflow.protos.service_pb2 import (\r\n      4     Experiment as ProtoExperiment,\r\n      5     ExperimentTag as ProtoExperimentTag,\r\n      6 )\r\n      9 class Experiment(_MLflowObject):\r\n\r\nFile /opt/anaconda3/envs/spark32/lib/python3.9/site-packages/mlflow/entities/experiment_tag.py:2, in <module>\r\n      1 from mlflow.entities._mlflow_object import _MLflowObject\r\n----> 2 from mlflow.protos.service_pb2 import ExperimentTag as ProtoExperimentTag\r\n      5 class ExperimentTag(_MLflowObject):\r\n      6     \"\"\"Tag object associated with an experiment.\"\"\"\r\n\r\nFile /opt/anaconda3/envs/spark32/lib/python3.9/site-packages/mlflow/protos/service_pb2.py:18, in <module>\r\n     13 # @@protoc_insertion_point(imports)\r\n     15 _sym_db = _symbol_database.Default()\r\n---> 18 from .scalapb import scalapb_pb2 as scalapb_dot_scalapb__pb2\r\n     19 from . import databricks_pb2 as databricks__pb2\r\n     22 DESCRIPTOR = _descriptor.FileDescriptor(\r\n     23   name='service.proto',\r\n     24   package='mlflow',\r\n   (...)\r\n     28   ,\r\n     29   dependencies=[scalapb_dot_scalapb__pb2.DESCRIPTOR,databricks__pb2.DESCRIPTOR,])\r\n\r\nFile /opt/anaconda3/envs/spark32/lib/python3.9/site-packages/mlflow/protos/scalapb/scalapb_pb2.py:29, in <module>\r\n     18 DESCRIPTOR = _descriptor.FileDescriptor(\r\n     19   name='scalapb/scalapb.proto',\r\n     20   package='scalapb',\r\n   (...)\r\n     24   ,\r\n     25   dependencies=[google_dot_protobuf_dot_descriptor__pb2.DESCRIPTOR,])\r\n     28 OPTIONS_FIELD_NUMBER = 1020\r\n---> 29 options = _descriptor.FieldDescriptor(\r\n     30   name='options', full_name='scalapb.options', index=0,\r\n     31   number=1020, type=11, cpp_type=10, label=1,\r\n     32   has_default_value=False, default_value=None,\r\n     33   message_type=None, enum_type=None, containing_type=None,\r\n     34   is_extension=True, extension_scope=None,\r\n     35   serialized_options=None, file=DESCRIPTOR)\r\n     36 MESSAGE_FIELD_NUMBER = 1020\r\n     37 message = _descriptor.FieldDescriptor(\r\n     38   name='message', full_name='scalapb.message', index=1,\r\n     39   number=1020, type=11, cpp_type=10, label=1,\r\n   (...)\r\n     42   is_extension=True, extension_scope=None,\r\n     43   serialized_options=None, file=DESCRIPTOR)\r\n\r\nFile /opt/anaconda3/envs/spark32/lib/python3.9/site-packages/google/protobuf/descriptor.py:560, in FieldDescriptor.__new__(cls, name, full_name, index, number, type, cpp_type, label, default_value, message_type, enum_type, containing_type, is_extension, extension_scope, options, serialized_options, has_default_value, containing_oneof, json_name, file, create_key)\r\n    554 def __new__(cls, name, full_name, index, number, type, cpp_type, label,\r\n    555             default_value, message_type, enum_type, containing_type,\r\n    556             is_extension, extension_scope, options=None,\r\n    557             serialized_options=None,\r\n    558             has_default_value=True, containing_oneof=None, json_name=None,\r\n    559             file=None, create_key=None):  # pylint: disable=redefined-builtin\r\n--> 560   _message.Message._CheckCalledFromGeneratedFile()\r\n    561   if is_extension:\r\n    562     return _message.default_pool.FindExtensionByName(full_name)\r\n\r\nTypeError: Descriptors cannot not be created directly.\r\nIf this call came from a _pb2.py file, your generated code is out of date and must be regenerated with protoc >= 3.19.0.\r\nIf you cannot immediately regenerate your protos, some other possible workarounds are:\r\n 1. Downgrade the protobuf package to 3.20.x or lower.\r\n 2. Set PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION=python (but this will use pure-Python parsing and will be much slower).\r\n\r\nMore information: https://developers.google.com/protocol-buffers/docs/news/2022-05-06#python-updates\n\n### Other info / logs\n\n_No response_\n\n### What component(s) does this bug affect?\n\n- [ ] `area/artifacts`: Artifact stores and artifact logging\n- [ ] `area/build`: Build and test infrastructure for MLflow\n- [ ] `area/docs`: MLflow documentation pages\n- [ ] `area/examples`: Example code\n- [ ] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\n- [ ] `area/pipelines`: Pipelines, Pipeline APIs, Pipeline configs, Pipeline Templates\n- [ ] `area/projects`: MLproject format, project running backends\n- [ ] `area/scoring`: MLflow Model server, model deployment tools, Spark UDFs\n- [ ] `area/server-infra`: MLflow Tracking server backend\n- [X] `area/tracking`: Tracking Service, tracking client APIs, autologging\n\n### What interface(s) does this bug affect?\n\n- [ ] `area/uiux`: Front-end, user experience, plotting, JavaScript, JavaScript dev server\n- [ ] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\n- [ ] `area/windows`: Windows support\n\n### What language(s) does this bug affect?\n\n- [ ] `language/r`: R APIs and clients\n- [ ] `language/java`: Java APIs and clients\n- [ ] `language/new`: Proposals for new client languages\n\n### What integration(s) does this bug affect?\n\n- [ ] `integrations/azure`: Azure and Azure ML integrations\n- [ ] `integrations/sagemaker`: SageMaker integrations\n- [ ] `integrations/databricks`: Databricks integrations","closed_by":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/6572/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/6572/timeline","performed_via_github_app":null,"state_reason":"completed"}