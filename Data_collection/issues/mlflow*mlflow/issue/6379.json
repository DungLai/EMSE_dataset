{"url":"https://api.github.com/repos/mlflow/mlflow/issues/6379","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/6379/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/6379/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/6379/events","html_url":"https://github.com/mlflow/mlflow/issues/6379","id":1325129020,"node_id":"I_kwDOCB5Jx85O-908","number":6379,"title":"Migrate environment variables used in MLflow (e.g. `MLFLOW_S3_ENDPOINT_URL`) to the `mlflow.environment_variables` module","user":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"labels":[{"id":955449436,"node_id":"MDU6TGFiZWw5NTU0NDk0MzY=","url":"https://api.github.com/repos/mlflow/mlflow/labels/good%20first%20issue","name":"good first issue","color":"7057ff","default":true,"description":"Good for newcomers"}],"state":"open","locked":false,"assignee":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"assignees":[{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},{"login":"ahlag","id":51813538,"node_id":"MDQ6VXNlcjUxODEzNTM4","avatar_url":"https://avatars.githubusercontent.com/u/51813538?v=4","gravatar_id":"","url":"https://api.github.com/users/ahlag","html_url":"https://github.com/ahlag","followers_url":"https://api.github.com/users/ahlag/followers","following_url":"https://api.github.com/users/ahlag/following{/other_user}","gists_url":"https://api.github.com/users/ahlag/gists{/gist_id}","starred_url":"https://api.github.com/users/ahlag/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ahlag/subscriptions","organizations_url":"https://api.github.com/users/ahlag/orgs","repos_url":"https://api.github.com/users/ahlag/repos","events_url":"https://api.github.com/users/ahlag/events{/privacy}","received_events_url":"https://api.github.com/users/ahlag/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2022-08-02T00:24:23Z","updated_at":"2022-10-28T00:41:49Z","closed_at":null,"author_association":"MEMBER","active_lock_reason":null,"body":"In https://github.com/mlflow/mlflow/pull/5745, we added the `mlflow.environment_variables` module to define environment variables used in MLflow in one place and provide a document for them. We should migrate the environment variables in the table below to this module as we did in https://github.com/mlflow/mlflow/pull/6375.\r\n\r\n\r\n| Name                                    | Location                                                                                                                                | Assignee   | PR   |\r\n|:----------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------|:-----------|:-----|\r\n| `MLFLOW_TRACKING_DIR`                   | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/store/tracking/file_store.py#L79                  |            |      |\r\n| `MLFLOW_ENABLE_DBFS_FUSE_ARTIFACT_REPO` | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/store/artifact/dbfs_artifact_repo.py#L29          |            |      |\r\n| `MLFLOW_DISABLE_ENV_CREATION`           | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/models/docker_utils.py#L79                        |            |      |\r\n| `MLFLOW_DEPLOYMENT_FLAVOR_NAME`         | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/models/container/__init__.py#L32                  |            |      |\r\n| `MLFLOW_PIPELINES_PROFILE`              | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/pipelines/utils/__init__.py#L13                   |            |      |\r\n| `MLFLOW_PIPELINES_EXECUTION_DIRECTORY`  | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/pipelines/utils/execution.py#L12                  |            |      |\r\n| `MLFLOW_SAGEMAKER_DEPLOY_IMG_URL`       | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/sagemaker/__init__.py#L36                         |            |      |\r\n| `MLFLOW_EXPERIMENT_NAME`                | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/tracking/fluent.py#L57                            |            |      |\r\n| `MLFLOW_EXPERIMENT_ID`                  | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/tracking/fluent.py#L56                            |            |      |\r\n| `MLFLOW_RUN_ID`                         | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/tracking/fluent.py#L58                            |            |      |\r\n| `MLFLOW_RUN_CONTEXT`                    | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/tracking/context/system_environment_context.py#L7 |            |      |\r\n| `MLFLOW_TRACKING_USERNAME`              | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/tracking/_tracking_service/utils.py#L21           |            |      |\r\n| `MLFLOW_TRACKING_URI`                   | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/tracking/_tracking_service/utils.py#L17           |            |      |\r\n| `MLFLOW_TRACKING_SERVER_CERT_PATH`      | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/tracking/_tracking_service/utils.py#L28           |            |      |\r\n| `MLFLOW_TRACKING_INSECURE_TLS`          | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/tracking/_tracking_service/utils.py#L27           |            |      |\r\n| `MLFLOW_TRACKING_TOKEN`                 | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/tracking/_tracking_service/utils.py#L23           |            |      |\r\n| `MLFLOW_TRACKING_CLIENT_CERT_PATH`      | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/tracking/_tracking_service/utils.py#L32           |            |      |\r\n| `MLFLOW_TRACKING_PASSWORD`              | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/tracking/_tracking_service/utils.py#L22           |            |      |\r\n| `MLFLOW_CONDA_HOME`                     | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/utils/conda.py#L13                                |            |      |\r\n| `MLFLOW_CONDA_CREATE_ENV_CMD`           | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/utils/conda.py#L21                                |            |      |\r\n| `MLFLOW_ENV_ROOT`                       | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/utils/virtualenv.py#L23                           |            |      |\r\n| `MLFLOW_AUTOLOGGING_TESTING`            | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/utils/autologging_utils/safety.py#L25             |            |      |\r\n| `MLFLOW_AUTOLOGGING_TESTING`            | https://github.com/mlflow/mlflow/blob/1b89add428da0a4453e7523a20d13f04f6291f37/mlflow/utils/autologging_utils/__init__.py#L45           |            |      |\r\n\r\n<details>\r\n<summary>Code toe generate this table</summary>\r\n\r\n```python\r\nimport ast\r\nfrom pathlib import Path\r\nfrom typing import Iterable, Set, Dict, Tuple\r\nimport re\r\nfrom collections import defaultdict\r\nimport pandas as pd\r\n\r\n\r\ndef iter_python_scripts(root: str) -> Iterable[Path]:\r\n    for p in Path(root).rglob(\"*\"):\r\n        if p.name.endswith(\".py\"):\r\n            yield p\r\n\r\n\r\ndef read_file(path: Path) -> str:\r\n    return path.read_text()\r\n\r\n\r\nclass Visitor(ast.NodeVisitor):\r\n    def __init__(self) -> None:\r\n        super().__init__()\r\n        self.nodes: Set[str] = set()\r\n\r\n    def visit_Assign(self, node: ast.Assign):\r\n        if isinstance(node.value, ast.Str) and re.match(r\"^MLFLOW_[A-Z0-9_]+$\", node.value.s):\r\n            self.nodes.add((node.value.s, node.lineno))\r\n        self.generic_visit(node)\r\n\r\n\r\ndef main() -> None:\r\n    envs: Dict[str, Set(Tuple(str, int))] = dict()\r\n    for d in [\"mlflow\"]:\r\n        for path in iter_python_scripts(d):\r\n            if str(path) == \"mlflow/environment_variables.py\":\r\n                continue\r\n            visitor = Visitor()\r\n            src = read_file(path)\r\n            root = ast.parse(src)\r\n            visitor.visit(root)\r\n            if visitor.nodes:\r\n                envs[str(path)] = visitor.nodes\r\n\r\n    data = []\r\n    for path, vals in envs.items():\r\n        for (name, lineno) in vals:\r\n            data.append(\r\n                (\r\n                    f\"`{name}`\",\r\n                    \"https://github.com/mlflow/mlflow/blob/{}/{}#L{}\".format(\r\n                        \"1b89add428da0a4453e7523a20d13f04f6291f37\", path, lineno\r\n                    ),\r\n                    \"\",\r\n                    \"\",\r\n                )\r\n            )\r\n\r\n    print(\r\n        pd.DataFrame(data, columns=[\"Name\", \"Location\", \"Assignee\", \"PR\"]).to_markdown(index=False)\r\n    )\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>Old table</summary>\r\n\r\n|Location|Assignee|PR|\r\n|:-|:-|:-|\r\n|https://github.com/mlflow/mlflow/blob/c98313482168137e39a6e6b0ed7169de5bfe0ba5/mlflow/data.py#L37-L38|WON'T DO. It looks like `_fetch_s3` is not used at all|-|\r\n|https://github.com/mlflow/mlflow/blob/f7a42be1e29ec1ff1f6086cdb79d75248f877715/mlflow/store/artifact/s3_artifact_repo.py#L79|@ahlag|https://github.com/mlflow/mlflow/pull/6438|\r\n|https://github.com/mlflow/mlflow/blob/2a05d7d0cc65d4d72bc42b47321ae5b5011944dc/mlflow/projects/backend/local.py#L362-L366|@ahlag|https://github.com/mlflow/mlflow/pull/6438|\r\n|https://github.com/mlflow/mlflow/blob/4422fafb94a0003cfa6170ca3a9692bea518234e/mlflow/store/db/utils.py#L18-L20|@harupy|#6396|\r\n\r\n</details>\r\n\r\n\r\n\r\n(I'll add more environment variables to the table.)\r\n\r\n\r\n### Example PR:\r\n\r\nhttps://github.com/mlflow/mlflow/pull/6375","closed_by":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/6379/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/6379/timeline","performed_via_github_app":null,"state_reason":"reopened"}