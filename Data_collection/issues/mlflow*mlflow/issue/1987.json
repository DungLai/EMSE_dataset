{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1987","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/1987/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/1987/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/1987/events","html_url":"https://github.com/mlflow/mlflow/issues/1987","id":512009834,"node_id":"MDU6SXNzdWU1MTIwMDk4MzQ=","number":1987,"title":"[BUG] Calling get_artifact_uri() causes mlflow to get stuck at a run which cannot be killed","user":{"login":"mirekphd","id":36706320,"node_id":"MDQ6VXNlcjM2NzA2MzIw","avatar_url":"https://avatars.githubusercontent.com/u/36706320?v=4","gravatar_id":"","url":"https://api.github.com/users/mirekphd","html_url":"https://github.com/mirekphd","followers_url":"https://api.github.com/users/mirekphd/followers","following_url":"https://api.github.com/users/mirekphd/following{/other_user}","gists_url":"https://api.github.com/users/mirekphd/gists{/gist_id}","starred_url":"https://api.github.com/users/mirekphd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mirekphd/subscriptions","organizations_url":"https://api.github.com/users/mirekphd/orgs","repos_url":"https://api.github.com/users/mirekphd/repos","events_url":"https://api.github.com/users/mirekphd/events{/privacy}","received_events_url":"https://api.github.com/users/mirekphd/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1554650079,"node_id":"MDU6TGFiZWwxNTU0NjUwMDc5","url":"https://api.github.com/repos/mlflow/mlflow/labels/stale","name":"stale","color":"828282","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"smurching","id":2358483,"node_id":"MDQ6VXNlcjIzNTg0ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2358483?v=4","gravatar_id":"","url":"https://api.github.com/users/smurching","html_url":"https://github.com/smurching","followers_url":"https://api.github.com/users/smurching/followers","following_url":"https://api.github.com/users/smurching/following{/other_user}","gists_url":"https://api.github.com/users/smurching/gists{/gist_id}","starred_url":"https://api.github.com/users/smurching/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smurching/subscriptions","organizations_url":"https://api.github.com/users/smurching/orgs","repos_url":"https://api.github.com/users/smurching/repos","events_url":"https://api.github.com/users/smurching/events{/privacy}","received_events_url":"https://api.github.com/users/smurching/received_events","type":"User","site_admin":false},"assignees":[{"login":"smurching","id":2358483,"node_id":"MDQ6VXNlcjIzNTg0ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2358483?v=4","gravatar_id":"","url":"https://api.github.com/users/smurching","html_url":"https://github.com/smurching","followers_url":"https://api.github.com/users/smurching/followers","following_url":"https://api.github.com/users/smurching/following{/other_user}","gists_url":"https://api.github.com/users/smurching/gists{/gist_id}","starred_url":"https://api.github.com/users/smurching/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smurching/subscriptions","organizations_url":"https://api.github.com/users/smurching/orgs","repos_url":"https://api.github.com/users/smurching/repos","events_url":"https://api.github.com/users/smurching/events{/privacy}","received_events_url":"https://api.github.com/users/smurching/received_events","type":"User","site_admin":false},{"login":"andychow-db","id":58712524,"node_id":"MDQ6VXNlcjU4NzEyNTI0","avatar_url":"https://avatars.githubusercontent.com/u/58712524?v=4","gravatar_id":"","url":"https://api.github.com/users/andychow-db","html_url":"https://github.com/andychow-db","followers_url":"https://api.github.com/users/andychow-db/followers","following_url":"https://api.github.com/users/andychow-db/following{/other_user}","gists_url":"https://api.github.com/users/andychow-db/gists{/gist_id}","starred_url":"https://api.github.com/users/andychow-db/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andychow-db/subscriptions","organizations_url":"https://api.github.com/users/andychow-db/orgs","repos_url":"https://api.github.com/users/andychow-db/repos","events_url":"https://api.github.com/users/andychow-db/events{/privacy}","received_events_url":"https://api.github.com/users/andychow-db/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2019-10-24T15:11:06Z","updated_at":"2021-08-10T10:02:59Z","closed_at":"2020-01-08T19:30:55Z","author_association":"NONE","active_lock_reason":null,"body":"I get a \"Run with UUID < uuid >  is already active\" error every time I call in the python script a seemingly innocuous read-only function `get_artifact_uri()` (\"get*\" functions are not supposed to alter anything...) - as a pure side effect of its being run. It breaks a python 3 code that worked previously for hundreds of runs and saved metrics for three different algos to a MariaDB database. I do not attempt to save any artifacts, just connect to the mlflow server and try to invoke `log_metric()` or `log_param()`. The MLflow web UI shows an empty table entry was created at this time, and a db query shows a new db record is being created for the current experiment.\r\n\r\nRestarting python 3 kernel in the notebook (apart from commenting out the offending function call) is also required to get rid of the problem.\r\n\r\n Every time I restart `mlflow server` (entire container) I get a different UUID in the error message:\r\n`Exception: Run with UUID 0c2471380c5949b4af7a18d0f1972f23 is already active. To start a nested run, call start_run with nested=True`\r\n\r\nIf I do not connect to the mlflow server (don't invoke `mlflow.set_tracking_uri(uri=tracking_server_url)`), then the error does not appear (but my results do not get stored in the db either).\r\n\r\nTrying to kill the run with `mlflow.end_run(status=\"KILLED\")` fails, and mlflow server reports the following error (keep scrolling:):\r\n\r\n```\r\n2019/10/24 14:53:34 ERROR mlflow.server: Exception on /api/2.0/mlflow/runs/update [POST]\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1249, in _execute_context\r\n    cursor, statement, parameters, context\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/default.py\", line 580, in do_execute\r\n    cursor.execute(statement, parameters)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/cursors.py\", line 209, in execute\r\n    res = self._query(query)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/cursors.py\", line 315, in _query\r\n    db.query(q)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/connections.py\", line 226, in query\r\n    _mysql.connection.query(self, query)\r\nMySQLdb._exceptions.OperationalError: (4025, 'CONSTRAINT `status` failed for `mariadb`.`runs`')\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/sqlalchemy_store.py\", line 158, in make_managed_session\r\n    yield session\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/sqlalchemy_store.py\", line 466, in update_run_info\r\n    run = run.to_mlflow_entity()\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/dbmodels/models.py\", line 174, in to_mlflow_entity\r\n    metrics=[m.to_mlflow_entity() for m in self.latest_metrics],\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/attributes.py\", line 282, in __get__\r\n    return self.impl.get(instance_state(instance), dict_)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/attributes.py\", line 710, in get\r\n    value = self.callable_(state, passive)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/strategies.py\", line 730, in _load_for_state\r\n    session, state, primary_key_identity, passive\r\n  File \"<string>\", line 1, in <lambda>\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/strategies.py\", line 872, in _emit_lazyload\r\n    .with_post_criteria(set_default_params)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/ext/baked.py\", line 531, in all\r\n    return list(self)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/ext/baked.py\", line 429, in __iter__\r\n    self.session._autoflush()\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/session.py\", line 1588, in _autoflush\r\n    util.raise_from_cause(e)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 398, in raise_from_cause\r\n    reraise(type(exception), exception, tb=exc_tb, cause=cause)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 153, in reraise\r\n    raise value\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/session.py\", line 1577, in _autoflush\r\n    self.flush()\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/session.py\", line 2470, in flush\r\n    self._flush(objects)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/session.py\", line 2608, in _flush\r\n    transaction.rollback(_capture_exception=True)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/langhelpers.py\", line 68, in __exit__\r\n    compat.reraise(exc_type, exc_value, exc_tb)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 153, in reraise\r\n    raise value\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/session.py\", line 2568, in _flush\r\n    flush_context.execute()\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/unitofwork.py\", line 422, in execute\r\n    rec.execute(self)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/unitofwork.py\", line 589, in execute\r\n    uow,\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/persistence.py\", line 236, in save_obj\r\n    update,\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/persistence.py\", line 996, in _emit_update_statements\r\n    statement, multiparams\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 988, in execute\r\n    return meth(self, multiparams, params)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/sql/elements.py\", line 287, in _execute_on_connection\r\n    return connection._execute_clauseelement(self, multiparams, params)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1107, in _execute_clauseelement\r\n    distilled_params,\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1253, in _execute_context\r\n    e, statement, parameters, cursor, context\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1473, in _handle_dbapi_exception\r\n    util.raise_from_cause(sqlalchemy_exception, exc_info)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 398, in raise_from_cause\r\n    reraise(type(exception), exception, tb=exc_tb, cause=cause)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 152, in reraise\r\n    raise value.with_traceback(tb)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1249, in _execute_context\r\n    cursor, statement, parameters, context\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/default.py\", line 580, in do_execute\r\n    cursor.execute(statement, parameters)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/cursors.py\", line 209, in execute\r\n    res = self._query(query)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/cursors.py\", line 315, in _query\r\n    db.query(q)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/connections.py\", line 226, in query\r\n    _mysql.connection.query(self, query)\r\nsqlalchemy.exc.OperationalError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)\r\n(MySQLdb._exceptions.OperationalError) (4025, 'CONSTRAINT `status` failed for `mariadb`.`runs`')\r\n[SQL: UPDATE runs SET status=%s, end_time=%s WHERE runs.run_uuid = %s]\r\n[parameters: ('KILLED', 1571928814925, 'f6ba2d9431994eaa81cf28db67277387')]\r\n(Background on this error at: http://sqlalche.me/e/e3q8 )\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/server/handlers.py\", line 102, in wrapper\r\n    return func(*args, **kwargs)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/server/handlers.py\", line 238, in _update_run\r\n    request_message.end_time)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/sqlalchemy_store.py\", line 468, in update_run_info\r\n    return run.info\r\n  File \"/opt/conda/lib/python3.6/contextlib.py\", line 99, in __exit__\r\n    self.gen.throw(type, value, traceback)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/sqlalchemy_store.py\", line 165, in make_managed_session\r\n    raise MlflowException(message=e, error_code=INTERNAL_ERROR)\r\nmlflow.exceptions.MlflowException: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)\r\n(MySQLdb._exceptions.OperationalError) (4025, 'CONSTRAINT `status` failed for `mariadb`.`runs`')\r\n[SQL: UPDATE runs SET status=%s, end_time=%s WHERE runs.run_uuid = %s]\r\n[parameters: ('KILLED', 1571928814925, 'f6ba2d9431994eaa81cf28db67277387')]\r\n(Background on this error at: http://sqlalche.me/e/e3q8 )\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 2446, in wsgi_app\r\n    response = self.full_dispatch_request()\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1951, in full_dispatch_request\r\n    rv = self.handle_user_exception(e)\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1820, in handle_user_exception\r\n    reraise(exc_type, exc_value, tb)\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/_compat.py\", line 39, in reraise\r\n    raise value\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1949, in full_dispatch_request\r\n    rv = self.dispatch_request()\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1935, in dispatch_request\r\n    return self.view_functions[rule.endpoint](**req.view_args)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/server/handlers.py\", line 105, in wrapper\r\n    response.set_data(e.serialize_as_json())\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/exceptions.py\", line 50, in serialize_as_json\r\n    return json.dumps(exception_dict)\r\n  File \"/opt/conda/lib/python3.6/json/__init__.py\", line 231, in dumps\r\n    return _default_encoder.encode(obj)\r\n  File \"/opt/conda/lib/python3.6/json/encoder.py\", line 199, in encode\r\n    chunks = self.iterencode(o, _one_shot=True)\r\n  File \"/opt/conda/lib/python3.6/json/encoder.py\", line 257, in iterencode\r\n    return _iterencode(o, 0)\r\n  File \"/opt/conda/lib/python3.6/json/encoder.py\", line 180, in default\r\n    o.__class__.__name__)\r\nTypeError: Object of type 'OperationalError' is not JSON serializable\r\n2019/10/24 14:53:37 ERROR mlflow.server: Exception on /api/2.0/mlflow/runs/update [POST]\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1249, in _execute_context\r\n    cursor, statement, parameters, context\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/default.py\", line 580, in do_execute\r\n    cursor.execute(statement, parameters)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/cursors.py\", line 209, in execute\r\n    res = self._query(query)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/cursors.py\", line 315, in _query\r\n    db.query(q)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/connections.py\", line 226, in query\r\n    _mysql.connection.query(self, query)\r\nMySQLdb._exceptions.OperationalError: (4025, 'CONSTRAINT `status` failed for `mariadb`.`runs`')\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/sqlalchemy_store.py\", line 158, in make_managed_session\r\n    yield session\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/sqlalchemy_store.py\", line 466, in update_run_info\r\n    run = run.to_mlflow_entity()\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/dbmodels/models.py\", line 174, in to_mlflow_entity\r\n    metrics=[m.to_mlflow_entity() for m in self.latest_metrics],\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/attributes.py\", line 282, in __get__\r\n    return self.impl.get(instance_state(instance), dict_)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/attributes.py\", line 710, in get\r\n    value = self.callable_(state, passive)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/strategies.py\", line 730, in _load_for_state\r\n    session, state, primary_key_identity, passive\r\n  File \"<string>\", line 1, in <lambda>\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/strategies.py\", line 872, in _emit_lazyload\r\n    .with_post_criteria(set_default_params)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/ext/baked.py\", line 531, in all\r\n    return list(self)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/ext/baked.py\", line 429, in __iter__\r\n    self.session._autoflush()\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/session.py\", line 1588, in _autoflush\r\n    util.raise_from_cause(e)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 398, in raise_from_cause\r\n    reraise(type(exception), exception, tb=exc_tb, cause=cause)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 153, in reraise\r\n    raise value\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/session.py\", line 1577, in _autoflush\r\n    self.flush()\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/session.py\", line 2470, in flush\r\n    self._flush(objects)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/session.py\", line 2608, in _flush\r\n    transaction.rollback(_capture_exception=True)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/langhelpers.py\", line 68, in __exit__\r\n    compat.reraise(exc_type, exc_value, exc_tb)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 153, in reraise\r\n    raise value\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/session.py\", line 2568, in _flush\r\n    flush_context.execute()\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/unitofwork.py\", line 422, in execute\r\n    rec.execute(self)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/unitofwork.py\", line 589, in execute\r\n    uow,\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/persistence.py\", line 236, in save_obj\r\n    update,\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/persistence.py\", line 996, in _emit_update_statements\r\n    statement, multiparams\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 988, in execute\r\n    return meth(self, multiparams, params)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/sql/elements.py\", line 287, in _execute_on_connection\r\n    return connection._execute_clauseelement(self, multiparams, params)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1107, in _execute_clauseelement\r\n    distilled_params,\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1253, in _execute_context\r\n    e, statement, parameters, cursor, context\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1473, in _handle_dbapi_exception\r\n    util.raise_from_cause(sqlalchemy_exception, exc_info)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 398, in raise_from_cause\r\n    reraise(type(exception), exception, tb=exc_tb, cause=cause)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 152, in reraise\r\n    raise value.with_traceback(tb)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1249, in _execute_context\r\n    cursor, statement, parameters, context\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/default.py\", line 580, in do_execute\r\n    cursor.execute(statement, parameters)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/cursors.py\", line 209, in execute\r\n    res = self._query(query)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/cursors.py\", line 315, in _query\r\n    db.query(q)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/connections.py\", line 226, in query\r\n    _mysql.connection.query(self, query)\r\nsqlalchemy.exc.OperationalError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)\r\n(MySQLdb._exceptions.OperationalError) (4025, 'CONSTRAINT `status` failed for `mariadb`.`runs`')\r\n[SQL: UPDATE runs SET status=%s, end_time=%s WHERE runs.run_uuid = %s]\r\n[parameters: ('KILLED', 1571928814925, 'f6ba2d9431994eaa81cf28db67277387')]\r\n(Background on this error at: http://sqlalche.me/e/e3q8 )\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/server/handlers.py\", line 102, in wrapper\r\n    return func(*args, **kwargs)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/server/handlers.py\", line 238, in _update_run\r\n    request_message.end_time)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/sqlalchemy_store.py\", line 468, in update_run_info\r\n    return run.info\r\n  File \"/opt/conda/lib/python3.6/contextlib.py\", line 99, in __exit__\r\n    self.gen.throw(type, value, traceback)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/sqlalchemy_store.py\", line 165, in make_managed_session\r\n    raise MlflowException(message=e, error_code=INTERNAL_ERROR)\r\nmlflow.exceptions.MlflowException: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)\r\n(MySQLdb._exceptions.OperationalError) (4025, 'CONSTRAINT `status` failed for `mariadb`.`runs`')\r\n[SQL: UPDATE runs SET status=%s, end_time=%s WHERE runs.run_uuid = %s]\r\n[parameters: ('KILLED', 1571928814925, 'f6ba2d9431994eaa81cf28db67277387')]\r\n(Background on this error at: http://sqlalche.me/e/e3q8 )\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 2446, in wsgi_app\r\n    response = self.full_dispatch_request()\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1951, in full_dispatch_request\r\n    rv = self.handle_user_exception(e)\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1820, in handle_user_exception\r\n    reraise(exc_type, exc_value, tb)\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/_compat.py\", line 39, in reraise\r\n    raise value\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1949, in full_dispatch_request\r\n    rv = self.dispatch_request()\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1935, in dispatch_request\r\n    return self.view_functions[rule.endpoint](**req.view_args)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/server/handlers.py\", line 105, in wrapper\r\n    response.set_data(e.serialize_as_json())\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/exceptions.py\", line 50, in serialize_as_json\r\n    return json.dumps(exception_dict)\r\n  File \"/opt/conda/lib/python3.6/json/__init__.py\", line 231, in dumps\r\n    return _default_encoder.encode(obj)\r\n  File \"/opt/conda/lib/python3.6/json/encoder.py\", line 199, in encode\r\n    chunks = self.iterencode(o, _one_shot=True)\r\n  File \"/opt/conda/lib/python3.6/json/encoder.py\", line 257, in iterencode\r\n    return _iterencode(o, 0)\r\n  File \"/opt/conda/lib/python3.6/json/encoder.py\", line 180, in default\r\n    o.__class__.__name__)\r\nTypeError: Object of type 'OperationalError' is not JSON serializable\r\n2019/10/24 14:53:41 ERROR mlflow.server: Exception on /api/2.0/mlflow/runs/update [POST]\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1249, in _execute_context\r\n    cursor, statement, parameters, context\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/default.py\", line 580, in do_execute\r\n    cursor.execute(statement, parameters)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/cursors.py\", line 209, in execute\r\n    res = self._query(query)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/cursors.py\", line 315, in _query\r\n    db.query(q)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/connections.py\", line 226, in query\r\n    _mysql.connection.query(self, query)\r\nMySQLdb._exceptions.OperationalError: (4025, 'CONSTRAINT `status` failed for `mariadb`.`runs`')\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/sqlalchemy_store.py\", line 158, in make_managed_session\r\n    yield session\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/sqlalchemy_store.py\", line 466, in update_run_info\r\n    run = run.to_mlflow_entity()\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/dbmodels/models.py\", line 174, in to_mlflow_entity\r\n    metrics=[m.to_mlflow_entity() for m in self.latest_metrics],\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/attributes.py\", line 282, in __get__\r\n    return self.impl.get(instance_state(instance), dict_)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/attributes.py\", line 710, in get\r\n    value = self.callable_(state, passive)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/strategies.py\", line 730, in _load_for_state\r\n    session, state, primary_key_identity, passive\r\n  File \"<string>\", line 1, in <lambda>\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/strategies.py\", line 872, in _emit_lazyload\r\n    .with_post_criteria(set_default_params)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/ext/baked.py\", line 531, in all\r\n    return list(self)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/ext/baked.py\", line 429, in __iter__\r\n    self.session._autoflush()\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/session.py\", line 1588, in _autoflush\r\n    util.raise_from_cause(e)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 398, in raise_from_cause\r\n    reraise(type(exception), exception, tb=exc_tb, cause=cause)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 153, in reraise\r\n    raise value\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/session.py\", line 1577, in _autoflush\r\n    self.flush()\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/session.py\", line 2470, in flush\r\n    self._flush(objects)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/session.py\", line 2608, in _flush\r\n    transaction.rollback(_capture_exception=True)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/langhelpers.py\", line 68, in __exit__\r\n    compat.reraise(exc_type, exc_value, exc_tb)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 153, in reraise\r\n    raise value\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/session.py\", line 2568, in _flush\r\n    flush_context.execute()\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/unitofwork.py\", line 422, in execute\r\n    rec.execute(self)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/unitofwork.py\", line 589, in execute\r\n    uow,\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/persistence.py\", line 236, in save_obj\r\n    update,\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/orm/persistence.py\", line 996, in _emit_update_statements\r\n    statement, multiparams\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 988, in execute\r\n    return meth(self, multiparams, params)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/sql/elements.py\", line 287, in _execute_on_connection\r\n    return connection._execute_clauseelement(self, multiparams, params)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1107, in _execute_clauseelement\r\n    distilled_params,\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1253, in _execute_context\r\n    e, statement, parameters, cursor, context\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1473, in _handle_dbapi_exception\r\n    util.raise_from_cause(sqlalchemy_exception, exc_info)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 398, in raise_from_cause\r\n    reraise(type(exception), exception, tb=exc_tb, cause=cause)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 152, in reraise\r\n    raise value.with_traceback(tb)\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1249, in _execute_context\r\n    cursor, statement, parameters, context\r\n  File \"/opt/conda/lib/python3.6/site-packages/sqlalchemy/engine/default.py\", line 580, in do_execute\r\n    cursor.execute(statement, parameters)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/cursors.py\", line 209, in execute\r\n    res = self._query(query)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/cursors.py\", line 315, in _query\r\n    db.query(q)\r\n  File \"/opt/conda/lib/python3.6/site-packages/MySQLdb/connections.py\", line 226, in query\r\n    _mysql.connection.query(self, query)\r\nsqlalchemy.exc.OperationalError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)\r\n(MySQLdb._exceptions.OperationalError) (4025, 'CONSTRAINT `status` failed for `mariadb`.`runs`')\r\n[SQL: UPDATE runs SET status=%s, end_time=%s WHERE runs.run_uuid = %s]\r\n[parameters: ('KILLED', 1571928814925, 'f6ba2d9431994eaa81cf28db67277387')]\r\n(Background on this error at: http://sqlalche.me/e/e3q8 )\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/server/handlers.py\", line 102, in wrapper\r\n    return func(*args, **kwargs)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/server/handlers.py\", line 238, in _update_run\r\n    request_message.end_time)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/sqlalchemy_store.py\", line 468, in update_run_info\r\n    return run.info\r\n  File \"/opt/conda/lib/python3.6/contextlib.py\", line 99, in __exit__\r\n    self.gen.throw(type, value, traceback)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/sqlalchemy_store.py\", line 165, in make_managed_session\r\n    raise MlflowException(message=e, error_code=INTERNAL_ERROR)\r\nmlflow.exceptions.MlflowException: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)\r\n(MySQLdb._exceptions.OperationalError) (4025, 'CONSTRAINT `status` failed for `mariadb`.`runs`')\r\n[SQL: UPDATE runs SET status=%s, end_time=%s WHERE runs.run_uuid = %s]\r\n[parameters: ('KILLED', 1571928814925, 'f6ba2d9431994eaa81cf28db67277387')]\r\n(Background on this error at: http://sqlalche.me/e/e3q8 )\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 2446, in wsgi_app\r\n    response = self.full_dispatch_request()\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1951, in full_dispatch_request\r\n    rv = self.handle_user_exception(e)\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1820, in handle_user_exception\r\n    reraise(exc_type, exc_value, tb)\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/_compat.py\", line 39, in reraise\r\n    raise value\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1949, in full_dispatch_request\r\n    rv = self.dispatch_request()\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1935, in dispatch_request\r\n    return self.view_functions[rule.endpoint](**req.view_args)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/server/handlers.py\", line 105, in wrapper\r\n    response.set_data(e.serialize_as_json())\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/exceptions.py\", line 50, in serialize_as_json\r\n    return json.dumps(exception_dict)\r\n  File \"/opt/conda/lib/python3.6/json/__init__.py\", line 231, in dumps\r\n    return _default_encoder.encode(obj)\r\n  File \"/opt/conda/lib/python3.6/json/encoder.py\", line 199, in encode\r\n    chunks = self.iterencode(o, _one_shot=True)\r\n  File \"/opt/conda/lib/python3.6/json/encoder.py\", line 257, in iterencode\r\n    return _iterencode(o, 0)\r\n  File \"/opt/conda/lib/python3.6/json/encoder.py\", line 180, in default\r\n    o.__class__.__name__)\r\nTypeError: Object of type 'OperationalError' is not JSON serializable\r\n\r\n```","closed_by":{"login":"smurching","id":2358483,"node_id":"MDQ6VXNlcjIzNTg0ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2358483?v=4","gravatar_id":"","url":"https://api.github.com/users/smurching","html_url":"https://github.com/smurching","followers_url":"https://api.github.com/users/smurching/followers","following_url":"https://api.github.com/users/smurching/following{/other_user}","gists_url":"https://api.github.com/users/smurching/gists{/gist_id}","starred_url":"https://api.github.com/users/smurching/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smurching/subscriptions","organizations_url":"https://api.github.com/users/smurching/orgs","repos_url":"https://api.github.com/users/smurching/repos","events_url":"https://api.github.com/users/smurching/events{/privacy}","received_events_url":"https://api.github.com/users/smurching/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1987/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/1987/timeline","performed_via_github_app":null,"state_reason":"completed"}