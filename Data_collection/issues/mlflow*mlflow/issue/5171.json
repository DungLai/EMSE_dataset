{"url":"https://api.github.com/repos/mlflow/mlflow/issues/5171","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/5171/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/5171/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/5171/events","html_url":"https://github.com/mlflow/mlflow/issues/5171","id":1081258821,"node_id":"I_kwDOCB5Jx85AcrNF","number":5171,"title":"[BUG] Using MlflowClient.get_latest_version with an older server instance causes 404","user":{"login":"daanknoope","id":8389610,"node_id":"MDQ6VXNlcjgzODk2MTA=","avatar_url":"https://avatars.githubusercontent.com/u/8389610?v=4","gravatar_id":"","url":"https://api.github.com/users/daanknoope","html_url":"https://github.com/daanknoope","followers_url":"https://api.github.com/users/daanknoope/followers","following_url":"https://api.github.com/users/daanknoope/following{/other_user}","gists_url":"https://api.github.com/users/daanknoope/gists{/gist_id}","starred_url":"https://api.github.com/users/daanknoope/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daanknoope/subscriptions","organizations_url":"https://api.github.com/users/daanknoope/orgs","repos_url":"https://api.github.com/users/daanknoope/repos","events_url":"https://api.github.com/users/daanknoope/events{/privacy}","received_events_url":"https://api.github.com/users/daanknoope/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1893057631,"node_id":"MDU6TGFiZWwxODkzMDU3NjMx","url":"https://api.github.com/repos/mlflow/mlflow/labels/Acknowledged","name":"Acknowledged","color":"f9d0c4","default":false,"description":"This issue has been read and acknowledged by the MLflow admins."},{"id":2022847714,"node_id":"MDU6TGFiZWwyMDIyODQ3NzE0","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/model-registry","name":"area/model-registry","color":"48eabc","default":false,"description":"Model registry, model registry APIs, and the fluent client calls for model registry"}],"state":"open","locked":false,"assignee":{"login":"daanknoope","id":8389610,"node_id":"MDQ6VXNlcjgzODk2MTA=","avatar_url":"https://avatars.githubusercontent.com/u/8389610?v=4","gravatar_id":"","url":"https://api.github.com/users/daanknoope","html_url":"https://github.com/daanknoope","followers_url":"https://api.github.com/users/daanknoope/followers","following_url":"https://api.github.com/users/daanknoope/following{/other_user}","gists_url":"https://api.github.com/users/daanknoope/gists{/gist_id}","starred_url":"https://api.github.com/users/daanknoope/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daanknoope/subscriptions","organizations_url":"https://api.github.com/users/daanknoope/orgs","repos_url":"https://api.github.com/users/daanknoope/repos","events_url":"https://api.github.com/users/daanknoope/events{/privacy}","received_events_url":"https://api.github.com/users/daanknoope/received_events","type":"User","site_admin":false},"assignees":[{"login":"daanknoope","id":8389610,"node_id":"MDQ6VXNlcjgzODk2MTA=","avatar_url":"https://avatars.githubusercontent.com/u/8389610?v=4","gravatar_id":"","url":"https://api.github.com/users/daanknoope","html_url":"https://github.com/daanknoope","followers_url":"https://api.github.com/users/daanknoope/followers","following_url":"https://api.github.com/users/daanknoope/following{/other_user}","gists_url":"https://api.github.com/users/daanknoope/gists{/gist_id}","starred_url":"https://api.github.com/users/daanknoope/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daanknoope/subscriptions","organizations_url":"https://api.github.com/users/daanknoope/orgs","repos_url":"https://api.github.com/users/daanknoope/repos","events_url":"https://api.github.com/users/daanknoope/events{/privacy}","received_events_url":"https://api.github.com/users/daanknoope/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2021-12-15T16:45:39Z","updated_at":"2022-03-31T09:27:29Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### Willingness to contribute\r\nThe MLflow Community encourages bug fix contributions. Would you or another member of your organization be willing to contribute a fix for this bug to the MLflow code base?\r\n\r\n- [ ] Yes. I can contribute a fix for this bug independently.\r\n- [x] Yes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\r\n- [ ] No. I cannot contribute a bug fix at this time.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: SUSE Linux Enterprise Server 12 SP2\r\n- **MLflow installed from (source or binary)**: Binary\r\n- **MLflow version (run ``mlflow --version``)**: 1.22 for the **client**, 1.11.0 for the **server**\r\n- **Python version**: 3.6.12\r\n- **npm version, if running the dev UI**:\r\n- **Exact command to reproduce**: `MlflowClient().get_latest_versions(\"SOME_REGISTERED_MODEL\")`\r\n\r\n### Describe the problem\r\nWe have MlFlow 1.11.0 installed on a server, and version 1.22 on the client. When the client is connected to the server, and executing the `get_latest_version` command, the following message is shown:\r\n\r\n```python\r\nMlflowException: API request to endpoint /api/2.0/mlflow/registered-models/get-latest-versions failed with error code 404 != 200. Response body: '<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\">\r\n\r\n<title>404 Not Found</title>\r\n\r\n<h1>Not Found</h1>\r\n\r\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>\r\n```\r\nThe expected result would have been the latest version information of the model.\r\n\r\n\r\n### Code to reproduce issue\r\n\r\nPrerequisites:\r\n\r\n1. Run mlflow version 1.11.0 on a server in a conda environment\r\n2. Connect a client to the mlflow server using `mlflow.set_tracking_uri()`\r\n3. Create an experiment on the server using `MlflowClient.create_experiment`\r\n\r\nNow run:\r\n\r\n```python\r\nimport mlflow\r\nfrom mlflow.tracking import MlflowClient\r\n\r\nmlflow.set_tracking_uri(\"TRACKING_URI\")\r\n\r\nclient = MlflowClient()\r\nclient.get_latest_versions(\"EXPERIMENT_NAME\")\r\n```\r\n\r\n\r\n### Other info / logs\r\n\r\nThis problem seems to have been introduced with #4999. In that PR, support for POST-calls on get-latest-version was added. \r\nThis by itself is not a problem, since the author of the PR checks that if the POST-call is not available on the server, it catches the `ENDPOINT_NOT_FOUND` exception and tries to use a GET-call. \r\n\r\nThe problem is created however, because it calls `/mlflow/registered-models/get-latest-version` instead of the usual `/preview/mlflow/registered-models/get-latest-versions`. This means  that not an `ENDPONT_NOT_FOUND` exception is thrown, but a 404 Not Found. This exception is not caught, meaning that the program will not continue to try the GET-call and crashes instead.\r\n\r\nIt seems to me that the omission of `preview` in the URL is the root cause of the bug (see: https://github.com/stevenchen-db/mlflow/blob/9bbbb0c28d285476e0f3e2a81ecfbf577d1b03ca/mlflow/protos/model_registry.proto#L133), but I'm not sure if that is on purpose or not. If the omission of `preview` is on purpose, some other way of exception handling could be implemented to avoid getting 404-errors when working with older servers that do not support POST-calls.\r\n\r\nSince the reason behind the missing `preview` part is not entirely clear to me, I did not want to provide a bug fix immediately. If the maintainers could provide some guidance on which approach to fix this bug would be best for this project, I'd be happy to help implement the change.\r\n\r\n### What component(s), interfaces, languages, and integrations does this bug affect?\r\nComponents \r\n- [ ] `area/artifacts`: Artifact stores and artifact logging\r\n- [ ] `area/build`: Build and test infrastructure for MLflow\r\n- [ ] `area/docs`: MLflow documentation pages\r\n- [ ] `area/examples`: Example code\r\n- [x] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\r\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\r\n- [ ] `area/projects`: MLproject format, project running backends\r\n- [ ] `area/scoring`: MLflow Model server, model deployment tools, Spark UDFs\r\n- [ ] `area/server-infra`: MLflow Tracking server backend\r\n- [ ] `area/tracking`: Tracking Service, tracking client APIs, autologging\r\n\r\nInterface \r\n- [ ] `area/uiux`: Front-end, user experience, plotting, JavaScript, JavaScript dev server\r\n- [ ] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\r\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\r\n- [ ] `area/windows`: Windows support\r\n\r\nLanguage \r\n- [ ] `language/r`: R APIs and clients\r\n- [ ] `language/java`: Java APIs and clients\r\n- [ ] `language/new`: Proposals for new client languages\r\n\r\nIntegrations\r\n- [ ] `integrations/azure`: Azure and Azure ML integrations\r\n- [ ] `integrations/sagemaker`: SageMaker integrations\r\n- [ ] `integrations/databricks`: Databricks integrations\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/5171/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/5171/timeline","performed_via_github_app":null,"state_reason":null}