{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2746","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2746/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2746/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2746/events","html_url":"https://github.com/mlflow/mlflow/issues/2746","id":605853699,"node_id":"MDU6SXNzdWU2MDU4NTM2OTk=","number":2746,"title":"EKS MLflow Server S3 Artifact Access Denied","user":{"login":"TheVillageFool","id":23197718,"node_id":"MDQ6VXNlcjIzMTk3NzE4","avatar_url":"https://avatars.githubusercontent.com/u/23197718?v=4","gravatar_id":"","url":"https://api.github.com/users/TheVillageFool","html_url":"https://github.com/TheVillageFool","followers_url":"https://api.github.com/users/TheVillageFool/followers","following_url":"https://api.github.com/users/TheVillageFool/following{/other_user}","gists_url":"https://api.github.com/users/TheVillageFool/gists{/gist_id}","starred_url":"https://api.github.com/users/TheVillageFool/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TheVillageFool/subscriptions","organizations_url":"https://api.github.com/users/TheVillageFool/orgs","repos_url":"https://api.github.com/users/TheVillageFool/repos","events_url":"https://api.github.com/users/TheVillageFool/events{/privacy}","received_events_url":"https://api.github.com/users/TheVillageFool/received_events","type":"User","site_admin":false},"labels":[{"id":1893057631,"node_id":"MDU6TGFiZWwxODkzMDU3NjMx","url":"https://api.github.com/repos/mlflow/mlflow/labels/Acknowledged","name":"Acknowledged","color":"f9d0c4","default":false,"description":"This issue has been read and acknowledged by the MLflow admins."},{"id":1988875934,"node_id":"MDU6TGFiZWwxOTg4ODc1OTM0","url":"https://api.github.com/repos/mlflow/mlflow/labels/needs%20author%20feedback","name":"needs author feedback","color":"fef2c0","default":false,"description":"Issue is waiting for the author to respond"},{"id":2022849295,"node_id":"MDU6TGFiZWwyMDIyODQ5Mjk1","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/tracking","name":"area/tracking","color":"48eabc","default":false,"description":"Tracking service, tracking client APIs, autologging"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-04-23T20:39:04Z","updated_at":"2020-07-13T04:38:56Z","closed_at":"2020-07-13T04:38:56Z","author_association":"NONE","active_lock_reason":null,"body":"Hello,\r\n\r\nI'm currently working on dockerizing and deploying mlflow on an eks cluster. In the dockerfile, I set the env variables and run a script to start mlflow server. I'm able to connect to the server and save to the postgres backend I have set up, but I'm getting an Access Denied when attempting to save artifacts to S3. I ensured the environment variables are set for aws during the deployment since a test 'aws s3 ls' to the artifact bucket returns correctly. Is there something that needs to be done to ensure the credentials are being passed to mlflow server correctly?\r\n\r\nDockerfile:\r\n```\r\nFROM python:3.7.0\r\n\r\nRUN pip install mlflow\r\nRUN pip install boto3\r\nRUN pip install awscli\r\nRUN pip install psycopg2-binary\r\n\r\nENV AWS_MLFLOW_BUCKET=aws_mlflow_bucket\r\nENV AWS_ACCESS_KEY_ID=aws_access_key_id\r\nENV AWS_SECRET_ACCESS_KEY=aws_secret_access_key\r\nENV AWS_SESSION_TOKEN=aws_session_token\r\n\r\nCOPY run.sh /\r\nRUN chmod +x /run.sh\r\nENTRYPOINT [\"/run.sh\"]\r\n```\r\n\r\nrun.sh\r\n```\r\n#!/bin/sh\r\n\r\nset -e\r\n\r\naws s3 ls s3://<bucket_name>\r\n\r\nmlflow server \\\r\n--backend-store-uri ${POSTGRES_DB} \\\r\n--default-artifact-root ${S3_ARTIFACT_BUCKET} \\\r\n--host 0.0.0.0 \\\r\n--port 5000\r\n```\r\n\r\nError when trying to store artifact in s3:\r\n`An error occurred (AccessDenied) when calling the AssumeRoleWithWebIdentity operation: Not authorized to perform sts:AssumeRoleWithWebIdentity`","closed_by":{"login":"smurching","id":2358483,"node_id":"MDQ6VXNlcjIzNTg0ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2358483?v=4","gravatar_id":"","url":"https://api.github.com/users/smurching","html_url":"https://github.com/smurching","followers_url":"https://api.github.com/users/smurching/followers","following_url":"https://api.github.com/users/smurching/following{/other_user}","gists_url":"https://api.github.com/users/smurching/gists{/gist_id}","starred_url":"https://api.github.com/users/smurching/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smurching/subscriptions","organizations_url":"https://api.github.com/users/smurching/orgs","repos_url":"https://api.github.com/users/smurching/repos","events_url":"https://api.github.com/users/smurching/events{/privacy}","received_events_url":"https://api.github.com/users/smurching/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2746/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2746/timeline","performed_via_github_app":null,"state_reason":"completed"}