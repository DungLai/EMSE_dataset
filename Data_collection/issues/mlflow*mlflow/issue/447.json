{"url":"https://api.github.com/repos/mlflow/mlflow/issues/447","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/447/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/447/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/447/events","html_url":"https://github.com/mlflow/mlflow/issues/447","id":357977349,"node_id":"MDU6SXNzdWUzNTc5NzczNDk=","number":447,"title":"Error while using SFTP with custom port for default-artifact-root ","user":{"login":"arnabbiswas1","id":4428191,"node_id":"MDQ6VXNlcjQ0MjgxOTE=","avatar_url":"https://avatars.githubusercontent.com/u/4428191?v=4","gravatar_id":"","url":"https://api.github.com/users/arnabbiswas1","html_url":"https://github.com/arnabbiswas1","followers_url":"https://api.github.com/users/arnabbiswas1/followers","following_url":"https://api.github.com/users/arnabbiswas1/following{/other_user}","gists_url":"https://api.github.com/users/arnabbiswas1/gists{/gist_id}","starred_url":"https://api.github.com/users/arnabbiswas1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arnabbiswas1/subscriptions","organizations_url":"https://api.github.com/users/arnabbiswas1/orgs","repos_url":"https://api.github.com/users/arnabbiswas1/repos","events_url":"https://api.github.com/users/arnabbiswas1/events{/privacy}","received_events_url":"https://api.github.com/users/arnabbiswas1/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2018-09-07T08:51:25Z","updated_at":"2019-08-02T17:46:32Z","closed_at":"2019-08-02T17:46:32Z","author_association":"NONE","active_lock_reason":null,"body":"### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: RHEL 6.10\r\n- **MLflow installed from**:  pip\r\n- **MLflow version (run ``mlflow --version``)**:  0.5.2\r\n- **Python version**: 3.7\r\n- **npm version (if running the dev UI): NA\r\n- **Exact command to reproduce**: log_artifact()\r\n\r\n\r\n### Describe the problem\r\nI tried to use the SFTP option for artifact location and encountered with following issues:\r\n\r\n1. I started the MLFLow server (in Server 3) in the following way:\r\n\r\n> mlflow server --host 0.0.0.0 --port 8090 --default-artifact-root sftp://arnab@<Server_3>:2222/home/arnab/artifact_location --file-store /home/arnab/file_store_location/\r\n\r\nServer 3 is different from Server_1 (Where MLFlow Server is running) and Server 2 (Where client code is running). Also note I am using a custom SFTP port (2222) here. \r\n\r\nOn invoking log_artifact(), I got the following error message which seems to be due to a bug in paramiko related to handling of custom ports:\r\n\r\n    ~/anaconda3/envs/python-skl/lib/python3.7/site-packages/mlflow/store/artifact_repo.py in from_artifact_uri(artifact_uri, store)\r\n         80         elif artifact_uri.startswith(\"sftp:/\"):\r\n         81             from mlflow.store.sftp_artifact_repo import SFTPArtifactRepository\r\n    ---> 82             return SFTPArtifactRepository(artifact_uri)\r\n         83         elif artifact_uri.startswith(\"dbfs:/\"):\r\n         84             from mlflow.store.dbfs_artifact_repo import DbfsArtifactRepository\r\n\r\n    ~/anaconda3/envs/python-skl/lib/python3.7/site-packages/mlflow/store/sftp_artifact_repo.py in __init__(self, artifact_uri, client)\r\n         47                 self.config['private_key'] = user_config['identityfile'][0]\r\n         48 \r\n    ---> 49             self.sftp = pysftp.Connection(**self.config)\r\n         50 \r\n         51         super(SFTPArtifactRepository, self).__init__(artifact_uri)\r\n\r\n    ~/anaconda3/envs/python-skl/lib/python3.7/site-packages/pysftp/__init__.py in __init__(self, host, username, private_key, password, port, private_key_pass, ciphers, log, cnopts, default_path)\r\n        130         # check that we have a hostkey to verify\r\n        131         if self._cnopts.hostkeys is not None:\r\n    --> 132             self._tconnect['hostkey'] = self._cnopts.get_hostkey(host)\r\n        133 \r\n        134         self._sftp_live = False\r\n\r\n    ~/anaconda3/envs/python-skl/lib/python3.7/site-packages/pysftp/__init__.py in get_hostkey(self, host)\r\n         69         kval = self.hostkeys.lookup(host)  # None|{keytype: PKey}\r\n         70         if kval is None:\r\n    ---> 71             raise SSHException(\"No hostkey for host %s found.\" % host)\r\n         72         # return the pkey from the dict\r\n         73         return list(kval.values())[0]\r\n\r\n    SSHException: No hostkey for host <IP_Address> found.\r\n\r\nThis is because of the fact that paramiko does not handle custom ports (https://bitbucket.org/dundeemt/pysftp/issues/106/no-hostkey-for-host). I was able to handle by following the work around mentioned here: \"A workaround available to users, assuming that they don't also use the same server on the standard port, is to copy the entry in known_hosts and put it in again labeled with only host.\"\r\n\r\nPlease refer to the detailed discussion on google groups : [Link](https://groups.google.com/forum/#!topic/mlflow-users/vyq2eJqDU0k)\r\n","closed_by":{"login":"ankit-db","id":52183359,"node_id":"MDQ6VXNlcjUyMTgzMzU5","avatar_url":"https://avatars.githubusercontent.com/u/52183359?v=4","gravatar_id":"","url":"https://api.github.com/users/ankit-db","html_url":"https://github.com/ankit-db","followers_url":"https://api.github.com/users/ankit-db/followers","following_url":"https://api.github.com/users/ankit-db/following{/other_user}","gists_url":"https://api.github.com/users/ankit-db/gists{/gist_id}","starred_url":"https://api.github.com/users/ankit-db/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ankit-db/subscriptions","organizations_url":"https://api.github.com/users/ankit-db/orgs","repos_url":"https://api.github.com/users/ankit-db/repos","events_url":"https://api.github.com/users/ankit-db/events{/privacy}","received_events_url":"https://api.github.com/users/ankit-db/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/447/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/447/timeline","performed_via_github_app":null,"state_reason":"completed"}