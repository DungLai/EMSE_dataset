{"url":"https://api.github.com/repos/mlflow/mlflow/issues/6984","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/6984/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/6984/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/6984/events","html_url":"https://github.com/mlflow/mlflow/issues/6984","id":1398499426,"node_id":"I_kwDOCB5Jx85TW2hi","number":6984,"title":"[BUG] Model version UI page requires MLmodel at top level of artifact directory","user":{"login":"kevingreer","id":7669871,"node_id":"MDQ6VXNlcjc2Njk4NzE=","avatar_url":"https://avatars.githubusercontent.com/u/7669871?v=4","gravatar_id":"","url":"https://api.github.com/users/kevingreer","html_url":"https://github.com/kevingreer","followers_url":"https://api.github.com/users/kevingreer/followers","following_url":"https://api.github.com/users/kevingreer/following{/other_user}","gists_url":"https://api.github.com/users/kevingreer/gists{/gist_id}","starred_url":"https://api.github.com/users/kevingreer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kevingreer/subscriptions","organizations_url":"https://api.github.com/users/kevingreer/orgs","repos_url":"https://api.github.com/users/kevingreer/repos","events_url":"https://api.github.com/users/kevingreer/events{/privacy}","received_events_url":"https://api.github.com/users/kevingreer/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1470945519,"node_id":"MDU6TGFiZWwxNDcwOTQ1NTE5","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/uiux","name":"area/uiux","color":"ede978","default":false,"description":"Front-end, user experience, plotting, JavaScript, JavaScript dev server"},{"id":4300304016,"node_id":"LA_kwDOCB5Jx88AAAABAFFukA","url":"https://api.github.com/repos/mlflow/mlflow/labels/has-closing-pr","name":"has-closing-pr","color":"fef2c0","default":false,"description":"This issue has a closing PR"}],"state":"closed","locked":false,"assignee":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"assignees":[{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false}],"milestone":null,"comments":10,"created_at":"2022-10-05T23:24:39Z","updated_at":"2022-10-12T05:05:11Z","closed_at":"2022-10-12T05:05:11Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### Willingness to contribute\n\nYes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\n\n### MLflow version\n\n1.28.0\n\n### System information\n\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: server is a docker image based on `python:3.8.10`, browser is Google Chrome Version 105.0.5195.125 (Official Build) (arm64) running on macOS Monterey v12.3.1 (M1 chip)\r\n- **Python version**: 3.8.10\r\n- **yarn version, if running the dev UI**: N/A, not running dev UI\r\n\n\n### Describe the problem\n\nAfter upgrading from version 1.26.1 to version 1.28.0, each time we load the model version UI page (/models/.../versions/...), we see the following error at the top of the page:\r\n```\r\nINTERNAL_ERROR: The following failures occurred while downloading one or more artifacts from s3://<path>/artifacts: {'MLmodel': \"ClientError('An error occurred (404) when calling the HeadObject operation: Not Found')\"}\r\n```\r\nIt appears that this is because an `MLmodel` file is required to be at the top level of the directory, but this is not the case for any of our models. Some of our models have only custom artifacts, but even the ones that were packaged by MLflow have the MLmodel file within a `model` directory and not at the top level.\r\n\r\nI tried downgrading back to v1.26.1, and the networking error described in the console below is still present, but for some reason the error is not displayed on the UI (which is fine for us, this error does not seem to be affecting anything in the UI). I also tried digging into the MLflow code around this call and everything I've found has not been touched in years. \n\n### Steps to reproduce the bug\n\n1. Run a v1.28.0 MLflow server with an s3 artifact repo (we were using mysql for model registry and tracking stores, but not sure if that's relevant to this issue)\r\n2. Create a run with no artifacts (you can use the code block below)\r\n3. Navigate to the model version page for your created model `<mlflow_base_url>/#/models/<model_name>/versions/<model_version>`\r\n4. Observe the error in the UI\n\n### Code to generate data required to reproduce the bug\n\n```py\r\nimport mlflow\r\nfrom mlflow.tracking import MlflowClient\r\n\r\ntracking_uri = '<your-tracking-uri>'\r\n\r\nclient = MlflowClient(tracking_uri)\r\nmlflow.set_experiment(experiment_id='<your-experiment-id>')\r\n\r\nwith mlflow.start_run() as run:\r\n    artifact_uri = run.info.artifact_uri\r\n    run_id = run.info.run_id\r\n\r\nmodel_name = '<your-model-name>'\r\nclient.create_registered_model(model_name)\r\nclient.create_model_version(model_name, artifact_uri, run_id)\r\n```\n\n### Is the console panel in DevTools showing errors relevant to the bug?\n\n```\r\nGET https://<url>/model-versions/get-artifact?path=MLmodel&name=<model_name>&version=<version_number> 500\r\n\r\n\"{\"error_code\": \"INTERNAL_ERROR\", \"message\": \"The following failures occurred while downloading one or more artifacts from s3://<path>/artifacts: {'MLmodel': \\\"ClientError('An error occurred (404) when calling the HeadObject operation: Not Found')\\\"}\"}\"\r\n```\n\n### Does the network panel in DevTools contain failed requests relevant to the bug?\n\n# Headers:\r\n## General:\r\nRequest URL: https://<url>/model-versions/get-artifact?path=MLmodel&name=<model_name>&version=1\r\nRequest Method: GET\r\nStatus Code: 500 \r\nRemote Address: <ip>\r\nReferrer Policy: strict-origin-when-cross-origin\r\n\r\n## Response Headers:\r\ncontent-length: 308\r\ncontent-type: application/json\r\ndate: Wed, 05 Oct 2022 22:59:30 GMT\r\nstrict-transport-security: max-age=15724800; includeSubDomains\r\n\r\n## Request Headers:\r\n:authority: <url>\r\n:method: GET\r\n:path: /model-versions/get-artifact?path=MLmodel&name=<model_name>&version=1\r\n:scheme: https\r\naccept: */*\r\naccept-encoding: gzip, deflate, br\r\naccept-language: en-US,en;q=0.9\r\nreferer: <url>\r\nsec-ch-ua: \"Google Chrome\";v=\"105\", \"Not)A;Brand\";v=\"8\", \"Chromium\";v=\"105\"\r\nsec-ch-ua-mobile: ?0\r\nsec-ch-ua-platform: \"macOS\"\r\nsec-fetch-dest: empty\r\nsec-fetch-mode: cors\r\nsec-fetch-site: same-origin\r\nuser-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36\r\n\r\n# Payload\r\npath: MLmodel\r\nname: <model_name>\r\nversion: 1\r\n\r\n# Response\r\n{\"error_code\": \"INTERNAL_ERROR\", \"message\": \"The following failures occurred while downloading one or more artifacts from s3://<path>/artifacts: {'MLmodel': \\\"ClientError('An error occurred (404) when calling the HeadObject operation: Not Found')\\\"}\"}","closed_by":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/6984/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/6984/timeline","performed_via_github_app":null,"state_reason":"completed"}