{"url":"https://api.github.com/repos/mlflow/mlflow/issues/208","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/208/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/208/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/208/events","html_url":"https://github.com/mlflow/mlflow/issues/208","id":345549240,"node_id":"MDU6SXNzdWUzNDU1NDkyNDA=","number":208,"title":"Bug with pyfunc serving int64","user":{"login":"joshpeng","id":22549127,"node_id":"MDQ6VXNlcjIyNTQ5MTI3","avatar_url":"https://avatars.githubusercontent.com/u/22549127?v=4","gravatar_id":"","url":"https://api.github.com/users/joshpeng","html_url":"https://github.com/joshpeng","followers_url":"https://api.github.com/users/joshpeng/followers","following_url":"https://api.github.com/users/joshpeng/following{/other_user}","gists_url":"https://api.github.com/users/joshpeng/gists{/gist_id}","starred_url":"https://api.github.com/users/joshpeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshpeng/subscriptions","organizations_url":"https://api.github.com/users/joshpeng/orgs","repos_url":"https://api.github.com/users/joshpeng/repos","events_url":"https://api.github.com/users/joshpeng/events{/privacy}","received_events_url":"https://api.github.com/users/joshpeng/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-07-29T17:49:45Z","updated_at":"2018-08-10T18:12:17Z","closed_at":"2018-08-10T18:12:17Z","author_association":"NONE","active_lock_reason":null,"body":"### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**:\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: MacOS\r\n- **MLflow installed from (source or binary)**: pip install mlflow\r\n- **MLflow version (run ``mlflow --version``)**: 0.3.0\r\n- **Python version**: 3.6.3\r\n- **npm version (if running the dev UI):\r\n- **Exact command to reproduce**:\r\n\r\n### Describe the problem\r\nWhen trying to serve via `mlflow pyfunc serve -m xxx`, the server comes online, but when passing in a curl command that would result in the function to output a pandas dataframe's numpy.int64 column, we run into this error:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Users/josh/anaconda2/envs/py36/lib/python3.6/site-packages/flask/app.py\", line 1982, in wsgi_app\r\n    response = self.full_dispatch_request()\r\n  File \"/Users/josh/anaconda2/envs/py36/lib/python3.6/site-packages/flask/app.py\", line 1614, in full_dispatch_request\r\n    rv = self.handle_user_exception(e)\r\n  File \"/Users/josh/anaconda2/envs/py36/lib/python3.6/site-packages/flask/app.py\", line 1517, in handle_user_exception\r\n    reraise(exc_type, exc_value, tb)\r\n  File \"/Users/josh/anaconda2/envs/py36/lib/python3.6/site-packages/flask/_compat.py\", line 33, in reraise\r\n    raise value\r\n  File \"/Users/josh/anaconda2/envs/py36/lib/python3.6/site-packages/flask/app.py\", line 1612, in full_dispatch_request\r\n    rv = self.dispatch_request()\r\n  File \"/Users/josh/anaconda2/envs/py36/lib/python3.6/site-packages/flask/app.py\", line 1598, in dispatch_request\r\n    return self.view_functions[rule.endpoint](**req.view_args)\r\n  File \"/Users/josh/anaconda2/envs/py36/lib/python3.6/site-packages/mlflow/pyfunc/scoring_server.py\", line 67, in transformation\r\n    result = json.dumps(predictions)\r\n  File \"/Users/josh/anaconda2/envs/py36/lib/python3.6/json/__init__.py\", line 231, in dumps\r\n    return _default_encoder.encode(obj)\r\n  File \"/Users/josh/anaconda2/envs/py36/lib/python3.6/json/encoder.py\", line 199, in encode\r\n    chunks = self.iterencode(o, _one_shot=True)\r\n  File \"/Users/josh/anaconda2/envs/py36/lib/python3.6/json/encoder.py\", line 257, in iterencode\r\n    return _iterencode(o, 0)\r\n  File \"/Users/josh/anaconda2/envs/py36/lib/python3.6/json/encoder.py\", line 180, in default\r\n    o.__class__.__name__)\r\nTypeError: Object of type 'int64' is not JSON serializable\r\n```\r\n\r\nThe reason for this is because Python 3 has issues with serializing numpy.int64 object type. An easy solution is as follows: https://stackoverflow.com/a/50577730/6467553\r\n\r\nCreate that helper function in `mlflow.utils` and then in pyfunc's `scoring_server.py` on line 67, the `json.dumps` line, we can just add the default parameter.\r\n","closed_by":{"login":"aarondav","id":1400247,"node_id":"MDQ6VXNlcjE0MDAyNDc=","avatar_url":"https://avatars.githubusercontent.com/u/1400247?v=4","gravatar_id":"","url":"https://api.github.com/users/aarondav","html_url":"https://github.com/aarondav","followers_url":"https://api.github.com/users/aarondav/followers","following_url":"https://api.github.com/users/aarondav/following{/other_user}","gists_url":"https://api.github.com/users/aarondav/gists{/gist_id}","starred_url":"https://api.github.com/users/aarondav/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aarondav/subscriptions","organizations_url":"https://api.github.com/users/aarondav/orgs","repos_url":"https://api.github.com/users/aarondav/repos","events_url":"https://api.github.com/users/aarondav/events{/privacy}","received_events_url":"https://api.github.com/users/aarondav/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/208/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/208/timeline","performed_via_github_app":null,"state_reason":"completed"}