{"url":"https://api.github.com/repos/mlflow/mlflow/issues/4109","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/4109/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/4109/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/4109/events","html_url":"https://github.com/mlflow/mlflow/issues/4109","id":810523575,"node_id":"MDU6SXNzdWU4MTA1MjM1NzU=","number":4109,"title":"creating model version for model registry throws an error on Databricks when using relative path","user":{"login":"darshan-gr","id":40804906,"node_id":"MDQ6VXNlcjQwODA0OTA2","avatar_url":"https://avatars.githubusercontent.com/u/40804906?v=4","gravatar_id":"","url":"https://api.github.com/users/darshan-gr","html_url":"https://github.com/darshan-gr","followers_url":"https://api.github.com/users/darshan-gr/followers","following_url":"https://api.github.com/users/darshan-gr/following{/other_user}","gists_url":"https://api.github.com/users/darshan-gr/gists{/gist_id}","starred_url":"https://api.github.com/users/darshan-gr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/darshan-gr/subscriptions","organizations_url":"https://api.github.com/users/darshan-gr/orgs","repos_url":"https://api.github.com/users/darshan-gr/repos","events_url":"https://api.github.com/users/darshan-gr/events{/privacy}","received_events_url":"https://api.github.com/users/darshan-gr/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022845866,"node_id":"MDU6TGFiZWwyMDIyODQ1ODY2","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/artifacts","name":"area/artifacts","color":"48eabc","default":false,"description":"Artifact stores and artifact logging"},{"id":2022847277,"node_id":"MDU6TGFiZWwyMDIyODQ3Mjc3","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/examples","name":"area/examples","color":"48eabc","default":false,"description":"Example code"},{"id":2022847714,"node_id":"MDU6TGFiZWwyMDIyODQ3NzE0","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/model-registry","name":"area/model-registry","color":"48eabc","default":false,"description":"Model registry, model registry APIs, and the fluent client calls for model registry"},{"id":2022849295,"node_id":"MDU6TGFiZWwyMDIyODQ5Mjk1","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/tracking","name":"area/tracking","color":"48eabc","default":false,"description":"Tracking service, tracking client APIs, autologging"},{"id":2114036915,"node_id":"MDU6TGFiZWwyMTE0MDM2OTE1","url":"https://api.github.com/repos/mlflow/mlflow/labels/integrations/databricks","name":"integrations/databricks","color":"ffbce5","default":false,"description":"Databricks integrations"}],"state":"closed","locked":false,"assignee":{"login":"apurva-koti","id":51172624,"node_id":"MDQ6VXNlcjUxMTcyNjI0","avatar_url":"https://avatars.githubusercontent.com/u/51172624?v=4","gravatar_id":"","url":"https://api.github.com/users/apurva-koti","html_url":"https://github.com/apurva-koti","followers_url":"https://api.github.com/users/apurva-koti/followers","following_url":"https://api.github.com/users/apurva-koti/following{/other_user}","gists_url":"https://api.github.com/users/apurva-koti/gists{/gist_id}","starred_url":"https://api.github.com/users/apurva-koti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apurva-koti/subscriptions","organizations_url":"https://api.github.com/users/apurva-koti/orgs","repos_url":"https://api.github.com/users/apurva-koti/repos","events_url":"https://api.github.com/users/apurva-koti/events{/privacy}","received_events_url":"https://api.github.com/users/apurva-koti/received_events","type":"User","site_admin":false},"assignees":[{"login":"apurva-koti","id":51172624,"node_id":"MDQ6VXNlcjUxMTcyNjI0","avatar_url":"https://avatars.githubusercontent.com/u/51172624?v=4","gravatar_id":"","url":"https://api.github.com/users/apurva-koti","html_url":"https://github.com/apurva-koti","followers_url":"https://api.github.com/users/apurva-koti/followers","following_url":"https://api.github.com/users/apurva-koti/following{/other_user}","gists_url":"https://api.github.com/users/apurva-koti/gists{/gist_id}","starred_url":"https://api.github.com/users/apurva-koti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apurva-koti/subscriptions","organizations_url":"https://api.github.com/users/apurva-koti/orgs","repos_url":"https://api.github.com/users/apurva-koti/repos","events_url":"https://api.github.com/users/apurva-koti/events{/privacy}","received_events_url":"https://api.github.com/users/apurva-koti/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2021-02-17T20:43:24Z","updated_at":"2021-08-12T18:36:02Z","closed_at":"2021-08-12T18:35:40Z","author_association":"NONE","active_lock_reason":null,"body":"Thank you for submitting an issue. Please refer to our [issue policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md) for additional information about bug reports. For help with debugging your code, please refer to [Stack Overflow](https://stackoverflow.com/questions/tagged/mlflow).\r\n\r\n**Please fill in this bug report template to ensure a timely and thorough response.**\r\n\r\n### Willingness to contribute\r\nThe MLflow Community encourages bug fix contributions. Would you or another member of your organization be willing to contribute a fix for this bug to the MLflow code base?\r\n\r\n- [ ] Yes. I can contribute a fix for this bug independently.\r\n- [ ] Yes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\r\n- [x] No. I cannot contribute a bug fix at this time.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: No\r\n- **MLflow version (run ``mlflow --version``)**: 1.13.1\r\n- **Python version**: 3.7.5\r\n\r\n### Describe the problem\r\nI am following the example for creating the model version described [here](https://www.mlflow.org/docs/latest/python_api/mlflow.tracking.html#mlflow.tracking.MlflowClient.create_model_version) on the DataBricks runtime version 7.4 but facing an error as : `RestException: INVALID_PARAMETER_VALUE: Got an invalid source 'runs:/b10b131f7deb4094a42c8261a930de40/sklearn-model'. Only DBFS locations are currently supported.`\r\n\r\nBut, when I tried other example: [register_model](https://www.mlflow.org/docs/latest/python_api/mlflow.html#mlflow.register_model), I could successfully register in the model registry (using relative path example :` model_uri = \"runs:/{}/sklearn-model\".format(run.info.run_id))`.\r\n\r\nI am trying to use the relative path of that run as model uri, to [create_model_version](https://www.mlflow.org/docs/latest/python_api/mlflow.tracking.html#mlflow.tracking.MlflowClient.create_model_version) (as described in documentation example) on DataBricks. But, could not register version of the model.\r\n\r\n### Code to reproduce issue\r\nCode to reproduce is the example for [create_model_version](https://www.mlflow.org/docs/latest/python_api/mlflow.tracking.html#mlflow.tracking.MlflowClient.create_model_version) in mlflow.tracking , the code is posted below (only set_tracking_uri is commented out from original example): \r\n```\r\nimport mlflow.sklearn\r\nfrom mlflow.tracking import MlflowClient\r\nfrom sklearn.ensemble import RandomForestRegressor\r\n\r\n# mlflow.set_tracking_uri(\"sqlite:///mlruns.db\")\r\nparams = {\"n_estimators\": 3, \"random_state\": 42}\r\nname = \"RandomForestRegression\"\r\nrfr = RandomForestRegressor(**params).fit([[0, 1]], [1])\r\n# Log MLflow entities\r\nwith mlflow.start_run() as run:\r\n    mlflow.log_params(params)\r\n    mlflow.sklearn.log_model(rfr, artifact_path=\"sklearn-model\")\r\n\r\n# Register model name in the model registry\r\nclient = MlflowClient()\r\nclient.create_registered_model(name)\r\n\r\n# Create a new version of the rfr model under the registered model name\r\ndesc = \"A new version of the model\"\r\nmodel_uri = \"runs:/{}/sklearn-model\".format(run.info.run_id)\r\nmv = client.create_model_version(name, model_uri, run.info.run_id, description=desc)\r\nprint(\"Name: {}\".format(mv.name))\r\nprint(\"Version: {}\".format(mv.version))\r\nprint(\"Description: {}\".format(mv.description))\r\nprint(\"Status: {}\".format(mv.status))\r\nprint(\"Stage: {}\".format(mv.current_stage))\r\n```\r\n\r\n### Other info / logs\r\n\r\n![mlflow](https://user-images.githubusercontent.com/40804906/109122645-2c086e00-7749-11eb-860f-50e686bcaa4d.PNG)\r\n\r\n\r\nThe error faced:\r\n```\r\nRestException: INVALID_PARAMETER_VALUE: Got an invalid source 'runs:/b10b131f7deb4094a42c8261a930de40/sklearn-model'. Only DBFS locations are currently supported.\r\n---------------------------------------------------------------------------\r\nRestException                             Traceback (most recent call last)\r\n<command-3390063603017977> in <module>\r\n     19 desc = \"A new version of the model\"\r\n     20 model_uri = \"runs:/{}/sklearn-model\".format(run.info.run_id)\r\n---> 21 mv = client.create_model_version(name, model_uri, run.info.run_id, description=desc)\r\n     22 print(\"Name: {}\".format(mv.name))\r\n     23 print(\"Version: {}\".format(mv.version))\r\n\r\n/databricks/python/lib/python3.7/site-packages/mlflow/tracking/client.py in create_model_version(self, name, source, run_id, tags, run_link, description)\r\n    619             tags=tags,\r\n    620             run_link=run_link,\r\n--> 621             description=description,\r\n    622         )\r\n    623 \r\n\r\n/databricks/python/lib/python3.7/site-packages/mlflow/tracking/_model_registry/client.py in create_model_version(self, name, source, run_id, tags, run_link, description)\r\n    178         tags = tags if tags else {}\r\n    179         tags = [ModelVersionTag(key, str(value)) for key, value in tags.items()]\r\n--> 180         return self.store.create_model_version(name, source, run_id, tags, run_link, description)\r\n```\r\n\r\n\r\n### What component(s), interfaces, languages, and integrations does this bug affect?\r\nComponents \r\n- [x] `area/artifacts`: Artifact stores and artifact logging\r\n- [x] `area/examples`: Example code\r\n- [x] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\r\n- [x] `area/tracking`: Tracking Service, tracking client APIs, autologging\r\n\r\nIntegrations\r\n- [x] `integrations/databricks`: Databricks integrations\r\n","closed_by":{"login":"apurva-koti","id":51172624,"node_id":"MDQ6VXNlcjUxMTcyNjI0","avatar_url":"https://avatars.githubusercontent.com/u/51172624?v=4","gravatar_id":"","url":"https://api.github.com/users/apurva-koti","html_url":"https://github.com/apurva-koti","followers_url":"https://api.github.com/users/apurva-koti/followers","following_url":"https://api.github.com/users/apurva-koti/following{/other_user}","gists_url":"https://api.github.com/users/apurva-koti/gists{/gist_id}","starred_url":"https://api.github.com/users/apurva-koti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apurva-koti/subscriptions","organizations_url":"https://api.github.com/users/apurva-koti/orgs","repos_url":"https://api.github.com/users/apurva-koti/repos","events_url":"https://api.github.com/users/apurva-koti/events{/privacy}","received_events_url":"https://api.github.com/users/apurva-koti/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/4109/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/4109/timeline","performed_via_github_app":null,"state_reason":"completed"}