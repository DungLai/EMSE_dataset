{"url":"https://api.github.com/repos/mlflow/mlflow/issues/5199","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/5199/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/5199/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/5199/events","html_url":"https://github.com/mlflow/mlflow/issues/5199","id":1088547474,"node_id":"I_kwDOCB5Jx85A4eqS","number":5199,"title":"`mlflow_transition_model_version_stage` (R) fails with HTTP `500` [BUG]","user":{"login":"mrkaye97","id":44219491,"node_id":"MDQ6VXNlcjQ0MjE5NDkx","avatar_url":"https://avatars.githubusercontent.com/u/44219491?v=4","gravatar_id":"","url":"https://api.github.com/users/mrkaye97","html_url":"https://github.com/mrkaye97","followers_url":"https://api.github.com/users/mrkaye97/followers","following_url":"https://api.github.com/users/mrkaye97/following{/other_user}","gists_url":"https://api.github.com/users/mrkaye97/gists{/gist_id}","starred_url":"https://api.github.com/users/mrkaye97/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrkaye97/subscriptions","organizations_url":"https://api.github.com/users/mrkaye97/orgs","repos_url":"https://api.github.com/users/mrkaye97/repos","events_url":"https://api.github.com/users/mrkaye97/events{/privacy}","received_events_url":"https://api.github.com/users/mrkaye97/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1041183632,"node_id":"MDU6TGFiZWwxMDQxMTgzNjMy","url":"https://api.github.com/repos/mlflow/mlflow/labels/language/r","name":"language/r","color":"349cd8","default":false,"description":"R APIs and clients"},{"id":2022847714,"node_id":"MDU6TGFiZWwyMDIyODQ3NzE0","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/model-registry","name":"area/model-registry","color":"48eabc","default":false,"description":"Model registry, model registry APIs, and the fluent client calls for model registry"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2021-12-25T05:04:15Z","updated_at":"2022-08-18T16:18:34Z","closed_at":"2022-08-18T16:18:34Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### Willingness to contribute\r\nThe MLflow Community encourages bug fix contributions. Would you or another member of your organization be willing to contribute a fix for this bug to the MLflow code base?\r\n\r\n- [ ] Yes. I can contribute a fix for this bug independently.\r\n- [x] Yes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\r\n- [ ] No. I cannot contribute a bug fix at this time.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**:\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: MacOS Monterrey (MLFlow hosted on Linux -- Docker + Heroku)\r\n- **MLflow installed from (source or binary)**:\r\n- **MLflow version (run ``mlflow --version``)**:\r\n- **Python version**:\r\n- **npm version, if running the dev UI**:\r\n- **Exact command to reproduce**:\r\n\r\n### Describe the problem\r\n\r\nTrying to run `mlflow::mlflow_transition_model_version_stage` as follows:\r\n\r\n```r\r\nmlflow_transition_model_version_stage(\r\n    name = \"foo\",\r\n    version = 1,\r\n    stage = \"Staging\"\r\n)\r\n```\r\n\r\ngives me the following errors. In R, I see this:\r\n\r\n```r\r\nError: API request to endpoint 'model-versions/transition-stage' failed with error code 500. Reponse body: '<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\">\r\n<title>500 Internal Server Error</title>\r\n<h1>Internal Server Error</h1>\r\n<p>The server encountered an internal error and was unable to complete your request. Either the server is overloaded or there is an error in the application.</p>\r\n'\r\n```\r\n\r\nand in my Heroku logs, I see this:\r\n\r\n```bash\r\n2021-12-25T04:55:31.636699+00:00 heroku[router]: at=info method=POST path=\"/api/2.0/mlflow/model-versions/transition-stage\" host=<<my host>> request_id=<<rid>> fwd=... dyno=web.1 connect=0ms service=2ms status=500 bytes=463 protocol=https\r\n2021-12-25T04:55:31.635410+00:00 app[web.1]: 2021/12/25 04:55:31 ERROR mlflow.server: Exception on /api/2.0/mlflow/model-versions/transition-stage [POST]\r\n2021-12-25T04:55:31.635418+00:00 app[web.1]: Traceback (most recent call last):\r\n2021-12-25T04:55:31.635419+00:00 app[web.1]:   File \"/opt/conda/lib/python3.9/site-packages/google/protobuf/json_format.py\", line 585, in _ConvertFieldValuePair\r\n2021-12-25T04:55:31.635420+00:00 app[web.1]:     setattr(message, field.name, _ConvertScalarFieldValue(value, field))\r\n2021-12-25T04:55:31.635420+00:00 app[web.1]:   File \"/opt/conda/lib/python3.9/site-packages/google/protobuf/json_format.py\", line 720, in _ConvertScalarFieldValue\r\n2021-12-25T04:55:31.635421+00:00 app[web.1]:     return _ConvertBool(value, require_str)\r\n2021-12-25T04:55:31.635421+00:00 app[web.1]:   File \"/opt/conda/lib/python3.9/site-packages/google/protobuf/json_format.py\", line 838, in _ConvertBool\r\n2021-12-25T04:55:31.635422+00:00 app[web.1]:     raise ParseError('Expected true or false without quotes.')\r\n2021-12-25T04:55:31.635423+00:00 app[web.1]: google.protobuf.json_format.ParseError: Expected true or false without quotes.\r\n2021-12-25T04:55:31.635423+00:00 app[web.1]: \r\n2021-12-25T04:55:31.635424+00:00 app[web.1]: During handling of the above exception, another exception occurred:\r\n2021-12-25T04:55:31.635424+00:00 app[web.1]: \r\n2021-12-25T04:55:31.635424+00:00 app[web.1]: Traceback (most recent call last):\r\n2021-12-25T04:55:31.635425+00:00 app[web.1]:   File \"/opt/conda/lib/python3.9/site-packages/flask/app.py\", line 2073, in wsgi_app\r\n2021-12-25T04:55:31.635425+00:00 app[web.1]:     response = self.full_dispatch_request()\r\n2021-12-25T04:55:31.635426+00:00 app[web.1]:   File \"/opt/conda/lib/python3.9/site-packages/flask/app.py\", line 1518, in full_dispatch_request\r\n2021-12-25T04:55:31.635426+00:00 app[web.1]:     rv = self.handle_user_exception(e)\r\n2021-12-25T04:55:31.635426+00:00 app[web.1]:   File \"/opt/conda/lib/python3.9/site-packages/flask/app.py\", line 1516, in full_dispatch_request\r\n2021-12-25T04:55:31.635427+00:00 app[web.1]:     rv = self.dispatch_request()\r\n2021-12-25T04:55:31.635427+00:00 app[web.1]:   File \"/opt/conda/lib/python3.9/site-packages/flask/app.py\", line 1502, in dispatch_request\r\n2021-12-25T04:55:31.635427+00:00 app[web.1]:     return self.ensure_sync(self.view_functions[rule.endpoint])(**req.view_args)\r\n2021-12-25T04:55:31.635428+00:00 app[web.1]:   File \"/opt/conda/lib/python3.9/site-packages/mlflow/server/handlers.py\", line 238, in wrapper\r\n2021-12-25T04:55:31.635428+00:00 app[web.1]:     return func(*args, **kwargs)\r\n2021-12-25T04:55:31.635428+00:00 app[web.1]:   File \"/opt/conda/lib/python3.9/site-packages/mlflow/server/handlers.py\", line 767, in _transition_stage\r\n2021-12-25T04:55:31.635429+00:00 app[web.1]:     request_message = _get_request_message(TransitionModelVersionStage())\r\n2021-12-25T04:55:31.635429+00:00 app[web.1]:   File \"/opt/conda/lib/python3.9/site-packages/mlflow/server/handlers.py\", line 219, in _get_request_message\r\n2021-12-25T04:55:31.635429+00:00 app[web.1]:     parse_dict(request_json, request_message)\r\n2021-12-25T04:55:31.635430+00:00 app[web.1]:   File \"/opt/conda/lib/python3.9/site-packages/mlflow/utils/proto_json_utils.py\", line 153, in parse_dict\r\n2021-12-25T04:55:31.635430+00:00 app[web.1]:     ParseDict(js_dict=js_dict, message=message, ignore_unknown_fields=True)\r\n2021-12-25T04:55:31.635430+00:00 app[web.1]:   File \"/opt/conda/lib/python3.9/site-packages/google/protobuf/json_format.py\", line 445, in ParseDict\r\n2021-12-25T04:55:31.635431+00:00 app[web.1]:     parser.ConvertMessage(js_dict, message)\r\n2021-12-25T04:55:31.635431+00:00 app[web.1]:   File \"/opt/conda/lib/python3.9/site-packages/google/protobuf/json_format.py\", line 476, in ConvertMessage\r\n2021-12-25T04:55:31.635431+00:00 app[web.1]:     self._ConvertFieldValuePair(value, message)\r\n2021-12-25T04:55:31.635432+00:00 app[web.1]:   File \"/opt/conda/lib/python3.9/site-packages/google/protobuf/json_format.py\", line 588, in _ConvertFieldValuePair\r\n2021-12-25T04:55:31.635432+00:00 app[web.1]:     raise ParseError('Failed to parse {0} field: {1}.'.format(name, e))\r\n2021-12-25T04:55:31.635433+00:00 app[web.1]: google.protobuf.json_format.ParseError: Failed to parse archive_existing_versions field: Expected true or false without quotes..\r\n```\r\n\r\nI'm not sure how to repro this more cleanly, but it seems like a bug. I tried explicitly setting the `archive_existing_versions` argument to a bunch of different things (i.e. `TRUE`, `FALSE`, `\"true\"`, `\"false\"`, etc.) to no avail.\r\n\r\nAnd while we're at I also noticed a small typo in the R package documentation under `?mlflow_transition_model_version_stage`: `Transition 'model_version' to this tage.` --> `Transition 'model_version' to this stage.`. It'd also be helpful to list out what the allowed stages are in the docs and to use something like `match.arg()` [at this point in the code](https://github.com/mlflow/mlflow/blob/master/mlflow/R/mlflow/R/model-registry.R#L302-L306) to match against the allowed stages (I'd be happy to PR this change -- it'd be easy). \r\n\r\n### What component(s), interfaces, languages, and integrations does this bug affect?\r\nComponents \r\n- [ ] `area/artifacts`: Artifact stores and artifact logging\r\n- [ ] `area/build`: Build and test infrastructure for MLflow\r\n- [ ] `area/docs`: MLflow documentation pages\r\n- [ ] `area/examples`: Example code\r\n- [x] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\r\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\r\n- [ ] `area/projects`: MLproject format, project running backends\r\n- [ ] `area/scoring`: MLflow Model server, model deployment tools, Spark UDFs\r\n- [ ] `area/server-infra`: MLflow Tracking server backend\r\n- [ ] `area/tracking`: Tracking Service, tracking client APIs, autologging\r\n\r\nInterface \r\n- [ ] `area/uiux`: Front-end, user experience, plotting, JavaScript, JavaScript dev server\r\n- [ ] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\r\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\r\n- [ ] `area/windows`: Windows support\r\n\r\nLanguage \r\n- [x] `language/r`: R APIs and clients\r\n- [ ] `language/java`: Java APIs and clients\r\n- [ ] `language/new`: Proposals for new client languages\r\n\r\nIntegrations\r\n- [ ] `integrations/azure`: Azure and Azure ML integrations\r\n- [ ] `integrations/sagemaker`: SageMaker integrations\r\n- [ ] `integrations/databricks`: Databricks integrations\r\n","closed_by":{"login":"mrkaye97","id":44219491,"node_id":"MDQ6VXNlcjQ0MjE5NDkx","avatar_url":"https://avatars.githubusercontent.com/u/44219491?v=4","gravatar_id":"","url":"https://api.github.com/users/mrkaye97","html_url":"https://github.com/mrkaye97","followers_url":"https://api.github.com/users/mrkaye97/followers","following_url":"https://api.github.com/users/mrkaye97/following{/other_user}","gists_url":"https://api.github.com/users/mrkaye97/gists{/gist_id}","starred_url":"https://api.github.com/users/mrkaye97/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrkaye97/subscriptions","organizations_url":"https://api.github.com/users/mrkaye97/orgs","repos_url":"https://api.github.com/users/mrkaye97/repos","events_url":"https://api.github.com/users/mrkaye97/events{/privacy}","received_events_url":"https://api.github.com/users/mrkaye97/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/5199/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/5199/timeline","performed_via_github_app":null,"state_reason":"completed"}