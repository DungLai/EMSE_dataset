{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2635","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2635/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2635/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2635/events","html_url":"https://github.com/mlflow/mlflow/issues/2635","id":587517887,"node_id":"MDU6SXNzdWU1ODc1MTc4ODc=","number":2635,"title":"[BUG] Importing tensorflow after MLFlow fails","user":{"login":"jantrienes","id":12009072,"node_id":"MDQ6VXNlcjEyMDA5MDcy","avatar_url":"https://avatars.githubusercontent.com/u/12009072?v=4","gravatar_id":"","url":"https://api.github.com/users/jantrienes","html_url":"https://github.com/jantrienes","followers_url":"https://api.github.com/users/jantrienes/followers","following_url":"https://api.github.com/users/jantrienes/following{/other_user}","gists_url":"https://api.github.com/users/jantrienes/gists{/gist_id}","starred_url":"https://api.github.com/users/jantrienes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jantrienes/subscriptions","organizations_url":"https://api.github.com/users/jantrienes/orgs","repos_url":"https://api.github.com/users/jantrienes/repos","events_url":"https://api.github.com/users/jantrienes/events{/privacy}","received_events_url":"https://api.github.com/users/jantrienes/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-03-25T08:13:11Z","updated_at":"2020-03-25T08:29:36Z","closed_at":"2020-03-25T08:29:36Z","author_association":"NONE","active_lock_reason":null,"body":"### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: no\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: macOS 10.15.3\r\n- **MLflow installed from (source or binary)**: binary\r\n- **MLflow version (run ``mlflow --version``)**: mlflow, version 1.7.2\r\n- **Python version**: 3.6.10\r\n- **npm version, if running the dev UI**: n/a\r\n- **Exact command to reproduce**: see below\r\n\r\n### Describe the problem\r\nImporting tensorflow *after* mlflow fails with an error related to protobuf (see below). Importing tensorflow *before* mlflow works however.\r\n\r\n**Failing import order:**\r\n```\r\n> python\r\nPython 3.6.10 | packaged by conda-forge | (default, Mar  5 2020, 09:56:10) \r\n[GCC Clang 9.0.1 ] on darwin\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import mlflow\r\n>>> import tensorflow\r\n/usr/local/Caskroom/miniconda/base/envs/mlflow_debug/lib/python3.6/site-packages/tensorflow/python/pywrap_tensorflow_internal.py:15: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses\r\n  import imp\r\n[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/descriptor_database.cc:334] Invalid file descriptor data passed to EncodedDescriptorDatabase::Add().\r\n[libprotobuf FATAL external/protobuf_archive/src/google/protobuf/descriptor.cc:1370] CHECK failed: GeneratedDatabase()->Add(encoded_file_descriptor, size): \r\nlibc++abi.dylib: terminating with uncaught exception of type google::protobuf::FatalException: CHECK failed: GeneratedDatabase()->Add(encoded_file_descriptor, size): \r\nAbort trap: 6\r\n```\r\n\r\n**Working import order**:\r\n```\r\n> python\r\nPython 3.6.10 | packaged by conda-forge | (default, Mar  5 2020, 09:56:10) \r\n[GCC Clang 9.0.1 ] on darwin\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import tensorflow\r\n>>> import mlflow\r\n>>> mlflow.__version__\r\n'1.7.2'\r\n```\r\n\r\nThis issue issue is similar to the behavior in #2478 except that pandas is not involved. \r\n\r\n### Code to reproduce issue\r\n\r\n**environment.yml**\r\n```yml\r\nname: mlflow_debug\r\nchannels:\r\n  - conda-forge\r\ndependencies:\r\n  - pip\r\n  - python=3.6.10\r\n  - tensorflow=1.14\r\n  - pip:\r\n    - mlflow==1.7.2\r\n```\r\n\r\n**test.py**\r\n```py\r\nimport mlflow\r\nimport tensorflow\r\n```\r\n\r\nTo reproduce:\r\n```sh\r\nconda env create -f environment.yml\r\nconda activate mlflow_debug\r\npython test.py\r\n```\r\n\r\n### Other info / logs\r\n\r\n```\r\n> pip freeze\r\nabsl-py==0.9.0\r\nalembic==1.4.1\r\nastor==0.7.1\r\ncertifi==2019.11.28\r\nchardet==3.0.4\r\nclick==7.1.1\r\ncloudpickle==1.3.0\r\nconfigparser==4.0.2\r\ndatabricks-cli==0.9.1\r\ndocker==4.2.0\r\nentrypoints==0.3\r\nFlask==1.1.1\r\ngast==0.3.3\r\ngitdb==4.0.2\r\nGitPython==3.1.0\r\ngorilla==0.3.0\r\ngrpcio==1.23.0\r\ngunicorn==20.0.4\r\nh5py==2.10.0\r\nidna==2.9\r\nitsdangerous==1.1.0\r\nJinja2==2.11.1\r\nKeras-Applications==1.0.8\r\nKeras-Preprocessing==1.1.0\r\nMako==1.1.2\r\nMarkdown==3.2.1\r\nMarkupSafe==1.1.1\r\nmlflow==1.7.2\r\nnumpy==1.18.1\r\npandas==1.0.3\r\nprometheus-client==0.7.1\r\nprometheus-flask-exporter==0.13.0\r\nprotobuf==3.11.4\r\npython-dateutil==2.8.1\r\npython-editor==1.0.4\r\npytz==2019.3\r\nPyYAML==5.3.1\r\nquerystring-parser==1.2.4\r\nrequests==2.23.0\r\nscipy==1.4.1\r\nsimplejson==3.17.0\r\nsix==1.14.0\r\nsmmap==3.0.1\r\nSQLAlchemy==1.3.13\r\nsqlparse==0.3.1\r\ntabulate==0.8.7\r\ntensorboard==1.14.0\r\ntensorflow==1.14.0\r\ntensorflow-estimator==1.14.0\r\ntermcolor==1.1.0\r\nurllib3==1.25.8\r\nwebsocket-client==0.57.0\r\nWerkzeug==1.0.0\r\nwrapt==1.12.1\r\n```","closed_by":{"login":"jantrienes","id":12009072,"node_id":"MDQ6VXNlcjEyMDA5MDcy","avatar_url":"https://avatars.githubusercontent.com/u/12009072?v=4","gravatar_id":"","url":"https://api.github.com/users/jantrienes","html_url":"https://github.com/jantrienes","followers_url":"https://api.github.com/users/jantrienes/followers","following_url":"https://api.github.com/users/jantrienes/following{/other_user}","gists_url":"https://api.github.com/users/jantrienes/gists{/gist_id}","starred_url":"https://api.github.com/users/jantrienes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jantrienes/subscriptions","organizations_url":"https://api.github.com/users/jantrienes/orgs","repos_url":"https://api.github.com/users/jantrienes/repos","events_url":"https://api.github.com/users/jantrienes/events{/privacy}","received_events_url":"https://api.github.com/users/jantrienes/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2635/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2635/timeline","performed_via_github_app":null,"state_reason":"completed"}