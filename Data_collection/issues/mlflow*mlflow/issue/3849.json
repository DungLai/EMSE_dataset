{"url":"https://api.github.com/repos/mlflow/mlflow/issues/3849","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/3849/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/3849/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/3849/events","html_url":"https://github.com/mlflow/mlflow/issues/3849","id":767585606,"node_id":"MDU6SXNzdWU3Njc1ODU2MDY=","number":3849,"title":"[FR] Add Pandas category dtype to mlflow.types.schema","user":{"login":"henriqueluzz","id":3441278,"node_id":"MDQ6VXNlcjM0NDEyNzg=","avatar_url":"https://avatars.githubusercontent.com/u/3441278?v=4","gravatar_id":"","url":"https://api.github.com/users/henriqueluzz","html_url":"https://github.com/henriqueluzz","followers_url":"https://api.github.com/users/henriqueluzz/followers","following_url":"https://api.github.com/users/henriqueluzz/following{/other_user}","gists_url":"https://api.github.com/users/henriqueluzz/gists{/gist_id}","starred_url":"https://api.github.com/users/henriqueluzz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henriqueluzz/subscriptions","organizations_url":"https://api.github.com/users/henriqueluzz/orgs","repos_url":"https://api.github.com/users/henriqueluzz/repos","events_url":"https://api.github.com/users/henriqueluzz/events{/privacy}","received_events_url":"https://api.github.com/users/henriqueluzz/received_events","type":"User","site_admin":false},"labels":[{"id":955449434,"node_id":"MDU6TGFiZWw5NTU0NDk0MzQ=","url":"https://api.github.com/repos/mlflow/mlflow/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"},{"id":2022847714,"node_id":"MDU6TGFiZWwyMDIyODQ3NzE0","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/model-registry","name":"area/model-registry","color":"48eabc","default":false,"description":"Model registry, model registry APIs, and the fluent client calls for model registry"},{"id":2022848043,"node_id":"MDU6TGFiZWwyMDIyODQ4MDQz","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/models","name":"area/models","color":"48eabc","default":false,"description":"MLmodel format, model serialization/deserialization, flavors"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2020-12-15T13:21:16Z","updated_at":"2022-12-01T00:03:33Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"## Willingness to contribute\r\nThe MLflow Community encourages new feature contributions. Would you or another member of your organization be willing to contribute an implementation of this feature (either as an MLflow Plugin or an enhancement to the MLflow code base)?\r\n\r\n- [ ] Yes. I can contribute this feature independently.\r\n- [X] Yes. I would be willing to contribute this feature with guidance from the MLflow community.\r\n- [ ] No. I cannot contribute this feature at this time.\r\n\r\n## Proposal Summary\r\nAdd Pandas category dtype, to mlflow.types.schema().\r\n\r\nI currently have a ML model based on LightGBM running on production environment that contains categorical variables. Instead of label-encoding or OHE the categorical variables, I'm using Pandas dataframe with categorical columns set to be of the categorical dtype.\r\n\r\n` df['some_categorical_column'] = df['some_categorical_column'].astype('category') .`\r\n\r\nI'm trying to deploy this model on Databricks Serve Model that uses MLFlow as backend, but currently this category dtype is not supported for model signature according to the available dtypes on [https://www.mlflow.org/docs/latest/_modules/mlflow/types/schema.html](https://www.mlflow.org/docs/latest/_modules/mlflow/types/schema.html), so I'm unable to correctly cast the prediction Dataframe accordingly to the training phase.\r\n\r\nIt makes me think that deploying models that were trained with LightGBM using Pandas category dtypes, cannot be correctly deployed since this dtype is not availabe, so it would occur some casting error during the prediction leading to incorrect scores/predictions. \r\n\r\nI could of course OHE the data and outline the problem, but I'm trying to deploy the current model into MLFlow.\r\nI'm not sure if this is a FR or something else.\r\n\r\n![bug2](https://user-images.githubusercontent.com/3441278/102220152-2f68b900-3ebf-11eb-9417-871fd027cca8.PNG)\r\n\r\n\r\n### What component(s), interfaces, languages, and integrations does this feature affect?\r\nComponents \r\n- [ ] `area/artifacts`: Artifact stores and artifact logging\r\n- [ ] `area/build`: Build and test infrastructure for MLflow\r\n- [ ] `area/docs`: MLflow documentation pages\r\n- [ ] `area/examples`: Example code\r\n- [X] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\r\n- [X] `area/models`: MLmodel format, model serialization/deserialization, flavors\r\n- [ ] `area/projects`: MLproject format, project running backends\r\n- [ ] `area/scoring`: Local serving, model deployment tools, spark UDFs\r\n- [ ] `area/server-infra`: MLflow server, JavaScript dev server\r\n- [ ] `area/tracking`: Tracking Service, tracking client APIs, autologging\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/3849/reactions","total_count":5,"+1":5,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/3849/timeline","performed_via_github_app":null,"state_reason":null}