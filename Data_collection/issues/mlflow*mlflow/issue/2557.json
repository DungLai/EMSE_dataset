{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2557","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2557/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2557/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2557/events","html_url":"https://github.com/mlflow/mlflow/issues/2557","id":577201712,"node_id":"MDU6SXNzdWU1NzcyMDE3MTI=","number":2557,"title":"[FR] Publish separate mlflow-client package that doesn't contain server-only dependencies","user":{"login":"smurching","id":2358483,"node_id":"MDQ6VXNlcjIzNTg0ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2358483?v=4","gravatar_id":"","url":"https://api.github.com/users/smurching","html_url":"https://github.com/smurching","followers_url":"https://api.github.com/users/smurching/followers","following_url":"https://api.github.com/users/smurching/following{/other_user}","gists_url":"https://api.github.com/users/smurching/gists{/gist_id}","starred_url":"https://api.github.com/users/smurching/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smurching/subscriptions","organizations_url":"https://api.github.com/users/smurching/orgs","repos_url":"https://api.github.com/users/smurching/repos","events_url":"https://api.github.com/users/smurching/events{/privacy}","received_events_url":"https://api.github.com/users/smurching/received_events","type":"User","site_admin":false},"labels":[{"id":955449434,"node_id":"MDU6TGFiZWw5NTU0NDk0MzQ=","url":"https://api.github.com/repos/mlflow/mlflow/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"},{"id":1893072438,"node_id":"MDU6TGFiZWwxODkzMDcyNDM4","url":"https://api.github.com/repos/mlflow/mlflow/labels/help%20wanted","name":"help wanted","color":"c5def5","default":true,"description":"We would like help from the community to add this support"},{"id":2022865338,"node_id":"MDU6TGFiZWwyMDIyODY1MzM4","url":"https://api.github.com/repos/mlflow/mlflow/labels/priority/important-longterm","name":"priority/important-longterm","color":"534cb5","default":false,"description":"Important over the long term, but may not be staffed or may need multiple releases to complete."},{"id":2042304474,"node_id":"MDU6TGFiZWwyMDQyMzA0NDc0","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/build","name":"area/build","color":"48eabc","default":false,"description":"Build and test infrastructure for MLflow"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-03-06T22:07:59Z","updated_at":"2022-06-02T02:01:28Z","closed_at":"2022-06-02T02:01:28Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"## Describe the proposal\r\nAlongside the main `mlflow` PyPI package, we should consider publishing an `mlflow-client` package that excludes some of the heavier dependencies (sqlalchemy, alembic, flask, gunicorn) needed to run the MLflow server.\r\n\r\n### Motivation\r\nMany use cases do not actually require the MLflow server's dependencies - for example:\r\n* If running a production ML training job, it becomes harder to introduce MLflow when there are unneeded/unused server dependencies - these increase the likelihood that MLflow will muck with the environment of your production job and change its behavior\r\n* If building a standard data-science docker image to share with your data science team, it becomes more complex to reason about the runtime environment if unnecessary server dependencies are pulled in. \r\n\r\n### Proposed Changes\r\nWe should additionally publish a standalone mlflow-client package containing only the Python client logic (i.e. for the tracking, projects, models, and model registry components). In particular, MLflow currently has the following Python requirements:\r\n\r\n```\r\n    install_requires=[\r\n        'alembic',\r\n        'click>=7.0',\r\n        'cloudpickle',\r\n        'databricks-cli>=0.8.7',\r\n        'requests>=2.17.3',\r\n        'six>=1.10.0',\r\n        'waitress; platform_system == \"Windows\"',\r\n        'gunicorn; platform_system != \"Windows\"',\r\n        'Flask',\r\n        'numpy',\r\n        'pandas',\r\n        'python-dateutil',\r\n        'protobuf>=3.6.0',\r\n        'gitpython>=2.1.0',\r\n        'pyyaml',\r\n        'querystring_parser',\r\n        'simplejson',\r\n        'docker>=4.0.0',\r\n        'entrypoints',\r\n        'sqlparse',\r\n        'sqlalchemy',\r\n        'gorilla',\r\n        'prometheus-flask-exporter',\r\n    ],\r\n```\r\n\r\nWhich contains the following, seemingly-unnecessary-for-client-only operation libraries:\r\n* `alembic`: used to run database migrations, currently invoked during initialization of the SqlAlchemyStore\r\n* `sqlalchemy`: used to perform database operations in SqlAlchemyStore\r\n* `waitress`, `gunicorn`, `flask`: used to run the open-source REST API server and serve MLflow models as part of `mlflow models serve`. Also used when building docker images for `mlflow sagemaker` and `mlflow azureml` CLIs?\r\n* `prometheus-flask-exporter`: used to expose service metrics to Prometheus when running the OSS server\r\n\r\nIf we were to remove these libraries, we'd end up with a client package dependent on:\r\n```\r\n    install_requires=[\r\n        'click>=7.0',\r\n        'cloudpickle',\r\n        'databricks-cli>=0.8.7',\r\n        'requests>=2.17.3',\r\n        'six>=1.10.0',\r\n        'numpy',\r\n        'pandas',\r\n        'python-dateutil',\r\n        'protobuf>=3.6.0',\r\n        'gitpython>=2.1.0',\r\n        'pyyaml',\r\n        'querystring_parser',\r\n        'simplejson',\r\n        'docker>=4.0.0',\r\n        'entrypoints',\r\n        'sqlparse',\r\n        'sqlalchemy',\r\n        'gorilla',\r\n    ],\r\n```\r\n\r\nWhich would be significantly smaller (TODO how much) & have a smaller transitive closure of dependencies.\r\n\r\n### What APIs will be available in the mlflow-client package? How will we document them?\r\nSay we publish an `mlflow-client` package with a reduced dependency set, but that this package contains all the APIs supported by the main `mlflow` package. This may lead to confusing behavior where users attempt to use APIs documented in the main package, only to find that they don't work (e.g. `mlflow models serve` will not work without the `gunicorn` server dependency, for example).\r\n\r\nOne simple approach could be to simply expose the same APIs (so that we don't need to separately document the two packages), but attempt to show informative error messages that clearly indicate to mlflow-client users why certain functionality fails or is otherwise unavailable.\r\n\r\nThe main APIs this is relevant for are (TODO flesh out this list):\r\n* `mlflow models serve` & `mlflow models predict`?\r\n* TODO: `mlflow sagemaker ...` and `mlflow azureml ...` CLIs?\r\n* \r\n\r\nMy hope is that this audit will show that the number of affected APIs is relatively small","closed_by":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2557/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2557/timeline","performed_via_github_app":null,"state_reason":"completed"}