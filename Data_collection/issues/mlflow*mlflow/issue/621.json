{"url":"https://api.github.com/repos/mlflow/mlflow/issues/621","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/621/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/621/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/621/events","html_url":"https://github.com/mlflow/mlflow/issues/621","id":369126820,"node_id":"MDU6SXNzdWUzNjkxMjY4MjA=","number":621,"title":"Artifacts logged from a Windows based client won't appear in a remote mlflow server that has been configured to use GCS","user":{"login":"Wasala","id":1227610,"node_id":"MDQ6VXNlcjEyMjc2MTA=","avatar_url":"https://avatars.githubusercontent.com/u/1227610?v=4","gravatar_id":"","url":"https://api.github.com/users/Wasala","html_url":"https://github.com/Wasala","followers_url":"https://api.github.com/users/Wasala/followers","following_url":"https://api.github.com/users/Wasala/following{/other_user}","gists_url":"https://api.github.com/users/Wasala/gists{/gist_id}","starred_url":"https://api.github.com/users/Wasala/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Wasala/subscriptions","organizations_url":"https://api.github.com/users/Wasala/orgs","repos_url":"https://api.github.com/users/Wasala/repos","events_url":"https://api.github.com/users/Wasala/events{/privacy}","received_events_url":"https://api.github.com/users/Wasala/received_events","type":"User","site_admin":false},"labels":[{"id":1554650079,"node_id":"MDU6TGFiZWwxNTU0NjUwMDc5","url":"https://api.github.com/repos/mlflow/mlflow/labels/stale","name":"stale","color":"828282","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-10-11T13:40:45Z","updated_at":"2020-03-11T17:30:51Z","closed_at":"2019-11-12T23:50:01Z","author_association":"NONE","active_lock_reason":null,"body":"### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: stock\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Windows 7 (client), Ubuntu 16.04 server\r\n- **MLflow installed from (source or binary)**:  pip install mlflow\r\n- **MLflow version (run ``mlflow --version``)**: 0.7.0\r\n- **Python version**:  3.7\r\n- **npm version (if running the dev UI):\r\n- **Exact command to reproduce**: Attempting to log artifact from Windows client to gcs bucket\r\n\r\n### Describe the problem\r\nAn mlflow client running on Windows is set to track a remote mlflow server (running on Ubuntu) and the remote server is configured to log artifacts to Google Cloud Storage (GCS). When an artifact is logged in a run (via client), it will successfully get uploaded into the GCS bucket, but mlflow server's tracking UI shows no artifacts and it shows \"No Artifacts Recorded. Use the log artifact APIs to store file outputs from MLflow runs.\" When examining the bucket it was noticed that the file has been uploaded as \"artifacts\\maxresdefault.jpg\" into the bucket. i.e. It was not uploaded into a separate \"artifacts\" folder but  as a file with a forward slash in its name. It seems that in Windows, \"path.join()\" using the forward slash \"\\\" seem to be the issue here.\r\n\r\n### Source code / logs\r\nInclude any logs or source code that would be helpful to diagnose the problem. If including tracebacks,\r\nplease include the full traceback. Large logs and files should be attached.\r\nTry to provide a reproducible test case that is the bare minimum necessary to generate the problem.\r\n\r\n\r\n\r\nClient code is running on Windows Jupyter notebook :\r\n```\r\n...\r\nmlflow.set_tracking_uri(mlflow_tracking_URI)\r\n..\r\nwith mlflow.start_run(run_name=\"experiment-5\", source_name=\"this_script\"):\r\n\tmlflow.log_artifact('maxresdefault.jpg')\r\n\r\n```\r\nServer ran as:\r\n\t`mlflow server --file-store ./mlflow-metadata --default-artifact-root gs://path-to-my-gcs-bucket --host 0.0.0.0`\r\n\r\n\r\nI've modified the store/gcs_aritifact_repo.py's log_artifact function so that it will replace all the forward slashes with backslashes as follows.\r\n```\r\n    def log_artifact(self, local_file, artifact_path=None):\r\n        (bucket, dest_path) = self.parse_gcs_uri(self.artifact_uri)\r\n        if artifact_path:\r\n            dest_path = build_path(dest_path, artifact_path)\r\n        dest_path = build_path(dest_path, os.path.basename(local_file))\r\n        gcs_bucket = self.gcs.Client().get_bucket(bucket)\r\n        blob = gcs_bucket.blob(dest_path.replace('\\\\','/'))\r\n        blob.upload_from_filename(local_file)\r\n\r\n```\r\nThis resolved the issue for me. But a more permanent and a  better solution needs to be investigated.\r\n\r\n","closed_by":{"login":"stale[bot]","id":26384082,"node_id":"MDM6Qm90MjYzODQwODI=","avatar_url":"https://avatars.githubusercontent.com/in/1724?v=4","gravatar_id":"","url":"https://api.github.com/users/stale%5Bbot%5D","html_url":"https://github.com/apps/stale","followers_url":"https://api.github.com/users/stale%5Bbot%5D/followers","following_url":"https://api.github.com/users/stale%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stale%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/stale%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/stale%5Bbot%5D/repos","events_url":"https://api.github.com/users/stale%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/stale%5Bbot%5D/received_events","type":"Bot","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/621/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/621/timeline","performed_via_github_app":null,"state_reason":"completed"}