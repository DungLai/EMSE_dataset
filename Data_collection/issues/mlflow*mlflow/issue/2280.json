{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2280","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2280/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2280/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2280/events","html_url":"https://github.com/mlflow/mlflow/issues/2280","id":547605031,"node_id":"MDU6SXNzdWU1NDc2MDUwMzE=","number":2280,"title":"[BUG] mlflow resets the global warning filter as a module import side-effect","user":{"login":"Connossor","id":22548039,"node_id":"MDQ6VXNlcjIyNTQ4MDM5","avatar_url":"https://avatars.githubusercontent.com/u/22548039?v=4","gravatar_id":"","url":"https://api.github.com/users/Connossor","html_url":"https://github.com/Connossor","followers_url":"https://api.github.com/users/Connossor/followers","following_url":"https://api.github.com/users/Connossor/following{/other_user}","gists_url":"https://api.github.com/users/Connossor/gists{/gist_id}","starred_url":"https://api.github.com/users/Connossor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Connossor/subscriptions","organizations_url":"https://api.github.com/users/Connossor/orgs","repos_url":"https://api.github.com/users/Connossor/repos","events_url":"https://api.github.com/users/Connossor/events{/privacy}","received_events_url":"https://api.github.com/users/Connossor/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1893072438,"node_id":"MDU6TGFiZWwxODkzMDcyNDM4","url":"https://api.github.com/repos/mlflow/mlflow/labels/help%20wanted","name":"help wanted","color":"c5def5","default":true,"description":"We would like help from the community to add this support"},{"id":2022866026,"node_id":"MDU6TGFiZWwyMDIyODY2MDI2","url":"https://api.github.com/repos/mlflow/mlflow/labels/priority/backlog","name":"priority/backlog","color":"534cb5","default":false,"description":"We believe it is useful, but donâ€™t see it being prioritized in the next few months."},{"id":2042304474,"node_id":"MDU6TGFiZWwyMDQyMzA0NDc0","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/build","name":"area/build","color":"48eabc","default":false,"description":"Build and test infrastructure for MLflow"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-01-09T17:01:31Z","updated_at":"2020-11-22T05:38:37Z","closed_at":"2020-11-22T05:38:37Z","author_association":"NONE","active_lock_reason":null,"body":"\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: no\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: linux Ubuntu -- Python 3.7.3\r\n- **MLflow installed from (source or binary)**: source\r\n- **MLflow version (run ``mlflow --version``)**: 1.2.0\r\n- **Python version**: 3.7.3\r\n\r\n### Describe the problem\r\nI've encountered some unexpected behaviour when using mlflow and pytest together. It looks like warning filters do not behave as expected: warnings which should be surpressed are not.\r\n\r\nHere is the response from the pytest devs when they looked into the [issue](https://github.com/pytest-dev/pytest/issues/6417):\r\n\r\n> `mlflow` does a naughty thing and [resets the global warning filter as a module import side-effect](https://github.com/mlflow/mlflow/blob/c6be0a4472f41d2e78bd4c73ef2126a63bbd0c86/mlflow/__init__.py#L39)\r\n> \r\n> there isn't really much `pytest` can do here to prevent/fix that -- I suggest creating [an issue on mlflow to stop doing that](https://github.com/mlflow/mlflow/issues)\r\n> \r\n> _Originally posted by @asottile in https://github.com/pytest-dev/pytest/issues/6417#issuecomment-572580955_\r\n\r\n\r\n### Code to reproduce issue\r\nHere's a minimal example. \r\npytest.ini:\r\n```\r\n[pytest]\r\nfilterwarnings =\r\n    ignore::DeprecationWarning\r\n```\r\n\r\nAnd a simple test test_foo.py:\r\n```python\r\n\r\nimport mlflow     # This seems to \"break\" the filterwarnings\r\nimport nbconvert  # An example lib that raises two DeprecationWarnings\r\n\r\ndef test_bar():\r\n    assert True\r\n\r\n```\r\n\r\nWhen I run `pytest`, the warnings are not filtered out as they should be:\r\n```\r\n============ test session starts ==================\r\nplatform linux -- Python 3.7.3, pytest-5.3.0, py-1.8.0, pluggy-0.12.0\r\nrootdir: /hpcdata/a_username/foo, inifile: pytest.ini\r\nplugins: arraydiff-0.3, doctestplus-0.3.0, openfiles-0.4.0, remotedata-0.3.1, pyfakefs-3.6.1\r\ncollected 1 item                                                                                                                                                                                         \r\n\r\ntest_foo.py .                                                                                                                                                                                      [100%]\r\n\r\n============== warnings summary ==================\r\n/....lib/python3.7/site-packages/nbformat/notebooknode.py:4\r\n  /.../lib/python3.7/site-packages/nbformat/notebooknode.py:4: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working\r\n    from collections import Mapping\r\n\r\n/.../lib/python3.7/site-packages/jinja2/utils.py:485\r\n  /.../lib/python3.7/site-packages/jinja2/utils.py:485: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working\r\n    from collections import MutableMapping\r\n\r\n-- Docs: https://docs.pytest.org/en/latest/warnings.html\r\n============ 1 passed, 2 warnings in 2.64s ============\r\n```\r\n\r\n### Other info / logs\r\nOutput of pip list:\r\n<details>\r\n\r\n```\r\nPackage                            Version   \r\n---------------------------------- ----------\r\nalabaster                          0.7.12    \r\nalembic                            1.1.0     \r\nanaconda-client                    1.7.2     \r\nanaconda-project                   0.8.3     \r\nasn1crypto                         0.24.0    \r\nastroid                            2.2.5     \r\nastropy                            3.2.1     \r\natomicwrites                       1.3.0     \r\nattrs                              19.1.0    \r\nBabel                              2.7.0     \r\nbackcall                           0.1.0     \r\nbackports.os                       0.1.1     \r\nbackports.shutil-get-terminal-size 1.0.0     \r\nbcrypt                             3.1.7     \r\nbeautifulsoup4                     4.8.0     \r\nbitarray                           1.0.1     \r\nbkcharts                           0.2       \r\nbleach                             3.1.0     \r\nbokeh                              1.3.4     \r\nboto                               2.49.0    \r\nBottleneck                         1.2.1     \r\ncertifi                            2019.11.28\r\ncffi                               1.12.3    \r\nchardet                            3.0.4     \r\nClick                              7.0       \r\ncloudpickle                        1.2.1     \r\nclyent                             1.2.2     \r\ncolorama                           0.4.1     \r\nconfigparser                       3.8.1     \r\ncontextlib2                        0.5.5     \r\ncryptography                       2.7       \r\ncycler                             0.10.0    \r\nCython                             0.29.13   \r\ncytoolz                            0.10.0    \r\ndask                               2.2.0     \r\ndask-jobqueue                      0.6.3     \r\ndatabricks-cli                     0.8.7     \r\ndecorator                          4.4.0     \r\ndefusedxml                         0.5.0     \r\ndistributed                        2.2.0     \r\ndocker                             4.0.2     \r\ndocrep                             0.2.7     \r\ndocutils                           0.15.2    \r\nentrypoints                        0.3       \r\net-xmlfile                         1.0.1     \r\nfastcache                          1.1.0     \r\nfilelock                           3.0.10    \r\nFlask                              1.1.1     \r\nfsspec                             0.4.1     \r\ngevent                             1.4.0     \r\ngitdb2                             2.0.5     \r\nGitPython                          3.0.2     \r\nglob2                              0.7       \r\ngmpy2                              2.1.0b1   \r\ngorilla                            0.3.0     \r\ngraphviz                           0.12      \r\ngreenlet                           0.4.15    \r\ngunicorn                           19.9.0    \r\nh5py                               2.9.0     \r\nheapdict                           1.0.0     \r\nholoviews                          1.12.4    \r\nhtml5lib                           1.0.1     \r\nidna                               2.8       \r\nimageio                            2.5.0     \r\nimagesize                          1.1.0     \r\nimportlib-metadata                 0.18      \r\nipydatawidgets                     4.0.1     \r\nipykernel                          5.1.2     \r\nipympl                             0.3.3     \r\nipyscales                          0.3.0     \r\nipython                            7.7.0     \r\nipython-genutils                   0.2.0     \r\nipyvolume                          0.5.2     \r\nipywebrtc                          0.5.0     \r\nipywidgets                         7.5.1     \r\nisort                              4.3.21    \r\nitsdangerous                       1.1.0     \r\njdcal                              1.4.1     \r\njedi                               0.14.1    \r\njeepney                            0.4       \r\nJinja2                             2.10.1    \r\njoblib                             0.13.2    \r\njson5                              0.8.5     \r\njsonschema                         3.0.2     \r\njupyter-client                     5.3.1     \r\njupyter-console                    6.0.0     \r\njupyter-core                       4.4.0     \r\njupyterlab                         1.0.4     \r\njupyterlab-server                  1.0.0     \r\nkeyring                            19.0.2    \r\nkiwisolver                         1.1.0     \r\nlasio                              0.24.1    \r\nlazy-object-proxy                  1.4.1     \r\nlibarchive-c                       2.8       \r\nlief                               0.9.0     \r\nllvmlite                           0.29.0    \r\nlocket                             0.2.0     \r\nlxml                               4.4.0     \r\nMako                               1.1.0     \r\nMarkdown                           3.1.1     \r\nMarkupSafe                         1.1.1     \r\nmatplotlib                         3.1.1     \r\nmccabe                             0.6.1     \r\nmistune                            0.8.4     \r\nmkl-fft                            1.0.14    \r\nmkl-random                         1.0.4     \r\nmkl-service                        2.1.0     \r\nmlflow                             1.2.0     \r\nmock                               3.0.5     \r\nmore-itertools                     7.2.0     \r\nmpmath                             1.1.0     \r\nmsgpack                            0.6.1     \r\nmultipledispatch                   0.6.0     \r\nmysql-connector-python             8.0.18    \r\nnbconvert                          5.6.0     \r\nnbformat                           4.4.0     \r\nnetworkx                           2.3       \r\nnltk                               3.4.4     \r\nnose                               1.3.7     \r\nnotebook                           6.0.0     \r\nnumba                              0.45.1    \r\nnumexpr                            2.6.9     \r\nnumpy                              1.16.4    \r\nnumpydoc                           0.9.1     \r\nolefile                            0.46      \r\nopenpyxl                           2.6.2     \r\npackaging                          19.0      \r\npandas                             0.25.0    \r\npandocfilters                      1.4.2     \r\npanel                              0.6.2     \r\nparam                              1.9.1     \r\nparamiko                           2.6.0     \r\nparso                              0.5.1     \r\npartd                              1.0.0     \r\npath.py                            12.0.1    \r\npathlib2                           2.3.4     \r\npatsy                              0.5.1     \r\npep8                               1.7.1     \r\npexpect                            4.7.0     \r\npickleshare                        0.7.5     \r\nPillow                             6.1.0     \r\npip                                19.2.1    \r\npkginfo                            1.5.0.1   \r\nplotly                             4.1.1     \r\npluggy                             0.12.0    \r\nply                                3.11      \r\nprometheus-client                  0.7.1     \r\nprompt-toolkit                     2.0.9     \r\nprotobuf                           3.11.1    \r\npsutil                             5.6.3     \r\nPTable                             0.9.2     \r\nptyprocess                         0.6.0     \r\npy                                 1.8.0     \r\npycodestyle                        2.5.0     \r\npycosat                            0.6.3     \r\npycparser                          2.19      \r\npycrypto                           2.6.1     \r\npyct                               0.4.6     \r\npycurl                             7.43.0.2  \r\npyfakefs                           3.6.1     \r\npyflakes                           2.1.1     \r\nPygments                           2.4.2     \r\npylint                             2.3.1     \r\nPyNaCl                             1.3.0     \r\npyodbc                             4.0.27    \r\npyOpenSSL                          19.0.0    \r\npyparsing                          2.4.2     \r\npyproj                             2.2.1     \r\npyrsistent                         0.15.4    \r\nPySocks                            1.7.0     \r\npytest                             5.3.0     \r\npytest-arraydiff                   0.3       \r\npytest-astropy                     0.5.0     \r\npytest-doctestplus                 0.3.0     \r\npytest-openfiles                   0.4.0     \r\npytest-remotedata                  0.3.1     \r\npython-dateutil                    2.8.0     \r\npython-editor                      1.0.4     \r\npython-pptx                        0.6.18    \r\npythreejs                          2.1.1     \r\npytz                               2019.2    \r\npyviz-comms                        0.7.2     \r\nPyWavelets                         1.0.3     \r\nPyYAML                             5.1.2     \r\npyzmq                              18.0.2    \r\nqgrid                              1.1.1     \r\nQtAwesome                          0.6.0     \r\nqtconsole                          4.5.2     \r\nQtPy                               1.9.0     \r\nquerystring-parser                 1.2.4     \r\nrequests                           2.22.0    \r\nretrying                           1.3.3     \r\nrope                               0.14.0    \r\nruamel-yaml                        0.15.71   \r\nscikit-image                       0.15.0    \r\nscikit-learn                       0.21.3    \r\nscipy                              1.3.0     \r\nseaborn                            0.9.0     \r\nSecretStorage                      3.1.1     \r\nSend2Trash                         1.5.0     \r\nsetuptools                         41.0.1    \r\nsimplegeneric                      0.8.1     \r\nsimplejson                         3.16.0    \r\nsingledispatch                     3.4.0.3   \r\nsix                                1.12.0    \r\nsmmap2                             2.0.5     \r\nsnowballstemmer                    1.9.0     \r\nsortedcollections                  1.1.2     \r\nsortedcontainers                   2.1.0     \r\nsoupsieve                          1.9.2     \r\nSphinx                             2.1.2     \r\nsphinxcontrib-applehelp            1.0.1     \r\nsphinxcontrib-devhelp              1.0.1     \r\nsphinxcontrib-htmlhelp             1.0.2     \r\nsphinxcontrib-jsmath               1.0.1     \r\nsphinxcontrib-qthelp               1.0.2     \r\nsphinxcontrib-serializinghtml      1.1.1     \r\nsphinxcontrib-websupport           1.1.2     \r\nspyder                             3.3.6     \r\nspyder-kernels                     0.5.1     \r\nSQLAlchemy                         1.3.6     \r\nsqlparse                           0.3.0     \r\nsshtunnel                          0.1.5     \r\nstatsmodels                        0.10.1    \r\nsympy                              1.4       \r\ntables                             3.5.2     \r\ntabulate                           0.8.3     \r\ntblib                              1.4.0     \r\nterminado                          0.8.2     \r\ntestpath                           0.4.2     \r\ntoolz                              0.10.0    \r\ntornado                            6.0.3     \r\ntqdm                               4.33.0    \r\ntraitlets                          4.3.2     \r\ntraittypes                         0.2.1     \r\nunicodecsv                         0.14.1    \r\nurllib3                            1.25.3    \r\nwcwidth                            0.1.7     \r\nwebencodings                       0.5.1     \r\nwebsocket-client                   0.56.0    \r\nWerkzeug                           0.15.5    \r\nwheel                              0.33.4    \r\nwidgetsnbextension                 3.5.1     \r\nwrapt                              1.11.2    \r\nwurlitzer                          1.0.3     \r\nxlrd                               1.2.0     \r\nXlsxWriter                         1.1.8     \r\nxlwt                               1.3.0     \r\nzict                               1.0.0     \r\nzipp                               0.5.2     \r\nzmapio                             0.3       \r\n```\r\n</details>\r\n","closed_by":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2280/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2280/timeline","performed_via_github_app":null,"state_reason":"completed"}