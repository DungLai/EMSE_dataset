{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1266","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/1266/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/1266/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/1266/events","html_url":"https://github.com/mlflow/mlflow/issues/1266","id":443933347,"node_id":"MDU6SXNzdWU0NDM5MzMzNDc=","number":1266,"title":"SQLAlchemy backend is ignored when a driver is included in the URI","user":{"login":"drewmcdonald","id":6540837,"node_id":"MDQ6VXNlcjY1NDA4Mzc=","avatar_url":"https://avatars.githubusercontent.com/u/6540837?v=4","gravatar_id":"","url":"https://api.github.com/users/drewmcdonald","html_url":"https://github.com/drewmcdonald","followers_url":"https://api.github.com/users/drewmcdonald/followers","following_url":"https://api.github.com/users/drewmcdonald/following{/other_user}","gists_url":"https://api.github.com/users/drewmcdonald/gists{/gist_id}","starred_url":"https://api.github.com/users/drewmcdonald/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drewmcdonald/subscriptions","organizations_url":"https://api.github.com/users/drewmcdonald/orgs","repos_url":"https://api.github.com/users/drewmcdonald/repos","events_url":"https://api.github.com/users/drewmcdonald/events{/privacy}","received_events_url":"https://api.github.com/users/drewmcdonald/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-05-14T14:01:17Z","updated_at":"2019-07-07T11:56:17Z","closed_at":"2019-07-07T11:56:17Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Mac OS X\r\n- **MLflow installed from (source or binary)**: binary\r\n- **MLflow version (run ``mlflow --version``)**: 0.9.1\r\n- **Python version**: 3.6.8\r\n- **npm version (if running the dev UI):\r\n- **Exact command to reproduce**: use a database backend URI that specifies a driver (in the form `'dialect+driver://...'`)\r\n\r\n### Describe the problem\r\n\r\nWhen starting a server, the`backend-store-uri` is parsed in `SQLAlchemyStore.__init__` [here](https://github.com/mlflow/mlflow/blob/2ee4c64a5d8d089ca23195e835fd6d1b986fcba8/mlflow/store/sqlalchemy_store.py#L66). The scheme (everything before `://`) is used as a key to identify what type of backend is being requested. \r\n\r\nHowever, it's very common to specify a database connection using both a dialect and a driver for that dialect, as in `dialect+driver://...`. In this situation, mlflow takes `dialect+driver` as the key, and has to fall back to the file store since that key does not match to a supported backend type.\r\n\r\nThis URI style [is supported in sqlalchemy](https://docs.sqlalchemy.org/en/13/core/engines.html#database-urls) and should be allowed in mlflow as well. For one example, I use the `pymysql` driver heavily as it's easiest to install. It's also worth noting that this breaks even when the default drivers are the drivers specified.\r\n\r\n### Suggested Solution\r\n\r\nAdd another step to the URI parsing procedure that keeps everything before `'+'` as the key for the backend type.\r\n\r\nInstead of `self.db_type = urllib.parse.urlparse(db_uri).scheme`, we could split at '+' and take the first value (`self.db_type = urllib.parse.urlparse(db_uri).scheme.split('+')[0]`), or do some sort of regex scrub.\r\n\r\n* `mysql+pymysql` -> `mysql`\r\n* `mysql` -> `mysql`\r\n* `postgresql+pg8000` -> `postgresql`\r\n* etc.\r\n\r\nThis would yield the correct keys for identifying database types and allow users to use the driver of their choice (the connection would still be built on the db_uri as specified).\r\n","closed_by":{"login":"drewmcdonald","id":6540837,"node_id":"MDQ6VXNlcjY1NDA4Mzc=","avatar_url":"https://avatars.githubusercontent.com/u/6540837?v=4","gravatar_id":"","url":"https://api.github.com/users/drewmcdonald","html_url":"https://github.com/drewmcdonald","followers_url":"https://api.github.com/users/drewmcdonald/followers","following_url":"https://api.github.com/users/drewmcdonald/following{/other_user}","gists_url":"https://api.github.com/users/drewmcdonald/gists{/gist_id}","starred_url":"https://api.github.com/users/drewmcdonald/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drewmcdonald/subscriptions","organizations_url":"https://api.github.com/users/drewmcdonald/orgs","repos_url":"https://api.github.com/users/drewmcdonald/repos","events_url":"https://api.github.com/users/drewmcdonald/events{/privacy}","received_events_url":"https://api.github.com/users/drewmcdonald/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1266/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/1266/timeline","performed_via_github_app":null,"state_reason":"completed"}