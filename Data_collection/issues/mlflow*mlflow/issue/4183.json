{"url":"https://api.github.com/repos/mlflow/mlflow/issues/4183","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/4183/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/4183/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/4183/events","html_url":"https://github.com/mlflow/mlflow/issues/4183","id":833315224,"node_id":"MDU6SXNzdWU4MzMzMTUyMjQ=","number":4183,"title":"Tensorflow Addon FBetaScore metric error: \"Got invalid value [0.13744274] for metric 'fbeta_score'\"","user":{"login":"zoltan-fedor","id":3887295,"node_id":"MDQ6VXNlcjM4ODcyOTU=","avatar_url":"https://avatars.githubusercontent.com/u/3887295?v=4","gravatar_id":"","url":"https://api.github.com/users/zoltan-fedor","html_url":"https://github.com/zoltan-fedor","followers_url":"https://api.github.com/users/zoltan-fedor/followers","following_url":"https://api.github.com/users/zoltan-fedor/following{/other_user}","gists_url":"https://api.github.com/users/zoltan-fedor/gists{/gist_id}","starred_url":"https://api.github.com/users/zoltan-fedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zoltan-fedor/subscriptions","organizations_url":"https://api.github.com/users/zoltan-fedor/orgs","repos_url":"https://api.github.com/users/zoltan-fedor/repos","events_url":"https://api.github.com/users/zoltan-fedor/events{/privacy}","received_events_url":"https://api.github.com/users/zoltan-fedor/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-03-17T01:17:16Z","updated_at":"2021-03-17T22:23:42Z","closed_at":"2021-03-17T22:23:42Z","author_association":"NONE","active_lock_reason":null,"body":"I am using MLFlow 2.4.1 with Tensorflow 2.3.1 and MLFlow autologging and all worked well with the standard metrics.\r\nBut then I decided to try the `FBetaScore` metric from the tensorflow-addons package (see https://www.tensorflow.org/addons/api_docs/python/tfa/metrics/FBetaScore) and which causes the following warning:\r\n\r\n`2021/03/16 19:43:38 WARNING mlflow.utils.autologging_utils: MLflow issued a warning during tensorflow autologging: \".../lib/python3.8/site-packages/mlflow/utils/autologging_utils.py:242: UserWarning: Logging to MLflow failed: Got invalid value [0.13744274] for metric 'fbeta_score' (timestamp=1615938218333). Please specify value as a valid double (64-bit floating point)\"`\r\n\r\nIt seems as if the value for the metric is a list (or a Tensor) and MLFlow only accepts direct numerical values, see https://github.com/mlflow/mlflow/blob/3935ad1cd9cb556ac931de9ed5c7c9538a3a8281/mlflow/utils/validation.py#L72\r\n\r\nAny ideas how to work around this?\r\n\r\n\r\nMy code:\r\n\r\n```\r\nimport tensorflow as tf\r\nfrom tensorflow.keras import layers, metrics\r\nimport tensorflow_addons as tfa\r\nimport mlflow.tensorflow\r\n\r\n...\r\n\r\nmlflow.tensorflow.autolog(every_n_iter=1)\r\n\r\n...\r\n\r\n_metrics = [\r\n    'accuracy',\r\n    metrics.TruePositives(name='tp'),\r\n    metrics.FalsePositives(name='fp'),\r\n    metrics.TrueNegatives(name='tn'),\r\n    metrics.FalseNegatives(name='fn'),\r\n    metrics.Precision(name='precision'),\r\n    metrics.Recall(name='recall'),\r\n    metrics.AUC(name='auc'),\r\n    # calculating F2 using https://www.tensorflow.org/addons/api_docs/python/tfa/metrics/FBetaScore\r\n    tfa.metrics.FBetaScore(num_classes=1, beta=2.0,\r\n                           threshold=0.9999999,\r\n                           name='fbeta_score'\r\n                           )\r\n]\r\n\r\nmodel.compile(optimizer=optimizer,\r\n              loss=tf.keras.losses.BinaryCrossentropy(from_logits=True),\r\n              metrics=_metrics)\r\n\r\nearly_stopping = tf.keras.callbacks.EarlyStopping(\r\n    monitor='fbeta_score',\r\n    verbose=1,\r\n    patience=10,\r\n    mode='max',\r\n    restore_best_weights=True)\r\n\r\nhistory = model.fit(train_ds,\r\n                    validation_data=val_ds,\r\n                    epochs=max_epochs,\r\n                    batch_size=batch_size,\r\n                    class_weight={0: 1, 1: 10},\r\n                    callbacks=[early_stopping],\r\n                    verbose=0\r\n                    )\r\n```","closed_by":{"login":"zoltan-fedor","id":3887295,"node_id":"MDQ6VXNlcjM4ODcyOTU=","avatar_url":"https://avatars.githubusercontent.com/u/3887295?v=4","gravatar_id":"","url":"https://api.github.com/users/zoltan-fedor","html_url":"https://github.com/zoltan-fedor","followers_url":"https://api.github.com/users/zoltan-fedor/followers","following_url":"https://api.github.com/users/zoltan-fedor/following{/other_user}","gists_url":"https://api.github.com/users/zoltan-fedor/gists{/gist_id}","starred_url":"https://api.github.com/users/zoltan-fedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zoltan-fedor/subscriptions","organizations_url":"https://api.github.com/users/zoltan-fedor/orgs","repos_url":"https://api.github.com/users/zoltan-fedor/repos","events_url":"https://api.github.com/users/zoltan-fedor/events{/privacy}","received_events_url":"https://api.github.com/users/zoltan-fedor/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/4183/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/4183/timeline","performed_via_github_app":null,"state_reason":"completed"}