{"url":"https://api.github.com/repos/mlflow/mlflow/issues/4874","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/4874/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/4874/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/4874/events","html_url":"https://github.com/mlflow/mlflow/issues/4874","id":1019232118,"node_id":"I_kwDOCB5Jx848wD92","number":4874,"title":"[BUG] mlflow pyfunc is not predicting the model trained on tensorflow 1.15.4 ","user":{"login":"mtayyab-numtra","id":85476318,"node_id":"MDQ6VXNlcjg1NDc2MzE4","avatar_url":"https://avatars.githubusercontent.com/u/85476318?v=4","gravatar_id":"","url":"https://api.github.com/users/mtayyab-numtra","html_url":"https://github.com/mtayyab-numtra","followers_url":"https://api.github.com/users/mtayyab-numtra/followers","following_url":"https://api.github.com/users/mtayyab-numtra/following{/other_user}","gists_url":"https://api.github.com/users/mtayyab-numtra/gists{/gist_id}","starred_url":"https://api.github.com/users/mtayyab-numtra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtayyab-numtra/subscriptions","organizations_url":"https://api.github.com/users/mtayyab-numtra/orgs","repos_url":"https://api.github.com/users/mtayyab-numtra/repos","events_url":"https://api.github.com/users/mtayyab-numtra/events{/privacy}","received_events_url":"https://api.github.com/users/mtayyab-numtra/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-10-06T21:07:25Z","updated_at":"2021-10-06T21:07:25Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Thank you for submitting an issue. Please refer to our [issue policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md) for additional information about bug reports. For help with debugging your code, please refer to [Stack Overflow](https://stackoverflow.com/questions/tagged/mlflow).\r\n\r\n**Please fill in this bug report template to ensure a timely and thorough response.**\r\n\r\n### Willingness to contribute\r\nThe MLflow Community encourages bug fix contributions. Would you or another member of your organization be willing to contribute a fix for this bug to the MLflow code base?\r\n\r\n- [ ] Yes. I can contribute a fix for this bug independently.\r\n- [ ] Yes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\r\n-  No. I cannot contribute a bug fix at this time.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)No:\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)Linux:\r\n- **MLflow installed from (source or binary)pip:\r\n- **MLflow version (run ``mlflow --version``)1.19.0:\r\n- **Python version3.6:\r\n\r\n### Describe the problem\r\nI build a model in tensorflow 1.15.4 and log it in the mlflow. After loading it back in tensorflow it shows that it does not have a predict function. If I load it back in the default pyfunc then it is also not predicting the dataframe/numpy/dict. \r\n\r\n### Code to reproduce issue\r\nPredicting using tensorflow model\r\n```\r\ntf_graph = tf.Graph()\r\ntf_sess = tf.Session(graph=tf_graph)\r\ntensor_model = mlflow.tensorflow.load_model(model_uri=\"runs:/519a3786726249e0ad8a6dd26b0531cd/widedeep\", tf_sess=tf_sess)\r\ntensor_model.predict(test)\r\n---------------------------------------------------------------------------\r\nAttributeError                            Traceback (most recent call last)\r\n<ipython-input-46-28b1b402562c> in <module>\r\n----> 1 tensor_model.predict(test)\r\n\r\nAttributeError: predict\r\n```\r\nPredicting using default pyfunc model\r\n```\r\nmodel = mlflow.pyfunc.load_model(model_uri= \"runs:/519a3786726249e0ad8a6dd26b0531cd/widedeep\", suppress_warnings= True)\r\nmodel.predict(test)\r\n---------------------------------------------------------------------------\r\nKeyError                                  Traceback (most recent call last)\r\nD:\\Anaconda\\envs\\reco_base\\lib\\site-packages\\pandas\\core\\indexes\\base.py in get_loc(self, key, method, tolerance)\r\n   2897             try:\r\n-> 2898                 return self._engine.get_loc(casted_key)\r\n   2899             except KeyError as err:\r\n\r\npandas\\_libs\\index.pyx in pandas._libs.index.IndexEngine.get_loc()\r\n\r\npandas\\_libs\\index.pyx in pandas._libs.index.IndexEngine.get_loc()\r\n\r\npandas\\_libs\\hashtable_class_helper.pxi in pandas._libs.hashtable.PyObjectHashTable.get_item()\r\n\r\npandas\\_libs\\hashtable_class_helper.pxi in pandas._libs.hashtable.PyObjectHashTable.get_item()\r\n\r\nKeyError: 'examples'\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nKeyError                                  Traceback (most recent call last)\r\n<ipython-input-45-c0ac8462bce6> in <module>\r\n----> 1 model.predict(test)\r\n\r\nD:\\Anaconda\\envs\\reco_base\\lib\\site-packages\\mlflow\\pyfunc\\__init__.py in predict(self, data)\r\n    594         if input_schema is not None:\r\n    595             data = _enforce_schema(data, input_schema)\r\n--> 596         return self._model_impl.predict(data)\r\n    597 \r\n    598     @property\r\n\r\nD:\\Anaconda\\envs\\reco_base\\lib\\site-packages\\mlflow\\tensorflow.py in predict(self, data)\r\n    535                 feed_dict = {\r\n    536                     self.input_tensor_mapping[tensor_column_name]: data[tensor_column_name].values\r\n--> 537                     for tensor_column_name in self.input_tensor_mapping.keys()\r\n    538                 }\r\n    539             else:\r\n\r\nD:\\Anaconda\\envs\\reco_base\\lib\\site-packages\\mlflow\\tensorflow.py in <dictcomp>(.0)\r\n    535                 feed_dict = {\r\n    536                     self.input_tensor_mapping[tensor_column_name]: data[tensor_column_name].values\r\n--> 537                     for tensor_column_name in self.input_tensor_mapping.keys()\r\n    538                 }\r\n    539             else:\r\n\r\nD:\\Anaconda\\envs\\reco_base\\lib\\site-packages\\pandas\\core\\frame.py in __getitem__(self, key)\r\n   2904             if self.columns.nlevels > 1:\r\n   2905                 return self._getitem_multilevel(key)\r\n-> 2906             indexer = self.columns.get_loc(key)\r\n   2907             if is_integer(indexer):\r\n   2908                 indexer = [indexer]\r\n\r\nD:\\Anaconda\\envs\\reco_base\\lib\\site-packages\\pandas\\core\\indexes\\base.py in get_loc(self, key, method, tolerance)\r\n   2898                 return self._engine.get_loc(casted_key)\r\n   2899             except KeyError as err:\r\n-> 2900                 raise KeyError(key) from err\r\n   2901 \r\n   2902         if tolerance is not None:\r\n\r\nKeyError: 'examples'\r\n```\r\n\r\n### What component(s), interfaces, languages, and integrations does this bug affect?\r\nComponents \r\n- [ ] `area/artifacts`: Artifact stores and artifact logging\r\n- [ ] `area/build`: Build and test infrastructure for MLflow\r\n- [ ] `area/docs`: MLflow documentation pages\r\n- [ ] `area/examples`: Example code\r\n- [ ] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\r\n- [] `area/models`: MLmodel format, model serialization/deserialization, flavors\r\n- [ ] `area/projects`: MLproject format, project running backends\r\n- [ ] `area/scoring`: MLflow Model server, model deployment tools, Spark UDFs\r\n- [ ] `area/server-infra`: MLflow Tracking server backend\r\n- [ ] `area/tracking`: Tracking Service, tracking client APIs, autologging\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/4874/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/4874/timeline","performed_via_github_app":null,"state_reason":null}