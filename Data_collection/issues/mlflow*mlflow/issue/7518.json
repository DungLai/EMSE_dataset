{"url":"https://api.github.com/repos/mlflow/mlflow/issues/7518","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/7518/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/7518/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/7518/events","html_url":"https://github.com/mlflow/mlflow/issues/7518","id":1493297011,"node_id":"I_kwDOCB5Jx85ZAedz","number":7518,"title":"[BUG] Unable to list artifacts stored under <code>{artifactUri}</code> for the current run.","user":{"login":"hrahmanStratuscent","id":100220774,"node_id":"U_kgDOBfk_Zg","avatar_url":"https://avatars.githubusercontent.com/u/100220774?v=4","gravatar_id":"","url":"https://api.github.com/users/hrahmanStratuscent","html_url":"https://github.com/hrahmanStratuscent","followers_url":"https://api.github.com/users/hrahmanStratuscent/followers","following_url":"https://api.github.com/users/hrahmanStratuscent/following{/other_user}","gists_url":"https://api.github.com/users/hrahmanStratuscent/gists{/gist_id}","starred_url":"https://api.github.com/users/hrahmanStratuscent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hrahmanStratuscent/subscriptions","organizations_url":"https://api.github.com/users/hrahmanStratuscent/orgs","repos_url":"https://api.github.com/users/hrahmanStratuscent/repos","events_url":"https://api.github.com/users/hrahmanStratuscent/events{/privacy}","received_events_url":"https://api.github.com/users/hrahmanStratuscent/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-12-13T03:52:36Z","updated_at":"2022-12-19T04:39:06Z","closed_at":"2022-12-19T04:39:05Z","author_association":"NONE","active_lock_reason":null,"body":"### Issues Policy acknowledgement\n\n- [X] I have read and agree to submit bug reports in accordance with the [issues policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md)\n\n### Willingness to contribute\n\nYes. I can contribute a fix for this bug independently.\n\n### MLflow version\n\n- Client: 2.0.1\r\n- Tracking server: 2.0.1\r\n\n\n### System information\n\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\n- **Python version**: python:3.8\r\n- **yarn version, if running the dev UI**:\r\n\n\n### Describe the problem\n\nCreated and deployed MLflow docker image on K8S cluster. Using Google Cloud Storage as the root artifact directory.\r\nThe Dockerfile:\r\n\r\n```\r\nFROM python:3.8-slim\r\nRUN apt update && apt install -y python3-venv gcc\r\nRUN apt-get install -y python3-dev build-essential curl\r\n\r\nENV VENV=/.venv/myenv\r\nRUN python3 -m venv ${VENV}\r\nRUN mkdir -p $VENV/src\r\nENV PATH=$VENV/bin:$PATH\r\nRUN pip install -U pip psycopg2-binary mlflow==2.0.1 google-cloud google-cloud-storage\r\n# Mount the credentials json file under the following directory\r\nRUN mkdir -p /workdir/gcloud-credentials/\r\nWORKDIR /workdir/\r\nRUN curl https://sdk.cloud.google.com > install.sh\r\nRUN bash install.sh --disable-prompts --install-dir=/workdir/\r\nENV PATH=/workdir/google-cloud-sdk/bin:$PATH\r\n# Expose the port that the MLFlow tracking server runs on\r\nEXPOSE 5000\r\n# Default database credentials\r\n\r\nENTRYPOINT gcloud auth activate-service-account --key-file=/workdir/gcloud-credentials/gcloud-credentials.json && \\\r\n        mlflow server \\\r\n        --default-artifact-root gs://ml1-bucket \\\r\n        --backend-store-uri postgresql://$DB_USERNAME:$DB_PASSWORD@$DB_URL/$DB_NAME --host 0.0.0.0\r\n```\r\n\r\nThe Service Account has read-write permission. But UI not showing artifacts with this error:\r\n\r\n```\r\nLoading Artifacts Failed\r\nUnable to list artifacts stored under <code>{artifactUri}</code> for the current run. Please contact your tracking server administrator to notify them of this error, which can happen when the tracking server lacks permission to list artifacts under the current run's root artifact directory.\r\n```\r\n\n\n### Tracking information\n\n_No response_\n\n### Code to reproduce issue\n\n```\r\nprint(\"MLflow Version:\", mlflow.__version__)\r\nprint(\"Tracking URI:\", mlflow.tracking.get_tracking_uri())\r\nclient = mlflow.tracking.MlflowClient()\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    with mlflow.start_run() as run:\r\n        mlflow.log_param(\"alpha\", 5)\r\n        mlflow.log_metric(\"rmse\", 0.789)\r\n        with open(\"info.txt\", \"w\") as f:\r\n            f.write(\"Hi artifact\")\r\n        mlflow.log_artifact(\"info.txt\")\r\n        params = [Param(\"p1\", \"0.1\"), Param(\"p2\", \"0.2\")]\r\n        now = round(time.time())\r\n        metrics = [Metric(\"m1\", 0.1, now, 0), Metric(\"m2\", 0.2, now, 0)]\r\n        tags = [RunTag(\"tag1\", \"hi1\"), RunTag(\"tag2\", \"hi2\")]\r\n        client.log_batch(run.info.run_id, metrics, params, tags)\r\n```\n\n### Stack trace\n\n```\r\nLoading Artifacts Failed\r\nUnable to list artifacts stored under <code>{artifactUri}</code> for the current run. Please contact your tracking server administrator to notify them of this error, which can happen when the tracking server lacks permission to list artifacts under the current run's root artifact directory.\r\n```\n\n### Other info / logs\n\n_No response_\n\n### What component(s) does this bug affect?\n\n- [ ] `area/artifacts`: Artifact stores and artifact logging\n- [ ] `area/build`: Build and test infrastructure for MLflow\n- [ ] `area/docs`: MLflow documentation pages\n- [ ] `area/examples`: Example code\n- [ ] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\n- [ ] `area/recipes`: Recipes, Recipe APIs, Recipe configs, Recipe Templates\n- [ ] `area/projects`: MLproject format, project running backends\n- [ ] `area/scoring`: MLflow Model server, model deployment tools, Spark UDFs\n- [ ] `area/server-infra`: MLflow Tracking server backend\n- [ ] `area/tracking`: Tracking Service, tracking client APIs, autologging\n\n### What interface(s) does this bug affect?\n\n- [ ] `area/uiux`: Front-end, user experience, plotting, JavaScript, JavaScript dev server\n- [ ] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\n- [ ] `area/windows`: Windows support\n\n### What language(s) does this bug affect?\n\n- [ ] `language/r`: R APIs and clients\n- [ ] `language/java`: Java APIs and clients\n- [ ] `language/new`: Proposals for new client languages\n\n### What integration(s) does this bug affect?\n\n- [ ] `integrations/azure`: Azure and Azure ML integrations\n- [ ] `integrations/sagemaker`: SageMaker integrations\n- [ ] `integrations/databricks`: Databricks integrations","closed_by":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/7518/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/7518/timeline","performed_via_github_app":null,"state_reason":"completed"}