{"url":"https://api.github.com/repos/mlflow/mlflow/issues/608","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/608/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/608/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/608/events","html_url":"https://github.com/mlflow/mlflow/issues/608","id":367562925,"node_id":"MDU6SXNzdWUzNjc1NjI5MjU=","number":608,"title":"RunId not found when executing \"mlflow run\" with remote tracking server","user":{"login":"dmarkhas","id":16191105,"node_id":"MDQ6VXNlcjE2MTkxMTA1","avatar_url":"https://avatars.githubusercontent.com/u/16191105?v=4","gravatar_id":"","url":"https://api.github.com/users/dmarkhas","html_url":"https://github.com/dmarkhas","followers_url":"https://api.github.com/users/dmarkhas/followers","following_url":"https://api.github.com/users/dmarkhas/following{/other_user}","gists_url":"https://api.github.com/users/dmarkhas/gists{/gist_id}","starred_url":"https://api.github.com/users/dmarkhas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmarkhas/subscriptions","organizations_url":"https://api.github.com/users/dmarkhas/orgs","repos_url":"https://api.github.com/users/dmarkhas/repos","events_url":"https://api.github.com/users/dmarkhas/events{/privacy}","received_events_url":"https://api.github.com/users/dmarkhas/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":19,"created_at":"2018-10-07T15:03:12Z","updated_at":"2021-12-22T15:57:39Z","closed_at":"2019-07-26T21:55:03Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: \r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\n- **MLflow installed from (source or binary)**: \r\n- **MLflow version (run ``mlflow --version``)**: 0.7.0\r\n- **Python version**: 3.6\r\n- **npm version (if running the dev UI):\r\n- **Exact command to reproduce**:\r\n\r\n### Describe the problem\r\n\r\nI have followed the tutorial and was able to get everything to work, and then added remote tracking to the train.py script so it will log everything to a remote mlflow server. That works well when executing the script directly via python, but when packaging that same script and using `mlflow run` to run it, I am observing errors that indicate mlflow is generating a unique experiment ID and then trying to look it up in the remote tracking server, and fails.\r\n\r\nThe client-side (where `mlflow run` runs) error is:\r\n\r\n> icsl6700> .venv/bin/mlflow run tutorial -P alpha=0.42\r\n> === Created directory /tmp/tmp65fqzyo2 for downloading remote URIs passed to arguments of type 'path' ===\r\n> === Running command 'source activate mlflow-3eee9bd7a0713cf80a17bc0a4d659bc9c549efac && python train.py 0.42 0.1' in run with ID '63e35b4f66164976b27f3d849c0fe72e' === \r\n> API request to http://mlflow-server:5000/api/2.0/preview/mlflow/runs/get failed with code 500 != 200, retrying up to 2 more times. API response body: <!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\">\r\n> <title>500 Internal Server Error</title>\r\n> <h1>Internal Server Error</h1>\r\n> <p>The server encountered an internal error and was unable to complete your request.  Either the server is overloaded or there is an error in the application.</p>\r\n> API request to http://mlflow-server:5000/api/2.0/preview/mlflow/runs/get failed with code 500 != 200, retrying up to 1 more times. API response body: <!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\">\r\n> <title>500 Internal Server Error</title>\r\n> <h1>Internal Server Error</h1>\r\n> <p>The server encountered an internal error and was unable to complete your request.  Either the server is overloaded or there is an error in the application.</p>\r\n> API request to http://mlflow-server:5000/api/2.0/preview/mlflow/runs/get failed with code 500 != 200, retrying up to 0 more times. API response body: <!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\">\r\n> <title>500 Internal Server Error</title>\r\n> <h1>Internal Server Error</h1>\r\n> <p>The server encountered an internal error and was unable to complete your request.  Either the server is overloaded or there is an error in the application.</p>\r\n> Traceback (most recent call last):\r\n>   File \"train.py\", line 40, in <module>\r\n>     with mlflow.start_run():\r\n>   File \"/nfs/site/disks/ibi_tools/workarea/dmarkhas/python/.venv/lib/python3.6/site-packages/mlflow/tracking/fluent.py\", line 105, in start_run\r\n>     active_run_obj = MlflowClient().get_run(existing_run_uuid)\r\n>   File \"/nfs/site/disks/ibi_tools/workarea/dmarkhas/python/.venv/lib/python3.6/site-packages/mlflow/tracking/client.py\", line 37, in get_run\r\n>     return self.store.get_run(run_id)\r\n>   File \"/nfs/site/disks/ibi_tools/workarea/dmarkhas/python/.venv/lib/python3.6/site-packages/mlflow/store/rest_store.py\", line 132, in get_run\r\n>     response_proto = self._call_endpoint(GetRun, req_body)\r\n>   File \"/nfs/site/disks/ibi_tools/workarea/dmarkhas/python/.venv/lib/python3.6/site-packages/mlflow/store/rest_store.py\", line 68, in _call_endpoint\r\n>     json=json_body)\r\n>   File \"/nfs/site/disks/ibi_tools/workarea/dmarkhas/python/.venv/lib/python3.6/site-packages/mlflow/utils/rest_utils.py\", line 53, in http_request\r\n>     (url, retries))\r\n> mlflow.exceptions.MlflowException: API request to http://mlflow-server:5000/api/2.0/preview/mlflow/runs/get failed to return code 200 after 3 tries\r\n> \r\n\r\n\r\nAnd the server-side error is:\r\n\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]: [2018-10-07 17:38:49,690] ERROR in app: Exception on /api/2.0/preview/mlflow/runs/get [GET]\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]: Traceback (most recent call last):\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:   File \"/nfs/site/disks/ibi_tools/workarea/dmarkhas/python/.venv/lib/python3.6/site-packages/flask/app.py\", line 2292, in wsgi_app\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:     response = self.full_dispatch_request()\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:   File \"/nfs/site/disks/ibi_tools/workarea/dmarkhas/python/.venv/lib/python3.6/site-packages/flask/app.py\", line 1815, in full_dispatch_request\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:     rv = self.handle_user_exception(e)\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:   File \"/nfs/site/disks/ibi_tools/workarea/dmarkhas/python/.venv/lib/python3.6/site-packages/flask/app.py\", line 1718, in handle_user_exception\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:     reraise(exc_type, exc_value, tb)\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:   File \"/nfs/site/disks/ibi_tools/workarea/dmarkhas/python/.venv/lib/python3.6/site-packages/flask/_compat.py\", line 35, in reraise\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:     raise value\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:   File \"/nfs/site/disks/ibi_tools/workarea/dmarkhas/python/.venv/lib/python3.6/site-packages/flask/app.py\", line 1813, in full_dispatch_request\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:     rv = self.dispatch_request()\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:   File \"/nfs/site/disks/ibi_tools/workarea/dmarkhas/python/.venv/lib/python3.6/site-packages/flask/app.py\", line 1799, in dispatch_request\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:     return self.view_functions[rule.endpoint](**req.view_args)\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:   File \"/nfs/site/disks/ibi_tools/workarea/dmarkhas/python/.venv/lib/python3.6/site-packages/mlflow/server/handlers.py\", line 218, in _get_run\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:     response_message.run.MergeFrom(_get_store().get_run(request_message.run_uuid).to_proto())\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:   File \"/nfs/site/disks/ibi_tools/workarea/dmarkhas/python/.venv/lib/python3.6/site-packages/mlflow/store/file_store.py\", line 296, in get_run\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:     run_info = self._get_run_info(run_uuid)\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:   File \"/nfs/site/disks/ibi_tools/workarea/dmarkhas/python/.venv/lib/python3.6/site-packages/mlflow/store/file_store.py\", line 310, in _get_run_info\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]:     raise Exception(\"Run '%s' not found\" % run_uuid)\r\n> Oct 07 17:38:49 icsl6688 mlflow[19938]: Exception: Run '6c72666f96ff4e0fbd7cb2002f074460' not found\r\n\r\nSince mlflow run sets a random runid in the environment, mlflow picks it up and tries to look it up in the tracking server - and fails.\r\nPerhaps I am missing something about the correct use-case of `mlflow run` but assuming packaged code can contain a remote tracking URI, won't it always cause it to fail when somebody else tries to run that packaged code with `mlflow run`?","closed_by":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/608/reactions","total_count":3,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/608/timeline","performed_via_github_app":null,"state_reason":"completed"}