{"url":"https://api.github.com/repos/mlflow/mlflow/issues/7019","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/7019/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/7019/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/7019/events","html_url":"https://github.com/mlflow/mlflow/issues/7019","id":1405182180,"node_id":"I_kwDOCB5Jx85TwWDk","number":7019,"title":"[FR] Allow signing all outgoing request using AWS Sig V4","user":{"login":"pdifranc","id":17848490,"node_id":"MDQ6VXNlcjE3ODQ4NDkw","avatar_url":"https://avatars.githubusercontent.com/u/17848490?v=4","gravatar_id":"","url":"https://api.github.com/users/pdifranc","html_url":"https://github.com/pdifranc","followers_url":"https://api.github.com/users/pdifranc/followers","following_url":"https://api.github.com/users/pdifranc/following{/other_user}","gists_url":"https://api.github.com/users/pdifranc/gists{/gist_id}","starred_url":"https://api.github.com/users/pdifranc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pdifranc/subscriptions","organizations_url":"https://api.github.com/users/pdifranc/orgs","repos_url":"https://api.github.com/users/pdifranc/repos","events_url":"https://api.github.com/users/pdifranc/events{/privacy}","received_events_url":"https://api.github.com/users/pdifranc/received_events","type":"User","site_admin":false},"labels":[{"id":955449434,"node_id":"MDU6TGFiZWw5NTU0NDk0MzQ=","url":"https://api.github.com/repos/mlflow/mlflow/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"},{"id":2022849295,"node_id":"MDU6TGFiZWwyMDIyODQ5Mjk1","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/tracking","name":"area/tracking","color":"48eabc","default":false,"description":"Tracking service, tracking client APIs, autologging"},{"id":4300304016,"node_id":"LA_kwDOCB5Jx88AAAABAFFukA","url":"https://api.github.com/repos/mlflow/mlflow/labels/has-closing-pr","name":"has-closing-pr","color":"fef2c0","default":false,"description":"This issue has a closing PR"}],"state":"closed","locked":false,"assignee":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"assignees":[{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2022-10-11T20:22:17Z","updated_at":"2022-10-18T21:03:44Z","closed_at":"2022-10-18T21:03:44Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### Willingness to contribute\r\n\r\nYes. I can contribute this feature independently.\r\n\r\n### Proposal Summary\r\n\r\nAdd possibility to sign request using [AWS SigV4](https://docs.aws.amazon.com/general/latest/gr/signature-version-4.html).\r\n\r\nThis would allow to implement authentication / authorization via shielding the `<MLFLOW_TRACKING_URI>/api` route with an Amazon API Gateway which implements IAM Authorizers. By doing so, you can either:\r\n* use your AWS access key and secret key to sign the request\r\n* (prefferred) use the instance role (if for example running on an EC2 instance, or on the sagemaker maanged infrastructure) and use the `boto3` session, thus temporary credentials automatically handled by AWS.\r\n\r\n### Motivation\r\n\r\n> #### What is the use case for this feature?\r\n\r\nAuthentication / Authorization handled with IAM policies when shielding MLflow with an API Gateway\r\n\r\n> #### Why is this use case valuable to support for MLflow users in general?\r\n\r\nMore flexibility to handle authentication / authorization.\r\n\r\n> #### Why is this use case valuable to support for your project(s) or organization?\r\n\r\nWe want to have a fine grained control over who can do what via the APIs\r\n\r\n> #### Why is it currently difficult to achieve this use case?\r\n\r\nWe have been using an nginx reverse proxy with basic auth, but this approach has some limitation, e.g. credential sharing, anyone with the credentials is essentially admin. A plugin is not really possible because to compute all headers for the signature, I need to have the URL that is being requested, which is not available when using the provided plugin like the [one provided](https://github.com/mlflow/mlflow/blob/95793b30c05ebf506b62c0112249b67d0276b2c5/mlflow/tracking/request_header/abstract_request_header_provider.py#L4) to add headers to every outgoing request (unfortunately)\r\n\r\n### Details\r\n\r\nI have actually implemented this already as part of a bigger sample I wrote to run MLFlow on AWS, which also includes changes to the MLFlow UI to use Amazon Cognito to authenticate. For this specific use case, I am proposing to add a new env variable, e.g. `MLFLOW_TRACKING_AWS_SIGV4` in the similar way `MLFLOW_TRACKING_USERNAME`, `MLFLOW_TRACKING_PASSWORD`, and `MLFLOW_TRACKING_TOKEN` have been implemented.\r\n Details of the whole architecture and how this fits can be found [here](https://github.com/pdifranc/sagemaker-studio-mlflow-integration#architecture).\r\n\r\nThe changes for this pull request can be found [here](https://github.com/pdifranc/mlflow/commit/2d01bd0d9c638cfb49bb05e916e992f82bc38215)\r\n\r\nFor the MLFlow UI I would open a different feature request to keep it simpler\r\n\r\n### What component(s) does this bug affect?\r\n\r\n- [ ] `area/artifacts`: Artifact stores and artifact logging\r\n- [ ] `area/build`: Build and test infrastructure for MLflow\r\n- [ ] `area/docs`: MLflow documentation pages\r\n- [ ] `area/examples`: Example code\r\n- [ ] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\r\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\r\n- [ ] `area/pipelines`: Pipelines, Pipeline APIs, Pipeline configs, Pipeline Templates\r\n- [ ] `area/projects`: MLproject format, project running backends\r\n- [ ] `area/scoring`: MLflow Model server, model deployment tools, Spark UDFs\r\n- [ ] `area/server-infra`: MLflow Tracking server backend\r\n- [X] `area/tracking`: Tracking Service, tracking client APIs, autologging\r\n\r\n### What interface(s) does this bug affect?\r\n\r\n- [ ] `area/uiux`: Front-end, user experience, plotting, JavaScript, JavaScript dev server\r\n- [ ] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\r\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\r\n- [ ] `area/windows`: Windows support\r\n\r\n### What language(s) does this bug affect?\r\n\r\n- [ ] `language/r`: R APIs and clients\r\n- [ ] `language/java`: Java APIs and clients\r\n- [ ] `language/new`: Proposals for new client languages\r\n\r\n### What integration(s) does this bug affect?\r\n\r\n- [ ] `integrations/azure`: Azure and Azure ML integrations\r\n- [ ] `integrations/sagemaker`: SageMaker integrations\r\n- [ ] `integrations/databricks`: Databricks integrations","closed_by":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/7019/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/7019/timeline","performed_via_github_app":null,"state_reason":"completed"}