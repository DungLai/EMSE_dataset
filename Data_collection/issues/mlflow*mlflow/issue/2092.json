{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2092","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2092/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2092/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2092/events","html_url":"https://github.com/mlflow/mlflow/issues/2092","id":522532118,"node_id":"MDU6SXNzdWU1MjI1MzIxMTg=","number":2092,"title":"[FR] save_model() support for remote paths","user":{"login":"TheTravellingSalesman","id":36421850,"node_id":"MDQ6VXNlcjM2NDIxODUw","avatar_url":"https://avatars.githubusercontent.com/u/36421850?v=4","gravatar_id":"","url":"https://api.github.com/users/TheTravellingSalesman","html_url":"https://github.com/TheTravellingSalesman","followers_url":"https://api.github.com/users/TheTravellingSalesman/followers","following_url":"https://api.github.com/users/TheTravellingSalesman/following{/other_user}","gists_url":"https://api.github.com/users/TheTravellingSalesman/gists{/gist_id}","starred_url":"https://api.github.com/users/TheTravellingSalesman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TheTravellingSalesman/subscriptions","organizations_url":"https://api.github.com/users/TheTravellingSalesman/orgs","repos_url":"https://api.github.com/users/TheTravellingSalesman/repos","events_url":"https://api.github.com/users/TheTravellingSalesman/events{/privacy}","received_events_url":"https://api.github.com/users/TheTravellingSalesman/received_events","type":"User","site_admin":false},"labels":[{"id":955449434,"node_id":"MDU6TGFiZWw5NTU0NDk0MzQ=","url":"https://api.github.com/repos/mlflow/mlflow/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"},{"id":2022845866,"node_id":"MDU6TGFiZWwyMDIyODQ1ODY2","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/artifacts","name":"area/artifacts","color":"48eabc","default":false,"description":"Artifact stores and artifact logging"},{"id":2022866026,"node_id":"MDU6TGFiZWwyMDIyODY2MDI2","url":"https://api.github.com/repos/mlflow/mlflow/labels/priority/backlog","name":"priority/backlog","color":"534cb5","default":false,"description":"We believe it is useful, but donâ€™t see it being prioritized in the next few months."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-11-13T23:27:36Z","updated_at":"2022-06-02T01:18:36Z","closed_at":"2022-06-02T01:18:36Z","author_association":"NONE","active_lock_reason":null,"body":"Thank you for submitting an issue. Please refer to our [issue policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md)\r\nfor information on what types of issues we address.\r\n\r\nPlease fill in this template and do not delete it unless you are sure your issue is outside its scope.\r\n\r\n-------\r\n## Guidelines\r\n\r\nFeature requests typically go through the following lifecycle:\r\n\r\n1. Submit feature request with high-level description on GitHub issues (this is what you're doing now)\r\n2. Discuss feature request with a committer, who may ask for a more detailed design\r\n3. After discussion & agreement on feature request, start implementation\r\n\r\n\r\n## Describe the proposal\r\nProvide a clear high-level description of the feature request in the following sections. Feature requests that are likely to be accepted:\r\n* Are minimal in scope (note that it's always easier to add additional functionality later than remove functionality)\r\n* Are extensible (e.g. if adding an integration with an ML framework, is it possible to add similar integrations with other frameworks?)\r\n* Have user impact & value that justifies the maintenance burden of supporting the feature moving forwards. The [JQuery contributor guide](https://contribute.jquery.org/open-source/#contributing-something-new) has an excellent discussion on this.\r\n\r\n### Motivation\r\nWhat is the use case in mind?  Why is it valuable to support, and why is it currently difficult or impossible to achieve? Could the desired functionality alternatively be implemented as a third-party package using MLflow public APIs?\r\n\r\n- The goal of this feature request is to provide a way to directly save models to remote paths using the MLflow API. Per my understanding, there is no existing workflow for this. The workaround I've used is to use `mlflow.<flavor>.save_model(model, temp_local_path)` to write it to a local file, then copy it out to the remote path. This method, while effective, is somewhat cumbersome, and does not generalize well between file systems like `mlflow.<flavor>.load_model()` does (`load_model()` does support remote file systems).\r\n\r\n- It appears that there is support for remote paths built into `mlflow.<flavor>.log_model()`, but there does not seem to be any way to save a MLflow artifact to a remote path without having a running tracking server (or at least it hasn't worked for me; happy to provide further details if it helps).\r\n\r\n### Proposed Changes\r\nFor user-facing changes, what APIs are you proposing to add or modify? For internal changes, what code paths will need to be modified?\r\n\r\n- I have a working implementation of this which leverages a decorator which provides `mlflow.<flavor>.save_model()` with access to a file-system-agnostic file path. The decorator function uses `fsspec`, so that it can generalize between `gcsfs`, `s3`, local paths, etc (happy to utilize another library if you don't want to add dependencies, although `gcsfs`' API is much smoother than the official GCS API). The workflow is roughly as follows:\r\n\r\n1. The decorator determines the file system. If it is remote it runs `mlflow.<flavor>.save_model()` with a temporary local path, and if not it runs it with the original local path.\r\n2. At the end of `mlflow.<flavor>.save_model()`, if the original path is a remote path, it uses the appropriate file system protocol to `put()` the MLflow artifact into the remote path. \r\n\r\n- In either case, the function behaves as expected, but is now able to directly write out to remote paths. The API remains unchanged, and it shouldn't break any existing functionality, or cause unusual behavior in existing codebases. \r\n\r\n\r\n\r\nI'm mainly interested in finding out if your team would be interested in supporting this sort of functionality. If so, I can get started on a pull request. If you have any comments, concerns, or suggestions, I would be happy to implement them. ","closed_by":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2092/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2092/timeline","performed_via_github_app":null,"state_reason":"completed"}