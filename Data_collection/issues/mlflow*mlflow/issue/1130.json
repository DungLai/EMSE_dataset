{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1130","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/1130/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/1130/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/1130/events","html_url":"https://github.com/mlflow/mlflow/issues/1130","id":433661351,"node_id":"MDU6SXNzdWU0MzM2NjEzNTE=","number":1130,"title":"Previous environment is activated when --no-conda is NOT specified","user":{"login":"juhanishen","id":8583850,"node_id":"MDQ6VXNlcjg1ODM4NTA=","avatar_url":"https://avatars.githubusercontent.com/u/8583850?v=4","gravatar_id":"","url":"https://api.github.com/users/juhanishen","html_url":"https://github.com/juhanishen","followers_url":"https://api.github.com/users/juhanishen/followers","following_url":"https://api.github.com/users/juhanishen/following{/other_user}","gists_url":"https://api.github.com/users/juhanishen/gists{/gist_id}","starred_url":"https://api.github.com/users/juhanishen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juhanishen/subscriptions","organizations_url":"https://api.github.com/users/juhanishen/orgs","repos_url":"https://api.github.com/users/juhanishen/repos","events_url":"https://api.github.com/users/juhanishen/events{/privacy}","received_events_url":"https://api.github.com/users/juhanishen/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-04-16T08:57:04Z","updated_at":"2019-07-26T21:25:26Z","closed_at":"2019-07-26T21:25:26Z","author_association":"NONE","active_lock_reason":null,"body":"### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: No.\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: CentOS 7.4\r\n- **MLflow installed from (source or binary)**:  pip install mlflow\r\n- **MLflow version (run ``mlflow --version``)**: 0.9.0\r\n- **Python version**:  3.7.3\r\n- **npm version (if running the dev UI):\r\n- **Exact command to reproduce**: mlflow run xxxxx with or without parameter --no-conda\r\n\r\n### Describe the problem\r\nDescribe the problem clearly here. Be sure to convey here why it's a bug in MLflow or a feature request.\r\n\r\nI am using centOS 7.4 and installed Anaconda3, MLFlow.\r\n    Here is my /home/k8s/mlruns/0 list and /home/k8s/envs list,\r\n\r\n```\r\n        +  run id folder list, ls -alt /home/k8s/mlruns/0/\r\n        (base) [k8s@k8s 0]$ ls -alt\r\n        drwxrwxr-x  6 k8s k8s   81 April  16 10:51 9853c9380dc94e508bb90d77821d97ee\r\n        drwxrwxr-x 26 k8s k8s 4096 April  16 10:51 .\r\n        drwxrwxr-x  6 k8s k8s   81 April  16 10:51 8a6acfc9189443cabce48776d93aa867\r\n        drwxrwxr-x  6 k8s k8s   81 April  16 10:45 eedb5419170f49e982152195b8fbe27a\r\n        drwxrwxr-x  6 k8s k8s   81 April  16 10:37 5413dfae66ae4e868f572cfad7d05313\r\n        drwxrwxr-x  6 k8s k8s   81 April  16 10:35 f7c8c3fc5cc54727b947b71ce4aed5c1\r\n        drwxrwxr-x  6 k8s k8s   81 April  16 10:31 af26a5a23ec74745b34ad3b30e588864\r\n        drwxrwxr-x  6 k8s k8s   81 April  16 10:07 005e9b060a934747a1b7aa08e7550bd6\r\n        drwxrwxr-x  6 k8s k8s   81 April  16 10:06 a75f629a67ce4dfc999cb82dce183c5b\r\n        drwxrwxr-x  6 k8s k8s   81 April  16 10:04 da939c5ab5544a69aca9e3647cc8aff7\r\n        drwxrwxr-x  6 k8s k8s   81 April  15 13:59 12e5ed013a5c4351b1afc9d7c83a6ee2\r\n        drwxrwxr-x  6 k8s k8s   81 April  15 13:32 d6e7ee6867874944a861f8dd16bcebbe\r\n        drwxrwxr-x  6 k8s k8s   81 April  15 13:18 fa111007033c482a9d40b43902a123a1\r\n        drwxrwxr-x  6 k8s k8s   81 April  12 16:46 7dcbafb34e484fe18b4a5e934815a892\r\n        drwxrwxr-x  6 k8s k8s   81 April  12 16:30 57df4911c45048248e6247d5d356179b\r\n        drwxrwxr-x  6 k8s k8s   81 April  12 15:19 284f48cfe80a48e5b48868a1647717d2\r\n        drwxrwxr-x  6 k8s k8s   81 April  12 14:55 a14180c8c0b14caabf9272e89893469f\r\n        drwxrwxr-x  6 k8s k8s   81 April  12 14:19 29c6f03c6e144590962bad736b69e222\r\n        drwxrwxr-x  6 k8s k8s   81 April  12 14:17 0e5827774fff4a6086031e0d9d1475ff\r\n        drwxrwxr-x  6 k8s k8s   81 April  12 14:14 2bb707a2507046648a0c9067e65e0def\r\n        drwxrwxr-x  6 k8s k8s   81 April  12 14:03 84b9d344dc18452f81302e26aaf805d0\r\n        drwxrwxr-x  6 k8s k8s   81 April  12 13:47 9e92463f17304dc5b3417750a94b1a3d\r\n        drwxrwxr-x  6 k8s k8s   81 April  12 13:27 1db0dc435b23442a859007631870c44f\r\n        drwxrwxr-x  6 k8s k8s   81 April  12 11:42 84e96c64e7c644e480f00f63322c85c7\r\n        drwxrwxr-x  6 k8s k8s   81 April  12 11:34 41188fc00aa74d4ea63460aa4c5cf59a\r\n        drwxrwxr-x  4 k8s k8s   29 April  12 10:13 ..\r\n        -rw-rw-r--  1 k8s k8s   93 April  12 10:13 meta.yaml\r\n```\r\n        + ls -alt /home/k8s/anaconda3/envs/\r\n        \r\n```\r\n        (base) [k8s@k8s envs]$ ls -alt\r\n        drwxrwxr-x 10 k8s k8s  143 April  16 10:12 mlflow-1c292d1b046bb633f6b5948ad7864466d3f46bd9\r\n        drwxrwxr-x 11 k8s k8s 4096 April  16 10:12 .\r\n        drwxrwxr-x  3 k8s k8s   24 April  15 14:24 myenv1\r\n        drwxrwxr-x 10 k8s k8s  143 April  12 14:41 mlflow-c19934350e380c130cd3cfba6f892016407835b8\r\n        drwxrwxr-x 11 k8s k8s  154 April  12 14:20 mlflow-3a1b65b85b85e9f8cf8723ef71df02cfdd114732\r\n        drwxrwxr-x 11 k8s k8s  154 April  12 13:48 mlflow-c69e7aa9344a1fde24a09e3134f2897e5706dae4\r\n        drwxrwxr-x 10 k8s k8s  143 April  12 09:56 mlflow-9870915dc521392821312638616a04e73d8870ad\r\n        drwxrwxr-x 10 k8s k8s  143 April  11 16:27 mlflow-04a1fc5f17437e38460c3e16a17c13d933afee55\r\n        drwxrwxr-x 11 k8s k8s  154 April  10 15:29 mlflow-b93852916f9be8ee2359db52b5dfab5589743459\r\n        drwxrwxr-x 10 k8s k8s  143 April   9 16:27 snowflakes\r\n        -rw-rw-r--  1 k8s k8s    0 April   9 16:26 .conda_envs_dir_test\r\n        drwxrwxr-x 26 k8s k8s 4096 April   9 15:00 ..\r\n```\r\n\r\n + when I do mlflow run without --no-conda parameter, the command and result is shown as follows:\r\n\r\n```\r\n     (myenv1) [k8s@k8s ~]$ mlflow run mlflow/mlflow/examples/sklearn_elasticnet_wine/ -P alpha=0.0234 -P l1_ratio=0.0234\r\n```\r\n```\r\n     /usr/local/python3Dir/lib/python3.7/site-packages/mlflow/utils/environment.py:26: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please read https://msg.pyyaml.org/load for full details.\r\n           env = yaml.load(_conda_header)\r\n     2019/04/16 14:31:10 INFO mlflow.projects: === Created directory /tmp/tmpfamjleze for downloading remote URIs passed to arguments of type 'path' ===\r\n     2019/04/16 14:31:10 INFO mlflow.projects: === Running command 'source activate mlflow-3a1b65b85b85e9f8cf8723ef71df02cfdd114732 && python train.py 0.0234 0.0234' in run with ID 'c0940cce3f9442c58cd00492f44057a5' ===\r\n     bash: activate: no this file or directory\r\n     2019/04/16 14:31:10 ERROR mlflow.cli: === Run (ID 'c0940cce3f9442c58cd00492f44057a5') failed ===\r\n```\r\n +  mlflow tried to locate a previous environment(see April 12 14:20 above): 3a1b65b85b85e9f8cf8723ef71df02cfdd114732, why could it not compile and run in the environment I activated, in this case is myenv1?\r\n\r\n +  when I check myenv1 directory, it shows as follows: there is only conda-meta directory.\r\n\r\n```\r\n     (myenv1) [k8s@k8s ~]$ ls -alt anaconda3/envs/myenv1/\r\n     drwxrwxr-x 11 k8s k8s 4096 4月  16 10:12 ..\r\n     drwxrwxr-x  2 k8s k8s   21 4月  15 14:24 conda-meta\r\n     drwxrwxr-x  3 k8s k8s   24 4月  15 14:24 .        \r\n```\r\n +  when I do mlflow run with --no-conda, the result is successful. Why is there difference with/without --no-conda? what is the mechanism behind it? If parameter --no-conda is not specified, which rule would mlflow follow to activate an previous environment?\r\n\r\n```\r\n     (myenv1) [k8s@k8s ~]$ mlflow run mlflow/mlflow/examples/sklearn_elasticnet_wine/ -P alpha=0.0234 -P l1_ratio=0.0234 --no-conda\r\n```\r\n```\r\n    /usr/local/python3Dir/lib/python3.7/site-packages/mlflow/utils/environment.py:26: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please read https://msg.pyyaml.org/load for full details.\r\n         env = yaml.load(_conda_header)\r\n     2019/04/16 14:35:00 INFO mlflow.projects: === Created directory /tmp/tmpkta2czuj for downloading remote URIs passed to arguments of type 'path' ===\r\n     2019/04/16 14:35:00 INFO mlflow.projects: === Running command 'python train.py 0.0234 0.0234' in run with ID '4acd4205f3ec407f9c1dd84f4bfe89e5' ===\r\n     /usr/local/python3Dir/lib/python3.7/site-packages/mlflow/utils/environment.py:26: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please read https://msg.pyyaml.org/load for full details.\r\n       env = yaml.load(_conda_header)\r\n     Elasticnet model (alpha=0.023400, l1_ratio=0.023400):\r\n       RMSE: 0.7659655325696515\r\n       MAE: 0.5982667311191122\r\n       R2: 0.2422283956658633\r\n     2019/04/16 14:35:02 INFO mlflow.projects: === Run (ID \r\n 4acd4205f3ec407f9c1dd84f4bfe89e5') succeeded ===\r\n\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n### Source code / logs\r\nInclude any logs or source code that would be helpful to diagnose the problem. If including tracebacks,\r\nplease include the full traceback. Large logs and files should be attached.\r\nTry to provide a reproducible test case that is the bare minimum necessary to generate the problem.\r\n","closed_by":{"login":"aarondav","id":1400247,"node_id":"MDQ6VXNlcjE0MDAyNDc=","avatar_url":"https://avatars.githubusercontent.com/u/1400247?v=4","gravatar_id":"","url":"https://api.github.com/users/aarondav","html_url":"https://github.com/aarondav","followers_url":"https://api.github.com/users/aarondav/followers","following_url":"https://api.github.com/users/aarondav/following{/other_user}","gists_url":"https://api.github.com/users/aarondav/gists{/gist_id}","starred_url":"https://api.github.com/users/aarondav/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aarondav/subscriptions","organizations_url":"https://api.github.com/users/aarondav/orgs","repos_url":"https://api.github.com/users/aarondav/repos","events_url":"https://api.github.com/users/aarondav/events{/privacy}","received_events_url":"https://api.github.com/users/aarondav/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1130/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/1130/timeline","performed_via_github_app":null,"state_reason":"completed"}