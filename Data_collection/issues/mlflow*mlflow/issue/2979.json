{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2979","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2979/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2979/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2979/events","html_url":"https://github.com/mlflow/mlflow/issues/2979","id":642529381,"node_id":"MDU6SXNzdWU2NDI1MjkzODE=","number":2979,"title":"[BUG] mlflow version is not fixed in default conda env","user":{"login":"eavidan","id":14073228,"node_id":"MDQ6VXNlcjE0MDczMjI4","avatar_url":"https://avatars.githubusercontent.com/u/14073228?v=4","gravatar_id":"","url":"https://api.github.com/users/eavidan","html_url":"https://github.com/eavidan","followers_url":"https://api.github.com/users/eavidan/followers","following_url":"https://api.github.com/users/eavidan/following{/other_user}","gists_url":"https://api.github.com/users/eavidan/gists{/gist_id}","starred_url":"https://api.github.com/users/eavidan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eavidan/subscriptions","organizations_url":"https://api.github.com/users/eavidan/orgs","repos_url":"https://api.github.com/users/eavidan/repos","events_url":"https://api.github.com/users/eavidan/events{/privacy}","received_events_url":"https://api.github.com/users/eavidan/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022848043,"node_id":"MDU6TGFiZWwyMDIyODQ4MDQz","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/models","name":"area/models","color":"48eabc","default":false,"description":"MLmodel format, model serialization/deserialization, flavors"},{"id":2022865338,"node_id":"MDU6TGFiZWwyMDIyODY1MzM4","url":"https://api.github.com/repos/mlflow/mlflow/labels/priority/important-longterm","name":"priority/important-longterm","color":"534cb5","default":false,"description":"Important over the long term, but may not be staffed or may need multiple releases to complete."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-06-21T09:34:34Z","updated_at":"2022-06-03T00:24:08Z","closed_at":"2022-06-03T00:24:07Z","author_association":"NONE","active_lock_reason":null,"body":"### Willingness to contribute\r\nThe MLflow Community encourages bug fix contributions. Would you or another member of your organization be willing to contribute a fix for this bug to the MLflow code base?\r\n\r\n- [x] Yes. I can contribute a fix for this bug independently.\r\n- [x] Yes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\r\n- [ ] No. I cannot contribute a bug fix at this time.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Mac OS 10.15.2\r\n- **MLflow installed from (source or binary)**: binary\r\n- **MLflow version (run ``mlflow --version``)**: 1.5.0\r\n- **Python version**: 3.7\r\n- **npm version, if running the dev UI**:\r\n- **Exact command to reproduce**: mlflow.sklearn.log_model(lr, \"model\")\r\n\r\n### Describe the problem\r\nWhen loging any kind of supported model, `mlflow` is added as a pip dependency to the `conda.yaml`. The issue is that it is added without any fixed version, which results in the conda env having the latest `mlflow` version even if the training environment had an older one.\r\n\r\n### Code to reproduce issue\r\nAny log model function uses `_mlflow_conda_env()` which adds the version less `mlflow` pip dependency.\r\n\r\nhttps://github.com/mlflow/mlflow/blob/10f336a0c86cbabab3089fdfc3943884d2f807ca/mlflow/utils/environment.py#L13-L14\r\n\r\nhttps://github.com/mlflow/mlflow/blob/10f336a0c86cbabab3089fdfc3943884d2f807ca/mlflow/utils/environment.py#L31-L32\r\n\r\nfor instance, the following code\r\n\r\n```python\r\nmlflow.sklearn.log_model(lr, \"model\")\r\n```\r\n\r\nwill results in the following `conda.yaml`\r\n```yaml\r\nchannels:\r\n- defaults\r\ndependencies:\r\n- python=3.6.10\r\n- scikit-learn=0.22.1\r\n- pip:\r\n  - mlflow\r\n  - cloudpickle==1.4.1\r\nname: mlflow-env\r\n```\r\n\r\na simple fix would be to infer `mlflow` version similar to what is done with other dependencies. for instance:\r\n\r\nhttps://github.com/mlflow/mlflow/blob/6e60e79a593fed2ff5a08aa637a79354bee1be0e/mlflow/sklearn.py#L46-L49\r\n\r\n\r\n","closed_by":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2979/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2979/timeline","performed_via_github_app":null,"state_reason":"completed"}