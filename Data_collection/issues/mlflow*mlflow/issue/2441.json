{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2441","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2441/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2441/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2441/events","html_url":"https://github.com/mlflow/mlflow/issues/2441","id":567538634,"node_id":"MDU6SXNzdWU1Njc1Mzg2MzQ=","number":2441,"title":"[BUG] Azure backend crashes with bad error when there is more than 200 metrics","user":{"login":"epa095","id":1576438,"node_id":"MDQ6VXNlcjE1NzY0Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/1576438?v=4","gravatar_id":"","url":"https://api.github.com/users/epa095","html_url":"https://github.com/epa095","followers_url":"https://api.github.com/users/epa095/followers","following_url":"https://api.github.com/users/epa095/following{/other_user}","gists_url":"https://api.github.com/users/epa095/gists{/gist_id}","starred_url":"https://api.github.com/users/epa095/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epa095/subscriptions","organizations_url":"https://api.github.com/users/epa095/orgs","repos_url":"https://api.github.com/users/epa095/repos","events_url":"https://api.github.com/users/epa095/events{/privacy}","received_events_url":"https://api.github.com/users/epa095/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022859639,"node_id":"MDU6TGFiZWwyMDIyODU5NjM5","url":"https://api.github.com/repos/mlflow/mlflow/labels/integrations/azure","name":"integrations/azure","color":"ffbce5","default":false,"description":"Azure and Azure ML integrations"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-02-19T12:33:30Z","updated_at":"2021-07-16T17:19:24Z","closed_at":"2021-07-16T17:19:24Z","author_association":"NONE","active_lock_reason":null,"body":"### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux\r\n- **MLflow installed from (source or binary)**: From pip\r\n- **MLflow version (run ``mlflow --version``)**: mlflow==1.5.0\r\n- **Python version**: 3.7\r\n\r\n### Describe the problem\r\nWe are using the `azureml-mlflow` version `1.0.85 `, and using azure ML workspace as the sever. When we are posting a batch-request with more than 200 metrics ml-flow crashes with a bad error:\r\n\r\n```\r\n  File \"/usr/local/lib/python3.7/site-packages/gordo/reporters/mlflow.py\", line 413, in log_machine\r\n    mlflow_client.log_batch(run_id, **get_batch_kwargs(machine))\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/tracking/client.py\", line 242, in log_batch\r\n    self._tracking_client.log_batch(run_id, metrics, params, tags)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/tracking/_tracking_service/client.py\", line 231, in log_batch\r\n    self.store.log_batch(run_id=run_id, metrics=metrics, params=params, tags=tags)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/store/tracking/rest_store.py\", line 240, in log_batch\r\n    self._call_endpoint(LogBatch, req_body)\r\n  File \"/usr/local/lib/python3.7/site-packages/azureml/mlflow/_internal/store.py\", line 88, in _call_endpoint\r\n    return super(AzureMLRestStore, self)._call_endpoint(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/store/tracking/rest_store.py\", line 32, in _call_endpoint\r\n    return call_endpoint(self.get_host_creds(), endpoint, method, json_body, response_proto)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/utils/rest_utils.py\", line 137, in call_endpoint\r\n    response = verify_rest_response(response, endpoint)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/utils/rest_utils.py\", line 103, in verify_rest_response\r\n    raise RestException(json.loads(response.text))\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/exceptions.py\", line 62, in __init__\r\n    super(RestException, self).__init__(message, error_code=ErrorCode.Value(error_code))\r\n  File \"/usr/local/lib/python3.7/site-packages/google/protobuf/internal/enum_type_wrapper.py\", line 71, in Value\r\n    self._enum_type.name, name))\r\nValueError: Enum ErrorCode has no value defined for name 1\r\n```\r\nWhen inspecting the request manually we see that it contains this response:\r\n```{'Error': {'Code': 'UserError', 'Message': 'No more than 200 metrics per batch.', 'DetailsUri': None, 'Target': None, 'Details': [], 'InnerError': None, 'DebugInfo': None}, 'Correlation': {'operation': '0db01b139bfe9e43835dc67568e26c69', 'request': 'e7b03bcd644fbf23'}, 'Environment': 'northeurope', 'Location': 'northeurope', 'Time': '2020-02-17T08:07:59.4923142+00:00', 'error_code': 1}```\r\n\r\nThe problem is the error message we get in the stacktrace, which gives no hint about this being the issue. ","closed_by":{"login":"ankit-db","id":52183359,"node_id":"MDQ6VXNlcjUyMTgzMzU5","avatar_url":"https://avatars.githubusercontent.com/u/52183359?v=4","gravatar_id":"","url":"https://api.github.com/users/ankit-db","html_url":"https://github.com/ankit-db","followers_url":"https://api.github.com/users/ankit-db/followers","following_url":"https://api.github.com/users/ankit-db/following{/other_user}","gists_url":"https://api.github.com/users/ankit-db/gists{/gist_id}","starred_url":"https://api.github.com/users/ankit-db/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ankit-db/subscriptions","organizations_url":"https://api.github.com/users/ankit-db/orgs","repos_url":"https://api.github.com/users/ankit-db/repos","events_url":"https://api.github.com/users/ankit-db/events{/privacy}","received_events_url":"https://api.github.com/users/ankit-db/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2441/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2441/timeline","performed_via_github_app":null,"state_reason":"completed"}