{"url":"https://api.github.com/repos/mlflow/mlflow/issues/3935","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/3935/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/3935/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/3935/events","html_url":"https://github.com/mlflow/mlflow/issues/3935","id":777692882,"node_id":"MDU6SXNzdWU3Nzc2OTI4ODI=","number":3935,"title":"[BUG] \"No Artifacts Recorded\" in MLFlow UI while artifacts are listed in S3 and MLFlow is correctly pointed to it","user":{"login":"zoltan-fedor","id":3887295,"node_id":"MDQ6VXNlcjM4ODcyOTU=","avatar_url":"https://avatars.githubusercontent.com/u/3887295?v=4","gravatar_id":"","url":"https://api.github.com/users/zoltan-fedor","html_url":"https://github.com/zoltan-fedor","followers_url":"https://api.github.com/users/zoltan-fedor/followers","following_url":"https://api.github.com/users/zoltan-fedor/following{/other_user}","gists_url":"https://api.github.com/users/zoltan-fedor/gists{/gist_id}","starred_url":"https://api.github.com/users/zoltan-fedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zoltan-fedor/subscriptions","organizations_url":"https://api.github.com/users/zoltan-fedor/orgs","repos_url":"https://api.github.com/users/zoltan-fedor/repos","events_url":"https://api.github.com/users/zoltan-fedor/events{/privacy}","received_events_url":"https://api.github.com/users/zoltan-fedor/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022845866,"node_id":"MDU6TGFiZWwyMDIyODQ1ODY2","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/artifacts","name":"area/artifacts","color":"48eabc","default":false,"description":"Artifact stores and artifact logging"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-01-03T18:34:28Z","updated_at":"2021-01-03T18:50:41Z","closed_at":"2021-01-03T18:45:29Z","author_association":"NONE","active_lock_reason":null,"body":"- [ ] Yes. I can contribute a fix for this bug independently.\r\n- [ ] Yes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\r\n- [ x ] No. I cannot contribute a bug fix at this time.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 18.04\r\n- **MLflow installed from (source or binary)**: binary\r\n- **MLflow version (run ``mlflow --version``)**: 1.13.1\r\n- **Python version**: 3.8.7\r\n- **npm version, if running the dev UI**:\r\n- **Exact command to reproduce**:\r\n\r\n## Upload artifact:\r\n```\r\nfeatures = \"rooms, zipcode, median_price, school_rating, transport\"\r\nwith open(\"features.txt\", 'w') as f:\r\n    f.write(features)\r\nmlflow.log_artifact(\"features.txt\")\r\n```\r\n## Check artifact in S3 (MinIO):\r\nAvailable\r\n\r\n## Check artifact in MLFlow UI - showing error: \"No Artifacts Recorded\"\r\n\r\n### Describe the problem\r\nDescribe the problem clearly here. Include descriptions of the expected behavior and the actual behavior.\r\n\r\nI am running the latest version of MLFlow (1.13.1) on Kubernetes with MySQL backend and MinIO as artifact store.\r\nWhen using `mlflow.log_artifact(\"features.txt\")`, the artifact correctly shows up in MinIO, but the MLFlow UI returns: \"No Artifacts Recorded\"\r\n\r\nMySQL correctly shows the artifact_uri:\r\n```\r\n+----------------------------------+------+-------------+-------------+------------------+---------+----------+---------------+---------------+----------------+-----------------+--------------------------------------------------------------------+---------------+\r\n| run_uuid                         | name | source_type | source_name | entry_point_name | user_id | status   | start_time    | end_time      | source_version | lifecycle_stage | artifact_uri                                                       | experiment_id |\r\n+----------------------------------+------+-------------+-------------+------------------+---------+----------+---------------+---------------+----------------+-----------------+--------------------------------------------------------------------+---------------+\r\n| 4890b350cea4492396a2edf99fee0868 |      | UNKNOWN     |             |                  | xxxxx   | FINISHED | 1609695779081 | 1609695781842 |                | active          | s3://mlflow/artifacts/1/4890b350cea4492396a2edf99fee0868/artifacts |             1 |\r\n```\r\n\r\nArtifact is available under s3://mlflow/artifacts/1/4890b350cea4492396a2edf99fee0868/artifacts in MinIO.\r\n\r\nMLFlow is started with:\r\n`$ mlflow server --host 0.0.0.0 --port 80 --gunicorn-opts '--log-level debug' --backend-store-uri $BACKEND_STORE_URI --default-artifact-root $DEFAULT_ARTIFACT_ROOT`\r\n\r\n`DEFAULT_ARTIFACT_ROOT` is set to `s3://mlflow/artifacts`\r\n\r\n`MLFLOW_S3_ENDPOINT_URL` is set to `http://minio-service.kubeflow.svc.cluster.local:9000`\r\n\r\nMLFlow UI correctly shows experiment artifact location as : `Artifact Locations3://mlflow/artifacts/1`\r\n\r\nMLFlow server can access the MinIO service:\r\n```\r\nroot@mlflow-778bf7bccb-w2bnt:/# telnet minio-service.kubeflow.svc.cluster.local 9000\r\nTrying 172.20.253.11...\r\nConnected to minio-service.kubeflow.svc.cluster.local.\r\nEscape character is '^]'.\r\n```\r\n\r\nIf `MLFLOW_S3_ENDPOINT_URL` is set to `minio-service.kubeflow.svc.cluster.local:9000`, then error is thrown about not being able to access it.\r\n\r\nDebug logs show NO error, NO warnig:\r\n```\r\n[2021-01-03 18:00:32 +0000] [15] [INFO] Starting gunicorn 20.0.4\r\n[2021-01-03 18:00:32 +0000] [15] [DEBUG] Arbiter booted\r\n[2021-01-03 18:00:32 +0000] [15] [INFO] Listening at: http://0.0.0.0:80 (15)\r\n[2021-01-03 18:00:32 +0000] [15] [INFO] Using worker: sync\r\n[2021-01-03 18:00:32 +0000] [17] [INFO] Booting worker with pid: 17\r\n[2021-01-03 18:00:32 +0000] [25] [INFO] Booting worker with pid: 25\r\n[2021-01-03 18:00:32 +0000] [26] [INFO] Booting worker with pid: 26\r\n[2021-01-03 18:00:32 +0000] [27] [INFO] Booting worker with pid: 27\r\n[2021-01-03 18:00:32 +0000] [15] [DEBUG] 4 workers\r\n[2021-01-03 18:00:35 +0000] [27] [DEBUG] GET /\r\n[2021-01-03 18:00:42 +0000] [17] [DEBUG] GET /\r\n[2021-01-03 18:00:45 +0000] [17] [DEBUG] GET /\r\n[2021-01-03 18:00:52 +0000] [25] [DEBUG] GET /\r\n[2021-01-03 18:00:55 +0000] [27] [DEBUG] GET /\r\n[2021-01-03 18:01:02 +0000] [17] [DEBUG] GET /\r\n[2021-01-03 18:01:05 +0000] [27] [DEBUG] GET /\r\n[2021-01-03 18:01:12 +0000] [25] [DEBUG] GET /\r\n[2021-01-03 18:01:15 +0000] [27] [DEBUG] GET /\r\n[2021-01-03 18:01:20 +0000] [26] [DEBUG] GET /\r\n[2021-01-03 18:01:21 +0000] [17] [DEBUG] GET /ajax-api/2.0/preview/mlflow/runs/get\r\n[2021-01-03 18:01:21 +0000] [26] [DEBUG] GET /ajax-api/2.0/preview/mlflow/experiments/get\r\n[2021-01-03 18:01:21 +0000] [25] [DEBUG] GET /static-files/favicon.ico\r\n[2021-01-03 18:01:21 +0000] [27] [DEBUG] GET /ajax-api/2.0/preview/mlflow/model-versions/search\r\n[2021-01-03 18:01:22 +0000] [27] [DEBUG] GET /ajax-api/2.0/preview/mlflow/artifacts/list\r\n[2021-01-03 18:01:22 +0000] [17] [DEBUG] GET /\r\n```\r\n\r\n### Code to reproduce issue\r\nProvide a reproducible test case that is the bare minimum necessary to generate the problem.\r\n\r\nSetup an MLFlow 1.13.1 server with MinIO artifact storage and then:\r\n```\r\nfeatures = \"rooms, zipcode, median_price, school_rating, transport\"\r\nwith open(\"features.txt\", 'w') as f:\r\n    f.write(features)\r\nmlflow.log_artifact(\"features.txt\")\r\n```\r\n\r\n### Other info / logs\r\nInclude any logs or source code that would be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached.\r\n\r\n\r\n### What component(s), interfaces, languages, and integrations does this bug affect?\r\nComponents \r\n- [ x ] `area/artifacts`: Artifact stores and artifact logging\r\n- [ ] `area/build`: Build and test infrastructure for MLflow\r\n- [ ] `area/docs`: MLflow documentation pages\r\n- [ ] `area/examples`: Example code\r\n- [ ] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\r\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\r\n- [ ] `area/projects`: MLproject format, project running backends\r\n- [ ] `area/scoring`: Local serving, model deployment tools, spark UDFs\r\n- [ ] `area/server-infra`: MLflow server, JavaScript dev server\r\n- [ ] `area/tracking`: Tracking Service, tracking client APIs, autologging\r\n\r\nInterface \r\n- [ ] `area/uiux`: Front-end, user experience, JavaScript, plotting\r\n- [ ] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\r\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\r\n- [ ] `area/windows`: Windows support\r\n\r\nLanguage \r\n- [ ] `language/r`: R APIs and clients\r\n- [ ] `language/java`: Java APIs and clients\r\n- [ ] `language/new`: Proposals for new client languages\r\n\r\nIntegrations\r\n- [ ] `integrations/azure`: Azure and Azure ML integrations\r\n- [ ] `integrations/sagemaker`: SageMaker integrations\r\n- [ ] `integrations/databricks`: Databricks integrations\r\n","closed_by":{"login":"zoltan-fedor","id":3887295,"node_id":"MDQ6VXNlcjM4ODcyOTU=","avatar_url":"https://avatars.githubusercontent.com/u/3887295?v=4","gravatar_id":"","url":"https://api.github.com/users/zoltan-fedor","html_url":"https://github.com/zoltan-fedor","followers_url":"https://api.github.com/users/zoltan-fedor/followers","following_url":"https://api.github.com/users/zoltan-fedor/following{/other_user}","gists_url":"https://api.github.com/users/zoltan-fedor/gists{/gist_id}","starred_url":"https://api.github.com/users/zoltan-fedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zoltan-fedor/subscriptions","organizations_url":"https://api.github.com/users/zoltan-fedor/orgs","repos_url":"https://api.github.com/users/zoltan-fedor/repos","events_url":"https://api.github.com/users/zoltan-fedor/events{/privacy}","received_events_url":"https://api.github.com/users/zoltan-fedor/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/3935/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/3935/timeline","performed_via_github_app":null,"state_reason":"completed"}