{"url":"https://api.github.com/repos/mlflow/mlflow/issues/6532","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/6532/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/6532/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/6532/events","html_url":"https://github.com/mlflow/mlflow/issues/6532","id":1345868131,"node_id":"I_kwDOCB5Jx85QOFFj","number":6532,"title":"[FR] create new cli command for generating dockerfile","user":{"login":"anuarkaliyev23","id":25451733,"node_id":"MDQ6VXNlcjI1NDUxNzMz","avatar_url":"https://avatars.githubusercontent.com/u/25451733?v=4","gravatar_id":"","url":"https://api.github.com/users/anuarkaliyev23","html_url":"https://github.com/anuarkaliyev23","followers_url":"https://api.github.com/users/anuarkaliyev23/followers","following_url":"https://api.github.com/users/anuarkaliyev23/following{/other_user}","gists_url":"https://api.github.com/users/anuarkaliyev23/gists{/gist_id}","starred_url":"https://api.github.com/users/anuarkaliyev23/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anuarkaliyev23/subscriptions","organizations_url":"https://api.github.com/users/anuarkaliyev23/orgs","repos_url":"https://api.github.com/users/anuarkaliyev23/repos","events_url":"https://api.github.com/users/anuarkaliyev23/events{/privacy}","received_events_url":"https://api.github.com/users/anuarkaliyev23/received_events","type":"User","site_admin":false},"labels":[{"id":955449434,"node_id":"MDU6TGFiZWw5NTU0NDk0MzQ=","url":"https://api.github.com/repos/mlflow/mlflow/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"},{"id":2022851725,"node_id":"MDU6TGFiZWwyMDIyODUxNzI1","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/docker","name":"area/docker","color":"ede978","default":false,"description":"Docker use anywhere, such as MLprojects and MLmodels"},{"id":2042304474,"node_id":"MDU6TGFiZWwyMDQyMzA0NDc0","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/build","name":"area/build","color":"48eabc","default":false,"description":"Build and test infrastructure for MLflow"},{"id":4300304016,"node_id":"LA_kwDOCB5Jx88AAAABAFFukA","url":"https://api.github.com/repos/mlflow/mlflow/labels/has-closing-pr","name":"has-closing-pr","color":"fef2c0","default":false,"description":"This issue has a closing PR"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2022-08-22T06:09:26Z","updated_at":"2022-09-13T06:20:24Z","closed_at":"2022-09-13T06:20:24Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### Willingness to contribute\r\n\r\nYes. I would be willing to contribute this feature with guidance from the MLflow community.\r\n\r\n### Proposal Summary\r\n\r\nWe have ability to create an docker image for ml model, stored and tracked in mlflow with command\r\n`mlflow models build-docker <...> ` \r\nThis command has several arguments\\flags that can be specified, full list of which can be found in the [documentation](https://mlflow.org/docs/latest/cli.html#mlflow-models-build-docker) \r\n\r\nHowever, I find this approach rather opinionated in regard of building docker image. I find it more flexible to be able to extract said dockerfile and build this image using standard docker tools.\r\n\r\nI propose a solution to overcome those difficulties without affecting any currently available functionality: **new cli command to generate `dockerfile` only**, which can be manipulated afterwards\r\n\r\n\r\n### Motivation\r\n\r\n> #### What is the use case for this feature?\r\n\r\nFor example, it can be useful in several scenarios:\r\n\r\n- Building docker image on a remote host, even allowing us to use some tools like `buildx` to do so  (oftentimes useful with ci/cd pipelines)\r\n- Changing resulting dockerfile, changing base image (useful when dealing with troublesome installments that have docker image of themselves, such as CUDA)\r\n- Setting up cache policies for apt packages (keeping in mind considerate image size, it can be pretty useful coupled with remote host docker build)\r\n\r\n> #### Why is this use case valuable to support for MLflow users in general?\r\n\r\nMost of the scenarios are the ones, we are experiencing currently, introducing mlflow to our ml development, so I do believe they are applicable to the variety of users.\r\n\r\nI believe, this approach will ease many processes related to integrating mlflow models or mlflow itself in ci/cd pipelines/cycles.\r\n\r\n> #### Why is this use case valuable to support for your project(s) or organization?\r\n\r\nWe, at our organization restructuring our approaches regarding development of ML services. We find mlflow of great value regarding this process. It allows us to concentrate on ML model for ML team and on domain features for product teams, since it can automate \"wrapping\" our ml model in RESTful service. However we struggle sometimes with our currently existing ci/cd pipelines which were created with mindset of somewhat total control over things like dockerfile, which we must overcome sometimes, since it's easier for us to adapt to existing pipelines rather than changing ci/cd approaches we have\r\n\r\n> #### Why is it currently difficult to achieve this use case?\r\n\r\nSince mlflow calls docker implicitly it is difficult to pass arguments (such as `-H` for remote build). Python is not a primary language for my organization so it would be very troublesome to fork mlflow, since we coudn't possibly provide adequate support for it.\r\nWe've found some ways around those issues (such as setting `DOCKER_HOST` environment variable), but we are struggling right now with \"post-build-docker\" steps, such as installment of CUDA toolkit. We could possibly use ml model, built with mlflow, as a base image and manipulate over it (to install some software, for example) but this will add a major step to our ci/cd pipelines and will require us to maintain it\r\n\r\nAbility to generate dockerfile would ease out those cases since we could change it afterwards and will allow us to reduce complexity of the steps necessary to deploy ml service\r\n\r\n\r\n### Details\r\n\r\n_No response_\r\n\r\n### What component(s) does this bug affect?\r\n\r\n- [ ] `area/artifacts`: Artifact stores and artifact logging\r\n- [X] `area/build`: Build and test infrastructure for MLflow\r\n- [ ] `area/docs`: MLflow documentation pages\r\n- [ ] `area/examples`: Example code\r\n- [ ] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\r\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\r\n- [ ] `area/pipelines`: Pipelines, Pipeline APIs, Pipeline configs, Pipeline Templates\r\n- [ ] `area/projects`: MLproject format, project running backends\r\n- [ ] `area/scoring`: MLflow Model server, model deployment tools, Spark UDFs\r\n- [ ] `area/server-infra`: MLflow Tracking server backend\r\n- [ ] `area/tracking`: Tracking Service, tracking client APIs, autologging\r\n\r\n### What interface(s) does this bug affect?\r\n\r\n- [ ] `area/uiux`: Front-end, user experience, plotting, JavaScript, JavaScript dev server\r\n- [X] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\r\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\r\n- [ ] `area/windows`: Windows support\r\n\r\n### What language(s) does this bug affect?\r\n\r\n- [ ] `language/r`: R APIs and clients\r\n- [ ] `language/java`: Java APIs and clients\r\n- [ ] `language/new`: Proposals for new client languages\r\n\r\n### What integration(s) does this bug affect?\r\n\r\n- [ ] `integrations/azure`: Azure and Azure ML integrations\r\n- [ ] `integrations/sagemaker`: SageMaker integrations\r\n- [ ] `integrations/databricks`: Databricks integrations","closed_by":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/6532/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/6532/timeline","performed_via_github_app":null,"state_reason":"completed"}