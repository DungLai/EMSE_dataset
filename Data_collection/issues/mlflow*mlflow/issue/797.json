{"url":"https://api.github.com/repos/mlflow/mlflow/issues/797","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/797/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/797/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/797/events","html_url":"https://github.com/mlflow/mlflow/issues/797","id":396714160,"node_id":"MDU6SXNzdWUzOTY3MTQxNjA=","number":797,"title":"ImportError: No module named mlflow.pyfunc.spark_model_cache","user":{"login":"amitdingareNovelis","id":4303278,"node_id":"MDQ6VXNlcjQzMDMyNzg=","avatar_url":"https://avatars.githubusercontent.com/u/4303278?v=4","gravatar_id":"","url":"https://api.github.com/users/amitdingareNovelis","html_url":"https://github.com/amitdingareNovelis","followers_url":"https://api.github.com/users/amitdingareNovelis/followers","following_url":"https://api.github.com/users/amitdingareNovelis/following{/other_user}","gists_url":"https://api.github.com/users/amitdingareNovelis/gists{/gist_id}","starred_url":"https://api.github.com/users/amitdingareNovelis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amitdingareNovelis/subscriptions","organizations_url":"https://api.github.com/users/amitdingareNovelis/orgs","repos_url":"https://api.github.com/users/amitdingareNovelis/repos","events_url":"https://api.github.com/users/amitdingareNovelis/events{/privacy}","received_events_url":"https://api.github.com/users/amitdingareNovelis/received_events","type":"User","site_admin":false},"labels":[{"id":1554650079,"node_id":"MDU6TGFiZWwxNTU0NjUwMDc5","url":"https://api.github.com/repos/mlflow/mlflow/labels/stale","name":"stale","color":"828282","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-01-08T01:24:09Z","updated_at":"2019-11-12T22:50:02Z","closed_at":"2019-11-12T22:50:02Z","author_association":"NONE","active_lock_reason":null,"body":"### System information\r\n- here is the code:\r\n- **Linux CentOS**:\r\n- **PIP installation of MLFlow**: \r\n- **MLflow version : 0.8.0**:\r\n- **Python version - 2.7**: \r\n\r\n\r\n### Describe the problem\r\nDescribe the problem clearly here. Be sure to convey here why it's a bug in MLflow or a feature request.\r\n\r\n### Source code / logs\r\n```\r\nif __name__ == '__main__':\r\n    path = os.path.join(\"...\", \"wine-quality.csv\")\r\n    run_id = \"...\"\r\n    \r\n    spark = SparkSession.builder.appName(\"ServePredictions\").getOrCreate()\r\n\r\n    df = spark.read.option(\"inferSchema\",True).option(\"header\", True).csv(path) if path.endswith(\".csv\") \\\r\n    else spark.read.option(\"multiLine\",True).json(path)\r\n\r\n    if \"quality\" in df.columns:\r\n        df = df.drop(\"quality\")\r\n    df.show(10)\r\n\r\n    udf = mlflow.pyfunc.spark_udf(spark, \"model\", run_id=run_id)\r\n    df2 = df.withColumn(\"prediction\", udf(*df.columns))\r\n    df2.show(10)\r\n```\r\n```\r\nException: Traceback (most recent call last):\r\n  File \"/opt/cloudera/parcels/SPARK2-2.3.0.cloudera4-1.cdh5.13.3.p0.611179/lib/spark2/python/lib/pyspark.zip/pyspark/worker.py\", line 242, in main\r\n    func, profiler, deserializer, serializer = read_udfs(pickleSer, infile, eval_type)\r\n  File \"/opt/cloudera/parcels/SPARK2-2.3.0.cloudera4-1.cdh5.13.3.p0.611179/lib/spark2/python/lib/pyspark.zip/pyspark/worker.py\", line 144, in read_udfs\r\n    arg_offsets, udf = read_single_udf(pickleSer, infile, eval_type)\r\n  File \"/opt/cloudera/parcels/SPARK2-2.3.0.cloudera4-1.cdh5.13.3.p0.611179/lib/spark2/python/lib/pyspark.zip/pyspark/worker.py\", line 120, in read_single_udf\r\n    f, return_type = read_command(pickleSer, infile)\r\n  File \"/opt/cloudera/parcels/SPARK2-2.3.0.cloudera4-1.cdh5.13.3.p0.611179/lib/spark2/python/lib/pyspark.zip/pyspark/worker.py\", line 60, in read_command\r\n    command = serializer._read_with_length(file)\r\n  File \"/opt/cloudera/parcels/SPARK2-2.3.0.cloudera4-1.cdh5.13.3.p0.611179/lib/spark2/python/lib/pyspark.zip/pyspark/serializers.py\", line 171, in _read_with_length\r\n    return self.loads(obj)\r\n  File \"/opt/cloudera/parcels/SPARK2-2.3.0.cloudera4-1.cdh5.13.3.p0.611179/lib/spark2/python/lib/pyspark.zip/pyspark/serializers.py\", line 569, in loads\r\n    return pickle.loads(obj)\r\nImportError: No module named mlflow.pyfunc.spark_model_cache\r\n\r\n\tat org.apache.spark.api.python.BasePythonRunner$ReaderIterator.handlePythonException(PythonRunner.scala:330)\r\n\tat org.apache.spark.sql.execution.python.ArrowPythonRunner$$anon$1.read(ArrowPythonRunner.scala:171)\r\n\tat org.apache.spark.sql.execution.python.ArrowPythonRunner$$anon$1.read(ArrowPythonRunner.scala:121)\r\n\tat org.apache.spark.api.python.BasePythonRunner$ReaderIterator.hasNext(PythonRunner.scala:284)\r\n\tat org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)\r\n\tat org.apache.spark.sql.execution.python.ArrowEvalPythonExec$$anon$2.<init>(ArrowEvalPythonExec.scala:90)\r\n\tat org.apache.spark.sql.execution.python.ArrowEvalPythonExec.evaluate(ArrowEvalPythonExec.scala:88)\r\n\tat org.apache.spark.sql.execution.python.EvalPythonExec$$anonfun$doExecute$1.apply(EvalPythonExec.scala:131)\r\n\tat org.apache.spark.sql.execution.python.EvalPythonExec$$anonfun$doExecute$1.apply(EvalPythonExec.scala:93)\r\n\tat org.apache.spark.rdd.RDD$$anonfun$mapPartitions$1$$anonfun$apply$23.apply(RDD.scala:801)\r\n\tat org.apache.spark.rdd.RDD$$anonfun$mapPartitions$1$$anonfun$apply$23.apply(RDD.scala:801)\r\n\tat org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:49)\r\n\tat org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)\r\n\tat org.apache.spark.rdd.RDD.iterator(RDD.scala:288)\r\n\tat org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:49)\r\n\tat org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)\r\n\tat org.apache.spark.rdd.RDD.iterator(RDD.scala:288)\r\n\tat org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:49)\r\n\tat org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)\r\n\tat org.apache.spark.rdd.RDD.iterator(RDD.scala:288)\r\n\tat org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:49)\r\n\tat org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)\r\n\tat org.apache.spark.rdd.RDD.iterator(RDD.scala:288)\r\n\tat org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:87)\r\n\tat org.apache.spark.scheduler.Task.run(Task.scala:109)\r\n\tat org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:381)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\n\r\n```\r\n\r\nInclude any logs or source code that would be helpful to diagnose the problem. If including tracebacks,\r\nplease include the full traceback. Large logs and files should be attached.\r\nTry to provide a reproducible test case that is the bare minimum necessary to generate the problem.\r\n","closed_by":{"login":"stale[bot]","id":26384082,"node_id":"MDM6Qm90MjYzODQwODI=","avatar_url":"https://avatars.githubusercontent.com/in/1724?v=4","gravatar_id":"","url":"https://api.github.com/users/stale%5Bbot%5D","html_url":"https://github.com/apps/stale","followers_url":"https://api.github.com/users/stale%5Bbot%5D/followers","following_url":"https://api.github.com/users/stale%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stale%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/stale%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/stale%5Bbot%5D/repos","events_url":"https://api.github.com/users/stale%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/stale%5Bbot%5D/received_events","type":"Bot","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/797/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/797/timeline","performed_via_github_app":null,"state_reason":"completed"}