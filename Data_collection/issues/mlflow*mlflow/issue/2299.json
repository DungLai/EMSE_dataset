{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2299","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2299/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2299/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2299/events","html_url":"https://github.com/mlflow/mlflow/issues/2299","id":549074515,"node_id":"MDU6SXNzdWU1NDkwNzQ1MTU=","number":2299,"title":"Deployment of Tracking Server to Google Kubernetes Engine: Site Cannot Be Reached","user":{"login":"rileyhun","id":20649466,"node_id":"MDQ6VXNlcjIwNjQ5NDY2","avatar_url":"https://avatars.githubusercontent.com/u/20649466?v=4","gravatar_id":"","url":"https://api.github.com/users/rileyhun","html_url":"https://github.com/rileyhun","followers_url":"https://api.github.com/users/rileyhun/followers","following_url":"https://api.github.com/users/rileyhun/following{/other_user}","gists_url":"https://api.github.com/users/rileyhun/gists{/gist_id}","starred_url":"https://api.github.com/users/rileyhun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rileyhun/subscriptions","organizations_url":"https://api.github.com/users/rileyhun/orgs","repos_url":"https://api.github.com/users/rileyhun/repos","events_url":"https://api.github.com/users/rileyhun/events{/privacy}","received_events_url":"https://api.github.com/users/rileyhun/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-01-13T17:25:05Z","updated_at":"2021-02-14T07:24:19Z","closed_at":"2020-01-23T15:40:16Z","author_association":"NONE","active_lock_reason":null,"body":"I'm trying to host an MLFlow Tracking Server remotely on Google Kubernetes Engine. After deploying the service, I don't see an errors being logged, so I believe deployment was a success. \r\n\r\nHowever, when I go into the Public IP Address, it says the site cannot be reached. Does anyone have an insight on what's happening here? Any help would be greatly appreciated!\r\n\r\n**DockerFile**\r\n\r\n   ```\r\n FROM python:3-onbuild\r\n    \r\n    LABEL maintainer='rihun@cisco.com'\r\n    \r\n    RUN mkdir /mlflow\r\n    ADD . /mlflow\r\n    \r\n    WORKDIR /mlflow\r\n    \r\n    RUN pip3 --no-cache-dir install -r requirements.txt\r\n    \r\n    EXPOSE 5000\r\n    \r\n    RUN chmod u+x ./start.sh\r\n    ENTRYPOINT [\"./start.sh\"]\r\n```\r\n\r\n**Deployment Yaml File**\r\n\r\n   ```\r\n apiVersion: apps/v1\r\n    kind: Deployment\r\n    metadata:\r\n      name: mlflow-tracking-server-deploy\r\n      labels:\r\n        app: mlflow-tracking-server\r\n    spec:\r\n      replicas: 1\r\n      selector:\r\n        matchLabels:\r\n          app: mlflow-tracking-server\r\n      template:\r\n        metadata:\r\n          labels:\r\n            app: mlflow-tracking-server\r\n        spec:\r\n          # This section describes the containers that make up the deployment\r\n          containers:\r\n            - name: mlflow-tracking-server\r\n              image: gcr.io/project_id/mlflow-tracking-server\r\n    #          ports:\r\n    #            - containerPort: 5000\r\n              # Set env variables used for Postgres Connection\r\n              env:\r\n                - name: GCLOUD_SERVICE_KEY_ENC\r\n                  valueFrom:\r\n                    secretKeyRef:\r\n                      name: mlflow-env-secret\r\n                      key: GCLOUD_SERVICE_KEY_ENC\r\n                - name: GCP_STORAGE_BUCKET\r\n                  valueFrom:\r\n                    secretKeyRef:\r\n                      name: mlflow-env-secret\r\n                      key: GCP_STORAGE_BUCKET\r\n                - name: DB_USER\r\n                  valueFrom:\r\n                    secretKeyRef:\r\n                      name: mlflow-env-secret\r\n                      key: DB_USER\r\n                - name: DB_PASS\r\n                  valueFrom:\r\n                    secretKeyRef:\r\n                      name: mlflow-env-secret\r\n                      key: DB_PASS\r\n                - name: DB_NAME\r\n                  valueFrom:\r\n                    secretKeyRef:\r\n                      name: mlflow-env-secret\r\n                      key: DB_NAME\r\n            # Change <INSTANCE_CONNECTION_NAME> here to include your GCP\r\n            # project, the region of your Cloud SQL instance and the name\r\n            # of your Cloud SQL instance. The format is $PROJECT:$REGION:$INSTANCE\r\n            - name: cloudsql-proxy\r\n              image: gcr.io/cloudsql-docker/gce-proxy:1.11\r\n              command: [\"/cloud_sql_proxy\",\r\n                        \"-instances=project_id:us-east1:ailab=tcp:5432\",\r\n                        \"-credential_file=/secrets/cloudsql/credentials.json\"]\r\n              volumeMounts:\r\n                - name: my-secrets-volume\r\n                  mountPath: /secrets/cloudsql\r\n                  readOnly: true\r\n          volumes:\r\n            - name: my-secrets-volume\r\n              secret:\r\n                secretName: cloudsql-instance-credentials\r\n```\r\n\r\n**Shell Script**\r\n\r\n ```\r\n\r\n    set -ex\r\n    \r\n    if ! ([ -z \"${GCLOUD_SERVICE_KEY_ENC}\" ] || [ -z \"${GCP_STORAGE_BUCKET}\" ]); then\r\n      echo  \"Creating experiment\"\r\n      NAME=\"Experiment1\"\r\n      echo $GCLOUD_SERVICE_KEY_ENC | base64 --decode > ~/secrets_dec.json\r\n      export GOOGLE_CLOUD_KEYFILE_JSON=~/secrets_dec.json\r\n      if ! [ -z \"${EXPERIMENT_NAME}\" ]; then\r\n        NAME=$EXPERIMENT_NAME\r\n        cd /mlflow\r\n        mlflow experiments create --artifact-location gs://$GCP_STORAGE_BUCKET $NAME\r\n      fi\r\n    else\r\n      echo \"Not found environment variables\"\r\n    fi\r\n    \r\n    mlflow server \\\r\n    #    --file-store /mlflow/feature_pipeline_runs \\\r\n        --host 0.0.0.0 \\\r\n        --backend_store_uri postgresql+psycopg2://$DB_USER:$DB_PASS@$127.0.0.1:5432/$DB_NAME \\\r\n        --default-artifact-root gs://$GCP_STORAGE_BUCKET \\\r\n    #    --port 5000\r\n```\r\n\r\n**Here's the Log:**\r\n\r\n> [2020-01-13 17:34:36 +0000] [15] [INFO] Starting gunicorn 20.0.4\r\n> [2020-01-13 17:34:36 +0000] [15] [INFO] Listening at: http://127.0.0.1:5000 (15)\r\n> [2020-01-13 17:34:36 +0000] [15] [INFO] Using worker: sync\r\n> [2020-01-13 17:34:36 +0000] [18] [INFO] Booting worker with pid: 18\r\n> [2020-01-13 17:34:36 +0000] [19] [INFO] Booting worker with pid: 19\r\n> [2020-01-13 17:34:36 +0000] [20] [INFO] Booting worker with pid: 20\r\n> [2020-01-13 17:34:36 +0000] [22] [INFO] Booting worker with pid: 22\r\n\r\n","closed_by":{"login":"rileyhun","id":20649466,"node_id":"MDQ6VXNlcjIwNjQ5NDY2","avatar_url":"https://avatars.githubusercontent.com/u/20649466?v=4","gravatar_id":"","url":"https://api.github.com/users/rileyhun","html_url":"https://github.com/rileyhun","followers_url":"https://api.github.com/users/rileyhun/followers","following_url":"https://api.github.com/users/rileyhun/following{/other_user}","gists_url":"https://api.github.com/users/rileyhun/gists{/gist_id}","starred_url":"https://api.github.com/users/rileyhun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rileyhun/subscriptions","organizations_url":"https://api.github.com/users/rileyhun/orgs","repos_url":"https://api.github.com/users/rileyhun/repos","events_url":"https://api.github.com/users/rileyhun/events{/privacy}","received_events_url":"https://api.github.com/users/rileyhun/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2299/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2299/timeline","performed_via_github_app":null,"state_reason":"completed"}