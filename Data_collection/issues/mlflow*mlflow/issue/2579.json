{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2579","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2579/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2579/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2579/events","html_url":"https://github.com/mlflow/mlflow/issues/2579","id":580407629,"node_id":"MDU6SXNzdWU1ODA0MDc2Mjk=","number":2579,"title":"[BUG] Unable to log artifacts in s3 when running through uwsgi + nginx","user":{"login":"ravilkashyap","id":20355455,"node_id":"MDQ6VXNlcjIwMzU1NDU1","avatar_url":"https://avatars.githubusercontent.com/u/20355455?v=4","gravatar_id":"","url":"https://api.github.com/users/ravilkashyap","html_url":"https://github.com/ravilkashyap","followers_url":"https://api.github.com/users/ravilkashyap/followers","following_url":"https://api.github.com/users/ravilkashyap/following{/other_user}","gists_url":"https://api.github.com/users/ravilkashyap/gists{/gist_id}","starred_url":"https://api.github.com/users/ravilkashyap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ravilkashyap/subscriptions","organizations_url":"https://api.github.com/users/ravilkashyap/orgs","repos_url":"https://api.github.com/users/ravilkashyap/repos","events_url":"https://api.github.com/users/ravilkashyap/events{/privacy}","received_events_url":"https://api.github.com/users/ravilkashyap/received_events","type":"User","site_admin":false},"labels":[{"id":1893057631,"node_id":"MDU6TGFiZWwxODkzMDU3NjMx","url":"https://api.github.com/repos/mlflow/mlflow/labels/Acknowledged","name":"Acknowledged","color":"f9d0c4","default":false,"description":"This issue has been read and acknowledged by the MLflow admins."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-03-13T06:53:32Z","updated_at":"2020-04-04T06:02:23Z","closed_at":"2020-04-04T06:02:23Z","author_association":"NONE","active_lock_reason":null,"body":"Thank you for submitting an issue. Please refer to our [issue policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md)\r\nfor information on what types of issues we address. For help with debugging your code, please refer to [Stack Overflow](https://stackoverflow.com/questions/tagged/mlflow).\r\n\r\nPlease fill in this template and do not delete it unless you are sure your issue is outside its scope.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux ubuntu 16.04\r\n- **MLflow installed from (source or binary)**: source\r\n- **MLflow version (run ``mlflow --version``)**: 1.7.0\r\n- **Python version**: 3.7.4\r\n- **npm version, if running the dev UI**:\r\n- **Exact command to reproduce**: mlflow.log_artifact(\"fname\")\r\n\r\n### Describe the problem\r\nWhen I run my program through terminal, it is able to interact with tracking server and log artifacts to s3 and register models in tracking server database. But when I trigger the same program through uwsgi + nginx, I get 502 bad gateway and this error - `DEBUG - Releasing acquire 0/None`. And one of the uwsgi worker dies and respawns. I am able to log parameters to tracking server but not able to upload artifacts to s3. I have checked that credentials given are right. \r\n### Code to reproduce issue\r\nJust a simple logging code running under uwsgi + nginx\r\n\r\n### Other info / logs\r\nlogs - ` auth.py - 32194 - 2020-03-10 11:47:07 - DEBUG - StringToSign:\r\nAWS4-HMAC-SHA256\r\n20200310T114707Z\r\n20200310/us-east-1/s3/aws4_request\r\nc3f65519db1b8b286225cf0a6fbe5e9a63bbf82307f5f1acbe72bf23d21f3cd0\r\n auth.py - 32194 - 2020-03-10 11:47:07 - DEBUG - Signature:\r\n40cd9385c66bc1f39255f7055bb9a0c74c6c424e6dcdf263e80cc1e64d86c578\r\n hooks.py - 32194 - 2020-03-10 11:47:07 - DEBUG - Event request-created.s3.PutObject: calling handler <function signal_transferring at 0x7f8394163268>\r\n endpoint.py - 32194 - 2020-03-10 11:47:07 - DEBUG - Sending http request: <AWSPreparedRequest stream_output=False, method=PUT, url=https://versioncontrolds.s3.amazonaws.com/1/cbf9717962f84203aa7df44d09a2d457/artifacts/pipeline_ha__svm_clf__generic.pkl/conda.yaml, headers={'User-Agent': b'Boto3/1.12.17 Python/3.7.3 Linux/4.4.0-1101-aws Botocore/1.15.17', 'Content-MD5': b'waybH36VQLKanEW62W1dqA==', 'Expect': b'100-continue', 'X-Amz-Date': b'20200310T114707Z', 'X-Amz-Content-SHA256': b'UNSIGNED-PAYLOAD', 'Authorization': b'AWS4-HMAC-SHA256 Credential=AKIAICRWEUJK3GTWK4RA/20200310/us-east-1/s3/aws4_request, SignedHeaders=content-md5;host;x-amz-content-sha256;x-amz-date, Signature=40cd9385c66bc1f39255f7055bb9a0c74c6c424e6dcdf263e80cc1e64d86c578', 'Content-Length': '108'}>\r\n connectionpool.py - 32194 - 2020-03-10 11:47:07 - DEBUG - Starting new HTTPS connection (1): versioncontrolds.s3.amazonaws.com:443\r\n awsrequest.py - 32194 - 2020-03-10 11:47:07 - DEBUG - Waiting for 100 Continue response.\r\n awsrequest.py - 32194 - 2020-03-10 11:47:07 - DEBUG - 100 Continue response seen, now sending request body.\r\n connectionpool.py - 32194 - 2020-03-10 11:47:07 - DEBUG - https://versioncontrolds.s3.amazonaws.com:443 \"PUT /1/cbf9717962f84203aa7df44d09a2d457/artifacts/pipeline_ha__svm_clf__generic.pkl/conda.yaml HTTP/1.1\" 200 0\r\n parsers.py - 32194 - 2020-03-10 11:47:07 - DEBUG - Response headers: {'x-amz-id-2': 'XxF8kVAHnpze1pYnk6u3ezFG0zy+00O1sUbPMhh2xfepCnGGJzK7CcRcERTO2iEBfpOxVD4Ycyo=', 'x-amz-request-id': '54A47C9B0BB87861', 'Date': 'Tue, 10 Mar 2020 11:47:08 GMT', 'x-amz-version-id': '7zSfID77PL0yMRHUE92DRjcc3kgkGHbm', 'ETag': '\"c1ac9b1f7e9540b29a9c45bad96d5da8\"', 'Content-Length': '0', 'Server': 'AmazonS3'}\r\n parsers.py - 32194 - 2020-03-10 11:47:07 - DEBUG - Response body:\r\nb''\r\n hooks.py - 32194 - 2020-03-10 11:47:07 - DEBUG - Event needs-retry.s3.PutObject: calling handler <botocore.retryhandler.RetryHandler object at 0x7f8394127b38>\r\n retryhandler.py - 32194 - 2020-03-10 11:47:07 - DEBUG - No retry needed.\r\n hooks.py - 32194 - 2020-03-10 11:47:07 - DEBUG - Event needs-retry.s3.PutObject: calling handler <bound method S3RegionRedirector.redirect_from_error of <botocore.utils.S3RegionRedirector object at 0x7f8394127c50>>\r\n utils.py - 32194 - 2020-03-10 11:47:07 - DEBUG - Releasing acquire 0/None`\r\n\r\nuwsgi/journalctl logs - \r\n`Mar 10 11:47:07 ip-172-30-0-42 uwsgi[32167]: /home/ubuntu/miniconda3/envs/tern_env/bin/uwsgi(_PyFunction_FastCallKeywords+0xfb) [0x564b62161e8b]\r\nMar 10 11:47:07 ip-172-30-0-42 uwsgi[32167]: /home/ubuntu/miniconda3/envs/tern_env/bin/uwsgi(_PyEval_EvalFrameDefault+0x6d4) [0x564b620fd844]\r\nMar 10 11:47:07 ip-172-30-0-42 uwsgi[32167]: /home/ubuntu/miniconda3/envs/tern_env/bin/uwsgi(_PyFunction_FastCallKeywords+0xfb) [0x564b62161e8b]\r\nMar 10 11:47:07 ip-172-30-0-42 uwsgi[32167]: *** end of backtrace ***\r\nMar 10 11:47:08 ip-172-30-0-42 uwsgi[32167]: DAMN ! worker 6 (pid: 32194) died :( trying respawn ...\r\nMar 10 11:47:08 ip-172-30-0-42 uwsgi[32167]: Respawned uWSGI worker 6 (new pid: 32208)`\r\n","closed_by":{"login":"ravilkashyap","id":20355455,"node_id":"MDQ6VXNlcjIwMzU1NDU1","avatar_url":"https://avatars.githubusercontent.com/u/20355455?v=4","gravatar_id":"","url":"https://api.github.com/users/ravilkashyap","html_url":"https://github.com/ravilkashyap","followers_url":"https://api.github.com/users/ravilkashyap/followers","following_url":"https://api.github.com/users/ravilkashyap/following{/other_user}","gists_url":"https://api.github.com/users/ravilkashyap/gists{/gist_id}","starred_url":"https://api.github.com/users/ravilkashyap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ravilkashyap/subscriptions","organizations_url":"https://api.github.com/users/ravilkashyap/orgs","repos_url":"https://api.github.com/users/ravilkashyap/repos","events_url":"https://api.github.com/users/ravilkashyap/events{/privacy}","received_events_url":"https://api.github.com/users/ravilkashyap/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2579/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2579/timeline","performed_via_github_app":null,"state_reason":"completed"}