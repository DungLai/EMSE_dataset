{"url":"https://api.github.com/repos/mlflow/mlflow/issues/6611","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/6611/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/6611/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/6611/events","html_url":"https://github.com/mlflow/mlflow/issues/6611","id":1352734586,"node_id":"I_kwDOCB5Jx85QoRd6","number":6611,"title":"[BUG] conda environment creation attempt when running project with --no-conda/--env-manager=local causes failure","user":{"login":"nfarley-soaren","id":92752316,"node_id":"U_kgDOBYdJvA","avatar_url":"https://avatars.githubusercontent.com/u/92752316?v=4","gravatar_id":"","url":"https://api.github.com/users/nfarley-soaren","html_url":"https://github.com/nfarley-soaren","followers_url":"https://api.github.com/users/nfarley-soaren/followers","following_url":"https://api.github.com/users/nfarley-soaren/following{/other_user}","gists_url":"https://api.github.com/users/nfarley-soaren/gists{/gist_id}","starred_url":"https://api.github.com/users/nfarley-soaren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nfarley-soaren/subscriptions","organizations_url":"https://api.github.com/users/nfarley-soaren/orgs","repos_url":"https://api.github.com/users/nfarley-soaren/repos","events_url":"https://api.github.com/users/nfarley-soaren/events{/privacy}","received_events_url":"https://api.github.com/users/nfarley-soaren/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022848510,"node_id":"MDU6TGFiZWwyMDIyODQ4NTEw","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/projects","name":"area/projects","color":"48eabc","default":false,"description":"MLproject format, project running backends"}],"state":"closed","locked":false,"assignee":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"assignees":[{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2022-08-26T21:05:59Z","updated_at":"2023-01-04T15:12:20Z","closed_at":"2022-08-29T16:47:15Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### Willingness to contribute\r\n\r\nNo. I cannot contribute a bug fix at this time.\r\n\r\n### MLflow version\r\n\r\n1.27.0\r\n\r\n### System information\r\n\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:  Windows Server 2019 Standard\r\n- **Python version**: 3.10.4\r\n- **yarn version, if running the dev UI**:\r\n\r\n\r\n### Describe the problem\r\n\r\nI am attempting to run mlflow project from a github repo on remote Windows Server.  I have not had any problems running the same command on my local Windows 10 machine.   The run failed on remote due to a conda error during environment creation so I manually created an environment to use.  However, when I try to run the project with the local environment (either using --no-conda or --env-manager=local) it still attempts to create the project environment and fails at this step.  Any insight would be greatly appreciated.\r\n\r\n### Tracking information\r\n\r\n_No response_\r\n\r\n### Code to reproduce issue\r\n\r\n```\r\nmlflow run https://{GITHUB_ACCESS_TOKEN}@github.com/CompanyName/data-science-projects.git#pti_multistep_workflow --version my_model --experiment-name my_experiment --env-manager=local\r\n```\r\n\r\n### Stack trace\r\n\r\n```\r\n2022/08/26 13:56:35 INFO mlflow.projects.utils: === Fetching project from https://{GITHUB_ACCESS_TOKEN}@github.com/CompanyName/data-science-projects.git#pti_multistep_workflow into C:\\Users\\NICOLE~1.FAR\\AppData\\Local\\Temp\\6\\tmph1v6_xbz ===\r\n2022/08/26 13:56:56 INFO mlflow.projects.utils: === Created directory C:\\Users\\NICOLE~1.FAR\\AppData\\Local\\Temp\\6\\tmpj97ildpr for downloading remote URIs passed to arguments of type 'path' ===\r\n2022/08/26 13:56:56 INFO mlflow.projects.backend.local: === Running command 'python main.py' in run with ID 'bab43bcd1c23482c8bc0b5383d572b61' ===\r\n2022/08/26 13:57:04 INFO mlflow.utils.conda: === Creating conda environment mlflow-f9436806216344de765e4a9ad154d6365504135b ===\r\nCollecting package metadata (repodata.json): failed\r\n\r\nCondaHTTPError: HTTP 000 CONNECTION FAILED for url <https://conda.anaconda.org/conda-forge/win-64/repodata.json>\r\nElapsed: -\r\n\r\nAn HTTP error occurred when trying to retrieve this URL.\r\nHTTP errors are often intermittent, and a simple retry will get you on your way.\r\n'https://conda.anaconda.org/conda-forge/win-64'\r\n\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\NICOLE~1.FAR\\AppData\\Local\\Temp\\6\\tmph1v6_xbz\\pti_multistep_workflow\\main.py\", line 106, in <module>\r\n    workflow()\r\n  File \"C:\\Users\\NICOLE~1.FAR\\AppData\\Local\\Temp\\6\\tmph1v6_xbz\\pti_multistep_workflow\\main.py\", line 85,\r\nin workflow\r\n    custom_preprocessing_run = mlflow.run(\".\", \"custom_preprocess\", parameters=preprocessing_params)\r\n  File \"C:\\Users\\nicole\\.conda\\envs\\tutorial\\lib\\site-packages\\mlflow\\projects\\__init__.py\", line\r\n331, in run\r\n    submitted_run_obj = _run(\r\n  File \"C:\\Users\\nicole\\.conda\\envs\\tutorial\\lib\\site-packages\\mlflow\\projects\\__init__.py\", line\r\n95, in _run\r\n    submitted_run = backend.run(\r\n  File \"C:\\Users\\nicole\\.conda\\envs\\tutorial\\lib\\site-packages\\mlflow\\projects\\backend\\local.py\",\r\nline 136, in run\r\n    conda_env_name = get_or_create_conda_env(project.env_config_path)\r\n  File \"C:\\Users\\nicole\\.conda\\envs\\tutorial\\lib\\site-packages\\mlflow\\utils\\conda.py\", line 214, in get_or_create_conda_env\r\n    process._exec_cmd(\r\n  File \"C:\\Users\\nicole\\.conda\\envs\\tutorial\\lib\\site-packages\\mlflow\\utils\\process.py\", line 116, in _exec_cmd\r\n    raise ShellCommandException.from_completed_process(comp_process)\r\nmlflow.utils.process.ShellCommandException: Non-zero exit code: 1\r\nCommand: ['C:\\\\ProgramData\\\\Miniconda3\\\\condabin\\\\..\\\\Scripts\\\\conda', 'env', 'create', '-n', 'mlflow-f9436806216344de765e4a9ad154d6365504135b', '--file', 'C:\\\\Users\\\\NICOLE~1.FAR\\\\AppData\\\\Local\\\\Temp\\\\6\\\\tmph1v6_xbz\\\\pti_multistep_workflow\\\\conda.yaml']\r\n2022/08/26 13:57:15 ERROR mlflow.cli: === Run (ID 'bab43bcd1c23482c8bc0b5383d572b61') failed ===\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n### Other info / logs\r\n\r\n_No response_\r\n\r\n### What component(s) does this bug affect?\r\n\r\n- [ ] `area/artifacts`: Artifact stores and artifact logging\r\n- [ ] `area/build`: Build and test infrastructure for MLflow\r\n- [ ] `area/docs`: MLflow documentation pages\r\n- [ ] `area/examples`: Example code\r\n- [ ] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\r\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\r\n- [ ] `area/pipelines`: Pipelines, Pipeline APIs, Pipeline configs, Pipeline Templates\r\n- [X] `area/projects`: MLproject format, project running backends\r\n- [ ] `area/scoring`: MLflow Model server, model deployment tools, Spark UDFs\r\n- [ ] `area/server-infra`: MLflow Tracking server backend\r\n- [ ] `area/tracking`: Tracking Service, tracking client APIs, autologging\r\n\r\n### What interface(s) does this bug affect?\r\n\r\n- [ ] `area/uiux`: Front-end, user experience, plotting, JavaScript, JavaScript dev server\r\n- [ ] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\r\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\r\n- [ ] `area/windows`: Windows support\r\n\r\n### What language(s) does this bug affect?\r\n\r\n- [ ] `language/r`: R APIs and clients\r\n- [ ] `language/java`: Java APIs and clients\r\n- [ ] `language/new`: Proposals for new client languages\r\n\r\n### What integration(s) does this bug affect?\r\n\r\n- [ ] `integrations/azure`: Azure and Azure ML integrations\r\n- [ ] `integrations/sagemaker`: SageMaker integrations\r\n- [ ] `integrations/databricks`: Databricks integrations","closed_by":{"login":"nfarley-soaren","id":92752316,"node_id":"U_kgDOBYdJvA","avatar_url":"https://avatars.githubusercontent.com/u/92752316?v=4","gravatar_id":"","url":"https://api.github.com/users/nfarley-soaren","html_url":"https://github.com/nfarley-soaren","followers_url":"https://api.github.com/users/nfarley-soaren/followers","following_url":"https://api.github.com/users/nfarley-soaren/following{/other_user}","gists_url":"https://api.github.com/users/nfarley-soaren/gists{/gist_id}","starred_url":"https://api.github.com/users/nfarley-soaren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nfarley-soaren/subscriptions","organizations_url":"https://api.github.com/users/nfarley-soaren/orgs","repos_url":"https://api.github.com/users/nfarley-soaren/repos","events_url":"https://api.github.com/users/nfarley-soaren/events{/privacy}","received_events_url":"https://api.github.com/users/nfarley-soaren/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/6611/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/6611/timeline","performed_via_github_app":null,"state_reason":"completed"}