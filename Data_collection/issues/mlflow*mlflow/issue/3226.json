{"url":"https://api.github.com/repos/mlflow/mlflow/issues/3226","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/3226/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/3226/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/3226/events","html_url":"https://github.com/mlflow/mlflow/issues/3226","id":672694262,"node_id":"MDU6SXNzdWU2NzI2OTQyNjI=","number":3226,"title":"[BUG] Unable to log using mlflow.tensorflow.log_model()","user":{"login":"naman-mehta","id":22037624,"node_id":"MDQ6VXNlcjIyMDM3NjI0","avatar_url":"https://avatars.githubusercontent.com/u/22037624?v=4","gravatar_id":"","url":"https://api.github.com/users/naman-mehta","html_url":"https://github.com/naman-mehta","followers_url":"https://api.github.com/users/naman-mehta/followers","following_url":"https://api.github.com/users/naman-mehta/following{/other_user}","gists_url":"https://api.github.com/users/naman-mehta/gists{/gist_id}","starred_url":"https://api.github.com/users/naman-mehta/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/naman-mehta/subscriptions","organizations_url":"https://api.github.com/users/naman-mehta/orgs","repos_url":"https://api.github.com/users/naman-mehta/repos","events_url":"https://api.github.com/users/naman-mehta/events{/privacy}","received_events_url":"https://api.github.com/users/naman-mehta/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022848043,"node_id":"MDU6TGFiZWwyMDIyODQ4MDQz","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/models","name":"area/models","color":"48eabc","default":false,"description":"MLmodel format, model serialization/deserialization, flavors"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2020-08-04T10:43:48Z","updated_at":"2020-08-05T16:01:54Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Thank you for submitting an issue. Please refer to our [issue policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md) for information on what types of issues we address.\r\n\r\n**Please fill in this installation issue template to ensure a timely and thorough response.**\r\n\r\n### System information\r\n- **OS Platform and Distribution :Ubuntu 18.04\r\n- **MLflow installed from :source\r\n- **MLflow version :1.10\r\n\r\n\r\nI am trying to log the TensorFlow based Deeplab model using mlflow.tensorflow.log_model(). It takes the following 3 arguments.\r\n1-tf_saved_model_dir\r\n2-tf_meta_graph_tags\r\n3-tf_signature_def_key\r\n1-tf_saved_model_dir - For the first argument- deeplab models are saved in .ckpt format but mlflow.tensorflow.log_model() expects in .pb format.\r\nSo I used export_model.py https://github.com/tensorflow/models/blob/master/research/deeplab/export_model.py to convert to pb format.\r\nCommand used-\r\npython3 deeplab/export_model.py \\\r\n  --logtostderr \\\r\n  --model_variant=\"xception_65\" \\\r\n  --num_classes=151 \\\r\n  --atrous_rates=6 \\\r\n  --atrous_rates=12 \\\r\n  --atrous_rates=18 \\\r\n  --output_stride=16 \\\r\n  --crop_size=513 \\\r\n  --crop_size=513 \\\r\n  --checkpoint_path='/home/.../training_dir/model.ckpt-100' \\\r\n  --export_path='/home/.../training_dir/export_model/saved_model.pb' \\\r\n  --save_inference_graph=True\r\n2-tf_meta_graph_tags -\r\nFor conversion of checkpoints to pb export_model.py uses freeze_graph_with_def_protos() function of /tensorflow/python/tools/freeze_graph.py. The arguments saved_model_tags is set to None.\r\nBut when I try\r\nmlflow.tensorflow.log_model(tf_saved_model_dir= tf_saved_model_dir ,tf_meta_graph_tags= None , tf_signature_def_key=None , artifact_path = export_path)\r\nI get the error -\r\nTypeError: 'NoneType' object is not iterable\r\nOr\r\nmlflow.tensorflow.log_model(tf_saved_model_dir= tf_saved_model_dir ,tf_meta_graph_tags= tag_constants.SERVING , tf_signature_def_key=None , artifact_path = export_path)\r\nRuntimeError: MetaGraphDef associated with tags serve could not be found in SavedModel.\r\nIs tf_meta_graph_tags and saved_model_tags different.\r\nhow to find tf_meta_graph_tags.\r\nI tried this\r\nfrom tensorflow.python.tools import freeze_graph\r\ntf_saved_model_dir = '/home/.../deeplab/training_dir/export_model'\r\nprint(freeze_graph._parse_input_meta_graph_proto(tf_saved_model_dir+'/inference_graph.pbtxt',input_binary= False))\r\nGot this error-\r\ngoogle.protobuf.text_format.ParseError: 1:1 : Message type \"tensorflow.MetaGraphDef\" has no field named \"node\"\r\n3-tf_signature_def_key- Please suggest how to find this argument. for eg- in few other codes other than deeplab it is tf_signature_def_key=’serving_default’.\r\nBut I am not sure it is the same for my model.\r\nWhat I have understood till now is that I have to use saved_model_cli to know tags and key from my model. Am i right?\r\nIf yes how to use saved_model_cli here.\r\nIf I am wrong please suggest ways to know tf_meta_graph_tags and tf_signature_def_key.\r\nI have also followed this https://medium.com/analytics-vidhya/mlflow-logging-for-tensorflow-37b6a6a53e3c approach.\r\nto log model checkpoints as artifacts which can be a workaround to mlflow.tensorflow.log_model().\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/3226/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/3226/timeline","performed_via_github_app":null,"state_reason":null}