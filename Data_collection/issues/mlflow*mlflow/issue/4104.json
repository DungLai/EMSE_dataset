{"url":"https://api.github.com/repos/mlflow/mlflow/issues/4104","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/4104/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/4104/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/4104/events","html_url":"https://github.com/mlflow/mlflow/issues/4104","id":808341832,"node_id":"MDU6SXNzdWU4MDgzNDE4MzI=","number":4104,"title":"mlflow models serve fails with 'FileNotFoundError: [Errno 2] No such file or directory: /tmp/tmpv459n53j/MLmodel/MLmodel'","user":{"login":"akhiljain794","id":7837283,"node_id":"MDQ6VXNlcjc4MzcyODM=","avatar_url":"https://avatars.githubusercontent.com/u/7837283?v=4","gravatar_id":"","url":"https://api.github.com/users/akhiljain794","html_url":"https://github.com/akhiljain794","followers_url":"https://api.github.com/users/akhiljain794/followers","following_url":"https://api.github.com/users/akhiljain794/following{/other_user}","gists_url":"https://api.github.com/users/akhiljain794/gists{/gist_id}","starred_url":"https://api.github.com/users/akhiljain794/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/akhiljain794/subscriptions","organizations_url":"https://api.github.com/users/akhiljain794/orgs","repos_url":"https://api.github.com/users/akhiljain794/repos","events_url":"https://api.github.com/users/akhiljain794/events{/privacy}","received_events_url":"https://api.github.com/users/akhiljain794/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022847714,"node_id":"MDU6TGFiZWwyMDIyODQ3NzE0","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/model-registry","name":"area/model-registry","color":"48eabc","default":false,"description":"Model registry, model registry APIs, and the fluent client calls for model registry"},{"id":2022848043,"node_id":"MDU6TGFiZWwyMDIyODQ4MDQz","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/models","name":"area/models","color":"48eabc","default":false,"description":"MLmodel format, model serialization/deserialization, flavors"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-02-15T09:06:02Z","updated_at":"2021-12-17T13:17:54Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### Willingness to contribute\r\nThe MLflow Community encourages bug fix contributions. Would you or another member of your organization be willing to contribute a fix for this bug to the MLflow code base?\r\n\r\n- [ ] Yes. I can contribute a fix for this bug independently.\r\n- [ ] Yes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: MacOS 10.15.6\r\n- **MLflow installed from (source or binary)**: Binary\r\n- **MLflow version (run ``mlflow --version``)**: 1.13.1\r\n- **Python version**: 3.8.5\r\n- **npm version, if running the dev UI**: N/A\r\n- **Exact command to reproduce**: mlflow models serve -m \"models:/SeasonalAD/1\" -p 1234\r\n\r\n### Describe the problem\r\nMlflow details-\r\nI have mlflow running in k8s container with s3 storage (models being stored at s3://mlflow/ bucket) on a remote cluster.\r\nOn my mac:\r\nI have a custom anomaly detection python class with training and prediction method. I am using jupyter notebook(running on my mac) to train and save the model.\r\nI have set suitable env variables from my jupyter notebook to communicate to remote mlflow process. Below vars are set -\r\nimport os\r\nos.environ[\"MLFLOW_S3_ENDPOINT_URL\"]=\"XXXX\"\r\nos.environ[\"AWS_ACCESS_KEY_ID\"]=\"XXXX\"\r\nos.environ[\"AWS_SECRET_ACCESS_KEY\"]=\"XXXX\"\r\nos.environ[\"MLFLOW_TRACKING_INSECURE_TLS\"]=\"true\"\r\nos.environ[\"MLFLOW_TRACKING_URI\"]=\"XXXX\"\r\nimport mlflow\r\nmlflow.set_experiment(\"aj-experiment\")\r\n\r\nI am training this model using a sample data and registering the model using below command-\r\nmlflow.pyfunc.log_model(artifact_path=\"seasonalAD\",python_model=seasonalADTrained, registered_model_name=\"SeasonalAD\")\r\n\r\nModel is successfully registered and I can view the model from s3 minIO UI under **Models** tab. Following are the contents-\r\nseasonalAD\r\n  |--MLModel\r\n  |--conda.yaml\r\n  |--python_model.pkl\r\n\r\nNow, when I try to serve this model as a REST API through cli from my mac it is giving me below trace-\r\n\r\n(base) akhiljain@akhil-jain ~ % mlflow models serve -m \"models:/SeasonalAD/1\" -p 1234\r\n/Users/akhiljain/miniconda3/lib/python3.8/site-packages/urllib3/connectionpool.py:981: InsecureRequestWarning: Unverified HTTPS request is being made to host 'XXXX'. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings\r\n  warnings.warn(\r\nTraceback (most recent call last):\r\n  File \"/Users/akhiljain/miniconda3/bin/mlflow\", line 8, in <module>\r\n    sys.exit(cli())\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/click/core.py\", line 829, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/click/core.py\", line 782, in main\r\n    rv = self.invoke(ctx)\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/click/core.py\", line 1259, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/click/core.py\", line 1259, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/click/core.py\", line 1066, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/click/core.py\", line 610, in invoke\r\n    return callback(*args, **kwargs)\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/mlflow/models/cli.py\", line 55, in serve\r\n    return _get_flavor_backend(\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/mlflow/models/cli.py\", line 180, in _get_flavor_backend\r\n    model = Model.load(local_path)\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/mlflow/models/model.py\", line 112, in load\r\n    with open(path) as f:\r\nFileNotFoundError: [Errno 2] No such file or directory: '/tmp/tmpv459n53j/MLmodel/MLmodel'\r\n\r\nExpected behavior: Serve a model saved with MLflow by launching a webserver on the specified port\r\n\r\n### Code to reproduce issue\r\nimport pandas as pd\r\nimport numpy as np\r\nimport mlflow.pyfunc\r\ndf = pd.read_csv(\"data/seasonal.csv\", index_col=\"Time\", parse_dates=True)\r\ndf_train = df.iloc[0:7000]\r\nfrom SeasonalAD_class_mlflow import SeasonalAD\r\nseasonalADTrained = SeasonalAD(adjust_trend = False)\r\ndf_train_r, anomalies_f =  seasonalADTrained.fit(df_train[\"Traffic\"],return_result=True)\r\nwith mlflow.start_run():\r\n    mlflow.pyfunc.log_model(artifact_path=\"seasonalAD\",python_model=seasonalADTrained,\r\n                        registered_model_name=\"SeasonalAD\")\r\n\r\n### Other info / logs\r\nThis issue comes even when I try to serve model as REST API created by running the ElasticnetWineModel tutorial present on mlflow documentation page.\r\n(base) akhiljain@akhil-jain ~ % mlflow models serve -m \"models:/ElasticnetWineModel/1\" -p 1234\r\n/Users/akhiljain/miniconda3/lib/python3.8/site-packages/urllib3/connectionpool.py:981: InsecureRequestWarning: Unverified HTTPS request is being made to host 'XXXX'. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings\r\n  warnings.warn(\r\nTraceback (most recent call last):\r\n  File \"/Users/akhiljain/miniconda3/bin/mlflow\", line 8, in <module>\r\n    sys.exit(cli())\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/click/core.py\", line 829, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/click/core.py\", line 782, in main\r\n    rv = self.invoke(ctx)\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/click/core.py\", line 1259, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/click/core.py\", line 1259, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/click/core.py\", line 1066, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/click/core.py\", line 610, in invoke\r\n    return callback(*args, **kwargs)\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/mlflow/models/cli.py\", line 55, in serve\r\n    return _get_flavor_backend(\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/mlflow/models/cli.py\", line 180, in _get_flavor_backend\r\n    model = Model.load(local_path)\r\n  File \"/Users/akhiljain/miniconda3/lib/python3.8/site-packages/mlflow/models/model.py\", line 112, in load\r\n    with open(path) as f:\r\nFileNotFoundError: [Errno 2] No such file or directory: '/tmp/tmpjakqqrk7/MLmodel/MLmodel'\r\n\r\n### What component(s), interfaces, languages, and integrations does this bug affect?\r\nComponents \r\n- [x] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\r\n- [x] `area/models`: MLmodel format, model serialization/deserialization, flavors\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/4104/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/4104/timeline","performed_via_github_app":null,"state_reason":null}