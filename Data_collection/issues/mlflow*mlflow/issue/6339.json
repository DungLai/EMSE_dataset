{"url":"https://api.github.com/repos/mlflow/mlflow/issues/6339","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/6339/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/6339/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/6339/events","html_url":"https://github.com/mlflow/mlflow/issues/6339","id":1318888012,"node_id":"I_kwDOCB5Jx85OnKJM","number":6339,"title":"[BUG] Internal Server Error on delete","user":{"login":"jaelynlitz","id":93339979,"node_id":"U_kgDOBZBBSw","avatar_url":"https://avatars.githubusercontent.com/u/93339979?v=4","gravatar_id":"","url":"https://api.github.com/users/jaelynlitz","html_url":"https://github.com/jaelynlitz","followers_url":"https://api.github.com/users/jaelynlitz/followers","following_url":"https://api.github.com/users/jaelynlitz/following{/other_user}","gists_url":"https://api.github.com/users/jaelynlitz/gists{/gist_id}","starred_url":"https://api.github.com/users/jaelynlitz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaelynlitz/subscriptions","organizations_url":"https://api.github.com/users/jaelynlitz/orgs","repos_url":"https://api.github.com/users/jaelynlitz/repos","events_url":"https://api.github.com/users/jaelynlitz/events{/privacy}","received_events_url":"https://api.github.com/users/jaelynlitz/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1470945519,"node_id":"MDU6TGFiZWwxNDcwOTQ1NTE5","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/uiux","name":"area/uiux","color":"ede978","default":false,"description":"Front-end, user experience, plotting, JavaScript, JavaScript dev server"},{"id":4300304016,"node_id":"LA_kwDOCB5Jx88AAAABAFFukA","url":"https://api.github.com/repos/mlflow/mlflow/labels/has-closing-pr","name":"has-closing-pr","color":"fef2c0","default":false,"description":"This issue has a closing PR"}],"state":"closed","locked":false,"assignee":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"assignees":[{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false}],"milestone":null,"comments":13,"created_at":"2022-07-27T00:39:09Z","updated_at":"2022-11-11T01:41:21Z","closed_at":"2022-08-03T08:37:41Z","author_association":"NONE","active_lock_reason":null,"body":"### Willingness to contribute\n\nYes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\n\n### MLflow version\n\n1.19.0\n\n### System information\n\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: CentOS 7\r\n- **Python version**: 3.9\r\n- **yarn version, if running the dev UI**:\r\n\n\n### Describe the problem\n\nAfter using mlflow for ~1 year, we've run into this difficult to reproduce bug several times where an experiment tab will show an INTERNAL_SERVER_ERROR and stops displaying the runs that were stored in that experiment.\r\n\r\nThis issue seems to come up when deleting one or multiple runs from an experiment, but it doesn't happen every time a delete is attempted. But it seems to usually happen on the first delete attempt in an experiment if it's going to fail... The delete command hangs longer than usual then prompts the INTERNAL_SERVER_ERROR.\r\n\r\n<img width=\"1624\" alt=\"Screen Shot 2022-07-26 at 4 30 40 PM\" src=\"https://user-images.githubusercontent.com/93339979/181131068-8ea76d64-f1a8-473d-8c4c-63b7e4d0fad0.png\">\r\n\r\nBesides a full fix, I would also be interested to learn if it's possible to retrieve the runs that were stored in the broken experiment.\n\n### Steps to reproduce the bug\n\nThis is inconsistently reproducible (and I apologize, I know that's not very helpful), but I logged 50-100 runs in a new experiment. Each run had 5 metrics with ~200 values. I then tried deleting a random amount of runs. Sometimes one or the whole page. Sometimes the experiment broke, but most times the delete executed no problem.\n\n### Code to generate data required to reproduce the bug\n\n```python\r\nimport mlflow\r\nimport boto3\r\nimport random\r\n\r\nMLFLOW_EXPERIMENT_NAME = \"break server\"\r\nif not mlflow.get_experiment_by_name(MLFLOW_EXPERIMENT_NAME):\r\n      mlflow.create_experiment(MLFLOW_EXPERIMENT_NAME)\r\nmlflow.set_experiment(MLFLOW_EXPERIMENT_NAME)\r\n\r\nmlflow.start_run()\r\n\r\nmlflow.log_param(\"number\", 1)\r\n\r\nrandomlist = random.sample(range(10, 500), 200)\r\nfor x in randomlist:\r\n  mlflow.log_metric(\"rand1\", x)\r\n  mlflow.log_metric(\"rand2\", x)\r\n  mlflow.log_metric(\"rand3\", x)\r\n  mlflow.log_metric(\"rand4\", x)\r\n  mlflow.log_metric(\"rand5\", x)\r\n\r\nmlflow.end_run()\r\n```\r\nI then ran this 50-100 times to fill the experiment with runs to delete.\n\n### Is the console panel in DevTools showing errors relevant to the bug?\n\n<img width=\"1680\" alt=\"Screen Shot 2022-07-26 at 5 19 29 PM\" src=\"https://user-images.githubusercontent.com/93339979/181134085-3bd23fb4-c985-488a-b823-ea6ec2cf296a.png\">\r\n\r\n```\r\nError: Promised response from onMessage listener went out of scope 5 [background.js:841:170](moz-extension://d6a7add6-de11-4239-898f-0a287b30c3e7/dist/background.js)\r\nXHR failed \r\nObject { readyState: 4, getResponseHeader: getResponseHeader(e), getAllResponseHeaders: getAllResponseHeaders(), setRequestHeader: setRequestHeader(e, t), overrideMimeType: overrideMimeType(e), statusCode: statusCode(e), abort: abort(e), state: state(), always: always(), catch: catch(e)\r\n, … }\r\n​\r\nabort: function abort(e)​\r\nalways: function always()​\r\ncatch: function catch(e)​\r\ndone: function add()​\r\nfail: function add()​\r\ngetAllResponseHeaders: function getAllResponseHeaders()​\r\ngetResponseHeader: function getResponseHeader(e)​\r\noverrideMimeType: function overrideMimeType(e)​\r\npipe: function pipe()​\r\nprogress: function add()​\r\npromise: function promise(e)\r\n​\r\nreadyState: 4\r\n​\r\nresponseText: \"<!DOCTYPE HTML PUBLIC \\\"-//W3C//DTD HTML 3.2 Final//EN\\\">\\n<title>500 Internal Server Error</title>\\n<h1>Internal Server Error</h1>\\n<p>The server encountered an internal error and was unable to complete your request. Either the server is overloaded or there is an error in the application.</p>\\n\"\r\n​\r\nsetRequestHeader: function setRequestHeader(e, t)​\r\nstate: function state()\r\n​\r\nstatus: 500\r\n​\r\nstatusCode: function statusCode(e)\r\n​\r\nstatusText: \"Internal Server Error\"\r\n​\r\nthen: function then(e, r, o)​\r\n<prototype>: Object { … }\r\n[main.895f3836.chunk.js:1:15852](https://mlwf-devel-server.mlflow.pnl.gov/static-files/static/js/main.895f3836.chunk.js)\r\n    error https://mlwf-devel-server.mlflow.pnl.gov/static-files/static/js/main.895f3836.chunk.js:1\r\n    l https://mlwf-devel-server.mlflow.pnl.gov/static-files/static/js/2.8c754ded.chunk.js:1\r\n    fireWith https://mlwf-devel-server.mlflow.pnl.gov/static-files/static/js/2.8c754ded.chunk.js:1\r\n    S https://mlwf-devel-server.mlflow.pnl.gov/static-files/static/js/2.8c754ded.chunk.js:1\r\n    t https://mlwf-devel-server.mlflow.pnl.gov/static-files/static/js/2.8c754ded.chunk.js:1\r\nObject { xhr: {…} }\r\n​\r\nxhr: Object { readyState: 4, getResponseHeader: getResponseHeader(e), getAllResponseHeaders: getAllResponseHeaders()\r\n, … }\r\n​​\r\nabort: function abort(e)​​\r\nalways: function always()​​\r\ncatch: function catch(e)​​\r\ndone: function add()​​\r\nfail: function add()​​\r\ngetAllResponseHeaders: function getAllResponseHeaders()​​\r\ngetResponseHeader: function getResponseHeader(e)​​\r\noverrideMimeType: function overrideMimeType(e)​​\r\npipe: function pipe()​​\r\nprogress: function add()​​\r\npromise: function promise(e)\r\n​​\r\nreadyState: 4\r\n​​\r\nresponseText: \"<!DOCTYPE HTML PUBLIC \\\"-//W3C//DTD HTML 3.2 Final//EN\\\">\\n<title>500 Internal Server Error</title>\\n<h1>Internal Server Error</h1>\\n<p>The server encountered an internal error and was unable to complete your request. Either the server is overloaded or there is an error in the application.</p>\\n\"\r\n​​\r\nsetRequestHeader: function setRequestHeader(e, t)​​\r\nstate: function state()\r\n​​\r\nstatus: 500\r\n​​\r\nstatusCode: function statusCode(e)\r\n​​\r\nstatusText: \"Internal Server Error\"\r\n​​\r\nthen: function then(e, r, o)​​\r\n<prototype>: Object { … }\r\n​\r\n<prototype>: Object { … }\r\n[main.895f3836.chunk.js:1:8885](https://mlwf-devel-server.mlflow.pnl.gov/static-files/static/js/main.895f3836.chunk.js)\r\n    value https://mlwf-devel-server.mlflow.pnl.gov/static-files/static/js/main.895f3836.chunk.js:1\r\n    value https://mlwf-devel-server.mlflow.pnl.gov/static-files/static/js/main.895f3836.chunk.js:1\r\n```\n\n### Does the network panel in DevTools contain failed requests relevant to the bug?\n\n<img width=\"1680\" alt=\"Screen Shot 2022-07-26 at 5 24 17 PM\" src=\"https://user-images.githubusercontent.com/93339979/181134493-6bcb6f07-3e8c-46e9-ba71-1ac1bff0c04c.png\">\r\n","closed_by":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/6339/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/6339/timeline","performed_via_github_app":null,"state_reason":"completed"}