{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1997","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/1997/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/1997/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/1997/events","html_url":"https://github.com/mlflow/mlflow/issues/1997","id":512825990,"node_id":"MDU6SXNzdWU1MTI4MjU5OTA=","number":1997,"title":"[BUG] h2o.log_model() does not work properly (wrong file type, no upload to S3) + a workaround","user":{"login":"mirekphd","id":36706320,"node_id":"MDQ6VXNlcjM2NzA2MzIw","avatar_url":"https://avatars.githubusercontent.com/u/36706320?v=4","gravatar_id":"","url":"https://api.github.com/users/mirekphd","html_url":"https://github.com/mirekphd","followers_url":"https://api.github.com/users/mirekphd/followers","following_url":"https://api.github.com/users/mirekphd/following{/other_user}","gists_url":"https://api.github.com/users/mirekphd/gists{/gist_id}","starred_url":"https://api.github.com/users/mirekphd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mirekphd/subscriptions","organizations_url":"https://api.github.com/users/mirekphd/orgs","repos_url":"https://api.github.com/users/mirekphd/repos","events_url":"https://api.github.com/users/mirekphd/events{/privacy}","received_events_url":"https://api.github.com/users/mirekphd/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022848043,"node_id":"MDU6TGFiZWwyMDIyODQ4MDQz","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/models","name":"area/models","color":"48eabc","default":false,"description":"MLmodel format, model serialization/deserialization, flavors"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2019-10-26T11:45:58Z","updated_at":"2020-11-04T21:59:12Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"The recommended method for persisting H2O models, `mlflow.h2o.log_model()`  does not work as expected. It does not upload (at least to an S3 bucket created by MinIO) any file reminiscent of a model file - neither in the internal binary H2O format or the JAVA MOJO / POJO model deployment file. All we see in MLflow Artifacts section or in the remote objects folder (say an S3 bucket accessed with the MinIO browser) is a YAML file `h2o.yaml` generated by MLflow and put into the `h2o.model` subfolder, with the following sample contents:\r\n```\r\nfull_file: /tmp/tmpw6agr_er/model/model.h2o/GBM_model_python_1572007960887_26750\r\nmodel_dir: /tmp/tmpw6agr_er/model/model.h2o\r\nmodel_file: GBM_model_python_1572007960887_26750\r\n\r\n```\r\nEven it this file was successfully uploaded (and it never does - as verified using dirrerent built-in H2O algos over 50+ runs), it would not be the correct one. These internal H2O model objects are way too slow for production (having latencies measured in seconds instead of ms even with the simplest of models). **The files we want persisted by MLflow are MOJO files** (which can for some time now be re-imported by H2O, at least for internal models, not yet xgboost).\r\n\r\nSo the workaround for the current version of mlflow (1.3) and a suggested solution to incorporate in its future versions is as follows:\r\n\r\n```\r\n# to archive models in case of H2O we use a workaround: calling h2o \r\n# function download_mojo() (which in R is in the h2o module, \r\n# but in python is in the model object itself) \r\nmodel.download_mojo(temp_folder+\"h2o-model-mojo.zip\")\r\n\r\n# after downloading mojo file, we treat it as an artifact\r\n# and log it using mlflow.log_artifact()\r\nmlflow.log_artifact(temp_folder+\"h2o-model-mojo.zip\", artifact_path=\"h2o-model-mojo\")\r\n```\r\n\r\n\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1997/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/1997/timeline","performed_via_github_app":null,"state_reason":null}