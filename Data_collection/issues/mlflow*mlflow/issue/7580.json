{"url":"https://api.github.com/repos/mlflow/mlflow/issues/7580","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/7580/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/7580/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/7580/events","html_url":"https://github.com/mlflow/mlflow/issues/7580","id":1506486988,"node_id":"I_kwDOCB5Jx85ZyyrM","number":7580,"title":"[BUG] MLFlow UI fails to load experiment artifacts stored in remote HDFS","user":{"login":"pwnywiz","id":11291967,"node_id":"MDQ6VXNlcjExMjkxOTY3","avatar_url":"https://avatars.githubusercontent.com/u/11291967?v=4","gravatar_id":"","url":"https://api.github.com/users/pwnywiz","html_url":"https://github.com/pwnywiz","followers_url":"https://api.github.com/users/pwnywiz/followers","following_url":"https://api.github.com/users/pwnywiz/following{/other_user}","gists_url":"https://api.github.com/users/pwnywiz/gists{/gist_id}","starred_url":"https://api.github.com/users/pwnywiz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pwnywiz/subscriptions","organizations_url":"https://api.github.com/users/pwnywiz/orgs","repos_url":"https://api.github.com/users/pwnywiz/repos","events_url":"https://api.github.com/users/pwnywiz/events{/privacy}","received_events_url":"https://api.github.com/users/pwnywiz/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022845866,"node_id":"MDU6TGFiZWwyMDIyODQ1ODY2","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/artifacts","name":"area/artifacts","color":"48eabc","default":false,"description":"Artifact stores and artifact logging"},{"id":2237250735,"node_id":"MDU6TGFiZWwyMjM3MjUwNzM1","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/server-infra","name":"area/server-infra","color":"48eabc","default":false,"description":"MLflow Tracking server backend"},{"id":4300304016,"node_id":"LA_kwDOCB5Jx88AAAABAFFukA","url":"https://api.github.com/repos/mlflow/mlflow/labels/has-closing-pr","name":"has-closing-pr","color":"fef2c0","default":false,"description":"This issue has a closing PR"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-12-21T15:29:13Z","updated_at":"2022-12-22T06:38:21Z","closed_at":"2022-12-22T06:38:21Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### Issues Policy acknowledgement\n\n- [X] I have read and agree to submit bug reports in accordance with the [issues policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md)\n\n### Willingness to contribute\n\nYes. I can contribute a fix for this bug independently.\n\n### MLflow version\n\n- Client: 2.0.1\r\n- Tracking server: 2.0.1\n\n### System information\n\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 20.04\r\n- **Python version**: 3.8\r\n- **yarn version, if running the dev UI**: -\r\n\n\n### Describe the problem\n\nAfter successfully logging artifacts to a remote HDFS server, when trying to inspect them through the MLFlow UI, it is not possible to load their contents.\r\nAs seen in the image below, the contents are located successfully, but cant be loaded properly.\r\n![Screenshot](https://user-images.githubusercontent.com/11291967/208936910-be513169-a749-4ac1-a6ee-04a1b44f5cec.png)\r\n\r\nThese are the server logs:\r\n`mlflow_tracking_server-artifacts-server-1  | PermissionError: [Errno 13] Opening HDFS file '/user/ichatzigianellis/mlflow/experiments/6/23788831488c4091b9008435390b8df9/artifacts/model/requirements.txt/requirements.txt' failed. Detail: [errno 13] Permission denied`\r\n\r\nIt seems that when `hdfs_artifact_repo.py` lists the hdfs contents, is not properly recognizing that the certain path is actually a file and tries to append the file name on top of the full path - hence the double requirements.txt in the error line.\n\n### Tracking information\n\n_No response_\n\n### Code to reproduce issue\n\nIt is a UI issue but here is a minimal configuration of the `docker compose` services\r\n\r\n```\r\nartifacts-server:\r\n  build:\r\n    context: .\r\n    dockerfile: \"${DOCKERFILE:-Dockerfile}\"\r\n  expose:\r\n    - \"5500\"\r\n  command: >\r\n    mlflow server --host 0.0.0.0 --port 5500 --artifacts-destination hdfs://XX:9000/path/to/mlflow --gunicorn-opts \"--log-level debug\" --serve-artifacts --artifacts-only\r\n\r\ntracking-server:\r\n    build:\r\n      context: .\r\n      dockerfile: \"${DOCKERFILE:-Dockerfile}\"\r\n    restart: always\r\n    depends_on:\r\n      - postgres\r\n      - artifacts-server\r\n    expose:\r\n      - \"5000\"\r\n    ports:\r\n      - \"5000:5000\"\r\n    command: >\r\n      mlflow server --host 0.0.0.0 --port 5000 --backend-store-uri postgresql://user:password@postgres:5432/db --default-artifact-root http://artifacts-server:5500/api/2.0/mlflow-artifacts/artifacts/experiments --gunicorn-opts \"--log-level debug\"\r\n```\n\n### Stack trace\n\n```\r\nmlflow_tracking_server-artifacts-server-1  | [2022-12-21 14:45:39 +0000] [27] [DEBUG] GET /api/2.0/mlflow-\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:524)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1025)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:876)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:822)\r\nmlflow_tracking_server-artifacts-server-1  |    at java.security.AccessController.doPrivileged(Native Method)\r\nmlflow_tracking_server-artifacts-server-1  |    at javax.security.auth.Subject.doAs(Subject.java:422)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1730)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2682)\r\nmlflow_tracking_server-artifacts-server-1  | org.apache.hadoop.security.AccessControlException: /user/ichatzigianellis/mlflow/experiments/6/23788831488c4091b9008435390b8df9/artifacts/model/requirements.txt (is not a directory)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.FSDirectory.resolvePath(FSDirectory.java:679)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.FSDirStatAndListingOp.getBlockLocations(FSDirStatAndListingOp.java:151)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getBlockLocations(FSNamesystem.java:1946)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.getBlockLocations(NameNodeRpcServer.java:739)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.getBlockLocations(ClientNamenodeProtocolServerSideTranslatorPB.java:432)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:524)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1025)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:876)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:822)\r\nmlflow_tracking_server-artifacts-server-1  |    at java.security.AccessController.doPrivileged(Native Method)\r\nmlflow_tracking_server-artifacts-server-1  |    at javax.security.auth.Subject.doAs(Subject.java:422)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1730)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2682)\r\nmlflow_tracking_server-artifacts-server-1  | \r\nmlflow_tracking_server-artifacts-server-1  |    at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\r\nmlflow_tracking_server-artifacts-server-1  |    at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\r\nmlflow_tracking_server-artifacts-server-1  |    at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\r\nmlflow_tracking_server-artifacts-server-1  |    at java.lang.reflect.Constructor.newInstance(Constructor.java:423)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:121)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:88)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DFSClient.callGetBlockLocations(DFSClient.java:879)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DFSClient.getLocatedBlocks(DFSClient.java:866)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DFSClient.getLocatedBlocks(DFSClient.java:855)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DFSClient.open(DFSClient.java:1023)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DistributedFileSystem$4.doCall(DistributedFileSystem.java:322)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DistributedFileSystem$4.doCall(DistributedFileSystem.java:318)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DistributedFileSystem.open(DistributedFileSystem.java:330)\r\nmlflow_tracking_server-artifacts-server-1  | Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.AccessControlException): /user/ichatzigianellis/mlflow/experiments/6/23788831488c4091b9008435390b8df9/artifacts/model/requirements.txt (is not a directory)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.FSDirectory.resolvePath(FSDirectory.java:679)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.FSDirStatAndListingOp.getBlockLocations(FSDirStatAndListingOp.java:151)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getBlockLocations(FSNamesystem.java:1946)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.getBlockLocations(NameNodeRpcServer.java:739)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.getBlockLocations(ClientNamenodeProtocolServerSideTranslatorPB.java:432)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:524)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1025)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:876)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:822)\r\nmlflow_tracking_server-artifacts-server-1  |    at java.security.AccessController.doPrivileged(Native Method)\r\nmlflow_tracking_server-artifacts-server-1  |    at javax.security.auth.Subject.doAs(Subject.java:422)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1730)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2682)\r\nmlflow_tracking_server-artifacts-server-1  | \r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Client.getRpcResponse(Client.java:1612)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Client.call(Client.java:1558)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Client.call(Client.java:1455)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:231)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:118)\r\nmlflow_tracking_server-artifacts-server-1  |    at com.sun.proxy.$Proxy9.getBlockLocations(Unknown Source)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolTranslatorPB.getBlockLocations(ClientNamenodeProtocolTranslatorPB.java:327)\r\nmlflow_tracking_server-artifacts-server-1  |    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\nmlflow_tracking_server-artifacts-server-1  |    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\nmlflow_tracking_server-artifacts-server-1  |    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\nmlflow_tracking_server-artifacts-server-1  |    at java.lang.reflect.Method.invoke(Method.java:498)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:433)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeMethod(RetryInvocationHandler.java:166)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invoke(RetryInvocationHandler.java:158)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeOnce(RetryInvocationHandler.java:96)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:362)\r\nmlflow_tracking_server-artifacts-server-1  |    at com.sun.proxy.$Proxy10.getBlockLocations(Unknown Source)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DFSClient.callGetBlockLocations(DFSClient.java:877)\r\nmlflow_tracking_server-artifacts-server-1  |    ... 7 more\r\nmlflow_tracking_server-artifacts-server-1  | /usr/local/lib/python3.8/site-packages/mlflow/store/artifact/hdfs_artifact_repo.py:199: FutureWarning: pyarrow.hdfs.connect is deprecated as of 2.0.0, please use pyarrow.fs.HadoopFileSystem instead.\r\nmlflow_tracking_server-artifacts-server-1  |   connected = pa.hdfs.connect(\r\nmlflow_tracking_server-artifacts-server-1  | 2022/12/21 14:45:39 ERROR mlflow.server: Exception on /api/2.0/mlflow-artifacts/artifacts/experiments/6/23788831488c4091b9008435390b8df9/artifacts/model/requirements.txt/requirements.txt [GET]\r\nmlflow_tracking_server-artifacts-server-1  | Traceback (most recent call last):\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/flask/app.py\", line 2525, in wsgi_app\r\nmlflow_tracking_server-artifacts-server-1  |     response = self.full_dispatch_request()\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/flask/app.py\", line 1822, in full_dispatch_request\r\nmlflow_tracking_server-artifacts-server-1  |     rv = self.handle_user_exception(e)\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/flask/app.py\", line 1820, in full_dispatch_request\r\nmlflow_tracking_server-artifacts-server-1  |     rv = self.dispatch_request()\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/flask/app.py\", line 1796, in dispatch_request\r\nmlflow_tracking_server-artifacts-server-1  |     return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/mlflow/server/handlers.py\", line 456, in wrapper\r\nmlflow_tracking_server-artifacts-server-1  |     return func(*args, **kwargs)\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/mlflow/server/handlers.py\", line 507, in wrapper\r\nmlflow_tracking_server-artifacts-server-1  |     return func(*args, **kwargs)\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/mlflow/server/handlers.py\", line 1478, in _download_artifact\r\nmlflow_tracking_server-artifacts-server-1  |     dst = artifact_repo.download_artifacts(artifact_path, tmp_dir.name)\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/mlflow/store/artifact/hdfs_artifact_repo.py\", line 151, in download_artifacts\r\nmlflow_tracking_server-artifacts-server-1  |     _download_hdfs_file(hdfs, hdfs_base_path, local_path)\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/mlflow/store/artifact/hdfs_artifact_repo.py\", line 248, in _download_hdfs_file\r\nmlflow_tracking_server-artifacts-server-1  |     f.write(hdfs.open(remote_file_path, \"rb\").read())\r\nmlflow_tracking_server-artifacts-server-1  |   File \"pyarrow/_hdfsio.pyx\", line 419, in pyarrow._hdfsio.HadoopFileSystem.open\r\nmlflow_tracking_server-artifacts-server-1  |   File \"pyarrow/error.pxi\", line 113, in pyarrow.lib.check_status\r\nmlflow_tracking_server-artifacts-server-1  | PermissionError: [Errno 13] Opening HDFS file '/user/ichatzigianellis/mlflow/experiments/6/23788831488c4091b9008435390b8df9/artifacts/model/requirements.txt/requirements.txt' failed. Detail: [errno 13] Permission denied\r\nmlflow_tracking_server-artifacts-server-1  | [2022-12-21 14:45:55 +0000] [27] [DEBUG] GET /api/2.0/mlflow-artifacts/artifacts/experiments/6/23788831488c4091b9008435390b8df9/artifacts/model/requirements.txt/requirements.txt\r\nmlflow_tracking_server-artifacts-server-1  | hdfsOpenFile(/user/ichatzigianellis/mlflow/experiments/6/23788831488c4091b9008435390b8df9/artifacts/model/requirements.txt/requirements.txt): FileSystem#open((Lorg/apache/hadoop/fs/Path;I)Lorg/apache/hadoop/fs/FSDataInputStream;) error:\r\nmlflow_tracking_server-artifacts-server-1  | RemoteException: /user/ichatzigianellis/mlflow/experiments/6/23788831488c4091b9008435390b8df9/artifacts/model/requirements.txt (is not a directory)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.FSDirectory.resolvePath(FSDirectory.java:679)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.FSDirStatAndListingOp.getBlockLocations(FSDirStatAndListingOp.java:151)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getBlockLocations(FSNamesystem.java:1946)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.getBlockLocations(NameNodeRpcServer.java:739)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.getBlockLocations(ClientNamenodeProtocolServerSideTranslatorPB.java:432)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:524)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1025)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:876)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:822)\r\nmlflow_tracking_server-artifacts-server-1  |    at java.security.AccessController.doPrivileged(Native Method)\r\nmlflow_tracking_server-artifacts-server-1  |    at javax.security.auth.Subject.doAs(Subject.java:422)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1730)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2682)\r\nmlflow_tracking_server-artifacts-server-1  | org.apache.hadoop.security.AccessControlException: /user/ichatzigianellis/mlflow/experiments/6/23788831488c4091b9008435390b8df9/artifacts/model/requirements.txt (is not a directory)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.FSDirectory.resolvePath(FSDirectory.java:679)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.FSDirStatAndListingOp.getBlockLocations(FSDirStatAndListingOp.java:151)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getBlockLocations(FSNamesystem.java:1946)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.getBlockLocations(NameNodeRpcServer.java:739)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.getBlockLocations(ClientNamenodeProtocolServerSideTranslatorPB.java:432)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:524)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1025)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:876)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:822)\r\nmlflow_tracking_server-artifacts-server-1  |    at java.security.AccessController.doPrivileged(Native Method)\r\nmlflow_tracking_server-artifacts-server-1  |    at javax.security.auth.Subject.doAs(Subject.java:422)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1730)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2682)\r\nmlflow_tracking_server-artifacts-server-1  | \r\nmlflow_tracking_server-artifacts-server-1  |    at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\r\nmlflow_tracking_server-artifacts-server-1  |    at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\r\nmlflow_tracking_server-artifacts-server-1  |    at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\r\nmlflow_tracking_server-artifacts-server-1  |    at java.lang.reflect.Constructor.newInstance(Constructor.java:423)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:121)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:88)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DFSClient.callGetBlockLocations(DFSClient.java:879)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DFSClient.getLocatedBlocks(DFSClient.java:866)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DFSClient.getLocatedBlocks(DFSClient.java:855)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DFSClient.open(DFSClient.java:1023)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DistributedFileSystem$4.doCall(DistributedFileSystem.java:322)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DistributedFileSystem$4.doCall(DistributedFileSystem.java:318)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DistributedFileSystem.open(DistributedFileSystem.java:330)\r\nmlflow_tracking_server-artifacts-server-1  | Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.AccessControlException): /user/ichatzigianellis/mlflow/experiments/6/23788831488c4091b9008435390b8df9/artifacts/model/requirements.txt (is not a directory)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.FSDirectory.resolvePath(FSDirectory.java:679)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.FSDirStatAndListingOp.getBlockLocations(FSDirStatAndListingOp.java:151)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getBlockLocations(FSNamesystem.java:1946)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.getBlockLocations(NameNodeRpcServer.java:739)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.getBlockLocations(ClientNamenodeProtocolServerSideTranslatorPB.java:432)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:524)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1025)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:876)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:822)\r\nmlflow_tracking_server-artifacts-server-1  |    at java.security.AccessController.doPrivileged(Native Method)\r\nmlflow_tracking_server-artifacts-server-1  |    at javax.security.auth.Subject.doAs(Subject.java:422)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1730)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2682)\r\nmlflow_tracking_server-artifacts-server-1  | \r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Client.getRpcResponse(Client.java:1612)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Client.call(Client.java:1558)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.Client.call(Client.java:1455)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:231)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:118)\r\nmlflow_tracking_server-artifacts-server-1  |    at com.sun.proxy.$Proxy9.getBlockLocations(Unknown Source)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolTranslatorPB.getBlockLocations(ClientNamenodeProtocolTranslatorPB.java:327)\r\nmlflow_tracking_server-artifacts-server-1  |    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\nmlflow_tracking_server-artifacts-server-1  |    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\nmlflow_tracking_server-artifacts-server-1  |    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\nmlflow_tracking_server-artifacts-server-1  |    at java.lang.reflect.Method.invoke(Method.java:498)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:433)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeMethod(RetryInvocationHandler.java:166)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invoke(RetryInvocationHandler.java:158)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeOnce(RetryInvocationHandler.java:96)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:362)\r\nmlflow_tracking_server-artifacts-server-1  |    at com.sun.proxy.$Proxy10.getBlockLocations(Unknown Source)\r\nmlflow_tracking_server-artifacts-server-1  |    at org.apache.hadoop.hdfs.DFSClient.callGetBlockLocations(DFSClient.java:877)\r\nmlflow_tracking_server-artifacts-server-1  |    ... 7 more\r\nmlflow_tracking_server-artifacts-server-1  | /usr/local/lib/python3.8/site-packages/mlflow/store/artifact/hdfs_artifact_repo.py:199: FutureWarning: pyarrow.hdfs.connect is deprecated as of 2.0.0, please use pyarrow.fs.HadoopFileSystem instead.\r\nmlflow_tracking_server-artifacts-server-1  |   connected = pa.hdfs.connect(\r\nmlflow_tracking_server-artifacts-server-1  | 2022/12/21 14:45:56 ERROR mlflow.server: Exception on /api/2.0/mlflow-artifacts/artifacts/experiments/6/23788831488c4091b9008435390b8df9/artifacts/model/requirements.txt/requirements.txt [GET]\r\nmlflow_tracking_server-artifacts-server-1  | Traceback (most recent call last):\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/flask/app.py\", line 2525, in wsgi_app\r\nmlflow_tracking_server-artifacts-server-1  |     response = self.full_dispatch_request()\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/flask/app.py\", line 1822, in full_dispatch_request\r\nmlflow_tracking_server-artifacts-server-1  |     rv = self.handle_user_exception(e)\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/flask/app.py\", line 1820, in full_dispatch_request\r\nmlflow_tracking_server-artifacts-server-1  |     rv = self.dispatch_request()\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/flask/app.py\", line 1796, in dispatch_request\r\nmlflow_tracking_server-artifacts-server-1  |     return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/mlflow/server/handlers.py\", line 456, in wrapper\r\nmlflow_tracking_server-artifacts-server-1  |     return func(*args, **kwargs)\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/mlflow/server/handlers.py\", line 507, in wrapper\r\nmlflow_tracking_server-artifacts-server-1  |     return func(*args, **kwargs)\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/mlflow/server/handlers.py\", line 1478, in _download_artifact\r\nmlflow_tracking_server-artifacts-server-1  |     dst = artifact_repo.download_artifacts(artifact_path, tmp_dir.name)\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/mlflow/store/artifact/hdfs_artifact_repo.py\", line 151, in download_artifacts\r\nmlflow_tracking_server-artifacts-server-1  |     _download_hdfs_file(hdfs, hdfs_base_path, local_path)\r\nmlflow_tracking_server-artifacts-server-1  |   File \"/usr/local/lib/python3.8/site-packages/mlflow/store/artifact/hdfs_artifact_repo.py\", line 248, in _download_hdfs_file\r\nmlflow_tracking_server-artifacts-server-1  |     f.write(hdfs.open(remote_file_path, \"rb\").read())\r\nmlflow_tracking_server-artifacts-server-1  |   File \"pyarrow/_hdfsio.pyx\", line 419, in pyarrow._hdfsio.HadoopFileSystem.open\r\nmlflow_tracking_server-artifacts-server-1  |   File \"pyarrow/error.pxi\", line 113, in pyarrow.lib.check_status\r\nmlflow_tracking_server-artifacts-server-1  | PermissionError: [Errno 13] Opening HDFS file '/user/ichatzigianellis/mlflow/experiments/6/23788831488c4091b9008435390b8df9/artifacts/model/requirements.txt/requirements.txt' failed. Detail: [errno 13] Permission denied\r\n```\n\n### Other info / logs\n\n_No response_\n\n### What component(s) does this bug affect?\n\n- [x] `area/artifacts`: Artifact stores and artifact logging\n- [ ] `area/build`: Build and test infrastructure for MLflow\n- [ ] `area/docs`: MLflow documentation pages\n- [ ] `area/examples`: Example code\n- [ ] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\n- [ ] `area/recipes`: Recipes, Recipe APIs, Recipe configs, Recipe Templates\n- [ ] `area/projects`: MLproject format, project running backends\n- [ ] `area/scoring`: MLflow Model server, model deployment tools, Spark UDFs\n- [x] `area/server-infra`: MLflow Tracking server backend\n- [ ] `area/tracking`: Tracking Service, tracking client APIs, autologging\n\n### What interface(s) does this bug affect?\n\n- [ ] `area/uiux`: Front-end, user experience, plotting, JavaScript, JavaScript dev server\n- [ ] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\n- [ ] `area/windows`: Windows support\n\n### What language(s) does this bug affect?\n\n- [ ] `language/r`: R APIs and clients\n- [ ] `language/java`: Java APIs and clients\n- [ ] `language/new`: Proposals for new client languages\n\n### What integration(s) does this bug affect?\n\n- [ ] `integrations/azure`: Azure and Azure ML integrations\n- [ ] `integrations/sagemaker`: SageMaker integrations\n- [ ] `integrations/databricks`: Databricks integrations","closed_by":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/7580/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/7580/timeline","performed_via_github_app":null,"state_reason":"completed"}