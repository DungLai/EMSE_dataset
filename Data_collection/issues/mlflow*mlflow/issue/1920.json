{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1920","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/1920/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/1920/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/1920/events","html_url":"https://github.com/mlflow/mlflow/issues/1920","id":505081933,"node_id":"MDU6SXNzdWU1MDUwODE5MzM=","number":1920,"title":"[BUG] Cannot Build a Docker Image with a private network","user":{"login":"pandae7","id":52786222,"node_id":"MDQ6VXNlcjUyNzg2MjIy","avatar_url":"https://avatars.githubusercontent.com/u/52786222?v=4","gravatar_id":"","url":"https://api.github.com/users/pandae7","html_url":"https://github.com/pandae7","followers_url":"https://api.github.com/users/pandae7/followers","following_url":"https://api.github.com/users/pandae7/following{/other_user}","gists_url":"https://api.github.com/users/pandae7/gists{/gist_id}","starred_url":"https://api.github.com/users/pandae7/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pandae7/subscriptions","organizations_url":"https://api.github.com/users/pandae7/orgs","repos_url":"https://api.github.com/users/pandae7/repos","events_url":"https://api.github.com/users/pandae7/events{/privacy}","received_events_url":"https://api.github.com/users/pandae7/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022851725,"node_id":"MDU6TGFiZWwyMDIyODUxNzI1","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/docker","name":"area/docker","color":"ede978","default":false,"description":"Docker use anywhere, such as MLprojects and MLmodels"},{"id":2022863969,"node_id":"MDU6TGFiZWwyMDIyODYzOTY5","url":"https://api.github.com/repos/mlflow/mlflow/labels/priority/important-soon","name":"priority/important-soon","color":"534cb5","default":false,"description":"The issue is worked on by the community currently or will be very soon, ideally in time for the"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2019-10-10T07:12:33Z","updated_at":"2022-06-02T01:17:56Z","closed_at":"2022-06-02T01:17:56Z","author_association":"NONE","active_lock_reason":null,"body":"Thank you for submitting an issue. Please refer to our [issue policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md)\r\nfor information on what types of issues we address. For help with debugging your code, please refer to [Stack Overflow](https://stackoverflow.com/questions/tagged/mlflow).\r\n\r\nPlease fill in this template and do not delete it unless you are sure your issue is outside its scope.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: Yes, a Minor change\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 16.04 \r\n- **MLflow installed from (source or binary)**: Source\r\n- **MLflow version (run ``mlflow --version``)**: 1.3.0\r\n- **Python version**: 3.7\r\n- **npm version, if running the dev UI**:\r\n- **Exact command to reproduce**: mlflow models build-docker -m (uri to the MLmodel file)\r\n\r\n### Describe the problem\r\nWe are trying to build a docker image of a model using a private network, . We made changes in the MLflow backend in the dockerfile_template in Docker_utils.py file according to our needs but still we get the following error when the Daemon run **Run pip install mlflow==1.3.0**\r\n\r\n```\r\nStep 12/18 : RUN pip install mlflow==1.3.0\r\n ---> Running in c768df4081d8\r\nCollecting mlflow==1.3.0\r\n  WARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLError(\"bad handshake: Error([('SSL routines', 'tls_process_server_certificate', 'certificate verify failed')])\"))': /simple/mlflow/\r\n  WARNING: Retrying (Retry(total=3, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLError(\"bad handshake: Error([('SSL routines', 'tls_process_server_certificate', 'certificate verify failed')])\"))': /simple/mlflow/\r\n  WARNING: Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLError(\"bad handshake: Error([('SSL routines', 'tls_process_server_certificate', 'certificate verify failed')])\"))': /simple/mlflow/\r\n  WARNING: Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLError(\"bad handshake: Error([('SSL routines', 'tls_process_server_certificate', 'certificate verify failed')])\"))': /simple/mlflow/\r\n  WARNING: Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLError(\"bad handshake: Error([('SSL routines', 'tls_process_server_certificate', 'certificate verify failed')])\"))': /simple/mlflow/\r\n  Could not fetch URL https://pypi.org/simple/mlflow/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host='pypi.org', port=443): Max retries exceeded with url: /simple/mlflow/ (Caused by SSLError(SSLError(\"bad handshake: Error([('SSL routines', 'tls_process_server_certificate', 'certificate verify failed')])\"))) - skipping\r\n  ERROR: Could not find a version that satisfies the requirement mlflow==1.3.0 (from versions: none)\r\nERROR: No matching distribution found for mlflow==1.3.0\r\nCould not fetch URL https://pypi.org/simple/pip/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host='pypi.org', port=443): Max retries exceeded with url: /simple/pip/ (Caused by SSLError(SSLError(\"bad handshake: Error([('SSL routines', 'tls_process_server_certificate', 'certificate verify failed')])\"))) - skipping\r\nThe command '/bin/sh -c pip install mlflow==1.3.0' returned a non-zero code: 1\r\n127.0.0.1 - - [10/Oct/2019 11:48:08] \"GET / HTTP/1.1\" 200 -\r\n^Z\r\n[1]+  Stopped\r\n```\r\n\r\n### Code to reproduce issue\r\nDocker file template after our changes - \r\n\r\n```\r\n_DOCKERFILE_TEMPLATE = \"\"\"\r\nBuild an image that can serve mlflow models.\r\nFROM ubuntu:16.04\r\n\r\nCOPY . /home/pandae/ZscalerRootCertificate-***********.crt\r\nCOPY . /home/pandae/ca-certificates\r\nCMD update-ca-certificates --fresh\r\n\r\nRUN apt-get -y update && apt-get install -y --no-install-recommends \\\r\n         wget \\\r\n         curl \\\r\n         nginx \\\r\n         ca-certificates \\\r\n         bzip2 \\\r\n         build-essential \\\r\n         cmake \\\r\n         openjdk-8-jdk \\\r\n         git-core \\\r\n         maven \\\r\n    && rm -rf /var/lib/apt/lists/*\r\n\r\n# Download and setup miniconda\r\nRUN curl https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh >> miniconda.sh -k\r\nRUN bash ./miniconda.sh -b -p /miniconda; rm ./miniconda.sh;\r\nENV PATH=\"/miniconda/bin:$PATH\"\r\nENV JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64\r\nENV GUNICORN_CMD_ARGS=\"--timeout 60 -k gevent\"\r\n\r\n# Set up the program in the image\r\nWORKDIR /opt/mlflow\r\n\r\n{install_mlflow}\r\n\r\n{custom_setup_steps}\r\n{entrypoint}\r\n\"\"\"\r\n```\r\n\r\nwhat am I doing wrong here?\r\nFor pip to install any packages from the net we have to provide that particular certificate, Right now the issue is I'm having a tough time figuring it out to where exactly to put that certificate so that pip can access it while building the image\r\n","closed_by":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1920/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/1920/timeline","performed_via_github_app":null,"state_reason":"completed"}