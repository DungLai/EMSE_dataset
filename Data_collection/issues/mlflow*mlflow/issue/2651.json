{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2651","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2651/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2651/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2651/events","html_url":"https://github.com/mlflow/mlflow/issues/2651","id":590596110,"node_id":"MDU6SXNzdWU1OTA1OTYxMTA=","number":2651,"title":"cannot reuse deleted experiment names","user":{"login":"jeremyjordan","id":13970565,"node_id":"MDQ6VXNlcjEzOTcwNTY1","avatar_url":"https://avatars.githubusercontent.com/u/13970565?v=4","gravatar_id":"","url":"https://api.github.com/users/jeremyjordan","html_url":"https://github.com/jeremyjordan","followers_url":"https://api.github.com/users/jeremyjordan/followers","following_url":"https://api.github.com/users/jeremyjordan/following{/other_user}","gists_url":"https://api.github.com/users/jeremyjordan/gists{/gist_id}","starred_url":"https://api.github.com/users/jeremyjordan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeremyjordan/subscriptions","organizations_url":"https://api.github.com/users/jeremyjordan/orgs","repos_url":"https://api.github.com/users/jeremyjordan/repos","events_url":"https://api.github.com/users/jeremyjordan/events{/privacy}","received_events_url":"https://api.github.com/users/jeremyjordan/received_events","type":"User","site_admin":false},"labels":[{"id":955449434,"node_id":"MDU6TGFiZWw5NTU0NDk0MzQ=","url":"https://api.github.com/repos/mlflow/mlflow/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"},{"id":2022849295,"node_id":"MDU6TGFiZWwyMDIyODQ5Mjk1","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/tracking","name":"area/tracking","color":"48eabc","default":false,"description":"Tracking service, tracking client APIs, autologging"},{"id":2022865338,"node_id":"MDU6TGFiZWwyMDIyODY1MzM4","url":"https://api.github.com/repos/mlflow/mlflow/labels/priority/important-longterm","name":"priority/important-longterm","color":"534cb5","default":false,"description":"Important over the long term, but may not be staffed or may need multiple releases to complete."},{"id":2029592925,"node_id":"MDU6TGFiZWwyMDI5NTkyOTI1","url":"https://api.github.com/repos/mlflow/mlflow/labels/needs%20review","name":"needs review","color":"7aa0d6","default":false,"description":"Pull request is ready for code review"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":14,"created_at":"2020-03-30T21:06:21Z","updated_at":"2022-12-06T04:44:29Z","closed_at":"2022-12-06T04:44:29Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Thank you for submitting an issue. Please refer to our [issue policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md)\r\nfor information on what types of issues we address. For help with debugging your code, please refer to [Stack Overflow](https://stackoverflow.com/questions/tagged/mlflow).\r\n\r\nPlease fill in this template and do not delete it unless you are sure your issue is outside its scope.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Debian GNU/Linux 10 (buster)\r\n- **MLflow installed from (source or binary)**: PyPi binary\r\n- **MLflow version (run ``mlflow --version``)**: mlflow==1.7.2\r\n- **Python version**: Python 3.7.6\r\n- **npm version, if running the dev UI**: n/a\r\n- **Exact command to reproduce**: See code to reproduce.\r\n\r\n### Describe the problem\r\nDescribe the problem clearly here. Include descriptions of the expected behavior and the actual behavior.\r\n\r\n### Code to reproduce issue\r\n\r\n```\r\nPython 3.7.6 (default, Jan  8 2020, 19:59:22) \r\n[GCC 7.3.0] :: Anaconda, Inc. on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import mlflow\r\n>>> mlflow_client = mlflow.tracking.MlflowClient('./mlruns')\r\n>>> experiment = mlflow_client.create_experiment('test')\r\n>>> mlflow_client.list_experiments()\r\n[<Experiment: artifact_location='./mlruns/0', experiment_id='0', lifecycle_stage='active', name='Default', tags={}>, <Experiment: artifact_location='./mlruns/1', experiment_id='1', lifecycle_stage='active', name='test', tags={}>]\r\n>>> mlflow.delete_experiment('1')\r\n>>> mlflow_client.list_experiments()\r\n[<Experiment: artifact_location='./mlruns/0', experiment_id='0', lifecycle_stage='active', name='Default', tags={}>]\r\n>>> quit()\r\n(base) root@a0ab3fe52510:/workdir# mlflow gc --backend-store-uri ./mlruns\r\n(base) root@a0ab3fe52510:/workdir# python\r\nPython 3.7.6 (default, Jan  8 2020, 19:59:22) \r\n[GCC 7.3.0] :: Anaconda, Inc. on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import mlflow\r\n>>> mlflow_client = mlflow.tracking.MlflowClient('./mlruns')\r\n>>> mlflow_client.list_experiments()\r\n[<Experiment: artifact_location='./mlruns/0', experiment_id='0', lifecycle_stage='active', name='Default', tags={}>]\r\n>>> experiment = mlflow_client.create_experiment('test')\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/opt/conda/lib/python3.7/site-packages/mlflow/tracking/client.py\", line 161, in create_experiment\r\n    return self._tracking_client.create_experiment(name, artifact_location)\r\n  File \"/opt/conda/lib/python3.7/site-packages/mlflow/tracking/_tracking_service/client.py\", line 128, in create_experiment\r\n    artifact_location=artifact_location,\r\n  File \"/opt/conda/lib/python3.7/site-packages/mlflow/store/tracking/file_store.py\", line 239, in create_experiment\r\n    self._validate_experiment_name(name)\r\n  File \"/opt/conda/lib/python3.7/site-packages/mlflow/store/tracking/file_store.py\", line 232, in _validate_experiment_name\r\n    databricks_pb2.RESOURCE_ALREADY_EXISTS)\r\nmlflow.exceptions.MlflowException: Experiment 'test' already exists in deleted state. You can restore the experiment, or permanently delete the experiment from the .trash folder (under tracking server's root folder) in order to use this experiment name again.\r\n```\r\n\r\nThis error message is fine and provides a solution when using a filesystem-based backend store. However, if I use a database-based backend store I cannot resolve the issue. \r\n\r\n```\r\n>>> import mlflow\r\n>>> MLFLOW_TRACKING_SERVER = # IP address of the tracking server\r\n>>> mlflow_client = mlflow.tracking.MlflowClient(MLFLOW_TRACKING_SERVER)\r\n>>> mlflow_client.list_experiments()\r\n[<Experiment: artifact_location='s3://bucket/project/mlflow/0', experiment_id='0', lifecycle_stage='active', name='Default', tags={}>, <Experiment: artifact_location='s3://bucket/project/mlflow/5', experiment_id='5', lifecycle_stage='active', name='tests', tags={}>]\r\n>>> experiment = mlflow_client.create_experiment('testing')\r\n>>> mlflow_client.list_experiments()\r\n[<Experiment: artifact_location='s3://bucket/project/mlflow/0', experiment_id='0', lifecycle_stage='active', name='Default', tags={}>, <Experiment: artifact_location='s3://bucket/project/mlflow/5', experiment_id='5', lifecycle_stage='active', name='tests', tags={}>, <Experiment: artifact_location='s3://bucket/project/mlflow/6', experiment_id='6', lifecycle_stage='active', name='testing', tags={}>]\r\n>>> mlflow.delete_experiment('6')\r\n>>> mlflow_client.list_experiments()\r\n[<Experiment: artifact_location='s3://bucket/project/mlflow/0', experiment_id='0', lifecycle_stage='active', name='Default', tags={}>, <Experiment: artifact_location='s3://bucket/project/mlflow/5', experiment_id='5', lifecycle_stage='active', name='tests', tags={}>]\r\n>>> experiment = mlflow_client.create_experiment('testing')\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/opt/conda/lib/python3.7/site-packages/mlflow/tracking/client.py\", line 161, in create_experiment\r\n    return self._tracking_client.create_experiment(name, artifact_location)\r\n  File \"/opt/conda/lib/python3.7/site-packages/mlflow/tracking/_tracking_service/client.py\", line 128, in create_experiment\r\n    artifact_location=artifact_location,\r\n  File \"/opt/conda/lib/python3.7/site-packages/mlflow/store/tracking/rest_store.py\", line 54, in create_experiment\r\n    response_proto = self._call_endpoint(CreateExperiment, req_body)\r\n  File \"/opt/conda/lib/python3.7/site-packages/mlflow/store/tracking/rest_store.py\", line 32, in _call_endpoint\r\n    return call_endpoint(self.get_host_creds(), endpoint, method, json_body, response_proto)\r\n  File \"/opt/conda/lib/python3.7/site-packages/mlflow/utils/rest_utils.py\", line 137, in call_endpoint\r\n    response = verify_rest_response(response, endpoint)\r\n  File \"/opt/conda/lib/python3.7/site-packages/mlflow/utils/rest_utils.py\", line 103, in verify_rest_response\r\n    raise RestException(json.loads(response.text))\r\nmlflow.exceptions.RestException: RESOURCE_ALREADY_EXISTS: Experiment(name=testing) already exists. Error: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)\r\n(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint \"experiments_name_key\"\r\nDETAIL:  Key (name)=(testing) already exists.\r\n\r\n[SQL: INSERT INTO experiments (name, artifact_location, lifecycle_stage) VALUES (%(name)s, %(artifact_location)s, %(lifecycle_stage)s) RETURNING experiments.experiment_id]\r\n[parameters: {'name': 'testing', 'artifact_location': '', 'lifecycle_stage': 'active'}]\r\n(Background on this error at: http://sqlalche.me/e/gkpj)\r\n```","closed_by":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2651/reactions","total_count":12,"+1":12,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2651/timeline","performed_via_github_app":null,"state_reason":"completed"}