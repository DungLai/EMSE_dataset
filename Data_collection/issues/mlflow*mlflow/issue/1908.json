{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1908","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/1908/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/1908/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/1908/events","html_url":"https://github.com/mlflow/mlflow/issues/1908","id":503035817,"node_id":"MDU6SXNzdWU1MDMwMzU4MTc=","number":1908,"title":"[BUG] Can't log artifacts or run a basic command 'RESOURCE_DOES_NOT_EXIST'","user":{"login":"aatmane","id":24759918,"node_id":"MDQ6VXNlcjI0NzU5OTE4","avatar_url":"https://avatars.githubusercontent.com/u/24759918?v=4","gravatar_id":"","url":"https://api.github.com/users/aatmane","html_url":"https://github.com/aatmane","followers_url":"https://api.github.com/users/aatmane/followers","following_url":"https://api.github.com/users/aatmane/following{/other_user}","gists_url":"https://api.github.com/users/aatmane/gists{/gist_id}","starred_url":"https://api.github.com/users/aatmane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aatmane/subscriptions","organizations_url":"https://api.github.com/users/aatmane/orgs","repos_url":"https://api.github.com/users/aatmane/repos","events_url":"https://api.github.com/users/aatmane/events{/privacy}","received_events_url":"https://api.github.com/users/aatmane/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-10-06T00:59:49Z","updated_at":"2019-10-07T16:23:14Z","closed_at":"2019-10-07T16:23:14Z","author_association":"NONE","active_lock_reason":null,"body":"Thank you for submitting an issue. Please refer to our [issue policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md)\r\nfor information on what types of issues we address. For help with debugging your code, please refer to [Stack Overflow](https://stackoverflow.com/questions/tagged/mlflow).\r\n\r\nPlease fill in this template and do not delete it unless you are sure your issue is outside its scope.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: no\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: \r\nDocker container running on Linux Redhat 7.2\r\n- **MLflow installed from (source or binary)**: pip install mlflow\r\n- **MLflow version (run ``mlflow --version``)**: 1.3.0\r\n- **Python version**: 3.6.5 (anaconda)\r\n- **npm version, if running the dev UI**:\r\n- **Exact command to reproduce**:\r\n\r\n### Describe the problem\r\nDescribe the problem clearly here. Include descriptions of the expected behavior and the actual behavior.\r\n\r\nI a running mlflow in a Docker container, hosted in Kubernetes. I have also setup a S3 bucket (scality, self hosted) to log artifacts.\r\n\r\nI am unable to log artifacts or just run basic commands from my PC (Win 10, python client.\r\nWhile it works fine from the Docker container or from Kubernetes directly.\r\nHere below are the details of the scripts and tests performed.\r\n\r\n### Code to reproduce issue\r\nProvide a reproducible test case that is the bare minimum necessary to generate the problem.\r\nSERVER:\r\nI set those local variables:\r\nMLFLOW_S3_ENDPOINT_URL=http://s3endpoint\r\nMLFLOW_TRACKING_URI=http://localhost:5000\r\n\r\nmlflow server -h 0.0.0.0 --artifact-root s3://mybucket\r\n\r\n\r\nCLIENT:\r\nI set those local variables:\r\nMLFLOW_S3_ENDPOINT_URL=http://s3endpoint\r\nMLFLOW_TRACKING_URI=http://mytrackingserver\r\n\r\nPython Script:\r\nimport mlflow\r\nimport mlflow.tracking\r\nprint(mlflow.get_tracking_uri()) --> this returns the correct path to S3\r\n\r\nmlfow.start_run()\r\nprint(mlflow.get_artifact_uri()) \r\nmlflow.log_artifact('file.csv')\r\nmlfow.end_run()\r\n\r\n\r\n1) S3 testing\r\nI confirmed S3 bucket can be accessed to read and write data with the commands below, run in the Docker container locally on my PC and also in Kubernetes directly:\r\n\r\naws --endpoint-url=http://myurl s3 ls s3://mybucket\r\naws --endpoint-url=http://myurl s3 cp file.txt s3://mybucket\r\n\r\n2) MLflow API testing\r\nThe above python script runs fine on the Docker container running locally on my PC and in Kubernetes. So this proves S3 is ok as well as mlflow on the Docker container.\r\n\r\nBut it fails with the errors below when I run the python script from my PC (Win 10) against the tracking server running in Kubernetes (MLFLOW_TRACKING_URI=http://mytrackingserver).\r\n\r\nIt looks like both those commands are failing:\r\nprint(mlflow.get_artifact_uri()) \r\nmlflow.log_artifact('file.csv')\r\n\r\n### Other info / logs\r\nInclude any logs or source code that would be helpful to diagnose the problem. If including tracebacks,\r\nplease include the full traceback. Large logs and files should be attached.\r\n\r\nERROR LOGS:\r\n\r\nTraceback (most recent call last):\r\n  File \"mltest.py\", line 14, in <module>\r\n    print(mlflow.get_artifact_uri())\r\n  File \"C:\\HOMEWARE\\Miniconda3-Windows-x86_64\\lib\\site-packages\\mlflow\\tracking\\fluent.py\", line 337, in get_artifact_uri\r\n    artifact_path=artifact_path)\r\n  File \"C:\\HOMEWARE\\Miniconda3-Windows-x86_64\\lib\\site-packages\\mlflow\\tracking\\artifact_utils.py\", line 37, in get_artifact_uri\r\n    run = store.get_run(run_id)\r\n  File \"C:\\HOMEWARE\\Miniconda3-Windows-x86_64\\lib\\site-packages\\mlflow\\store\\rest_store.py\", line 129, in get_run\r\n    response_proto = self._call_endpoint(GetRun, req_body)\r\n  File \"C:\\HOMEWARE\\Miniconda3-Windows-x86_64\\lib\\site-packages\\mlflow\\store\\rest_store.py\", line 65, in _call_endpoint\r\n    response = self._verify_rest_response(response, endpoint)\r\n  File \"C:\\HOMEWARE\\Miniconda3-Windows-x86_64\\lib\\site-packages\\mlflow\\store\\rest_store.py\", line 48, in _verify_rest_response\r\n    return verify_rest_response(response, endpoint)\r\n  File \"C:\\HOMEWARE\\Miniconda3-Windows-x86_64\\lib\\site-packages\\mlflow\\utils\\rest_utils.py\", line 103, in verify_rest_response\r\n    raise RestException(json.loads(response.text))\r\nmlflow.exceptions.RestException: RESOURCE_DOES_NOT_EXIST: Run 'b88c7eb8e3024a0f9e5647d7920ccb98' not found\r\nError in atexit._run_exitfuncs:\r\nTraceback (most recent call last):\r\n  File \"C:\\HOMEWARE\\Miniconda3-Windows-x86_64\\lib\\site-packages\\mlflow\\tracking\\fluent.py\", line 163, in end_run\r\n    MlflowClient().set_terminated(_active_run_stack[-1].info.run_id, status)\r\n  File \"C:\\HOMEWARE\\Miniconda3-Windows-x86_64\\lib\\site-packages\\mlflow\\tracking\\client.py\", line 305, in set_terminated\r\n    end_time=end_time)\r\n  File \"C:\\HOMEWARE\\Miniconda3-Windows-x86_64\\lib\\site-packages\\mlflow\\store\\rest_store.py\", line 136, in update_run_info\r\n    response_proto = self._call_endpoint(UpdateRun, req_body)\r\n  File \"C:\\HOMEWARE\\Miniconda3-Windows-x86_64\\lib\\site-packages\\mlflow\\store\\rest_store.py\", line 65, in _call_endpoint\r\n    response = self._verify_rest_response(response, endpoint)\r\n  File \"C:\\HOMEWARE\\Miniconda3-Windows-x86_64\\lib\\site-packages\\mlflow\\store\\rest_store.py\", line 48, in _verify_rest_response\r\n    return verify_rest_response(response, endpoint)\r\n  File \"C:\\HOMEWARE\\Miniconda3-Windows-x86_64\\lib\\site-packages\\mlflow\\utils\\rest_utils.py\", line 103, in verify_rest_response\r\n    raise RestException(json.loads(response.text))\r\nmlflow.exceptions.RestException: RESOURCE_DOES_NOT_EXIST: Run 'b88c7eb8e3024a0f9e5647d7920ccb98' not found\r\n\r\n \r\n\r\n","closed_by":{"login":"aatmane","id":24759918,"node_id":"MDQ6VXNlcjI0NzU5OTE4","avatar_url":"https://avatars.githubusercontent.com/u/24759918?v=4","gravatar_id":"","url":"https://api.github.com/users/aatmane","html_url":"https://github.com/aatmane","followers_url":"https://api.github.com/users/aatmane/followers","following_url":"https://api.github.com/users/aatmane/following{/other_user}","gists_url":"https://api.github.com/users/aatmane/gists{/gist_id}","starred_url":"https://api.github.com/users/aatmane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aatmane/subscriptions","organizations_url":"https://api.github.com/users/aatmane/orgs","repos_url":"https://api.github.com/users/aatmane/repos","events_url":"https://api.github.com/users/aatmane/events{/privacy}","received_events_url":"https://api.github.com/users/aatmane/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1908/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/1908/timeline","performed_via_github_app":null,"state_reason":"completed"}