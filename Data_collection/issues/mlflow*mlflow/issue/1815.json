{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1815","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/1815/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/1815/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/1815/events","html_url":"https://github.com/mlflow/mlflow/issues/1815","id":489689950,"node_id":"MDU6SXNzdWU0ODk2ODk5NTA=","number":1815,"title":"How to store artifacts on a server running MLflow instead of the mlruns directory in local server","user":{"login":"cyrilthank","id":4562436,"node_id":"MDQ6VXNlcjQ1NjI0MzY=","avatar_url":"https://avatars.githubusercontent.com/u/4562436?v=4","gravatar_id":"","url":"https://api.github.com/users/cyrilthank","html_url":"https://github.com/cyrilthank","followers_url":"https://api.github.com/users/cyrilthank/followers","following_url":"https://api.github.com/users/cyrilthank/following{/other_user}","gists_url":"https://api.github.com/users/cyrilthank/gists{/gist_id}","starred_url":"https://api.github.com/users/cyrilthank/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cyrilthank/subscriptions","organizations_url":"https://api.github.com/users/cyrilthank/orgs","repos_url":"https://api.github.com/users/cyrilthank/repos","events_url":"https://api.github.com/users/cyrilthank/events{/privacy}","received_events_url":"https://api.github.com/users/cyrilthank/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1554650079,"node_id":"MDU6TGFiZWwxNTU0NjUwMDc5","url":"https://api.github.com/repos/mlflow/mlflow/labels/stale","name":"stale","color":"828282","default":false,"description":""},{"id":2022845866,"node_id":"MDU6TGFiZWwyMDIyODQ1ODY2","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/artifacts","name":"area/artifacts","color":"48eabc","default":false,"description":"Artifact stores and artifact logging"},{"id":2022863969,"node_id":"MDU6TGFiZWwyMDIyODYzOTY5","url":"https://api.github.com/repos/mlflow/mlflow/labels/priority/important-soon","name":"priority/important-soon","color":"534cb5","default":false,"description":"The issue is worked on by the community currently or will be very soon, ideally in time for the"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":23,"created_at":"2019-09-05T11:21:18Z","updated_at":"2022-09-14T07:56:20Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Thank you for submitting an issue. Please refer to our [issue policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md)\r\nfor information on what types of issues we address. For help with debugging your code, please refer to [Stack Overflow](https://stackoverflow.com/questions/tagged/mlflow).\r\n\r\nPlease fill in this template and do not delete it unless you are sure your issue is outside its scope.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**:\r\n OS Platform and Distribution (e.g., Linux Ubuntu 16.04):\r\nLinux Ubuntu 18.04\r\nMLflow installed from (source or binary):\r\nBinary\r\nMLflow version (run mlflow --version):\r\n1.2.0\r\nPython version:\r\n3.7.3\r\nnpm version, if running the dev UI:\r\nExact command to reproduce:\r\n\r\n### Describe the problem\r\nUnable to store\r\n\r\n### Code to reproduce issue\r\nHi\r\nIs there a way to store the artifacts on mlflow server\r\n \r\nwhile the below creates the artifacts in the directory\r\n\r\nimport os\r\nimport mlflow\r\nimport mlflow.pyfunc\r\n\r\nclass AddN(mlflow.pyfunc.PythonModel):\r\n\r\n    def __init__(self, n):\r\n        self.n = n\r\n\r\n    def predict(self, context, model_input):\r\n        return model_input.apply(lambda column: column + self.n)\r\n\r\nmodel_path = \"add_n_model\"\r\nadd5_model = AddN(n=5)\r\n\r\n\r\ntracking_uri=\"http://localhost:5000\"\r\nmlflowClient = mlflow.tracking.MlflowClient(tracking_uri)\r\n\r\nexperiment_id=mlflowClient.create_experiment(\"firstExperiment\",\"/mlflowserver_default_artifact_root\")\r\n\r\nexperiment_to_run=mlflowClient.get_experiment_by_name(\"firstExperiment\")\r\ncreated_run=mlflowClient.create_run(experiment_to_run.experiment_id)\r\n\r\nos.environ['MLFLOW_TRACKING_URI'] = tracking_uri\r\nos.environ['MLFLOW_ARTIFACT_URI'] = tracking_uri\r\n\r\nmlflow.pyfunc.log_model(\r\n        artifact_path=\"artifacts\",\r\n        python_model=add5_model,\r\n   )\r\n\r\n====== when i run the below\r\n\r\nimport os\r\nimport mlflow\r\nimport mlflow.pyfunc\r\n\r\nclass AddN(mlflow.pyfunc.PythonModel):\r\n\r\n    def __init__(self, n):\r\n        self.n = n\r\n\r\n    def predict(self, context, model_input):\r\n        return model_input.apply(lambda column: column + self.n)\r\n\r\nmodel_path = \"add_n_model\"\r\nadd5_model = AddN(n=5)\r\n\r\n\r\ntracking_uri=\"http://localhost:5000\"\r\nmlflowClient = mlflow.tracking.MlflowClient(tracking_uri)\r\n\r\nexperiment_to_run=mlflowClient.get_experiment_by_name(\"firstExperiment\")\r\ncreated_run=mlflowClient.create_run(experiment_to_run.experiment_id)\r\n\r\nos.environ['MLFLOW_TRACKING_URI'] = tracking_uri\r\nos.environ['MLFLOW_ARTIFACT_URI'] = tracking_uri\r\n\r\nmlflow.pyfunc.log_model(\r\n        artifact_path=\"artifacts\",\r\n        python_model=add5_model,\r\n        )\r\n\r\n\r\nI get the below error\r\n\r\n/home/cyril/anaconda3/lib/python3.7/site-packages/parso/python/tree.py:46: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working\r\n  from collections import Mapping\r\nTraceback (most recent call last):\r\n  File \"temp.py\", line 29, in <module>\r\n    python_model=add5_model,\r\n  File \"/home/cyril/anaconda3/lib/python3.7/site-packages/mlflow/pyfunc/__init__.py\", line 664, in log_model\r\n    conda_env=conda_env)\r\n  File \"/home/cyril/anaconda3/lib/python3.7/site-packages/mlflow/models/__init__.py\", line 78, in log\r\n    mlflow.tracking.fluent.log_artifacts(local_path, artifact_path)\r\n  File \"/home/cyril/anaconda3/lib/python3.7/site-packages/mlflow/tracking/fluent.py\", line 277, in log_artifacts\r\n    MlflowClient().log_artifacts(run_id, local_dir, artifact_path)\r\n  File \"/home/cyril/anaconda3/lib/python3.7/site-packages/mlflow/tracking/client.py\", line 253, in log_artifacts\r\n    artifact_repo = get_artifact_repository(run.info.artifact_uri)\r\n  File \"/home/cyril/anaconda3/lib/python3.7/site-packages/mlflow/store/artifact_repository_registry.py\", line 99, in get_artifact_repository\r\n    return _artifact_repository_registry.get_artifact_repository(artifact_uri)\r\n  File \"/home/cyril/anaconda3/lib/python3.7/site-packages/mlflow/store/artifact_repository_registry.py\", line 67, in get_artifact_repository\r\n    artifact_uri, list(self._registry.keys())\r\nmlflow.exceptions.MlflowException: Could not find a registered artifact repository for: http://localhost:5000/6a8e2424eb2a490bb7aec43a63c4f87e/artifacts. Currently registered schemes are: ['', 'file', 's3', 'gs', 'wasbs', 'ftp', 'sftp', 'dbfs', 'hdfs', 'runs']\r\n\r\n\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1815/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/1815/timeline","performed_via_github_app":null,"state_reason":null}