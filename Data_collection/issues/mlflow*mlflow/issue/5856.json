{"url":"https://api.github.com/repos/mlflow/mlflow/issues/5856","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/5856/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/5856/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/5856/events","html_url":"https://github.com/mlflow/mlflow/issues/5856","id":1233554510,"node_id":"I_kwDOCB5Jx85JhoxO","number":5856,"title":"[BUG] IsADirectoryError while selecting Azure artifact in the UI","user":{"login":"christianbaumberger","id":44830049,"node_id":"MDQ6VXNlcjQ0ODMwMDQ5","avatar_url":"https://avatars.githubusercontent.com/u/44830049?v=4","gravatar_id":"","url":"https://api.github.com/users/christianbaumberger","html_url":"https://github.com/christianbaumberger","followers_url":"https://api.github.com/users/christianbaumberger/followers","following_url":"https://api.github.com/users/christianbaumberger/following{/other_user}","gists_url":"https://api.github.com/users/christianbaumberger/gists{/gist_id}","starred_url":"https://api.github.com/users/christianbaumberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/christianbaumberger/subscriptions","organizations_url":"https://api.github.com/users/christianbaumberger/orgs","repos_url":"https://api.github.com/users/christianbaumberger/repos","events_url":"https://api.github.com/users/christianbaumberger/events{/privacy}","received_events_url":"https://api.github.com/users/christianbaumberger/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1470945519,"node_id":"MDU6TGFiZWwxNDcwOTQ1NTE5","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/uiux","name":"area/uiux","color":"ede978","default":false,"description":"Front-end, user experience, plotting, JavaScript, JavaScript dev server"},{"id":2022845866,"node_id":"MDU6TGFiZWwyMDIyODQ1ODY2","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/artifacts","name":"area/artifacts","color":"48eabc","default":false,"description":"Artifact stores and artifact logging"},{"id":2022859639,"node_id":"MDU6TGFiZWwyMDIyODU5NjM5","url":"https://api.github.com/repos/mlflow/mlflow/labels/integrations/azure","name":"integrations/azure","color":"ffbce5","default":false,"description":"Azure and Azure ML integrations"},{"id":4300304016,"node_id":"LA_kwDOCB5Jx88AAAABAFFukA","url":"https://api.github.com/repos/mlflow/mlflow/labels/has-closing-pr","name":"has-closing-pr","color":"fef2c0","default":false,"description":"This issue has a closing PR"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2022-05-12T07:20:00Z","updated_at":"2022-07-17T04:06:40Z","closed_at":"2022-07-17T04:06:40Z","author_association":"NONE","active_lock_reason":null,"body":"### Willingness to contribute\n\nNo. I cannot contribute a bug fix at this time.\n\n### System information\n\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: no\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Debian GNU/Linux 11 (bullseye)\r\n- **MLflow installed from (source or binary)**: binary\r\n- **MLflow version (run ``mlflow --version``)**: 1.25.1\r\n- **Python version**: 3.7\r\n- **npm version, if running the dev UI**:\r\n\n\n### Describe the problem\n\nWe deploy mlflow-server within a docker image on a kubernetes cluster on azure. As artifact store is an azure blob storage configured. MLFlow server is configured as artifact proxy. When logging a new model from a jupyter notebook on the client side, the model gets written correcty to the artifact store. We are also able to download the model again on the client side with the python api. As soon as we want to display the artifacts on the UI, it will not show up as expected. \r\n![grafik](https://user-images.githubusercontent.com/44830049/168012555-3eebc53b-2391-486e-94fd-6345340e9f00.png)\r\n\r\nOn the mlflow server we see the following exception:\r\n\r\n`[2022-05-12 07:10:38 +0000] [20] [DEBUG] GET /get-artifact\r\n2022/05/12 07:10:39 ERROR mlflow.server: Exception on /get-artifact [GET]\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.7/site-packages/flask/app.py\", line 2077, in wsgi_app\r\n    response = self.full_dispatch_request()\r\n  File \"/usr/local/lib/python3.7/site-packages/flask/app.py\", line 1525, in full_dispatch_request\r\n    rv = self.handle_user_exception(e)\r\n  File \"/usr/local/lib/python3.7/site-packages/flask/app.py\", line 1523, in full_dispatch_request\r\n    rv = self.dispatch_request()\r\n  File \"/usr/local/lib/python3.7/site-packages/flask/app.py\", line 1509, in dispatch_request\r\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**req.view_args)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/server/__init__.py\", line 53, in serve_artifacts\r\n    return get_artifact_handler()\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/server/handlers.py\", line 327, in wrapper\r\n    return func(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/server/handlers.py\", line 409, in get_artifact_handler\r\n    return _send_artifact(artifact_repo, artifact_path)\r\n  File \"/usr/local/lib/python3.7/site-packages/mlflow/server/handlers.py\", line 318, in _send_artifact\r\n    return send_file(filename, mimetype=\"text/plain\", as_attachment=True)\r\n  File \"/usr/local/lib/python3.7/site-packages/flask/helpers.py\", line 623, in send_file\r\n    cache_timeout=cache_timeout,\r\n  File \"/usr/local/lib/python3.7/site-packages/werkzeug/utils.py\", line 491, in send_file\r\n    file = open(path, \"rb\")  # type: ignore\r\nIsADirectoryError: [Errno 21] Is a directory: '/tmp/tmpwsvta9ik/9/45c58ecb75b8420a8b58375015a20ea4/artifacts/sklearn-model/requirements.txt'`\r\n\r\nWhen I then try to access the above file, I see that it actually is a directory and not a file:\r\n![grafik](https://user-images.githubusercontent.com/44830049/168013145-85695c0a-e9f1-428f-8d03-cc93fa8139bc.png)\r\n\r\nI think this issue is related to the following to issues:\r\nhttps://github.com/mlflow/mlflow/issues/3154\r\nhttps://github.com/mlflow/mlflow/issues/2991\r\n\r\nUnfortunately I cannot debug the mlflow server in an easy way to print something.\r\n\n\n### Tracking information\n\nmlflow server \\\r\n    --backend-store-uri postgresql://connection_string \\\r\n    --artifacts-destination wasbs://container_name@storage_account.blob.core.windows.net/ \\\r\n    --serve-artifacts \\\r\n    --host 0.0.0.0 \\\r\n    --port 5000 \\\r\n    --gunicorn-opts \"--log-level debug\"\n\n### Code to reproduce issue\n\nIt is a mlflow server UI problem.\n\n### Other info / logs\n\n_No response_\n\n### What component(s) does this bug affect?\n\n- [X] `area/artifacts`: Artifact stores and artifact logging\n- [ ] `area/build`: Build and test infrastructure for MLflow\n- [ ] `area/docs`: MLflow documentation pages\n- [ ] `area/examples`: Example code\n- [ ] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\n- [ ] `area/projects`: MLproject format, project running backends\n- [ ] `area/scoring`: MLflow Model server, model deployment tools, Spark UDFs\n- [ ] `area/server-infra`: MLflow Tracking server backend\n- [ ] `area/tracking`: Tracking Service, tracking client APIs, autologging\n\n### What interface(s) does this bug affect?\n\n- [X] `area/uiux`: Front-end, user experience, plotting, JavaScript, JavaScript dev server\n- [ ] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\n- [ ] `area/windows`: Windows support\n\n### What language(s) does this bug affect?\n\n- [ ] `language/r`: R APIs and clients\n- [ ] `language/java`: Java APIs and clients\n- [ ] `language/new`: Proposals for new client languages\n\n### What integration(s) does this bug affect?\n\n- [X] `integrations/azure`: Azure and Azure ML integrations\n- [ ] `integrations/sagemaker`: SageMaker integrations\n- [ ] `integrations/databricks`: Databricks integrations","closed_by":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/5856/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/5856/timeline","performed_via_github_app":null,"state_reason":"completed"}