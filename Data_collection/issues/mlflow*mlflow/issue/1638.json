{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1638","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/1638/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/1638/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/1638/events","html_url":"https://github.com/mlflow/mlflow/issues/1638","id":470237164,"node_id":"MDU6SXNzdWU0NzAyMzcxNjQ=","number":1638,"title":"Why return to self._tags is missing  in search_utils.py(289)does_run_match_clause() ?","user":{"login":"lyw615","id":32604809,"node_id":"MDQ6VXNlcjMyNjA0ODA5","avatar_url":"https://avatars.githubusercontent.com/u/32604809?v=4","gravatar_id":"","url":"https://api.github.com/users/lyw615","html_url":"https://github.com/lyw615","followers_url":"https://api.github.com/users/lyw615/followers","following_url":"https://api.github.com/users/lyw615/following{/other_user}","gists_url":"https://api.github.com/users/lyw615/gists{/gist_id}","starred_url":"https://api.github.com/users/lyw615/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lyw615/subscriptions","organizations_url":"https://api.github.com/users/lyw615/orgs","repos_url":"https://api.github.com/users/lyw615/repos","events_url":"https://api.github.com/users/lyw615/events{/privacy}","received_events_url":"https://api.github.com/users/lyw615/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-07-19T09:46:22Z","updated_at":"2019-07-19T12:38:30Z","closed_at":"2019-07-19T12:38:30Z","author_association":"NONE","active_lock_reason":null,"body":"### Describe the problem\r\nI set a breakpoint here```\r\n ```\r\nruns = client.search_runs([experiment_id], \"tags.mlflow.parentRunId = '{run_id}' \".format(\r\n            run_id=run.info.run_id\r\n        ))\r\n```\r\n\r\n`Constantly steped into ,entered the function _search_runs of file_store.py, but the code from line 546 to 551 is different between windows and linux.\r\n```\r\nwindows:\r\nfor experiment_id in experiment_ids:\r\n            run_infos = self._list_run_infos(experiment_id, run_view_type)\r\n            runs.extend(self.get_run(r.run_id) for r in run_infos)\r\n        filtered = SearchUtils.filter(runs, filter_string)\r\n        runs = SearchUtils.sort(filtered, order_by)[:max_results]\r\n        return runs, None\r\n\r\n```\r\n```\r\n `linux:\r\n runs = []\r\n544  \t        for experiment_id in experiment_ids:\r\n545  \t            run_infos = self._list_run_infos(experiment_id, run_view_type)\r\n546  \t            runs.extend(self.get_run(r.run_id) for r in run_infos)\r\n547  \t        filtered = [run for run in runs if not search_filter or search_filter.filter(run)]\r\n548  ->\t        return sorted(filtered, key=lambda r: (-r.info.start_time, r.info.run_id))[:max_results]`\r\n```\r\nAnd the value of filtered  is '[ ]'. But the value of runs is normal. This causes the runs '[ ]'ã€‚ I think that by condition, the runs should get the expected value, but I don't know where to find the reason.\r\nSome value in runs of file_store.py in line 543\r\n'training_data': 'CamVid'}, tags={'mlflow.gitRepoURL': 'https://github.com/mlflow/mlflow.git',\r\n 'mlflow.parentRunId': 'df13a154557d49bcb87cfd173c08fedb',\r\n 'mlflow.source.git.commit': 'deeb7f0f753fd9af228917675e4020eeb6a53668',\r\n 'mlflow.source.git.repoURL': 'https://github.com/mlflow/mlflow.git',\r\n 'mlflow.source.name': 'seg_search.py',\r\n 'mlflow.source.type': 'LOCAL',\r\n 'mlflow.user': 'root'}>, info=<RunInfo: artifact_uri='file:\r\n### Source code / logs\r\n    with mlflow.start_run() as run:#parent run\r\n        experiment_id=run.info.experiment_id\r\n        #evaluate null model first\r\n        valid_null_loss,test_null_loss=new_eval(1,experiment_id,_inf,_inf,True)(params=[1e-3,0.995])\r\n        best=fmin(fn=new_eval(epochs,experiment_id,valid_null_loss,test_null_loss),\r\n                  space=space,algo=tpe.suggest if algo== 'tpe.suggest' else  rand.suggest,\r\n                  max_evals=max_runs)\r\n        mlflow.set_tag('best params',str(best))\r\n        client=MlflowClient()\r\n        runs=client.search_runs([experiment_id],\"tags.mlflow.parentRrunId='{run_id}'\".format(\r\n            run_id=run.info.run_id\r\n        ))\r\n        #best_val_train=_inf\r\n        best_val_valid=_inf\r\n        best_val_test=_inf\r\n\r\nThis is logs:\r\n-> runs=client.search_runs([experiment_id],\"tags.mlflow.parentRrunId='{run_id}'\".format(\r\n(Pdb) s\r\n> /home/do/lyw/mlflow_x/Semantic-Segmentation-Suite-master/seg_search.py(69)run()\r\n-> run_id=run.info.run_id\r\n(Pdb) s\r\n--Call--\r\n> /software/conda/lib/python3.6/site-packages/mlflow/entities/run.py(19)info()\r\n-> @property\r\n(Pdb) s\r\n> /software/conda/lib/python3.6/site-packages/mlflow/entities/run.py(26)info()\r\n-> return self._info\r\n(Pdb) s\r\n--Return--\r\n> /software/conda/lib/python3.6/site-packages/mlflow/entities/run.py(26)info()-><RunInfo: art...ser_id='root'>\r\n-> return self._info\r\n(Pdb) s\r\n--Call--\r\n> /software/conda/lib/python3.6/site-packages/mlflow/entities/run_info.py(79)run_id()\r\n-> @property\r\n(Pdb) s\r\n> /software/conda/lib/python3.6/site-packages/mlflow/entities/run_info.py(82)run_id()\r\n-> return self._run_id\r\n(Pdb) s\r\n--Return--\r\n> /software/conda/lib/python3.6/site-packages/mlflow/entities/run_info.py(82)run_id()->'1ef70d553173...abb4bfd722108'\r\n-> return self._run_id\r\n(Pdb) s\r\n--Call--\r\n> /software/conda/lib/python3.6/site-packages/mlflow/tracking/client.py(274)search_runs()\r\n-> def search_runs(self, experiment_ids, filter_string=\"\",\r\n(Pdb) s\r\n> /software/conda/lib/python3.6/site-packages/mlflow/tracking/client.py(289)search_runs()\r\n-> if isinstance(experiment_ids, int) or isinstance(experiment_ids, str):\r\n(Pdb) s\r\n> /software/conda/lib/python3.6/site-packages/mlflow/tracking/client.py(291)search_runs()\r\n-> return self.store.search_runs(experiment_ids=experiment_ids,\r\n(Pdb) s\r\n> /software/conda/lib/python3.6/site-packages/mlflow/tracking/client.py(292)search_runs()\r\n-> search_filter=SearchFilter(filter_string=filter_string),\r\n(Pdb) s\r\n--Call--\r\n> /software/conda/lib/python3.6/site-packages/mlflow/utils/search_utils.py(33)__init__()\r\n-> def __init__(self, filter_string=None, anded_expressions=None):\r\n(Pdb) s\r\n> /software/conda/lib/python3.6/site-packages/mlflow/utils/search_utils.py(34)__init__()\r\n-> self._filter_string = filter_string\r\n(Pdb) s\r\n> /software/conda/lib/python3.6/site-packages/mlflow/utils/search_utils.py(35)__init__()\r\n-> self._search_expressions = anded_expressions\r\n(Pdb) s\r\n> /software/conda/lib/python3.6/site-packages/mlflow/utils/search_utils.py(36)__init__()\r\n-> if self._filter_string and self._search_expressions:\r\n(Pdb) s\r\n> /software/conda/lib/python3.6/site-packages/mlflow/utils/search_utils.py(41)__init__()\r\n-> self.parsed = None\r\n(Pdb) s\r\n--Return--\r\n> /software/conda/lib/python3.6/site-packages/mlflow/utils/search_utils.py(41)__init__()->None\r\n-> self.parsed = None\r\n(Pdb) s\r\n> /software/conda/lib/python3.6/site-packages/mlflow/tracking/client.py(293)search_runs()\r\n-> run_view_type=run_view_type,\r\n(Pdb) s\r\n> /software/conda/lib/python3.6/site-packages/mlflow/tracking/client.py(294)search_runs()\r\n-> max_results=max_results)\r\n(Pdb) s\r\n--Call--\r\n> /software/conda/lib/python3.6/site-packages/mlflow/store/file_store.py(536)search_runs()\r\n-> def search_runs(self, experiment_ids, search_filter, run_view_type,\r\n(Pdb) s\r\n> /software/conda/lib/python3.6/site-packages/mlflow/store/file_store.py(538)search_runs()\r\n-> if max_results > SEARCH_MAX_RESULTS_THRESHOLD:\r\n(Pdb) s\r\n> /software/conda/lib/python3.6/site-packages/mlflow/store/file_store.py(543)search_runs()\r\n-> runs = []\r\n(Pdb) s\r\n> /software/conda/lib/python3.6/site-packages/mlflow/store/file_store.py(544)search_runs()\r\n-> for experiment_id in experiment_ids:\r\n(Pdb) l\r\n539  \t            ```\r\n```\r\nraise MlflowException(\"Invalid value for request parameter max_results. It must be at \"\r\n540  \t                                  \"most {}, but got value {}\".format(SEARCH_MAX_RESULTS_THRESHOLD,\r\n541  \t                                                                     max_results),\r\n542  \t                                  databricks_pb2.INVALID_PARAMETER_VALUE)\r\n543  \t        runs = []\r\n544  ->\t        for experiment_id in experiment_ids:\r\n545  \t            run_infos = self._list_run_infos(experiment_id, run_view_type)\r\n546  \t            runs.extend(self.get_run(r.run_id) for r in run_infos)\r\n547  \t        filtered = [run for run in runs if not search_filter or search_filter.filter(run)]\r\n548  \t        return sorted(filtered, key=lambda r: (-r.info.start_time, r.info.run_id))[:max_results]\r\n```\r\n\r\n","closed_by":{"login":"lyw615","id":32604809,"node_id":"MDQ6VXNlcjMyNjA0ODA5","avatar_url":"https://avatars.githubusercontent.com/u/32604809?v=4","gravatar_id":"","url":"https://api.github.com/users/lyw615","html_url":"https://github.com/lyw615","followers_url":"https://api.github.com/users/lyw615/followers","following_url":"https://api.github.com/users/lyw615/following{/other_user}","gists_url":"https://api.github.com/users/lyw615/gists{/gist_id}","starred_url":"https://api.github.com/users/lyw615/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lyw615/subscriptions","organizations_url":"https://api.github.com/users/lyw615/orgs","repos_url":"https://api.github.com/users/lyw615/repos","events_url":"https://api.github.com/users/lyw615/events{/privacy}","received_events_url":"https://api.github.com/users/lyw615/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1638/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/1638/timeline","performed_via_github_app":null,"state_reason":"completed"}