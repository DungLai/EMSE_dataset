{"url":"https://api.github.com/repos/mlflow/mlflow/issues/4062","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/4062/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/4062/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/4062/events","html_url":"https://github.com/mlflow/mlflow/issues/4062","id":801127076,"node_id":"MDU6SXNzdWU4MDExMjcwNzY=","number":4062,"title":"[BUG] log_model, load_model,register_model... very slow under win10","user":{"login":"potoo0","id":34411681,"node_id":"MDQ6VXNlcjM0NDExNjgx","avatar_url":"https://avatars.githubusercontent.com/u/34411681?v=4","gravatar_id":"","url":"https://api.github.com/users/potoo0","html_url":"https://github.com/potoo0","followers_url":"https://api.github.com/users/potoo0/followers","following_url":"https://api.github.com/users/potoo0/following{/other_user}","gists_url":"https://api.github.com/users/potoo0/gists{/gist_id}","starred_url":"https://api.github.com/users/potoo0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/potoo0/subscriptions","organizations_url":"https://api.github.com/users/potoo0/orgs","repos_url":"https://api.github.com/users/potoo0/repos","events_url":"https://api.github.com/users/potoo0/events{/privacy}","received_events_url":"https://api.github.com/users/potoo0/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2021-02-04T10:03:59Z","updated_at":"2021-04-07T01:53:45Z","closed_at":"2021-04-07T01:51:41Z","author_association":"NONE","active_lock_reason":null,"body":"### System information\r\n- **Have I written custom code**: Yes\r\n- **OS Platform and Distribution**: win10 20H2\r\n- **MLflow installed from**: binary\r\n- **MLflow version**: mlflow, version 1.13.1\r\n- **Python version**: 3.8.5\r\n- **DB**: mysql 8.0.21 for Win64 on x86_64 (MySQL Community Server - GPL)\r\n- **Storage**: FTP from Internet Information Services (IIS)\r\n\r\n### Describe the problem\r\nlog_model, load_model,register_model... very slow under win10\r\n\r\n### Code to reproduce issue\r\ntimemeasur.py\r\n```python\r\nimport time\r\nimport mlflow\r\nimport numpy as np\r\nfrom mlflow.pyfunc import load_model\r\n\r\nfrom model_builder import Test1\r\n\r\n\r\n# config\r\ntracking_server = 'http://localhost:8088'\r\nexperiment_name = 'pyfunc_model_t1'\r\nregistered_name = experiment_name\r\nrun_name = 'test1'\r\nstage = None\r\n\r\n\r\nst = time.time()\r\nmlflow.tracking.set_tracking_uri(tracking_server)\r\nprint(f'time cost - set_tracking_uri: {time.time() - st}')\r\n\r\nst = time.time()\r\nmlflow.set_experiment(experiment_name)\r\nprint(f'time cost - set_experiment: {time.time() - st}')\r\n\r\n\r\n# log model\r\nmodel = Test1()\r\nst = time.time()\r\nwith mlflow.start_run(run_name=run_name) as run:\r\n    mlflow.pyfunc.log_model(\r\n        'model',\r\n        python_model=model,\r\n        code_path=['model_builder.py']\r\n    )\r\nprint(f'time cost - log_model: {time.time() - st}')\r\n\r\n# register model\r\nst = time.time()\r\nreg_info = mlflow.register_model(\r\n    f\"runs:/{run.info.run_id}/model\",\r\n    registered_name\r\n)\r\nprint(f'time cost - register_model: {time.time() - st}')\r\n\r\n# load model\r\nst = time.time()\r\nloadedml_1 = load_model(f\"models:/{registered_name}/{stage}\")\r\nprint(f'time cost - load_model: {time.time() - st}')\r\n```\r\nmodel_builder.py\r\n```python\r\nimport mlflow.pyfunc\r\nimport numpy as np\r\n\r\n\r\nclass Test1(mlflow.pyfunc.PythonModel):\r\n    def __init__(self):\r\n        super().__init__()\r\n\r\n    def load_context(self, context):\r\n        import numpy as np\r\n\r\n        return\r\n\r\n    def predict(self, context, model_input):\r\n        '''\r\n        Args:\r\n            model_input: ndarray, shape: (-1)\r\n        '''\r\n        res = np.sum(model_input)\r\n\r\n        return res\r\n```\r\n\r\n### Other info / logs\r\n```\r\ntime cost - set_tracking_uri: 0.0\r\ntime cost - set_experiment: 2.0557515621185303\r\ntime cost - log_model: 8.30472469329834\r\nRegistered model 'pyfunc_model_t1' already exists. Creating a new version of this model...\r\n2021/02/04 18:00:57 INFO mlflow.tracking._model_registry.client: Waiting up to 300 seconds for model version to finish creation.                     Model name: pyfunc_model_t1, version 6\r\nCreated version '6' of model 'pyfunc_model_t1'.\r\ntime cost - register_model: 6.139993906021118\r\ntime cost - load_model: 4.121163606643677\r\n```","closed_by":{"login":"potoo0","id":34411681,"node_id":"MDQ6VXNlcjM0NDExNjgx","avatar_url":"https://avatars.githubusercontent.com/u/34411681?v=4","gravatar_id":"","url":"https://api.github.com/users/potoo0","html_url":"https://github.com/potoo0","followers_url":"https://api.github.com/users/potoo0/followers","following_url":"https://api.github.com/users/potoo0/following{/other_user}","gists_url":"https://api.github.com/users/potoo0/gists{/gist_id}","starred_url":"https://api.github.com/users/potoo0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/potoo0/subscriptions","organizations_url":"https://api.github.com/users/potoo0/orgs","repos_url":"https://api.github.com/users/potoo0/repos","events_url":"https://api.github.com/users/potoo0/events{/privacy}","received_events_url":"https://api.github.com/users/potoo0/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/4062/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/4062/timeline","performed_via_github_app":null,"state_reason":"completed"}