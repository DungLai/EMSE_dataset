{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2923","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2923/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2923/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2923/events","html_url":"https://github.com/mlflow/mlflow/issues/2923","id":636992704,"node_id":"MDU6SXNzdWU2MzY5OTI3MDQ=","number":2923,"title":"[BUG] mlflow after update calls for db migration when no data has changed","user":{"login":"mirekphd","id":36706320,"node_id":"MDQ6VXNlcjM2NzA2MzIw","avatar_url":"https://avatars.githubusercontent.com/u/36706320?v=4","gravatar_id":"","url":"https://api.github.com/users/mirekphd","html_url":"https://github.com/mirekphd","followers_url":"https://api.github.com/users/mirekphd/followers","following_url":"https://api.github.com/users/mirekphd/following{/other_user}","gists_url":"https://api.github.com/users/mirekphd/gists{/gist_id}","starred_url":"https://api.github.com/users/mirekphd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mirekphd/subscriptions","organizations_url":"https://api.github.com/users/mirekphd/orgs","repos_url":"https://api.github.com/users/mirekphd/repos","events_url":"https://api.github.com/users/mirekphd/events{/privacy}","received_events_url":"https://api.github.com/users/mirekphd/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022849295,"node_id":"MDU6TGFiZWwyMDIyODQ5Mjk1","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/tracking","name":"area/tracking","color":"48eabc","default":false,"description":"Tracking service, tracking client APIs, autologging"},{"id":2022852620,"node_id":"MDU6TGFiZWwyMDIyODUyNjIw","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/sqlalchemy","name":"area/sqlalchemy","color":"ede978","default":false,"description":"Use of SQL alchemy in tracking service or model registry"},{"id":2022866026,"node_id":"MDU6TGFiZWwyMDIyODY2MDI2","url":"https://api.github.com/repos/mlflow/mlflow/labels/priority/backlog","name":"priority/backlog","color":"534cb5","default":false,"description":"We believe it is useful, but donâ€™t see it being prioritized in the next few months."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2020-06-11T12:58:05Z","updated_at":"2022-06-17T12:32:52Z","closed_at":"2020-08-25T10:31:36Z","author_association":"NONE","active_lock_reason":null,"body":"### Willingness to contribute\r\n- [x] Yes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**:yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: ubuntu:bionic, ubuntu:focal\r\n- **MLflow installed from (source or binary)**: binary\r\n- **MLflow version (run ``mlflow --version``)**: 1.3.0, 1.8.0\r\n- **Python version**: 3.6.4, 3.8.2\r\n- **Exact command to reproduce**: -\r\n\r\n### Describe the problem\r\nI upgraded mlflow server version in our `mirekphd/ml-mlflow` docker container from 1.3.0 (container tag 20191024) to 1.8.0 (tag 20200611). The new mlflow version fails to start due to apparent need for db schema migration, even though nothing has changed and rollback of mlflow to previous version 1.3.0 restores normal operation\r\n\r\n### Code to reproduce issue\r\nbuggy:\r\n`docker pull mirekphd/ml-mlflow:20200611`\r\nvs. normal:\r\n`docker pull mirekphd/ml-mlflow:20191024`\r\n\r\n### Other info / logs\r\n```\r\n2020/06/11 11:26:28 ERROR mlflow.cli: Error initializing backend store\r\n2020/06/11 11:26:28 ERROR mlflow.cli: Detected out-of-date database schema (found version 89d4b8295536, but expected 0a8213491aaa). Take a backup of your database, then run 'mlflow db upgrade <database_uri>' to migrate your database to the latest schema. NOTE: schema migration may result in database downtime - please consult your database's documentation for more detail.\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.8/dist-packages/mlflow/cli.py\", line 286, in server\r\n    initialize_backend_stores(backend_store_uri, default_artifact_root)\r\n  File \"/usr/local/lib/python3.8/dist-packages/mlflow/server/handlers.py\", line 101, in initialize_backend_stores\r\n    _get_tracking_store(backend_store_uri, default_artifact_root)\r\n  File \"/usr/local/lib/python3.8/dist-packages/mlflow/server/handlers.py\", line 87, in _get_tracking_store\r\n    _tracking_store = _tracking_store_registry.get_store(store_uri, artifact_root)\r\n  File \"/usr/local/lib/python3.8/dist-packages/mlflow/tracking/_tracking_service/registry.py\", line 37, in get_store\r\n    return builder(store_uri=store_uri, artifact_uri=artifact_uri)\r\n  File \"/usr/local/lib/python3.8/dist-packages/mlflow/server/handlers.py\", line 60, in _get_sqlalchemy_store\r\n    return SqlAlchemyStore(store_uri, artifact_uri)\r\n  File \"/usr/local/lib/python3.8/dist-packages/mlflow/store/tracking/sqlalchemy_store.py\", line 103, in __init__\r\n    mlflow.store.db.utils._verify_schema(self.engine)\r\n  File \"/usr/local/lib/python3.8/dist-packages/mlflow/store/db/utils.py\", line 50, in _verify_schema\r\n    raise MlflowException(\r\nmlflow.exceptions.MlflowException: Detected out-of-date database schema (found version 89d4b8295536, but expected 0a8213491aaa). Take a backup of your database, then run 'mlflow db upgrade <database_uri>' to migrate your database to the latest schema. NOTE: schema migration may result in database downtime - please consult your database's documentation for more detail.\r\n```\r\n\r\n### What component(s), interfaces, languages, and integrations does this bug affect?\r\nComponents \r\n- [x] `area/tracking`: Tracking Service, tracking client APIs, autologging\r\n\r\nInterface \r\n- [x] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\r\n\r\n","closed_by":{"login":"mirekphd","id":36706320,"node_id":"MDQ6VXNlcjM2NzA2MzIw","avatar_url":"https://avatars.githubusercontent.com/u/36706320?v=4","gravatar_id":"","url":"https://api.github.com/users/mirekphd","html_url":"https://github.com/mirekphd","followers_url":"https://api.github.com/users/mirekphd/followers","following_url":"https://api.github.com/users/mirekphd/following{/other_user}","gists_url":"https://api.github.com/users/mirekphd/gists{/gist_id}","starred_url":"https://api.github.com/users/mirekphd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mirekphd/subscriptions","organizations_url":"https://api.github.com/users/mirekphd/orgs","repos_url":"https://api.github.com/users/mirekphd/repos","events_url":"https://api.github.com/users/mirekphd/events{/privacy}","received_events_url":"https://api.github.com/users/mirekphd/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2923/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2923/timeline","performed_via_github_app":null,"state_reason":"completed"}