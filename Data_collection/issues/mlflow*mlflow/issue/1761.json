{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1761","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/1761/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/1761/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/1761/events","html_url":"https://github.com/mlflow/mlflow/issues/1761","id":482488959,"node_id":"MDU6SXNzdWU0ODI0ODg5NTk=","number":1761,"title":"[BUG] MySQLConnections on v1.2.0 does not run as expected","user":{"login":"jerrygb","id":1516634,"node_id":"MDQ6VXNlcjE1MTY2MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1516634?v=4","gravatar_id":"","url":"https://api.github.com/users/jerrygb","html_url":"https://github.com/jerrygb","followers_url":"https://api.github.com/users/jerrygb/followers","following_url":"https://api.github.com/users/jerrygb/following{/other_user}","gists_url":"https://api.github.com/users/jerrygb/gists{/gist_id}","starred_url":"https://api.github.com/users/jerrygb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jerrygb/subscriptions","organizations_url":"https://api.github.com/users/jerrygb/orgs","repos_url":"https://api.github.com/users/jerrygb/repos","events_url":"https://api.github.com/users/jerrygb/events{/privacy}","received_events_url":"https://api.github.com/users/jerrygb/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1554650079,"node_id":"MDU6TGFiZWwxNTU0NjUwMDc5","url":"https://api.github.com/repos/mlflow/mlflow/labels/stale","name":"stale","color":"828282","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-08-19T19:35:45Z","updated_at":"2020-11-08T15:57:31Z","closed_at":"2019-11-29T15:35:46Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**:\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Debian Stretch\r\n- **MLflow installed from (source or binary)**: binary\r\n- **MLflow version (run ``mlflow --version``)**: mlflow, version 1.2.0\r\n- **Python version**: Python 2.7.15 :: Anaconda, Inc.\r\n- **npm version, if running the dev UI**:\r\n- **Exact command to reproduce**: `docker run -ti -p 5000:5000 mlflow:v1.2 mlflow server --backend-store-uri mysql://abc:xyz@url --default-artifact-root s3://mlflow-artifact-store/ --host 0.0.0.0`\r\n\r\n### Describe the problem\r\n\r\nFirst run before the creation of the tables, mlflow completes the DDL as follows,\r\n\r\n```\r\n2019/08/19 19:25:57 INFO mlflow.store.sqlalchemy_store: Creating initial MLflow database tables...\r\n2019/08/19 19:25:57 INFO mlflow.store.db.utils: Updating database tables at mysql://admin:Za7Jbbxm@mlflow-tracking-db.cvmvev1doduj.us-east-1.rds.amazonaws.com/mlflow\r\nINFO  [alembic.runtime.migration] Context impl MySQLImpl.\r\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\r\nINFO  [alembic.runtime.migration] Running upgrade  -> 451aebb31d03, add metric step\r\nINFO  [alembic.runtime.migration] Running upgrade 451aebb31d03 -> 90e64c465722, migrate user column to tags\r\nINFO  [alembic.runtime.migration] Running upgrade 90e64c465722 -> 181f10493468, allow nulls for metric values\r\nINFO  [alembic.runtime.migration] Running upgrade 181f10493468 -> df50e92ffc5e, Add Experiment Tags Table\r\nINFO  [alembic.runtime.migration] Running upgrade df50e92ffc5e -> 7ac759974ad8, Update run tags with larger limit\r\nINFO  [alembic.runtime.migration] Context impl MySQLImpl.\r\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\r\n```\r\n\r\nAfter this, the server seems to abruptly exit without a message. Noticed the `mlflow server` did not have debug switch.\r\n\r\nWhen running the server the next time, we received an issue related to incorrect schema due to missing quotes for `artifact_location`, afaik. \r\n\r\nSee the logs below,\r\n\r\n```\r\n2019/08/19 19:26:51 ERROR mlflow.cli: Error initializing backend store\r\n2019/08/19 19:26:51 ERROR mlflow.cli: (MySQLdb._exceptions.ProgrammingError) (1064, \"You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '://mlflow-artifact-store-poc/0, 'active', 'Default', 0)' at line 1\")\r\n[SQL: INSERT INTO experiments (artifact_location, lifecycle_stage, name, experiment_id) VALUES (s3://mlflow-artifact-store-poc/0, 'active', 'Default', 0);]\r\n(Background on this error at: http://sqlalche.me/e/f405)\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python2.7/site-packages/mlflow/cli.py\", line 266, in server\r\n    _get_store(backend_store_uri, default_artifact_root)\r\n  File \"/opt/conda/lib/python2.7/site-packages/mlflow/server/handlers.py\", line 61, in _get_store\r\n    _store = _tracking_store_registry.get_store(store_uri, artifact_root)\r\n  File \"/opt/conda/lib/python2.7/site-packages/mlflow/tracking/registry.py\", line 65, in get_store\r\n    return store_builder(store_uri=store_uri, artifact_uri=artifact_uri)\r\n  File \"/opt/conda/lib/python2.7/site-packages/mlflow/server/handlers.py\", line 43, in _get_sqlalchemy_store\r\n    return SqlAlchemyStore(store_uri, artifact_uri)\r\n  File \"/opt/conda/lib/python2.7/site-packages/mlflow/store/sqlalchemy_store.py\", line 100, in __init__\r\n    self._create_default_experiment(session)\r\n  File \"/opt/conda/lib/python2.7/contextlib.py\", line 35, in __exit__\r\n    self.gen.throw(type, value, traceback)\r\n  File \"/opt/conda/lib/python2.7/site-packages/mlflow/store/sqlalchemy_store.py\", line 156, in make_managed_session\r\n    raise MlflowException(message=e, error_code=INTERNAL_ERROR)\r\nMlflowException: (MySQLdb._exceptions.ProgrammingError) (1064, \"You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '://mlflow-artifact-store-poc/0, 'active', 'Default', 0)' at line 1\")\r\n[SQL: INSERT INTO experiments (artifact_location, lifecycle_stage, name, experiment_id) VALUES (s3://mlflow-artifact-store-poc/0, 'active', 'Default', 0);]\r\n(Background on this error at: http://sqlalche.me/e/f405)\r\n```\r\n\r\n\r\n\r\n","closed_by":{"login":"stale[bot]","id":26384082,"node_id":"MDM6Qm90MjYzODQwODI=","avatar_url":"https://avatars.githubusercontent.com/in/1724?v=4","gravatar_id":"","url":"https://api.github.com/users/stale%5Bbot%5D","html_url":"https://github.com/apps/stale","followers_url":"https://api.github.com/users/stale%5Bbot%5D/followers","following_url":"https://api.github.com/users/stale%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stale%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/stale%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/stale%5Bbot%5D/repos","events_url":"https://api.github.com/users/stale%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/stale%5Bbot%5D/received_events","type":"Bot","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1761/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/1761/timeline","performed_via_github_app":null,"state_reason":"completed"}