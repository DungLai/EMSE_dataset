{"url":"https://api.github.com/repos/mlflow/mlflow/issues/5949","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/5949/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/5949/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/5949/events","html_url":"https://github.com/mlflow/mlflow/issues/5949","id":1249357856,"node_id":"I_kwDOCB5Jx85Kd7Ag","number":5949,"title":"Can't import mlflow due to protobuf update to version 4.21 [BUG]","user":{"login":"diego-pm","id":99246556,"node_id":"U_kgDOBeph3A","avatar_url":"https://avatars.githubusercontent.com/u/99246556?v=4","gravatar_id":"","url":"https://api.github.com/users/diego-pm","html_url":"https://github.com/diego-pm","followers_url":"https://api.github.com/users/diego-pm/followers","following_url":"https://api.github.com/users/diego-pm/following{/other_user}","gists_url":"https://api.github.com/users/diego-pm/gists{/gist_id}","starred_url":"https://api.github.com/users/diego-pm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diego-pm/subscriptions","organizations_url":"https://api.github.com/users/diego-pm/orgs","repos_url":"https://api.github.com/users/diego-pm/repos","events_url":"https://api.github.com/users/diego-pm/events{/privacy}","received_events_url":"https://api.github.com/users/diego-pm/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":14,"created_at":"2022-05-26T09:59:35Z","updated_at":"2022-06-08T05:41:00Z","closed_at":"2022-05-26T14:24:08Z","author_association":"NONE","active_lock_reason":null,"body":"### System information\r\n\r\nmlflow version: 1.26\r\npython version: 3.7\r\n\r\n\r\n### Describe the problem\r\n\r\nCannot import mlflow with the latest dependency of protobuf (4.21)\r\n\r\n### Tracking information\r\n\r\n_No response_\r\n\r\n### Code to reproduce issue\r\n\r\n```python\r\nimport mlflow\r\n```\r\n\r\n### Other info / logs\r\n\r\n```python-traceback\r\nTypeError                                 Traceback (most recent call last)\r\n<command-4092054516117478> in <module>\r\n----> 1 import mlflow\r\n\r\n/local_disk0/pythonVirtualEnvDirs/virtualEnv-b0db65a3-9256-450f-9467-e817ece7ad9e/lib/python3.7/importlib/_bootstrap.py in _find_and_load(name, import_)\r\n\r\n/local_disk0/pythonVirtualEnvDirs/virtualEnv-b0db65a3-9256-450f-9467-e817ece7ad9e/lib/python3.7/importlib/_bootstrap.py in _find_and_load_unlocked(name, import_)\r\n\r\n/local_disk0/pythonVirtualEnvDirs/virtualEnv-b0db65a3-9256-450f-9467-e817ece7ad9e/lib/python3.7/importlib/_bootstrap.py in _load_unlocked(spec)\r\n\r\n/local_disk0/pythonVirtualEnvDirs/virtualEnv-b0db65a3-9256-450f-9467-e817ece7ad9e/lib/python3.7/importlib/_bootstrap.py in _load_backward_compatible(spec)\r\n\r\n/local_disk0/tmp/1653558472209-0/PostImportHook.py in load_module(self, fullname)\r\n    187 \r\n    188     def load_module(self, fullname):\r\n--> 189         module = self.loader.load_module(fullname)\r\n    190         notify_module_loaded(module)\r\n    191 \r\n\r\n/databricks/python/lib/python3.7/site-packages/mlflow/__init__.py in <module>\r\n     30 from mlflow.version import VERSION as __version__  # pylint: disable=unused-import\r\n     31 from mlflow.utils.logging_utils import _configure_mlflow_loggers\r\n---> 32 import mlflow.tracking._model_registry.fluent\r\n     33 import mlflow.tracking.fluent\r\n     34 \r\n\r\n/databricks/python/lib/python3.7/site-packages/mlflow/tracking/__init__.py in <module>\r\n      6 \"\"\"\r\n      7 \r\n----> 8 from mlflow.tracking.client import MlflowClient\r\n      9 from mlflow.tracking._tracking_service.utils import (\r\n     10     set_tracking_uri,\r\n\r\n/local_disk0/pythonVirtualEnvDirs/virtualEnv-b0db65a3-9256-450f-9467-e817ece7ad9e/lib/python3.7/importlib/_bootstrap.py in _find_and_load(name, import_)\r\n\r\n/local_disk0/pythonVirtualEnvDirs/virtualEnv-b0db65a3-9256-450f-9467-e817ece7ad9e/lib/python3.7/importlib/_bootstrap.py in _find_and_load_unlocked(name, import_)\r\n\r\n/local_disk0/pythonVirtualEnvDirs/virtualEnv-b0db65a3-9256-450f-9467-e817ece7ad9e/lib/python3.7/importlib/_bootstrap.py in _load_unlocked(spec)\r\n\r\n/local_disk0/pythonVirtualEnvDirs/virtualEnv-b0db65a3-9256-450f-9467-e817ece7ad9e/lib/python3.7/importlib/_bootstrap.py in _load_backward_compatible(spec)\r\n\r\n/local_disk0/tmp/1653558472209-0/PostImportHook.py in load_module(self, fullname)\r\n    187 \r\n    188     def load_module(self, fullname):\r\n--> 189         module = self.loader.load_module(fullname)\r\n    190         notify_module_loaded(module)\r\n    191 \r\n\r\n/databricks/python/lib/python3.7/site-packages/mlflow/tracking/client.py in <module>\r\n     14 from typing import Any, Dict, Sequence, List, Optional, Union, TYPE_CHECKING\r\n     15 \r\n---> 16 from mlflow.entities import Experiment, Run, RunInfo, Param, Metric, RunTag, FileInfo, ViewType\r\n     17 from mlflow.store.entities.paged_list import PagedList\r\n     18 from mlflow.entities.model_registry import RegisteredModel, ModelVersion\r\n\r\n/databricks/python/lib/python3.7/site-packages/mlflow/entities/__init__.py in <module>\r\n      4 \"\"\"\r\n      5 \r\n----> 6 from mlflow.entities.experiment import Experiment\r\n      7 from mlflow.entities.experiment_tag import ExperimentTag\r\n      8 from mlflow.entities.file_info import FileInfo\r\n\r\n/databricks/python/lib/python3.7/site-packages/mlflow/entities/experiment.py in <module>\r\n      1 from mlflow.entities._mlflow_object import _MLflowObject\r\n----> 2 from mlflow.entities.experiment_tag import ExperimentTag\r\n      3 from mlflow.protos.service_pb2 import (\r\n      4     Experiment as ProtoExperiment,\r\n      5     ExperimentTag as ProtoExperimentTag,\r\n\r\n/databricks/python/lib/python3.7/site-packages/mlflow/entities/experiment_tag.py in <module>\r\n      1 from mlflow.entities._mlflow_object import _MLflowObject\r\n----> 2 from mlflow.protos.service_pb2 import ExperimentTag as ProtoExperimentTag\r\n      3 \r\n      4 \r\n      5 class ExperimentTag(_MLflowObject):\r\n\r\n/databricks/python/lib/python3.7/site-packages/mlflow/protos/service_pb2.py in <module>\r\n     16 \r\n     17 \r\n---> 18 from .scalapb import scalapb_pb2 as scalapb_dot_scalapb__pb2\r\n     19 from . import databricks_pb2 as databricks__pb2\r\n     20 \r\n\r\n/databricks/python/lib/python3.7/site-packages/mlflow/protos/scalapb/scalapb_pb2.py in <module>\r\n     33   message_type=None, enum_type=None, containing_type=None,\r\n     34   is_extension=True, extension_scope=None,\r\n---> 35   serialized_options=None, file=DESCRIPTOR)\r\n     36 MESSAGE_FIELD_NUMBER = 1020\r\n     37 message = _descriptor.FieldDescriptor(\r\n\r\n/databricks/python/lib/python3.7/site-packages/google/protobuf/descriptor.py in __new__(cls, name, full_name, index, number, type, cpp_type, label, default_value, message_type, enum_type, containing_type, is_extension, extension_scope, options, serialized_options, has_default_value, containing_oneof, json_name, file, create_key)\r\n    558                 has_default_value=True, containing_oneof=None, json_name=None,\r\n    559                 file=None, create_key=None):  # pylint: disable=redefined-builtin\r\n--> 560       _message.Message._CheckCalledFromGeneratedFile()\r\n    561       if is_extension:\r\n    562         return _message.default_pool.FindExtensionByName(full_name)\r\n\r\nTypeError: Descriptors cannot not be created directly.\r\nIf this call came from a _pb2.py file, your generated code is out of date and must be regenerated with protoc >= 3.19.0.\r\nIf you cannot immediately regenerate your protos, some other possible workarounds are:\r\n 1. Downgrade the protobuf package to 3.20.x or lower.\r\n 2. Set PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION=python (but this will use pure-Python parsing and will be much slower).\r\n\r\nMore information: https://developers.google.com/protocol-buffers/docs/news/2022-05-06#python-updates\r\n```\r\n\r\n### What component(s) does this bug affect?\r\n\r\n- [ ] `area/artifacts`: Artifact stores and artifact logging\r\n- [ ] `area/build`: Build and test infrastructure for MLflow\r\n- [ ] `area/docs`: MLflow documentation pages\r\n- [ ] `area/examples`: Example code\r\n- [ ] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\r\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\r\n- [ ] `area/projects`: MLproject format, project running backends\r\n- [ ] `area/scoring`: MLflow Model server, model deployment tools, Spark UDFs\r\n- [ ] `area/server-infra`: MLflow Tracking server backend\r\n- [ ] `area/tracking`: Tracking Service, tracking client APIs, autologging\r\n\r\n### What interface(s) does this bug affect?\r\n\r\n- [ ] `area/uiux`: Front-end, user experience, plotting, JavaScript, JavaScript dev server\r\n- [ ] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\r\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\r\n- [ ] `area/windows`: Windows support\r\n\r\n### What language(s) does this bug affect?\r\n\r\n- [ ] `language/r`: R APIs and clients\r\n- [ ] `language/java`: Java APIs and clients\r\n- [ ] `language/new`: Proposals for new client languages\r\n\r\n### What integration(s) does this bug affect?\r\n\r\n- [ ] `integrations/azure`: Azure and Azure ML integrations\r\n- [ ] `integrations/sagemaker`: SageMaker integrations\r\n- [ ] `integrations/databricks`: Databricks integrations","closed_by":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/5949/reactions","total_count":7,"+1":7,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/5949/timeline","performed_via_github_app":null,"state_reason":"completed"}