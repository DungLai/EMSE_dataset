{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2227","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2227/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2227/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2227/events","html_url":"https://github.com/mlflow/mlflow/issues/2227","id":540001758,"node_id":"MDU6SXNzdWU1NDAwMDE3NTg=","number":2227,"title":"[BUG]mlflow run cannot call set_experiment","user":{"login":"HugangR","id":25859225,"node_id":"MDQ6VXNlcjI1ODU5MjI1","avatar_url":"https://avatars.githubusercontent.com/u/25859225?v=4","gravatar_id":"","url":"https://api.github.com/users/HugangR","html_url":"https://github.com/HugangR","followers_url":"https://api.github.com/users/HugangR/followers","following_url":"https://api.github.com/users/HugangR/following{/other_user}","gists_url":"https://api.github.com/users/HugangR/gists{/gist_id}","starred_url":"https://api.github.com/users/HugangR/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HugangR/subscriptions","organizations_url":"https://api.github.com/users/HugangR/orgs","repos_url":"https://api.github.com/users/HugangR/repos","events_url":"https://api.github.com/users/HugangR/events{/privacy}","received_events_url":"https://api.github.com/users/HugangR/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022849295,"node_id":"MDU6TGFiZWwyMDIyODQ5Mjk1","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/tracking","name":"area/tracking","color":"48eabc","default":false,"description":"Tracking service, tracking client APIs, autologging"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2019-12-19T00:32:37Z","updated_at":"2020-07-02T00:21:31Z","closed_at":"2020-07-02T00:21:31Z","author_association":"NONE","active_lock_reason":null,"body":"Thank you for submitting an issue. Please refer to our [issue policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md)\r\nfor information on what types of issues we address. For help with debugging your code, please refer to [Stack Overflow](https://stackoverflow.com/questions/tagged/mlflow).\r\n\r\nPlease fill in this template and do not delete it unless you are sure your issue is outside its scope.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**:Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Windows 10 1909\r\n- **MLflow installed from (source or binary)**: binary\r\n- **MLflow version (run ``mlflow --version``)**:1.4.0\r\n- **Python version**:3.8.0\r\n- **npm version, if running the dev UI**:N/A\r\n- **Exact command to reproduce**:mlflow run examples/sklearn_elasticnet_wine -P alpha=0.42\r\n\r\n### Describe the problem\r\nDescribe the problem clearly here. Include descriptions of the expected behavior and the actual behavior.\r\n\r\nWhen I ran the tutorial about mlflow run (https://www.mlflow.org/docs/latest/tutorial.html#packaging-the-training-code)\r\n\r\nThe default code works. However, once I added \"mlflow.set_experiment(\"test\")\" on line 55 before \"with mlflow.start_run():\",\r\n\r\nit gave this error message:\r\n\r\n\r\n\r\n### Code to reproduce issue\r\nProvide a reproducible test case that is the bare minimum necessary to generate the problem.\r\n# The data set used in this example is from http://archive.ics.uci.edu/ml/datasets/Wine+Quality\r\n# P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis.\r\n# Modeling wine preferences by data mining from physicochemical properties. In Decision Support Systems, Elsevier, 47(4):547-553, 2009.\r\n\r\nimport os\r\nimport warnings\r\nimport sys\r\n\r\nimport pandas as pd\r\nimport numpy as np\r\nfrom sklearn.metrics import mean_squared_error, mean_absolute_error, r2_score\r\nfrom sklearn.model_selection import train_test_split\r\nfrom sklearn.linear_model import ElasticNet\r\n\r\nimport mlflow\r\nimport mlflow.sklearn\r\n\r\nimport logging\r\nlogging.basicConfig(level=logging.WARN)\r\nlogger = logging.getLogger(__name__)\r\n\r\n\r\ndef eval_metrics(actual, pred):\r\n    rmse = np.sqrt(mean_squared_error(actual, pred))\r\n    mae = mean_absolute_error(actual, pred)\r\n    r2 = r2_score(actual, pred)\r\n    return rmse, mae, r2\r\n\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    warnings.filterwarnings(\"ignore\")\r\n    np.random.seed(40)\r\n\r\n    # Read the wine-quality csv file from the URL\r\n    csv_url =\\\r\n        'http://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-red.csv'\r\n    try:\r\n        data = pd.read_csv(csv_url, sep=';')\r\n    except Exception as e:\r\n        logger.exception(\r\n            \"Unable to download training & test CSV, check your internet connection. Error: %s\", e)\r\n\r\n    # Split the data into training and test sets. (0.75, 0.25) split.\r\n    train, test = train_test_split(data)\r\n\r\n    # The predicted column is \"quality\" which is a scalar from [3, 9]\r\n    train_x = train.drop([\"quality\"], axis=1)\r\n    test_x = test.drop([\"quality\"], axis=1)\r\n    train_y = train[[\"quality\"]]\r\n    test_y = test[[\"quality\"]]\r\n\r\n    alpha = float(sys.argv[1]) if len(sys.argv) > 1 else 0.5\r\n    l1_ratio = float(sys.argv[2]) if len(sys.argv) > 2 else 0.5\r\n    mlflow.set_experiment(\"test\")\r\n    with mlflow.start_run():\r\n        lr = ElasticNet(alpha=alpha, l1_ratio=l1_ratio, random_state=42)\r\n        lr.fit(train_x, train_y)\r\n\r\n        predicted_qualities = lr.predict(test_x)\r\n\r\n        (rmse, mae, r2) = eval_metrics(test_y, predicted_qualities)\r\n\r\n        print(\"Elasticnet model (alpha=%f, l1_ratio=%f):\" % (alpha, l1_ratio))\r\n        print(\"  RMSE: %s\" % rmse)\r\n        print(\"  MAE: %s\" % mae)\r\n        print(\"  R2: %s\" % r2)\r\n\r\n        mlflow.log_param(\"alpha\", alpha)\r\n        mlflow.log_param(\"l1_ratio\", l1_ratio)\r\n        mlflow.log_metric(\"rmse\", rmse)\r\n        mlflow.log_metric(\"r2\", r2)\r\n        mlflow.log_metric(\"mae\", mae)\r\n\r\n        mlflow.sklearn.log_model(lr, \"model\")\r\n\r\n### Other info / logs\r\nInclude any logs or source code that would be helpful to diagnose the problem. If including tracebacks,\r\nplease include the full traceback. Large logs and files should be attached.\r\n(mlflowprojecttest) XXX>mlflow run examples/sklearn_elasticnet_wine -P alpha=0.42\r\n2019/12/18 16:25:22 INFO mlflow.projects: === Creating conda environment mlflow-c48cb3f50ce83eb7b7e05ba90cd663b336c6eec1 ===\r\nWarning: you have pip-installed dependencies in your environment file, but you do not list pip itself as one of your conda dependencies.  Conda may not use the correct pip to install your packages, and they may end up in the wrong place.  Please add an explicit pip dependency.  I'm adding one for you, but still nagging you.\r\nCollecting package metadata (repodata.json): done\r\nSolving environment: done\r\nPreparing transaction: done\r\nVerifying transaction: done\r\nExecuting transaction: done\r\nRan pip subprocess with arguments:\r\n['C:\\\\Users\\\\XXXXX\\\\Anaconda3\\\\envs\\\\mlflow-c48cb3f50ce83eb7b7e05ba90cd663b336c6eec1\\\\python.exe', '-m', 'pip', 'install', '-U', '-r', 'D:\\\\Git\\\\mlflow\\\\examples\\\\sklearn_elasticnet_wine\\\\condaenv.ye104r_q.requirements.txt']\r\nPip subprocess output:\r\nProcessing c:\\users\\xxx\\appdata\\local\\pip\\cache\\wheels\\5d\\0e\\cc\\79315d41833b92a8a9e276716874f2c1dc654018b44632dc06\\mlflow-1.4.0-cp36-none-any.whl\r\nCollecting Flask\r\n  Using cached https://files.pythonhosted.org/packages/9b/93/628509b8d5dc749656a9641f4caf13540e2cdec85276964ff8f43bbb1d3b/Flask-1.1.1-py2.py3-none-any.whl\r\nRequirement already satisfied, skipping upgrade: numpy in c:\\users\\xxxx\\anaconda3\\envs\\mlflow-c48cb3f50ce83eb7b7e05ba90cd663b336c6eec1\\lib\\site-packages (from mlflow==1.4.0->-r D:\\Git\\mlflow\\examples\\sklearn_elasticnet_wine\\condaenv.ye104r_q.requirements.txt (line 1)) (1.15.4)\r\nCollecting simplejson\r\n  Using cached https://files.pythonhosted.org/packages/7a/62/6b9dcd8727a3139c5335653a3447e5fea81c225766857f75243e07e3b285/simplejson-3.17.0-cp36-cp36m-win_amd64.whl\r\nCollecting python-dateutil\r\n  Using cached https://files.pythonhosted.org/packages/d4/70/d60450c3dd48ef87586924207ae8907090de0b306af2bce5d134d78615cb/python_dateutil-2.8.1-py2.py3-none-any.whl\r\nCollecting six>=1.10.0\r\n  Using cached https://files.pythonhosted.org/packages/65/26/32b8464df2a97e6dd1b656ed26b2c194606c16fe163c695a992b36c11cdf/six-1.13.0-py2.py3-none-any.whl\r\nCollecting pyyaml\r\n  Using cached https://files.pythonhosted.org/packages/58/1f/00682a829890131bcc71755e78d595e439bd6b291ea9bd5ced93ed57cc3d/PyYAML-5.2-cp36-cp36m-win_amd64.whl\r\nCollecting requests>=2.17.3\r\n  Using cached https://files.pythonhosted.org/packages/51/bd/23c926cd341ea6b7dd0b2a00aba99ae0f828be89d72b2190f27c11d4b7fb/requests-2.22.0-py2.py3-none-any.whl\r\nProcessing c:\\users\\xxx\\appdata\\local\\pip\\cache\\wheels\\ee\\33\\44\\0788a6e806866ae2e246d5cd841d07498a46bcb3f3c42ea5a4\\sqlalchemy-1.3.12-cp36-cp36m-win_amd64.whl\r\nCollecting entrypoints\r\n  Using cached https://files.pythonhosted.org/packages/ac/c6/44694103f8c221443ee6b0041f69e2740d89a25641e62fb4f2ee568f2f9c/entrypoints-0.3-py2.py3-none-any.whl\r\nCollecting gorilla\r\n  Using cached https://files.pythonhosted.org/packages/e3/56/5a683944cbfc77e429c6f03c636ca50504a785f60ffae91ddd7f5f7bb520/gorilla-0.3.0-py2.py3-none-any.whl\r\nCollecting cloudpickle\r\n  Using cached https://files.pythonhosted.org/packages/c1/49/334e279caa3231255725c8e860fa93e72083567625573421db8875846c14/cloudpickle-1.2.2-py2.py3-none-any.whl\r\nProcessing c:\\users\\xxx\\appdata\\local\\pip\\cache\\wheels\\bc\\27\\58\\c6ef96e649962e9584a50f58d5b6abafb71a03512b2e381ad1\\databricks_cli-0.9.1-cp36-none-any.whl\r\nProcessing c:\\users\\xxx\\appdata\\local\\pip\\cache\\wheels\\5c\\66\\53\\e0633382ac8625ab1c099db6a290d1b6b24f849a4666a57105\\alembic-1.3.2-py2.py3-none-any.whl\r\nCollecting waitress; platform_system == \"Windows\"\r\n  Using cached https://files.pythonhosted.org/packages/2d/0b/84a7da7fd12ee556dd193c24b635a11b840d314bc580771dd2a3151450c9/waitress-1.3.1-py2.py3-none-any.whl\r\nCollecting protobuf>=3.6.0\r\n  Using cached https://files.pythonhosted.org/packages/78/c5/5f64362524497c0ab5f532f58d605c9a6f75a7313974893f6c3168903dfe/protobuf-3.11.1-cp36-cp36m-win_amd64.whl\r\nCollecting sqlparse\r\n  Using cached https://files.pythonhosted.org/packages/ef/53/900f7d2a54557c6a37886585a91336520e5539e3ae2423ff1102daf4f3a7/sqlparse-0.3.0-py2.py3-none-any.whl\r\nCollecting click>=7.0\r\n  Using cached https://files.pythonhosted.org/packages/fa/37/45185cb5abbc30d7257104c434fe0b07e5a195a6847506c074527aa599ec/Click-7.0-py2.py3-none-any.whl\r\nCollecting pandas\r\n  Using cached https://files.pythonhosted.org/packages/f0/ac/92c3d2f0b627efbd1a7b2156faa697f9c2bbd7b0fe83ba8a9d36f982156f/pandas-0.25.3-cp36-cp36m-win_amd64.whl\r\nCollecting gitpython>=2.1.0\r\n  Using cached https://files.pythonhosted.org/packages/20/8c/4543981439d23c4ff65b2e62dddd767ebc84a8e664a9b67e840d1e2730d3/GitPython-3.0.5-py3-none-any.whl\r\nProcessing c:\\users\\xxx\\appdata\\local\\pip\\cache\\wheels\\1e\\41\\34\\23ebf5d1089a9aed847951e0ee375426eb4ad0a7079d88d41e\\querystring_parser-1.2.4-cp36-none-any.whl\r\nCollecting docker>=4.0.0\r\n  Using cached https://files.pythonhosted.org/packages/cc/ca/699d4754a932787ef353a157ada74efd1ceb6d1fc0bfb7989ae1e7b33111/docker-4.1.0-py2.py3-none-any.whl\r\nCollecting Werkzeug>=0.15\r\n  Using cached https://files.pythonhosted.org/packages/ce/42/3aeda98f96e85fd26180534d36570e4d18108d62ae36f87694b476b83d6f/Werkzeug-0.16.0-py2.py3-none-any.whl\r\nCollecting Jinja2>=2.10.1\r\n  Using cached https://files.pythonhosted.org/packages/65/e0/eb35e762802015cab1ccee04e8a277b03f1d8e53da3ec3106882ec42558b/Jinja2-2.10.3-py2.py3-none-any.whl\r\nCollecting itsdangerous>=0.24\r\n  Using cached https://files.pythonhosted.org/packages/76/ae/44b03b253d6fade317f32c24d100b3b35c2239807046a4c953c7b89fa49e/itsdangerous-1.1.0-py2.py3-none-any.whl\r\nCollecting idna<2.9,>=2.5\r\n  Using cached https://files.pythonhosted.org/packages/14/2c/cd551d81dbe15200be1cf41cd03869a46fe7226e7450af7a6545bfc474c9/idna-2.8-py2.py3-none-any.whl\r\nCollecting chardet<3.1.0,>=3.0.2\r\n  Using cached https://files.pythonhosted.org/packages/bc/a9/01ffebfb562e4274b6487b4bb1ddec7ca55ec7510b22e4c51f14098443b8/chardet-3.0.4-py2.py3-none-any.whl\r\nRequirement already satisfied, skipping upgrade: certifi>=2017.4.17 in c:\\users\\xxx\\anaconda3\\envs\\mlflow-c48cb3f50ce83eb7b7e05ba90cd663b336c6eec1\\lib\\site-packages (from requests>=2.17.3->mlflow==1.4.0->-r D:\\Git\\mlflow\\examples\\sklearn_elasticnet_wine\\condaenv.ye104r_q.requirements.txt (line 1)) (2019.11.28)\r\nCollecting urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1\r\n  Using cached https://files.pythonhosted.org/packages/b4/40/a9837291310ee1ccc242ceb6ebfd9eb21539649f193a7c8c86ba15b98539/urllib3-1.25.7-py2.py3-none-any.whl\r\nCollecting configparser>=0.3.5\r\n  Using cached https://files.pythonhosted.org/packages/7a/2a/95ed0501cf5d8709490b1d3a3f9b5cf340da6c433f896bbe9ce08dbe6785/configparser-4.0.2-py2.py3-none-any.whl\r\nProcessing c:\\users\\xxx\\appdata\\local\\pip\\cache\\wheels\\9c\\9b\\f4\\eb243fdb89676ec00588e8c54bb54360724c06e7fafe95278e\\tabulate-0.8.6-cp36-none-any.whl\r\nProcessing c:\\users\\xxx\\appdata\\local\\pip\\cache\\wheels\\98\\32\\7b\\a291926643fc1d1e02593e0d9e247c5a866a366b8343b7aa27\\mako-1.1.0-cp36-none-any.whl\r\nCollecting python-editor>=0.3\r\n  Using cached https://files.pythonhosted.org/packages/c6/d3/201fc3abe391bbae6606e6f1d598c15d367033332bd54352b12f35513717/python_editor-1.0.4-py3-none-any.whl\r\nRequirement already satisfied, skipping upgrade: setuptools in c:\\users\\xxx\\anaconda3\\envs\\mlflow-c48cb3f50ce83eb7b7e05ba90cd663b336c6eec1\\lib\\site-packages (from protobuf>=3.6.0->mlflow==1.4.0->-r D:\\Git\\mlflow\\examples\\sklearn_elasticnet_wine\\condaenv.ye104r_q.requirements.txt (line 1)) (42.0.2.post20191203)\r\nCollecting pytz>=2017.2\r\n  Using cached https://files.pythonhosted.org/packages/e7/f9/f0b53f88060247251bf481fa6ea62cd0d25bf1b11a87888e53ce5b7c8ad2/pytz-2019.3-py2.py3-none-any.whl\r\nCollecting gitdb2>=2.0.0\r\n  Using cached https://files.pythonhosted.org/packages/03/6c/99296f89bad2ef85626e1df9f677acbee8885bb043ad82ad3ed4746d2325/gitdb2-2.0.6-py2.py3-none-any.whl\r\nCollecting pypiwin32==223; sys_platform == \"win32\" and python_version >= \"3.6\"\r\n  Using cached https://files.pythonhosted.org/packages/d0/1b/2f292bbd742e369a100c91faa0483172cd91a1a422a6692055ac920946c5/pypiwin32-223-py3-none-any.whl\r\nCollecting websocket-client>=0.32.0\r\n  Using cached https://files.pythonhosted.org/packages/29/19/44753eab1fdb50770ac69605527e8859468f3c0fd7dc5a76dd9c4dbd7906/websocket_client-0.56.0-py2.py3-none-any.whl\r\nCollecting MarkupSafe>=0.23\r\n  Using cached https://files.pythonhosted.org/packages/b9/82/833c7714951bff8f502ed054e6fbd8bd00e083d1fd96de6a46905cf23378/MarkupSafe-1.1.1-cp36-cp36m-win_amd64.whl\r\nCollecting smmap2>=2.0.0\r\n  Using cached https://files.pythonhosted.org/packages/55/d2/866d45e3a121ee15a1dc013824d58072fd5c7799c9c34d01378eb262ca8f/smmap2-2.0.5-py2.py3-none-any.whl\r\nCollecting pywin32>=223\r\n  Using cached https://files.pythonhosted.org/packages/f7/76/29e8e24a4967eb40fdf2f525aae53a1fd6e606382d957aa403f3f12ea235/pywin32-227-cp36-cp36m-win_amd64.whl\r\nInstalling collected packages: Werkzeug, click, MarkupSafe, Jinja2, itsdangerous, Flask, simplejson, six, python-dateutil, pyyaml, idna, chardet, urllib3, requests, sqlalchemy, entrypoints, gorilla, cloudpickle, configparser, tabulate, databricks-cli, Mako, python-editor, alembic, waitress, protobuf, sqlparse, pytz, pandas, smmap2, gitdb2, gitpython, querystring-parser, pywin32, pypiwin32, websocket-client, docker, mlflow\r\nSuccessfully installed Flask-1.1.1 Jinja2-2.10.3 Mako-1.1.0 MarkupSafe-1.1.1 Werkzeug-0.16.0 alembic-1.3.2 chardet-3.0.4 click-7.0 cloudpickle-1.2.2 configparser-4.0.2 databricks-cli-0.9.1 docker-4.1.0 entrypoints-0.3 gitdb2-2.0.6 gitpython-3.0.5 gorilla-0.3.0 idna-2.8 itsdangerous-1.1.0 mlflow-1.4.0 pandas-0.25.3 protobuf-3.11.1 pypiwin32-223 python-dateutil-2.8.1 python-editor-1.0.4 pytz-2019.3 pywin32-227 pyyaml-5.2 querystring-parser-1.2.4 requests-2.22.0 simplejson-3.17.0 six-1.13.0 smmap2-2.0.5 sqlalchemy-1.3.12 sqlparse-0.3.0 tabulate-0.8.6 urllib3-1.25.7 waitress-1.3.1 websocket-client-0.56.0\r\n\r\n#\r\n# To activate this environment, use\r\n#\r\n#     $ conda activate mlflow-c48cb3f50ce83eb7b7e05ba90cd663b336c6eec1\r\n#\r\n# To deactivate an active environment, use\r\n#\r\n#     $ conda deactivate\r\n\r\n2019/12/18 16:26:16 INFO mlflow.projects: === Created directory C:\\Users\\xxx\\AppData\\Local\\Temp\\tmpraxile5x for downloading remote URIs passed to arguments of type 'path' ===\r\n2019/12/18 16:26:16 INFO mlflow.projects: === Running command 'conda.bat activate mlflow-c48cb3f50ce83eb7b7e05ba90cd663b336c6eec1 && python train.py 0.42 0.1' in run with ID '99beae565eb9453286430860205d463a' ===\r\nTraceback (most recent call last):\r\n  File \"train.py\", line 56, in <module>\r\n    with mlflow.start_run():\r\n  File \"C:\\Users\\xxx\\Anaconda3\\envs\\mlflow-c48cb3f50ce83eb7b7e05ba90cd663b336c6eec1\\lib\\site-packages\\mlflow\\tracking\\fluent.py\", line 129, in start_run\r\n    \"arguments\".format(existing_run_id))\r\nmlflow.exceptions.MlflowException: Cannot start run with ID 99beae565eb9453286430860205d463a because active run ID does not match environment run ID. Make sure --experiment-name or --experiment-id matches experiment set with set_experiment(), or just use command-line arguments\r\n2019/12/18 16:26:21 ERROR mlflow.cli: === Run (ID '99beae565eb9453286430860205d463a') failed ===","closed_by":{"login":"dmatrix","id":1117597,"node_id":"MDQ6VXNlcjExMTc1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1117597?v=4","gravatar_id":"","url":"https://api.github.com/users/dmatrix","html_url":"https://github.com/dmatrix","followers_url":"https://api.github.com/users/dmatrix/followers","following_url":"https://api.github.com/users/dmatrix/following{/other_user}","gists_url":"https://api.github.com/users/dmatrix/gists{/gist_id}","starred_url":"https://api.github.com/users/dmatrix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmatrix/subscriptions","organizations_url":"https://api.github.com/users/dmatrix/orgs","repos_url":"https://api.github.com/users/dmatrix/repos","events_url":"https://api.github.com/users/dmatrix/events{/privacy}","received_events_url":"https://api.github.com/users/dmatrix/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2227/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2227/timeline","performed_via_github_app":null,"state_reason":"completed"}