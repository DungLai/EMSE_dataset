{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1680","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/1680/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/1680/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/1680/events","html_url":"https://github.com/mlflow/mlflow/issues/1680","id":474603988,"node_id":"MDU6SXNzdWU0NzQ2MDM5ODg=","number":1680,"title":"[FR] Add periodic tasks to be executed by the tracking server","user":{"login":"jdlesage","id":658597,"node_id":"MDQ6VXNlcjY1ODU5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/658597?v=4","gravatar_id":"","url":"https://api.github.com/users/jdlesage","html_url":"https://github.com/jdlesage","followers_url":"https://api.github.com/users/jdlesage/followers","following_url":"https://api.github.com/users/jdlesage/following{/other_user}","gists_url":"https://api.github.com/users/jdlesage/gists{/gist_id}","starred_url":"https://api.github.com/users/jdlesage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdlesage/subscriptions","organizations_url":"https://api.github.com/users/jdlesage/orgs","repos_url":"https://api.github.com/users/jdlesage/repos","events_url":"https://api.github.com/users/jdlesage/events{/privacy}","received_events_url":"https://api.github.com/users/jdlesage/received_events","type":"User","site_admin":false},"labels":[{"id":955449434,"node_id":"MDU6TGFiZWw5NTU0NDk0MzQ=","url":"https://api.github.com/repos/mlflow/mlflow/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2019-07-30T14:01:45Z","updated_at":"2019-12-20T16:54:16Z","closed_at":"2019-12-20T16:54:16Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Thank you for submitting an issue. Please refer to our [issue policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md)\r\nfor information on what types of issues we address.\r\n  \r\nPlease do not delete this template unless you are sure your issue is outside its scope.\r\n\r\n-------\r\n## Guidelines\r\n\r\nFeature requests typically go through the following lifecycle:\r\n\r\n1. Submit feature request with high-level description on GitHub issues (this is what you're doing now)\r\n2. Discuss feature request with a committer, who may ask for a more detailed design\r\n3. After discussion & agreement on feature request, start implementation\r\n\r\n\r\n## Describe the proposal\r\n\r\nIn order to operate the MLFlow tracking server, I would like to register periodic tasks to be executed by the server. These tasks could clean DB, pack artifacts into archives, monitor runs, etc.\r\n\r\n### Motivation\r\n\r\nAt Criteo, we start to operate a central MLflow tracking service. With the number of runs, we start facing some issues. To fix them, we would like to register some periodic tasks related to MLFlow. Here some examples:\r\n* We would like to aggregate timeseries metrics in order to reduce the load during search (https://github.com/mlflow/mlflow/issues/1571). \r\n* We would like to pack all artifacts into an archive after a run We are using HDFS as storage backend. The number of files is critical on this FileSystem.\r\n* We can also imagine to clean artifacts or runs after an amount of time in order to implement a retention policy.\r\n\r\nIn a first step, I would like to focus on the first usecase: aggregate timeseries metrics.\r\n\r\n## Possible alternative\r\n \r\nWe can use a separate process to do the cleanings. It will avoid changes in mlflow.  It will be another application to deploy... and this application will be strongly coupled to mlflow. That will make MLFlow deployment more complex. \r\nIMO, having some cleaning processes will become important with the number of runs. That's could be a nice feature to provide to everyone.\r\n\r\n### Proposed Changes\r\n\r\n1/ I would like to integrate into mlflow a scheduler that will execute periodic tasks. Candidate is ApScheduler (https://apscheduler.readthedocs.io/en/latest/)\r\n2/ Implement the method that aggregates metrics. It will be a new method of the SqlAlchemyStore\r\n3/ Create the periodic job that calls the method. Add configuration to enable it, to select the aggregation ratio (how many points to keep) and the condition to apply the aggregation (for example, runs must be > 24h old)","closed_by":{"login":"jdlesage","id":658597,"node_id":"MDQ6VXNlcjY1ODU5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/658597?v=4","gravatar_id":"","url":"https://api.github.com/users/jdlesage","html_url":"https://github.com/jdlesage","followers_url":"https://api.github.com/users/jdlesage/followers","following_url":"https://api.github.com/users/jdlesage/following{/other_user}","gists_url":"https://api.github.com/users/jdlesage/gists{/gist_id}","starred_url":"https://api.github.com/users/jdlesage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdlesage/subscriptions","organizations_url":"https://api.github.com/users/jdlesage/orgs","repos_url":"https://api.github.com/users/jdlesage/repos","events_url":"https://api.github.com/users/jdlesage/events{/privacy}","received_events_url":"https://api.github.com/users/jdlesage/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1680/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/1680/timeline","performed_via_github_app":null,"state_reason":"completed"}