{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2148","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2148/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2148/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2148/events","html_url":"https://github.com/mlflow/mlflow/issues/2148","id":529447259,"node_id":"MDU6SXNzdWU1Mjk0NDcyNTk=","number":2148,"title":"[BUG] mlflow serve models error","user":{"login":"TheEdoardo93","id":19664571,"node_id":"MDQ6VXNlcjE5NjY0NTcx","avatar_url":"https://avatars.githubusercontent.com/u/19664571?v=4","gravatar_id":"","url":"https://api.github.com/users/TheEdoardo93","html_url":"https://github.com/TheEdoardo93","followers_url":"https://api.github.com/users/TheEdoardo93/followers","following_url":"https://api.github.com/users/TheEdoardo93/following{/other_user}","gists_url":"https://api.github.com/users/TheEdoardo93/gists{/gist_id}","starred_url":"https://api.github.com/users/TheEdoardo93/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TheEdoardo93/subscriptions","organizations_url":"https://api.github.com/users/TheEdoardo93/orgs","repos_url":"https://api.github.com/users/TheEdoardo93/repos","events_url":"https://api.github.com/users/TheEdoardo93/events{/privacy}","received_events_url":"https://api.github.com/users/TheEdoardo93/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-11-27T16:17:03Z","updated_at":"2020-03-09T18:26:34Z","closed_at":"2019-12-05T13:27:05Z","author_association":"NONE","active_lock_reason":null,"body":"Thank you for submitting an issue. Please refer to our [issue policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md)\r\nfor information on what types of issues we address. For help with debugging your code, please refer to [Stack Overflow](https://stackoverflow.com/questions/tagged/mlflow).\r\n\r\nPlease fill in this template and do not delete it unless you are sure your issue is outside its scope.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: No, I'm following the tutorial code on README file\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Ubuntu 16.04\r\n- **MLflow installed from (source or binary)**: through `pip install mlflow` (today)\r\n- **MLflow version (run ``mlflow --version``)**: 1.4.0\r\n- **Python version**: 3.6.9\r\n- **npm version, if running the dev UI**: No\r\n- **Exact command to reproduce**: `mlflow models serve -m runs:/<RUN_ID>/model`\r\n\r\n### Describe the problem\r\nAfter the correct installation of mlflow through `pip install mlflow` (1.4.0 version), I've followed the [Quickstart](https://mlflow.org/docs/latest/quickstart.html).\r\nI've done the following steps in order:\r\n1) downloaded the _mlflow_ library with `git clone https://github.com/mlflow/mlflow` \r\n2) `cd mlflow/examples`\r\n3) run `mlflow run sklearn_logistic_regression/` --> it created a Conda env correctly, installing the necessary libraries. The output is the following:\r\n```\r\n2019/11/27 17:12:17 INFO mlflow.projects: === Creating conda environment mlflow-7fe9f24d100ade6523081ed2190877c5976a985c ===\r\nWarning: you have pip-installed dependencies in your environment file, but you do not list pip itself as one of your conda dependencies.  Conda may not use the correct pip to install your packages, and they may end up in the wrong place.  Please add an explicit pip dependency.  I'm adding one for you, but still nagging you.\r\nCollecting package metadata (repodata.json): done\r\nSolving environment: done\r\nPreparing transaction: done\r\nVerifying transaction: done\r\nExecuting transaction: done\r\nRan pip subprocess with arguments:\r\n['/home/vidiemme/anaconda3/envs/mlflow-7fe9f24d100ade6523081ed2190877c5976a985c/bin/python', '-m', 'pip', 'install', '-U', '-r', '/home/vidiemme/Desktop/mlflow-test/mlflow/examples/sklearn_logistic_regression/condaenv.erydi_jh.requirements.txt']\r\nPip subprocess output:\r\nProcessing /home/vidiemme/.cache/pip/wheels/5d/0e/cc/79315d41833b92a8a9e276716874f2c1dc654018b44632dc06/mlflow-1.4.0-cp36-none-any.whl\r\nCollecting gorilla\r\n  Using cached https://files.pythonhosted.org/packages/e3/56/5a683944cbfc77e429c6f03c636ca50504a785f60ffae91ddd7f5f7bb520/gorilla-0.3.0-py2.py3-none-any.whl\r\nCollecting cloudpickle\r\n  Using cached https://files.pythonhosted.org/packages/c1/49/334e279caa3231255725c8e860fa93e72083567625573421db8875846c14/cloudpickle-1.2.2-py2.py3-none-any.whl\r\nCollecting gitpython>=2.1.0\r\n  Using cached https://files.pythonhosted.org/packages/20/8c/4543981439d23c4ff65b2e62dddd767ebc84a8e664a9b67e840d1e2730d3/GitPython-3.0.5-py3-none-any.whl\r\nCollecting click>=7.0\r\n  Using cached https://files.pythonhosted.org/packages/fa/37/45185cb5abbc30d7257104c434fe0b07e5a195a6847506c074527aa599ec/Click-7.0-py2.py3-none-any.whl\r\nCollecting pandas\r\n  Using cached https://files.pythonhosted.org/packages/52/3f/f6a428599e0d4497e1595030965b5ba455fd8ade6e977e3c819973c4b41d/pandas-0.25.3-cp36-cp36m-manylinux1_x86_64.whl\r\nCollecting Flask\r\n  Using cached https://files.pythonhosted.org/packages/9b/93/628509b8d5dc749656a9641f4caf13540e2cdec85276964ff8f43bbb1d3b/Flask-1.1.1-py2.py3-none-any.whl\r\nRequirement already satisfied, skipping upgrade: protobuf>=3.6.0 in /home/vidiemme/.local/lib/python3.6/site-packages (from mlflow>=1.0->-r /home/vidiemme/Desktop/mlflow-test/mlflow/examples/sklearn_logistic_regression/condaenv.erydi_jh.requirements.txt (line 1)) (3.10.0)\r\nRequirement already satisfied, skipping upgrade: six>=1.10.0 in /home/vidiemme/.local/lib/python3.6/site-packages (from mlflow>=1.0->-r /home/vidiemme/Desktop/mlflow-test/mlflow/examples/sklearn_logistic_regression/condaenv.erydi_jh.requirements.txt (line 1)) (1.12.0)\r\nCollecting requests>=2.17.3\r\n  Using cached https://files.pythonhosted.org/packages/51/bd/23c926cd341ea6b7dd0b2a00aba99ae0f828be89d72b2190f27c11d4b7fb/requests-2.22.0-py2.py3-none-any.whl\r\nCollecting docker>=4.0.0\r\n  Using cached https://files.pythonhosted.org/packages/cc/ca/699d4754a932787ef353a157ada74efd1ceb6d1fc0bfb7989ae1e7b33111/docker-4.1.0-py2.py3-none-any.whl\r\nCollecting python-dateutil\r\n  Using cached https://files.pythonhosted.org/packages/d4/70/d60450c3dd48ef87586924207ae8907090de0b306af2bce5d134d78615cb/python_dateutil-2.8.1-py2.py3-none-any.whl\r\nProcessing /home/vidiemme/.cache/pip/wheels/b2/d4/19/5ab879d30af7cbc79e6dcc1d421795b1aa9d78f455b0412ef7/alembic-1.3.1-py2.py3-none-any.whl\r\nCollecting entrypoints\r\n  Using cached https://files.pythonhosted.org/packages/ac/c6/44694103f8c221443ee6b0041f69e2740d89a25641e62fb4f2ee568f2f9c/entrypoints-0.3-py2.py3-none-any.whl\r\nCollecting gunicorn; platform_system != \"Windows\"\r\n  Using cached https://files.pythonhosted.org/packages/69/ca/926f7cd3a2014b16870086b2d0fdc84a9e49473c68a8dff8b57f7c156f43/gunicorn-20.0.4-py2.py3-none-any.whl\r\nProcessing /home/vidiemme/.cache/pip/wheels/a3/67/7d/6c41104a1a08ff1a25e260d3edec3ac19203141d1aaa2f0975/SQLAlchemy-1.3.11-cp36-cp36m-linux_x86_64.whl\r\nCollecting sqlparse\r\n  Using cached https://files.pythonhosted.org/packages/ef/53/900f7d2a54557c6a37886585a91336520e5539e3ae2423ff1102daf4f3a7/sqlparse-0.3.0-py2.py3-none-any.whl\r\nProcessing /home/vidiemme/.cache/pip/wheels/bc/27/58/c6ef96e649962e9584a50f58d5b6abafb71a03512b2e381ad1/databricks_cli-0.9.1-cp36-none-any.whl\r\nProcessing /home/vidiemme/.cache/pip/wheels/86/c0/83/dcd0339abb2640544bb8e0938aab2d069cef55e5647ce6e097/simplejson-3.17.0-cp36-cp36m-linux_x86_64.whl\r\nProcessing /home/vidiemme/.cache/pip/wheels/d9/45/dd/65f0b38450c47cf7e5312883deb97d065e030c5cca0a365030/PyYAML-5.1.2-cp36-cp36m-linux_x86_64.whl\r\nProcessing /home/vidiemme/.cache/pip/wheels/1e/41/34/23ebf5d1089a9aed847951e0ee375426eb4ad0a7079d88d41e/querystring_parser-1.2.4-cp36-none-any.whl\r\nRequirement already satisfied, skipping upgrade: numpy in /home/vidiemme/anaconda3/envs/mlflow-7fe9f24d100ade6523081ed2190877c5976a985c/lib/python3.6/site-packages (from mlflow>=1.0->-r /home/vidiemme/Desktop/mlflow-test/mlflow/examples/sklearn_logistic_regression/condaenv.erydi_jh.requirements.txt (line 1)) (1.15.4)\r\nCollecting gitdb2>=2.0.0\r\n  Using cached https://files.pythonhosted.org/packages/03/6c/99296f89bad2ef85626e1df9f677acbee8885bb043ad82ad3ed4746d2325/gitdb2-2.0.6-py2.py3-none-any.whl\r\nCollecting pytz>=2017.2\r\n  Using cached https://files.pythonhosted.org/packages/e7/f9/f0b53f88060247251bf481fa6ea62cd0d25bf1b11a87888e53ce5b7c8ad2/pytz-2019.3-py2.py3-none-any.whl\r\nRequirement already satisfied, skipping upgrade: Werkzeug>=0.15 in /home/vidiemme/.local/lib/python3.6/site-packages (from Flask->mlflow>=1.0->-r /home/vidiemme/Desktop/mlflow-test/mlflow/examples/sklearn_logistic_regression/condaenv.erydi_jh.requirements.txt (line 1)) (0.16.0)\r\nCollecting Jinja2>=2.10.1\r\n  Using cached https://files.pythonhosted.org/packages/65/e0/eb35e762802015cab1ccee04e8a277b03f1d8e53da3ec3106882ec42558b/Jinja2-2.10.3-py2.py3-none-any.whl\r\nCollecting itsdangerous>=0.24\r\n  Using cached https://files.pythonhosted.org/packages/76/ae/44b03b253d6fade317f32c24d100b3b35c2239807046a4c953c7b89fa49e/itsdangerous-1.1.0-py2.py3-none-any.whl\r\nRequirement already satisfied, skipping upgrade: setuptools in /home/vidiemme/.local/lib/python3.6/site-packages (from protobuf>=3.6.0->mlflow>=1.0->-r /home/vidiemme/Desktop/mlflow-test/mlflow/examples/sklearn_logistic_regression/condaenv.erydi_jh.requirements.txt (line 1)) (41.4.0)\r\nCollecting urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1\r\n  Using cached https://files.pythonhosted.org/packages/b4/40/a9837291310ee1ccc242ceb6ebfd9eb21539649f193a7c8c86ba15b98539/urllib3-1.25.7-py2.py3-none-any.whl\r\nCollecting idna<2.9,>=2.5\r\n  Using cached https://files.pythonhosted.org/packages/14/2c/cd551d81dbe15200be1cf41cd03869a46fe7226e7450af7a6545bfc474c9/idna-2.8-py2.py3-none-any.whl\r\nCollecting chardet<3.1.0,>=3.0.2\r\n  Using cached https://files.pythonhosted.org/packages/bc/a9/01ffebfb562e4274b6487b4bb1ddec7ca55ec7510b22e4c51f14098443b8/chardet-3.0.4-py2.py3-none-any.whl\r\nRequirement already satisfied, skipping upgrade: certifi>=2017.4.17 in /home/vidiemme/anaconda3/envs/mlflow-7fe9f24d100ade6523081ed2190877c5976a985c/lib/python3.6/site-packages (from requests>=2.17.3->mlflow>=1.0->-r /home/vidiemme/Desktop/mlflow-test/mlflow/examples/sklearn_logistic_regression/condaenv.erydi_jh.requirements.txt (line 1)) (2019.9.11)\r\nCollecting websocket-client>=0.32.0\r\n  Using cached https://files.pythonhosted.org/packages/29/19/44753eab1fdb50770ac69605527e8859468f3c0fd7dc5a76dd9c4dbd7906/websocket_client-0.56.0-py2.py3-none-any.whl\r\nCollecting python-editor>=0.3\r\n  Using cached https://files.pythonhosted.org/packages/c6/d3/201fc3abe391bbae6606e6f1d598c15d367033332bd54352b12f35513717/python_editor-1.0.4-py3-none-any.whl\r\nProcessing /home/vidiemme/.cache/pip/wheels/98/32/7b/a291926643fc1d1e02593e0d9e247c5a866a366b8343b7aa27/Mako-1.1.0-cp36-none-any.whl\r\nProcessing /home/vidiemme/.cache/pip/wheels/9c/9b/f4/eb243fdb89676ec00588e8c54bb54360724c06e7fafe95278e/tabulate-0.8.6-cp36-none-any.whl\r\nCollecting configparser>=0.3.5\r\n  Using cached https://files.pythonhosted.org/packages/7a/2a/95ed0501cf5d8709490b1d3a3f9b5cf340da6c433f896bbe9ce08dbe6785/configparser-4.0.2-py2.py3-none-any.whl\r\nCollecting smmap2>=2.0.0\r\n  Using cached https://files.pythonhosted.org/packages/55/d2/866d45e3a121ee15a1dc013824d58072fd5c7799c9c34d01378eb262ca8f/smmap2-2.0.5-py2.py3-none-any.whl\r\nCollecting MarkupSafe>=0.23\r\n  Using cached https://files.pythonhosted.org/packages/b2/5f/23e0023be6bb885d00ffbefad2942bc51a620328ee910f64abe5a8d18dd1/MarkupSafe-1.1.1-cp36-cp36m-manylinux1_x86_64.whl\r\nInstalling collected packages: gorilla, cloudpickle, smmap2, gitdb2, gitpython, click, pytz, python-dateutil, pandas, MarkupSafe, Jinja2, itsdangerous, Flask, urllib3, idna, chardet, requests, websocket-client, docker, python-editor, sqlalchemy, Mako, alembic, entrypoints, gunicorn, sqlparse, tabulate, configparser, databricks-cli, simplejson, pyyaml, querystring-parser, mlflow\r\nSuccessfully installed Flask-1.1.1 Jinja2-2.10.3 Mako-1.1.0 MarkupSafe-1.1.1 alembic-1.3.1 chardet-3.0.4 click-7.0 cloudpickle-1.2.2 configparser-4.0.2 databricks-cli-0.9.1 docker-4.1.0 entrypoints-0.3 gitdb2-2.0.6 gitpython-3.0.5 gorilla-0.3.0 gunicorn-20.0.4 idna-2.8 itsdangerous-1.1.0 mlflow-1.4.0 pandas-0.25.3 python-dateutil-2.8.1 python-editor-1.0.4 pytz-2019.3 pyyaml-5.1.2 querystring-parser-1.2.4 requests-2.22.0 simplejson-3.17.0 smmap2-2.0.5 sqlalchemy-1.3.11 sqlparse-0.3.0 tabulate-0.8.6 urllib3-1.25.7 websocket-client-0.56.0\r\n\r\n#\r\n# To activate this environment, use\r\n#\r\n#     $ conda activate mlflow-7fe9f24d100ade6523081ed2190877c5976a985c\r\n#\r\n# To deactivate an active environment, use\r\n#\r\n#     $ conda deactivate\r\n\r\n2019/11/27 17:12:35 INFO mlflow.projects: === Created directory /tmp/tmp93rnvome for downloading remote URIs passed to arguments of type 'path' ===\r\n2019/11/27 17:12:35 INFO mlflow.projects: === Running command 'source /home/vidiemme/anaconda3/bin/../etc/profile.d/conda.sh && conda activate mlflow-7fe9f24d100ade6523081ed2190877c5976a985c 1>&2 && python train.py' in run with ID 'f86dab00b1724400a8d2e86f51d3b76b' === \r\nScore: 0.6666666666666666\r\nModel saved in run f86dab00b1724400a8d2e86f51d3b76b\r\n2019/11/27 17:12:36 INFO mlflow.projects: === Run (ID 'f86dab00b1724400a8d2e86f51d3b76b') succeeded ===\r\n```\r\n4) run `mlflow models serve -m runs:/<RUN_ID>/model`, where <RUN_ID> is f86dab00b1724400a8d2e86f51d3b76b. HERE IT OCCURS THE ERROR!\r\nThe output is the following:\r\n```\r\n2019/11/27 17:14:38 INFO mlflow.models.cli: Selected backend for flavor 'python_function'\r\n2019/11/27 17:14:39 INFO mlflow.projects: === Creating conda environment mlflow-6f475bd37d4f55ec6492cb12d6cc9361e3da03ec ===\r\nWarning: you have pip-installed dependencies in your environment file, but you do not list pip itself as one of your conda dependencies.  Conda may not use the correct pip to install your packages, and they may end up in the wrong place.  Please add an explicit pip dependency.  I'm adding one for you, but still nagging you.\r\nCollecting package metadata (repodata.json): done\r\nSolving environment: failed\r\n\r\nResolvePackageNotFound: \r\n  - python=3.6.0\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/vidiemme/anaconda3/envs/mlflow/bin/mlflow\", line 8, in <module>\r\n    sys.exit(cli())\r\n  File \"/home/vidiemme/anaconda3/envs/mlflow/lib/python3.6/site-packages/click/core.py\", line 764, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/home/vidiemme/anaconda3/envs/mlflow/lib/python3.6/site-packages/click/core.py\", line 717, in main\r\n    rv = self.invoke(ctx)\r\n  File \"/home/vidiemme/anaconda3/envs/mlflow/lib/python3.6/site-packages/click/core.py\", line 1137, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/home/vidiemme/anaconda3/envs/mlflow/lib/python3.6/site-packages/click/core.py\", line 1137, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/home/vidiemme/anaconda3/envs/mlflow/lib/python3.6/site-packages/click/core.py\", line 956, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"/home/vidiemme/anaconda3/envs/mlflow/lib/python3.6/site-packages/click/core.py\", line 555, in invoke\r\n    return callback(*args, **kwargs)\r\n  File \"/home/vidiemme/anaconda3/envs/mlflow/lib/python3.6/site-packages/mlflow/models/cli.py\", line 56, in serve\r\n    host=host)\r\n  File \"/home/vidiemme/anaconda3/envs/mlflow/lib/python3.6/site-packages/mlflow/pyfunc/backend.py\", line 84, in serve\r\n    command_env=command_env)\r\n  File \"/home/vidiemme/anaconda3/envs/mlflow/lib/python3.6/site-packages/mlflow/pyfunc/backend.py\", line 140, in _execute_in_conda_env\r\n    conda_env_name = _get_or_create_conda_env(conda_env_path, env_id=env_id)\r\n  File \"/home/vidiemme/anaconda3/envs/mlflow/lib/python3.6/site-packages/mlflow/projects/__init__.py\", line 518, in _get_or_create_conda_env\r\n    conda_env_path], stream_output=True)\r\n  File \"/home/vidiemme/anaconda3/envs/mlflow/lib/python3.6/site-packages/mlflow/utils/process.py\", line 38, in exec_cmd\r\n    raise ShellCommandException(\"Non-zero exitcode: %s\" % (exit_code))\r\nmlflow.utils.process.ShellCommandException: Non-zero exitcode: 1\r\n```\r\n\r\nHow can I solve this problem?\r\n- Do I have to activate the conda env previously created in order to serve the model? Is it correct that it creates a new conda env and not use the previously created one?\r\n\r\nPlease, I need help!\r\n\r\n**UPDATE**: following the [tutorial](https://www.mlflow.org/docs/latest/tutorial.html) section, it works as expected: I can obtain a prediction result from a MLflow model server listening on localhost:1234. Why?","closed_by":{"login":"TheEdoardo93","id":19664571,"node_id":"MDQ6VXNlcjE5NjY0NTcx","avatar_url":"https://avatars.githubusercontent.com/u/19664571?v=4","gravatar_id":"","url":"https://api.github.com/users/TheEdoardo93","html_url":"https://github.com/TheEdoardo93","followers_url":"https://api.github.com/users/TheEdoardo93/followers","following_url":"https://api.github.com/users/TheEdoardo93/following{/other_user}","gists_url":"https://api.github.com/users/TheEdoardo93/gists{/gist_id}","starred_url":"https://api.github.com/users/TheEdoardo93/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TheEdoardo93/subscriptions","organizations_url":"https://api.github.com/users/TheEdoardo93/orgs","repos_url":"https://api.github.com/users/TheEdoardo93/repos","events_url":"https://api.github.com/users/TheEdoardo93/events{/privacy}","received_events_url":"https://api.github.com/users/TheEdoardo93/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2148/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2148/timeline","performed_via_github_app":null,"state_reason":"completed"}