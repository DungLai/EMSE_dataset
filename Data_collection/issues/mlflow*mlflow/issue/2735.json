{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2735","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2735/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2735/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2735/events","html_url":"https://github.com/mlflow/mlflow/issues/2735","id":603038641,"node_id":"MDU6SXNzdWU2MDMwMzg2NDE=","number":2735,"title":"[BUG] Setting experiment id from python fails when running script from CLI","user":{"login":"cyruoff","id":64001343,"node_id":"MDQ6VXNlcjY0MDAxMzQz","avatar_url":"https://avatars.githubusercontent.com/u/64001343?v=4","gravatar_id":"","url":"https://api.github.com/users/cyruoff","html_url":"https://github.com/cyruoff","followers_url":"https://api.github.com/users/cyruoff/followers","following_url":"https://api.github.com/users/cyruoff/following{/other_user}","gists_url":"https://api.github.com/users/cyruoff/gists{/gist_id}","starred_url":"https://api.github.com/users/cyruoff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cyruoff/subscriptions","organizations_url":"https://api.github.com/users/cyruoff/orgs","repos_url":"https://api.github.com/users/cyruoff/repos","events_url":"https://api.github.com/users/cyruoff/events{/privacy}","received_events_url":"https://api.github.com/users/cyruoff/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022848510,"node_id":"MDU6TGFiZWwyMDIyODQ4NTEw","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/projects","name":"area/projects","color":"48eabc","default":false,"description":"MLproject format, project running backends"},{"id":2022863969,"node_id":"MDU6TGFiZWwyMDIyODYzOTY5","url":"https://api.github.com/repos/mlflow/mlflow/labels/priority/important-soon","name":"priority/important-soon","color":"534cb5","default":false,"description":"The issue is worked on by the community currently or will be very soon, ideally in time for the"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2020-04-20T08:19:24Z","updated_at":"2022-07-13T14:45:09Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### System information\r\n- **OS Platform and Distribution**: Linux Ubuntu 18.04\r\n- **MLflow installed from**: binary\r\n- **MLflow version**: 1.8\r\n- **Python version**: 3.8\r\n\r\n### Describe the problem\r\nSetting the experiment id in a python script with `mlflow.set_experiment('foo')` does not work when the script is run with `mlflow run . -e train_model_min`. In the case where something is logged to the experiment, the run fails with the exception \r\n\r\n> mlflow.exceptions.MlflowException: Cannot start run with ID c21d2c4e75c047608003235f213e5bb5 because active run ID does not match environment run ID. Make sure --experiment-name or --experiment-id matches experiment set with set_experiment(), or just use command-line arguments\r\n\r\neven though no experiment id was specified in the CLI.\r\n\r\nIf nothing is logged (commenting out the line with log_metric in the code below), the run is executed without error but is logged under the Default experiment instead of foo.\r\n\r\n### Code to reproduce issue\r\ntrain_model_min.py:\r\n```\r\nimport mlflow\r\n\r\ndef main():\r\n    mlflow.set_experiment('foo')\r\n    mlflow.log_metric('answer', 42)\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n```\r\n\r\nMLproject file:\r\n```\r\nname: MLFlow Test\r\n\r\nconda_env: conda.yaml\r\n\r\nentry_points:\r\n  train_model_min:\r\n    command: \"python train_model_min.py\"\r\n```\r\n\r\ncommand to reproduce bug:\r\n`mlflow run . -e train_model_min`","closed_by":null,"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2735/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2735/timeline","performed_via_github_app":null,"state_reason":null}