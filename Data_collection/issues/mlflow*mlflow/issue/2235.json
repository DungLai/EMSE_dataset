{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2235","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2235/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2235/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2235/events","html_url":"https://github.com/mlflow/mlflow/issues/2235","id":540249723,"node_id":"MDU6SXNzdWU1NDAyNDk3MjM=","number":2235,"title":"log_param failes logging string containing \\n","user":{"login":"reidarkind","id":53039431,"node_id":"MDQ6VXNlcjUzMDM5NDMx","avatar_url":"https://avatars.githubusercontent.com/u/53039431?v=4","gravatar_id":"","url":"https://api.github.com/users/reidarkind","html_url":"https://github.com/reidarkind","followers_url":"https://api.github.com/users/reidarkind/followers","following_url":"https://api.github.com/users/reidarkind/following{/other_user}","gists_url":"https://api.github.com/users/reidarkind/gists{/gist_id}","starred_url":"https://api.github.com/users/reidarkind/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reidarkind/subscriptions","organizations_url":"https://api.github.com/users/reidarkind/orgs","repos_url":"https://api.github.com/users/reidarkind/repos","events_url":"https://api.github.com/users/reidarkind/events{/privacy}","received_events_url":"https://api.github.com/users/reidarkind/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"assignees":[{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2019-12-19T11:17:58Z","updated_at":"2020-02-07T15:05:38Z","closed_at":"2020-02-07T15:05:38Z","author_association":"NONE","active_lock_reason":null,"body":"### System information\r\nmlflow, version 1.4.0\r\nPython 3.7.4\r\n\r\n### Describe the problem\r\nmlflow throws and exception: \"Exception: Unexpected data for param <key>. Param recorded more than once\" when trying to log a multiline string with log_param. \r\n\r\nOk, this is a special case and I don't see many use-cases, but I stumbled this today. That said, I don't think the Exception description is not very clear (took me a while do understand what actually was wrong - I only tried to log the param once...).\r\n\r\n\r\n### Code to reproduce issue\r\nProvide a reproducible test case that is the bare minimum necessary to generate the problem.\r\n```\r\nimport mlflow\r\n\r\n# create a multiline string\r\na_two_line_str = \"a\\nb\"\r\n\r\nwith mlflow.start_run() as mlrun:\r\n\r\n    # this works\r\n    clean_str = a_two_line_str.replace(\"\\n|\\r\", \"\")\r\n    mlflow.log_param(\"two_liner\", clean_str)\r\n    print(\"no exception yet\")\r\n\r\n    # this fails\r\n    print(a_two_line_str)\r\n    mlflow.log_param(\"two_liner\", a_two_line_str)\r\n    # >> Exception: Unexpected data for param 'two_liner'. Param recorded more than once\r\n\r\n```\r\n\r\n### Other info / logs\r\nThe reason for the exception is that `len(param_data)>1`, since `len(\"a\\nb\")>1`.\r\n\r\nPropose either 1) a fix to strip for \\n and \\r, or 2) give a more describing Exception string, e.g:\r\n\r\n#### 1) Strip \\n and \\r from param data strings\r\nmlflow.tracking._tracking_service.client.TrackingServiceClient.log_param:\r\n```\r\ndef log_param(self, run_id, key, value):\r\n    \"\"\"\r\n    Log a parameter against the run ID. Value is converted to a string.\r\n    \"\"\"\r\n    _validate_param_name(key)\r\n    param = Param(key, str(value).replace(\"\\n|\\r\", \"\")) #change: the '.replace(..)\r\n    self.store.log_param(run_id, param)\r\n```\r\n\r\n#### 2) Change Exception description\r\nmlflow.store.tracking.file_store.FileStore._get_param_from_file:\r\n```\r\n@staticmethod\r\ndef _get_param_from_file(parent_path, param_name):\r\n    _validate_param_name(param_name)\r\n    param_data = read_file_lines(parent_path, param_name)\r\n    if len(param_data) > 1:\r\n        raise Exception(\"Unexpected data for param '%s'. Len of param data is bigger than 1\"\r\n                        % param_name)\r\n    # The only cause for param_data's length to be zero is the param's\r\n    # value is an empty string\r\n    value = '' if len(param_data) == 0 else str(param_data[0].strip())\r\n    return Param(param_name, value)\r\n```\r\n \r\n","closed_by":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2235/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2235/timeline","performed_via_github_app":null,"state_reason":"completed"}