{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1970","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/1970/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/1970/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/1970/events","html_url":"https://github.com/mlflow/mlflow/issues/1970","id":510486691,"node_id":"MDU6SXNzdWU1MTA0ODY2OTE=","number":1970,"title":"[BUG] Missing boto3 dependency in mlflow python package","user":{"login":"mirekphd","id":36706320,"node_id":"MDQ6VXNlcjM2NzA2MzIw","avatar_url":"https://avatars.githubusercontent.com/u/36706320?v=4","gravatar_id":"","url":"https://api.github.com/users/mirekphd","html_url":"https://github.com/mirekphd","followers_url":"https://api.github.com/users/mirekphd/followers","following_url":"https://api.github.com/users/mirekphd/following{/other_user}","gists_url":"https://api.github.com/users/mirekphd/gists{/gist_id}","starred_url":"https://api.github.com/users/mirekphd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mirekphd/subscriptions","organizations_url":"https://api.github.com/users/mirekphd/orgs","repos_url":"https://api.github.com/users/mirekphd/repos","events_url":"https://api.github.com/users/mirekphd/events{/privacy}","received_events_url":"https://api.github.com/users/mirekphd/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022845866,"node_id":"MDU6TGFiZWwyMDIyODQ1ODY2","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/artifacts","name":"area/artifacts","color":"48eabc","default":false,"description":"Artifact stores and artifact logging"},{"id":2022849295,"node_id":"MDU6TGFiZWwyMDIyODQ5Mjk1","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/tracking","name":"area/tracking","color":"48eabc","default":false,"description":"Tracking service, tracking client APIs, autologging"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2019-10-22T07:51:08Z","updated_at":"2021-02-10T18:46:14Z","closed_at":"2020-07-13T17:42:32Z","author_association":"NONE","active_lock_reason":null,"body":"- **Exact command to reproduce**:\r\n-  take any system (e.g. an ubutunu with miniconda and python 3.6 docker container) with mlflow python package v1.3 installed using `pip install mlflow`,\r\n- make sure that the connection from the mlflow python client library to the s3 bucket (in my case created using minio) is working (e.g. with curl),\r\n- make sure mlflow server has no access to the internet (should you try to download and install the dependency at first use),\r\n- create a new experiment, because otherwise local folder will still be used for artifact storage),\r\n- train the model in python mlflow 1.3 client library, \r\n- log using log_model() and then \r\n- go to MLflow Tracking Web UI \r\n- click on the appropriate run (the one which should be stored remotely not locally), trying to access the artifacts from a remote S3 bucket (e.g. serverd by minio),\r\n- hey presto, Niagara Falls gets displayed!\r\n\r\n### Describe the problem\r\nAll dependencies of mlflow package should be either bundled-in (they were apparently not installed) or stated explicitly. Eg. \"If you want to use S3 buckets for artifact storage (e.g. through minio) please install boto3 python package on the MLflow Tracking server side (e.g. in the docker container with the server).\"\r\n\r\n### Other info / logs\r\nAs we see, boto3 (and botocore) dependencies were not installed together with mlflow:\r\n```\r\n$ python\r\nPython 3.6.5 |Anaconda, Inc.| (default, Apr 29 2018, 16:14:56) \r\n[GCC 7.2.0] on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n\r\n>>> import boto3\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nModuleNotFoundError: No module named 'boto3'\r\n\r\n>>> import botocore\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nModuleNotFoundError: No module named 'botocore'\r\n\r\n>>> exit()\r\n\r\n$ pip freeze\r\nalembic==1.2.1\r\nasn1crypto==0.24.0\r\ncertifi==2018.4.16\r\ncffi==1.11.5\r\nchardet==3.0.4\r\nClick==7.0\r\ncloudpickle==1.2.2\r\nconda==4.5.4\r\nconfigparser==4.0.2\r\ncryptography==2.2.2\r\ndatabricks-cli==0.9.0\r\ndocker==4.1.0\r\nentrypoints==0.3\r\nFlask==1.1.1\r\ngitdb2==2.0.6\r\nGitPython==3.0.3\r\ngorilla==0.3.0\r\ngunicorn==19.9.0\r\nidna==2.6\r\nitsdangerous==1.1.0\r\nJinja2==2.10.3\r\nMako==1.1.0\r\nMarkupSafe==1.1.1\r\nmlflow==1.3.0\r\nnumpy==1.17.3\r\npandas==0.25.2\r\nprotobuf==3.10.0\r\npycosat==0.6.3\r\npycparser==2.18\r\npyOpenSSL==18.0.0\r\nPySocks==1.6.8\r\npython-dateutil==2.8.0\r\npython-editor==1.0.4\r\npytz==2019.3\r\nPyYAML==5.1.2\r\nquerystring-parser==1.2.4\r\nrequests==2.18.4\r\nruamel-yaml==0.15.37\r\nsimplejson==3.16.0\r\nsix==1.11.0\r\nsmmap2==2.0.5\r\nSQLAlchemy==1.3.10\r\nsqlparse==0.3.0\r\ntabulate==0.8.5\r\nurllib3==1.22\r\nwebsocket-client==0.56.0\r\nWerkzeug==0.16.0\r\njovyan@ml-mlflow-node1-4-rg5zs:~$ \r\n\r\n```\r\n\r\nFrom server logs:\r\n```\r\n2019/10/22 07:24:53 ERROR mlflow.server: Exception on /ajax-api/2.0/preview/mlflow/artifacts/list [GET]\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 2446, in wsgi_app\r\n    response = self.full_dispatch_request()\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1951, in full_dispatch_request\r\n    rv = self.handle_user_exception(e)\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1820, in handle_user_exception\r\n    reraise(exc_type, exc_value, tb)\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/_compat.py\", line 39, in reraise\r\n    raise value\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1949, in full_dispatch_request\r\n    rv = self.dispatch_request()\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1935, in dispatch_request\r\n    return self.view_functions[rule.endpoint](**req.view_args)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/server/handlers.py\", line 102, in wrapper\r\n    return func(*args, **kwargs)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/server/handlers.py\", line 366, in _list_artifacts\r\n    artifact_entities = _get_artifact_repo(run).list_artifacts(path)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/s3_artifact_repo.py\", line 65, in list_artifacts\r\n    s3_client = self._get_s3_client()\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/s3_artifact_repo.py\", line 27, in _get_s3_client\r\n    import boto3\r\nModuleNotFoundError: No module named 'boto3'\r\n2019/10/22 07:26:00 ERROR mlflow.server: Exception on /ajax-api/2.0/preview/mlflow/artifacts/list [GET]\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 2446, in wsgi_app\r\n    response = self.full_dispatch_request()\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1951, in full_dispatch_request\r\n    rv = self.handle_user_exception(e)\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1820, in handle_user_exception\r\n    reraise(exc_type, exc_value, tb)\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/_compat.py\", line 39, in reraise\r\n    raise value\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1949, in full_dispatch_request\r\n    rv = self.dispatch_request()\r\n  File \"/opt/conda/lib/python3.6/site-packages/flask/app.py\", line 1935, in dispatch_request\r\n    return self.view_functions[rule.endpoint](**req.view_args)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/server/handlers.py\", line 102, in wrapper\r\n    return func(*args, **kwargs)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/server/handlers.py\", line 366, in _list_artifacts\r\n    artifact_entities = _get_artifact_repo(run).list_artifacts(path)\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/s3_artifact_repo.py\", line 65, in list_artifacts\r\n    s3_client = self._get_s3_client()\r\n  File \"/opt/conda/lib/python3.6/site-packages/mlflow/store/s3_artifact_repo.py\", line 27, in _get_s3_client\r\n    import boto3\r\nModuleNotFoundError: No module named 'boto3'\r\n\r\n```","closed_by":{"login":"smurching","id":2358483,"node_id":"MDQ6VXNlcjIzNTg0ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2358483?v=4","gravatar_id":"","url":"https://api.github.com/users/smurching","html_url":"https://github.com/smurching","followers_url":"https://api.github.com/users/smurching/followers","following_url":"https://api.github.com/users/smurching/following{/other_user}","gists_url":"https://api.github.com/users/smurching/gists{/gist_id}","starred_url":"https://api.github.com/users/smurching/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smurching/subscriptions","organizations_url":"https://api.github.com/users/smurching/orgs","repos_url":"https://api.github.com/users/smurching/repos","events_url":"https://api.github.com/users/smurching/events{/privacy}","received_events_url":"https://api.github.com/users/smurching/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1970/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/1970/timeline","performed_via_github_app":null,"state_reason":"completed"}