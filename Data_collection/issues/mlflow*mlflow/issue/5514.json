{"url":"https://api.github.com/repos/mlflow/mlflow/issues/5514","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/5514/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/5514/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/5514/events","html_url":"https://github.com/mlflow/mlflow/issues/5514","id":1174663898,"node_id":"I_kwDOCB5Jx85GA_La","number":5514,"title":"[SETUP-BUG] Problem setting up Scenario 5 using Minio server to store artifacts","user":{"login":"rgaudenzi-fub","id":62242567,"node_id":"MDQ6VXNlcjYyMjQyNTY3","avatar_url":"https://avatars.githubusercontent.com/u/62242567?v=4","gravatar_id":"","url":"https://api.github.com/users/rgaudenzi-fub","html_url":"https://github.com/rgaudenzi-fub","followers_url":"https://api.github.com/users/rgaudenzi-fub/followers","following_url":"https://api.github.com/users/rgaudenzi-fub/following{/other_user}","gists_url":"https://api.github.com/users/rgaudenzi-fub/gists{/gist_id}","starred_url":"https://api.github.com/users/rgaudenzi-fub/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rgaudenzi-fub/subscriptions","organizations_url":"https://api.github.com/users/rgaudenzi-fub/orgs","repos_url":"https://api.github.com/users/rgaudenzi-fub/repos","events_url":"https://api.github.com/users/rgaudenzi-fub/events{/privacy}","received_events_url":"https://api.github.com/users/rgaudenzi-fub/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2022-03-20T19:48:43Z","updated_at":"2022-05-10T10:11:59Z","closed_at":"2022-03-21T16:21:44Z","author_association":"NONE","active_lock_reason":null,"body":"Good evening, I'm trying to setup a MLflow deploy based on docker container following the structure depicted in Scenario 5 (https://mlflow.org/docs/latest/tracking.html#scenario-5-mlflow-tracking-server-enabled-with-proxied-artifact-storage-access) where MLflow acts as artifact proxy. \r\nMy idea was to have three container:\r\n- a MySQL container to store data about runs, metrics and parameters;\r\n- a container running Minio where MLflow will store my artifacts;\r\n- a container running MLflow.\r\n\r\nI don't want to expose the minio over Internet, but I want to make it accessible only from the MLflow server, and I thought that I could do that after seeing the Scenario 5 description in the documentation.\r\n\r\nIn the MLflow container I set up the envinroment variables:\r\nMLFLOW_S3_ENDPOINT_URL, \r\nAWS_ACCESS_KEY_ID \r\nAWS_SECRET_ACCESS_KEY \r\n\r\nthen I created a bucket inside Minio named \"mlflow\", and then start the tracking server in this way:\r\nmlflow server \\\r\n--backend-store-uri mysql+mysqlconnector://$DB_USER:$DB_PWD@db:3306/mlflowtest \\\r\n--artifacts-destination s3://mlflow \\\r\n--serve-artifacts \\\r\n--host 0.0.0.0 \\\r\n--gunicorn-opts \"--log-level debug\"\r\n\r\nAt this point, I have a python script that does the following:\r\nmlflow.set_tracking_uri('http://localhost:5000/')\r\nmlflow.create_experiment(\"test\")\r\nmlflow.set_experiment(\"test\")\r\n\r\nwith mlflow.start_run():\r\n    print(\"Test LOG ARTIFACT - start\")\r\n    mlflow.log_artifact(local_path=\"./data/language_detection.csv\")\r\n    print(\"Test LOG ARTIFACT - done\")\r\n\r\nBut I get the following error:\r\nmlflow.exceptions.MlflowException: Could not find a registered artifact repository for: mlflow-artifacts:/39/668c9fe202184565897f08f6234049be/artifacts. Currently registered schemes are: ['', 'file', 's3', 'gs', 'wasbs', 'ftp', 'sftp', 'dbfs', 'hdfs', 'viewfs', 'runs', 'models']\r\n\r\nI've also tried to setup the parameter \"default-artifact-root\" in some ways:\r\n- If I set it to \"--default-artifact-root s3://mlflow\" then I get the error \"Unable to locate credentials\". If I set the envinroment variables inside the python client code, then I get the error \"boto3.exceptions.S3UploadFailedError: Failed to upload ./data/language_detection.csv to mlflow/a8df2597bad64420af0ef56a19708bee/artifacts/language_detection.csv: An error occurred (InvalidAccessKeyId) when calling the PutObject operation: The AWS Access Key Id you provided does not exist in our records.\"\r\n- If I set it to \"http://localhost:5000/api/2.0/mlflow-artifacts/artifacts/myruns\", then I get the error: mlflow.exceptions.MlflowException: Could not find a registered artifact repository for: http://localhost:5000/api/2.0/mlflow-artifacts/artifacts/myruns/37/7e27c1a84966472f9c871e9a62719de1/artifacts. Currently registered schemes are: ['', 'file', 's3', 'gs', 'wasbs', 'ftp', 'sftp', 'dbfs', 'hdfs', 'viewfs', 'runs', 'models']\r\n\r\nCould you please tell me how can I reproduce the Scenario 5 where the client code cannot access Minio, but actually uploads the artifacts on Minio passing them to the Mlflow server?\r\n\r\nThank you in advance for any help you can give me.","closed_by":{"login":"rgaudenzi-fub","id":62242567,"node_id":"MDQ6VXNlcjYyMjQyNTY3","avatar_url":"https://avatars.githubusercontent.com/u/62242567?v=4","gravatar_id":"","url":"https://api.github.com/users/rgaudenzi-fub","html_url":"https://github.com/rgaudenzi-fub","followers_url":"https://api.github.com/users/rgaudenzi-fub/followers","following_url":"https://api.github.com/users/rgaudenzi-fub/following{/other_user}","gists_url":"https://api.github.com/users/rgaudenzi-fub/gists{/gist_id}","starred_url":"https://api.github.com/users/rgaudenzi-fub/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rgaudenzi-fub/subscriptions","organizations_url":"https://api.github.com/users/rgaudenzi-fub/orgs","repos_url":"https://api.github.com/users/rgaudenzi-fub/repos","events_url":"https://api.github.com/users/rgaudenzi-fub/events{/privacy}","received_events_url":"https://api.github.com/users/rgaudenzi-fub/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/5514/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/5514/timeline","performed_via_github_app":null,"state_reason":"completed"}