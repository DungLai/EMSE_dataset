{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1460","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/1460/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/1460/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/1460/events","html_url":"https://github.com/mlflow/mlflow/issues/1460","id":456668448,"node_id":"MDU6SXNzdWU0NTY2Njg0NDg=","number":1460,"title":"mlflow.tracking.artifact_utils._download_artifact_from_uri does not supported nested artifacts.","user":{"login":"eedeleon","id":31962564,"node_id":"MDQ6VXNlcjMxOTYyNTY0","avatar_url":"https://avatars.githubusercontent.com/u/31962564?v=4","gravatar_id":"","url":"https://api.github.com/users/eedeleon","html_url":"https://github.com/eedeleon","followers_url":"https://api.github.com/users/eedeleon/followers","following_url":"https://api.github.com/users/eedeleon/following{/other_user}","gists_url":"https://api.github.com/users/eedeleon/gists{/gist_id}","starred_url":"https://api.github.com/users/eedeleon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eedeleon/subscriptions","organizations_url":"https://api.github.com/users/eedeleon/orgs","repos_url":"https://api.github.com/users/eedeleon/repos","events_url":"https://api.github.com/users/eedeleon/events{/privacy}","received_events_url":"https://api.github.com/users/eedeleon/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-06-16T18:24:16Z","updated_at":"2019-07-26T21:48:40Z","closed_at":"2019-07-26T21:48:40Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**:\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Windows Subsytem for Linux Ubuntu 18.04\r\n- **MLflow version**: 1.0.0\r\n- **Python version**: 3.6.1\r\n- **Exact command to reproduce**:\r\n\r\n### Describe the problem\r\nWhile debugging a user scenario I noticed _download_artifact_from_uri uses basename internally while parsing for the artifact path. This works for flat artifact paths such as \"model\" or \"artifact_path\", but omits the directory structure for \"artifact_path/model\".\r\n\r\nOur scenario had a user passing runs:/run_id/ after a recent update to mlflow.azureml.build_image. However, this behavior should affect other code paths.\r\n\r\nI started a PR resolving the runs:/run_id/path/to/file scenario but am opening up an issue since there are more affected code paths but not all of them are within mlflow's control. \r\n\r\nI think the issue here is parsing for the artifact path is ArtifactRepository specific. \r\n\r\nIt may be useful to add a new function to the ArtifactRepository() with a default behavior of what was originally implemented in _download_artifact_from_uri for backwards compatibility.\r\n\r\ndef extract_artifact_path(self, artifact_uri):\r\n    parse for schema \r\n    schema + artifact_uri to artifact repository  #  root_uri would be more correct\r\n    artifact_path = artifact repository.extract_artifact_path(artifact_uri)\r\n    return artifact_path\r\n\r\n### Source code / logs\r\nInclude any logs or source code that would be helpful to diagnose the problem. If including tracebacks,\r\nplease include the full traceback. Large logs and files should be attached.\r\nTry to provide a reproducible test case that is the bare minimum necessary to generate the problem.\r\n","closed_by":{"login":"aarondav","id":1400247,"node_id":"MDQ6VXNlcjE0MDAyNDc=","avatar_url":"https://avatars.githubusercontent.com/u/1400247?v=4","gravatar_id":"","url":"https://api.github.com/users/aarondav","html_url":"https://github.com/aarondav","followers_url":"https://api.github.com/users/aarondav/followers","following_url":"https://api.github.com/users/aarondav/following{/other_user}","gists_url":"https://api.github.com/users/aarondav/gists{/gist_id}","starred_url":"https://api.github.com/users/aarondav/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aarondav/subscriptions","organizations_url":"https://api.github.com/users/aarondav/orgs","repos_url":"https://api.github.com/users/aarondav/repos","events_url":"https://api.github.com/users/aarondav/events{/privacy}","received_events_url":"https://api.github.com/users/aarondav/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/1460/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/1460/timeline","performed_via_github_app":null,"state_reason":"completed"}