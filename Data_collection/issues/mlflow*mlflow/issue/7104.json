{"url":"https://api.github.com/repos/mlflow/mlflow/issues/7104","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/7104/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/7104/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/7104/events","html_url":"https://github.com/mlflow/mlflow/issues/7104","id":1415100612,"node_id":"I_kwDOCB5Jx85UWLjE","number":7104,"title":"[BUG] MLFLOW_S3_ENDPOINT_URL  is ignored","user":{"login":"tamis-laan","id":3178666,"node_id":"MDQ6VXNlcjMxNzg2NjY=","avatar_url":"https://avatars.githubusercontent.com/u/3178666?v=4","gravatar_id":"","url":"https://api.github.com/users/tamis-laan","html_url":"https://github.com/tamis-laan","followers_url":"https://api.github.com/users/tamis-laan/followers","following_url":"https://api.github.com/users/tamis-laan/following{/other_user}","gists_url":"https://api.github.com/users/tamis-laan/gists{/gist_id}","starred_url":"https://api.github.com/users/tamis-laan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tamis-laan/subscriptions","organizations_url":"https://api.github.com/users/tamis-laan/orgs","repos_url":"https://api.github.com/users/tamis-laan/repos","events_url":"https://api.github.com/users/tamis-laan/events{/privacy}","received_events_url":"https://api.github.com/users/tamis-laan/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022845866,"node_id":"MDU6TGFiZWwyMDIyODQ1ODY2","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/artifacts","name":"area/artifacts","color":"48eabc","default":false,"description":"Artifact stores and artifact logging"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":19,"created_at":"2022-10-19T14:38:23Z","updated_at":"2022-10-26T01:11:13Z","closed_at":"2022-10-25T23:56:56Z","author_association":"NONE","active_lock_reason":null,"body":"### Issues Policy acknowledgement\n\n- [X] I have read and agree to submit bug reports in accordance with the [issues policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md)\n\n### Willingness to contribute\n\nNo. I cannot contribute a bug fix at this time.\n\n### MLflow version\n\nmlflow, version 1.29.0\n\n### System information\n\n- Arch Linux\r\n- Python 3.10.8\r\n\n\n### Describe the problem\n\nI'm trying to start the mlflow tracking server with an bucket and a postgresql database attached. The object store is not hosted by AWS but implements the S3 api interface. \r\n\r\nWhen adding an artifact to the database mflow throws an error that it cannot connect to the bucket. It complains about not being able to connect to AWS.\r\n\r\nI have set all the nesessary environment variables.\n\n### Tracking information\n\nNo notebook\n\n### Code to reproduce issue\n\n```\r\nMLFLOW_TRACKING_URI=http://0.0.0.0:5000\r\nMLFLOW_BACKEND_STORE_URI=postgresql://<user>:<password>@<host>:<port>\r\nMLFLOW_S3_ENDPOINT_URL=https://<edacted>.<redacted>.cloud\r\nAWS_ACCESS_KEY_ID=<redacted>\r\nAWS_SECRET_ACCESS_KEY=<redacted>\r\n```\r\n\r\n```\r\nmlflow server --default-artifact-root s3://mlflow/ --host 0.0.0.0\r\n```\n\n### Stack trace\n\n```\r\nTraceback (most recent call last):\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/urllib3/connection.py\", line 174, in _new_conn\r\n    conn = connection.create_connection(\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/urllib3/util/connection.py\", line 72, in create_connection\r\n    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):\r\n  File \"/usr/lib/python3.10/socket.py\", line 955, in getaddrinfo\r\n    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):\r\nsocket.gaierror: [Errno -2] Name or service not known\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/httpsession.py\", line 455, in send\r\n    urllib_response = conn.urlopen(\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/urllib3/connectionpool.py\", line 787, in urlopen\r\n    retries = retries.increment(\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/urllib3/util/retry.py\", line 525, in increment\r\n    raise six.reraise(type(error), error, _stacktrace)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/urllib3/packages/six.py\", line 770, in reraise\r\n    raise value\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/urllib3/connectionpool.py\", line 703, in urlopen\r\n    httplib_response = self._make_request(\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/urllib3/connectionpool.py\", line 386, in _make_request\r\n    self._validate_conn(conn)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/urllib3/connectionpool.py\", line 1042, in _validate_conn\r\n    conn.connect()\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/urllib3/connection.py\", line 358, in connect\r\n    self.sock = conn = self._new_conn()\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/urllib3/connection.py\", line 186, in _new_conn\r\n    raise NewConnectionError(\r\nurllib3.exceptions.NewConnectionError: <botocore.awsrequest.AWSHTTPSConnection object at 0x7f9e5b7b9e70>: Failed to establish a new connection: [Errno -2] Name or service not known\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/flask/app.py\", line 2525, in wsgi_app\r\n    response = self.full_dispatch_request()\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/flask/app.py\", line 1822, in full_dispatch_request\r\n    rv = self.handle_user_exception(e)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/flask/app.py\", line 1820, in full_dispatch_request\r\n    rv = self.dispatch_request()\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/flask/app.py\", line 1796, in dispatch_request\r\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/mlflow/server/handlers.py\", line 456, in wrapper\r\n    return func(*args, **kwargs)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/mlflow/server/handlers.py\", line 526, in wrapper\r\n    return func(*args, **kwargs)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/mlflow/server/handlers.py\", line 909, in _list_artifacts\r\n    artifact_entities = _get_artifact_repo(run).list_artifacts(path)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/mlflow/store/artifact/s3_artifact_repo.py\", line 159, in list_artifacts\r\n    for result in results:\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/paginate.py\", line 269, in __iter__\r\n    response = self._make_request(current_kwargs)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/paginate.py\", line 357, in _make_request\r\n    return self._method(**current_kwargs)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/client.py\", line 514, in _api_call\r\n    return self._make_api_call(operation_name, kwargs)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/client.py\", line 921, in _make_api_call\r\n    http, parsed_response = self._make_request(\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/client.py\", line 944, in _make_request\r\n    return self._endpoint.make_request(operation_model, request_dict)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/endpoint.py\", line 119, in make_request\r\n    return self._send_request(request_dict, operation_model)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/endpoint.py\", line 202, in _send_request\r\n    while self._needs_retry(\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/endpoint.py\", line 354, in _needs_retry\r\n    responses = self._event_emitter.emit(\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/hooks.py\", line 412, in emit\r\n    return self._emitter.emit(aliased_event_name, **kwargs)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/hooks.py\", line 256, in emit\r\n    return self._emit(event_name, kwargs)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/hooks.py\", line 239, in _emit\r\n    response = handler(**kwargs)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/retryhandler.py\", line 207, in __call__\r\n    if self._checker(**checker_kwargs):\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/retryhandler.py\", line 284, in __call__\r\n    should_retry = self._should_retry(\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/retryhandler.py\", line 320, in _should_retry\r\n    return self._checker(attempt_number, response, caught_exception)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/retryhandler.py\", line 363, in __call__\r\n    checker_response = checker(\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/retryhandler.py\", line 247, in __call__\r\n    return self._check_caught_exception(\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/retryhandler.py\", line 416, in _check_caught_exception\r\n    raise caught_exception\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/endpoint.py\", line 281, in _do_get_response\r\n    http_response = self._send(request)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/endpoint.py\", line 377, in _send\r\n    return self.http_session.send(request)\r\n  File \"$HOME/.local/share/virtualenvs/ai-panoptes-O4NUaGdJ/lib/python3.10/site-packages/botocore/httpsession.py\", line 484, in send\r\n    raise EndpointConnectionError(endpoint_url=request.url, error=e)\r\nbotocore.exceptions.EndpointConnectionError: Could not connect to the endpoint URL: \"https://s3.nl-ams.amazonaws.com/mlflow?list-type=2&prefix=1%2F6c3af048e4a74ded9dd43ddd898c0d3c%2Fartifacts%2F&delimiter=%2F&encoding-type=url\"\r\n```\n\n### Other info / logs\n\n_No response_\n\n### What component(s) does this bug affect?\n\n- [X] `area/artifacts`: Artifact stores and artifact logging\n- [ ] `area/build`: Build and test infrastructure for MLflow\n- [ ] `area/docs`: MLflow documentation pages\n- [ ] `area/examples`: Example code\n- [ ] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\n- [ ] `area/pipelines`: Pipelines, Pipeline APIs, Pipeline configs, Pipeline Templates\n- [ ] `area/projects`: MLproject format, project running backends\n- [ ] `area/scoring`: MLflow Model server, model deployment tools, Spark UDFs\n- [ ] `area/server-infra`: MLflow Tracking server backend\n- [ ] `area/tracking`: Tracking Service, tracking client APIs, autologging\n\n### What interface(s) does this bug affect?\n\n- [ ] `area/uiux`: Front-end, user experience, plotting, JavaScript, JavaScript dev server\n- [ ] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\n- [ ] `area/windows`: Windows support\n\n### What language(s) does this bug affect?\n\n- [ ] `language/r`: R APIs and clients\n- [ ] `language/java`: Java APIs and clients\n- [ ] `language/new`: Proposals for new client languages\n\n### What integration(s) does this bug affect?\n\n- [ ] `integrations/azure`: Azure and Azure ML integrations\n- [ ] `integrations/sagemaker`: SageMaker integrations\n- [ ] `integrations/databricks`: Databricks integrations","closed_by":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/7104/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/7104/timeline","performed_via_github_app":null,"state_reason":"completed"}