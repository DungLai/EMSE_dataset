{"url":"https://api.github.com/repos/mlflow/mlflow/issues/3448","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/3448/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/3448/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/3448/events","html_url":"https://github.com/mlflow/mlflow/issues/3448","id":706233014,"node_id":"MDU6SXNzdWU3MDYyMzMwMTQ=","number":3448,"title":"[BUG] MLflow not picking up environment variables and not mounting volumes when run with --backend kubernetes","user":{"login":"somasays","id":51323306,"node_id":"MDQ6VXNlcjUxMzIzMzA2","avatar_url":"https://avatars.githubusercontent.com/u/51323306?v=4","gravatar_id":"","url":"https://api.github.com/users/somasays","html_url":"https://github.com/somasays","followers_url":"https://api.github.com/users/somasays/followers","following_url":"https://api.github.com/users/somasays/following{/other_user}","gists_url":"https://api.github.com/users/somasays/gists{/gist_id}","starred_url":"https://api.github.com/users/somasays/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somasays/subscriptions","organizations_url":"https://api.github.com/users/somasays/orgs","repos_url":"https://api.github.com/users/somasays/repos","events_url":"https://api.github.com/users/somasays/events{/privacy}","received_events_url":"https://api.github.com/users/somasays/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":978584226,"node_id":"MDU6TGFiZWw5Nzg1ODQyMjY=","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/docs","name":"area/docs","color":"48eabc","default":false,"description":"Documentation issues"},{"id":2022847277,"node_id":"MDU6TGFiZWwyMDIyODQ3Mjc3","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/examples","name":"area/examples","color":"48eabc","default":false,"description":"Example code"},{"id":2022848510,"node_id":"MDU6TGFiZWwyMDIyODQ4NTEw","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/projects","name":"area/projects","color":"48eabc","default":false,"description":"MLproject format, project running backends"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-09-22T09:49:36Z","updated_at":"2020-09-22T09:49:52Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Thank you for submitting an issue. Please refer to our [issue policy](https://www.github.com/mlflow/mlflow/blob/master/ISSUE_POLICY.md) for additional information about bug reports. For help with debugging your code, please refer to [Stack Overflow](https://stackoverflow.com/questions/tagged/mlflow).\r\n\r\n**Please fill in this bug report template to ensure a timely and thorough response.**\r\n\r\n### Willingness to contribute\r\nThe MLflow Community encourages bug fix contributions. Would you or another member of your organization be willing to contribute a fix for this bug to the MLflow code base?\r\n\r\n- [ ] Yes. I can contribute a fix for this bug independently.\r\n- [x] Yes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\r\n- [ ] No. I cannot contribute a bug fix at this time.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: MacOS 10.14.5 (18F203)\r\n- **MLflow installed from (source or binary)**: binary\r\n- **MLflow version (run ``mlflow --version``)**: 1.11.0\r\n- **Python version**: Python 3.8.5\r\n- **npm version, if running the dev UI**: Not using UI\r\n- **Exact command to reproduce**: `MLFLOW_TRACKING_URI=https://xxxx.xxxxx.com MLFLOW_TRACKING_USERNAME=xxxx MLFLOW_TRACKING_PASSWORD=xxxxx mlflow run -P alpha=0.5  . --backend kubernetes --backend-config kubernetes_config.json --experiment-name test1`\r\n\r\n### Describe the problem\r\n**MLflow not picking up environment variables when run with --backend kubernetes**\r\n\r\nI'm trying to get MLProject to run inside Kubernetes following this https://github.com/mlflow/mlflow/tree/master/examples/docker with the below command\r\n\r\nThe describe pod however only show MLFLOW_TRACKING_URI being picked up not the other two env variables, see below\r\n\r\n```\r\nName:         tutorial-2020-09-22-11-17-54-381954-mgptt\r\nNamespace:    mlflow\r\nPriority:     0\r\nNode:         kind-worker/172.19.0.3\r\nContainers:\r\n  tutorial:\r\n    Container ID:  containerd://7de7124f96ea83da474e66bc7b2119cba4d4e0ab7188e135e3ed190dde5c8df4\r\n    State:          Terminated\r\n      Reason:       Error\r\n      Exit Code:    1\r\n      Started:      Tue, 22 Sep 2020 11:17:55 +0200\r\n      Finished:     Tue, 22 Sep 2020 11:17:56 +0200\r\n    Ready:          False\r\n    Restart Count:  0\r\n    ...\r\n    Environment:\r\n      MLFLOW_RUN_ID:         1a83aa6a16704883a775ad50bc94c7e9\r\n      MLFLOW_TRACKING_URI:   https://xxxx.xxxxx.com\r\n      MLFLOW_EXPERIMENT_ID:  73\r\n    ...\r\n```\r\n\r\nThe env variables are described in the MLproject file as below, to note the volume mentioned below also is also not mounted as expected\r\n\r\n```\r\ndocker_env:\r\n  image: somaupday/mlflow-sklearn:latest\r\n  environment: [[\"MLFLOW_TRACKING_URI\", \"https://xxxx.xxxxx.com\"], [\"MLFLOW_TRACKING_USERNAME\", \"mlflow\"], [\"MLFLOW_TRACKING_PASSWORD\", \"xxxxxxx\"]]\r\n  volumes: [\"${HOME}/.aws:/root/.aws\"]\r\n```\r\n\r\nother relevant files for reference \r\n**kubernetes_config.json**\r\n```\r\n{\r\n  \"kube-context\": \"kind-kind\",\r\n  \"repository-uri\": \"xxxxx/mlflow-sklearn\",\r\n  \"kube-job-template-path\": \"./kubernetes_job_template.yaml\"\r\n}\r\n```\r\n\r\n**kubernetes_job_template.yaml**\r\n```\r\napiVersion: batch/v1\r\nkind: Job\r\nmetadata:\r\n  name: \"{replaced with MLflow Project name}\"\r\n  namespace: mlflow\r\nspec:\r\n  ttlSecondsAfterFinished: 100\r\n  backoffLimit: 0\r\n  template:\r\n    spec:\r\n      containers:\r\n      - name: \"{replaced with MLflow Project name}\"\r\n        image: \"{replaced with URI of Docker image created during Project execution}\"\r\n        command: [\"{replaced with MLflow Project entry point command}\"]\r\n      resources:\r\n        limits:\r\n          memory: 512Mi\r\n        requests:\r\n          memory: 256Mi\r\n      restartPolicy: Never\r\n```\r\n\r\nAdditionally I also don't see the volumes are not mounted as expected.. \r\n\r\nPS: This is based on one of the MLproject that already runs in docker for us, we just want to run it in Kubernetes instead\r\n\r\n\r\n### Code to reproduce issue\r\n```\r\nMLFLOW_TRACKING_URI=https://xxxx.xxxxx.com MLFLOW_TRACKING_USERNAME=xxxx MLFLOW_TRACKING_PASSWORD=xxxxx mlflow run -P alpha=0.5  . --backend kubernetes --backend-config kubernetes_config.json --experiment-name test1\r\n```\r\n\r\n### What component(s), interfaces, languages, and integrations does this bug affect?\r\nComponents \r\n- [ ] `area/artifacts`: Artifact stores and artifact logging\r\n- [ ] `area/build`: Build and test infrastructure for MLflow\r\n- [x] `area/docs`: MLflow documentation pages\r\n- [x] `area/examples`: Example code\r\n- [ ] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for Model Registry\r\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\r\n- [x] `area/projects`: MLproject format, project running backends\r\n- [ ] `area/scoring`: Local serving, model deployment tools, spark UDFs\r\n- [ ] `area/server-infra`: MLflow server, JavaScript dev server\r\n- [ ] `area/tracking`: Tracking Service, tracking client APIs, autologging\r\n\r\nInterface \r\n- [ ] `area/uiux`: Front-end, user experience, JavaScript, plotting\r\n- [ ] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\r\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\r\n- [ ] `area/windows`: Windows support\r\n\r\nLanguage \r\n- [ ] `language/r`: R APIs and clients\r\n- [ ] `language/java`: Java APIs and clients\r\n- [ ] `language/new`: Proposals for new client languages\r\n\r\nIntegrations\r\n- [ ] `integrations/azure`: Azure and Azure ML integrations\r\n- [ ] `integrations/sagemaker`: SageMaker integrations\r\n- [ ] `integrations/databricks`: Databricks integrations\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/3448/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/3448/timeline","performed_via_github_app":null,"state_reason":null}