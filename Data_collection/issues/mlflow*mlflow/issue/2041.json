{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2041","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2041/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2041/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2041/events","html_url":"https://github.com/mlflow/mlflow/issues/2041","id":517822777,"node_id":"MDU6SXNzdWU1MTc4MjI3Nzc=","number":2041,"title":"[BUG] Spark UDF spark_udf() fails for H2o models","user":{"login":"kucera-jan-cz","id":7317329,"node_id":"MDQ6VXNlcjczMTczMjk=","avatar_url":"https://avatars.githubusercontent.com/u/7317329?v=4","gravatar_id":"","url":"https://api.github.com/users/kucera-jan-cz","html_url":"https://github.com/kucera-jan-cz","followers_url":"https://api.github.com/users/kucera-jan-cz/followers","following_url":"https://api.github.com/users/kucera-jan-cz/following{/other_user}","gists_url":"https://api.github.com/users/kucera-jan-cz/gists{/gist_id}","starred_url":"https://api.github.com/users/kucera-jan-cz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kucera-jan-cz/subscriptions","organizations_url":"https://api.github.com/users/kucera-jan-cz/orgs","repos_url":"https://api.github.com/users/kucera-jan-cz/repos","events_url":"https://api.github.com/users/kucera-jan-cz/events{/privacy}","received_events_url":"https://api.github.com/users/kucera-jan-cz/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022848043,"node_id":"MDU6TGFiZWwyMDIyODQ4MDQz","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/models","name":"area/models","color":"48eabc","default":false,"description":"MLmodel format, model serialization/deserialization, flavors"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2019-11-05T14:53:26Z","updated_at":"2020-07-22T18:31:42Z","closed_at":"2020-07-22T18:31:42Z","author_association":"NONE","active_lock_reason":null,"body":"### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Docker (debian stretch) in Windows 10\r\n- **MLflow installed from (source or binary)**: pip install mlflow\r\n- **MLflow version (run ``mlflow --version``)**: 1.4.0\r\n- **Python version**: Python 3.5.3\r\n- **npm version, if running the dev UI**: No\r\n- **Exact command to reproduce**: Below\r\n\r\n### Describe the problem\r\nI am trying to use your spark_udf function for Spark to run model created by H2O. My setup is one docker image with spark and one with mlflow. I was able to log model through your code and serve it through `mlflow models serve` however I am failing to achive prediction in spark where H2O is failing saying my dataframe doesn't have required columns (see log where is also printing that DF contains required columns). H2o version is same on both containers however python version differs. Can you please advise me whether there is some way to achieve predictions?\r\n\r\n\r\n\r\n### Code to reproduce issue\r\n```\r\nfrom pyspark.sql import SparkSession\r\nimport mlflow\r\nfrom mlflow import pyfunc\r\nimport h2o\r\nfrom mlflow.h2o import load_model\r\nfrom pyspark.sql.types import IntegerType\r\n\r\nh2o.init()\r\n\r\nsc = SparkSession.builder.appName(\"Python Spark with MlFlow\").getOrCreate()\r\n\r\nmlflow.set_tracking_uri(\"http://mlflow:5000\")\r\n\r\nmodel_path = \"runs:/87da0a12c7974f1b9cf6d1d6726aaed8/model\"\r\nmodel_udf = mlflow.pyfunc.spark_udf(sc, model_path, IntegerType())\r\n\r\nmodel = load_model(model_path)\r\nprint('MODEL:')\r\nprint('-----')\r\nprint(model.summary())\r\n\r\ndf = sc.read.csv('/var/local/data/rai_data/wine_quality_h2o_test.csv',\r\n                 header=True,\r\n                 sep='|')\r\ndf.show(1)\r\ndf.select(\"density\", \"alcohol\", \"pH\", \"sulphates\").show(1)\r\nprint(df.withColumn(\"prediction\",\r\n                    model_udf(\"density\", \"alcohol\", \"pH\", \"sulphates\")\r\n                    ).show(3))\r\n```\r\n\r\n### Other info / logs\r\nLogs with output and error placed in file [output.txt](https://github.com/mlflow/mlflow/files/3809527/output.txt)","closed_by":{"login":"tomasatdatabricks","id":33237569,"node_id":"MDQ6VXNlcjMzMjM3NTY5","avatar_url":"https://avatars.githubusercontent.com/u/33237569?v=4","gravatar_id":"","url":"https://api.github.com/users/tomasatdatabricks","html_url":"https://github.com/tomasatdatabricks","followers_url":"https://api.github.com/users/tomasatdatabricks/followers","following_url":"https://api.github.com/users/tomasatdatabricks/following{/other_user}","gists_url":"https://api.github.com/users/tomasatdatabricks/gists{/gist_id}","starred_url":"https://api.github.com/users/tomasatdatabricks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tomasatdatabricks/subscriptions","organizations_url":"https://api.github.com/users/tomasatdatabricks/orgs","repos_url":"https://api.github.com/users/tomasatdatabricks/repos","events_url":"https://api.github.com/users/tomasatdatabricks/events{/privacy}","received_events_url":"https://api.github.com/users/tomasatdatabricks/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2041/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2041/timeline","performed_via_github_app":null,"state_reason":"completed"}