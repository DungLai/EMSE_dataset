{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2832","repository_url":"https://api.github.com/repos/mlflow/mlflow","labels_url":"https://api.github.com/repos/mlflow/mlflow/issues/2832/labels{/name}","comments_url":"https://api.github.com/repos/mlflow/mlflow/issues/2832/comments","events_url":"https://api.github.com/repos/mlflow/mlflow/issues/2832/events","html_url":"https://github.com/mlflow/mlflow/issues/2832","id":618619091,"node_id":"MDU6SXNzdWU2MTg2MTkwOTE=","number":2832,"title":"[BUG] mlflow server logs secrets on first startup","user":{"login":"hajapy","id":21218230,"node_id":"MDQ6VXNlcjIxMjE4MjMw","avatar_url":"https://avatars.githubusercontent.com/u/21218230?v=4","gravatar_id":"","url":"https://api.github.com/users/hajapy","html_url":"https://github.com/hajapy","followers_url":"https://api.github.com/users/hajapy/followers","following_url":"https://api.github.com/users/hajapy/following{/other_user}","gists_url":"https://api.github.com/users/hajapy/gists{/gist_id}","starred_url":"https://api.github.com/users/hajapy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hajapy/subscriptions","organizations_url":"https://api.github.com/users/hajapy/orgs","repos_url":"https://api.github.com/users/hajapy/repos","events_url":"https://api.github.com/users/hajapy/events{/privacy}","received_events_url":"https://api.github.com/users/hajapy/received_events","type":"User","site_admin":false},"labels":[{"id":955449428,"node_id":"MDU6TGFiZWw5NTU0NDk0Mjg=","url":"https://api.github.com/repos/mlflow/mlflow/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2022852620,"node_id":"MDU6TGFiZWwyMDIyODUyNjIw","url":"https://api.github.com/repos/mlflow/mlflow/labels/area/sqlalchemy","name":"area/sqlalchemy","color":"ede978","default":false,"description":"Use of SQL alchemy in tracking service or model registry"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-05-15T00:40:58Z","updated_at":"2020-05-22T06:47:26Z","closed_at":"2020-05-22T06:47:26Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### Willingness to contribute\r\nThe MLflow Community encourages bug fix contributions. Would you or another member of your organization be willing to contribute a fix for this bug to the MLflow code base?\r\n\r\n- [ ] Yes. I can contribute a fix for this bug independently.\r\n- [x] Yes. I would be willing to contribute a fix for this bug with guidance from the MLflow community.\r\n- [ ] No. I cannot contribute a bug fix at this time.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in MLflow)**: no\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Debian Buster\r\n- **MLflow installed from (source or binary)**: source\r\n- **MLflow version (run ``mlflow --version``)**: 1.8.0\r\n- **Python version**: 3.8\r\n- **npm version, if running the dev UI**:\r\n- **Exact command to reproduce**: `mlflow server --backend-store-uri postgresql://username:password@host:port/name`\r\n\r\n### Describe the problem\r\nThe first time an mlflow server is started, tables are created and the database is updated to prepare it for use. This triggers this line: https://github.com/mlflow/mlflow/blob/8e6b27dbc3370d9fc0e550d6bbaf00a7b7feb0be/mlflow/store/db/utils.py#L124\r\n\r\nUnfortunately, this means the log output contains the full text of the engine.url, including the database username and password, which is secret information and shouldn't appear in plaintext log files. \r\n\r\nExpected behaviour: sensitive information should either be masked or excluded.\r\n\r\nI traced into sqlalchemy code and found that the URL object contained within the engine behaves differently when str() or repr()'ed: https://github.com/sqlalchemy/sqlalchemy/blob/3ab5e3781b9f44d458cb6213e89f50d01ea167dd/lib/sqlalchemy/engine/url.py#L105-L109\r\n\r\nWith str-formatting, it does not hide passwords, whereas with repr it does.\r\n\r\nI'm happy to contribute a fix, of which I see a few options:\r\n\r\n- Drop including the url in this log statement\r\n- Move the url to a debug statement\r\n- Use repr instead of str for formatting\r\n\r\n\r\n### Code to reproduce issue\r\nCreate an server backed by a SQL database using `mlflow server --backend-store-uri <uri>`, observe the log output: \"Updating database tables at <postgresql://user:password@host:port/name>\"\r\n\r\n\r\n### What component(s), interfaces, languages, and integrations does this bug affect?\r\nComponents \r\n- [ ] `area/artifacts`: Artifact stores and artifact logging\r\n- [ ] `area/build`: Build and test infrastructure for MLflow\r\n- [ ] `area/docs`: MLflow documentation pages\r\n- [ ] `area/examples`: Example code\r\n- [ ] `area/model-registry`: Model Registry service, APIs, and the fluent client calls for\r\nModel Registry\r\n- [ ] `area/models`: MLmodel format, model serialization/deserialization, flavors\r\n- [ ] `area/projects`: MLproject format, project running backends\r\n- [ ] `area/scoring`: Local serving, model deployment tools, spark UDFs\r\n- [x] `area/tracking`: Tracking Service, tracking client APIs, autologging\r\n\r\nInterface \r\n- [ ] `area/uiux`: Front-end, user experience, JavaScript, plotting\r\n- [ ] `area/docker`: Docker use across MLflow's components, such as MLflow Projects and MLflow Models\r\n- [ ] `area/sqlalchemy`: Use of SQLAlchemy in the Tracking Service or Model Registry\r\n- [ ] `area/windows`: Windows support\r\n\r\nLanguage \r\n- [ ] `language/r`: R APIs and clients\r\n- [ ] `language/java`: Java APIs and clients\r\n\r\nIntegrations\r\n- [ ] `integrations/azure`: Azure and Azure ML integrations\r\n- [ ] `integrations/sagemaker`: SageMaker integrations\r\n","closed_by":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/2832/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mlflow/mlflow/issues/2832/timeline","performed_via_github_app":null,"state_reason":"completed"}