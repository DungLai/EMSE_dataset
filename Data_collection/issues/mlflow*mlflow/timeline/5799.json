[{"id":6520620138,"node_id":"LE_lADOCB5Jx85IuJhxzwAAAAGEqMRq","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/6520620138","actor":{"login":"Sergiodiaz53","id":6660257,"node_id":"MDQ6VXNlcjY2NjAyNTc=","avatar_url":"https://avatars.githubusercontent.com/u/6660257?v=4","gravatar_id":"","url":"https://api.github.com/users/Sergiodiaz53","html_url":"https://github.com/Sergiodiaz53","followers_url":"https://api.github.com/users/Sergiodiaz53/followers","following_url":"https://api.github.com/users/Sergiodiaz53/following{/other_user}","gists_url":"https://api.github.com/users/Sergiodiaz53/gists{/gist_id}","starred_url":"https://api.github.com/users/Sergiodiaz53/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sergiodiaz53/subscriptions","organizations_url":"https://api.github.com/users/Sergiodiaz53/orgs","repos_url":"https://api.github.com/users/Sergiodiaz53/repos","events_url":"https://api.github.com/users/Sergiodiaz53/events{/privacy}","received_events_url":"https://api.github.com/users/Sergiodiaz53/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-04-29T07:04:07Z","label":{"name":"area/docs","color":"48eabc"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1115477503","html_url":"https://github.com/mlflow/mlflow/issues/5799#issuecomment-1115477503","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/5799","id":1115477503,"node_id":"IC_kwDOCB5Jx85CfNX_","user":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"created_at":"2022-05-02T23:56:07Z","updated_at":"2022-05-02T23:56:07Z","author_association":"COLLABORATOR","body":"Hi @Sergiodiaz53, using `~/.ssh/config` is indeed the recommended approach for specifying custom private keys and other host-specific connection properties. To confirm, is the hostname included in the artifact URI? If you don't mind doing some printline debugging, perhaps printing the value of `user_config` in https://github.com/mlflow/mlflow/blob/d0d307f7f7b49f013727191a672ae2139bf37343/mlflow/store/artifact/sftp_artifact_repo.py#L52 could shed some light on the situation. Once this is resolved, we would be very excited about a documentation improvement; thank you so much in advance.","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1115477503/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false}},{"id":6536935884,"node_id":"MEE_lADOCB5Jx85IuJhxzwAAAAGFobnM","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/6536935884","actor":{"login":"Sergiodiaz53","id":6660257,"node_id":"MDQ6VXNlcjY2NjAyNTc=","avatar_url":"https://avatars.githubusercontent.com/u/6660257?v=4","gravatar_id":"","url":"https://api.github.com/users/Sergiodiaz53","html_url":"https://github.com/Sergiodiaz53","followers_url":"https://api.github.com/users/Sergiodiaz53/followers","following_url":"https://api.github.com/users/Sergiodiaz53/following{/other_user}","gists_url":"https://api.github.com/users/Sergiodiaz53/gists{/gist_id}","starred_url":"https://api.github.com/users/Sergiodiaz53/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sergiodiaz53/subscriptions","organizations_url":"https://api.github.com/users/Sergiodiaz53/orgs","repos_url":"https://api.github.com/users/Sergiodiaz53/repos","events_url":"https://api.github.com/users/Sergiodiaz53/events{/privacy}","received_events_url":"https://api.github.com/users/Sergiodiaz53/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-05-02T23:56:07Z","performed_via_github_app":null},{"id":6536935886,"node_id":"SE_lADOCB5Jx85IuJhxzwAAAAGFobnO","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/6536935886","actor":{"login":"Sergiodiaz53","id":6660257,"node_id":"MDQ6VXNlcjY2NjAyNTc=","avatar_url":"https://avatars.githubusercontent.com/u/6660257?v=4","gravatar_id":"","url":"https://api.github.com/users/Sergiodiaz53","html_url":"https://github.com/Sergiodiaz53","followers_url":"https://api.github.com/users/Sergiodiaz53/followers","following_url":"https://api.github.com/users/Sergiodiaz53/following{/other_user}","gists_url":"https://api.github.com/users/Sergiodiaz53/gists{/gist_id}","starred_url":"https://api.github.com/users/Sergiodiaz53/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sergiodiaz53/subscriptions","organizations_url":"https://api.github.com/users/Sergiodiaz53/orgs","repos_url":"https://api.github.com/users/Sergiodiaz53/repos","events_url":"https://api.github.com/users/Sergiodiaz53/events{/privacy}","received_events_url":"https://api.github.com/users/Sergiodiaz53/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-05-02T23:56:07Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1121110108","html_url":"https://github.com/mlflow/mlflow/issues/5799#issuecomment-1121110108","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/5799","id":1121110108,"node_id":"IC_kwDOCB5Jx85C0shc","user":{"login":"Sergiodiaz53","id":6660257,"node_id":"MDQ6VXNlcjY2NjAyNTc=","avatar_url":"https://avatars.githubusercontent.com/u/6660257?v=4","gravatar_id":"","url":"https://api.github.com/users/Sergiodiaz53","html_url":"https://github.com/Sergiodiaz53","followers_url":"https://api.github.com/users/Sergiodiaz53/followers","following_url":"https://api.github.com/users/Sergiodiaz53/following{/other_user}","gists_url":"https://api.github.com/users/Sergiodiaz53/gists{/gist_id}","starred_url":"https://api.github.com/users/Sergiodiaz53/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sergiodiaz53/subscriptions","organizations_url":"https://api.github.com/users/Sergiodiaz53/orgs","repos_url":"https://api.github.com/users/Sergiodiaz53/repos","events_url":"https://api.github.com/users/Sergiodiaz53/events{/privacy}","received_events_url":"https://api.github.com/users/Sergiodiaz53/received_events","type":"User","site_admin":false},"created_at":"2022-05-09T13:33:34Z","updated_at":"2022-05-13T07:54:58Z","author_association":"NONE","body":"Hi dbczumar, \r\n\r\nSorry for the delay.\r\nI'm running MLFLOW in a docker with a exposed port to localhost in :5000\r\nI'm running SFTP in a remote host 2.2.2.2:9222\r\nI'm running my CLIENT in localhost\r\n\r\nIm launching MLFlow inside my docker container as root using: \r\n`mlflow server  --port 5000  --host 0.0.0.0  --backend-store-uri sqlite:///db/test.db --default-artifact-root sftp://mlflow@ 2.2.2.2:9222`\r\n\r\nI'm launching my CLIENT using my ubuntuuser, inside myfile.py I set up:\r\n\r\n```\r\nremote_server_uri = \"http://127.0.0.1:5000\"\r\nmlflow.set_tracking_uri(remote_server_uri)\r\n\r\n[train model]\r\n\r\nmlflow.keras.save_model(...)\r\nmlflow.keras.log_model(...)\r\n```\r\n\r\nI have added to ~/.ssh/config in the docker container with mlflow and my localhost this information:\r\n\r\n```\r\nHost sftp_server\r\n        Hostname 2.2.2.2\r\n        User mlflow\r\n        IdentityFile ~/.ssh/id_rsa\r\n```\r\n\r\nWhen I run myfile.py, the print you told me (inside the sftp_artifact_repo) is priting:\r\n{ ''hostname'' : ''2.2.2.2''}\r\nand being id_rsa my only rsa I have seen that is being taken.\r\nSo what is probable happening is that Im trying to connect to 2.2.2.2 (OK) with the user mlflow (OK) and the id_rsa file (OK) but in the port 22 and NOT the 9222.\r\n\r\nQuestions:\r\n**1)** Is there anyway to setup a custom port for SFTP? Do I add the port into the ~/.ssh/config file?\r\n\r\n```\r\nHost sftp_server\r\n        Hostname 2.2.2.2\r\n        Port 9222\r\n        User mlflow\r\n        IdentityFile ~/.ssh/id_rsa\r\n```\r\n\r\n**2)** Knowing that Im running mlflow inside a docker container, I think I should set the ~/.ssh/config file in both (meaning the localhost and the docker itself), am I right?\r\n\r\n**3) Extra question** when I launch the mlflow instance, in the --default-artifact-root, should I use the name of the hostname defined in ~/.ssh/config? in this case ''_sftp_server_'' or should I stick with the IP itself?\r\n\r\nThanks in advance!\r\n","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1121110108/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Sergiodiaz53","id":6660257,"node_id":"MDQ6VXNlcjY2NjAyNTc=","avatar_url":"https://avatars.githubusercontent.com/u/6660257?v=4","gravatar_id":"","url":"https://api.github.com/users/Sergiodiaz53","html_url":"https://github.com/Sergiodiaz53","followers_url":"https://api.github.com/users/Sergiodiaz53/followers","following_url":"https://api.github.com/users/Sergiodiaz53/following{/other_user}","gists_url":"https://api.github.com/users/Sergiodiaz53/gists{/gist_id}","starred_url":"https://api.github.com/users/Sergiodiaz53/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sergiodiaz53/subscriptions","organizations_url":"https://api.github.com/users/Sergiodiaz53/orgs","repos_url":"https://api.github.com/users/Sergiodiaz53/repos","events_url":"https://api.github.com/users/Sergiodiaz53/events{/privacy}","received_events_url":"https://api.github.com/users/Sergiodiaz53/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1125757755","html_url":"https://github.com/mlflow/mlflow/issues/5799#issuecomment-1125757755","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/5799","id":1125757755,"node_id":"IC_kwDOCB5Jx85DGbM7","user":{"login":"Sergiodiaz53","id":6660257,"node_id":"MDQ6VXNlcjY2NjAyNTc=","avatar_url":"https://avatars.githubusercontent.com/u/6660257?v=4","gravatar_id":"","url":"https://api.github.com/users/Sergiodiaz53","html_url":"https://github.com/Sergiodiaz53","followers_url":"https://api.github.com/users/Sergiodiaz53/followers","following_url":"https://api.github.com/users/Sergiodiaz53/following{/other_user}","gists_url":"https://api.github.com/users/Sergiodiaz53/gists{/gist_id}","starred_url":"https://api.github.com/users/Sergiodiaz53/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sergiodiaz53/subscriptions","organizations_url":"https://api.github.com/users/Sergiodiaz53/orgs","repos_url":"https://api.github.com/users/Sergiodiaz53/repos","events_url":"https://api.github.com/users/Sergiodiaz53/events{/privacy}","received_events_url":"https://api.github.com/users/Sergiodiaz53/received_events","type":"User","site_admin":false},"created_at":"2022-05-13T07:49:16Z","updated_at":"2022-05-13T07:55:22Z","author_association":"NONE","body":"Hi there,\r\n\r\nI had some advances on this.\r\nAt first let me say that if I run:\r\n\r\n`sftp mlflow@2.2.2.2`\r\n\r\neverything works and I can create files and directories in my sftp server. So without MLFlow everything seems to work fine (meaning that my .ssh/config file is ok)\r\n\r\nNow when I print my user_config inside sftp_artifact_repo.py what I get is:\r\n\r\n`{'hostname': '2.2.2.2', 'port': '9222', 'user': 'mlflow', 'identityfile': ['/home/UBUNTUUSER/.ssh/id_rsa_sftp']}`\r\n\r\nSo I think I'm on the good way.\r\nThe problem is I'm getting a:\r\n\r\n`paramiko.ssh_exception.SSHException: Bad host key from server`\r\n\r\nDue to the user_config print I'm pretty sure we are using the correct key, may the problem be related to the known_hosts?\r\n\r\nIm running my .py using my user UBUNTUUSER but I'm connecting using the user MLFLOW, I have already try to create a /home/mlflow/.ssh/known_hosts with the fingerprint but I still have the same problem.\r\n\r\nHope you can help! \r\nThanks in advance\r\n\r\n","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1125757755/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Sergiodiaz53","id":6660257,"node_id":"MDQ6VXNlcjY2NjAyNTc=","avatar_url":"https://avatars.githubusercontent.com/u/6660257?v=4","gravatar_id":"","url":"https://api.github.com/users/Sergiodiaz53","html_url":"https://github.com/Sergiodiaz53","followers_url":"https://api.github.com/users/Sergiodiaz53/followers","following_url":"https://api.github.com/users/Sergiodiaz53/following{/other_user}","gists_url":"https://api.github.com/users/Sergiodiaz53/gists{/gist_id}","starred_url":"https://api.github.com/users/Sergiodiaz53/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sergiodiaz53/subscriptions","organizations_url":"https://api.github.com/users/Sergiodiaz53/orgs","repos_url":"https://api.github.com/users/Sergiodiaz53/repos","events_url":"https://api.github.com/users/Sergiodiaz53/events{/privacy}","received_events_url":"https://api.github.com/users/Sergiodiaz53/received_events","type":"User","site_admin":false}}]