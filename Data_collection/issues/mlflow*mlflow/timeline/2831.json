[{"id":3338870075,"node_id":"MDEyOkxhYmVsZWRFdmVudDMzMzg4NzAwNzU=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3338870075","actor":{"login":"ramji-c","id":12154068,"node_id":"MDQ6VXNlcjEyMTU0MDY4","avatar_url":"https://avatars.githubusercontent.com/u/12154068?v=4","gravatar_id":"","url":"https://api.github.com/users/ramji-c","html_url":"https://github.com/ramji-c","followers_url":"https://api.github.com/users/ramji-c/followers","following_url":"https://api.github.com/users/ramji-c/following{/other_user}","gists_url":"https://api.github.com/users/ramji-c/gists{/gist_id}","starred_url":"https://api.github.com/users/ramji-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ramji-c/subscriptions","organizations_url":"https://api.github.com/users/ramji-c/orgs","repos_url":"https://api.github.com/users/ramji-c/repos","events_url":"https://api.github.com/users/ramji-c/events{/privacy}","received_events_url":"https://api.github.com/users/ramji-c/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-05-15T00:14:33Z","label":{"name":"bug","color":"d73a4a"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/629054244","html_url":"https://github.com/mlflow/mlflow/issues/2831#issuecomment-629054244","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/2831","id":629054244,"node_id":"MDEyOklzc3VlQ29tbWVudDYyOTA1NDI0NA==","user":{"login":"smurching","id":2358483,"node_id":"MDQ6VXNlcjIzNTg0ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2358483?v=4","gravatar_id":"","url":"https://api.github.com/users/smurching","html_url":"https://github.com/smurching","followers_url":"https://api.github.com/users/smurching/followers","following_url":"https://api.github.com/users/smurching/following{/other_user}","gists_url":"https://api.github.com/users/smurching/gists{/gist_id}","starred_url":"https://api.github.com/users/smurching/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smurching/subscriptions","organizations_url":"https://api.github.com/users/smurching/orgs","repos_url":"https://api.github.com/users/smurching/repos","events_url":"https://api.github.com/users/smurching/events{/privacy}","received_events_url":"https://api.github.com/users/smurching/received_events","type":"User","site_admin":false},"created_at":"2020-05-15T06:27:21Z","updated_at":"2020-05-15T06:27:21Z","author_association":"COLLABORATOR","body":"Hi @ramji-c, thanks for reporting this issue! Do you have an example code snippet that I can run to reproduce it? We have a test [here](https://github.com/mlflow/mlflow/blob/c8ec506e83e7f7e3e0af6094444d7969ed1a11e3/tests/tensorflow_autolog/test_tensorflow2_autolog.py#L230-L249) that [fits a model for 10 epochs](https://github.com/mlflow/mlflow/blob/c8ec506e83e7f7e3e0af6094444d7969ed1a11e3/tests/tensorflow_autolog/test_tensorflow2_autolog.py#L174-L193) with a patience of 11, so that early stopping cannot occur, and verifies that autologging doesn't log an extra metric value in that case In particular, only 10 metric values are logged, one per step of training, rather than 11 metrics\r\n\r\nI updated the autologging test in [this branch](https://github.com/smurching/mlflow/pull/new/tensorflow-repro) to use a patience value of 2 and `min_delta` of 0.01, as in your example callback, and found that it still passes using TensorFlow 2.2.0. It's possible there's something different about the test setup vs in your use case - having a script handy that I can run reproduce the error you saw would help rule that out. Thanks!\r\n\r\nAs you pointed out, we only log metric values again if the Keras callback has a non-zero `stopped_epoch`. If `stopped_epoch == num_epochs`, this actually means that loss has improved by < `min_delta` for the last `patience` epochs, as per the [tf.Keras docs](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/EarlyStopping#arguments_1), so early stopping is in fact being applied. For example, if I train a model for 10 epochs with `patience=2` and `min_delta=0.01` and find that early stopping occurs on epoch 10, that implies that loss has improved by less than 0.01 for both epochs 9 and 10, so we should apply early stopping and restore weights from epoch 8.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/629054244/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"smurching","id":2358483,"node_id":"MDQ6VXNlcjIzNTg0ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2358483?v=4","gravatar_id":"","url":"https://api.github.com/users/smurching","html_url":"https://github.com/smurching","followers_url":"https://api.github.com/users/smurching/followers","following_url":"https://api.github.com/users/smurching/following{/other_user}","gists_url":"https://api.github.com/users/smurching/gists{/gist_id}","starred_url":"https://api.github.com/users/smurching/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smurching/subscriptions","organizations_url":"https://api.github.com/users/smurching/orgs","repos_url":"https://api.github.com/users/smurching/repos","events_url":"https://api.github.com/users/smurching/events{/privacy}","received_events_url":"https://api.github.com/users/smurching/received_events","type":"User","site_admin":false}},{"id":3339536789,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzMzOTUzNjc4OQ==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3339536789","actor":{"login":"ramji-c","id":12154068,"node_id":"MDQ6VXNlcjEyMTU0MDY4","avatar_url":"https://avatars.githubusercontent.com/u/12154068?v=4","gravatar_id":"","url":"https://api.github.com/users/ramji-c","html_url":"https://github.com/ramji-c","followers_url":"https://api.github.com/users/ramji-c/followers","following_url":"https://api.github.com/users/ramji-c/following{/other_user}","gists_url":"https://api.github.com/users/ramji-c/gists{/gist_id}","starred_url":"https://api.github.com/users/ramji-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ramji-c/subscriptions","organizations_url":"https://api.github.com/users/ramji-c/orgs","repos_url":"https://api.github.com/users/ramji-c/repos","events_url":"https://api.github.com/users/ramji-c/events{/privacy}","received_events_url":"https://api.github.com/users/ramji-c/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-05-15T06:27:21Z","performed_via_github_app":null},{"id":3339536792,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMzMzk1MzY3OTI=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3339536792","actor":{"login":"ramji-c","id":12154068,"node_id":"MDQ6VXNlcjEyMTU0MDY4","avatar_url":"https://avatars.githubusercontent.com/u/12154068?v=4","gravatar_id":"","url":"https://api.github.com/users/ramji-c","html_url":"https://github.com/ramji-c","followers_url":"https://api.github.com/users/ramji-c/followers","following_url":"https://api.github.com/users/ramji-c/following{/other_user}","gists_url":"https://api.github.com/users/ramji-c/gists{/gist_id}","starred_url":"https://api.github.com/users/ramji-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ramji-c/subscriptions","organizations_url":"https://api.github.com/users/ramji-c/orgs","repos_url":"https://api.github.com/users/ramji-c/repos","events_url":"https://api.github.com/users/ramji-c/events{/privacy}","received_events_url":"https://api.github.com/users/ramji-c/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-05-15T06:27:21Z","performed_via_github_app":null},{"id":3345077826,"node_id":"MDEyOkxhYmVsZWRFdmVudDMzNDUwNzc4MjY=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3345077826","actor":{"login":"sueann","id":4411489,"node_id":"MDQ6VXNlcjQ0MTE0ODk=","avatar_url":"https://avatars.githubusercontent.com/u/4411489?v=4","gravatar_id":"","url":"https://api.github.com/users/sueann","html_url":"https://github.com/sueann","followers_url":"https://api.github.com/users/sueann/followers","following_url":"https://api.github.com/users/sueann/following{/other_user}","gists_url":"https://api.github.com/users/sueann/gists{/gist_id}","starred_url":"https://api.github.com/users/sueann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sueann/subscriptions","organizations_url":"https://api.github.com/users/sueann/orgs","repos_url":"https://api.github.com/users/sueann/repos","events_url":"https://api.github.com/users/sueann/events{/privacy}","received_events_url":"https://api.github.com/users/sueann/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-05-18T00:06:36Z","label":{"name":"area/tracking","color":"48eabc"},"performed_via_github_app":null},{"id":3345077967,"node_id":"MDEyOkxhYmVsZWRFdmVudDMzNDUwNzc5Njc=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3345077967","actor":{"login":"sueann","id":4411489,"node_id":"MDQ6VXNlcjQ0MTE0ODk=","avatar_url":"https://avatars.githubusercontent.com/u/4411489?v=4","gravatar_id":"","url":"https://api.github.com/users/sueann","html_url":"https://github.com/sueann","followers_url":"https://api.github.com/users/sueann/followers","following_url":"https://api.github.com/users/sueann/following{/other_user}","gists_url":"https://api.github.com/users/sueann/gists{/gist_id}","starred_url":"https://api.github.com/users/sueann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sueann/subscriptions","organizations_url":"https://api.github.com/users/sueann/orgs","repos_url":"https://api.github.com/users/sueann/repos","events_url":"https://api.github.com/users/sueann/events{/privacy}","received_events_url":"https://api.github.com/users/sueann/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-05-18T00:06:48Z","label":{"name":"needs author feedback","color":"fef2c0"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/630446307","html_url":"https://github.com/mlflow/mlflow/issues/2831#issuecomment-630446307","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/2831","id":630446307,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDQ0NjMwNw==","user":{"login":"ramji-c","id":12154068,"node_id":"MDQ6VXNlcjEyMTU0MDY4","avatar_url":"https://avatars.githubusercontent.com/u/12154068?v=4","gravatar_id":"","url":"https://api.github.com/users/ramji-c","html_url":"https://github.com/ramji-c","followers_url":"https://api.github.com/users/ramji-c/followers","following_url":"https://api.github.com/users/ramji-c/following{/other_user}","gists_url":"https://api.github.com/users/ramji-c/gists{/gist_id}","starred_url":"https://api.github.com/users/ramji-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ramji-c/subscriptions","organizations_url":"https://api.github.com/users/ramji-c/orgs","repos_url":"https://api.github.com/users/ramji-c/repos","events_url":"https://api.github.com/users/ramji-c/events{/privacy}","received_events_url":"https://api.github.com/users/ramji-c/received_events","type":"User","site_admin":false},"created_at":"2020-05-18T21:31:41Z","updated_at":"2020-05-18T21:31:41Z","author_association":"NONE","body":"Had a brief discussion with Sid and got all clarifications I needed. This can be closed! Thank you, Sid.","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/630446307/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ramji-c","id":12154068,"node_id":"MDQ6VXNlcjEyMTU0MDY4","avatar_url":"https://avatars.githubusercontent.com/u/12154068?v=4","gravatar_id":"","url":"https://api.github.com/users/ramji-c","html_url":"https://github.com/ramji-c","followers_url":"https://api.github.com/users/ramji-c/followers","following_url":"https://api.github.com/users/ramji-c/following{/other_user}","gists_url":"https://api.github.com/users/ramji-c/gists{/gist_id}","starred_url":"https://api.github.com/users/ramji-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ramji-c/subscriptions","organizations_url":"https://api.github.com/users/ramji-c/orgs","repos_url":"https://api.github.com/users/ramji-c/repos","events_url":"https://api.github.com/users/ramji-c/events{/privacy}","received_events_url":"https://api.github.com/users/ramji-c/received_events","type":"User","site_admin":false}},{"id":3349195908,"node_id":"MDE0OlVubGFiZWxlZEV2ZW50MzM0OTE5NTkwOA==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3349195908","actor":{"login":"stale[bot]","id":26384082,"node_id":"MDM6Qm90MjYzODQwODI=","avatar_url":"https://avatars.githubusercontent.com/in/1724?v=4","gravatar_id":"","url":"https://api.github.com/users/stale%5Bbot%5D","html_url":"https://github.com/apps/stale","followers_url":"https://api.github.com/users/stale%5Bbot%5D/followers","following_url":"https://api.github.com/users/stale%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stale%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/stale%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/stale%5Bbot%5D/repos","events_url":"https://api.github.com/users/stale%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/stale%5Bbot%5D/received_events","type":"Bot","site_admin":false},"event":"unlabeled","commit_id":null,"commit_url":null,"created_at":"2020-05-18T21:31:44Z","label":{"name":"needs author feedback","color":"fef2c0"},"performed_via_github_app":null},{"id":3460128725,"node_id":"MDExOkNsb3NlZEV2ZW50MzQ2MDEyODcyNQ==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3460128725","actor":{"login":"juntai-zheng","id":39497939,"node_id":"MDQ6VXNlcjM5NDk3OTM5","avatar_url":"https://avatars.githubusercontent.com/u/39497939?v=4","gravatar_id":"","url":"https://api.github.com/users/juntai-zheng","html_url":"https://github.com/juntai-zheng","followers_url":"https://api.github.com/users/juntai-zheng/followers","following_url":"https://api.github.com/users/juntai-zheng/following{/other_user}","gists_url":"https://api.github.com/users/juntai-zheng/gists{/gist_id}","starred_url":"https://api.github.com/users/juntai-zheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juntai-zheng/subscriptions","organizations_url":"https://api.github.com/users/juntai-zheng/orgs","repos_url":"https://api.github.com/users/juntai-zheng/repos","events_url":"https://api.github.com/users/juntai-zheng/events{/privacy}","received_events_url":"https://api.github.com/users/juntai-zheng/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-06-18T21:28:39Z","state_reason":null,"performed_via_github_app":null}]