[{"id":7017252300,"node_id":"LE_lADOCB5Jx85OBRUCzwAAAAGiQsXM","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/7017252300","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-07-19T04:20:18Z","label":{"name":"bug","color":"d73a4a"},"performed_via_github_app":null},{"id":7017253447,"node_id":"LE_lADOCB5Jx85OBRUCzwAAAAGiQspH","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/7017253447","actor":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-07-19T04:20:32Z","label":{"name":"area/docker","color":"ede978"},"performed_via_github_app":null},{"id":7017253448,"node_id":"LE_lADOCB5Jx85OBRUCzwAAAAGiQspI","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/7017253448","actor":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-07-19T04:20:33Z","label":{"name":"area/models","color":"48eabc"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1188623503","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1188623503","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1188623503,"node_id":"IC_kwDOCB5Jx85G2PSP","user":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"created_at":"2022-07-19T05:44:05Z","updated_at":"2022-07-19T06:21:49Z","author_association":"MEMBER","body":"@tsungjung411 I was able to reproduce the issue. I think the cause is `mlflow.sklearn.autolog` patches `accuracy_score`.\r\n\r\nCode I used:\r\n\r\n```dockerfile\r\nFROM python:3.9\r\n\r\nRUN pip install mlflow==1.27.0 scikit-learn auto-sklearn\r\nCOPY . .\r\nRUN python a.py\r\n```\r\n\r\n```python\r\nimport mlflow\r\n\r\nmlflow.autolog()\r\n\r\nfrom sklearn.datasets import load_iris\r\nfrom sklearn.model_selection import train_test_split\r\nfrom sklearn.ensemble import RandomForestClassifier\r\nfrom autosklearn.classification import AutoSklearnClassifier\r\n\r\nX, y = load_iris(return_X_y=True)\r\ntrain_X, test_X, train_y, test_y = train_test_split(X, y)\r\n\r\n# training\r\n# model = RandomForestClassifier() # pass\r\nmodel = AutoSklearnClassifier(  # failed\r\n    memory_limit=1024 * 12,  # (in MB) (default: 3072 MB)\r\n    time_left_for_this_task=30,  # 60 sec.\r\n    per_run_time_limit=3,\r\n)  # 15 sec.\r\nmodel.fit(train_X, train_y)\r\n\r\n# inference\r\nprint(\"score:\", model.score(test_X, test_y))\r\n\r\n# save the model to the local disk\r\nimport pickle\r\n\r\nwith open(\"model.pkl\", \"wb\") as f:\r\n    pickle.dump(model, f)\r\nprint(\"Model saved successfully\")\r\n\r\n```\r\n\r\n```\r\ndocker build .\r\n```","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1188623503/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false}},{"id":7017563856,"node_id":"MEE_lADOCB5Jx85OBRUCzwAAAAGiR4bQ","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/7017563856","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-07-19T05:44:15Z","performed_via_github_app":null},{"id":7017563860,"node_id":"SE_lADOCB5Jx85OBRUCzwAAAAGiR4bU","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/7017563860","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-07-19T05:44:15Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1188630676","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1188630676","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1188630676,"node_id":"IC_kwDOCB5Jx85G2RCU","user":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"created_at":"2022-07-19T05:56:52Z","updated_at":"2022-07-19T05:56:52Z","author_association":"MEMBER","body":"Checking what happens if we don't patch the sklearn's metric functions.","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1188630676/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1188630730","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1188630730","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1188630730,"node_id":"IC_kwDOCB5Jx85G2RDK","user":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"created_at":"2022-07-19T05:56:59Z","updated_at":"2022-07-19T13:51:55Z","author_association":"MEMBER","body":"```diff\r\ndiff --git a/mlflow/sklearn/__init__.py b/mlflow/sklearn/__init__.py\r\nindex da1fd1d3b..497b0f2cc 100644\r\n--- a/mlflow/sklearn/__init__.py\r\n+++ b/mlflow/sklearn/__init__.py\r\n@@ -1697,12 +1697,14 @@ def _autolog(\r\n \r\n     if log_post_training_metrics:\r\n         for metric_name in _get_metric_name_list():\r\n-            safe_patch(\r\n-                flavor_name, sklearn.metrics, metric_name, patched_metric_api, manage_run=False\r\n-            )\r\n+            pass\r\n+            # safe_patch(\r\n+            #     flavor_name, sklearn.metrics, metric_name, patched_metric_api, manage_run=False\r\n+            # )\r\n \r\n         for scorer in sklearn.metrics.SCORERS.values():\r\n-            safe_patch(flavor_name, scorer, \"_score_func\", patched_metric_api, manage_run=False)\r\n+            pass\r\n+            # safe_patch(flavor_name, scorer, \"_score_func\", patched_metric_api, manage_run=False)\r\n \r\n     def patched_fn_with_autolog_disabled(original, *args, **kwargs):\r\n         with disable_autologging():\r\n```\r\n\r\nresults in:\r\n\r\n```\r\nStep 5/5 : RUN python a.py\r\n ---> Running in 17c4a472847f\r\n2022/07/19 05:54:59 INFO mlflow.tracking.fluent: Autologging successfully enabled for sklearn.\r\n2022/07/19 05:55:02 INFO mlflow.utils.autologging_utils: Created MLflow autologging run with ID 'ddcb74946a5c488996b3bd6f43b03235', which will track hyperparameters, performance metrics, model artifacts, and lineage information for the current sklearn workflow\r\n2022/07/19 05:55:02 WARNING mlflow.sklearn: Training metrics will not be recorded because training labels were not specified. To automatically record training metrics, provide training labels as inputs to the model training function.\r\n2022/07/19 05:55:02 WARNING mlflow.sklearn: Failed to infer model signature: 'StandardScalerComponent' object has no attribute 'predict'\r\n/usr/local/lib/python3.9/site-packages/autosklearn/metalearning/metalearning/meta_base.py:68: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.\r\n  self.metafeatures = self.metafeatures.append(metafeatures)\r\n/usr/local/lib/python3.9/site-packages/autosklearn/metalearning/metalearning/meta_base.py:72: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.\r\n  self.algorithm_runs[metric].append(runs)\r\n2022/07/19 05:55:04 INFO mlflow.utils.autologging_utils: Created MLflow autologging run with ID 'cadf072bda65493794fda12fdced6f06', which will track hyperparameters, performance metrics, model artifacts, and lineage information for the current sklearn workflow\r\n2022/07/19 05:55:04 WARNING mlflow.sklearn: Training metrics will not be recorded because training labels were not specified. To automatically record training metrics, provide training labels as inputs to the model training function.\r\n2022/07/19 05:55:04 WARNING mlflow.sklearn: Failed to infer model signature: the trained model does not specify a `predict` function, which is required in order to infer the signature\r\nscore: 1.0\r\nModel saved successfully\r\nRemoving intermediate container 17c4a472847f\r\n```\r\n\r\nThe root cause is patching.","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1188630730/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1188636429","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1188636429","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1188636429,"node_id":"IC_kwDOCB5Jx85G2ScN","user":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"created_at":"2022-07-19T06:06:57Z","updated_at":"2022-07-19T06:06:57Z","author_association":"MEMBER","body":"@tsungjung411 `mlflow.sklearn.autolog(log_post_training_metrics=False)` can prevent the issue.","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1188636429/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false}},{"id":7017662095,"node_id":"MEE_lADOCB5Jx85OBRUCzwAAAAGiSQaP","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/7017662095","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-07-19T06:06:57Z","performed_via_github_app":null},{"id":7017662100,"node_id":"SE_lADOCB5Jx85OBRUCzwAAAAGiSQaU","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/7017662100","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-07-19T06:06:57Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189738733","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1189738733","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1189738733,"node_id":"IC_kwDOCB5Jx85G6fjt","user":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"created_at":"2022-07-20T02:32:07Z","updated_at":"2022-07-20T03:00:32Z","author_association":"NONE","body":"The solution is not acceptable. \r\nWe still need the post training metrics, and there must be something wrong in mlflow.\r\n\r\n## pickle a model: pass\r\n```python\r\nimport mlflow\r\n\r\n#mlflow.autolog() # failed\r\n\r\nfrom sklearn.datasets import load_iris\r\nfrom sklearn.model_selection import train_test_split\r\nfrom sklearn.ensemble import RandomForestClassifier\r\nfrom autosklearn.classification import AutoSklearnClassifier\r\n\r\nmlflow.autolog() # pass\r\n\r\nX, y = load_iris(return_X_y=True)\r\ntrain_X, test_X, train_y, test_y = train_test_split(X, y)\r\n\r\n# training\r\n# model = RandomForestClassifier() # pass\r\nmodel = AutoSklearnClassifier(   # failed\r\n    memory_limit=1024 * 12,      # (in MB) (default: 3072 MB)\r\n    time_left_for_this_task=60,  # 60 sec.\r\n    per_run_time_limit=15,       # 15 sec.\r\n)  # 15 sec.\r\nmodel.fit(train_X, train_y)\r\n\r\n# inference\r\nprint(\"score:\", model.score(test_X, test_y))\r\n\r\n# save the model to the local disk\r\nimport pickle\r\n\r\nwith open(\"model.pkl\", \"wb\") as f:\r\n    pickle.dump(model, f)\r\nprint(\"Model saved successfully\")\r\n```\r\n\r\n## pickle a model: failed\r\n```python\r\nimport mlflow\r\n\r\nmlflow.autolog() # failed\r\n\r\nfrom sklearn.datasets import load_iris\r\nfrom sklearn.model_selection import train_test_split\r\nfrom sklearn.ensemble import RandomForestClassifier\r\nfrom autosklearn.classification import AutoSklearnClassifier\r\n\r\n#mlflow.autolog() # pass\r\n\r\nX, y = load_iris(return_X_y=True)\r\ntrain_X, test_X, train_y, test_y = train_test_split(X, y)\r\n\r\n# training\r\n# model = RandomForestClassifier() # pass\r\nmodel = AutoSklearnClassifier(   # failed\r\n    memory_limit=1024 * 12,      # (in MB) (default: 3072 MB)\r\n    time_left_for_this_task=60,  # 60 sec.\r\n    per_run_time_limit=15,       # 15 sec.\r\n)  # 15 sec.\r\nmodel.fit(train_X, train_y)\r\n\r\n# inference\r\nprint(\"score:\", model.score(test_X, test_y))\r\n\r\n# save the model to the local disk\r\nimport pickle\r\n\r\nwith open(\"model.pkl\", \"wb\") as f:\r\n    pickle.dump(model, f)\r\nprint(\"Model saved successfully\")\r\n```\r\n\r\n## difference\r\nThe difference is the order of `mlflow.autolog()` and import-AutoSklearnClassifier statement.\r\n- pass\r\n  ```python\r\n  ...\r\n  from autosklearn.classification import AutoSklearnClassifier\r\n  mlflow.autolog() # pass\r\n  ...\r\n  ```\r\n- failed\r\n  ```python\r\n  ...\r\n  mlflow.autolog() # failed\r\n  from autosklearn.classification import AutoSklearnClassifier\r\n  ...\r\n  ```","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189738733/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189747402","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1189747402","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1189747402,"node_id":"IC_kwDOCB5Jx85G6hrK","user":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"created_at":"2022-07-20T02:50:20Z","updated_at":"2022-07-20T02:50:26Z","author_association":"MEMBER","body":"@tsungjung411 What do `failed` and `pass` mean?","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189747402/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false}},{"id":7025515042,"node_id":"MEE_lADOCB5Jx85OBRUCzwAAAAGiwNoi","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/7025515042","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-07-20T02:50:21Z","performed_via_github_app":null},{"id":7025515045,"node_id":"SE_lADOCB5Jx85OBRUCzwAAAAGiwNol","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/7025515045","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-07-20T02:50:21Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189749152","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1189749152","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1189749152,"node_id":"IC_kwDOCB5Jx85G6iGg","user":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"created_at":"2022-07-20T02:54:30Z","updated_at":"2022-07-20T02:55:33Z","author_association":"NONE","body":"**failed**: the program will be stopped due to an error, and cannot output a model to the local disk\r\n```\r\nTraceback (most recent call last):\r\n  File \".../ml_sklearn/doc/examples/mlflow/failed.py\", line 31, in <module>\r\n    pickle.dump(model, f)\r\n_pickle.PicklingError: Can't pickle <function accuracy_score at 0x7fe3863f8310>: it's not the same object as sklearn.metrics._classification.accuracy_score\r\n```\r\n\r\n**pass**: the program can output a model to the local disk successfully","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189749152/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189764459","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1189764459","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1189764459,"node_id":"IC_kwDOCB5Jx85G6l1r","user":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"created_at":"2022-07-20T03:14:23Z","updated_at":"2022-07-20T03:24:32Z","author_association":"MEMBER","body":"~Executing `mlflow.autolog()` after the import statements didn't work. I got `_pickle.PicklingError: Can't pickle <function accuracy_score at 0x7fe3863f8310>: it's not the same object as sklearn.metrics._classification.accuracy_score`.~\r\n\r\n\r\nNever mind.","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189764459/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189765363","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1189765363","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1189765363,"node_id":"IC_kwDOCB5Jx85G6mDz","user":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"created_at":"2022-07-20T03:16:26Z","updated_at":"2022-07-20T03:16:35Z","author_association":"MEMBER","body":"btw scikit-learn autologging may not work properly with `AutoSklearnClassifier`.","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189765363/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189776300","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1189776300","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1189776300,"node_id":"IC_kwDOCB5Jx85G6ous","user":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"created_at":"2022-07-20T03:29:47Z","updated_at":"2022-07-20T03:29:47Z","author_association":"NONE","body":"`AutoSklearnClassifier` and `AutoSklearnRegressor` are ensemble classes that combine multiple scikit-learn (sklearn) models into one model. Auto-sklearn just uses scikit-learn packages.","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189776300/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189782566","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1189782566","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1189782566,"node_id":"IC_kwDOCB5Jx85G6qQm","user":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"created_at":"2022-07-20T03:41:03Z","updated_at":"2022-07-20T03:49:15Z","author_association":"NONE","body":"I have found an easy way to reproduce this case without the auto-sklearn package.\r\n\r\n```python\r\nimport mlflow\r\n\r\nmlflow.autolog() # failed\r\n\r\nfrom sklearn.datasets import load_iris\r\nfrom sklearn.model_selection import train_test_split\r\nfrom sklearn.ensemble import RandomForestClassifier\r\nfrom sklearn.metrics import accuracy_score\r\n\r\nclass MyRF(RandomForestClassifier):\r\n    def __init__(self):\r\n        super(MyRF, self).__init__()\r\n        self.accu = accuracy_score\r\n\r\n# mlflow.autolog() # work\r\n\r\nX, y = load_iris(return_X_y=True)\r\ntrain_X, test_X, train_y, test_y = train_test_split(X, y)\r\n\r\n# training\r\nmodel = MyRF()\r\nmodel.fit(train_X, train_y)\r\n\r\n# inference\r\nprint(\"score:\", model.score(test_X, test_y))\r\n\r\n# save the model to the local disk\r\nimport pickle\r\n\r\nwith open(\"model.pkl\", \"wb\") as f:\r\n    pickle.dump(model, f)\r\nprint(\"Model saved successfully\")\r\n```\r\n![image](https://user-images.githubusercontent.com/14820019/179890803-e383bc5c-9188-4b43-b658-36b58e84f3af.png)\r\n\r\n- The key point is `self.accu = accuracy_score`.\r\n- Without the statement, the model can be saved successfully.\r\n  <br>![image](https://user-images.githubusercontent.com/14820019/179891762-2faa6ee0-0667-4bb1-b79b-c004b63b00e5.png)\r\n","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189782566/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189784896","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1189784896","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1189784896,"node_id":"IC_kwDOCB5Jx85G6q1A","user":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"created_at":"2022-07-20T03:43:09Z","updated_at":"2022-07-20T03:44:17Z","author_association":"MEMBER","body":"The code you attached worked.\r\n\r\n```bash\r\n> cat a.py\r\nimport mlflow\r\n\r\n# mlflow.autolog() # failed\r\n\r\nfrom sklearn.datasets import load_iris\r\nfrom sklearn.model_selection import train_test_split\r\nfrom sklearn.ensemble import RandomForestClassifier\r\nfrom sklearn.metrics import accuracy_score\r\n\r\n\r\nclass MyRF(RandomForestClassifier):\r\n    def __init__(self):\r\n        super(MyRF, self).__init__()\r\n        self.accu = accuracy_score\r\n\r\n\r\nmlflow.autolog()\r\n\r\nX, y = load_iris(return_X_y=True)\r\ntrain_X, test_X, train_y, test_y = train_test_split(X, y)\r\n\r\n# training\r\nmodel = MyRF()\r\nmodel.fit(train_X, train_y)\r\n\r\n# inference\r\nprint(\"score:\", model.score(test_X, test_y))\r\n\r\n# save the model to the local disk\r\nimport pickle\r\n\r\nwith open(\"model.pkl\", \"wb\") as f:\r\n    pickle.dump(model, f)\r\nprint(\"Model saved successfully\")\r\n\r\n> python a.py\r\n2022/07/20 12:43:41 INFO mlflow.tracking.fluent: Autologging successfully enabled for sklearn.\r\n2022/07/20 12:43:41 INFO mlflow.tracking.fluent: Autologging successfully enabled for pyspark.\r\n2022/07/20 12:43:41 INFO mlflow.pyspark.ml: No SparkSession detected. Autologging will log pyspark.ml models contained in the default allowlist. To specify a custom allowlist, initialize a SparkSession prior to calling mlflow.pyspark.ml.autolog() and specify the path to your allowlist file via the spark.mlflow.pysparkml.autolog.logModelAllowlistFile conf.\r\n2022/07/20 12:43:41 INFO mlflow.tracking.fluent: Autologging successfully enabled for pyspark.ml.\r\n2022/07/20 12:43:41 INFO mlflow.utils.autologging_utils: Created MLflow autologging run with ID '0f2423c49aa243969d2f354781c09765', which will track hyperparameters, performance metrics, model artifacts, and lineage information for the current sklearn workflow\r\nscore: 0.9210526315789473\r\nModel saved successfully\r\n```","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189784896/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189798374","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1189798374","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1189798374,"node_id":"IC_kwDOCB5Jx85G6uHm","user":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"created_at":"2022-07-20T03:58:39Z","updated_at":"2022-07-20T03:58:53Z","author_association":"NONE","body":"Sorry, I forgot to restart the kernerl from Notebook.\r\n\r\nPlease have a trial again. `mlflow.autolog()` precedes `import accuracy_score`.\r\n```python\r\nimport mlflow\r\n\r\nfrom sklearn.datasets import load_iris\r\nfrom sklearn.model_selection import train_test_split\r\nfrom sklearn.ensemble import RandomForestClassifier\r\n\r\nmlflow.autolog()  # failed\r\nfrom sklearn.metrics import accuracy_score\r\n#mlflow.autolog() # here can work\r\n\r\nclass MyRF(RandomForestClassifier):\r\n    def __init__(self):\r\n        super(MyRF, self).__init__()\r\n        self.accu = accuracy_score\r\n\r\n\r\nX, y = load_iris(return_X_y=True)\r\ntrain_X, test_X, train_y, test_y = train_test_split(X, y)\r\n\r\n# training\r\nmodel = MyRF()\r\nmodel.fit(train_X, train_y)\r\n\r\n# inference\r\nprint(\"score:\", model.score(test_X, test_y))\r\n\r\n# save the model to the local disk\r\nimport pickle\r\n\r\nwith open(\"model.pkl\", \"wb\") as f:\r\n    pickle.dump(model, f)\r\nprint(\"Model saved successfully\")\r\n```\r\n![image](https://user-images.githubusercontent.com/14820019/179893704-593156d8-f35b-4b1f-abec-5ded852c65fc.png)\r\n","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189798374/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189810225","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1189810225","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1189810225,"node_id":"IC_kwDOCB5Jx85G6xAx","user":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"created_at":"2022-07-20T04:20:11Z","updated_at":"2022-07-20T04:20:11Z","author_association":"NONE","body":"Regression metrics have the same situation.\r\n\r\n```python\r\nimport mlflow\r\nfrom sklearn.ensemble import RandomForestRegressor\r\n\r\nmlflow.autolog()  # failed\r\nfrom sklearn.metrics import r2_score\r\n#mlflow.autolog()  # here can work\r\n\r\n\r\nclass MyRF(RandomForestRegressor):\r\n    def __init__(self):\r\n        super(MyRF, self).__init__()\r\n        self.r2 = r2_score\r\n\r\n# training\r\nmodel = MyRF()\r\nmodel.fit(X=[[1], [2], [3]], y=[2, 4, 6])\r\n\r\n\r\n# save the model to the local disk\r\nimport pickle\r\n\r\nwith open(\"model.pkl\", \"wb\") as f:\r\n    pickle.dump(model, f)\r\nprint(\"Model saved successfully\")\r\n```\r\n\r\n![image](https://user-images.githubusercontent.com/14820019/179896048-0e522176-ada8-466c-80f0-266d3dd67791.png)\r\n","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189810225/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189810441","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1189810441","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1189810441,"node_id":"IC_kwDOCB5Jx85G6xEJ","user":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"created_at":"2022-07-20T04:20:36Z","updated_at":"2022-07-20T04:26:02Z","author_association":"MEMBER","body":"In the successful case, `accuracy_score` is the original `accuracy_score` so works.\r\nIn the failed case, `accuracy_score` is the patched `accuracy_score` so doesn't work.\r\n\r\n```python\r\nimport mlflow\r\n\r\n\r\n# mlflow.autolog()\r\n\r\nfrom sklearn.metrics import accuracy_score\r\nimport sklearn.metrics\r\n\r\nprint(\"Before\")\r\nprint(\r\n    accuracy_score,\r\n    sklearn.metrics.accuracy_score,\r\n    sklearn.metrics._classification.accuracy_score,\r\n)\r\n\r\nmlflow.autolog()\r\n\r\nprint(\"After\")\r\nprint(\r\n    accuracy_score,\r\n    sklearn.metrics.accuracy_score,\r\n    sklearn.metrics._classification.accuracy_score,\r\n)\r\n```\r\n\r\nOutput:\r\n\r\n```\r\n<function accuracy_score at 0x7f2bcf982b00> <function accuracy_score at 0x7f2bcf982b00> <function accuracy_score at 0x7f2bcf982b00>\r\n2022/07/20 13:25:28 INFO mlflow.tracking.fluent: Autologging successfully enabled for sklearn.\r\n2022/07/20 13:25:28 INFO mlflow.tracking.fluent: Autologging successfully enabled for pyspark.\r\n2022/07/20 13:25:28 INFO mlflow.pyspark.ml: No SparkSession detected. Autologging will log pyspark.ml models contained in the default allowlist. To specify a custom allowlist, initialize a SparkSession prior to calling mlflow.pyspark.ml.autolog() and specify the path to your allowlist file via the spark.mlflow.pysparkml.autolog.logModelAllowlistFile conf.\r\n2022/07/20 13:25:28 INFO mlflow.tracking.fluent: Autologging successfully enabled for pyspark.ml.\r\nAfter\r\n<function accuracy_score at 0x7f2bcf982b00> <function accuracy_score at 0x7f2bc79aec20> <function accuracy_score at 0x7f2bcf982b00>\r\n```","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189810441/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189842545","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1189842545","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1189842545,"node_id":"IC_kwDOCB5Jx85G645x","user":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"created_at":"2022-07-20T05:24:00Z","updated_at":"2022-07-20T05:24:00Z","author_association":"NONE","body":"Some of Scikit-learn's other APIs are also patched, such as `fit`, `score`, but they can still be pickled.\r\n\r\n## show patched hashes before and after `mlflow.autolog()`.\r\n```python\r\nimport mlflow\r\nfrom sklearn.ensemble import RandomForestRegressor\r\n\r\nprint(RandomForestRegressor.fit)\r\nprint(RandomForestRegressor.score)\r\nmlflow.autolog()\r\nprint(RandomForestRegressor.fit)\r\nprint(RandomForestRegressor.score)\r\n```\r\n![image](https://user-images.githubusercontent.com/14820019/179901927-69987966-83be-42c7-97e2-23111b7a5d30.png)\r\n\r\n<br>\r\n\r\n## save a patched object to Python pickle\r\n```python\r\nimport mlflow\r\n\r\nmlflow.autolog()  # can work\r\nfrom sklearn.ensemble import RandomForestRegressor\r\n#mlflow.autolog()  # can work\r\n\r\n# training\r\nmodel = RandomForestRegressor()\r\nmodel.fit(X=[[1], [3], [5]], y=[2, 6, 10])\r\nprint(model.score(X=[[2], [4]], y=[4, 8]))\r\n\r\n# save the model to the local disk\r\nimport pickle\r\n\r\nwith open(\"model.pkl\", \"wb\") as f:\r\n    pickle.dump(model, f)\r\nprint(\"Model saved successfully\")\r\n```\r\n![image](https://user-images.githubusercontent.com/14820019/179902387-c00046d5-511f-4b24-8865-026dcda254c6.png)\r\n","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189842545/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189843949","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1189843949","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1189843949,"node_id":"IC_kwDOCB5Jx85G65Pt","user":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"created_at":"2022-07-20T05:26:53Z","updated_at":"2022-07-20T05:41:44Z","author_association":"MEMBER","body":"`fit` is an instance method, but `accuracy_score` is a function. I'm not sure why pickle complains.","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189843949/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189892596","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1189892596","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1189892596,"node_id":"IC_kwDOCB5Jx85G7FH0","user":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"created_at":"2022-07-20T06:45:50Z","updated_at":"2022-07-20T07:56:53Z","author_association":"NONE","body":"## Simulate the patching behavior of mlflow\r\n\r\n## code\r\n### `base.py`\r\n```python\r\ndef r2_score():\r\n    print('calling r2_score()')\r\n    return 1.0\r\n```\r\n\r\n### `utils.py`\r\n```python\r\nfrom base import r2_score\r\n```\r\n\r\n### `main.py`\r\n```python\r\nfrom functools import wraps\r\nimport utils\r\n\r\ndef patch(func):\r\n    @wraps(func)\r\n    def wrapper():\r\n        print('>>> [ENTER]')\r\n        score = func()\r\n        print('<<< [EXIT]')\r\n        return score\r\n    return wrapper\r\n\r\n# before patching\r\nprint('score: {} ({})'.format(\r\n    utils.r2_score(),\r\n    utils.r2_score.__hash__\r\n))\r\nprint('-' * 60)\r\n\r\n# patching\r\nsetattr(utils, \r\n        'r2_score', \r\n        patch(getattr(utils, 'r2_score')))\r\n\r\n# after patching\r\nprint('score: {} ({})'.format(\r\n    utils.r2_score(),\r\n    utils.r2_score.__hash__\r\n))\r\nprint('-' * 60)\r\n\r\n\r\nimport pickle\r\nwith open('r2.pkl', 'wb') as f:\r\n    pickle.dump(utils.r2_score, f)\r\n\r\nprint('save successfully')\r\n```\r\n\r\n<br>\r\n\r\n## run\r\n[cannot_pickle_model.zip](https://github.com/mlflow/mlflow/files/9147180/cannot_pickle_model.zip) (base.py + utils.py + main.py)\r\n\r\n```\r\n$ python main.py \r\ncalling r2_score()\r\nscore: 1.0 (<method-wrapper '__hash__' of function object at 0x7f0aaa403040>)\r\n------------------------------------------------------------\r\n>>> [ENTER]\r\ncalling r2_score()\r\n<<< [EXIT]\r\nscore: 1.0 (<method-wrapper '__hash__' of function object at 0x7f0aaa45af70>)\r\n------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/workspace/cannot_pickle/main.py\", line 35, in <module>\r\n    pickle.dump(utils.r2_score, f)\r\n_pickle.PicklingError: Can't pickle <function r2_score at 0x7f0aaa45af70>: it's not the same object as base.r2_score\r\n```\r\n\r\n<br>\r\n\r\nif without `@wraps(func)`, it will show another error:\r\n```\r\n------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/workspace/cannot_pickle/main.py\", line 34, in <module>\r\n    pickle.dump(utils.r2_score, f)\r\nAttributeError: Can't pickle local object 'patch.<locals>.wrapper'\r\n```","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1189892596/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1190263394","html_url":"https://github.com/mlflow/mlflow/issues/6268#issuecomment-1190263394","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/6268","id":1190263394,"node_id":"IC_kwDOCB5Jx85G8fpi","user":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"created_at":"2022-07-20T13:05:49Z","updated_at":"2022-07-20T13:05:49Z","author_association":"MEMBER","body":"@tsungjung411 Have you tried `cloudpickle`?","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/1190263394/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false}},{"id":7029204924,"node_id":"MEE_lADOCB5Jx85OBRUCzwAAAAGi-Se8","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/7029204924","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-07-20T13:05:50Z","performed_via_github_app":null},{"id":7029204929,"node_id":"SE_lADOCB5Jx85OBRUCzwAAAAGi-SfB","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/7029204929","actor":{"login":"tsungjung411","id":14820019,"node_id":"MDQ6VXNlcjE0ODIwMDE5","avatar_url":"https://avatars.githubusercontent.com/u/14820019?v=4","gravatar_id":"","url":"https://api.github.com/users/tsungjung411","html_url":"https://github.com/tsungjung411","followers_url":"https://api.github.com/users/tsungjung411/followers","following_url":"https://api.github.com/users/tsungjung411/following{/other_user}","gists_url":"https://api.github.com/users/tsungjung411/gists{/gist_id}","starred_url":"https://api.github.com/users/tsungjung411/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsungjung411/subscriptions","organizations_url":"https://api.github.com/users/tsungjung411/orgs","repos_url":"https://api.github.com/users/tsungjung411/repos","events_url":"https://api.github.com/users/tsungjung411/events{/privacy}","received_events_url":"https://api.github.com/users/tsungjung411/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-07-20T13:05:50Z","performed_via_github_app":null}]