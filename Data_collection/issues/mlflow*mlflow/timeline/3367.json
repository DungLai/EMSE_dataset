[{"id":3710548338,"node_id":"MDEyOkxhYmVsZWRFdmVudDM3MTA1NDgzMzg=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3710548338","actor":{"login":"NithyaMogane-TomTom","id":62301809,"node_id":"MDQ6VXNlcjYyMzAxODA5","avatar_url":"https://avatars.githubusercontent.com/u/62301809?v=4","gravatar_id":"","url":"https://api.github.com/users/NithyaMogane-TomTom","html_url":"https://github.com/NithyaMogane-TomTom","followers_url":"https://api.github.com/users/NithyaMogane-TomTom/followers","following_url":"https://api.github.com/users/NithyaMogane-TomTom/following{/other_user}","gists_url":"https://api.github.com/users/NithyaMogane-TomTom/gists{/gist_id}","starred_url":"https://api.github.com/users/NithyaMogane-TomTom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NithyaMogane-TomTom/subscriptions","organizations_url":"https://api.github.com/users/NithyaMogane-TomTom/orgs","repos_url":"https://api.github.com/users/NithyaMogane-TomTom/repos","events_url":"https://api.github.com/users/NithyaMogane-TomTom/events{/privacy}","received_events_url":"https://api.github.com/users/NithyaMogane-TomTom/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-08-31T15:58:28Z","label":{"name":"bug","color":"d73a4a"},"performed_via_github_app":null},{"id":3711091354,"node_id":"MDEyOkxhYmVsZWRFdmVudDM3MTEwOTEzNTQ=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3711091354","actor":{"login":"dmatrix","id":1117597,"node_id":"MDQ6VXNlcjExMTc1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1117597?v=4","gravatar_id":"","url":"https://api.github.com/users/dmatrix","html_url":"https://github.com/dmatrix","followers_url":"https://api.github.com/users/dmatrix/followers","following_url":"https://api.github.com/users/dmatrix/following{/other_user}","gists_url":"https://api.github.com/users/dmatrix/gists{/gist_id}","starred_url":"https://api.github.com/users/dmatrix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmatrix/subscriptions","organizations_url":"https://api.github.com/users/dmatrix/orgs","repos_url":"https://api.github.com/users/dmatrix/repos","events_url":"https://api.github.com/users/dmatrix/events{/privacy}","received_events_url":"https://api.github.com/users/dmatrix/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-08-31T18:26:21Z","label":{"name":"area/tracking","color":"48eabc"},"performed_via_github_app":null},{"id":3711091992,"node_id":"MDEyOkxhYmVsZWRFdmVudDM3MTEwOTE5OTI=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3711091992","actor":{"login":"dmatrix","id":1117597,"node_id":"MDQ6VXNlcjExMTc1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1117597?v=4","gravatar_id":"","url":"https://api.github.com/users/dmatrix","html_url":"https://github.com/dmatrix","followers_url":"https://api.github.com/users/dmatrix/followers","following_url":"https://api.github.com/users/dmatrix/following{/other_user}","gists_url":"https://api.github.com/users/dmatrix/gists{/gist_id}","starred_url":"https://api.github.com/users/dmatrix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmatrix/subscriptions","organizations_url":"https://api.github.com/users/dmatrix/orgs","repos_url":"https://api.github.com/users/dmatrix/repos","events_url":"https://api.github.com/users/dmatrix/events{/privacy}","received_events_url":"https://api.github.com/users/dmatrix/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-08-31T18:26:33Z","label":{"name":"area/model-registry","color":"48eabc"},"performed_via_github_app":null},{"id":3711093202,"node_id":"MDE0OlVubGFiZWxlZEV2ZW50MzcxMTA5MzIwMg==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3711093202","actor":{"login":"dmatrix","id":1117597,"node_id":"MDQ6VXNlcjExMTc1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1117597?v=4","gravatar_id":"","url":"https://api.github.com/users/dmatrix","html_url":"https://github.com/dmatrix","followers_url":"https://api.github.com/users/dmatrix/followers","following_url":"https://api.github.com/users/dmatrix/following{/other_user}","gists_url":"https://api.github.com/users/dmatrix/gists{/gist_id}","starred_url":"https://api.github.com/users/dmatrix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmatrix/subscriptions","organizations_url":"https://api.github.com/users/dmatrix/orgs","repos_url":"https://api.github.com/users/dmatrix/repos","events_url":"https://api.github.com/users/dmatrix/events{/privacy}","received_events_url":"https://api.github.com/users/dmatrix/received_events","type":"User","site_admin":false},"event":"unlabeled","commit_id":null,"commit_url":null,"created_at":"2020-08-31T18:26:55Z","label":{"name":"area/model-registry","color":"48eabc"},"performed_via_github_app":null},{"id":3711093204,"node_id":"MDEyOkxhYmVsZWRFdmVudDM3MTEwOTMyMDQ=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3711093204","actor":{"login":"dmatrix","id":1117597,"node_id":"MDQ6VXNlcjExMTc1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1117597?v=4","gravatar_id":"","url":"https://api.github.com/users/dmatrix","html_url":"https://github.com/dmatrix","followers_url":"https://api.github.com/users/dmatrix/followers","following_url":"https://api.github.com/users/dmatrix/following{/other_user}","gists_url":"https://api.github.com/users/dmatrix/gists{/gist_id}","starred_url":"https://api.github.com/users/dmatrix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmatrix/subscriptions","organizations_url":"https://api.github.com/users/dmatrix/orgs","repos_url":"https://api.github.com/users/dmatrix/repos","events_url":"https://api.github.com/users/dmatrix/events{/privacy}","received_events_url":"https://api.github.com/users/dmatrix/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-08-31T18:26:55Z","label":{"name":"area/models","color":"48eabc"},"performed_via_github_app":null},{"id":3730858985,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQzNzMwODU4OTg1","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3730858985","actor":{"login":"apurva-koti","id":51172624,"node_id":"MDQ6VXNlcjUxMTcyNjI0","avatar_url":"https://avatars.githubusercontent.com/u/51172624?v=4","gravatar_id":"","url":"https://api.github.com/users/apurva-koti","html_url":"https://github.com/apurva-koti","followers_url":"https://api.github.com/users/apurva-koti/followers","following_url":"https://api.github.com/users/apurva-koti/following{/other_user}","gists_url":"https://api.github.com/users/apurva-koti/gists{/gist_id}","starred_url":"https://api.github.com/users/apurva-koti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apurva-koti/subscriptions","organizations_url":"https://api.github.com/users/apurva-koti/orgs","repos_url":"https://api.github.com/users/apurva-koti/repos","events_url":"https://api.github.com/users/apurva-koti/events{/privacy}","received_events_url":"https://api.github.com/users/apurva-koti/received_events","type":"User","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2020-09-04T17:37:48Z","assignee":{"login":"apurva-koti","id":51172624,"node_id":"MDQ6VXNlcjUxMTcyNjI0","avatar_url":"https://avatars.githubusercontent.com/u/51172624?v=4","gravatar_id":"","url":"https://api.github.com/users/apurva-koti","html_url":"https://github.com/apurva-koti","followers_url":"https://api.github.com/users/apurva-koti/followers","following_url":"https://api.github.com/users/apurva-koti/following{/other_user}","gists_url":"https://api.github.com/users/apurva-koti/gists{/gist_id}","starred_url":"https://api.github.com/users/apurva-koti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apurva-koti/subscriptions","organizations_url":"https://api.github.com/users/apurva-koti/orgs","repos_url":"https://api.github.com/users/apurva-koti/repos","events_url":"https://api.github.com/users/apurva-koti/events{/privacy}","received_events_url":"https://api.github.com/users/apurva-koti/received_events","type":"User","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/687289857","html_url":"https://github.com/mlflow/mlflow/issues/3367#issuecomment-687289857","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/3367","id":687289857,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NzI4OTg1Nw==","user":{"login":"apurva-koti","id":51172624,"node_id":"MDQ6VXNlcjUxMTcyNjI0","avatar_url":"https://avatars.githubusercontent.com/u/51172624?v=4","gravatar_id":"","url":"https://api.github.com/users/apurva-koti","html_url":"https://github.com/apurva-koti","followers_url":"https://api.github.com/users/apurva-koti/followers","following_url":"https://api.github.com/users/apurva-koti/following{/other_user}","gists_url":"https://api.github.com/users/apurva-koti/gists{/gist_id}","starred_url":"https://api.github.com/users/apurva-koti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apurva-koti/subscriptions","organizations_url":"https://api.github.com/users/apurva-koti/orgs","repos_url":"https://api.github.com/users/apurva-koti/repos","events_url":"https://api.github.com/users/apurva-koti/events{/privacy}","received_events_url":"https://api.github.com/users/apurva-koti/received_events","type":"User","site_admin":false},"created_at":"2020-09-04T17:41:38Z","updated_at":"2020-09-04T17:41:38Z","author_association":"COLLABORATOR","body":"Hi @greenorblack! Thanks for filing. This sounds like a great improvement.\r\nYou would need to patch the `train_loop` and `evaluate_continuously` functions you mentioned in `tensorflow.py` and set those functions to point to your patched versions. [Here is an example.](https://github.com/mlflow/mlflow/blob/5cf346fec70d1a680915c4760a809386b1a402f2/mlflow/tensorflow.py#L856) Let me know if you need any more information/context!","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/687289857/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"apurva-koti","id":51172624,"node_id":"MDQ6VXNlcjUxMTcyNjI0","avatar_url":"https://avatars.githubusercontent.com/u/51172624?v=4","gravatar_id":"","url":"https://api.github.com/users/apurva-koti","html_url":"https://github.com/apurva-koti","followers_url":"https://api.github.com/users/apurva-koti/followers","following_url":"https://api.github.com/users/apurva-koti/following{/other_user}","gists_url":"https://api.github.com/users/apurva-koti/gists{/gist_id}","starred_url":"https://api.github.com/users/apurva-koti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apurva-koti/subscriptions","organizations_url":"https://api.github.com/users/apurva-koti/orgs","repos_url":"https://api.github.com/users/apurva-koti/repos","events_url":"https://api.github.com/users/apurva-koti/events{/privacy}","received_events_url":"https://api.github.com/users/apurva-koti/received_events","type":"User","site_admin":false}},{"id":3730871991,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzczMDg3MTk5MQ==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3730871991","actor":{"login":"NithyaMogane-TomTom","id":62301809,"node_id":"MDQ6VXNlcjYyMzAxODA5","avatar_url":"https://avatars.githubusercontent.com/u/62301809?v=4","gravatar_id":"","url":"https://api.github.com/users/NithyaMogane-TomTom","html_url":"https://github.com/NithyaMogane-TomTom","followers_url":"https://api.github.com/users/NithyaMogane-TomTom/followers","following_url":"https://api.github.com/users/NithyaMogane-TomTom/following{/other_user}","gists_url":"https://api.github.com/users/NithyaMogane-TomTom/gists{/gist_id}","starred_url":"https://api.github.com/users/NithyaMogane-TomTom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NithyaMogane-TomTom/subscriptions","organizations_url":"https://api.github.com/users/NithyaMogane-TomTom/orgs","repos_url":"https://api.github.com/users/NithyaMogane-TomTom/repos","events_url":"https://api.github.com/users/NithyaMogane-TomTom/events{/privacy}","received_events_url":"https://api.github.com/users/NithyaMogane-TomTom/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-09-04T17:41:38Z","performed_via_github_app":null},{"id":3730871995,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM3MzA4NzE5OTU=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3730871995","actor":{"login":"NithyaMogane-TomTom","id":62301809,"node_id":"MDQ6VXNlcjYyMzAxODA5","avatar_url":"https://avatars.githubusercontent.com/u/62301809?v=4","gravatar_id":"","url":"https://api.github.com/users/NithyaMogane-TomTom","html_url":"https://github.com/NithyaMogane-TomTom","followers_url":"https://api.github.com/users/NithyaMogane-TomTom/followers","following_url":"https://api.github.com/users/NithyaMogane-TomTom/following{/other_user}","gists_url":"https://api.github.com/users/NithyaMogane-TomTom/gists{/gist_id}","starred_url":"https://api.github.com/users/NithyaMogane-TomTom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NithyaMogane-TomTom/subscriptions","organizations_url":"https://api.github.com/users/NithyaMogane-TomTom/orgs","repos_url":"https://api.github.com/users/NithyaMogane-TomTom/repos","events_url":"https://api.github.com/users/NithyaMogane-TomTom/events{/privacy}","received_events_url":"https://api.github.com/users/NithyaMogane-TomTom/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-09-04T17:41:38Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/688728329","html_url":"https://github.com/mlflow/mlflow/issues/3367#issuecomment-688728329","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/3367","id":688728329,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODcyODMyOQ==","user":{"login":"NithyaMogane-TomTom","id":62301809,"node_id":"MDQ6VXNlcjYyMzAxODA5","avatar_url":"https://avatars.githubusercontent.com/u/62301809?v=4","gravatar_id":"","url":"https://api.github.com/users/NithyaMogane-TomTom","html_url":"https://github.com/NithyaMogane-TomTom","followers_url":"https://api.github.com/users/NithyaMogane-TomTom/followers","following_url":"https://api.github.com/users/NithyaMogane-TomTom/following{/other_user}","gists_url":"https://api.github.com/users/NithyaMogane-TomTom/gists{/gist_id}","starred_url":"https://api.github.com/users/NithyaMogane-TomTom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NithyaMogane-TomTom/subscriptions","organizations_url":"https://api.github.com/users/NithyaMogane-TomTom/orgs","repos_url":"https://api.github.com/users/NithyaMogane-TomTom/repos","events_url":"https://api.github.com/users/NithyaMogane-TomTom/events{/privacy}","received_events_url":"https://api.github.com/users/NithyaMogane-TomTom/received_events","type":"User","site_admin":false},"created_at":"2020-09-08T09:00:49Z","updated_at":"2020-09-08T09:00:49Z","author_association":"NONE","body":"HI @apurva-koti , thanks for getting back ! \r\nSo, I did patch `train_loop` function to print train_steps as opposed to steps/max_steps in the previous. It works. However, there are no metrics dict created in `train_loop`, so there is nothing of significance to log here. \r\nThe main issue for me is in `eval_continuously`.\r\n\r\n[`Eval_continuously`](https://github.com/tensorflow/models/blob/master/research/object_detection/model_lib_v2.py#L861), calls [`eager_eval_loop`](https://github.com/tensorflow/models/blob/master/research/object_detection/model_lib_v2.py#L667). The latter is the one that returns a dict of metrics. Hence, I patched that.  \r\n\r\n    @gorilla.patch(model_lib_v2)\r\n    def eager_eval_loop(*args, **kwargs):\r\n        with _manage_active_run():\r\n            original = gorilla.get_original_attribute(model_lib_v2, 'eager_eval_loop')\r\n            result = original(*args, **kwargs)\r\n            print(\"\\n Contents of eval dict: \\n\")\r\n            print(result)\r\n\r\n\r\nBut, `eager_eval_loop` constantly waits for a new checkpoint and doesn't exit per se. Which means, I don't actually get the eval metrics dict returned. I'm having trouble figuring out the how to work around this without making significant changes in the functions defined in model_lib_v2.","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/688728329/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"NithyaMogane-TomTom","id":62301809,"node_id":"MDQ6VXNlcjYyMzAxODA5","avatar_url":"https://avatars.githubusercontent.com/u/62301809?v=4","gravatar_id":"","url":"https://api.github.com/users/NithyaMogane-TomTom","html_url":"https://github.com/NithyaMogane-TomTom","followers_url":"https://api.github.com/users/NithyaMogane-TomTom/followers","following_url":"https://api.github.com/users/NithyaMogane-TomTom/following{/other_user}","gists_url":"https://api.github.com/users/NithyaMogane-TomTom/gists{/gist_id}","starred_url":"https://api.github.com/users/NithyaMogane-TomTom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NithyaMogane-TomTom/subscriptions","organizations_url":"https://api.github.com/users/NithyaMogane-TomTom/orgs","repos_url":"https://api.github.com/users/NithyaMogane-TomTom/repos","events_url":"https://api.github.com/users/NithyaMogane-TomTom/events{/privacy}","received_events_url":"https://api.github.com/users/NithyaMogane-TomTom/received_events","type":"User","site_admin":false}},{"id":3739866174,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzczOTg2NjE3NA==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3739866174","actor":{"login":"apurva-koti","id":51172624,"node_id":"MDQ6VXNlcjUxMTcyNjI0","avatar_url":"https://avatars.githubusercontent.com/u/51172624?v=4","gravatar_id":"","url":"https://api.github.com/users/apurva-koti","html_url":"https://github.com/apurva-koti","followers_url":"https://api.github.com/users/apurva-koti/followers","following_url":"https://api.github.com/users/apurva-koti/following{/other_user}","gists_url":"https://api.github.com/users/apurva-koti/gists{/gist_id}","starred_url":"https://api.github.com/users/apurva-koti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apurva-koti/subscriptions","organizations_url":"https://api.github.com/users/apurva-koti/orgs","repos_url":"https://api.github.com/users/apurva-koti/repos","events_url":"https://api.github.com/users/apurva-koti/events{/privacy}","received_events_url":"https://api.github.com/users/apurva-koti/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-09-08T09:00:49Z","performed_via_github_app":null},{"id":3739866176,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM3Mzk4NjYxNzY=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3739866176","actor":{"login":"apurva-koti","id":51172624,"node_id":"MDQ6VXNlcjUxMTcyNjI0","avatar_url":"https://avatars.githubusercontent.com/u/51172624?v=4","gravatar_id":"","url":"https://api.github.com/users/apurva-koti","html_url":"https://github.com/apurva-koti","followers_url":"https://api.github.com/users/apurva-koti/followers","following_url":"https://api.github.com/users/apurva-koti/following{/other_user}","gists_url":"https://api.github.com/users/apurva-koti/gists{/gist_id}","starred_url":"https://api.github.com/users/apurva-koti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apurva-koti/subscriptions","organizations_url":"https://api.github.com/users/apurva-koti/orgs","repos_url":"https://api.github.com/users/apurva-koti/repos","events_url":"https://api.github.com/users/apurva-koti/events{/privacy}","received_events_url":"https://api.github.com/users/apurva-koti/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-09-08T09:00:49Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/700293452","html_url":"https://github.com/mlflow/mlflow/issues/3367#issuecomment-700293452","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/3367","id":700293452,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMDI5MzQ1Mg==","user":{"login":"apurva-koti","id":51172624,"node_id":"MDQ6VXNlcjUxMTcyNjI0","avatar_url":"https://avatars.githubusercontent.com/u/51172624?v=4","gravatar_id":"","url":"https://api.github.com/users/apurva-koti","html_url":"https://github.com/apurva-koti","followers_url":"https://api.github.com/users/apurva-koti/followers","following_url":"https://api.github.com/users/apurva-koti/following{/other_user}","gists_url":"https://api.github.com/users/apurva-koti/gists{/gist_id}","starred_url":"https://api.github.com/users/apurva-koti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apurva-koti/subscriptions","organizations_url":"https://api.github.com/users/apurva-koti/orgs","repos_url":"https://api.github.com/users/apurva-koti/repos","events_url":"https://api.github.com/users/apurva-koti/events{/privacy}","received_events_url":"https://api.github.com/users/apurva-koti/received_events","type":"User","site_admin":false},"created_at":"2020-09-28T21:34:29Z","updated_at":"2020-09-28T21:34:29Z","author_association":"COLLABORATOR","body":"cc'ing @juntai-zheng for clarity on which summary writer function to patch for this!","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/700293452/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"apurva-koti","id":51172624,"node_id":"MDQ6VXNlcjUxMTcyNjI0","avatar_url":"https://avatars.githubusercontent.com/u/51172624?v=4","gravatar_id":"","url":"https://api.github.com/users/apurva-koti","html_url":"https://github.com/apurva-koti","followers_url":"https://api.github.com/users/apurva-koti/followers","following_url":"https://api.github.com/users/apurva-koti/following{/other_user}","gists_url":"https://api.github.com/users/apurva-koti/gists{/gist_id}","starred_url":"https://api.github.com/users/apurva-koti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apurva-koti/subscriptions","organizations_url":"https://api.github.com/users/apurva-koti/orgs","repos_url":"https://api.github.com/users/apurva-koti/repos","events_url":"https://api.github.com/users/apurva-koti/events{/privacy}","received_events_url":"https://api.github.com/users/apurva-koti/received_events","type":"User","site_admin":false}},{"id":3816562256,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzgxNjU2MjI1Ng==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3816562256","actor":{"login":"juntai-zheng","id":39497939,"node_id":"MDQ6VXNlcjM5NDk3OTM5","avatar_url":"https://avatars.githubusercontent.com/u/39497939?v=4","gravatar_id":"","url":"https://api.github.com/users/juntai-zheng","html_url":"https://github.com/juntai-zheng","followers_url":"https://api.github.com/users/juntai-zheng/followers","following_url":"https://api.github.com/users/juntai-zheng/following{/other_user}","gists_url":"https://api.github.com/users/juntai-zheng/gists{/gist_id}","starred_url":"https://api.github.com/users/juntai-zheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juntai-zheng/subscriptions","organizations_url":"https://api.github.com/users/juntai-zheng/orgs","repos_url":"https://api.github.com/users/juntai-zheng/repos","events_url":"https://api.github.com/users/juntai-zheng/events{/privacy}","received_events_url":"https://api.github.com/users/juntai-zheng/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-09-28T21:34:29Z","performed_via_github_app":null},{"id":3816562259,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM4MTY1NjIyNTk=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3816562259","actor":{"login":"juntai-zheng","id":39497939,"node_id":"MDQ6VXNlcjM5NDk3OTM5","avatar_url":"https://avatars.githubusercontent.com/u/39497939?v=4","gravatar_id":"","url":"https://api.github.com/users/juntai-zheng","html_url":"https://github.com/juntai-zheng","followers_url":"https://api.github.com/users/juntai-zheng/followers","following_url":"https://api.github.com/users/juntai-zheng/following{/other_user}","gists_url":"https://api.github.com/users/juntai-zheng/gists{/gist_id}","starred_url":"https://api.github.com/users/juntai-zheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juntai-zheng/subscriptions","organizations_url":"https://api.github.com/users/juntai-zheng/orgs","repos_url":"https://api.github.com/users/juntai-zheng/repos","events_url":"https://api.github.com/users/juntai-zheng/events{/privacy}","received_events_url":"https://api.github.com/users/juntai-zheng/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-09-28T21:34:29Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/700323851","html_url":"https://github.com/mlflow/mlflow/issues/3367#issuecomment-700323851","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/3367","id":700323851,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMDMyMzg1MQ==","user":{"login":"juntai-zheng","id":39497939,"node_id":"MDQ6VXNlcjM5NDk3OTM5","avatar_url":"https://avatars.githubusercontent.com/u/39497939?v=4","gravatar_id":"","url":"https://api.github.com/users/juntai-zheng","html_url":"https://github.com/juntai-zheng","followers_url":"https://api.github.com/users/juntai-zheng/followers","following_url":"https://api.github.com/users/juntai-zheng/following{/other_user}","gists_url":"https://api.github.com/users/juntai-zheng/gists{/gist_id}","starred_url":"https://api.github.com/users/juntai-zheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juntai-zheng/subscriptions","organizations_url":"https://api.github.com/users/juntai-zheng/orgs","repos_url":"https://api.github.com/users/juntai-zheng/repos","events_url":"https://api.github.com/users/juntai-zheng/events{/privacy}","received_events_url":"https://api.github.com/users/juntai-zheng/received_events","type":"User","site_admin":false},"created_at":"2020-09-28T22:50:02Z","updated_at":"2020-09-28T22:50:02Z","author_association":"COLLABORATOR","body":"Hi @greenorblack, when running your code with the patched `eager_eval_loop`, are you setting the flag `checkpoint_dir` for evaluation? [`eval_continuously`](https://github.com/tensorflow/models/blob/ee3bfa1ecf5c0d2296bb5d32e7b34d9e0b4b0205/research/object_detection/model_main_tf2.py#L79) seems to be only called when that flag is added for eval mode.\r\nFrom my understanding, `eval_continuously` [waits on checkpoints to appear](https://github.com/tensorflow/models/blob/master/research/object_detection/model_lib_v2.py#L965) to run `eager_eval_loop`, and `eager_eval_loop` shouldn't be waiting for anything. Could you double check that your patched code is run when you test it out?\r\n\r\nAdditionally, you should be able to log training metrics in `train_loop` by incorporating [mlflow callbacks](https://github.com/mlflow/mlflow/blob/5cf346fec70d1a680915c4760a809386b1a402f2/mlflow/tensorflow.py#L637) to log Tensorboard info captured by `train_loop`.\r\n\r\nLet me know if that makes sense, thanks!","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/700323851/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"juntai-zheng","id":39497939,"node_id":"MDQ6VXNlcjM5NDk3OTM5","avatar_url":"https://avatars.githubusercontent.com/u/39497939?v=4","gravatar_id":"","url":"https://api.github.com/users/juntai-zheng","html_url":"https://github.com/juntai-zheng","followers_url":"https://api.github.com/users/juntai-zheng/followers","following_url":"https://api.github.com/users/juntai-zheng/following{/other_user}","gists_url":"https://api.github.com/users/juntai-zheng/gists{/gist_id}","starred_url":"https://api.github.com/users/juntai-zheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juntai-zheng/subscriptions","organizations_url":"https://api.github.com/users/juntai-zheng/orgs","repos_url":"https://api.github.com/users/juntai-zheng/repos","events_url":"https://api.github.com/users/juntai-zheng/events{/privacy}","received_events_url":"https://api.github.com/users/juntai-zheng/received_events","type":"User","site_admin":false}},{"id":3816756449,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzgxNjc1NjQ0OQ==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3816756449","actor":{"login":"NithyaMogane-TomTom","id":62301809,"node_id":"MDQ6VXNlcjYyMzAxODA5","avatar_url":"https://avatars.githubusercontent.com/u/62301809?v=4","gravatar_id":"","url":"https://api.github.com/users/NithyaMogane-TomTom","html_url":"https://github.com/NithyaMogane-TomTom","followers_url":"https://api.github.com/users/NithyaMogane-TomTom/followers","following_url":"https://api.github.com/users/NithyaMogane-TomTom/following{/other_user}","gists_url":"https://api.github.com/users/NithyaMogane-TomTom/gists{/gist_id}","starred_url":"https://api.github.com/users/NithyaMogane-TomTom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NithyaMogane-TomTom/subscriptions","organizations_url":"https://api.github.com/users/NithyaMogane-TomTom/orgs","repos_url":"https://api.github.com/users/NithyaMogane-TomTom/repos","events_url":"https://api.github.com/users/NithyaMogane-TomTom/events{/privacy}","received_events_url":"https://api.github.com/users/NithyaMogane-TomTom/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-09-28T22:50:02Z","performed_via_github_app":null},{"id":3816756451,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM4MTY3NTY0NTE=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3816756451","actor":{"login":"NithyaMogane-TomTom","id":62301809,"node_id":"MDQ6VXNlcjYyMzAxODA5","avatar_url":"https://avatars.githubusercontent.com/u/62301809?v=4","gravatar_id":"","url":"https://api.github.com/users/NithyaMogane-TomTom","html_url":"https://github.com/NithyaMogane-TomTom","followers_url":"https://api.github.com/users/NithyaMogane-TomTom/followers","following_url":"https://api.github.com/users/NithyaMogane-TomTom/following{/other_user}","gists_url":"https://api.github.com/users/NithyaMogane-TomTom/gists{/gist_id}","starred_url":"https://api.github.com/users/NithyaMogane-TomTom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NithyaMogane-TomTom/subscriptions","organizations_url":"https://api.github.com/users/NithyaMogane-TomTom/orgs","repos_url":"https://api.github.com/users/NithyaMogane-TomTom/repos","events_url":"https://api.github.com/users/NithyaMogane-TomTom/events{/privacy}","received_events_url":"https://api.github.com/users/NithyaMogane-TomTom/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-09-28T22:50:02Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/730594616","html_url":"https://github.com/mlflow/mlflow/issues/3367#issuecomment-730594616","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/3367","id":730594616,"node_id":"MDEyOklzc3VlQ29tbWVudDczMDU5NDYxNg==","user":{"login":"NithyaMogane-TomTom","id":62301809,"node_id":"MDQ6VXNlcjYyMzAxODA5","avatar_url":"https://avatars.githubusercontent.com/u/62301809?v=4","gravatar_id":"","url":"https://api.github.com/users/NithyaMogane-TomTom","html_url":"https://github.com/NithyaMogane-TomTom","followers_url":"https://api.github.com/users/NithyaMogane-TomTom/followers","following_url":"https://api.github.com/users/NithyaMogane-TomTom/following{/other_user}","gists_url":"https://api.github.com/users/NithyaMogane-TomTom/gists{/gist_id}","starred_url":"https://api.github.com/users/NithyaMogane-TomTom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NithyaMogane-TomTom/subscriptions","organizations_url":"https://api.github.com/users/NithyaMogane-TomTom/orgs","repos_url":"https://api.github.com/users/NithyaMogane-TomTom/repos","events_url":"https://api.github.com/users/NithyaMogane-TomTom/events{/privacy}","received_events_url":"https://api.github.com/users/NithyaMogane-TomTom/received_events","type":"User","site_admin":false},"created_at":"2020-11-19T19:41:29Z","updated_at":"2020-11-27T09:57:42Z","author_association":"NONE","body":"@juntai-zheng and @apurva-koti Sorry about the delayed reply\r\n**UPDATE**: \r\nI patched [eager_eval_loop](https://github.com/tensorflow/models/blob/master/research/object_detection/model_lib_v2.py#L760)\r\nwhich returns eval_metrics and I can successfully log it.\r\nHere's my patch:\r\n```\r\n    def eager_eval_loop(*args, **kwargs):\r\n        with _manage_active_run():\r\n            original = gorilla.get_original_attribute(model_lib_v2, 'eager_eval_loop')\r\n            step = np.int(kwargs[\"global_step\"])\r\n            for key, value in result.items():\r\n                if isinstance(value, np.number):\r\n                    metric_name = 'Eval/{}'.format(''.join(filter(lambda c: c not in '()[]@', key)))\r\n                    try_mlflow_log(mlflow.log_metric, metric_name, value, step=step)\r\n\r\n            try_mlflow_log(mlflow.log_metric, \"Eval/Loss/localization_loss\", np.float(result['Loss/localization_loss']), step=step)\r\n            try_mlflow_log(mlflow.log_metric, \"Eval/Loss/classification_loss\", np.float(result['Loss/classification_loss']), step=step)\r\n            try_mlflow_log(mlflow.log_metric, \"Eval/Loss/regularization_loss\", np.float(result['Loss/regularization_loss']), step=step)\r\n            try_mlflow_log(mlflow.log_metric, \"Eval/Loss/total_loss\", np.float(result['Loss/total_loss']), step=step)\r\n           \r\n            return result\r\n\r\n```\r\nHowever, when trying to log metrics for the training session -\r\nI patched [eager_train_step](https://github.com/tensorflow/models/blob/master/research/object_detection/model_lib_v2.py#L760). My patched function is called as expected. However, I cannot log the global_step and total loss (as returned by the function). global_step is a mirrored variable and hence can't be converted into a number for logging purposes. I'm assuming something similar with the total_loss value returned by it. I'm not sure how to access these values. Attempts at patching [train_step_fn](https://github.com/tensorflow/models/blob/master/research/object_detection/model_lib_v2.py#L579) failed. Perhaps, because I am entering incorrect destination path in gorilla.patch (`@gorilla.patch(model_lib_v2.train_loop)`)? \r\n\r\nI'm currently working on fixing these issues. Any suggestions on what can be done would be helpful : ) ","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/730594616/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"NithyaMogane-TomTom","id":62301809,"node_id":"MDQ6VXNlcjYyMzAxODA5","avatar_url":"https://avatars.githubusercontent.com/u/62301809?v=4","gravatar_id":"","url":"https://api.github.com/users/NithyaMogane-TomTom","html_url":"https://github.com/NithyaMogane-TomTom","followers_url":"https://api.github.com/users/NithyaMogane-TomTom/followers","following_url":"https://api.github.com/users/NithyaMogane-TomTom/following{/other_user}","gists_url":"https://api.github.com/users/NithyaMogane-TomTom/gists{/gist_id}","starred_url":"https://api.github.com/users/NithyaMogane-TomTom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NithyaMogane-TomTom/subscriptions","organizations_url":"https://api.github.com/users/NithyaMogane-TomTom/orgs","repos_url":"https://api.github.com/users/NithyaMogane-TomTom/repos","events_url":"https://api.github.com/users/NithyaMogane-TomTom/events{/privacy}","received_events_url":"https://api.github.com/users/NithyaMogane-TomTom/received_events","type":"User","site_admin":false}},{"id":4017584234,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDAxNzU4NDIzNA==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/4017584234","actor":{"login":"juntai-zheng","id":39497939,"node_id":"MDQ6VXNlcjM5NDk3OTM5","avatar_url":"https://avatars.githubusercontent.com/u/39497939?v=4","gravatar_id":"","url":"https://api.github.com/users/juntai-zheng","html_url":"https://github.com/juntai-zheng","followers_url":"https://api.github.com/users/juntai-zheng/followers","following_url":"https://api.github.com/users/juntai-zheng/following{/other_user}","gists_url":"https://api.github.com/users/juntai-zheng/gists{/gist_id}","starred_url":"https://api.github.com/users/juntai-zheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juntai-zheng/subscriptions","organizations_url":"https://api.github.com/users/juntai-zheng/orgs","repos_url":"https://api.github.com/users/juntai-zheng/repos","events_url":"https://api.github.com/users/juntai-zheng/events{/privacy}","received_events_url":"https://api.github.com/users/juntai-zheng/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-11-19T19:41:29Z","performed_via_github_app":null},{"id":4017584238,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQwMTc1ODQyMzg=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/4017584238","actor":{"login":"juntai-zheng","id":39497939,"node_id":"MDQ6VXNlcjM5NDk3OTM5","avatar_url":"https://avatars.githubusercontent.com/u/39497939?v=4","gravatar_id":"","url":"https://api.github.com/users/juntai-zheng","html_url":"https://github.com/juntai-zheng","followers_url":"https://api.github.com/users/juntai-zheng/followers","following_url":"https://api.github.com/users/juntai-zheng/following{/other_user}","gists_url":"https://api.github.com/users/juntai-zheng/gists{/gist_id}","starred_url":"https://api.github.com/users/juntai-zheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juntai-zheng/subscriptions","organizations_url":"https://api.github.com/users/juntai-zheng/orgs","repos_url":"https://api.github.com/users/juntai-zheng/repos","events_url":"https://api.github.com/users/juntai-zheng/events{/privacy}","received_events_url":"https://api.github.com/users/juntai-zheng/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-11-19T19:41:29Z","performed_via_github_app":null},{"id":4045409632,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDA0NTQwOTYzMg==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/4045409632","actor":{"login":"apurva-koti","id":51172624,"node_id":"MDQ6VXNlcjUxMTcyNjI0","avatar_url":"https://avatars.githubusercontent.com/u/51172624?v=4","gravatar_id":"","url":"https://api.github.com/users/apurva-koti","html_url":"https://github.com/apurva-koti","followers_url":"https://api.github.com/users/apurva-koti/followers","following_url":"https://api.github.com/users/apurva-koti/following{/other_user}","gists_url":"https://api.github.com/users/apurva-koti/gists{/gist_id}","starred_url":"https://api.github.com/users/apurva-koti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apurva-koti/subscriptions","organizations_url":"https://api.github.com/users/apurva-koti/orgs","repos_url":"https://api.github.com/users/apurva-koti/repos","events_url":"https://api.github.com/users/apurva-koti/events{/privacy}","received_events_url":"https://api.github.com/users/apurva-koti/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-11-27T09:57:42Z","performed_via_github_app":null},{"id":4045409637,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQwNDU0MDk2Mzc=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/4045409637","actor":{"login":"apurva-koti","id":51172624,"node_id":"MDQ6VXNlcjUxMTcyNjI0","avatar_url":"https://avatars.githubusercontent.com/u/51172624?v=4","gravatar_id":"","url":"https://api.github.com/users/apurva-koti","html_url":"https://github.com/apurva-koti","followers_url":"https://api.github.com/users/apurva-koti/followers","following_url":"https://api.github.com/users/apurva-koti/following{/other_user}","gists_url":"https://api.github.com/users/apurva-koti/gists{/gist_id}","starred_url":"https://api.github.com/users/apurva-koti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apurva-koti/subscriptions","organizations_url":"https://api.github.com/users/apurva-koti/orgs","repos_url":"https://api.github.com/users/apurva-koti/repos","events_url":"https://api.github.com/users/apurva-koti/events{/privacy}","received_events_url":"https://api.github.com/users/apurva-koti/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-11-27T09:57:42Z","performed_via_github_app":null},{"id":4193155036,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDE5MzE1NTAzNg==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/4193155036","actor":{"login":"NithyaMogane-TomTom","id":62301809,"node_id":"MDQ6VXNlcjYyMzAxODA5","avatar_url":"https://avatars.githubusercontent.com/u/62301809?v=4","gravatar_id":"","url":"https://api.github.com/users/NithyaMogane-TomTom","html_url":"https://github.com/NithyaMogane-TomTom","followers_url":"https://api.github.com/users/NithyaMogane-TomTom/followers","following_url":"https://api.github.com/users/NithyaMogane-TomTom/following{/other_user}","gists_url":"https://api.github.com/users/NithyaMogane-TomTom/gists{/gist_id}","starred_url":"https://api.github.com/users/NithyaMogane-TomTom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NithyaMogane-TomTom/subscriptions","organizations_url":"https://api.github.com/users/NithyaMogane-TomTom/orgs","repos_url":"https://api.github.com/users/NithyaMogane-TomTom/repos","events_url":"https://api.github.com/users/NithyaMogane-TomTom/events{/privacy}","received_events_url":"https://api.github.com/users/NithyaMogane-TomTom/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-01-11T22:50:46Z","performed_via_github_app":null},{"id":4193155041,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQxOTMxNTUwNDE=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/4193155041","actor":{"login":"NithyaMogane-TomTom","id":62301809,"node_id":"MDQ6VXNlcjYyMzAxODA5","avatar_url":"https://avatars.githubusercontent.com/u/62301809?v=4","gravatar_id":"","url":"https://api.github.com/users/NithyaMogane-TomTom","html_url":"https://github.com/NithyaMogane-TomTom","followers_url":"https://api.github.com/users/NithyaMogane-TomTom/followers","following_url":"https://api.github.com/users/NithyaMogane-TomTom/following{/other_user}","gists_url":"https://api.github.com/users/NithyaMogane-TomTom/gists{/gist_id}","starred_url":"https://api.github.com/users/NithyaMogane-TomTom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NithyaMogane-TomTom/subscriptions","organizations_url":"https://api.github.com/users/NithyaMogane-TomTom/orgs","repos_url":"https://api.github.com/users/NithyaMogane-TomTom/repos","events_url":"https://api.github.com/users/NithyaMogane-TomTom/events{/privacy}","received_events_url":"https://api.github.com/users/NithyaMogane-TomTom/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-01-11T22:50:46Z","performed_via_github_app":null},{"id":4247675188,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDI0NzY3NTE4OA==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/4247675188","actor":{"login":"juntai-zheng","id":39497939,"node_id":"MDQ6VXNlcjM5NDk3OTM5","avatar_url":"https://avatars.githubusercontent.com/u/39497939?v=4","gravatar_id":"","url":"https://api.github.com/users/juntai-zheng","html_url":"https://github.com/juntai-zheng","followers_url":"https://api.github.com/users/juntai-zheng/followers","following_url":"https://api.github.com/users/juntai-zheng/following{/other_user}","gists_url":"https://api.github.com/users/juntai-zheng/gists{/gist_id}","starred_url":"https://api.github.com/users/juntai-zheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juntai-zheng/subscriptions","organizations_url":"https://api.github.com/users/juntai-zheng/orgs","repos_url":"https://api.github.com/users/juntai-zheng/repos","events_url":"https://api.github.com/users/juntai-zheng/events{/privacy}","received_events_url":"https://api.github.com/users/juntai-zheng/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-01-25T20:55:55Z","performed_via_github_app":null},{"id":4247675192,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQyNDc2NzUxOTI=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/4247675192","actor":{"login":"juntai-zheng","id":39497939,"node_id":"MDQ6VXNlcjM5NDk3OTM5","avatar_url":"https://avatars.githubusercontent.com/u/39497939?v=4","gravatar_id":"","url":"https://api.github.com/users/juntai-zheng","html_url":"https://github.com/juntai-zheng","followers_url":"https://api.github.com/users/juntai-zheng/followers","following_url":"https://api.github.com/users/juntai-zheng/following{/other_user}","gists_url":"https://api.github.com/users/juntai-zheng/gists{/gist_id}","starred_url":"https://api.github.com/users/juntai-zheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juntai-zheng/subscriptions","organizations_url":"https://api.github.com/users/juntai-zheng/orgs","repos_url":"https://api.github.com/users/juntai-zheng/repos","events_url":"https://api.github.com/users/juntai-zheng/events{/privacy}","received_events_url":"https://api.github.com/users/juntai-zheng/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-01-25T20:55:55Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/780791078","html_url":"https://github.com/mlflow/mlflow/issues/3367#issuecomment-780791078","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/3367","id":780791078,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MDc5MTA3OA==","user":{"login":"mohammedayub44","id":7122670,"node_id":"MDQ6VXNlcjcxMjI2NzA=","avatar_url":"https://avatars.githubusercontent.com/u/7122670?v=4","gravatar_id":"","url":"https://api.github.com/users/mohammedayub44","html_url":"https://github.com/mohammedayub44","followers_url":"https://api.github.com/users/mohammedayub44/followers","following_url":"https://api.github.com/users/mohammedayub44/following{/other_user}","gists_url":"https://api.github.com/users/mohammedayub44/gists{/gist_id}","starred_url":"https://api.github.com/users/mohammedayub44/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mohammedayub44/subscriptions","organizations_url":"https://api.github.com/users/mohammedayub44/orgs","repos_url":"https://api.github.com/users/mohammedayub44/repos","events_url":"https://api.github.com/users/mohammedayub44/events{/privacy}","received_events_url":"https://api.github.com/users/mohammedayub44/received_events","type":"User","site_admin":false},"created_at":"2021-02-17T19:20:13Z","updated_at":"2021-02-23T22:09:22Z","author_association":"NONE","body":"@NithyaMogane-TomTom @juntai-zheng \r\n\r\nAfter spending sometime looking into this, here are some changes that I tested - \r\n\r\nLooks like patches can only be introduced on functions that have a valid `return` statement in them. Therefore functions like `train_loop` cannot be patched instead `eager_train_step` can be patched easily. Even though `loss` is returned from `eager_train_step` the entire training step is being run in **Graph Mode** and not **Eager mode**  (because `_dist_train_step` is wrapped in `@tf.function`  from which each train step is called). I had to run them eagerly using `tf.config.experimental_run_functions_eagerly(True)` , doing so will <Tensor>.numpy() should give you the float values. I'm not sure how much impact this will have on my training performance but it gets the job done. (TensorFlow does give you a warning for this which can be ignored). \r\n \r\nCallbacks - I had to override the callbacks functionality in `model_main_tf2.py` and pass them as params to `train_loop` also modify `eager_train_step` function to add `callbacks=None` param to be returned to mlflow.\r\n\r\n\r\nFollowing changes were made to get training metrics - \r\n\r\n```python\r\n# Add return statement in `eager_train_step`  (model_lib_v2.py)\r\n# If your using virtual environment file location  - /home/ubuntu/anaconda3/envs/tensorflow2_p36/lib/python3.6/site-packages/object_detection/model_lib_v2.py\r\n\r\ndef eager_train_step(...\r\n                   callbacks=None ):   # <-- Here\r\n     ...\r\n     return total_loss,losses_dict,learning_rate,global_step   # <-- Here\r\n\r\n# Capture them after the return (model_lib_v2.py Line 587)\r\nloss,ld,lr,gs = eager_train_step(                                         # <-- Here\r\n                      ... \r\n                      callbacks=kwargs['callbacks'] )  # <-- Here\r\n\r\n```\r\n\r\nRun each Step eagerly in `train_loop` (model_lib_v2.py)\r\n\r\n```python\r\ntf.config.experimental_run_functions_eagerly(True)\r\nloss = _dist_train_step(train_input_iter)\r\ntf.config.experimental_run_functions_eagerly(False)\r\n```\r\n\r\n### Callbacks (you can start the run using `with` clause as well)\r\n\r\n```python\r\n(in model_main_tf2.py )\r\n...\r\nwith strategy.scope():\r\n      mlflow.start_run(run_name=\"TF2_COCO_Train\")\r\n      callbacks = [ tf.keras.callbacks.TensorBoard(log_dir=FLAGS.model_dir+'train'),\r\n                    tf.keras.callbacks.ModelCheckpoint(filepath=FLAGS.model_dir,\r\n                                       save_weights_only=True)]  \r\n      model_lib_v2.train_loop(\r\n        pipeline_config_path=FLAGS.pipeline_config_path,\r\n        model_dir=FLAGS.model_dir,\r\n        train_steps=FLAGS.num_train_steps,\r\n        use_tpu=FLAGS.use_tpu,\r\n        checkpoint_every_n=FLAGS.checkpoint_every_n,\r\n        record_summaries=FLAGS.record_summaries,\r\n        callbacks=callbacks)    # <-- Here\r\n      mlflow.end_run()\r\n\r\n```\r\n\r\n\r\n### Added separate class in tensorflow.py to capture training metrics (similar to FitPatch class)\r\n\r\n```python\r\n\r\nclass EagerTrain(PatchFunction):\r\n        def __init__(self):\r\n            self.log_dir = None\r\n        \r\n        def _patch_implementation(\r\n            self, original, inst, *args, **kwargs\r\n        ):  # pylint: disable=arguments-differ\r\n            \r\n            # Log only Specific Params\r\n            try_mlflow_log(mlflow.log_param, \"base_arch_name\", inst.name)\r\n            try_mlflow_log(mlflow.log_param, \"num_classes\", inst.num_classes)\r\n            try_mlflow_log(mlflow.log_param, \"resizer_height\", inst._image_resizer_fn.keywords['new_height'])\r\n            try_mlflow_log(mlflow.log_param, \"resizer_width\", inst._image_resizer_fn.keywords['new_width'])\r\n            try_mlflow_log(mlflow.log_param, \"feature_extractor\", inst.feature_extractor.name)\r\n            try_mlflow_log(mlflow.log_param, \"post_processing_iou_thresh\", inst._non_max_suppression_fn.keywords['iou_thresh'])\r\n            try_mlflow_log(mlflow.log_param, \"post_processing_max_det\", inst._non_max_suppression_fn.keywords['max_total_size'])\r\n            try_mlflow_log(mlflow.log_param, \"post_processing_max_size_perclass\", inst._non_max_suppression_fn.keywords['max_size_per_class'])\r\n\r\n            run_id = mlflow.active_run().info.run_id\r\n            with batch_metrics_logger(run_id) as metrics_logger:\r\n                # Setting Log Dir location\r\n                if kwargs.get(\"callbacks\"):\r\n                    kwargs[\"callbacks\"], self.log_dir = _setup_callbacks(\r\n                        kwargs[\"callbacks\"], log_models, metrics_logger\r\n                    )\r\n                \r\n                history = original(inst, *args, **kwargs)\r\n                \r\n                # log eval metrics\r\n                c_step = history[3].numpy()\r\n                for key, value in history[1].items():\r\n                    # print(\"Key: \"+ str(key)+\" Type: \"+ str(type(value))+\" Value: \"+str(value.numpy()))\r\n                    # Filter out characters that can't be used in metric name\r\n                    metric_name = 'Train/{}'.format(''.join(filter(lambda c: c not in '()[]@', key)))\r\n                    try_mlflow_log(mlflow.log_metric, metric_name, value.numpy(), step=c_step)\r\n                lr_name = 'Train/LearningRate'\r\n                try_mlflow_log(mlflow.log_metric, lr_name, history[2].numpy(), step=c_step)\r\n\r\n            _flush_queue()\r\n            _log_artifacts_with_warning(\r\n                local_dir=self.log_dir.location, artifact_path=\"tensorboard_logs\",\r\n            )\r\n            if self.log_dir.is_temp:\r\n                shutil.rmtree(self.log_dir.location)\r\n\r\n            return history\r\n\r\n        def _on_exception(self, exception):\r\n            if (\r\n                self.log_dir is not None\r\n                and self.log_dir.is_temp\r\n                and os.path.exists(self.log_dir.location)\r\n            ):\r\n                shutil.rmtree(self.log_dir.location)\r\n\r\n```\r\n ### Call the class with managed run\r\n```python\r\n\r\nmanaged = [\r\n        ...\r\n        (object_detection.model_lib_v2, \"eager_train_step\", EagerTrain),  # <-- Here\r\n      ...\r\n    ]\r\n```\r\n\r\nSnapshots:\r\n\r\n![image](https://user-images.githubusercontent.com/7122670/108254273-cdc80380-7128-11eb-8859-017508b13934.png)\r\n\r\n\r\n\r\n![image](https://user-images.githubusercontent.com/7122670/108253939-614d0480-7128-11eb-9c11-89f2d4177703.png)\r\n\r\nI did not implement other callbacks for now, since I'm not using them.\r\n\r\nLet me know if this works on your machine. Thanks !\r\n\r\n","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/780791078/reactions","total_count":3,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":3,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mohammedayub44","id":7122670,"node_id":"MDQ6VXNlcjcxMjI2NzA=","avatar_url":"https://avatars.githubusercontent.com/u/7122670?v=4","gravatar_id":"","url":"https://api.github.com/users/mohammedayub44","html_url":"https://github.com/mohammedayub44","followers_url":"https://api.github.com/users/mohammedayub44/followers","following_url":"https://api.github.com/users/mohammedayub44/following{/other_user}","gists_url":"https://api.github.com/users/mohammedayub44/gists{/gist_id}","starred_url":"https://api.github.com/users/mohammedayub44/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mohammedayub44/subscriptions","organizations_url":"https://api.github.com/users/mohammedayub44/orgs","repos_url":"https://api.github.com/users/mohammedayub44/repos","events_url":"https://api.github.com/users/mohammedayub44/events{/privacy}","received_events_url":"https://api.github.com/users/mohammedayub44/received_events","type":"User","site_admin":false}},{"id":4343118011,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDM0MzExODAxMQ==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/4343118011","actor":{"login":"juntai-zheng","id":39497939,"node_id":"MDQ6VXNlcjM5NDk3OTM5","avatar_url":"https://avatars.githubusercontent.com/u/39497939?v=4","gravatar_id":"","url":"https://api.github.com/users/juntai-zheng","html_url":"https://github.com/juntai-zheng","followers_url":"https://api.github.com/users/juntai-zheng/followers","following_url":"https://api.github.com/users/juntai-zheng/following{/other_user}","gists_url":"https://api.github.com/users/juntai-zheng/gists{/gist_id}","starred_url":"https://api.github.com/users/juntai-zheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juntai-zheng/subscriptions","organizations_url":"https://api.github.com/users/juntai-zheng/orgs","repos_url":"https://api.github.com/users/juntai-zheng/repos","events_url":"https://api.github.com/users/juntai-zheng/events{/privacy}","received_events_url":"https://api.github.com/users/juntai-zheng/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-02-17T19:20:13Z","performed_via_github_app":null},{"id":4343118015,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQzNDMxMTgwMTU=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/4343118015","actor":{"login":"juntai-zheng","id":39497939,"node_id":"MDQ6VXNlcjM5NDk3OTM5","avatar_url":"https://avatars.githubusercontent.com/u/39497939?v=4","gravatar_id":"","url":"https://api.github.com/users/juntai-zheng","html_url":"https://github.com/juntai-zheng","followers_url":"https://api.github.com/users/juntai-zheng/followers","following_url":"https://api.github.com/users/juntai-zheng/following{/other_user}","gists_url":"https://api.github.com/users/juntai-zheng/gists{/gist_id}","starred_url":"https://api.github.com/users/juntai-zheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juntai-zheng/subscriptions","organizations_url":"https://api.github.com/users/juntai-zheng/orgs","repos_url":"https://api.github.com/users/juntai-zheng/repos","events_url":"https://api.github.com/users/juntai-zheng/events{/privacy}","received_events_url":"https://api.github.com/users/juntai-zheng/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-02-17T19:20:13Z","performed_via_github_app":null}]