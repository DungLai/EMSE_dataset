[{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/714563796","html_url":"https://github.com/mlflow/mlflow/issues/3574#issuecomment-714563796","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/3574","id":714563796,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNDU2Mzc5Ng==","user":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"created_at":"2020-10-22T15:13:39Z","updated_at":"2020-10-22T15:13:39Z","author_association":"MEMBER","body":"@sheldonkhall Thanks for reporting this. I was able to reproduce the issue.","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/714563796/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false}},{"id":3909647909,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzkwOTY0NzkwOQ==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3909647909","actor":{"login":"sheldonkhall","id":8779668,"node_id":"MDQ6VXNlcjg3Nzk2Njg=","avatar_url":"https://avatars.githubusercontent.com/u/8779668?v=4","gravatar_id":"","url":"https://api.github.com/users/sheldonkhall","html_url":"https://github.com/sheldonkhall","followers_url":"https://api.github.com/users/sheldonkhall/followers","following_url":"https://api.github.com/users/sheldonkhall/following{/other_user}","gists_url":"https://api.github.com/users/sheldonkhall/gists{/gist_id}","starred_url":"https://api.github.com/users/sheldonkhall/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sheldonkhall/subscriptions","organizations_url":"https://api.github.com/users/sheldonkhall/orgs","repos_url":"https://api.github.com/users/sheldonkhall/repos","events_url":"https://api.github.com/users/sheldonkhall/events{/privacy}","received_events_url":"https://api.github.com/users/sheldonkhall/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-10-22T15:13:39Z","performed_via_github_app":null},{"id":3909647910,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM5MDk2NDc5MTA=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3909647910","actor":{"login":"sheldonkhall","id":8779668,"node_id":"MDQ6VXNlcjg3Nzk2Njg=","avatar_url":"https://avatars.githubusercontent.com/u/8779668?v=4","gravatar_id":"","url":"https://api.github.com/users/sheldonkhall","html_url":"https://github.com/sheldonkhall","followers_url":"https://api.github.com/users/sheldonkhall/followers","following_url":"https://api.github.com/users/sheldonkhall/following{/other_user}","gists_url":"https://api.github.com/users/sheldonkhall/gists{/gist_id}","starred_url":"https://api.github.com/users/sheldonkhall/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sheldonkhall/subscriptions","organizations_url":"https://api.github.com/users/sheldonkhall/orgs","repos_url":"https://api.github.com/users/sheldonkhall/repos","events_url":"https://api.github.com/users/sheldonkhall/events{/privacy}","received_events_url":"https://api.github.com/users/sheldonkhall/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-10-22T15:13:39Z","performed_via_github_app":null},{"id":3910061632,"node_id":"MDEyOkxhYmVsZWRFdmVudDM5MTAwNjE2MzI=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3910061632","actor":{"login":"dmatrix","id":1117597,"node_id":"MDQ6VXNlcjExMTc1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1117597?v=4","gravatar_id":"","url":"https://api.github.com/users/dmatrix","html_url":"https://github.com/dmatrix","followers_url":"https://api.github.com/users/dmatrix/followers","following_url":"https://api.github.com/users/dmatrix/following{/other_user}","gists_url":"https://api.github.com/users/dmatrix/gists{/gist_id}","starred_url":"https://api.github.com/users/dmatrix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmatrix/subscriptions","organizations_url":"https://api.github.com/users/dmatrix/orgs","repos_url":"https://api.github.com/users/dmatrix/repos","events_url":"https://api.github.com/users/dmatrix/events{/privacy}","received_events_url":"https://api.github.com/users/dmatrix/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-10-22T16:34:43Z","label":{"name":"area/artifacts","color":"48eabc"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/714615336","html_url":"https://github.com/mlflow/mlflow/issues/3574#issuecomment-714615336","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/3574","id":714615336,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNDYxNTMzNg==","user":{"login":"dmatrix","id":1117597,"node_id":"MDQ6VXNlcjExMTc1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1117597?v=4","gravatar_id":"","url":"https://api.github.com/users/dmatrix","html_url":"https://github.com/dmatrix","followers_url":"https://api.github.com/users/dmatrix/followers","following_url":"https://api.github.com/users/dmatrix/following{/other_user}","gists_url":"https://api.github.com/users/dmatrix/gists{/gist_id}","starred_url":"https://api.github.com/users/dmatrix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmatrix/subscriptions","organizations_url":"https://api.github.com/users/dmatrix/orgs","repos_url":"https://api.github.com/users/dmatrix/repos","events_url":"https://api.github.com/users/dmatrix/events{/privacy}","received_events_url":"https://api.github.com/users/dmatrix/received_events","type":"User","site_admin":false},"created_at":"2020-10-22T16:35:48Z","updated_at":"2020-10-22T16:35:48Z","author_association":"CONTRIBUTOR","body":"@harupy Thanks for jumping on it!","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/714615336/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dmatrix","id":1117597,"node_id":"MDQ6VXNlcjExMTc1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1117597?v=4","gravatar_id":"","url":"https://api.github.com/users/dmatrix","html_url":"https://github.com/dmatrix","followers_url":"https://api.github.com/users/dmatrix/followers","following_url":"https://api.github.com/users/dmatrix/following{/other_user}","gists_url":"https://api.github.com/users/dmatrix/gists{/gist_id}","starred_url":"https://api.github.com/users/dmatrix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmatrix/subscriptions","organizations_url":"https://api.github.com/users/dmatrix/orgs","repos_url":"https://api.github.com/users/dmatrix/repos","events_url":"https://api.github.com/users/dmatrix/events{/privacy}","received_events_url":"https://api.github.com/users/dmatrix/received_events","type":"User","site_admin":false}},{"id":3910066121,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzkxMDA2NjEyMQ==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3910066121","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-10-22T16:35:48Z","performed_via_github_app":null},{"id":3910066124,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM5MTAwNjYxMjQ=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3910066124","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-10-22T16:35:48Z","performed_via_github_app":null},{"id":3910072804,"node_id":"MDE0OlVubGFiZWxlZEV2ZW50MzkxMDA3MjgwNA==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3910072804","actor":{"login":"dmatrix","id":1117597,"node_id":"MDQ6VXNlcjExMTc1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1117597?v=4","gravatar_id":"","url":"https://api.github.com/users/dmatrix","html_url":"https://github.com/dmatrix","followers_url":"https://api.github.com/users/dmatrix/followers","following_url":"https://api.github.com/users/dmatrix/following{/other_user}","gists_url":"https://api.github.com/users/dmatrix/gists{/gist_id}","starred_url":"https://api.github.com/users/dmatrix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmatrix/subscriptions","organizations_url":"https://api.github.com/users/dmatrix/orgs","repos_url":"https://api.github.com/users/dmatrix/repos","events_url":"https://api.github.com/users/dmatrix/events{/privacy}","received_events_url":"https://api.github.com/users/dmatrix/received_events","type":"User","site_admin":false},"event":"unlabeled","commit_id":null,"commit_url":null,"created_at":"2020-10-22T16:37:09Z","label":{"name":"area/artifacts","color":"48eabc"},"performed_via_github_app":null},{"id":3910072806,"node_id":"MDEyOkxhYmVsZWRFdmVudDM5MTAwNzI4MDY=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3910072806","actor":{"login":"dmatrix","id":1117597,"node_id":"MDQ6VXNlcjExMTc1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1117597?v=4","gravatar_id":"","url":"https://api.github.com/users/dmatrix","html_url":"https://github.com/dmatrix","followers_url":"https://api.github.com/users/dmatrix/followers","following_url":"https://api.github.com/users/dmatrix/following{/other_user}","gists_url":"https://api.github.com/users/dmatrix/gists{/gist_id}","starred_url":"https://api.github.com/users/dmatrix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmatrix/subscriptions","organizations_url":"https://api.github.com/users/dmatrix/orgs","repos_url":"https://api.github.com/users/dmatrix/repos","events_url":"https://api.github.com/users/dmatrix/events{/privacy}","received_events_url":"https://api.github.com/users/dmatrix/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-10-22T16:37:09Z","label":{"name":"area/tracking","color":"48eabc"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/714843237","html_url":"https://github.com/mlflow/mlflow/issues/3574#issuecomment-714843237","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/3574","id":714843237,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNDg0MzIzNw==","user":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"created_at":"2020-10-23T01:01:21Z","updated_at":"2020-10-23T01:21:16Z","author_association":"MEMBER","body":"Wrote a script to repro & investigate the issue:\r\n\r\n```python\r\nimport functools\r\nimport gorilla\r\nfrom mlflow.utils.autologging_utils import wrap_patch\r\n\r\n# context\r\n# 1. `TfidfVectorizer` inherits from `CountVectorizer`.\r\n# 2. `TfidfVectorizer.fit_transform` internally calls `super().fit_transform`.\r\n\r\nclass CountVectorizer:\r\n    def fit_transform(self):\r\n        print(\"CountVectorizer.fit_transform called\")\r\n\r\n\r\nclass TfidfVectorizer(CountVectorizer):\r\n    def fit_transform(self):\r\n        print(\"TfidfVectorizer.fit_transform called\")\r\n        super().fit_transform()\r\n\r\n\r\nFUNC_NAME = \"fit_transform\"\r\n\r\n\r\ndef fit_transform1(self, *args, **kwargs):\r\n    print(\"fit_transform1 called\")\r\n    original_fit1 = gorilla.get_original_attribute(self, FUNC_NAME)\r\n    return original_fit1(*args, **kwargs)\r\n\r\n\r\ndef fit_transform2(self, *args, **kwargs):\r\n    print(\"fit_transform2 called\")\r\n    original_fit2 = gorilla.get_original_attribute(self, FUNC_NAME)\r\n    return original_fit2(*args, **kwargs)\r\n\r\n\r\nwrap_patch(TfidfVectorizer, FUNC_NAME, fit_transform1)\r\nwrap_patch(CountVectorizer, FUNC_NAME, fit_transform2)\r\n\r\n\r\ntfidf = TfidfVectorizer()\r\ntfidf.fit_transform()\r\n\r\n# output:\r\n\"\"\"\r\nfit_transform1 called\r\nTfidfVectorizer.fit_transform called\r\nfit_transform2 called\r\nTfidfVectorizer.fit_transform called\r\nfit_transform2 called\r\nTfidfVectorizer.fit_transform called\r\n...\r\n\r\nRecursionError: maximum recursion depth exceeded while calling a Python object\r\n\"\"\"\r\n\r\n\r\n# How this error occurs:\r\n\"\"\"\r\n1. `TfidfVectorizer.fit_transform` called\r\n2. `fit_transform1` called\r\n3. `original_fit1` (the original `TfidfVectorizer.fit_transform`) called\r\n4. `super().fit_transform` (= `CountVectorizer.fit_transform`) called\r\n5. `fit_transform2` is called\r\n6. `original_fit2` (the original `TfidfVectorizer.fit_transform`) called\r\n7. Goes back to step 4 (== infinite loop)\r\n\"\"\"\r\n\r\n```\r\n\r\ncc @dbczumar @andrewnitu ","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/714843237/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false}},{"id":3911685461,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzkxMTY4NTQ2MQ==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3911685461","actor":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-10-23T01:03:30Z","performed_via_github_app":null},{"id":3911685463,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM5MTE2ODU0NjM=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3911685463","actor":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-10-23T01:03:31Z","performed_via_github_app":null},{"id":3911685464,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzkxMTY4NTQ2NA==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3911685464","actor":{"login":"andrewnitu","id":20518204,"node_id":"MDQ6VXNlcjIwNTE4MjA0","avatar_url":"https://avatars.githubusercontent.com/u/20518204?v=4","gravatar_id":"","url":"https://api.github.com/users/andrewnitu","html_url":"https://github.com/andrewnitu","followers_url":"https://api.github.com/users/andrewnitu/followers","following_url":"https://api.github.com/users/andrewnitu/following{/other_user}","gists_url":"https://api.github.com/users/andrewnitu/gists{/gist_id}","starred_url":"https://api.github.com/users/andrewnitu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrewnitu/subscriptions","organizations_url":"https://api.github.com/users/andrewnitu/orgs","repos_url":"https://api.github.com/users/andrewnitu/repos","events_url":"https://api.github.com/users/andrewnitu/events{/privacy}","received_events_url":"https://api.github.com/users/andrewnitu/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-10-23T01:03:31Z","performed_via_github_app":null},{"id":3911685465,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM5MTE2ODU0NjU=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3911685465","actor":{"login":"andrewnitu","id":20518204,"node_id":"MDQ6VXNlcjIwNTE4MjA0","avatar_url":"https://avatars.githubusercontent.com/u/20518204?v=4","gravatar_id":"","url":"https://api.github.com/users/andrewnitu","html_url":"https://github.com/andrewnitu","followers_url":"https://api.github.com/users/andrewnitu/followers","following_url":"https://api.github.com/users/andrewnitu/following{/other_user}","gists_url":"https://api.github.com/users/andrewnitu/gists{/gist_id}","starred_url":"https://api.github.com/users/andrewnitu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrewnitu/subscriptions","organizations_url":"https://api.github.com/users/andrewnitu/orgs","repos_url":"https://api.github.com/users/andrewnitu/repos","events_url":"https://api.github.com/users/andrewnitu/events{/privacy}","received_events_url":"https://api.github.com/users/andrewnitu/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-10-23T01:03:31Z","performed_via_github_app":null},{"id":3911719969,"node_id":"MDEyOkxhYmVsZWRFdmVudDM5MTE3MTk5Njk=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3911719969","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-10-23T01:23:22Z","label":{"name":"bug","color":"d73a4a"},"performed_via_github_app":null},{"id":3911720100,"node_id":"MDEyOkxhYmVsZWRFdmVudDM5MTE3MjAxMDA=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3911720100","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-10-23T01:23:27Z","label":{"name":"priority/important-soon","color":"534cb5"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/714994583","html_url":"https://github.com/mlflow/mlflow/issues/3574#issuecomment-714994583","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/3574","id":714994583,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNDk5NDU4Mw==","user":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"created_at":"2020-10-23T06:48:22Z","updated_at":"2020-10-23T06:50:15Z","author_association":"COLLABORATOR","body":"Hi folks, I dug into this and found the root cause + a potential fix. There were two issues - one in gorilla itself and one with our usage of gorilla: \r\n\r\n1. In gorilla 0.3.0, applying a patch that stores a hit to a parent class (e.g., `CountVectorizer`) forces `get_original_attribute` of its children to refer to the parent class attribute, even if we patch the child later on. I.e.\r\n\r\nThis ordering is okay\r\n```\r\ngorilla.Patch(<TfidfVectorizer>)\r\ngorilla.Patch(<CountVectorizer>)\r\n```\r\n\r\nbut this ordering is not\r\n\r\n```\r\ngorilla.Patch(<CountVectorizer>)\r\ngorilla.Patch(<TfidfVectorizer>)\r\n```\r\n\r\nThis appears to be caused by the following line that prevents the original attribute from being overwritten once it's set: https://github.com/christophercrouzet/gorilla/blob/0c895b34311b6546bde35854e24862c001279add/gorilla.py#L280. As a result, setting the attribute on the parent, which sets the original attribute on the child if the child does not already define it, means that the child is always stuck with the parent's original attribute. This seems to be fixed in the `master` branch of gorilla but has not been released. Either we can pull in the copy from `master` or pull in a copy from 0.3.0 that removes this problematic `hasattr` check.\r\n\r\n2. In `fit_mlflow` and `fit_predict`, we perform `get_original_attribute(self, func_name)`. In the case where we're in a super class function (e.g., `CountVectorizer.fit_transform()`), `self` still refers to the subclass (e.g., `TfidfVectorizer`). As a result, calling `get_original_attribute` in the patched super class method fetches invokes the patched subclass method, which creates the infinite recursion problem observed in the issue description. I've filed https://github.com/mlflow/mlflow/pull/3582/ to address this problem by fetching the original function attribute by reference to a class rather than by reference to `self`. This PR still needs docs & tests, and it needs to incorporate a fix for (1) before it's mergeable.\r\n\r\n@harupy Let me know what your thoughts are here.","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/714994583/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false}},{"id":3912372387,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzkxMjM3MjM4Nw==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3912372387","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-10-23T06:48:22Z","performed_via_github_app":null},{"id":3912372393,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM5MTIzNzIzOTM=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3912372393","actor":{"login":"harupy","id":17039389,"node_id":"MDQ6VXNlcjE3MDM5Mzg5","avatar_url":"https://avatars.githubusercontent.com/u/17039389?v=4","gravatar_id":"","url":"https://api.github.com/users/harupy","html_url":"https://github.com/harupy","followers_url":"https://api.github.com/users/harupy/followers","following_url":"https://api.github.com/users/harupy/following{/other_user}","gists_url":"https://api.github.com/users/harupy/gists{/gist_id}","starred_url":"https://api.github.com/users/harupy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harupy/subscriptions","organizations_url":"https://api.github.com/users/harupy/orgs","repos_url":"https://api.github.com/users/harupy/repos","events_url":"https://api.github.com/users/harupy/events{/privacy}","received_events_url":"https://api.github.com/users/harupy/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-10-23T06:48:22Z","performed_via_github_app":null},{"id":3924167868,"node_id":"MDExOkNsb3NlZEV2ZW50MzkyNDE2Nzg2OA==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/3924167868","actor":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-10-27T06:26:43Z","state_reason":null,"performed_via_github_app":null}]