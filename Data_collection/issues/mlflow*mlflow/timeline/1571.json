[{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/510758837","html_url":"https://github.com/mlflow/mlflow/issues/1571#issuecomment-510758837","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/1571","id":510758837,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMDc1ODgzNw==","user":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false},"created_at":"2019-07-12T06:05:59Z","updated_at":"2019-07-12T06:05:59Z","author_association":"COLLABORATOR","body":"@jdlesage Thank you for raising this concern. Regarding the ListRuns performance issue with a large number of metrics, it seems reasonable to create a new database table containing the latest metric for each run (e.g., the metric with the maximum step, timestamp, and value); ListRuns can then read from this table without fetching all metrics for each run. `LogMetric` can then write to both tables: the table consisting of metric timeseries and the table consisting of latest metric values. We would be more than happy to review and merge a PR that implements this proposal!\r\n\r\nRegarding the database size problem, it might make sense to log metric values less frequently. Perhaps logging a metric every 10-20 steps is sufficient if the aggregate number of steps per metric is very large. Alternatively, we recommend using a scalable, SQLAlchemy-compatible database in order to meet storage capacity requirements.\r\n\r\nIt would be useful to know how many distinct metrics you're logging for each run and how many timeseries (\"step\") entries you're logging per metric. Can you provide this information?\r\n\r\n","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/510758837/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dbczumar","id":39497902,"node_id":"MDQ6VXNlcjM5NDk3OTAy","avatar_url":"https://avatars.githubusercontent.com/u/39497902?v=4","gravatar_id":"","url":"https://api.github.com/users/dbczumar","html_url":"https://github.com/dbczumar","followers_url":"https://api.github.com/users/dbczumar/followers","following_url":"https://api.github.com/users/dbczumar/following{/other_user}","gists_url":"https://api.github.com/users/dbczumar/gists{/gist_id}","starred_url":"https://api.github.com/users/dbczumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbczumar/subscriptions","organizations_url":"https://api.github.com/users/dbczumar/orgs","repos_url":"https://api.github.com/users/dbczumar/repos","events_url":"https://api.github.com/users/dbczumar/events{/privacy}","received_events_url":"https://api.github.com/users/dbczumar/received_events","type":"User","site_admin":false}},{"id":2478002959,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjQ3ODAwMjk1OQ==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/2478002959","actor":{"login":"jdlesage","id":658597,"node_id":"MDQ6VXNlcjY1ODU5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/658597?v=4","gravatar_id":"","url":"https://api.github.com/users/jdlesage","html_url":"https://github.com/jdlesage","followers_url":"https://api.github.com/users/jdlesage/followers","following_url":"https://api.github.com/users/jdlesage/following{/other_user}","gists_url":"https://api.github.com/users/jdlesage/gists{/gist_id}","starred_url":"https://api.github.com/users/jdlesage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdlesage/subscriptions","organizations_url":"https://api.github.com/users/jdlesage/orgs","repos_url":"https://api.github.com/users/jdlesage/repos","events_url":"https://api.github.com/users/jdlesage/events{/privacy}","received_events_url":"https://api.github.com/users/jdlesage/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-07-12T06:05:59Z","performed_via_github_app":null},{"id":2478002960,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI0NzgwMDI5NjA=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/2478002960","actor":{"login":"jdlesage","id":658597,"node_id":"MDQ6VXNlcjY1ODU5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/658597?v=4","gravatar_id":"","url":"https://api.github.com/users/jdlesage","html_url":"https://github.com/jdlesage","followers_url":"https://api.github.com/users/jdlesage/followers","following_url":"https://api.github.com/users/jdlesage/following{/other_user}","gists_url":"https://api.github.com/users/jdlesage/gists{/gist_id}","starred_url":"https://api.github.com/users/jdlesage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdlesage/subscriptions","organizations_url":"https://api.github.com/users/jdlesage/orgs","repos_url":"https://api.github.com/users/jdlesage/repos","events_url":"https://api.github.com/users/jdlesage/events{/privacy}","received_events_url":"https://api.github.com/users/jdlesage/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-07-12T06:05:59Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/510851568","html_url":"https://github.com/mlflow/mlflow/issues/1571#issuecomment-510851568","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/1571","id":510851568,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMDg1MTU2OA==","user":{"login":"jdlesage","id":658597,"node_id":"MDQ6VXNlcjY1ODU5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/658597?v=4","gravatar_id":"","url":"https://api.github.com/users/jdlesage","html_url":"https://github.com/jdlesage","followers_url":"https://api.github.com/users/jdlesage/followers","following_url":"https://api.github.com/users/jdlesage/following{/other_user}","gists_url":"https://api.github.com/users/jdlesage/gists{/gist_id}","starred_url":"https://api.github.com/users/jdlesage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdlesage/subscriptions","organizations_url":"https://api.github.com/users/jdlesage/orgs","repos_url":"https://api.github.com/users/jdlesage/repos","events_url":"https://api.github.com/users/jdlesage/events{/privacy}","received_events_url":"https://api.github.com/users/jdlesage/received_events","type":"User","site_admin":false},"created_at":"2019-07-12T11:25:37Z","updated_at":"2019-07-12T11:25:37Z","author_association":"CONTRIBUTOR","body":"Agree. I will do soon a PR to create the separate table and compare performance.\r\n\r\nWe also advised our teams to reduce the frequency. It would be nice to implement something that enforces this policy. (sampling at the end of the run ?).  It could be another nice PR.\r\n\r\nFYI, in our database the \"biggest\" run is:\r\n2500 steps per metrics\r\n25 distinct metrics per run\r\n\r\nOur database is currently a MariaDB (version 10.3.11)","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/510851568/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jdlesage","id":658597,"node_id":"MDQ6VXNlcjY1ODU5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/658597?v=4","gravatar_id":"","url":"https://api.github.com/users/jdlesage","html_url":"https://github.com/jdlesage","followers_url":"https://api.github.com/users/jdlesage/followers","following_url":"https://api.github.com/users/jdlesage/following{/other_user}","gists_url":"https://api.github.com/users/jdlesage/gists{/gist_id}","starred_url":"https://api.github.com/users/jdlesage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdlesage/subscriptions","organizations_url":"https://api.github.com/users/jdlesage/orgs","repos_url":"https://api.github.com/users/jdlesage/repos","events_url":"https://api.github.com/users/jdlesage/events{/privacy}","received_events_url":"https://api.github.com/users/jdlesage/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/512846379","html_url":"https://github.com/mlflow/mlflow/issues/1571#issuecomment-512846379","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/1571","id":512846379,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjg0NjM3OQ==","user":{"login":"t-henri","id":51711739,"node_id":"MDQ6VXNlcjUxNzExNzM5","avatar_url":"https://avatars.githubusercontent.com/u/51711739?v=4","gravatar_id":"","url":"https://api.github.com/users/t-henri","html_url":"https://github.com/t-henri","followers_url":"https://api.github.com/users/t-henri/followers","following_url":"https://api.github.com/users/t-henri/following{/other_user}","gists_url":"https://api.github.com/users/t-henri/gists{/gist_id}","starred_url":"https://api.github.com/users/t-henri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/t-henri/subscriptions","organizations_url":"https://api.github.com/users/t-henri/orgs","repos_url":"https://api.github.com/users/t-henri/repos","events_url":"https://api.github.com/users/t-henri/events{/privacy}","received_events_url":"https://api.github.com/users/t-henri/received_events","type":"User","site_admin":false},"created_at":"2019-07-18T14:44:18Z","updated_at":"2019-07-18T14:44:18Z","author_association":"CONTRIBUTOR","body":"Hello,\r\n\r\nI am working with @jdlesage on our mlflow server, I was looking into this issue and I found two separate causes for the slowness of the UI:\r\n\r\n- There is a for loop in the python code used to keep only the last metrics for a specific run (in mlflow/store/dbmodels/models.py), and when we list runs we spend around 75% of the time in this loop. In our case, the page takes 7 seconds to load and we spend 5.5 seconds in this loop.\r\n\r\n- We do a lot of sql queries, to load the page we make one query to get the list of runs, then we do three queries per run, one for its metrics, one for its tags and one for its params. So if you have 100 runs, it makes 301 queries to the database.\r\n\r\nI think we could greatly improve this by replacing all those queries and the python loop by a single sql JOIN with the right filter to get only the metrics with the last step. \r\n\r\nWhat do you think ?","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/512846379/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"t-henri","id":51711739,"node_id":"MDQ6VXNlcjUxNzExNzM5","avatar_url":"https://avatars.githubusercontent.com/u/51711739?v=4","gravatar_id":"","url":"https://api.github.com/users/t-henri","html_url":"https://github.com/t-henri","followers_url":"https://api.github.com/users/t-henri/followers","following_url":"https://api.github.com/users/t-henri/following{/other_user}","gists_url":"https://api.github.com/users/t-henri/gists{/gist_id}","starred_url":"https://api.github.com/users/t-henri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/t-henri/subscriptions","organizations_url":"https://api.github.com/users/t-henri/orgs","repos_url":"https://api.github.com/users/t-henri/repos","events_url":"https://api.github.com/users/t-henri/events{/privacy}","received_events_url":"https://api.github.com/users/t-henri/received_events","type":"User","site_admin":false}},{"id":2492965951,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjQ5Mjk2NTk1MQ==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/2492965951","actor":{"login":"jdlesage","id":658597,"node_id":"MDQ6VXNlcjY1ODU5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/658597?v=4","gravatar_id":"","url":"https://api.github.com/users/jdlesage","html_url":"https://github.com/jdlesage","followers_url":"https://api.github.com/users/jdlesage/followers","following_url":"https://api.github.com/users/jdlesage/following{/other_user}","gists_url":"https://api.github.com/users/jdlesage/gists{/gist_id}","starred_url":"https://api.github.com/users/jdlesage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdlesage/subscriptions","organizations_url":"https://api.github.com/users/jdlesage/orgs","repos_url":"https://api.github.com/users/jdlesage/repos","events_url":"https://api.github.com/users/jdlesage/events{/privacy}","received_events_url":"https://api.github.com/users/jdlesage/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-07-18T14:44:18Z","performed_via_github_app":null},{"id":2492965954,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI0OTI5NjU5NTQ=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/2492965954","actor":{"login":"jdlesage","id":658597,"node_id":"MDQ6VXNlcjY1ODU5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/658597?v=4","gravatar_id":"","url":"https://api.github.com/users/jdlesage","html_url":"https://github.com/jdlesage","followers_url":"https://api.github.com/users/jdlesage/followers","following_url":"https://api.github.com/users/jdlesage/following{/other_user}","gists_url":"https://api.github.com/users/jdlesage/gists{/gist_id}","starred_url":"https://api.github.com/users/jdlesage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdlesage/subscriptions","organizations_url":"https://api.github.com/users/jdlesage/orgs","repos_url":"https://api.github.com/users/jdlesage/repos","events_url":"https://api.github.com/users/jdlesage/events{/privacy}","received_events_url":"https://api.github.com/users/jdlesage/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-07-18T14:44:18Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/517601854","html_url":"https://github.com/mlflow/mlflow/issues/1571#issuecomment-517601854","issue_url":"https://api.github.com/repos/mlflow/mlflow/issues/1571","id":517601854,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNzYwMTg1NA==","user":{"login":"jdlesage","id":658597,"node_id":"MDQ6VXNlcjY1ODU5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/658597?v=4","gravatar_id":"","url":"https://api.github.com/users/jdlesage","html_url":"https://github.com/jdlesage","followers_url":"https://api.github.com/users/jdlesage/followers","following_url":"https://api.github.com/users/jdlesage/following{/other_user}","gists_url":"https://api.github.com/users/jdlesage/gists{/gist_id}","starred_url":"https://api.github.com/users/jdlesage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdlesage/subscriptions","organizations_url":"https://api.github.com/users/jdlesage/orgs","repos_url":"https://api.github.com/users/jdlesage/repos","events_url":"https://api.github.com/users/jdlesage/events{/privacy}","received_events_url":"https://api.github.com/users/jdlesage/received_events","type":"User","site_admin":false},"created_at":"2019-08-02T08:03:25Z","updated_at":"2019-08-02T08:03:25Z","author_association":"CONTRIBUTOR","body":"@t-henri PR fixes the problem. I close the issue.","reactions":{"url":"https://api.github.com/repos/mlflow/mlflow/issues/comments/517601854/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jdlesage","id":658597,"node_id":"MDQ6VXNlcjY1ODU5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/658597?v=4","gravatar_id":"","url":"https://api.github.com/users/jdlesage","html_url":"https://github.com/jdlesage","followers_url":"https://api.github.com/users/jdlesage/followers","following_url":"https://api.github.com/users/jdlesage/following{/other_user}","gists_url":"https://api.github.com/users/jdlesage/gists{/gist_id}","starred_url":"https://api.github.com/users/jdlesage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdlesage/subscriptions","organizations_url":"https://api.github.com/users/jdlesage/orgs","repos_url":"https://api.github.com/users/jdlesage/repos","events_url":"https://api.github.com/users/jdlesage/events{/privacy}","received_events_url":"https://api.github.com/users/jdlesage/received_events","type":"User","site_admin":false}},{"id":2528872146,"node_id":"MDExOkNsb3NlZEV2ZW50MjUyODg3MjE0Ng==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/2528872146","actor":{"login":"jdlesage","id":658597,"node_id":"MDQ6VXNlcjY1ODU5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/658597?v=4","gravatar_id":"","url":"https://api.github.com/users/jdlesage","html_url":"https://github.com/jdlesage","followers_url":"https://api.github.com/users/jdlesage/followers","following_url":"https://api.github.com/users/jdlesage/following{/other_user}","gists_url":"https://api.github.com/users/jdlesage/gists{/gist_id}","starred_url":"https://api.github.com/users/jdlesage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdlesage/subscriptions","organizations_url":"https://api.github.com/users/jdlesage/orgs","repos_url":"https://api.github.com/users/jdlesage/repos","events_url":"https://api.github.com/users/jdlesage/events{/privacy}","received_events_url":"https://api.github.com/users/jdlesage/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-08-02T08:03:25Z","state_reason":null,"performed_via_github_app":null},{"id":2528872151,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjUyODg3MjE1MQ==","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/2528872151","actor":{"login":"t-henri","id":51711739,"node_id":"MDQ6VXNlcjUxNzExNzM5","avatar_url":"https://avatars.githubusercontent.com/u/51711739?v=4","gravatar_id":"","url":"https://api.github.com/users/t-henri","html_url":"https://github.com/t-henri","followers_url":"https://api.github.com/users/t-henri/followers","following_url":"https://api.github.com/users/t-henri/following{/other_user}","gists_url":"https://api.github.com/users/t-henri/gists{/gist_id}","starred_url":"https://api.github.com/users/t-henri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/t-henri/subscriptions","organizations_url":"https://api.github.com/users/t-henri/orgs","repos_url":"https://api.github.com/users/t-henri/repos","events_url":"https://api.github.com/users/t-henri/events{/privacy}","received_events_url":"https://api.github.com/users/t-henri/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-08-02T08:03:25Z","performed_via_github_app":null},{"id":2528872154,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI1Mjg4NzIxNTQ=","url":"https://api.github.com/repos/mlflow/mlflow/issues/events/2528872154","actor":{"login":"t-henri","id":51711739,"node_id":"MDQ6VXNlcjUxNzExNzM5","avatar_url":"https://avatars.githubusercontent.com/u/51711739?v=4","gravatar_id":"","url":"https://api.github.com/users/t-henri","html_url":"https://github.com/t-henri","followers_url":"https://api.github.com/users/t-henri/followers","following_url":"https://api.github.com/users/t-henri/following{/other_user}","gists_url":"https://api.github.com/users/t-henri/gists{/gist_id}","starred_url":"https://api.github.com/users/t-henri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/t-henri/subscriptions","organizations_url":"https://api.github.com/users/t-henri/orgs","repos_url":"https://api.github.com/users/t-henri/repos","events_url":"https://api.github.com/users/t-henri/events{/privacy}","received_events_url":"https://api.github.com/users/t-henri/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-08-02T08:03:25Z","performed_via_github_app":null}]