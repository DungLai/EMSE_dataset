{"url":"https://api.github.com/repos/TimoBolkart/TF_FLAME/issues/56","repository_url":"https://api.github.com/repos/TimoBolkart/TF_FLAME","labels_url":"https://api.github.com/repos/TimoBolkart/TF_FLAME/issues/56/labels{/name}","comments_url":"https://api.github.com/repos/TimoBolkart/TF_FLAME/issues/56/comments","events_url":"https://api.github.com/repos/TimoBolkart/TF_FLAME/issues/56/events","html_url":"https://github.com/TimoBolkart/TF_FLAME/issues/56","id":1087194200,"node_id":"I_kwDOCzszic5AzURY","number":56,"title":"Help with projection Matrix","user":{"login":"josephbiko","id":17003173,"node_id":"MDQ6VXNlcjE3MDAzMTcz","avatar_url":"https://avatars.githubusercontent.com/u/17003173?v=4","gravatar_id":"","url":"https://api.github.com/users/josephbiko","html_url":"https://github.com/josephbiko","followers_url":"https://api.github.com/users/josephbiko/followers","following_url":"https://api.github.com/users/josephbiko/following{/other_user}","gists_url":"https://api.github.com/users/josephbiko/gists{/gist_id}","starred_url":"https://api.github.com/users/josephbiko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/josephbiko/subscriptions","organizations_url":"https://api.github.com/users/josephbiko/orgs","repos_url":"https://api.github.com/users/josephbiko/repos","events_url":"https://api.github.com/users/josephbiko/events{/privacy}","received_events_url":"https://api.github.com/users/josephbiko/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-12-22T21:14:46Z","updated_at":"2021-12-22T21:16:21Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"I am trying to calculate the pixel coordinates of the landmarks.\r\n(Parameters are copied from the render helper).\r\n\r\n\r\n```\r\ndef viewport(x, y, w, h):\r\n    x, y, w, h = map(float, (x, y, w, h))\r\n    return np.matrix([[w/2, 0  , 0,x+w/2],\r\n                      [0  , h/2, 0,y+h/2],\r\n                      [0  , 0  , 0.5,  0.5],\r\n                      [0  , 0  , 0,    1]])\r\n\r\nsize = 800\r\n\r\nfrustum_ = {'near': 0.01, 'far': 3.0, 'height': 800, 'width': 800}\r\ncamera_params = {'c': np.array([400, 400]),\r\n                 'k': np.array([-0.19816071, 0.92822711, 0, 0, 0]),\r\n                 'f': np.array([4754.97941935 / 2, 4754.97941935 / 2])}\r\n\r\nlandmarks = mesh_points_by_barycentric_coordinates(m.v,m.f,flame_embedding['lmk_face_idx'],flame_embedding['lmk_b_coords'])\r\n \r\n\r\n\r\npose_mat = [[1, 0, 0, 0],\r\n            [0, 1, 0, 0],\r\n            [0, 0, 1, 1],\r\n            [0, 0, 0, 1]]\r\n\r\ncamera = pyrender.IntrinsicsCamera(fx=camera_params['f'][0],\r\n                                  fy=camera_params['f'][1],\r\n                                  cx=camera_params['c'][0],\r\n                                  cy=camera_params['c'][1],\r\n                                  znear=frustum_['near'],\r\n                                  zfar=frustum_['far'])\r\n\r\nP = camera.get_projection_matrix(size,size)\r\nV = np.linalg.inv(pose_mat)\r\nM = np.eye(4)\r\nVw= viewport(0,0,size,size)\r\n\r\nlandmarks_expanded = np.ones((68,4)) \r\nlandmarks_expanded[:68,:3] = landmarks\r\n\r\nexpanded = (Vw@P@V@landmarks_expanded.T).T\r\nplt.scatter([expanded[:,0]],[expanded[:,1]])\r\nplt.show()\r\nplt.scatter([landmarks[:,0]],[landmarks[:,1]])\r\nplt.show()\r\n```\r\n` \r\nBut the resulting image is a bit skewed.\r\nI'm probably doing something wrong... but not sure what.\r\nAny help would be greatly appreciated!\r\n\r\n![image](https://user-images.githubusercontent.com/17003173/147155889-83106b72-dd15-4a9b-8af2-e847eb2a3364.png)\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/TimoBolkart/TF_FLAME/issues/56/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/TimoBolkart/TF_FLAME/issues/56/timeline","performed_via_github_app":null,"state_reason":null}