{"url":"https://api.github.com/repos/TimoBolkart/TF_FLAME/issues/17","repository_url":"https://api.github.com/repos/TimoBolkart/TF_FLAME","labels_url":"https://api.github.com/repos/TimoBolkart/TF_FLAME/issues/17/labels{/name}","comments_url":"https://api.github.com/repos/TimoBolkart/TF_FLAME/issues/17/comments","events_url":"https://api.github.com/repos/TimoBolkart/TF_FLAME/issues/17/events","html_url":"https://github.com/TimoBolkart/TF_FLAME/issues/17","id":583657387,"node_id":"MDU6SXNzdWU1ODM2NTczODc=","number":17,"title":"fit_2d_landmarks.py Pyglet error","user":{"login":"plmsmile","id":17981649,"node_id":"MDQ6VXNlcjE3OTgxNjQ5","avatar_url":"https://avatars.githubusercontent.com/u/17981649?v=4","gravatar_id":"","url":"https://api.github.com/users/plmsmile","html_url":"https://github.com/plmsmile","followers_url":"https://api.github.com/users/plmsmile/followers","following_url":"https://api.github.com/users/plmsmile/following{/other_user}","gists_url":"https://api.github.com/users/plmsmile/gists{/gist_id}","starred_url":"https://api.github.com/users/plmsmile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/plmsmile/subscriptions","organizations_url":"https://api.github.com/users/plmsmile/orgs","repos_url":"https://api.github.com/users/plmsmile/repos","events_url":"https://api.github.com/users/plmsmile/events{/privacy}","received_events_url":"https://api.github.com/users/plmsmile/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-03-18T11:22:20Z","updated_at":"2020-08-07T12:47:41Z","closed_at":"2020-08-07T12:47:41Z","author_association":"NONE","active_lock_reason":null,"body":"Thanks the great work share~ I am trying the demo, run the following command on my Mac.\r\n``` shell\r\nimg_name=\"imgHQ00088.jpeg\"\r\npython fit_2D_landmarks.py \\\r\n    --tf_model_fname './models/generic_model' \\\r\n    --template_fname './data/template.ply' \\\r\n    --flame_lmk_path './data/flame_static_embedding.pkl'\\\r\n    --texture_mapping './data/texture_data.npy' \\\r\n    --target_img_path \"./data/${img_name}\" \\\r\n    --target_lmk_path './data/imgHQ00088_lmks.npy' \\\r\n    --out_path './results'\r\n```\r\nHowever, it always have a problem after some minutes. And I have tried other image and other versions of pyrender, pyglet. Sadly, the error always is there. I hope maybe you can give me some advice. Thank you very much~~\r\n\r\n``` shell\r\nlmk_dist: 0.015134, shape_reg: 0.004308, exp_reg: 0.002860, neck_pose_reg: 0.000000, jaw_pose_reg: 0.000016, eyeballs_pose_reg: 0.000000\r\nlmk_dist: 0.015124, shape_reg: 0.004314, exp_reg: 0.002863, neck_pose_reg: 0.000000, jaw_pose_reg: 0.000016, eyeballs_pose_reg: 0.000000\r\nlmk_dist: 0.015116, shape_reg: 0.004319, exp_reg: 0.002866, neck_pose_reg: 0.000000, jaw_pose_reg: 0.000016, eyeballs_pose_reg: 0.000000\r\nlmk_dist: 0.015107, shape_reg: 0.004325, exp_reg: 0.002869, neck_pose_reg: 0.000000, jaw_pose_reg: 0.000016, eyeballs_pose_reg: 0.000000\r\nTraceback (most recent call last):\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/pyrender/platforms/pyglet_platform.py\", line 32, in init_context\r\n    width=1, height=1)\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/pyglet/window/__init__.py\", line 632, in __init__\r\n    self._create()\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/pyglet/window/cocoa/__init__.py\", line 194, in _create\r\n    self.context.attach(self.canvas)\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/pyglet/gl/cocoa.py\", line 291, in attach\r\n    self._nscontext.setView_(canvas.nsview)\r\nAttributeError: 'NoneType' object has no attribute 'setView_'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"fit_2D_landmarks.py\", line 215, in <module>\r\n    run_2d_lmk_fitting(args.tf_model_fname, args.template_fname, args.flame_lmk_path, args.texture_mapping, args.target_img_path, args.target_lmk_path, args.out_path)\r\nFile \"fit_2D_landmarks.py\", line 171, in run_2d_lmk_fitting\r\n    result_mesh, result_scale = fit_lmk2d(target_img, lmk_2d, template_fname, tf_model_fname, lmk_face_idx, lmk_b_coords, weights)\r\n  File \"fit_2D_landmarks.py\", line 126, in fit_lmk2d\r\n    lmk_dist, shape_reg, exp_reg, neck_pose_reg, jaw_pose_reg, eyeballs_pose_reg], loss_callback=on_step)\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/tensorflow/contrib/opt/python/training/external_optimizer.py\", line 207, in minimize\r\n    optimizer_kwargs=self.optimizer_kwargs)\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/tensorflow/contrib/opt/python/training/external_optimizer.py\", line 402, in _minimize\r\n    result = scipy.optimize.minimize(*minimize_args, **minimize_kwargs)\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/scipy/optimize/_minimize.py\", line 610, in minimize\r\n    callback=callback, **options)\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/scipy/optimize/lbfgsb.py\", line 345, in _minimize_lbfgsb\r\n    f, g = func_and_grad(x)\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/scipy/optimize/lbfgsb.py\", line 295, in func_and_grad\r\n    f = fun(x, *args)\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/scipy/optimize/optimize.py\", line 327, in function_wrapper\r\n    return function(*(wrapper_args + args))\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/scipy/optimize/optimize.py\", line 65, in __call__\r\n    fg = self.fun(x, *args)\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/tensorflow/contrib/opt/python/training/external_optimizer.py\", line 367, in loss_grad_func_wrapper\r\n    loss, gradient = loss_grad_func(x)\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/tensorflow/contrib/opt/python/training/external_optimizer.py\", line 281, in eval_func\r\n    callback(*augmented_fetch_vals[num_tensors:])\r\n  File \"fit_2D_landmarks.py\", line 106, in on_step\r\n    rendered_img = render_mesh(Mesh(scale*verts, faces), height=target_img.shape[0], width=target_img.shape[1])\r\n  File \"/Users/plm/pro/TF_FLAME/utils/render_mesh.py\", line 30, in render_mesh\r\n    r = pyrender.OffscreenRenderer(viewport_width=width, viewport_height=height)\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/pyrender/offscreen.py\", line 31, in __init__\r\n    self._create()\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/pyrender/offscreen.py\", line 134, in _create\r\n    self._platform.init_context()\r\n  File \"/Users/plm/app/anaconda3/envs/flame/lib/python3.6/site-packages/pyrender/platforms/pyglet_platform.py\", line 38, in init_context\r\n    'internal error message was \"{}\"'.format(e)\r\nValueError: Failed to initialize Pyglet window with an OpenGL >= 3+ context. If you're logged in via SSH, ensure that you're running your script with vglrun (i.e. VirtualGL). The internal error message was \"'NoneType' object has no attribute 'setView_'\"\r\n\r\n```","closed_by":{"login":"TimoBolkart","id":26549953,"node_id":"MDQ6VXNlcjI2NTQ5OTUz","avatar_url":"https://avatars.githubusercontent.com/u/26549953?v=4","gravatar_id":"","url":"https://api.github.com/users/TimoBolkart","html_url":"https://github.com/TimoBolkart","followers_url":"https://api.github.com/users/TimoBolkart/followers","following_url":"https://api.github.com/users/TimoBolkart/following{/other_user}","gists_url":"https://api.github.com/users/TimoBolkart/gists{/gist_id}","starred_url":"https://api.github.com/users/TimoBolkart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TimoBolkart/subscriptions","organizations_url":"https://api.github.com/users/TimoBolkart/orgs","repos_url":"https://api.github.com/users/TimoBolkart/repos","events_url":"https://api.github.com/users/TimoBolkart/events{/privacy}","received_events_url":"https://api.github.com/users/TimoBolkart/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/TimoBolkart/TF_FLAME/issues/17/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/TimoBolkart/TF_FLAME/issues/17/timeline","performed_via_github_app":null,"state_reason":"completed"}