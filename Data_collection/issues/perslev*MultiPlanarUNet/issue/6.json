{"url":"https://api.github.com/repos/perslev/MultiPlanarUNet/issues/6","repository_url":"https://api.github.com/repos/perslev/MultiPlanarUNet","labels_url":"https://api.github.com/repos/perslev/MultiPlanarUNet/issues/6/labels{/name}","comments_url":"https://api.github.com/repos/perslev/MultiPlanarUNet/issues/6/comments","events_url":"https://api.github.com/repos/perslev/MultiPlanarUNet/issues/6/events","html_url":"https://github.com/perslev/MultiPlanarUNet/issues/6","id":520003624,"node_id":"MDU6SXNzdWU1MjAwMDM2MjQ=","number":6,"title":"Memory Error and Lack of GPU Usage","user":{"login":"admshumar","id":31727606,"node_id":"MDQ6VXNlcjMxNzI3NjA2","avatar_url":"https://avatars.githubusercontent.com/u/31727606?v=4","gravatar_id":"","url":"https://api.github.com/users/admshumar","html_url":"https://github.com/admshumar","followers_url":"https://api.github.com/users/admshumar/followers","following_url":"https://api.github.com/users/admshumar/following{/other_user}","gists_url":"https://api.github.com/users/admshumar/gists{/gist_id}","starred_url":"https://api.github.com/users/admshumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/admshumar/subscriptions","organizations_url":"https://api.github.com/users/admshumar/orgs","repos_url":"https://api.github.com/users/admshumar/repos","events_url":"https://api.github.com/users/admshumar/events{/privacy}","received_events_url":"https://api.github.com/users/admshumar/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-11-08T13:03:44Z","updated_at":"2019-11-12T13:49:55Z","closed_at":"2019-11-12T13:49:55Z","author_association":"NONE","active_lock_reason":null,"body":"I'm attempting to train a Multi-planar U-Net with MPUNet 0.2.2 on an Ubuntu 18.04.3 LTS virtual machine with an Nvidia Tesla K80 GPU. Executing the command \"mp train --force_GPU=true\" produces a run through the training data:\r\n\r\n> --------------------------------------------------------------------------------\r\n> >>>Logged by: 'prepare_for_iso_live' in 'image_pair.py'\r\n> OBS: Using 1 percentile BG value of [32768.0, 32768.0, 32768.0, -5.138273081684019e-06, 0.0]\r\n> 1012_NSK47177\r\n> --- shape:      [108 162 100   5]\r\n> --- real shape: [108. 162. 100.]\r\n> --- pixdim:     [1. 1. 1.]\r\n> --------------------------------------------------------------------------------\r\n> >>> Logged by: 'prepare_for_iso_live' in 'image_pair.py' ...\r\n\r\nBut it leads to the following error:\r\n\r\n`Traceback (most recent call last):\r\n  File \"/usr/local/bin/mp\", line 11, in <module>\r\n    load_entry_point('MultiPlanarUNet==0.2.2', 'console_scripts', 'mp')()\r\n  File \"/usr/local/lib/python3.6/dist-packages/MultiPlanarUNet-0.2.2-py3.6.egg/MultiPlanarUNet/bin/mp.py\", line 55, in entry_func\r\n    mod.entry_func(parsed.args)\r\n  File \"/usr/local/lib/python3.6/dist-packages/MultiPlanarUNet-0.2.2-py3.6.egg/MultiPlanarUNet/bin/train.py\", line 398, in entry_func\r\n    raise e\r\n  File \"/usr/local/lib/python3.6/dist-packages/MultiPlanarUNet-0.2.2-py3.6.egg/MultiPlanarUNet/bin/train.py\", line 394, in entry_func\r\n    run(project_dir=project_dir, gpu_mon=gpu_mon, logger=logger, args=args)\r\n  File \"/usr/local/lib/python3.6/dist-packages/MultiPlanarUNet-0.2.2-py3.6.egg/MultiPlanarUNet/bin/train.py\", line 331, in run\r\n    args=args)\r\n  File \"/usr/local/lib/python3.6/dist-packages/MultiPlanarUNet-0.2.2-py3.6.egg/MultiPlanarUNet/bin/train.py\", line 238, in get_data_sequences\r\n    base_path=project_dir)\r\n  File \"/usr/local/lib/python3.6/dist-packages/MultiPlanarUNet-0.2.2-py3.6.egg/MultiPlanarUNet/preprocessing/data_preparation_funcs.py\", line 176, in prepare_for_multi_view_unet\r\n    is_validation=True, **hparams[\"fit\"])\r\n  File \"/usr/local/lib/python3.6/dist-packages/MultiPlanarUNet-0.2.2-py3.6.egg/MultiPlanarUNet/image/image_pair_loader.py\", line 432, in get_sequencer\r\n    self.prepare_for_iso_live_views(**kwargs)\r\n  File \"/usr/local/lib/python3.6/dist-packages/MultiPlanarUNet-0.2.2-py3.6.egg/MultiPlanarUNet/image/image_pair_loader.py\", line 381, in prepare_for_iso_live_views\r\n    image.prepare_for_iso_live(bg_value, bg_class, scaler)\r\n  File \"/usr/local/lib/python3.6/dist-packages/MultiPlanarUNet-0.2.2-py3.6.egg/MultiPlanarUNet/image/image_pair.py\", line 271, in prepare_for_iso_live\r\n    bg_value = [np.percentile(self.image[..., i], bg_pct) for i in range(self.n_channels)]\r\n  File \"/usr/local/lib/python3.6/dist-packages/MultiPlanarUNet-0.2.2-py3.6.egg/MultiPlanarUNet/image/image_pair.py\", line 271, in <listcomp>\r\n    bg_value = [np.percentile(self.image[..., i], bg_pct) for i in range(self.n_channels)]\r\n  File \"/usr/local/lib/python3.6/dist-packages/MultiPlanarUNet-0.2.2-py3.6.egg/MultiPlanarUNet/image/image_pair.py\", line 147, in image\r\n    dtype=self.im_dtype)\r\n  File \"/usr/local/lib/python3.6/dist-packages/nibabel-2.5.1-py3.6.egg/nibabel/dataobj_images.py\", line 348, in get_fdata\r\n    data = np.asanyarray(self._dataobj).astype(dtype, copy=False)\r\n  File \"/home/akshay/.local/lib/python3.6/site-packages/numpy/core/_asarray.py\", line 138, in asanyarray\r\n    return array(a, dtype, copy=False, order=order, subok=True)\r\n  File \"/usr/local/lib/python3.6/dist-packages/nibabel-2.5.1-py3.6.egg/nibabel/arrayproxy.py\", line 355, in __array__\r\n    raw_data = self.get_unscaled()\r\n  File \"/usr/local/lib/python3.6/dist-packages/nibabel-2.5.1-py3.6.egg/nibabel/arrayproxy.py\", line 350, in get_unscaled\r\n    mmap=self._mmap)\r\n  File \"/usr/local/lib/python3.6/dist-packages/nibabel-2.5.1-py3.6.egg/nibabel/volumeutils.py\", line 524, in array_from_file\r\n    n_read = infile.readinto(data_bytes)\r\n  File \"/usr/lib/python3.6/gzip.py\", line 276, in read\r\n    return self._buffer.read(size)\r\nMemoryError` \r\n\r\nWhat could be causing this? Moreover, running \"nvidia-smi\" shows no active GPU processes. Are there any other ways of checking whether MultiPlanarUNet is interacting with GPUs?\r\n","closed_by":{"login":"perslev","id":12041524,"node_id":"MDQ6VXNlcjEyMDQxNTI0","avatar_url":"https://avatars.githubusercontent.com/u/12041524?v=4","gravatar_id":"","url":"https://api.github.com/users/perslev","html_url":"https://github.com/perslev","followers_url":"https://api.github.com/users/perslev/followers","following_url":"https://api.github.com/users/perslev/following{/other_user}","gists_url":"https://api.github.com/users/perslev/gists{/gist_id}","starred_url":"https://api.github.com/users/perslev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/perslev/subscriptions","organizations_url":"https://api.github.com/users/perslev/orgs","repos_url":"https://api.github.com/users/perslev/repos","events_url":"https://api.github.com/users/perslev/events{/privacy}","received_events_url":"https://api.github.com/users/perslev/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/perslev/MultiPlanarUNet/issues/6/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/perslev/MultiPlanarUNet/issues/6/timeline","performed_via_github_app":null,"state_reason":"completed"}