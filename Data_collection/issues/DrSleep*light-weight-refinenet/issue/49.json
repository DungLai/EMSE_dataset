{"url":"https://api.github.com/repos/DrSleep/light-weight-refinenet/issues/49","repository_url":"https://api.github.com/repos/DrSleep/light-weight-refinenet","labels_url":"https://api.github.com/repos/DrSleep/light-weight-refinenet/issues/49/labels{/name}","comments_url":"https://api.github.com/repos/DrSleep/light-weight-refinenet/issues/49/comments","events_url":"https://api.github.com/repos/DrSleep/light-weight-refinenet/issues/49/events","html_url":"https://github.com/DrSleep/light-weight-refinenet/issues/49","id":483300646,"node_id":"MDU6SXNzdWU0ODMzMDA2NDY=","number":49,"title":"I try to convert .pth.tar to onnx file, please help me!!!","user":{"login":"electronicYH","id":11705091,"node_id":"MDQ6VXNlcjExNzA1MDkx","avatar_url":"https://avatars.githubusercontent.com/u/11705091?v=4","gravatar_id":"","url":"https://api.github.com/users/electronicYH","html_url":"https://github.com/electronicYH","followers_url":"https://api.github.com/users/electronicYH/followers","following_url":"https://api.github.com/users/electronicYH/following{/other_user}","gists_url":"https://api.github.com/users/electronicYH/gists{/gist_id}","starred_url":"https://api.github.com/users/electronicYH/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/electronicYH/subscriptions","organizations_url":"https://api.github.com/users/electronicYH/orgs","repos_url":"https://api.github.com/users/electronicYH/repos","events_url":"https://api.github.com/users/electronicYH/events{/privacy}","received_events_url":"https://api.github.com/users/electronicYH/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-08-21T09:19:25Z","updated_at":"2019-08-25T23:06:35Z","closed_at":"2019-08-25T23:06:35Z","author_association":"NONE","active_lock_reason":null,"body":"amax@amax:/data/yh/light-weight-refinenet$ python make_onnx.py \r\nTraceback (most recent call last):\r\n  File \"make_onnx.py\", line 17, in <module>\r\n    torch.onnx.export(segmenter,dummy_input,\"yh_refinenet.onnx\",verbose=True)\r\n  File \"/home/amax/anaconda3/lib/python3.6/site-packages/torch/onnx/__init__.py\", line 25, in export\r\n    return utils.export(*args, **kwargs)\r\n  File \"/home/amax/anaconda3/lib/python3.6/site-packages/torch/onnx/utils.py\", line 131, in export\r\n    strip_doc_string=strip_doc_string)\r\n  File \"/home/amax/anaconda3/lib/python3.6/site-packages/torch/onnx/utils.py\", line 363, in _export\r\n    _retain_param_name, do_constant_folding)\r\n  File \"/home/amax/anaconda3/lib/python3.6/site-packages/torch/onnx/utils.py\", line 278, in _model_to_graph\r\n    _disable_torch_constant_prop=_disable_torch_constant_prop)\r\n  File \"/home/amax/anaconda3/lib/python3.6/site-packages/torch/onnx/utils.py\", line 183, in _optimize_graph\r\n    torch._C._jit_pass_lower_all_tuples(graph)\r\nRuntimeError: tuple appears in op that does not forward tuples (VisitNode at /opt/conda/conda-bld/pytorch_1556653099582/work/torch/csrc/jit/passes/lower_tuples.cpp:117)\r\nframe #0: c10::Error::Error(c10::SourceLocation, std::string const&) + 0x45 (0x7fd313353dc5 in /home/amax/anaconda3/lib/python3.6/site-packages/torch/lib/libc10.so)\r\nframe #1: <unknown function> + 0xadf7d0 (0x7fd30e4777d0 in /home/amax/anaconda3/lib/python3.6/site-packages/torch/lib/libtorch.so.1)\r\nframe #2: <unknown function> + 0xadfa34 (0x7fd30e477a34 in /home/amax/anaconda3/lib/python3.6/site-packages/torch/lib/libtorch.so.1)\r\nframe #3: torch::jit::LowerAllTuples(std::shared_ptr<torch::jit::Graph>&) + 0x13 (0x7fd30e477a73 in /home/amax/anaconda3/lib/python3.6/site-packages/torch/lib/libtorch.so.1)\r\nframe #4: <unknown function> + 0x3f59a4 (0x7fd3426259a4 in /home/amax/anaconda3/lib/python3.6/site-packages/torch/lib/libtorch_python.so)\r\nframe #5: <unknown function> + 0x12ce4a (0x7fd34235ce4a in /home/amax/anaconda3/lib/python3.6/site-packages/torch/lib/libtorch_python.so)\r\n<omitting python frames>\r\nframe #36: __libc_start_main + 0xf0 (0x7fd349179830 in /lib/x86_64-linux-gnu/libc.so.6)\r\n\r\n\r\nmy python:\r\n\r\nimport torch\r\nfrom models.resnet import rf_lw50\r\nfrom torch.autograd import Variable\r\n\r\nfile = 'ckpt/checkpoint.pth.tar'\r\n\r\nsegmenter = rf_lw50(15, False)\r\nsegmenter = torch.nn.DataParallel(segmenter)\r\n\r\nckpt = torch.load(file)\r\nsegmenter.load_state_dict(ckpt['segmenter'])\r\nsegmenter.cuda()\r\nsegmenter.eval()\r\n\r\ndummy_input = Variable(torch.randn(1,3,360,640)).cuda()\r\n\r\ntorch.onnx.export(segmenter,dummy_input,\"yh_refinenet.onnx\",verbose=True)","closed_by":{"login":"DrSleep","id":7841432,"node_id":"MDQ6VXNlcjc4NDE0MzI=","avatar_url":"https://avatars.githubusercontent.com/u/7841432?v=4","gravatar_id":"","url":"https://api.github.com/users/DrSleep","html_url":"https://github.com/DrSleep","followers_url":"https://api.github.com/users/DrSleep/followers","following_url":"https://api.github.com/users/DrSleep/following{/other_user}","gists_url":"https://api.github.com/users/DrSleep/gists{/gist_id}","starred_url":"https://api.github.com/users/DrSleep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DrSleep/subscriptions","organizations_url":"https://api.github.com/users/DrSleep/orgs","repos_url":"https://api.github.com/users/DrSleep/repos","events_url":"https://api.github.com/users/DrSleep/events{/privacy}","received_events_url":"https://api.github.com/users/DrSleep/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DrSleep/light-weight-refinenet/issues/49/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DrSleep/light-weight-refinenet/issues/49/timeline","performed_via_github_app":null,"state_reason":"completed"}