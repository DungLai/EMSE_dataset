{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/981","repository_url":"https://api.github.com/repos/dmlc/gluon-nlp","labels_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/981/labels{/name}","comments_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/981/comments","events_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/981/events","html_url":"https://github.com/dmlc/gluon-nlp/issues/981","id":510213605,"node_id":"MDU6SXNzdWU1MTAyMTM2MDU=","number":981,"title":"FastText embeddings not working on MxNET 1.5.1/GluonNLP 0.8.1","user":{"login":"mohammedkhalilia","id":6099774,"node_id":"MDQ6VXNlcjYwOTk3NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/6099774?v=4","gravatar_id":"","url":"https://api.github.com/users/mohammedkhalilia","html_url":"https://github.com/mohammedkhalilia","followers_url":"https://api.github.com/users/mohammedkhalilia/followers","following_url":"https://api.github.com/users/mohammedkhalilia/following{/other_user}","gists_url":"https://api.github.com/users/mohammedkhalilia/gists{/gist_id}","starred_url":"https://api.github.com/users/mohammedkhalilia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mohammedkhalilia/subscriptions","organizations_url":"https://api.github.com/users/mohammedkhalilia/orgs","repos_url":"https://api.github.com/users/mohammedkhalilia/repos","events_url":"https://api.github.com/users/mohammedkhalilia/events{/privacy}","received_events_url":"https://api.github.com/users/mohammedkhalilia/received_events","type":"User","site_admin":false},"labels":[{"id":890393501,"node_id":"MDU6TGFiZWw4OTAzOTM1MDE=","url":"https://api.github.com/repos/dmlc/gluon-nlp/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"assignees":[{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2019-10-21T19:02:38Z","updated_at":"2019-10-21T21:21:00Z","closed_at":"2019-10-21T21:21:00Z","author_association":"NONE","active_lock_reason":null,"body":"## Description\r\nCalling `gluonnlp.model.train.FasttextEmbeddingModel.load_fasttext_format()` generates an error when using MxNET 1.5.1 and GluonNLP 0.8.1. But the call works when using MxNET 1.4.1 and GluonNLP 0.7.1.\r\n\r\n### Error Message\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/khallia/workspace/CompMedNER/bin/train.py\", line 66, in <module>\r\n    main()\r\n  File \"/home/khallia/workspace/CompMedNER/bin/train.py\", line 38, in main\r\n    Vocab(sentences, wordvectors=config.word_vecs, bert_vocab=config.bert_vocab)\r\n  File \"/home/khallia/workspace/CompMedNER/src/vocab.py\", line 29, in __init__\r\n    Vocab.word = self.create_word_vocab()\r\n  File \"/home/khallia/workspace/CompMedNER/src/vocab.py\", line 120, in create_word_vocab\r\n    model = nlp.model.train.FasttextEmbeddingModel.load_fasttext_format(self.wordvectors)\r\n  File \"/env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/site-packages/gluonnlp/model/train/embedding.py\", line 278, in load_fasttext_format\r\n    self.weight.set_data(nd.array(matrix))\r\n  File \"/env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/site-packages/mxnet/ndarray/utils.py\", line 146, in array\r\n    return _array(source_array, ctx=ctx, dtype=dtype)\r\n  File \"/env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/site-packages/mxnet/ndarray/ndarray.py\", line 2505, in array\r\n    arr[:] = source_array\r\n  File \"/env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/site-packages/mxnet/ndarray/ndarray.py\", line 449, in __setitem__\r\n    self._set_nd_basic_indexing(key, value)\r\n  File \"/env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/site-packages/mxnet/ndarray/ndarray.py\", line 715, in _set_nd_basic_indexing\r\n    self._sync_copyfrom(value)\r\n  File \"/env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/site-packages/mxnet/ndarray/ndarray.py\", line 881, in _sync_copyfrom\r\n    ctypes.c_size_t(source_array.size)))\r\n  File \"/env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/site-packages/mxnet/base.py\", line 253, in check_call\r\n    raise MXNetError(py_str(_LIB.MXGetLastError()))\r\nmxnet.base.MXNetError: [11:32:50] src/ndarray/ndarray_function.cc:51: Check failed: size == to->Size() (-585876896 vs. 3709090400) : copying size mismatch, from: 18446744071366044032 bytes, to: 14836361600 bytes.\r\nStack trace:\r\n  [bt] (0) /env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/site-packages/mxnet/libmxnet.so(+0x4b04cb) [0x7f350d5a34cb]\r\n  [bt] (1) /env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/site-packages/mxnet/libmxnet.so(+0x281c85b) [0x7f350f90f85b]\r\n  [bt] (2) /env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/site-packages/mxnet/libmxnet.so(mxnet::NDArray::SyncCopyFromCPU(void const*, unsigned long) const+0x27c) [0x7f350f89b59c]\r\n  [bt] (3) /env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/site-packages/mxnet/libmxnet.so(MXNDArraySyncCopyFromCPU+0x2b) [0x7f350f61790b]\r\n  [bt] (4) /env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/lib-dynload/_ctypes.cpython-35m-x86_64-linux-gnu.so(ffi_call_unix64+0x4c) [0x7f354255ee20]\r\n  [bt] (5) /env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/lib-dynload/_ctypes.cpython-35m-x86_64-linux-gnu.so(ffi_call+0x2eb) [0x7f354255e88b]\r\n  [bt] (6) /env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/lib-dynload/_ctypes.cpython-35m-x86_64-linux-gnu.so(_ctypes_callproc+0x49a) [0x7f354255901a]\r\n  [bt] (7) /env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/lib-dynload/_ctypes.cpython-35m-x86_64-linux-gnu.so(+0x9fcb) [0x7f354254cfcb]\r\n  [bt] (8) /env/mx_1.5.1_gnlp_0.8.1/bin/python3(PyObject_Call+0x47) [0x5c20e7]\r\n\r\n```\r\n## To Reproduce\r\n    import mxnet as mx\r\n    import gluonnlp as nlp\r\n    wordvectors = 'BioWordVec_PubMed_MIMICIII_d200.bin'\r\n    model = nlp.model.train.FasttextEmbeddingModel.load_fasttext_format(wordvectors)\r\n\r\n### Steps to reproduce\r\n1. Download the embeddings from here:\r\n    https://ftp.ncbi.nlm.nih.gov/pub/lu/Suppl/BioSentVec/BioWordVec_PubMed_MIMICIII_d200.bin\r\n2. Run the code snippet above.\r\n\r\n## Environment\r\n```\r\nArchitecture:          x86_64\r\nCPU op-mode(s):        32-bit, 64-bit\r\nByte Order:            Little Endian\r\nCPU(s):                64\r\nOn-line CPU(s) list:   0-63\r\nThread(s) per core:    2\r\nCore(s) per socket:    16\r\nSocket(s):             2\r\nNUMA node(s):          2\r\nVendor ID:             GenuineIntel\r\nCPU family:            6\r\nModel:                 79\r\nModel name:            Intel(R) Xeon(R) CPU E5-2686 v4 @ 2.30GHz\r\nStepping:              1\r\nCPU MHz:               2699.984\r\nCPU max MHz:           3000.0000\r\nCPU min MHz:           1200.0000\r\nBogoMIPS:              4600.15\r\nHypervisor vendor:     Xen\r\nVirtualization type:   full\r\nL1d cache:             32K\r\nL1i cache:             32K\r\nL2 cache:              256K\r\nL3 cache:              46080K\r\nNUMA node0 CPU(s):     0-15,32-47\r\nNUMA node1 CPU(s):     16-31,48-63\r\nFlags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon rep_good nopl xtopology nonstop_tsc aperfmperf pni pclmulqdq monitor est ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch invpcid_single pti fsgsbase bmi1 hle avx2 smep bmi2 erms invpcid rtm rdseed adx xsaveopt ida\r\n----------Python Info----------\r\nVersion      : 3.5.2\r\nCompiler     : GCC 5.4.0 20160609\r\nBuild        : ('default', 'Nov 12 2018 13:43:14')\r\nArch         : ('64bit', 'ELF')\r\n------------Pip Info-----------\r\nVersion      : 19.3\r\nDirectory    : /env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/site-packages/pip\r\n----------MXNet Info-----------\r\nVersion      : 1.5.1\r\nDirectory    : /env/mx_1.5.1_gnlp_0.8.1/lib/python3.5/site-packages/mxnet\r\nNum GPUs     : 8\r\nCommit Hash   : c9818480680f84daa6e281a974ab263691302ba8\r\n----------System Info----------\r\nPlatform     : Linux-4.4.0-1090-aws-x86_64-with-Ubuntu-16.04-xenial\r\nsystem       : Linux\r\nnode         : ip-172-31-30-122\r\nrelease      : 4.4.0-1090-aws\r\nversion      : #101-Ubuntu SMP Fri Aug 2 15:21:01 UTC 2019\r\n----------Hardware Info----------\r\nmachine      : x86_64\r\nprocessor    : x86_64\r\n----------Network Test----------\r\nSetting timeout: 10\r\nTiming for GluonNLP GitHub: https://github.com/dmlc/gluon-nlp, DNS: 0.0023 sec, LOAD: 0.4338 sec.\r\nTiming for FashionMNIST: https://repo.mxnet.io/gluon/dataset/fashion-mnist/train-labels-idx1-ubyte.gz, DNS: 0.0919 sec, LOAD: 0.0523 sec.\r\nTiming for D2L (zh-cn): http://zh.d2l.ai, DNS: 0.0060 sec, LOAD: 0.0718 sec.\r\nTiming for D2L: http://d2l.ai, DNS: 0.0155 sec, LOAD: 0.0264 sec.\r\nTiming for MXNet: https://github.com/apache/incubator-mxnet, DNS: 0.0003 sec, LOAD: 0.4836 sec.\r\nTiming for PYPI: https://pypi.python.org/pypi/pip, DNS: 0.0024 sec, LOAD: 0.3733 sec.\r\nTiming for Conda: https://repo.continuum.io/pkgs/free/, DNS: 0.0127 sec, LOAD: 0.0653 sec.\r\nTiming for GluonNLP: http://gluon-nlp.mxnet.io, DNS: 0.1836 sec, LOAD: 0.2207 sec.\r\n\r\n```\r\n","closed_by":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/981/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/981/timeline","performed_via_github_app":null,"state_reason":"completed"}