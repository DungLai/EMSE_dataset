{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1294","repository_url":"https://api.github.com/repos/dmlc/gluon-nlp","labels_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1294/labels{/name}","comments_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1294/comments","events_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1294/events","html_url":"https://github.com/dmlc/gluon-nlp/issues/1294","id":676470007,"node_id":"MDU6SXNzdWU2NzY0NzAwMDc=","number":1294,"title":"GluonNLP 0.8 BERT output is different from GluonNLP 0.9 ","user":{"login":"davisliang","id":12505988,"node_id":"MDQ6VXNlcjEyNTA1OTg4","avatar_url":"https://avatars.githubusercontent.com/u/12505988?v=4","gravatar_id":"","url":"https://api.github.com/users/davisliang","html_url":"https://github.com/davisliang","followers_url":"https://api.github.com/users/davisliang/followers","following_url":"https://api.github.com/users/davisliang/following{/other_user}","gists_url":"https://api.github.com/users/davisliang/gists{/gist_id}","starred_url":"https://api.github.com/users/davisliang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisliang/subscriptions","organizations_url":"https://api.github.com/users/davisliang/orgs","repos_url":"https://api.github.com/users/davisliang/repos","events_url":"https://api.github.com/users/davisliang/events{/privacy}","received_events_url":"https://api.github.com/users/davisliang/received_events","type":"User","site_admin":false},"labels":[{"id":890393501,"node_id":"MDU6TGFiZWw4OTAzOTM1MDE=","url":"https://api.github.com/repos/dmlc/gluon-nlp/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-08-10T23:11:14Z","updated_at":"2020-08-13T01:20:04Z","closed_at":"2020-08-13T01:20:04Z","author_association":"NONE","active_lock_reason":null,"body":"## Description\r\nUsing the same BERT model parameters, GluonNLP0.8 and GluonNLP0.9 output drastically different encoder representations. Tested on both MxNet1.5, MxNet1.6.\r\n\r\n### Error Message\r\nGluonNLP 0.8 output:\r\n[[[-0.14241228  0.13353696 -0.12907042 ... -0.3596797  -0.05622234\r\n    0.36050126]\r\n  [-0.3506479   0.10419717  0.62444484 ... -0.17610289  0.48340234\r\n    0.06443496]\r\n  [-0.24513118 -0.15731761  0.69451797 ... -0.5654461  -0.08939961\r\n   -0.18564416]\r\n  [-0.824786   -0.9119225  -0.65607095 ...  0.50742507 -0.19388743\r\n   -0.1658766 ]\r\n  [ 0.87665254  0.03524816 -0.12331399 ...  0.2720159  -0.63690007\r\n   -0.15850069]]]\r\n<NDArray 1x5x768 @cpu(0)>\r\n\r\nGluonNLP 0.9 output:\r\n[[[-0.8164635  -0.18977094 -0.44616854 ... -0.9124998   0.02381709\r\n    0.5544555 ]\r\n  [-1.0949776  -0.41612968  0.5249134  ... -0.706112    0.14636786\r\n   -0.38614586]\r\n  [-0.8410385  -0.45054507  0.3945069  ... -0.9239115  -0.3351414\r\n    0.05241004]\r\n  [-0.8435936  -1.2706859  -0.5667961  ... -0.40249282 -0.1447221\r\n   -0.12529008]\r\n  [ 0.75693136 -1.1236286  -0.2741627  ...  0.08363507 -0.71608377\r\n    0.29923674]]]\r\n<NDArray 1x5x768 @cpu(0)>\r\n\r\n## To Reproduce\r\nFirst, install the packages:\r\n!pip install mxnet-cu102\r\n!pip install gluonnlp==0.9.1\r\n!pip install gluonnlp==0.8\r\n\r\n```\r\nimport gluonnlp as nlp; import mxnet as mx;\r\nmodel, vocab = nlp.model.get_model('bert_12_768_12', dataset_name='book_corpus_wiki_en_uncased', use_classifier=False, use_decoder=False);\r\ntokenizer = nlp.data.BERTTokenizer(vocab, lower=True);\r\ntransform = nlp.data.BERTSentenceTransform(tokenizer, max_seq_length=512, pair=False, pad=False);\r\nsample = transform(['Hello world!']);\r\nwords, valid_len, segments = mx.nd.array([sample[0]]), mx.nd.array([sample[1]]), mx.nd.array([sample[2]]);\r\nseq_encoding, cls_encoding = model(words, segments, valid_len);\r\n\r\nprint(seq_encoding)\r\n```\r\n### Steps to reproduce\r\n(Paste the commands you ran that produced the error.)\r\n\r\n1. Install the package (either GluonNLP 0.8 or 0.9, as detailed in To Reproduce)\r\n2. Run the example code snippet, taken from the GluonNLP BERT tutorial\r\n\r\n## What have you tried to solve it?\r\n\r\n1. I hypothesized there might be something different in the handing of parameters but it doesn't seem like it.\r\n2. I hypothesized there might be something different with tokenization and transformations but it doesn't seem like that's the issue either.\r\n\r\n## Environment\r\nAny EC2\r\n\r\nWe recommend using our script for collecting the diagnositc information. Run the following command and paste the outputs below:\r\n```\r\ncurl --retry 10 -s https://raw.githubusercontent.com/dmlc/gluon-nlp/master/tools/diagnose.py | python\r\n\r\n# paste outputs here\r\n```\r\n","closed_by":{"login":"davisliang","id":12505988,"node_id":"MDQ6VXNlcjEyNTA1OTg4","avatar_url":"https://avatars.githubusercontent.com/u/12505988?v=4","gravatar_id":"","url":"https://api.github.com/users/davisliang","html_url":"https://github.com/davisliang","followers_url":"https://api.github.com/users/davisliang/followers","following_url":"https://api.github.com/users/davisliang/following{/other_user}","gists_url":"https://api.github.com/users/davisliang/gists{/gist_id}","starred_url":"https://api.github.com/users/davisliang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisliang/subscriptions","organizations_url":"https://api.github.com/users/davisliang/orgs","repos_url":"https://api.github.com/users/davisliang/repos","events_url":"https://api.github.com/users/davisliang/events{/privacy}","received_events_url":"https://api.github.com/users/davisliang/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1294/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1294/timeline","performed_via_github_app":null,"state_reason":"completed"}