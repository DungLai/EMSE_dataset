{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1324","repository_url":"https://api.github.com/repos/dmlc/gluon-nlp","labels_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1324/labels{/name}","comments_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1324/comments","events_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1324/events","html_url":"https://github.com/dmlc/gluon-nlp/issues/1324","id":687921106,"node_id":"MDU6SXNzdWU2ODc5MjExMDY=","number":1324,"title":"Dynamic masked position sampling of Electra","user":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"labels":[{"id":890393501,"node_id":"MDU6TGFiZWw4OTAzOTM1MDE=","url":"https://api.github.com/repos/dmlc/gluon-nlp/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-08-28T08:55:00Z","updated_at":"2020-09-01T07:07:36Z","closed_at":"2020-09-01T07:07:36Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"## Description\r\n\r\nThe implementation of Gluonnlp Electra uses the a Gumbel variable for dynamic mask sampling as below\r\n```\r\nmasked_positions = F.npx.topk(\r\n            sample_probs + gumbels, k=N, axis=-1, ret_typ='indices', dtype=np.int32)\r\n```\r\n\r\nI am curious about why the implementation is using a Gumbel variable here. It may introduce error in sampling. For example, in one of my run the dynamic masking, I find that `sample_probs[10]` is\r\n\r\n```\r\narray([0.    , 0.07692308, 0.07692308, 0.07692308, 0.07692308,\r\n       0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.07692308,\r\n       0.07692308, 0.07692308, 0.07692308, 0.07692308, 0.        ,\r\n       0.        , 0.        , 0.        , 0.        , 0.        ,\r\n       ...\r\n       0.        , 0.        , 0.        , 0.        , 0.        ]\r\n ```\r\nIn this case, only the positions 1 to 13 should be considered as masked position candidates. However, `masked_positions` is \r\n\r\n```\r\narray([ 27, 100,  87,  60,  81,  52,  98,  25,  12,  62,  88,  85,  61,\r\n        54,  55,  69,  47,   6,  59], dtype=int32, ctx=gpu(0))\r\n``` \r\n\r\nclearly, indexes like 27 or 100 should not be considered masked position candidates.\r\n\r\nAlso, for each sequence, a separate masked position length should be considered.\r\n\r\nFor completeness, I also paste the `Gumbel[10]` here\r\n\r\n```\r\narray([-5.6676561e-01, -4.4656819e-01, -2.7907902e-01, -3.2573196e-01,\r\n       -4.4453812e-01,  3.2523954e-01,  2.0374992e+00, -1.6541387e-01,\r\n        7.7737647e-01, -5.7431495e-01, -5.1315073e-02, -8.1144041e-01,\r\n        2.9163866e+00, -6.2848467e-01,  6.0831666e-01, -9.7478211e-01,\r\n        1.3809233e+00, -7.9744577e-01, -2.8823370e-01,  1.8911676e+00,\r\n       -8.5267669e-01,  1.4505583e+00,  2.0499854e-01,  8.3566004e-01,\r\n       -6.1793911e-01,  3.0691831e+00, -1.1203859e-01,  6.7471809e+00,\r\n        8.0651736e-01,  1.8440349e+00, -3.6532184e-01, -4.2094207e-01,\r\n        1.8653628e+00,  3.7640807e-01, -7.3615271e-01,  1.2071087e+00\r\n       ...\r\n```\r\n\r\n## Environment\r\n\r\nWe recommend using our script for collecting the diagnositc information. Run the following command and paste the outputs below:\r\n```\r\ncurl --retry 10 -s https://raw.githubusercontent.com/dmlc/gluon-nlp/master/tools/diagnose.py | python\r\n\r\n# paste outputs here\r\n```\r\n","closed_by":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1324/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1324/timeline","performed_via_github_app":null,"state_reason":"completed"}