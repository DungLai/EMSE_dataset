{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1020","repository_url":"https://api.github.com/repos/dmlc/gluon-nlp","labels_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1020/labels{/name}","comments_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1020/comments","events_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1020/events","html_url":"https://github.com/dmlc/gluon-nlp/issues/1020","id":527866118,"node_id":"MDU6SXNzdWU1Mjc4NjYxMTg=","number":1020,"title":"HybridBeamSearch broken","user":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"labels":[{"id":890393501,"node_id":"MDU6TGFiZWw4OTAzOTM1MDE=","url":"https://api.github.com/repos/dmlc/gluon-nlp/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"open","locked":false,"assignee":{"login":"junrushao","id":22515877,"node_id":"MDQ6VXNlcjIyNTE1ODc3","avatar_url":"https://avatars.githubusercontent.com/u/22515877?v=4","gravatar_id":"","url":"https://api.github.com/users/junrushao","html_url":"https://github.com/junrushao","followers_url":"https://api.github.com/users/junrushao/followers","following_url":"https://api.github.com/users/junrushao/following{/other_user}","gists_url":"https://api.github.com/users/junrushao/gists{/gist_id}","starred_url":"https://api.github.com/users/junrushao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/junrushao/subscriptions","organizations_url":"https://api.github.com/users/junrushao/orgs","repos_url":"https://api.github.com/users/junrushao/repos","events_url":"https://api.github.com/users/junrushao/events{/privacy}","received_events_url":"https://api.github.com/users/junrushao/received_events","type":"User","site_admin":false},"assignees":[{"login":"junrushao","id":22515877,"node_id":"MDQ6VXNlcjIyNTE1ODc3","avatar_url":"https://avatars.githubusercontent.com/u/22515877?v=4","gravatar_id":"","url":"https://api.github.com/users/junrushao","html_url":"https://github.com/junrushao","followers_url":"https://api.github.com/users/junrushao/followers","following_url":"https://api.github.com/users/junrushao/following{/other_user}","gists_url":"https://api.github.com/users/junrushao/gists{/gist_id}","starred_url":"https://api.github.com/users/junrushao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/junrushao/subscriptions","organizations_url":"https://api.github.com/users/junrushao/orgs","repos_url":"https://api.github.com/users/junrushao/repos","events_url":"https://api.github.com/users/junrushao/events{/privacy}","received_events_url":"https://api.github.com/users/junrushao/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2019-11-25T05:58:34Z","updated_at":"2019-11-25T08:50:48Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"## Description\r\nHybridBeamSearch tests break after https://github.com/apache/incubator-mxnet/pull/16836.\r\nPrior to the change in MXNet, the tests wouldn't fail because MXNet wouldn't give a chance to the operator to verify that types are correct.\r\n\r\n### Error Message\r\n```\r\ntests/unittest/test_sequence_sampler.py <class 'test_sequence_sampler.test_beam_search.<locals>.RNNDecoder'>\r\nRNNDecoder 2 1 3 0 1.0 1\r\nterminate called after throwing an instance of 'dmlc::Error'\r\n  what():  [05:56:03] src/operator/numpy/linalg/./../../tensor/../elemwise_op_common.h:135: Check failed: assign(&dattr, vec.at(i)): Incompatible attr in node hybridbeamsearchsampler0_identity0 at 0-th output: expected int32, got float32\r\nStack trace:\r\n  [bt] (0) /home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/mxnet/libmxnet.so(+0x30a67b) [0x7f154ef8567b]\r\n  [bt] (1) /home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/mxnet/libmxnet.so(+0x31ad42) [0x7f154ef95d42]\r\n  [bt] (2) /home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/mxnet/libmxnet.so(+0x33ee9c) [0x7f154efb9e9c]\r\n  [bt] (3) /home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/mxnet/libmxnet.so(+0x35804f6) [0x7f15521fb4f6]\r\n\r\n\r\nFatal Python error: Aborted\r\n\r\nCurrent thread 0x00007f156ffa0700 (most recent call first):\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/mxnet/_ctypes/ndarray.py\", line 170 in __call__\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/mxnet/gluon/block.py\", line 1020 in _call_cached_op\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/mxnet/gluon/block.py\", line 1148 in forward\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/mxnet/gluon/block.py\", line 693 in __call__\r\n  File \"/home/ubuntu/projects/gluon-nlp/tests/unittest/test_sequence_sampler.py\", line 280 in test_beam_search\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/_pytest/python.py\", line 176 in pytest_pyfunc_call\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/callers.py\", line 187 in _multicall\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/manager.py\", line 81 in <lambda>\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/manager.py\", line 87 in _hookexec\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/hooks.py\", line 289 in __call__\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/_pytest/python.py\", line 1445 in runtest\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/_pytest/runner.py\", line 126 in pytest_runtest_call\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/callers.py\", line 187 in _multicall\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/manager.py\", line 81 in <lambda>\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/manager.py\", line 87 in _hookexec\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/hooks.py\", line 289 in __call__\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/flaky/flaky_pytest_plugin.py\", line 306 in <lambda>\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/_pytest/runner.py\", line 229 in from_call\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/flaky/flaky_pytest_plugin.py\", line 307 in call_runtest_hook\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/flaky/flaky_pytest_plugin.py\", line 129 in call_and_report\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/_pytest/runner.py\", line 96 in runtestprotocol\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/_pytest/runner.py\", line 81 in pytest_runtest_protocol\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/flaky/flaky_pytest_plugin.py\", line 92 in pytest_runtest_protocol\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/callers.py\", line 187 in _multicall\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/manager.py\", line 81 in <lambda>\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/manager.py\", line 87 in _hookexec\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/hooks.py\", line 289 in __call__\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/_pytest/main.py\", line 264 in pytest_runtestloop\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/callers.py\", line 187 in _multicall\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/manager.py\", line 81 in <lambda>\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/manager.py\", line 87 in _hookexec\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/hooks.py\", line 289 in __call__\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/_pytest/main.py\", line 240 in _main\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/_pytest/main.py\", line 196 in wrap_session\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/_pytest/main.py\", line 233 in pytest_cmdline_main\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/callers.py\", line 187 in _multicall\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/manager.py\", line 81 in <lambda>\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/manager.py\", line 87 in _hookexec\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/pluggy/hooks.py\", line 289 in __call__\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/lib/python3.7/site-packages/_pytest/config/__init__.py\", line 92 in main\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.3/bin/pytest\", line 8 in <module>\r\nzsh: abort (core dumped)  pytest --color=yes -s tests/unittest/test_sequence_sampler.py -k\r\n```\r\n\r\n## To Reproduce\r\n(If you developed your own code, please provide a short script that reproduces the error. For existing examples, please provide link.)\r\n\r\n### Steps to reproduce\r\n1. `pip install --upgrade --pre 'mxnet==1.6.0b20191122'`\r\n2. `pytest --color=yes -s tests/unittest/test_sequence_sampler.py -k 'test_beam_search[HybridBeamSearchSampler-True]''\r\n\r\n\r\n@junrushao1994 ","closed_by":null,"reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1020/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1020/timeline","performed_via_github_app":null,"state_reason":null}