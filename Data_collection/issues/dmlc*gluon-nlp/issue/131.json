{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/131","repository_url":"https://api.github.com/repos/dmlc/gluon-nlp","labels_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/131/labels{/name}","comments_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/131/comments","events_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/131/events","html_url":"https://github.com/dmlc/gluon-nlp/issues/131","id":329237522,"node_id":"MDU6SXNzdWUzMjkyMzc1MjI=","number":131,"title":"support vocab with indices assigned based on frequencies","user":{"login":"eric-haibin-lin","id":5545640,"node_id":"MDQ6VXNlcjU1NDU2NDA=","avatar_url":"https://avatars.githubusercontent.com/u/5545640?v=4","gravatar_id":"","url":"https://api.github.com/users/eric-haibin-lin","html_url":"https://github.com/eric-haibin-lin","followers_url":"https://api.github.com/users/eric-haibin-lin/followers","following_url":"https://api.github.com/users/eric-haibin-lin/following{/other_user}","gists_url":"https://api.github.com/users/eric-haibin-lin/gists{/gist_id}","starred_url":"https://api.github.com/users/eric-haibin-lin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eric-haibin-lin/subscriptions","organizations_url":"https://api.github.com/users/eric-haibin-lin/orgs","repos_url":"https://api.github.com/users/eric-haibin-lin/repos","events_url":"https://api.github.com/users/eric-haibin-lin/events{/privacy}","received_events_url":"https://api.github.com/users/eric-haibin-lin/received_events","type":"User","site_admin":false},"labels":[{"id":890393503,"node_id":"MDU6TGFiZWw4OTAzOTM1MDM=","url":"https://api.github.com/repos/dmlc/gluon-nlp/labels/enhancement","name":"enhancement","color":"135caf","default":true,"description":"New feature or request"},{"id":963101581,"node_id":"MDU6TGFiZWw5NjMxMDE1ODE=","url":"https://api.github.com/repos/dmlc/gluon-nlp/labels/discussion","name":"discussion","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2018-06-04T22:21:05Z","updated_at":"2020-10-15T20:18:57Z","closed_at":"2020-10-15T20:18:57Z","author_association":"MEMBER","active_lock_reason":null,"body":"Currently, the indices in `gluonnlp.Vocab` are assigned in the following order:\r\n- assign indices to special tokens, including: \\<unk\\>, \\<pad\\>, \\<bos\\>, \\<eos\\> and reserved ones\r\n- assign indices to normal tokens in the counter. \r\n\r\nWhat I see missing for the language model in https://arxiv.org/pdf/1602.02410.pdf is the capability to do the following. For large scale language models that require sampling during training, it's important to build a vocab with indices generated based on word frequencies (including \\<unk\\>, \\<eos\\>, etc):\r\n- assign indices to special & normal tokens based their frequency. \r\n- If a normal token's frequency is less than `min_freq`, its frequency should contribute to the frequency of \\<unk\\>.  \r\n\r\nI propose we extend `gluonnlp.data.Counter` and introduce `gluonnlp.SortedVocab`:\r\n#### Counter\r\n- \\_\\_init\\_\\_(iterable, unknown_token=None, min_freq=None)\r\n\r\nunknown_token: if specified, tokens whose freq is under `min_freq` contribute to the frequency of provided unknown_token. \r\n\r\nmin_freq: if specified, tokens whose freq is under `min_freq` will be removed from the counter.\r\n\r\n#### SortedVocab\r\n\r\n- \\_\\_init\\_\\_(counter=None, max_size=None, min_freq=1, unknown_token=C.UNK_TOKEN,\r\n                 padding_token=C.PAD_TOKEN, bos_token=C.BOS_TOKEN, eos_token=C.EOS_TOKEN,\r\n                 reserved_tokens=None)\r\n\r\nIndexing and embedding attachment for text tokens. The indices in the vocabulary is generated based on frequencies of the tokens, including special tokens (unk, pad, eos, bos and reserved tokens). If max_size is specified, special tokens are still guaranteed to be in the vocabulary. The provided counter instance is the source of all tokens' frequencies.\r\n\r\n@leezu @sxjscience @szha\r\n\r\n","closed_by":{"login":"eric-haibin-lin","id":5545640,"node_id":"MDQ6VXNlcjU1NDU2NDA=","avatar_url":"https://avatars.githubusercontent.com/u/5545640?v=4","gravatar_id":"","url":"https://api.github.com/users/eric-haibin-lin","html_url":"https://github.com/eric-haibin-lin","followers_url":"https://api.github.com/users/eric-haibin-lin/followers","following_url":"https://api.github.com/users/eric-haibin-lin/following{/other_user}","gists_url":"https://api.github.com/users/eric-haibin-lin/gists{/gist_id}","starred_url":"https://api.github.com/users/eric-haibin-lin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eric-haibin-lin/subscriptions","organizations_url":"https://api.github.com/users/eric-haibin-lin/orgs","repos_url":"https://api.github.com/users/eric-haibin-lin/repos","events_url":"https://api.github.com/users/eric-haibin-lin/events{/privacy}","received_events_url":"https://api.github.com/users/eric-haibin-lin/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/131/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/131/timeline","performed_via_github_app":null,"state_reason":"completed"}