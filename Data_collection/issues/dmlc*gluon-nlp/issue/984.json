{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/984","repository_url":"https://api.github.com/repos/dmlc/gluon-nlp","labels_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/984/labels{/name}","comments_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/984/comments","events_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/984/events","html_url":"https://github.com/dmlc/gluon-nlp/issues/984","id":511133115,"node_id":"MDU6SXNzdWU1MTExMzMxMTU=","number":984,"title":"BERT tutorial failed","user":{"login":"zburning","id":26197318,"node_id":"MDQ6VXNlcjI2MTk3MzE4","avatar_url":"https://avatars.githubusercontent.com/u/26197318?v=4","gravatar_id":"","url":"https://api.github.com/users/zburning","html_url":"https://github.com/zburning","followers_url":"https://api.github.com/users/zburning/followers","following_url":"https://api.github.com/users/zburning/following{/other_user}","gists_url":"https://api.github.com/users/zburning/gists{/gist_id}","starred_url":"https://api.github.com/users/zburning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zburning/subscriptions","organizations_url":"https://api.github.com/users/zburning/orgs","repos_url":"https://api.github.com/users/zburning/repos","events_url":"https://api.github.com/users/zburning/events{/privacy}","received_events_url":"https://api.github.com/users/zburning/received_events","type":"User","site_admin":false},"labels":[{"id":890393501,"node_id":"MDU6TGFiZWw4OTAzOTM1MDE=","url":"https://api.github.com/repos/dmlc/gluon-nlp/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-10-23T07:32:36Z","updated_at":"2019-11-30T16:17:42Z","closed_at":"2019-11-30T16:17:42Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"## Description\r\nI was trying to go through the BERT tutorial on [http://gluon-nlp.mxnet.io/examples/sentence_embedding/bert.html](http://gluon-nlp.mxnet.io/examples/sentence_embedding/bert.html)and got error in the following code.\r\nfor epoch_id in range(num_epochs):\r\n    metric.reset()\r\n    step_loss = 0\r\n    for batch_id, (token_ids, valid_length, segment_ids, label) in enumerate(bert_dataloader):\r\n        with mx.autograd.record():\r\n            # Load the data to the GPU\r\n            token_ids = token_ids.as_in_context(ctx)\r\n            valid_length = valid_length.as_in_context(ctx)\r\n            segment_ids = segment_ids.as_in_context(ctx)\r\n            label = label.as_in_context(ctx)\r\n            # Forward computation\r\n            out = bert_classifier(token_ids, segment_ids, valid_length.astype('float32'))\r\n            ls = loss_function(out, label).mean()\r\n        # And backwards computation\r\n        ls.backward()\r\n\r\n\r\n\r\n### Error Message\r\nTraceback (most recent call last):\r\n  File \"/Users/zechenw/PycharmProjects/bert_playground/playground.py\", line 104, in <module>\r\n    out = bert_classifier(token_ids, segment_ids, valid_length.astype('float32'))\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/gluonnlp/model/bert.py\", line 635, in __call__\r\n    return super(BERTClassifier, self).__call__(inputs, token_types, valid_length)\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/mxnet/gluon/block.py\", line 548, in __call__\r\n    out = self.forward(*args)\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/mxnet/gluon/block.py\", line 915, in forward\r\n    return self._call_cached_op(x, *args)\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/mxnet/gluon/block.py\", line 805, in _call_cached_op\r\n    self._build_cache(*args)\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/mxnet/gluon/block.py\", line 757, in _build_cache\r\n    data, out = self._get_graph(*args)\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/mxnet/gluon/block.py\", line 749, in _get_graph\r\n    out = self.hybrid_forward(symbol, *grouped_inputs, **params)  # pylint: disable=no-value-for-parameter\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/gluonnlp/model/bert.py\", line 656, in hybrid_forward\r\n    _, pooler_out = self.bert(inputs, token_types, valid_length)\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/gluonnlp/model/bert.py\", line 425, in __call__\r\n    valid_length, masked_positions)\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/mxnet/gluon/block.py\", line 548, in __call__\r\n    out = self.forward(*args)\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/mxnet/gluon/block.py\", line 932, in forward\r\n    return self.hybrid_forward(symbol, x, *args, **params)\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/gluonnlp/model/bert.py\", line 434, in hybrid_forward\r\n    seq_out, attention_out = self._encode_sequence(inputs, token_types, valid_length)\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/gluonnlp/model/bert.py\", line 470, in _encode_sequence\r\n    outputs, additional_outputs = self.encoder(embedding, valid_length=valid_length)\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/gluonnlp/model/transformer.py\", line 440, in __call__\r\n    return super(BaseTransformerEncoder, self).__call__(inputs, states, valid_length)\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/gluonnlp/model/seq2seq_encoder_decoder.py\", line 149, in __call__\r\n    return super(Seq2SeqEncoder, self).__call__(inputs, valid_length, states)\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/mxnet/gluon/block.py\", line 548, in __call__\r\n    out = self.forward(*args)\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/mxnet/gluon/block.py\", line 932, in forward\r\n    return self.hybrid_forward(symbol, x, *args, **params)\r\n  File \"/opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/gluonnlp/model/transformer.py\", line 479, in hybrid_forward\r\n    steps = F.contrib.arange_like(inputs, axis=1)\r\nAttributeError: module 'mxnet.symbol.contrib' has no attribute 'arange_like'\r\n\r\n\r\n\r\n## To Reproduce\r\n[http://gluon-nlp.mxnet.io/examples/sentence_embedding/bert.html](http://gluon-nlp.mxnet.io/examples/sentence_embedding/bert.html)\r\n\r\n## What have you tried to solve it?\r\nI'm using gluonnlp installed from github.\r\nI checked mxnet.symbol.contrib and mxnet.symbol.gen_contrib, but did not find arrage_like(). \r\n\r\n## Environment\r\n\r\n----------Python Info----------\r\nVersion      : 3.7.4\r\nCompiler     : Clang 4.0.1 (tags/RELEASE_401/final)\r\nBuild        : ('default', 'Aug 13 2019 15:17:50')\r\nArch         : ('64bit', '')\r\n------------Pip Info-----------\r\nVersion      : 19.3.1\r\nDirectory    : /opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/pip\r\n----------MXNet Info-----------\r\nVersion      : 1.5.1\r\nDirectory    : /opt/anaconda3/envs/mxnet_15/lib/python3.7/site-packages/mxnet\r\nNum GPUs     : 0\r\nCommit Hash   : c9818480680f84daa6e281a974ab263691302ba8\r\n----------System Info----------\r\nPlatform     : Darwin-18.6.0-x86_64-i386-64bit\r\nsystem       : Darwin\r\nnode         : a483e7462a21.ant.amazon.com\r\nrelease      : 18.6.0\r\nversion      : Darwin Kernel Version 18.6.0: Sun Apr 28 18:06:45 PDT 2019; root:xnu-4903.261.4~6/RELEASE_X86_64\r\n----------Hardware Info----------\r\nmachine      : x86_64\r\nprocessor    : i386\r\nb'machdep.cpu.brand_string: Intel(R) Core(TM) i7-8557U CPU @ 1.70GHz'\r\nb'machdep.cpu.features: FPU VME DE PSE TSC MSR PAE MCE CX8 APIC SEP MTRR PGE MCA CMOV PAT PSE36 CLFSH DS ACPI MMX FXSR SSE SSE2 SS HTT TM PBE SSE3 PCLMULQDQ DTES64 MON DSCPL VMX EST TM2 SSSE3 FMA CX16 TPR PDCM SSE4.1 SSE4.2 x2APIC MOVBE POPCNT AES PCID XSAVE OSXSAVE SEGLIM64 TSCTMR AVX1.0 RDRAND F16C'\r\nb'machdep.cpu.leaf7_features: SMEP ERMS RDWRFSGS TSC_THREAD_OFFSET BMI1 AVX2 BMI2 INVPCID SMAP RDSEED ADX IPT SGX FPU_CSDS MPX CLFSOPT TSXFA IBRS STIBP L1DF SSBD'\r\nb'machdep.cpu.extfeatures: SYSCALL XD 1GBPAGE EM64T LAHF LZCNT PREFETCHW RDTSCP TSCI'\r\n----------Network Test----------\r\nSetting timeout: 10\r\nTiming for MXNet: https://github.com/apache/incubator-mxnet, DNS: 0.0009 sec, LOAD: 1.1944 sec.\r\nTiming for GluonNLP GitHub: https://github.com/dmlc/gluon-nlp, DNS: 0.0006 sec, LOAD: 1.1631 sec.\r\nTiming for GluonNLP: http://gluon-nlp.mxnet.io, DNS: 0.0008 sec, LOAD: 0.3726 sec.\r\nTiming for D2L: http://d2l.ai, DNS: 0.0008 sec, LOAD: 0.3690 sec.\r\nTiming for D2L (zh-cn): http://zh.d2l.ai, DNS: 0.0012 sec, LOAD: 0.3752 sec.\r\nTiming for FashionMNIST: https://repo.mxnet.io/gluon/dataset/fashion-mnist/train-labels-idx1-ubyte.gz, DNS: 0.0017 sec, LOAD: 0.7922 sec.\r\nTiming for PYPI: https://pypi.python.org/pypi/pip, DNS: 0.1924 sec, LOAD: 3.0321 sec.\r\nTiming for Conda: https://repo.continuum.io/pkgs/free/, DNS: 0.0005 sec, LOAD: 0.7737 sec.\r\n","closed_by":{"login":"zburning","id":26197318,"node_id":"MDQ6VXNlcjI2MTk3MzE4","avatar_url":"https://avatars.githubusercontent.com/u/26197318?v=4","gravatar_id":"","url":"https://api.github.com/users/zburning","html_url":"https://github.com/zburning","followers_url":"https://api.github.com/users/zburning/followers","following_url":"https://api.github.com/users/zburning/following{/other_user}","gists_url":"https://api.github.com/users/zburning/gists{/gist_id}","starred_url":"https://api.github.com/users/zburning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zburning/subscriptions","organizations_url":"https://api.github.com/users/zburning/orgs","repos_url":"https://api.github.com/users/zburning/repos","events_url":"https://api.github.com/users/zburning/events{/privacy}","received_events_url":"https://api.github.com/users/zburning/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/984/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/984/timeline","performed_via_github_app":null,"state_reason":"completed"}