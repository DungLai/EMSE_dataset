{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1238","repository_url":"https://api.github.com/repos/dmlc/gluon-nlp","labels_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1238/labels{/name}","comments_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1238/comments","events_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1238/events","html_url":"https://github.com/dmlc/gluon-nlp/issues/1238","id":630132128,"node_id":"MDU6SXNzdWU2MzAxMzIxMjg=","number":1238,"title":"loading the pre-trained BERT with (pretrained=True) crashing","user":{"login":"Hildweig","id":34550304,"node_id":"MDQ6VXNlcjM0NTUwMzA0","avatar_url":"https://avatars.githubusercontent.com/u/34550304?v=4","gravatar_id":"","url":"https://api.github.com/users/Hildweig","html_url":"https://github.com/Hildweig","followers_url":"https://api.github.com/users/Hildweig/followers","following_url":"https://api.github.com/users/Hildweig/following{/other_user}","gists_url":"https://api.github.com/users/Hildweig/gists{/gist_id}","starred_url":"https://api.github.com/users/Hildweig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hildweig/subscriptions","organizations_url":"https://api.github.com/users/Hildweig/orgs","repos_url":"https://api.github.com/users/Hildweig/repos","events_url":"https://api.github.com/users/Hildweig/events{/privacy}","received_events_url":"https://api.github.com/users/Hildweig/received_events","type":"User","site_admin":false},"labels":[{"id":890393501,"node_id":"MDU6TGFiZWw4OTAzOTM1MDE=","url":"https://api.github.com/repos/dmlc/gluon-nlp/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-06-03T16:11:28Z","updated_at":"2020-06-05T11:51:38Z","closed_at":"2020-06-05T11:51:37Z","author_association":"NONE","active_lock_reason":null,"body":"## Description\r\nI am trying to do this tutorial https://gluon-nlp.mxnet.io/examples/sentence_embedding/bert.html\r\nand whenever I arrive to the 3rd cell I get a crash in collab.\r\n### Error Message\r\n\r\nTimestamp | Level | Message\r\n-- | -- | --\r\nJun 3, 2020, 2:28:19 PM | WARNING | WARNING:root:kernel ad3dbdee-4b57-493d-bf27-40be9330ee20 restarted\r\nJun 3, 2020, 2:28:19 PM | INFO | KernelRestarter: restarting kernel (1/5), keep random ports\r\nJun 3, 2020, 2:28:18 PM | WARNING | [bt] (1) /usr/local/lib/python3.6/dist-packages/mxnet/libmxnet.so(mxnet::CopyFromTo(mxnet::NDArray const&, mxnet::NDArray const&, int, bool)+0x6db) [0x7faa2db0f28b]\r\n\r\n\r\n## To Reproduce\r\n!pip install --pre --upgrade mxnet\r\n!pip install gluonnlp\r\n\r\nimport warnings\r\nwarnings.filterwarnings('ignore')\r\n\r\nimport io\r\nimport random\r\nimport numpy as np\r\nimport mxnet as mx\r\nimport gluonnlp as nlp\r\nfrom gluonnlp.calibration import BertLayerCollector\r\n# this notebook assumes that all required scripts are already\r\n# downloaded from the corresponding tutorial webpage on http://gluon-nlp.mxnet.io\r\n%cd /content/sentence_embedding #this one contains the bert file of the tutorial\r\nfrom bert import data\r\nnlp.utils.check_version('0.8.1')\r\nnp.random.seed(100)\r\nrandom.seed(100)\r\nmx.random.seed(10000)\r\n# change `ctx` to `mx.cpu()` if no GPU is available.\r\ntry:\r\n    ctx = mx.gpu(0)\r\nexcept:\r\n    ctx = mx.cpu()\r\n### Steps to reproduce\r\nafter doing those up: the one that makes it crash is this one\r\n\r\nbert_base, vocabulary = nlp.model.get_model('bert_12_768_12',\r\n                                             dataset_name='book_corpus_wiki_en_uncased',\r\n                                             pretrained=True, ctx=ctx, use_pooler=True,\r\n                                             use_decoder=False, use_classifier=False)\r\n\r\n## What have you tried to solve it?\r\n\r\n1. I tried to replace it with this one : \r\nbert_base, vocabulary = nlp.model.bert.get_bert_model(model_name='bert_12_768_12',\r\n                                                      dataset_name='book_corpus_wiki_en_uncased', \r\n                                                      pretrained=True,\r\n                                                      ctx=ctx,\r\n                                                      use_pooler=True,\r\n                                                      use_decoder=False,\r\n                                                      use_classifier=False)\r\n\r\n2. Also tried to remove some parameters and I realized that it crashes when pretrained = True, still I need it to be like that.\r\n\r\n## Environment\r\n----------Python Info----------\r\nVersion      : 3.6.9\r\nCompiler     : GCC 8.4.0\r\nBuild        : ('default', 'Apr 18 2020 01:56:04')\r\nArch         : ('64bit', '')\r\n------------Pip Info-----------\r\nVersion      : 19.3.1\r\nDirectory    : /usr/local/lib/python3.6/dist-packages/pip\r\n----------MXNet Info-----------\r\nVersion      : 1.6.0\r\nDirectory    : /usr/local/lib/python3.6/dist-packages/mxnet\r\nNum GPUs     : 0\r\nCommit Hash   : 6eec9da55c5096079355d1f1a5fa58dcf35d6752\r\n----------System Info----------\r\nPlatform     : Linux-4.19.104+-x86_64-with-Ubuntu-18.04-bionic\r\nsystem       : Linux\r\nnode         : a7a11b36dda7\r\nrelease      : 4.19.104+\r\nversion      : #1 SMP Wed Feb 19 05:26:34 PST 2020\r\n----------Hardware Info----------\r\nmachine      : x86_64\r\nprocessor    : x86_64\r\nArchitecture:        x86_64\r\nCPU op-mode(s):      32-bit, 64-bit\r\nByte Order:          Little Endian\r\nCPU(s):              2\r\nOn-line CPU(s) list: 0,1\r\nThread(s) per core:  2\r\nCore(s) per socket:  1\r\nSocket(s):           1\r\nNUMA node(s):        1\r\nVendor ID:           GenuineIntel\r\nCPU family:          6\r\nModel:               63\r\nModel name:          Intel(R) Xeon(R) CPU @ 2.30GHz\r\nStepping:            0\r\nCPU MHz:             2300.000\r\nBogoMIPS:            4600.00\r\nHypervisor vendor:   KVM\r\nVirtualization type: full\r\nL1d cache:           32K\r\nL1i cache:           32K\r\nL2 cache:            256K\r\nL3 cache:            46080K\r\nNUMA node0 CPU(s):   0,1\r\nFlags:               fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc cpuid tsc_known_freq pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt aes xsave avx f16c rdrand hypervisor lahf_lm abm invpcid_single ssbd ibrs ibpb stibp fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt arat md_clear arch_capabilities\r\n----------Network Test----------\r\nSetting timeout: 10\r\nTiming for MXNet: https://github.com/apache/incubator-mxnet, DNS: 0.0029 sec, LOAD: 0.6395 sec.\r\nTiming for GluonNLP GitHub: https://github.com/dmlc/gluon-nlp, DNS: 0.0029 sec, LOAD: 0.5304 sec.\r\nTiming for GluonNLP: http://gluon-nlp.mxnet.io, DNS: 0.1030 sec, LOAD: 0.4462 sec.\r\nTiming for D2L: http://d2l.ai, DNS: 0.0337 sec, LOAD: 0.3244 sec.\r\nTiming for D2L (zh-cn): http://zh.d2l.ai, DNS: 0.0170 sec, LOAD: 0.2023 sec.\r\nTiming for FashionMNIST: https://repo.mxnet.io/gluon/dataset/fashion-mnist/train-labels-idx1-ubyte.gz, DNS: 0.0310 sec, LOAD: 0.6803 sec.\r\nTiming for PYPI: https://pypi.python.org/pypi/pip, DNS: 0.0088 sec, LOAD: 0.3790 sec.\r\nError open Conda: https://repo.continuum.io/pkgs/free/, HTTP Error 403: Forbidden, DNS finished in 0.010742664337158203 sec.\r\n","closed_by":{"login":"Hildweig","id":34550304,"node_id":"MDQ6VXNlcjM0NTUwMzA0","avatar_url":"https://avatars.githubusercontent.com/u/34550304?v=4","gravatar_id":"","url":"https://api.github.com/users/Hildweig","html_url":"https://github.com/Hildweig","followers_url":"https://api.github.com/users/Hildweig/followers","following_url":"https://api.github.com/users/Hildweig/following{/other_user}","gists_url":"https://api.github.com/users/Hildweig/gists{/gist_id}","starred_url":"https://api.github.com/users/Hildweig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hildweig/subscriptions","organizations_url":"https://api.github.com/users/Hildweig/orgs","repos_url":"https://api.github.com/users/Hildweig/repos","events_url":"https://api.github.com/users/Hildweig/events{/privacy}","received_events_url":"https://api.github.com/users/Hildweig/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1238/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1238/timeline","performed_via_github_app":null,"state_reason":"completed"}