[{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/462815420","html_url":"https://github.com/dmlc/gluon-nlp/issues/590#issuecomment-462815420","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/590","id":462815420,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MjgxNTQyMA==","user":{"login":"szhengac","id":3960020,"node_id":"MDQ6VXNlcjM5NjAwMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3960020?v=4","gravatar_id":"","url":"https://api.github.com/users/szhengac","html_url":"https://github.com/szhengac","followers_url":"https://api.github.com/users/szhengac/followers","following_url":"https://api.github.com/users/szhengac/following{/other_user}","gists_url":"https://api.github.com/users/szhengac/gists{/gist_id}","starred_url":"https://api.github.com/users/szhengac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szhengac/subscriptions","organizations_url":"https://api.github.com/users/szhengac/orgs","repos_url":"https://api.github.com/users/szhengac/repos","events_url":"https://api.github.com/users/szhengac/events{/privacy}","received_events_url":"https://api.github.com/users/szhengac/received_events","type":"User","site_admin":false},"created_at":"2019-02-12T15:55:24Z","updated_at":"2019-02-12T15:55:24Z","author_association":"MEMBER","body":"The purpose of pad is to form a rectangular input so that one can achieve mini-batch acceleration, and the number of paddings is determined by the maximum length in the batch. The memory cost can be reduced by using bucketing. You can also consider clipping the training sequence in the preprocessing pipeline.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/462815420/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"szhengac","id":3960020,"node_id":"MDQ6VXNlcjM5NjAwMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3960020?v=4","gravatar_id":"","url":"https://api.github.com/users/szhengac","html_url":"https://github.com/szhengac","followers_url":"https://api.github.com/users/szhengac/followers","following_url":"https://api.github.com/users/szhengac/following{/other_user}","gists_url":"https://api.github.com/users/szhengac/gists{/gist_id}","starred_url":"https://api.github.com/users/szhengac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szhengac/subscriptions","organizations_url":"https://api.github.com/users/szhengac/orgs","repos_url":"https://api.github.com/users/szhengac/repos","events_url":"https://api.github.com/users/szhengac/events{/privacy}","received_events_url":"https://api.github.com/users/szhengac/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/462826506","html_url":"https://github.com/dmlc/gluon-nlp/issues/590#issuecomment-462826506","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/590","id":462826506,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MjgyNjUwNg==","user":{"login":"vanewu","id":27672489,"node_id":"MDQ6VXNlcjI3NjcyNDg5","avatar_url":"https://avatars.githubusercontent.com/u/27672489?v=4","gravatar_id":"","url":"https://api.github.com/users/vanewu","html_url":"https://github.com/vanewu","followers_url":"https://api.github.com/users/vanewu/followers","following_url":"https://api.github.com/users/vanewu/following{/other_user}","gists_url":"https://api.github.com/users/vanewu/gists{/gist_id}","starred_url":"https://api.github.com/users/vanewu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vanewu/subscriptions","organizations_url":"https://api.github.com/users/vanewu/orgs","repos_url":"https://api.github.com/users/vanewu/repos","events_url":"https://api.github.com/users/vanewu/events{/privacy}","received_events_url":"https://api.github.com/users/vanewu/received_events","type":"User","site_admin":false},"created_at":"2019-02-12T16:21:07Z","updated_at":"2019-02-12T16:21:07Z","author_association":"CONTRIBUTOR","body":"Hi, @fierceX , I simply looked at the code in 7219400, where the dataloader uses batchify directly, which may result in too much length difference for each sample in each batch of data when the batch is randomly generated. This can lead to too much unnecessary padding, which may be the reason for memory out of bounds. You can use ` nlp.data.sampler.FixedBucketSampler ` to improve performance, or use ` gluonnlp.data.ClipSequence `  to clip the maximum length of the sentence in data preprocessing.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/462826506/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vanewu","id":27672489,"node_id":"MDQ6VXNlcjI3NjcyNDg5","avatar_url":"https://avatars.githubusercontent.com/u/27672489?v=4","gravatar_id":"","url":"https://api.github.com/users/vanewu","html_url":"https://github.com/vanewu","followers_url":"https://api.github.com/users/vanewu/followers","following_url":"https://api.github.com/users/vanewu/following{/other_user}","gists_url":"https://api.github.com/users/vanewu/gists{/gist_id}","starred_url":"https://api.github.com/users/vanewu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vanewu/subscriptions","organizations_url":"https://api.github.com/users/vanewu/orgs","repos_url":"https://api.github.com/users/vanewu/repos","events_url":"https://api.github.com/users/vanewu/events{/privacy}","received_events_url":"https://api.github.com/users/vanewu/received_events","type":"User","site_admin":false}},{"id":2134214125,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjEzNDIxNDEyNQ==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2134214125","actor":{"login":"fierceX","id":13912058,"node_id":"MDQ6VXNlcjEzOTEyMDU4","avatar_url":"https://avatars.githubusercontent.com/u/13912058?v=4","gravatar_id":"","url":"https://api.github.com/users/fierceX","html_url":"https://github.com/fierceX","followers_url":"https://api.github.com/users/fierceX/followers","following_url":"https://api.github.com/users/fierceX/following{/other_user}","gists_url":"https://api.github.com/users/fierceX/gists{/gist_id}","starred_url":"https://api.github.com/users/fierceX/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fierceX/subscriptions","organizations_url":"https://api.github.com/users/fierceX/orgs","repos_url":"https://api.github.com/users/fierceX/repos","events_url":"https://api.github.com/users/fierceX/events{/privacy}","received_events_url":"https://api.github.com/users/fierceX/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-02-12T16:21:07Z","performed_via_github_app":null},{"id":2134214127,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIxMzQyMTQxMjc=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2134214127","actor":{"login":"fierceX","id":13912058,"node_id":"MDQ6VXNlcjEzOTEyMDU4","avatar_url":"https://avatars.githubusercontent.com/u/13912058?v=4","gravatar_id":"","url":"https://api.github.com/users/fierceX","html_url":"https://github.com/fierceX","followers_url":"https://api.github.com/users/fierceX/followers","following_url":"https://api.github.com/users/fierceX/following{/other_user}","gists_url":"https://api.github.com/users/fierceX/gists{/gist_id}","starred_url":"https://api.github.com/users/fierceX/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fierceX/subscriptions","organizations_url":"https://api.github.com/users/fierceX/orgs","repos_url":"https://api.github.com/users/fierceX/repos","events_url":"https://api.github.com/users/fierceX/events{/privacy}","received_events_url":"https://api.github.com/users/fierceX/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-02-12T16:21:07Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/463122413","html_url":"https://github.com/dmlc/gluon-nlp/issues/590#issuecomment-463122413","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/590","id":463122413,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MzEyMjQxMw==","user":{"login":"fierceX","id":13912058,"node_id":"MDQ6VXNlcjEzOTEyMDU4","avatar_url":"https://avatars.githubusercontent.com/u/13912058?v=4","gravatar_id":"","url":"https://api.github.com/users/fierceX","html_url":"https://github.com/fierceX","followers_url":"https://api.github.com/users/fierceX/followers","following_url":"https://api.github.com/users/fierceX/following{/other_user}","gists_url":"https://api.github.com/users/fierceX/gists{/gist_id}","starred_url":"https://api.github.com/users/fierceX/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fierceX/subscriptions","organizations_url":"https://api.github.com/users/fierceX/orgs","repos_url":"https://api.github.com/users/fierceX/repos","events_url":"https://api.github.com/users/fierceX/events{/privacy}","received_events_url":"https://api.github.com/users/fierceX/received_events","type":"User","site_admin":false},"created_at":"2019-02-13T09:22:23Z","updated_at":"2019-02-13T09:22:23Z","author_association":"MEMBER","body":"@kenjewu In the submission of https://github.com/dmlc/gluon-nlp/pull/493/commits/b6be61cd6d88d1e559c0360b5be35256bba7dc93, I used `FixedBucketSampler`.\r\nBut GPU memory will also increase, and will gradually increase to the same size as before.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/463122413/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fierceX","id":13912058,"node_id":"MDQ6VXNlcjEzOTEyMDU4","avatar_url":"https://avatars.githubusercontent.com/u/13912058?v=4","gravatar_id":"","url":"https://api.github.com/users/fierceX","html_url":"https://github.com/fierceX","followers_url":"https://api.github.com/users/fierceX/followers","following_url":"https://api.github.com/users/fierceX/following{/other_user}","gists_url":"https://api.github.com/users/fierceX/gists{/gist_id}","starred_url":"https://api.github.com/users/fierceX/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fierceX/subscriptions","organizations_url":"https://api.github.com/users/fierceX/orgs","repos_url":"https://api.github.com/users/fierceX/repos","events_url":"https://api.github.com/users/fierceX/events{/privacy}","received_events_url":"https://api.github.com/users/fierceX/received_events","type":"User","site_admin":false}},{"id":2136116625,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjEzNjExNjYyNQ==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2136116625","actor":{"login":"vanewu","id":27672489,"node_id":"MDQ6VXNlcjI3NjcyNDg5","avatar_url":"https://avatars.githubusercontent.com/u/27672489?v=4","gravatar_id":"","url":"https://api.github.com/users/vanewu","html_url":"https://github.com/vanewu","followers_url":"https://api.github.com/users/vanewu/followers","following_url":"https://api.github.com/users/vanewu/following{/other_user}","gists_url":"https://api.github.com/users/vanewu/gists{/gist_id}","starred_url":"https://api.github.com/users/vanewu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vanewu/subscriptions","organizations_url":"https://api.github.com/users/vanewu/orgs","repos_url":"https://api.github.com/users/vanewu/repos","events_url":"https://api.github.com/users/vanewu/events{/privacy}","received_events_url":"https://api.github.com/users/vanewu/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-02-13T09:22:23Z","performed_via_github_app":null},{"id":2136116627,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIxMzYxMTY2Mjc=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2136116627","actor":{"login":"vanewu","id":27672489,"node_id":"MDQ6VXNlcjI3NjcyNDg5","avatar_url":"https://avatars.githubusercontent.com/u/27672489?v=4","gravatar_id":"","url":"https://api.github.com/users/vanewu","html_url":"https://github.com/vanewu","followers_url":"https://api.github.com/users/vanewu/followers","following_url":"https://api.github.com/users/vanewu/following{/other_user}","gists_url":"https://api.github.com/users/vanewu/gists{/gist_id}","starred_url":"https://api.github.com/users/vanewu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vanewu/subscriptions","organizations_url":"https://api.github.com/users/vanewu/orgs","repos_url":"https://api.github.com/users/vanewu/repos","events_url":"https://api.github.com/users/vanewu/events{/privacy}","received_events_url":"https://api.github.com/users/vanewu/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-02-13T09:22:24Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/463136593","html_url":"https://github.com/dmlc/gluon-nlp/issues/590#issuecomment-463136593","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/590","id":463136593,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MzEzNjU5Mw==","user":{"login":"vanewu","id":27672489,"node_id":"MDQ6VXNlcjI3NjcyNDg5","avatar_url":"https://avatars.githubusercontent.com/u/27672489?v=4","gravatar_id":"","url":"https://api.github.com/users/vanewu","html_url":"https://github.com/vanewu","followers_url":"https://api.github.com/users/vanewu/followers","following_url":"https://api.github.com/users/vanewu/following{/other_user}","gists_url":"https://api.github.com/users/vanewu/gists{/gist_id}","starred_url":"https://api.github.com/users/vanewu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vanewu/subscriptions","organizations_url":"https://api.github.com/users/vanewu/orgs","repos_url":"https://api.github.com/users/vanewu/repos","events_url":"https://api.github.com/users/vanewu/events{/privacy}","received_events_url":"https://api.github.com/users/vanewu/received_events","type":"User","site_admin":false},"created_at":"2019-02-13T10:02:42Z","updated_at":"2019-02-13T10:02:42Z","author_association":"CONTRIBUTOR","body":"Can you show ` sampler.stats() ` here? This may help to troubleshoot the problem.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/463136593/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vanewu","id":27672489,"node_id":"MDQ6VXNlcjI3NjcyNDg5","avatar_url":"https://avatars.githubusercontent.com/u/27672489?v=4","gravatar_id":"","url":"https://api.github.com/users/vanewu","html_url":"https://github.com/vanewu","followers_url":"https://api.github.com/users/vanewu/followers","following_url":"https://api.github.com/users/vanewu/following{/other_user}","gists_url":"https://api.github.com/users/vanewu/gists{/gist_id}","starred_url":"https://api.github.com/users/vanewu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vanewu/subscriptions","organizations_url":"https://api.github.com/users/vanewu/orgs","repos_url":"https://api.github.com/users/vanewu/repos","events_url":"https://api.github.com/users/vanewu/events{/privacy}","received_events_url":"https://api.github.com/users/vanewu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/463138923","html_url":"https://github.com/dmlc/gluon-nlp/issues/590#issuecomment-463138923","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/590","id":463138923,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MzEzODkyMw==","user":{"login":"fierceX","id":13912058,"node_id":"MDQ6VXNlcjEzOTEyMDU4","avatar_url":"https://avatars.githubusercontent.com/u/13912058?v=4","gravatar_id":"","url":"https://api.github.com/users/fierceX","html_url":"https://github.com/fierceX","followers_url":"https://api.github.com/users/fierceX/followers","following_url":"https://api.github.com/users/fierceX/following{/other_user}","gists_url":"https://api.github.com/users/fierceX/gists{/gist_id}","starred_url":"https://api.github.com/users/fierceX/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fierceX/subscriptions","organizations_url":"https://api.github.com/users/fierceX/orgs","repos_url":"https://api.github.com/users/fierceX/repos","events_url":"https://api.github.com/users/fierceX/events{/privacy}","received_events_url":"https://api.github.com/users/fierceX/received_events","type":"User","site_admin":false},"created_at":"2019-02-13T10:09:06Z","updated_at":"2019-02-13T10:09:06Z","author_association":"MEMBER","body":"`batch_size=6`, `num_buckets=10`, `ratio=0`, `shuffle=True`\r\n```\r\nFixedBucketSampler:\r\n  sample_num=88641, batch_num=14777\r\n  key=[78, 112, 146, 180, 214, 248, 282, 316, 350, 384]\r\n  cnt=[3698, 7202, 24221, 21614, 13458, 7671, 4806, 2772, 1499, 1700]\r\n  batch_size=[6, 6, 6, 6, 6, 6, 6, 6, 6, 6]\r\n```","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/463138923/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fierceX","id":13912058,"node_id":"MDQ6VXNlcjEzOTEyMDU4","avatar_url":"https://avatars.githubusercontent.com/u/13912058?v=4","gravatar_id":"","url":"https://api.github.com/users/fierceX","html_url":"https://github.com/fierceX","followers_url":"https://api.github.com/users/fierceX/followers","following_url":"https://api.github.com/users/fierceX/following{/other_user}","gists_url":"https://api.github.com/users/fierceX/gists{/gist_id}","starred_url":"https://api.github.com/users/fierceX/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fierceX/subscriptions","organizations_url":"https://api.github.com/users/fierceX/orgs","repos_url":"https://api.github.com/users/fierceX/repos","events_url":"https://api.github.com/users/fierceX/events{/privacy}","received_events_url":"https://api.github.com/users/fierceX/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/463496763","html_url":"https://github.com/dmlc/gluon-nlp/issues/590#issuecomment-463496763","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/590","id":463496763,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MzQ5Njc2Mw==","user":{"login":"vanewu","id":27672489,"node_id":"MDQ6VXNlcjI3NjcyNDg5","avatar_url":"https://avatars.githubusercontent.com/u/27672489?v=4","gravatar_id":"","url":"https://api.github.com/users/vanewu","html_url":"https://github.com/vanewu","followers_url":"https://api.github.com/users/vanewu/followers","following_url":"https://api.github.com/users/vanewu/following{/other_user}","gists_url":"https://api.github.com/users/vanewu/gists{/gist_id}","starred_url":"https://api.github.com/users/vanewu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vanewu/subscriptions","organizations_url":"https://api.github.com/users/vanewu/orgs","repos_url":"https://api.github.com/users/vanewu/repos","events_url":"https://api.github.com/users/vanewu/events{/privacy}","received_events_url":"https://api.github.com/users/vanewu/received_events","type":"User","site_admin":false},"created_at":"2019-02-14T05:36:42Z","updated_at":"2019-02-14T05:36:42Z","author_association":"CONTRIBUTOR","body":"From the ` key ` you can see the length of the sequence in each bucket. Is this a big difference from the maximum length you set before? If the difference is too large, you may need to clip the long sequence.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/463496763/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vanewu","id":27672489,"node_id":"MDQ6VXNlcjI3NjcyNDg5","avatar_url":"https://avatars.githubusercontent.com/u/27672489?v=4","gravatar_id":"","url":"https://api.github.com/users/vanewu","html_url":"https://github.com/vanewu","followers_url":"https://api.github.com/users/vanewu/followers","following_url":"https://api.github.com/users/vanewu/following{/other_user}","gists_url":"https://api.github.com/users/vanewu/gists{/gist_id}","starred_url":"https://api.github.com/users/vanewu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vanewu/subscriptions","organizations_url":"https://api.github.com/users/vanewu/orgs","repos_url":"https://api.github.com/users/vanewu/repos","events_url":"https://api.github.com/users/vanewu/events{/privacy}","received_events_url":"https://api.github.com/users/vanewu/received_events","type":"User","site_admin":false}},{"id":2140518524,"node_id":"MDEyOkxhYmVsZWRFdmVudDIxNDA1MTg1MjQ=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2140518524","actor":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-02-14T18:34:44Z","label":{"name":"discussion","color":"c5def5"},"performed_via_github_app":null}]