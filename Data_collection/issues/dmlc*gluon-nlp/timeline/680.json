[{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/486740312","html_url":"https://github.com/dmlc/gluon-nlp/issues/680#issuecomment-486740312","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/680","id":486740312,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4Njc0MDMxMg==","user":{"login":"khui","id":5355226,"node_id":"MDQ6VXNlcjUzNTUyMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5355226?v=4","gravatar_id":"","url":"https://api.github.com/users/khui","html_url":"https://github.com/khui","followers_url":"https://api.github.com/users/khui/followers","following_url":"https://api.github.com/users/khui/following{/other_user}","gists_url":"https://api.github.com/users/khui/gists{/gist_id}","starred_url":"https://api.github.com/users/khui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/khui/subscriptions","organizations_url":"https://api.github.com/users/khui/orgs","repos_url":"https://api.github.com/users/khui/repos","events_url":"https://api.github.com/users/khui/events{/privacy}","received_events_url":"https://api.github.com/users/khui/received_events","type":"User","site_admin":false},"created_at":"2019-04-25T16:17:02Z","updated_at":"2019-04-25T16:19:15Z","author_association":"NONE","body":"One solution is to write a subsriptable class as the lookup function, which though looks like a workaround for me. Take a note here as for future referecnes. \r\n```\r\nclass UnkLookup(object):\r\n\r\n    def __init__(self, embedding_dim=50):\r\n        self.embedding_dim = embedding_dim\r\n        self.token_vec = {}\r\n\r\n    def __getitem__(self, token):\r\n        if token not in self.token_vec:\r\n            self.token_vec[token] = nd.random.uniform(shape=(self.embedding_dim,))\r\n        return self.token_vec[token]\r\n\r\n    def __contains__(self, token):\r\n        // hack to avoid the use of the embedding for '<unk>' if there is any.\r\n        return True\r\nunk_lookup = UnkLookup(embedding_dim=50)\r\nem = gluonnlp.embedding.create(embedding_name,\r\n                                       embedding_root=embedding_root,\r\n                                       unknown_token=None,\r\n                                       source=embedding_src,\r\n                                       allow_extend=True,\r\n                                       unknown_lookup=unk_lookup)\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/486740312/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"khui","id":5355226,"node_id":"MDQ6VXNlcjUzNTUyMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5355226?v=4","gravatar_id":"","url":"https://api.github.com/users/khui","html_url":"https://github.com/khui","followers_url":"https://api.github.com/users/khui/followers","following_url":"https://api.github.com/users/khui/following{/other_user}","gists_url":"https://api.github.com/users/khui/gists{/gist_id}","starred_url":"https://api.github.com/users/khui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/khui/subscriptions","organizations_url":"https://api.github.com/users/khui/orgs","repos_url":"https://api.github.com/users/khui/repos","events_url":"https://api.github.com/users/khui/events{/privacy}","received_events_url":"https://api.github.com/users/khui/received_events","type":"User","site_admin":false}},{"id":2303724808,"node_id":"MDEyOkxhYmVsZWRFdmVudDIzMDM3MjQ4MDg=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2303724808","actor":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-04-26T17:29:23Z","label":{"name":"enhancement","color":"135caf"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/487137784","html_url":"https://github.com/dmlc/gluon-nlp/issues/680#issuecomment-487137784","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/680","id":487137784,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzEzNzc4NA==","user":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false},"created_at":"2019-04-26T17:30:47Z","updated_at":"2019-04-26T17:30:47Z","author_association":"MEMBER","body":"Thanks for reporting it. Let's take this as part of the 0.7.0 roadmap as usability improvement item. Do you have a design in mind for the improvement?\r\ncc @astonzhang @leezu ","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/487137784/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false}},{"id":2303727867,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjMwMzcyNzg2Nw==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2303727867","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-04-26T17:30:47Z","performed_via_github_app":null},{"id":2303727868,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzMDM3Mjc4Njg=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2303727868","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-04-26T17:30:47Z","performed_via_github_app":null},{"id":2303727869,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjMwMzcyNzg2OQ==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2303727869","actor":{"login":"astonzhang","id":22279212,"node_id":"MDQ6VXNlcjIyMjc5MjEy","avatar_url":"https://avatars.githubusercontent.com/u/22279212?v=4","gravatar_id":"","url":"https://api.github.com/users/astonzhang","html_url":"https://github.com/astonzhang","followers_url":"https://api.github.com/users/astonzhang/followers","following_url":"https://api.github.com/users/astonzhang/following{/other_user}","gists_url":"https://api.github.com/users/astonzhang/gists{/gist_id}","starred_url":"https://api.github.com/users/astonzhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astonzhang/subscriptions","organizations_url":"https://api.github.com/users/astonzhang/orgs","repos_url":"https://api.github.com/users/astonzhang/repos","events_url":"https://api.github.com/users/astonzhang/events{/privacy}","received_events_url":"https://api.github.com/users/astonzhang/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-04-26T17:30:47Z","performed_via_github_app":null},{"id":2303727870,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzMDM3Mjc4NzA=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2303727870","actor":{"login":"astonzhang","id":22279212,"node_id":"MDQ6VXNlcjIyMjc5MjEy","avatar_url":"https://avatars.githubusercontent.com/u/22279212?v=4","gravatar_id":"","url":"https://api.github.com/users/astonzhang","html_url":"https://github.com/astonzhang","followers_url":"https://api.github.com/users/astonzhang/followers","following_url":"https://api.github.com/users/astonzhang/following{/other_user}","gists_url":"https://api.github.com/users/astonzhang/gists{/gist_id}","starred_url":"https://api.github.com/users/astonzhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astonzhang/subscriptions","organizations_url":"https://api.github.com/users/astonzhang/orgs","repos_url":"https://api.github.com/users/astonzhang/repos","events_url":"https://api.github.com/users/astonzhang/events{/privacy}","received_events_url":"https://api.github.com/users/astonzhang/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-04-26T17:30:47Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/487154975","html_url":"https://github.com/dmlc/gluon-nlp/issues/680#issuecomment-487154975","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/680","id":487154975,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzE1NDk3NQ==","user":{"login":"astonzhang","id":22279212,"node_id":"MDQ6VXNlcjIyMjc5MjEy","avatar_url":"https://avatars.githubusercontent.com/u/22279212?v=4","gravatar_id":"","url":"https://api.github.com/users/astonzhang","html_url":"https://github.com/astonzhang","followers_url":"https://api.github.com/users/astonzhang/followers","following_url":"https://api.github.com/users/astonzhang/following{/other_user}","gists_url":"https://api.github.com/users/astonzhang/gists{/gist_id}","starred_url":"https://api.github.com/users/astonzhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astonzhang/subscriptions","organizations_url":"https://api.github.com/users/astonzhang/orgs","repos_url":"https://api.github.com/users/astonzhang/repos","events_url":"https://api.github.com/users/astonzhang/events{/privacy}","received_events_url":"https://api.github.com/users/astonzhang/received_events","type":"User","site_admin":false},"created_at":"2019-04-26T18:24:14Z","updated_at":"2019-04-26T18:24:14Z","author_association":"MEMBER","body":"Thanks. Please see my comments in the code.\r\n\r\n```\r\n# Case 1: '<unk>' in the text data SHOULD be considered as the representation for any unknown token\r\n\r\n>>> import gluonnlp\r\n>>> text_data = ['<unk>', 'a', 'b']  # Say, we want any unknown token to map to '<unk>' in text_data\r\n>>> counter = gluonnlp.data.count_tokens(text_data)\r\n>>> my_vocab = gluonnlp.Vocab(counter)  # Use default unknown token '<unk>'\r\n>>> my_vocab.idx_to_token\r\n['<unk>', '<pad>', '<bos>', '<eos>', 'a', 'b']\r\n>>> my_vocab['x']  # any unknown token is mapped to '<unk>'\r\n0\r\n\r\n# Case 2: '<unk>' in the text data SHOULD NOT be considered as the representation for any unknown token\r\n\r\n# Say, now we want any unknown token to map to a token other than '<unk>' in text_data\r\n>>> my_vocab = gluonnlp.Vocab(counter, unknown_token='<<UnK>>')\r\n>>> my_vocab.idx_to_token\r\n['<<UnK>>', '<pad>', '<bos>', '<eos>', '<unk>', 'a', 'b']\r\n>>> my_vocab['x']  # any unknown token is mapped to '<<UnK>>'\r\n0\r\n>>> my_vocab['<unk>']  # '<unk>' is a common token\r\n4\r\n```","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/487154975/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"astonzhang","id":22279212,"node_id":"MDQ6VXNlcjIyMjc5MjEy","avatar_url":"https://avatars.githubusercontent.com/u/22279212?v=4","gravatar_id":"","url":"https://api.github.com/users/astonzhang","html_url":"https://github.com/astonzhang","followers_url":"https://api.github.com/users/astonzhang/followers","following_url":"https://api.github.com/users/astonzhang/following{/other_user}","gists_url":"https://api.github.com/users/astonzhang/gists{/gist_id}","starred_url":"https://api.github.com/users/astonzhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astonzhang/subscriptions","organizations_url":"https://api.github.com/users/astonzhang/orgs","repos_url":"https://api.github.com/users/astonzhang/repos","events_url":"https://api.github.com/users/astonzhang/events{/privacy}","received_events_url":"https://api.github.com/users/astonzhang/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/487576452","html_url":"https://github.com/dmlc/gluon-nlp/issues/680#issuecomment-487576452","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/680","id":487576452,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzU3NjQ1Mg==","user":{"login":"khui","id":5355226,"node_id":"MDQ6VXNlcjUzNTUyMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5355226?v=4","gravatar_id":"","url":"https://api.github.com/users/khui","html_url":"https://github.com/khui","followers_url":"https://api.github.com/users/khui/followers","following_url":"https://api.github.com/users/khui/following{/other_user}","gists_url":"https://api.github.com/users/khui/gists{/gist_id}","starred_url":"https://api.github.com/users/khui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/khui/subscriptions","organizations_url":"https://api.github.com/users/khui/orgs","repos_url":"https://api.github.com/users/khui/repos","events_url":"https://api.github.com/users/khui/events{/privacy}","received_events_url":"https://api.github.com/users/khui/received_events","type":"User","site_admin":false},"created_at":"2019-04-29T13:19:44Z","updated_at":"2019-04-29T17:38:49Z","author_association":"NONE","body":"@astonzhang \r\nThanks! \r\n\r\nBut I agree it is mostly about the logic behind the design when **using pre-trained embedding for an established vocabulary**. Namely, one may not want to treat the word from the vocabulary that does not present in a pre-trained embedding as `<unk>` (from the embedding).\r\n\r\nOne suggestion is to update the `Vocab.set_embedding(self, *embeddings)`. In particular, for the line [`new_idx_to_vec[1:, col_start:col_end] = embs[self._idx_to_token[1:]]`](https://github.com/dmlc/gluon-nlp/blob/master/src/gluonnlp/vocab/vocab.py#L319), check first the existence of the terms in `embs` before assignment. \r\n\r\n\r\n```\r\n        for embs in embeddings:\r\n            if embs and embs.idx_to_vec is not None:\r\n                col_end = col_start + embs.idx_to_vec.shape[1]\r\n                # Cancatenate vectors of the unknown token.\r\n                new_idx_to_vec[0, col_start:col_end] = embs.idx_to_vec[0]\r\n                new_idx_to_vec[1:, col_start:col_end] = embs[self._idx_to_token[1:]]\r\n                col_start = col_end\r\n```\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/487576452/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"khui","id":5355226,"node_id":"MDQ6VXNlcjUzNTUyMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5355226?v=4","gravatar_id":"","url":"https://api.github.com/users/khui","html_url":"https://github.com/khui","followers_url":"https://api.github.com/users/khui/followers","following_url":"https://api.github.com/users/khui/following{/other_user}","gists_url":"https://api.github.com/users/khui/gists{/gist_id}","starred_url":"https://api.github.com/users/khui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/khui/subscriptions","organizations_url":"https://api.github.com/users/khui/orgs","repos_url":"https://api.github.com/users/khui/repos","events_url":"https://api.github.com/users/khui/events{/privacy}","received_events_url":"https://api.github.com/users/khui/received_events","type":"User","site_admin":false}},{"id":2306665353,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjMwNjY2NTM1Mw==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2306665353","actor":{"login":"astonzhang","id":22279212,"node_id":"MDQ6VXNlcjIyMjc5MjEy","avatar_url":"https://avatars.githubusercontent.com/u/22279212?v=4","gravatar_id":"","url":"https://api.github.com/users/astonzhang","html_url":"https://github.com/astonzhang","followers_url":"https://api.github.com/users/astonzhang/followers","following_url":"https://api.github.com/users/astonzhang/following{/other_user}","gists_url":"https://api.github.com/users/astonzhang/gists{/gist_id}","starred_url":"https://api.github.com/users/astonzhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astonzhang/subscriptions","organizations_url":"https://api.github.com/users/astonzhang/orgs","repos_url":"https://api.github.com/users/astonzhang/repos","events_url":"https://api.github.com/users/astonzhang/events{/privacy}","received_events_url":"https://api.github.com/users/astonzhang/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-04-29T13:19:44Z","performed_via_github_app":null},{"id":2306665354,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzMDY2NjUzNTQ=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2306665354","actor":{"login":"astonzhang","id":22279212,"node_id":"MDQ6VXNlcjIyMjc5MjEy","avatar_url":"https://avatars.githubusercontent.com/u/22279212?v=4","gravatar_id":"","url":"https://api.github.com/users/astonzhang","html_url":"https://github.com/astonzhang","followers_url":"https://api.github.com/users/astonzhang/followers","following_url":"https://api.github.com/users/astonzhang/following{/other_user}","gists_url":"https://api.github.com/users/astonzhang/gists{/gist_id}","starred_url":"https://api.github.com/users/astonzhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astonzhang/subscriptions","organizations_url":"https://api.github.com/users/astonzhang/orgs","repos_url":"https://api.github.com/users/astonzhang/repos","events_url":"https://api.github.com/users/astonzhang/events{/privacy}","received_events_url":"https://api.github.com/users/astonzhang/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-04-29T13:19:44Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/504760244","html_url":"https://github.com/dmlc/gluon-nlp/issues/680#issuecomment-504760244","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/680","id":504760244,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDc2MDI0NA==","user":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"created_at":"2019-06-23T15:05:05Z","updated_at":"2019-06-23T15:05:05Z","author_association":"CONTRIBUTOR","body":"Hi @khui, thanks for raising this issue. Actually `init_unknown_vec` is not part of the public API of `TokenEmbedding` but only used in it's constructor. Thus we cannot use `init_unknown_vec` inside `Vocab.set_embedding`. Your proposal in https://github.com/dmlc/gluon-nlp/issues/680#issuecomment-486740312 is currently the only supported way.\r\n\r\nDo you see any issue with your proposal https://github.com/dmlc/gluon-nlp/issues/680#issuecomment-486740312? To make that easier, we could add a naive unknown lookup class to our API:\r\n\r\n```\r\nclass UnkLookup(object):\r\n    def __init__(self, init_vec=nd.random.uniform, embedding_dim=50):\r\n        self.init_vec = init_vec\r\n        self.embedding_dim = embedding_dim\r\n        self.token_vec = {}\r\n\r\n    def __getitem__(self, token):\r\n        if token not in self.token_vec:\r\n            self.token_vec[token] = self.init_vec(shape=(self.embedding_dim,))\r\n        return self.token_vec[token]\r\n\r\n    def __contains__(self, token):\r\n        // we can construct a vector for any token.\r\n        return True\r\n```\r\n\r\nThen your workaround will reduce to two statements (instead of requiring a class definition).\r\n\r\nI agree with you that it is not intuitive that `vocab.set_embedding` will use the same vector for every unknown token if the provided embedding has no unknown_lookup. Unfortunately any change will require breaking backwards compatibility.\r\n\r\nIn https://github.com/dmlc/gluon-nlp/pull/750/ I recently began work to refactor the `TokenEmbedding` class. Currently all changes are backwards compatible, but we may consider breaking the API and removing the current `init_unknown_vec` functionality in favor of only using `unknown_lookup`. This would solve your use-case, as it would essentially make your proposed workaround the default behavior.\r\n\r\n@szha @astonzhang @eric-haibin-lin I'd suggest to remove `unknown_token` completely from the `TokenEmbedding` class and replace it's behavior by a UnkLookup that returns the same, fixed vector for any token. In this case also the `init_unknown_vec` constructor argument would be removed and in essensce the else branch of the constructor introduced in https://github.com/dmlc/gluon-nlp/pull/750 could be removed, keeping only (with slight extensions):\r\n\r\nhttps://github.com/dmlc/gluon-nlp/blob/master/src/gluonnlp/embedding/token_embedding.py#L210-L239\r\n\r\nLet's discuss if you have any concerns or other proposals.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/504760244/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false}},{"id":2432493753,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjQzMjQ5Mzc1Mw==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2432493753","actor":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-06-23T15:05:06Z","performed_via_github_app":null},{"id":2432493754,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI0MzI0OTM3NTQ=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2432493754","actor":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-06-23T15:05:06Z","performed_via_github_app":null},{"id":2432493758,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjQzMjQ5Mzc1OA==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2432493758","actor":{"login":"khui","id":5355226,"node_id":"MDQ6VXNlcjUzNTUyMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5355226?v=4","gravatar_id":"","url":"https://api.github.com/users/khui","html_url":"https://github.com/khui","followers_url":"https://api.github.com/users/khui/followers","following_url":"https://api.github.com/users/khui/following{/other_user}","gists_url":"https://api.github.com/users/khui/gists{/gist_id}","starred_url":"https://api.github.com/users/khui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/khui/subscriptions","organizations_url":"https://api.github.com/users/khui/orgs","repos_url":"https://api.github.com/users/khui/repos","events_url":"https://api.github.com/users/khui/events{/privacy}","received_events_url":"https://api.github.com/users/khui/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-06-23T15:05:06Z","performed_via_github_app":null},{"id":2432493759,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI0MzI0OTM3NTk=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2432493759","actor":{"login":"khui","id":5355226,"node_id":"MDQ6VXNlcjUzNTUyMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5355226?v=4","gravatar_id":"","url":"https://api.github.com/users/khui","html_url":"https://github.com/khui","followers_url":"https://api.github.com/users/khui/followers","following_url":"https://api.github.com/users/khui/following{/other_user}","gists_url":"https://api.github.com/users/khui/gists{/gist_id}","starred_url":"https://api.github.com/users/khui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/khui/subscriptions","organizations_url":"https://api.github.com/users/khui/orgs","repos_url":"https://api.github.com/users/khui/repos","events_url":"https://api.github.com/users/khui/events{/privacy}","received_events_url":"https://api.github.com/users/khui/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-06-23T15:05:06Z","performed_via_github_app":null},{"id":2432493760,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjQzMjQ5Mzc2MA==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2432493760","actor":{"login":"eric-haibin-lin","id":5545640,"node_id":"MDQ6VXNlcjU1NDU2NDA=","avatar_url":"https://avatars.githubusercontent.com/u/5545640?v=4","gravatar_id":"","url":"https://api.github.com/users/eric-haibin-lin","html_url":"https://github.com/eric-haibin-lin","followers_url":"https://api.github.com/users/eric-haibin-lin/followers","following_url":"https://api.github.com/users/eric-haibin-lin/following{/other_user}","gists_url":"https://api.github.com/users/eric-haibin-lin/gists{/gist_id}","starred_url":"https://api.github.com/users/eric-haibin-lin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eric-haibin-lin/subscriptions","organizations_url":"https://api.github.com/users/eric-haibin-lin/orgs","repos_url":"https://api.github.com/users/eric-haibin-lin/repos","events_url":"https://api.github.com/users/eric-haibin-lin/events{/privacy}","received_events_url":"https://api.github.com/users/eric-haibin-lin/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-06-23T15:05:06Z","performed_via_github_app":null},{"id":2432493761,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI0MzI0OTM3NjE=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2432493761","actor":{"login":"eric-haibin-lin","id":5545640,"node_id":"MDQ6VXNlcjU1NDU2NDA=","avatar_url":"https://avatars.githubusercontent.com/u/5545640?v=4","gravatar_id":"","url":"https://api.github.com/users/eric-haibin-lin","html_url":"https://github.com/eric-haibin-lin","followers_url":"https://api.github.com/users/eric-haibin-lin/followers","following_url":"https://api.github.com/users/eric-haibin-lin/following{/other_user}","gists_url":"https://api.github.com/users/eric-haibin-lin/gists{/gist_id}","starred_url":"https://api.github.com/users/eric-haibin-lin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eric-haibin-lin/subscriptions","organizations_url":"https://api.github.com/users/eric-haibin-lin/orgs","repos_url":"https://api.github.com/users/eric-haibin-lin/repos","events_url":"https://api.github.com/users/eric-haibin-lin/events{/privacy}","received_events_url":"https://api.github.com/users/eric-haibin-lin/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-06-23T15:05:06Z","performed_via_github_app":null},{"id":2432493762,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjQzMjQ5Mzc2Mg==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2432493762","actor":{"login":"astonzhang","id":22279212,"node_id":"MDQ6VXNlcjIyMjc5MjEy","avatar_url":"https://avatars.githubusercontent.com/u/22279212?v=4","gravatar_id":"","url":"https://api.github.com/users/astonzhang","html_url":"https://github.com/astonzhang","followers_url":"https://api.github.com/users/astonzhang/followers","following_url":"https://api.github.com/users/astonzhang/following{/other_user}","gists_url":"https://api.github.com/users/astonzhang/gists{/gist_id}","starred_url":"https://api.github.com/users/astonzhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astonzhang/subscriptions","organizations_url":"https://api.github.com/users/astonzhang/orgs","repos_url":"https://api.github.com/users/astonzhang/repos","events_url":"https://api.github.com/users/astonzhang/events{/privacy}","received_events_url":"https://api.github.com/users/astonzhang/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-06-23T15:05:06Z","performed_via_github_app":null},{"id":2432493764,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI0MzI0OTM3NjQ=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2432493764","actor":{"login":"astonzhang","id":22279212,"node_id":"MDQ6VXNlcjIyMjc5MjEy","avatar_url":"https://avatars.githubusercontent.com/u/22279212?v=4","gravatar_id":"","url":"https://api.github.com/users/astonzhang","html_url":"https://github.com/astonzhang","followers_url":"https://api.github.com/users/astonzhang/followers","following_url":"https://api.github.com/users/astonzhang/following{/other_user}","gists_url":"https://api.github.com/users/astonzhang/gists{/gist_id}","starred_url":"https://api.github.com/users/astonzhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astonzhang/subscriptions","organizations_url":"https://api.github.com/users/astonzhang/orgs","repos_url":"https://api.github.com/users/astonzhang/repos","events_url":"https://api.github.com/users/astonzhang/events{/privacy}","received_events_url":"https://api.github.com/users/astonzhang/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-06-23T15:05:06Z","performed_via_github_app":null},{"id":2432494083,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQyNDMyNDk0MDgz","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2432494083","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2019-06-23T15:05:51Z","assignee":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/504789598","html_url":"https://github.com/dmlc/gluon-nlp/issues/680#issuecomment-504789598","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/680","id":504789598,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDc4OTU5OA==","user":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false},"created_at":"2019-06-23T21:41:18Z","updated_at":"2019-06-23T21:41:18Z","author_association":"MEMBER","body":"I think it makes total sense to use a unified way for unknown token look-up. Just keep in mind that we should pay attention to how we deprecate APIs. I started a discussion on this topic in #790.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/504789598/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false}}]