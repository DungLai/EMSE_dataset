[{"id":2892395568,"node_id":"MDEyOkxhYmVsZWRFdmVudDI4OTIzOTU1Njg=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2892395568","actor":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-12-18T06:53:18Z","label":{"name":"bug","color":"d73a4a"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/566894469","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-566894469","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":566894469,"node_id":"MDEyOklzc3VlQ29tbWVudDU2Njg5NDQ2OQ==","user":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"created_at":"2019-12-18T06:56:42Z","updated_at":"2019-12-18T06:56:42Z","author_association":"CONTRIBUTOR","body":"One workaround to the above problem is to initialize the `model` parameters before applying weight sharing:\r\n```\r\nmodel = nlp.model.train.AWDRNN(args.model, len(vocab), args.emsize, args.nhid, args.nlayers,\r\n                               args.tied, args.dropout, args.weight_dropout,\r\n                               args.dropout_h, args.dropout_i, args.dropout_e)\r\nmodel.initialize(mx.init.Xavier(), ctx=context)\r\nmodel_eval = nlp.model.AWDRNN(args.model, len(vocab), args.emsize, args.nhid, args.nlayers,\r\n                              args.tied, args.dropout, args.weight_dropout,\r\n                              args.dropout_h, args.dropout_i, args.dropout_e,\r\n                              params=model.collect_params())\r\n```","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/566894469/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/566894713","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-566894713","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":566894713,"node_id":"MDEyOklzc3VlQ29tbWVudDU2Njg5NDcxMw==","user":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"created_at":"2019-12-18T06:57:38Z","updated_at":"2019-12-18T06:58:28Z","author_association":"CONTRIBUTOR","body":"I suggest we drop the `WeightDropParameter`. Instead users can manually call `Dropout` in forward.\r\n\r\nUnderstanding `WeightDropParameter` requires intricate familiarity with the way Gluon handles Parameters and Blocks, and most users will have a hard time to understand it. However, our goal is to have easy to understand code. Thus in it's current implementation, `WeightDropParameter` doesn't align with our goals.\r\n\r\n Further, as pointed out by @liuzh91, the implementation is currently broken.\r\n\r\nWhat do others think? ","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/566894713/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false}},{"id":2892404266,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjg5MjQwNDI2Ng==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2892404266","actor":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-12-18T06:57:38Z","performed_via_github_app":null},{"id":2892404268,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI4OTI0MDQyNjg=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2892404268","actor":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-12-18T06:57:38Z","performed_via_github_app":null},{"id":2892406212,"node_id":"MDEyOkxhYmVsZWRFdmVudDI4OTI0MDYyMTI=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2892406212","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-12-18T06:58:37Z","label":{"name":"release focus","color":"fbca04"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/567816563","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-567816563","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":567816563,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NzgxNjU2Mw==","user":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"created_at":"2019-12-20T07:06:00Z","updated_at":"2019-12-20T07:08:23Z","author_association":"CONTRIBUTOR","body":"The above workaround does not work if we have `args.tied` turned on. In this case, after I ran the code `check_initialized(model_eval)`, I got the following error message:\r\n```\r\n*** RuntimeError: Parameter 'awdrnn0_hybridsequential0_embedding0_bias' has not been initialized\r\n```\r\nIt is exactly the output layer of the `model_eval`that not been initialized. `model_eval` contains the following parameters:\r\n```\r\nmodel_eval.collect_params()\r\nawdrnn0_ (\r\n  WeightDropParameter awdrnn0_hybridsequential0_embedding0_weight (shape=(33278, 400), dtype=float32, rate=0.1, mode=training)\r\n  Parameter awdrnn0_hybridsequential1_lstm0_l0_i2h_weight (shape=(4600, 400), dtype=float32)\r\n  WeightDropParameter awdrnn0_hybridsequential1_lstm0_l0_h2h_weight (shape=(4600, 1150), dtype=float32, rate=0.5, mode=training)\r\n  Parameter awdrnn0_hybridsequential1_lstm0_l0_i2h_bias (shape=(4600,), dtype=float32)\r\n  Parameter awdrnn0_hybridsequential1_lstm0_l0_h2h_bias (shape=(4600,), dtype=float32)\r\n  Parameter awdrnn0_hybridsequential1_lstm1_l0_i2h_weight (shape=(4600, 1150), dtype=float32)\r\n  WeightDropParameter awdrnn0_hybridsequential1_lstm1_l0_h2h_weight (shape=(4600, 1150), dtype=float32, rate=0.5, mode=training)\r\n  Parameter awdrnn0_hybridsequential1_lstm1_l0_i2h_bias (shape=(4600,), dtype=float32)\r\n  Parameter awdrnn0_hybridsequential1_lstm1_l0_h2h_bias (shape=(4600,), dtype=float32)\r\n  Parameter awdrnn0_hybridsequential1_lstm2_l0_i2h_weight (shape=(1600, 1150), dtype=float32)\r\n  WeightDropParameter awdrnn0_hybridsequential1_lstm2_l0_h2h_weight (shape=(1600, 400), dtype=float32, rate=0.5, mode=training)\r\n  Parameter awdrnn0_hybridsequential1_lstm2_l0_i2h_bias (shape=(1600,), dtype=float32)\r\n  Parameter awdrnn0_hybridsequential1_lstm2_l0_h2h_bias (shape=(1600,), dtype=float32)\r\n  Parameter awdrnn0_hybridsequential0_embedding0_bias (shape=(33278,), dtype=float32)\r\n)\r\n```\r\n\r\n`WeightDropParameter awdrnn0_hybridsequential0_embedding0_weight` and  `Parameter awdrnn0_hybridsequential0_embedding0_bias` have their weights tied up.  `WeightDropParameter awdrnn0_hybridsequential0_embedding0_weight` is properly initialized whereas `Parameter awdrnn0_hybridsequential0_embedding0_bias` is not initialized. I guess it is `WeightDropParameter` that causes the initialization error.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/567816563/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/568719679","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-568719679","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":568719679,"node_id":"MDEyOklzc3VlQ29tbWVudDU2ODcxOTY3OQ==","user":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"created_at":"2019-12-24T10:36:37Z","updated_at":"2019-12-26T06:29:17Z","author_association":"CONTRIBUTOR","body":"If I applied weight dropout during the forward pass:\r\n```python\r\nembedding_param = self.collect_params()['awdrnn0_hybridsequential0_embedding0_weight']\r\nembedding_param.set_data(mx.nd.Dropout(embedding_param.data(), 0.3))\r\n``` \r\nI got the following error msg:\r\n```\r\n*** mxnet.base.MXNetError: [10:20:43] src/imperative/imperative.cc:203: Check failed: AGInfo::IsNone(*output): Assigning to NDArrays that are already in a computational graph will cause undefined behavior when evaluating gradients. Please call backward first to clear the graph or do this out side of a record section. Also note that you cannot use inplace operations like +=, *=, relu(x, out=x), y[idx]=x, etc inside a record section.\r\n```\r\n\r\nNote that my code is wrapped in the `autograd.record()`.  The error suggests I apply the weight dropout outside the `record` section, but it is impractical in this case. Is there any workaround for this error?","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/568719679/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/568774413","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-568774413","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":568774413,"node_id":"MDEyOklzc3VlQ29tbWVudDU2ODc3NDQxMw==","user":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"created_at":"2019-12-24T16:23:19Z","updated_at":"2019-12-24T16:23:55Z","author_association":"CONTRIBUTOR","body":"Yes, this will not work indeed.\r\n\r\nYou need to do something like\r\n\r\n```python\r\ndef forward(self, ...):\r\n    ....\r\n    embedding_param = self.collect_params()['awdrnn0_hybridsequential0_embedding0_weight'].data(CTX)\r\n    embedding_param = mx.nd.Dropout(embedding_param, 0.3)\r\n    ....\r\n```","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/568774413/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/568833454","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-568833454","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":568833454,"node_id":"MDEyOklzc3VlQ29tbWVudDU2ODgzMzQ1NA==","user":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"created_at":"2019-12-25T04:03:09Z","updated_at":"2019-12-26T06:28:55Z","author_association":"CONTRIBUTOR","body":"> Yes, this will not work indeed.\r\n> \r\n> You need to do something like\r\n> \r\n> ```python\r\n> def forward(self, ...):\r\n>     ....\r\n>     embedding_param = self.collect_params()['awdrnn0_hybridsequential0_embedding0_weight'].data(CTX)\r\n>     embedding_param = mx.nd.Dropout(embedding_param, 0.3)\r\n>     ....\r\n> ```\r\n\r\nIt should use slice assign `embedding_param[:]` instead of `embedding_param`.  Otherwise, the weight `self.collect_params()['awdrnn0_hybridsequential0_embedding0_weight']` does not change at all. Concretely, I implement the following code:\r\n\r\n```python\r\n    embedding_param = self.collect_params(['awdrnn0_hybridsequential0_embedding0_weight'].data(CTX)\r\n    embedding_param[:] = mx.nd.Dropout(embedding_param, 0.3)\r\n```\r\nBut if I do it in this way, I still get the same `MXNetError`:\r\n```\r\n*** mxnet.base.MXNetError: [03:55:51] src/imperative/imperative.cc:203: Check failed: AGInfo::IsNone(*output): Assigning to NDArrays that are already in a computational graph will cause undefined behavior when evaluating gradients. Please call backward first to clear the graph or do this out side of a record section. Also note that you cannot use inplace operations like +=, *=, relu(x, out=x), y[idx]=x, etc inside a record section.\r\n```","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/568833454/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/568851120","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-568851120","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":568851120,"node_id":"MDEyOklzc3VlQ29tbWVudDU2ODg1MTEyMA==","user":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"created_at":"2019-12-25T06:47:35Z","updated_at":"2019-12-26T10:56:37Z","author_association":"CONTRIBUTOR","body":"> I suggest we drop the `WeightDropParameter`. Instead users can manually call `Dropout` in forward.\r\n> \r\n> Understanding `WeightDropParameter` requires intricate familiarity with the way Gluon handles Parameters and Blocks, and most users will have a hard time to understand it. However, our goal is to have easy to understand code. Thus in it's current implementation, `WeightDropParameter` doesn't align with our goals.\r\n> \r\n> Further, as pointed out by @liuzh91, the implementation is currently broken.\r\n> \r\n> What do others think?\r\n\r\nIt seems we cannot manually assign weights during the record session. I found a bunch of similar  assignment errors from the internet, e.g., https://discuss.mxnet.io/t/autograd-record-error-about-assigning-to-ndarray/322.  https://github.com/apache/incubator-mxnet/issues/9989\r\n\r\nAlternatively, I have tried weight assignment outside the record session suggested by the error msg. However, `mx.nd.Dropout` deferred the evaluation until entering the `with autograd.record()` scope. \r\n\r\nPerhaps we still need to switch back to the `apply_weight_drop()` function and fix the shared parameters problem there. In `apply_weight_drop()`, it technically replaces every `param` matching `local_param_regex` with a new `dropped_param` even the `param` is an instance of `WeightDropParameter`. If my understanding is correct, assume that the `param` is already an instance of `WeightDropParameter` by weight sharing, we do not need to create a new `WeightDropParameter dropped_param` and replace every occurrence of the `param`. The following assignment is therefore unnecessary:\r\nhttps://github.com/dmlc/gluon-nlp/blob/434187eb5e7bb898482021ffbc9c1648d0700608/src/gluonnlp/model/utils.py#L92\r\nIt can be replaced by\r\n```python\r\ndropped_param = param\r\n```\r\n\r\n[UPDATE] If I add a check before creating a new `dropped_param` in L92:\r\n```python\r\nif isinstance(param, WeightDropParameter):\r\n    continue\r\n```\r\n\r\nThe initialization works if I don't have `args.tied` turned on. If `args.tied` turned on, the tied weight parameters ` Parameter awdrnn0_hybridsequential0_embedding0_bias` still suffer the initialization problem. The bug is triggered by the following code:\r\n```python\r\n    with output.name_scope():\r\n            if self._tie_weights:\r\n                output.add(nn.Dense(self._vocab_size, flatten=False,\r\n                                    params=self.embedding[0].params))\r\n            else:\r\n                output.add(nn.Dense(self._vocab_size, flatten=False))\r\n```\r\n\r\n[UPDATE]2:\r\nAfter some investigation, I found the following debugging info:\r\n```\r\n(Pdb) model_eval.decoder[0]._params._shared.list_ctx()\r\n[cpu(0)]\r\n(Pdb) model_eval.decoder[0]._params.list_ctx()\r\n*** RuntimeError: Parameter 'awdrnn0_hybridsequential0_embedding0_bias' has not been initialized\r\n``` \r\n\r\nI believe `params` should always have the same context with the `params._shared`. There is something messed up here.\r\n\r\n[UPDATE]3:\r\nI am confused with the weight tied here. The two tied layers has different initialized values:\r\n```\r\n(Pdb) model.collect_params()['awdrnn0_hybridsequential0_embedding0_weight']._data\r\n[\r\n[[ 0.0097627   0.01856892  0.04303787 ... -0.08871634 -0.01311667\r\n  -0.00243246]\r\n [-0.03764082  0.07620091  0.03926869 ...  0.00636984 -0.06295353\r\n   0.06907154]\r\n [-0.0197481   0.00725491  0.08585829 ... -0.09896208  0.09590539\r\n   0.09404436]\r\n ...\r\n [-0.05431841  0.02288689  0.05555419 ...  0.05949707  0.00848633\r\n  -0.0083269 ]\r\n [ 0.04172196  0.00805981 -0.03484908 ... -0.08370983  0.04527131\r\n   0.05345441]\r\n [ 0.07405332  0.05066857  0.02247771 ... -0.00969069  0.03976088\r\n   0.00947104]]\r\n<NDArray 33278x400 @cpu(0)>]\r\n(Pdb) model.collect_params()['awdrnn0_hybridsequential0_embedding0_bias']._data\r\n[\r\n[0. 0. 0. ... 0. 0. 0.]\r\n<NDArray 33278 @cpu(0)>]\r\n```","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/568851120/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false}},{"id":2907648203,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjkwNzY0ODIwMw==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2907648203","actor":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-12-25T06:47:35Z","performed_via_github_app":null},{"id":2907648204,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5MDc2NDgyMDQ=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2907648204","actor":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-12-25T06:47:35Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569044319","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-569044319","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":569044319,"node_id":"MDEyOklzc3VlQ29tbWVudDU2OTA0NDMxOQ==","user":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"created_at":"2019-12-26T11:46:01Z","updated_at":"2019-12-26T11:47:10Z","author_association":"CONTRIBUTOR","body":"Why do you want to assign the weight? You can access the non-weight-dropped weight and apply dropout to the sliced part that you are interested. It's not necessary nor possible to modify the actual parameter via assignment in the forward pass.\r\n\r\nThe code I posted above, which doesn't do any in-place modification of the weight is correct. You just need to keep the variable around so that you use the same dropped out version at any location in the forward pass.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569044319/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569069451","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-569069451","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":569069451,"node_id":"MDEyOklzc3VlQ29tbWVudDU2OTA2OTQ1MQ==","user":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"created_at":"2019-12-26T14:41:10Z","updated_at":"2019-12-26T15:02:24Z","author_association":"CONTRIBUTOR","body":"> Why do you want to assign the weight? You can access the non-weight-dropped weight and apply dropout to the sliced part that you are interested. It's not necessary nor possible to modify the actual parameter via assignment in the forward pass.\r\n> \r\n> The code I posted above, which doesn't do any in-place modification of the weight is correct. You just need to keep the variable around so that you use the same dropped out version at any location in the forward pass.\r\n\r\nThe key problem is that how to do gradient backpropogation if the weight is not updated? If some weights are dropped in the forward pass, they should never be updated during current iteration. I really doubt whether the gradient computation will still work correctly with your hack.\r\n\r\nAlso, keeping network parameters in a temporary variable is also not memory efficient.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569069451/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569169629","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-569169629","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":569169629,"node_id":"MDEyOklzc3VlQ29tbWVudDU2OTE2OTYyOQ==","user":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false},"created_at":"2019-12-27T02:29:42Z","updated_at":"2019-12-27T02:29:42Z","author_association":"MEMBER","body":"I think we can add the weight drop flag to the Dense/RNN/Embedding layers. In that case, we can apply dropout inside hybrid_forward:\r\n\r\nhttps://github.com/apache/incubator-mxnet/blob/2ad3ce408b08456bff0b92a82aa3c484adde29f2/python/mxnet/gluon/nn/basic_layers.py#L222-L228","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569169629/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569180476","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-569180476","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":569180476,"node_id":"MDEyOklzc3VlQ29tbWVudDU2OTE4MDQ3Ng==","user":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"created_at":"2019-12-27T03:54:12Z","updated_at":"2019-12-27T03:59:13Z","author_association":"CONTRIBUTOR","body":"I finally figured out there is a mxnet weight sharing bug. When weight sharing is used with tied weight, something unexpected will occur. For this piece of code:\r\n\r\n```python\r\nmodel = nlp.model.train.AWDRNN(args.model, len(vocab), args.emsize, args.nhid, args.nlayers,\r\n                               args.tied, args.dropout, args.weight_dropout,\r\n                               args.dropout_h, args.dropout_i, args.dropout_e)\r\nmodel_eval = nlp.model.AWDRNN(args.model, len(vocab), args.emsize, args.nhid, args.nlayers,\r\n                              args.tied, args.dropout, args.weight_dropout,\r\n                              args.dropout_h, args.dropout_i, args.dropout_e,\r\n                              params=model.collect_params())\r\n\r\nmodel.initialize(mx.init.Xavier(), ctx=context)\r\n\r\nmodel.hybridize(static_alloc=True)\r\n```\r\n\r\nEven I comment out all the `apply_weight_drop` in the code, the initialization error still occurred if `args.tied` is turned on. I print out some pdb info here:\r\n\r\n```\r\n(Pdb) model_eval.decoder[0]._params\r\nawdrnn0_hybridsequential0_embedding0_ (\r\n  Parameter awdrnn0_hybridsequential0_embedding0_weight (shape=(33278, 400), dtype=float32)\r\n  Parameter awdrnn0_hybridsequential0_embedding0_bias (shape=(33278,), dtype=float32)\r\n)\r\n(Pdb) model_eval.decoder[0]._params.list_ctx()\r\n*** RuntimeError: Parameter 'awdrnn0_hybridsequential0_embedding0_bias' has not been initialized\r\n(Pdb) model_eval.decoder[0]._params._shared\r\nawdrnn0_hybridsequential0_embedding0_ (\r\n  Parameter awdrnn0_hybridsequential0_embedding0_weight (shape=(33278, 400), dtype=float32)\r\n)\r\n(Pdb) model_eval.decoder[0]._params._shared.list_ctx()\r\n[cpu(0)]\r\n```\r\nThe conclusion is: no matter whether we use weight drop or not, weight tied and weight sharing cannot be used simultaneously. Otherwise, there will be an initialization error. I will submit a separate issue for this in MXNET.\r\n\r\nFor the current weight drop bug, I think my fix is more simple and elegant. I will submit my PR very soon. \r\n","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569180476/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569182599","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-569182599","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":569182599,"node_id":"MDEyOklzc3VlQ29tbWVudDU2OTE4MjU5OQ==","user":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"created_at":"2019-12-27T04:10:58Z","updated_at":"2019-12-27T04:11:26Z","author_association":"CONTRIBUTOR","body":"> I think we can add the weight drop flag to the Dense/RNN/Embedding layers. In that case, we can apply dropout inside hybrid_forward:\r\n> \r\n> https://github.com/apache/incubator-mxnet/blob/2ad3ce408b08456bff0b92a82aa3c484adde29f2/python/mxnet/gluon/nn/basic_layers.py#L222-L228\r\n\r\nIt is similar to @leezu 's proposal.  My point is that using weight drop in `forward`/`hybrid_forward` will lead to some unexpected gradient computation error. So I  suggest we stick to the existing implementation of `apply_weight_drop`.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569182599/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false}},{"id":2910021033,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjkxMDAyMTAzMw==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2910021033","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-12-27T04:10:58Z","performed_via_github_app":null},{"id":2910021034,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5MTAwMjEwMzQ=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2910021034","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-12-27T04:10:58Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569183082","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-569183082","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":569183082,"node_id":"MDEyOklzc3VlQ29tbWVudDU2OTE4MzA4Mg==","user":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false},"created_at":"2019-12-27T04:15:39Z","updated_at":"2019-12-27T04:15:39Z","author_association":"MEMBER","body":"Let me try that. It should be fine (otherwise we will need to fix it in the MXNet side). The autograd error you’ve met is due to the fact that the AG engine in MXNet does not support assignment operations.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569183082/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569263078","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-569263078","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":569263078,"node_id":"MDEyOklzc3VlQ29tbWVudDU2OTI2MzA3OA==","user":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"created_at":"2019-12-27T12:47:25Z","updated_at":"2019-12-27T12:47:25Z","author_association":"CONTRIBUTOR","body":"> The key problem is that how to do gradient backpropogation if the weight is not updated? If some weights are dropped in the forward pass, they should never be updated during current iteration. I really doubt whether the gradient computation will still work correctly with your hack.\r\n\r\nIt's the same as Dropout. The gradient will be 0 for the dropped out parts. The proposal above is correct. ","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569263078/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569270928","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-569270928","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":569270928,"node_id":"MDEyOklzc3VlQ29tbWVudDU2OTI3MDkyOA==","user":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"created_at":"2019-12-27T13:35:54Z","updated_at":"2019-12-27T13:35:54Z","author_association":"CONTRIBUTOR","body":"> It's the same as Dropout. The gradient will be 0 for the dropped out parts. The proposal above is correct.\r\n\r\nI will check if gradient computation works correctly or not.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569270928/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569301151","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-569301151","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":569301151,"node_id":"MDEyOklzc3VlQ29tbWVudDU2OTMwMTE1MQ==","user":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"created_at":"2019-12-27T16:25:42Z","updated_at":"2019-12-27T16:25:42Z","author_association":"CONTRIBUTOR","body":"Ok, thank you. For your convenience, let me give a more complete code regarding above example:\r\nIf you had before\r\n\r\n``` python\r\ndef forward(self, x):\r\n    ....\r\n    embeddings = self.embedding(x)  # self.embedding is a gluon.nn.Embedding\r\n    ....\r\n```\r\n\r\nthen for weight dropout you need to\r\n\r\n\r\n``` python\r\ndef forward(self, x):\r\n    ....\r\n    embedding_param = self.collect_params()['awdrnn0_hybridsequential0_embedding0_weight'].data(CTX)\r\n    dropped_embedding = mx.nd.Dropout(embedding_param, 0.3)\r\n    word_embedding = mx.nd.Embedding(x, dropped_embedding)\r\n    ....\r\n```\r\n\r\nFurther, you can optimize the computation by only performing dropout on the part of the weight that you are interested in:\r\n\r\n``` python\r\ndef forward(self, x):\r\n    ....\r\n    embedding_param = self.collect_params()['awdrnn0_hybridsequential0_embedding0_weight'].data(CTX)\r\n    word_embedding = mx.nd.Embedding(x, embedding_param)\r\n    dropped_embedding = mx.nd.Dropout(word_embedding, 0.3)\r\n    ....\r\n```","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569301151/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569598764","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-569598764","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":569598764,"node_id":"MDEyOklzc3VlQ29tbWVudDU2OTU5ODc2NA==","user":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false},"created_at":"2019-12-30T06:55:25Z","updated_at":"2019-12-30T07:10:38Z","author_association":"CONTRIBUTOR","body":"@leezu  Thanks for the example. I have a few concerns about the your code.\r\n\r\n```python\r\ndef forward(self, x):\r\n    ....\r\n    embedding_param = self.collect_params()['awdrnn0_hybridsequential0_embedding0_weight'].data(CTX)\r\n    word_embedding = mx.nd.Embedding(x, embedding_param)\r\n    dropped_embedding = mx.nd.Dropout(word_embedding, 0.3)\r\n    ....\r\n```\r\nI believe this piece of code is to apply dropout on the word embedding instead of embedding weights.\r\n\r\noriginal embedding architecture looks like:\r\n```python\r\nembedding = nn.HybridSequential()\r\nwith embedding.name_scope():\r\n    embedding_block = nn.Embedding(self._vocab_size, self._embed_size,\r\n                                   weight_initializer=init.Uniform(0.1))\r\n    if self._drop_e:\r\n        apply_weight_drop(embedding_block, 'weight', self._drop_e, axes=(1,))\r\n    embedding.add(embedding_block)\r\n    if self._drop_i:\r\n        embedding.add(nn.Dropout(self._drop_i, axes=(0,)))\r\nreturn embedding\r\n```\r\n\r\nSo I think your implementation should be like \r\n```python\r\ndef forward(self, x):\r\n    ....\r\n    embedding_param = self.collect_params()['awdrnn0_hybridsequential0_embedding0_weight'].data(CTX)\r\n    if self._drop_e:\r\n        embedding_param = mx.nd.Dropout(embedding_param, self._drop_e)\r\n    word_embedding = mx.nd.Embedding(x, embedding_param)\r\n    if self._drop_i:\r\n        word_embedding = mx.nd.Dropout(word_embedding, self._drop_i)\r\n    ....\r\n```\r\n\r\nEach time if there is a dropout operation, do you have to reimplement the block structure in the forward function? It looks really impractical. what about weight drop on rnn cells? https://github.com/dmlc/gluon-nlp/blob/434187eb5e7bb898482021ffbc9c1648d0700608/src/gluonnlp/model/utils.py#L240","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569598764/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"liuzh47","id":12567586,"node_id":"MDQ6VXNlcjEyNTY3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/12567586?v=4","gravatar_id":"","url":"https://api.github.com/users/liuzh47","html_url":"https://github.com/liuzh47","followers_url":"https://api.github.com/users/liuzh47/followers","following_url":"https://api.github.com/users/liuzh47/following{/other_user}","gists_url":"https://api.github.com/users/liuzh47/gists{/gist_id}","starred_url":"https://api.github.com/users/liuzh47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuzh47/subscriptions","organizations_url":"https://api.github.com/users/liuzh47/orgs","repos_url":"https://api.github.com/users/liuzh47/repos","events_url":"https://api.github.com/users/liuzh47/events{/privacy}","received_events_url":"https://api.github.com/users/liuzh47/received_events","type":"User","site_admin":false}},{"id":2913314387,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjkxMzMxNDM4Nw==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2913314387","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-12-30T06:55:26Z","performed_via_github_app":null},{"id":2913314390,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5MTMzMTQzOTA=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2913314390","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-12-30T06:55:26Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569629511","html_url":"https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-569629511","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/1060","id":569629511,"node_id":"MDEyOklzc3VlQ29tbWVudDU2OTYyOTUxMQ==","user":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"created_at":"2019-12-30T09:51:01Z","updated_at":"2019-12-30T09:51:01Z","author_association":"CONTRIBUTOR","body":"Yes, above example for applying dropout sparsely was not correct. You would need the `np.unique` with `return_inverse=True` to make sure the same dropout mask is applied to repeated words.\r\nBut in fact, this kind of optimization is not crucial (it is currently not done either).\r\n\r\nYou're right about rnn cells. One way to avoid re-implementing the rnn cell is to add weight_drop support to the cells upstream in mxnet as @sxjscience suggested (https://github.com/dmlc/gluon-nlp/issues/1060#issuecomment-569169629). \r\n\r\nSo for now it may be simplest to keep `apply_weight_drop` around for the RNN use-case? When redesigning parameter handling in MXNet 2 we can revisit the design of `apply_weight_drop` and simplify the weight drop API / implementation.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/569629511/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false}},{"id":2913573753,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjkxMzU3Mzc1Mw==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2913573753","actor":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-12-30T09:51:02Z","performed_via_github_app":null},{"id":2913573755,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5MTM1NzM3NTU=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2913573755","actor":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-12-30T09:51:02Z","performed_via_github_app":null}]