[{"id":1707322850,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTcwNzMyMjg1MA==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/1707322850","actor":{"login":"szhengac","id":3960020,"node_id":"MDQ6VXNlcjM5NjAwMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3960020?v=4","gravatar_id":"","url":"https://api.github.com/users/szhengac","html_url":"https://github.com/szhengac","followers_url":"https://api.github.com/users/szhengac/followers","following_url":"https://api.github.com/users/szhengac/following{/other_user}","gists_url":"https://api.github.com/users/szhengac/gists{/gist_id}","starred_url":"https://api.github.com/users/szhengac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szhengac/subscriptions","organizations_url":"https://api.github.com/users/szhengac/orgs","repos_url":"https://api.github.com/users/szhengac/repos","events_url":"https://api.github.com/users/szhengac/events{/privacy}","received_events_url":"https://api.github.com/users/szhengac/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-06-28T20:54:37Z","performed_via_github_app":null},{"id":1707322851,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE3MDczMjI4NTE=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/1707322851","actor":{"login":"szhengac","id":3960020,"node_id":"MDQ6VXNlcjM5NjAwMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3960020?v=4","gravatar_id":"","url":"https://api.github.com/users/szhengac","html_url":"https://github.com/szhengac","followers_url":"https://api.github.com/users/szhengac/followers","following_url":"https://api.github.com/users/szhengac/following{/other_user}","gists_url":"https://api.github.com/users/szhengac/gists{/gist_id}","starred_url":"https://api.github.com/users/szhengac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szhengac/subscriptions","organizations_url":"https://api.github.com/users/szhengac/orgs","repos_url":"https://api.github.com/users/szhengac/repos","events_url":"https://api.github.com/users/szhengac/events{/privacy}","received_events_url":"https://api.github.com/users/szhengac/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-06-28T20:54:38Z","performed_via_github_app":null},{"id":1707404812,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQxNzA3NDA0ODEy","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/1707404812","actor":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2018-06-28T21:40:09Z","assignee":{"login":"szhengac","id":3960020,"node_id":"MDQ6VXNlcjM5NjAwMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3960020?v=4","gravatar_id":"","url":"https://api.github.com/users/szhengac","html_url":"https://github.com/szhengac","followers_url":"https://api.github.com/users/szhengac/followers","following_url":"https://api.github.com/users/szhengac/following{/other_user}","gists_url":"https://api.github.com/users/szhengac/gists{/gist_id}","starred_url":"https://api.github.com/users/szhengac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szhengac/subscriptions","organizations_url":"https://api.github.com/users/szhengac/orgs","repos_url":"https://api.github.com/users/szhengac/repos","events_url":"https://api.github.com/users/szhengac/events{/privacy}","received_events_url":"https://api.github.com/users/szhengac/received_events","type":"User","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/401184027","html_url":"https://github.com/dmlc/gluon-nlp/issues/178#issuecomment-401184027","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/178","id":401184027,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMTE4NDAyNw==","user":{"login":"szhengac","id":3960020,"node_id":"MDQ6VXNlcjM5NjAwMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3960020?v=4","gravatar_id":"","url":"https://api.github.com/users/szhengac","html_url":"https://github.com/szhengac","followers_url":"https://api.github.com/users/szhengac/followers","following_url":"https://api.github.com/users/szhengac/following{/other_user}","gists_url":"https://api.github.com/users/szhengac/gists{/gist_id}","starred_url":"https://api.github.com/users/szhengac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szhengac/subscriptions","organizations_url":"https://api.github.com/users/szhengac/orgs","repos_url":"https://api.github.com/users/szhengac/repos","events_url":"https://api.github.com/users/szhengac/events{/privacy}","received_events_url":"https://api.github.com/users/szhengac/received_events","type":"User","site_admin":false},"created_at":"2018-06-28T21:49:29Z","updated_at":"2018-06-28T22:05:33Z","author_association":"MEMBER","body":"Hi @JulianSlzr. Thanks for catching up. I think it would not make much difference. In t2t and sockeye, they also use slightly one from the paper. Do you mind try running the script with this modification to see how the performance changes? ","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/401184027/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"szhengac","id":3960020,"node_id":"MDQ6VXNlcjM5NjAwMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3960020?v=4","gravatar_id":"","url":"https://api.github.com/users/szhengac","html_url":"https://github.com/szhengac","followers_url":"https://api.github.com/users/szhengac/followers","following_url":"https://api.github.com/users/szhengac/following{/other_user}","gists_url":"https://api.github.com/users/szhengac/gists{/gist_id}","starred_url":"https://api.github.com/users/szhengac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szhengac/subscriptions","organizations_url":"https://api.github.com/users/szhengac/orgs","repos_url":"https://api.github.com/users/szhengac/repos","events_url":"https://api.github.com/users/szhengac/events{/privacy}","received_events_url":"https://api.github.com/users/szhengac/received_events","type":"User","site_admin":false}},{"id":1707419737,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTcwNzQxOTczNw==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/1707419737","actor":{"login":"JulianSlzr","id":4734836,"node_id":"MDQ6VXNlcjQ3MzQ4MzY=","avatar_url":"https://avatars.githubusercontent.com/u/4734836?v=4","gravatar_id":"","url":"https://api.github.com/users/JulianSlzr","html_url":"https://github.com/JulianSlzr","followers_url":"https://api.github.com/users/JulianSlzr/followers","following_url":"https://api.github.com/users/JulianSlzr/following{/other_user}","gists_url":"https://api.github.com/users/JulianSlzr/gists{/gist_id}","starred_url":"https://api.github.com/users/JulianSlzr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JulianSlzr/subscriptions","organizations_url":"https://api.github.com/users/JulianSlzr/orgs","repos_url":"https://api.github.com/users/JulianSlzr/repos","events_url":"https://api.github.com/users/JulianSlzr/events{/privacy}","received_events_url":"https://api.github.com/users/JulianSlzr/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-06-28T21:49:29Z","performed_via_github_app":null},{"id":1707419739,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE3MDc0MTk3Mzk=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/1707419739","actor":{"login":"JulianSlzr","id":4734836,"node_id":"MDQ6VXNlcjQ3MzQ4MzY=","avatar_url":"https://avatars.githubusercontent.com/u/4734836?v=4","gravatar_id":"","url":"https://api.github.com/users/JulianSlzr","html_url":"https://github.com/JulianSlzr","followers_url":"https://api.github.com/users/JulianSlzr/followers","following_url":"https://api.github.com/users/JulianSlzr/following{/other_user}","gists_url":"https://api.github.com/users/JulianSlzr/gists{/gist_id}","starred_url":"https://api.github.com/users/JulianSlzr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JulianSlzr/subscriptions","organizations_url":"https://api.github.com/users/JulianSlzr/orgs","repos_url":"https://api.github.com/users/JulianSlzr/repos","events_url":"https://api.github.com/users/JulianSlzr/events{/privacy}","received_events_url":"https://api.github.com/users/JulianSlzr/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-06-28T21:49:29Z","performed_via_github_app":null},{"id":1710159268,"node_id":"MDEyOkxhYmVsZWRFdmVudDE3MTAxNTkyNjg=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/1710159268","actor":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-07-01T04:22:01Z","label":{"name":"discussion","color":"c5def5"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/401600938","html_url":"https://github.com/dmlc/gluon-nlp/issues/178#issuecomment-401600938","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/178","id":401600938,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMTYwMDkzOA==","user":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false},"created_at":"2018-07-01T11:34:48Z","updated_at":"2018-07-01T11:34:48Z","author_association":"MEMBER","body":"I think the relative order should not affect the performance","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/401600938/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/404057839","html_url":"https://github.com/dmlc/gluon-nlp/issues/178#issuecomment-404057839","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/178","id":404057839,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDA1NzgzOQ==","user":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false},"created_at":"2018-07-11T06:19:48Z","updated_at":"2018-07-11T06:19:48Z","author_association":"MEMBER","body":"Any update?","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/404057839/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/514969535","html_url":"https://github.com/dmlc/gluon-nlp/issues/178#issuecomment-514969535","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/178","id":514969535,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNDk2OTUzNQ==","user":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"created_at":"2019-07-25T09:25:02Z","updated_at":"2019-07-25T09:25:32Z","author_association":"CONTRIBUTOR","body":"As the relative order doesn't seem to matter, how about replacing the current logic generating a fixed length (max_length) embedding matrix with \r\n\r\n``` python\r\nclass PositionalEmbedding(mx.gluon.HybridBlock):\r\n    \"\"\"Positional embedding.\r\n\r\n    Parameters\r\n    ----------\r\n    embed_size : int\r\n        Dimensionality of positional embeddings.\r\n    \"\"\"\r\n\r\n    def __init__(self, embed_size, **kwargs):\r\n        super().__init__(**kwargs)\r\n\r\n        inv_freq = 1 / mx.nd.power(10000, mx.nd.arange(0.0, embed_size, 2.0) / embed_size)\r\n        with self.name_scope():\r\n            self.inv_freq = self.params.get_constant('inv_freq', inv_freq.reshape((1, -1)))\r\n\r\n    def hybrid_forward(self, F, pos_seq, inv_freq):  # pylint: disable=arguments-differ\r\n        \"\"\"Compute positional embeddings.\r\n\r\n        Parameters\r\n        ----------\r\n        pos_seq : Symbol or NDArray\r\n            Positions to compute embedding for. Shape (length, )\r\n\r\n        Returns\r\n        -------\r\n        pos_emb: Symbol or NDArray\r\n            Positional embeddings for positions secified in pos_seq. Shape\r\n            (length, embed_size).\r\n        \"\"\"\r\n        inp = F.dot(pos_seq.reshape((-1, 1)), inv_freq)\r\n        pos_emb = F.concat(F.sin(inp), F.cos(inp), dim=-1)\r\n        return pos_emb\r\n```\r\n\r\nIn that case we don't require users to specify max_length a-priori when using sinusoidal embedding.\r\n\r\nAbove Block is currently used already as part of https://github.com/dmlc/gluon-nlp/pull/846","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/514969535/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/515458731","html_url":"https://github.com/dmlc/gluon-nlp/issues/178#issuecomment-515458731","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/178","id":515458731,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNTQ1ODczMQ==","user":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"created_at":"2019-07-26T13:45:21Z","updated_at":"2019-07-26T13:45:21Z","author_association":"CONTRIBUTOR","body":"I obtained \r\n\r\n```\r\n2019-07-25 18:20:45,923 - root - [Epoch 29] valid Loss=1.5228, valid ppl=4.5849, valid bleu=25.98\r\n2019-07-25 18:26:46,444 - root - [Epoch 29] test Loss=1.3216, test ppl=3.7493, test bleu=26.10\r\n2019-07-25 18:26:46,452 - root - Save best parameters to transformer_en_de_u512/valid_best.params\r\n2019-07-25 18:33:03,171 - root - Best model valid Loss=1.4929, valid ppl=4.4499, valid bleu=26.25\r\n2019-07-25 18:38:53,523 - root - Best model test Loss=1.2879, test ppl=3.6253, test bleu=26.85\r\n```\r\n\r\nwhen using above Block compared to \r\n\r\n```\r\n2019-07-25 19:43:16,816 - root - [Epoch 29] valid Loss=1.5230, valid ppl=4.5857, valid bleu=25.78\r\n2019-07-25 19:49:17,773 - root - [Epoch 29] test Loss=1.3219, test ppl=3.7506, test bleu=26.03\r\n2019-07-25 19:55:01,214 - root - Best model valid Loss=1.4923, valid ppl=4.4471, valid bleu=26.34\r\n2019-07-25 20:00:55,458 - root - Best model test Loss=1.2867, test ppl=3.6208, test bleu=26.79\r\n```\r\nwith the current script in the master branch.\r\n\r\nIn both cases running: `MXNET_GPU_MEM_POOL_TYPE=Round python train_transformer.py --dataset WMT2014BPE --src_lang en --tgt_lang de --batch_size 2700 --optimizer adam --num_accumulated 16 --lr 2.0 --warmup_steps 4000 --save_dir transformer_en_de_u512 --epochs 30 --gpus 0,1,2,3,4,5,6,7 --scaled --average_start 5 --num_buckets 20 --bucket_scheme exp --bleu 13a --log_interval 10`","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/515458731/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/515662220","html_url":"https://github.com/dmlc/gluon-nlp/issues/178#issuecomment-515662220","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/178","id":515662220,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNTY2MjIyMA==","user":{"login":"szhengac","id":3960020,"node_id":"MDQ6VXNlcjM5NjAwMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3960020?v=4","gravatar_id":"","url":"https://api.github.com/users/szhengac","html_url":"https://github.com/szhengac","followers_url":"https://api.github.com/users/szhengac/followers","following_url":"https://api.github.com/users/szhengac/following{/other_user}","gists_url":"https://api.github.com/users/szhengac/gists{/gist_id}","starred_url":"https://api.github.com/users/szhengac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szhengac/subscriptions","organizations_url":"https://api.github.com/users/szhengac/orgs","repos_url":"https://api.github.com/users/szhengac/repos","events_url":"https://api.github.com/users/szhengac/events{/privacy}","received_events_url":"https://api.github.com/users/szhengac/received_events","type":"User","site_admin":false},"created_at":"2019-07-27T07:39:06Z","updated_at":"2019-07-27T07:39:18Z","author_association":"MEMBER","body":"In the first version, I also used real-time computing, but I found it slows down the training. Then, I changed it to a predefined embedding matrix. Have you checked how long it takes to complete the training compared to using a fix embedding matrix?","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/515662220/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"szhengac","id":3960020,"node_id":"MDQ6VXNlcjM5NjAwMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3960020?v=4","gravatar_id":"","url":"https://api.github.com/users/szhengac","html_url":"https://github.com/szhengac","followers_url":"https://api.github.com/users/szhengac/followers","following_url":"https://api.github.com/users/szhengac/following{/other_user}","gists_url":"https://api.github.com/users/szhengac/gists{/gist_id}","starred_url":"https://api.github.com/users/szhengac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szhengac/subscriptions","organizations_url":"https://api.github.com/users/szhengac/orgs","repos_url":"https://api.github.com/users/szhengac/repos","events_url":"https://api.github.com/users/szhengac/events{/privacy}","received_events_url":"https://api.github.com/users/szhengac/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/515701149","html_url":"https://github.com/dmlc/gluon-nlp/issues/178#issuecomment-515701149","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/178","id":515701149,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNTcwMTE0OQ==","user":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"created_at":"2019-07-27T17:34:46Z","updated_at":"2019-07-27T17:34:46Z","author_association":"CONTRIBUTOR","body":"Both jobs were started at the same time on separate p3.16xlarge instances. According to above log, using the HybridBlock was about 1.5 hours faster than the the fixed embedding matrix way. Ì'm not sure about why the difference is so large. I'll check the full logs later if this is due to a sustained increased throughput or maybe due to some flakiness of the p3 instance running the unmodified code..","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/515701149/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":2},"performed_via_github_app":null,"event":"commented","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/515881306","html_url":"https://github.com/dmlc/gluon-nlp/issues/178#issuecomment-515881306","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/178","id":515881306,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNTg4MTMwNg==","user":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"created_at":"2019-07-29T07:39:23Z","updated_at":"2019-07-29T07:39:23Z","author_association":"CONTRIBUTOR","body":"See the two log files attached. Somehow the unmodified run got delayed by 1 hour during the first evaluation:\r\n\r\n```\r\n2019-07-24 21:38:45,328 - root - [Epoch 0 Batch 7520/7679] loss=7.0374, ppl=1138.4511, throughput=163.62K wps, wc=5783.88K\r\n2019-07-24 22:14:10,205 - root - [Epoch 0] valid Loss=6.2416, valid ppl=513.6734, valid bleu=0.21\r\n2019-07-24 22:51:49,854 - root - [Epoch 0] test Loss=6.4132, test ppl=609.8661, test bleu=0.18\r\n2019-07-24 22:51:49,862 - root - Save best parameters to transformer_en_de_u512/valid_best.params\r\n2019-07-24 22:52:29,000 - root - [Epoch 1 Batch 160/7679] loss=6.9615, ppl=1055.1741, throughput=152.81K wps, wc=5780.33K\r\n\r\n```\r\n\r\nCompared to the modified run\r\n\r\n```\r\n2019-07-24 21:39:13,101 - root - [Epoch 0 Batch 7520/7679] loss=7.0567, ppl=1160.6043, throughput=162.76K wps, wc=5783.88K\r\n2019-07-24 21:55:46,334 - root - [Epoch 0] valid Loss=6.2516, valid ppl=518.8240, valid bleu=0.27\r\n2019-07-24 22:09:51,370 - root - [Epoch 0] test Loss=6.4214, test ppl=614.8332, test bleu=0.24\r\n2019-07-24 22:09:51,378 - root - Save best parameters to transformer_en_de_u512/valid_best.params\r\n2019-07-24 22:10:35,695 - root - [Epoch 1 Batch 160/7679] loss=6.9881, ppl=1083.6077, throughput=152.01K wps, wc=5780.33K\r\n\r\n```\r\n\r\n[train_transformer.log](https://github.com/dmlc/gluon-nlp/files/3440757/train_transformer.log)\r\n[train_transformer_with_pos_emb_block.log](https://github.com/dmlc/gluon-nlp/files/3440758/train_transformer_with_pos_emb_block.log)\r\n\r\nHowever, based on the throughput numbers (in attached files) I think we can conclude that replacing the precomputed embedding matrix by above block does not, or at least not significantly impact the throughput.\r\n","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/515881306/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/516012027","html_url":"https://github.com/dmlc/gluon-nlp/issues/178#issuecomment-516012027","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/178","id":516012027,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNjAxMjAyNw==","user":{"login":"szhengac","id":3960020,"node_id":"MDQ6VXNlcjM5NjAwMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3960020?v=4","gravatar_id":"","url":"https://api.github.com/users/szhengac","html_url":"https://github.com/szhengac","followers_url":"https://api.github.com/users/szhengac/followers","following_url":"https://api.github.com/users/szhengac/following{/other_user}","gists_url":"https://api.github.com/users/szhengac/gists{/gist_id}","starred_url":"https://api.github.com/users/szhengac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szhengac/subscriptions","organizations_url":"https://api.github.com/users/szhengac/orgs","repos_url":"https://api.github.com/users/szhengac/repos","events_url":"https://api.github.com/users/szhengac/events{/privacy}","received_events_url":"https://api.github.com/users/szhengac/received_events","type":"User","site_admin":false},"created_at":"2019-07-29T14:20:33Z","updated_at":"2019-07-29T14:20:33Z","author_association":"MEMBER","body":"It seems that the main difference comes from the validation/testing in the first few epochs, where the modified embedding outputs a shorter sequence so that the beam search ends more quickly. This seems to suggest that the positions of sin and cos have something to do with the generation process.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/516012027/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"szhengac","id":3960020,"node_id":"MDQ6VXNlcjM5NjAwMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3960020?v=4","gravatar_id":"","url":"https://api.github.com/users/szhengac","html_url":"https://github.com/szhengac","followers_url":"https://api.github.com/users/szhengac/followers","following_url":"https://api.github.com/users/szhengac/following{/other_user}","gists_url":"https://api.github.com/users/szhengac/gists{/gist_id}","starred_url":"https://api.github.com/users/szhengac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szhengac/subscriptions","organizations_url":"https://api.github.com/users/szhengac/orgs","repos_url":"https://api.github.com/users/szhengac/repos","events_url":"https://api.github.com/users/szhengac/events{/privacy}","received_events_url":"https://api.github.com/users/szhengac/received_events","type":"User","site_admin":false}}]