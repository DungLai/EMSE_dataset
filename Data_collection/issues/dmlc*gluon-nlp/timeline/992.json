[{"id":2750417127,"node_id":"MDEyOkxhYmVsZWRFdmVudDI3NTA0MTcxMjc=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2750417127","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-10-28T23:53:59Z","label":{"name":"bug","color":"d73a4a"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/547196217","html_url":"https://github.com/dmlc/gluon-nlp/issues/992#issuecomment-547196217","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/992","id":547196217,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzE5NjIxNw==","user":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false},"created_at":"2019-10-28T23:55:27Z","updated_at":"2019-10-28T23:55:27Z","author_association":"CONTRIBUTOR","body":"If you could reproduce the non-deterministic behavior with a simple model / example, that would be helpful.\r\nFor example, you can try out the different components that the Bert model is made of and pinpoint which one is causing the issue.\r\nThank you!","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/547196217/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"leezu","id":946903,"node_id":"MDQ6VXNlcjk0NjkwMw==","avatar_url":"https://avatars.githubusercontent.com/u/946903?v=4","gravatar_id":"","url":"https://api.github.com/users/leezu","html_url":"https://github.com/leezu","followers_url":"https://api.github.com/users/leezu/followers","following_url":"https://api.github.com/users/leezu/following{/other_user}","gists_url":"https://api.github.com/users/leezu/gists{/gist_id}","starred_url":"https://api.github.com/users/leezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leezu/subscriptions","organizations_url":"https://api.github.com/users/leezu/orgs","repos_url":"https://api.github.com/users/leezu/repos","events_url":"https://api.github.com/users/leezu/events{/privacy}","received_events_url":"https://api.github.com/users/leezu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/547208271","html_url":"https://github.com/dmlc/gluon-nlp/issues/992#issuecomment-547208271","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/992","id":547208271,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzIwODI3MQ==","user":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false},"created_at":"2019-10-29T00:50:48Z","updated_at":"2019-10-29T00:50:48Z","author_association":"MEMBER","body":"@AaronYALai I'm not familiar with the inner mechanism of uuid. It looks that is may have interfered the random state of the random number generator.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/547208271/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false}},{"id":2750500995,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjc1MDUwMDk5NQ==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2750500995","actor":{"login":"AaronYALai","id":14147661,"node_id":"MDQ6VXNlcjE0MTQ3NjYx","avatar_url":"https://avatars.githubusercontent.com/u/14147661?v=4","gravatar_id":"","url":"https://api.github.com/users/AaronYALai","html_url":"https://github.com/AaronYALai","followers_url":"https://api.github.com/users/AaronYALai/followers","following_url":"https://api.github.com/users/AaronYALai/following{/other_user}","gists_url":"https://api.github.com/users/AaronYALai/gists{/gist_id}","starred_url":"https://api.github.com/users/AaronYALai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AaronYALai/subscriptions","organizations_url":"https://api.github.com/users/AaronYALai/orgs","repos_url":"https://api.github.com/users/AaronYALai/repos","events_url":"https://api.github.com/users/AaronYALai/events{/privacy}","received_events_url":"https://api.github.com/users/AaronYALai/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-10-29T00:50:48Z","performed_via_github_app":null},{"id":2750500996,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI3NTA1MDA5OTY=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2750500996","actor":{"login":"AaronYALai","id":14147661,"node_id":"MDQ6VXNlcjE0MTQ3NjYx","avatar_url":"https://avatars.githubusercontent.com/u/14147661?v=4","gravatar_id":"","url":"https://api.github.com/users/AaronYALai","html_url":"https://github.com/AaronYALai","followers_url":"https://api.github.com/users/AaronYALai/followers","following_url":"https://api.github.com/users/AaronYALai/following{/other_user}","gists_url":"https://api.github.com/users/AaronYALai/gists{/gist_id}","starred_url":"https://api.github.com/users/AaronYALai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AaronYALai/subscriptions","organizations_url":"https://api.github.com/users/AaronYALai/orgs","repos_url":"https://api.github.com/users/AaronYALai/repos","events_url":"https://api.github.com/users/AaronYALai/events{/privacy}","received_events_url":"https://api.github.com/users/AaronYALai/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-10-29T00:50:48Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/547556925","html_url":"https://github.com/dmlc/gluon-nlp/issues/992#issuecomment-547556925","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/992","id":547556925,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzU1NjkyNQ==","user":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false},"created_at":"2019-10-29T18:07:08Z","updated_at":"2019-10-29T18:07:42Z","author_association":"MEMBER","body":"@AaronYALai In fact, I'm not able to reproduce the inconsistency problem using the script. Maybe it's because I'm using 1.6","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/547556925/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false}},{"id":2753248372,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjc1MzI0ODM3Mg==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2753248372","actor":{"login":"AaronYALai","id":14147661,"node_id":"MDQ6VXNlcjE0MTQ3NjYx","avatar_url":"https://avatars.githubusercontent.com/u/14147661?v=4","gravatar_id":"","url":"https://api.github.com/users/AaronYALai","html_url":"https://github.com/AaronYALai","followers_url":"https://api.github.com/users/AaronYALai/followers","following_url":"https://api.github.com/users/AaronYALai/following{/other_user}","gists_url":"https://api.github.com/users/AaronYALai/gists{/gist_id}","starred_url":"https://api.github.com/users/AaronYALai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AaronYALai/subscriptions","organizations_url":"https://api.github.com/users/AaronYALai/orgs","repos_url":"https://api.github.com/users/AaronYALai/repos","events_url":"https://api.github.com/users/AaronYALai/events{/privacy}","received_events_url":"https://api.github.com/users/AaronYALai/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-10-29T18:07:08Z","performed_via_github_app":null},{"id":2753248374,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI3NTMyNDgzNzQ=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2753248374","actor":{"login":"AaronYALai","id":14147661,"node_id":"MDQ6VXNlcjE0MTQ3NjYx","avatar_url":"https://avatars.githubusercontent.com/u/14147661?v=4","gravatar_id":"","url":"https://api.github.com/users/AaronYALai","html_url":"https://github.com/AaronYALai","followers_url":"https://api.github.com/users/AaronYALai/followers","following_url":"https://api.github.com/users/AaronYALai/following{/other_user}","gists_url":"https://api.github.com/users/AaronYALai/gists{/gist_id}","starred_url":"https://api.github.com/users/AaronYALai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AaronYALai/subscriptions","organizations_url":"https://api.github.com/users/AaronYALai/orgs","repos_url":"https://api.github.com/users/AaronYALai/repos","events_url":"https://api.github.com/users/AaronYALai/events{/privacy}","received_events_url":"https://api.github.com/users/AaronYALai/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-10-29T18:07:08Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/547587230","html_url":"https://github.com/dmlc/gluon-nlp/issues/992#issuecomment-547587230","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/992","id":547587230,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzU4NzIzMA==","user":{"login":"AaronYALai","id":14147661,"node_id":"MDQ6VXNlcjE0MTQ3NjYx","avatar_url":"https://avatars.githubusercontent.com/u/14147661?v=4","gravatar_id":"","url":"https://api.github.com/users/AaronYALai","html_url":"https://github.com/AaronYALai","followers_url":"https://api.github.com/users/AaronYALai/followers","following_url":"https://api.github.com/users/AaronYALai/following{/other_user}","gists_url":"https://api.github.com/users/AaronYALai/gists{/gist_id}","starred_url":"https://api.github.com/users/AaronYALai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AaronYALai/subscriptions","organizations_url":"https://api.github.com/users/AaronYALai/orgs","repos_url":"https://api.github.com/users/AaronYALai/repos","events_url":"https://api.github.com/users/AaronYALai/events{/privacy}","received_events_url":"https://api.github.com/users/AaronYALai/received_events","type":"User","site_admin":false},"created_at":"2019-10-29T19:18:41Z","updated_at":"2019-10-29T19:18:41Z","author_association":"NONE","body":"To reproduce the issue, I've followed this process:\r\n\r\n1. Launch a new GPU instance (ex. p3.2xl) with Deep Learning AMI (Ubuntu 16.04) Version 24.3 (ami-05931d11d2bf831c3)\r\n\r\n2. Once get into the machine, setup the environment:\r\n```\r\nsource activate mxnet_p36\r\npip install --upgrade pip\r\npip install mxnet-cu100mkl==1.5.0\r\npip install gluonnlp\r\n```\r\n\r\n3. Uncomment the uuid.uuid1() line and run the test program above twice that can have inconsistent outputs","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/547587230/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"AaronYALai","id":14147661,"node_id":"MDQ6VXNlcjE0MTQ3NjYx","avatar_url":"https://avatars.githubusercontent.com/u/14147661?v=4","gravatar_id":"","url":"https://api.github.com/users/AaronYALai","html_url":"https://github.com/AaronYALai","followers_url":"https://api.github.com/users/AaronYALai/followers","following_url":"https://api.github.com/users/AaronYALai/following{/other_user}","gists_url":"https://api.github.com/users/AaronYALai/gists{/gist_id}","starred_url":"https://api.github.com/users/AaronYALai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AaronYALai/subscriptions","organizations_url":"https://api.github.com/users/AaronYALai/orgs","repos_url":"https://api.github.com/users/AaronYALai/repos","events_url":"https://api.github.com/users/AaronYALai/events{/privacy}","received_events_url":"https://api.github.com/users/AaronYALai/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/547590001","html_url":"https://github.com/dmlc/gluon-nlp/issues/992#issuecomment-547590001","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/992","id":547590001,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzU5MDAwMQ==","user":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false},"created_at":"2019-10-29T19:25:49Z","updated_at":"2019-10-29T19:28:43Z","author_association":"MEMBER","body":"`uuid.uuid1` queries `random.getrandbits` so it may have changed the internal states of `random`. This means that somewhere in the code there is dependency on the states in `random`.\r\n\r\nTo avoid querying the `random`, you can specify clock_seq argument when calling `uuid1`.\r\n\r\n<details><summary>Ref: `uuid.uuid1` implementation</summary>\r\n```\r\ndef uuid1(node=None, clock_seq=None):\r\n    \"\"\"Generate a UUID from a host ID, sequence number, and the current time.\r\n    If 'node' is not given, getnode() is used to obtain the hardware\r\n    address.  If 'clock_seq' is given, it is used as the sequence number;\r\n    otherwise a random 14-bit sequence number is chosen.\"\"\"\r\n\r\n    # When the system provides a version-1 UUID generator, use it (but don't\r\n    # use UuidCreate here because its UUIDs don't conform to RFC 4122).\r\n    _load_system_functions()\r\n    if _generate_time_safe is not None and node is clock_seq is None:\r\n        uuid_time, safely_generated = _generate_time_safe()\r\n        try:\r\n            is_safe = SafeUUID(safely_generated)\r\n        except ValueError:\r\n            is_safe = SafeUUID.unknown\r\n        return UUID(bytes=uuid_time, is_safe=is_safe)\r\n\r\n    global _last_timestamp\r\n    import time\r\n    nanoseconds = int(time.time() * 1e9)\r\n    # 0x01b21dd213814000 is the number of 100-ns intervals between the\r\n    # UUID epoch 1582-10-15 00:00:00 and the Unix epoch 1970-01-01 00:00:00.\r\n    timestamp = int(nanoseconds/100) + 0x01b21dd213814000\r\n    if _last_timestamp is not None and timestamp <= _last_timestamp:\r\n        timestamp = _last_timestamp + 1\r\n    _last_timestamp = timestamp\r\n    if clock_seq is None:\r\n        import random\r\n        clock_seq = random.getrandbits(14) # instead of stable storage\r\n    time_low = timestamp & 0xffffffff\r\n    time_mid = (timestamp >> 32) & 0xffff\r\n    time_hi_version = (timestamp >> 48) & 0x0fff\r\n    clock_seq_low = clock_seq & 0xff\r\n    clock_seq_hi_variant = (clock_seq >> 8) & 0x3f\r\n    if node is None:\r\n        node = getnode()\r\n    return UUID(fields=(time_low, time_mid, time_hi_version,\r\n                        clock_seq_hi_variant, clock_seq_low, node), version=1)\r\n```\r\n</details>","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/547590001/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/547591783","html_url":"https://github.com/dmlc/gluon-nlp/issues/992#issuecomment-547591783","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/992","id":547591783,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzU5MTc4Mw==","user":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false},"created_at":"2019-10-29T19:30:10Z","updated_at":"2019-10-29T19:30:10Z","author_association":"MEMBER","body":"It's unclear why such query would affect the consistency of the results. We should raise an issue in mxnet to investigate further.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/547591783/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/547623121","html_url":"https://github.com/dmlc/gluon-nlp/issues/992#issuecomment-547623121","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/992","id":547623121,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzYyMzEyMQ==","user":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false},"created_at":"2019-10-29T20:49:39Z","updated_at":"2019-10-29T20:49:39Z","author_association":"MEMBER","body":"@AaronYALai It's related to the cudnn dropout in MXNet, minimal reproducible example: https://gist.github.com/sxjscience/93512080231e6faa1f874fa3eba87b78","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/547623121/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false}},{"id":2753760707,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjc1Mzc2MDcwNw==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2753760707","actor":{"login":"AaronYALai","id":14147661,"node_id":"MDQ6VXNlcjE0MTQ3NjYx","avatar_url":"https://avatars.githubusercontent.com/u/14147661?v=4","gravatar_id":"","url":"https://api.github.com/users/AaronYALai","html_url":"https://github.com/AaronYALai","followers_url":"https://api.github.com/users/AaronYALai/followers","following_url":"https://api.github.com/users/AaronYALai/following{/other_user}","gists_url":"https://api.github.com/users/AaronYALai/gists{/gist_id}","starred_url":"https://api.github.com/users/AaronYALai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AaronYALai/subscriptions","organizations_url":"https://api.github.com/users/AaronYALai/orgs","repos_url":"https://api.github.com/users/AaronYALai/repos","events_url":"https://api.github.com/users/AaronYALai/events{/privacy}","received_events_url":"https://api.github.com/users/AaronYALai/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-10-29T20:49:39Z","performed_via_github_app":null},{"id":2753760709,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI3NTM3NjA3MDk=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2753760709","actor":{"login":"AaronYALai","id":14147661,"node_id":"MDQ6VXNlcjE0MTQ3NjYx","avatar_url":"https://avatars.githubusercontent.com/u/14147661?v=4","gravatar_id":"","url":"https://api.github.com/users/AaronYALai","html_url":"https://github.com/AaronYALai","followers_url":"https://api.github.com/users/AaronYALai/followers","following_url":"https://api.github.com/users/AaronYALai/following{/other_user}","gists_url":"https://api.github.com/users/AaronYALai/gists{/gist_id}","starred_url":"https://api.github.com/users/AaronYALai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AaronYALai/subscriptions","organizations_url":"https://api.github.com/users/AaronYALai/orgs","repos_url":"https://api.github.com/users/AaronYALai/repos","events_url":"https://api.github.com/users/AaronYALai/events{/privacy}","received_events_url":"https://api.github.com/users/AaronYALai/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-10-29T20:49:39Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/548502046","html_url":"https://github.com/dmlc/gluon-nlp/issues/992#issuecomment-548502046","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/992","id":548502046,"node_id":"MDEyOklzc3VlQ29tbWVudDU0ODUwMjA0Ng==","user":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false},"created_at":"2019-10-31T18:10:49Z","updated_at":"2019-10-31T18:10:49Z","author_association":"MEMBER","body":"@AaronYALai Here's the monkey patch approach to solve this problem (disable the cudnn-dropout):\r\n\r\n```python\r\nimport random\r\nimport mxnet as mx\r\n\r\n\r\ndef apply_monkey_patch_dropout(mxnet_lib):\r\n    class Dropout(mx.gluon.HybridBlock):\r\n        def __init__(self, rate, axes=(), **kwargs):\r\n            super(Dropout, self).__init__(**kwargs)\r\n            self._rate = rate\r\n            self._axes = axes\r\n\r\n        def hybrid_forward(self, F, x):\r\n            if self._rate > 0:\r\n                return F.Dropout(x, p=self._rate, axes=self._axes, name='fwd', cudnn_off=True)\r\n            else:\r\n                copy = F.identity\r\n                return copy(x)\r\n\r\n        def __repr__(self):\r\n            s = '{name}(p = {_rate}, axes={_axes})'\r\n            return s.format(name=self.__class__.__name__,\r\n                            **self.__dict__)\r\n    mxnet_lib.gluon.nn.Dropout = Dropout\r\napply_monkey_patch_dropout(mx)\r\n\r\nimport numpy as np\r\nimport gluonnlp as nlp\r\nimport uuid\r\n\r\n# mx.__version__ '1.5.0' (mxnet-cu100mkl)\r\n# np.__version__ '1.17.3'\r\n# nlp.__version__ '0.8.1'\r\n# environment: source activate mxnet_p36 (Amazon Deep Learning AMI)\r\n# machine: EC2 p3.8xl\r\n\r\n\r\ndef run_bert(context=[mx.gpu()]):\r\n    seed = 0\r\n    mx.random.seed(seed)\r\n    random.seed(seed)\r\n    np.random.seed(seed)\r\n\r\n    # Execute this line makes BERT non-deterministic inside mx.autograd.record()\r\n    uid = uuid.uuid1()\r\n\r\n    bert_model, bert_vocab = nlp.model.get_model(\r\n        name='bert_12_768_12',\r\n        dataset_name='book_corpus_wiki_en_uncased',\r\n        pretrained=True,\r\n        ctx=context,\r\n        use_pooler=True,\r\n        use_decoder=False,\r\n        use_classifier=False,\r\n        dropout=0.1,\r\n        embed_dropout=0.1)\r\n\r\n    # sample inputs\r\n    ti = mx.nd.array([[2, 22100, 2080, 2629, 2072, 2475, 2912, 7685, 4160, 2078,\r\n                       2629, 4430, 2581, 6895,  3501, 2546, 2629, 2480, 17299, 3],\r\n                      [2, 2064, 1045, 2689, 2000, 2151, 12485, 1029, 2835, 1999,\r\n                       6421, 2575, 2683, 12521, 18139, 2575, 2581, 16068, 2475, 3]],\r\n                     dtype=int, ctx=context[0])\r\n    tt = mx.nd.zeros((2, 20), dtype=int, ctx=context[0])\r\n    vl = mx.nd.array([20, 20], ctx=context[0])\r\n\r\n    # BERT forward, outside and inside autograd.record()\r\n    out1 = [a.sum().asscalar() for a in bert_model(ti, tt, vl)]\r\n\r\n    with mx.autograd.record():\r\n        # Inconsistent if call \"uuid.uuid1()\"\r\n        out2 = [a.sum().asscalar() for a in bert_model(ti, tt, vl)]\r\n\r\n    print('Outside autograd:', out1)\r\n    print('Inside autograd:', out2)\r\n\r\n\r\nif __name__ == '__main__':\r\n    run_bert()\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/548502046/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false}},{"id":2760895176,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjc2MDg5NTE3Ng==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2760895176","actor":{"login":"AaronYALai","id":14147661,"node_id":"MDQ6VXNlcjE0MTQ3NjYx","avatar_url":"https://avatars.githubusercontent.com/u/14147661?v=4","gravatar_id":"","url":"https://api.github.com/users/AaronYALai","html_url":"https://github.com/AaronYALai","followers_url":"https://api.github.com/users/AaronYALai/followers","following_url":"https://api.github.com/users/AaronYALai/following{/other_user}","gists_url":"https://api.github.com/users/AaronYALai/gists{/gist_id}","starred_url":"https://api.github.com/users/AaronYALai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AaronYALai/subscriptions","organizations_url":"https://api.github.com/users/AaronYALai/orgs","repos_url":"https://api.github.com/users/AaronYALai/repos","events_url":"https://api.github.com/users/AaronYALai/events{/privacy}","received_events_url":"https://api.github.com/users/AaronYALai/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-10-31T18:10:49Z","performed_via_github_app":null},{"id":2760895178,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI3NjA4OTUxNzg=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2760895178","actor":{"login":"AaronYALai","id":14147661,"node_id":"MDQ6VXNlcjE0MTQ3NjYx","avatar_url":"https://avatars.githubusercontent.com/u/14147661?v=4","gravatar_id":"","url":"https://api.github.com/users/AaronYALai","html_url":"https://github.com/AaronYALai","followers_url":"https://api.github.com/users/AaronYALai/followers","following_url":"https://api.github.com/users/AaronYALai/following{/other_user}","gists_url":"https://api.github.com/users/AaronYALai/gists{/gist_id}","starred_url":"https://api.github.com/users/AaronYALai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AaronYALai/subscriptions","organizations_url":"https://api.github.com/users/AaronYALai/orgs","repos_url":"https://api.github.com/users/AaronYALai/repos","events_url":"https://api.github.com/users/AaronYALai/events{/privacy}","received_events_url":"https://api.github.com/users/AaronYALai/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-10-31T18:10:49Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/548510295","html_url":"https://github.com/dmlc/gluon-nlp/issues/992#issuecomment-548510295","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/992","id":548510295,"node_id":"MDEyOklzc3VlQ29tbWVudDU0ODUxMDI5NQ==","user":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false},"created_at":"2019-10-31T18:30:32Z","updated_at":"2019-10-31T18:30:32Z","author_association":"MEMBER","body":"This PR in MXNet should fix the problem then. https://github.com/apache/incubator-mxnet/pull/16532","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/548510295/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"szha","id":2626883,"node_id":"MDQ6VXNlcjI2MjY4ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2626883?v=4","gravatar_id":"","url":"https://api.github.com/users/szha","html_url":"https://github.com/szha","followers_url":"https://api.github.com/users/szha/followers","following_url":"https://api.github.com/users/szha/following{/other_user}","gists_url":"https://api.github.com/users/szha/gists{/gist_id}","starred_url":"https://api.github.com/users/szha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szha/subscriptions","organizations_url":"https://api.github.com/users/szha/orgs","repos_url":"https://api.github.com/users/szha/repos","events_url":"https://api.github.com/users/szha/events{/privacy}","received_events_url":"https://api.github.com/users/szha/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/553208202","html_url":"https://github.com/dmlc/gluon-nlp/issues/992#issuecomment-553208202","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/992","id":553208202,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MzIwODIwMg==","user":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false},"created_at":"2019-11-13T02:23:40Z","updated_at":"2019-11-13T02:23:40Z","author_association":"MEMBER","body":"Let me close this one since it's mainly related to MXNet.","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/553208202/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false}},{"id":2793678896,"node_id":"MDExOkNsb3NlZEV2ZW50Mjc5MzY3ODg5Ng==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2793678896","actor":{"login":"sxjscience","id":5178350,"node_id":"MDQ6VXNlcjUxNzgzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5178350?v=4","gravatar_id":"","url":"https://api.github.com/users/sxjscience","html_url":"https://github.com/sxjscience","followers_url":"https://api.github.com/users/sxjscience/followers","following_url":"https://api.github.com/users/sxjscience/following{/other_user}","gists_url":"https://api.github.com/users/sxjscience/gists{/gist_id}","starred_url":"https://api.github.com/users/sxjscience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sxjscience/subscriptions","organizations_url":"https://api.github.com/users/sxjscience/orgs","repos_url":"https://api.github.com/users/sxjscience/repos","events_url":"https://api.github.com/users/sxjscience/events{/privacy}","received_events_url":"https://api.github.com/users/sxjscience/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-11-13T02:23:40Z","state_reason":null,"performed_via_github_app":null}]