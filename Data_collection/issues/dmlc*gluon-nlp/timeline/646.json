[{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/476713661","html_url":"https://github.com/dmlc/gluon-nlp/issues/646#issuecomment-476713661","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/646","id":476713661,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjcxMzY2MQ==","user":{"login":"szhengac","id":3960020,"node_id":"MDQ6VXNlcjM5NjAwMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3960020?v=4","gravatar_id":"","url":"https://api.github.com/users/szhengac","html_url":"https://github.com/szhengac","followers_url":"https://api.github.com/users/szhengac/followers","following_url":"https://api.github.com/users/szhengac/following{/other_user}","gists_url":"https://api.github.com/users/szhengac/gists{/gist_id}","starred_url":"https://api.github.com/users/szhengac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szhengac/subscriptions","organizations_url":"https://api.github.com/users/szhengac/orgs","repos_url":"https://api.github.com/users/szhengac/repos","events_url":"https://api.github.com/users/szhengac/events{/privacy}","received_events_url":"https://api.github.com/users/szhengac/received_events","type":"User","site_admin":false},"created_at":"2019-03-26T15:49:29Z","updated_at":"2019-03-26T15:55:00Z","author_association":"MEMBER","body":"@lambdaofgod I tried following small example and I cannot reproduce the error. Can you check how it differs from your code? Also, you may try the below code. If it does not work, the error may have something to do with the version of gluonnlp/mxnet.\r\n\r\n```\r\nimport mxnet as mx\r\nimport gluonnlp as nlp\r\n\r\nfrom gluonnlp.model.translation import NMTModel\r\nfrom gluonnlp.model.transformer import get_transformer_encoder_decoder\r\nfrom translation import BeamSearchTranslator\r\nimport itertools\r\n\r\nn_units = 128\r\nhidden_size = 512\r\nseq_length = 100\r\ncontext = mx.gpu(0)\r\n\r\nencoder, decoder = nlp.model.transformer.get_transformer_encoder_decoder(\r\n    num_layers=2,\r\n    units=n_units,\r\n    hidden_size=hidden_size,\r\n    use_residual=False ,\r\n    max_src_length=seq_length,\r\n    max_tgt_length=seq_length,\r\n    num_heads=1\r\n)\r\n\r\ntrain_seqs = [['I', 'am', 'Charles'], ['Today', 'is', 'a', 'good', 'day']]\r\ncounter = nlp.data.count_tokens(list(itertools.chain.from_iterable(train_seqs)))\r\nvocab = nlp.Vocab(counter, max_size=100, padding_token=None,\r\n                  bos_token=None, eos_token=None)\r\nmodel = NMTModel(vocab, vocab, encoder, decoder, embed_size=n_units, share_embed=True)\r\nmodel.initialize(mx.init.Xavier(), ctx=context)\r\n\r\ntranslator = BeamSearchTranslator(model=model, beam_size=4,\r\n                                  scorer=nlp.model.BeamSearchScorer(alpha=0.4,\r\n                                                                    K=5),\r\n                                  max_length=50)\r\n\r\nexample_input_batch = mx.nd.zeros((100, 25), ctx=context)\r\nresult = translator.translate(example_input_batch, mx.nd.full((example_input_batch.shape[0]), ctx=context, val=example_input_batch.shape[1]-1))\r\n#result = translator.translate(example_input_batch, None)\r\nprint(result)\r\n```","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/476713661/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"szhengac","id":3960020,"node_id":"MDQ6VXNlcjM5NjAwMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3960020?v=4","gravatar_id":"","url":"https://api.github.com/users/szhengac","html_url":"https://github.com/szhengac","followers_url":"https://api.github.com/users/szhengac/followers","following_url":"https://api.github.com/users/szhengac/following{/other_user}","gists_url":"https://api.github.com/users/szhengac/gists{/gist_id}","starred_url":"https://api.github.com/users/szhengac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szhengac/subscriptions","organizations_url":"https://api.github.com/users/szhengac/orgs","repos_url":"https://api.github.com/users/szhengac/repos","events_url":"https://api.github.com/users/szhengac/events{/privacy}","received_events_url":"https://api.github.com/users/szhengac/received_events","type":"User","site_admin":false}},{"id":2230258320,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjIzMDI1ODMyMA==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2230258320","actor":{"login":"lambdaofgod","id":3647577,"node_id":"MDQ6VXNlcjM2NDc1Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/3647577?v=4","gravatar_id":"","url":"https://api.github.com/users/lambdaofgod","html_url":"https://github.com/lambdaofgod","followers_url":"https://api.github.com/users/lambdaofgod/followers","following_url":"https://api.github.com/users/lambdaofgod/following{/other_user}","gists_url":"https://api.github.com/users/lambdaofgod/gists{/gist_id}","starred_url":"https://api.github.com/users/lambdaofgod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lambdaofgod/subscriptions","organizations_url":"https://api.github.com/users/lambdaofgod/orgs","repos_url":"https://api.github.com/users/lambdaofgod/repos","events_url":"https://api.github.com/users/lambdaofgod/events{/privacy}","received_events_url":"https://api.github.com/users/lambdaofgod/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-03-26T15:49:29Z","performed_via_github_app":null},{"id":2230258322,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIyMzAyNTgzMjI=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2230258322","actor":{"login":"lambdaofgod","id":3647577,"node_id":"MDQ6VXNlcjM2NDc1Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/3647577?v=4","gravatar_id":"","url":"https://api.github.com/users/lambdaofgod","html_url":"https://github.com/lambdaofgod","followers_url":"https://api.github.com/users/lambdaofgod/followers","following_url":"https://api.github.com/users/lambdaofgod/following{/other_user}","gists_url":"https://api.github.com/users/lambdaofgod/gists{/gist_id}","starred_url":"https://api.github.com/users/lambdaofgod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lambdaofgod/subscriptions","organizations_url":"https://api.github.com/users/lambdaofgod/orgs","repos_url":"https://api.github.com/users/lambdaofgod/repos","events_url":"https://api.github.com/users/lambdaofgod/events{/privacy}","received_events_url":"https://api.github.com/users/lambdaofgod/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-03-26T15:49:29Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/476719080","html_url":"https://github.com/dmlc/gluon-nlp/issues/646#issuecomment-476719080","issue_url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/646","id":476719080,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjcxOTA4MA==","user":{"login":"lambdaofgod","id":3647577,"node_id":"MDQ6VXNlcjM2NDc1Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/3647577?v=4","gravatar_id":"","url":"https://api.github.com/users/lambdaofgod","html_url":"https://github.com/lambdaofgod","followers_url":"https://api.github.com/users/lambdaofgod/followers","following_url":"https://api.github.com/users/lambdaofgod/following{/other_user}","gists_url":"https://api.github.com/users/lambdaofgod/gists{/gist_id}","starred_url":"https://api.github.com/users/lambdaofgod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lambdaofgod/subscriptions","organizations_url":"https://api.github.com/users/lambdaofgod/orgs","repos_url":"https://api.github.com/users/lambdaofgod/repos","events_url":"https://api.github.com/users/lambdaofgod/events{/privacy}","received_events_url":"https://api.github.com/users/lambdaofgod/received_events","type":"User","site_admin":false},"created_at":"2019-03-26T16:00:36Z","updated_at":"2019-03-26T16:00:36Z","author_association":"NONE","body":"@szhengac I tried your code again. It looks like I introduced a bug by tinkering in BeamSearchTranslator.\r\n\r\nThanks!","reactions":{"url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/comments/476719080/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lambdaofgod","id":3647577,"node_id":"MDQ6VXNlcjM2NDc1Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/3647577?v=4","gravatar_id":"","url":"https://api.github.com/users/lambdaofgod","html_url":"https://github.com/lambdaofgod","followers_url":"https://api.github.com/users/lambdaofgod/followers","following_url":"https://api.github.com/users/lambdaofgod/following{/other_user}","gists_url":"https://api.github.com/users/lambdaofgod/gists{/gist_id}","starred_url":"https://api.github.com/users/lambdaofgod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lambdaofgod/subscriptions","organizations_url":"https://api.github.com/users/lambdaofgod/orgs","repos_url":"https://api.github.com/users/lambdaofgod/repos","events_url":"https://api.github.com/users/lambdaofgod/events{/privacy}","received_events_url":"https://api.github.com/users/lambdaofgod/received_events","type":"User","site_admin":false}},{"id":2230298393,"node_id":"MDExOkNsb3NlZEV2ZW50MjIzMDI5ODM5Mw==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2230298393","actor":{"login":"lambdaofgod","id":3647577,"node_id":"MDQ6VXNlcjM2NDc1Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/3647577?v=4","gravatar_id":"","url":"https://api.github.com/users/lambdaofgod","html_url":"https://github.com/lambdaofgod","followers_url":"https://api.github.com/users/lambdaofgod/followers","following_url":"https://api.github.com/users/lambdaofgod/following{/other_user}","gists_url":"https://api.github.com/users/lambdaofgod/gists{/gist_id}","starred_url":"https://api.github.com/users/lambdaofgod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lambdaofgod/subscriptions","organizations_url":"https://api.github.com/users/lambdaofgod/orgs","repos_url":"https://api.github.com/users/lambdaofgod/repos","events_url":"https://api.github.com/users/lambdaofgod/events{/privacy}","received_events_url":"https://api.github.com/users/lambdaofgod/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-03-26T16:00:36Z","state_reason":null,"performed_via_github_app":null},{"id":2230298399,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjIzMDI5ODM5OQ==","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2230298399","actor":{"login":"szhengac","id":3960020,"node_id":"MDQ6VXNlcjM5NjAwMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3960020?v=4","gravatar_id":"","url":"https://api.github.com/users/szhengac","html_url":"https://github.com/szhengac","followers_url":"https://api.github.com/users/szhengac/followers","following_url":"https://api.github.com/users/szhengac/following{/other_user}","gists_url":"https://api.github.com/users/szhengac/gists{/gist_id}","starred_url":"https://api.github.com/users/szhengac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szhengac/subscriptions","organizations_url":"https://api.github.com/users/szhengac/orgs","repos_url":"https://api.github.com/users/szhengac/repos","events_url":"https://api.github.com/users/szhengac/events{/privacy}","received_events_url":"https://api.github.com/users/szhengac/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-03-26T16:00:36Z","performed_via_github_app":null},{"id":2230298401,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIyMzAyOTg0MDE=","url":"https://api.github.com/repos/dmlc/gluon-nlp/issues/events/2230298401","actor":{"login":"szhengac","id":3960020,"node_id":"MDQ6VXNlcjM5NjAwMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3960020?v=4","gravatar_id":"","url":"https://api.github.com/users/szhengac","html_url":"https://github.com/szhengac","followers_url":"https://api.github.com/users/szhengac/followers","following_url":"https://api.github.com/users/szhengac/following{/other_user}","gists_url":"https://api.github.com/users/szhengac/gists{/gist_id}","starred_url":"https://api.github.com/users/szhengac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szhengac/subscriptions","organizations_url":"https://api.github.com/users/szhengac/orgs","repos_url":"https://api.github.com/users/szhengac/repos","events_url":"https://api.github.com/users/szhengac/events{/privacy}","received_events_url":"https://api.github.com/users/szhengac/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-03-26T16:00:36Z","performed_via_github_app":null}]