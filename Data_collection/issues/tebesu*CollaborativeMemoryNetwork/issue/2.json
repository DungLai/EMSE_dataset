{"url":"https://api.github.com/repos/tebesu/CollaborativeMemoryNetwork/issues/2","repository_url":"https://api.github.com/repos/tebesu/CollaborativeMemoryNetwork","labels_url":"https://api.github.com/repos/tebesu/CollaborativeMemoryNetwork/issues/2/labels{/name}","comments_url":"https://api.github.com/repos/tebesu/CollaborativeMemoryNetwork/issues/2/comments","events_url":"https://api.github.com/repos/tebesu/CollaborativeMemoryNetwork/issues/2/events","html_url":"https://github.com/tebesu/CollaborativeMemoryNetwork/issues/2","id":361194597,"node_id":"MDU6SXNzdWUzNjExOTQ1OTc=","number":2,"title":"train.py crash InvalidArgumentError","user":{"login":"MaurizioFD","id":23312164,"node_id":"MDQ6VXNlcjIzMzEyMTY0","avatar_url":"https://avatars.githubusercontent.com/u/23312164?v=4","gravatar_id":"","url":"https://api.github.com/users/MaurizioFD","html_url":"https://github.com/MaurizioFD","followers_url":"https://api.github.com/users/MaurizioFD/followers","following_url":"https://api.github.com/users/MaurizioFD/following{/other_user}","gists_url":"https://api.github.com/users/MaurizioFD/gists{/gist_id}","starred_url":"https://api.github.com/users/MaurizioFD/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MaurizioFD/subscriptions","organizations_url":"https://api.github.com/users/MaurizioFD/orgs","repos_url":"https://api.github.com/users/MaurizioFD/repos","events_url":"https://api.github.com/users/MaurizioFD/events{/privacy}","received_events_url":"https://api.github.com/users/MaurizioFD/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2018-09-18T08:37:55Z","updated_at":"2018-10-24T17:58:03Z","closed_at":"2018-10-24T17:58:03Z","author_association":"NONE","active_lock_reason":null,"body":"Dear authors,\r\n\r\nI was trying to run your algorithm. While pretrain.py runs until the end, train.py, with your own configuration, crashes very soon with an InvalidArgumentError\r\n\r\nI am using tensorflow 1.8.0, sonnet 1.23 and python 3.6\r\n\r\nThe console oputput is the following:\r\n\r\n\r\n\r\n\r\n[INFO:tensorflow]<info>:116: \r\n\r\n{\r\n  \"batch_size\": 128,\r\n  \"decay_rate\": 0.9,\r\n  \"embed_size\": 50,\r\n  \"filename\": \"data/citeulike-a.npz\",\r\n  \"grad_clip\": 5.0,\r\n  \"hops\": 2,\r\n  \"item_count\": \"16980\",\r\n  \"l2\": 0.1,\r\n  \"learning_rate\": 0.001,\r\n  \"logdir\": \"result/004/\",\r\n  \"max_neighbors\": 311,\r\n  \"neg_count\": 4,\r\n  \"optimizer\": \"rmsprop\",\r\n  \"optimizer_params\": \"{'momentum': 0.9, 'decay': 0.9}\",\r\n  \"pretrain\": \"pretrain/citeulike-a_e50.npz\",\r\n  \"save_directory\": \"result/004/\",\r\n  \"tol\": 1e-05,\r\n  \"user_count\": \"5551\"\r\n}\r\n\r\n\r\n[WARNING:tensorflow]<warning>:126: From /home/ubuntu/Scaricati/CollaborativeMemoryNetwork-master/util/layers.py:250: get_or_create_global_step (from tensorflow.contrib.framework.python.ops.variables) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nPlease switch to tf.train.get_or_create_global_step\r\n[INFO:tensorflow]<info>:116: Creating Hop Mapping 2 with <function relu at 0x7f6033936400>\r\n[INFO:tensorflow]<info>:116: Creating Hop Mapping 2 with <function relu at 0x7f6033936400>\r\n[WARNING:tensorflow]<warning>:126: From train.py:83: Supervisor.__init__ (from tensorflow.python.training.supervisor) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nPlease switch to tf.train.MonitoredTrainingSession\r\n2018-09-18 10:31:07.033201: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\r\n[INFO:tensorflow]<info>:116: Running local_init_op.\r\n[INFO:tensorflow]<info>:116: Done running local_init_op.\r\n[INFO:tensorflow]<info>:116: Starting standard services.\r\n[INFO:tensorflow]<info>:116: Saving checkpoint to path result/004/model.ckpt\r\n[INFO:tensorflow]<info>:116: Starting queue runners.\r\n[INFO:tensorflow]<info>:116: Loading Pretrained Embeddings.... from pretrain/citeulike-a_e50.npz\r\n\r\n  0%|          | 0/6232 [00:00<?, ?it/s]\r\n[0] Loss: 10.9797 » » » » :   0%|          | 0/6232 [00:00<?, ?it/s]\r\n[0] Loss: 10.9797 » » » » :   0%|          | 1/6232 [00:00<54:19,  1.91it/s]\r\n[0] Loss: 10.9669 » » » » :   0%|          | 1/6232 [00:00<1:04:38,  1.61it/s]\r\n[0] Loss: 10.9458 » » » » :   0%|          | 1/6232 [00:00<1:24:32,  1.23it/s]\r\n[0] Loss: 10.9458 » » » » :   0%|          | 3/6232 [00:00<28:10,  3.68it/s]  Traceback (most recent call last):\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1322, in _do_call\r\n    return fn(*args)\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1307, in _run_fn\r\n    options, feed_dict, fetch_list, target_list, run_metadata)\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1409, in _call_tf_sessionrun\r\n    run_metadata)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: indices[126,0] = 12178 is not in [0, 5551)\r\n\t [[Node: MemoryOutput_2/embedding_lookup = GatherV2[Taxis=DT_INT32, Tindices=DT_INT32, Tparams=DT_FLOAT, _class=[\"loc:@Optimizer/ApplyGradients/update_MemoryOutput/embeddings/ApplyRMSProp\"], _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](MemoryOutput/embeddings/read, _arg_NeighborhoodNeg_0_5, Optimizer/gradients/MemoryOutput_1/embedding_lookup_grad/concat/axis)]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"train.py\", line 116, in <module>\r\n    batch_loss, _ = sess.run([model.loss, model.train], feed)\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 900, in run\r\n    run_metadata_ptr)\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1135, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1316, in _do_run\r\n    run_metadata)\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1335, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: indices[126,0] = 12178 is not in [0, 5551)\r\n\t [[Node: MemoryOutput_2/embedding_lookup = GatherV2[Taxis=DT_INT32, Tindices=DT_INT32, Tparams=DT_FLOAT, _class=[\"loc:@Optimizer/ApplyGradients/update_MemoryOutput/embeddings/ApplyRMSProp\"], _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](MemoryOutput/embeddings/read, _arg_NeighborhoodNeg_0_5, Optimizer/gradients/MemoryOutput_1/embedding_lookup_grad/concat/axis)]]\r\n\r\nCaused by op 'MemoryOutput_2/embedding_lookup', defined at:\r\n  File \"train.py\", line 80, in <module>\r\n    model = CollaborativeMemoryNetwork(config)\r\n  File \"/home/ubuntu/Scaricati/CollaborativeMemoryNetwork-master/util/cmn.py\", line 42, in __init__\r\n    self._construct()\r\n  File \"/home/ubuntu/Scaricati/CollaborativeMemoryNetwork-master/util/cmn.py\", line 69, in _construct\r\n    self.user_output(self.input_neighborhoods_negative),\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/sonnet/python/modules/base.py\", line 389, in __call__\r\n    outputs, subgraph_name_scope = self._template(*args, **kwargs)\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/ops/template.py\", line 455, in __call__\r\n    result = self._call_func(args, kwargs)\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/ops/template.py\", line 400, in _call_func\r\n    result = self._func(*args, **kwargs)\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/sonnet/python/modules/base.py\", line 246, in _build_wrapper\r\n    output = self._build(*args, **kwargs)\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/sonnet/python/modules/embed.py\", line 166, in _build\r\n    self._embeddings, ids, name=\"embedding_lookup\")\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/ops/embedding_ops.py\", line 308, in embedding_lookup\r\n    transform_fn=None)\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/ops/embedding_ops.py\", line 131, in _embedding_lookup_and_transform\r\n    result = _clip(array_ops.gather(params[0], ids, name=name),\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 2736, in gather\r\n    return gen_array_ops.gather_v2(params, indices, axis, name=name)\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 3065, in gather_v2\r\n    \"GatherV2\", params=params, indices=indices, axis=axis, name=name)\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3392, in create_op\r\n    op_def=op_def)\r\n  File \"/home/ubuntu/anaconda3/envs/DL_env/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1718, in __init__\r\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\r\n\r\nInvalidArgumentError (see above for traceback): indices[126,0] = 12178 is not in [0, 5551)\r\n\t [[Node: MemoryOutput_2/embedding_lookup = GatherV2[Taxis=DT_INT32, Tindices=DT_INT32, Tparams=DT_FLOAT, _class=[\"loc:@Optimizer/ApplyGradients/update_MemoryOutput/embeddings/ApplyRMSProp\"], _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](MemoryOutput/embeddings/read, _arg_NeighborhoodNeg_0_5, Optimizer/gradients/MemoryOutput_1/embedding_lookup_grad/concat/axis)]]\r\n","closed_by":{"login":"tebesu","id":2096875,"node_id":"MDQ6VXNlcjIwOTY4NzU=","avatar_url":"https://avatars.githubusercontent.com/u/2096875?v=4","gravatar_id":"","url":"https://api.github.com/users/tebesu","html_url":"https://github.com/tebesu","followers_url":"https://api.github.com/users/tebesu/followers","following_url":"https://api.github.com/users/tebesu/following{/other_user}","gists_url":"https://api.github.com/users/tebesu/gists{/gist_id}","starred_url":"https://api.github.com/users/tebesu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tebesu/subscriptions","organizations_url":"https://api.github.com/users/tebesu/orgs","repos_url":"https://api.github.com/users/tebesu/repos","events_url":"https://api.github.com/users/tebesu/events{/privacy}","received_events_url":"https://api.github.com/users/tebesu/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tebesu/CollaborativeMemoryNetwork/issues/2/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tebesu/CollaborativeMemoryNetwork/issues/2/timeline","performed_via_github_app":null,"state_reason":"completed"}