[{"url":"https://api.github.com/repos/dbiir/UER-py/issues/comments/944310223","html_url":"https://github.com/dbiir/UER-py/issues/212#issuecomment-944310223","issue_url":"https://api.github.com/repos/dbiir/UER-py/issues/212","id":944310223,"node_id":"IC_kwDOCsNQKM44SQfP","user":{"login":"ydli-ai","id":20391895,"node_id":"MDQ6VXNlcjIwMzkxODk1","avatar_url":"https://avatars.githubusercontent.com/u/20391895?v=4","gravatar_id":"","url":"https://api.github.com/users/ydli-ai","html_url":"https://github.com/ydli-ai","followers_url":"https://api.github.com/users/ydli-ai/followers","following_url":"https://api.github.com/users/ydli-ai/following{/other_user}","gists_url":"https://api.github.com/users/ydli-ai/gists{/gist_id}","starred_url":"https://api.github.com/users/ydli-ai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ydli-ai/subscriptions","organizations_url":"https://api.github.com/users/ydli-ai/orgs","repos_url":"https://api.github.com/users/ydli-ai/repos","events_url":"https://api.github.com/users/ydli-ai/events{/privacy}","received_events_url":"https://api.github.com/users/ydli-ai/received_events","type":"User","site_admin":false},"created_at":"2021-10-15T13:39:13Z","updated_at":"2021-10-15T13:39:13Z","author_association":"COLLABORATOR","body":"训练的速度可以根据tokens/s 判断，从以上日志上看，4卡的效率是单卡的三倍以上，是符合预期的。\r\n________________________________\r\n发件人: rainssun ***@***.***>\r\n发送时间: Friday, October 15, 2021 8:09:42 PM\r\n收件人: dbiir/UER-py ***@***.***>\r\n抄送: Subscribed ***@***.***>\r\n主题: [dbiir/UER-py] 单张显卡和多张显卡pretrain.py (#212)\r\n\r\n\r\n求助各位大佬，有个问题，根据pretrain.py所说，对于实际的batch size，是等于输入的batch sizeGPU个数accumulation_steps得到的结果。但是我测试了一张和四张GPU，在相同的实际batch size下速度不同。在输入相同资料的情况下，一张更快，四张更慢。在输入相同资料的情况下，1000个steps输出的结果如下：\r\n\r\n1 GPU ：14分钟 ；平均：4700 tokens/s ；【batch size=16,accumulation_steps=500,world_size=1】\r\n4 GPU ：17分钟 ; 平均：15700 tokens/s ; 【batch size=16,accumulation_steps=125,world_size=4】\r\n在我控制参数使得一张和四张GPU的实际batch size相同时。\r\n以tokens数目来说是多张显卡效果更好，但是如果以step所花的时间来看，单张更好，为什么？\r\n\r\n―\r\nYou are receiving this because you are subscribed to this thread.\r\nReply to this email directly, view it on GitHub<https://github.com/dbiir/UER-py/issues/212>, or unsubscribe<https://github.com/notifications/unsubscribe-auth/AE3SPV7CM6SEH52UXJSAAILUHAKYNANCNFSM5GB2SGTQ>.\r\nTriage notifications on the go with GitHub Mobile for iOS<https://apps.apple.com/app/apple-store/id1477376905?ct=notification-email&mt=8&pt=524675> or Android<https://play.google.com/store/apps/details?id=com.github.android&referrer=utm_campaign%3Dnotification-email%26utm_medium%3Demail%26utm_source%3Dgithub>.\r\n","reactions":{"url":"https://api.github.com/repos/dbiir/UER-py/issues/comments/944310223/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ydli-ai","id":20391895,"node_id":"MDQ6VXNlcjIwMzkxODk1","avatar_url":"https://avatars.githubusercontent.com/u/20391895?v=4","gravatar_id":"","url":"https://api.github.com/users/ydli-ai","html_url":"https://github.com/ydli-ai","followers_url":"https://api.github.com/users/ydli-ai/followers","following_url":"https://api.github.com/users/ydli-ai/following{/other_user}","gists_url":"https://api.github.com/users/ydli-ai/gists{/gist_id}","starred_url":"https://api.github.com/users/ydli-ai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ydli-ai/subscriptions","organizations_url":"https://api.github.com/users/ydli-ai/orgs","repos_url":"https://api.github.com/users/ydli-ai/repos","events_url":"https://api.github.com/users/ydli-ai/events{/privacy}","received_events_url":"https://api.github.com/users/ydli-ai/received_events","type":"User","site_admin":false}},{"id":5813434259,"node_id":"CE_lADOCsNQKM49PIzVzwAAAAFagfeT","url":"https://api.github.com/repos/dbiir/UER-py/issues/events/5813434259","actor":{"login":"rainssun","id":92580738,"node_id":"U_kgDOBYSrgg","avatar_url":"https://avatars.githubusercontent.com/u/92580738?v=4","gravatar_id":"","url":"https://api.github.com/users/rainssun","html_url":"https://github.com/rainssun","followers_url":"https://api.github.com/users/rainssun/followers","following_url":"https://api.github.com/users/rainssun/following{/other_user}","gists_url":"https://api.github.com/users/rainssun/gists{/gist_id}","starred_url":"https://api.github.com/users/rainssun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rainssun/subscriptions","organizations_url":"https://api.github.com/users/rainssun/orgs","repos_url":"https://api.github.com/users/rainssun/repos","events_url":"https://api.github.com/users/rainssun/events{/privacy}","received_events_url":"https://api.github.com/users/rainssun/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-12-24T11:18:11Z","state_reason":null,"performed_via_github_app":null}]