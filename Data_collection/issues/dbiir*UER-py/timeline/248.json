[{"url":"https://api.github.com/repos/dbiir/UER-py/issues/comments/1006353601","html_url":"https://github.com/dbiir/UER-py/issues/248#issuecomment-1006353601","issue_url":"https://api.github.com/repos/dbiir/UER-py/issues/248","id":1006353601,"node_id":"IC_kwDOCsNQKM47-7zB","user":{"login":"LeoWood","id":17940401,"node_id":"MDQ6VXNlcjE3OTQwNDAx","avatar_url":"https://avatars.githubusercontent.com/u/17940401?v=4","gravatar_id":"","url":"https://api.github.com/users/LeoWood","html_url":"https://github.com/LeoWood","followers_url":"https://api.github.com/users/LeoWood/followers","following_url":"https://api.github.com/users/LeoWood/following{/other_user}","gists_url":"https://api.github.com/users/LeoWood/gists{/gist_id}","starred_url":"https://api.github.com/users/LeoWood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LeoWood/subscriptions","organizations_url":"https://api.github.com/users/LeoWood/orgs","repos_url":"https://api.github.com/users/LeoWood/repos","events_url":"https://api.github.com/users/LeoWood/events{/privacy}","received_events_url":"https://api.github.com/users/LeoWood/received_events","type":"User","site_admin":false},"created_at":"2022-01-06T07:53:25Z","updated_at":"2022-01-06T07:53:25Z","author_association":"NONE","body":"版本退回之后没问题了，大概退回到十月份的版本。google相关的问题之后，感觉可能与代码中新加的logger有一定关系，望关注！","reactions":{"url":"https://api.github.com/repos/dbiir/UER-py/issues/comments/1006353601/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"LeoWood","id":17940401,"node_id":"MDQ6VXNlcjE3OTQwNDAx","avatar_url":"https://avatars.githubusercontent.com/u/17940401?v=4","gravatar_id":"","url":"https://api.github.com/users/LeoWood","html_url":"https://github.com/LeoWood","followers_url":"https://api.github.com/users/LeoWood/followers","following_url":"https://api.github.com/users/LeoWood/following{/other_user}","gists_url":"https://api.github.com/users/LeoWood/gists{/gist_id}","starred_url":"https://api.github.com/users/LeoWood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LeoWood/subscriptions","organizations_url":"https://api.github.com/users/LeoWood/orgs","repos_url":"https://api.github.com/users/LeoWood/repos","events_url":"https://api.github.com/users/LeoWood/events{/privacy}","received_events_url":"https://api.github.com/users/LeoWood/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dbiir/UER-py/issues/comments/1006420737","html_url":"https://github.com/dbiir/UER-py/issues/248#issuecomment-1006420737","issue_url":"https://api.github.com/repos/dbiir/UER-py/issues/248","id":1006420737,"node_id":"IC_kwDOCsNQKM47_MMB","user":{"login":"ydli-ai","id":20391895,"node_id":"MDQ6VXNlcjIwMzkxODk1","avatar_url":"https://avatars.githubusercontent.com/u/20391895?v=4","gravatar_id":"","url":"https://api.github.com/users/ydli-ai","html_url":"https://github.com/ydli-ai","followers_url":"https://api.github.com/users/ydli-ai/followers","following_url":"https://api.github.com/users/ydli-ai/following{/other_user}","gists_url":"https://api.github.com/users/ydli-ai/gists{/gist_id}","starred_url":"https://api.github.com/users/ydli-ai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ydli-ai/subscriptions","organizations_url":"https://api.github.com/users/ydli-ai/orgs","repos_url":"https://api.github.com/users/ydli-ai/repos","events_url":"https://api.github.com/users/ydli-ai/events{/privacy}","received_events_url":"https://api.github.com/users/ydli-ai/received_events","type":"User","site_admin":false},"created_at":"2022-01-06T09:46:45Z","updated_at":"2022-01-06T09:46:45Z","author_association":"COLLABORATOR","body":"好的，感谢！\r\n________________________________\r\n发件人: LeoWood ***@***.***>\r\n发送时间: Thursday, January 6, 2022 3:53:37 PM\r\n收件人: dbiir/UER-py ***@***.***>\r\n抄送: Subscribed ***@***.***>\r\n主题: Re: [dbiir/UER-py] 多卡运行报错 TypeError: can't pickle _thread.RLock objects (Issue #248)\r\n\r\n\r\n版本退回之后没问题了，大概退回到十月份的版本。google相关的问题之后，感觉可能与代码中新加的logger有一定关系，望关注！\r\n\r\n―\r\nReply to this email directly, view it on GitHub<https://github.com/dbiir/UER-py/issues/248#issuecomment-1006353601>, or unsubscribe<https://github.com/notifications/unsubscribe-auth/AE3SPVYXOCA2EYWDTFIE7Z3UUVDADANCNFSM5LLL6DMQ>.\r\nTriage notifications on the go with GitHub Mobile for iOS<https://apps.apple.com/app/apple-store/id1477376905?ct=notification-email&mt=8&pt=524675> or Android<https://play.google.com/store/apps/details?id=com.github.android&referrer=utm_campaign%3Dnotification-email%26utm_medium%3Demail%26utm_source%3Dgithub>.\r\nYou are receiving this because you are subscribed to this thread.Message ID: ***@***.***>\r\n","reactions":{"url":"https://api.github.com/repos/dbiir/UER-py/issues/comments/1006420737/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ydli-ai","id":20391895,"node_id":"MDQ6VXNlcjIwMzkxODk1","avatar_url":"https://avatars.githubusercontent.com/u/20391895?v=4","gravatar_id":"","url":"https://api.github.com/users/ydli-ai","html_url":"https://github.com/ydli-ai","followers_url":"https://api.github.com/users/ydli-ai/followers","following_url":"https://api.github.com/users/ydli-ai/following{/other_user}","gists_url":"https://api.github.com/users/ydli-ai/gists{/gist_id}","starred_url":"https://api.github.com/users/ydli-ai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ydli-ai/subscriptions","organizations_url":"https://api.github.com/users/ydli-ai/orgs","repos_url":"https://api.github.com/users/ydli-ai/repos","events_url":"https://api.github.com/users/ydli-ai/events{/privacy}","received_events_url":"https://api.github.com/users/ydli-ai/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dbiir/UER-py/issues/comments/1023962828","html_url":"https://github.com/dbiir/UER-py/issues/248#issuecomment-1023962828","issue_url":"https://api.github.com/repos/dbiir/UER-py/issues/248","id":1023962828,"node_id":"IC_kwDOCsNQKM49CG7M","user":{"login":"hfutweile","id":26094044,"node_id":"MDQ6VXNlcjI2MDk0MDQ0","avatar_url":"https://avatars.githubusercontent.com/u/26094044?v=4","gravatar_id":"","url":"https://api.github.com/users/hfutweile","html_url":"https://github.com/hfutweile","followers_url":"https://api.github.com/users/hfutweile/followers","following_url":"https://api.github.com/users/hfutweile/following{/other_user}","gists_url":"https://api.github.com/users/hfutweile/gists{/gist_id}","starred_url":"https://api.github.com/users/hfutweile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hfutweile/subscriptions","organizations_url":"https://api.github.com/users/hfutweile/orgs","repos_url":"https://api.github.com/users/hfutweile/repos","events_url":"https://api.github.com/users/hfutweile/events{/privacy}","received_events_url":"https://api.github.com/users/hfutweile/received_events","type":"User","site_admin":false},"created_at":"2022-01-28T07:42:39Z","updated_at":"2022-01-28T07:42:39Z","author_association":"NONE","body":"版本回退到9月份的版本，多卡训练依然报错，单卡训练没问题，辛苦帮忙看一下原因\r\n报错信息：\r\nTraceback (most recent call last):\r\n  File \"pretrain.py\", line 133, in <module>\r\n    main()\r\n  File \"pretrain.py\", line 129, in main\r\n    trainer.train_and_validate(args)\r\n  File \"/home/ssd5/liuweile/UER-py/uer/trainer.py\", line 54, in train_and_validate\r\n    mp.spawn(worker, nprocs=args.ranks_num, args=(args.gpu_ranks, args, model), daemon=False)\r\n  File \"/home/liuweile/.local/lib/python3.6/site-packages/torch/multiprocessing/spawn.py\", line 230, in spawn\r\n    return start_processes(fn, args, nprocs, join, daemon, start_method='spawn')\r\n  File \"/home/liuweile/.local/lib/python3.6/site-packages/torch/multiprocessing/spawn.py\", line 179, in start_processes\r\n    process.start()\r\n  File \"/home/ssd5/liuweile/Python-3.6.5/lib/python3.6/multiprocessing/process.py\", line 105, in start\r\n    self._popen = self._Popen(self)\r\n  File \"/home/ssd5/liuweile/Python-3.6.5/lib/python3.6/multiprocessing/context.py\", line 284, in _Popen\r\n    return Popen(process_obj)\r\n  File \"/home/ssd5/liuweile/Python-3.6.5/lib/python3.6/multiprocessing/popen_spawn_posix.py\", line 32, in __init__\r\n    super().__init__(process_obj)\r\n  File \"/home/ssd5/liuweile/Python-3.6.5/lib/python3.6/multiprocessing/popen_fork.py\", line 19, in __init__\r\n    self._launch(process_obj)\r\n  File \"/home/ssd5/liuweile/Python-3.6.5/lib/python3.6/multiprocessing/popen_spawn_posix.py\", line 47, in _launch\r\n    reduction.dump(process_obj, fp)\r\n  File \"/home/ssd5/liuweile/Python-3.6.5/lib/python3.6/multiprocessing/reduction.py\", line 60, in dump\r\n    ForkingPickler(file, protocol).dump(obj)\r\nTypeError: can't pickle _thread.RLock objects\r\n\r\n训练命令：\r\npython3 pretrain.py --dataset_path dataset.pt --vocab_path models/google_zh_vocab.txt \\\r\n                    --pretrained_model_path models/google_zh_model.bin \\\r\n                    --output_model_path models/book_review_model.bin \\\r\n                    --world_size 5 --gpu_ranks 2 4 5 6 7 \\\r\n                    --total_steps 5000 --save_checkpoint_steps 1000 --batch_size 32 \\\r\n                    --embedding word_pos_seg --encoder transformer --mask fully_visible --target bert","reactions":{"url":"https://api.github.com/repos/dbiir/UER-py/issues/comments/1023962828/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"hfutweile","id":26094044,"node_id":"MDQ6VXNlcjI2MDk0MDQ0","avatar_url":"https://avatars.githubusercontent.com/u/26094044?v=4","gravatar_id":"","url":"https://api.github.com/users/hfutweile","html_url":"https://github.com/hfutweile","followers_url":"https://api.github.com/users/hfutweile/followers","following_url":"https://api.github.com/users/hfutweile/following{/other_user}","gists_url":"https://api.github.com/users/hfutweile/gists{/gist_id}","starred_url":"https://api.github.com/users/hfutweile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hfutweile/subscriptions","organizations_url":"https://api.github.com/users/hfutweile/orgs","repos_url":"https://api.github.com/users/hfutweile/repos","events_url":"https://api.github.com/users/hfutweile/events{/privacy}","received_events_url":"https://api.github.com/users/hfutweile/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dbiir/UER-py/issues/comments/1030642907","html_url":"https://github.com/dbiir/UER-py/issues/248#issuecomment-1030642907","issue_url":"https://api.github.com/repos/dbiir/UER-py/issues/248","id":1030642907,"node_id":"IC_kwDOCsNQKM49blzb","user":{"login":"cdd1993","id":28085921,"node_id":"MDQ6VXNlcjI4MDg1OTIx","avatar_url":"https://avatars.githubusercontent.com/u/28085921?v=4","gravatar_id":"","url":"https://api.github.com/users/cdd1993","html_url":"https://github.com/cdd1993","followers_url":"https://api.github.com/users/cdd1993/followers","following_url":"https://api.github.com/users/cdd1993/following{/other_user}","gists_url":"https://api.github.com/users/cdd1993/gists{/gist_id}","starred_url":"https://api.github.com/users/cdd1993/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdd1993/subscriptions","organizations_url":"https://api.github.com/users/cdd1993/orgs","repos_url":"https://api.github.com/users/cdd1993/repos","events_url":"https://api.github.com/users/cdd1993/events{/privacy}","received_events_url":"https://api.github.com/users/cdd1993/received_events","type":"User","site_admin":false},"created_at":"2022-02-05T15:16:25Z","updated_at":"2022-02-05T15:16:25Z","author_association":"NONE","body":"> 版本回退到9月份的版本，多卡训练依然报错，单卡训练没问题，辛苦帮忙看一下原因 报错信息： Traceback (most recent call last): File \"pretrain.py\", line 133, in main() File \"pretrain.py\", line 129, in main trainer.train_and_validate(args) File \"/home/ssd5/liuweile/UER-py/uer/trainer.py\", line 54, in train_and_validate mp.spawn(worker, nprocs=args.ranks_num, args=(args.gpu_ranks, args, model), daemon=False) File \"/home/liuweile/.local/lib/python3.6/site-packages/torch/multiprocessing/spawn.py\", line 230, in spawn return start_processes(fn, args, nprocs, join, daemon, start_method='spawn') File \"/home/liuweile/.local/lib/python3.6/site-packages/torch/multiprocessing/spawn.py\", line 179, in start_processes process.start() File \"/home/ssd5/liuweile/Python-3.6.5/lib/python3.6/multiprocessing/process.py\", line 105, in start self._popen = self._Popen(self) File \"/home/ssd5/liuweile/Python-3.6.5/lib/python3.6/multiprocessing/context.py\", line 284, in _Popen return Popen(process_obj) File \"/home/ssd5/liuweile/Python-3.6.5/lib/python3.6/multiprocessing/popen_spawn_posix.py\", line 32, in **init** super().**init**(process_obj) File \"/home/ssd5/liuweile/Python-3.6.5/lib/python3.6/multiprocessing/popen_fork.py\", line 19, in **init** self._launch(process_obj) File \"/home/ssd5/liuweile/Python-3.6.5/lib/python3.6/multiprocessing/popen_spawn_posix.py\", line 47, in _launch reduction.dump(process_obj, fp) File \"/home/ssd5/liuweile/Python-3.6.5/lib/python3.6/multiprocessing/reduction.py\", line 60, in dump ForkingPickler(file, protocol).dump(obj) TypeError: can't pickle _thread.RLock objects\r\n> \r\n> 训练命令： python3 pretrain.py --dataset_path dataset.pt --vocab_path models/google_zh_vocab.txt --pretrained_model_path models/google_zh_model.bin --output_model_path models/book_review_model.bin --world_size 5 --gpu_ranks 2 4 5 6 7 --total_steps 5000 --save_checkpoint_steps 1000 --batch_size 32 --embedding word_pos_seg --encoder transformer --mask fully_visible --target bert\r\n\r\n升级python版本应该能解决","reactions":{"url":"https://api.github.com/repos/dbiir/UER-py/issues/comments/1030642907/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cdd1993","id":28085921,"node_id":"MDQ6VXNlcjI4MDg1OTIx","avatar_url":"https://avatars.githubusercontent.com/u/28085921?v=4","gravatar_id":"","url":"https://api.github.com/users/cdd1993","html_url":"https://github.com/cdd1993","followers_url":"https://api.github.com/users/cdd1993/followers","following_url":"https://api.github.com/users/cdd1993/following{/other_user}","gists_url":"https://api.github.com/users/cdd1993/gists{/gist_id}","starred_url":"https://api.github.com/users/cdd1993/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdd1993/subscriptions","organizations_url":"https://api.github.com/users/cdd1993/orgs","repos_url":"https://api.github.com/users/cdd1993/repos","events_url":"https://api.github.com/users/cdd1993/events{/privacy}","received_events_url":"https://api.github.com/users/cdd1993/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dbiir/UER-py/issues/comments/1032549126","html_url":"https://github.com/dbiir/UER-py/issues/248#issuecomment-1032549126","issue_url":"https://api.github.com/repos/dbiir/UER-py/issues/248","id":1032549126,"node_id":"IC_kwDOCsNQKM49i3MG","user":{"login":"hfutweile","id":26094044,"node_id":"MDQ6VXNlcjI2MDk0MDQ0","avatar_url":"https://avatars.githubusercontent.com/u/26094044?v=4","gravatar_id":"","url":"https://api.github.com/users/hfutweile","html_url":"https://github.com/hfutweile","followers_url":"https://api.github.com/users/hfutweile/followers","following_url":"https://api.github.com/users/hfutweile/following{/other_user}","gists_url":"https://api.github.com/users/hfutweile/gists{/gist_id}","starred_url":"https://api.github.com/users/hfutweile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hfutweile/subscriptions","organizations_url":"https://api.github.com/users/hfutweile/orgs","repos_url":"https://api.github.com/users/hfutweile/repos","events_url":"https://api.github.com/users/hfutweile/events{/privacy}","received_events_url":"https://api.github.com/users/hfutweile/received_events","type":"User","site_admin":false},"created_at":"2022-02-08T12:20:55Z","updated_at":"2022-02-08T12:20:55Z","author_association":"NONE","body":"感谢，我试一下","reactions":{"url":"https://api.github.com/repos/dbiir/UER-py/issues/comments/1032549126/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"hfutweile","id":26094044,"node_id":"MDQ6VXNlcjI2MDk0MDQ0","avatar_url":"https://avatars.githubusercontent.com/u/26094044?v=4","gravatar_id":"","url":"https://api.github.com/users/hfutweile","html_url":"https://github.com/hfutweile","followers_url":"https://api.github.com/users/hfutweile/followers","following_url":"https://api.github.com/users/hfutweile/following{/other_user}","gists_url":"https://api.github.com/users/hfutweile/gists{/gist_id}","starred_url":"https://api.github.com/users/hfutweile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hfutweile/subscriptions","organizations_url":"https://api.github.com/users/hfutweile/orgs","repos_url":"https://api.github.com/users/hfutweile/repos","events_url":"https://api.github.com/users/hfutweile/events{/privacy}","received_events_url":"https://api.github.com/users/hfutweile/received_events","type":"User","site_admin":false}}]