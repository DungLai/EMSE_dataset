{"url":"https://api.github.com/repos/dbiir/UER-py/issues/212","repository_url":"https://api.github.com/repos/dbiir/UER-py","labels_url":"https://api.github.com/repos/dbiir/UER-py/issues/212/labels{/name}","comments_url":"https://api.github.com/repos/dbiir/UER-py/issues/212/comments","events_url":"https://api.github.com/repos/dbiir/UER-py/issues/212/events","html_url":"https://github.com/dbiir/UER-py/issues/212","id":1027378389,"node_id":"I_kwDOCsNQKM49PIzV","number":212,"title":"单张显卡和多张显卡pretrain.py","user":{"login":"rainssun","id":92580738,"node_id":"U_kgDOBYSrgg","avatar_url":"https://avatars.githubusercontent.com/u/92580738?v=4","gravatar_id":"","url":"https://api.github.com/users/rainssun","html_url":"https://github.com/rainssun","followers_url":"https://api.github.com/users/rainssun/followers","following_url":"https://api.github.com/users/rainssun/following{/other_user}","gists_url":"https://api.github.com/users/rainssun/gists{/gist_id}","starred_url":"https://api.github.com/users/rainssun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rainssun/subscriptions","organizations_url":"https://api.github.com/users/rainssun/orgs","repos_url":"https://api.github.com/users/rainssun/repos","events_url":"https://api.github.com/users/rainssun/events{/privacy}","received_events_url":"https://api.github.com/users/rainssun/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-10-15T12:09:27Z","updated_at":"2021-12-24T11:18:11Z","closed_at":"2021-12-24T11:18:11Z","author_association":"NONE","active_lock_reason":null,"body":"求助各位大佬，有个问题，根据pretrain.py所说，对于实际的batch size，是等于输入的batch size*GPU个数*accumulation_steps得到的结果。但是我测试了一张和四张GPU，在相同的实际batch size下速度不同。在输入相同资料的情况下，一张更快，四张更慢。在输入相同资料的情况下，1000个steps输出的结果如下：\r\n\r\n1 GPU ：14分钟 ；平均：4700 tokens/s ；【batch size=16,accumulation_steps=500,world_size=1】\r\n4 GPU ：17分钟  ;  平均：15700 tokens/s ; 【batch size=16,accumulation_steps=125,world_size=4】\r\n在我控制参数使得一张和四张GPU的实际batch size相同时。\r\n以tokens数目来说是多张显卡效果更好，但是如果以step所花的时间来看，单张更好，为什么？\r\n","closed_by":{"login":"rainssun","id":92580738,"node_id":"U_kgDOBYSrgg","avatar_url":"https://avatars.githubusercontent.com/u/92580738?v=4","gravatar_id":"","url":"https://api.github.com/users/rainssun","html_url":"https://github.com/rainssun","followers_url":"https://api.github.com/users/rainssun/followers","following_url":"https://api.github.com/users/rainssun/following{/other_user}","gists_url":"https://api.github.com/users/rainssun/gists{/gist_id}","starred_url":"https://api.github.com/users/rainssun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rainssun/subscriptions","organizations_url":"https://api.github.com/users/rainssun/orgs","repos_url":"https://api.github.com/users/rainssun/repos","events_url":"https://api.github.com/users/rainssun/events{/privacy}","received_events_url":"https://api.github.com/users/rainssun/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dbiir/UER-py/issues/212/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dbiir/UER-py/issues/212/timeline","performed_via_github_app":null,"state_reason":"completed"}