{"url":"https://api.github.com/repos/theislab/diffxpy/issues/155","repository_url":"https://api.github.com/repos/theislab/diffxpy","labels_url":"https://api.github.com/repos/theislab/diffxpy/issues/155/labels{/name}","comments_url":"https://api.github.com/repos/theislab/diffxpy/issues/155/comments","events_url":"https://api.github.com/repos/theislab/diffxpy/issues/155/events","html_url":"https://github.com/theislab/diffxpy/issues/155","id":606709453,"node_id":"MDU6SXNzdWU2MDY3MDk0NTM=","number":155,"title":"BUG: `struct.error` when `de.test.wald(...)`","user":{"login":"HypoChloremic","id":26204559,"node_id":"MDQ6VXNlcjI2MjA0NTU5","avatar_url":"https://avatars.githubusercontent.com/u/26204559?v=4","gravatar_id":"","url":"https://api.github.com/users/HypoChloremic","html_url":"https://github.com/HypoChloremic","followers_url":"https://api.github.com/users/HypoChloremic/followers","following_url":"https://api.github.com/users/HypoChloremic/following{/other_user}","gists_url":"https://api.github.com/users/HypoChloremic/gists{/gist_id}","starred_url":"https://api.github.com/users/HypoChloremic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HypoChloremic/subscriptions","organizations_url":"https://api.github.com/users/HypoChloremic/orgs","repos_url":"https://api.github.com/users/HypoChloremic/repos","events_url":"https://api.github.com/users/HypoChloremic/events{/privacy}","received_events_url":"https://api.github.com/users/HypoChloremic/received_events","type":"User","site_admin":false},"labels":[{"id":981698115,"node_id":"MDU6TGFiZWw5ODE2OTgxMTU=","url":"https://api.github.com/repos/theislab/diffxpy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"open","locked":false,"assignee":{"login":"davidsebfischer","id":11200205,"node_id":"MDQ6VXNlcjExMjAwMjA1","avatar_url":"https://avatars.githubusercontent.com/u/11200205?v=4","gravatar_id":"","url":"https://api.github.com/users/davidsebfischer","html_url":"https://github.com/davidsebfischer","followers_url":"https://api.github.com/users/davidsebfischer/followers","following_url":"https://api.github.com/users/davidsebfischer/following{/other_user}","gists_url":"https://api.github.com/users/davidsebfischer/gists{/gist_id}","starred_url":"https://api.github.com/users/davidsebfischer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidsebfischer/subscriptions","organizations_url":"https://api.github.com/users/davidsebfischer/orgs","repos_url":"https://api.github.com/users/davidsebfischer/repos","events_url":"https://api.github.com/users/davidsebfischer/events{/privacy}","received_events_url":"https://api.github.com/users/davidsebfischer/received_events","type":"User","site_admin":false},"assignees":[{"login":"davidsebfischer","id":11200205,"node_id":"MDQ6VXNlcjExMjAwMjA1","avatar_url":"https://avatars.githubusercontent.com/u/11200205?v=4","gravatar_id":"","url":"https://api.github.com/users/davidsebfischer","html_url":"https://github.com/davidsebfischer","followers_url":"https://api.github.com/users/davidsebfischer/followers","following_url":"https://api.github.com/users/davidsebfischer/following{/other_user}","gists_url":"https://api.github.com/users/davidsebfischer/gists{/gist_id}","starred_url":"https://api.github.com/users/davidsebfischer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidsebfischer/subscriptions","organizations_url":"https://api.github.com/users/davidsebfischer/orgs","repos_url":"https://api.github.com/users/davidsebfischer/repos","events_url":"https://api.github.com/users/davidsebfischer/events{/privacy}","received_events_url":"https://api.github.com/users/davidsebfischer/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2020-04-25T07:17:53Z","updated_at":"2021-06-15T10:27:17Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"I was using `diffxpy` to find marker-genes for a cluster vs all other clusters in a scRNA-dataset stored in `adata`.\r\nWhen performing the following:\r\n\r\n```python\r\n# Performing differential expression to find the markers for\r\n# cluter 20, which was defined as a CD33+ myeloid by HGA (Human Gene Atlas). \r\nadata.obs['twty_All'] = [\r\n\t'group 1' if int(i) == 20 else 'group 2' for i in adata.obs['leiden']\r\n\t]\r\n\r\ncl20_test = de.test.wald(\r\n    data=adata,\r\n    formula_loc=\"~ 1 + twty_All\",\r\n    factor_loc_totest=\"twty_All\"\r\n)\r\n```\r\n\r\nThe following error is produced, which I do not know how to resolve: \r\n```python\r\ntraining location model: False\r\ntraining scale model: True\r\niter   0: ll=23072758620.633224\r\niter   1: ll=23072758620.633224, converged: 0.00% (loc: 100.00%, scale update: False), in 0.00sec\r\nFitting 26542 dispersion models: (progress not available with multiprocessing)\r\n\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 4, in <module>\r\n  File \"[USERNAME]/anaconda3/envs/scMachineLearning1/lib/python3.7/site-packages/diffxpy/testing/tests.py\", line 736, in wald\r\n    **kwargs,\r\n  File \"[USERNAME]/anaconda3/envs/scMachineLearning1/lib/python3.7/site-packages/diffxpy/testing/tests.py\", line 244, in _fit\r\n    **train_args\r\n  File \"[USERNAME]/anaconda3/envs/scMachineLearning1/lib/python3.7/site-packages/batchglm/models/base/estimator.py\", line 124, in train_sequence\r\n    self.train(**d, **kwargs)\r\n  File \"[USERNAME]/anaconda3/envs/scMachineLearning1/lib/python3.7/site-packages/batchglm/train/numpy/base_glm/estimator.py\", line 112, in train\r\n    nproc=nproc\r\n  File \"[USERNAME]/anaconda3/envs/scMachineLearning1/lib/python3.7/site-packages/batchglm/train/numpy/base_glm/estimator.py\", line 351, in b_step\r\n    nproc=nproc\r\n  File \"[USERNAME]/anaconda3/envs/scMachineLearning1/lib/python3.7/site-packages/batchglm/train/numpy/base_glm/estimator.py\", line 478, in _b_step_loop\r\n    ) for j in idx_update]\r\n  File \"[USERNAME]/anaconda3/envs/scMachineLearning1/lib/python3.7/multiprocessing/pool.py\", line 276, in starmap\r\n    return self._map_async(func, iterable, starmapstar, chunksize).get()\r\n  File \"[USERNAME]/anaconda3/envs/scMachineLearning1/lib/python3.7/multiprocessing/pool.py\", line 657, in get\r\n    raise self._value\r\n  File \"[USERNAME]/anaconda3/envs/scMachineLearning1/lib/python3.7/multiprocessing/pool.py\", line 431, in _handle_tasks\r\n    put(task)\r\n  File \"[USERNAME]/anaconda3/envs/scMachineLearning1/lib/python3.7/multiprocessing/connection.py\", line 206, in send\r\n    self._send_bytes(_ForkingPickler.dumps(obj))\r\n  File \"[USERNAME]/anaconda3/envs/scMachineLearning1/lib/python3.7/multiprocessing/connection.py\", line 393, in _send_bytes\r\n    header = struct.pack(\"!i\", n)\r\nstruct.error: 'i' format requires -2147483648 <= number <= 2147483647\r\n```\r\nI have noted that there are similar issues involving `multiprocessing` but I haven't had the time to check them out in detail. \r\n\r\n\r\n(`de.__version__ = 'v0.7.4'` , `sc.__version__ = '1.4.6`)","closed_by":null,"reactions":{"url":"https://api.github.com/repos/theislab/diffxpy/issues/155/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/theislab/diffxpy/issues/155/timeline","performed_via_github_app":null,"state_reason":null}