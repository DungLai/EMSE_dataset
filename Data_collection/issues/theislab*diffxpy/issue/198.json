{"url":"https://api.github.com/repos/theislab/diffxpy/issues/198","repository_url":"https://api.github.com/repos/theislab/diffxpy","labels_url":"https://api.github.com/repos/theislab/diffxpy/issues/198/labels{/name}","comments_url":"https://api.github.com/repos/theislab/diffxpy/issues/198/comments","events_url":"https://api.github.com/repos/theislab/diffxpy/issues/198/events","html_url":"https://github.com/theislab/diffxpy/issues/198","id":867389229,"node_id":"MDU6SXNzdWU4NjczODkyMjk=","number":198,"title":"Question regarding log2fc returned by differential expression Wald testing","user":{"login":"YousufYassouf","id":80340257,"node_id":"MDQ6VXNlcjgwMzQwMjU3","avatar_url":"https://avatars.githubusercontent.com/u/80340257?v=4","gravatar_id":"","url":"https://api.github.com/users/YousufYassouf","html_url":"https://github.com/YousufYassouf","followers_url":"https://api.github.com/users/YousufYassouf/followers","following_url":"https://api.github.com/users/YousufYassouf/following{/other_user}","gists_url":"https://api.github.com/users/YousufYassouf/gists{/gist_id}","starred_url":"https://api.github.com/users/YousufYassouf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YousufYassouf/subscriptions","organizations_url":"https://api.github.com/users/YousufYassouf/orgs","repos_url":"https://api.github.com/users/YousufYassouf/repos","events_url":"https://api.github.com/users/YousufYassouf/events{/privacy}","received_events_url":"https://api.github.com/users/YousufYassouf/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-04-26T07:56:03Z","updated_at":"2021-04-27T16:09:26Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Hi,\r\nI was trying to find DEGs and their fold change between two conditions (Conditions =['1Con', '2Con']) and to regress out two covariates (SampleType =['Frozen', 'Fresh'], n_genes).\r\n\r\nI have two questions:\r\n1. How to interpret the resulting log2fc, is it 1Con/2Con or the 2Con/1Con?\r\n2. 'caught 141 linalg singular matrix errors' appeared in the output, but I still got the summary table, is it correct or should I do something about it?\r\n\r\nAny help would be appreciated!\r\n\r\nI used this script to perform the analysis:\r\n\r\n```\r\ntest = de.test.wald(data=fadata,\r\nformula_loc=\"~1+Conditions+SampleType+SampleType:Conditions+n_genes+n_genes:Conditions\",\r\n                    factor_loc_totest=\"Conditions\", as_numeric=['n_genes'],\r\n                    sample_description=fadata.obs, noise_model=\"nb\", training_strategy=\"DEFAULT\", dtype=\"float64\")\r\ntest.summary().to_csv(sc.settings.figdir /'de.test.wald.summary.tsv', sep=\"\\t\", index=False)\r\n```\r\nI got this output:\r\n```\r\nDiffxpy de.test.wald testing\r\ntraining location model: True\r\ntraining scale model: True\r\niter   0: ll=8489257375.931549\r\niter   1: ll=8486685806.088095, converged: 0.00% (loc: 4.67%, scale update: False), in 26.07sec\r\ncaught 141 linalg singular matrix errors\r\niter   2: ll=8486679830.490733, converged: 0.00% (loc: 98.58%, scale update: False), in 24.84sec\r\niter   3: ll=8486678948.803598, converged: 0.00% (loc: 98.58%, scale update: False), in 4.52sec\r\niter   4: ll=8486678815.294401, converged: 0.00% (loc: 98.65%, scale update: False), in 4.52sec\r\niter   5: ll=8486678785.821270, converged: 0.00% (loc: 98.88%, scale update: False), in 4.45sec\r\n\r\nFitting 24506 dispersion models: (progress not available with multiprocessing)\r\niter   6: ll=70569325.724172, converged: 3.62% (loc: 3.62%, scale update: True), in 1788.10sec\r\ncaught 123 linalg singular matrix errors\r\niter   7: ll=70296497.765427, converged: 3.62% (loc: 35.44%, scale update: False), in 23.67sec\r\niter   8: ll=70260749.227150, converged: 3.62% (loc: 40.07%, scale update: False), in 18.26sec\r\niter   9: ll=70251928.577203, converged: 3.62% (loc: 58.57%, scale update: False), in 17.01sec\r\niter  10: ll=70249711.995841, converged: 3.62% (loc: 81.31%, scale update: False), in 12.83sec\r\niter  11: ll=70249379.829412, converged: 3.62% (loc: 89.92%, scale update: False), in 7.47sec\r\n\r\nFitting 23619 dispersion models: (progress not available with multiprocessing)\r\niter  12: ll=54446548.515894, converged: 20.45% (loc: 20.45%, scale update: True), in 1559.48sec\r\ncaught 46 linalg singular matrix errors\r\niter  13: ll=54435626.591855, converged: 20.45% (loc: 87.07%, scale update: False), in 20.72sec\r\niter  14: ll=54434658.754988, converged: 20.45% (loc: 94.59%, scale update: False), in 6.43sec\r\niter  15: ll=54434444.213969, converged: 20.45% (loc: 96.54%, scale update: False), in 5.81sec\r\niter  16: ll=54434378.910931, converged: 20.45% (loc: 97.34%, scale update: False), in 5.26sec\r\niter  17: ll=54434362.876335, converged: 20.45% (loc: 97.69%, scale update: False), in 5.24sec\r\n\r\nFitting 19494 dispersion models: (progress not available with multiprocessing)\r\niter  18: ll=48554309.314322, converged: 67.49% (loc: 67.49%, scale update: True), in 1260.92sec\r\ncaught 12 linalg singular matrix errors\r\niter  19: ll=48554130.906475, converged: 67.49% (loc: 97.40%, scale update: False), in 11.38sec\r\niter  20: ll=48554108.553771, converged: 67.49% (loc: 98.90%, scale update: False), in 5.42sec\r\ncaught 11 linalg singular matrix errors\r\niter  21: ll=48554100.295546, converged: 67.49% (loc: 99.10%, scale update: False), in 3.43sec\r\ncaught 44 linalg singular matrix errors\r\niter  22: ll=48554096.867598, converged: 67.49% (loc: 99.37%, scale update: False), in 3.20sec\r\ncaught 27 linalg singular matrix errors\r\niter  23: ll=48554095.283522, converged: 67.49% (loc: 99.52%, scale update: False), in 2.71sec\r\n\r\nFitting 7967 dispersion models: (progress not available with multiprocessing)\r\niter  24: ll=46569302.387164, converged: 90.46% (loc: 90.46%, scale update: True), in 527.66sec\r\ncaught 116 linalg singular matrix errors\r\niter  25: ll=46569299.973292, converged: 90.46% (loc: 99.49%, scale update: False), in 6.18sec\r\ncaught 11 linalg singular matrix errors\r\niter  26: ll=46569299.754370, converged: 90.46% (loc: 99.87%, scale update: False), in 2.71sec\r\ncaught 6 linalg singular matrix errors\r\niter  27: ll=46569299.752718, converged: 90.46% (loc: 99.92%, scale update: False), in 1.41sec\r\niter  28: ll=46569299.752676, converged: 90.46% (loc: 99.93%, scale update: False), in 1.50sec\r\ncaught 3 linalg singular matrix errors\r\niter  29: ll=46569299.752662, converged: 90.46% (loc: 99.96%, scale update: False), in 1.19sec\r\n\r\nFitting 2337 dispersion models: (progress not available with multiprocessing)\r\niter  30: ll=46113421.509132, converged: 97.82% (loc: 97.82%, scale update: True), in 175.80sec\r\ncaught 30 linalg singular matrix errors\r\niter  31: ll=46113419.735521, converged: 97.82% (loc: 99.93%, scale update: False), in 5.41sec\r\ncaught 6 linalg singular matrix errors\r\niter  32: ll=46113419.712236, converged: 97.82% (loc: 100.00%, scale update: False), in 1.23sec\r\niter  33: ll=46113419.710071, converged: 97.82% (loc: 100.00%, scale update: False), in 1.25sec\r\niter  34: ll=46113419.709985, converged: 97.82% (loc: 100.00%, scale update: False), in 1.01sec\r\niter  35: ll=46113419.709984, converged: 97.82% (loc: 100.00%, scale update: False), in 1.02sec\r\n\r\nFitting 534 dispersion models: (progress not available with multiprocessing)\r\niter  36: ll=45997409.837720, converged: 99.64% (loc: 99.64%, scale update: True), in 57.52sec\r\ncaught 12 linalg singular matrix errors\r\niter  37: ll=45997409.834046, converged: 99.64% (loc: 99.98%, scale update: False), in 2.16sec\r\niter  38: ll=45997409.834046, converged: 99.64% (loc: 100.00%, scale update: False), in 1.53sec\r\n\r\nFitting 89 dispersion models: (progress not available with multiprocessing)\r\niter  39: ll=45989396.952243, converged: 99.92% (loc: 99.92%, scale update: True), in 32.57sec\r\ncaught 1 linalg singular matrix errors\r\niter  40: ll=45989396.952202, converged: 99.92% (loc: 100.00%, scale update: False), in 1.58sec\r\niter  41: ll=45989396.952202, converged: 99.92% (loc: 100.00%, scale update: False), in 1.13sec\r\n\r\nFitting 20 dispersion models: (progress not available with multiprocessing)\r\niter  42: ll=45950000.848035, converged: 99.97% (loc: 99.97%, scale update: True), in 28.84sec\r\niter  43: ll=45950000.848035, converged: 99.97% (loc: 100.00%, scale update: False), in 1.55sec\r\n\r\nFitting 7 dispersion models: (progress not available with multiprocessing)\r\niter  44: ll=45949070.365447, converged: 100.00% (loc: 100.00%, scale update: True), in 24.72sec\r\niter  45: ll=45949070.365447, converged: 100.00% (loc: 100.00%, scale update: False), in 1.35sec\r\n\r\nFitting dispersion models: 0.00% in 0.01sec\r\niter  46: ll=45949070.365447, converged: 100.00% (loc: 100.00%, scale update: True), in 1.25sec\r\n```\r\nand this is the head of the resulting tsv file\r\n```\r\ngene\tpval\tqval\tlog2fc\tmean\tzero_mean\tgrad\tcoef_mle\tcoef_sd\tll\r\nA1BG\t0.312478681\t0.787738151\t0.161516688\t0.092773702\tFALSE\t4.056426074\t0.161516688\t0.159912024\t-6781.629286\r\nA1BG-AS1\t0.48030134\t0.929602236\t0.331335826\t0.009863314\tFALSE\t0.009596474\t0.331335826\t0.469435231\t-385.7717783\r\nA1CF\t0.894546706\t1\t-0.21362873\t0.001293466\tFALSE\t0.082358417\t-0.21362873\t1.611644585\t-82.14013579\r\nA2M\t0.047744881\t0.275626869\t-0.763245681\t0.01917489\tFALSE\t0.262260202\t-0.763245681\t0.385549251\t-1230.818608\r\nA2M-AS1\t0.524215312\t0.957188022\t-0.469050349\t0.005311979\tFALSE\t0.000410546\t-0.469050349\t0.736503355\t-560.8241553\r\nA2ML1\t0.646698854\t1\t-0.415191149\t0.003174966\tFALSE\t6.79E-06\t-0.415191149\t0.905832734\t-467.2889809\r\nA2ML1-AS2\t1\t1\t0\t0\tTRUE\t5.03E-127\t0\t3.37E+63\t-7.31E-126\r\nA4GALT\t0.21076328\t0.658880588\t-1.394940411\t0.001117579\tFALSE\t1.47615582\t-1.394940411\t1.114642066\t-27.84762266\r\nAAAS\t0.901200251\t1\t0.024925929\t0.046980111\tFALSE\t11.23234409\t0.024925929\t0.200780325\t-1885.289258\r\n```","closed_by":null,"reactions":{"url":"https://api.github.com/repos/theislab/diffxpy/issues/198/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/theislab/diffxpy/issues/198/timeline","performed_via_github_app":null,"state_reason":null}