{"url":"https://api.github.com/repos/theislab/diffxpy/issues/172","repository_url":"https://api.github.com/repos/theislab/diffxpy","labels_url":"https://api.github.com/repos/theislab/diffxpy/issues/172/labels{/name}","comments_url":"https://api.github.com/repos/theislab/diffxpy/issues/172/comments","events_url":"https://api.github.com/repos/theislab/diffxpy/issues/172/events","html_url":"https://github.com/theislab/diffxpy/issues/172","id":665064324,"node_id":"MDU6SXNzdWU2NjUwNjQzMjQ=","number":172,"title":"de.test.lrt fails with ValueError: type <class 'tuple'> not recognized","user":{"login":"letaylor","id":3814682,"node_id":"MDQ6VXNlcjM4MTQ2ODI=","avatar_url":"https://avatars.githubusercontent.com/u/3814682?v=4","gravatar_id":"","url":"https://api.github.com/users/letaylor","html_url":"https://github.com/letaylor","followers_url":"https://api.github.com/users/letaylor/followers","following_url":"https://api.github.com/users/letaylor/following{/other_user}","gists_url":"https://api.github.com/users/letaylor/gists{/gist_id}","starred_url":"https://api.github.com/users/letaylor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/letaylor/subscriptions","organizations_url":"https://api.github.com/users/letaylor/orgs","repos_url":"https://api.github.com/users/letaylor/repos","events_url":"https://api.github.com/users/letaylor/events{/privacy}","received_events_url":"https://api.github.com/users/letaylor/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-07-24T10:08:06Z","updated_at":"2020-07-24T17:21:40Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"I am finding an error when I run de.test.lrt. Below is an example based on the tutorials. \r\n\r\n```\r\nimport anndata\r\nimport matplotlib.pyplot as plt\r\nimport seaborn as sns\r\nimport logging\r\nimport numpy as np\r\nimport pandas as pd\r\nimport scipy.stats\r\nimport diffxpy.api as de\r\n\r\nfrom batchglm.api.models.tf1.glm_nb import Simulator\r\n\r\nsim = Simulator(num_observations=200, num_features=100)\r\nsim.generate_sample_description(num_batches=0, num_conditions=2)\r\nsim.generate_params(\r\n    rand_fn_loc=lambda shape: np.random.uniform(-0.1, 0.1, shape),\r\n    rand_fn_scale=lambda shape: np.random.uniform(0.1, 2, shape)\r\n)\r\nsim.generate_data()\r\n\r\ndata = anndata.AnnData(\r\n    X=sim.x,\r\n    var=pd.DataFrame(index=[\"gene\" + str(i) for i in range(sim.x.shape[1])]),\r\n    obs=sim.sample_description\r\n)\r\n\r\ntest_lrt = de.test.lrt(\r\n   data=data, \r\n   full_formula_loc=\"1+condition\",\r\n   reduced_formula_loc=\"1\"\r\n)\r\n```\r\n\r\nThrows the below error:\r\n```\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-3-faaa08cbab62> in <module>\r\n      2    data=data,\r\n      3    full_formula_loc=\"1+condition\",\r\n----> 4    reduced_formula_loc=\"1\"\r\n      5 )\r\n\r\n/miniconda3/envs/diffx/lib/python3.7/site-packages/diffxpy/testing/tests.py in lrt(data, full_formula_loc, reduced_formula_loc, full_formula_scale, reduced_formula_scale, as_numeric, init_a,\r\ninit_b, gene_names, sample_description, noise_model, size_factors, batch_size, backend, train_args, training_strategy, quick_scale, dtype, **kwargs)\r\n    412         quick_scale=quick_scale,\r\n    413         dtype=dtype,\r\n--> 414         **kwargs\r\n    415     )\r\n    416     full_model = _fit(\r\n\r\n/miniconda3/envs/diffx/lib/python3.7/site-packages/diffxpy/testing/tests.py in _fit(noise_model, data, design_loc, design_scale, design_loc_names, design_scale_names, constraints_loc, constra\r\nints_scale, init_model, init_a, init_b, gene_names, size_factors, batch_size, backend, training_strategy, quick_scale, train_args, close_session, dtype)\r\n    188         chunk_size_genes=chunk_size_genes,\r\n    189         as_dask=backend.lower() in [\"numpy\"],\r\n--> 190         cast_dtype=dtype\r\n    191     )\r\n    192\r\n\r\n/miniconda3/envs/diffx/lib/python3.7/site-packages/batchglm/models/base_glm/input.py in __init__(self, data, design_loc, design_loc_names, design_scale, design_scale_names, constraints_loc, c\r\nonstraints_scale, size_factors, observation_names, feature_names, chunk_size_cells, chunk_size_genes, as_dask, cast_dtype)\r\n     94         design_loc, design_loc_names = parse_design(\r\n     95             design_matrix=design_loc,\r\n---> 96             param_names=design_loc_names\r\n     97         )\r\n     98         design_scale, design_scale_names = parse_design(\r\n\r\n/miniconda3/envs/diffx/lib/python3.7/site-packages/batchglm/models/base_glm/utils.py in parse_design(design_matrix, param_names)\r\n     39         params = None\r\n     40     else:\r\n---> 41         raise ValueError(\"type %s not recognized\" % type(design_matrix))\r\n     42\r\n     43     if param_names is not None:\r\n\r\nValueError: type <class 'tuple'> not recognized\r\n```\r\n\r\nConda environment:\r\n```\r\nchannels:\r\n  - hanyucui\r\n  - conda-forge\r\n  - bioconda\r\n  - r\r\n  - defaults\r\ndependencies:\r\n  - pandas=1.0.5\r\n  - scipy=1.5.0\r\n  - scanpy=1.5.1\r\n  - plotnine=0.7.0\r\n  - scikit-learn=0.23.1\r\n  - joblib=0.15.1\r\n  - tensorflow-gpu=1.15.0+db2\r\n  - pip\r\n  - pip:\r\n      - diffxpy==0.7.4\r\n```","closed_by":null,"reactions":{"url":"https://api.github.com/repos/theislab/diffxpy/issues/172/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/theislab/diffxpy/issues/172/timeline","performed_via_github_app":null,"state_reason":null}