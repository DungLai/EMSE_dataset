{"url":"https://api.github.com/repos/theislab/diffxpy/issues/18","repository_url":"https://api.github.com/repos/theislab/diffxpy","labels_url":"https://api.github.com/repos/theislab/diffxpy/issues/18/labels{/name}","comments_url":"https://api.github.com/repos/theislab/diffxpy/issues/18/comments","events_url":"https://api.github.com/repos/theislab/diffxpy/issues/18/events","html_url":"https://github.com/theislab/diffxpy/issues/18","id":346958235,"node_id":"MDU6SXNzdWUzNDY5NTgyMzU=","number":18,"title":"lrt with dispersion model = ~1","user":{"login":"davidsebfischer","id":11200205,"node_id":"MDQ6VXNlcjExMjAwMjA1","avatar_url":"https://avatars.githubusercontent.com/u/11200205?v=4","gravatar_id":"","url":"https://api.github.com/users/davidsebfischer","html_url":"https://github.com/davidsebfischer","followers_url":"https://api.github.com/users/davidsebfischer/followers","following_url":"https://api.github.com/users/davidsebfischer/following{/other_user}","gists_url":"https://api.github.com/users/davidsebfischer/gists{/gist_id}","starred_url":"https://api.github.com/users/davidsebfischer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidsebfischer/subscriptions","organizations_url":"https://api.github.com/users/davidsebfischer/orgs","repos_url":"https://api.github.com/users/davidsebfischer/repos","events_url":"https://api.github.com/users/davidsebfischer/events{/privacy}","received_events_url":"https://api.github.com/users/davidsebfischer/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"Hoeze","id":1200058,"node_id":"MDQ6VXNlcjEyMDAwNTg=","avatar_url":"https://avatars.githubusercontent.com/u/1200058?v=4","gravatar_id":"","url":"https://api.github.com/users/Hoeze","html_url":"https://github.com/Hoeze","followers_url":"https://api.github.com/users/Hoeze/followers","following_url":"https://api.github.com/users/Hoeze/following{/other_user}","gists_url":"https://api.github.com/users/Hoeze/gists{/gist_id}","starred_url":"https://api.github.com/users/Hoeze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hoeze/subscriptions","organizations_url":"https://api.github.com/users/Hoeze/orgs","repos_url":"https://api.github.com/users/Hoeze/repos","events_url":"https://api.github.com/users/Hoeze/events{/privacy}","received_events_url":"https://api.github.com/users/Hoeze/received_events","type":"User","site_admin":false},"assignees":[{"login":"Hoeze","id":1200058,"node_id":"MDQ6VXNlcjEyMDAwNTg=","avatar_url":"https://avatars.githubusercontent.com/u/1200058?v=4","gravatar_id":"","url":"https://api.github.com/users/Hoeze","html_url":"https://github.com/Hoeze","followers_url":"https://api.github.com/users/Hoeze/followers","following_url":"https://api.github.com/users/Hoeze/following{/other_user}","gists_url":"https://api.github.com/users/Hoeze/gists{/gist_id}","starred_url":"https://api.github.com/users/Hoeze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hoeze/subscriptions","organizations_url":"https://api.github.com/users/Hoeze/orgs","repos_url":"https://api.github.com/users/Hoeze/repos","events_url":"https://api.github.com/users/Hoeze/events{/privacy}","received_events_url":"https://api.github.com/users/Hoeze/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2018-08-02T10:46:04Z","updated_at":"2018-08-02T21:02:24Z","closed_at":"2018-08-02T21:02:23Z","author_association":"MEMBER","active_lock_reason":null,"body":"This yields an error, likely because the dispersion model isnt set up correctly?\r\n```sim = Simulator(num_observations=2000, num_features=100)\r\nsim.generate_sample_description(num_batches=0, num_confounders=0)\r\nsim.generate()\r\n\r\n\r\nlogging.getLogger(\"tensorflow\").setLevel(logging.WARNING)\r\nlogging.getLogger(\"batchglm\").setLevel(logging.INFO)\r\nlogging.getLogger(\"diffxpy\").setLevel(logging.INFO)\r\n\r\nrandom_sample_description = pd.DataFrame({\r\n    \"condition\": np.random.randint(2, size=sim.num_observations)\r\n})\r\n\r\ntraining_strategy = [{\r\n\t\"learning_rate\": 1e-4,\r\n\t\"convergence_criteria\": \"t_test\",\r\n\t\"stop_at_loss_change\": 1e-8,\r\n\t\"loss_window_size\": 20,\r\n\t'use_batching': False, \r\n\t'optim_algo': 'GD'\r\n}]\r\ntest = de.test_lrt(\r\n    data = sim.X, \r\n    full_formula_loc=\"~ 1 + condition\", \r\n    reduced_formula_loc=\"~ 1\", \r\n    full_formula_scale=\"~ 1\", \r\n    reduced_formula_scale=\"~ 1\", \r\n    sample_description=random_sample_description,\r\n    training_strategy=training_strategy\r\n)\r\n```\r\n\r\nThis is the full model estimation output:\r\n```Estimating model ready\r\nEstimating model...\r\nUsing closed-form MLE initialization for mean\r\nUsing closed-form MME initialization for dispersion\r\nTraceback (most recent call last):\r\n  File \"/Users/david.fischer/miniconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1605, in _create_c_op\r\n    c_op = c_api.TF_FinishOperation(op_desc)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Dimension 0 in both shapes must be equal, but are 1 and 2. Shapes are [1,1000] and [2,1000]. for 'output/b' (op: 'Select') with input shapes: [2,1000], [1,1000], [1,1000].\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 8, in <module>\r\n  File \"/Users/david.fischer/gitDevelopment/diffxpy/diffxpy/base.py\", line 803, in test_lrt\r\n    training_strategy=training_strategy,\r\n  File \"/Users/david.fischer/gitDevelopment/diffxpy/diffxpy/base.py\", line 676, in _fit\r\n    estim = test_model.Estimator(input_data=input_data, init_model=init_model, **constructor_args)\r\n  File \"/Users/david.fischer/gitDevelopment/batchglm/batchglm/train/tf/nb_glm/estimator.py\", line 811, in __init__\r\n    extended_summary=extended_summary\r\n  File \"/Users/david.fischer/gitDevelopment/batchglm/batchglm/train/tf/nb_glm/estimator.py\", line 504, in __init__\r\n    name=\"b\"\r\n  File \"/Users/david.fischer/miniconda3/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 2608, in where\r\n    return gen_math_ops.select(condition=condition, x=x, y=y, name=name)\r\n  File \"/Users/david.fischer/miniconda3/lib/python3.6/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 6931, in select\r\n    \"Select\", condition=condition, t=x, e=y, name=name)\r\n  File \"/Users/david.fischer/miniconda3/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/Users/david.fischer/miniconda3/lib/python3.6/site-packages/tensorflow/python/util/deprecation.py\", line 488, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"/Users/david.fischer/miniconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3259, in create_op\r\n    op_def=op_def)\r\n  File \"/Users/david.fischer/miniconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1769, in __init__\r\n    control_input_ops)\r\n  File \"/Users/david.fischer/miniconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1608, in _create_c_op\r\n    raise ValueError(str(e))\r\nValueError: Dimension 0 in both shapes must be equal, but are 1 and 2. Shapes are [1,1000] and [2,1000]. for 'output/b' (op: 'Select') with input shapes: [2,1000], [1,1000], [1,1000].```","closed_by":{"login":"Hoeze","id":1200058,"node_id":"MDQ6VXNlcjEyMDAwNTg=","avatar_url":"https://avatars.githubusercontent.com/u/1200058?v=4","gravatar_id":"","url":"https://api.github.com/users/Hoeze","html_url":"https://github.com/Hoeze","followers_url":"https://api.github.com/users/Hoeze/followers","following_url":"https://api.github.com/users/Hoeze/following{/other_user}","gists_url":"https://api.github.com/users/Hoeze/gists{/gist_id}","starred_url":"https://api.github.com/users/Hoeze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hoeze/subscriptions","organizations_url":"https://api.github.com/users/Hoeze/orgs","repos_url":"https://api.github.com/users/Hoeze/repos","events_url":"https://api.github.com/users/Hoeze/events{/privacy}","received_events_url":"https://api.github.com/users/Hoeze/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/theislab/diffxpy/issues/18/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/theislab/diffxpy/issues/18/timeline","performed_via_github_app":null,"state_reason":"completed"}