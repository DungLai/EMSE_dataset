[{"id":2787812391,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjc4NzgxMjM5MQ==","url":"https://api.github.com/repos/theislab/diffxpy/issues/events/2787812391","actor":{"login":"abyssum","id":32481179,"node_id":"MDQ6VXNlcjMyNDgxMTc5","avatar_url":"https://avatars.githubusercontent.com/u/32481179?v=4","gravatar_id":"","url":"https://api.github.com/users/abyssum","html_url":"https://github.com/abyssum","followers_url":"https://api.github.com/users/abyssum/followers","following_url":"https://api.github.com/users/abyssum/following{/other_user}","gists_url":"https://api.github.com/users/abyssum/gists{/gist_id}","starred_url":"https://api.github.com/users/abyssum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abyssum/subscriptions","organizations_url":"https://api.github.com/users/abyssum/orgs","repos_url":"https://api.github.com/users/abyssum/repos","events_url":"https://api.github.com/users/abyssum/events{/privacy}","received_events_url":"https://api.github.com/users/abyssum/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-11-11T12:44:11Z","performed_via_github_app":null},{"id":2787812392,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI3ODc4MTIzOTI=","url":"https://api.github.com/repos/theislab/diffxpy/issues/events/2787812392","actor":{"login":"abyssum","id":32481179,"node_id":"MDQ6VXNlcjMyNDgxMTc5","avatar_url":"https://avatars.githubusercontent.com/u/32481179?v=4","gravatar_id":"","url":"https://api.github.com/users/abyssum","html_url":"https://github.com/abyssum","followers_url":"https://api.github.com/users/abyssum/followers","following_url":"https://api.github.com/users/abyssum/following{/other_user}","gists_url":"https://api.github.com/users/abyssum/gists{/gist_id}","starred_url":"https://api.github.com/users/abyssum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abyssum/subscriptions","organizations_url":"https://api.github.com/users/abyssum/orgs","repos_url":"https://api.github.com/users/abyssum/repos","events_url":"https://api.github.com/users/abyssum/events{/privacy}","received_events_url":"https://api.github.com/users/abyssum/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-11-11T12:44:11Z","performed_via_github_app":null},{"actor":{"login":"grst","id":7051479,"node_id":"MDQ6VXNlcjcwNTE0Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/7051479?v=4","gravatar_id":"","url":"https://api.github.com/users/grst","html_url":"https://github.com/grst","followers_url":"https://api.github.com/users/grst/followers","following_url":"https://api.github.com/users/grst/following{/other_user}","gists_url":"https://api.github.com/users/grst/gists{/gist_id}","starred_url":"https://api.github.com/users/grst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/grst/subscriptions","organizations_url":"https://api.github.com/users/grst/orgs","repos_url":"https://api.github.com/users/grst/repos","events_url":"https://api.github.com/users/grst/events{/privacy}","received_events_url":"https://api.github.com/users/grst/received_events","type":"User","site_admin":false},"created_at":"2019-11-11T13:00:35Z","updated_at":"2019-11-11T13:00:35Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/theislab/diffxpy/issues/132","repository_url":"https://api.github.com/repos/theislab/diffxpy","labels_url":"https://api.github.com/repos/theislab/diffxpy/issues/132/labels{/name}","comments_url":"https://api.github.com/repos/theislab/diffxpy/issues/132/comments","events_url":"https://api.github.com/repos/theislab/diffxpy/issues/132/events","html_url":"https://github.com/theislab/diffxpy/issues/132","id":520949356,"node_id":"MDU6SXNzdWU1MjA5NDkzNTY=","number":132,"title":"Design matrix is not full rank (on example that works in edgeR)","user":{"login":"grst","id":7051479,"node_id":"MDQ6VXNlcjcwNTE0Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/7051479?v=4","gravatar_id":"","url":"https://api.github.com/users/grst","html_url":"https://github.com/grst","followers_url":"https://api.github.com/users/grst/followers","following_url":"https://api.github.com/users/grst/following{/other_user}","gists_url":"https://api.github.com/users/grst/gists{/gist_id}","starred_url":"https://api.github.com/users/grst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/grst/subscriptions","organizations_url":"https://api.github.com/users/grst/orgs","repos_url":"https://api.github.com/users/grst/repos","events_url":"https://api.github.com/users/grst/events{/privacy}","received_events_url":"https://api.github.com/users/grst/received_events","type":"User","site_admin":false},"labels":[{"id":1500434326,"node_id":"MDU6TGFiZWwxNTAwNDM0MzI2","url":"https://api.github.com/repos/theislab/diffxpy/labels/waiting%20to%20close","name":"waiting to close","color":"c5def5","default":false,"description":"Issue is solved, waiting for feedback."}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-11-11T13:00:35Z","updated_at":"2019-11-12T15:11:18Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"repository":{"id":139462224,"node_id":"MDEwOlJlcG9zaXRvcnkxMzk0NjIyMjQ=","name":"diffxpy","full_name":"theislab/diffxpy","private":false,"owner":{"login":"theislab","id":22319415,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIyMzE5NDE1","avatar_url":"https://avatars.githubusercontent.com/u/22319415?v=4","gravatar_id":"","url":"https://api.github.com/users/theislab","html_url":"https://github.com/theislab","followers_url":"https://api.github.com/users/theislab/followers","following_url":"https://api.github.com/users/theislab/following{/other_user}","gists_url":"https://api.github.com/users/theislab/gists{/gist_id}","starred_url":"https://api.github.com/users/theislab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theislab/subscriptions","organizations_url":"https://api.github.com/users/theislab/orgs","repos_url":"https://api.github.com/users/theislab/repos","events_url":"https://api.github.com/users/theislab/events{/privacy}","received_events_url":"https://api.github.com/users/theislab/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/theislab/diffxpy","description":"Differential expression analysis for single-cell RNA-seq data.","fork":false,"url":"https://api.github.com/repos/theislab/diffxpy","forks_url":"https://api.github.com/repos/theislab/diffxpy/forks","keys_url":"https://api.github.com/repos/theislab/diffxpy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/theislab/diffxpy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/theislab/diffxpy/teams","hooks_url":"https://api.github.com/repos/theislab/diffxpy/hooks","issue_events_url":"https://api.github.com/repos/theislab/diffxpy/issues/events{/number}","events_url":"https://api.github.com/repos/theislab/diffxpy/events","assignees_url":"https://api.github.com/repos/theislab/diffxpy/assignees{/user}","branches_url":"https://api.github.com/repos/theislab/diffxpy/branches{/branch}","tags_url":"https://api.github.com/repos/theislab/diffxpy/tags","blobs_url":"https://api.github.com/repos/theislab/diffxpy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/theislab/diffxpy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/theislab/diffxpy/git/refs{/sha}","trees_url":"https://api.github.com/repos/theislab/diffxpy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/theislab/diffxpy/statuses/{sha}","languages_url":"https://api.github.com/repos/theislab/diffxpy/languages","stargazers_url":"https://api.github.com/repos/theislab/diffxpy/stargazers","contributors_url":"https://api.github.com/repos/theislab/diffxpy/contributors","subscribers_url":"https://api.github.com/repos/theislab/diffxpy/subscribers","subscription_url":"https://api.github.com/repos/theislab/diffxpy/subscription","commits_url":"https://api.github.com/repos/theislab/diffxpy/commits{/sha}","git_commits_url":"https://api.github.com/repos/theislab/diffxpy/git/commits{/sha}","comments_url":"https://api.github.com/repos/theislab/diffxpy/comments{/number}","issue_comment_url":"https://api.github.com/repos/theislab/diffxpy/issues/comments{/number}","contents_url":"https://api.github.com/repos/theislab/diffxpy/contents/{+path}","compare_url":"https://api.github.com/repos/theislab/diffxpy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/theislab/diffxpy/merges","archive_url":"https://api.github.com/repos/theislab/diffxpy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/theislab/diffxpy/downloads","issues_url":"https://api.github.com/repos/theislab/diffxpy/issues{/number}","pulls_url":"https://api.github.com/repos/theislab/diffxpy/pulls{/number}","milestones_url":"https://api.github.com/repos/theislab/diffxpy/milestones{/number}","notifications_url":"https://api.github.com/repos/theislab/diffxpy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/theislab/diffxpy/labels{/name}","releases_url":"https://api.github.com/repos/theislab/diffxpy/releases{/id}","deployments_url":"https://api.github.com/repos/theislab/diffxpy/deployments","created_at":"2018-07-02T15:37:56Z","updated_at":"2023-01-13T22:49:58Z","pushed_at":"2022-10-11T02:41:42Z","git_url":"git://github.com/theislab/diffxpy.git","ssh_url":"git@github.com:theislab/diffxpy.git","clone_url":"https://github.com/theislab/diffxpy.git","svn_url":"https://github.com/theislab/diffxpy","homepage":"https://diffxpy.rtfd.io","size":1794,"stargazers_count":143,"watchers_count":143,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":21,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":102,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause","node_id":"MDc6TGljZW5zZTU="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["bioinformatics","differential-expression","gene-set-enrichment","single-cell-rna-seq","tensorflow","transcriptomics"],"visibility":"public","forks":21,"open_issues":102,"watchers":143,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"[Soneson et al, 2018, NMeth](https://www.nature.com/articles/nmeth.4612#references) recommend to add the fraction of detected genes as a covariate to the linear model for DE testing: \r\n```\r\n~ group + n_genes\r\n```\r\n(instead of using a ZINB model (#131))\r\n\r\nWhen I try add `n_genes` to my `diffxpy` model, it throws a `ValueError`: \r\n```python\r\n> test = de.test.wald(\r\n    data=counts.values.T,\r\n    formula_loc=\"~ 1 + group + n_genes\",\r\n    factor_loc_totest=[\"group\"],\r\n    coef_to_test=\"group\",\r\n    sample_description=obs,\r\n    batch_size=100,\r\n    training_strategy=\"DEFAULT\",\r\n    dtype=\"float64\",\r\n    gene_names=counts.index\r\n  )\r\n```\r\n```\r\nValueError: constrained design matrix is not full rank: 80 81\r\n```\r\n\r\nThe same model runs fine with `edgeR`: \r\n```R\r\nd <- DGEList(counts)\r\nd <- suppressWarnings(edgeR::calcNormFactors(d))\r\ndesign <- model.matrix(~ 1 + group + n_genes, data=obs)\r\nd <- estimateDisp(d, design)\r\nfit <- glmFit(d,design)\r\nlrt <- glmLRT(fit, coef = 2)\r\npval <- lrt$table$PValue\r\n```\r\n\r\nIs that a bug? Or am I missing something? \r\nThanks for your help! \r\n\r\n## Full repex\r\n* A reproducible example (Rmd notebook + sample data) is available at https://github.com/grst/benchmark-single-cell-de-analysis/tree/master/diffxpy_test. The example uses diffxpy v0.7.1 from PyPI.\r\n* An executed version of the notebook is [here](https://grst.github.io/benchmark-single-cell-de-analysis/results/diffxpy_ncounts/diffxpy_ncounts.html).\r\n* To run the notebook in my conda-environment, use `nextflow run` [`diffxpy_test.nf`](https://github.com/grst/benchmark-single-cell-de-analysis/blob/master/diffxpy_test.nf). \r\n\r\n","reactions":{"url":"https://api.github.com/repos/theislab/diffxpy/issues/132/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/theislab/diffxpy/issues/132/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/theislab/diffxpy/issues/comments/552491830","html_url":"https://github.com/theislab/diffxpy/issues/131#issuecomment-552491830","issue_url":"https://api.github.com/repos/theislab/diffxpy/issues/131","id":552491830,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MjQ5MTgzMA==","user":{"login":"davidsebfischer","id":11200205,"node_id":"MDQ6VXNlcjExMjAwMjA1","avatar_url":"https://avatars.githubusercontent.com/u/11200205?v=4","gravatar_id":"","url":"https://api.github.com/users/davidsebfischer","html_url":"https://github.com/davidsebfischer","followers_url":"https://api.github.com/users/davidsebfischer/followers","following_url":"https://api.github.com/users/davidsebfischer/following{/other_user}","gists_url":"https://api.github.com/users/davidsebfischer/gists{/gist_id}","starred_url":"https://api.github.com/users/davidsebfischer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidsebfischer/subscriptions","organizations_url":"https://api.github.com/users/davidsebfischer/orgs","repos_url":"https://api.github.com/users/davidsebfischer/repos","events_url":"https://api.github.com/users/davidsebfischer/events{/privacy}","received_events_url":"https://api.github.com/users/davidsebfischer/received_events","type":"User","site_admin":false},"created_at":"2019-11-11T15:31:29Z","updated_at":"2019-11-11T15:31:29Z","author_association":"MEMBER","body":"Hi Gregor!\r\n\r\n1. Weights are going to come, hopefully this month. We are switching the tf1 backend to tf2 and adding a numpy/dask backend, the weighting will be easier to introduce there than in tf1. The workflow that you propose will be possible then. \r\n\r\n2. To the best of my knowledge, the consensus in the field right now is that zero-inflation was a technical noise effect that only occured in protocols that did not use UMIs, probably related to biased PCR amplification. This is why we do not have zero-inflated models right now. Thank you for the reference, I will read what their opinion is on that topic but I think that these models should be treated with care. However, we can in principle include them. Building the noise function in tensorflow or numpy is relatively easy, one would have to decide on a way to parameterise the mixture weigh `pi` though and then build a parameter estimation around that. Are you intersted in having a single scalar for `pi` per cell or per gene?\r\nMy intuition is also that this should be faster and more accurate than a sequential model fit in which the first round just estimates observation weights.\r\n\r\nBest,\r\nDavid","reactions":{"url":"https://api.github.com/repos/theislab/diffxpy/issues/comments/552491830/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"davidsebfischer","id":11200205,"node_id":"MDQ6VXNlcjExMjAwMjA1","avatar_url":"https://avatars.githubusercontent.com/u/11200205?v=4","gravatar_id":"","url":"https://api.github.com/users/davidsebfischer","html_url":"https://github.com/davidsebfischer","followers_url":"https://api.github.com/users/davidsebfischer/followers","following_url":"https://api.github.com/users/davidsebfischer/following{/other_user}","gists_url":"https://api.github.com/users/davidsebfischer/gists{/gist_id}","starred_url":"https://api.github.com/users/davidsebfischer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidsebfischer/subscriptions","organizations_url":"https://api.github.com/users/davidsebfischer/orgs","repos_url":"https://api.github.com/users/davidsebfischer/repos","events_url":"https://api.github.com/users/davidsebfischer/events{/privacy}","received_events_url":"https://api.github.com/users/davidsebfischer/received_events","type":"User","site_admin":false}},{"id":2788344433,"node_id":"MDEyOkxhYmVsZWRFdmVudDI3ODgzNDQ0MzM=","url":"https://api.github.com/repos/theislab/diffxpy/issues/events/2788344433","actor":{"login":"davidsebfischer","id":11200205,"node_id":"MDQ6VXNlcjExMjAwMjA1","avatar_url":"https://avatars.githubusercontent.com/u/11200205?v=4","gravatar_id":"","url":"https://api.github.com/users/davidsebfischer","html_url":"https://github.com/davidsebfischer","followers_url":"https://api.github.com/users/davidsebfischer/followers","following_url":"https://api.github.com/users/davidsebfischer/following{/other_user}","gists_url":"https://api.github.com/users/davidsebfischer/gists{/gist_id}","starred_url":"https://api.github.com/users/davidsebfischer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidsebfischer/subscriptions","organizations_url":"https://api.github.com/users/davidsebfischer/orgs","repos_url":"https://api.github.com/users/davidsebfischer/repos","events_url":"https://api.github.com/users/davidsebfischer/events{/privacy}","received_events_url":"https://api.github.com/users/davidsebfischer/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-11-11T15:31:51Z","label":{"name":"question","color":"d876e3"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/theislab/diffxpy/issues/comments/552500946","html_url":"https://github.com/theislab/diffxpy/issues/131#issuecomment-552500946","issue_url":"https://api.github.com/repos/theislab/diffxpy/issues/131","id":552500946,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MjUwMDk0Ng==","user":{"login":"grst","id":7051479,"node_id":"MDQ6VXNlcjcwNTE0Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/7051479?v=4","gravatar_id":"","url":"https://api.github.com/users/grst","html_url":"https://github.com/grst","followers_url":"https://api.github.com/users/grst/followers","following_url":"https://api.github.com/users/grst/following{/other_user}","gists_url":"https://api.github.com/users/grst/gists{/gist_id}","starred_url":"https://api.github.com/users/grst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/grst/subscriptions","organizations_url":"https://api.github.com/users/grst/orgs","repos_url":"https://api.github.com/users/grst/repos","events_url":"https://api.github.com/users/grst/events{/privacy}","received_events_url":"https://api.github.com/users/grst/received_events","type":"User","site_admin":false},"created_at":"2019-11-11T15:54:18Z","updated_at":"2019-11-11T15:54:18Z","author_association":"NONE","body":"Hi David, \r\n\r\nthanks for your feedback! \r\n\r\n> Weights are going to come, hopefully this month. We are switching the tf1 backend to tf2 and adding a numpy/dask backend, the weighting will be easier to introduce there than in tf1. The workflow that you propose will be possible then.\r\n\r\nThat are great news! \r\n\r\n> Are you interested in having a single scalar for `pi` per cell or per gene?\r\n\r\nAs far as I can tell, in the study mentioned above, they use one weight per cell. However, I do not know if that really makes more sense than having a per-gene weight. \r\n\r\nCheers, \r\nGregor \r\n","reactions":{"url":"https://api.github.com/repos/theislab/diffxpy/issues/comments/552500946/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"grst","id":7051479,"node_id":"MDQ6VXNlcjcwNTE0Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/7051479?v=4","gravatar_id":"","url":"https://api.github.com/users/grst","html_url":"https://github.com/grst","followers_url":"https://api.github.com/users/grst/followers","following_url":"https://api.github.com/users/grst/following{/other_user}","gists_url":"https://api.github.com/users/grst/gists{/gist_id}","starred_url":"https://api.github.com/users/grst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/grst/subscriptions","organizations_url":"https://api.github.com/users/grst/orgs","repos_url":"https://api.github.com/users/grst/repos","events_url":"https://api.github.com/users/grst/events{/privacy}","received_events_url":"https://api.github.com/users/grst/received_events","type":"User","site_admin":false}}]