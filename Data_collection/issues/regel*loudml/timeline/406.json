[{"url":"https://api.github.com/repos/regel/loudml/issues/comments/684118416","html_url":"https://github.com/regel/loudml/issues/406#issuecomment-684118416","issue_url":"https://api.github.com/repos/regel/loudml/issues/406","id":684118416,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NDExODQxNg==","user":{"login":"joshkentYT","id":32724595,"node_id":"MDQ6VXNlcjMyNzI0NTk1","avatar_url":"https://avatars.githubusercontent.com/u/32724595?v=4","gravatar_id":"","url":"https://api.github.com/users/joshkentYT","html_url":"https://github.com/joshkentYT","followers_url":"https://api.github.com/users/joshkentYT/followers","following_url":"https://api.github.com/users/joshkentYT/following{/other_user}","gists_url":"https://api.github.com/users/joshkentYT/gists{/gist_id}","starred_url":"https://api.github.com/users/joshkentYT/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshkentYT/subscriptions","organizations_url":"https://api.github.com/users/joshkentYT/orgs","repos_url":"https://api.github.com/users/joshkentYT/repos","events_url":"https://api.github.com/users/joshkentYT/events{/privacy}","received_events_url":"https://api.github.com/users/joshkentYT/received_events","type":"User","site_admin":false},"created_at":"2020-09-01T00:26:43Z","updated_at":"2020-09-01T00:26:43Z","author_association":"NONE","body":"I'm running into pretty much the exact same issue with my kubernetes deployed version, but with an Elasticsearch bucket. \r\n\r\nI initially thought it was a DB thing as well, but no longer think so. I realized there was an error in my bucket configuration, but updating it to be correct didn't change the error at all. I also don't think failing when cancelling a job should have anything to do with the db. \r\n\r\nHave you had any luck figuring it out? ","reactions":{"url":"https://api.github.com/repos/regel/loudml/issues/comments/684118416/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"joshkentYT","id":32724595,"node_id":"MDQ6VXNlcjMyNzI0NTk1","avatar_url":"https://avatars.githubusercontent.com/u/32724595?v=4","gravatar_id":"","url":"https://api.github.com/users/joshkentYT","html_url":"https://github.com/joshkentYT","followers_url":"https://api.github.com/users/joshkentYT/followers","following_url":"https://api.github.com/users/joshkentYT/following{/other_user}","gists_url":"https://api.github.com/users/joshkentYT/gists{/gist_id}","starred_url":"https://api.github.com/users/joshkentYT/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshkentYT/subscriptions","organizations_url":"https://api.github.com/users/joshkentYT/orgs","repos_url":"https://api.github.com/users/joshkentYT/repos","events_url":"https://api.github.com/users/joshkentYT/events{/privacy}","received_events_url":"https://api.github.com/users/joshkentYT/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/regel/loudml/issues/comments/685090496","html_url":"https://github.com/regel/loudml/issues/406#issuecomment-685090496","issue_url":"https://api.github.com/repos/regel/loudml/issues/406","id":685090496,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NTA5MDQ5Ng==","user":{"login":"joshkentYT","id":32724595,"node_id":"MDQ6VXNlcjMyNzI0NTk1","avatar_url":"https://avatars.githubusercontent.com/u/32724595?v=4","gravatar_id":"","url":"https://api.github.com/users/joshkentYT","html_url":"https://github.com/joshkentYT","followers_url":"https://api.github.com/users/joshkentYT/followers","following_url":"https://api.github.com/users/joshkentYT/following{/other_user}","gists_url":"https://api.github.com/users/joshkentYT/gists{/gist_id}","starred_url":"https://api.github.com/users/joshkentYT/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshkentYT/subscriptions","organizations_url":"https://api.github.com/users/joshkentYT/orgs","repos_url":"https://api.github.com/users/joshkentYT/repos","events_url":"https://api.github.com/users/joshkentYT/events{/privacy}","received_events_url":"https://api.github.com/users/joshkentYT/received_events","type":"User","site_admin":false},"created_at":"2020-09-01T19:40:13Z","updated_at":"2020-09-01T19:40:13Z","author_association":"NONE","body":"@regel any suggestions for next troubleshooting steps? \r\n\r\nTo add to this, not sure if it's related, but when I shell into the pod in kubernetes, I don't have a user assigned `I have no name!@loudml-0:/`. More than likely I just need to refactor the helm chart for 1.6.0, but figured I'd add it in case it helps.\r\n\r\nAs I mentioned in my previous comment, changing the database info doesn't seem to have had any effect. Is there anyway I can test this to rule it out? I validated credentials are correct, but not sure how to get confirmation loudml is able to access. \r\n\r\nAdding my replication to this ticket getting same result as OP: \r\n\r\nusing the 1.6.0 docker image, I am unable to start or cancel processes without error \r\n\r\nBelow are all the creation steps for each resource and the output. Stack trace from the logs is below as well. The job will stay in waiting until I try to cancel it. When I try to cancel it, it errors and then stays in canceling until I restart. \r\n\r\nModel Creation: \r\n```\r\ncurl -XPOST localhost:8077/models --data-binary \"@/home/me/Documents/deny-model.json\" -H \"Content-Type: application/json\"\r\n\r\n{\r\n\t\"bucket_interval\": \"1m\",\r\n\t\"default_datasource\": \"firewall-count-index\",\r\n\t\"features\": [\r\n\t\t {\r\n\t\t   \"default\": 0,\r\n\t\t  \"field\": \"Deny_count\",\r\n\t\t   \"metric\": \"avg\",\r\n\t\t   \"name\": \"avg_denies\"\r\n\t\t }\r\n\t],\r\n\t\"grace_period\": 0,\r\n\t\"interval\": 60,\r\n\t\"max_evals\": 10,\r\n\t\"max_threshold\": 90,\r\n\t\"min_threshold\": 50,\r\n\t\"name\": \"avg-denied-counts-redo\",\r\n\t\"offset\": 30,\r\n\t\"span\": 5,\r\n\t\"timestamp_field\": \"@timestamp\",\r\n\t\"type\": \"donut\"\r\n}\r\n```\r\n\r\nBucket Creation: \r\n```\r\ncurl -XPOST localhost:8077buckets --data-binary \"@/home/me/Documents/firewallbucket.json\" -H \"Content-Type: application/json\"\r\n\r\n{\r\n\t\"addr\": \"https://k8s-cluster-es.namespace.cluster.local:9200\",\r\n\t\"dbuser\": \"svc_loudml\",\r\n\t\"doc_type\": \"_doc\",\r\n\t\"index\": \"datacount.all-*\",\r\n\t\"name\": \"firewall-count-index\",\r\n\t\"type\": \"elasticsearch\",\r\n\t\"use_ssl\": true,\r\n\t\"verify_ssl\": false\r\n\t\"dbuser_password\": \"\"\r\n}\r\n```\r\n\r\nTrain Model\r\n```\r\ncurl -X POST localhost:8077/models/avg-denied-counts-redo/_train?from=now-30d\r\n[1] 119731\r\ninternal server error[1]+  Done\r\n```\r\n\r\nCheck job to see status \r\n```\r\ncurl localhost:8077/jobs/e7176a7e-3eca-4c6c-b525-6a61f494f7cb | jq\r\n{\r\n    \"duration\": 52.941789,\r\n    \"id\": \"e7176a7e-3eca-4c6c-b525-6a61f494f7cb\",\r\n    \"model\": \"avg-denied-counts-redo\",\r\n    \"result\": null,\r\n    \"start_date\": \"Tue Sep  1 19:04:09 2020\",\r\n    \"start_timestamp\": 1598987049.511435,\r\n    \"state\": \"waiting\",\r\n    \"type\": \"training\"\r\n}\r\n```\r\nstack trace \r\n```\r\n[2020-09-01 19:04:09,511] ERROR in app: Exception on /models/avg-denied-counts-redo/_train [POST]                                                                                                                                      \r\n Traceback (most recent call last):                                                                                                                                                                                                     \r\n   File \"/opt/vendor/lib/python3.5/site-packages/flask/app.py\", line 2446, in wsgi_app                                                                                                                                                  \r\n     response = self.full_dispatch_request()                                                                                                                                                                                            \r\n   File \"/opt/vendor/lib/python3.5/site-packages/flask/app.py\", line 1951, in full_dispatch_request                                                                                                                                     \r\n     rv = self.handle_user_exception(e)                                                                                                                                                                                                 \r\n   File \"/opt/vendor/lib/python3.5/site-packages/flask_restful/__init__.py\", line 269, in error_router                                                                                                                                  \r\n     return original_handler(e)                                                                                                                                                                                                         \r\n   File \"/opt/vendor/lib/python3.5/site-packages/flask/app.py\", line 1820, in handle_user_exception                                                                                                                                     \r\n     reraise(exc_type, exc_value, tb)                                                                                                                                                                                                   \r\n   File \"/opt/vendor/lib/python3.5/site-packages/flask/_compat.py\", line 39, in reraise                                                                                                                                                 \r\n     raise value                                                                                                                                                                                                                        \r\n   File \"/opt/vendor/lib/python3.5/site-packages/flask/app.py\", line 1949, in full_dispatch_request                                                                                                                                     \r\n     rv = self.dispatch_request()                                                                                                                                                                                                       \r\n   File \"/opt/vendor/lib/python3.5/site-packages/flask/app.py\", line 1935, in dispatch_request                                                                                                                                          \r\n     return self.view_functions[rule.endpoint](**req.view_args)                                                                                                                                                                         \r\n   File \"/opt/vendor/lib/python3.5/site-packages/loudml/server.py\", line 932, in model_train                                                                                                                                            \r\n     job.start(g_config)                                                                                                                                                                                                                \r\n   File \"/opt/vendor/lib/python3.5/site-packages/loudml/server.py\", line 1430, in start                                                                                                                                                 \r\n     kwargs=self.kwargs,                                                                                                                                                                                                                \r\n   File \"/opt/vendor/lib/python3.5/site-packages/pebble/pool/process.py\", line 84, in schedule                                                                                                                                          \r\n     self._check_pool_state()                                                                                                                                                                                                           \r\n   File \"/opt/vendor/lib/python3.5/site-packages/pebble/pool/base_pool.py\", line 94, in _check_pool_state                                                                                                                               \r\n     raise RuntimeError('Unexpected error within the Pool')                                                                                                                                                                             \r\n RuntimeError: Unexpected error within the Pool                                                                                                                                                                                         \r\n ERROR:loudml.server:Exception on /models/avg-denied-counts-redo/_train [POST]                                                                                                                                                          \r\n Traceback (most recent call last):                                                                                                                                                                                                     \r\n   File \"/opt/vendor/lib/python3.5/site-packages/flask/app.py\", line 2446, in wsgi_app                                                                                                                                                  \r\n     response = self.full_dispatch_request()                                                                                                                                                                                            \r\n   File \"/opt/vendor/lib/python3.5/site-packages/flask/app.py\", line 1951, in full_dispatch_request                                                                                                                                     \r\n     rv = self.handle_user_exception(e)                                                                                                                                                                                                 \r\n   File \"/opt/vendor/lib/python3.5/site-packages/flask_restful/__init__.py\", line 269, in error_router                                                                                                                                  \r\n     return original_handler(e)                                                                                                                                                                                                         \r\n   File \"/opt/vendor/lib/python3.5/site-packages/flask/app.py\", line 1820, in handle_user_exception                                                                                                                                     \r\n     reraise(exc_type, exc_value, tb)                                                                                                                                                                                                   \r\n   File \"/opt/vendor/lib/python3.5/site-packages/flask/_compat.py\", line 39, in reraise                                                                                                                                                 \r\n     raise value                                                                                                                                                                                                                        \r\n   File \"/opt/vendor/lib/python3.5/site-packages/flask/app.py\", line 1949, in full_dispatch_request                                                                                                                                     \r\n     rv = self.dispatch_request()                                                                                                                                                                                                       \r\n   File \"/opt/vendor/lib/python3.5/site-packages/flask/app.py\", line 1935, in dispatch_request                                                                                                                                          \r\n     return self.view_functions[rule.endpoint](**req.view_args)                                                                                                                                                                         \r\n   File \"/opt/vendor/lib/python3.5/site-packages/loudml/server.py\", line 932, in model_train                                                                                                                                            \r\n     job.start(g_config)                                                                                                                                                                                                                \r\n   File \"/opt/vendor/lib/python3.5/site-packages/loudml/server.py\", line 1430, in start                                                                                                                                                 \r\n     kwargs=self.kwargs,                                                                                                                                                                                                                \r\n   File \"/opt/vendor/lib/python3.5/site-packages/pebble/pool/process.py\", line 84, in schedule\r\n self._check_pool_state()                                                                                                                                                                                                           \r\n   File \"/opt/vendor/lib/python3.5/site-packages/pebble/pool/base_pool.py\", line 94, in _check_pool_state                                                                                                                               \r\n     raise RuntimeError('Unexpected error within the Pool')                                                                                                                                                                             \r\n RuntimeError: Unexpected error within the Pool                                                                                                                                                                                         \r\n 127.0.0.1 - - [2020-09-01 19:04:09] \"POST /models/avg-denied-counts-redo/_train?from=now-30d HTTP/1.1\" 500 156 0.007398     \r\n```\r\nAttempt to cancel job \r\n```\r\ncurl -X POST localhost:8077/jobs/e7176a7e-3eca-4c6c-b525-6a61f494f7cb/_cancel\r\ninternal server error\r\n\r\ncurl localhost:8077/jobs/e7176a7e-3eca-4c6c-b525-6a61f494f7cb | jq\r\n{\r\n    \"duration\": 1229.536151,\r\n    \"id\": \"e7176a7e-3eca-4c6c-b525-6a61f494f7cb\",\r\n    \"model\": \"avg-denied-counts-redo\",\r\n    \"result\": null,\r\n    \"start_date\": \"Tue Sep  1 19:04:09 2020\",\r\n    \"start_timestamp\": 1598987049.511435,\r\n    \"state\": \"canceling\",\r\n    \"type\": \"training\"\r\n  }\r\n\r\n```\r\nNo stack trace is generated when the job fails to cancel. ","reactions":{"url":"https://api.github.com/repos/regel/loudml/issues/comments/685090496/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"joshkentYT","id":32724595,"node_id":"MDQ6VXNlcjMyNzI0NTk1","avatar_url":"https://avatars.githubusercontent.com/u/32724595?v=4","gravatar_id":"","url":"https://api.github.com/users/joshkentYT","html_url":"https://github.com/joshkentYT","followers_url":"https://api.github.com/users/joshkentYT/followers","following_url":"https://api.github.com/users/joshkentYT/following{/other_user}","gists_url":"https://api.github.com/users/joshkentYT/gists{/gist_id}","starred_url":"https://api.github.com/users/joshkentYT/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshkentYT/subscriptions","organizations_url":"https://api.github.com/users/joshkentYT/orgs","repos_url":"https://api.github.com/users/joshkentYT/repos","events_url":"https://api.github.com/users/joshkentYT/events{/privacy}","received_events_url":"https://api.github.com/users/joshkentYT/received_events","type":"User","site_admin":false}},{"id":3716536598,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzcxNjUzNjU5OA==","url":"https://api.github.com/repos/regel/loudml/issues/events/3716536598","actor":{"login":"regel","id":355557,"node_id":"MDQ6VXNlcjM1NTU1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/355557?v=4","gravatar_id":"","url":"https://api.github.com/users/regel","html_url":"https://github.com/regel","followers_url":"https://api.github.com/users/regel/followers","following_url":"https://api.github.com/users/regel/following{/other_user}","gists_url":"https://api.github.com/users/regel/gists{/gist_id}","starred_url":"https://api.github.com/users/regel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/regel/subscriptions","organizations_url":"https://api.github.com/users/regel/orgs","repos_url":"https://api.github.com/users/regel/repos","events_url":"https://api.github.com/users/regel/events{/privacy}","received_events_url":"https://api.github.com/users/regel/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-09-01T19:40:13Z","performed_via_github_app":null},{"id":3716536601,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM3MTY1MzY2MDE=","url":"https://api.github.com/repos/regel/loudml/issues/events/3716536601","actor":{"login":"regel","id":355557,"node_id":"MDQ6VXNlcjM1NTU1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/355557?v=4","gravatar_id":"","url":"https://api.github.com/users/regel","html_url":"https://github.com/regel","followers_url":"https://api.github.com/users/regel/followers","following_url":"https://api.github.com/users/regel/following{/other_user}","gists_url":"https://api.github.com/users/regel/gists{/gist_id}","starred_url":"https://api.github.com/users/regel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/regel/subscriptions","organizations_url":"https://api.github.com/users/regel/orgs","repos_url":"https://api.github.com/users/regel/repos","events_url":"https://api.github.com/users/regel/events{/privacy}","received_events_url":"https://api.github.com/users/regel/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-09-01T19:40:13Z","performed_via_github_app":null}]