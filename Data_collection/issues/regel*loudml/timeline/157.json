[{"url":"https://api.github.com/repos/regel/loudml/issues/comments/557495604","html_url":"https://github.com/regel/loudml/issues/157#issuecomment-557495604","issue_url":"https://api.github.com/repos/regel/loudml/issues/157","id":557495604,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NzQ5NTYwNA==","user":{"login":"Xavear","id":10222810,"node_id":"MDQ6VXNlcjEwMjIyODEw","avatar_url":"https://avatars.githubusercontent.com/u/10222810?v=4","gravatar_id":"","url":"https://api.github.com/users/Xavear","html_url":"https://github.com/Xavear","followers_url":"https://api.github.com/users/Xavear/followers","following_url":"https://api.github.com/users/Xavear/following{/other_user}","gists_url":"https://api.github.com/users/Xavear/gists{/gist_id}","starred_url":"https://api.github.com/users/Xavear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Xavear/subscriptions","organizations_url":"https://api.github.com/users/Xavear/orgs","repos_url":"https://api.github.com/users/Xavear/repos","events_url":"https://api.github.com/users/Xavear/events{/privacy}","received_events_url":"https://api.github.com/users/Xavear/received_events","type":"User","site_admin":false},"created_at":"2019-11-22T11:22:36Z","updated_at":"2019-11-22T11:22:36Z","author_association":"NONE","body":"Dear AddChickpeas,\r\n\r\nI can only answer question 1 for you:\r\nAs of version 1.5.0 the timeseries type was removed. You can donut instead. (source: https://loudml.io/en/loudml/reference/current/release-notes-1.5.0.html)\r\n\r\nWith respect to question 2:\r\nI think you cannot train based on a count but maybe you can transform your data into a form where you have a column called \"Is_denied?\" with possible values 0 and 1, and train based on that? But this is purely a guess.\r\n\r\nWith kind regards,\r\nThom\r\n","reactions":{"url":"https://api.github.com/repos/regel/loudml/issues/comments/557495604/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Xavear","id":10222810,"node_id":"MDQ6VXNlcjEwMjIyODEw","avatar_url":"https://avatars.githubusercontent.com/u/10222810?v=4","gravatar_id":"","url":"https://api.github.com/users/Xavear","html_url":"https://github.com/Xavear","followers_url":"https://api.github.com/users/Xavear/followers","following_url":"https://api.github.com/users/Xavear/following{/other_user}","gists_url":"https://api.github.com/users/Xavear/gists{/gist_id}","starred_url":"https://api.github.com/users/Xavear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Xavear/subscriptions","organizations_url":"https://api.github.com/users/Xavear/orgs","repos_url":"https://api.github.com/users/Xavear/repos","events_url":"https://api.github.com/users/Xavear/events{/privacy}","received_events_url":"https://api.github.com/users/Xavear/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/regel/loudml/issues/comments/557647325","html_url":"https://github.com/regel/loudml/issues/157#issuecomment-557647325","issue_url":"https://api.github.com/repos/regel/loudml/issues/157","id":557647325,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NzY0NzMyNQ==","user":{"login":"joshkentYT","id":32724595,"node_id":"MDQ6VXNlcjMyNzI0NTk1","avatar_url":"https://avatars.githubusercontent.com/u/32724595?v=4","gravatar_id":"","url":"https://api.github.com/users/joshkentYT","html_url":"https://github.com/joshkentYT","followers_url":"https://api.github.com/users/joshkentYT/followers","following_url":"https://api.github.com/users/joshkentYT/following{/other_user}","gists_url":"https://api.github.com/users/joshkentYT/gists{/gist_id}","starred_url":"https://api.github.com/users/joshkentYT/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshkentYT/subscriptions","organizations_url":"https://api.github.com/users/joshkentYT/orgs","repos_url":"https://api.github.com/users/joshkentYT/repos","events_url":"https://api.github.com/users/joshkentYT/events{/privacy}","received_events_url":"https://api.github.com/users/joshkentYT/received_events","type":"User","site_admin":false},"created_at":"2019-11-22T18:45:40Z","updated_at":"2019-11-22T18:45:40Z","author_association":"NONE","body":"Hi Thom, \r\n\r\nThanks for the response. That's the same route I was thinking of taking on it. Another method I had been playing with was using Fluentd to count how many denies, accepts, etc per 30 seconds and output them to their own index. \r\n\r\nDo you have any insight on why the example is failing? It's just a simple average calculation on a numeric field. \r\nHere's the full error trace. The model is in the original post. \r\n```\r\nINFO:root:job[6a2bdfa7-7839-4aa2-8ca2-a0a384952fa7] starting, nice=5                                                                                                               \r\nINFO:root:train(bytes-model) range=2019-10-23T17:30:00.000Z-2019-11-22T17:31:00.000Z train_size=0.670000 batch_size=64 epochs=100)                                                                                                                                                                                                                              \r\nERROR:root:'aggregations'                                                                                                                                                                                                                 \r\nTraceback (most recent call last):                                                                                                                                                                                                        \r\nINFO:root:job[3508ed04-2cc2-4e80-9687-e978d0f3a40d starting, nice=5\r\nINFO:root:train(bytes-model) range=2019-10-23T18:38:00.000Z-2019-11-22T18:39:00.000Z train_size=0.670000 batch_size=64 epochs=100)\r\nERROR:root:'aggregations'\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3/dist-packages/loudml/worker.py\", line 57, in run\r\n    res = getattr(self, func_name)(*args, **kwargs)\r\n  File \"/usr/lib/python3/dist-packages/loudml/worker.py\", line 102, in train\r\n    **kwargs\r\n  File \"/usr/lib/python3/dist-packages/loudml/donut.py\", line 937, in train\r\n    for i, (_, val, timeval) in enumerate(data):\r\n  File \"/usr/lib/python3/dist-packages/loudml/elastic.py\", line 672, in get_times_data\r\n    for bucket in es_res['aggregations']['histogram']['buckets']:\r\nKeyError: 'aggregations'\r\n10.0.6.99 - - [2019-11-22 18:38:26 \"POST /models/bytes-model/_train?from=now-30d&to=now HTTP/1.1\" 200 147 0.004710\r\nERROR:root:job[3508ed04-2cc2-4e80-9687-e978d0f3a40d failed: 'aggregations'\r\n```","reactions":{"url":"https://api.github.com/repos/regel/loudml/issues/comments/557647325/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"joshkentYT","id":32724595,"node_id":"MDQ6VXNlcjMyNzI0NTk1","avatar_url":"https://avatars.githubusercontent.com/u/32724595?v=4","gravatar_id":"","url":"https://api.github.com/users/joshkentYT","html_url":"https://github.com/joshkentYT","followers_url":"https://api.github.com/users/joshkentYT/followers","following_url":"https://api.github.com/users/joshkentYT/following{/other_user}","gists_url":"https://api.github.com/users/joshkentYT/gists{/gist_id}","starred_url":"https://api.github.com/users/joshkentYT/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshkentYT/subscriptions","organizations_url":"https://api.github.com/users/joshkentYT/orgs","repos_url":"https://api.github.com/users/joshkentYT/repos","events_url":"https://api.github.com/users/joshkentYT/events{/privacy}","received_events_url":"https://api.github.com/users/joshkentYT/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/regel/loudml/issues/comments/557868027","html_url":"https://github.com/regel/loudml/issues/157#issuecomment-557868027","issue_url":"https://api.github.com/repos/regel/loudml/issues/157","id":557868027,"node_id":"MDEyOklzc3VlQ29tbWVudDU1Nzg2ODAyNw==","user":{"login":"regel","id":355557,"node_id":"MDQ6VXNlcjM1NTU1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/355557?v=4","gravatar_id":"","url":"https://api.github.com/users/regel","html_url":"https://github.com/regel","followers_url":"https://api.github.com/users/regel/followers","following_url":"https://api.github.com/users/regel/following{/other_user}","gists_url":"https://api.github.com/users/regel/gists{/gist_id}","starred_url":"https://api.github.com/users/regel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/regel/subscriptions","organizations_url":"https://api.github.com/users/regel/orgs","repos_url":"https://api.github.com/users/regel/repos","events_url":"https://api.github.com/users/regel/events{/privacy}","received_events_url":"https://api.github.com/users/regel/received_events","type":"User","site_admin":false},"created_at":"2019-11-24T08:29:05Z","updated_at":"2019-11-24T08:29:05Z","author_association":"OWNER","body":"Hi Josh,\r\n\r\nYou wrote:\r\n\r\n```\r\n\"features\":[\r\n{\r\n\"default\":0,\r\n\"metric\":\"avg\",\r\n\"field\":\"client.bytes\",\r\n\"name\":\"avg_bytes\"\r\n}\r\n],\r\n```\r\n\r\nAverage of bytes? Perhaps replacing `avg` by `count` is what you intended (point 2) for bytes-model.\r\n\r\nI can improve error logging. The Elasticsearch query is probably returning an exception although it is not caught nor printed here.","reactions":{"url":"https://api.github.com/repos/regel/loudml/issues/comments/557868027/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"regel","id":355557,"node_id":"MDQ6VXNlcjM1NTU1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/355557?v=4","gravatar_id":"","url":"https://api.github.com/users/regel","html_url":"https://github.com/regel","followers_url":"https://api.github.com/users/regel/followers","following_url":"https://api.github.com/users/regel/following{/other_user}","gists_url":"https://api.github.com/users/regel/gists{/gist_id}","starred_url":"https://api.github.com/users/regel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/regel/subscriptions","organizations_url":"https://api.github.com/users/regel/orgs","repos_url":"https://api.github.com/users/regel/repos","events_url":"https://api.github.com/users/regel/events{/privacy}","received_events_url":"https://api.github.com/users/regel/received_events","type":"User","site_admin":false}}]