{"url":"https://api.github.com/repos/regel/loudml/issues/173","repository_url":"https://api.github.com/repos/regel/loudml","labels_url":"https://api.github.com/repos/regel/loudml/issues/173/labels{/name}","comments_url":"https://api.github.com/repos/regel/loudml/issues/173/comments","events_url":"https://api.github.com/repos/regel/loudml/issues/173/events","html_url":"https://github.com/regel/loudml/issues/173","id":545727707,"node_id":"MDU6SXNzdWU1NDU3Mjc3MDc=","number":173,"title":"Scheduled predictions terminate with errors","user":{"login":"simplelife2010","id":22767935,"node_id":"MDQ6VXNlcjIyNzY3OTM1","avatar_url":"https://avatars.githubusercontent.com/u/22767935?v=4","gravatar_id":"","url":"https://api.github.com/users/simplelife2010","html_url":"https://github.com/simplelife2010","followers_url":"https://api.github.com/users/simplelife2010/followers","following_url":"https://api.github.com/users/simplelife2010/following{/other_user}","gists_url":"https://api.github.com/users/simplelife2010/gists{/gist_id}","starred_url":"https://api.github.com/users/simplelife2010/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/simplelife2010/subscriptions","organizations_url":"https://api.github.com/users/simplelife2010/orgs","repos_url":"https://api.github.com/users/simplelife2010/repos","events_url":"https://api.github.com/users/simplelife2010/events{/privacy}","received_events_url":"https://api.github.com/users/simplelife2010/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2020-01-06T13:30:17Z","updated_at":"2020-01-19T19:21:47Z","closed_at":"2020-01-19T19:21:46Z","author_association":"NONE","active_lock_reason":null,"body":"I started experimenting with the _start api call to get regular anomaly detections. In my setup I had 4 models running simultaneously. The scheduled jobs are visible via list-scheduled-jobs. After about 24h they stop producing output and I recieve the following error:\r\n```\r\nINFO:schedule:Running job Every 300.0 seconds do daemon_exec_scheduled_job('_eval(198-ch2-ae-mse)') (last run: 2020-01-04 19:09:25, next run: 2020-01-04 19:14:25)\r\nINFO:root:job[843596e1-f06c-4860-8453-20daa5e76d4e] starting, nice=0\r\nINFO:root:predict(198-ch2-ae-mse) range=2020-01-04T18:00:00.000Z-2020-01-04T19:00:00.000Z\r\nINFO:root:setting threshold range min=68.000000 max=99.700000\r\nINFO:root:extracting data for range=2020-01-03T19:00:00.000Z-2020-01-04T19:00:00.000Z\r\nINFO:root:connecting to influxdb on aim-influxdb-master.aim-staging.svc.cluster.local:8086, using database 'business_data_escalator'\r\nINFO:root:found 24 time periods\r\nINFO:root:generating prediction\r\nINFO:root:job[843596e1-f06c-4860-8453-20daa5e76d4e] predicted values for 1 time buckets\r\nWARNING:root:detected anomaly for model '198-ch2-ae-mse' at 2020-01-04T18:00:00.000Z (score = 100.0)\r\nINFO:root:connecting to influxdb on aim-influxdb-master.aim-staging.svc.cluster.local:8086, using database 'business_data_escalator'\r\nINFO:root:job[843596e1-f06c-4860-8453-20daa5e76d4e] done. Took 0:00:00.605445\r\n127.0.0.1 - - [2020-01-04 19:14:26] \"POST /models/198-ch2-ae-mse/_eval?from=1578161366&to=1578161666&save_output_data=True&output_bucket=frame_wise&flag_abnormal_data=True HTTP/1.1\" 200 541 0.606498\r\nINFO:schedule:Running job Every 300.0 seconds do daemon_exec_scheduled_job('_eval(198-ch2-fm1)') (last run: 2020-01-04 19:09:26, next run: 2020-01-04 19:14:26)\r\nINFO:root:job[5336c270-5e4d-4375-a928-02cfc0831082] starting, nice=0\r\nINFO:root:predict(198-ch2-fm1) range=2020-01-04T18:00:00.000Z-2020-01-04T19:00:00.000Z\r\nINFO:root:setting threshold range min=68.000000 max=99.700000\r\nINFO:root:extracting data for range=2020-01-03T19:00:00.000Z-2020-01-04T19:00:00.000Z\r\nINFO:root:connecting to influxdb on aim-influxdb-master.aim-staging.svc.cluster.local:8086, using database 'business_data_escalator'\r\nINFO:root:found 24 time periods\r\nINFO:root:generating prediction\r\nINFO:root:job[5336c270-5e4d-4375-a928-02cfc0831082] predicted values for 1 time buckets\r\nINFO:root:job[5336c270-5e4d-4375-a928-02cfc0831082] done. Took 0:00:00.602062\r\n127.0.0.1 - - [2020-01-04 19:14:28] \"POST /models/198-ch2-fm1/_eval?from=1578161367&to=1578161667&save_output_data=True&output_bucket=frame_wise&flag_abnormal_data=True HTTP/1.1\" 200 447 0.603621\r\nINFO:schedule:Running job Every 1 minute do daemon_clear_jobs() (last run: 2020-01-04 19:13:26, next run: 2020-01-04 19:14:26)\r\nINFO:schedule:Running job Every 300.0 seconds do daemon_exec_scheduled_job('_eval(882-ch1-ae-mse)') (last run: 2020-01-04 19:09:57, next run: 2020-01-04 19:14:57)\r\nINFO:root:job[891198ec-84c5-4171-bdaa-0657b1cc8d76] starting, nice=0\r\nINFO:root:predict(882-ch1-ae-mse) range=2020-01-04T18:00:00.000Z-2020-01-04T19:00:00.000Z\r\nINFO:root:setting threshold range min=68.000000 max=99.700000\r\nINFO:root:extracting data for range=2020-01-03T19:00:00.000Z-2020-01-04T19:00:00.000Z\r\nINFO:root:connecting to influxdb on aim-influxdb-master.aim-staging.svc.cluster.local:8086, using database 'business_data_escalator'\r\nINFO:root:found 24 time periods\r\nINFO:root:generating prediction\r\nINFO:root:job[891198ec-84c5-4171-bdaa-0657b1cc8d76] predicted values for 1 time buckets\r\nINFO:root:connecting to influxdb on aim-influxdb-master.aim-staging.svc.cluster.local:8086, using database 'business_data_escalator'\r\nException in thread Thread-101531:\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/loudml/vendor/urllib3/connectionpool.py\", line 421, in _make_request\r\n    six.raise_from(e, None)\r\n  File \"<string>\", line 3, in raise_from\r\n  File \"/usr/lib/loudml/vendor/urllib3/connectionpool.py\", line 416, in _make_request\r\n    httplib_response = conn.getresponse()\r\n  File \"/usr/lib/python3.5/http/client.py\", line 1198, in getresponse\r\n    response.begin()\r\n  File \"/usr/lib/python3.5/http/client.py\", line 297, in begin\r\n    version, status, reason = self._read_status()\r\n  File \"/usr/lib/python3.5/http/client.py\", line 258, in _read_status\r\n    line = str(self.fp.readline(_MAXLINE + 1), \"iso-8859-1\")\r\n  File \"/usr/lib/python3.5/socket.py\", line 576, in readinto\r\n    return self._sock.recv_into(b)\r\nsocket.timeout: timed out\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/loudml/vendor/requests/adapters.py\", line 449, in send\r\n    timeout=timeout\r\n  File \"/usr/lib/loudml/vendor/urllib3/connectionpool.py\", line 720, in urlopen\r\n    method, url, error=e, _pool=self, _stacktrace=sys.exc_info()[2]\r\n  File \"/usr/lib/loudml/vendor/urllib3/util/retry.py\", line 400, in increment\r\n    raise six.reraise(type(error), error, _stacktrace)\r\n  File \"/usr/lib/loudml/vendor/urllib3/packages/six.py\", line 735, in reraise\r\n    raise value\r\n  File \"/usr/lib/loudml/vendor/urllib3/connectionpool.py\", line 672, in urlopen\r\n    chunked=chunked,\r\n  File \"/usr/lib/loudml/vendor/urllib3/connectionpool.py\", line 423, in _make_request\r\n    self._raise_timeout(err=e, url=url, timeout_value=read_timeout)\r\n  File \"/usr/lib/loudml/vendor/urllib3/connectionpool.py\", line 331, in _raise_timeout\r\n    self, url, \"Read timed out. (read timeout=%s)\" % timeout_value\r\nurllib3.exceptions.ReadTimeoutError: HTTPConnectionPool(host='localhost', port=8077): Read timed out. (read timeout=5)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3/dist-packages/loudml/requests.py\", line 30, in perform_request\r\n    response = session.send(prepared_request, **send_kwargs)\r\n  File \"/usr/lib/loudml/vendor/requests/sessions.py\", line 646, in send\r\n    r = adapter.send(request, **kwargs)\r\n  File \"/usr/lib/loudml/vendor/requests/adapters.py\", line 529, in send\r\n    raise ReadTimeout(e, request=request)\r\nrequests.exceptions.ReadTimeout: HTTPConnectionPool(host='localhost', port=8077): Read timed out. (read timeout=5)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.5/threading.py\", line 914, in _bootstrap_inner\r\n    self.run()\r\n  File \"/usr/lib/python3.5/threading.py\", line 1180, in run\r\n    self.function(*self.args, **self.kwargs)\r\n  File \"/usr/lib/python3/dist-packages/loudml/server.py\", line 234, in callback\r\n    self.cb(*self.args, **self.kwargs)\r\n  File \"/usr/lib/python3/dist-packages/loudml/server.py\", line 416, in read_messages\r\n    schedule.run_pending()\r\n  File \"/usr/lib/loudml/vendor/schedule/__init__.py\", line 563, in run_pending\r\n    default_scheduler.run_pending()\r\n  File \"/usr/lib/loudml/vendor/schedule/__init__.py\", line 94, in run_pending\r\n    self._run_job(job)\r\n  File \"/usr/lib/loudml/vendor/schedule/__init__.py\", line 147, in _run_job\r\n    ret = job.run()\r\n  File \"/usr/lib/loudml/vendor/schedule/__init__.py\", line 466, in run\r\n    ret = self.job_func()\r\n  File \"/usr/lib/python3/dist-packages/loudml/server.py\", line 178, in daemon_exec_scheduled_job\r\n    headers=None,\r\n  File \"/usr/lib/python3/dist-packages/loudml/requests.py\", line 35, in perform_request\r\n    raise errors.ConnectionTimeout('TIMEOUT', str(e), e)\r\nTypeError: __init__() takes from 1 to 2 positional arguments but 4 were given\r\n\r\n```\r\n\r\nIt seems to me that a scheduled job tries to call the _eval function via api and gets a timeout. After that, all scheduled jobs still exist, but stopped working.\r\n\r\nAny help appreciated.\r\nBruno","closed_by":{"login":"simplelife2010","id":22767935,"node_id":"MDQ6VXNlcjIyNzY3OTM1","avatar_url":"https://avatars.githubusercontent.com/u/22767935?v=4","gravatar_id":"","url":"https://api.github.com/users/simplelife2010","html_url":"https://github.com/simplelife2010","followers_url":"https://api.github.com/users/simplelife2010/followers","following_url":"https://api.github.com/users/simplelife2010/following{/other_user}","gists_url":"https://api.github.com/users/simplelife2010/gists{/gist_id}","starred_url":"https://api.github.com/users/simplelife2010/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/simplelife2010/subscriptions","organizations_url":"https://api.github.com/users/simplelife2010/orgs","repos_url":"https://api.github.com/users/simplelife2010/repos","events_url":"https://api.github.com/users/simplelife2010/events{/privacy}","received_events_url":"https://api.github.com/users/simplelife2010/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/regel/loudml/issues/173/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/regel/loudml/issues/173/timeline","performed_via_github_app":null,"state_reason":"completed"}