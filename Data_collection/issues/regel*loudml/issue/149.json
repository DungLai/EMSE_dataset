{"url":"https://api.github.com/repos/regel/loudml/issues/149","repository_url":"https://api.github.com/repos/regel/loudml","labels_url":"https://api.github.com/repos/regel/loudml/issues/149/labels{/name}","comments_url":"https://api.github.com/repos/regel/loudml/issues/149/comments","events_url":"https://api.github.com/repos/regel/loudml/issues/149/events","html_url":"https://github.com/regel/loudml/issues/149","id":501512672,"node_id":"MDU6SXNzdWU1MDE1MTI2NzI=","number":149,"title":"'search_phase_execution_exception', 'failed to parse date field' | GRAYLOG + Elastic backend","user":{"login":"piellick","id":18485789,"node_id":"MDQ6VXNlcjE4NDg1Nzg5","avatar_url":"https://avatars.githubusercontent.com/u/18485789?v=4","gravatar_id":"","url":"https://api.github.com/users/piellick","html_url":"https://github.com/piellick","followers_url":"https://api.github.com/users/piellick/followers","following_url":"https://api.github.com/users/piellick/following{/other_user}","gists_url":"https://api.github.com/users/piellick/gists{/gist_id}","starred_url":"https://api.github.com/users/piellick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/piellick/subscriptions","organizations_url":"https://api.github.com/users/piellick/orgs","repos_url":"https://api.github.com/users/piellick/repos","events_url":"https://api.github.com/users/piellick/events{/privacy}","received_events_url":"https://api.github.com/users/piellick/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-10-02T14:07:05Z","updated_at":"2020-05-15T05:32:06Z","closed_at":"2020-05-15T05:32:06Z","author_association":"NONE","active_lock_reason":null,"body":"Hi everyone, \r\nwhen graylog is using in front of Elasticsearch for log management, a specific time format is used and training crash.\r\n\r\n**loudML version :** latest docker image\r\n{\"host_id\":\"3d919776204fddded5e557fa72242330\",\"tagline\":\"The Disruptive Machine Learning API\",\"version\":\"1.6.0-446132b4\"}\r\n\r\n**Elasticsearch version :** 6.7.1\r\n**Graylog version :** 3.0.1\r\n\r\nHere is the log output : \r\n```\r\n\r\nINFO:root:job[a198e0ec-0925-4696-9b92-bb0fa0eccc5e] starting, nice=5\r\n--\r\n  | INFO:root:train(count-model2) range=2019-10-02T13:50:00.000Z-2019-10-02T13:51:00.000Z train_size=0.670000 batch_size=64 epochs=100)\r\n  | INFO:root:connecting to elasticsearch on es-cluster-0:9200\r\n  | 10.131.4.1 - - [2019-10-02 13:50:50] \"POST /models/count-model2/_train?from=now-5s&to=now HTTP/1.1\" 202 153 0.218694\r\n  | ERROR:concurrent.futures:exception calling callback for <ProcessFuture at 0x7f584dd47898 state=finished raised TransportError>\r\n  | pebble.common.RemoteTraceback: Traceback (most recent call last):\r\n  | File \"/usr/lib/python3/dist-packages/loudml/elastic.py\", line 430, in search\r\n  | params=params,\r\n  | File \"/usr/lib/loudml/vendor/elasticsearch/client/utils.py\", line 76, in _wrapped\r\n  | return func(*args, params=params, **kwargs)\r\n  | File \"/usr/lib/loudml/vendor/elasticsearch/client/__init__.py\", line 660, in search\r\n  | doc_type, '_search'), params=params, body=body)\r\n  | File \"/usr/lib/loudml/vendor/elasticsearch/transport.py\", line 318, in perform_request\r\n  | status, headers_response, data = connection.perform_request(method, url, params, body, headers=headers, ignore=ignore, timeout=timeout)\r\n  | File \"/usr/lib/loudml/vendor/elasticsearch/connection/http_urllib3.py\", line 186, in perform_request\r\n  | self._raise_error(response.status, raw_data)\r\n  | File \"/usr/lib/loudml/vendor/elasticsearch/connection/base.py\", line 125, in _raise_error\r\n  | raise HTTP_EXCEPTIONS.get(status_code, TransportError)(status_code, error_message, additional_info)\r\n  | **elasticsearch.exceptions.RequestError: RequestError(400, 'search_phase_execution_exception', 'failed to parse date field [1570024200000] with format [yyyy-MM-dd HH:mm:ss.SSS]')**\r\n  |  \r\n  | During handling of the above exception, another exception occurred:\r\n  |  \r\n  | Traceback (most recent call last):\r\n  | File \"/usr/lib/loudml/vendor/pebble/common.py\", line 174, in process_execute\r\n  | return function(*args, **kwargs)\r\n  | File \"/usr/lib/python3/dist-packages/loudml/worker.py\", line 351, in run\r\n  | return g_worker.run(job_id, nice, func_name, *args, **kwargs)\r\n  | File \"/usr/lib/python3/dist-packages/loudml/worker.py\", line 55, in run\r\n  | raise exn\r\n  | File \"/usr/lib/python3/dist-packages/loudml/worker.py\", line 53, in run\r\n  | res = getattr(self, func_name)(*args, **kwargs)\r\n  | File \"/usr/lib/python3/dist-packages/loudml/worker.py\", line 101, in train\r\n  | **kwargs\r\n  | File \"/usr/lib/python3/dist-packages/loudml/donut.py\", line 1051, in train\r\n  | for i, (_, val, timeval) in enumerate(data):\r\n  | File \"/usr/lib/python3/dist-packages/loudml/elastic.py\", line 567, in get_times_data\r\n  | routing=None,\r\n  | File \"/usr/lib/python3/dist-packages/loudml/elastic.py\", line 433, in search\r\n  | raise errors.TransportError(str(exn))\r\n  | loudml.errors.TransportError: <unprintable TransportError object>\r\n\r\n```\r\nMapping schema on elasticsearch for Graylog's managed indices:\r\n![image](https://user-images.githubusercontent.com/18485789/66051870-e766ac00-e52f-11e9-8d58-429efba01a3d.png)\r\n\r\n\r\n","closed_by":{"login":"regel","id":355557,"node_id":"MDQ6VXNlcjM1NTU1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/355557?v=4","gravatar_id":"","url":"https://api.github.com/users/regel","html_url":"https://github.com/regel","followers_url":"https://api.github.com/users/regel/followers","following_url":"https://api.github.com/users/regel/following{/other_user}","gists_url":"https://api.github.com/users/regel/gists{/gist_id}","starred_url":"https://api.github.com/users/regel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/regel/subscriptions","organizations_url":"https://api.github.com/users/regel/orgs","repos_url":"https://api.github.com/users/regel/repos","events_url":"https://api.github.com/users/regel/events{/privacy}","received_events_url":"https://api.github.com/users/regel/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/regel/loudml/issues/149/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/regel/loudml/issues/149/timeline","performed_via_github_app":null,"state_reason":"completed"}