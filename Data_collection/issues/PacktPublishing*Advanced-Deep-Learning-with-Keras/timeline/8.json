[{"url":"https://api.github.com/repos/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/comments/633771624","html_url":"https://github.com/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/8#issuecomment-633771624","issue_url":"https://api.github.com/repos/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/8","id":633771624,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMzc3MTYyNA==","user":{"login":"roatienza","id":8848769,"node_id":"MDQ6VXNlcjg4NDg3Njk=","avatar_url":"https://avatars.githubusercontent.com/u/8848769?v=4","gravatar_id":"","url":"https://api.github.com/users/roatienza","html_url":"https://github.com/roatienza","followers_url":"https://api.github.com/users/roatienza/followers","following_url":"https://api.github.com/users/roatienza/following{/other_user}","gists_url":"https://api.github.com/users/roatienza/gists{/gist_id}","starred_url":"https://api.github.com/users/roatienza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roatienza/subscriptions","organizations_url":"https://api.github.com/users/roatienza/orgs","repos_url":"https://api.github.com/users/roatienza/repos","events_url":"https://api.github.com/users/roatienza/events{/privacy}","received_events_url":"https://api.github.com/users/roatienza/received_events","type":"User","site_admin":false},"created_at":"2020-05-26T02:10:29Z","updated_at":"2020-05-26T02:10:29Z","author_association":"COLLABORATOR","body":"Pls note that `self.n_boxes` refers to the number of bounding boxes per feature layer. In other words, if a feature layer is divided into 3x2 region, there are 6 bounding boxes. An anchor box is assigned to a bounding box as ground truth if: 1) it has max iou with that bounding box or 2) it has iou with that bounding box that is greater than a threshold (eg 0.6). Majority of these  `self.n_boxes`  bounding boxes are never assigned an anchor box (ie it is a background).","reactions":{"url":"https://api.github.com/repos/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/comments/633771624/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roatienza","id":8848769,"node_id":"MDQ6VXNlcjg4NDg3Njk=","avatar_url":"https://avatars.githubusercontent.com/u/8848769?v=4","gravatar_id":"","url":"https://api.github.com/users/roatienza","html_url":"https://github.com/roatienza","followers_url":"https://api.github.com/users/roatienza/followers","following_url":"https://api.github.com/users/roatienza/following{/other_user}","gists_url":"https://api.github.com/users/roatienza/gists{/gist_id}","starred_url":"https://api.github.com/users/roatienza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roatienza/subscriptions","organizations_url":"https://api.github.com/users/roatienza/orgs","repos_url":"https://api.github.com/users/roatienza/repos","events_url":"https://api.github.com/users/roatienza/events{/privacy}","received_events_url":"https://api.github.com/users/roatienza/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/comments/634199806","html_url":"https://github.com/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/8#issuecomment-634199806","issue_url":"https://api.github.com/repos/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/8","id":634199806,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNDE5OTgwNg==","user":{"login":"pedrogalher","id":59447712,"node_id":"MDQ6VXNlcjU5NDQ3NzEy","avatar_url":"https://avatars.githubusercontent.com/u/59447712?v=4","gravatar_id":"","url":"https://api.github.com/users/pedrogalher","html_url":"https://github.com/pedrogalher","followers_url":"https://api.github.com/users/pedrogalher/followers","following_url":"https://api.github.com/users/pedrogalher/following{/other_user}","gists_url":"https://api.github.com/users/pedrogalher/gists{/gist_id}","starred_url":"https://api.github.com/users/pedrogalher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pedrogalher/subscriptions","organizations_url":"https://api.github.com/users/pedrogalher/orgs","repos_url":"https://api.github.com/users/pedrogalher/repos","events_url":"https://api.github.com/users/pedrogalher/events{/privacy}","received_events_url":"https://api.github.com/users/pedrogalher/received_events","type":"User","site_admin":false},"created_at":"2020-05-26T18:30:20Z","updated_at":"2020-05-26T20:43:37Z","author_association":"NONE","body":"Thank you for the explanation and clarification. However i still dont get two things in `data_generator.py`:\r\n\r\n1) In the method `get_n_boxes` from `class DataGenerator`, as you mention, `self.n_boxes` is the sum of the number of bounding boxes (without taking into account the anchor boxes) for each feature layer:\r\n`self.n_boxes += np.prod(shape) // self.n_anchors`\r\n\r\nLet's say that the total number of bounding boxes accross all the feature layers is 500 for example.\r\n \r\n2 )Later on, in function `data_generation`, we create a tensor for storing class ground truth (line 130) which has dimensions `gt_class.shape = (self.args.batch_size, self.n_boxes, self.n_classes)`, i.e, `gt_class.shape = ( batch_size, 500, n_classes)`, if we consider 500 bounding boxes and 4 layers (1 for the background).\r\n\r\n3) In line 160 in  `data_generation`, we generate the anchors for each feature layer and feed it to the function `get_gt_data` to retrieve class ground truth tensor `gt_cls` for each layer. We append all the `gt_cls` across all the fature layers and get a tensor `cls` that has a shape of  `(self.n_boxes *4, n_classes)`.\r\n\r\n4) Finally, we store this `cls` in the corresponding image at `gt_class` in line 182: \r\n`gt_class[i] = cls`\r\n\r\nThis is the question: How can we assign `cls` to `gt_class` if they have different shape? Whereas `gt_class` has 500 rows, `cls` has 2000 rows (since it takes into account the anchors per feature map point.\r\n\r\nI have not run the code yet since I want to understand it before running it, and this difference in shape between gt_class and gt_cls is preventing me from advancing since I'm afraid I'm missing something important.\r\n\r\nThank you very much for your patience and help. I'm loving your book!\r\nPedro\r\n","reactions":{"url":"https://api.github.com/repos/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/comments/634199806/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pedrogalher","id":59447712,"node_id":"MDQ6VXNlcjU5NDQ3NzEy","avatar_url":"https://avatars.githubusercontent.com/u/59447712?v=4","gravatar_id":"","url":"https://api.github.com/users/pedrogalher","html_url":"https://github.com/pedrogalher","followers_url":"https://api.github.com/users/pedrogalher/followers","following_url":"https://api.github.com/users/pedrogalher/following{/other_user}","gists_url":"https://api.github.com/users/pedrogalher/gists{/gist_id}","starred_url":"https://api.github.com/users/pedrogalher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pedrogalher/subscriptions","organizations_url":"https://api.github.com/users/pedrogalher/orgs","repos_url":"https://api.github.com/users/pedrogalher/repos","events_url":"https://api.github.com/users/pedrogalher/events{/privacy}","received_events_url":"https://api.github.com/users/pedrogalher/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/comments/636442027","html_url":"https://github.com/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/8#issuecomment-636442027","issue_url":"https://api.github.com/repos/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/8","id":636442027,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNjQ0MjAyNw==","user":{"login":"roatienza","id":8848769,"node_id":"MDQ6VXNlcjg4NDg3Njk=","avatar_url":"https://avatars.githubusercontent.com/u/8848769?v=4","gravatar_id":"","url":"https://api.github.com/users/roatienza","html_url":"https://github.com/roatienza","followers_url":"https://api.github.com/users/roatienza/followers","following_url":"https://api.github.com/users/roatienza/following{/other_user}","gists_url":"https://api.github.com/users/roatienza/gists{/gist_id}","starred_url":"https://api.github.com/users/roatienza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roatienza/subscriptions","organizations_url":"https://api.github.com/users/roatienza/orgs","repos_url":"https://api.github.com/users/roatienza/repos","events_url":"https://api.github.com/users/roatienza/events{/privacy}","received_events_url":"https://api.github.com/users/roatienza/received_events","type":"User","site_admin":false},"created_at":"2020-05-31T08:53:57Z","updated_at":"2020-05-31T08:53:57Z","author_association":"COLLABORATOR","body":"tracing back my code, I believe I may have to correct myself. `self.n_boxes` is the total number of anchor boxes for all feature layers. The code for `get_n_boxes()` may be misleading which got me confused since each feature_shape is in fact feature_height x feature_width x n_anchors x 4 . 4 came from the number of offsets (there are 4 corners of a rectangle). The total number of anchor boxes per feature layer is  (feature_height x feature_width x n_anchors x 4)/4. Since the number of anchors per feature pt is also 4, the computation was correct by accident.  \r\nin the `data_generation`, the inner for loop, generates the ground truth class, offset and mask per feature layer anchors. so, when you get the total, it is equal to `self.n_boxes`.","reactions":{"url":"https://api.github.com/repos/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/comments/636442027/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roatienza","id":8848769,"node_id":"MDQ6VXNlcjg4NDg3Njk=","avatar_url":"https://avatars.githubusercontent.com/u/8848769?v=4","gravatar_id":"","url":"https://api.github.com/users/roatienza","html_url":"https://github.com/roatienza","followers_url":"https://api.github.com/users/roatienza/followers","following_url":"https://api.github.com/users/roatienza/following{/other_user}","gists_url":"https://api.github.com/users/roatienza/gists{/gist_id}","starred_url":"https://api.github.com/users/roatienza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roatienza/subscriptions","organizations_url":"https://api.github.com/users/roatienza/orgs","repos_url":"https://api.github.com/users/roatienza/repos","events_url":"https://api.github.com/users/roatienza/events{/privacy}","received_events_url":"https://api.github.com/users/roatienza/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/comments/636486897","html_url":"https://github.com/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/8#issuecomment-636486897","issue_url":"https://api.github.com/repos/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/8","id":636486897,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNjQ4Njg5Nw==","user":{"login":"pedrogalher","id":59447712,"node_id":"MDQ6VXNlcjU5NDQ3NzEy","avatar_url":"https://avatars.githubusercontent.com/u/59447712?v=4","gravatar_id":"","url":"https://api.github.com/users/pedrogalher","html_url":"https://github.com/pedrogalher","followers_url":"https://api.github.com/users/pedrogalher/followers","following_url":"https://api.github.com/users/pedrogalher/following{/other_user}","gists_url":"https://api.github.com/users/pedrogalher/gists{/gist_id}","starred_url":"https://api.github.com/users/pedrogalher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pedrogalher/subscriptions","organizations_url":"https://api.github.com/users/pedrogalher/orgs","repos_url":"https://api.github.com/users/pedrogalher/repos","events_url":"https://api.github.com/users/pedrogalher/events{/privacy}","received_events_url":"https://api.github.com/users/pedrogalher/received_events","type":"User","site_admin":false},"created_at":"2020-05-31T15:31:14Z","updated_at":"2020-05-31T15:31:14Z","author_association":"NONE","body":"Thank you very much for your answer and for solving the question. I'll close the issue now.","reactions":{"url":"https://api.github.com/repos/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/comments/636486897/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pedrogalher","id":59447712,"node_id":"MDQ6VXNlcjU5NDQ3NzEy","avatar_url":"https://avatars.githubusercontent.com/u/59447712?v=4","gravatar_id":"","url":"https://api.github.com/users/pedrogalher","html_url":"https://github.com/pedrogalher","followers_url":"https://api.github.com/users/pedrogalher/followers","following_url":"https://api.github.com/users/pedrogalher/following{/other_user}","gists_url":"https://api.github.com/users/pedrogalher/gists{/gist_id}","starred_url":"https://api.github.com/users/pedrogalher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pedrogalher/subscriptions","organizations_url":"https://api.github.com/users/pedrogalher/orgs","repos_url":"https://api.github.com/users/pedrogalher/repos","events_url":"https://api.github.com/users/pedrogalher/events{/privacy}","received_events_url":"https://api.github.com/users/pedrogalher/received_events","type":"User","site_admin":false}},{"id":3390710596,"node_id":"MDExOkNsb3NlZEV2ZW50MzM5MDcxMDU5Ng==","url":"https://api.github.com/repos/PacktPublishing/Advanced-Deep-Learning-with-Keras/issues/events/3390710596","actor":{"login":"pedrogalher","id":59447712,"node_id":"MDQ6VXNlcjU5NDQ3NzEy","avatar_url":"https://avatars.githubusercontent.com/u/59447712?v=4","gravatar_id":"","url":"https://api.github.com/users/pedrogalher","html_url":"https://github.com/pedrogalher","followers_url":"https://api.github.com/users/pedrogalher/followers","following_url":"https://api.github.com/users/pedrogalher/following{/other_user}","gists_url":"https://api.github.com/users/pedrogalher/gists{/gist_id}","starred_url":"https://api.github.com/users/pedrogalher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pedrogalher/subscriptions","organizations_url":"https://api.github.com/users/pedrogalher/orgs","repos_url":"https://api.github.com/users/pedrogalher/repos","events_url":"https://api.github.com/users/pedrogalher/events{/privacy}","received_events_url":"https://api.github.com/users/pedrogalher/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-05-31T15:31:14Z","state_reason":null,"performed_via_github_app":null}]