{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/376","repository_url":"https://api.github.com/repos/onnx/onnxmltools","labels_url":"https://api.github.com/repos/onnx/onnxmltools/issues/376/labels{/name}","comments_url":"https://api.github.com/repos/onnx/onnxmltools/issues/376/comments","events_url":"https://api.github.com/repos/onnx/onnxmltools/issues/376/events","html_url":"https://github.com/onnx/onnxmltools/issues/376","id":583539841,"node_id":"MDU6SXNzdWU1ODM1Mzk4NDE=","number":376,"title":"Can't convert Core ML model to Onnx","user":{"login":"aof-github","id":62326883,"node_id":"MDQ6VXNlcjYyMzI2ODgz","avatar_url":"https://avatars.githubusercontent.com/u/62326883?v=4","gravatar_id":"","url":"https://api.github.com/users/aof-github","html_url":"https://github.com/aof-github","followers_url":"https://api.github.com/users/aof-github/followers","following_url":"https://api.github.com/users/aof-github/following{/other_user}","gists_url":"https://api.github.com/users/aof-github/gists{/gist_id}","starred_url":"https://api.github.com/users/aof-github/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aof-github/subscriptions","organizations_url":"https://api.github.com/users/aof-github/orgs","repos_url":"https://api.github.com/users/aof-github/repos","events_url":"https://api.github.com/users/aof-github/events{/privacy}","received_events_url":"https://api.github.com/users/aof-github/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2020-03-18T07:59:47Z","updated_at":"2021-03-17T18:04:50Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Hello,\r\n\r\nI'm trying to convert a trained Core ML model (activity classification) to Onnx in order to convert it to TensorFlow Lite.\r\nThe problems is that I get errors. I've tried with different versions of python, onnxmltools, winmltools and it doesn't seems to work. I also tried docker image of onnx ecosystem with same result. Can any one help me with it? Thanks in advance.\r\n\r\n**Script**\r\n```\r\nimport coremltools\r\nimport onnxmltools\r\n\r\ninput_coreml_model = '../model.mlmodel'\r\noutput_onnx_model = '../model.onnx'\r\ncoreml_model = coremltools.utils.load_spec(input_coreml_model)\r\nonnx_model = onnxmltools.convert_coreml(coreml_model)\r\nonnxmltools.utils.save_model(onnx_model, output_onnx_model)\r\n```\r\n\r\n**Error Messages**\r\n---------------------------------------------------------------------------\r\n```\r\nIndexError                                Traceback (most recent call last)\r\n<ipython-input-11-94a6dc527869> in <module>\r\n      3 \r\n      4 # Convert the CoreML model into ONNX\r\n----> 5 onnx_model = onnxmltools.convert_coreml(coreml_model)\r\n      6 \r\n      7 # Save as protobuf\r\n\r\n/usr/local/lib/python3.6/dist-packages/onnxmltools/convert/main.py in convert_coreml(model, name, initial_types, doc_string, target_opset, targeted_onnx, custom_conversion_functions, custom_shape_calculators)\r\n     16     from .coreml.convert import convert\r\n     17     return convert(model, name, initial_types, doc_string, target_opset, targeted_onnx,\r\n---> 18                    custom_conversion_functions, custom_shape_calculators)\r\n     19 \r\n     20 \r\n\r\n/usr/local/lib/python3.6/dist-packages/onnxmltools/convert/coreml/convert.py in convert(model, name, initial_types, doc_string, target_opset, targeted_onnx, custom_conversion_functions, custom_shape_calculators)\r\n     58     target_opset = target_opset if target_opset else get_opset_number_from_onnx()\r\n     59     # Parse CoreML model as our internal data structure (i.e., Topology)\r\n---> 60     topology = parse_coreml(spec, initial_types, target_opset, custom_conversion_functions, custom_shape_calculators)\r\n     61 \r\n     62     # Parse CoreML description, author, and license. Those information will be attached to the final ONNX model.\r\n\r\n/usr/local/lib/python3.6/dist-packages/onnxmltools/convert/coreml/_parse.py in parse_coreml(model, initial_types, target_opset, custom_conversion_functions, custom_shape_calculators)\r\n    465     # Instead of using CoremlModelContainer, we directly pass the model in because _parse_model is CoreML-specific.\r\n    466     _parse_model(topology, scope, model)\r\n--> 467     topology.compile()\r\n    468 \r\n    469     for variable in topology.find_root_and_sink_variables():\r\n\r\n/usr/local/lib/python3.6/dist-packages/onnxconverter_common/topology.py in compile(self)\r\n    630         self._resolve_duplicates()\r\n    631         self._fix_shapes()\r\n--> 632         self._infer_all_types()\r\n    633         self._check_structure()\r\n    634 \r\n\r\n/usr/local/lib/python3.6/dist-packages/onnxconverter_common/topology.py in _infer_all_types(self)\r\n    506                 pass  # in Keras converter, the shape calculator can be optional.\r\n    507             else:\r\n--> 508                 operator.infer_types()\r\n    509 \r\n    510     def _resolve_duplicates(self):\r\n\r\n/usr/local/lib/python3.6/dist-packages/onnxconverter_common/topology.py in infer_types(self)\r\n    108     def infer_types(self):\r\n    109         # Invoke a core inference function\r\n--> 110         registration.get_shape_calculator(self.type)(self)\r\n    111 \r\n    112 \r\n\r\n/usr/local/lib/python3.6/dist-packages/onnxmltools/convert/coreml/shape_calculators/neural_network/Concat.py in calculate_concat_output_shapes(operator)\r\n     22         if variable.type.shape[0] != 'None' and variable.type.shape[0] != output_shape[0]:\r\n     23             raise RuntimeError('Only dimensions along C-axis can be different')\r\n---> 24         if variable.type.shape[2] != 'None' and variable.type.shape[2] != output_shape[2]:\r\n     25             raise RuntimeError('Only dimensions along C-axis can be different')\r\n     26         if variable.type.shape[3] != 'None' and variable.type.shape[3] != output_shape[3]:\r\n\r\nIndexError: list index out of range\r\n```","closed_by":null,"reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/376/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/onnxmltools/issues/376/timeline","performed_via_github_app":null,"state_reason":null}