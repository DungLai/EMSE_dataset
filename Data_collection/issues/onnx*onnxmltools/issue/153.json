{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/153","repository_url":"https://api.github.com/repos/onnx/onnxmltools","labels_url":"https://api.github.com/repos/onnx/onnxmltools/issues/153/labels{/name}","comments_url":"https://api.github.com/repos/onnx/onnxmltools/issues/153/comments","events_url":"https://api.github.com/repos/onnx/onnxmltools/issues/153/events","html_url":"https://github.com/onnx/onnxmltools/issues/153","id":371315367,"node_id":"MDU6SXNzdWUzNzEzMTUzNjc=","number":153,"title":"LightGBM multiclass convert error","user":{"login":"little-eyes","id":1495542,"node_id":"MDQ6VXNlcjE0OTU1NDI=","avatar_url":"https://avatars.githubusercontent.com/u/1495542?v=4","gravatar_id":"","url":"https://api.github.com/users/little-eyes","html_url":"https://github.com/little-eyes","followers_url":"https://api.github.com/users/little-eyes/followers","following_url":"https://api.github.com/users/little-eyes/following{/other_user}","gists_url":"https://api.github.com/users/little-eyes/gists{/gist_id}","starred_url":"https://api.github.com/users/little-eyes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/little-eyes/subscriptions","organizations_url":"https://api.github.com/users/little-eyes/orgs","repos_url":"https://api.github.com/users/little-eyes/repos","events_url":"https://api.github.com/users/little-eyes/events{/privacy}","received_events_url":"https://api.github.com/users/little-eyes/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-10-18T00:24:27Z","updated_at":"2018-10-23T18:49:01Z","closed_at":"2018-10-23T18:49:00Z","author_association":"NONE","active_lock_reason":null,"body":"I try to add a test for lightgbm, but i found multiclass classification seems to have error:\r\n\r\n```\r\n=================================== FAILURES ===================================\r\n_______ TestLGBMClassifierConverter.test_model_multiclass_classification _______\r\n\r\nself = <test_LightGBMClassifier.TestLGBMClassifierConverter testMethod=test_model_multiclass_classification>\r\n\r\n    def test_model_multiclass_classification(self):\r\n        model = self._fit_model_binary_classification(LGBMClassifier(\r\n            objective=\"ova\",\r\n            learning_rate=0.05,\r\n            boosting_type=\"gbdt\",\r\n            num_class=10))\r\n>       model_onnx = convert_sklearn(model, 'scikit-learn LGBM multiclass classifier', [('input', FloatTensorType([1, 10]))])\r\n\r\ntests/sklearn/test_LightGBMClassifier.py:47: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nonnxmltools/convert/main.py:18: in convert_sklearn\r\n    doc_string, targeted_onnx, custom_conversion_functions, custom_shape_calculators)\r\nonnxmltools/convert/sklearn/convert.py:97: in convert\r\n    onnx_model = convert_topology(topology, name, doc_string, targeted_onnx)\r\nonnxmltools/convert/common/_topology.py:704: in convert_topology\r\n    _registration.get_converter(operator.type)(scope, operator, container)\r\nonnxmltools/convert/sklearn/operator_converters/LightGbm.py:140: in convert_lightgbm\r\n    _parse_tree_structure(tree_id, class_id, learning_rate, tree['tree_structure'], attrs)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\ntree_id = 2, class_id = 2, learning_rate = 1\r\ntree_structure = {'leaf_value': -34.53877639770508}\r\nattrs = {'class_ids': [0, 0, 0, 1, 1, 1], 'class_nodeids': [3, 4, 2, 3, 4, 2], 'class_treeids': [0, 0, 0, 1, 1, 1], 'class_weights': [0.004500000000000001, 0.005, -0.005000000000000001, -0.004500000000000001, -0.005, 0.005000000000000001], ...}\r\n\r\n    def _parse_tree_structure(tree_id, class_id, learning_rate, tree_structure, attrs):\r\n        # The pool of all nodes' indexes created when parsing a single tree. Different trees may use different pools.\r\n        node_id_pool = set()\r\n    \r\n        node_id = _create_node_id(node_id_pool)\r\n        left_id = _create_node_id(node_id_pool)\r\n        right_id = _create_node_id(node_id_pool)\r\n    \r\n        attrs['nodes_treeids'].append(tree_id)\r\n        attrs['nodes_nodeids'].append(node_id)\r\n    \r\n>       attrs['nodes_featureids'].append(tree_structure['split_feature'])\r\nE       KeyError: 'split_feature'\r\n\r\nonnxmltools/convert/sklearn/operator_converters/LightGbm.py:49: KeyError\r\n\r\n```\r\nThe relevant code is here https://github.com/onnx/onnxmltools/pull/152\r\n","closed_by":{"login":"little-eyes","id":1495542,"node_id":"MDQ6VXNlcjE0OTU1NDI=","avatar_url":"https://avatars.githubusercontent.com/u/1495542?v=4","gravatar_id":"","url":"https://api.github.com/users/little-eyes","html_url":"https://github.com/little-eyes","followers_url":"https://api.github.com/users/little-eyes/followers","following_url":"https://api.github.com/users/little-eyes/following{/other_user}","gists_url":"https://api.github.com/users/little-eyes/gists{/gist_id}","starred_url":"https://api.github.com/users/little-eyes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/little-eyes/subscriptions","organizations_url":"https://api.github.com/users/little-eyes/orgs","repos_url":"https://api.github.com/users/little-eyes/repos","events_url":"https://api.github.com/users/little-eyes/events{/privacy}","received_events_url":"https://api.github.com/users/little-eyes/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/153/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/onnxmltools/issues/153/timeline","performed_via_github_app":null,"state_reason":"completed"}