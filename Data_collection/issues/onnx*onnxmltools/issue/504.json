{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/504","repository_url":"https://api.github.com/repos/onnx/onnxmltools","labels_url":"https://api.github.com/repos/onnx/onnxmltools/issues/504/labels{/name}","comments_url":"https://api.github.com/repos/onnx/onnxmltools/issues/504/comments","events_url":"https://api.github.com/repos/onnx/onnxmltools/issues/504/events","html_url":"https://github.com/onnx/onnxmltools/issues/504","id":1014387814,"node_id":"I_kwDOB0J-H848dlRm","number":504,"title":"Unsupported objective 'quantile' for LGBMRegressor ","user":{"login":"brunovilar","id":629703,"node_id":"MDQ6VXNlcjYyOTcwMw==","avatar_url":"https://avatars.githubusercontent.com/u/629703?v=4","gravatar_id":"","url":"https://api.github.com/users/brunovilar","html_url":"https://github.com/brunovilar","followers_url":"https://api.github.com/users/brunovilar/followers","following_url":"https://api.github.com/users/brunovilar/following{/other_user}","gists_url":"https://api.github.com/users/brunovilar/gists{/gist_id}","starred_url":"https://api.github.com/users/brunovilar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brunovilar/subscriptions","organizations_url":"https://api.github.com/users/brunovilar/orgs","repos_url":"https://api.github.com/users/brunovilar/repos","events_url":"https://api.github.com/users/brunovilar/events{/privacy}","received_events_url":"https://api.github.com/users/brunovilar/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-10-03T13:05:20Z","updated_at":"2021-10-04T11:41:29Z","closed_at":"2021-10-04T11:41:28Z","author_association":"NONE","active_lock_reason":null,"body":"### Issue description\r\n\r\nWhen trying to run `onnxmltools.convert_lightgbm` on a `lightgbm.sklearn.LGBMRegressor` model with `objective='poisson'`, the conversion fails with a RuntimeError.\r\n\r\n### Open PR\r\nThis is an update. O just saw [this pull request](https://github.com/onnx/onnxmltools/pull/503). By directly applying the change it works properly. I would really recommend approving and merge the PR. :) \r\n\r\n### Similar closed issue\r\n\r\nThis problem seems to be similar to [this one](https://github.com/onnx/onnxmltools/issues/462), reported by @janjagusch. I could not reproduce the workaround for the original (poisson) problem.\r\n\r\n### Reproducible example\r\n\r\n```\r\nimport numpy as np\r\nfrom lightgbm.sklearn import LGBMRegressor\r\nfrom onnxmltools import convert_lightgbm\r\nfrom skl2onnx.common.data_types import FloatTensorType\r\n\r\nexamples = 1000\r\nfeatures = 10\r\n\r\nX = np.random.randn(examples, features)\r\ny = np.round(np.random.randn(examples), 0)\r\n\r\nmodel = LGBMRegressor(objective=\"quantile\", metric=\"quantile\", alpha=0.05)\r\nmodel.fit(X, y)\r\n\r\ninitial_types = [(\"float_input\", FloatTensorType([None, features]))]\r\nonnx_model = convert_lightgbm(model, initial_types=initial_types)\r\n```\r\n\r\nResults in the following error:\r\n```\r\n---------------------------------------------------------------------------\r\nRuntimeError                              Traceback (most recent call last)\r\n/tmp/ipykernel_33543/973951346.py in <module>\r\n     14 \r\n     15 initial_types = [(\"float_input\", FloatTensorType([None, features]))]\r\n---> 16 onnx_model = convert_lightgbm(model, initial_types=initial_types)\r\n\r\n/media/bruno/dados/dev/virtual_envs/generic_env/lib/python3.9/site-packages/onnxmltools/convert/main.py in convert_lightgbm(model, name, initial_types, doc_string, target_opset, targeted_onnx, custom_conversion_functions, custom_shape_calculators, without_onnx_ml, zipmap)\r\n    134 \r\n    135     from .lightgbm.convert import convert\r\n--> 136     return convert(model, name, initial_types, doc_string, target_opset, targeted_onnx,\r\n    137                    custom_conversion_functions, custom_shape_calculators, without_onnx_ml,\r\n    138                    zipmap=zipmap)\r\n\r\n/media/bruno/dados/dev/virtual_envs/generic_env/lib/python3.9/site-packages/onnxmltools/convert/lightgbm/convert.py in convert(model, name, initial_types, doc_string, target_opset, targeted_onnx, custom_conversion_functions, custom_shape_calculators, without_onnx_ml, zipmap)\r\n     54                               custom_shape_calculators, zipmap=zipmap)\r\n     55     topology.compile()\r\n---> 56     onnx_ml_model = convert_topology(topology, name, doc_string, target_opset, targeted_onnx)\r\n     57 \r\n     58     if without_onnx_ml:\r\n\r\n/media/bruno/dados/dev/virtual_envs/generic_env/lib/python3.9/site-packages/onnxconverter_common/topology.py in convert_topology(topology, model_name, doc_string, target_opset, targeted_onnx, channel_first_inputs)\r\n    774         else:\r\n    775             # Convert the selected operator into some ONNX objects and save them into the container\r\n--> 776             get_converter(operator.type)(scope, operator, container)\r\n    777 \r\n    778     # When calling ModelComponentContainer's add_initializer(...), nothing is added into the input list.\r\n\r\n/media/bruno/dados/dev/virtual_envs/generic_env/lib/python3.9/site-packages/onnxmltools/convert/lightgbm/operator_converters/LightGbm.py in convert_lightgbm(scope, operator, container)\r\n    398         post_transform = \"Exp\"\r\n    399     else:\r\n--> 400         raise RuntimeError(\r\n    401             \"LightGBM objective should be cleaned already not '{}'.\".format(\r\n    402                 gbm_text['objective']))\r\n\r\nRuntimeError: LightGBM objective should be cleaned already not 'quantile'.\r\n```\r\n\r\n### Versions\r\n```\r\nnumpy==1.21.1\r\nlightgbm==3.2.1\r\nonnxmltools==1.9.1\r\nskl2onnx==1.10.0\r\n```\r\n\r\n","closed_by":{"login":"brunovilar","id":629703,"node_id":"MDQ6VXNlcjYyOTcwMw==","avatar_url":"https://avatars.githubusercontent.com/u/629703?v=4","gravatar_id":"","url":"https://api.github.com/users/brunovilar","html_url":"https://github.com/brunovilar","followers_url":"https://api.github.com/users/brunovilar/followers","following_url":"https://api.github.com/users/brunovilar/following{/other_user}","gists_url":"https://api.github.com/users/brunovilar/gists{/gist_id}","starred_url":"https://api.github.com/users/brunovilar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brunovilar/subscriptions","organizations_url":"https://api.github.com/users/brunovilar/orgs","repos_url":"https://api.github.com/users/brunovilar/repos","events_url":"https://api.github.com/users/brunovilar/events{/privacy}","received_events_url":"https://api.github.com/users/brunovilar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/504/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/onnxmltools/issues/504/timeline","performed_via_github_app":null,"state_reason":"completed"}