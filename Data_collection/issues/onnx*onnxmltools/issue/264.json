{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/264","repository_url":"https://api.github.com/repos/onnx/onnxmltools","labels_url":"https://api.github.com/repos/onnx/onnxmltools/issues/264/labels{/name}","comments_url":"https://api.github.com/repos/onnx/onnxmltools/issues/264/comments","events_url":"https://api.github.com/repos/onnx/onnxmltools/issues/264/events","html_url":"https://github.com/onnx/onnxmltools/issues/264","id":421255411,"node_id":"MDU6SXNzdWU0MjEyNTU0MTE=","number":264,"title":"Error converting model from keras using tensorflow-gpu backend","user":{"login":"arielbernal","id":8987082,"node_id":"MDQ6VXNlcjg5ODcwODI=","avatar_url":"https://avatars.githubusercontent.com/u/8987082?v=4","gravatar_id":"","url":"https://api.github.com/users/arielbernal","html_url":"https://github.com/arielbernal","followers_url":"https://api.github.com/users/arielbernal/followers","following_url":"https://api.github.com/users/arielbernal/following{/other_user}","gists_url":"https://api.github.com/users/arielbernal/gists{/gist_id}","starred_url":"https://api.github.com/users/arielbernal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arielbernal/subscriptions","organizations_url":"https://api.github.com/users/arielbernal/orgs","repos_url":"https://api.github.com/users/arielbernal/repos","events_url":"https://api.github.com/users/arielbernal/events{/privacy}","received_events_url":"https://api.github.com/users/arielbernal/received_events","type":"User","site_admin":false},"labels":[{"id":839509663,"node_id":"MDU6TGFiZWw4Mzk1MDk2NjM=","url":"https://api.github.com/repos/onnx/onnxmltools/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-03-14T21:35:48Z","updated_at":"2019-03-19T17:08:41Z","closed_at":"2019-03-19T17:08:41Z","author_association":"NONE","active_lock_reason":null,"body":"$pip list\r\nonnx 1.4.1\r\nonnxmltools 1.3.2\r\ntensorflow 1.13.1\r\ntensorflow-gpu 1.13.1\r\n\r\n$conda list\r\nkeras 2.2.4\r\n\r\n``` python\r\nimport onnxmltools\r\nfrom keras.layers import Input, Dense, Add\r\nfrom keras.models import Model\r\n\r\n# N: batch size, C: sub-model input dimension, D: final model's input dimension\r\nN, C, D = 2, 3, 3\r\n\r\n# Define a sub-model, it will become a part of our final model\r\nsub_input1 = Input(shape=(C,))\r\nsub_mapped1 = Dense(D)(sub_input1)\r\nsub_model1 = Model(inputs=sub_input1, outputs=sub_mapped1)\r\n\r\n# Define another sub-model, it will become a part of our final model\r\nsub_input2 = Input(shape=(C,))\r\nsub_mapped2 = Dense(D)(sub_input2)\r\nsub_model2 = Model(inputs=sub_input2, outputs=sub_mapped2)\r\n\r\n# Define a model built upon the previous two sub-models\r\ninput1 = Input(shape=(D,))\r\ninput2 = Input(shape=(D,))\r\nmapped1_2 = sub_model1(input1)\r\nmapped2_2 = sub_model2(input2)\r\nsub_sum = Add()([mapped1_2, mapped2_2])\r\nkeras_model = Model(inputs=[input1, input2], output=sub_sum)\r\n\r\n# Convert it! The target_opset parameter is optional.\r\nonnx_model = onnxmltools.convert_keras(keras_model, target_opset=7) \r\n```\r\n\r\nError:\r\n\r\n```\r\nC:\\Users\\intel\\Anaconda3\\envs\\denoiser\\lib\\site-packages\\ipykernel_launcher.py:24: UserWarning: Update your `Model` call to the Keras 2 API: `Model(inputs=[<tf.Tenso..., outputs=Tensor(\"ad...)`\r\n---------------------------------------------------------------------------\r\nAttributeError                            Traceback (most recent call last)\r\n<ipython-input-7-13c32f7fd452> in <module>\r\n     25 \r\n     26 # Convert it! The target_opset parameter is optional.\r\n---> 27 onnx_model = onnxmltools.convert_keras(keras_model, target_opset=7)\r\n\r\n~\\AppData\\Roaming\\Python\\Python36\\site-packages\\onnxmltools\\convert\\main.py in convert_keras(model, name, initial_types, doc_string, target_opset, targeted_onnx, channel_first_inputs, custom_conversion_functions, custom_shape_calculators, default_batch_size)\r\n     30 \r\n     31     from keras2onnx import convert_keras as convert\r\n---> 32     return convert(model, name, doc_string, target_opset, channel_first_inputs)\r\n     33 \r\n     34 \r\n\r\n~\\AppData\\Roaming\\Python\\Python36\\site-packages\\keras2onnx\\main.py in convert_keras(model, name, doc_string, target_opset, channel_first_inputs, debug_mode, custom_op_conversions)\r\n     92     tf_graph_def = tf.graph_util.convert_variables_to_constants(sess, sess.graph_def, output_node_names=out_node)\r\n     93     return _convert_tf(name, tf_graph_def, op_dict, output_names, target_opset, doc_string, channel_first_inputs,\r\n---> 94                        debug_mode, custom_op_conversions)\r\n     95 \r\n     96 \r\n\r\n~\\AppData\\Roaming\\Python\\Python36\\site-packages\\keras2onnx\\main.py in _convert_tf(name, tf_graph_def, keras_op_table, output_names, target_opset, doc_string, channel_first_inputs, debug_mode, custom_op_conversions)\r\n     64         topology.compile()\r\n     65 \r\n---> 66         return convert_topology(topology, name, doc_string, target_opset, channel_first_inputs)\r\n     67 \r\n     68 \r\n\r\n~\\AppData\\Roaming\\Python\\Python36\\site-packages\\keras2onnx\\topology.py in convert_topology(topology, model_name, doc_string, target_opset, channel_first_inputs)\r\n    232         scope = next(scope for scope in topology.scopes if scope.name == operator.scope)\r\n    233         keras2onnx_logger().debug(\"Converting the operator (%s): %s\" % (operator.full_name, operator.type))\r\n--> 234         get_converter(operator.type)(scope, operator, container)\r\n    235 \r\n    236     # When calling ModelComponentContainer's add_initializer(...), nothing is added into the input list. However, in\r\n\r\n~\\AppData\\Roaming\\Python\\Python36\\site-packages\\keras2onnx\\wrapper.py in tfnode_convert(varset, operator, container)\r\n     51     # create input_tensor_values, initializers\r\n     52     # if initilizer is not used as input by any node, then it will be ignored\r\n---> 53     initializers = [i for i in list(g.initializers.values()) if i.name in all_inputs]\r\n     54     for init_tensor_ in initializers:\r\n     55         init_tensor_.name = varset.get_local_variable_or_declare_one(init_tensor_.name).full_name.encode('utf-8')\r\n\r\nAttributeError: 'Graph' object has no attribute 'initializers'\r\n```","closed_by":{"login":"arielbernal","id":8987082,"node_id":"MDQ6VXNlcjg5ODcwODI=","avatar_url":"https://avatars.githubusercontent.com/u/8987082?v=4","gravatar_id":"","url":"https://api.github.com/users/arielbernal","html_url":"https://github.com/arielbernal","followers_url":"https://api.github.com/users/arielbernal/followers","following_url":"https://api.github.com/users/arielbernal/following{/other_user}","gists_url":"https://api.github.com/users/arielbernal/gists{/gist_id}","starred_url":"https://api.github.com/users/arielbernal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arielbernal/subscriptions","organizations_url":"https://api.github.com/users/arielbernal/orgs","repos_url":"https://api.github.com/users/arielbernal/repos","events_url":"https://api.github.com/users/arielbernal/events{/privacy}","received_events_url":"https://api.github.com/users/arielbernal/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/264/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/onnxmltools/issues/264/timeline","performed_via_github_app":null,"state_reason":"completed"}