{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/462","repository_url":"https://api.github.com/repos/onnx/onnxmltools","labels_url":"https://api.github.com/repos/onnx/onnxmltools/issues/462/labels{/name}","comments_url":"https://api.github.com/repos/onnx/onnxmltools/issues/462/comments","events_url":"https://api.github.com/repos/onnx/onnxmltools/issues/462/events","html_url":"https://github.com/onnx/onnxmltools/issues/462","id":883593811,"node_id":"MDU6SXNzdWU4ODM1OTM4MTE=","number":462,"title":"Unsupported objective 'poission' for LGBMRegressor ","user":{"login":"janjagusch","id":25852654,"node_id":"MDQ6VXNlcjI1ODUyNjU0","avatar_url":"https://avatars.githubusercontent.com/u/25852654?v=4","gravatar_id":"","url":"https://api.github.com/users/janjagusch","html_url":"https://github.com/janjagusch","followers_url":"https://api.github.com/users/janjagusch/followers","following_url":"https://api.github.com/users/janjagusch/following{/other_user}","gists_url":"https://api.github.com/users/janjagusch/gists{/gist_id}","starred_url":"https://api.github.com/users/janjagusch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janjagusch/subscriptions","organizations_url":"https://api.github.com/users/janjagusch/orgs","repos_url":"https://api.github.com/users/janjagusch/repos","events_url":"https://api.github.com/users/janjagusch/events{/privacy}","received_events_url":"https://api.github.com/users/janjagusch/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2021-05-10T07:28:31Z","updated_at":"2021-05-20T16:37:13Z","closed_at":"2021-05-20T16:37:13Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### Issue description\r\n\r\nWhen trying to run `onnxmltools.convert_lightgbm` on a `lightgbm.sklearn.LGBMRegressor` model with `objective='poisson'`, the conversion fails with a `RuntimeError`.\r\n\r\n### First diagnosis\r\n\r\nThe only supported objective are ['binary', 'multiclass' and 'regression'](https://github.com/onnx/onnxmltools/blob/master/onnxmltools/convert/lightgbm/operator_converters/LightGbm.py#L223-L238).\r\n\r\n### Possible solution\r\n\r\nImplement the 'poisson' objective similarly to the 'regression' objective (same `n_classes`, different `post_tranform`). The`post_transform` should be `f(y)=e^y` (I don't know if such a post transform function already exists). I'd like to give this a try, if that's okay for you.\r\n\r\n### Reproducible example\r\n\r\n```py\r\nimport numpy as np\r\nfrom lightgbm.sklearn import LGBMRegressor\r\nfrom onnxmltools import convert_lightgbm\r\nfrom skl2onnx.common.data_types import FloatTensorType\r\n\r\nN_ROWS = 1000\r\nN_COLS = 4\r\n\r\nX = np.random.randn(N_ROWS, N_COLS)\r\n# For 'poisson' objective, all target values need to be non-negative\r\ny = abs(np.random.randn(N_ROWS))\r\n\r\nestimator = LGBMRegressor(objective=\"poisson\")\r\nestimator.fit(X, y)\r\n\r\ninitial_types = [(\"float_input\", FloatTensorType([None, N_COLS]))]\r\nconvert_lightgbm(model=estimator, name=\"Poisson Estimator\", initial_types=initial_types)\r\n```\r\n\r\nResults in the following error:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Users/janjagusch/Projects/risk-modelling-pipeline-sandbox/notebooks/example-upstream.py\", line 33, in <module>\r\n    convert_lightgbm(model=estimator, name=\"Poisson Estimator\", initial_types=initial_types)\r\n  File \"/usr/local/Caskroom/miniforge/base/envs/risk-modelling-pipeline-sandbox/lib/python3.9/site-packages/onnxmltools/convert/main.py\", line 60, in convert_lightgbm\r\n    return convert(model, name, initial_types, doc_string, target_opset, targeted_onnx,\r\n  File \"/usr/local/Caskroom/miniforge/base/envs/risk-modelling-pipeline-sandbox/lib/python3.9/site-packages/onnxmltools/convert/lightgbm/convert.py\", line 55, in convert\r\n    onnx_ml_model = convert_topology(topology, name, doc_string, target_opset, targeted_onnx)\r\n  File \"/usr/local/Caskroom/miniforge/base/envs/risk-modelling-pipeline-sandbox/lib/python3.9/site-packages/onnxconverter_common/topology.py\", line 776, in convert_topology\r\n    get_converter(operator.type)(scope, operator, container)\r\n  File \"/usr/local/Caskroom/miniforge/base/envs/risk-modelling-pipeline-sandbox/lib/python3.9/site-packages/onnxmltools/convert/lightgbm/operator_converters/LightGbm.py\", line 235, in convert_lightgbm\r\n    raise RuntimeError(\r\nRuntimeError: LightGBM objective should be cleaned already not 'poisson'.\r\n```\r\n\r\n#### Versions\r\n\r\n```\r\nnumpy                     1.20.2\r\nlightgbm                  3.2.1\r\nonnxmltools               1.8.0\r\nskl2onnx                  1.8.0.1\r\n```","closed_by":{"login":"wenbingl","id":10278425,"node_id":"MDQ6VXNlcjEwMjc4NDI1","avatar_url":"https://avatars.githubusercontent.com/u/10278425?v=4","gravatar_id":"","url":"https://api.github.com/users/wenbingl","html_url":"https://github.com/wenbingl","followers_url":"https://api.github.com/users/wenbingl/followers","following_url":"https://api.github.com/users/wenbingl/following{/other_user}","gists_url":"https://api.github.com/users/wenbingl/gists{/gist_id}","starred_url":"https://api.github.com/users/wenbingl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wenbingl/subscriptions","organizations_url":"https://api.github.com/users/wenbingl/orgs","repos_url":"https://api.github.com/users/wenbingl/repos","events_url":"https://api.github.com/users/wenbingl/events{/privacy}","received_events_url":"https://api.github.com/users/wenbingl/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/462/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/onnxmltools/issues/462/timeline","performed_via_github_app":null,"state_reason":"completed"}