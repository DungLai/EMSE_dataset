{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/378","repository_url":"https://api.github.com/repos/onnx/onnxmltools","labels_url":"https://api.github.com/repos/onnx/onnxmltools/issues/378/labels{/name}","comments_url":"https://api.github.com/repos/onnx/onnxmltools/issues/378/comments","events_url":"https://api.github.com/repos/onnx/onnxmltools/issues/378/events","html_url":"https://github.com/onnx/onnxmltools/issues/378","id":586856917,"node_id":"MDU6SXNzdWU1ODY4NTY5MTc=","number":378,"title":"Unsupported shape calculation for operator textClassifier, CoreML -> ONNX","user":{"login":"Siberi0","id":62592121,"node_id":"MDQ6VXNlcjYyNTkyMTIx","avatar_url":"https://avatars.githubusercontent.com/u/62592121?v=4","gravatar_id":"","url":"https://api.github.com/users/Siberi0","html_url":"https://github.com/Siberi0","followers_url":"https://api.github.com/users/Siberi0/followers","following_url":"https://api.github.com/users/Siberi0/following{/other_user}","gists_url":"https://api.github.com/users/Siberi0/gists{/gist_id}","starred_url":"https://api.github.com/users/Siberi0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Siberi0/subscriptions","organizations_url":"https://api.github.com/users/Siberi0/orgs","repos_url":"https://api.github.com/users/Siberi0/repos","events_url":"https://api.github.com/users/Siberi0/events{/privacy}","received_events_url":"https://api.github.com/users/Siberi0/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-03-24T10:33:27Z","updated_at":"2023-01-13T15:13:53Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Hi all\r\nI am totally new in Machine Learning. I have started to work on a project in which I've been asked to add some ML features. The first and most simple task I've completed is Text Recognition and Classification. I have followed a tutorial linked below, ran and tested the app with success.\r\nNow I have applied the little knowledge I've gained to our project. The feature is the same, the only difference are the articles used to train the model. Again, all ran smooth with iOS.\r\nA colleague needs to do the same on Android. Since I have already trained a model, we decided to try and use the same model for Android. So here I am, trying to convert a .mlmodel to something Android compatible (should be tensor flow light) using onnxmltools.\r\nSince I am a newbie in ML and python, please excuse me if I say something wrong\r\n\r\n## Problem description\r\nAs title states, Unsupported shape calculation for operator textClassifier error is printed on console when trying to convert a .mlmodel to .onnx\r\n\r\n## Trace\r\nTraceback (most recent call last):\r\n  File \"convertML.py\", line 14, in <module>\r\n    onnx_model = onnxmltools.convert_coreml(coreml_model)\r\n  File \"/usr/local/lib/python3.7/site-packages/onnxmltools/convert/main.py\", line 20, in convert_coreml\r\n    custom_conversion_functions, custom_shape_calculators)\r\n  File \"/usr/local/lib/python3.7/site-packages/onnxmltools/convert/coreml/convert.py\", line 60, in convert\r\n    topology = parse_coreml(spec, initial_types, target_opset, custom_conversion_functions, custom_shape_calculators)\r\n  File \"/usr/local/lib/python3.7/site-packages/onnxmltools/convert/coreml/_parse.py\", line 467, in parse_coreml\r\n    topology.compile()\r\n  File \"/usr/local/lib/python3.7/site-packages/onnxconverter_common/topology.py\", line 680, in compile\r\n    self._infer_all_types()\r\n  File \"/usr/local/lib/python3.7/site-packages/onnxconverter_common/topology.py\", line 556, in _infer_all_types\r\n    operator.infer_types()\r\n  File \"/usr/local/lib/python3.7/site-packages/onnxconverter_common/topology.py\", line 108, in infer_types\r\n    registration.get_shape_calculator(self.type)(self)\r\n  File \"/usr/local/lib/python3.7/site-packages/onnxconverter_common/registration.py\", line 67, in get_shape_calculator\r\n    raise ValueError('Unsupported shape calculation for operator %s' % operator_name)\r\nValueError: Unsupported shape calculation for operator textClassifier\r\n\r\n## To Reproduce\r\n```\r\n`import onnxmltools\r\nimport coremltools\r\n\r\n# Update the input name and path for your CoreML model\r\ninput_coreml_model = 'NewsClassifier.mlmodel'\r\n\r\n# Change this path to the output name and path for the ONNX model\r\noutput_onnx_model = 'NewsClassifier.onnx'\r\n\r\n# Load your CoreML model\r\ncoreml_model = coremltools.utils.load_spec(input_coreml_model)\r\n\r\n# Convert the CoreML model into ONNX\r\nonnx_model = onnxmltools.convert_coreml(coreml_model)\r\n\r\n# Save as protobuf\r\nonnxmltools.utils.save_model(onnx_model, output_onnx_model)\r\n```\r\n\r\n[NewsClassifier.mlmodel.zip](https://github.com/onnx/onnx-coreml/files/4374345/NewsClassifier.mlmodel.zip)\r\n\r\nI have attached CoreML model, the one created following this tutorial\r\nhttps://heartbeat.fritz.ai/text-classification-on-ios-using-create-ml-f71d7191404a\r\n\r\n## System environment:\r\n - coremltools version: 3.3\r\n - onnxmltools version: 1.6.5\r\n - OS: MacOS\r\n - macOS version: 10.15.3\r\n - python installed through system\r\n - python version: 3.7.7\r\n\r\n## Additional context\r\nAgain, I am a new comer in ML so please excuse me for my lack of knowledge on the subject\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/378/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/onnxmltools/issues/378/timeline","performed_via_github_app":null,"state_reason":null}