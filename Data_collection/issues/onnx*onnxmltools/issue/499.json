{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/499","repository_url":"https://api.github.com/repos/onnx/onnxmltools","labels_url":"https://api.github.com/repos/onnx/onnxmltools/issues/499/labels{/name}","comments_url":"https://api.github.com/repos/onnx/onnxmltools/issues/499/comments","events_url":"https://api.github.com/repos/onnx/onnxmltools/issues/499/events","html_url":"https://github.com/onnx/onnxmltools/issues/499","id":1000077420,"node_id":"I_kwDOB0J-H847m_hs","number":499,"title":"Error converting deserialized xgboost Booster","user":{"login":"ide-an","id":1685297,"node_id":"MDQ6VXNlcjE2ODUyOTc=","avatar_url":"https://avatars.githubusercontent.com/u/1685297?v=4","gravatar_id":"","url":"https://api.github.com/users/ide-an","html_url":"https://github.com/ide-an","followers_url":"https://api.github.com/users/ide-an/followers","following_url":"https://api.github.com/users/ide-an/following{/other_user}","gists_url":"https://api.github.com/users/ide-an/gists{/gist_id}","starred_url":"https://api.github.com/users/ide-an/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ide-an/subscriptions","organizations_url":"https://api.github.com/users/ide-an/orgs","repos_url":"https://api.github.com/users/ide-an/repos","events_url":"https://api.github.com/users/ide-an/events{/privacy}","received_events_url":"https://api.github.com/users/ide-an/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-09-18T16:34:28Z","updated_at":"2022-02-01T10:16:50Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Hello.\r\n\r\nI am trying to convert existing xgboost model file (which is created by `xgboost.Booster.save_model`) to onnx. While doing that I am getting the following error:\r\n\r\n`AttributeError: 'Booster' object has no attribute 'best_ntree_limit'`\r\n\r\nmy environment\r\n * OS: Windows 10 Home\r\n * xgboost==1.4.2\r\n * onnxmltools==1.9.1\r\n * onnx==1.10.1\r\n\r\n\r\nreproduction code:\r\n```python\r\nfrom sklearn.datasets import load_iris\r\nfrom sklearn.model_selection import train_test_split\r\nfrom xgboost import DMatrix, Booster, train as train_xgb\r\nfrom onnxconverter_common.data_types import FloatTensorType\r\nfrom onnxmltools.convert import convert_xgboost\r\n\r\n# Train\r\niris = load_iris()\r\nX, y = iris.data, iris.target\r\nX_train, X_test, y_train, y_test = train_test_split(X, y)\r\ndtrain = DMatrix(X_train, label=y_train)\r\nparam = {'objective': 'multi:softmax', 'num_class': 3}\r\nbst_original = train_xgb(param, dtrain, 10)\r\ninitial_type = [('float_input', FloatTensorType([None, 4]))]\r\n\r\n# Converting original Booster is OK.\r\nonx = convert_xgboost(bst_original, initial_types=initial_type)\r\n\r\n# Save and load model\r\nbst_original.save_model('model.json')\r\nbst_loaded = Booster()\r\nbst_loaded.load_model('model.json')\r\n\r\n# !!! Converting loaded Booster fails !!!\r\nonx_loaded = convert_xgboost(bst_loaded, initial_types=initial_type)\r\n```\r\n\r\nstack trace:\r\n```\r\n[01:32:25] WARNING: C:/Users/Administrator/workspace/xgboost-win64_release_1.4.0/src/learner.cc:1095: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective 'multi:softmax' was changed from 'merror' to 'mlogloss'. Explicitly set eval_metric if you'd like to restore the old behavior.\r\nTraceback (most recent call last):\r\n  File \"conv.py\", line 25, in <module>\r\n    onx_loaded = convert_xgboost(bst_loaded, initial_types=initial_type)\r\n  File \"C:\\Users\\macke\\repos\\onnx_sample\\env\\lib\\site-packages\\onnxmltools\\convert\\main.py\", line 176, in convert_xgboost\r\n    return convert(*args, **kwargs)\r\n  File \"C:\\Users\\macke\\repos\\onnx_sample\\env\\lib\\site-packages\\onnxmltools\\convert\\xgboost\\convert.py\", line 39, in convert\r\n    model = WrappedBooster(model)\r\n  File \"C:\\Users\\macke\\repos\\onnx_sample\\env\\lib\\site-packages\\onnxmltools\\convert\\xgboost\\_parse.py\", line 85, in __init__\r\n    self.kwargs = _get_attributes(booster)\r\n  File \"C:\\Users\\macke\\repos\\onnx_sample\\env\\lib\\site-packages\\onnxmltools\\convert\\xgboost\\_parse.py\", line 31, in _get_attributes\r\n    ntrees = booster.best_ntree_limit\r\nAttributeError: 'Booster' object has no attribute 'best_ntree_limit'\r\n```\r\n\r\n\r\nAccording to https://github.com/dmlc/xgboost/issues/805 loaded Booster doesn't have `best_ntree_limit`, it may cause this error.\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/499/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/onnxmltools/issues/499/timeline","performed_via_github_app":null,"state_reason":null}