{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/601","repository_url":"https://api.github.com/repos/onnx/onnxmltools","labels_url":"https://api.github.com/repos/onnx/onnxmltools/issues/601/labels{/name}","comments_url":"https://api.github.com/repos/onnx/onnxmltools/issues/601/comments","events_url":"https://api.github.com/repos/onnx/onnxmltools/issues/601/events","html_url":"https://github.com/onnx/onnxmltools/issues/601","id":1518640667,"node_id":"I_kwDOB0J-H85ahJ4b","number":601,"title":"convert_xgboost - AssertionError: Missing required property \"tree_info\".","user":{"login":"ShuningL","id":121935509,"node_id":"U_kgDOB0SWlQ","avatar_url":"https://avatars.githubusercontent.com/u/121935509?v=4","gravatar_id":"","url":"https://api.github.com/users/ShuningL","html_url":"https://github.com/ShuningL","followers_url":"https://api.github.com/users/ShuningL/followers","following_url":"https://api.github.com/users/ShuningL/following{/other_user}","gists_url":"https://api.github.com/users/ShuningL/gists{/gist_id}","starred_url":"https://api.github.com/users/ShuningL/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ShuningL/subscriptions","organizations_url":"https://api.github.com/users/ShuningL/orgs","repos_url":"https://api.github.com/users/ShuningL/repos","events_url":"https://api.github.com/users/ShuningL/events{/privacy}","received_events_url":"https://api.github.com/users/ShuningL/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-01-04T09:37:25Z","updated_at":"2023-01-04T09:37:25Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"I was trying to run the sample code of convert_xgboost(onnxmltools/docs/examples/plot_convert_xgboost.py), and I got an error [\"AssertionError: Missing required property \"tree_info\".] which is only for Dmatrix ( for sklearn model, it's ok).\r\nLooking forward to your responses.\r\n# ------------------------- The Output is as follow ----------------------------\r\nXGBClassifier(base_score=0.5, booster='gbtree', colsample_bylevel=1,\r\n              colsample_bynode=1, colsample_bytree=1, gamma=0, gpu_id=-1,\r\n              importance_type='gain', interaction_constraints='',\r\n              learning_rate=0.300000012, max_delta_step=0, max_depth=6,\r\n              min_child_weight=1, missing=nan, monotone_constraints='()',\r\n              n_estimators=100, n_jobs=0, num_parallel_tree=1,\r\n              objective='multi:softprob', random_state=0, reg_alpha=0,\r\n              reg_lambda=1, scale_pos_weight=None, subsample=1,\r\n              tree_method='exact', validate_parameters=1, verbosity=None)\r\n[1 2 2 0 2 0 0 1 0 1 1 2 2 1 2 2 2 2 2 2 0 1 2 0 2 1 1 0 2 2 2 1 2 0 0 2 2\r\n 2]\r\n---------------------------------------------------------------------------\r\nAssertionError                            Traceback (most recent call last)\r\nInput In [10], in <cell line: 71>()\r\n     68 bst = train_xgb(param, dtrain, 10)\r\n     70 initial_type = [('float_input', FloatTensorType([None, 4]))]\r\n---> 71 onx = convert_xgboost(bst, initial_types=initial_type)\r\n     73 sess = rt.InferenceSession(onx.SerializeToString())\r\n     74 input_name = sess.get_inputs()[0].name\r\n\r\nFile ~/miniconda3/envs/mlflow/lib/python3.8/site-packages/onnxmltools/convert/main.py:177, in convert_xgboost(*args, **kwargs)\r\n    174     raise RuntimeError('xgboost is not installed. Please install xgboost to use this feature.')\r\n    176 from .xgboost.convert import convert\r\n--> 177 return convert(*args, **kwargs)\r\n\r\nFile ~/miniconda3/envs/mlflow/lib/python3.8/site-packages/onnxmltools/convert/xgboost/convert.py:39, in convert(model, name, initial_types, doc_string, target_opset, targeted_onnx, custom_conversion_functions, custom_shape_calculators)\r\n     36     name = str(uuid4().hex)\r\n     38 if isinstance(model, xgboost.Booster):\r\n---> 39     model = WrappedBooster(model)\r\n     40 target_opset = target_opset if target_opset else get_maximum_opset_supported()\r\n     41 topology = parse_xgboost(model, initial_types, target_opset, custom_conversion_functions, custom_shape_calculators)\r\n\r\nFile ~/miniconda3/envs/mlflow/lib/python3.8/site-packages/onnxmltools/convert/xgboost/_parse.py:85, in WrappedBooster.__init__(self, booster)\r\n     83 def __init__(self, booster):\r\n     84     self.booster_ = booster\r\n---> 85     self.kwargs = _get_attributes(booster)\r\n     87     if self.kwargs['num_class'] > 0:\r\n     88         self.classes_ = self._generate_classes(self.kwargs)\r\n\r\nFile ~/miniconda3/envs/mlflow/lib/python3.8/site-packages/onnxmltools/convert/xgboost/_parse.py:35, in _get_attributes(booster)\r\n     33 reg = re.compile(b'(\"tree_info\":\\\\[[0-9,]*\\\\])')\r\n     34 objs = list(set(reg.findall(bstate)))\r\n---> 35 assert len(objs) == 1, 'Missing required property \"tree_info\".'\r\n     36 tree_info = json.loads(\"{{{}}}\".format(objs[0].decode('ascii')))['tree_info']\r\n     37 num_class = len(set(tree_info))\r\n\r\nAssertionError: Missing required property \"tree_info\".\r\n# ---------------------------------------------------------------\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/601/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/onnxmltools/issues/601/timeline","performed_via_github_app":null,"state_reason":null}