[{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/512084609","html_url":"https://github.com/onnx/onnxmltools/issues/323#issuecomment-512084609","issue_url":"https://api.github.com/repos/onnx/onnxmltools/issues/323","id":512084609,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjA4NDYwOQ==","user":{"login":"jiafatom","id":30608893,"node_id":"MDQ6VXNlcjMwNjA4ODkz","avatar_url":"https://avatars.githubusercontent.com/u/30608893?v=4","gravatar_id":"","url":"https://api.github.com/users/jiafatom","html_url":"https://github.com/jiafatom","followers_url":"https://api.github.com/users/jiafatom/followers","following_url":"https://api.github.com/users/jiafatom/following{/other_user}","gists_url":"https://api.github.com/users/jiafatom/gists{/gist_id}","starred_url":"https://api.github.com/users/jiafatom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiafatom/subscriptions","organizations_url":"https://api.github.com/users/jiafatom/orgs","repos_url":"https://api.github.com/users/jiafatom/repos","events_url":"https://api.github.com/users/jiafatom/events{/privacy}","received_events_url":"https://api.github.com/users/jiafatom/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T03:13:37Z","updated_at":"2019-07-17T03:13:37Z","author_association":"COLLABORATOR","body":"Can you try target opset=10? also you can try keras converter directly [here](https://github.com/onnx/keras-onnx) using opset=10. If it does not work, please share the model.","reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/512084609/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jiafatom","id":30608893,"node_id":"MDQ6VXNlcjMwNjA4ODkz","avatar_url":"https://avatars.githubusercontent.com/u/30608893?v=4","gravatar_id":"","url":"https://api.github.com/users/jiafatom","html_url":"https://github.com/jiafatom","followers_url":"https://api.github.com/users/jiafatom/followers","following_url":"https://api.github.com/users/jiafatom/following{/other_user}","gists_url":"https://api.github.com/users/jiafatom/gists{/gist_id}","starred_url":"https://api.github.com/users/jiafatom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiafatom/subscriptions","organizations_url":"https://api.github.com/users/jiafatom/orgs","repos_url":"https://api.github.com/users/jiafatom/repos","events_url":"https://api.github.com/users/jiafatom/events{/privacy}","received_events_url":"https://api.github.com/users/jiafatom/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/512087137","html_url":"https://github.com/onnx/onnxmltools/issues/323#issuecomment-512087137","issue_url":"https://api.github.com/repos/onnx/onnxmltools/issues/323","id":512087137,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjA4NzEzNw==","user":{"login":"CristXu","id":49855018,"node_id":"MDQ6VXNlcjQ5ODU1MDE4","avatar_url":"https://avatars.githubusercontent.com/u/49855018?v=4","gravatar_id":"","url":"https://api.github.com/users/CristXu","html_url":"https://github.com/CristXu","followers_url":"https://api.github.com/users/CristXu/followers","following_url":"https://api.github.com/users/CristXu/following{/other_user}","gists_url":"https://api.github.com/users/CristXu/gists{/gist_id}","starred_url":"https://api.github.com/users/CristXu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CristXu/subscriptions","organizations_url":"https://api.github.com/users/CristXu/orgs","repos_url":"https://api.github.com/users/CristXu/repos","events_url":"https://api.github.com/users/CristXu/events{/privacy}","received_events_url":"https://api.github.com/users/CristXu/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T03:27:09Z","updated_at":"2019-07-17T03:27:09Z","author_association":"NONE","body":"Hi，\r\n       Thanks for your response, because the onnxmltools used to convert the keras model, it will normalize the value in the batchnorm layer: mean, scale, var, bias; but it is the same as the before one and will take no effect on the converted model.\r\n       By the way, the raw-data is params[0], params[1], params[2], params[3]; and the value after is gamma, beta, 0, 1\r\n[cid:image001.png@01D53C92.8A1B62C0]\r\n\r\nRegards，\r\n       Crist\r\n\r\nFrom: David Fan <notifications@github.com>\r\nSent: 2019年7月17日 11:14\r\nTo: onnx/onnxmltools <onnxmltools@noreply.github.com>\r\nCc: Crist Xu <crist.xu@nxp.com>; Author <author@noreply.github.com>\r\nSubject: [EXT] Re: [onnx/onnxmltools] keras->onnx, the batchnorm value loss (#323)\r\n\r\n\r\nCaution: EXT Email\r\n\r\nCan you try target opset=10? also you can try keras converter directly here<https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fonnx%2Fkeras-onnx&data=02%7C01%7Ccrist.xu%40nxp.com%7C67be7dd594644dbcd23208d70a64c4ce%7C686ea1d3bc2b4c6fa92cd99c5c301635%7C0%7C0%7C636989300229307716&sdata=cereBKYy0p9LPe%2Fs%2Bad4Hl6bk%2BLtEhDeEp2Xg6EWAFw%3D&reserved=0> using opset=10. If it does not work, please share the model.\r\n\r\n—\r\nYou are receiving this because you authored the thread.\r\nReply to this email directly, view it on GitHub<https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fonnx%2Fonnxmltools%2Fissues%2F323%3Femail_source%3Dnotifications%26email_token%3DAL4LUKVHZJUPA5ECLJYB4CLP72E6HA5CNFSM4IDST2FKYY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGOD2C4VAI%23issuecomment-512084609&data=02%7C01%7Ccrist.xu%40nxp.com%7C67be7dd594644dbcd23208d70a64c4ce%7C686ea1d3bc2b4c6fa92cd99c5c301635%7C0%7C0%7C636989300229307716&sdata=hFeVqTSOWmupkHraCaOdZx6pfZRFtgGr%2BDdcvWlucPY%3D&reserved=0>, or mute the thread<https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fnotifications%2Funsubscribe-auth%2FAL4LUKUGFETIHIVYFTSAUHDP72E6HANCNFSM4IDST2FA&data=02%7C01%7Ccrist.xu%40nxp.com%7C67be7dd594644dbcd23208d70a64c4ce%7C686ea1d3bc2b4c6fa92cd99c5c301635%7C0%7C0%7C636989300229317707&sdata=38ddqgs4eQaw49Vkntsct4AXBztQ1Gurdmam5ZqrLOE%3D&reserved=0>.\r\n","reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/512087137/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"CristXu","id":49855018,"node_id":"MDQ6VXNlcjQ5ODU1MDE4","avatar_url":"https://avatars.githubusercontent.com/u/49855018?v=4","gravatar_id":"","url":"https://api.github.com/users/CristXu","html_url":"https://github.com/CristXu","followers_url":"https://api.github.com/users/CristXu/followers","following_url":"https://api.github.com/users/CristXu/following{/other_user}","gists_url":"https://api.github.com/users/CristXu/gists{/gist_id}","starred_url":"https://api.github.com/users/CristXu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CristXu/subscriptions","organizations_url":"https://api.github.com/users/CristXu/orgs","repos_url":"https://api.github.com/users/CristXu/repos","events_url":"https://api.github.com/users/CristXu/events{/privacy}","received_events_url":"https://api.github.com/users/CristXu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/512094286","html_url":"https://github.com/onnx/onnxmltools/issues/323#issuecomment-512094286","issue_url":"https://api.github.com/repos/onnx/onnxmltools/issues/323","id":512094286,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjA5NDI4Ng==","user":{"login":"jiafatom","id":30608893,"node_id":"MDQ6VXNlcjMwNjA4ODkz","avatar_url":"https://avatars.githubusercontent.com/u/30608893?v=4","gravatar_id":"","url":"https://api.github.com/users/jiafatom","html_url":"https://github.com/jiafatom","followers_url":"https://api.github.com/users/jiafatom/followers","following_url":"https://api.github.com/users/jiafatom/following{/other_user}","gists_url":"https://api.github.com/users/jiafatom/gists{/gist_id}","starred_url":"https://api.github.com/users/jiafatom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiafatom/subscriptions","organizations_url":"https://api.github.com/users/jiafatom/orgs","repos_url":"https://api.github.com/users/jiafatom/repos","events_url":"https://api.github.com/users/jiafatom/events{/privacy}","received_events_url":"https://api.github.com/users/jiafatom/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T04:10:58Z","updated_at":"2019-07-17T04:10:58Z","author_association":"COLLABORATOR","body":"sorry I don't understand your reply. Does your conversion work using opset 10? onnxmltools will call [keras2onnx](https://github.com/onnx/keras-onnx), so can you try it directly? If it does not work, please share the model file.","reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/512094286/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jiafatom","id":30608893,"node_id":"MDQ6VXNlcjMwNjA4ODkz","avatar_url":"https://avatars.githubusercontent.com/u/30608893?v=4","gravatar_id":"","url":"https://api.github.com/users/jiafatom","html_url":"https://github.com/jiafatom","followers_url":"https://api.github.com/users/jiafatom/followers","following_url":"https://api.github.com/users/jiafatom/following{/other_user}","gists_url":"https://api.github.com/users/jiafatom/gists{/gist_id}","starred_url":"https://api.github.com/users/jiafatom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiafatom/subscriptions","organizations_url":"https://api.github.com/users/jiafatom/orgs","repos_url":"https://api.github.com/users/jiafatom/repos","events_url":"https://api.github.com/users/jiafatom/events{/privacy}","received_events_url":"https://api.github.com/users/jiafatom/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/512113702","html_url":"https://github.com/onnx/onnxmltools/issues/323#issuecomment-512113702","issue_url":"https://api.github.com/repos/onnx/onnxmltools/issues/323","id":512113702,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjExMzcwMg==","user":{"login":"CristXu","id":49855018,"node_id":"MDQ6VXNlcjQ5ODU1MDE4","avatar_url":"https://avatars.githubusercontent.com/u/49855018?v=4","gravatar_id":"","url":"https://api.github.com/users/CristXu","html_url":"https://github.com/CristXu","followers_url":"https://api.github.com/users/CristXu/followers","following_url":"https://api.github.com/users/CristXu/following{/other_user}","gists_url":"https://api.github.com/users/CristXu/gists{/gist_id}","starred_url":"https://api.github.com/users/CristXu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CristXu/subscriptions","organizations_url":"https://api.github.com/users/CristXu/orgs","repos_url":"https://api.github.com/users/CristXu/repos","events_url":"https://api.github.com/users/CristXu/events{/privacy}","received_events_url":"https://api.github.com/users/CristXu/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T05:55:38Z","updated_at":"2019-07-17T05:55:38Z","author_association":"NONE","body":"I mean that even though the value in the batchnorm layer of the onnx-model is not the same as the one in keras-model ( I convert the keras-model into the onnx-model with the onnxmodel ), because the convert-tool normalize the value in the batchnorm, make std to 1, and mean to 0, so I think if the convert-tool have some bugs with the keras-model before, but now, I figure out that the value is equal between the onnx-model & keras-model.\r\nBy the way, the convert tool has no bugs. It can works well.\r\nAbout the normalize, you can find the detail in the keras2onnx/batch_norm.py , line 45.\r\n\r\nFrom: David Fan <notifications@github.com>\r\nSent: 2019年7月17日 12:11\r\nTo: onnx/onnxmltools <onnxmltools@noreply.github.com>\r\nCc: Crist Xu <crist.xu@nxp.com>; Author <author@noreply.github.com>\r\nSubject: [EXT] Re: [onnx/onnxmltools] keras->onnx, the batchnorm value loss (#323)\r\n\r\n\r\nCaution: EXT Email\r\n\r\nsorry I don't understand your reply. Does your conversion work using opset 10? onnxmltools will call keras2onnx<https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fonnx%2Fkeras-onnx&data=02%7C01%7Ccrist.xu%40nxp.com%7C3cc36bce304048631c6c08d70a6cc7ae%7C686ea1d3bc2b4c6fa92cd99c5c301635%7C0%7C0%7C636989334637800039&sdata=J4A0qc5hujFt6vCVS46pPcb4wQ%2BXjNCLAgJggMXZAvU%3D&reserved=0>, so can you try it directly? If it does not work, please share the model file.\r\n\r\n—\r\nYou are receiving this because you authored the thread.\r\nReply to this email directly, view it on GitHub<https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fonnx%2Fonnxmltools%2Fissues%2F323%3Femail_source%3Dnotifications%26email_token%3DAL4LUKRDWCFPJD63E6W7QD3P72LVJA5CNFSM4IDST2FKYY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGOD2C7ATQ%23issuecomment-512094286&data=02%7C01%7Ccrist.xu%40nxp.com%7C3cc36bce304048631c6c08d70a6cc7ae%7C686ea1d3bc2b4c6fa92cd99c5c301635%7C0%7C0%7C636989334637810023&sdata=6J1sWGNovH8ck8c3kMmOARgilu%2FUDTwMb0kfZN8DE3g%3D&reserved=0>, or mute the thread<https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fnotifications%2Funsubscribe-auth%2FAL4LUKTY2AWZPQ2YULOB7TLP72LVJANCNFSM4IDST2FA&data=02%7C01%7Ccrist.xu%40nxp.com%7C3cc36bce304048631c6c08d70a6cc7ae%7C686ea1d3bc2b4c6fa92cd99c5c301635%7C0%7C0%7C636989334637810023&sdata=L4hSgW%2BABBzRU9kf12AJjC9dtfEoEyVGlervAxRb0zU%3D&reserved=0>.\r\n","reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/512113702/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"CristXu","id":49855018,"node_id":"MDQ6VXNlcjQ5ODU1MDE4","avatar_url":"https://avatars.githubusercontent.com/u/49855018?v=4","gravatar_id":"","url":"https://api.github.com/users/CristXu","html_url":"https://github.com/CristXu","followers_url":"https://api.github.com/users/CristXu/followers","following_url":"https://api.github.com/users/CristXu/following{/other_user}","gists_url":"https://api.github.com/users/CristXu/gists{/gist_id}","starred_url":"https://api.github.com/users/CristXu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CristXu/subscriptions","organizations_url":"https://api.github.com/users/CristXu/orgs","repos_url":"https://api.github.com/users/CristXu/repos","events_url":"https://api.github.com/users/CristXu/events{/privacy}","received_events_url":"https://api.github.com/users/CristXu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/512562042","html_url":"https://github.com/onnx/onnxmltools/issues/323#issuecomment-512562042","issue_url":"https://api.github.com/repos/onnx/onnxmltools/issues/323","id":512562042,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjU2MjA0Mg==","user":{"login":"jiafatom","id":30608893,"node_id":"MDQ6VXNlcjMwNjA4ODkz","avatar_url":"https://avatars.githubusercontent.com/u/30608893?v=4","gravatar_id":"","url":"https://api.github.com/users/jiafatom","html_url":"https://github.com/jiafatom","followers_url":"https://api.github.com/users/jiafatom/followers","following_url":"https://api.github.com/users/jiafatom/following{/other_user}","gists_url":"https://api.github.com/users/jiafatom/gists{/gist_id}","starred_url":"https://api.github.com/users/jiafatom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiafatom/subscriptions","organizations_url":"https://api.github.com/users/jiafatom/orgs","repos_url":"https://api.github.com/users/jiafatom/repos","events_url":"https://api.github.com/users/jiafatom/events{/privacy}","received_events_url":"https://api.github.com/users/jiafatom/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T20:46:31Z","updated_at":"2019-07-17T20:46:31Z","author_association":"COLLABORATOR","body":"Good to know that the model conversion works well. We do some transform on the value part because keras and onnx spec is different, so it is normal to see the value difference.","reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/512562042/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jiafatom","id":30608893,"node_id":"MDQ6VXNlcjMwNjA4ODkz","avatar_url":"https://avatars.githubusercontent.com/u/30608893?v=4","gravatar_id":"","url":"https://api.github.com/users/jiafatom","html_url":"https://github.com/jiafatom","followers_url":"https://api.github.com/users/jiafatom/followers","following_url":"https://api.github.com/users/jiafatom/following{/other_user}","gists_url":"https://api.github.com/users/jiafatom/gists{/gist_id}","starred_url":"https://api.github.com/users/jiafatom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiafatom/subscriptions","organizations_url":"https://api.github.com/users/jiafatom/orgs","repos_url":"https://api.github.com/users/jiafatom/repos","events_url":"https://api.github.com/users/jiafatom/events{/privacy}","received_events_url":"https://api.github.com/users/jiafatom/received_events","type":"User","site_admin":false}},{"id":2490821165,"node_id":"MDExOkNsb3NlZEV2ZW50MjQ5MDgyMTE2NQ==","url":"https://api.github.com/repos/onnx/onnxmltools/issues/events/2490821165","actor":{"login":"jiafatom","id":30608893,"node_id":"MDQ6VXNlcjMwNjA4ODkz","avatar_url":"https://avatars.githubusercontent.com/u/30608893?v=4","gravatar_id":"","url":"https://api.github.com/users/jiafatom","html_url":"https://github.com/jiafatom","followers_url":"https://api.github.com/users/jiafatom/followers","following_url":"https://api.github.com/users/jiafatom/following{/other_user}","gists_url":"https://api.github.com/users/jiafatom/gists{/gist_id}","starred_url":"https://api.github.com/users/jiafatom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiafatom/subscriptions","organizations_url":"https://api.github.com/users/jiafatom/orgs","repos_url":"https://api.github.com/users/jiafatom/repos","events_url":"https://api.github.com/users/jiafatom/events{/privacy}","received_events_url":"https://api.github.com/users/jiafatom/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-07-17T20:46:31Z","state_reason":null,"performed_via_github_app":null}]