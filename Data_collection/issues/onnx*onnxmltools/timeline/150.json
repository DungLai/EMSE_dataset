[{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/430807723","html_url":"https://github.com/onnx/onnxmltools/issues/150#issuecomment-430807723","issue_url":"https://api.github.com/repos/onnx/onnxmltools/issues/150","id":430807723,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMDgwNzcyMw==","user":{"login":"NonaryR","id":8309465,"node_id":"MDQ6VXNlcjgzMDk0NjU=","avatar_url":"https://avatars.githubusercontent.com/u/8309465?v=4","gravatar_id":"","url":"https://api.github.com/users/NonaryR","html_url":"https://github.com/NonaryR","followers_url":"https://api.github.com/users/NonaryR/followers","following_url":"https://api.github.com/users/NonaryR/following{/other_user}","gists_url":"https://api.github.com/users/NonaryR/gists{/gist_id}","starred_url":"https://api.github.com/users/NonaryR/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NonaryR/subscriptions","organizations_url":"https://api.github.com/users/NonaryR/orgs","repos_url":"https://api.github.com/users/NonaryR/repos","events_url":"https://api.github.com/users/NonaryR/events{/privacy}","received_events_url":"https://api.github.com/users/NonaryR/received_events","type":"User","site_admin":false},"created_at":"2018-10-17T22:11:38Z","updated_at":"2018-10-17T22:11:38Z","author_association":"NONE","body":"@xadupre can you add more information about this issue? \r\nAlso - about [this comment](https://github.com/onnx/onnxmltools/blob/master/onnxmltools/convert/sklearn/convert.py#L61)\r\nOnly 1-24 or all of this modules is currently supported? \r\n`Pipeline + LightGBM` - that's what I'm interested for this ","reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/430807723/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"NonaryR","id":8309465,"node_id":"MDQ6VXNlcjgzMDk0NjU=","avatar_url":"https://avatars.githubusercontent.com/u/8309465?v=4","gravatar_id":"","url":"https://api.github.com/users/NonaryR","html_url":"https://github.com/NonaryR","followers_url":"https://api.github.com/users/NonaryR/followers","following_url":"https://api.github.com/users/NonaryR/following{/other_user}","gists_url":"https://api.github.com/users/NonaryR/gists{/gist_id}","starred_url":"https://api.github.com/users/NonaryR/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NonaryR/subscriptions","organizations_url":"https://api.github.com/users/NonaryR/orgs","repos_url":"https://api.github.com/users/NonaryR/repos","events_url":"https://api.github.com/users/NonaryR/events{/privacy}","received_events_url":"https://api.github.com/users/NonaryR/received_events","type":"User","site_admin":false}},{"id":1910818995,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTkxMDgxODk5NQ==","url":"https://api.github.com/repos/onnx/onnxmltools/issues/events/1910818995","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-10-17T22:11:39Z","performed_via_github_app":null},{"id":1910818996,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE5MTA4MTg5OTY=","url":"https://api.github.com/repos/onnx/onnxmltools/issues/events/1910818996","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-10-17T22:11:39Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/430815794","html_url":"https://github.com/onnx/onnxmltools/issues/150#issuecomment-430815794","issue_url":"https://api.github.com/repos/onnx/onnxmltools/issues/150","id":430815794,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMDgxNTc5NA==","user":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"created_at":"2018-10-17T22:47:30Z","updated_at":"2018-10-17T22:47:30Z","author_association":"COLLABORATOR","body":"I'm currently testing every converted model with onnxruntime in this PR: https://github.com/onnx/onnxmltools/pull/144. The test about LightGBM is now generating model, onnx pickle, inputs, expected outputs. It is used by a final test checking that onnxruntime produces the same results.","reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/430815794/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/432370668","html_url":"https://github.com/onnx/onnxmltools/issues/150#issuecomment-432370668","issue_url":"https://api.github.com/repos/onnx/onnxmltools/issues/150","id":432370668,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMjM3MDY2OA==","user":{"login":"little-eyes","id":1495542,"node_id":"MDQ6VXNlcjE0OTU1NDI=","avatar_url":"https://avatars.githubusercontent.com/u/1495542?v=4","gravatar_id":"","url":"https://api.github.com/users/little-eyes","html_url":"https://github.com/little-eyes","followers_url":"https://api.github.com/users/little-eyes/followers","following_url":"https://api.github.com/users/little-eyes/following{/other_user}","gists_url":"https://api.github.com/users/little-eyes/gists{/gist_id}","starred_url":"https://api.github.com/users/little-eyes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/little-eyes/subscriptions","organizations_url":"https://api.github.com/users/little-eyes/orgs","repos_url":"https://api.github.com/users/little-eyes/repos","events_url":"https://api.github.com/users/little-eyes/events{/privacy}","received_events_url":"https://api.github.com/users/little-eyes/received_events","type":"User","site_admin":false},"created_at":"2018-10-23T18:42:50Z","updated_at":"2018-10-23T18:42:50Z","author_association":"NONE","body":"I encountered the same problem, the prediction probability is way too different, comparing to the original LightGBM mode. The dataset is the digits dataset from scikit-learn.\r\n\r\nHere is my simple python code:\r\n\r\n```python\r\nimport onnxmltools\r\n\r\nfrom onnxmltools.convert.common.data_types import FloatTensorType\r\n\r\nfrom lightgbm import LGBMClassifier\r\n\r\nfrom sklearn.datasets import load_digits\r\n\r\nfrom sklearn.model_selection import train_test_split\r\n\r\n \r\n\r\ndigits = load_digits()\r\n\r\nX_train, X_test, y_train, y_test = train_test_split(\r\n\r\n    digits.data,\r\n\r\n    digits.target,\r\n\r\n    test_size=0.2,\r\n\r\n    random_state=42,\r\n\r\n    stratify=digits.target)\r\n\r\n \r\n\r\ngbm = LGBMClassifier(\r\n\r\n    objective='ova',\r\n\r\n    n_estimator=10,\r\n\r\n    num_class=10,\r\n\r\n    min_child_samples=1,\r\n\r\n    boosting_type='gbdt')\r\n\r\ngbm.fit(X_train, y_train)\r\n\r\n \r\n\r\n# save booster\r\n\r\ngbm.booster_.save_model('sample.txt', gbm.booster_.best_iteration)\r\n\r\n \r\n\r\n# save onnx\r\n\r\nonnx_model = onnxmltools.convert_sklearn(\r\n\r\n    gbm,\r\n\r\n    name='sample gbm',\r\n\r\n    initial_types=[('input', FloatTensorType([1, X_train.shape[0]]))])\r\n\r\n \r\n\r\nonnxmltools.utils.save_model(onnx_model, 'sample.onnx')\r\n\r\n \r\n\r\n# predict using model.txt\r\n\r\nfrom lightgbm import Booster\r\n\r\nimport pandas as pd\r\n\r\n \r\n\r\nbooster = Booster(model_file='sample.txt')\r\n\r\npredict_booster = booster.predict(X_test)\r\n\r\npd.DataFrame(predict_booster)\r\n\r\n \r\n\r\n# predict using onnx\r\n\r\nimport onnx\r\n\r\nimport onnxruntime as rt\r\n\r\nimport pandas as pd\r\n\r\nimport numpy\r\n\r\n \r\n\r\nsession = rt.InferenceSession(\"sample.onnx\")\r\n\r\n \r\n\r\ninput_name = session.get_inputs()[0].name\r\n\r\nlabel_name = session.get_outputs()[0].name\r\n\r\nprob_name = session.get_outputs()[1].name\r\n\r\n \r\n\r\npredict = []\r\n\r\nfor row in X_test:\r\n\r\n    feature_vector = row.astype('float32')\r\n\r\n    inferred = session.run([prob_name], { input_name: feature_vector })[0]\r\n\r\n    predict.append(inferred[0])\r\n\r\npd.DataFrame(predict)\r\n```","reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/432370668/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"little-eyes","id":1495542,"node_id":"MDQ6VXNlcjE0OTU1NDI=","avatar_url":"https://avatars.githubusercontent.com/u/1495542?v=4","gravatar_id":"","url":"https://api.github.com/users/little-eyes","html_url":"https://github.com/little-eyes","followers_url":"https://api.github.com/users/little-eyes/followers","following_url":"https://api.github.com/users/little-eyes/following{/other_user}","gists_url":"https://api.github.com/users/little-eyes/gists{/gist_id}","starred_url":"https://api.github.com/users/little-eyes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/little-eyes/subscriptions","organizations_url":"https://api.github.com/users/little-eyes/orgs","repos_url":"https://api.github.com/users/little-eyes/repos","events_url":"https://api.github.com/users/little-eyes/events{/privacy}","received_events_url":"https://api.github.com/users/little-eyes/received_events","type":"User","site_admin":false}},{"id":1936252055,"node_id":"MDExOkNsb3NlZEV2ZW50MTkzNjI1MjA1NQ==","url":"https://api.github.com/repos/onnx/onnxmltools/issues/events/1936252055","actor":{"login":"wenbingl","id":10278425,"node_id":"MDQ6VXNlcjEwMjc4NDI1","avatar_url":"https://avatars.githubusercontent.com/u/10278425?v=4","gravatar_id":"","url":"https://api.github.com/users/wenbingl","html_url":"https://github.com/wenbingl","followers_url":"https://api.github.com/users/wenbingl/followers","following_url":"https://api.github.com/users/wenbingl/following{/other_user}","gists_url":"https://api.github.com/users/wenbingl/gists{/gist_id}","starred_url":"https://api.github.com/users/wenbingl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wenbingl/subscriptions","organizations_url":"https://api.github.com/users/wenbingl/orgs","repos_url":"https://api.github.com/users/wenbingl/repos","events_url":"https://api.github.com/users/wenbingl/events{/privacy}","received_events_url":"https://api.github.com/users/wenbingl/received_events","type":"User","site_admin":false},"event":"closed","commit_id":"d66b74bad7ba76336888d8ece7fb1842f1e452a0","commit_url":"https://api.github.com/repos/onnx/onnxmltools/commits/d66b74bad7ba76336888d8ece7fb1842f1e452a0","created_at":"2018-10-30T20:44:15Z","state_reason":null,"performed_via_github_app":null},{"id":1966741590,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDE5NjY3NDE1OTA=","url":"https://api.github.com/repos/onnx/onnxmltools/issues/events/1966741590","actor":{"login":"wenbingl","id":10278425,"node_id":"MDQ6VXNlcjEwMjc4NDI1","avatar_url":"https://avatars.githubusercontent.com/u/10278425?v=4","gravatar_id":"","url":"https://api.github.com/users/wenbingl","html_url":"https://github.com/wenbingl","followers_url":"https://api.github.com/users/wenbingl/followers","following_url":"https://api.github.com/users/wenbingl/following{/other_user}","gists_url":"https://api.github.com/users/wenbingl/gists{/gist_id}","starred_url":"https://api.github.com/users/wenbingl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wenbingl/subscriptions","organizations_url":"https://api.github.com/users/wenbingl/orgs","repos_url":"https://api.github.com/users/wenbingl/repos","events_url":"https://api.github.com/users/wenbingl/events{/privacy}","received_events_url":"https://api.github.com/users/wenbingl/received_events","type":"User","site_admin":false},"event":"referenced","commit_id":"96585ba5028ef22b2a86e2f2389c6d086297d704","commit_url":"https://api.github.com/repos/wenbingl/onnxmltools/commits/96585ba5028ef22b2a86e2f2389c6d086297d704","created_at":"2018-11-14T19:02:39Z","performed_via_github_app":null}]