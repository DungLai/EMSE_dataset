[{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/428256099","html_url":"https://github.com/onnx/onnxmltools/issues/26#issuecomment-428256099","issue_url":"https://api.github.com/repos/onnx/onnxmltools/issues/26","id":428256099,"node_id":"MDEyOklzc3VlQ29tbWVudDQyODI1NjA5OQ==","user":{"login":"another-pjohnson","id":24667483,"node_id":"MDQ6VXNlcjI0NjY3NDgz","avatar_url":"https://avatars.githubusercontent.com/u/24667483?v=4","gravatar_id":"","url":"https://api.github.com/users/another-pjohnson","html_url":"https://github.com/another-pjohnson","followers_url":"https://api.github.com/users/another-pjohnson/followers","following_url":"https://api.github.com/users/another-pjohnson/following{/other_user}","gists_url":"https://api.github.com/users/another-pjohnson/gists{/gist_id}","starred_url":"https://api.github.com/users/another-pjohnson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/another-pjohnson/subscriptions","organizations_url":"https://api.github.com/users/another-pjohnson/orgs","repos_url":"https://api.github.com/users/another-pjohnson/repos","events_url":"https://api.github.com/users/another-pjohnson/events{/privacy}","received_events_url":"https://api.github.com/users/another-pjohnson/received_events","type":"User","site_admin":false},"created_at":"2018-10-09T16:17:08Z","updated_at":"2018-10-09T16:17:08Z","author_association":"NONE","body":"If you are just trying to change the batch size, I've created a PR #146 that lets you do just that. Using the initial_types didn't really work for me because the output shape wasn't being changed and when i tried to do infer_shapes on the model, it would blow up.","reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/428256099/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"another-pjohnson","id":24667483,"node_id":"MDQ6VXNlcjI0NjY3NDgz","avatar_url":"https://avatars.githubusercontent.com/u/24667483?v=4","gravatar_id":"","url":"https://api.github.com/users/another-pjohnson","html_url":"https://github.com/another-pjohnson","followers_url":"https://api.github.com/users/another-pjohnson/followers","following_url":"https://api.github.com/users/another-pjohnson/following{/other_user}","gists_url":"https://api.github.com/users/another-pjohnson/gists{/gist_id}","starred_url":"https://api.github.com/users/another-pjohnson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/another-pjohnson/subscriptions","organizations_url":"https://api.github.com/users/another-pjohnson/orgs","repos_url":"https://api.github.com/users/another-pjohnson/repos","events_url":"https://api.github.com/users/another-pjohnson/events{/privacy}","received_events_url":"https://api.github.com/users/another-pjohnson/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/428260565","html_url":"https://github.com/onnx/onnxmltools/issues/26#issuecomment-428260565","issue_url":"https://api.github.com/repos/onnx/onnxmltools/issues/26","id":428260565,"node_id":"MDEyOklzc3VlQ29tbWVudDQyODI2MDU2NQ==","user":{"login":"wschin","id":3524474,"node_id":"MDQ6VXNlcjM1MjQ0NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/3524474?v=4","gravatar_id":"","url":"https://api.github.com/users/wschin","html_url":"https://github.com/wschin","followers_url":"https://api.github.com/users/wschin/followers","following_url":"https://api.github.com/users/wschin/following{/other_user}","gists_url":"https://api.github.com/users/wschin/gists{/gist_id}","starred_url":"https://api.github.com/users/wschin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wschin/subscriptions","organizations_url":"https://api.github.com/users/wschin/orgs","repos_url":"https://api.github.com/users/wschin/repos","events_url":"https://api.github.com/users/wschin/events{/privacy}","received_events_url":"https://api.github.com/users/wschin/received_events","type":"User","site_admin":false},"created_at":"2018-10-09T16:30:10Z","updated_at":"2018-10-09T16:30:23Z","author_association":"CONTRIBUTOR","body":"One problem of having `default_batch_size` is that we need to define what is a `batch` dimension. Although many frameworks assume that the first axis is batch, there is nothing preventing someone to use the second axis as batch. Could you share more details about the blowing up? I believe there might be a bug. Thanks.","reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/428260565/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"wschin","id":3524474,"node_id":"MDQ6VXNlcjM1MjQ0NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/3524474?v=4","gravatar_id":"","url":"https://api.github.com/users/wschin","html_url":"https://github.com/wschin","followers_url":"https://api.github.com/users/wschin/followers","following_url":"https://api.github.com/users/wschin/following{/other_user}","gists_url":"https://api.github.com/users/wschin/gists{/gist_id}","starred_url":"https://api.github.com/users/wschin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wschin/subscriptions","organizations_url":"https://api.github.com/users/wschin/orgs","repos_url":"https://api.github.com/users/wschin/repos","events_url":"https://api.github.com/users/wschin/events{/privacy}","received_events_url":"https://api.github.com/users/wschin/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/428271186","html_url":"https://github.com/onnx/onnxmltools/issues/26#issuecomment-428271186","issue_url":"https://api.github.com/repos/onnx/onnxmltools/issues/26","id":428271186,"node_id":"MDEyOklzc3VlQ29tbWVudDQyODI3MTE4Ng==","user":{"login":"another-pjohnson","id":24667483,"node_id":"MDQ6VXNlcjI0NjY3NDgz","avatar_url":"https://avatars.githubusercontent.com/u/24667483?v=4","gravatar_id":"","url":"https://api.github.com/users/another-pjohnson","html_url":"https://github.com/another-pjohnson","followers_url":"https://api.github.com/users/another-pjohnson/followers","following_url":"https://api.github.com/users/another-pjohnson/following{/other_user}","gists_url":"https://api.github.com/users/another-pjohnson/gists{/gist_id}","starred_url":"https://api.github.com/users/another-pjohnson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/another-pjohnson/subscriptions","organizations_url":"https://api.github.com/users/another-pjohnson/orgs","repos_url":"https://api.github.com/users/another-pjohnson/repos","events_url":"https://api.github.com/users/another-pjohnson/events{/privacy}","received_events_url":"https://api.github.com/users/another-pjohnson/received_events","type":"User","site_admin":false},"created_at":"2018-10-09T17:02:18Z","updated_at":"2018-10-09T17:02:18Z","author_association":"NONE","body":"Well, default_batch_size already exists in the Topology class and is set to 1. It seems to do exactly what I want -- convert \"None/??\" dimension to value of default_batch_size. Here is the minimal code that reproduces my error:\r\n\r\n```\r\nimport keras\r\nfrom keras.models import Sequential\r\nfrom keras.layers import Dense, Dropout, Activation\r\n\r\nfrom onnx import shape_inference, optimizer\r\nimport onnxmltools\r\nfrom onnxmltools.convert.common.data_types import FloatTensorType\r\n\r\nbatch_size=10\r\n\r\nmodel = Sequential()\r\nmodel.add(Dense(512, activation='relu', input_shape=(784,), kernel_initializer='glorot_uniform'))\r\nmodel.add(Dropout(0.2))\r\nmodel.add(Dense(512, activation='relu', kernel_initializer='glorot_uniform'))\r\nmodel.add(Dropout(0.2))\r\nmodel.add(Dense(10, activation='softmax', kernel_initializer='glorot_uniform'))\r\n\r\nin_shape = model.inputs[0].shape.as_list()\r\nin_shape[0] = batch_size\r\nout_shape = model.outputs[0].shape.as_list()\r\nout_shape[0] = batch_size\r\ninitial_type = [(model.inputs[0].name, FloatTensorType(shape=in_shape)),\r\n                (model.outputs[0].name, FloatTensorType(shape=out_shape))]\r\nonnx_model = onnxmltools.convert_keras(model=model, name='mnist_simple', initial_types=initial_type)\r\npasses = ['eliminate_identity', 'fuse_consecutive_transposes', 'eliminate_nop_transpose']\r\noptimized_onnx = optimizer.optimize(onnx_model, passes)\r\ninferred_onnx = shape_inference.infer_shapes(optimized_onnx)\r\n```\r\n\r\nGrabbing shapes and input/output names, matching up types all to force the shape seems really klunky. onnxmltools.convert_keras(..., default_batch_size=10) seems much easier and does exactly what I want -- and what I imagine most other people would want to do. If it's much more difficult than changing the batch size after creating the onnx model, i don't see why anyone would use the initial_types to do the same thing:\r\n\r\n```\r\n# fix up batch size after onnx_model constructed:\r\nonnx_model.graph.input[0].type.tensor_type.shape.dim[0].dim_value = batch_size\r\nonnx_model.graph.output[0].type.tensor_type.shape.dim[0].dim_value = batch_size\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/428271186/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"another-pjohnson","id":24667483,"node_id":"MDQ6VXNlcjI0NjY3NDgz","avatar_url":"https://avatars.githubusercontent.com/u/24667483?v=4","gravatar_id":"","url":"https://api.github.com/users/another-pjohnson","html_url":"https://github.com/another-pjohnson","followers_url":"https://api.github.com/users/another-pjohnson/followers","following_url":"https://api.github.com/users/another-pjohnson/following{/other_user}","gists_url":"https://api.github.com/users/another-pjohnson/gists{/gist_id}","starred_url":"https://api.github.com/users/another-pjohnson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/another-pjohnson/subscriptions","organizations_url":"https://api.github.com/users/another-pjohnson/orgs","repos_url":"https://api.github.com/users/another-pjohnson/repos","events_url":"https://api.github.com/users/another-pjohnson/events{/privacy}","received_events_url":"https://api.github.com/users/another-pjohnson/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/429382653","html_url":"https://github.com/onnx/onnxmltools/issues/26#issuecomment-429382653","issue_url":"https://api.github.com/repos/onnx/onnxmltools/issues/26","id":429382653,"node_id":"MDEyOklzc3VlQ29tbWVudDQyOTM4MjY1Mw==","user":{"login":"wschin","id":3524474,"node_id":"MDQ6VXNlcjM1MjQ0NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/3524474?v=4","gravatar_id":"","url":"https://api.github.com/users/wschin","html_url":"https://github.com/wschin","followers_url":"https://api.github.com/users/wschin/followers","following_url":"https://api.github.com/users/wschin/following{/other_user}","gists_url":"https://api.github.com/users/wschin/gists{/gist_id}","starred_url":"https://api.github.com/users/wschin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wschin/subscriptions","organizations_url":"https://api.github.com/users/wschin/orgs","repos_url":"https://api.github.com/users/wschin/repos","events_url":"https://api.github.com/users/wschin/events{/privacy}","received_events_url":"https://api.github.com/users/wschin/received_events","type":"User","site_admin":false},"created_at":"2018-10-12T16:24:38Z","updated_at":"2018-10-12T16:24:38Z","author_association":"CONTRIBUTOR","body":"Thank you @Oewyn. That internal batch size was initially designed for Core ML, where batch axis is well-defined. For Core ML, its first axis is always batch size! I don't know if Keras has such a strong rule to identify batch axis in a tensor. Editing shapes after conversion is unsafe; for example, a model is trained with specifically batch size = 10 (10 observation points of a time series) for predicting the next observation. That model might always want to consume input with batch size = 10 to make sure the statistics are consistent to those in training phase.","reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/429382653/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"wschin","id":3524474,"node_id":"MDQ6VXNlcjM1MjQ0NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/3524474?v=4","gravatar_id":"","url":"https://api.github.com/users/wschin","html_url":"https://github.com/wschin","followers_url":"https://api.github.com/users/wschin/followers","following_url":"https://api.github.com/users/wschin/following{/other_user}","gists_url":"https://api.github.com/users/wschin/gists{/gist_id}","starred_url":"https://api.github.com/users/wschin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wschin/subscriptions","organizations_url":"https://api.github.com/users/wschin/orgs","repos_url":"https://api.github.com/users/wschin/repos","events_url":"https://api.github.com/users/wschin/events{/privacy}","received_events_url":"https://api.github.com/users/wschin/received_events","type":"User","site_admin":false}},{"id":1901167424,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTkwMTE2NzQyNA==","url":"https://api.github.com/repos/onnx/onnxmltools/issues/events/1901167424","actor":{"login":"another-pjohnson","id":24667483,"node_id":"MDQ6VXNlcjI0NjY3NDgz","avatar_url":"https://avatars.githubusercontent.com/u/24667483?v=4","gravatar_id":"","url":"https://api.github.com/users/another-pjohnson","html_url":"https://github.com/another-pjohnson","followers_url":"https://api.github.com/users/another-pjohnson/followers","following_url":"https://api.github.com/users/another-pjohnson/following{/other_user}","gists_url":"https://api.github.com/users/another-pjohnson/gists{/gist_id}","starred_url":"https://api.github.com/users/another-pjohnson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/another-pjohnson/subscriptions","organizations_url":"https://api.github.com/users/another-pjohnson/orgs","repos_url":"https://api.github.com/users/another-pjohnson/repos","events_url":"https://api.github.com/users/another-pjohnson/events{/privacy}","received_events_url":"https://api.github.com/users/another-pjohnson/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-10-12T16:24:38Z","performed_via_github_app":null},{"id":1901167426,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE5MDExNjc0MjY=","url":"https://api.github.com/repos/onnx/onnxmltools/issues/events/1901167426","actor":{"login":"another-pjohnson","id":24667483,"node_id":"MDQ6VXNlcjI0NjY3NDgz","avatar_url":"https://avatars.githubusercontent.com/u/24667483?v=4","gravatar_id":"","url":"https://api.github.com/users/another-pjohnson","html_url":"https://github.com/another-pjohnson","followers_url":"https://api.github.com/users/another-pjohnson/followers","following_url":"https://api.github.com/users/another-pjohnson/following{/other_user}","gists_url":"https://api.github.com/users/another-pjohnson/gists{/gist_id}","starred_url":"https://api.github.com/users/another-pjohnson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/another-pjohnson/subscriptions","organizations_url":"https://api.github.com/users/another-pjohnson/orgs","repos_url":"https://api.github.com/users/another-pjohnson/repos","events_url":"https://api.github.com/users/another-pjohnson/events{/privacy}","received_events_url":"https://api.github.com/users/another-pjohnson/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-10-12T16:24:38Z","performed_via_github_app":null},{"id":1994038383,"node_id":"MDExOkNsb3NlZEV2ZW50MTk5NDAzODM4Mw==","url":"https://api.github.com/repos/onnx/onnxmltools/issues/events/1994038383","actor":{"login":"wenbingl","id":10278425,"node_id":"MDQ6VXNlcjEwMjc4NDI1","avatar_url":"https://avatars.githubusercontent.com/u/10278425?v=4","gravatar_id":"","url":"https://api.github.com/users/wenbingl","html_url":"https://github.com/wenbingl","followers_url":"https://api.github.com/users/wenbingl/followers","following_url":"https://api.github.com/users/wenbingl/following{/other_user}","gists_url":"https://api.github.com/users/wenbingl/gists{/gist_id}","starred_url":"https://api.github.com/users/wenbingl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wenbingl/subscriptions","organizations_url":"https://api.github.com/users/wenbingl/orgs","repos_url":"https://api.github.com/users/wenbingl/repos","events_url":"https://api.github.com/users/wenbingl/events{/privacy}","received_events_url":"https://api.github.com/users/wenbingl/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2018-11-29T01:32:37Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/1129693505","html_url":"https://github.com/onnx/onnxmltools/issues/26#issuecomment-1129693505","issue_url":"https://api.github.com/repos/onnx/onnxmltools/issues/26","id":1129693505,"node_id":"IC_kwDOB0J-H85DVcFB","user":{"login":"ghoshaw","id":23494873,"node_id":"MDQ6VXNlcjIzNDk0ODcz","avatar_url":"https://avatars.githubusercontent.com/u/23494873?v=4","gravatar_id":"","url":"https://api.github.com/users/ghoshaw","html_url":"https://github.com/ghoshaw","followers_url":"https://api.github.com/users/ghoshaw/followers","following_url":"https://api.github.com/users/ghoshaw/following{/other_user}","gists_url":"https://api.github.com/users/ghoshaw/gists{/gist_id}","starred_url":"https://api.github.com/users/ghoshaw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghoshaw/subscriptions","organizations_url":"https://api.github.com/users/ghoshaw/orgs","repos_url":"https://api.github.com/users/ghoshaw/repos","events_url":"https://api.github.com/users/ghoshaw/events{/privacy}","received_events_url":"https://api.github.com/users/ghoshaw/received_events","type":"User","site_admin":false},"created_at":"2022-05-18T07:58:39Z","updated_at":"2022-05-18T07:58:39Z","author_association":"NONE","body":"@wschin , I tried your code to convert coreml to onnx, but it says \" ValueError: Unknown color space for tensor image__0\", How to solve this? thanks","reactions":{"url":"https://api.github.com/repos/onnx/onnxmltools/issues/comments/1129693505/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ghoshaw","id":23494873,"node_id":"MDQ6VXNlcjIzNDk0ODcz","avatar_url":"https://avatars.githubusercontent.com/u/23494873?v=4","gravatar_id":"","url":"https://api.github.com/users/ghoshaw","html_url":"https://github.com/ghoshaw","followers_url":"https://api.github.com/users/ghoshaw/followers","following_url":"https://api.github.com/users/ghoshaw/following{/other_user}","gists_url":"https://api.github.com/users/ghoshaw/gists{/gist_id}","starred_url":"https://api.github.com/users/ghoshaw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghoshaw/subscriptions","organizations_url":"https://api.github.com/users/ghoshaw/orgs","repos_url":"https://api.github.com/users/ghoshaw/repos","events_url":"https://api.github.com/users/ghoshaw/events{/privacy}","received_events_url":"https://api.github.com/users/ghoshaw/received_events","type":"User","site_admin":false}},{"id":6630064845,"node_id":"MEE_lADOB0J-H84TDq_mzwAAAAGLLsLN","url":"https://api.github.com/repos/onnx/onnxmltools/issues/events/6630064845","actor":{"login":"wschin","id":3524474,"node_id":"MDQ6VXNlcjM1MjQ0NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/3524474?v=4","gravatar_id":"","url":"https://api.github.com/users/wschin","html_url":"https://github.com/wschin","followers_url":"https://api.github.com/users/wschin/followers","following_url":"https://api.github.com/users/wschin/following{/other_user}","gists_url":"https://api.github.com/users/wschin/gists{/gist_id}","starred_url":"https://api.github.com/users/wschin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wschin/subscriptions","organizations_url":"https://api.github.com/users/wschin/orgs","repos_url":"https://api.github.com/users/wschin/repos","events_url":"https://api.github.com/users/wschin/events{/privacy}","received_events_url":"https://api.github.com/users/wschin/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-05-18T07:58:40Z","performed_via_github_app":null},{"id":6630064850,"node_id":"SE_lADOB0J-H84TDq_mzwAAAAGLLsLS","url":"https://api.github.com/repos/onnx/onnxmltools/issues/events/6630064850","actor":{"login":"wschin","id":3524474,"node_id":"MDQ6VXNlcjM1MjQ0NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/3524474?v=4","gravatar_id":"","url":"https://api.github.com/users/wschin","html_url":"https://github.com/wschin","followers_url":"https://api.github.com/users/wschin/followers","following_url":"https://api.github.com/users/wschin/following{/other_user}","gists_url":"https://api.github.com/users/wschin/gists{/gist_id}","starred_url":"https://api.github.com/users/wschin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wschin/subscriptions","organizations_url":"https://api.github.com/users/wschin/orgs","repos_url":"https://api.github.com/users/wschin/repos","events_url":"https://api.github.com/users/wschin/events{/privacy}","received_events_url":"https://api.github.com/users/wschin/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-05-18T07:58:40Z","performed_via_github_app":null}]