[{"id":3366581815,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzM2NjU4MTgxNQ==","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/3366581815","actor":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-05-23T02:05:23Z","performed_via_github_app":null},{"id":3366581816,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMzNjY1ODE4MTY=","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/3366581816","actor":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-05-23T02:05:23Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/632969500","html_url":"https://github.com/ProGamerGov/neural-style-pt/issues/71#issuecomment-632969500","issue_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71","id":632969500,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMjk2OTUwMA==","user":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false},"created_at":"2020-05-23T02:06:10Z","updated_at":"2020-05-23T02:06:10Z","author_association":"OWNER","body":"@genekogan It's not immediately clear to me what is causing these artifacts, but I'll look into it and see if I can figure it out. Have you tested any of the other models? And have you ruled out artifacts from the input images (like JPEG artifacts)?","reactions":{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/632969500/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false}},{"id":3366582831,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzM2NjU4MjgzMQ==","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/3366582831","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-05-23T02:06:10Z","performed_via_github_app":null},{"id":3366582833,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMzNjY1ODI4MzM=","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/3366582833","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-05-23T02:06:10Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/632974886","html_url":"https://github.com/ProGamerGov/neural-style-pt/issues/71#issuecomment-632974886","issue_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71","id":632974886,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMjk3NDg4Ng==","user":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"created_at":"2020-05-23T02:53:53Z","updated_at":"2020-05-23T02:53:53Z","author_association":"NONE","body":"Just tried with vgg16. At first glance, it wasn't as noticeable but my eye is not very trained to it yet, and I can't compare to the Lua version as I don't see VGG16 available for it? \r\n\r\nAs far as jpeg artifacts, it seems unlikely because the artifacts appear in different places each time you run it, and I'm using the exact same images for both the Lua and PyTorch versions.","reactions":{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/632974886/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/633061489","html_url":"https://github.com/ProGamerGov/neural-style-pt/issues/71#issuecomment-633061489","issue_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71","id":633061489,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMzA2MTQ4OQ==","user":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false},"created_at":"2020-05-23T14:11:49Z","updated_at":"2020-05-23T14:14:06Z","author_association":"OWNER","body":"The VGG-16 model for the Lua version can be found here: https://gist.github.com/ksimonyan/211839e770f7b538e2d8. \r\n\r\nA list of many of the supported models for the Lua version can be found here: https://github.com/jcjohnson/neural-style/wiki/Using-Other-Neural-Models\r\n\r\nThe full list of models supported by neural-style-pt can be found here: https://github.com/ProGamerGov/neural-style-pt/wiki/Other-Models","reactions":{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/633061489/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/633165444","html_url":"https://github.com/ProGamerGov/neural-style-pt/issues/71#issuecomment-633165444","issue_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71","id":633165444,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMzE2NTQ0NA==","user":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false},"created_at":"2020-05-24T01:57:16Z","updated_at":"2020-05-24T01:57:16Z","author_association":"OWNER","body":"Maybe there are layer implementation differences between Torch and PyTorch that could be causing the artifacts? Have you tried using [resize convolutions (that are designed to deal with checker board artifacts)](https://distill.pub/2016/deconv-checkerboard/)? ","reactions":{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/633165444/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/633719086","html_url":"https://github.com/ProGamerGov/neural-style-pt/issues/71#issuecomment-633719086","issue_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71","id":633719086,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMzcxOTA4Ng==","user":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"created_at":"2020-05-25T21:18:47Z","updated_at":"2020-05-25T21:18:47Z","author_association":"NONE","body":"I took a quick stab at this, by replacing at line 119:\r\n\r\n```\r\nif isinstance(layer, nn.Conv2d):\r\n    net.add_module(str(len(net)), layer)\r\n```\r\n\r\nwith\r\n\r\n```\r\nif isinstance(layer, nn.Conv2d):\r\n    net.add_module(str(len(net)), nn.Upsample(scale_factor=2, mode='bilinear'))\r\n    net.add_module(str(len(net)), layer)\r\n    net.add_module(str(len(net)), nn.MaxPool2d(2))\r\n```\r\n\r\nand then doubling style_scale to compensate for the 2x upsampling. It doesn't solve the checkerboard problem for me, and is now also slower and more memory intensive. I made this change based on the discussion/advice [here](https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix/issues/190#issuecomment-358546675) but I'm not sure I made the right change/understood it correctly. Need to read a bit deeper and try again, but wanted to put early attempts here.","reactions":{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/633719086/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/663877795","html_url":"https://github.com/ProGamerGov/neural-style-pt/issues/71#issuecomment-663877795","issue_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71","id":663877795,"node_id":"MDEyOklzc3VlQ29tbWVudDY2Mzg3Nzc5NQ==","user":{"login":"ajhool","id":10801791,"node_id":"MDQ6VXNlcjEwODAxNzkx","avatar_url":"https://avatars.githubusercontent.com/u/10801791?v=4","gravatar_id":"","url":"https://api.github.com/users/ajhool","html_url":"https://github.com/ajhool","followers_url":"https://api.github.com/users/ajhool/followers","following_url":"https://api.github.com/users/ajhool/following{/other_user}","gists_url":"https://api.github.com/users/ajhool/gists{/gist_id}","starred_url":"https://api.github.com/users/ajhool/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajhool/subscriptions","organizations_url":"https://api.github.com/users/ajhool/orgs","repos_url":"https://api.github.com/users/ajhool/repos","events_url":"https://api.github.com/users/ajhool/events{/privacy}","received_events_url":"https://api.github.com/users/ajhool/received_events","type":"User","site_admin":false},"created_at":"2020-07-25T17:03:33Z","updated_at":"2020-07-25T17:03:33Z","author_association":"NONE","body":"@genekogan ever have any success with this? One area that I had been looking in was in the deprocess code, which might differ slightly in how the normalization is done. I though t that the clamp might be doing it:\r\n\r\n```\r\n# Preprocess an image before passing it to a model.\r\n# We need to rescale from [0, 1] to [0, 255], convert from RGB to BGR,\r\n# and subtract the mean pixel.\r\ndef preprocess(image_name, image_size):\r\n    image = Image.open(image_name).convert('RGB')\r\n    if type(image_size) is not tuple:\r\n        image_size = tuple([int((float(image_size) / max(image.size))*x) for x in (image.height, image.width)])\r\n    Loader = transforms.Compose([transforms.Resize(image_size), transforms.ToTensor()])\r\n    rgb2bgr = transforms.Compose([transforms.Lambda(lambda x: x[torch.LongTensor([2,1,0])])])\r\n    Normalize = transforms.Compose([transforms.Normalize(mean=[103.939, 116.779, 123.68], std=[1,1,1])])\r\n    tensor = Normalize(rgb2bgr(Loader(image) * 256)).unsqueeze(0)\r\n    return tensor\r\n\r\n\r\n#  Undo the above preprocessing.\r\ndef deprocess(output_tensor):\r\n    Normalize = transforms.Compose([transforms.Normalize(mean=[-103.939, -116.779, -123.68], std=[1,1,1])])\r\n    bgr2rgb = transforms.Compose([transforms.Lambda(lambda x: x[torch.LongTensor([2,1,0])])])\r\n    output_tensor = bgr2rgb(Normalize(output_tensor.squeeze(0).cpu())) / 256\r\n    output_tensor.clamp_(0, 1)\r\n    Image2PIL = transforms.ToPILImage()\r\n    image = Image2PIL(output_tensor.cpu())\r\n    return image\r\n\r\n```\r\n\r\n```\r\n// original lua:\r\n\r\n-- Preprocess an image before passing it to a Caffe model.\r\n-- We need to rescale from [0, 1] to [0, 255], convert from RGB to BGR,\r\n-- and subtract the mean pixel.\r\nfunction preprocess(img)\r\n  local mean_pixel = torch.DoubleTensor({103.939, 116.779, 123.68})\r\n  local perm = torch.LongTensor{3, 2, 1}\r\n  img = img:index(1, perm):mul(256.0)\r\n  mean_pixel = mean_pixel:view(3, 1, 1):expandAs(img)\r\n  img:add(-1, mean_pixel)\r\n  return img\r\nend\r\n\r\n\r\n-- Undo the above preprocessing.\r\nfunction deprocess(img)\r\n  local mean_pixel = torch.DoubleTensor({103.939, 116.779, 123.68})\r\n  mean_pixel = mean_pixel:view(3, 1, 1):expandAs(img)\r\n  img = img + mean_pixel\r\n  local perm = torch.LongTensor{3, 2, 1}\r\n  img = img:index(1, perm):div(256.0)\r\n  return img\r\nend\r\n\r\n  \r\n```","reactions":{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/663877795/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ajhool","id":10801791,"node_id":"MDQ6VXNlcjEwODAxNzkx","avatar_url":"https://avatars.githubusercontent.com/u/10801791?v=4","gravatar_id":"","url":"https://api.github.com/users/ajhool","html_url":"https://github.com/ajhool","followers_url":"https://api.github.com/users/ajhool/followers","following_url":"https://api.github.com/users/ajhool/following{/other_user}","gists_url":"https://api.github.com/users/ajhool/gists{/gist_id}","starred_url":"https://api.github.com/users/ajhool/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajhool/subscriptions","organizations_url":"https://api.github.com/users/ajhool/orgs","repos_url":"https://api.github.com/users/ajhool/repos","events_url":"https://api.github.com/users/ajhool/events{/privacy}","received_events_url":"https://api.github.com/users/ajhool/received_events","type":"User","site_admin":false}},{"id":3586418742,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzU4NjQxODc0Mg==","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/3586418742","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-07-25T17:03:33Z","performed_via_github_app":null},{"id":3586418743,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM1ODY0MTg3NDM=","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/3586418743","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-07-25T17:03:33Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/667401482","html_url":"https://github.com/ProGamerGov/neural-style-pt/issues/71#issuecomment-667401482","issue_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71","id":667401482,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NzQwMTQ4Mg==","user":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"created_at":"2020-07-31T21:49:38Z","updated_at":"2020-07-31T21:49:38Z","author_association":"NONE","body":"@ajhool I'm not sure if `deprocess` has much to do it with it because it's only called before display or saving the image to disk. The original tensor goes to the next iteration unclamped. Have you tried any changes?\r\n","reactions":{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/667401482/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false}},{"id":3610430327,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzYxMDQzMDMyNw==","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/3610430327","actor":{"login":"ajhool","id":10801791,"node_id":"MDQ6VXNlcjEwODAxNzkx","avatar_url":"https://avatars.githubusercontent.com/u/10801791?v=4","gravatar_id":"","url":"https://api.github.com/users/ajhool","html_url":"https://github.com/ajhool","followers_url":"https://api.github.com/users/ajhool/followers","following_url":"https://api.github.com/users/ajhool/following{/other_user}","gists_url":"https://api.github.com/users/ajhool/gists{/gist_id}","starred_url":"https://api.github.com/users/ajhool/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajhool/subscriptions","organizations_url":"https://api.github.com/users/ajhool/orgs","repos_url":"https://api.github.com/users/ajhool/repos","events_url":"https://api.github.com/users/ajhool/events{/privacy}","received_events_url":"https://api.github.com/users/ajhool/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-07-31T21:49:39Z","performed_via_github_app":null},{"id":3610430332,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM2MTA0MzAzMzI=","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/3610430332","actor":{"login":"ajhool","id":10801791,"node_id":"MDQ6VXNlcjEwODAxNzkx","avatar_url":"https://avatars.githubusercontent.com/u/10801791?v=4","gravatar_id":"","url":"https://api.github.com/users/ajhool","html_url":"https://github.com/ajhool","followers_url":"https://api.github.com/users/ajhool/followers","following_url":"https://api.github.com/users/ajhool/following{/other_user}","gists_url":"https://api.github.com/users/ajhool/gists{/gist_id}","starred_url":"https://api.github.com/users/ajhool/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajhool/subscriptions","organizations_url":"https://api.github.com/users/ajhool/orgs","repos_url":"https://api.github.com/users/ajhool/repos","events_url":"https://api.github.com/users/ajhool/events{/privacy}","received_events_url":"https://api.github.com/users/ajhool/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-07-31T21:49:39Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/739561153","html_url":"https://github.com/ProGamerGov/neural-style-pt/issues/71#issuecomment-739561153","issue_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71","id":739561153,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTU2MTE1Mw==","user":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false},"created_at":"2020-12-06T20:46:00Z","updated_at":"2020-12-06T20:54:07Z","author_association":"OWNER","body":"@genekogan Can you still reproduce this issue on the latest version of PyTorch? I was trying to see if my [gradient normalization code](https://github.com/ProGamerGov/neural-style-pt/commit/cbcd023326a3487a2d75270ed1f3b3ddb4b72407) fixed it, but I can't even get the original artifacts to show up like they did before.","reactions":{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/739561153/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false}},{"id":4076991087,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDA3Njk5MTA4Nw==","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/4076991087","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-12-06T20:46:01Z","performed_via_github_app":null},{"id":4076991088,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQwNzY5OTEwODg=","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/4076991088","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-12-06T20:46:01Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/739664065","html_url":"https://github.com/ProGamerGov/neural-style-pt/issues/71#issuecomment-739664065","issue_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71","id":739664065,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTY2NDA2NQ==","user":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"created_at":"2020-12-07T05:00:07Z","updated_at":"2020-12-07T05:00:07Z","author_association":"NONE","body":"Just tried it, with pytorch 1.7. \r\n\r\n    python neural_style.py -content_image examples/inputs/monalisa.jpg -style_image examples/inputs/hokusai.jpg -image_size 720 -num_iterations 1000 -backend cudnn\r\n\r\ncontent, style, and output:\r\n\r\n![monalisa](https://user-images.githubusercontent.com/1335251/101310631-4a269800-3804-11eb-94cb-3a9597540a8d.jpg)\r\n![hokusai](https://user-images.githubusercontent.com/1335251/101310642-4dba1f00-3804-11eb-92b4-bc7210431d71.jpg)\r\n\r\n![out](https://user-images.githubusercontent.com/1335251/101310861-e0f35480-3804-11eb-8ded-35662747e5f2.png)\r\n\r\nSame thing but with `-normalize_gradients`.\r\n\r\n![out_ng](https://user-images.githubusercontent.com/1335251/101310890-f36d8e00-3804-11eb-92d3-22e413261b50.png)\r\n\r\nI'm still getting the checkerboard artifacts but normalizing the gradients seems to reduce those grayish de-saturated regions, which is very nice. I haven't found anything yet for the checkerboard artifacts.","reactions":{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/739664065/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/739667326","html_url":"https://github.com/ProGamerGov/neural-style-pt/issues/71#issuecomment-739667326","issue_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71","id":739667326,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTY2NzMyNg==","user":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"created_at":"2020-12-07T05:10:17Z","updated_at":"2020-12-07T05:10:17Z","author_association":"NONE","body":"Another one, same as above but for \r\n\r\n![output4](https://user-images.githubusercontent.com/1335251/101311749-f4072400-3806-11eb-8a5d-081135adb6e4.png)\r\n\r\nand `-normalize_gradients`:\r\n\r\n![output3](https://user-images.githubusercontent.com/1335251/101311618-ac809800-3806-11eb-9d61-55d3769ddd2a.png)\r\nstarry_night.jpg\r\n\r\nThe artifacts are much less visible in this case. Perhaps its image-sensitive? Or maybe I used a low quality image before and it learned compression artifacts? Not sure, but here it's looking much better.","reactions":{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/739667326/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/739972795","html_url":"https://github.com/ProGamerGov/neural-style-pt/issues/71#issuecomment-739972795","issue_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71","id":739972795,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTk3Mjc5NQ==","user":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false},"created_at":"2020-12-07T15:01:28Z","updated_at":"2020-12-07T15:38:48Z","author_association":"OWNER","body":"@genekogan I was testing with the brad_pitt.jpg example image and hokusai:\r\n\r\n![artifact_test_out](https://user-images.githubusercontent.com/10626398/101366118-cdc2a200-3861-11eb-9bb6-7410cb139468.jpg)\r\n\r\nTests with and without gradient normalization (some control tests were set to (strength * strength) to make the weights similar to normalize gradients):\r\n\r\n<div align=\"center\">\r\n<img src=\"https://user-images.githubusercontent.com/10626398/101366342-14b09780-3862-11eb-90ee-c059e6e1a0f0.jpg\" height=\"160px\">\r\n<img src=\"https://user-images.githubusercontent.com/10626398/101366343-15492e00-3862-11eb-8a1a-66a6ba39d974.jpg\" height=\"160px\">\r\n<img src=\"https://user-images.githubusercontent.com/10626398/101366346-15e1c480-3862-11eb-86d5-999c38c3080d.jpg\" height=\"160px\">\r\n<img src=\"https://user-images.githubusercontent.com/10626398/101366347-15e1c480-3862-11eb-829c-7ae3a90fe846.jpg\" height=\"160px\">\r\n</div>\r\n\r\nThere are artifacts in my test results, but they are nowhere near as bad as yours with the Mona Lisa.\r\n\r\nIn the original neural-style, I found that Adam produced grayish regions when it's parameters like the beta parameters were not optimal. [PyTorch's Adam optimizer](https://pytorch.org/docs/stable/optim.html#torch.optim.Adam) actually uses the same parameters that [I figured out for neural_style.lua](https://github.com/jcjohnson/neural-style/pull/451). Maybe L-BFGS needs it's parameters tuned in order to avoid creating grayish areas?","reactions":{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/739972795/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false}},{"id":4080089985,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDA4MDA4OTk4NQ==","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/4080089985","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-12-07T15:01:28Z","performed_via_github_app":null},{"id":4080089992,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQwODAwODk5OTI=","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/4080089992","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-12-07T15:01:28Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/739978454","html_url":"https://github.com/ProGamerGov/neural-style-pt/issues/71#issuecomment-739978454","issue_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71","id":739978454,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTk3ODQ1NA==","user":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false},"created_at":"2020-12-07T15:11:06Z","updated_at":"2020-12-07T15:33:43Z","author_association":"OWNER","body":"Another thing is that `neural_style.lua` appears to multiply the gradients by the content / style weights in the backward pass instead of dividing by them. So in order to reproduce that, I had to multiply the weights by themselves to cancel out the division by the weights that takes place in neural-style-pt's backward pass (because things are reversed in the backwards pass). If I didn't multiply the normalized gradients in the backward pass at all, the stylization was little to non existent. I may be wrong about this, but testing with it gave me very similar results to `neural_style.lua`.\r\n\r\n```\r\n    @staticmethod\r\n    def backward(self, grad_output):\r\n        grad_input = grad_output.clone()\r\n        grad_input = grad_input / (torch.norm(grad_input, keepdim=True) + 1e-8)\r\n        return grad_input * self.strength * self.strength, None\r\n```\r\n\r\n```\r\nclass ContentLoss(nn.Module):\r\n\r\n    def forward(self, input):\r\n        if self.mode == 'loss':\r\n            loss = self.crit(input, self.target)\r\n            if self.normalize:\r\n                loss = ScaleGradients.apply(loss, self.strength)\r\n            self.loss = loss * self.strength\r\n```\r\n\r\nhttps://github.com/ProGamerGov/neural-style-pt/blob/master/neural_style.py#L414\r\n\r\nAnd from `neural_style.lua`:\r\n\r\n```\r\nfunction ContentLoss:updateGradInput(input, gradOutput)\r\n  if self.mode == 'loss' then\r\n    if input:nElement() == self.target:nElement() then\r\n      self.gradInput = self.crit:backward(input, self.target)\r\n    end\r\n    if self.normalize then\r\n      self.gradInput:div(torch.norm(self.gradInput, 1) + 1e-8)\r\n    end\r\n    self.gradInput:mul(self.strength)\r\n```\r\n\r\nhttps://github.com/jcjohnson/neural-style/blob/master/neural_style.lua#L480\r\n\r\n\r\nHopefully now that I've figured out how to modify things in the backward pass without breaking neural-style-pt, we can get closer to a solution to the artifacts issue! More information about PyTorch autograd functions (what ScaleGradients uses) can be found [here](https://pytorch.org/docs/stable/notes/extending.html).","reactions":{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/739978454/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/740172894","html_url":"https://github.com/ProGamerGov/neural-style-pt/issues/71#issuecomment-740172894","issue_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71","id":740172894,"node_id":"MDEyOklzc3VlQ29tbWVudDc0MDE3Mjg5NA==","user":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"created_at":"2020-12-07T20:51:19Z","updated_at":"2020-12-07T20:51:19Z","author_association":"NONE","body":"This is what I get using default parameters (regular first, then with -normalize_gradients).\r\n\r\n![output_bp_hokusai](https://user-images.githubusercontent.com/1335251/101403331-f1014780-3889-11eb-9f8e-28cf7a158ff2.png)\r\n![output_bp_hokusai_ng](https://user-images.githubusercontent.com/1335251/101403384-05dddb00-388a-11eb-94e0-9e74fad85c0c.png)\r\n\r\nThe artifacts are still there, they are kind of mild (and with normalized gradients even milder). Your output seem to have no artifacts though. I'm a bit puzzled why we are getting differing results.  Are you using ADAM, or is it the default settings for L-BFGS? I'm on the latest version of your master branch and pytorch 1.7. Maybe something even lower is causing the disparity?\r\n\r\n@alexjc wrote earlier a bit about the issue of muddy regions in [this thread](https://twitter.com/alexjc/status/1280267685692145667) and [this one](https://twitter.com/alexjc/status/1274066030684504064). The [paper by Heitz et al](https://arxiv.org/abs/2006.07229) says Gram loss fails to represent the whole style feature distribution and suggest that swapping in Sliced Wasserstein Distance instead may help reduce or eliminate the muddy \"desaturated\" zones, and I also suspect it could improve the issue I was struggling with earlier of [blending styles together](https://github.com/genekogan/neural_style/issues/1). I tried to implement SWD the other day but ran into issues. I recall swapping in histogram loss helped a bit but did not solve it, I'm curious if this looks interesting to you.\r\n","reactions":{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/740172894/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false}},{"id":4081622263,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDA4MTYyMjI2Mw==","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/4081622263","actor":{"login":"alexjc","id":445208,"node_id":"MDQ6VXNlcjQ0NTIwOA==","avatar_url":"https://avatars.githubusercontent.com/u/445208?v=4","gravatar_id":"","url":"https://api.github.com/users/alexjc","html_url":"https://github.com/alexjc","followers_url":"https://api.github.com/users/alexjc/followers","following_url":"https://api.github.com/users/alexjc/following{/other_user}","gists_url":"https://api.github.com/users/alexjc/gists{/gist_id}","starred_url":"https://api.github.com/users/alexjc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexjc/subscriptions","organizations_url":"https://api.github.com/users/alexjc/orgs","repos_url":"https://api.github.com/users/alexjc/repos","events_url":"https://api.github.com/users/alexjc/events{/privacy}","received_events_url":"https://api.github.com/users/alexjc/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-12-07T20:51:20Z","performed_via_github_app":null},{"id":4081622265,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQwODE2MjIyNjU=","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/4081622265","actor":{"login":"alexjc","id":445208,"node_id":"MDQ6VXNlcjQ0NTIwOA==","avatar_url":"https://avatars.githubusercontent.com/u/445208?v=4","gravatar_id":"","url":"https://api.github.com/users/alexjc","html_url":"https://github.com/alexjc","followers_url":"https://api.github.com/users/alexjc/followers","following_url":"https://api.github.com/users/alexjc/following{/other_user}","gists_url":"https://api.github.com/users/alexjc/gists{/gist_id}","starred_url":"https://api.github.com/users/alexjc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexjc/subscriptions","organizations_url":"https://api.github.com/users/alexjc/orgs","repos_url":"https://api.github.com/users/alexjc/repos","events_url":"https://api.github.com/users/alexjc/events{/privacy}","received_events_url":"https://api.github.com/users/alexjc/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-12-07T20:51:20Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/740183428","html_url":"https://github.com/ProGamerGov/neural-style-pt/issues/71#issuecomment-740183428","issue_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71","id":740183428,"node_id":"MDEyOklzc3VlQ29tbWVudDc0MDE4MzQyOA==","user":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false},"created_at":"2020-12-07T21:13:55Z","updated_at":"2020-12-07T21:21:14Z","author_association":"OWNER","body":"@genekogan These are the different parameters that I used for testing with both Adam and L-BFGS, I think (the tests above are all with L-BFGS, and master branch with no changes):\r\n\r\n```\r\n-init image -style_weight 6000 -content_weight 100\r\n```\r\n\r\nI think for the tests above, I may have also forgotten to set tv weight to zero, which I normally do. I also have in the past used a learning rate of 2 with the Adam optimizer in the original neural-style, but I'm not sure if I ever did the same with neural-style-pt.","reactions":{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/comments/740183428/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ProGamerGov","id":10626398,"node_id":"MDQ6VXNlcjEwNjI2Mzk4","avatar_url":"https://avatars.githubusercontent.com/u/10626398?v=4","gravatar_id":"","url":"https://api.github.com/users/ProGamerGov","html_url":"https://github.com/ProGamerGov","followers_url":"https://api.github.com/users/ProGamerGov/followers","following_url":"https://api.github.com/users/ProGamerGov/following{/other_user}","gists_url":"https://api.github.com/users/ProGamerGov/gists{/gist_id}","starred_url":"https://api.github.com/users/ProGamerGov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProGamerGov/subscriptions","organizations_url":"https://api.github.com/users/ProGamerGov/orgs","repos_url":"https://api.github.com/users/ProGamerGov/repos","events_url":"https://api.github.com/users/ProGamerGov/events{/privacy}","received_events_url":"https://api.github.com/users/ProGamerGov/received_events","type":"User","site_admin":false}},{"id":4081701996,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDA4MTcwMTk5Ng==","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/4081701996","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-12-07T21:13:55Z","performed_via_github_app":null},{"id":4081701997,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQwODE3MDE5OTc=","url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/events/4081701997","actor":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-12-07T21:13:55Z","performed_via_github_app":null}]