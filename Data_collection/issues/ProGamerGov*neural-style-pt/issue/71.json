{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71","repository_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt","labels_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71/labels{/name}","comments_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71/comments","events_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71/events","html_url":"https://github.com/ProGamerGov/neural-style-pt/issues/71","id":623522285,"node_id":"MDU6SXNzdWU2MjM1MjIyODU=","number":71,"title":"Artifacts compared to Lua version","user":{"login":"genekogan","id":1335251,"node_id":"MDQ6VXNlcjEzMzUyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1335251?v=4","gravatar_id":"","url":"https://api.github.com/users/genekogan","html_url":"https://github.com/genekogan","followers_url":"https://api.github.com/users/genekogan/followers","following_url":"https://api.github.com/users/genekogan/following{/other_user}","gists_url":"https://api.github.com/users/genekogan/gists{/gist_id}","starred_url":"https://api.github.com/users/genekogan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/genekogan/subscriptions","organizations_url":"https://api.github.com/users/genekogan/orgs","repos_url":"https://api.github.com/users/genekogan/repos","events_url":"https://api.github.com/users/genekogan/events{/privacy}","received_events_url":"https://api.github.com/users/genekogan/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":23,"created_at":"2020-05-22T23:42:19Z","updated_at":"2021-05-25T11:08:53Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Coming back to this repo after a long break, interested in [developing this](https://github.com/ProGamerGov/neural-style-pt/issues/46) further...\r\n\r\nI was just comparing this implementation to [the original Lua version](https://github.com/jcjohnson/neural-style) and noticed something I hadn't before. The two produce almost identical results, but the PyTorch version appears to produce very subtle artifacts. \r\n\r\nThe following is an example, using Hokusai as the style image. On the left side is neural-style (lua), on the right side is neural-style-pt.\r\n\r\n![ml_hk_lua copy](https://user-images.githubusercontent.com/1335251/82715558-83bcfa80-9c48-11ea-8a9c-9129ed513721.png)\r\n\r\nNotice in scattered places the presence of high-frequency discolorations, often in almost checkerboard-like patterns. These do not appear in the Lua version. If you zoom in on a few parts of the neural-style-pt versions, you can see them clearly. Notice the pink and green checkers.\r\n\r\n<img width=\"994\" alt=\"Screen Shot 2020-05-22 at 4 27 22 PM\" src=\"https://user-images.githubusercontent.com/1335251/82715698-368d5880-9c49-11ea-9731-fa07ab216c06.png\">\r\n\r\n<img width=\"1055\" alt=\"Screen Shot 2020-05-22 at 4 27 42 PM\" src=\"https://user-images.githubusercontent.com/1335251/82715699-38571c00-9c49-11ea-8c93-a0eee7bc5d90.png\">\r\n\r\n<img width=\"979\" alt=\"Screen Shot 2020-05-22 at 4 39 16 PM\" src=\"https://user-images.githubusercontent.com/1335251/82716189-0ba40400-9c4b-11ea-828b-d07516a9e375.png\">\r\n\r\nThis generally happens consistently for any combination of content and style images, although for some style images the artifacts are more obvious. Sometimes obvious discolorations appear, other times they are smaller, giving the output an almost grainy appearance. The artifacts can be reduced by increasing `-tv_weight` but at the expense of content/style reconstruction, and even then it's still visible. \r\n\r\nI tried fixing it a few ways. Clamping the image between iterations (not just at the end) didn't fix it. I tried playing with the `TVLoss` module. For example, changing\r\n\r\n    self.loss = self.strength * (torch.sum(torch.abs(self.x_diff)) + torch.sum(torch.abs(self.y_diff)))\r\n\r\nto an L2-loss, i.e.\r\n\r\n    self.loss = self.strength * (torch.sum(torch.pow(torch.pow(self.x_diff, 2)) + torch.sum(torch.pow(self.y_diff, 2)), 2))\r\n\r\nalso did not get rid of the artifact (I tried this because [my reading of the TVLoss formula](https://arxiv.org/abs/1412.0035) is that they use L2-loss not absolute values. But I'm not sure this makes a big difference.\r\n\r\nThe artifact is very subtle, but I'm hoping to fix it, as I'd like to produce more print-quality images in the future, and multi-stage or multi-scaled techniques on top may amplify the artifact. I wonder if you have any idea what might be causing this or what could potentially fix it.\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ProGamerGov/neural-style-pt/issues/71/timeline","performed_via_github_app":null,"state_reason":null}