{"url":"https://api.github.com/repos/sipeed/MaixPy_scripts/issues/76","repository_url":"https://api.github.com/repos/sipeed/MaixPy_scripts","labels_url":"https://api.github.com/repos/sipeed/MaixPy_scripts/issues/76/labels{/name}","comments_url":"https://api.github.com/repos/sipeed/MaixPy_scripts/issues/76/comments","events_url":"https://api.github.com/repos/sipeed/MaixPy_scripts/issues/76/events","html_url":"https://github.com/sipeed/MaixPy_scripts/issues/76","id":708874248,"node_id":"MDU6SXNzdWU3MDg4NzQyNDg=","number":76,"title":"Image download maixduino","user":{"login":"ChahidTALHA","id":68379453,"node_id":"MDQ6VXNlcjY4Mzc5NDUz","avatar_url":"https://avatars.githubusercontent.com/u/68379453?v=4","gravatar_id":"","url":"https://api.github.com/users/ChahidTALHA","html_url":"https://github.com/ChahidTALHA","followers_url":"https://api.github.com/users/ChahidTALHA/followers","following_url":"https://api.github.com/users/ChahidTALHA/following{/other_user}","gists_url":"https://api.github.com/users/ChahidTALHA/gists{/gist_id}","starred_url":"https://api.github.com/users/ChahidTALHA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ChahidTALHA/subscriptions","organizations_url":"https://api.github.com/users/ChahidTALHA/orgs","repos_url":"https://api.github.com/users/ChahidTALHA/repos","events_url":"https://api.github.com/users/ChahidTALHA/events{/privacy}","received_events_url":"https://api.github.com/users/ChahidTALHA/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-09-25T11:48:22Z","updated_at":"2020-12-15T15:26:49Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"ESP32 firmware version: 1.4.0\r\nMaixduino firmware: MicroPython v0.5.0-221-g6460c58.\r\n\r\nHi everyone, I am using Maixduino for my demo project. Where i should first download image from a localhost url (using Xampp).\r\nThe problem I am facing now is that the code takes too long to download the image (Alice.jpg, size: 42.7 KB), it takes 4 seconds to download the image (Where the expected download time should take 200ms as a maximum for a light image). and sometimes it doesn't get all the data . \r\nIs there any way to optimize my code in this case. Or should I look for an alternative solution.\r\nCode:\r\n```\r\n#-------------- IMPORT PHASE -----------------\r\nimport network, socket\r\nfrom Maix import GPIO\r\nfrom fpioa_manager import fm, board_info\r\nimport machine\r\nimport time\r\nimport image\r\nimport sensor\r\nimport os\r\n#---------------------------------------------\r\n#------------- INIT PHASE --------------------\r\nsensor.reset()\r\nsensor.set_pixformat(sensor.RGB565)\r\nsensor.set_framesize(sensor.QVGA)\r\nsensor.set_vflip(0)\r\nsensor.set_hmirror(0)\r\nsensor.run(1)\r\nWIFI_SSID = \"WIFI_SSID\"\r\nWIFI_PASSWD = \"WIFI_PASSWD\"\r\n#-----------------------------------------------\r\ndef display_on_buffer(img): #display the image object on the buffer and returns nothing\r\n    img2=img.copy(copy_to_fb=True)\r\n    sensor.snapshot()\r\n###----------------------------------------\r\n# IO map for ESP32 on Maixduino\r\nfm.register(25,fm.fpioa.GPIOHS10)#cs\r\nfm.register(8,fm.fpioa.GPIOHS11)#rst\r\nfm.register(9,fm.fpioa.GPIOHS12)#rdy\r\nfm.register(28,fm.fpioa.GPIOHS13)#mosi\r\nfm.register(26,fm.fpioa.GPIOHS14)#miso\r\nfm.register(27,fm.fpioa.GPIOHS15)#sclk\r\nnic = network.ESP32_SPI(cs=fm.fpioa.GPIOHS10,rst=fm.fpioa.GPIOHS11,rdy=fm.fpioa.GPIOHS12, mosi=fm.fpioa.GPIOHS13,miso=fm.fpioa.GPIOHS14,sclk=fm.fpioa.GPIOHS15)\r\n###----------------------------------------\r\nprint(\"ESP32_SPI firmware version:\", nic.version())\r\nerr = 0\r\nwhile 1:\r\n    try:\r\n        nic.connect(WIFI_SSID, WIFI_PASSWD)\r\n    except Exception:\r\n        err += 1\r\n        print(\"Connect AP failed, now try again\")\r\n        if err > 3:\r\n            raise Exception(\"Conenct AP fail\")\r\n        continue\r\n    break\r\nprint(nic.ifconfig())\r\nprint(nic.isconnected())\r\n\r\nFULL_URL =\"http://localhost/Alice.jpg\"\r\nHOST = \"192.168.1.54\"\r\n\r\nHTTP_HEADER =b\"GET %s HTTP/1.1\\r\\nHost: %s\\r\\n\\r\\n\"%(FULL_URL,HOST)\r\nsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\r\nerr = 0\r\nwhile 1:\r\n    try:\r\n        addr = socket.getaddrinfo(HOST, 80)[0][-1]\r\n        break\r\n    except Exception:\r\n        err += 1\r\n    if err > 5:\r\n        raise Exception(\"get ip failed!\")\r\n\r\nsock.connect(addr)\r\nbytes_sent = sock.send(HTTP_HEADER)\r\ntime.sleep_ms(300)\r\ndata_length = 0\r\nimg = b\"\"\r\nsock.settimeout(5)\r\nprint(\"start receiving\")\r\nstart_time = time.ticks_ms()\r\nwhile True:\r\n    try:\r\n        data = sock.recv(4096)\r\n        print(len(data))\r\n        if len(data) == 0:\r\n            break\r\n        else:\r\n            img=img+data\r\n            data_length = data_length + len(data)\r\n    except Exception as e:\r\n        print(\"exception: \",e)\r\n        break\r\nsock.close()\r\nfinish_time = time.ticks_ms() - start_time\r\nprint(\"download time: \",finish_time)\r\nprint(\"data length:\",data_length)\r\nimg = img[img.find(b\"\\r\\n\\r\\n\")+4:]\r\nfis = open(\"/flash/Alice.jpg\",\"wb\")\r\nfis.write(img)\r\nfis.close()\r\nimg = image.Image(\"/flash/Alice.jpg\")\r\ndisplay_on_buffer(img)\r\nprint(\"DONE\")\r\n```\r\nfinish time prints 4 to 5 seconds for such image.\r\nCan I have a clarification about this","closed_by":null,"reactions":{"url":"https://api.github.com/repos/sipeed/MaixPy_scripts/issues/76/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sipeed/MaixPy_scripts/issues/76/timeline","performed_via_github_app":null,"state_reason":null}