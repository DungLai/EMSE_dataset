[{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/595224031","html_url":"https://github.com/voxelmorph/voxelmorph/issues/160#issuecomment-595224031","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/160","id":595224031,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NTIyNDAzMQ==","user":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"created_at":"2020-03-05T13:17:49Z","updated_at":"2020-03-05T13:17:49Z","author_association":"COLLABORATOR","body":"I agree that this looks from the image like it may be doing some weird interpolation, but we've never seen this for nearest neighbor interpolation option, so I am a bit confused and suspect there is a bug elsewhere. Some notes:\r\n\r\n - can you try `networks.nn_trf()` to warp your data? just get a model from that function, then use the model to apply your transform\r\n- If that still behaves weirdly, to double check, can you send me your original image, original segmentation, and resulting flow (all in a numpy file, say)?\r\n- To answer your question about the code, the code dependence follows `layers.SpatialTransform() -> utils.transform -> utils.interpn()` and in `internp` the nearest neighbour is implemented [here](https://github.com/adalca/neuron/blob/95ee00ea25bfe964a80aaa7a9198049e8a93e4b7/neuron/utils.py#L139). But I doubt there's an issue here, we've been using this code for a couple of years without this issue.\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/595224031/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false}},{"id":3101151502,"node_id":"MDEyOkxhYmVsZWRFdmVudDMxMDExNTE1MDI=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3101151502","actor":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-03-05T13:18:15Z","label":{"name":"voxelmorph","color":"1d76db"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/595555591","html_url":"https://github.com/voxelmorph/voxelmorph/issues/160#issuecomment-595555591","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/160","id":595555591,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NTU1NTU5MQ==","user":{"login":"emckenzi123","id":28455475,"node_id":"MDQ6VXNlcjI4NDU1NDc1","avatar_url":"https://avatars.githubusercontent.com/u/28455475?v=4","gravatar_id":"","url":"https://api.github.com/users/emckenzi123","html_url":"https://github.com/emckenzi123","followers_url":"https://api.github.com/users/emckenzi123/followers","following_url":"https://api.github.com/users/emckenzi123/following{/other_user}","gists_url":"https://api.github.com/users/emckenzi123/gists{/gist_id}","starred_url":"https://api.github.com/users/emckenzi123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/emckenzi123/subscriptions","organizations_url":"https://api.github.com/users/emckenzi123/orgs","repos_url":"https://api.github.com/users/emckenzi123/repos","events_url":"https://api.github.com/users/emckenzi123/events{/privacy}","received_events_url":"https://api.github.com/users/emckenzi123/received_events","type":"User","site_admin":false},"created_at":"2020-03-06T01:46:10Z","updated_at":"2020-03-06T01:46:10Z","author_association":"NONE","body":"Ah after getting some sleep and looking at it the next day I realized it was user error. Thank you so much for all of your help!","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/595555591/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"emckenzi123","id":28455475,"node_id":"MDQ6VXNlcjI4NDU1NDc1","avatar_url":"https://avatars.githubusercontent.com/u/28455475?v=4","gravatar_id":"","url":"https://api.github.com/users/emckenzi123","html_url":"https://github.com/emckenzi123","followers_url":"https://api.github.com/users/emckenzi123/followers","following_url":"https://api.github.com/users/emckenzi123/following{/other_user}","gists_url":"https://api.github.com/users/emckenzi123/gists{/gist_id}","starred_url":"https://api.github.com/users/emckenzi123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/emckenzi123/subscriptions","organizations_url":"https://api.github.com/users/emckenzi123/orgs","repos_url":"https://api.github.com/users/emckenzi123/repos","events_url":"https://api.github.com/users/emckenzi123/events{/privacy}","received_events_url":"https://api.github.com/users/emckenzi123/received_events","type":"User","site_admin":false}},{"id":3103572025,"node_id":"MDExOkNsb3NlZEV2ZW50MzEwMzU3MjAyNQ==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3103572025","actor":{"login":"emckenzi123","id":28455475,"node_id":"MDQ6VXNlcjI4NDU1NDc1","avatar_url":"https://avatars.githubusercontent.com/u/28455475?v=4","gravatar_id":"","url":"https://api.github.com/users/emckenzi123","html_url":"https://github.com/emckenzi123","followers_url":"https://api.github.com/users/emckenzi123/followers","following_url":"https://api.github.com/users/emckenzi123/following{/other_user}","gists_url":"https://api.github.com/users/emckenzi123/gists{/gist_id}","starred_url":"https://api.github.com/users/emckenzi123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/emckenzi123/subscriptions","organizations_url":"https://api.github.com/users/emckenzi123/orgs","repos_url":"https://api.github.com/users/emckenzi123/repos","events_url":"https://api.github.com/users/emckenzi123/events{/privacy}","received_events_url":"https://api.github.com/users/emckenzi123/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-03-06T01:46:13Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/987888042","html_url":"https://github.com/voxelmorph/voxelmorph/issues/160#issuecomment-987888042","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/160","id":987888042,"node_id":"IC_kwDOB_Nd28464fmq","user":{"login":"hsiangyuzhao","id":53631393,"node_id":"MDQ6VXNlcjUzNjMxMzkz","avatar_url":"https://avatars.githubusercontent.com/u/53631393?v=4","gravatar_id":"","url":"https://api.github.com/users/hsiangyuzhao","html_url":"https://github.com/hsiangyuzhao","followers_url":"https://api.github.com/users/hsiangyuzhao/followers","following_url":"https://api.github.com/users/hsiangyuzhao/following{/other_user}","gists_url":"https://api.github.com/users/hsiangyuzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/hsiangyuzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hsiangyuzhao/subscriptions","organizations_url":"https://api.github.com/users/hsiangyuzhao/orgs","repos_url":"https://api.github.com/users/hsiangyuzhao/repos","events_url":"https://api.github.com/users/hsiangyuzhao/events{/privacy}","received_events_url":"https://api.github.com/users/hsiangyuzhao/received_events","type":"User","site_admin":false},"created_at":"2021-12-07T12:38:49Z","updated_at":"2021-12-07T12:38:49Z","author_association":"NONE","body":"> **Details of experiments**\r\n> \r\n> I have dug through the source code a bit trying to see where the interpolation was occurring and if it was somehow possible for me to fix, however after several hours of searching I decided to post here and ask for help. I'm not sure if you have seen this happen?\r\n> \r\n> Thank you in advance, -E\r\n\r\nSorry to bother but I wonder what kind of bug you have encountered there? I have met the same problem and I have no idea where the fault lies.","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/987888042/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"hsiangyuzhao","id":53631393,"node_id":"MDQ6VXNlcjUzNjMxMzkz","avatar_url":"https://avatars.githubusercontent.com/u/53631393?v=4","gravatar_id":"","url":"https://api.github.com/users/hsiangyuzhao","html_url":"https://github.com/hsiangyuzhao","followers_url":"https://api.github.com/users/hsiangyuzhao/followers","following_url":"https://api.github.com/users/hsiangyuzhao/following{/other_user}","gists_url":"https://api.github.com/users/hsiangyuzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/hsiangyuzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hsiangyuzhao/subscriptions","organizations_url":"https://api.github.com/users/hsiangyuzhao/orgs","repos_url":"https://api.github.com/users/hsiangyuzhao/repos","events_url":"https://api.github.com/users/hsiangyuzhao/events{/privacy}","received_events_url":"https://api.github.com/users/hsiangyuzhao/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/987899775","html_url":"https://github.com/voxelmorph/voxelmorph/issues/160#issuecomment-987899775","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/160","id":987899775,"node_id":"IC_kwDOB_Nd28464id_","user":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"created_at":"2021-12-07T12:54:51Z","updated_at":"2021-12-07T12:54:51Z","author_association":"COLLABORATOR","body":"If you are warping a segmentation map (not a one-hot representation), you need to warp with the nearest-neighbour interpolation - are you doing this? Alternatively, you need to go to one-hot (`tf.one_hot`), warp that, then take the `argmax` along the last dimension.","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/987899775/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/987931969","html_url":"https://github.com/voxelmorph/voxelmorph/issues/160#issuecomment-987931969","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/160","id":987931969,"node_id":"IC_kwDOB_Nd28464qVB","user":{"login":"hsiangyuzhao","id":53631393,"node_id":"MDQ6VXNlcjUzNjMxMzkz","avatar_url":"https://avatars.githubusercontent.com/u/53631393?v=4","gravatar_id":"","url":"https://api.github.com/users/hsiangyuzhao","html_url":"https://github.com/hsiangyuzhao","followers_url":"https://api.github.com/users/hsiangyuzhao/followers","following_url":"https://api.github.com/users/hsiangyuzhao/following{/other_user}","gists_url":"https://api.github.com/users/hsiangyuzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/hsiangyuzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hsiangyuzhao/subscriptions","organizations_url":"https://api.github.com/users/hsiangyuzhao/orgs","repos_url":"https://api.github.com/users/hsiangyuzhao/repos","events_url":"https://api.github.com/users/hsiangyuzhao/events{/privacy}","received_events_url":"https://api.github.com/users/hsiangyuzhao/received_events","type":"User","site_admin":false},"created_at":"2021-12-07T13:35:36Z","updated_at":"2021-12-07T13:35:36Z","author_association":"NONE","body":"> If you are warping a segmentation map (not a one-hot representation), you need to warp with the nearest-neighbour interpolation - are you doing this? Alternatively, you need to go to one-hot (`tf.one_hot`), warp that, then take the `argmax` along the last dimension.\r\n\r\nThanks! That's exactly what I have mistaken.","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/987931969/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"hsiangyuzhao","id":53631393,"node_id":"MDQ6VXNlcjUzNjMxMzkz","avatar_url":"https://avatars.githubusercontent.com/u/53631393?v=4","gravatar_id":"","url":"https://api.github.com/users/hsiangyuzhao","html_url":"https://github.com/hsiangyuzhao","followers_url":"https://api.github.com/users/hsiangyuzhao/followers","following_url":"https://api.github.com/users/hsiangyuzhao/following{/other_user}","gists_url":"https://api.github.com/users/hsiangyuzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/hsiangyuzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hsiangyuzhao/subscriptions","organizations_url":"https://api.github.com/users/hsiangyuzhao/orgs","repos_url":"https://api.github.com/users/hsiangyuzhao/repos","events_url":"https://api.github.com/users/hsiangyuzhao/events{/privacy}","received_events_url":"https://api.github.com/users/hsiangyuzhao/received_events","type":"User","site_admin":false}}]