[{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/583222680","html_url":"https://github.com/voxelmorph/voxelmorph/issues/143#issuecomment-583222680","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/143","id":583222680,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MzIyMjY4MA==","user":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"created_at":"2020-02-07T03:54:16Z","updated_at":"2020-02-07T03:54:16Z","author_association":"COLLABORATOR","body":"Hi @theoVag \r\n\r\nYou can do this in several ways, but the simplest is to have a model that learns the displacement in a layer. The idea is to have a model that has as input the two models, and a layer that has a parameter at every voxel (this one layer replaces the unet in voxelmorph). Then you can warp one of the images with the output of this layer, and compare with the second image as you do in voxelmorph. \r\n\r\nTo initialize the weights of this parameter, you can run your previously-trained vxm on some image pair, get the output, and load it as weights. \r\n\r\nThe codebase has changed dramatically and this isn't one we've kept up, but we'll release a version of this in the `redesign`, hopefully in the next few days. Here's some semi-pseudo-code:\r\n\r\n```\r\nsrc = Input(shape=vol_size + (1,))\r\ntgt = Input(shape=vol_size + (1,))\r\nflow = neuron.layers.LocalParam(shape=vol_size + (3,)) # flow layer\r\ny = neuron.layers.SpatialTransformer()([src, flow]) # warped image\r\ninsta_model = Model([src,tgt,v_flow], [y, flow])  # model\r\n\r\nflow.set_weights(weights_from_vxm_output)  # load weights\r\n\r\nmodel.compile(...)  # compile\r\n\r\nmodel.fit(...)  # fit on your pair\r\n```\r\n\r\n@balakg do you have code for this lying around?","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/583222680/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false}},{"id":3016293327,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzAxNjI5MzMyNw==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3016293327","actor":{"login":"balakg","id":8753801,"node_id":"MDQ6VXNlcjg3NTM4MDE=","avatar_url":"https://avatars.githubusercontent.com/u/8753801?v=4","gravatar_id":"","url":"https://api.github.com/users/balakg","html_url":"https://github.com/balakg","followers_url":"https://api.github.com/users/balakg/followers","following_url":"https://api.github.com/users/balakg/following{/other_user}","gists_url":"https://api.github.com/users/balakg/gists{/gist_id}","starred_url":"https://api.github.com/users/balakg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/balakg/subscriptions","organizations_url":"https://api.github.com/users/balakg/orgs","repos_url":"https://api.github.com/users/balakg/repos","events_url":"https://api.github.com/users/balakg/events{/privacy}","received_events_url":"https://api.github.com/users/balakg/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-02-07T03:54:16Z","performed_via_github_app":null},{"id":3016293330,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMwMTYyOTMzMzA=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3016293330","actor":{"login":"balakg","id":8753801,"node_id":"MDQ6VXNlcjg3NTM4MDE=","avatar_url":"https://avatars.githubusercontent.com/u/8753801?v=4","gravatar_id":"","url":"https://api.github.com/users/balakg","html_url":"https://github.com/balakg","followers_url":"https://api.github.com/users/balakg/followers","following_url":"https://api.github.com/users/balakg/following{/other_user}","gists_url":"https://api.github.com/users/balakg/gists{/gist_id}","starred_url":"https://api.github.com/users/balakg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/balakg/subscriptions","organizations_url":"https://api.github.com/users/balakg/orgs","repos_url":"https://api.github.com/users/balakg/repos","events_url":"https://api.github.com/users/balakg/events{/privacy}","received_events_url":"https://api.github.com/users/balakg/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-02-07T03:54:16Z","performed_via_github_app":null},{"id":3016293331,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzAxNjI5MzMzMQ==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3016293331","actor":{"login":"theoVag","id":32677031,"node_id":"MDQ6VXNlcjMyNjc3MDMx","avatar_url":"https://avatars.githubusercontent.com/u/32677031?v=4","gravatar_id":"","url":"https://api.github.com/users/theoVag","html_url":"https://github.com/theoVag","followers_url":"https://api.github.com/users/theoVag/followers","following_url":"https://api.github.com/users/theoVag/following{/other_user}","gists_url":"https://api.github.com/users/theoVag/gists{/gist_id}","starred_url":"https://api.github.com/users/theoVag/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theoVag/subscriptions","organizations_url":"https://api.github.com/users/theoVag/orgs","repos_url":"https://api.github.com/users/theoVag/repos","events_url":"https://api.github.com/users/theoVag/events{/privacy}","received_events_url":"https://api.github.com/users/theoVag/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-02-07T03:54:16Z","performed_via_github_app":null},{"id":3016293332,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMwMTYyOTMzMzI=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3016293332","actor":{"login":"theoVag","id":32677031,"node_id":"MDQ6VXNlcjMyNjc3MDMx","avatar_url":"https://avatars.githubusercontent.com/u/32677031?v=4","gravatar_id":"","url":"https://api.github.com/users/theoVag","html_url":"https://github.com/theoVag","followers_url":"https://api.github.com/users/theoVag/followers","following_url":"https://api.github.com/users/theoVag/following{/other_user}","gists_url":"https://api.github.com/users/theoVag/gists{/gist_id}","starred_url":"https://api.github.com/users/theoVag/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theoVag/subscriptions","organizations_url":"https://api.github.com/users/theoVag/orgs","repos_url":"https://api.github.com/users/theoVag/repos","events_url":"https://api.github.com/users/theoVag/events{/privacy}","received_events_url":"https://api.github.com/users/theoVag/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-02-07T03:54:16Z","performed_via_github_app":null},{"id":3016293463,"node_id":"MDEyOkxhYmVsZWRFdmVudDMwMTYyOTM0NjM=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3016293463","actor":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-02-07T03:54:22Z","label":{"name":"voxelmorph","color":"1d76db"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/589647086","html_url":"https://github.com/voxelmorph/voxelmorph/issues/143#issuecomment-589647086","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/143","id":589647086,"node_id":"MDEyOklzc3VlQ29tbWVudDU4OTY0NzA4Ng==","user":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"created_at":"2020-02-21T13:11:30Z","updated_at":"2020-02-21T13:11:30Z","author_association":"COLLABORATOR","body":"@theoVag \r\n\r\n@ahoopes has added an implementation of this in https://github.com/voxelmorph/voxelmorph/blob/redesign/scripts/tensorflow/train_instance.py -- this is part of a new refactoring of our code that will be up soon, but it enables you to see some instance-specific opt code.","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/589647086/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false}},{"id":3060433771,"node_id":"MDExOkNsb3NlZEV2ZW50MzA2MDQzMzc3MQ==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3060433771","actor":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-02-21T13:11:30Z","state_reason":null,"performed_via_github_app":null},{"id":3060433793,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzA2MDQzMzc5Mw==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3060433793","actor":{"login":"ahoopes","id":24280487,"node_id":"MDQ6VXNlcjI0MjgwNDg3","avatar_url":"https://avatars.githubusercontent.com/u/24280487?v=4","gravatar_id":"","url":"https://api.github.com/users/ahoopes","html_url":"https://github.com/ahoopes","followers_url":"https://api.github.com/users/ahoopes/followers","following_url":"https://api.github.com/users/ahoopes/following{/other_user}","gists_url":"https://api.github.com/users/ahoopes/gists{/gist_id}","starred_url":"https://api.github.com/users/ahoopes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ahoopes/subscriptions","organizations_url":"https://api.github.com/users/ahoopes/orgs","repos_url":"https://api.github.com/users/ahoopes/repos","events_url":"https://api.github.com/users/ahoopes/events{/privacy}","received_events_url":"https://api.github.com/users/ahoopes/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-02-21T13:11:30Z","performed_via_github_app":null},{"id":3060433796,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMwNjA0MzM3OTY=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3060433796","actor":{"login":"ahoopes","id":24280487,"node_id":"MDQ6VXNlcjI0MjgwNDg3","avatar_url":"https://avatars.githubusercontent.com/u/24280487?v=4","gravatar_id":"","url":"https://api.github.com/users/ahoopes","html_url":"https://github.com/ahoopes","followers_url":"https://api.github.com/users/ahoopes/followers","following_url":"https://api.github.com/users/ahoopes/following{/other_user}","gists_url":"https://api.github.com/users/ahoopes/gists{/gist_id}","starred_url":"https://api.github.com/users/ahoopes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ahoopes/subscriptions","organizations_url":"https://api.github.com/users/ahoopes/orgs","repos_url":"https://api.github.com/users/ahoopes/repos","events_url":"https://api.github.com/users/ahoopes/events{/privacy}","received_events_url":"https://api.github.com/users/ahoopes/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-02-21T13:11:30Z","performed_via_github_app":null},{"id":3060433805,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzA2MDQzMzgwNQ==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3060433805","actor":{"login":"theoVag","id":32677031,"node_id":"MDQ6VXNlcjMyNjc3MDMx","avatar_url":"https://avatars.githubusercontent.com/u/32677031?v=4","gravatar_id":"","url":"https://api.github.com/users/theoVag","html_url":"https://github.com/theoVag","followers_url":"https://api.github.com/users/theoVag/followers","following_url":"https://api.github.com/users/theoVag/following{/other_user}","gists_url":"https://api.github.com/users/theoVag/gists{/gist_id}","starred_url":"https://api.github.com/users/theoVag/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theoVag/subscriptions","organizations_url":"https://api.github.com/users/theoVag/orgs","repos_url":"https://api.github.com/users/theoVag/repos","events_url":"https://api.github.com/users/theoVag/events{/privacy}","received_events_url":"https://api.github.com/users/theoVag/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-02-21T13:11:30Z","performed_via_github_app":null},{"id":3060433806,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMwNjA0MzM4MDY=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3060433806","actor":{"login":"theoVag","id":32677031,"node_id":"MDQ6VXNlcjMyNjc3MDMx","avatar_url":"https://avatars.githubusercontent.com/u/32677031?v=4","gravatar_id":"","url":"https://api.github.com/users/theoVag","html_url":"https://github.com/theoVag","followers_url":"https://api.github.com/users/theoVag/followers","following_url":"https://api.github.com/users/theoVag/following{/other_user}","gists_url":"https://api.github.com/users/theoVag/gists{/gist_id}","starred_url":"https://api.github.com/users/theoVag/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theoVag/subscriptions","organizations_url":"https://api.github.com/users/theoVag/orgs","repos_url":"https://api.github.com/users/theoVag/repos","events_url":"https://api.github.com/users/theoVag/events{/privacy}","received_events_url":"https://api.github.com/users/theoVag/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-02-21T13:11:31Z","performed_via_github_app":null}]