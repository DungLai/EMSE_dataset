[{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620192990","html_url":"https://github.com/voxelmorph/voxelmorph/issues/178#issuecomment-620192990","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/178","id":620192990,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMDE5Mjk5MA==","user":{"login":"vincentme","id":11166542,"node_id":"MDQ6VXNlcjExMTY2NTQy","avatar_url":"https://avatars.githubusercontent.com/u/11166542?v=4","gravatar_id":"","url":"https://api.github.com/users/vincentme","html_url":"https://github.com/vincentme","followers_url":"https://api.github.com/users/vincentme/followers","following_url":"https://api.github.com/users/vincentme/following{/other_user}","gists_url":"https://api.github.com/users/vincentme/gists{/gist_id}","starred_url":"https://api.github.com/users/vincentme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincentme/subscriptions","organizations_url":"https://api.github.com/users/vincentme/orgs","repos_url":"https://api.github.com/users/vincentme/repos","events_url":"https://api.github.com/users/vincentme/events{/privacy}","received_events_url":"https://api.github.com/users/vincentme/received_events","type":"User","site_admin":false},"created_at":"2020-04-27T19:41:02Z","updated_at":"2020-04-27T19:41:02Z","author_association":"NONE","body":"I had the same issue as I try to reimplement the VoxelMorph. I think the reason for overflowed ncc is the lack of variation in some windows. The normalized corss-correlation is essentially normalizing the data by divided its variation. For two windows with very low variation to calculated ncc, both the denominator and numerator are approaching zero which brings the numerical stability issue. There are more chances to have this issue in the artificial images as they have much less noise. You can try to calculate the ncc of two identical images with flat region to see if the algorithm if is numerical stable. \r\n\r\nMy solution is \r\n```\r\nnum_stab_const = 3e-4 # numerical stability constant\r\n\r\n# u_I = I_sum/self.window_volume\r\n# u_J = J_sum/self.window_volume\r\n# cross = IJ_sum - u_J * I_sum - u_I * J_sum + u_I * u_J * self.window_volume\r\n# I_var = I2_sum - 2 * u_I * I_sum + u_I * u_I * self.window_volume\r\n# J_var = J2_sum - 2 * u_J * J_sum + u_J * u_J * self.window_volume\r\n\r\ncross = IJ_sum - I_sum*J_sum/self.window_volume + num_stab_const\r\nI_var = I2_sum - I_sum**2/self.window_volume + num_stab_const\r\nJ_var = J2_sum - J_sum**2/self.window_volume + num_stab_const\r\ncc = cross/((I_var*J_var)**0.5)\r\nreturn -torch.mean(cc)\r\n```\r\nHere a few changes to the original algorithm\r\n\r\n1. A simple equation to calculate the cross term and variation term. \r\n2. Numerical stability constant is added to each term. \r\n3. The original zero mean normalized corss-correlation is calculated instead of its square. See my comments on [this](https://github.com/voxelmorph/voxelmorph/issues/177). \r\n\r\n","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620192990/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vincentme","id":11166542,"node_id":"MDQ6VXNlcjExMTY2NTQy","avatar_url":"https://avatars.githubusercontent.com/u/11166542?v=4","gravatar_id":"","url":"https://api.github.com/users/vincentme","html_url":"https://github.com/vincentme","followers_url":"https://api.github.com/users/vincentme/followers","following_url":"https://api.github.com/users/vincentme/following{/other_user}","gists_url":"https://api.github.com/users/vincentme/gists{/gist_id}","starred_url":"https://api.github.com/users/vincentme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincentme/subscriptions","organizations_url":"https://api.github.com/users/vincentme/orgs","repos_url":"https://api.github.com/users/vincentme/repos","events_url":"https://api.github.com/users/vincentme/events{/privacy}","received_events_url":"https://api.github.com/users/vincentme/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620193612","html_url":"https://github.com/voxelmorph/voxelmorph/issues/178#issuecomment-620193612","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/178","id":620193612,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMDE5MzYxMg==","user":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"created_at":"2020-04-27T19:42:23Z","updated_at":"2020-04-27T19:42:23Z","author_association":"COLLABORATOR","body":"@HansLeonardVanBrueggemann which version are you using, keras of pytorch?","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620193612/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false}},{"id":3277326274,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI3NzMyNjI3NA==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3277326274","actor":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-27T19:42:23Z","performed_via_github_app":null},{"id":3277326276,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyNzczMjYyNzY=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3277326276","actor":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-27T19:42:23Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620194636","html_url":"https://github.com/voxelmorph/voxelmorph/issues/178#issuecomment-620194636","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/178","id":620194636,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMDE5NDYzNg==","user":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"created_at":"2020-04-27T19:44:42Z","updated_at":"2020-04-27T19:44:42Z","author_association":"COLLABORATOR","body":"@vincentme thanks for your comment -- both the keras and pytorch should have had stability constants already implemented in the original divisions -- did you find this not to be true? i.e. is there some place in the code where there wasn't some constant added in the division","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620194636/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false}},{"id":3277334554,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI3NzMzNDU1NA==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3277334554","actor":{"login":"vincentme","id":11166542,"node_id":"MDQ6VXNlcjExMTY2NTQy","avatar_url":"https://avatars.githubusercontent.com/u/11166542?v=4","gravatar_id":"","url":"https://api.github.com/users/vincentme","html_url":"https://github.com/vincentme","followers_url":"https://api.github.com/users/vincentme/followers","following_url":"https://api.github.com/users/vincentme/following{/other_user}","gists_url":"https://api.github.com/users/vincentme/gists{/gist_id}","starred_url":"https://api.github.com/users/vincentme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincentme/subscriptions","organizations_url":"https://api.github.com/users/vincentme/orgs","repos_url":"https://api.github.com/users/vincentme/repos","events_url":"https://api.github.com/users/vincentme/events{/privacy}","received_events_url":"https://api.github.com/users/vincentme/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-27T19:44:42Z","performed_via_github_app":null},{"id":3277334556,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyNzczMzQ1NTY=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3277334556","actor":{"login":"vincentme","id":11166542,"node_id":"MDQ6VXNlcjExMTY2NTQy","avatar_url":"https://avatars.githubusercontent.com/u/11166542?v=4","gravatar_id":"","url":"https://api.github.com/users/vincentme","html_url":"https://github.com/vincentme","followers_url":"https://api.github.com/users/vincentme/followers","following_url":"https://api.github.com/users/vincentme/following{/other_user}","gists_url":"https://api.github.com/users/vincentme/gists{/gist_id}","starred_url":"https://api.github.com/users/vincentme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincentme/subscriptions","organizations_url":"https://api.github.com/users/vincentme/orgs","repos_url":"https://api.github.com/users/vincentme/repos","events_url":"https://api.github.com/users/vincentme/events{/privacy}","received_events_url":"https://api.github.com/users/vincentme/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-27T19:44:42Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620197957","html_url":"https://github.com/voxelmorph/voxelmorph/issues/178#issuecomment-620197957","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/178","id":620197957,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMDE5Nzk1Nw==","user":{"login":"vincentme","id":11166542,"node_id":"MDQ6VXNlcjExMTY2NTQy","avatar_url":"https://avatars.githubusercontent.com/u/11166542?v=4","gravatar_id":"","url":"https://api.github.com/users/vincentme","html_url":"https://github.com/vincentme","followers_url":"https://api.github.com/users/vincentme/followers","following_url":"https://api.github.com/users/vincentme/following{/other_user}","gists_url":"https://api.github.com/users/vincentme/gists{/gist_id}","starred_url":"https://api.github.com/users/vincentme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincentme/subscriptions","organizations_url":"https://api.github.com/users/vincentme/orgs","repos_url":"https://api.github.com/users/vincentme/repos","events_url":"https://api.github.com/users/vincentme/events{/privacy}","received_events_url":"https://api.github.com/users/vincentme/received_events","type":"User","site_admin":false},"created_at":"2020-04-27T19:51:41Z","updated_at":"2020-04-27T19:51:54Z","author_association":"NONE","body":"> @vincentme thanks for your comment -- both the keras and pytorch should have had stability constants already implemented in the original divisions -- did you find this not to be true? i.e. is there some place in the code where there wasn't some constant added in the division\r\n\r\nI have implemented the constant a little bit different than yours `cc = cross*cross / (I_var*J_var + 1e-5)` which in the redesign brach. I'd suggest using `cc = (cross + 1e-5)**2 / ((I_var + 1e-5)*(J_var + 1e-5))`. \r\n","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620197957/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vincentme","id":11166542,"node_id":"MDQ6VXNlcjExMTY2NTQy","avatar_url":"https://avatars.githubusercontent.com/u/11166542?v=4","gravatar_id":"","url":"https://api.github.com/users/vincentme","html_url":"https://github.com/vincentme","followers_url":"https://api.github.com/users/vincentme/followers","following_url":"https://api.github.com/users/vincentme/following{/other_user}","gists_url":"https://api.github.com/users/vincentme/gists{/gist_id}","starred_url":"https://api.github.com/users/vincentme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincentme/subscriptions","organizations_url":"https://api.github.com/users/vincentme/orgs","repos_url":"https://api.github.com/users/vincentme/repos","events_url":"https://api.github.com/users/vincentme/events{/privacy}","received_events_url":"https://api.github.com/users/vincentme/received_events","type":"User","site_admin":false}},{"id":3277358276,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI3NzM1ODI3Ng==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3277358276","actor":{"login":"vincentme","id":11166542,"node_id":"MDQ6VXNlcjExMTY2NTQy","avatar_url":"https://avatars.githubusercontent.com/u/11166542?v=4","gravatar_id":"","url":"https://api.github.com/users/vincentme","html_url":"https://github.com/vincentme","followers_url":"https://api.github.com/users/vincentme/followers","following_url":"https://api.github.com/users/vincentme/following{/other_user}","gists_url":"https://api.github.com/users/vincentme/gists{/gist_id}","starred_url":"https://api.github.com/users/vincentme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincentme/subscriptions","organizations_url":"https://api.github.com/users/vincentme/orgs","repos_url":"https://api.github.com/users/vincentme/repos","events_url":"https://api.github.com/users/vincentme/events{/privacy}","received_events_url":"https://api.github.com/users/vincentme/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-27T19:51:41Z","performed_via_github_app":null},{"id":3277358279,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyNzczNTgyNzk=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3277358279","actor":{"login":"vincentme","id":11166542,"node_id":"MDQ6VXNlcjExMTY2NTQy","avatar_url":"https://avatars.githubusercontent.com/u/11166542?v=4","gravatar_id":"","url":"https://api.github.com/users/vincentme","html_url":"https://github.com/vincentme","followers_url":"https://api.github.com/users/vincentme/followers","following_url":"https://api.github.com/users/vincentme/following{/other_user}","gists_url":"https://api.github.com/users/vincentme/gists{/gist_id}","starred_url":"https://api.github.com/users/vincentme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincentme/subscriptions","organizations_url":"https://api.github.com/users/vincentme/orgs","repos_url":"https://api.github.com/users/vincentme/repos","events_url":"https://api.github.com/users/vincentme/events{/privacy}","received_events_url":"https://api.github.com/users/vincentme/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-27T19:51:41Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620449561","html_url":"https://github.com/voxelmorph/voxelmorph/issues/178#issuecomment-620449561","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/178","id":620449561,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMDQ0OTU2MQ==","user":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false},"created_at":"2020-04-28T08:07:09Z","updated_at":"2020-04-28T08:07:09Z","author_association":"NONE","body":"> \r\n> \r\n> @HansLeonardVanBrueggemann which version are you using, keras of pytorch?\r\n\r\nkeras. \r\n\r\n\r\n\r\n> \r\n> \r\n> > @vincentme thanks for your comment -- both the keras and pytorch should have had stability constants already implemented in the original divisions -- did you find this not to be true? i.e. is there some place in the code where there wasn't some constant added in the division\r\n> \r\n> I have implemented the constant a little bit different than yours `cc = cross*cross / (I_var*J_var + 1e-5)` which in the redesign brach. I'd suggest using `cc = (cross + 1e-5)**2 / ((I_var + 1e-5)*(J_var + 1e-5))`.\r\n\r\nthanks, i will try that ","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620449561/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false}},{"id":3279090526,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI3OTA5MDUyNg==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3279090526","actor":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-28T08:07:09Z","performed_via_github_app":null},{"id":3279090527,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyNzkwOTA1Mjc=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3279090527","actor":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-28T08:07:09Z","performed_via_github_app":null},{"id":3279090529,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI3OTA5MDUyOQ==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3279090529","actor":{"login":"vincentme","id":11166542,"node_id":"MDQ6VXNlcjExMTY2NTQy","avatar_url":"https://avatars.githubusercontent.com/u/11166542?v=4","gravatar_id":"","url":"https://api.github.com/users/vincentme","html_url":"https://github.com/vincentme","followers_url":"https://api.github.com/users/vincentme/followers","following_url":"https://api.github.com/users/vincentme/following{/other_user}","gists_url":"https://api.github.com/users/vincentme/gists{/gist_id}","starred_url":"https://api.github.com/users/vincentme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincentme/subscriptions","organizations_url":"https://api.github.com/users/vincentme/orgs","repos_url":"https://api.github.com/users/vincentme/repos","events_url":"https://api.github.com/users/vincentme/events{/privacy}","received_events_url":"https://api.github.com/users/vincentme/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-28T08:07:09Z","performed_via_github_app":null},{"id":3279090533,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyNzkwOTA1MzM=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3279090533","actor":{"login":"vincentme","id":11166542,"node_id":"MDQ6VXNlcjExMTY2NTQy","avatar_url":"https://avatars.githubusercontent.com/u/11166542?v=4","gravatar_id":"","url":"https://api.github.com/users/vincentme","html_url":"https://github.com/vincentme","followers_url":"https://api.github.com/users/vincentme/followers","following_url":"https://api.github.com/users/vincentme/following{/other_user}","gists_url":"https://api.github.com/users/vincentme/gists{/gist_id}","starred_url":"https://api.github.com/users/vincentme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincentme/subscriptions","organizations_url":"https://api.github.com/users/vincentme/orgs","repos_url":"https://api.github.com/users/vincentme/repos","events_url":"https://api.github.com/users/vincentme/events{/privacy}","received_events_url":"https://api.github.com/users/vincentme/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-28T08:07:09Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620470928","html_url":"https://github.com/voxelmorph/voxelmorph/issues/178#issuecomment-620470928","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/178","id":620470928,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMDQ3MDkyOA==","user":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false},"created_at":"2020-04-28T08:49:58Z","updated_at":"2020-04-28T08:49:58Z","author_association":"NONE","body":"> \r\n> \r\n> I had the same issue as I try to reimplement the VoxelMorph. I think the reason for overflowed ncc is the lack of variation in some windows. The normalized corss-correlation is essentially normalizing the data by divided its variation. For two windows with very low variation to calculated ncc, both the denominator and numerator are approaching zero which brings the numerical stability issue. There are more chances to have this issue in the artificial images as they have much less noise. You can try to calculate the ncc of two identical images with flat region to see if the algorithm if is numerical stable.\r\n> \r\n> My solution is\r\n> \r\n> ```\r\n> num_stab_const = 3e-4 # numerical stability constant\r\n> \r\n> # u_I = I_sum/self.window_volume\r\n> # u_J = J_sum/self.window_volume\r\n> # cross = IJ_sum - u_J * I_sum - u_I * J_sum + u_I * u_J * self.window_volume\r\n> # I_var = I2_sum - 2 * u_I * I_sum + u_I * u_I * self.window_volume\r\n> # J_var = J2_sum - 2 * u_J * J_sum + u_J * u_J * self.window_volume\r\n> \r\n> cross = IJ_sum - I_sum*J_sum/self.window_volume + num_stab_const\r\n> I_var = I2_sum - I_sum**2/self.window_volume + num_stab_const\r\n> J_var = J2_sum - J_sum**2/self.window_volume + num_stab_const\r\n> cc = cross/((I_var*J_var)**0.5)\r\n> return -torch.mean(cc)\r\n> ```\r\n> \r\n> Here a few changes to the original algorithm\r\n> \r\n>     1. A simple equation to calculate the cross term and variation term.\r\n> \r\n>     2. Numerical stability constant is added to each term.\r\n> \r\n>     3. The original zero mean normalized corss-correlation is calculated instead of its square. See my comments on [this](https://github.com/voxelmorph/voxelmorph/issues/177).\r\n\r\nmmmh unfortunately we are back again to the same problem. \r\n\r\n```\r\nEpoch 1/100\r\n  5/472 [..............................] - ETA: 1:33:37 - loss: nan - A_loss: 1.4945 - wrapA_loss: nan - E_loss: 582.0727 - wrapE_loss: nan          \r\n---------------------------------------------------------------------------\r\nInvalidArgumentError                      Traceback (most recent call last)\r\n<ipython-input-7-294a94e023b2> in <module>\r\n----> 1 net.fit_generator(train_datagen, epochs=100, validation_data=holdo_datagen)\r\n\r\n~/tf-1.9/lib/python3.5/site-packages/keras/legacy/interfaces.py in wrapper(*args, **kwargs)\r\n     89                 warnings.warn('Update your `' + object_name + '` call to the ' +\r\n     90                               'Keras 2 API: ' + signature, stacklevel=2)\r\n---> 91             return func(*args, **kwargs)\r\n     92         wrapper._original_function = func\r\n     93         return wrapper\r\n\r\n~/tf-1.9/lib/python3.5/site-packages/keras/engine/training.py in fit_generator(self, generator, steps_per_epoch, epochs, verbose, callbacks, validation_data, validation_steps, class_weight, max_queue_size, workers, use_multiprocessing, shuffle, initial_epoch)\r\n   1416             use_multiprocessing=use_multiprocessing,\r\n   1417             shuffle=shuffle,\r\n-> 1418             initial_epoch=initial_epoch)\r\n   1419 \r\n   1420     @interfaces.legacy_generator_methods_support\r\n\r\n~/tf-1.9/lib/python3.5/site-packages/keras/engine/training_generator.py in fit_generator(model, generator, steps_per_epoch, epochs, verbose, callbacks, validation_data, validation_steps, class_weight, max_queue_size, workers, use_multiprocessing, shuffle, initial_epoch)\r\n    215                 outs = model.train_on_batch(x, y,\r\n    216                                             sample_weight=sample_weight,\r\n--> 217                                             class_weight=class_weight)\r\n    218 \r\n    219                 outs = to_list(outs)\r\n\r\n~/tf-1.9/lib/python3.5/site-packages/keras/engine/training.py in train_on_batch(self, x, y, sample_weight, class_weight)\r\n   1215             ins = x + y + sample_weights\r\n   1216         self._make_train_function()\r\n-> 1217         outputs = self.train_function(ins)\r\n   1218         return unpack_singleton(outputs)\r\n   1219 \r\n\r\n~/tf-1.9/lib/python3.5/site-packages/keras/backend/tensorflow_backend.py in __call__(self, inputs)\r\n   2713                 return self._legacy_call(inputs)\r\n   2714 \r\n-> 2715             return self._call(inputs)\r\n   2716         else:\r\n   2717             if py_any(is_tensor(x) for x in inputs):\r\n\r\n~/tf-1.9/lib/python3.5/site-packages/keras/backend/tensorflow_backend.py in _call(self, inputs)\r\n   2673             fetched = self._callable_fn(*array_vals, run_metadata=self.run_metadata)\r\n   2674         else:\r\n-> 2675             fetched = self._callable_fn(*array_vals)\r\n   2676         return fetched[:len(self.outputs)]\r\n   2677 \r\n\r\n~/tf-1.9/lib/python3.5/site-packages/tensorflow/python/client/session.py in __call__(self, *args, **kwargs)\r\n   1437           ret = tf_session.TF_SessionRunCallable(\r\n   1438               self._session._session, self._handle, args, status,\r\n-> 1439               run_metadata_ptr)\r\n   1440         if run_metadata:\r\n   1441           proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\r\n\r\n~/tf-1.9/lib/python3.5/site-packages/tensorflow/python/framework/errors_impl.py in __exit__(self, type_arg, value_arg, traceback_arg)\r\n    526             None, None,\r\n    527             compat.as_text(c_api.TF_Message(self.status.status)),\r\n--> 528             c_api.TF_GetCode(self.status.status))\r\n    529     # Delete the underlying status object from memory otherwise it stays alive\r\n    530     # as there is a reference to status from this from the traceback due to\r\n\r\nInvalidArgumentError: Input is not invertible.\r\n\t [[{{node training/Adam/gradients/loss/A_loss/MatrixDeterminant_grad/MatrixInverse}} = MatrixInverse[T=DT_FLOAT, _class=[\"loc:@training/Adam/gradients/AddN_3\"], adjoint=true, _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"](loss/A_loss/add)]]\r\n\t [[{{node loss/A_loss/Mean_2/_1443}} = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device_incarnation=1, tensor_name=\"edge_14823_loss/A_loss/Mean_2\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"]()]]\r\n```","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620470928/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620630459","html_url":"https://github.com/voxelmorph/voxelmorph/issues/178#issuecomment-620630459","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/178","id":620630459,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMDYzMDQ1OQ==","user":{"login":"vincentme","id":11166542,"node_id":"MDQ6VXNlcjExMTY2NTQy","avatar_url":"https://avatars.githubusercontent.com/u/11166542?v=4","gravatar_id":"","url":"https://api.github.com/users/vincentme","html_url":"https://github.com/vincentme","followers_url":"https://api.github.com/users/vincentme/followers","following_url":"https://api.github.com/users/vincentme/following{/other_user}","gists_url":"https://api.github.com/users/vincentme/gists{/gist_id}","starred_url":"https://api.github.com/users/vincentme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincentme/subscriptions","organizations_url":"https://api.github.com/users/vincentme/orgs","repos_url":"https://api.github.com/users/vincentme/repos","events_url":"https://api.github.com/users/vincentme/events{/privacy}","received_events_url":"https://api.github.com/users/vincentme/received_events","type":"User","site_admin":false},"created_at":"2020-04-28T14:07:55Z","updated_at":"2020-04-28T14:07:55Z","author_association":"NONE","body":"@HansLeonardVanBrueggemann\r\nI just test ncc function on a pair of images with ones or zeros, my code can give the correct cc as 1 and loss as -1. If your code can do the same, then I don't think the problem is the loss function. ","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620630459/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vincentme","id":11166542,"node_id":"MDQ6VXNlcjExMTY2NTQy","avatar_url":"https://avatars.githubusercontent.com/u/11166542?v=4","gravatar_id":"","url":"https://api.github.com/users/vincentme","html_url":"https://github.com/vincentme","followers_url":"https://api.github.com/users/vincentme/followers","following_url":"https://api.github.com/users/vincentme/following{/other_user}","gists_url":"https://api.github.com/users/vincentme/gists{/gist_id}","starred_url":"https://api.github.com/users/vincentme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincentme/subscriptions","organizations_url":"https://api.github.com/users/vincentme/orgs","repos_url":"https://api.github.com/users/vincentme/repos","events_url":"https://api.github.com/users/vincentme/events{/privacy}","received_events_url":"https://api.github.com/users/vincentme/received_events","type":"User","site_admin":false}},{"id":3280500010,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI4MDUwMDAxMA==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3280500010","actor":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-28T14:07:55Z","performed_via_github_app":null},{"id":3280500014,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyODA1MDAwMTQ=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3280500014","actor":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-28T14:07:55Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620632206","html_url":"https://github.com/voxelmorph/voxelmorph/issues/178#issuecomment-620632206","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/178","id":620632206,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMDYzMjIwNg==","user":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"created_at":"2020-04-28T14:10:59Z","updated_at":"2020-04-28T14:10:59Z","author_association":"COLLABORATOR","body":"@HansLeonardVanBrueggemann  can you try a much smaller learning rate and tell me what happens? I recall this being an issue with some datasets a long time ago, and it would be good to know if this is different. ","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620632206/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false}},{"id":3280513656,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI4MDUxMzY1Ng==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3280513656","actor":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-28T14:10:59Z","performed_via_github_app":null},{"id":3280513663,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyODA1MTM2NjM=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3280513663","actor":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-28T14:10:59Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620712827","html_url":"https://github.com/voxelmorph/voxelmorph/issues/178#issuecomment-620712827","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/178","id":620712827,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMDcxMjgyNw==","user":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false},"created_at":"2020-04-28T16:24:32Z","updated_at":"2020-04-28T16:26:44Z","author_association":"NONE","body":"> \r\n> \r\n> @HansLeonardVanBrueggemann can you try a much smaller learning rate and tell me what happens? I recall this being an issue with some datasets a long time ago, and it would be good to know if this is different.\r\n\r\ndecreased learning rate from 3e-5 to 3e-6 and i got the same error, on the first batch. \r\n\r\n> \r\n> \r\n> @HansLeonardVanBrueggemann\r\n> I just test ncc function on a pair of images with ones or zeros, my code can give the correct cc as 1 and loss as -1. If your code can do the same, then I don't think the problem is the loss function.\r\n\r\nok I'll take a look to the rest of the network. It works though if I use the standard MSE, meaning it trains. That is why I thought it was the loss function ","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620712827/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false}},{"id":3281124935,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI4MTEyNDkzNQ==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3281124935","actor":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-28T16:24:32Z","performed_via_github_app":null},{"id":3281124938,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyODExMjQ5Mzg=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3281124938","actor":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-28T16:24:32Z","performed_via_github_app":null},{"id":3281124944,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI4MTEyNDk0NA==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3281124944","actor":{"login":"vincentme","id":11166542,"node_id":"MDQ6VXNlcjExMTY2NTQy","avatar_url":"https://avatars.githubusercontent.com/u/11166542?v=4","gravatar_id":"","url":"https://api.github.com/users/vincentme","html_url":"https://github.com/vincentme","followers_url":"https://api.github.com/users/vincentme/followers","following_url":"https://api.github.com/users/vincentme/following{/other_user}","gists_url":"https://api.github.com/users/vincentme/gists{/gist_id}","starred_url":"https://api.github.com/users/vincentme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincentme/subscriptions","organizations_url":"https://api.github.com/users/vincentme/orgs","repos_url":"https://api.github.com/users/vincentme/repos","events_url":"https://api.github.com/users/vincentme/events{/privacy}","received_events_url":"https://api.github.com/users/vincentme/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-28T16:24:32Z","performed_via_github_app":null},{"id":3281124946,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyODExMjQ5NDY=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3281124946","actor":{"login":"vincentme","id":11166542,"node_id":"MDQ6VXNlcjExMTY2NTQy","avatar_url":"https://avatars.githubusercontent.com/u/11166542?v=4","gravatar_id":"","url":"https://api.github.com/users/vincentme","html_url":"https://github.com/vincentme","followers_url":"https://api.github.com/users/vincentme/followers","following_url":"https://api.github.com/users/vincentme/following{/other_user}","gists_url":"https://api.github.com/users/vincentme/gists{/gist_id}","starred_url":"https://api.github.com/users/vincentme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincentme/subscriptions","organizations_url":"https://api.github.com/users/vincentme/orgs","repos_url":"https://api.github.com/users/vincentme/repos","events_url":"https://api.github.com/users/vincentme/events{/privacy}","received_events_url":"https://api.github.com/users/vincentme/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-28T16:24:32Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620746455","html_url":"https://github.com/voxelmorph/voxelmorph/issues/178#issuecomment-620746455","issue_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/178","id":620746455,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMDc0NjQ1NQ==","user":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"created_at":"2020-04-28T17:26:06Z","updated_at":"2020-04-28T17:26:06Z","author_association":"COLLABORATOR","body":"@HansLeonardVanBrueggemann  this is surely silly but did you check that your images are, let's say between [0, 1] with no inf or nan values? Could you maybe share a screenshot of the images here?","reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/comments/620746455/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false}},{"id":3281366477,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI4MTM2NjQ3Nw==","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3281366477","actor":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-28T17:26:06Z","performed_via_github_app":null},{"id":3281366478,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyODEzNjY0Nzg=","url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/events/3281366478","actor":{"login":"HansLeonardVanBrueggemann","id":445665,"node_id":"MDQ6VXNlcjQ0NTY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/445665?v=4","gravatar_id":"","url":"https://api.github.com/users/HansLeonardVanBrueggemann","html_url":"https://github.com/HansLeonardVanBrueggemann","followers_url":"https://api.github.com/users/HansLeonardVanBrueggemann/followers","following_url":"https://api.github.com/users/HansLeonardVanBrueggemann/following{/other_user}","gists_url":"https://api.github.com/users/HansLeonardVanBrueggemann/gists{/gist_id}","starred_url":"https://api.github.com/users/HansLeonardVanBrueggemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HansLeonardVanBrueggemann/subscriptions","organizations_url":"https://api.github.com/users/HansLeonardVanBrueggemann/orgs","repos_url":"https://api.github.com/users/HansLeonardVanBrueggemann/repos","events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/events{/privacy}","received_events_url":"https://api.github.com/users/HansLeonardVanBrueggemann/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-28T17:26:06Z","performed_via_github_app":null}]