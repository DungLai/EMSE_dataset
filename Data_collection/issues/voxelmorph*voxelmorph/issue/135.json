{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/135","repository_url":"https://api.github.com/repos/voxelmorph/voxelmorph","labels_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/135/labels{/name}","comments_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/135/comments","events_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/135/events","html_url":"https://github.com/voxelmorph/voxelmorph/issues/135","id":536311962,"node_id":"MDU6SXNzdWU1MzYzMTE5NjI=","number":135,"title":"Can anybody explain how the ncc loss function works?","user":{"login":"chuxiang93","id":11666931,"node_id":"MDQ6VXNlcjExNjY2OTMx","avatar_url":"https://avatars.githubusercontent.com/u/11666931?v=4","gravatar_id":"","url":"https://api.github.com/users/chuxiang93","html_url":"https://github.com/chuxiang93","followers_url":"https://api.github.com/users/chuxiang93/followers","following_url":"https://api.github.com/users/chuxiang93/following{/other_user}","gists_url":"https://api.github.com/users/chuxiang93/gists{/gist_id}","starred_url":"https://api.github.com/users/chuxiang93/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chuxiang93/subscriptions","organizations_url":"https://api.github.com/users/chuxiang93/orgs","repos_url":"https://api.github.com/users/chuxiang93/repos","events_url":"https://api.github.com/users/chuxiang93/events{/privacy}","received_events_url":"https://api.github.com/users/chuxiang93/received_events","type":"User","site_admin":false},"labels":[{"id":1347467145,"node_id":"MDU6TGFiZWwxMzQ3NDY3MTQ1","url":"https://api.github.com/repos/voxelmorph/voxelmorph/labels/voxelmorph","name":"voxelmorph","color":"1d76db","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-12-11T11:32:09Z","updated_at":"2020-02-12T04:27:10Z","closed_at":"2020-02-12T04:27:03Z","author_association":"NONE","active_lock_reason":null,"body":"I see in the code: \r\n# compute local sums via convolution\r\n        I_sum = conv_fn(I, sum_filt, strides, padding)\r\n        J_sum = conv_fn(J, sum_filt, strides, padding)\r\n        I2_sum = conv_fn(I2, sum_filt, strides, padding)\r\n        J2_sum = conv_fn(J2, sum_filt, strides, padding)\r\n        IJ_sum = conv_fn(IJ, sum_filt, strides, padding)\r\n\r\n        # compute cross correlation\r\n        win_size = np.prod(self.win)\r\n        u_I = I_sum/win_size\r\n        u_J = J_sum/win_size\r\n\r\n        cross = IJ_sum - u_J*I_sum - u_I*J_sum + u_I*u_J*win_size\r\n        I_var = I2_sum - 2 * u_I * I_sum + u_I*u_I*win_size\r\n        J_var = J2_sum - 2 * u_J * J_sum + u_J*u_J*win_size\r\n\r\n        cc = cross*cross / (I_var*J_var + self.eps)\r\n\r\n        # return negative cc.\r\n        return tf.reduce_mean(cc)\r\n\r\nAnd in the article:\r\n![image](https://user-images.githubusercontent.com/11666931/70618030-cebff400-1c4c-11ea-9957-2c81b67aecc2.png)\r\n\r\nBut I always feel that the code doesn't match the formulaï¼Œcan anybody explain the ncc loss function?\r\n\r\n","closed_by":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/135/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/135/timeline","performed_via_github_app":null,"state_reason":"completed"}