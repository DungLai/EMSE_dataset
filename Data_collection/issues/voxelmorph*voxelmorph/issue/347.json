{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/347","repository_url":"https://api.github.com/repos/voxelmorph/voxelmorph","labels_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/347/labels{/name}","comments_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/347/comments","events_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/347/events","html_url":"https://github.com/voxelmorph/voxelmorph/issues/347","id":998255076,"node_id":"I_kwDOB_Nd2847gCnk","number":347,"title":"Model output error when using train_synthmorph.py ","user":{"login":"bensarthou","id":37699244,"node_id":"MDQ6VXNlcjM3Njk5MjQ0","avatar_url":"https://avatars.githubusercontent.com/u/37699244?v=4","gravatar_id":"","url":"https://api.github.com/users/bensarthou","html_url":"https://github.com/bensarthou","followers_url":"https://api.github.com/users/bensarthou/followers","following_url":"https://api.github.com/users/bensarthou/following{/other_user}","gists_url":"https://api.github.com/users/bensarthou/gists{/gist_id}","starred_url":"https://api.github.com/users/bensarthou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bensarthou/subscriptions","organizations_url":"https://api.github.com/users/bensarthou/orgs","repos_url":"https://api.github.com/users/bensarthou/repos","events_url":"https://api.github.com/users/bensarthou/events{/privacy}","received_events_url":"https://api.github.com/users/bensarthou/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2021-09-16T14:03:44Z","updated_at":"2021-09-20T17:24:15Z","closed_at":"2021-09-20T17:24:15Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, \r\n\r\n**Task: Train SynthMorph model on a set of label using train_synthmorph.py** \r\n\r\nI want to train the SynthMorph model on a set of generated labels, using the example script provided in scripts/tf. \r\n\r\n**What have you tried**\r\n\r\nI'm using the dev branch, uptodate at 16/09/2021 (d7d13fa756fd6fbe22b1f60a13b65df37b952784), with tensorflow/keras 2.6.0\r\nVoxelmorph was installed via setup.py, as well as neurite and pystrum\r\n\r\nI generated the labels (with my own code) using the \"shape\" method described in the SynthMorph paper and stored them in a folder with the glob pattern below (in .nii.gz file, with 26 labels; of size 160x160x192)\r\n\r\nWhen I launch the command `python scripts\\tf\\train_synthmorph.py --label-dir e:\\data\\SynthShapes\\*\\*_origin_label_map.nii.gz --model-dir e:\\data\\models_SM_shapes_210916\\ --out-labels e:\\data\\models_vxm\\labels_shapes.npz`, it seems that it correctly load the data (it carries on without issues after the labels_to_image l157) but when the training starts (calling model.fit l196); it stops with the following error: \r\n\r\n```ValueError: ('Error when checking model target: expected no data, but got:', [array([[[[[0., 0., 0.],...```\r\n\r\n**Details**\r\nI found that tensorflow issued warnings when compiling the model: \r\n\r\n```WARNING:tensorflow:Output vxm_dense_transformer missing from loss dictionary. We assume this was done on purpose. The fit and evaluate APIs will not be expecting any data to be passed to vxm_dense_transformer.\r\nWARNING:tensorflow:Output vxm_dense_flow missing from loss dictionary. We assume this was done on purpose. The fit and evaluate APIs will not be expecting any data to be passed to vxm_dense_flow.\r\n```\r\nWhich would be coherent with the above error, as it seems vxm_dense_flow is never given to a loss (according to the error, not the code), whereas the grad Loss requires it.\r\n\r\nI tried to dig into the VxmDense class to see from where the error could come from but I wasn't able to find the culprit\r\nMaybe I am using wrongly the train_synthmorph script ?\r\n\r\nThanks in advance for your help, ","closed_by":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/347/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/347/timeline","performed_via_github_app":null,"state_reason":"completed"}