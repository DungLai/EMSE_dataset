{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/68","repository_url":"https://api.github.com/repos/voxelmorph/voxelmorph","labels_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/68/labels{/name}","comments_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/68/comments","events_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/68/events","html_url":"https://github.com/voxelmorph/voxelmorph/issues/68","id":464350929,"node_id":"MDU6SXNzdWU0NjQzNTA5Mjk=","number":68,"title":"Error loading trained models","user":{"login":"samnewhook","id":18132430,"node_id":"MDQ6VXNlcjE4MTMyNDMw","avatar_url":"https://avatars.githubusercontent.com/u/18132430?v=4","gravatar_id":"","url":"https://api.github.com/users/samnewhook","html_url":"https://github.com/samnewhook","followers_url":"https://api.github.com/users/samnewhook/followers","following_url":"https://api.github.com/users/samnewhook/following{/other_user}","gists_url":"https://api.github.com/users/samnewhook/gists{/gist_id}","starred_url":"https://api.github.com/users/samnewhook/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samnewhook/subscriptions","organizations_url":"https://api.github.com/users/samnewhook/orgs","repos_url":"https://api.github.com/users/samnewhook/repos","events_url":"https://api.github.com/users/samnewhook/events{/privacy}","received_events_url":"https://api.github.com/users/samnewhook/received_events","type":"User","site_admin":false},"labels":[{"id":1347467145,"node_id":"MDU6TGFiZWwxMzQ3NDY3MTQ1","url":"https://api.github.com/repos/voxelmorph/voxelmorph/labels/voxelmorph","name":"voxelmorph","color":"1d76db","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2019-07-04T17:11:55Z","updated_at":"2019-08-29T16:53:26Z","closed_at":"2019-07-05T02:05:27Z","author_association":"NONE","active_lock_reason":null,"body":"Hello author(s),\r\nAmazing work and thank you for sharing your code!\r\nI am trying to extend your work by training models using Spinal CT images and I am running into a problem when loading the models trained with your code. I am using .nii files scaled [0, 1] and of size (128, 128, 96) to train and have seemingly successfully run 1500 epochs, however, only the model trained on the first epoch will load when running the register.py file. All others fail with the following error: \r\n```Traceback (most recent call last):\r\n  File \"/home/phoenixyuwilkie/miniconda3/envs/obl_tf/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 1694, in ones\r\n    tensor_shape.TensorShape(shape))\r\n  File \"/home/phoenixyuwilkie/miniconda3/envs/obl_tf/lib/python3.6/site-packages/tensorflow/python/framework/constant_op.py\", line 250, in _tensor_shape_tensor_conversion_function\r\n    \"Cannot convert a partially known TensorShape to a Tensor: %s\" % s)\r\nValueError: Cannot convert a partially known TensorShape to a Tensor: (1, ?, ?, ?, 3)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"register.py\", line 103, in <module>\r\n    register(**vars(args))\r\n  File \"register.py\", line 66, in register\r\n    net = keras.models.load_model(model_file, custom_objects=custom_objects)\r\n  File \"/home/phoenixyuwilkie/.local/lib/python3.6/site-packages/keras/engine/saving.py\", line 419, in load_model\r\n    model = _deserialize_model(f, custom_objects, compile)\r\n  File \"/home/phoenixyuwilkie/.local/lib/python3.6/site-packages/keras/engine/saving.py\", line 312, in _deserialize_model\r\n    sample_weight_mode=sample_weight_mode)\r\n  File \"/home/phoenixyuwilkie/.local/lib/python3.6/site-packages/keras/engine/training.py\", line 342, in compile\r\n    sample_weight, mask)\r\n  File \"/home/phoenixyuwilkie/.local/lib/python3.6/site-packages/keras/engine/training_utils.py\", line 404, in weighted\r\n    score_array = fn(y_true, y_pred)\r\n  File \"/home/phoenixyuwilkie/Documents/Sam/obl_voxelmorph/src/losses.py\", line 221, in kl_loss\r\n    self.D = self._degree_matrix(self.flow_vol_shape)\r\n  File \"/home/phoenixyuwilkie/Documents/Sam/obl_voxelmorph/src/losses.py\", line 168, in _degree_matrix\r\n    z = K.ones([1] + sz)\r\n  File \"/home/phoenixyuwilkie/.local/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py\", line 734, in ones\r\n    v = tf.ones(shape=shape, dtype=tf_dtype, name=name)\r\n  File \"/home/phoenixyuwilkie/miniconda3/envs/obl_tf/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 1697, in ones\r\n    shape = ops.convert_to_tensor(shape, dtype=dtypes.int32)\r\n  File \"/home/phoenixyuwilkie/miniconda3/envs/obl_tf/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1050, in convert_to_tensor\r\n    as_ref=False)\r\n  File \"/home/phoenixyuwilkie/miniconda3/envs/obl_tf/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1146, in internal_convert_to_tensor\r\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\r\n  File \"/home/phoenixyuwilkie/miniconda3/envs/obl_tf/lib/python3.6/site-packages/tensorflow/python/framework/constant_op.py\", line 229, in _constant_tensor_conversion_function\r\n    return constant(v, dtype=dtype, name=name)\r\n  File \"/home/phoenixyuwilkie/miniconda3/envs/obl_tf/lib/python3.6/site-packages/tensorflow/python/framework/constant_op.py\", line 208, in constant\r\n    value, dtype=dtype, shape=shape, verify_shape=verify_shape))\r\n  File \"/home/phoenixyuwilkie/miniconda3/envs/obl_tf/lib/python3.6/site-packages/tensorflow/python/framework/tensor_util.py\", line 442, in make_tensor_proto\r\n    _AssertCompatible(values, dtype)\r\n  File \"/home/phoenixyuwilkie/miniconda3/envs/obl_tf/lib/python3.6/site-packages/tensorflow/python/framework/tensor_util.py\", line 353, in _AssertCompatible\r\n    (dtype.name, repr(mismatch), type(mismatch).__name__))\r\nTypeError: Expected int32, got None of type '_Message' instead.\r\n```\r\nThe training seems to have completed, I have attached the output from running the train_miccai2018.py file.\r\n[nohup.txt](https://github.com/voxelmorph/voxelmorph/files/3360115/nohup.txt)\r\n\r\n\r\nThank you,\r\nSamuel Newhook","closed_by":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/68/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/68/timeline","performed_via_github_app":null,"state_reason":"completed"}