{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/266","repository_url":"https://api.github.com/repos/voxelmorph/voxelmorph","labels_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/266/labels{/name}","comments_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/266/comments","events_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/266/events","html_url":"https://github.com/voxelmorph/voxelmorph/issues/266","id":792916041,"node_id":"MDU6SXNzdWU3OTI5MTYwNDE=","number":266,"title":"There are some problems with the Transformation Matrices issued by the Voxelmorph!","user":{"login":"boveiri","id":52887476,"node_id":"MDQ6VXNlcjUyODg3NDc2","avatar_url":"https://avatars.githubusercontent.com/u/52887476?v=4","gravatar_id":"","url":"https://api.github.com/users/boveiri","html_url":"https://github.com/boveiri","followers_url":"https://api.github.com/users/boveiri/followers","following_url":"https://api.github.com/users/boveiri/following{/other_user}","gists_url":"https://api.github.com/users/boveiri/gists{/gist_id}","starred_url":"https://api.github.com/users/boveiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boveiri/subscriptions","organizations_url":"https://api.github.com/users/boveiri/orgs","repos_url":"https://api.github.com/users/boveiri/repos","events_url":"https://api.github.com/users/boveiri/events{/privacy}","received_events_url":"https://api.github.com/users/boveiri/received_events","type":"User","site_admin":false},"labels":[{"id":1347467145,"node_id":"MDU6TGFiZWwxMzQ3NDY3MTQ1","url":"https://api.github.com/repos/voxelmorph/voxelmorph/labels/voxelmorph","name":"voxelmorph","color":"1d76db","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":18,"created_at":"2021-01-24T22:22:50Z","updated_at":"2021-02-07T20:16:48Z","closed_at":"2021-01-26T22:08:09Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, I have some problems with the Transformation Matrices issued by the Voxelmorph. It will be highly appreciated if someone can guide me since I am almost at the end of a research project.\r\n\r\nI used the Voxelmorph for 2D multimodal co-registration i.e. the registration of a patient's CT on his/her own MR image. The big picture of the system is as follows:\r\n\r\n![1](https://user-images.githubusercontent.com/52887476/105644851-2222ef00-5ead-11eb-9937-530dc628eaf1.jpg)\r\n\r\nBut there is a problem when I want to calculate TRE (Target Registration Error) using my manually annotated landmarks. Actually, when I apply the output of the network with the shape of (6, ) as an Affine Transformation Matrix to my moving image using SpatialTransformer layer hosted in the Neuron package, everything is good and my moved (warped) image is generated correctly. But, when I want to apply the output of the network with the shape of (6, ) as an Affine Transformation Matrix to my moving image using e.g. PIL.Image.transform or using simple matrix multiplication with the coordination of my landmarks to compute the TRE, the results are not as expected and most of the landmarks would fall outside of the image, though the warped image has some slight transformation.\r\n\r\nFor example, for the following pair of images, the output of the network is the following Transformation Matrix (the subplots are moving image, fix image, and warped image, respectively):\r\n\r\n![WhatsApp Image 2021-01-25 at 01 44 42](https://user-images.githubusercontent.com/52887476/105645371-577d0c00-5eb0-11eb-931c-d96206356f79.jpeg)\r\n\r\nNetwork_Output = [0.05199242, -0.07193471, -2.9393158,  0.11451177, -0.01375515, 0.57087]\r\n\r\nOriginal_Landmark_Location = [95, 134]\r\n\r\nMoved_Landmark_Location = [-7.5, 4.9] = np.array(Network_Output).reshape(2, 3) @ np.array(Original_Landmark_Location)\r\n\r\nAs it can be seen, whole the foreground of warped image is inside the image, but the calculated Moved_Landmark_Location goes far outside the image using the affine transformation matrix outputted by the Voxelmorph! The inputted fix and moving images (CT and MR) are both in the (256, 256, 1) shape.\r\n\r\nMany thanks for your time and energy. ","closed_by":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/266/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/266/timeline","performed_via_github_app":null,"state_reason":"completed"}