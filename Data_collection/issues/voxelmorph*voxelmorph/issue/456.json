{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/456","repository_url":"https://api.github.com/repos/voxelmorph/voxelmorph","labels_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/456/labels{/name}","comments_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/456/comments","events_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/456/events","html_url":"https://github.com/voxelmorph/voxelmorph/issues/456","id":1301523309,"node_id":"I_kwDOB_Nd285Nk6tt","number":456,"title":"Pair-wise registration question","user":{"login":"dfvr1994","id":45764991,"node_id":"MDQ6VXNlcjQ1NzY0OTkx","avatar_url":"https://avatars.githubusercontent.com/u/45764991?v=4","gravatar_id":"","url":"https://api.github.com/users/dfvr1994","html_url":"https://github.com/dfvr1994","followers_url":"https://api.github.com/users/dfvr1994/followers","following_url":"https://api.github.com/users/dfvr1994/following{/other_user}","gists_url":"https://api.github.com/users/dfvr1994/gists{/gist_id}","starred_url":"https://api.github.com/users/dfvr1994/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dfvr1994/subscriptions","organizations_url":"https://api.github.com/users/dfvr1994/orgs","repos_url":"https://api.github.com/users/dfvr1994/repos","events_url":"https://api.github.com/users/dfvr1994/events{/privacy}","received_events_url":"https://api.github.com/users/dfvr1994/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-07-12T04:32:58Z","updated_at":"2022-07-12T05:36:57Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Here http://tutorial.voxelmorph.net/ the `vxm_data_generator` only accepts the input from `x_train` and generates moving, fixed, moved groud-truth (fixed), and phi. \r\n\r\nHow can I tell the network to _moving_ comes from `x_train`, and _fixed_ from `y_train` ?\r\n\r\nOn my dataset I have pairs of images of the same surface taken from two slightly different perspectives, hence the pairs. \r\n\r\nWould this be correct? \r\n\r\n```\r\ndef vxm_data_generator(x_data, y_data, batch_size=32):\r\n    \"\"\"\r\n    Generator that takes in data of size [N, H, W], and yields data for\r\n    our custom vxm model. Note that we need to provide numpy data for each\r\n    input, and each output.\r\n\r\n    inputs:  moving [bs, H, W, 1], fixed image [bs, H, W, 1]\r\n    outputs: moved image [bs, H, W, 1], zero-gradient [bs, H, W, 2]\r\n    \"\"\"\r\n\r\n    # preliminary sizing\r\n    vol_shape = x_data.shape[1:] # extract data shape\r\n    ndims = len(vol_shape)\r\n    \r\n    # prepare a zero array the size of the deformation\r\n    # we'll explain this below\r\n    zero_phi = np.zeros([batch_size, *vol_shape, ndims])\r\n    \r\n    while True:\r\n        # prepare inputs:\r\n        # images need to be of the size [batch_size, H, W, 1]\r\n        idx1 = np.random.randint(0, x_data.shape[0], size=batch_size)\r\n        #moving_images = x_data[idx1, ..., np.newaxis]\r\n        moving_images = x_data[idx1, ...]\r\n        idx2 = np.random.randint(0, x_data.shape[0], size=batch_size)\r\n        #fixed_images = x_data[idx2, ..., np.newaxis]\r\n        fixed_images = y_data[idx1, ...]\r\n        inputs = [moving_images, fixed_images]\r\n        \r\n        # prepare outputs (the 'true' moved image):\r\n        # of course, we don't have this, but we know we want to compare \r\n        # the resulting moved image with the fixed image. \r\n        # we also wish to penalize the deformation field. \r\n        outputs = [fixed_images, zero_phi]\r\n        \r\n        yield (inputs, outputs)\r\n```\r\n\r\nand then: \r\n\r\n`train_generator = vxm_data_generator(x_train, y_train)`\r\n\r\nThe flow looks like this using `scale=0.07`. Otherwise I can't even see the arrows. \r\n\r\n![image](https://user-images.githubusercontent.com/45764991/178408945-58c3d257-f025-450b-a52e-f58b7327be19.png)\r\n\r\nLoss graph:\r\n\r\n![image](https://user-images.githubusercontent.com/45764991/178416399-54961ea1-af41-412a-b43e-d2fd2a1b3f79.png)\r\n\r\n\r\n\r\n\r\nHow can I improve it? \r\n\r\nThanks","closed_by":null,"reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/456/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/456/timeline","performed_via_github_app":null,"state_reason":null}