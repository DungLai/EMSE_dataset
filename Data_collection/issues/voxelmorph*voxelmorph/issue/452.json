{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/452","repository_url":"https://api.github.com/repos/voxelmorph/voxelmorph","labels_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/452/labels{/name}","comments_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/452/comments","events_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/452/events","html_url":"https://github.com/voxelmorph/voxelmorph/issues/452","id":1298697449,"node_id":"I_kwDOB_Nd285NaIzp","number":452,"title":"Cannot load pre-trained weight `.h5` of VoxelMorph using PyTorch","user":{"login":"Chrisa142857","id":32612977,"node_id":"MDQ6VXNlcjMyNjEyOTc3","avatar_url":"https://avatars.githubusercontent.com/u/32612977?v=4","gravatar_id":"","url":"https://api.github.com/users/Chrisa142857","html_url":"https://github.com/Chrisa142857","followers_url":"https://api.github.com/users/Chrisa142857/followers","following_url":"https://api.github.com/users/Chrisa142857/following{/other_user}","gists_url":"https://api.github.com/users/Chrisa142857/gists{/gist_id}","starred_url":"https://api.github.com/users/Chrisa142857/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Chrisa142857/subscriptions","organizations_url":"https://api.github.com/users/Chrisa142857/orgs","repos_url":"https://api.github.com/users/Chrisa142857/repos","events_url":"https://api.github.com/users/Chrisa142857/events{/privacy}","received_events_url":"https://api.github.com/users/Chrisa142857/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-07-08T08:49:08Z","updated_at":"2022-12-13T08:45:11Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"**Task** (what are you trying to do/register?)\r\n\r\nRegister using the pre-trained VoxelMorph Unet. Always Failed when loading `.h5`.\r\n\r\n**What have you tried**\r\n\r\nCode is simple:\r\n```\r\nimport torch\r\nm = torch.load(\"vxm_dense_brain_T1_3D_mse.h5\") \r\n```\r\nOutput:\r\n```\r\nTraceback (most recent call last):\r\n  File \"NLST/val_NLST.py\", line 49, in <module>\r\n    evaluate_L2R(args, config_path, out_path)\r\n  File \"NLST/val_NLST.py\", line 30, in evaluate_L2R\r\n    reg(args)\r\n  File \"/content/NLST/register.py\", line 66, in main\r\n    model = vxm.networks.VxmDense.load(args.model, device)\r\n  File \"/usr/local/lib/python3.7/dist-packages/voxelmorph/torch/modelio.py\", line 74, in load\r\n    checkpoint = torch.load(path, map_location=torch.device(device))\r\n  File \"/usr/local/lib/python3.7/dist-packages/torch/serialization.py\", line 713, in load\r\n    return _legacy_load(opened_file, map_location, pickle_module, **pickle_load_args)\r\n  File \"/usr/local/lib/python3.7/dist-packages/torch/serialization.py\", line 920, in _legacy_load\r\n    magic_number = pickle_module.load(f, **pickle_load_args)\r\n_pickle.UnpicklingError: invalid load key, 'H'.\r\n```\r\n\r\nHave tried on \r\n- my laptop\r\nOS: Win10\r\nGPU: GTX 970m\r\nCPU: Intel i7-6700HQ\r\n`torch.__version__ = '1.6.0+cu101'`\r\n\r\n- colab in [this link](https://colab.research.google.com/drive/1f9V30J5eyD-m1viJVSJKVkASeMXiBA8k?usp=sharing).\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/452/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/452/timeline","performed_via_github_app":null,"state_reason":null}