{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/285","repository_url":"https://api.github.com/repos/voxelmorph/voxelmorph","labels_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/285/labels{/name}","comments_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/285/comments","events_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/285/events","html_url":"https://github.com/voxelmorph/voxelmorph/issues/285","id":839705443,"node_id":"MDU6SXNzdWU4Mzk3MDU0NDM=","number":285,"title":"Weird behavior on a toy dataset","user":{"login":"mys007","id":5921083,"node_id":"MDQ6VXNlcjU5MjEwODM=","avatar_url":"https://avatars.githubusercontent.com/u/5921083?v=4","gravatar_id":"","url":"https://api.github.com/users/mys007","html_url":"https://github.com/mys007","followers_url":"https://api.github.com/users/mys007/followers","following_url":"https://api.github.com/users/mys007/following{/other_user}","gists_url":"https://api.github.com/users/mys007/gists{/gist_id}","starred_url":"https://api.github.com/users/mys007/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mys007/subscriptions","organizations_url":"https://api.github.com/users/mys007/orgs","repos_url":"https://api.github.com/users/mys007/repos","events_url":"https://api.github.com/users/mys007/events{/privacy}","received_events_url":"https://api.github.com/users/mys007/received_events","type":"User","site_admin":false},"labels":[{"id":1347467145,"node_id":"MDU6TGFiZWwxMzQ3NDY3MTQ1","url":"https://api.github.com/repos/voxelmorph/voxelmorph/labels/voxelmorph","name":"voxelmorph","color":"1d76db","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2021-03-24T13:08:25Z","updated_at":"2021-03-25T12:32:41Z","closed_at":"2021-03-25T12:11:02Z","author_association":"NONE","active_lock_reason":null,"body":"I'm trying to understand the behavior of VoxelMorph (PyTorch version, current master) by overfitting on a 2D toy dataset. The dataset consists of a single image pair with 2 rectangles which overlap to a certain degree (AFAIK VoxelMorph cannot deal with non-overlapping ones because there is no multi-scale loss). The generator is simple:\r\n```\r\ndef toy_square_reg(batch_size=1, **kwargs):\r\n    empty = np.zeros((batch_size, 512, 512, 1))\r\n    img1 = np.zeros((batch_size, 512, 512, 1))\r\n    img2 = np.zeros((batch_size, 512, 512, 1))\r\n    img1[:,100:150, 200:300] = 1\r\n    img1[:,300:350, 200:300] = 2\r\n    img2[:,100:150, 290:320] = 1\r\n    img2[:,300:350, 200:260] = 2\r\n    while True:\r\n        invols  = [img1, img2]\r\n        outvols = [img2, img1]\r\n        yield (invols, outvols)     \r\n```\r\n\r\nI use default parameters but no regularization in a wish to arrive at 0 loss - but it does not converge. See this [video](https://github.com/voxelmorph/voxelmorph/files/6197393/voxelmorph_toy_lambda0.zip) for step-by-step behavior of the fixed image, the moving image and the deformation field. \r\n\r\nThere are two issues:\r\n\r\n1) One of the boxes is subject to an unexpected deformation. There seems to be some kind of \"link\" between the two boxes, which intuitively should not be if there is no regularization.\r\n2) In general, boxes tend to get \"streaks\" or \"mustaches\" at corners until they have converged. I have observed these artifacts also on real-world data where VoxelMorph tends to produce van-Gogh-like artifacts.\r\n\r\nNote that the following observations hold also when L2 gradient regularizer is used. Alas with increasingly strong `lambda` the network sort of gets it right but one see it really fights hard. For example, see this [video](https://github.com/voxelmorph/voxelmorph/files/6197391/voxelmorph_toy_lambda0.1.mkv.zip) for `lambda=0.1`.\r\n\r\nI would be very happy for any insights, thanks!","closed_by":{"login":"adalca","id":3219675,"node_id":"MDQ6VXNlcjMyMTk2NzU=","avatar_url":"https://avatars.githubusercontent.com/u/3219675?v=4","gravatar_id":"","url":"https://api.github.com/users/adalca","html_url":"https://github.com/adalca","followers_url":"https://api.github.com/users/adalca/followers","following_url":"https://api.github.com/users/adalca/following{/other_user}","gists_url":"https://api.github.com/users/adalca/gists{/gist_id}","starred_url":"https://api.github.com/users/adalca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalca/subscriptions","organizations_url":"https://api.github.com/users/adalca/orgs","repos_url":"https://api.github.com/users/adalca/repos","events_url":"https://api.github.com/users/adalca/events{/privacy}","received_events_url":"https://api.github.com/users/adalca/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/285/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/285/timeline","performed_via_github_app":null,"state_reason":"completed"}