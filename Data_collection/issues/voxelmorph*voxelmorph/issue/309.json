{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/309","repository_url":"https://api.github.com/repos/voxelmorph/voxelmorph","labels_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/309/labels{/name}","comments_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/309/comments","events_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/309/events","html_url":"https://github.com/voxelmorph/voxelmorph/issues/309","id":881042840,"node_id":"MDU6SXNzdWU4ODEwNDI4NDA=","number":309,"title":"Mismatch between pre-trained model (atlas_creation_cond_NCC_1022.h5) and provided script (train_cond_template.py)","user":{"login":"Fjr9516","id":31833999,"node_id":"MDQ6VXNlcjMxODMzOTk5","avatar_url":"https://avatars.githubusercontent.com/u/31833999?v=4","gravatar_id":"","url":"https://api.github.com/users/Fjr9516","html_url":"https://github.com/Fjr9516","followers_url":"https://api.github.com/users/Fjr9516/followers","following_url":"https://api.github.com/users/Fjr9516/following{/other_user}","gists_url":"https://api.github.com/users/Fjr9516/gists{/gist_id}","starred_url":"https://api.github.com/users/Fjr9516/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Fjr9516/subscriptions","organizations_url":"https://api.github.com/users/Fjr9516/orgs","repos_url":"https://api.github.com/users/Fjr9516/repos","events_url":"https://api.github.com/users/Fjr9516/events{/privacy}","received_events_url":"https://api.github.com/users/Fjr9516/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-05-08T16:48:48Z","updated_at":"2022-07-21T12:04:52Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"**Task** \r\nI am trying to load your pre-trained h5 format weights (conditional one) using the script train_cond_template.py. But it seems these two models are mismatched.\r\nFor example, in train_cond_template.py,   you used this to build the model:  \r\n```\r\nmodel = vxm.networks.ConditionalTemplateCreation(\r\n        inshape,\r\n        pheno_input_shape=pheno_shape,\r\n        nb_unet_features = [ enc_nf , dec_nf ],\r\n        conv_nb_features=4,\r\n        conv_nb_levels=0,\r\n        extra_conv_layers=3,\r\n        src_feats=nfeats,\r\n        trg_feats = nfeats\r\n    )\r\n```\r\nI just used the default parameters to build the model; the model should have 57 layers.\r\n\r\nHowever, in pre-trained (atlas_creation_cond_NCC_1022.h5) model, I found there are only 50 layers. After carefully comparing the differences between the two models, I was even more confused. \r\nIn the pre-trained model you provided, there are several more layers that the original model did not have, such as:\r\n![image](https://user-images.githubusercontent.com/31833999/117546776-73a25480-b02c-11eb-85e8-d1f80627f333.png)\r\n![image](https://user-images.githubusercontent.com/31833999/117547114-2aeb9b00-b02e-11eb-8674-9e69d9f06884.png)\r\n\r\nAnd no max-pooling layers in the U-Net. Moreover, the encoder has 4 layers, and the decoder has only 3 layers.\r\n![image](https://user-images.githubusercontent.com/31833999/117546856-e57a9e00-b02c-11eb-86de-86505ebd0753.png)\r\n \r\nI'm not sure how some of your layers are implemented, such as the 'atlasmodel_up' layer and the 'atlasmodel_conv_uparm' layer?\r\n\r\nCan you give me some help on using the pre-trained weights(especially the conditional one)?\r\n\r\nI would be grateful for your help!\r\n\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/309/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/voxelmorph/voxelmorph/issues/309/timeline","performed_via_github_app":null,"state_reason":null}