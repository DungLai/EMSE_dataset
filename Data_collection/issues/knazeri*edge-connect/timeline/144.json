[{"url":"https://api.github.com/repos/knazeri/edge-connect/issues/comments/619342897","html_url":"https://github.com/knazeri/edge-connect/issues/144#issuecomment-619342897","issue_url":"https://api.github.com/repos/knazeri/edge-connect/issues/144","id":619342897,"node_id":"MDEyOklzc3VlQ29tbWVudDYxOTM0Mjg5Nw==","user":{"login":"rainadam","id":36543713,"node_id":"MDQ6VXNlcjM2NTQzNzEz","avatar_url":"https://avatars.githubusercontent.com/u/36543713?v=4","gravatar_id":"","url":"https://api.github.com/users/rainadam","html_url":"https://github.com/rainadam","followers_url":"https://api.github.com/users/rainadam/followers","following_url":"https://api.github.com/users/rainadam/following{/other_user}","gists_url":"https://api.github.com/users/rainadam/gists{/gist_id}","starred_url":"https://api.github.com/users/rainadam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rainadam/subscriptions","organizations_url":"https://api.github.com/users/rainadam/orgs","repos_url":"https://api.github.com/users/rainadam/repos","events_url":"https://api.github.com/users/rainadam/events{/privacy}","received_events_url":"https://api.github.com/users/rainadam/received_events","type":"User","site_admin":false},"created_at":"2020-04-25T08:32:12Z","updated_at":"2020-04-25T08:32:12Z","author_association":"NONE","body":"I wonder too","reactions":{"url":"https://api.github.com/repos/knazeri/edge-connect/issues/comments/619342897/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rainadam","id":36543713,"node_id":"MDQ6VXNlcjM2NTQzNzEz","avatar_url":"https://avatars.githubusercontent.com/u/36543713?v=4","gravatar_id":"","url":"https://api.github.com/users/rainadam","html_url":"https://github.com/rainadam","followers_url":"https://api.github.com/users/rainadam/followers","following_url":"https://api.github.com/users/rainadam/following{/other_user}","gists_url":"https://api.github.com/users/rainadam/gists{/gist_id}","starred_url":"https://api.github.com/users/rainadam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rainadam/subscriptions","organizations_url":"https://api.github.com/users/rainadam/orgs","repos_url":"https://api.github.com/users/rainadam/repos","events_url":"https://api.github.com/users/rainadam/events{/privacy}","received_events_url":"https://api.github.com/users/rainadam/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/knazeri/edge-connect/issues/comments/619672407","html_url":"https://github.com/knazeri/edge-connect/issues/144#issuecomment-619672407","issue_url":"https://api.github.com/repos/knazeri/edge-connect/issues/144","id":619672407,"node_id":"MDEyOklzc3VlQ29tbWVudDYxOTY3MjQwNw==","user":{"login":"12ycli","id":10368281,"node_id":"MDQ6VXNlcjEwMzY4Mjgx","avatar_url":"https://avatars.githubusercontent.com/u/10368281?v=4","gravatar_id":"","url":"https://api.github.com/users/12ycli","html_url":"https://github.com/12ycli","followers_url":"https://api.github.com/users/12ycli/followers","following_url":"https://api.github.com/users/12ycli/following{/other_user}","gists_url":"https://api.github.com/users/12ycli/gists{/gist_id}","starred_url":"https://api.github.com/users/12ycli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/12ycli/subscriptions","organizations_url":"https://api.github.com/users/12ycli/orgs","repos_url":"https://api.github.com/users/12ycli/repos","events_url":"https://api.github.com/users/12ycli/events{/privacy}","received_events_url":"https://api.github.com/users/12ycli/received_events","type":"User","site_admin":false},"created_at":"2020-04-27T02:20:29Z","updated_at":"2020-04-27T02:20:29Z","author_association":"NONE","body":"> I wonder too\r\n\r\nFrom what the code show in edgeconnect. Model 3 only backpropagates for inpaint model, but use the output of edge_model as edge input. Model 4 backpropagates for edge model and inpaint model.\r\n```\r\n               # inpaint with edge model\r\n                elif model == 3:\r\n                    # train\r\n                    if True or np.random.binomial(1, 0.5) > 0:\r\n                        outputs = self.edge_model(images_gray, edges, masks)\r\n                        outputs = outputs * masks + edges * (1 - masks)\r\n                    else:\r\n                        outputs = edges\r\n\r\n                    outputs, gen_loss, dis_loss, logs = self.inpaint_model.process(images, outputs.detach(), masks)\r\n                    outputs_merged = (outputs * masks) + (images * (1 - masks))\r\n\r\n                    # metrics\r\n                    psnr = self.psnr(self.postprocess(images), self.postprocess(outputs_merged))\r\n                    mae = (torch.sum(torch.abs(images - outputs_merged)) / torch.sum(images)).float()\r\n                    logs.append(('psnr', psnr.item()))\r\n                    logs.append(('mae', mae.item()))\r\n\r\n                    # backward\r\n                    self.inpaint_model.backward(gen_loss, dis_loss)\r\n                    iteration = self.inpaint_model.iteration\r\n\r\n\r\n                # joint model\r\n                else:\r\n                    # train\r\n                    e_outputs, e_gen_loss, e_dis_loss, e_logs = self.edge_model.process(images_gray, edges, masks)\r\n                    e_outputs = e_outputs * masks + edges * (1 - masks)\r\n                    i_outputs, i_gen_loss, i_dis_loss, i_logs = self.inpaint_model.process(images, e_outputs, masks)\r\n                    outputs_merged = (i_outputs * masks) + (images * (1 - masks))\r\n\r\n                    # metrics\r\n                    psnr = self.psnr(self.postprocess(images), self.postprocess(outputs_merged))\r\n                    mae = (torch.sum(torch.abs(images - outputs_merged)) / torch.sum(images)).float()\r\n                    precision, recall = self.edgeacc(edges * masks, e_outputs * masks)\r\n                    e_logs.append(('pre', precision.item()))\r\n                    e_logs.append(('rec', recall.item()))\r\n                    i_logs.append(('psnr', psnr.item()))\r\n                    i_logs.append(('mae', mae.item()))\r\n                    logs = e_logs + i_logs\r\n\r\n                    # backward\r\n                    self.inpaint_model.backward(i_gen_loss, i_dis_loss)\r\n                    self.edge_model.backward(e_gen_loss, e_dis_loss)\r\n```","reactions":{"url":"https://api.github.com/repos/knazeri/edge-connect/issues/comments/619672407/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"12ycli","id":10368281,"node_id":"MDQ6VXNlcjEwMzY4Mjgx","avatar_url":"https://avatars.githubusercontent.com/u/10368281?v=4","gravatar_id":"","url":"https://api.github.com/users/12ycli","html_url":"https://github.com/12ycli","followers_url":"https://api.github.com/users/12ycli/followers","following_url":"https://api.github.com/users/12ycli/following{/other_user}","gists_url":"https://api.github.com/users/12ycli/gists{/gist_id}","starred_url":"https://api.github.com/users/12ycli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/12ycli/subscriptions","organizations_url":"https://api.github.com/users/12ycli/orgs","repos_url":"https://api.github.com/users/12ycli/repos","events_url":"https://api.github.com/users/12ycli/events{/privacy}","received_events_url":"https://api.github.com/users/12ycli/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/knazeri/edge-connect/issues/comments/619707410","html_url":"https://github.com/knazeri/edge-connect/issues/144#issuecomment-619707410","issue_url":"https://api.github.com/repos/knazeri/edge-connect/issues/144","id":619707410,"node_id":"MDEyOklzc3VlQ29tbWVudDYxOTcwNzQxMA==","user":{"login":"rainadam","id":36543713,"node_id":"MDQ6VXNlcjM2NTQzNzEz","avatar_url":"https://avatars.githubusercontent.com/u/36543713?v=4","gravatar_id":"","url":"https://api.github.com/users/rainadam","html_url":"https://github.com/rainadam","followers_url":"https://api.github.com/users/rainadam/followers","following_url":"https://api.github.com/users/rainadam/following{/other_user}","gists_url":"https://api.github.com/users/rainadam/gists{/gist_id}","starred_url":"https://api.github.com/users/rainadam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rainadam/subscriptions","organizations_url":"https://api.github.com/users/rainadam/orgs","repos_url":"https://api.github.com/users/rainadam/repos","events_url":"https://api.github.com/users/rainadam/events{/privacy}","received_events_url":"https://api.github.com/users/rainadam/received_events","type":"User","site_admin":false},"created_at":"2020-04-27T04:25:15Z","updated_at":"2020-04-27T04:25:15Z","author_association":"NONE","body":"Thx 搜马驰","reactions":{"url":"https://api.github.com/repos/knazeri/edge-connect/issues/comments/619707410/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rainadam","id":36543713,"node_id":"MDQ6VXNlcjM2NTQzNzEz","avatar_url":"https://avatars.githubusercontent.com/u/36543713?v=4","gravatar_id":"","url":"https://api.github.com/users/rainadam","html_url":"https://github.com/rainadam","followers_url":"https://api.github.com/users/rainadam/followers","following_url":"https://api.github.com/users/rainadam/following{/other_user}","gists_url":"https://api.github.com/users/rainadam/gists{/gist_id}","starred_url":"https://api.github.com/users/rainadam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rainadam/subscriptions","organizations_url":"https://api.github.com/users/rainadam/orgs","repos_url":"https://api.github.com/users/rainadam/repos","events_url":"https://api.github.com/users/rainadam/events{/privacy}","received_events_url":"https://api.github.com/users/rainadam/received_events","type":"User","site_admin":false}}]