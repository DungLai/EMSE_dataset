{"url":"https://api.github.com/repos/ml-tooling/ml-workspace/issues/71","repository_url":"https://api.github.com/repos/ml-tooling/ml-workspace","labels_url":"https://api.github.com/repos/ml-tooling/ml-workspace/issues/71/labels{/name}","comments_url":"https://api.github.com/repos/ml-tooling/ml-workspace/issues/71/comments","events_url":"https://api.github.com/repos/ml-tooling/ml-workspace/issues/71/events","html_url":"https://github.com/ml-tooling/ml-workspace/issues/71","id":786405106,"node_id":"MDU6SXNzdWU3ODY0MDUxMDY=","number":71,"title":"Jupyter crashes in workspace, workspace-r and workspace-spark, but not in workspace-minimal","user":{"login":"IamLunchbox","id":56757745,"node_id":"MDQ6VXNlcjU2NzU3NzQ1","avatar_url":"https://avatars.githubusercontent.com/u/56757745?v=4","gravatar_id":"","url":"https://api.github.com/users/IamLunchbox","html_url":"https://github.com/IamLunchbox","followers_url":"https://api.github.com/users/IamLunchbox/followers","following_url":"https://api.github.com/users/IamLunchbox/following{/other_user}","gists_url":"https://api.github.com/users/IamLunchbox/gists{/gist_id}","starred_url":"https://api.github.com/users/IamLunchbox/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IamLunchbox/subscriptions","organizations_url":"https://api.github.com/users/IamLunchbox/orgs","repos_url":"https://api.github.com/users/IamLunchbox/repos","events_url":"https://api.github.com/users/IamLunchbox/events{/privacy}","received_events_url":"https://api.github.com/users/IamLunchbox/received_events","type":"User","site_admin":false},"labels":[{"id":1379266800,"node_id":"MDU6TGFiZWwxMzc5MjY2ODAw","url":"https://api.github.com/repos/ml-tooling/ml-workspace/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working as expected"},{"id":2552279497,"node_id":"MDU6TGFiZWwyNTUyMjc5NDk3","url":"https://api.github.com/repos/ml-tooling/ml-workspace/labels/stale","name":"stale","color":"cfd3d7","default":false,"description":"Awaiting input from creator for prolonged time period"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-01-14T23:06:08Z","updated_at":"2021-04-30T02:26:16Z","closed_at":"2021-04-30T02:26:16Z","author_association":"NONE","active_lock_reason":null,"body":"**Bug:**\r\nWorkspace flavors workspace, workspace-r and workspace-spark are unable to run due to jupyter-notebook crashing (sigill). Workspace-minimal works fine though.\r\n\r\n**Expected behaviour:**\r\nAll flavors should run in docker without any difficulties, jupyter notebook should not crash\r\n\r\n**Steps to reproduce the issue / Technical details:**\r\nI run ml-workspace in docker-compose with the following compose-file:\r\n```\r\nversion: \"3.2\"\r\nservices:\r\n  ml-workspace:\r\n#   image: mltooling/ml-workspace-r:0.12.1\r\n#   image: mltooling/ml-workspace-spark:0.12.1\r\n    image: mltooling/ml-workspace-minimal:0.12.1 #works\r\n    environment:\r\n    - AUTHENTICATE_VIA_JUPYTER=\r\n    - SHARED_LINKS_ENABLED=false\r\n    - SHUTDOWN_INACTIVE_KERNELS=1800\r\n    restart: unless-stopped\r\n    volumes:\r\n      - ml-workspace:/workspace\r\n      - ./projects:/workspace/Projects\r\n    ports:\r\n      - 8121:8080\r\nvolumes:\r\n  ml-workspace:\r\n\r\n```\r\n\r\nUsing `docker-compose up` creates the following output:\r\n\r\n```\r\n[...] #everthing starting fine\r\nml-workspace_1  | 2021/01/14 22:48:17 [error] 114#0: *6 connect() failed (111: Connection refused) while connecting to upstream, client: 127.0.0.1, server: , request: \"GET /login?next=%2Ftree%2FProjects HTTP/1.0\", upstream: \"http://127.0.0.1:8090/login?next=%2Ftree%2FProjects\", host: \"?.?.com\"\r\nml-workspace_1  | 2021-01-14 22:48:18,697 INFO success: jupyter entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)\r\nml-workspace_1  | 2021-01-14 22:48:20,580 INFO exited: jupyter (terminated by SIGILL (core dumped); not expected)\r\nml-workspace_1  | 2021-01-14 22:48:21,583 INFO spawned: 'jupyter' with pid 814\r\nml-workspace_1  | 2021/01/14 22:48:21 [error] 114#0: *8 connect() failed (111: Connection refused) while connecting to upstream, client: 127.0.0.1, server: , request: \"GET / HTTP/1.0\", upstream: \"http://127.0.0.1:8090/\", host: \"\"?.?.com\"\r\nml-workspace_1  | 2021-01-14 22:48:22,958 INFO success: jupyter entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)\r\nml-workspace_1  | 2021-01-14 22:48:24,872 INFO exited: jupyter (terminated by SIGILL (core dumped); not expected)\r\nml-workspace_1  | 2021-01-14 22:48:25,874 INFO spawned: 'jupyter' with pid 819\r\n#repeat forever\r\n```\r\nThe issue starts when I connect with either firefox or edge (chromium version)...\r\n\r\n`ml-workspace_1  | 2021/01/14 23:19:43 [error] 130#0: *16 recv() failed (104: Connection reset by peer) while reading response header from upstream, client: 127.0.0.1, server: , request: \"GET / HTTP/1.0\", upstream: \"http://127.0.0.1:8090/\", host: \"url.tld\", referrer: \"url.tld\"\r\n`\r\n...and Jupyter notebook dies.\r\n`ml-workspace_1  | 2021-01-14 23:19:43,871 INFO exited: jupyter (terminated by SIGILL (core dumped); not expected)`\r\n\r\nSince I use several web applications on my server, I run a reverse nginx-proxy. I am aware of the issue with cpu's not supporting SSE24, but my virtual-server's cpu supports it.  The following file manages incoming data for ml-workspace:\r\n```\r\nserver {\r\n    listen 80;\r\n    server_name ?.?.com www.\"?.?.com;\r\n    return 301 https://$host$request_uri;\r\n}\r\n\r\nserver {\r\n  listen 443 ssl http2;\r\n  server_name \"?.?.com www.\"?.?.com;\r\n\r\n  # Specify SSL config if using a shared one.\r\n  include conf.d/ssl/ssl.conf;\r\n  include conf.d/geoip/geoip.conf;\r\n  ssl_certificate /etc/letsencrypt/live/?/fullchain.pem;\r\n  ssl_certificate_key /etc/letsencrypt/live/?/privkey.pem;\r\n\r\n  # Allow large attachments\r\n  client_max_body_size 128M;\r\n\r\n  location / {\r\n    proxy_pass http://127.0.0.1:8121;\r\n    proxy_set_header Host $host;\r\n    proxy_set_header Upgrade $http_upgrade;\r\n    proxy_set_header Connection \"Upgrade\";\r\n    proxy_set_header X-Real-IP $remote_addr;\r\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n    proxy_set_header X-Forwarded-Proto $scheme;\r\n    auth_basic \"Private\";\r\n    auth_basic_user_file /;\r\n  }\r\n\r\n}\r\n```\r\n**Technical details:**\r\n\r\n- Workspace version: 0.12.01\r\n- Docker version 20.10.2\r\n- Host Machine OS (Windows/Linux/Mac): Debian Buster, Kernel 4.19 ( as a hosted kvm-vm)\r\n- Browser (Chrome/Firefox/Safari): Firefox, Edge\r\n\r\n**Additional context:**\r\nI would've suspected my system being broken, but I actually don't know why the minimal-flavour works then. I hope you have more insight in the jupyter-packages and an idea, why just the larger flavours break jupyter-notebook.\r\n\r\n**Edit**\r\nAfter looking at the nginx.conf file within ml-worspace it seems, that 127.0.0.1:8090 is used by pling for authentication:\r\n```\r\n -- only authenticate via jupyter ping method if it is activated (not false)\r\n                if \"password\" ~= \"false\" then\r\n                    local res, error = http_connection:request_uri(\r\n                        \"http://127.0.0.1:8090/tooling/ping\",\r\n```\r\nIf pling is a part of jupyter-notebook, it could be an upstream error related to the jupyter-notebook authentication mechanism.","closed_by":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ml-tooling/ml-workspace/issues/71/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ml-tooling/ml-workspace/issues/71/timeline","performed_via_github_app":null,"state_reason":"completed"}