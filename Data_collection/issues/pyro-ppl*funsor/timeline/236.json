[{"id":2630389142,"node_id":"MDEyOkxhYmVsZWRFdmVudDI2MzAzODkxNDI=","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2630389142","actor":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-09-12T19:59:27Z","label":{"name":"bug","color":"d73a4a"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/530983547","html_url":"https://github.com/pyro-ppl/funsor/issues/236#issuecomment-530983547","issue_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/236","id":530983547,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDk4MzU0Nw==","user":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"created_at":"2019-09-12T20:03:05Z","updated_at":"2019-09-12T20:03:05Z","author_association":"MEMBER","body":"We may simply want to avoid distributing, I forget the original motivation.","reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/530983547/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/530987754","html_url":"https://github.com/pyro-ppl/funsor/issues/236#issuecomment-530987754","issue_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/236","id":530987754,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDk4Nzc1NA==","user":{"login":"eb8680","id":2032320,"node_id":"MDQ6VXNlcjIwMzIzMjA=","avatar_url":"https://avatars.githubusercontent.com/u/2032320?v=4","gravatar_id":"","url":"https://api.github.com/users/eb8680","html_url":"https://github.com/eb8680","followers_url":"https://api.github.com/users/eb8680/followers","following_url":"https://api.github.com/users/eb8680/following{/other_user}","gists_url":"https://api.github.com/users/eb8680/gists{/gist_id}","starred_url":"https://api.github.com/users/eb8680/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eb8680/subscriptions","organizations_url":"https://api.github.com/users/eb8680/orgs","repos_url":"https://api.github.com/users/eb8680/repos","events_url":"https://api.github.com/users/eb8680/events{/privacy}","received_events_url":"https://api.github.com/users/eb8680/received_events","type":"User","site_admin":false},"created_at":"2019-09-12T20:15:00Z","updated_at":"2019-09-12T20:15:00Z","author_association":"MEMBER","body":"> We may simply want to avoid distributing, I forget the original motivation.\r\n\r\nI think it was for combining lazy expressions involving `Joint`s, but I'm not sure either","reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/530987754/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"eb8680","id":2032320,"node_id":"MDQ6VXNlcjIwMzIzMjA=","avatar_url":"https://avatars.githubusercontent.com/u/2032320?v=4","gravatar_id":"","url":"https://api.github.com/users/eb8680","html_url":"https://github.com/eb8680","followers_url":"https://api.github.com/users/eb8680/followers","following_url":"https://api.github.com/users/eb8680/following{/other_user}","gists_url":"https://api.github.com/users/eb8680/gists{/gist_id}","starred_url":"https://api.github.com/users/eb8680/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eb8680/subscriptions","organizations_url":"https://api.github.com/users/eb8680/orgs","repos_url":"https://api.github.com/users/eb8680/repos","events_url":"https://api.github.com/users/eb8680/events{/privacy}","received_events_url":"https://api.github.com/users/eb8680/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/544679773","html_url":"https://github.com/pyro-ppl/funsor/issues/236#issuecomment-544679773","issue_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/236","id":544679773,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NDY3OTc3Mw==","user":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"created_at":"2019-10-21T19:53:48Z","updated_at":"2019-10-21T19:53:48Z","author_association":"MEMBER","body":"Closing since `eager_distribute` was removed IIRC.","reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/544679773/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false}},{"id":2731044156,"node_id":"MDExOkNsb3NlZEV2ZW50MjczMTA0NDE1Ng==","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2731044156","actor":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-10-21T19:53:50Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"eb8680","id":2032320,"node_id":"MDQ6VXNlcjIwMzIzMjA=","avatar_url":"https://avatars.githubusercontent.com/u/2032320?v=4","gravatar_id":"","url":"https://api.github.com/users/eb8680","html_url":"https://github.com/eb8680","followers_url":"https://api.github.com/users/eb8680/followers","following_url":"https://api.github.com/users/eb8680/following{/other_user}","gists_url":"https://api.github.com/users/eb8680/gists{/gist_id}","starred_url":"https://api.github.com/users/eb8680/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eb8680/subscriptions","organizations_url":"https://api.github.com/users/eb8680/orgs","repos_url":"https://api.github.com/users/eb8680/repos","events_url":"https://api.github.com/users/eb8680/events{/privacy}","received_events_url":"https://api.github.com/users/eb8680/received_events","type":"User","site_admin":false},"created_at":"2020-11-13T06:42:06Z","updated_at":"2020-11-13T06:42:06Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/pyro-ppl/pyro/issues/2687","repository_url":"https://api.github.com/repos/pyro-ppl/pyro","labels_url":"https://api.github.com/repos/pyro-ppl/pyro/issues/2687/labels{/name}","comments_url":"https://api.github.com/repos/pyro-ppl/pyro/issues/2687/comments","events_url":"https://api.github.com/repos/pyro-ppl/pyro/issues/2687/events","html_url":"https://github.com/pyro-ppl/pyro/issues/2687","id":735493875,"node_id":"MDU6SXNzdWU3MzU0OTM4NzU=","number":2687,"title":"FR MarkovianCategorical distribution","user":{"login":"ordabayevy","id":50752571,"node_id":"MDQ6VXNlcjUwNzUyNTcx","avatar_url":"https://avatars.githubusercontent.com/u/50752571?v=4","gravatar_id":"","url":"https://api.github.com/users/ordabayevy","html_url":"https://github.com/ordabayevy","followers_url":"https://api.github.com/users/ordabayevy/followers","following_url":"https://api.github.com/users/ordabayevy/following{/other_user}","gists_url":"https://api.github.com/users/ordabayevy/gists{/gist_id}","starred_url":"https://api.github.com/users/ordabayevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ordabayevy/subscriptions","organizations_url":"https://api.github.com/users/ordabayevy/orgs","repos_url":"https://api.github.com/users/ordabayevy/repos","events_url":"https://api.github.com/users/ordabayevy/events{/privacy}","received_events_url":"https://api.github.com/users/ordabayevy/received_events","type":"User","site_admin":false},"labels":[{"id":627803347,"node_id":"MDU6TGFiZWw2Mjc4MDMzNDc=","url":"https://api.github.com/repos/pyro-ppl/pyro/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null},{"id":634787400,"node_id":"MDU6TGFiZWw2MzQ3ODc0MDA=","url":"https://api.github.com/repos/pyro-ppl/pyro/labels/discussion","name":"discussion","color":"fef2c0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":19,"created_at":"2020-11-03T17:07:52Z","updated_at":"2021-01-13T18:54:23Z","closed_at":"2021-01-13T18:54:22Z","author_association":"MEMBER","active_lock_reason":null,"repository":{"id":94506832,"node_id":"MDEwOlJlcG9zaXRvcnk5NDUwNjgzMg==","name":"pyro","full_name":"pyro-ppl/pyro","private":false,"owner":{"login":"pyro-ppl","id":46794900,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ2Nzk0OTAw","avatar_url":"https://avatars.githubusercontent.com/u/46794900?v=4","gravatar_id":"","url":"https://api.github.com/users/pyro-ppl","html_url":"https://github.com/pyro-ppl","followers_url":"https://api.github.com/users/pyro-ppl/followers","following_url":"https://api.github.com/users/pyro-ppl/following{/other_user}","gists_url":"https://api.github.com/users/pyro-ppl/gists{/gist_id}","starred_url":"https://api.github.com/users/pyro-ppl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pyro-ppl/subscriptions","organizations_url":"https://api.github.com/users/pyro-ppl/orgs","repos_url":"https://api.github.com/users/pyro-ppl/repos","events_url":"https://api.github.com/users/pyro-ppl/events{/privacy}","received_events_url":"https://api.github.com/users/pyro-ppl/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/pyro-ppl/pyro","description":"Deep universal probabilistic programming with Python and PyTorch","fork":false,"url":"https://api.github.com/repos/pyro-ppl/pyro","forks_url":"https://api.github.com/repos/pyro-ppl/pyro/forks","keys_url":"https://api.github.com/repos/pyro-ppl/pyro/keys{/key_id}","collaborators_url":"https://api.github.com/repos/pyro-ppl/pyro/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/pyro-ppl/pyro/teams","hooks_url":"https://api.github.com/repos/pyro-ppl/pyro/hooks","issue_events_url":"https://api.github.com/repos/pyro-ppl/pyro/issues/events{/number}","events_url":"https://api.github.com/repos/pyro-ppl/pyro/events","assignees_url":"https://api.github.com/repos/pyro-ppl/pyro/assignees{/user}","branches_url":"https://api.github.com/repos/pyro-ppl/pyro/branches{/branch}","tags_url":"https://api.github.com/repos/pyro-ppl/pyro/tags","blobs_url":"https://api.github.com/repos/pyro-ppl/pyro/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/pyro-ppl/pyro/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/pyro-ppl/pyro/git/refs{/sha}","trees_url":"https://api.github.com/repos/pyro-ppl/pyro/git/trees{/sha}","statuses_url":"https://api.github.com/repos/pyro-ppl/pyro/statuses/{sha}","languages_url":"https://api.github.com/repos/pyro-ppl/pyro/languages","stargazers_url":"https://api.github.com/repos/pyro-ppl/pyro/stargazers","contributors_url":"https://api.github.com/repos/pyro-ppl/pyro/contributors","subscribers_url":"https://api.github.com/repos/pyro-ppl/pyro/subscribers","subscription_url":"https://api.github.com/repos/pyro-ppl/pyro/subscription","commits_url":"https://api.github.com/repos/pyro-ppl/pyro/commits{/sha}","git_commits_url":"https://api.github.com/repos/pyro-ppl/pyro/git/commits{/sha}","comments_url":"https://api.github.com/repos/pyro-ppl/pyro/comments{/number}","issue_comment_url":"https://api.github.com/repos/pyro-ppl/pyro/issues/comments{/number}","contents_url":"https://api.github.com/repos/pyro-ppl/pyro/contents/{+path}","compare_url":"https://api.github.com/repos/pyro-ppl/pyro/compare/{base}...{head}","merges_url":"https://api.github.com/repos/pyro-ppl/pyro/merges","archive_url":"https://api.github.com/repos/pyro-ppl/pyro/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/pyro-ppl/pyro/downloads","issues_url":"https://api.github.com/repos/pyro-ppl/pyro/issues{/number}","pulls_url":"https://api.github.com/repos/pyro-ppl/pyro/pulls{/number}","milestones_url":"https://api.github.com/repos/pyro-ppl/pyro/milestones{/number}","notifications_url":"https://api.github.com/repos/pyro-ppl/pyro/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/pyro-ppl/pyro/labels{/name}","releases_url":"https://api.github.com/repos/pyro-ppl/pyro/releases{/id}","deployments_url":"https://api.github.com/repos/pyro-ppl/pyro/deployments","created_at":"2017-06-16T05:03:47Z","updated_at":"2023-01-18T11:02:23Z","pushed_at":"2023-01-18T21:23:53Z","git_url":"git://github.com/pyro-ppl/pyro.git","ssh_url":"git@github.com:pyro-ppl/pyro.git","clone_url":"https://github.com/pyro-ppl/pyro.git","svn_url":"https://github.com/pyro-ppl/pyro","homepage":"http://pyro.ai","size":81833,"stargazers_count":7751,"watchers_count":7751,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":952,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":233,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["bayesian","bayesian-inference","deep-learning","machine-learning","probabilistic-modeling","probabilistic-programming","python","pytorch","variational-inference"],"visibility":"public","forks":952,"open_issues":233,"watchers":7751,"default_branch":"dev","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"FR to have a more flexible version of `DiscreteHMM`.\r\n--------------------------------------------------------------------------------------------------\r\nI'm working with a model where several variables depend on  a discrete markovian state: \r\n\r\n`p(z_k | z_{k-1})` and `Categorical(m_k | z_k)`, `Gamma(h_k | z_k)`, `Beta(x_k | z_k)`\r\n\r\nI propose to introduce a new distribution `MarkovianCategorical` for `z` and integrate out `z` with `MarkovProduct` at the very end (this would be similar how enumeration works in `TraceEnum_ELBO`). Below is the snippet of `MarkovianCategorical` that I've written but I don't know how to make it funsor compatible. The logic for `log_prob` here depends on the whether the `value` is enumerated or not. If it is then calculate the `log_prob` of the shape of `(duration,states,states,...)` which later can be used with `MarkovProduct`. Is this approach feasible?\r\n\r\n### Code Snippet\r\n```py\r\nclass MarkovianCategorical(TorchDistribution):\r\n    def __init__(self, initial_logits, transition_logits, duration, validate_args=None):\r\n        if initial_logits.dim() < 1:\r\n             raise ValueError(\"expected initial_logits to have at least one dim, \"\r\n                              \"actual shape = {}\".format(initial_logits.shape))\r\n        if transition_logits.dim() < 2:\r\n            raise ValueError(\"expected transition_logits to have at least two dims, \"\r\n                             \"actual shape = {}\".format(transition_logits.shape))\r\n        batch_shape = broadcast_shape(initial_logits.shape[:-1],\r\n                                transition_logits.shape[:-3])\r\n        event_shape = torch.Size((duration,))\r\n        trans_shape = broadcast_shape(initial_logits.shape[-1:],\r\n                                transition_logits.shape[-2:])\r\n        self.initial_logits = initial_logits - initial_logits.logsumexp(-1, True)\r\n        self.transition_logits = transition_logits - transition_logits.logsumexp(-1, True)\r\n        self.logits = torch.zeros(batch_shape + event_shape + trans_shape)\r\n        self.logits[..., 0, 0, :] = self.initial_logits\r\n        self.logits[..., 1:, :, :] = self.transition_logits\r\n\r\n        self._duration = duration\r\n        self._num_events = trans_shape[-1]\r\n        super().__init__(batch_shape, event_shape, validate_args=validate_args)\r\n\r\n    def log_prob(self, value):\r\n        if self._validate_args:\r\n            self._validate_sample(value)\r\n        value = value.long()\r\n        # normal interpretation\r\n        if value.shape[-1] == self._duration:\r\n            value_prev = torch.cat(\r\n                (torch.zeros(value.shape[:-1] + (1,), dtype=torch.long), value[..., :-1]),\r\n                dim=-1)\r\n            result = Vindex(self.logits)[..., value_prev, value].sum(-1)\r\n        # enumarated interpretation\r\n        elif value.shape[-1] == 1:\r\n            time = torch.arange(self._duration).view((-1,) + (1,) * (len(value)+2))\r\n            result = Vindex(self.logits)[..., time, value.unsqueeze(-1), value]\r\n        return result\r\n\r\n    def enumerate_support(self, expand=True):\r\n        num_events = self._num_events\r\n        values = torch.arange(num_events, dtype=torch.long, device=self.logits.device)\r\n        values = values.view((-1,) + (1,) * len(self._batch_shape))\r\n        if expand:\r\n            values = values.expand((-1,) + self._batch_shape)\r\n        return values\r\n```","reactions":{"url":"https://api.github.com/repos/pyro-ppl/pyro/issues/2687/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pyro-ppl/pyro/issues/2687/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"}]