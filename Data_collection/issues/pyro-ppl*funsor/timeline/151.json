[{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/504467468","html_url":"https://github.com/pyro-ppl/funsor/issues/151#issuecomment-504467468","issue_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/151","id":504467468,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDQ2NzQ2OA==","user":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"created_at":"2019-06-21T15:27:18Z","updated_at":"2019-06-21T15:28:05Z","author_association":"MEMBER","body":"Hi @mattwescott, my aim of including the DiCE factor in non-reparametrizable `Tensor.sample()` is to maintain the invariant that samples are unbiased at all derivatives. That is, for any funsor `p(theta)` and C-infinity test function `f(theta)` both depending on a parameter `theta`,\r\n```\r\nE[ p(theta).sample() * f(theta) ] == E[ p(theta) * f(theta) ]\r\n                                at all\r\n                              derivatives\r\n                               wrt theta\r\n```\r\nThus we can think of `.sample()` as a differentiable approximation, in particular as an approximation by `Delta` funsors. I find it conceptually cute to define 'sampling' as exactly 'approximation by Delta funsors'.\r\n\r\nRe: importance sampling, I guess the first way I see that fitting into Funsor is via yet another interpretation: whereas the `monte_carlo` interpretation samples from the prior, `importance_monte_carlo` (or maybe `monte_carlo(proposal=q)`) could sample from another distribution. Does that sound reasonable to you?","reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/504467468/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false}},{"id":2430674063,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjQzMDY3NDA2Mw==","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2430674063","actor":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-06-21T15:27:18Z","performed_via_github_app":null},{"id":2430674064,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI0MzA2NzQwNjQ=","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2430674064","actor":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-06-21T15:27:18Z","performed_via_github_app":null},{"id":2430674333,"node_id":"MDEyOkxhYmVsZWRFdmVudDI0MzA2NzQzMzM=","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2430674333","actor":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-06-21T15:27:24Z","label":{"name":"discussion","color":"fef2c0"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/504504719","html_url":"https://github.com/pyro-ppl/funsor/issues/151#issuecomment-504504719","issue_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/151","id":504504719,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDUwNDcxOQ==","user":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false},"created_at":"2019-06-21T17:22:33Z","updated_at":"2019-06-21T17:22:33Z","author_association":"NONE","body":"Thanks @fritzo. Unless I'm still confused, what I have in mind might generalize this. \r\n\r\nIt seems natural to have a `differentiable_importance_sample(proposal=q)` method that would have the properties you've outlined of preserving expectations of all derivatives. The current behavior of `funsor.sample` would be a special case of using p as its own proposal. \r\n\r\n```python\r\nclass Funsor:\r\n\r\n    def differentiable_importance_sample(self, proposal=None):\r\n        if proposal is None:\r\n            proposal = self\r\n        sample = proposal.raw_sample()\r\n        return reduce(add, [Delta(sample), proposal.sum(), self(sample)/proposal(sample).detach()])\r\n\r\n    def sample(self):\r\n        # However it is implemented, this definition will take some adjustment for me\r\n        return self.differentiable_importance_sample()\r\n```\r\n\r\nThis feels like a simpler and more general way to conceptualize DiCE, but I might still be missing something. \r\n\r\n> I find it conceptually cute to define 'sampling' as exactly 'approximation by Delta funsors'.\r\n\r\nThis will probably grow on me. \r\n\r\n","reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/504504719/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false}},{"id":2430953246,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjQzMDk1MzI0Ng==","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2430953246","actor":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-06-21T17:22:33Z","performed_via_github_app":null},{"id":2430953247,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI0MzA5NTMyNDc=","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2430953247","actor":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-06-21T17:22:33Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/504508162","html_url":"https://github.com/pyro-ppl/funsor/issues/151#issuecomment-504508162","issue_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/151","id":504508162,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDUwODE2Mg==","user":{"login":"eb8680","id":2032320,"node_id":"MDQ6VXNlcjIwMzIzMjA=","avatar_url":"https://avatars.githubusercontent.com/u/2032320?v=4","gravatar_id":"","url":"https://api.github.com/users/eb8680","html_url":"https://github.com/eb8680","followers_url":"https://api.github.com/users/eb8680/followers","following_url":"https://api.github.com/users/eb8680/following{/other_user}","gists_url":"https://api.github.com/users/eb8680/gists{/gist_id}","starred_url":"https://api.github.com/users/eb8680/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eb8680/subscriptions","organizations_url":"https://api.github.com/users/eb8680/orgs","repos_url":"https://api.github.com/users/eb8680/repos","events_url":"https://api.github.com/users/eb8680/events{/privacy}","received_events_url":"https://api.github.com/users/eb8680/received_events","type":"User","site_admin":false},"created_at":"2019-06-21T17:33:20Z","updated_at":"2019-06-21T17:34:50Z","author_association":"MEMBER","body":"@mattwescott we prefer when possible to build more complex machinery out of simpler pieces in Funsor.  Dice is a nice atomic piece of functionality; to estimate an integral with importance sampling we'd just write out the definition and have Dice automatically applied: \r\n```python\r\n# monte carlo\r\nwith interpretation(monte_carlo):\r\n    y = funsor.Integrate(logp, f)\r\n\r\n# importance sampling\r\nwith interpretation(monte_carlo):\r\n    y = funsor.Integrate(logq, f * (logp - logq).exp())\r\n```","reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/504508162/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"eb8680","id":2032320,"node_id":"MDQ6VXNlcjIwMzIzMjA=","avatar_url":"https://avatars.githubusercontent.com/u/2032320?v=4","gravatar_id":"","url":"https://api.github.com/users/eb8680","html_url":"https://github.com/eb8680","followers_url":"https://api.github.com/users/eb8680/followers","following_url":"https://api.github.com/users/eb8680/following{/other_user}","gists_url":"https://api.github.com/users/eb8680/gists{/gist_id}","starred_url":"https://api.github.com/users/eb8680/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eb8680/subscriptions","organizations_url":"https://api.github.com/users/eb8680/orgs","repos_url":"https://api.github.com/users/eb8680/repos","events_url":"https://api.github.com/users/eb8680/events{/privacy}","received_events_url":"https://api.github.com/users/eb8680/received_events","type":"User","site_admin":false}},{"id":2430978643,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjQzMDk3ODY0Mw==","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2430978643","actor":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-06-21T17:33:20Z","performed_via_github_app":null},{"id":2430978645,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI0MzA5Nzg2NDU=","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2430978645","actor":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-06-21T17:33:20Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/504552595","html_url":"https://github.com/pyro-ppl/funsor/issues/151#issuecomment-504552595","issue_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/151","id":504552595,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDU1MjU5NQ==","user":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false},"created_at":"2019-06-21T19:51:41Z","updated_at":"2019-06-21T19:51:41Z","author_association":"NONE","body":"Thanks @eb8680, I'm getting closer to the same page. Conceptually I found it easier to motivate Dice from importance sampling. But as you said, however it is arrived at, it is a nice atom of functionality and the implementation probably shouldn't be entangled with importance sampling. \r\n\r\nIf I could bother you to comment on another aspect of this: Would it be practical to move the Dice logic to a base class? Maybe the parameterization could be handled with something like this?\r\n\r\n```python\r\n\r\ndef detach(fn, params):\r\n    \"\"\"this poutine turns off gradients for some parameters\"\"\"\r\n    return detached_fn\r\n\r\nclass Funsor:\r\n    def sample(self):\r\n        sample = self.raw_sample()\r\n        if not self.fully_reparameterized:\r\n            dice_factor = detach(self, self.reparameterized_params)(sample)/self(sample).detach()\r\n        else:\r\n            dice_factor = 0.0\r\n        return reduce(add, [Delta(sample), dice_factor, self.sum()])\r\n```","reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/504552595/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false}},{"id":2431287319,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjQzMTI4NzMxOQ==","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2431287319","actor":{"login":"eb8680","id":2032320,"node_id":"MDQ6VXNlcjIwMzIzMjA=","avatar_url":"https://avatars.githubusercontent.com/u/2032320?v=4","gravatar_id":"","url":"https://api.github.com/users/eb8680","html_url":"https://github.com/eb8680","followers_url":"https://api.github.com/users/eb8680/followers","following_url":"https://api.github.com/users/eb8680/following{/other_user}","gists_url":"https://api.github.com/users/eb8680/gists{/gist_id}","starred_url":"https://api.github.com/users/eb8680/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eb8680/subscriptions","organizations_url":"https://api.github.com/users/eb8680/orgs","repos_url":"https://api.github.com/users/eb8680/repos","events_url":"https://api.github.com/users/eb8680/events{/privacy}","received_events_url":"https://api.github.com/users/eb8680/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-06-21T19:51:41Z","performed_via_github_app":null},{"id":2431287320,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI0MzEyODczMjA=","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2431287320","actor":{"login":"eb8680","id":2032320,"node_id":"MDQ6VXNlcjIwMzIzMjA=","avatar_url":"https://avatars.githubusercontent.com/u/2032320?v=4","gravatar_id":"","url":"https://api.github.com/users/eb8680","html_url":"https://github.com/eb8680","followers_url":"https://api.github.com/users/eb8680/followers","following_url":"https://api.github.com/users/eb8680/following{/other_user}","gists_url":"https://api.github.com/users/eb8680/gists{/gist_id}","starred_url":"https://api.github.com/users/eb8680/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eb8680/subscriptions","organizations_url":"https://api.github.com/users/eb8680/orgs","repos_url":"https://api.github.com/users/eb8680/repos","events_url":"https://api.github.com/users/eb8680/events{/privacy}","received_events_url":"https://api.github.com/users/eb8680/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-06-21T19:51:41Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/504554968","html_url":"https://github.com/pyro-ppl/funsor/issues/151#issuecomment-504554968","issue_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/151","id":504554968,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDU1NDk2OA==","user":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"created_at":"2019-06-21T20:00:02Z","updated_at":"2019-06-21T20:00:02Z","author_association":"MEMBER","body":"Again, I prefer to think of `raw_sample()` as low-level concept appropriate for FORTRAN/MATLAB/CUDA code, and to think of `.sample()` as the more mathematical concept, an atomic method that each `Funsor` subclass must implement. Note also there are partially reparametrized cases where it doesn't make sense to consult a boolean `.fully_reparametrized` flag; even TFP made a decision early on to allow more than two values to `.reparametrization_type`.","reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/504554968/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/504581693","html_url":"https://github.com/pyro-ppl/funsor/issues/151#issuecomment-504581693","issue_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/151","id":504581693,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDU4MTY5Mw==","user":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false},"created_at":"2019-06-21T21:41:20Z","updated_at":"2019-06-21T21:41:20Z","author_association":"NONE","body":"Thanks for the detail @fritzo, that is even clearer now. It actually wasn't my intention to readjudicate `.sample()`. I'm curious if it would be practical to factor out the Dice factor computation.\r\n\r\n> Note also there are partially reparametrized cases where it doesn't make sense to consult a boolean .fully_reparametrized\r\n\r\nUsing `.reparametrization_type` seems cleaner, switched the pseudocode. \r\n\r\nFor the partial case, my hypothetical (and quite possibly nonsensical) `partial_detach` poutine turns off gradients for the relevant subset of parameters. These parameters are hypothetically stored in `.reparam_params` \r\n\r\n```python\r\ndef partial_detach(fn, params):\r\n    \"\"\"this poutine turns off gradients for params\"\"\"\r\n    ...\r\n    return partially_detached_fn\r\n\r\ndef dice_factor(p, raw_sample):\r\n    if p.reparametrization_type == 'full':\r\n        return 0.0\r\n    elif p.reparametrization_type == 'none':\r\n        return p(raw_sample) - p(raw_sample).detach()\r\n    elif p.reparametrization_type == 'partial':\r\n        return partial_detach(p, p.reparam_params)(raw_sample) - p(raw_sample).detach()\r\n    else:\r\n        raise \"invalid reparametrization type\"\r\n```\r\n\r\nSeems like it could be expensive to reevaluate the density with different `.requires_grad`. It is not clear to me how that would work, both the funsor evaluation and torch internals are still opaque. If it is expensive, could be a case for keeping the Dice factor computation with the sampling code where the parameterization is explicit?\r\n\r\nThanks for taking the time, it has been helpful.","reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/504581693/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false}},{"id":2431503438,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjQzMTUwMzQzOA==","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2431503438","actor":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-06-21T21:41:20Z","performed_via_github_app":null},{"id":2431503439,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI0MzE1MDM0Mzk=","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2431503439","actor":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-06-21T21:41:20Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/504597372","html_url":"https://github.com/pyro-ppl/funsor/issues/151#issuecomment-504597372","issue_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/151","id":504597372,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDU5NzM3Mg==","user":{"login":"eb8680","id":2032320,"node_id":"MDQ6VXNlcjIwMzIzMjA=","avatar_url":"https://avatars.githubusercontent.com/u/2032320?v=4","gravatar_id":"","url":"https://api.github.com/users/eb8680","html_url":"https://github.com/eb8680","followers_url":"https://api.github.com/users/eb8680/followers","following_url":"https://api.github.com/users/eb8680/following{/other_user}","gists_url":"https://api.github.com/users/eb8680/gists{/gist_id}","starred_url":"https://api.github.com/users/eb8680/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eb8680/subscriptions","organizations_url":"https://api.github.com/users/eb8680/orgs","repos_url":"https://api.github.com/users/eb8680/repos","events_url":"https://api.github.com/users/eb8680/events{/privacy}","received_events_url":"https://api.github.com/users/eb8680/received_events","type":"User","site_admin":false},"created_at":"2019-06-21T22:53:22Z","updated_at":"2019-06-21T23:05:15Z","author_association":"MEMBER","body":"@mattwescott I don't quite understand the motivation for your proposed refactoring - do you want to be able to turn off Dice?  When would you want a `funsor.Delta` that would silently produce incorrect gradient estimators?  Curious if you have some examples of things this would enable - maybe it would make it easier to implement fancier gradient estimators, like the ones in Pyro's `TraceGraph_ELBO` or [this tech report](https://arxiv.org/abs/1901.01761)?","reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/504597372/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"eb8680","id":2032320,"node_id":"MDQ6VXNlcjIwMzIzMjA=","avatar_url":"https://avatars.githubusercontent.com/u/2032320?v=4","gravatar_id":"","url":"https://api.github.com/users/eb8680","html_url":"https://github.com/eb8680","followers_url":"https://api.github.com/users/eb8680/followers","following_url":"https://api.github.com/users/eb8680/following{/other_user}","gists_url":"https://api.github.com/users/eb8680/gists{/gist_id}","starred_url":"https://api.github.com/users/eb8680/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eb8680/subscriptions","organizations_url":"https://api.github.com/users/eb8680/orgs","repos_url":"https://api.github.com/users/eb8680/repos","events_url":"https://api.github.com/users/eb8680/events{/privacy}","received_events_url":"https://api.github.com/users/eb8680/received_events","type":"User","site_admin":false}},{"id":2431604141,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjQzMTYwNDE0MQ==","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2431604141","actor":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-06-21T22:53:22Z","performed_via_github_app":null},{"id":2431604143,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI0MzE2MDQxNDM=","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2431604143","actor":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-06-21T22:53:22Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/505066324","html_url":"https://github.com/pyro-ppl/funsor/issues/151#issuecomment-505066324","issue_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/151","id":505066324,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTA2NjMyNA==","user":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false},"created_at":"2019-06-24T15:43:09Z","updated_at":"2019-06-24T15:43:09Z","author_association":"NONE","body":"> I don't quite understand the motivation for your proposed refactoring\r\n\r\nMy motivation is mostly to better understand Funsor. By proposing what seems to me a simplification, my hope is that if it is misguided you might point me toward what I'm missing. And if it could make sense and simply isn't a priority, that is helpful to know as well.\r\n\r\nThe implementations of `.unscaled_sample()` seemed complex. It would have felt more natural to me if any reparametrization were an explicit property of the distribution, with the Dice factor being constructed from the parametrization. \r\n\r\nThe pseudocode in my last comment might not be practical, especially for some cases of partial reparametrization. If instead the stochastic source and transformation are both explicit, both `unscaled_sample` and `compute_dice_factor` might be even simpler:\r\n\r\n```python\r\ndef compute_dice_factor(stochastic_source, epsilon):\r\n    return stochastic_source(epsilon) - stochastic_source(epsilon).detach()\r\n\r\nclass Distribution(Funsor):\r\n    def unscaled_sample(self):\r\n        epsilon = self.stochastic_source.raw_sample()\r\n        dice_factor = compute_dice_factor(stochastic_source, epsilon)\r\n        point = self.transformation(epsilon)\r\n        return reduce(add, [Delta(point), dice_factor, self.sum()])\r\n```\r\n\r\nIn any case, a factored out Dice might be used by all the `.sample()` methods, and could be easier to understand and test. My primary interest though is not to advocate for these changes, but to hopefully find out if there is something I'm not considering. ","reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/505066324/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/505203958","html_url":"https://github.com/pyro-ppl/funsor/issues/151#issuecomment-505203958","issue_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/151","id":505203958,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTIwMzk1OA==","user":{"login":"eb8680","id":2032320,"node_id":"MDQ6VXNlcjIwMzIzMjA=","avatar_url":"https://avatars.githubusercontent.com/u/2032320?v=4","gravatar_id":"","url":"https://api.github.com/users/eb8680","html_url":"https://github.com/eb8680","followers_url":"https://api.github.com/users/eb8680/followers","following_url":"https://api.github.com/users/eb8680/following{/other_user}","gists_url":"https://api.github.com/users/eb8680/gists{/gist_id}","starred_url":"https://api.github.com/users/eb8680/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eb8680/subscriptions","organizations_url":"https://api.github.com/users/eb8680/orgs","repos_url":"https://api.github.com/users/eb8680/repos","events_url":"https://api.github.com/users/eb8680/events{/privacy}","received_events_url":"https://api.github.com/users/eb8680/received_events","type":"User","site_admin":false},"created_at":"2019-06-24T22:22:51Z","updated_at":"2019-06-24T22:24:03Z","author_association":"MEMBER","body":"Hmm, interesting.  Given that there's currently only one implementation of Dice in Funsor (in `Tensor.unscaled_sample`) I don't quite see how your proposal would simplify the existing code, though it might more directly reflect one mathematical presentation of Dice, as you say.  \r\n\r\nNote that we have no plans to reimplement any additional samplers, as there are already high-performance, fully reparameterzed, broadcasting-aware samplers available for most common continuous-valued distributions in `torch.distributions` or `pyro.distributions` that we would prefer to wrap when possible.  \r\n\r\nIf you think a version of your proposal would make it easier to do that (e.g. by reusing [Pyro's `score_parts` machinery](http://docs.pyro.ai/en/stable/distributions.html#pyro.distributions.Distribution.score_parts) for Dice where appropriate), feel free to submit a PR adding `unscaled_sample` methods to some of the classes in `funsor/distributions.py` and we can discuss it in detail there.","reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/505203958/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"eb8680","id":2032320,"node_id":"MDQ6VXNlcjIwMzIzMjA=","avatar_url":"https://avatars.githubusercontent.com/u/2032320?v=4","gravatar_id":"","url":"https://api.github.com/users/eb8680","html_url":"https://github.com/eb8680","followers_url":"https://api.github.com/users/eb8680/followers","following_url":"https://api.github.com/users/eb8680/following{/other_user}","gists_url":"https://api.github.com/users/eb8680/gists{/gist_id}","starred_url":"https://api.github.com/users/eb8680/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eb8680/subscriptions","organizations_url":"https://api.github.com/users/eb8680/orgs","repos_url":"https://api.github.com/users/eb8680/repos","events_url":"https://api.github.com/users/eb8680/events{/privacy}","received_events_url":"https://api.github.com/users/eb8680/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/505229297","html_url":"https://github.com/pyro-ppl/funsor/issues/151#issuecomment-505229297","issue_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/151","id":505229297,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTIyOTI5Nw==","user":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false},"created_at":"2019-06-25T00:23:47Z","updated_at":"2019-06-25T00:23:47Z","author_association":"NONE","body":"> e.g. by reusing Pyro's score_parts machinery for Dice where appropriate\r\n\r\nLeaving `score_parts` behind is part of the appeal for me of explicit reparametrization. I've been seeing `score_parts` as loosely tied to parameterization since a comment about possibly using it to [stick the landing](https://arxiv.org/abs/1703.09194). Maybe I got the wrong impression. In any case, leaning on `score_parts.score_function` for now to compute Dice factors would make engineering sense to me.\r\n\r\nWill go ahead and close this. Thanks for all the discussion. ","reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/comments/505229297/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false}},{"id":2435911538,"node_id":"MDExOkNsb3NlZEV2ZW50MjQzNTkxMTUzOA==","url":"https://api.github.com/repos/pyro-ppl/funsor/issues/events/2435911538","actor":{"login":"mattwescott","id":863268,"node_id":"MDQ6VXNlcjg2MzI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/863268?v=4","gravatar_id":"","url":"https://api.github.com/users/mattwescott","html_url":"https://github.com/mattwescott","followers_url":"https://api.github.com/users/mattwescott/followers","following_url":"https://api.github.com/users/mattwescott/following{/other_user}","gists_url":"https://api.github.com/users/mattwescott/gists{/gist_id}","starred_url":"https://api.github.com/users/mattwescott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattwescott/subscriptions","organizations_url":"https://api.github.com/users/mattwescott/orgs","repos_url":"https://api.github.com/users/mattwescott/repos","events_url":"https://api.github.com/users/mattwescott/events{/privacy}","received_events_url":"https://api.github.com/users/mattwescott/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-06-25T00:23:47Z","state_reason":null,"performed_via_github_app":null}]