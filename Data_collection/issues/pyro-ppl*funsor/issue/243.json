{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/243","repository_url":"https://api.github.com/repos/pyro-ppl/funsor","labels_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/243/labels{/name}","comments_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/243/comments","events_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/243/events","html_url":"https://github.com/pyro-ppl/funsor/issues/243","id":495202634,"node_id":"MDU6SXNzdWU0OTUyMDI2MzQ=","number":243,"title":"Nondeterministic typing error on module load","user":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"labels":[{"id":1215006860,"node_id":"MDU6TGFiZWwxMjE1MDA2ODYw","url":"https://api.github.com/repos/pyro-ppl/funsor/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-09-18T12:45:07Z","updated_at":"2020-12-21T23:45:53Z","closed_at":"2020-12-21T23:45:53Z","author_association":"MEMBER","active_lock_reason":null,"body":"I have seen a couple nondeterministic errors on loading the funsor library with error messages\r\n```\r\nKeyError: (typing.Union[funsor.ops.LogAddExpOp, funsor.ops.NullOp], <class 'funsor.ops.AddOp'>, <class 'frozenset'>, typing.Tuple[typing.Union[funsor.torch.Tensor, funsor.terms.Number], funsor.gaussian.Gaussian])\r\n```\r\nThis is tough to reproduce.\r\n\r\n<details>\r\n\r\n```sh\r\n$ pytest -vx test/examples/test_bart.py --pdb\r\n============================================== test session starts ==============================================\r\nplatform darwin -- Python 3.7.2, pytest-5.0.1, py-1.8.0, pluggy-0.12.0 -- /Users/fritzobermeyer/miniconda2/envs/pyro3/bin/python\r\ncachedir: .pytest_cache\r\nbenchmark: 3.2.2 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)\r\nrootdir: /Users/fritzobermeyer/github/pyro-ppl/funsor, inifile: setup.cfg\r\nplugins: xdist-1.26.1, nbval-0.9.1, forked-1.0.2, benchmark-3.2.2\r\ncollecting ...\r\n>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> traceback >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\r\ntest/examples/test_bart.py:5: in <module>\r\n    import funsor\r\nfunsor/__init__.py:8: in <module>\r\n    from . import (\r\nfunsor/adjoint.py:7: in <module>\r\n    from funsor.cnf import Contraction, nullop\r\nfunsor/cnf.py:170: in <module>\r\n    Tuple[Union[Tensor, Number], Gaussian]]\r\nfunsor/terms.py:232: in __getitem__\r\n    return cls._type_cache[arg_types]\r\n../../../miniconda2/envs/pyro3/lib/python3.7/weakref.py:137: in __getitem__\r\n    o = self.data[key]()\r\nE   KeyError: (typing.Union[funsor.ops.LogAddExpOp, funsor.ops.NullOp], <class 'funsor.ops.AddOp'>, <class 'frozenset'>, typing.Tuple[typing.Union[funsor.torch.Tensor, funsor.terms.Number], funsor.gaussian.Gaussian])\r\n>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> entering PDB >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\r\n\r\n>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> PDB post_mortem (IO-capturing turned off) >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\r\n> /Users/fritzobermeyer/miniconda2/envs/pyro3/lib/python3.7/weakref.py(137)__getitem__()\r\n-> o = self.data[key]()\r\n(Pdb)\r\ncollected 0 items\r\n\r\n=============================================== warnings summary ================================================\r\nfunsor/terms.py:6\r\n  /Users/fritzobermeyer/github/pyro-ppl/funsor/funsor/terms.py:6: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working\r\n    from collections import Hashable, OrderedDict\r\n\r\n-- Docs: https://docs.pytest.org/en/latest/warnings.html\r\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! _pytest.outcomes.Exit: Quitting debugger !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\r\n========================================== 1 warnings in 97.33 seconds ==========================================\r\n```\r\n\r\n</details>","closed_by":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/243/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/243/timeline","performed_via_github_app":null,"state_reason":"completed"}