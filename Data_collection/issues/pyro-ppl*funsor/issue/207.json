{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/207","repository_url":"https://api.github.com/repos/pyro-ppl/funsor","labels_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/207/labels{/name}","comments_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/207/comments","events_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/207/events","html_url":"https://github.com/pyro-ppl/funsor/issues/207","id":487817334,"node_id":"MDU6SXNzdWU0ODc4MTczMzQ=","number":207,"title":"Support multiple backends","user":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"labels":[{"id":1245797346,"node_id":"MDU6TGFiZWwxMjQ1Nzk3MzQ2","url":"https://api.github.com/repos/pyro-ppl/funsor/labels/refactor","name":"refactor","color":"ff9900","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-08-31T22:27:54Z","updated_at":"2021-01-27T15:40:39Z","closed_at":"2021-01-27T15:40:38Z","author_association":"MEMBER","active_lock_reason":null,"body":"This issue tracks changes needed to fully support multiple backends in an interchangeable/generic way. The initial release of Funsor implements most funsors using PyTorch (funsor.torch implements `Tensor`, but all of funsor.gaussian, .joint, .distributions use PyTorch internally.\r\n\r\n## Approach 1\r\nOne possibility is to replicate backend-specific logic in a consistent way, e.g. with module structure\r\n- funsor\r\n  - torch\r\n    - tensor\r\n    - gaussian\r\n    - cnf\r\n    - distributions\r\n  - numpy / jax\r\n    - tensor\r\n    - gaussian\r\n    - cnf\r\n    - distributions\r\n  - tensorflow\r\n    - ...\r\n  - birch\r\n    - ...\r\n\r\n## Approach 2\r\nA second possibility (suggested by @eb8680 below and in #159) is to\r\n1. subclass `Tensor` into `TorchTensor` and `NumpyTensor`, then\r\n2. refactor `Gaussian` and `Contraction` etc. to use `Tensor`s rather than torch.Tensors internally.\r\n\r\nThis approach would still require duplicating distributions.\r\n\r\n## Potential backends\r\n- [x] PyTorch / `pyro.distributions`\r\n- [x] #58 NumPy\r\n- [x] JAX / `numpyro.distributions`\r\n- [ ] Tensorflow 2.0 / `tfp.distributions`\r\n- [ ] Trax's TensorFlow-backed NumPy API [`tf_numpy`](https://github.com/google/trax/tree/master/trax/tf_numpy)\r\n- [ ] Birch \r\n\r\n## Other tasks\r\n- [ ] Remove stray dependencies on PyTorch or NumPy e.g. in `funsor.testing` and `funsor.domains`\r\n- [x] Add backend-specific installation options `funsor[torch]`, `funsor[numpy]` etc.","closed_by":{"login":"eb8680","id":2032320,"node_id":"MDQ6VXNlcjIwMzIzMjA=","avatar_url":"https://avatars.githubusercontent.com/u/2032320?v=4","gravatar_id":"","url":"https://api.github.com/users/eb8680","html_url":"https://github.com/eb8680","followers_url":"https://api.github.com/users/eb8680/followers","following_url":"https://api.github.com/users/eb8680/following{/other_user}","gists_url":"https://api.github.com/users/eb8680/gists{/gist_id}","starred_url":"https://api.github.com/users/eb8680/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eb8680/subscriptions","organizations_url":"https://api.github.com/users/eb8680/orgs","repos_url":"https://api.github.com/users/eb8680/repos","events_url":"https://api.github.com/users/eb8680/events{/privacy}","received_events_url":"https://api.github.com/users/eb8680/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/207/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/207/timeline","performed_via_github_app":null,"state_reason":"completed"}