{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/493","repository_url":"https://api.github.com/repos/pyro-ppl/funsor","labels_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/493/labels{/name}","comments_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/493/comments","events_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/493/events","html_url":"https://github.com/pyro-ppl/funsor/issues/493","id":832199191,"node_id":"MDU6SXNzdWU4MzIxOTkxOTE=","number":493,"title":"Track issues with adjoint","user":{"login":"ordabayevy","id":50752571,"node_id":"MDQ6VXNlcjUwNzUyNTcx","avatar_url":"https://avatars.githubusercontent.com/u/50752571?v=4","gravatar_id":"","url":"https://api.github.com/users/ordabayevy","html_url":"https://github.com/ordabayevy","followers_url":"https://api.github.com/users/ordabayevy/followers","following_url":"https://api.github.com/users/ordabayevy/following{/other_user}","gists_url":"https://api.github.com/users/ordabayevy/gists{/gist_id}","starred_url":"https://api.github.com/users/ordabayevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ordabayevy/subscriptions","organizations_url":"https://api.github.com/users/ordabayevy/orgs","repos_url":"https://api.github.com/users/ordabayevy/repos","events_url":"https://api.github.com/users/ordabayevy/events{/privacy}","received_events_url":"https://api.github.com/users/ordabayevy/received_events","type":"User","site_admin":false},"labels":[{"id":1215006860,"node_id":"MDU6TGFiZWwxMjE1MDA2ODYw","url":"https://api.github.com/repos/pyro-ppl/funsor/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-03-15T21:16:19Z","updated_at":"2021-03-16T01:45:40Z","closed_at":null,"author_association":"MEMBER","active_lock_reason":null,"body":"This is to track issues related to using adjoint.\r\n\r\n- [ ] `test_adjoint.py::test_sequential_sum_product_adjoint`:  `xfail_param(MarkovProduct, reason=\"mysteriously doubles adjoint values?\")`\r\n`MarkovProduct` is evaluated again at `actual.reduce(sum_op)` line:\r\n\r\n```py\r\n    with AdjointTape() as actual_tape:\r\n        actual = impl(sum_op, prod_op, trans, time, {\"prev\": \"curr\"})\r\n        actual = actual.reduce(sum_op)\r\n```\r\nIt might be due to \" `.reduce` binds variables, which triggers alpha-renaming and reinterprets `actual`?\" from slack discussion with @eb8680 \r\n- [ ] `MarkovProduct` is not expanded by `lazy` (or any other Funsor not defined in `adjoint_ops`). A temporary solution (#492 ) might be to define an adjoint for `MarkovProduct`. Still work in progress.\r\n- [ ] `TraceEnum_ELBO` uses `AdjointTape` to calculate expectations. Under `eager` evaluation `nan` gradients appear  in more than half of the tests as caught by https://github.com/pyro-ppl/pyro/pull/2782:  \r\n\r\n<details>\r\n\r\n```\r\ntest_enum_funsor.py::test_elbo_plate_plate[2-2] FAILED                   [  1%]\r\ntest_enum_funsor.py::test_elbo_enumerate_1[1] FAILED                     [  3%]\r\ntest_enum_funsor.py::test_elbo_enumerate_1[10] FAILED                    [  5%]\r\ntest_enum_funsor.py::test_elbo_enumerate_2[1] FAILED                     [  7%]\r\ntest_enum_funsor.py::test_elbo_enumerate_2[10] FAILED                    [  9%]\r\ntest_enum_funsor.py::test_elbo_enumerate_3[1] FAILED                     [ 11%]\r\ntest_enum_funsor.py::test_elbo_enumerate_3[10] FAILED                    [ 13%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_1[batch-1] FAILED         [ 15%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_1[batch-10] FAILED        [ 16%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_1[masked-1] FAILED        [ 18%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_1[masked-10] FAILED       [ 20%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_2[batch-1] FAILED         [ 22%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_2[batch-10] FAILED        [ 24%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_2[masked-1] FAILED        [ 26%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_2[masked-10] FAILED       [ 28%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_3[batch-1] FAILED         [ 30%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_3[batch-10] FAILED        [ 32%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_3[masked-1] FAILED        [ 33%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_3[masked-10] FAILED       [ 35%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_4[False-True-1] PASSED    [ 37%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_4[False-True-10] PASSED   [ 39%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_4[True-False-1] PASSED    [ 41%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_4[True-False-10] PASSED   [ 43%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_4[True-True-1] PASSED     [ 45%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_4[True-True-10] PASSED    [ 47%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_5 XFAIL                   [ 49%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_6[parallel] FAILED        [ 50%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_6[sequential] PASSED      [ 52%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_7[1] FAILED               [ 54%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_7[10] FAILED              [ 56%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_1[1] PASSED              [ 58%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_1[10] PASSED             [ 60%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_2[1] PASSED              [ 62%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_2[10] PASSED             [ 64%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_3[1] PASSED              [ 66%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_3[10] PASSED             [ 67%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_4[1] PASSED              [ 69%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_4[10] PASSED             [ 71%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_5[1] PASSED              [ 73%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_5[10] PASSED             [ 75%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_6[1] PASSED              [ 77%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_6[10] PASSED             [ 79%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_7[1] PASSED              [ 81%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_7[10] PASSED             [ 83%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_8[False-False-1-1] FAILED [ 84%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_8[False-True-1-1] XFAIL  [ 86%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_8[True-False-1-1] FAILED [ 88%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plates_8[True-True-1-1] XFAIL   [ 90%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_9 FAILED                  [ 92%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_10 FAILED                 [ 94%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_11 FAILED                 [ 96%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_12 FAILED                 [ 98%]\r\ntest_enum_funsor.py::test_elbo_enumerate_plate_13 FAILED                 [100%]\r\n```\r\n\r\n</details>","closed_by":null,"reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/493/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/493/timeline","performed_via_github_app":null,"state_reason":null}