{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/236","repository_url":"https://api.github.com/repos/pyro-ppl/funsor","labels_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/236/labels{/name}","comments_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/236/comments","events_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/236/events","html_url":"https://github.com/pyro-ppl/funsor/issues/236","id":493000599,"node_id":"MDU6SXNzdWU0OTMwMDA1OTk=","number":236,"title":"Incorrect alpha conversion in eager_distribute_reduce_other","user":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"labels":[{"id":1215006860,"node_id":"MDU6TGFiZWwxMjE1MDA2ODYw","url":"https://api.github.com/repos/pyro-ppl/funsor/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-09-12T19:59:27Z","updated_at":"2019-10-21T19:53:50Z","closed_at":"2019-10-21T19:53:50Z","author_association":"MEMBER","active_lock_reason":null,"body":"This came up in JP's experiment. I don't have an easy way to reproduce.\r\n\r\n```\r\nipdb> foo = prod_op(x, y); print(foo.pretty())\r\n...\r\n/usr/local/lib/python3.6/dist-packages/funsor/terms.py in eager_distribute_reduce_other(op, red, other)\r\n    993         # Use distributive law.\r\n    994         arg = op(red.arg, other)\r\n--> 995         return arg.reduce(red.op, red.reduced_vars)\r\n    996 \r\n    997     return None  # defer to default implementation\r\n\r\n/usr/local/lib/python3.6/dist-packages/funsor/terms.py in reduce(self, op, reduced_vars)\r\n    389         if not reduced_vars:\r\n    390             return self\r\n--> 391         assert reduced_vars.issubset(self.inputs)\r\n    392         return Reduce(op, self, reduced_vars)\r\n    393 \r\n*** AssertionError\r\n```\r\n\r\n<details>\r\n\r\n```\r\nipdb> print(x.pretty())\r\nReduce\r\n│ logaddexp\r\n│ Binary\r\n│ │ add\r\n│ │ Binary\r\n│ │ │ add\r\n│ │ │ Joint\r\n│ │ │ │ tuple\r\n│ │ │ │ Tensor\r\n│ │ │ │ │ tensor(-9.1894, grad_fn=<SubBackward0>)\r\n│ │ │ │ │ tuple\r\n│ │ │ │ │ 'real'\r\n│ │ │ │ Gaussian\r\n│ │ │ │ │ tensor([0., 0., 0., 0., 0., 0., 0., 0., ...\r\n│ │ │ │ │ tensor([[1., 0., 0., 0., 0., 0., 0., 0.,...\r\n│ │ │ │ │ tuple\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ 'bias'\r\n│ │ │ │ │ │ │ reals(10,)\r\n│ │ │ Binary\r\n│ │ │ │ add\r\n│ │ │ │ Joint\r\n│ │ │ │ │ tuple\r\n│ │ │ │ │ Tensor\r\n│ │ │ │ │ │ tensor(-0.3123, grad_fn=<SubBackward0>)\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ 'real'\r\n│ │ │ │ │ Gaussian\r\n│ │ │ │ │ │ tensor([-0., -0., 0., 0.], grad_fn=<CatB...\r\n│ │ │ │ │ │ tensor([[  9.5114,   5.9748, -12.2663,  ...\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ 'state'\r\n│ │ │ │ │ │ │ │ reals(2,)\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ '_drop_0__BOUND_8'\r\n│ │ │ │ │ │ │ │ reals(2,)\r\n│ │ │ │ Binary\r\n│ │ │ │ │ add\r\n│ │ │ │ │ Tensor\r\n│ │ │ │ │ │ tensor(-9.1894, grad_fn=<SubBackward0>)\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ 'real'\r\n│ │ │ │ │ Subs\r\n│ │ │ │ │ │ Gaussian\r\n│ │ │ │ │ │ │ tensor([-0., -0., 0., 0., 0., 0., 0., 0....\r\n│ │ │ │ │ │ │ tensor([[10.7313, -1.0670, -1.4597, -0.1...\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ '_drop_0__BOUND_8'\r\n│ │ │ │ │ │ │ │ │ reals(2,)\r\n│ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ 'value__BOUND_7'\r\n│ │ │ │ │ │ │ │ │ reals(10,)\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ 'value__BOUND_7'\r\n│ │ │ │ │ │ │ │ Affine\r\n│ │ │ │ │ │ │ │ │ Tensor\r\n│ │ │ │ │ │ │ │ │ │ tensor([[  9.2302,   4.4876,   9.2302,  ...\r\n│ │ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ │ │ 'time'\r\n│ │ │ │ │ │ │ │ │ │ │ │ bint(25)\r\n│ │ │ │ │ │ │ │ │ │ 'real'\r\n│ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ │ Variable\r\n│ │ │ │ │ │ │ │ │ │ │ │ 'bias'\r\n│ │ │ │ │ │ │ │ │ │ │ │ reals(10,)\r\n│ │ │ │ │ │ │ │ │ │ │ Number\r\n│ │ │ │ │ │ │ │ │ │ │ │ 1.0\r\n│ │ │ │ │ │ │ │ │ │ │ │ 'real'\r\n│ │ Binary\r\n│ │ │ add\r\n│ │ │ Joint\r\n│ │ │ │ tuple\r\n│ │ │ │ Tensor\r\n│ │ │ │ │ tensor(-9.1894, grad_fn=<SubBackward0>)\r\n│ │ │ │ │ tuple\r\n│ │ │ │ │ 'real'\r\n│ │ │ │ Gaussian\r\n│ │ │ │ │ tensor([0., 0., 0., 0., 0., 0., 0., 0., ...\r\n│ │ │ │ │ tensor([[1., 0., 0., 0., 0., 0., 0., 0.,...\r\n│ │ │ │ │ tuple\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ 'bias'\r\n│ │ │ │ │ │ │ reals(10,)\r\n│ │ │ Binary\r\n│ │ │ │ add\r\n│ │ │ │ Joint\r\n│ │ │ │ │ tuple\r\n│ │ │ │ │ Tensor\r\n│ │ │ │ │ │ tensor(-0.3123, grad_fn=<SubBackward0>)\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ 'real'\r\n│ │ │ │ │ Gaussian\r\n│ │ │ │ │ │ tensor([-0., -0., 0., 0.], grad_fn=<CatB...\r\n│ │ │ │ │ │ tensor([[  9.5114,   5.9748, -12.2663,  ...\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ '_drop_0__BOUND_8'\r\n│ │ │ │ │ │ │ │ reals(2,)\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ '_drop_0'\r\n│ │ │ │ │ │ │ │ reals(2,)\r\n│ │ │ │ Binary\r\n│ │ │ │ │ add\r\n│ │ │ │ │ Tensor\r\n│ │ │ │ │ │ tensor(-9.1894, grad_fn=<SubBackward0>)\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ 'real'\r\n│ │ │ │ │ Subs\r\n│ │ │ │ │ │ Gaussian\r\n│ │ │ │ │ │ │ tensor([-0., -0., 0., 0., 0., 0., 0., 0....\r\n│ │ │ │ │ │ │ tensor([[10.7313, -1.0670, -1.4597, -0.1...\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ '_drop_0'\r\n│ │ │ │ │ │ │ │ │ reals(2,)\r\n│ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ 'value__BOUND_7'\r\n│ │ │ │ │ │ │ │ │ reals(10,)\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ 'value__BOUND_7'\r\n│ │ │ │ │ │ │ │ Affine\r\n│ │ │ │ │ │ │ │ │ Tensor\r\n│ │ │ │ │ │ │ │ │ │ tensor([[  9.1626,   4.2122,   9.1626,  ...\r\n│ │ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ │ │ 'time'\r\n│ │ │ │ │ │ │ │ │ │ │ │ bint(25)\r\n│ │ │ │ │ │ │ │ │ │ 'real'\r\n│ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ │ Variable\r\n│ │ │ │ │ │ │ │ │ │ │ │ 'bias'\r\n│ │ │ │ │ │ │ │ │ │ │ │ reals(10,)\r\n│ │ │ │ │ │ │ │ │ │ │ Number\r\n│ │ │ │ │ │ │ │ │ │ │ │ 1.0\r\n│ │ │ │ │ │ │ │ │ │ │ │ 'real'\r\n│ frozenset({'_drop_0__BOUND_8'})\r\nipdb> print(y.pretty())\r\nReduce\r\n│ logaddexp\r\n│ Binary\r\n│ │ add\r\n│ │ Binary\r\n│ │ │ add\r\n│ │ │ Joint\r\n│ │ │ │ tuple\r\n│ │ │ │ Tensor\r\n│ │ │ │ │ tensor(-9.1894, grad_fn=<SubBackward0>)\r\n│ │ │ │ │ tuple\r\n│ │ │ │ │ 'real'\r\n│ │ │ │ Gaussian\r\n│ │ │ │ │ tensor([0., 0., 0., 0., 0., 0., 0., 0., ...\r\n│ │ │ │ │ tensor([[1., 0., 0., 0., 0., 0., 0., 0.,...\r\n│ │ │ │ │ tuple\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ 'bias'\r\n│ │ │ │ │ │ │ reals(10,)\r\n│ │ │ Binary\r\n│ │ │ │ add\r\n│ │ │ │ Joint\r\n│ │ │ │ │ tuple\r\n│ │ │ │ │ Tensor\r\n│ │ │ │ │ │ tensor(-0.3123, grad_fn=<SubBackward0>)\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ 'real'\r\n│ │ │ │ │ Gaussian\r\n│ │ │ │ │ │ tensor([-0., -0., 0., 0.], grad_fn=<CatB...\r\n│ │ │ │ │ │ tensor([[  9.5114,   5.9748, -12.2663,  ...\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ '_drop_0'\r\n│ │ │ │ │ │ │ │ reals(2,)\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ '_drop_0__BOUND_8'\r\n│ │ │ │ │ │ │ │ reals(2,)\r\n│ │ │ │ Binary\r\n│ │ │ │ │ add\r\n│ │ │ │ │ Tensor\r\n│ │ │ │ │ │ tensor(-9.1894, grad_fn=<SubBackward0>)\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ 'real'\r\n│ │ │ │ │ Subs\r\n│ │ │ │ │ │ Gaussian\r\n│ │ │ │ │ │ │ tensor([-0., -0., 0., 0., 0., 0., 0., 0....\r\n│ │ │ │ │ │ │ tensor([[10.7313, -1.0670, -1.4597, -0.1...\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ '_drop_0__BOUND_8'\r\n│ │ │ │ │ │ │ │ │ reals(2,)\r\n│ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ 'value__BOUND_7'\r\n│ │ │ │ │ │ │ │ │ reals(10,)\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ 'value__BOUND_7'\r\n│ │ │ │ │ │ │ │ Affine\r\n│ │ │ │ │ │ │ │ │ Tensor\r\n│ │ │ │ │ │ │ │ │ │ tensor([[  9.8120,   3.2142,   9.8120,  ...\r\n│ │ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ │ │ 'time'\r\n│ │ │ │ │ │ │ │ │ │ │ │ bint(25)\r\n│ │ │ │ │ │ │ │ │ │ 'real'\r\n│ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ │ Variable\r\n│ │ │ │ │ │ │ │ │ │ │ │ 'bias'\r\n│ │ │ │ │ │ │ │ │ │ │ │ reals(10,)\r\n│ │ │ │ │ │ │ │ │ │ │ Number\r\n│ │ │ │ │ │ │ │ │ │ │ │ 1.0\r\n│ │ │ │ │ │ │ │ │ │ │ │ 'real'\r\n│ │ Binary\r\n│ │ │ add\r\n│ │ │ Joint\r\n│ │ │ │ tuple\r\n│ │ │ │ Tensor\r\n│ │ │ │ │ tensor(-9.1894, grad_fn=<SubBackward0>)\r\n│ │ │ │ │ tuple\r\n│ │ │ │ │ 'real'\r\n│ │ │ │ Gaussian\r\n│ │ │ │ │ tensor([0., 0., 0., 0., 0., 0., 0., 0., ...\r\n│ │ │ │ │ tensor([[1., 0., 0., 0., 0., 0., 0., 0.,...\r\n│ │ │ │ │ tuple\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ 'bias'\r\n│ │ │ │ │ │ │ reals(10,)\r\n│ │ │ Binary\r\n│ │ │ │ add\r\n│ │ │ │ Joint\r\n│ │ │ │ │ tuple\r\n│ │ │ │ │ Tensor\r\n│ │ │ │ │ │ tensor(-0.3123, grad_fn=<SubBackward0>)\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ 'real'\r\n│ │ │ │ │ Gaussian\r\n│ │ │ │ │ │ tensor([-0., -0., 0., 0.], grad_fn=<CatB...\r\n│ │ │ │ │ │ tensor([[  9.5114,   5.9748, -12.2663,  ...\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ '_drop_0__BOUND_8'\r\n│ │ │ │ │ │ │ │ reals(2,)\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ 'state(time=1)'\r\n│ │ │ │ │ │ │ │ reals(2,)\r\n│ │ │ │ Binary\r\n│ │ │ │ │ add\r\n│ │ │ │ │ Tensor\r\n│ │ │ │ │ │ tensor(-9.1894, grad_fn=<SubBackward0>)\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ 'real'\r\n│ │ │ │ │ Subs\r\n│ │ │ │ │ │ Gaussian\r\n│ │ │ │ │ │ │ tensor([-0., -0., 0., 0., 0., 0., 0., 0....\r\n│ │ │ │ │ │ │ tensor([[10.7313, -1.0670, -1.4597, -0.1...\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ 'state(time=1)'\r\n│ │ │ │ │ │ │ │ │ reals(2,)\r\n│ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ 'value__BOUND_7'\r\n│ │ │ │ │ │ │ │ │ reals(10,)\r\n│ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ 'value__BOUND_7'\r\n│ │ │ │ │ │ │ │ Affine\r\n│ │ │ │ │ │ │ │ │ Tensor\r\n│ │ │ │ │ │ │ │ │ │ tensor([[ 10.0083,   3.7126,  10.0083,  ...\r\n│ │ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ │ │ 'time'\r\n│ │ │ │ │ │ │ │ │ │ │ │ bint(25)\r\n│ │ │ │ │ │ │ │ │ │ 'real'\r\n│ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ tuple\r\n│ │ │ │ │ │ │ │ │ │ │ Variable\r\n│ │ │ │ │ │ │ │ │ │ │ │ 'bias'\r\n│ │ │ │ │ │ │ │ │ │ │ │ reals(10,)\r\n│ │ │ │ │ │ │ │ │ │ │ Number\r\n│ │ │ │ │ │ │ │ │ │ │ │ 1.0\r\n│ │ │ │ │ │ │ │ │ │ │ │ 'real'\r\n│ frozenset({'_drop_0__BOUND_8'})\r\n```\r\n\r\n</details>","closed_by":{"login":"fritzo","id":648532,"node_id":"MDQ6VXNlcjY0ODUzMg==","avatar_url":"https://avatars.githubusercontent.com/u/648532?v=4","gravatar_id":"","url":"https://api.github.com/users/fritzo","html_url":"https://github.com/fritzo","followers_url":"https://api.github.com/users/fritzo/followers","following_url":"https://api.github.com/users/fritzo/following{/other_user}","gists_url":"https://api.github.com/users/fritzo/gists{/gist_id}","starred_url":"https://api.github.com/users/fritzo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fritzo/subscriptions","organizations_url":"https://api.github.com/users/fritzo/orgs","repos_url":"https://api.github.com/users/fritzo/repos","events_url":"https://api.github.com/users/fritzo/events{/privacy}","received_events_url":"https://api.github.com/users/fritzo/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pyro-ppl/funsor/issues/236/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pyro-ppl/funsor/issues/236/timeline","performed_via_github_app":null,"state_reason":"completed"}