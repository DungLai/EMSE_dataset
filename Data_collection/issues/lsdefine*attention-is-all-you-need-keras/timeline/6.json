[{"url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/comments/414116438","html_url":"https://github.com/lsdefine/attention-is-all-you-need-keras/issues/6#issuecomment-414116438","issue_url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/6","id":414116438,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDExNjQzOA==","user":{"login":"XiaoLiuAI","id":1553482,"node_id":"MDQ6VXNlcjE1NTM0ODI=","avatar_url":"https://avatars.githubusercontent.com/u/1553482?v=4","gravatar_id":"","url":"https://api.github.com/users/XiaoLiuAI","html_url":"https://github.com/XiaoLiuAI","followers_url":"https://api.github.com/users/XiaoLiuAI/followers","following_url":"https://api.github.com/users/XiaoLiuAI/following{/other_user}","gists_url":"https://api.github.com/users/XiaoLiuAI/gists{/gist_id}","starred_url":"https://api.github.com/users/XiaoLiuAI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/XiaoLiuAI/subscriptions","organizations_url":"https://api.github.com/users/XiaoLiuAI/orgs","repos_url":"https://api.github.com/users/XiaoLiuAI/repos","events_url":"https://api.github.com/users/XiaoLiuAI/events{/privacy}","received_events_url":"https://api.github.com/users/XiaoLiuAI/received_events","type":"User","site_admin":false},"created_at":"2018-08-19T09:50:00Z","updated_at":"2018-08-19T09:50:00Z","author_association":"NONE","body":"Hi, thank you for your response. But I still want to make sure that I understand correctly. Let me put the attention block below: \r\n```\r\n       attn = Lambda(lambda x:K.batch_dot(x[0],x[1],axes=[2,2])/self.temper)([q, k])\r\n        if mask is not None:\r\n            mmask = Lambda(lambda x:(-1e+10)*(1-x))(mask)\r\n            attn = Add()([attn, mmask])\r\n        attn = Activation('softmax')(attn)\r\n        attn = self.dropout(attn)\r\n        output = Lambda(lambda x:K.batch_dot(x[0], x[1]))([attn, v])\r\n```\r\nIs the `Activation` layer assure that the mask is \"column-based\"? It applies softmax on the last dimension, which is the column of attention matrix?\r\n","reactions":{"url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/comments/414116438/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"XiaoLiuAI","id":1553482,"node_id":"MDQ6VXNlcjE1NTM0ODI=","avatar_url":"https://avatars.githubusercontent.com/u/1553482?v=4","gravatar_id":"","url":"https://api.github.com/users/XiaoLiuAI","html_url":"https://github.com/XiaoLiuAI","followers_url":"https://api.github.com/users/XiaoLiuAI/followers","following_url":"https://api.github.com/users/XiaoLiuAI/following{/other_user}","gists_url":"https://api.github.com/users/XiaoLiuAI/gists{/gist_id}","starred_url":"https://api.github.com/users/XiaoLiuAI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/XiaoLiuAI/subscriptions","organizations_url":"https://api.github.com/users/XiaoLiuAI/orgs","repos_url":"https://api.github.com/users/XiaoLiuAI/repos","events_url":"https://api.github.com/users/XiaoLiuAI/events{/privacy}","received_events_url":"https://api.github.com/users/XiaoLiuAI/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/comments/414117635","html_url":"https://github.com/lsdefine/attention-is-all-you-need-keras/issues/6#issuecomment-414117635","issue_url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/6","id":414117635,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDExNzYzNQ==","user":{"login":"XiaoLiuAI","id":1553482,"node_id":"MDQ6VXNlcjE1NTM0ODI=","avatar_url":"https://avatars.githubusercontent.com/u/1553482?v=4","gravatar_id":"","url":"https://api.github.com/users/XiaoLiuAI","html_url":"https://github.com/XiaoLiuAI","followers_url":"https://api.github.com/users/XiaoLiuAI/followers","following_url":"https://api.github.com/users/XiaoLiuAI/following{/other_user}","gists_url":"https://api.github.com/users/XiaoLiuAI/gists{/gist_id}","starred_url":"https://api.github.com/users/XiaoLiuAI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/XiaoLiuAI/subscriptions","organizations_url":"https://api.github.com/users/XiaoLiuAI/orgs","repos_url":"https://api.github.com/users/XiaoLiuAI/repos","events_url":"https://api.github.com/users/XiaoLiuAI/events{/privacy}","received_events_url":"https://api.github.com/users/XiaoLiuAI/received_events","type":"User","site_admin":false},"created_at":"2018-08-19T10:16:41Z","updated_at":"2018-08-19T10:16:41Z","author_association":"NONE","body":"If I make a matrix with upper right parts zero and multiply element-wise with attention matrix. For example\r\n```\r\nmask = tf.matrix_band_part(tf.ones_like(q.shape[1], k.shape[1]), -1, 0)\r\n...\r\nattn = Multiply()([attn, mask])\r\n```\r\nWould it take equivalent effects? ","reactions":{"url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/comments/414117635/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"XiaoLiuAI","id":1553482,"node_id":"MDQ6VXNlcjE1NTM0ODI=","avatar_url":"https://avatars.githubusercontent.com/u/1553482?v=4","gravatar_id":"","url":"https://api.github.com/users/XiaoLiuAI","html_url":"https://github.com/XiaoLiuAI","followers_url":"https://api.github.com/users/XiaoLiuAI/followers","following_url":"https://api.github.com/users/XiaoLiuAI/following{/other_user}","gists_url":"https://api.github.com/users/XiaoLiuAI/gists{/gist_id}","starred_url":"https://api.github.com/users/XiaoLiuAI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/XiaoLiuAI/subscriptions","organizations_url":"https://api.github.com/users/XiaoLiuAI/orgs","repos_url":"https://api.github.com/users/XiaoLiuAI/repos","events_url":"https://api.github.com/users/XiaoLiuAI/events{/privacy}","received_events_url":"https://api.github.com/users/XiaoLiuAI/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/comments/414117754","html_url":"https://github.com/lsdefine/attention-is-all-you-need-keras/issues/6#issuecomment-414117754","issue_url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/6","id":414117754,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDExNzc1NA==","user":{"login":"lsdefine","id":3377819,"node_id":"MDQ6VXNlcjMzNzc4MTk=","avatar_url":"https://avatars.githubusercontent.com/u/3377819?v=4","gravatar_id":"","url":"https://api.github.com/users/lsdefine","html_url":"https://github.com/lsdefine","followers_url":"https://api.github.com/users/lsdefine/followers","following_url":"https://api.github.com/users/lsdefine/following{/other_user}","gists_url":"https://api.github.com/users/lsdefine/gists{/gist_id}","starred_url":"https://api.github.com/users/lsdefine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lsdefine/subscriptions","organizations_url":"https://api.github.com/users/lsdefine/orgs","repos_url":"https://api.github.com/users/lsdefine/repos","events_url":"https://api.github.com/users/lsdefine/events{/privacy}","received_events_url":"https://api.github.com/users/lsdefine/received_events","type":"User","site_admin":false},"created_at":"2018-08-19T10:19:13Z","updated_at":"2018-08-19T10:19:13Z","author_association":"OWNER","body":"Sorry, my previous answer is wrong and I have found the right answers.\r\nThe experiment shows that using 1-mask+eye. The training accu & dev accu quickly go to near 100% but the model cannot process any user inputs. This situation means the model is using the future information.\r\nThe problem is: the axis 1 is not the column because there is a \"Batch\" axis.\r\n```\r\n>>> K.eval(GetSubMask(q))   # mask = K.cumsum(tf.eye(len_s, batch_shape=bs), 1)\r\narray([[[1., 0., 0., 0., 0., 0., 0.],\r\n        [1., 1., 0., 0., 0., 0., 0.],\r\n        [1., 1., 1., 0., 0., 0., 0.],\r\n        [1., 1., 1., 1., 0., 0., 0.],\r\n        [1., 1., 1., 1., 1., 0., 0.],\r\n        [1., 1., 1., 1., 1., 1., 0.],\r\n        [1., 1., 1., 1., 1., 1., 1.]]], dtype=float32)\r\n>>> np.cumsum(np.eye(5), 1)   # Your question\r\narray([[1., 1., 1., 1., 1.],\r\n       [0., 1., 1., 1., 1.],\r\n       [0., 0., 1., 1., 1.],\r\n       [0., 0., 0., 1., 1.],\r\n       [0., 0., 0., 0., 1.]])\r\n>>> np.cumsum(np.eye(5), 0)   # If no \"Batch\" axis, the cum axis is 0\r\narray([[1., 0., 0., 0., 0.],\r\n       [1., 1., 0., 0., 0.],\r\n       [1., 1., 1., 0., 0.],\r\n       [1., 1., 1., 1., 0.],\r\n       [1., 1., 1., 1., 1.]])\r\n```","reactions":{"url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/comments/414117754/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lsdefine","id":3377819,"node_id":"MDQ6VXNlcjMzNzc4MTk=","avatar_url":"https://avatars.githubusercontent.com/u/3377819?v=4","gravatar_id":"","url":"https://api.github.com/users/lsdefine","html_url":"https://github.com/lsdefine","followers_url":"https://api.github.com/users/lsdefine/followers","following_url":"https://api.github.com/users/lsdefine/following{/other_user}","gists_url":"https://api.github.com/users/lsdefine/gists{/gist_id}","starred_url":"https://api.github.com/users/lsdefine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lsdefine/subscriptions","organizations_url":"https://api.github.com/users/lsdefine/orgs","repos_url":"https://api.github.com/users/lsdefine/repos","events_url":"https://api.github.com/users/lsdefine/events{/privacy}","received_events_url":"https://api.github.com/users/lsdefine/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/comments/414118048","html_url":"https://github.com/lsdefine/attention-is-all-you-need-keras/issues/6#issuecomment-414118048","issue_url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/6","id":414118048,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDExODA0OA==","user":{"login":"lsdefine","id":3377819,"node_id":"MDQ6VXNlcjMzNzc4MTk=","avatar_url":"https://avatars.githubusercontent.com/u/3377819?v=4","gravatar_id":"","url":"https://api.github.com/users/lsdefine","html_url":"https://github.com/lsdefine","followers_url":"https://api.github.com/users/lsdefine/followers","following_url":"https://api.github.com/users/lsdefine/following{/other_user}","gists_url":"https://api.github.com/users/lsdefine/gists{/gist_id}","starred_url":"https://api.github.com/users/lsdefine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lsdefine/subscriptions","organizations_url":"https://api.github.com/users/lsdefine/orgs","repos_url":"https://api.github.com/users/lsdefine/repos","events_url":"https://api.github.com/users/lsdefine/events{/privacy}","received_events_url":"https://api.github.com/users/lsdefine/received_events","type":"User","site_admin":false},"created_at":"2018-08-19T10:25:14Z","updated_at":"2018-08-19T10:25:14Z","author_association":"OWNER","body":"We surely need a lower left triangular mask, as our expectation.","reactions":{"url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/comments/414118048/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lsdefine","id":3377819,"node_id":"MDQ6VXNlcjMzNzc4MTk=","avatar_url":"https://avatars.githubusercontent.com/u/3377819?v=4","gravatar_id":"","url":"https://api.github.com/users/lsdefine","html_url":"https://github.com/lsdefine","followers_url":"https://api.github.com/users/lsdefine/followers","following_url":"https://api.github.com/users/lsdefine/following{/other_user}","gists_url":"https://api.github.com/users/lsdefine/gists{/gist_id}","starred_url":"https://api.github.com/users/lsdefine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lsdefine/subscriptions","organizations_url":"https://api.github.com/users/lsdefine/orgs","repos_url":"https://api.github.com/users/lsdefine/repos","events_url":"https://api.github.com/users/lsdefine/events{/privacy}","received_events_url":"https://api.github.com/users/lsdefine/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/comments/414118533","html_url":"https://github.com/lsdefine/attention-is-all-you-need-keras/issues/6#issuecomment-414118533","issue_url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/6","id":414118533,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDExODUzMw==","user":{"login":"XiaoLiuAI","id":1553482,"node_id":"MDQ6VXNlcjE1NTM0ODI=","avatar_url":"https://avatars.githubusercontent.com/u/1553482?v=4","gravatar_id":"","url":"https://api.github.com/users/XiaoLiuAI","html_url":"https://github.com/XiaoLiuAI","followers_url":"https://api.github.com/users/XiaoLiuAI/followers","following_url":"https://api.github.com/users/XiaoLiuAI/following{/other_user}","gists_url":"https://api.github.com/users/XiaoLiuAI/gists{/gist_id}","starred_url":"https://api.github.com/users/XiaoLiuAI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/XiaoLiuAI/subscriptions","organizations_url":"https://api.github.com/users/XiaoLiuAI/orgs","repos_url":"https://api.github.com/users/XiaoLiuAI/repos","events_url":"https://api.github.com/users/XiaoLiuAI/events{/privacy}","received_events_url":"https://api.github.com/users/XiaoLiuAI/received_events","type":"User","site_admin":false},"created_at":"2018-08-19T10:33:58Z","updated_at":"2018-08-19T10:33:58Z","author_association":"NONE","body":"Thanks, that is clear. ","reactions":{"url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/comments/414118533/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"XiaoLiuAI","id":1553482,"node_id":"MDQ6VXNlcjE1NTM0ODI=","avatar_url":"https://avatars.githubusercontent.com/u/1553482?v=4","gravatar_id":"","url":"https://api.github.com/users/XiaoLiuAI","html_url":"https://github.com/XiaoLiuAI","followers_url":"https://api.github.com/users/XiaoLiuAI/followers","following_url":"https://api.github.com/users/XiaoLiuAI/following{/other_user}","gists_url":"https://api.github.com/users/XiaoLiuAI/gists{/gist_id}","starred_url":"https://api.github.com/users/XiaoLiuAI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/XiaoLiuAI/subscriptions","organizations_url":"https://api.github.com/users/XiaoLiuAI/orgs","repos_url":"https://api.github.com/users/XiaoLiuAI/repos","events_url":"https://api.github.com/users/XiaoLiuAI/events{/privacy}","received_events_url":"https://api.github.com/users/XiaoLiuAI/received_events","type":"User","site_admin":false}},{"id":1799468373,"node_id":"MDExOkNsb3NlZEV2ZW50MTc5OTQ2ODM3Mw==","url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/events/1799468373","actor":{"login":"XiaoLiuAI","id":1553482,"node_id":"MDQ6VXNlcjE1NTM0ODI=","avatar_url":"https://avatars.githubusercontent.com/u/1553482?v=4","gravatar_id":"","url":"https://api.github.com/users/XiaoLiuAI","html_url":"https://github.com/XiaoLiuAI","followers_url":"https://api.github.com/users/XiaoLiuAI/followers","following_url":"https://api.github.com/users/XiaoLiuAI/following{/other_user}","gists_url":"https://api.github.com/users/XiaoLiuAI/gists{/gist_id}","starred_url":"https://api.github.com/users/XiaoLiuAI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/XiaoLiuAI/subscriptions","organizations_url":"https://api.github.com/users/XiaoLiuAI/orgs","repos_url":"https://api.github.com/users/XiaoLiuAI/repos","events_url":"https://api.github.com/users/XiaoLiuAI/events{/privacy}","received_events_url":"https://api.github.com/users/XiaoLiuAI/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2018-08-21T07:51:24Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/comments/414609072","html_url":"https://github.com/lsdefine/attention-is-all-you-need-keras/issues/6#issuecomment-414609072","issue_url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/6","id":414609072,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDYwOTA3Mg==","user":{"login":"lsdefine","id":3377819,"node_id":"MDQ6VXNlcjMzNzc4MTk=","avatar_url":"https://avatars.githubusercontent.com/u/3377819?v=4","gravatar_id":"","url":"https://api.github.com/users/lsdefine","html_url":"https://github.com/lsdefine","followers_url":"https://api.github.com/users/lsdefine/followers","following_url":"https://api.github.com/users/lsdefine/following{/other_user}","gists_url":"https://api.github.com/users/lsdefine/gists{/gist_id}","starred_url":"https://api.github.com/users/lsdefine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lsdefine/subscriptions","organizations_url":"https://api.github.com/users/lsdefine/orgs","repos_url":"https://api.github.com/users/lsdefine/repos","events_url":"https://api.github.com/users/lsdefine/events{/privacy}","received_events_url":"https://api.github.com/users/lsdefine/received_events","type":"User","site_admin":false},"created_at":"2018-08-21T09:19:12Z","updated_at":"2018-08-21T09:19:12Z","author_association":"OWNER","body":"Hi,\n       The training corpus is too large. The corpus in the repo is only\nused for showing the format.\n       You may generate a large corpus for a good result.\n[image: image.png]\n\n\n\n\n\nXiao.Liu <notifications@github.com> 于2018年8月21日周二 下午3:51写道：\n\n> Hello, I tried the pinyin example with all the configuration untouched.\n> But the final test result is very bad. The result for 'ji zhi hu die zai\n> yang guang xia fei wu 。' is '斯对管道的资不仅能加中考。'\n>\n> —\n> You are receiving this because you commented.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/Lsdefine/attention-is-all-you-need-keras/issues/6#issuecomment-414583596>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/ADOKm9Z9_qvfQykEg_zquBbGfd-g0S0Jks5uS7v8gaJpZM4WClEA>\n> .\n>\n","reactions":{"url":"https://api.github.com/repos/lsdefine/attention-is-all-you-need-keras/issues/comments/414609072/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lsdefine","id":3377819,"node_id":"MDQ6VXNlcjMzNzc4MTk=","avatar_url":"https://avatars.githubusercontent.com/u/3377819?v=4","gravatar_id":"","url":"https://api.github.com/users/lsdefine","html_url":"https://github.com/lsdefine","followers_url":"https://api.github.com/users/lsdefine/followers","following_url":"https://api.github.com/users/lsdefine/following{/other_user}","gists_url":"https://api.github.com/users/lsdefine/gists{/gist_id}","starred_url":"https://api.github.com/users/lsdefine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lsdefine/subscriptions","organizations_url":"https://api.github.com/users/lsdefine/orgs","repos_url":"https://api.github.com/users/lsdefine/repos","events_url":"https://api.github.com/users/lsdefine/events{/privacy}","received_events_url":"https://api.github.com/users/lsdefine/received_events","type":"User","site_admin":false}}]