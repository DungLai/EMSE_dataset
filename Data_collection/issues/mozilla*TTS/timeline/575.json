[{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/732049273","html_url":"https://github.com/mozilla/TTS/issues/575#issuecomment-732049273","issue_url":"https://api.github.com/repos/mozilla/TTS/issues/575","id":732049273,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjA0OTI3Mw==","user":{"login":"lexkoro","id":6319070,"node_id":"MDQ6VXNlcjYzMTkwNzA=","avatar_url":"https://avatars.githubusercontent.com/u/6319070?v=4","gravatar_id":"","url":"https://api.github.com/users/lexkoro","html_url":"https://github.com/lexkoro","followers_url":"https://api.github.com/users/lexkoro/followers","following_url":"https://api.github.com/users/lexkoro/following{/other_user}","gists_url":"https://api.github.com/users/lexkoro/gists{/gist_id}","starred_url":"https://api.github.com/users/lexkoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexkoro/subscriptions","organizations_url":"https://api.github.com/users/lexkoro/orgs","repos_url":"https://api.github.com/users/lexkoro/repos","events_url":"https://api.github.com/users/lexkoro/events{/privacy}","received_events_url":"https://api.github.com/users/lexkoro/received_events","type":"User","site_admin":false},"created_at":"2020-11-23T09:50:41Z","updated_at":"2020-11-23T09:50:41Z","author_association":"CONTRIBUTOR","body":"Could be a problem with using mixed precision, see also here https://github.com/matplotlib/matplotlib/issues/15432\r\n\r\n","reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/732049273/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lexkoro","id":6319070,"node_id":"MDQ6VXNlcjYzMTkwNzA=","avatar_url":"https://avatars.githubusercontent.com/u/6319070?v=4","gravatar_id":"","url":"https://api.github.com/users/lexkoro","html_url":"https://github.com/lexkoro","followers_url":"https://api.github.com/users/lexkoro/followers","following_url":"https://api.github.com/users/lexkoro/following{/other_user}","gists_url":"https://api.github.com/users/lexkoro/gists{/gist_id}","starred_url":"https://api.github.com/users/lexkoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexkoro/subscriptions","organizations_url":"https://api.github.com/users/lexkoro/orgs","repos_url":"https://api.github.com/users/lexkoro/repos","events_url":"https://api.github.com/users/lexkoro/events{/privacy}","received_events_url":"https://api.github.com/users/lexkoro/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/732092822","html_url":"https://github.com/mozilla/TTS/issues/575#issuecomment-732092822","issue_url":"https://api.github.com/repos/mozilla/TTS/issues/575","id":732092822,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjA5MjgyMg==","user":{"login":"WeberJulian","id":17219561,"node_id":"MDQ6VXNlcjE3MjE5NTYx","avatar_url":"https://avatars.githubusercontent.com/u/17219561?v=4","gravatar_id":"","url":"https://api.github.com/users/WeberJulian","html_url":"https://github.com/WeberJulian","followers_url":"https://api.github.com/users/WeberJulian/followers","following_url":"https://api.github.com/users/WeberJulian/following{/other_user}","gists_url":"https://api.github.com/users/WeberJulian/gists{/gist_id}","starred_url":"https://api.github.com/users/WeberJulian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WeberJulian/subscriptions","organizations_url":"https://api.github.com/users/WeberJulian/orgs","repos_url":"https://api.github.com/users/WeberJulian/repos","events_url":"https://api.github.com/users/WeberJulian/events{/privacy}","received_events_url":"https://api.github.com/users/WeberJulian/received_events","type":"User","site_admin":false},"created_at":"2020-11-23T11:09:24Z","updated_at":"2020-11-23T11:09:24Z","author_association":"CONTRIBUTOR","body":"I think you're right, so the solution would be to cast here \r\n```\r\n  File \"train_tacotron.py\", line 305, in train\r\n    tb_logger.tb_train_figures(global_step, figures)\r\n```\r\nthe figures with something like:\r\n\r\n```python\r\nfigures = [figure.astype(np.float32) for figure in figures]\r\ntb_logger.tb_train_figures(global_step, figures)\r\n```","reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/732092822/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"WeberJulian","id":17219561,"node_id":"MDQ6VXNlcjE3MjE5NTYx","avatar_url":"https://avatars.githubusercontent.com/u/17219561?v=4","gravatar_id":"","url":"https://api.github.com/users/WeberJulian","html_url":"https://github.com/WeberJulian","followers_url":"https://api.github.com/users/WeberJulian/followers","following_url":"https://api.github.com/users/WeberJulian/following{/other_user}","gists_url":"https://api.github.com/users/WeberJulian/gists{/gist_id}","starred_url":"https://api.github.com/users/WeberJulian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WeberJulian/subscriptions","organizations_url":"https://api.github.com/users/WeberJulian/orgs","repos_url":"https://api.github.com/users/WeberJulian/repos","events_url":"https://api.github.com/users/WeberJulian/events{/privacy}","received_events_url":"https://api.github.com/users/WeberJulian/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/732167696","html_url":"https://github.com/mozilla/TTS/issues/575#issuecomment-732167696","issue_url":"https://api.github.com/repos/mozilla/TTS/issues/575","id":732167696,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjE2NzY5Ng==","user":{"login":"WeberJulian","id":17219561,"node_id":"MDQ6VXNlcjE3MjE5NTYx","avatar_url":"https://avatars.githubusercontent.com/u/17219561?v=4","gravatar_id":"","url":"https://api.github.com/users/WeberJulian","html_url":"https://github.com/WeberJulian","followers_url":"https://api.github.com/users/WeberJulian/followers","following_url":"https://api.github.com/users/WeberJulian/following{/other_user}","gists_url":"https://api.github.com/users/WeberJulian/gists{/gist_id}","starred_url":"https://api.github.com/users/WeberJulian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WeberJulian/subscriptions","organizations_url":"https://api.github.com/users/WeberJulian/orgs","repos_url":"https://api.github.com/users/WeberJulian/repos","events_url":"https://api.github.com/users/WeberJulian/events{/privacy}","received_events_url":"https://api.github.com/users/WeberJulian/received_events","type":"User","site_admin":false},"created_at":"2020-11-23T13:39:14Z","updated_at":"2020-11-23T13:39:14Z","author_association":"CONTRIBUTOR","body":"Myfix consisting of adding a bunch of .astype(np.float32) works, but I don't know if it's clean enough to go in a PR. Do we let the fix in the train_tacotron.py file or do we implement something else inside the tb-logger ?\r\n![image](https://user-images.githubusercontent.com/17219561/99968353-525ced00-2d99-11eb-9805-8bf0dd4b1a0d.png)\r\n","reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/732167696/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"WeberJulian","id":17219561,"node_id":"MDQ6VXNlcjE3MjE5NTYx","avatar_url":"https://avatars.githubusercontent.com/u/17219561?v=4","gravatar_id":"","url":"https://api.github.com/users/WeberJulian","html_url":"https://github.com/WeberJulian","followers_url":"https://api.github.com/users/WeberJulian/followers","following_url":"https://api.github.com/users/WeberJulian/following{/other_user}","gists_url":"https://api.github.com/users/WeberJulian/gists{/gist_id}","starred_url":"https://api.github.com/users/WeberJulian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WeberJulian/subscriptions","organizations_url":"https://api.github.com/users/WeberJulian/orgs","repos_url":"https://api.github.com/users/WeberJulian/repos","events_url":"https://api.github.com/users/WeberJulian/events{/privacy}","received_events_url":"https://api.github.com/users/WeberJulian/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/732742005","html_url":"https://github.com/mozilla/TTS/issues/575#issuecomment-732742005","issue_url":"https://api.github.com/repos/mozilla/TTS/issues/575","id":732742005,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjc0MjAwNQ==","user":{"login":"WeberJulian","id":17219561,"node_id":"MDQ6VXNlcjE3MjE5NTYx","avatar_url":"https://avatars.githubusercontent.com/u/17219561?v=4","gravatar_id":"","url":"https://api.github.com/users/WeberJulian","html_url":"https://github.com/WeberJulian","followers_url":"https://api.github.com/users/WeberJulian/followers","following_url":"https://api.github.com/users/WeberJulian/following{/other_user}","gists_url":"https://api.github.com/users/WeberJulian/gists{/gist_id}","starred_url":"https://api.github.com/users/WeberJulian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WeberJulian/subscriptions","organizations_url":"https://api.github.com/users/WeberJulian/orgs","repos_url":"https://api.github.com/users/WeberJulian/repos","events_url":"https://api.github.com/users/WeberJulian/events{/privacy}","received_events_url":"https://api.github.com/users/WeberJulian/received_events","type":"User","site_admin":false},"created_at":"2020-11-24T08:35:01Z","updated_at":"2020-11-24T08:45:19Z","author_association":"CONTRIBUTOR","body":"With the same config, I get this error at 10.4k\r\n\r\n```\r\n[WARNING] NaN or Inf found in input tensor.\r\n[WARNING] NaN or Inf found in input tensor.\r\n ! Run is kept in /home/ubuntu/model_vm/fr-5-speakers-November-23-2020_01+41PM-8d3554d\r\nTraceback (most recent call last):\r\n  File \"train_tacotron.py\", line 691, in <module>\r\n    main(args)\r\n  File \"train_tacotron.py\", line 603, in main\r\n    global_step, epoch, scaler, scaler_st, speaker_mapping)\r\n  File \"train_tacotron.py\", line 183, in train\r\n    text_lengths)\r\n  File \"/home/ubuntu/anaconda3/envs/TTS/lib/python3.6/site-packages/torch/nn/modules/module.py\", line 727, in _call_impl\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/home/ubuntu/TTS/TTS/tts/layers/losses.py\", line 380, in forward\r\n    raise RuntimeError(f\" [!] NaN loss with {key}.\")\r\nRuntimeError:  [!] NaN loss with decoder_loss.\r\n```\r\n\r\nCan this come from AMP as well ?\r\n\r\nI find the tensorboard suspect as it seems that the gradient hit 0 cause all the losses stagnated.\r\n![image](https://user-images.githubusercontent.com/17219561/100069418-082b4880-2e39-11eb-9378-080bf4cd5b3b.png)\r\n\r\nEDIT: I forgot about the gradnorm graph and it seem that I was right about the gradients. @erogol could this be link to the switch from nvidia/apex to native pytorch amp ?\r\n![image](https://user-images.githubusercontent.com/17219561/100070035-bf27c400-2e39-11eb-8e41-9e13323a513c.png)\r\n","reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/732742005/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"WeberJulian","id":17219561,"node_id":"MDQ6VXNlcjE3MjE5NTYx","avatar_url":"https://avatars.githubusercontent.com/u/17219561?v=4","gravatar_id":"","url":"https://api.github.com/users/WeberJulian","html_url":"https://github.com/WeberJulian","followers_url":"https://api.github.com/users/WeberJulian/followers","following_url":"https://api.github.com/users/WeberJulian/following{/other_user}","gists_url":"https://api.github.com/users/WeberJulian/gists{/gist_id}","starred_url":"https://api.github.com/users/WeberJulian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WeberJulian/subscriptions","organizations_url":"https://api.github.com/users/WeberJulian/orgs","repos_url":"https://api.github.com/users/WeberJulian/repos","events_url":"https://api.github.com/users/WeberJulian/events{/privacy}","received_events_url":"https://api.github.com/users/WeberJulian/received_events","type":"User","site_admin":false}},{"id":4031508503,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDAzMTUwODUwMw==","url":"https://api.github.com/repos/mozilla/TTS/issues/events/4031508503","actor":{"login":"erogol","id":1402048,"node_id":"MDQ6VXNlcjE0MDIwNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1402048?v=4","gravatar_id":"","url":"https://api.github.com/users/erogol","html_url":"https://github.com/erogol","followers_url":"https://api.github.com/users/erogol/followers","following_url":"https://api.github.com/users/erogol/following{/other_user}","gists_url":"https://api.github.com/users/erogol/gists{/gist_id}","starred_url":"https://api.github.com/users/erogol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erogol/subscriptions","organizations_url":"https://api.github.com/users/erogol/orgs","repos_url":"https://api.github.com/users/erogol/repos","events_url":"https://api.github.com/users/erogol/events{/privacy}","received_events_url":"https://api.github.com/users/erogol/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-11-24T08:45:19Z","performed_via_github_app":null},{"id":4031508508,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQwMzE1MDg1MDg=","url":"https://api.github.com/repos/mozilla/TTS/issues/events/4031508508","actor":{"login":"erogol","id":1402048,"node_id":"MDQ6VXNlcjE0MDIwNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1402048?v=4","gravatar_id":"","url":"https://api.github.com/users/erogol","html_url":"https://github.com/erogol","followers_url":"https://api.github.com/users/erogol/followers","following_url":"https://api.github.com/users/erogol/following{/other_user}","gists_url":"https://api.github.com/users/erogol/gists{/gist_id}","starred_url":"https://api.github.com/users/erogol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erogol/subscriptions","organizations_url":"https://api.github.com/users/erogol/orgs","repos_url":"https://api.github.com/users/erogol/repos","events_url":"https://api.github.com/users/erogol/events{/privacy}","received_events_url":"https://api.github.com/users/erogol/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-11-24T08:45:19Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/733310933","html_url":"https://github.com/mozilla/TTS/issues/575#issuecomment-733310933","issue_url":"https://api.github.com/repos/mozilla/TTS/issues/575","id":733310933,"node_id":"MDEyOklzc3VlQ29tbWVudDczMzMxMDkzMw==","user":{"login":"erogol","id":1402048,"node_id":"MDQ6VXNlcjE0MDIwNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1402048?v=4","gravatar_id":"","url":"https://api.github.com/users/erogol","html_url":"https://github.com/erogol","followers_url":"https://api.github.com/users/erogol/followers","following_url":"https://api.github.com/users/erogol/following{/other_user}","gists_url":"https://api.github.com/users/erogol/gists{/gist_id}","starred_url":"https://api.github.com/users/erogol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erogol/subscriptions","organizations_url":"https://api.github.com/users/erogol/orgs","repos_url":"https://api.github.com/users/erogol/repos","events_url":"https://api.github.com/users/erogol/events{/privacy}","received_events_url":"https://api.github.com/users/erogol/received_events","type":"User","site_admin":false},"created_at":"2020-11-24T23:52:14Z","updated_at":"2020-11-24T23:52:14Z","author_association":"CONTRIBUTOR","body":"that's a great call @SanjaESC . I was thinking about this problem but mixed precision makes a ton of sense. ","reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/733310933/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"erogol","id":1402048,"node_id":"MDQ6VXNlcjE0MDIwNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1402048?v=4","gravatar_id":"","url":"https://api.github.com/users/erogol","html_url":"https://github.com/erogol","followers_url":"https://api.github.com/users/erogol/followers","following_url":"https://api.github.com/users/erogol/following{/other_user}","gists_url":"https://api.github.com/users/erogol/gists{/gist_id}","starred_url":"https://api.github.com/users/erogol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erogol/subscriptions","organizations_url":"https://api.github.com/users/erogol/orgs","repos_url":"https://api.github.com/users/erogol/repos","events_url":"https://api.github.com/users/erogol/events{/privacy}","received_events_url":"https://api.github.com/users/erogol/received_events","type":"User","site_admin":false}},{"id":4035299849,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDAzNTI5OTg0OQ==","url":"https://api.github.com/repos/mozilla/TTS/issues/events/4035299849","actor":{"login":"lexkoro","id":6319070,"node_id":"MDQ6VXNlcjYzMTkwNzA=","avatar_url":"https://avatars.githubusercontent.com/u/6319070?v=4","gravatar_id":"","url":"https://api.github.com/users/lexkoro","html_url":"https://github.com/lexkoro","followers_url":"https://api.github.com/users/lexkoro/followers","following_url":"https://api.github.com/users/lexkoro/following{/other_user}","gists_url":"https://api.github.com/users/lexkoro/gists{/gist_id}","starred_url":"https://api.github.com/users/lexkoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexkoro/subscriptions","organizations_url":"https://api.github.com/users/lexkoro/orgs","repos_url":"https://api.github.com/users/lexkoro/repos","events_url":"https://api.github.com/users/lexkoro/events{/privacy}","received_events_url":"https://api.github.com/users/lexkoro/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-11-24T23:52:15Z","performed_via_github_app":null},{"id":4035299855,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQwMzUyOTk4NTU=","url":"https://api.github.com/repos/mozilla/TTS/issues/events/4035299855","actor":{"login":"lexkoro","id":6319070,"node_id":"MDQ6VXNlcjYzMTkwNzA=","avatar_url":"https://avatars.githubusercontent.com/u/6319070?v=4","gravatar_id":"","url":"https://api.github.com/users/lexkoro","html_url":"https://github.com/lexkoro","followers_url":"https://api.github.com/users/lexkoro/followers","following_url":"https://api.github.com/users/lexkoro/following{/other_user}","gists_url":"https://api.github.com/users/lexkoro/gists{/gist_id}","starred_url":"https://api.github.com/users/lexkoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexkoro/subscriptions","organizations_url":"https://api.github.com/users/lexkoro/orgs","repos_url":"https://api.github.com/users/lexkoro/repos","events_url":"https://api.github.com/users/lexkoro/events{/privacy}","received_events_url":"https://api.github.com/users/lexkoro/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-11-24T23:52:15Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/733563341","html_url":"https://github.com/mozilla/TTS/issues/575#issuecomment-733563341","issue_url":"https://api.github.com/repos/mozilla/TTS/issues/575","id":733563341,"node_id":"MDEyOklzc3VlQ29tbWVudDczMzU2MzM0MQ==","user":{"login":"lexkoro","id":6319070,"node_id":"MDQ6VXNlcjYzMTkwNzA=","avatar_url":"https://avatars.githubusercontent.com/u/6319070?v=4","gravatar_id":"","url":"https://api.github.com/users/lexkoro","html_url":"https://github.com/lexkoro","followers_url":"https://api.github.com/users/lexkoro/followers","following_url":"https://api.github.com/users/lexkoro/following{/other_user}","gists_url":"https://api.github.com/users/lexkoro/gists{/gist_id}","starred_url":"https://api.github.com/users/lexkoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexkoro/subscriptions","organizations_url":"https://api.github.com/users/lexkoro/orgs","repos_url":"https://api.github.com/users/lexkoro/repos","events_url":"https://api.github.com/users/lexkoro/events{/privacy}","received_events_url":"https://api.github.com/users/lexkoro/received_events","type":"User","site_admin":false},"created_at":"2020-11-25T08:55:53Z","updated_at":"2020-11-25T08:55:53Z","author_association":"CONTRIBUTOR","body":"> Myfix consisting of adding a bunch of .astype(np.float32) works, but I don't know if it's clean enough to go in a PR. Do we let the fix in the train_tacotron.py file or do we implement something else inside the tb-logger ?\r\n\r\nThis would work, but I think your mentioned approach in the tb-logger should be better. Only cast to float32 if needed, so something like this:\r\n\r\n    def dict_to_tb_figure(self, scope_name, figures, step):\r\n        for key, value in figures.items():\r\n            value = value if not value.dtype == np.float16 else value.astype(np.float32)\r\n            self.writer.add_figure('{}/{}'.format(scope_name, key), value, step)\r\n","reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/733563341/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lexkoro","id":6319070,"node_id":"MDQ6VXNlcjYzMTkwNzA=","avatar_url":"https://avatars.githubusercontent.com/u/6319070?v=4","gravatar_id":"","url":"https://api.github.com/users/lexkoro","html_url":"https://github.com/lexkoro","followers_url":"https://api.github.com/users/lexkoro/followers","following_url":"https://api.github.com/users/lexkoro/following{/other_user}","gists_url":"https://api.github.com/users/lexkoro/gists{/gist_id}","starred_url":"https://api.github.com/users/lexkoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexkoro/subscriptions","organizations_url":"https://api.github.com/users/lexkoro/orgs","repos_url":"https://api.github.com/users/lexkoro/repos","events_url":"https://api.github.com/users/lexkoro/events{/privacy}","received_events_url":"https://api.github.com/users/lexkoro/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/733583474","html_url":"https://github.com/mozilla/TTS/issues/575#issuecomment-733583474","issue_url":"https://api.github.com/repos/mozilla/TTS/issues/575","id":733583474,"node_id":"MDEyOklzc3VlQ29tbWVudDczMzU4MzQ3NA==","user":{"login":"WeberJulian","id":17219561,"node_id":"MDQ6VXNlcjE3MjE5NTYx","avatar_url":"https://avatars.githubusercontent.com/u/17219561?v=4","gravatar_id":"","url":"https://api.github.com/users/WeberJulian","html_url":"https://github.com/WeberJulian","followers_url":"https://api.github.com/users/WeberJulian/followers","following_url":"https://api.github.com/users/WeberJulian/following{/other_user}","gists_url":"https://api.github.com/users/WeberJulian/gists{/gist_id}","starred_url":"https://api.github.com/users/WeberJulian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WeberJulian/subscriptions","organizations_url":"https://api.github.com/users/WeberJulian/orgs","repos_url":"https://api.github.com/users/WeberJulian/repos","events_url":"https://api.github.com/users/WeberJulian/events{/privacy}","received_events_url":"https://api.github.com/users/WeberJulian/received_events","type":"User","site_admin":false},"created_at":"2020-11-25T09:30:06Z","updated_at":"2020-11-25T09:30:31Z","author_association":"CONTRIBUTOR","body":"Thanks @SanjaESC, you're right it looks much better.\r\n\r\nBut there still is a training problem even with this fix. The training doesn't work with AMP: true.\r\nThese are the graphs with the exact same config (except AMP) \r\n\r\n![image](https://user-images.githubusercontent.com/17219561/100208499-16e13080-2f09-11eb-9955-616cd28000ec.png)\r\n![image](https://user-images.githubusercontent.com/17219561/100208560-25c7e300-2f09-11eb-825f-c539aa1d51b6.png)\r\n","reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/733583474/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"WeberJulian","id":17219561,"node_id":"MDQ6VXNlcjE3MjE5NTYx","avatar_url":"https://avatars.githubusercontent.com/u/17219561?v=4","gravatar_id":"","url":"https://api.github.com/users/WeberJulian","html_url":"https://github.com/WeberJulian","followers_url":"https://api.github.com/users/WeberJulian/followers","following_url":"https://api.github.com/users/WeberJulian/following{/other_user}","gists_url":"https://api.github.com/users/WeberJulian/gists{/gist_id}","starred_url":"https://api.github.com/users/WeberJulian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WeberJulian/subscriptions","organizations_url":"https://api.github.com/users/WeberJulian/orgs","repos_url":"https://api.github.com/users/WeberJulian/repos","events_url":"https://api.github.com/users/WeberJulian/events{/privacy}","received_events_url":"https://api.github.com/users/WeberJulian/received_events","type":"User","site_admin":false}},{"id":4037089901,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDAzNzA4OTkwMQ==","url":"https://api.github.com/repos/mozilla/TTS/issues/events/4037089901","actor":{"login":"lexkoro","id":6319070,"node_id":"MDQ6VXNlcjYzMTkwNzA=","avatar_url":"https://avatars.githubusercontent.com/u/6319070?v=4","gravatar_id":"","url":"https://api.github.com/users/lexkoro","html_url":"https://github.com/lexkoro","followers_url":"https://api.github.com/users/lexkoro/followers","following_url":"https://api.github.com/users/lexkoro/following{/other_user}","gists_url":"https://api.github.com/users/lexkoro/gists{/gist_id}","starred_url":"https://api.github.com/users/lexkoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexkoro/subscriptions","organizations_url":"https://api.github.com/users/lexkoro/orgs","repos_url":"https://api.github.com/users/lexkoro/repos","events_url":"https://api.github.com/users/lexkoro/events{/privacy}","received_events_url":"https://api.github.com/users/lexkoro/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-11-25T09:30:06Z","performed_via_github_app":null},{"id":4037089906,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQwMzcwODk5MDY=","url":"https://api.github.com/repos/mozilla/TTS/issues/events/4037089906","actor":{"login":"lexkoro","id":6319070,"node_id":"MDQ6VXNlcjYzMTkwNzA=","avatar_url":"https://avatars.githubusercontent.com/u/6319070?v=4","gravatar_id":"","url":"https://api.github.com/users/lexkoro","html_url":"https://github.com/lexkoro","followers_url":"https://api.github.com/users/lexkoro/followers","following_url":"https://api.github.com/users/lexkoro/following{/other_user}","gists_url":"https://api.github.com/users/lexkoro/gists{/gist_id}","starred_url":"https://api.github.com/users/lexkoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexkoro/subscriptions","organizations_url":"https://api.github.com/users/lexkoro/orgs","repos_url":"https://api.github.com/users/lexkoro/repos","events_url":"https://api.github.com/users/lexkoro/events{/privacy}","received_events_url":"https://api.github.com/users/lexkoro/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-11-25T09:30:06Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/733714379","html_url":"https://github.com/mozilla/TTS/issues/575#issuecomment-733714379","issue_url":"https://api.github.com/repos/mozilla/TTS/issues/575","id":733714379,"node_id":"MDEyOklzc3VlQ29tbWVudDczMzcxNDM3OQ==","user":{"login":"erogol","id":1402048,"node_id":"MDQ6VXNlcjE0MDIwNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1402048?v=4","gravatar_id":"","url":"https://api.github.com/users/erogol","html_url":"https://github.com/erogol","followers_url":"https://api.github.com/users/erogol/followers","following_url":"https://api.github.com/users/erogol/following{/other_user}","gists_url":"https://api.github.com/users/erogol/gists{/gist_id}","starred_url":"https://api.github.com/users/erogol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erogol/subscriptions","organizations_url":"https://api.github.com/users/erogol/orgs","repos_url":"https://api.github.com/users/erogol/repos","events_url":"https://api.github.com/users/erogol/events{/privacy}","received_events_url":"https://api.github.com/users/erogol/received_events","type":"User","site_admin":false},"created_at":"2020-11-25T13:43:44Z","updated_at":"2020-11-25T13:43:44Z","author_association":"CONTRIBUTOR","body":"> > Myfix consisting of adding a bunch of .astype(np.float32) works, but I don't know if it's clean enough to go in a PR. Do we let the fix in the train_tacotron.py file or do we implement something else inside the tb-logger ?\r\n> \r\n> This would work, but I think your mentioned approach in the tb-logger should be better. Only cast to float32 if needed, so something like this:\r\n> \r\n> ```\r\n> def dict_to_tb_figure(self, scope_name, figures, step):\r\n>     for key, value in figures.items():\r\n>         value = value if not value.dtype == np.float16 else value.astype(np.float32)\r\n>         self.writer.add_figure('{}/{}'.format(scope_name, key), value, step)\r\n> ```\r\n\r\nThis won't work since value here is a figure. I fix it in plot_spectrogram function. \r\n","reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/733714379/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"erogol","id":1402048,"node_id":"MDQ6VXNlcjE0MDIwNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1402048?v=4","gravatar_id":"","url":"https://api.github.com/users/erogol","html_url":"https://github.com/erogol","followers_url":"https://api.github.com/users/erogol/followers","following_url":"https://api.github.com/users/erogol/following{/other_user}","gists_url":"https://api.github.com/users/erogol/gists{/gist_id}","starred_url":"https://api.github.com/users/erogol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erogol/subscriptions","organizations_url":"https://api.github.com/users/erogol/orgs","repos_url":"https://api.github.com/users/erogol/repos","events_url":"https://api.github.com/users/erogol/events{/privacy}","received_events_url":"https://api.github.com/users/erogol/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/733719421","html_url":"https://github.com/mozilla/TTS/issues/575#issuecomment-733719421","issue_url":"https://api.github.com/repos/mozilla/TTS/issues/575","id":733719421,"node_id":"MDEyOklzc3VlQ29tbWVudDczMzcxOTQyMQ==","user":{"login":"WeberJulian","id":17219561,"node_id":"MDQ6VXNlcjE3MjE5NTYx","avatar_url":"https://avatars.githubusercontent.com/u/17219561?v=4","gravatar_id":"","url":"https://api.github.com/users/WeberJulian","html_url":"https://github.com/WeberJulian","followers_url":"https://api.github.com/users/WeberJulian/followers","following_url":"https://api.github.com/users/WeberJulian/following{/other_user}","gists_url":"https://api.github.com/users/WeberJulian/gists{/gist_id}","starred_url":"https://api.github.com/users/WeberJulian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WeberJulian/subscriptions","organizations_url":"https://api.github.com/users/WeberJulian/orgs","repos_url":"https://api.github.com/users/WeberJulian/repos","events_url":"https://api.github.com/users/WeberJulian/events{/privacy}","received_events_url":"https://api.github.com/users/WeberJulian/received_events","type":"User","site_admin":false},"created_at":"2020-11-25T13:53:00Z","updated_at":"2020-11-25T13:53:00Z","author_association":"CONTRIBUTOR","body":"> > > Myfix consisting of adding a bunch of .astype(np.float32) works, but I don't know if it's clean enough to go in a PR. Do we let the fix in the train_tacotron.py file or do we implement something else inside the tb-logger ?\r\n> > \r\n> > \r\n> > This would work, but I think your mentioned approach in the tb-logger should be better. Only cast to float32 if needed, so something like this:\r\n> > ```\r\n> > def dict_to_tb_figure(self, scope_name, figures, step):\r\n> >     for key, value in figures.items():\r\n> >         value = value if not value.dtype == np.float16 else value.astype(np.float32)\r\n> >         self.writer.add_figure('{}/{}'.format(scope_name, key), value, step)\r\n> > ```\r\n> \r\n> This won't work since value here is a figure. I fix it in plot_spectrogram function.\r\n\r\nOh yeah that's right, I forgot why I didn't fix it here in the first place.\r\n\r\nAnd for the training stability problem ? Should I open an other issue about it as it's not directly related ?","reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/733719421/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"WeberJulian","id":17219561,"node_id":"MDQ6VXNlcjE3MjE5NTYx","avatar_url":"https://avatars.githubusercontent.com/u/17219561?v=4","gravatar_id":"","url":"https://api.github.com/users/WeberJulian","html_url":"https://github.com/WeberJulian","followers_url":"https://api.github.com/users/WeberJulian/followers","following_url":"https://api.github.com/users/WeberJulian/following{/other_user}","gists_url":"https://api.github.com/users/WeberJulian/gists{/gist_id}","starred_url":"https://api.github.com/users/WeberJulian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WeberJulian/subscriptions","organizations_url":"https://api.github.com/users/WeberJulian/orgs","repos_url":"https://api.github.com/users/WeberJulian/repos","events_url":"https://api.github.com/users/WeberJulian/events{/privacy}","received_events_url":"https://api.github.com/users/WeberJulian/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/733719723","html_url":"https://github.com/mozilla/TTS/issues/575#issuecomment-733719723","issue_url":"https://api.github.com/repos/mozilla/TTS/issues/575","id":733719723,"node_id":"MDEyOklzc3VlQ29tbWVudDczMzcxOTcyMw==","user":{"login":"erogol","id":1402048,"node_id":"MDQ6VXNlcjE0MDIwNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1402048?v=4","gravatar_id":"","url":"https://api.github.com/users/erogol","html_url":"https://github.com/erogol","followers_url":"https://api.github.com/users/erogol/followers","following_url":"https://api.github.com/users/erogol/following{/other_user}","gists_url":"https://api.github.com/users/erogol/gists{/gist_id}","starred_url":"https://api.github.com/users/erogol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erogol/subscriptions","organizations_url":"https://api.github.com/users/erogol/orgs","repos_url":"https://api.github.com/users/erogol/repos","events_url":"https://api.github.com/users/erogol/events{/privacy}","received_events_url":"https://api.github.com/users/erogol/received_events","type":"User","site_admin":false},"created_at":"2020-11-25T13:53:33Z","updated_at":"2020-11-25T13:53:33Z","author_association":"CONTRIBUTOR","body":"I am updating dev branch with the fix ","reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/733719723/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"erogol","id":1402048,"node_id":"MDQ6VXNlcjE0MDIwNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1402048?v=4","gravatar_id":"","url":"https://api.github.com/users/erogol","html_url":"https://github.com/erogol","followers_url":"https://api.github.com/users/erogol/followers","following_url":"https://api.github.com/users/erogol/following{/other_user}","gists_url":"https://api.github.com/users/erogol/gists{/gist_id}","starred_url":"https://api.github.com/users/erogol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erogol/subscriptions","organizations_url":"https://api.github.com/users/erogol/orgs","repos_url":"https://api.github.com/users/erogol/repos","events_url":"https://api.github.com/users/erogol/events{/privacy}","received_events_url":"https://api.github.com/users/erogol/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/733726232","html_url":"https://github.com/mozilla/TTS/issues/575#issuecomment-733726232","issue_url":"https://api.github.com/repos/mozilla/TTS/issues/575","id":733726232,"node_id":"MDEyOklzc3VlQ29tbWVudDczMzcyNjIzMg==","user":{"login":"erogol","id":1402048,"node_id":"MDQ6VXNlcjE0MDIwNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1402048?v=4","gravatar_id":"","url":"https://api.github.com/users/erogol","html_url":"https://github.com/erogol","followers_url":"https://api.github.com/users/erogol/followers","following_url":"https://api.github.com/users/erogol/following{/other_user}","gists_url":"https://api.github.com/users/erogol/gists{/gist_id}","starred_url":"https://api.github.com/users/erogol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erogol/subscriptions","organizations_url":"https://api.github.com/users/erogol/orgs","repos_url":"https://api.github.com/users/erogol/repos","events_url":"https://api.github.com/users/erogol/events{/privacy}","received_events_url":"https://api.github.com/users/erogol/received_events","type":"User","site_admin":false},"created_at":"2020-11-25T14:04:45Z","updated_at":"2020-11-25T14:04:45Z","author_association":"CONTRIBUTOR","body":"now it should be fixed ","reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/comments/733726232/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"erogol","id":1402048,"node_id":"MDQ6VXNlcjE0MDIwNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1402048?v=4","gravatar_id":"","url":"https://api.github.com/users/erogol","html_url":"https://github.com/erogol","followers_url":"https://api.github.com/users/erogol/followers","following_url":"https://api.github.com/users/erogol/following{/other_user}","gists_url":"https://api.github.com/users/erogol/gists{/gist_id}","starred_url":"https://api.github.com/users/erogol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erogol/subscriptions","organizations_url":"https://api.github.com/users/erogol/orgs","repos_url":"https://api.github.com/users/erogol/repos","events_url":"https://api.github.com/users/erogol/events{/privacy}","received_events_url":"https://api.github.com/users/erogol/received_events","type":"User","site_admin":false}},{"id":4038245681,"node_id":"MDExOkNsb3NlZEV2ZW50NDAzODI0NTY4MQ==","url":"https://api.github.com/repos/mozilla/TTS/issues/events/4038245681","actor":{"login":"erogol","id":1402048,"node_id":"MDQ6VXNlcjE0MDIwNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1402048?v=4","gravatar_id":"","url":"https://api.github.com/users/erogol","html_url":"https://github.com/erogol","followers_url":"https://api.github.com/users/erogol/followers","following_url":"https://api.github.com/users/erogol/following{/other_user}","gists_url":"https://api.github.com/users/erogol/gists{/gist_id}","starred_url":"https://api.github.com/users/erogol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erogol/subscriptions","organizations_url":"https://api.github.com/users/erogol/orgs","repos_url":"https://api.github.com/users/erogol/repos","events_url":"https://api.github.com/users/erogol/events{/privacy}","received_events_url":"https://api.github.com/users/erogol/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-11-25T14:04:45Z","state_reason":null,"performed_via_github_app":null}]