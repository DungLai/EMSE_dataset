{"url":"https://api.github.com/repos/mozilla/TTS/issues/115","repository_url":"https://api.github.com/repos/mozilla/TTS","labels_url":"https://api.github.com/repos/mozilla/TTS/issues/115/labels{/name}","comments_url":"https://api.github.com/repos/mozilla/TTS/issues/115/comments","events_url":"https://api.github.com/repos/mozilla/TTS/issues/115/events","html_url":"https://github.com/mozilla/TTS/issues/115","id":415485652,"node_id":"MDU6SXNzdWU0MTU0ODU2NTI=","number":115,"title":"when i restore, i got RuntimeError: expected type torch.FloatTensor but got torch.cuda.FloatTensor","user":{"login":"wangyuxinwhy","id":22192665,"node_id":"MDQ6VXNlcjIyMTkyNjY1","avatar_url":"https://avatars.githubusercontent.com/u/22192665?v=4","gravatar_id":"","url":"https://api.github.com/users/wangyuxinwhy","html_url":"https://github.com/wangyuxinwhy","followers_url":"https://api.github.com/users/wangyuxinwhy/followers","following_url":"https://api.github.com/users/wangyuxinwhy/following{/other_user}","gists_url":"https://api.github.com/users/wangyuxinwhy/gists{/gist_id}","starred_url":"https://api.github.com/users/wangyuxinwhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wangyuxinwhy/subscriptions","organizations_url":"https://api.github.com/users/wangyuxinwhy/orgs","repos_url":"https://api.github.com/users/wangyuxinwhy/repos","events_url":"https://api.github.com/users/wangyuxinwhy/events{/privacy}","received_events_url":"https://api.github.com/users/wangyuxinwhy/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-02-28T07:34:13Z","updated_at":"2019-03-05T11:35:49Z","closed_at":"2019-03-01T09:46:22Z","author_association":"NONE","active_lock_reason":null,"body":" > Using CUDA:  True\r\n > Number of GPUs:  1\r\n > Experiment folder: /home/yuxin.wang/WorkBench/TTS-master/./bznsyp_models/queue-February-28-2019_02+20PM-1\r\n > Setting up Audio Processor...\r\n | > fft size: 2048, hop length: 275, win length: 1102\r\n | > Audio Processor attributes.\r\n   | > bits:None\r\n   | > sample_rate:22050\r\n   | > num_mels:80\r\n   | > min_level_db:-100\r\n   | > frame_shift_ms:12.5\r\n   | > frame_length_ms:50\r\n   | > ref_level_db:20\r\n   | > num_freq:1025\r\n   | > power:1.5\r\n   | > preemphasis:0.98\r\n   | > griffin_lim_iters:60\r\n   | > signal_norm:True\r\n   | > symmetric_norm:False\r\n   | > mel_fmin:0\r\n   | > mel_fmax:None\r\n   | > max_norm:1.0\r\n   | > clip_norm:True\r\n   | > do_trim_silence:True\r\n   | > n_fft:2048\r\n   | > hop_length:275\r\n   | > win_length:1102\r\n | > Number of characters : 61\r\n | > Num output units : 1025\r\n > Model restored from step 20000\r\n | > Model has 7000370 parameters\r\n > DataLoader initialization\r\n | > Data path: ./BZNSYP/\r\n | > Use phonemes: True\r\n   | > phoneme language: zh\r\n | > Cached dataset: False\r\n | > Number of instances : 9000\r\n | > Max length sequence: 52\r\n | > Min length sequence: 5\r\n | > Avg length sequence: 25.88588888888889\r\n | > 0 instances are ignored (0)\r\n | > Batch group shuffling is active.\r\n | > Epoch 0/1000\r\nTraceback (most recent call last):\r\n  File \"train.py\", line 501, in <module>\r\n    main(args)\r\n  File \"train.py\", line 439, in main\r\n    scheduler, ap, epoch)\r\n  File \"train.py\", line 147, in train\r\n    optimizer.step()\r\n  File \"/home/yuxin.wang/anaconda3/envs/tts/lib/python3.6/site-packages/torch/optim/adam.py\", line 93, in step\r\n    exp_avg.mul_(beta1).add_(1 - beta1, grad)\r\nRuntimeError: expected type torch.FloatTensor but got torch.cuda.FloatTensor\r\n\r\nmaybe optimizer.state in cpu and grad in gpu, i fix it by move optimizer initial code to `if use_cuda:`, like this:\r\n```\r\n    if use_cuda:\r\n            model = model.cuda()\r\n            criterion.cuda()\r\n            criterion_st.cuda()\r\n            optimizer = optim.Adam(model.parameters(), lr=c.lr, weight_decay=0)\r\n            optimizer.load_state_dict(checkpoint['optimizer'])\r\n            optimizer_st = optim.Adam(model.decoder.stopnet.parameters(), lr=c.lr, weight_decay=0)\r\n            for state in optimizer.state.values():\r\n                for k, v in state.items():\r\n                    if isinstance(v, torch.Tensor):\r\n                        state[k] = v.cuda()\r\n```","closed_by":{"login":"wangyuxinwhy","id":22192665,"node_id":"MDQ6VXNlcjIyMTkyNjY1","avatar_url":"https://avatars.githubusercontent.com/u/22192665?v=4","gravatar_id":"","url":"https://api.github.com/users/wangyuxinwhy","html_url":"https://github.com/wangyuxinwhy","followers_url":"https://api.github.com/users/wangyuxinwhy/followers","following_url":"https://api.github.com/users/wangyuxinwhy/following{/other_user}","gists_url":"https://api.github.com/users/wangyuxinwhy/gists{/gist_id}","starred_url":"https://api.github.com/users/wangyuxinwhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wangyuxinwhy/subscriptions","organizations_url":"https://api.github.com/users/wangyuxinwhy/orgs","repos_url":"https://api.github.com/users/wangyuxinwhy/repos","events_url":"https://api.github.com/users/wangyuxinwhy/events{/privacy}","received_events_url":"https://api.github.com/users/wangyuxinwhy/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/115/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mozilla/TTS/issues/115/timeline","performed_via_github_app":null,"state_reason":"completed"}