{"url":"https://api.github.com/repos/mozilla/TTS/issues/643","repository_url":"https://api.github.com/repos/mozilla/TTS","labels_url":"https://api.github.com/repos/mozilla/TTS/issues/643/labels{/name}","comments_url":"https://api.github.com/repos/mozilla/TTS/issues/643/comments","events_url":"https://api.github.com/repos/mozilla/TTS/issues/643/events","html_url":"https://github.com/mozilla/TTS/issues/643","id":802967391,"node_id":"MDU6SXNzdWU4MDI5NjczOTE=","number":643,"title":"Adding the training step to best_model.pth.tar","user":{"login":"gerazov","id":15214418,"node_id":"MDQ6VXNlcjE1MjE0NDE4","avatar_url":"https://avatars.githubusercontent.com/u/15214418?v=4","gravatar_id":"","url":"https://api.github.com/users/gerazov","html_url":"https://github.com/gerazov","followers_url":"https://api.github.com/users/gerazov/followers","following_url":"https://api.github.com/users/gerazov/following{/other_user}","gists_url":"https://api.github.com/users/gerazov/gists{/gist_id}","starred_url":"https://api.github.com/users/gerazov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gerazov/subscriptions","organizations_url":"https://api.github.com/users/gerazov/orgs","repos_url":"https://api.github.com/users/gerazov/repos","events_url":"https://api.github.com/users/gerazov/events{/privacy}","received_events_url":"https://api.github.com/users/gerazov/received_events","type":"User","site_admin":false},"labels":[{"id":813922298,"node_id":"MDU6TGFiZWw4MTM5MjIyOTg=","url":"https://api.github.com/repos/mozilla/TTS/labels/wontfix","name":"wontfix","color":"ffffff","default":true,"description":"This will not be worked on"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":15,"created_at":"2021-02-07T14:39:00Z","updated_at":"2021-06-02T16:15:19Z","closed_at":"2021-06-02T16:15:19Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"This is a suggestion/discussion on changing the way the training scripts save the best model parameters.\r\n\r\nCurrently the best model is saved as `best_model.pth.tar` in the experiment folder. I suggest adding the global step to the basename e.g. `best_model_56342.pth.tar`, similarly to the way checkpoints are saved.\r\n\r\nThis will have two benefits:\r\n1. It would be easier to manage all the best models:\r\n    - it will be clear from the filename what was the training step that output that particular best model. Currently, one could load the model and read the step via `torch.load(restore_path)['step']`, but that is a bit involved if you want to sort through models via a file browser or terminal,\r\n    - several best models could be saved in the experiment folder as training progresses.\r\n2.  It would allow for continuing training from the model output at the last saved step. \r\nCurrently the model with the last creation time is used for continuing training via `args.restore_path = max(list_of_files, key=os.path.getctime)`. This is fine if you're continuing on the same machine in the same folder, but it is a bit volatile if you transfer the models between machines. Using `cp` or `rsync`, or plain copy paste in a file browser would give new time stamps for when the copy was created and modified (`cp` and `rsync` only) so continuation would not work as expected. This can be avoided with `cp -p` and `rsync -a`, but this dependency on how the files were copied/created is better avoided. \r\n\r\nThere are two disadvantages I can think of:\r\n1. Having to specify the step value when synthesizing with the best model. \r\nThis currently is always `best_model.pth.tar` so it's easy to use the models in synthesis by providing just the path name. This can be mitigated by creating a symbolic link in the experiment folder `best_model.pth.tar` pointing to the latest best model.\r\n2. Ending up with multiple `best_models_xxx.pth.tar`. \r\nThis can also be avoided by deleting the previous model when saving the new one. Even better the user can select if he only wants to keep the last model or all models along the way. Personally, I would prefer to keep the last checkpoint and all the best models (after some minimum step say 10k), rather than a single best model and a lot of checkpoints.","closed_by":{"login":"stale[bot]","id":26384082,"node_id":"MDM6Qm90MjYzODQwODI=","avatar_url":"https://avatars.githubusercontent.com/in/1724?v=4","gravatar_id":"","url":"https://api.github.com/users/stale%5Bbot%5D","html_url":"https://github.com/apps/stale","followers_url":"https://api.github.com/users/stale%5Bbot%5D/followers","following_url":"https://api.github.com/users/stale%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stale%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/stale%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/stale%5Bbot%5D/repos","events_url":"https://api.github.com/users/stale%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/stale%5Bbot%5D/received_events","type":"Bot","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/643/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mozilla/TTS/issues/643/timeline","performed_via_github_app":null,"state_reason":"completed"}