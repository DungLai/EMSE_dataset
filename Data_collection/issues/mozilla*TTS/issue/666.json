{"url":"https://api.github.com/repos/mozilla/TTS/issues/666","repository_url":"https://api.github.com/repos/mozilla/TTS","labels_url":"https://api.github.com/repos/mozilla/TTS/issues/666/labels{/name}","comments_url":"https://api.github.com/repos/mozilla/TTS/issues/666/comments","events_url":"https://api.github.com/repos/mozilla/TTS/issues/666/events","html_url":"https://github.com/mozilla/TTS/issues/666","id":813059792,"node_id":"MDU6SXNzdWU4MTMwNTk3OTI=","number":666,"title":"CUDA error: CUBLAS_STATUS_EXECUTION_FAILED when calling `cublasGemmEx` on GeForce GTX 1650 under WSL2","user":{"login":"GuyPaddock","id":2631799,"node_id":"MDQ6VXNlcjI2MzE3OTk=","avatar_url":"https://avatars.githubusercontent.com/u/2631799?v=4","gravatar_id":"","url":"https://api.github.com/users/GuyPaddock","html_url":"https://github.com/GuyPaddock","followers_url":"https://api.github.com/users/GuyPaddock/followers","following_url":"https://api.github.com/users/GuyPaddock/following{/other_user}","gists_url":"https://api.github.com/users/GuyPaddock/gists{/gist_id}","starred_url":"https://api.github.com/users/GuyPaddock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GuyPaddock/subscriptions","organizations_url":"https://api.github.com/users/GuyPaddock/orgs","repos_url":"https://api.github.com/users/GuyPaddock/repos","events_url":"https://api.github.com/users/GuyPaddock/events{/privacy}","received_events_url":"https://api.github.com/users/GuyPaddock/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-02-22T02:37:58Z","updated_at":"2021-03-10T15:06:17Z","closed_at":"2021-03-10T15:06:17Z","author_association":"NONE","active_lock_reason":null,"body":"Something causes TTS to fail to train on GeForce GTX 1650 cards under WSL2. Training works under CPU-based training fine, but it doesn't work using CUDA in WSL2.\r\n\r\nThe system in question is running the latest Windows 10 Dev insider build. It has been configured following all the steps under https://docs.nvidia.com/cuda/wsl-user-guide/index.html. It also has the specific version of CUDA libraries that TensorFlow demanded:\r\n\r\n```\r\napt-get install cuda-cudart-10-1\r\napt-get install cuda-cusparse-10-0\r\napt-get install cuda-cudart-10-1\r\napt-get install -y cuda-toolkit-10-1\r\napt-get install libcublas10=10.2.1.243-1 libcublas-dev=10.2.1.243-1 cuda-libraries-10-1 cuda-libraries-dev-10-1\r\n```\r\n\r\nOutput from the following script:\r\n```python\r\nimport tensorflow as tf\r\n\r\ntf.config.list_physical_devices('GPU')\r\n```\r\n\r\nResults in this output:\r\n```\r\n2021-02-21 21:29:20.944075: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudart.so.10.1\r\n2021-02-21 21:29:21.764417: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcuda.so.1\r\n2021-02-21 21:29:22.116036: E tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:968] could not open file to read NUMA node: /sys/bus/pci/devices/0000:01:00.0/numa_node\r\nYour kernel may have been built without NUMA support.\r\n2021-02-21 21:29:22.116429: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 0 with properties:\r\npciBusID: 0000:01:00.0 name: GeForce GTX 1650 computeCapability: 7.5\r\ncoreClock: 1.56GHz coreCount: 16 deviceMemorySize: 4.00GiB deviceMemoryBandwidth: 119.24GiB/s\r\n2021-02-21 21:29:22.116492: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudart.so.10.1\r\n2021-02-21 21:29:22.120803: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcublas.so.10\r\n2021-02-21 21:29:22.126134: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcufft.so.10\r\n2021-02-21 21:29:22.127236: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcurand.so.10\r\n2021-02-21 21:29:22.134919: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcusolver.so.10\r\n2021-02-21 21:29:22.137583: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcusparse.so.10\r\n2021-02-21 21:29:22.146202: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudnn.so.7\r\n2021-02-21 21:29:22.147391: E tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:968] could not open file to read NUMA node: /sys/bus/pci/devices/0000:01:00.0/numa_node\r\nYour kernel may have been built without NUMA support.\r\n2021-02-21 21:29:22.148957: E tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:968] could not open file to read NUMA node: /sys/bus/pci/devices/0000:01:00.0/numa_node\r\nYour kernel may have been built without NUMA support.\r\n2021-02-21 21:29:22.149538: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1858] Adding visible gpu devices: 0\r\n```\r\n\r\nBut training of the model results in:\r\n```\r\n2021-02-21 21:34:07.978266: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudart.so.10.1\r\n > Using CUDA:  True\r\n > Number of GPUs:  1\r\n   >  Mixed precision mode is ON\r\n > Git Hash: e9e0784\r\n > Experiment folder: /path/to/my/project\r\n > Setting up Audio Processor...\r\n | > sample_rate:22050\r\n | > resample:False\r\n | > num_mels:80\r\n | > min_level_db:-100\r\n | > frame_shift_ms:None\r\n | > frame_length_ms:None\r\n | > ref_level_db:20\r\n | > fft_size:1024\r\n | > power:1.5\r\n | > preemphasis:0.0\r\n | > griffin_lim_iters:60\r\n | > signal_norm:True\r\n | > symmetric_norm:True\r\n | > mel_fmin:50.0\r\n | > mel_fmax:7600.0\r\n | > spec_gain:1.0\r\n | > stft_pad_mode:reflect\r\n | > max_norm:4.0\r\n | > clip_norm:True\r\n | > do_trim_silence:True\r\n | > trim_db:60\r\n | > do_sound_norm:False\r\n | > stats_path:/path/to/my/project/scale_stats.npy\r\n | > hop_length:256\r\n | > win_length:1024\r\n | > Found 101 files in /path/to/my/project\r\n > Using model: Tacotron2\r\n\r\n > Model has 47914548 parameters\r\n\r\n > DataLoader initialization\r\n | > Use phonemes: True\r\n   | > phoneme language: en-us\r\n | > Number of instances : 100\r\n | > Max length sequence: 150\r\n | > Min length sequence: 3\r\n | > Avg length sequence: 39.07\r\n | > Num. instances discarded by max-min (max=153, min=6) seq limits: 3\r\n | > Batch group size: 128.\r\n\r\n > EPOCH: 0/1000\r\n\r\n > Number of output frames: 7\r\n\r\n > TRAINING (2021-02-21 21:34:13)\r\n ! Run is removed from /path/to/my/project\r\nTraceback (most recent call last):\r\n  File \"./TTS/bin/train_tacotron.py\", line 721, in <module>\r\n    main(args)\r\n  File \"./TTS/bin/train_tacotron.py\", line 619, in main\r\n    train_avg_loss_dict, global_step = train(train_loader, model,\r\n  File \"./TTS/bin/train_tacotron.py\", line 193, in train\r\n    scaler.scale(loss_dict['loss']).backward()\r\n  File \"/path/to/moz-tts/mozilla-tts/lib/python3.8/site-packages/torch/tensor.py\", line 221, in backward\r\n    torch.autograd.backward(self, gradient, retain_graph, create_graph)\r\n  File \"/path/to/moz-tts/mozilla-tts/lib/python3.8/site-packages/torch/autograd/__init__.py\", line 130, in backward\r\n    Variable._execution_engine.run_backward(\r\nRuntimeError: CUDA error: CUBLAS_STATUS_EXECUTION_FAILED when calling `cublasGemmEx( handle, opa, opb, m, n, k, &falpha, a, CUDA_R_16F, lda, b, CUDA_R_16F, ldb, &fbeta, c, CUDA_R_16F, ldc, CUDA_R_32F, CUBLAS_GEMM_DFALT_TENSOR_OP)`\r\n```","closed_by":{"login":"GuyPaddock","id":2631799,"node_id":"MDQ6VXNlcjI2MzE3OTk=","avatar_url":"https://avatars.githubusercontent.com/u/2631799?v=4","gravatar_id":"","url":"https://api.github.com/users/GuyPaddock","html_url":"https://github.com/GuyPaddock","followers_url":"https://api.github.com/users/GuyPaddock/followers","following_url":"https://api.github.com/users/GuyPaddock/following{/other_user}","gists_url":"https://api.github.com/users/GuyPaddock/gists{/gist_id}","starred_url":"https://api.github.com/users/GuyPaddock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GuyPaddock/subscriptions","organizations_url":"https://api.github.com/users/GuyPaddock/orgs","repos_url":"https://api.github.com/users/GuyPaddock/repos","events_url":"https://api.github.com/users/GuyPaddock/events{/privacy}","received_events_url":"https://api.github.com/users/GuyPaddock/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/666/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mozilla/TTS/issues/666/timeline","performed_via_github_app":null,"state_reason":"completed"}