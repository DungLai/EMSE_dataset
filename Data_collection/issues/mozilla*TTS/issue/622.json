{"url":"https://api.github.com/repos/mozilla/TTS/issues/622","repository_url":"https://api.github.com/repos/mozilla/TTS","labels_url":"https://api.github.com/repos/mozilla/TTS/issues/622/labels{/name}","comments_url":"https://api.github.com/repos/mozilla/TTS/issues/622/comments","events_url":"https://api.github.com/repos/mozilla/TTS/issues/622/events","html_url":"https://github.com/mozilla/TTS/issues/622","id":789802916,"node_id":"MDU6SXNzdWU3ODk4MDI5MTY=","number":622,"title":"RuntimeError: Expected all tensors to be on the same device, but found at least two devices, cuda:0 and cpu!","user":{"login":"wjqkkky","id":29905723,"node_id":"MDQ6VXNlcjI5OTA1NzIz","avatar_url":"https://avatars.githubusercontent.com/u/29905723?v=4","gravatar_id":"","url":"https://api.github.com/users/wjqkkky","html_url":"https://github.com/wjqkkky","followers_url":"https://api.github.com/users/wjqkkky/followers","following_url":"https://api.github.com/users/wjqkkky/following{/other_user}","gists_url":"https://api.github.com/users/wjqkkky/gists{/gist_id}","starred_url":"https://api.github.com/users/wjqkkky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wjqkkky/subscriptions","organizations_url":"https://api.github.com/users/wjqkkky/orgs","repos_url":"https://api.github.com/users/wjqkkky/repos","events_url":"https://api.github.com/users/wjqkkky/events{/privacy}","received_events_url":"https://api.github.com/users/wjqkkky/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-01-20T09:29:31Z","updated_at":"2021-02-17T13:15:51Z","closed_at":"2021-02-17T13:15:51Z","author_association":"NONE","active_lock_reason":null,"body":"Hi! There is already a similar issue, but It's not exactly the same as mine.\r\nI use the latest master branch.\r\nFirstly, I trained the model from scratch, it's ok.\r\nBut when I try to continue to train from checkpoint use `python TTS/bin/distribute.py --script train_vocoder_wavegrad.py --continue_path ../checkpoints/wavegrad-private-January-19-2021_10+16AM-d481fa2/`, I got RuntimeError.\r\n> > Using CUDA:  True\r\n > Number of GPUs:  4\r\n > Training continues for ../checkpoints/wavegrad-private-January-19-2021_10+16AM-d481fa2/best_model.pth.tar\r\n   >  Mixed precision is enabled\r\n > Loading wavs from: /data2/datasets/wavs_all\r\n > Setting up Audio Processor...\r\n | > sample_rate:22050\r\n | > resample:True\r\n | > num_mels:80\r\n | > min_level_db:-100\r\n | > frame_shift_ms:None\r\n | > frame_length_ms:None\r\n | > ref_level_db:20\r\n | > fft_size:1024\r\n | > power:None\r\n | > preemphasis:0.98\r\n | > griffin_lim_iters:None\r\n | > signal_norm:True\r\n | > symmetric_norm:True\r\n | > mel_fmin:0\r\n | > mel_fmax:8000.0\r\n | > spec_gain:20.0\r\n | > stft_pad_mode:reflect\r\n | > max_norm:4.0\r\n | > clip_norm:True\r\n | > do_trim_silence:True\r\n | > trim_db:30\r\n | > do_sound_norm:False\r\n | > stats_path:None\r\n | > hop_length:256\r\n | > win_length:1024\r\n > Generator Model: wavegrad\r\n > Restoring Model...\r\n > Restoring Optimizer...\r\n > Restoring LR Scheduler...\r\n > Restoring AMP Scaler...\r\n > Model restored from step 20864\r\n > WaveGrad has 15827106 parameters\r\n\r\n > EPOCH: 0/10000\r\n\r\n > TRAINING (2021-01-20 09:16:06) \r\nTraceback (most recent call last):\r\n  File \"/data2/wavegrad_mozilla/TTS/TTS/bin/train_vocoder_wavegrad.py\", line 501, in <module>\r\n    main(args)\r\n  File \"/data2/wavegrad_mozilla/TTS/TTS/bin/train_vocoder_wavegrad.py\", line 400, in main\r\n    epoch)\r\n  File \"/data2/wavegrad_mozilla/TTS/TTS/bin/train_vocoder_wavegrad.py\", line 137, in train\r\n    scaler.step(optimizer)\r\n  File \"/usr/local/lib/python3.6/dist-packages/torch/cuda/amp/grad_scaler.py\", line 294, in step\r\n    retval = optimizer.step(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.6/dist-packages/torch/optim/lr_scheduler.py\", line 67, in wrapper\r\n    return wrapped(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.6/dist-packages/torch/autograd/grad_mode.py\", line 15, in decorate_context\r\n    return func(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.6/dist-packages/torch/optim/adam.py\", line 99, in step\r\n    exp_avg.mul_(beta1).add_(grad, alpha=1 - beta1)\r\nRuntimeError: Expected all tensors to be on the same device, but found at least two devices, cuda:2 and cpu!\r\n\r\nHere is my environmentï¼š\r\n> Package                Version             Location                                         \r\nabsl-py                0.11.0              \r\nasn1crypto             0.24.0              \r\nastroid                2.4.2               \r\nastunparse             1.6.3               \r\nattrdict               2.0.1               \r\nattrs                  20.3.0              \r\naudioread              2.1.9               \r\nbokeh                  1.4.0               \r\ncachetools             4.1.1               \r\ncardboardlint          1.3.0               \r\ncertifi                2020.11.8           \r\ncffi                   1.14.3              \r\nchardet                3.0.4               \r\nclick                  7.1.2               \r\nclldutils              3.5.4               \r\ncolorlog               4.6.2               \r\ncryptography           2.1.4               \r\ncsvw                   1.8.0               \r\ncycler                 0.10.0              \r\nCython                 0.29.21             \r\ndataclasses            0.8                 \r\ndecorator              4.4.2               \r\nfilelock               3.0.12              \r\nFlask                  1.1.2               \r\nfuture                 0.18.2              \r\nfuzzywuzzy             0.18.0              \r\ngast                   0.3.3               \r\ngdown                  3.12.2              \r\ngoogle-auth            1.23.0              \r\ngoogle-auth-oauthlib   0.4.2               \r\ngoogle-pasta           0.2.0               \r\ngrpcio                 1.33.2              \r\nh5py                   2.10.0              \r\nidna                   2.6                 \r\nimportlib-metadata     2.0.0               \r\ninflect                5.0.2               \r\nisodate                0.6.0               \r\nisort                  4.3.21              \r\nitsdangerous           1.1.0               \r\nJinja2                 2.11.2              \r\njoblib                 0.17.0              \r\nKeras-Preprocessing    1.1.2               \r\nkeyring                10.6.0              \r\nkeyrings.alt           3.0                 \r\nkiwisolver             1.3.1               \r\nlazy-object-proxy      1.4.3               \r\nlibrosa                0.7.2               \r\nllvmlite               0.31.0              \r\nMarkdown               3.3.3               \r\nMarkupSafe             1.1.1               \r\nmatplotlib             3.3.3               \r\nmccabe                 0.6.1               \r\nnose                   1.3.7               \r\nnumba                  0.48.0              \r\nnumpy                  1.17.4              \r\noauthlib               3.1.0               \r\nopencv-python          3.4.8.29            \r\nopt-einsum             3.3.0               \r\npackaging              20.4                \r\npandas                 1.1.4               \r\nphonemizer             2.2.1               \r\nPillow                 6.2.1               \r\npip                    19.3.1              \r\nprotobuf               3.14.0              \r\npyasn1                 0.4.8               \r\npyasn1-modules         0.2.8               \r\npycparser              2.20                \r\npycrypto               2.6.1               \r\npygobject              3.26.1              \r\npylint                 2.5.3               \r\npyparsing              2.4.7               \r\npysbd                  0.3.3               \r\nPySocks                1.7.1               \r\npython-dateutil        2.8.1               \r\npytz                   2020.4              \r\npyworld                0.2.12              \r\npyxdg                  0.25                \r\nPyYAML                 5.3.1               \r\nregex                  2020.11.13          \r\nrequests               2.25.0              \r\nrequests-oauthlib      1.3.0               \r\nresampy                0.2.2               \r\nrfc3986                1.4.0               \r\nrsa                    4.6                 \r\nscikit-learn           0.23.2              \r\nscipy                  1.4.1               \r\nSecretStorage          2.3.1               \r\nsegments               2.1.3               \r\nsetuptools             50.3.2              \r\nsix                    1.15.0              \r\nSoundFile              0.10.3.post1        \r\ntabulate               0.8.7               \r\ntensorboard            2.4.0               \r\ntensorboard-plugin-wit 1.7.0               \r\ntensorboardX           2.1                 \r\ntensorflow             2.3.1               \r\ntensorflow-estimator   2.3.0               \r\ntermcolor              1.1.0               \r\ntf-estimator-nightly   2.3.0.dev2020062301 \r\nthreadpoolctl          2.1.0               \r\ntoml                   0.10.2              \r\ntorch                  1.6.0               \r\ntorchvision            0.4.2               \r\ntornado                6.1                 \r\ntqdm                   4.51.0              \r\nTTS                    0.0.6+566ad2e      \r\ntyped-ast              1.4.1               \r\ntyping-extensions      3.7.4.3             \r\numap                   0.1.1               \r\numap-learn             0.4.6               \r\nUnidecode              0.4.20              \r\nuritemplate            3.0.1               \r\nurllib3                1.26.2              \r\nWerkzeug               1.0.1               \r\nwheel                  0.30.0              \r\nwrapt                  1.12.1              \r\nzipp                   3.4.0\r\n\r\nDoes anybody know how to solve this? Thanks a lot!","closed_by":{"login":"erogol","id":1402048,"node_id":"MDQ6VXNlcjE0MDIwNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1402048?v=4","gravatar_id":"","url":"https://api.github.com/users/erogol","html_url":"https://github.com/erogol","followers_url":"https://api.github.com/users/erogol/followers","following_url":"https://api.github.com/users/erogol/following{/other_user}","gists_url":"https://api.github.com/users/erogol/gists{/gist_id}","starred_url":"https://api.github.com/users/erogol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erogol/subscriptions","organizations_url":"https://api.github.com/users/erogol/orgs","repos_url":"https://api.github.com/users/erogol/repos","events_url":"https://api.github.com/users/erogol/events{/privacy}","received_events_url":"https://api.github.com/users/erogol/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/622/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mozilla/TTS/issues/622/timeline","performed_via_github_app":null,"state_reason":"completed"}