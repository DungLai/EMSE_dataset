{"url":"https://api.github.com/repos/mozilla/TTS/issues/742","repository_url":"https://api.github.com/repos/mozilla/TTS","labels_url":"https://api.github.com/repos/mozilla/TTS/issues/742/labels{/name}","comments_url":"https://api.github.com/repos/mozilla/TTS/issues/742/comments","events_url":"https://api.github.com/repos/mozilla/TTS/issues/742/events","html_url":"https://github.com/mozilla/TTS/issues/742","id":1103723070,"node_id":"I_kwDOBxIBp85ByXo-","number":742,"title":"RuntimeError: failed to find espeak library","user":{"login":"Jzow","id":68860495,"node_id":"MDQ6VXNlcjY4ODYwNDk1","avatar_url":"https://avatars.githubusercontent.com/u/68860495?v=4","gravatar_id":"","url":"https://api.github.com/users/Jzow","html_url":"https://github.com/Jzow","followers_url":"https://api.github.com/users/Jzow/followers","following_url":"https://api.github.com/users/Jzow/following{/other_user}","gists_url":"https://api.github.com/users/Jzow/gists{/gist_id}","starred_url":"https://api.github.com/users/Jzow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jzow/subscriptions","organizations_url":"https://api.github.com/users/Jzow/orgs","repos_url":"https://api.github.com/users/Jzow/repos","events_url":"https://api.github.com/users/Jzow/events{/privacy}","received_events_url":"https://api.github.com/users/Jzow/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2022-01-14T14:36:01Z","updated_at":"2022-01-17T12:24:15Z","closed_at":"2022-01-17T12:15:47Z","author_association":"NONE","active_lock_reason":null,"body":"```python\r\n\r\nimport os\r\nimport torch\r\nimport time\r\n\r\nfrom TTS.tts.utils.generic_utils import setup_model\r\nfrom TTS.utils.io import load_config\r\nfrom TTS.tts.utils.text.symbols import symbols, phonemes\r\nfrom TTS.utils.audio import AudioProcessor\r\nfrom TTS.tts.utils.synthesis import synthesis\r\nfrom TTS.vocoder.utils.generic_utils import setup_generator\r\n\r\ndef tts(model, text, CONFIG, use_cuda, ap, use_gl, figures=True):\r\n    t_1 = time.time()\r\n    waveform, alignment, mel_spec, mel_postnet_spec, stop_tokens, inputs = synthesis(model, text, CONFIG, use_cuda, ap, speaker_id, style_wav=None,\r\n                                                                             truncated=False, enable_eos_bos_chars=CONFIG.enable_eos_bos_chars)\r\n    # mel_postnet_spec = ap.denormalize(mel_postnet_spec.T)\r\n    if not use_gl:\r\n        waveform = vocoder_model.inference(torch.FloatTensor(mel_postnet_spec.T).unsqueeze(0))\r\n        waveform = waveform.flatten()\r\n    if use_cuda:\r\n        waveform = waveform.cpu()\r\n    waveform = waveform.numpy()\r\n    rtf = (time.time() - t_1) / (len(waveform) / ap.sample_rate)\r\n    tps = (time.time() - t_1) / len(waveform)\r\n    print(waveform.shape)\r\n    print(\" > Run-time: {}\".format(time.time() - t_1))\r\n    print(\" > Real-time factor: {}\".format(rtf))\r\n    print(\" > Time per step: {}\".format(tps))\r\n    return alignment, mel_postnet_spec, stop_tokens, waveform\r\n\r\n\r\nuse_cuda = False\r\n\r\nTTS_MODEL = \"models/textTovideo/tts_model.pth.tar\"\r\nTTS_CONFIG = \"models/textTovideo/config.json\"\r\nVOCODER_MODEL = \"models/textTovideo/vocoder_model.pth.tar\"\r\nVOCODER_CONFIG = \"models/textTovideo/config_vocoder.json\"\r\n\r\nTTS_CONFIG = load_config(TTS_CONFIG)\r\nVOCODER_CONFIG = load_config(VOCODER_CONFIG)\r\n\r\nTTS_CONFIG.audio['stats_path'] = 'models/textTovideo/scale_stats.npy'\r\nap = AudioProcessor(**TTS_CONFIG.audio)\r\n\r\n\r\nspeaker_id = None\r\nspeakers = []\r\n\r\n# load the model\r\nnum_chars = len(phonemes) if TTS_CONFIG.use_phonemes else len(symbols)\r\nmodel = setup_model(num_chars, len(speakers), TTS_CONFIG)\r\n\r\n# load model state\r\ncp =  torch.load(TTS_MODEL, map_location=torch.device('cpu'))\r\n\r\n# load the model\r\nmodel.load_state_dict(cp['model'])\r\nif use_cuda:\r\n    model.cuda()\r\nmodel.eval()\r\n\r\n# set model stepsize\r\nif 'r' in cp:\r\n    model.decoder.set_r(cp['r'])\r\n\r\n\r\n\r\n# LOAD VOCODER MODEL\r\nvocoder_model = setup_generator(VOCODER_CONFIG)\r\nvocoder_model.load_state_dict(torch.load(VOCODER_MODEL, map_location=\"cpu\")[\"model\"])\r\nvocoder_model.remove_weight_norm()\r\nvocoder_model.inference_padding = 0\r\n\r\nap_vocoder = AudioProcessor(**VOCODER_CONFIG['audio'])\r\nif use_cuda:\r\n    vocoder_model.cuda()\r\nvocoder_model.eval()\r\n\r\nsentence =  \"Bill got in the habit of asking himself “Is that thought true?” and if he wasn’t absolutely certain it was, he just let it go.\"\r\nalign, spec, stop_tokens, wav = tts(model, sentence, TTS_CONFIG, use_cuda, ap, use_gl=False, figures=True)\r\n```\r\n\r\n\r\nAn error is reported when I run the demo according to the document. \r\nI don't know the key `'gst_embedding_dim: null'` where is set","closed_by":{"login":"Jzow","id":68860495,"node_id":"MDQ6VXNlcjY4ODYwNDk1","avatar_url":"https://avatars.githubusercontent.com/u/68860495?v=4","gravatar_id":"","url":"https://api.github.com/users/Jzow","html_url":"https://github.com/Jzow","followers_url":"https://api.github.com/users/Jzow/followers","following_url":"https://api.github.com/users/Jzow/following{/other_user}","gists_url":"https://api.github.com/users/Jzow/gists{/gist_id}","starred_url":"https://api.github.com/users/Jzow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jzow/subscriptions","organizations_url":"https://api.github.com/users/Jzow/orgs","repos_url":"https://api.github.com/users/Jzow/repos","events_url":"https://api.github.com/users/Jzow/events{/privacy}","received_events_url":"https://api.github.com/users/Jzow/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/742/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mozilla/TTS/issues/742/timeline","performed_via_github_app":null,"state_reason":"completed"}