{"url":"https://api.github.com/repos/mozilla/TTS/issues/631","repository_url":"https://api.github.com/repos/mozilla/TTS","labels_url":"https://api.github.com/repos/mozilla/TTS/issues/631/labels{/name}","comments_url":"https://api.github.com/repos/mozilla/TTS/issues/631/comments","events_url":"https://api.github.com/repos/mozilla/TTS/issues/631/events","html_url":"https://github.com/mozilla/TTS/issues/631","id":796535721,"node_id":"MDU6SXNzdWU3OTY1MzU3MjE=","number":631,"title":"Loading JSON tts config broken","user":{"login":"mweinelt","id":131599,"node_id":"MDQ6VXNlcjEzMTU5OQ==","avatar_url":"https://avatars.githubusercontent.com/u/131599?v=4","gravatar_id":"","url":"https://api.github.com/users/mweinelt","html_url":"https://github.com/mweinelt","followers_url":"https://api.github.com/users/mweinelt/followers","following_url":"https://api.github.com/users/mweinelt/following{/other_user}","gists_url":"https://api.github.com/users/mweinelt/gists{/gist_id}","starred_url":"https://api.github.com/users/mweinelt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mweinelt/subscriptions","organizations_url":"https://api.github.com/users/mweinelt/orgs","repos_url":"https://api.github.com/users/mweinelt/repos","events_url":"https://api.github.com/users/mweinelt/events{/privacy}","received_events_url":"https://api.github.com/users/mweinelt/received_events","type":"User","site_admin":false},"labels":[{"id":813922298,"node_id":"MDU6TGFiZWw4MTM5MjIyOTg=","url":"https://api.github.com/repos/mozilla/TTS/labels/wontfix","name":"wontfix","color":"ffffff","default":true,"description":"This will not be worked on"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2021-01-29T03:00:40Z","updated_at":"2021-07-08T01:00:00Z","closed_at":"2021-07-08T01:00:00Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I downloaded the Tacotron DCA model (https://github.com/mozilla/TTS/releases/download/v0.0.9/tts_models--en--ljspeech--tacotron2-DCA.rar) for 0.0.9 and unpacked it and modified the stats_path, which was hardcoded to your homedir.\r\n\r\nPassing the config to tts-server it fails to decode the JSON:\r\n\r\n```pytb\r\nTraceback (most recent call last):\r\n  File \"/nix/store/dadsa5nz9j79hwlnp4090ggdl55jgs8g-tts-0.0.9/bin/.tts-server-wrapped\", line 6, in <module>\r\n    from TTS.server.server import main\r\n  File \"/nix/store/dadsa5nz9j79hwlnp4090ggdl55jgs8g-tts-0.0.9/lib/python3.8/site-packages/TTS/server/server.py\", line 77, in <module>\r\n    synthesizer = Synthesizer(args.tts_checkpoint, args.tts_config, args.vocoder_checkpoint, args.vocoder_config, args.use_cuda)\r\n  File \"/nix/store/dadsa5nz9j79hwlnp4090ggdl55jgs8g-tts-0.0.9/lib/python3.8/site-packages/TTS/utils/synthesizer.py\", line 46, in __init__\r\n    self.load_tts(tts_checkpoint, tts_config,\r\n  File \"/nix/store/dadsa5nz9j79hwlnp4090ggdl55jgs8g-tts-0.0.9/lib/python3.8/site-packages/TTS/utils/synthesizer.py\", line 80, in load_tts\r\n    self.tts_config = load_config(tts_config)\r\n  File \"/nix/store/dadsa5nz9j79hwlnp4090ggdl55jgs8g-tts-0.0.9/lib/python3.8/site-packages/TTS/utils/io.py\", line 46, in load_config\r\n    data = read_json_with_comments(config_path)\r\n  File \"/nix/store/dadsa5nz9j79hwlnp4090ggdl55jgs8g-tts-0.0.9/lib/python3.8/site-packages/TTS/utils/io.py\", line 30, in read_json_with_comments\r\n    data = json.loads(input_str)\r\n  File \"/nix/store/2wwb85hrvvfzkhrlwcj3pqi60nlbi9cq-python3-3.8.7/lib/python3.8/json/__init__.py\", line 357, in loads\r\n    return _default_decoder.decode(s)\r\n  File \"/nix/store/2wwb85hrvvfzkhrlwcj3pqi60nlbi9cq-python3-3.8.7/lib/python3.8/json/decoder.py\", line 337, in decode\r\n    obj, end = self.raw_decode(s, idx=_w(s, 0).end())\r\n  File \"/nix/store/2wwb85hrvvfzkhrlwcj3pqi60nlbi9cq-python3-3.8.7/lib/python3.8/json/decoder.py\", line 353, in raw_decode\r\n    obj, end = self.scan_once(s, idx)\r\njson.decoder.JSONDecodeError: Invalid control character at: line 32 column 17 (char 788)\r\n```\r\n\r\nI piped the config through jq to pretty print it and make sure it is in fact valid JSON.\r\n\r\n```json\r\n{\r\n  \"github_branch\": \"* dynamic_conv_attention\",\r\n  \"model\": \"Tacotron2\",\r\n  \"run_name\": \"ljspeech-dcattn\",\r\n  \"run_description\": \"tacotron2 with dynamic convolution attention.\",\r\n  \"audio\": {\r\n    \"fft_size\": 1024,\r\n    \"win_length\": 1024,\r\n    \"hop_length\": 256,\r\n    \"frame_length_ms\": null,\r\n    \"frame_shift_ms\": null,\r\n    \"sample_rate\": 22050,\r\n    \"preemphasis\": 0,\r\n    \"ref_level_db\": 20,\r\n    \"do_trim_silence\": true,\r\n    \"trim_db\": 60,\r\n    \"power\": 1.5,\r\n    \"griffin_lim_iters\": 60,\r\n    \"num_mels\": 80,\r\n    \"mel_fmin\": 50,\r\n    \"mel_fmax\": 7600,\r\n    \"spec_gain\": 1,\r\n    \"signal_norm\": true,\r\n    \"min_level_db\": -100,\r\n    \"symmetric_norm\": true,\r\n    \"max_norm\": 4,\r\n    \"clip_norm\": true,\r\n    \"stats_path\": \"tts/scale_stats.npy\"\r\n  },\r\n  \"distributed\": {\r\n    \"backend\": \"nccl\",\r\n    \"url\": \"tcp://localhost:54321\"\r\n  },\r\n  \"reinit_layers\": [],\r\n  \"batch_size\": 64,\r\n  \"eval_batch_size\": 16,\r\n  \"r\": 2,\r\n  \"gradual_training\": null,\r\n  \"mixed_precision\": true,\r\n  \"loss_masking\": true,\r\n  \"decoder_loss_alpha\": 0.25,\r\n  \"postnet_loss_alpha\": 0.25,\r\n  \"postnet_diff_spec_alpha\": 0,\r\n  \"decoder_diff_spec_alpha\": 0,\r\n  \"decoder_ssim_alpha\": 0.25,\r\n  \"postnet_ssim_alpha\": 0.25,\r\n  \"ga_alpha\": 0,\r\n  \"stopnet_pos_weight\": 15,\r\n  \"run_eval\": true,\r\n  \"test_delay_epochs\": 10,\r\n  \"test_sentences_file\": null,\r\n  \"noam_schedule\": true,\r\n  \"grad_clip\": 0.05,\r\n  \"epochs\": 1000,\r\n  \"lr\": 0.001,\r\n  \"wd\": 1e-06,\r\n  \"warmup_steps\": 4000,\r\n  \"seq_len_norm\": false,\r\n  \"memory_size\": -1,\r\n  \"prenet_type\": \"original\",\r\n  \"prenet_dropout\": true,\r\n  \"attention_type\": \"dynamic_convolution\",\r\n  \"attention_heads\": 4,\r\n  \"attention_norm\": \"softmax\",\r\n  \"windowing\": false,\r\n  \"use_forward_attn\": false,\r\n  \"forward_attn_mask\": false,\r\n  \"transition_agent\": false,\r\n  \"location_attn\": false,\r\n  \"bidirectional_decoder\": false,\r\n  \"double_decoder_consistency\": false,\r\n  \"ddc_r\": 7,\r\n  \"stopnet\": true,\r\n  \"separate_stopnet\": true,\r\n  \"print_step\": 25,\r\n  \"tb_plot_step\": 100,\r\n  \"print_eval\": false,\r\n  \"save_step\": 10000,\r\n  \"checkpoint\": true,\r\n  \"tb_model_param_stats\": false,\r\n  \"text_cleaner\": \"phoneme_cleaners\",\r\n  \"enable_eos_bos_chars\": false,\r\n  \"num_loader_workers\": 4,\r\n  \"num_val_loader_workers\": 4,\r\n  \"batch_group_size\": 4,\r\n  \"min_seq_len\": 6,\r\n  \"max_seq_len\": 180,\r\n  \"compute_input_seq_cache\": true,\r\n  \"output_path\": \"/data/rw/home/Trainings/LJSpeech/\",\r\n  \"phoneme_cache_path\": \"~/phoneme_cache/\",\r\n  \"use_phonemes\": true,\r\n  \"phoneme_language\": \"en-us\",\r\n  \"use_speaker_embedding\": false,\r\n  \"use_gst\": false,\r\n  \"use_external_speaker_embedding_file\": false,\r\n  \"external_speaker_embedding_file\": \"../../speakers-vctk-en.json\",\r\n  \"gst\": {\r\n    \"gst_style_input\": null,\r\n    \"gst_embedding_dim\": 512,\r\n    \"gst_num_heads\": 4,\r\n    \"gst_style_tokens\": 10,\r\n    \"gst_use_speaker_embedding\": false\r\n  },\r\n  \"datasets\": [\r\n    {\r\n      \"name\": \"ljspeech\",\r\n      \"path\": \"/root/LJSpeech-1.1/\",\r\n      \"meta_file_train\": \"metadata.csv\",\r\n      \"meta_file_val\": null\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nI then noticed the alternate code path to interpret it as YAML, which just worked.\r\n\r\nSomething is clearly off with the code path beginning with `read_json_with_comments`.","closed_by":{"login":"stale[bot]","id":26384082,"node_id":"MDM6Qm90MjYzODQwODI=","avatar_url":"https://avatars.githubusercontent.com/in/1724?v=4","gravatar_id":"","url":"https://api.github.com/users/stale%5Bbot%5D","html_url":"https://github.com/apps/stale","followers_url":"https://api.github.com/users/stale%5Bbot%5D/followers","following_url":"https://api.github.com/users/stale%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stale%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/stale%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/stale%5Bbot%5D/repos","events_url":"https://api.github.com/users/stale%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/stale%5Bbot%5D/received_events","type":"Bot","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mozilla/TTS/issues/631/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mozilla/TTS/issues/631/timeline","performed_via_github_app":null,"state_reason":"completed"}