[{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/comments/784276882","html_url":"https://github.com/dirty-cat/dirty_cat/issues/160#issuecomment-784276882","issue_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/160","id":784276882,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDI3Njg4Mg==","user":{"login":"alexis-cvetkov","id":33491786,"node_id":"MDQ6VXNlcjMzNDkxNzg2","avatar_url":"https://avatars.githubusercontent.com/u/33491786?v=4","gravatar_id":"","url":"https://api.github.com/users/alexis-cvetkov","html_url":"https://github.com/alexis-cvetkov","followers_url":"https://api.github.com/users/alexis-cvetkov/followers","following_url":"https://api.github.com/users/alexis-cvetkov/following{/other_user}","gists_url":"https://api.github.com/users/alexis-cvetkov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexis-cvetkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexis-cvetkov/subscriptions","organizations_url":"https://api.github.com/users/alexis-cvetkov/orgs","repos_url":"https://api.github.com/users/alexis-cvetkov/repos","events_url":"https://api.github.com/users/alexis-cvetkov/events{/privacy}","received_events_url":"https://api.github.com/users/alexis-cvetkov/received_events","type":"User","site_admin":false},"created_at":"2021-02-23T15:19:39Z","updated_at":"2021-02-23T16:24:11Z","author_association":"MEMBER","body":"Hello @krumeto\r\n\r\nThank you for raising this issue! I think the **RuntimeWarnings** you get are due to the quantity `np.dot(Ht, W)` having very small values (< 5e-309), thus raising overflow errors when the algorithm computes the element-wise inverse of this quantity (as in `np.dot(Ht, W) ** -1`).\r\n\r\nTo show that, I trained the GapEncoder on a random array of strings with length = 1M and various cardinalities (10k, 20k, 100k). I plot below the evolution of the minimum value of `np.dot(Ht, W)` as the training goes.\r\n\r\n![image](https://user-images.githubusercontent.com/33491786/108849176-29d7cf80-75e2-11eb-8eaf-15877cdb44ef.png)\r\n\r\nWe can see that `np.dot(Ht, W)` takes smaller and smaller values as the training goes (mostly due to `W` being too small), but I was only able to see this when the cardinality is high. I guess it can also happen with low cardinality, as in your case, but may depend on the data.\r\n\r\nFor now a quick fix would be to prevent `W`  from taking arbitrarily small values. This can be done by thresholding values that are too small after training on each batch (see code below). From quick experiments it doesn't seem to change the encodings a lot, except for a few coefficients, but I am going to check if this is a proper way of tackling this issue in the future.\r\n\r\n```\r\nbatches = np.array_split(X, len(X)//128) # Split your data X in batches of size 128.\r\nenc = GapEncoder()\r\nfor batch in batches:\r\n    enc.partial_fit(batch)\r\n    enc.W_[enc.W_ < 1e-20] = 1e-20 # Prevent W from having values smaller than 1e-20\r\n```","reactions":{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/comments/784276882/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"alexis-cvetkov","id":33491786,"node_id":"MDQ6VXNlcjMzNDkxNzg2","avatar_url":"https://avatars.githubusercontent.com/u/33491786?v=4","gravatar_id":"","url":"https://api.github.com/users/alexis-cvetkov","html_url":"https://github.com/alexis-cvetkov","followers_url":"https://api.github.com/users/alexis-cvetkov/followers","following_url":"https://api.github.com/users/alexis-cvetkov/following{/other_user}","gists_url":"https://api.github.com/users/alexis-cvetkov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexis-cvetkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexis-cvetkov/subscriptions","organizations_url":"https://api.github.com/users/alexis-cvetkov/orgs","repos_url":"https://api.github.com/users/alexis-cvetkov/repos","events_url":"https://api.github.com/users/alexis-cvetkov/events{/privacy}","received_events_url":"https://api.github.com/users/alexis-cvetkov/received_events","type":"User","site_admin":false}},{"id":4365758501,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDM2NTc1ODUwMQ==","url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/events/4365758501","actor":{"login":"krumeto","id":11272436,"node_id":"MDQ6VXNlcjExMjcyNDM2","avatar_url":"https://avatars.githubusercontent.com/u/11272436?v=4","gravatar_id":"","url":"https://api.github.com/users/krumeto","html_url":"https://github.com/krumeto","followers_url":"https://api.github.com/users/krumeto/followers","following_url":"https://api.github.com/users/krumeto/following{/other_user}","gists_url":"https://api.github.com/users/krumeto/gists{/gist_id}","starred_url":"https://api.github.com/users/krumeto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krumeto/subscriptions","organizations_url":"https://api.github.com/users/krumeto/orgs","repos_url":"https://api.github.com/users/krumeto/repos","events_url":"https://api.github.com/users/krumeto/events{/privacy}","received_events_url":"https://api.github.com/users/krumeto/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-02-23T15:19:39Z","performed_via_github_app":null},{"id":4365758506,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQzNjU3NTg1MDY=","url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/events/4365758506","actor":{"login":"krumeto","id":11272436,"node_id":"MDQ6VXNlcjExMjcyNDM2","avatar_url":"https://avatars.githubusercontent.com/u/11272436?v=4","gravatar_id":"","url":"https://api.github.com/users/krumeto","html_url":"https://github.com/krumeto","followers_url":"https://api.github.com/users/krumeto/followers","following_url":"https://api.github.com/users/krumeto/following{/other_user}","gists_url":"https://api.github.com/users/krumeto/gists{/gist_id}","starred_url":"https://api.github.com/users/krumeto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krumeto/subscriptions","organizations_url":"https://api.github.com/users/krumeto/orgs","repos_url":"https://api.github.com/users/krumeto/repos","events_url":"https://api.github.com/users/krumeto/events{/privacy}","received_events_url":"https://api.github.com/users/krumeto/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-02-23T15:19:40Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/comments/784279814","html_url":"https://github.com/dirty-cat/dirty_cat/issues/160#issuecomment-784279814","issue_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/160","id":784279814,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDI3OTgxNA==","user":{"login":"krumeto","id":11272436,"node_id":"MDQ6VXNlcjExMjcyNDM2","avatar_url":"https://avatars.githubusercontent.com/u/11272436?v=4","gravatar_id":"","url":"https://api.github.com/users/krumeto","html_url":"https://github.com/krumeto","followers_url":"https://api.github.com/users/krumeto/followers","following_url":"https://api.github.com/users/krumeto/following{/other_user}","gists_url":"https://api.github.com/users/krumeto/gists{/gist_id}","starred_url":"https://api.github.com/users/krumeto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krumeto/subscriptions","organizations_url":"https://api.github.com/users/krumeto/orgs","repos_url":"https://api.github.com/users/krumeto/repos","events_url":"https://api.github.com/users/krumeto/events{/privacy}","received_events_url":"https://api.github.com/users/krumeto/received_events","type":"User","site_admin":false},"created_at":"2021-02-23T15:23:30Z","updated_at":"2021-02-23T15:23:30Z","author_association":"NONE","body":"Hi @alexis-cvetkov and thanks a lot!,\r\n\r\nWe will run experiments on our dataset vs. SimilarityEncoder and can post metrics results afterwards. \r\n\r\nTo add to the above, can you please confirm if Gapencoder expects a single column as an input?\r\n\r\nWhen we try to fit it on multiple columns, we get:\r\n`AssertionError: ERROR:        shape (4024877, 2) of input array is not supported`\r\n\r\nWe thus create a step per column in the ColumnTransformers we use.\r\n\r\nThank you in advance again,\r\nKrum\r\n","reactions":{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/comments/784279814/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"krumeto","id":11272436,"node_id":"MDQ6VXNlcjExMjcyNDM2","avatar_url":"https://avatars.githubusercontent.com/u/11272436?v=4","gravatar_id":"","url":"https://api.github.com/users/krumeto","html_url":"https://github.com/krumeto","followers_url":"https://api.github.com/users/krumeto/followers","following_url":"https://api.github.com/users/krumeto/following{/other_user}","gists_url":"https://api.github.com/users/krumeto/gists{/gist_id}","starred_url":"https://api.github.com/users/krumeto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krumeto/subscriptions","organizations_url":"https://api.github.com/users/krumeto/orgs","repos_url":"https://api.github.com/users/krumeto/repos","events_url":"https://api.github.com/users/krumeto/events{/privacy}","received_events_url":"https://api.github.com/users/krumeto/received_events","type":"User","site_admin":false}},{"id":4365779831,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDM2NTc3OTgzMQ==","url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/events/4365779831","actor":{"login":"alexis-cvetkov","id":33491786,"node_id":"MDQ6VXNlcjMzNDkxNzg2","avatar_url":"https://avatars.githubusercontent.com/u/33491786?v=4","gravatar_id":"","url":"https://api.github.com/users/alexis-cvetkov","html_url":"https://github.com/alexis-cvetkov","followers_url":"https://api.github.com/users/alexis-cvetkov/followers","following_url":"https://api.github.com/users/alexis-cvetkov/following{/other_user}","gists_url":"https://api.github.com/users/alexis-cvetkov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexis-cvetkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexis-cvetkov/subscriptions","organizations_url":"https://api.github.com/users/alexis-cvetkov/orgs","repos_url":"https://api.github.com/users/alexis-cvetkov/repos","events_url":"https://api.github.com/users/alexis-cvetkov/events{/privacy}","received_events_url":"https://api.github.com/users/alexis-cvetkov/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-02-23T15:23:30Z","performed_via_github_app":null},{"id":4365779835,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQzNjU3Nzk4MzU=","url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/events/4365779835","actor":{"login":"alexis-cvetkov","id":33491786,"node_id":"MDQ6VXNlcjMzNDkxNzg2","avatar_url":"https://avatars.githubusercontent.com/u/33491786?v=4","gravatar_id":"","url":"https://api.github.com/users/alexis-cvetkov","html_url":"https://github.com/alexis-cvetkov","followers_url":"https://api.github.com/users/alexis-cvetkov/followers","following_url":"https://api.github.com/users/alexis-cvetkov/following{/other_user}","gists_url":"https://api.github.com/users/alexis-cvetkov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexis-cvetkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexis-cvetkov/subscriptions","organizations_url":"https://api.github.com/users/alexis-cvetkov/orgs","repos_url":"https://api.github.com/users/alexis-cvetkov/repos","events_url":"https://api.github.com/users/alexis-cvetkov/events{/privacy}","received_events_url":"https://api.github.com/users/alexis-cvetkov/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-02-23T15:23:30Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/comments/784294849","html_url":"https://github.com/dirty-cat/dirty_cat/issues/160#issuecomment-784294849","issue_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/160","id":784294849,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDI5NDg0OQ==","user":{"login":"alexis-cvetkov","id":33491786,"node_id":"MDQ6VXNlcjMzNDkxNzg2","avatar_url":"https://avatars.githubusercontent.com/u/33491786?v=4","gravatar_id":"","url":"https://api.github.com/users/alexis-cvetkov","html_url":"https://github.com/alexis-cvetkov","followers_url":"https://api.github.com/users/alexis-cvetkov/followers","following_url":"https://api.github.com/users/alexis-cvetkov/following{/other_user}","gists_url":"https://api.github.com/users/alexis-cvetkov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexis-cvetkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexis-cvetkov/subscriptions","organizations_url":"https://api.github.com/users/alexis-cvetkov/orgs","repos_url":"https://api.github.com/users/alexis-cvetkov/repos","events_url":"https://api.github.com/users/alexis-cvetkov/events{/privacy}","received_events_url":"https://api.github.com/users/alexis-cvetkov/received_events","type":"User","site_admin":false},"created_at":"2021-02-23T15:43:19Z","updated_at":"2021-02-23T15:43:19Z","author_association":"MEMBER","body":"Yes for now the GapEncoder works for a single column only, so you have to train one model for each column.\r\nA comparison with SimilarityEncoder would be greatly appreciated indeed ! Note that you can also use the MinHashEncoder which should be quite fast.","reactions":{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/comments/784294849/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"alexis-cvetkov","id":33491786,"node_id":"MDQ6VXNlcjMzNDkxNzg2","avatar_url":"https://avatars.githubusercontent.com/u/33491786?v=4","gravatar_id":"","url":"https://api.github.com/users/alexis-cvetkov","html_url":"https://github.com/alexis-cvetkov","followers_url":"https://api.github.com/users/alexis-cvetkov/followers","following_url":"https://api.github.com/users/alexis-cvetkov/following{/other_user}","gists_url":"https://api.github.com/users/alexis-cvetkov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexis-cvetkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexis-cvetkov/subscriptions","organizations_url":"https://api.github.com/users/alexis-cvetkov/orgs","repos_url":"https://api.github.com/users/alexis-cvetkov/repos","events_url":"https://api.github.com/users/alexis-cvetkov/events{/privacy}","received_events_url":"https://api.github.com/users/alexis-cvetkov/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/comments/784302376","html_url":"https://github.com/dirty-cat/dirty_cat/issues/160#issuecomment-784302376","issue_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/160","id":784302376,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDMwMjM3Ng==","user":{"login":"GaelVaroquaux","id":208217,"node_id":"MDQ6VXNlcjIwODIxNw==","avatar_url":"https://avatars.githubusercontent.com/u/208217?v=4","gravatar_id":"","url":"https://api.github.com/users/GaelVaroquaux","html_url":"https://github.com/GaelVaroquaux","followers_url":"https://api.github.com/users/GaelVaroquaux/followers","following_url":"https://api.github.com/users/GaelVaroquaux/following{/other_user}","gists_url":"https://api.github.com/users/GaelVaroquaux/gists{/gist_id}","starred_url":"https://api.github.com/users/GaelVaroquaux/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GaelVaroquaux/subscriptions","organizations_url":"https://api.github.com/users/GaelVaroquaux/orgs","repos_url":"https://api.github.com/users/GaelVaroquaux/repos","events_url":"https://api.github.com/users/GaelVaroquaux/events{/privacy}","received_events_url":"https://api.github.com/users/GaelVaroquaux/received_events","type":"User","site_admin":false},"created_at":"2021-02-23T15:53:27Z","updated_at":"2021-02-23T15:53:27Z","author_association":"MEMBER","body":"> (as in np.dot(Ht, W) ** -1).\n\nTo avoid underflows, we should probably write this as\n\n1. / (np.dot(Ht, W) + 1e-10))\n\nCan you test that it fixes the problem and we'll update the library.\n\nDo we have a test case that we can use to reproduce and build a unit\ntest.\n","reactions":{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/comments/784302376/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GaelVaroquaux","id":208217,"node_id":"MDQ6VXNlcjIwODIxNw==","avatar_url":"https://avatars.githubusercontent.com/u/208217?v=4","gravatar_id":"","url":"https://api.github.com/users/GaelVaroquaux","html_url":"https://github.com/GaelVaroquaux","followers_url":"https://api.github.com/users/GaelVaroquaux/followers","following_url":"https://api.github.com/users/GaelVaroquaux/following{/other_user}","gists_url":"https://api.github.com/users/GaelVaroquaux/gists{/gist_id}","starred_url":"https://api.github.com/users/GaelVaroquaux/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GaelVaroquaux/subscriptions","organizations_url":"https://api.github.com/users/GaelVaroquaux/orgs","repos_url":"https://api.github.com/users/GaelVaroquaux/repos","events_url":"https://api.github.com/users/GaelVaroquaux/events{/privacy}","received_events_url":"https://api.github.com/users/GaelVaroquaux/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/comments/784459537","html_url":"https://github.com/dirty-cat/dirty_cat/issues/160#issuecomment-784459537","issue_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/160","id":784459537,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDQ1OTUzNw==","user":{"login":"krumeto","id":11272436,"node_id":"MDQ6VXNlcjExMjcyNDM2","avatar_url":"https://avatars.githubusercontent.com/u/11272436?v=4","gravatar_id":"","url":"https://api.github.com/users/krumeto","html_url":"https://github.com/krumeto","followers_url":"https://api.github.com/users/krumeto/followers","following_url":"https://api.github.com/users/krumeto/following{/other_user}","gists_url":"https://api.github.com/users/krumeto/gists{/gist_id}","starred_url":"https://api.github.com/users/krumeto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krumeto/subscriptions","organizations_url":"https://api.github.com/users/krumeto/orgs","repos_url":"https://api.github.com/users/krumeto/repos","events_url":"https://api.github.com/users/krumeto/events{/privacy}","received_events_url":"https://api.github.com/users/krumeto/received_events","type":"User","site_admin":false},"created_at":"2021-02-23T19:38:13Z","updated_at":"2021-02-23T19:38:13Z","author_association":"NONE","body":"@alexis-cvetkov If it would help for reproducing, the column on which I am testing is the following one:\r\n\r\nTotal values are 4391599, total unique values are 59. \r\n\r\nExample of values (we can do some preprocessing to go around it for sure):\r\n`[Mercy Medical Center (Des Moines, IA), Mercy Medical Center (Roseburg, OR), Harrison Medical Center (Bremerton, WA), St. Joseph Hospital East (Lexington, KY), Lakeside Hospital (Omaha, NE), ..., Plainview Hospital (Plainview, NE), Continuing Care Hospital (Lexington, KY), Regional Hospital for Resp (Seattle, WA), Creighton University Medical Center (Omaha, NE), St. Alexius Garrison Family Clinic (Garrison, ND)]`\r\n\r\nI tried tracking the minimum W throughout batches - it gets really small really fast:\r\n![image](https://user-images.githubusercontent.com/11272436/108897599-f23b4880-761e-11eb-8c35-dd76ea36d3b3.png)\r\n\r\nInterestingly, when we used .partial_fit(batch), we did not get the error message. Just when we tried fitting all at once. \r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/comments/784459537/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"krumeto","id":11272436,"node_id":"MDQ6VXNlcjExMjcyNDM2","avatar_url":"https://avatars.githubusercontent.com/u/11272436?v=4","gravatar_id":"","url":"https://api.github.com/users/krumeto","html_url":"https://github.com/krumeto","followers_url":"https://api.github.com/users/krumeto/followers","following_url":"https://api.github.com/users/krumeto/following{/other_user}","gists_url":"https://api.github.com/users/krumeto/gists{/gist_id}","starred_url":"https://api.github.com/users/krumeto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krumeto/subscriptions","organizations_url":"https://api.github.com/users/krumeto/orgs","repos_url":"https://api.github.com/users/krumeto/repos","events_url":"https://api.github.com/users/krumeto/events{/privacy}","received_events_url":"https://api.github.com/users/krumeto/received_events","type":"User","site_admin":false}},{"id":4367048052,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDM2NzA0ODA1Mg==","url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/events/4367048052","actor":{"login":"alexis-cvetkov","id":33491786,"node_id":"MDQ6VXNlcjMzNDkxNzg2","avatar_url":"https://avatars.githubusercontent.com/u/33491786?v=4","gravatar_id":"","url":"https://api.github.com/users/alexis-cvetkov","html_url":"https://github.com/alexis-cvetkov","followers_url":"https://api.github.com/users/alexis-cvetkov/followers","following_url":"https://api.github.com/users/alexis-cvetkov/following{/other_user}","gists_url":"https://api.github.com/users/alexis-cvetkov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexis-cvetkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexis-cvetkov/subscriptions","organizations_url":"https://api.github.com/users/alexis-cvetkov/orgs","repos_url":"https://api.github.com/users/alexis-cvetkov/repos","events_url":"https://api.github.com/users/alexis-cvetkov/events{/privacy}","received_events_url":"https://api.github.com/users/alexis-cvetkov/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-02-23T19:38:13Z","performed_via_github_app":null},{"id":4367048056,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQzNjcwNDgwNTY=","url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/events/4367048056","actor":{"login":"alexis-cvetkov","id":33491786,"node_id":"MDQ6VXNlcjMzNDkxNzg2","avatar_url":"https://avatars.githubusercontent.com/u/33491786?v=4","gravatar_id":"","url":"https://api.github.com/users/alexis-cvetkov","html_url":"https://github.com/alexis-cvetkov","followers_url":"https://api.github.com/users/alexis-cvetkov/followers","following_url":"https://api.github.com/users/alexis-cvetkov/following{/other_user}","gists_url":"https://api.github.com/users/alexis-cvetkov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexis-cvetkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexis-cvetkov/subscriptions","organizations_url":"https://api.github.com/users/alexis-cvetkov/orgs","repos_url":"https://api.github.com/users/alexis-cvetkov/repos","events_url":"https://api.github.com/users/alexis-cvetkov/events{/privacy}","received_events_url":"https://api.github.com/users/alexis-cvetkov/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-02-23T19:38:13Z","performed_via_github_app":null},{"actor":{"login":"alexis-cvetkov","id":33491786,"node_id":"MDQ6VXNlcjMzNDkxNzg2","avatar_url":"https://avatars.githubusercontent.com/u/33491786?v=4","gravatar_id":"","url":"https://api.github.com/users/alexis-cvetkov","html_url":"https://github.com/alexis-cvetkov","followers_url":"https://api.github.com/users/alexis-cvetkov/followers","following_url":"https://api.github.com/users/alexis-cvetkov/following{/other_user}","gists_url":"https://api.github.com/users/alexis-cvetkov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexis-cvetkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexis-cvetkov/subscriptions","organizations_url":"https://api.github.com/users/alexis-cvetkov/orgs","repos_url":"https://api.github.com/users/alexis-cvetkov/repos","events_url":"https://api.github.com/users/alexis-cvetkov/events{/privacy}","received_events_url":"https://api.github.com/users/alexis-cvetkov/received_events","type":"User","site_admin":false},"created_at":"2021-02-24T09:30:50Z","updated_at":"2021-02-24T09:30:50Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/161","repository_url":"https://api.github.com/repos/dirty-cat/dirty_cat","labels_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/161/labels{/name}","comments_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/161/comments","events_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/161/events","html_url":"https://github.com/dirty-cat/dirty_cat/pull/161","id":815293227,"node_id":"MDExOlB1bGxSZXF1ZXN0NTc5MTQ2NzE0","number":161,"title":"Fix overflow error in GapEncoder","user":{"login":"alexis-cvetkov","id":33491786,"node_id":"MDQ6VXNlcjMzNDkxNzg2","avatar_url":"https://avatars.githubusercontent.com/u/33491786?v=4","gravatar_id":"","url":"https://api.github.com/users/alexis-cvetkov","html_url":"https://github.com/alexis-cvetkov","followers_url":"https://api.github.com/users/alexis-cvetkov/followers","following_url":"https://api.github.com/users/alexis-cvetkov/following{/other_user}","gists_url":"https://api.github.com/users/alexis-cvetkov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexis-cvetkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexis-cvetkov/subscriptions","organizations_url":"https://api.github.com/users/alexis-cvetkov/orgs","repos_url":"https://api.github.com/users/alexis-cvetkov/repos","events_url":"https://api.github.com/users/alexis-cvetkov/events{/privacy}","received_events_url":"https://api.github.com/users/alexis-cvetkov/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-02-24T09:30:50Z","updated_at":"2021-02-27T13:49:41Z","closed_at":"2021-02-27T13:49:41Z","author_association":"MEMBER","active_lock_reason":null,"draft":false,"repository":{"id":124964482,"node_id":"MDEwOlJlcG9zaXRvcnkxMjQ5NjQ0ODI=","name":"dirty_cat","full_name":"dirty-cat/dirty_cat","private":false,"owner":{"login":"dirty-cat","id":37211705,"node_id":"MDEyOk9yZ2FuaXphdGlvbjM3MjExNzA1","avatar_url":"https://avatars.githubusercontent.com/u/37211705?v=4","gravatar_id":"","url":"https://api.github.com/users/dirty-cat","html_url":"https://github.com/dirty-cat","followers_url":"https://api.github.com/users/dirty-cat/followers","following_url":"https://api.github.com/users/dirty-cat/following{/other_user}","gists_url":"https://api.github.com/users/dirty-cat/gists{/gist_id}","starred_url":"https://api.github.com/users/dirty-cat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dirty-cat/subscriptions","organizations_url":"https://api.github.com/users/dirty-cat/orgs","repos_url":"https://api.github.com/users/dirty-cat/repos","events_url":"https://api.github.com/users/dirty-cat/events{/privacy}","received_events_url":"https://api.github.com/users/dirty-cat/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/dirty-cat/dirty_cat","description":"Machine learning on dirty tabular data","fork":false,"url":"https://api.github.com/repos/dirty-cat/dirty_cat","forks_url":"https://api.github.com/repos/dirty-cat/dirty_cat/forks","keys_url":"https://api.github.com/repos/dirty-cat/dirty_cat/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dirty-cat/dirty_cat/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dirty-cat/dirty_cat/teams","hooks_url":"https://api.github.com/repos/dirty-cat/dirty_cat/hooks","issue_events_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/events{/number}","events_url":"https://api.github.com/repos/dirty-cat/dirty_cat/events","assignees_url":"https://api.github.com/repos/dirty-cat/dirty_cat/assignees{/user}","branches_url":"https://api.github.com/repos/dirty-cat/dirty_cat/branches{/branch}","tags_url":"https://api.github.com/repos/dirty-cat/dirty_cat/tags","blobs_url":"https://api.github.com/repos/dirty-cat/dirty_cat/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dirty-cat/dirty_cat/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dirty-cat/dirty_cat/git/refs{/sha}","trees_url":"https://api.github.com/repos/dirty-cat/dirty_cat/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dirty-cat/dirty_cat/statuses/{sha}","languages_url":"https://api.github.com/repos/dirty-cat/dirty_cat/languages","stargazers_url":"https://api.github.com/repos/dirty-cat/dirty_cat/stargazers","contributors_url":"https://api.github.com/repos/dirty-cat/dirty_cat/contributors","subscribers_url":"https://api.github.com/repos/dirty-cat/dirty_cat/subscribers","subscription_url":"https://api.github.com/repos/dirty-cat/dirty_cat/subscription","commits_url":"https://api.github.com/repos/dirty-cat/dirty_cat/commits{/sha}","git_commits_url":"https://api.github.com/repos/dirty-cat/dirty_cat/git/commits{/sha}","comments_url":"https://api.github.com/repos/dirty-cat/dirty_cat/comments{/number}","issue_comment_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/comments{/number}","contents_url":"https://api.github.com/repos/dirty-cat/dirty_cat/contents/{+path}","compare_url":"https://api.github.com/repos/dirty-cat/dirty_cat/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dirty-cat/dirty_cat/merges","archive_url":"https://api.github.com/repos/dirty-cat/dirty_cat/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dirty-cat/dirty_cat/downloads","issues_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues{/number}","pulls_url":"https://api.github.com/repos/dirty-cat/dirty_cat/pulls{/number}","milestones_url":"https://api.github.com/repos/dirty-cat/dirty_cat/milestones{/number}","notifications_url":"https://api.github.com/repos/dirty-cat/dirty_cat/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dirty-cat/dirty_cat/labels{/name}","releases_url":"https://api.github.com/repos/dirty-cat/dirty_cat/releases{/id}","deployments_url":"https://api.github.com/repos/dirty-cat/dirty_cat/deployments","created_at":"2018-03-12T23:32:22Z","updated_at":"2023-01-19T10:35:18Z","pushed_at":"2023-01-19T08:53:32Z","git_url":"git://github.com/dirty-cat/dirty_cat.git","ssh_url":"git@github.com:dirty-cat/dirty_cat.git","clone_url":"https://github.com/dirty-cat/dirty_cat.git","svn_url":"https://github.com/dirty-cat/dirty_cat","homepage":"https://dirty-cat.github.io/","size":2263,"stargazers_count":645,"watchers_count":645,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":56,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":36,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause","node_id":"MDc6TGljZW5zZTU="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["data","data-cleaning","data-preparation","data-preparation-and-analysis","data-preprocessing","data-science","machine-learning"],"visibility":"public","forks":56,"open_issues":36,"watchers":645,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/pulls/161","html_url":"https://github.com/dirty-cat/dirty_cat/pull/161","diff_url":"https://github.com/dirty-cat/dirty_cat/pull/161.diff","patch_url":"https://github.com/dirty-cat/dirty_cat/pull/161.patch","merged_at":"2021-02-27T13:49:41Z"},"body":"Closes #160, I fixed potential overflow in `1 / np.dot(Ht, W)` with `1 / (np.dot(Ht, W) + 1e-10)`. I also added a unit test that raises RuntimeWarnings without the fix.","reactions":{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/161/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/161/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/comments/784941570","html_url":"https://github.com/dirty-cat/dirty_cat/issues/160#issuecomment-784941570","issue_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/160","id":784941570,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDk0MTU3MA==","user":{"login":"alexis-cvetkov","id":33491786,"node_id":"MDQ6VXNlcjMzNDkxNzg2","avatar_url":"https://avatars.githubusercontent.com/u/33491786?v=4","gravatar_id":"","url":"https://api.github.com/users/alexis-cvetkov","html_url":"https://github.com/alexis-cvetkov","followers_url":"https://api.github.com/users/alexis-cvetkov/followers","following_url":"https://api.github.com/users/alexis-cvetkov/following{/other_user}","gists_url":"https://api.github.com/users/alexis-cvetkov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexis-cvetkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexis-cvetkov/subscriptions","organizations_url":"https://api.github.com/users/alexis-cvetkov/orgs","repos_url":"https://api.github.com/users/alexis-cvetkov/repos","events_url":"https://api.github.com/users/alexis-cvetkov/events{/privacy}","received_events_url":"https://api.github.com/users/alexis-cvetkov/received_events","type":"User","site_admin":false},"created_at":"2021-02-24T09:33:34Z","updated_at":"2021-02-24T09:37:17Z","author_association":"MEMBER","body":"Thanks you for the details @krumeto. I have been able to reproduce this issue on a simple example which is quite fast to run:\r\n```\r\nimport numpy as np\r\nimport matplotlib.pyplot as plt\r\nfrom dirty_cat import GapEncoder\r\n\r\nnp.random.seed(0)\r\nX = np.random.randint(1e5, 1e6, size=(8000, 1)).astype(str)\r\n\r\nenc = GapEncoder(random_state=0, n_components=2, batch_size=1,\r\n                 min_iter=1, max_iter=1)\r\nenc.fit(X)\r\n```\r\nThis example raises the same RuntimeWarnings that you got, and Gael's suggestion fixes it.\r\nI have opened the PR #161 with the fix and a unit test. Can you quickly check if I can merge it @GaelVaroquaux ?\r\n\r\n> Interestingly, when we used .partial_fit(batch), we did not get the error message. Just when we tried fitting all at once.\r\n\r\nYes I realized my example doesn't raise any error with `partial_fit` too. I am not 100% sure why but I noticed that `np.dot(Ht, W)` decreases faster when the number of unique n-grams in the data is high (which I think is why you can get this error even with low cardinality data). This happens more when using `fit` rather than `partial_fit` because in the first case the matrix of n-grams counts that we want to factorize is built from all the data (which has a lot of n-grams). With `partial_fit` the number of different n-grams increases slowly with each batch, hence a slower decrease. This is coherent with what I observe in my toy example (slower decrease with partial fit and no error raised).","reactions":{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/comments/784941570/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"alexis-cvetkov","id":33491786,"node_id":"MDQ6VXNlcjMzNDkxNzg2","avatar_url":"https://avatars.githubusercontent.com/u/33491786?v=4","gravatar_id":"","url":"https://api.github.com/users/alexis-cvetkov","html_url":"https://github.com/alexis-cvetkov","followers_url":"https://api.github.com/users/alexis-cvetkov/followers","following_url":"https://api.github.com/users/alexis-cvetkov/following{/other_user}","gists_url":"https://api.github.com/users/alexis-cvetkov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexis-cvetkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexis-cvetkov/subscriptions","organizations_url":"https://api.github.com/users/alexis-cvetkov/orgs","repos_url":"https://api.github.com/users/alexis-cvetkov/repos","events_url":"https://api.github.com/users/alexis-cvetkov/events{/privacy}","received_events_url":"https://api.github.com/users/alexis-cvetkov/received_events","type":"User","site_admin":false}},{"id":4369866937,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDM2OTg2NjkzNw==","url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/events/4369866937","actor":{"login":"krumeto","id":11272436,"node_id":"MDQ6VXNlcjExMjcyNDM2","avatar_url":"https://avatars.githubusercontent.com/u/11272436?v=4","gravatar_id":"","url":"https://api.github.com/users/krumeto","html_url":"https://github.com/krumeto","followers_url":"https://api.github.com/users/krumeto/followers","following_url":"https://api.github.com/users/krumeto/following{/other_user}","gists_url":"https://api.github.com/users/krumeto/gists{/gist_id}","starred_url":"https://api.github.com/users/krumeto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krumeto/subscriptions","organizations_url":"https://api.github.com/users/krumeto/orgs","repos_url":"https://api.github.com/users/krumeto/repos","events_url":"https://api.github.com/users/krumeto/events{/privacy}","received_events_url":"https://api.github.com/users/krumeto/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-02-24T09:33:34Z","performed_via_github_app":null},{"id":4369866941,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQzNjk4NjY5NDE=","url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/events/4369866941","actor":{"login":"krumeto","id":11272436,"node_id":"MDQ6VXNlcjExMjcyNDM2","avatar_url":"https://avatars.githubusercontent.com/u/11272436?v=4","gravatar_id":"","url":"https://api.github.com/users/krumeto","html_url":"https://github.com/krumeto","followers_url":"https://api.github.com/users/krumeto/followers","following_url":"https://api.github.com/users/krumeto/following{/other_user}","gists_url":"https://api.github.com/users/krumeto/gists{/gist_id}","starred_url":"https://api.github.com/users/krumeto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krumeto/subscriptions","organizations_url":"https://api.github.com/users/krumeto/orgs","repos_url":"https://api.github.com/users/krumeto/repos","events_url":"https://api.github.com/users/krumeto/events{/privacy}","received_events_url":"https://api.github.com/users/krumeto/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-02-24T09:33:34Z","performed_via_github_app":null},{"id":4369885821,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDM2OTg4NTgyMQ==","url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/events/4369885821","actor":{"login":"GaelVaroquaux","id":208217,"node_id":"MDQ6VXNlcjIwODIxNw==","avatar_url":"https://avatars.githubusercontent.com/u/208217?v=4","gravatar_id":"","url":"https://api.github.com/users/GaelVaroquaux","html_url":"https://github.com/GaelVaroquaux","followers_url":"https://api.github.com/users/GaelVaroquaux/followers","following_url":"https://api.github.com/users/GaelVaroquaux/following{/other_user}","gists_url":"https://api.github.com/users/GaelVaroquaux/gists{/gist_id}","starred_url":"https://api.github.com/users/GaelVaroquaux/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GaelVaroquaux/subscriptions","organizations_url":"https://api.github.com/users/GaelVaroquaux/orgs","repos_url":"https://api.github.com/users/GaelVaroquaux/repos","events_url":"https://api.github.com/users/GaelVaroquaux/events{/privacy}","received_events_url":"https://api.github.com/users/GaelVaroquaux/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-02-24T09:37:17Z","performed_via_github_app":null},{"id":4369885824,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQzNjk4ODU4MjQ=","url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/events/4369885824","actor":{"login":"GaelVaroquaux","id":208217,"node_id":"MDQ6VXNlcjIwODIxNw==","avatar_url":"https://avatars.githubusercontent.com/u/208217?v=4","gravatar_id":"","url":"https://api.github.com/users/GaelVaroquaux","html_url":"https://github.com/GaelVaroquaux","followers_url":"https://api.github.com/users/GaelVaroquaux/followers","following_url":"https://api.github.com/users/GaelVaroquaux/following{/other_user}","gists_url":"https://api.github.com/users/GaelVaroquaux/gists{/gist_id}","starred_url":"https://api.github.com/users/GaelVaroquaux/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GaelVaroquaux/subscriptions","organizations_url":"https://api.github.com/users/GaelVaroquaux/orgs","repos_url":"https://api.github.com/users/GaelVaroquaux/repos","events_url":"https://api.github.com/users/GaelVaroquaux/events{/privacy}","received_events_url":"https://api.github.com/users/GaelVaroquaux/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-02-24T09:37:17Z","performed_via_github_app":null},{"id":4385006637,"node_id":"MDExOkNsb3NlZEV2ZW50NDM4NTAwNjYzNw==","url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/events/4385006637","actor":{"login":"alexis-cvetkov","id":33491786,"node_id":"MDQ6VXNlcjMzNDkxNzg2","avatar_url":"https://avatars.githubusercontent.com/u/33491786?v=4","gravatar_id":"","url":"https://api.github.com/users/alexis-cvetkov","html_url":"https://github.com/alexis-cvetkov","followers_url":"https://api.github.com/users/alexis-cvetkov/followers","following_url":"https://api.github.com/users/alexis-cvetkov/following{/other_user}","gists_url":"https://api.github.com/users/alexis-cvetkov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexis-cvetkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexis-cvetkov/subscriptions","organizations_url":"https://api.github.com/users/alexis-cvetkov/orgs","repos_url":"https://api.github.com/users/alexis-cvetkov/repos","events_url":"https://api.github.com/users/alexis-cvetkov/events{/privacy}","received_events_url":"https://api.github.com/users/alexis-cvetkov/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-02-27T13:49:41Z","state_reason":null,"performed_via_github_app":null}]