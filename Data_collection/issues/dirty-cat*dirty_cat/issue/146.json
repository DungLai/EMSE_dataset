{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/146","repository_url":"https://api.github.com/repos/dirty-cat/dirty_cat","labels_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/146/labels{/name}","comments_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/146/comments","events_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/146/events","html_url":"https://github.com/dirty-cat/dirty_cat/issues/146","id":724627723,"node_id":"MDU6SXNzdWU3MjQ2Mjc3MjM=","number":146,"title":"Apply minhash_encoder to more than 1024 categories returns -1","user":{"login":"jp-varela","id":25550793,"node_id":"MDQ6VXNlcjI1NTUwNzkz","avatar_url":"https://avatars.githubusercontent.com/u/25550793?v=4","gravatar_id":"","url":"https://api.github.com/users/jp-varela","html_url":"https://github.com/jp-varela","followers_url":"https://api.github.com/users/jp-varela/followers","following_url":"https://api.github.com/users/jp-varela/following{/other_user}","gists_url":"https://api.github.com/users/jp-varela/gists{/gist_id}","starred_url":"https://api.github.com/users/jp-varela/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jp-varela/subscriptions","organizations_url":"https://api.github.com/users/jp-varela/orgs","repos_url":"https://api.github.com/users/jp-varela/repos","events_url":"https://api.github.com/users/jp-varela/events{/privacy}","received_events_url":"https://api.github.com/users/jp-varela/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2020-10-19T13:49:13Z","updated_at":"2020-11-19T13:41:21Z","closed_at":"2020-11-19T13:41:21Z","author_association":"NONE","active_lock_reason":null,"body":"Hy all,\r\nI am trying to apply minhash_encoder to a somewhat large dataset of strings (~200k distinct).\r\nI was testing my code with 10 strings, and it was running fine.\r\nBut when I tested using all dataset, most of the strings were represented as all '-1' vectors.\r\nI took a look at the source code and find this line inside 'minhash_encoder.py', that maybe is causing the problem:\r\n`self.hash_dict = LRUDict(capacity=2**10)`\r\nNot sure why this is used, but I checked with 1025 strings, and only the first one returns -1.\r\nThis encoder should work with a lot more variables, right?\r\n\r\nCode to replicate:\r\n```\r\nfrom dirty_cat import MinHashEncoder\r\nimport random\r\nimport string\r\n\r\ndef get_random_string(length):\r\n    letters = string.ascii_lowercase\r\n    result_str = ''.join(random.choice(letters) for i in range(length))\r\n    return result_str\r\n\r\n# 1024 categories -> all ok\r\nraw_data = [get_random_string(10) for x in range(1024)]\r\nhash_encoder = MinHashEncoder(n_components=10)\r\ntransformed_values = hash_encoder.fit_transform(raw_data)\r\nprint(transformed_values)\r\n\r\n# 1025 categories -> first represented as -1's\r\nraw_data = [get_random_string(10) for x in range(1025)]\r\nhash_encoder = MinHashEncoder(n_components=10)\r\ntransformed_values = hash_encoder.fit_transform(raw_data)\r\nprint(transformed_values)\r\n```","closed_by":{"login":"GaelVaroquaux","id":208217,"node_id":"MDQ6VXNlcjIwODIxNw==","avatar_url":"https://avatars.githubusercontent.com/u/208217?v=4","gravatar_id":"","url":"https://api.github.com/users/GaelVaroquaux","html_url":"https://github.com/GaelVaroquaux","followers_url":"https://api.github.com/users/GaelVaroquaux/followers","following_url":"https://api.github.com/users/GaelVaroquaux/following{/other_user}","gists_url":"https://api.github.com/users/GaelVaroquaux/gists{/gist_id}","starred_url":"https://api.github.com/users/GaelVaroquaux/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GaelVaroquaux/subscriptions","organizations_url":"https://api.github.com/users/GaelVaroquaux/orgs","repos_url":"https://api.github.com/users/GaelVaroquaux/repos","events_url":"https://api.github.com/users/GaelVaroquaux/events{/privacy}","received_events_url":"https://api.github.com/users/GaelVaroquaux/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/146/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dirty-cat/dirty_cat/issues/146/timeline","performed_via_github_app":null,"state_reason":"completed"}