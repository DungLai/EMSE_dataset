{"url":"https://api.github.com/repos/plasticityai/magnitude/issues/90","repository_url":"https://api.github.com/repos/plasticityai/magnitude","labels_url":"https://api.github.com/repos/plasticityai/magnitude/issues/90/labels{/name}","comments_url":"https://api.github.com/repos/plasticityai/magnitude/issues/90/comments","events_url":"https://api.github.com/repos/plasticityai/magnitude/issues/90/events","html_url":"https://github.com/plasticityai/magnitude/issues/90","id":1145938811,"node_id":"I_kwDOB1B9KM5ETaN7","number":90,"title":"Quering taking lot of time (18 sec to 3 min) intermittently","user":{"login":"shubhamjoshi2130","id":6982640,"node_id":"MDQ6VXNlcjY5ODI2NDA=","avatar_url":"https://avatars.githubusercontent.com/u/6982640?v=4","gravatar_id":"","url":"https://api.github.com/users/shubhamjoshi2130","html_url":"https://github.com/shubhamjoshi2130","followers_url":"https://api.github.com/users/shubhamjoshi2130/followers","following_url":"https://api.github.com/users/shubhamjoshi2130/following{/other_user}","gists_url":"https://api.github.com/users/shubhamjoshi2130/gists{/gist_id}","starred_url":"https://api.github.com/users/shubhamjoshi2130/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shubhamjoshi2130/subscriptions","organizations_url":"https://api.github.com/users/shubhamjoshi2130/orgs","repos_url":"https://api.github.com/users/shubhamjoshi2130/repos","events_url":"https://api.github.com/users/shubhamjoshi2130/events{/privacy}","received_events_url":"https://api.github.com/users/shubhamjoshi2130/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-02-21T15:24:12Z","updated_at":"2022-02-21T18:20:21Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Quering taking lot of time (18 sec to 3 min) intermittently\r\n\r\nI am using pymagnitude in one of my project to load and use GoogleNews-vectors-negative300.bin. \r\n\r\nI have converted GoogleNews-vectors-negative300.bin ----> to a .magnitude file and loading the .magnitude file using Magnitude(). I use pymagnitude to generate embedding of  words and then train a ANN model on those embedding.\r\n\r\nOn my local (with below mentioned details), i face no issue and\r\n\r\nEnvironments:-\r\n\r\n(local):-\r\nMac, 32 GB RAM,docker with centos ---- very fast  less than fraction of a second\r\n\r\n(Testing Environment):-\r\nCentOs 16 GB Ram --- intermittent slowness, taking 18sec to 3 min for querying some words and the process timeouts.\r\n\r\n** I am using a mount , to keep my mmap files. And assured that it is not getting wiped out.\r\n\r\nHere are the finings of a few words on Testing Environment and on local :-\r\n\r\nWord, Time on Testing Environment\r\nliï¿½ï¿½n , 0.82 min\r\nphï¿½ï¿½ï¿½m, 0.4 min\r\nal,1.3\r\nTime on local of above keys is very less , even less than a second.\r\n\r\nOn further investigation and profiling execution time we observed that more time is being taken in case an OOV token if found, and **_db_query_similar_keys_vector** function is invoked.\r\n\r\n\r\nSample Queries which are taking more time:-\r\n\r\nSELECT\r\n    magnitude.*\r\nFROM\r\n    magnitude_subword,\r\n    magnitude\r\nWHERE\r\n    char_ngrams MATCH \"\\uf000al\" OR \"al\" OR \"l\" OR \"\\uf000\"\r\n    AND magnitude.rowid = magnitude_subword.rowid\r\nORDER BY\r\n    (\r\n        (\r\n            LENGTH(offsets(magnitude_subword)) - LENGTH(\r\n                REPLACE(offsets(magnitude_subword), ' ', '')\r\n            )\r\n        ) + 1\r\n    ) DESC,\r\n    magnitude.key LIKE 'a%'\r\n    AND LENGTH(magnitude.key) <= 4 DESC,\r\n    magnitude.key LIKE '%';\r\n\r\n-- Took 3.8 min to execute\r\n\r\n\r\n\r\n\r\n   SELECT\r\n    magnitude.*\r\nFROM\r\n    magnitude_subword,\r\n    magnitude\r\nWHERE\r\n    char_ngrams MATCH \"\\uf000ch\" OR \"ch\" OR \"h\" OR \"n\" OR \"ng\" OR \"ng\\uf000\"\r\n    AND magnitude.rowid = magnitude_subword.rowid\r\nORDER BY\r\n    (\r\n        (\r\n            LENGTH(offsets(magnitude_subword)) - LENGTH(\r\n                REPLACE(offsets(magnitude_subword), ' ', '')\r\n            )\r\n        ) + 1\r\n    ) DESC,\r\n    magnitude.key LIKE 'a%'\r\n    AND LENGTH(magnitude.key) <= 4 DESC,\r\n    magnitude.key LIKE '%';\r\n-- Took 2 min to execute","closed_by":null,"reactions":{"url":"https://api.github.com/repos/plasticityai/magnitude/issues/90/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/plasticityai/magnitude/issues/90/timeline","performed_via_github_app":null,"state_reason":null}