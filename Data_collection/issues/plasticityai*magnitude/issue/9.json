{"url":"https://api.github.com/repos/plasticityai/magnitude/issues/9","repository_url":"https://api.github.com/repos/plasticityai/magnitude","labels_url":"https://api.github.com/repos/plasticityai/magnitude/issues/9/labels{/name}","comments_url":"https://api.github.com/repos/plasticityai/magnitude/issues/9/comments","events_url":"https://api.github.com/repos/plasticityai/magnitude/issues/9/events","html_url":"https://github.com/plasticityai/magnitude/issues/9","id":309649565,"node_id":"MDU6SXNzdWUzMDk2NDk1NjU=","number":9,"title":"converting .vec with annoy causes an infinite loop","user":{"login":"johnfarina","id":20345189,"node_id":"MDQ6VXNlcjIwMzQ1MTg5","avatar_url":"https://avatars.githubusercontent.com/u/20345189?v=4","gravatar_id":"","url":"https://api.github.com/users/johnfarina","html_url":"https://github.com/johnfarina","followers_url":"https://api.github.com/users/johnfarina/followers","following_url":"https://api.github.com/users/johnfarina/following{/other_user}","gists_url":"https://api.github.com/users/johnfarina/gists{/gist_id}","starred_url":"https://api.github.com/users/johnfarina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johnfarina/subscriptions","organizations_url":"https://api.github.com/users/johnfarina/orgs","repos_url":"https://api.github.com/users/johnfarina/repos","events_url":"https://api.github.com/users/johnfarina/events{/privacy}","received_events_url":"https://api.github.com/users/johnfarina/received_events","type":"User","site_admin":false},"labels":[{"id":846895359,"node_id":"MDU6TGFiZWw4NDY4OTUzNTk=","url":"https://api.github.com/repos/plasticityai/magnitude/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":864668876,"node_id":"MDU6TGFiZWw4NjQ2Njg4NzY=","url":"https://api.github.com/repos/plasticityai/magnitude/labels/python3","name":"python3","color":"d3527b","default":false,"description":""},{"id":883338840,"node_id":"MDU6TGFiZWw4ODMzMzg4NDA=","url":"https://api.github.com/repos/plasticityai/magnitude/labels/converter","name":"converter","color":"eda6bb","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"AjayP13","id":5404177,"node_id":"MDQ6VXNlcjU0MDQxNzc=","avatar_url":"https://avatars.githubusercontent.com/u/5404177?v=4","gravatar_id":"","url":"https://api.github.com/users/AjayP13","html_url":"https://github.com/AjayP13","followers_url":"https://api.github.com/users/AjayP13/followers","following_url":"https://api.github.com/users/AjayP13/following{/other_user}","gists_url":"https://api.github.com/users/AjayP13/gists{/gist_id}","starred_url":"https://api.github.com/users/AjayP13/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AjayP13/subscriptions","organizations_url":"https://api.github.com/users/AjayP13/orgs","repos_url":"https://api.github.com/users/AjayP13/repos","events_url":"https://api.github.com/users/AjayP13/events{/privacy}","received_events_url":"https://api.github.com/users/AjayP13/received_events","type":"User","site_admin":false},"assignees":[{"login":"AjayP13","id":5404177,"node_id":"MDQ6VXNlcjU0MDQxNzc=","avatar_url":"https://avatars.githubusercontent.com/u/5404177?v=4","gravatar_id":"","url":"https://api.github.com/users/AjayP13","html_url":"https://github.com/AjayP13","followers_url":"https://api.github.com/users/AjayP13/followers","following_url":"https://api.github.com/users/AjayP13/following{/other_user}","gists_url":"https://api.github.com/users/AjayP13/gists{/gist_id}","starred_url":"https://api.github.com/users/AjayP13/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AjayP13/subscriptions","organizations_url":"https://api.github.com/users/AjayP13/orgs","repos_url":"https://api.github.com/users/AjayP13/repos","events_url":"https://api.github.com/users/AjayP13/events{/privacy}","received_events_url":"https://api.github.com/users/AjayP13/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2018-03-29T07:36:25Z","updated_at":"2018-03-29T17:18:32Z","closed_at":"2018-03-29T17:18:32Z","author_association":"NONE","active_lock_reason":null,"body":"Trying to convert a .vec file to .magnitude along with an annoy approximate index falls into an infinte loop whereby it continually prints `100.0%`.\r\n\r\nUsing the repo's `test/models/fasttext.vec` as a minimal example (though the same behavior occurs with real .vec files):\r\n\r\n```bash\r\n$ python -m pymagnitude.converter -i fasttext.vec -o out.magnitude -a  \r\n/usr/local/Cellar/python/3.6.4_3/Frameworks/Python.framework/Versions/3.6/lib/python3.6/runpy.py:125: RuntimeWarning: 'pymagnitude.converter' found in sys.modules after import of package 'pymagnitude', but prior to execution of 'pymagnitude.converter'; this may result in unpredictable behaviour\r\n  warn(RuntimeWarning(msg))\r\nLoading vectors... (this may take some time)\r\nFound 5 key(s)\r\nEach vector has 2 dimension(s)\r\nCreating magnitude format...\r\nWriting vectors... (this may take some time)\r\n0% completed\r\n20% completed\r\n40% completed\r\n60% completed\r\n80% completed\r\nCommitting written vectors... (this may take some time)\r\nEntropy of dimension 0 is 2.321928\r\nEntropy of dimension 1 is 2.321928\r\nCreating search index... (this may take some time)\r\nCreating spatial search index for dimension 0 (it has high entropy)... (this may take some time)\r\nCreating approximate nearest neighbors index... (this may take some time)\r\nDumping approximate nearest neighbors index... (this may take some time)\r\nCompressing approximate nearest neighbors index... (this may take some time)\r\n100.0%\r\n100.0%\r\n100.0%           <-- This line prints forever\r\n```\r\n\r\nWhich suggests that something is amiss in the following loop starting at line 392 of `converter.py`:\r\n\r\n```python\r\nfor i, chunk in enumerate(iter(partial(ifh.read, chunk_size), '')):\r\n    if i == 0:\r\n        chunk = compressor.begin() + compressor.compress(chunk)\r\n    else:\r\n        chunk = compressor.compress(chunk)\r\n    eprint(str((ifh.tell() / float(full_size)) * 100.0) + \"%\")\r\n```\r\n\r\nLikely unrelated, but I'm not sure what's causing the RuntimeWarning either. It's thrown even without `-a`, and the conversion seems to work just fine in that case.","closed_by":{"login":"AjayP13","id":5404177,"node_id":"MDQ6VXNlcjU0MDQxNzc=","avatar_url":"https://avatars.githubusercontent.com/u/5404177?v=4","gravatar_id":"","url":"https://api.github.com/users/AjayP13","html_url":"https://github.com/AjayP13","followers_url":"https://api.github.com/users/AjayP13/followers","following_url":"https://api.github.com/users/AjayP13/following{/other_user}","gists_url":"https://api.github.com/users/AjayP13/gists{/gist_id}","starred_url":"https://api.github.com/users/AjayP13/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AjayP13/subscriptions","organizations_url":"https://api.github.com/users/AjayP13/orgs","repos_url":"https://api.github.com/users/AjayP13/repos","events_url":"https://api.github.com/users/AjayP13/events{/privacy}","received_events_url":"https://api.github.com/users/AjayP13/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/plasticityai/magnitude/issues/9/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/plasticityai/magnitude/issues/9/timeline","performed_via_github_app":null,"state_reason":"completed"}