[{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/495155675","html_url":"https://github.com/sniklaus/pytorch-pwc/issues/24#issuecomment-495155675","issue_url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/24","id":495155675,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NTE1NTY3NQ==","user":{"login":"v-iashin","id":14952597,"node_id":"MDQ6VXNlcjE0OTUyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/14952597?v=4","gravatar_id":"","url":"https://api.github.com/users/v-iashin","html_url":"https://github.com/v-iashin","followers_url":"https://api.github.com/users/v-iashin/followers","following_url":"https://api.github.com/users/v-iashin/following{/other_user}","gists_url":"https://api.github.com/users/v-iashin/gists{/gist_id}","starred_url":"https://api.github.com/users/v-iashin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/v-iashin/subscriptions","organizations_url":"https://api.github.com/users/v-iashin/orgs","repos_url":"https://api.github.com/users/v-iashin/repos","events_url":"https://api.github.com/users/v-iashin/events{/privacy}","received_events_url":"https://api.github.com/users/v-iashin/received_events","type":"User","site_admin":false},"created_at":"2019-05-23T10:07:36Z","updated_at":"2019-05-23T10:50:46Z","author_association":"NONE","body":"Did exactly this quite recently. \r\n1. Put \r\n```\r\n    Backward_tensorGrid = {}\r\n    Backward_tensorPartial = {}\r\n```\r\ninside of the `Backward` function. \r\n2. Repeat the things I described in #22.\r\n3. Wrap the code in `run.py` in a module so you can do forward call. The forward call should have a `device` argument.\r\n4. Write another module that does what you need with each chunk of your dataset you want to parallelize (tensor with indices in my case). Inside of this module you can access the gpu_id from the input dataset (by using for example `chunk_tensor.device`). You can use this gpu index as the `device` input argument for the module defined in 3rd step. \r\n5. Initialize this module, replicate, scatter your data, apply. \r\n\r\nMind the preprocessing.","reactions":{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/495155675/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"v-iashin","id":14952597,"node_id":"MDQ6VXNlcjE0OTUyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/14952597?v=4","gravatar_id":"","url":"https://api.github.com/users/v-iashin","html_url":"https://github.com/v-iashin","followers_url":"https://api.github.com/users/v-iashin/followers","following_url":"https://api.github.com/users/v-iashin/following{/other_user}","gists_url":"https://api.github.com/users/v-iashin/gists{/gist_id}","starred_url":"https://api.github.com/users/v-iashin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/v-iashin/subscriptions","organizations_url":"https://api.github.com/users/v-iashin/orgs","repos_url":"https://api.github.com/users/v-iashin/repos","events_url":"https://api.github.com/users/v-iashin/events{/privacy}","received_events_url":"https://api.github.com/users/v-iashin/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/495286555","html_url":"https://github.com/sniklaus/pytorch-pwc/issues/24#issuecomment-495286555","issue_url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/24","id":495286555,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NTI4NjU1NQ==","user":{"login":"sniklaus","id":1238034,"node_id":"MDQ6VXNlcjEyMzgwMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1238034?v=4","gravatar_id":"","url":"https://api.github.com/users/sniklaus","html_url":"https://github.com/sniklaus","followers_url":"https://api.github.com/users/sniklaus/followers","following_url":"https://api.github.com/users/sniklaus/following{/other_user}","gists_url":"https://api.github.com/users/sniklaus/gists{/gist_id}","starred_url":"https://api.github.com/users/sniklaus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sniklaus/subscriptions","organizations_url":"https://api.github.com/users/sniklaus/orgs","repos_url":"https://api.github.com/users/sniklaus/repos","events_url":"https://api.github.com/users/sniklaus/events{/privacy}","received_events_url":"https://api.github.com/users/sniklaus/received_events","type":"User","site_admin":false},"created_at":"2019-05-23T16:16:54Z","updated_at":"2019-05-23T16:16:54Z","author_association":"OWNER","body":"Thank you for the instructions @v-iashin! Would you mind sharing the error message, @ZacharyGong?","reactions":{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/495286555/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sniklaus","id":1238034,"node_id":"MDQ6VXNlcjEyMzgwMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1238034?v=4","gravatar_id":"","url":"https://api.github.com/users/sniklaus","html_url":"https://github.com/sniklaus","followers_url":"https://api.github.com/users/sniklaus/followers","following_url":"https://api.github.com/users/sniklaus/following{/other_user}","gists_url":"https://api.github.com/users/sniklaus/gists{/gist_id}","starred_url":"https://api.github.com/users/sniklaus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sniklaus/subscriptions","organizations_url":"https://api.github.com/users/sniklaus/orgs","repos_url":"https://api.github.com/users/sniklaus/repos","events_url":"https://api.github.com/users/sniklaus/events{/privacy}","received_events_url":"https://api.github.com/users/sniklaus/received_events","type":"User","site_admin":false}},{"id":2363027253,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjM2MzAyNzI1Mw==","url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/events/2363027253","actor":{"login":"v-iashin","id":14952597,"node_id":"MDQ6VXNlcjE0OTUyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/14952597?v=4","gravatar_id":"","url":"https://api.github.com/users/v-iashin","html_url":"https://github.com/v-iashin","followers_url":"https://api.github.com/users/v-iashin/followers","following_url":"https://api.github.com/users/v-iashin/following{/other_user}","gists_url":"https://api.github.com/users/v-iashin/gists{/gist_id}","starred_url":"https://api.github.com/users/v-iashin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/v-iashin/subscriptions","organizations_url":"https://api.github.com/users/v-iashin/orgs","repos_url":"https://api.github.com/users/v-iashin/repos","events_url":"https://api.github.com/users/v-iashin/events{/privacy}","received_events_url":"https://api.github.com/users/v-iashin/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-05-23T16:16:54Z","performed_via_github_app":null},{"id":2363027255,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzNjMwMjcyNTU=","url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/events/2363027255","actor":{"login":"v-iashin","id":14952597,"node_id":"MDQ6VXNlcjE0OTUyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/14952597?v=4","gravatar_id":"","url":"https://api.github.com/users/v-iashin","html_url":"https://github.com/v-iashin","followers_url":"https://api.github.com/users/v-iashin/followers","following_url":"https://api.github.com/users/v-iashin/following{/other_user}","gists_url":"https://api.github.com/users/v-iashin/gists{/gist_id}","starred_url":"https://api.github.com/users/v-iashin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/v-iashin/subscriptions","organizations_url":"https://api.github.com/users/v-iashin/orgs","repos_url":"https://api.github.com/users/v-iashin/repos","events_url":"https://api.github.com/users/v-iashin/events{/privacy}","received_events_url":"https://api.github.com/users/v-iashin/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-05-23T16:16:54Z","performed_via_github_app":null},{"id":2363027258,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjM2MzAyNzI1OA==","url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/events/2363027258","actor":{"login":"ZacharyGong","id":37173782,"node_id":"MDQ6VXNlcjM3MTczNzgy","avatar_url":"https://avatars.githubusercontent.com/u/37173782?v=4","gravatar_id":"","url":"https://api.github.com/users/ZacharyGong","html_url":"https://github.com/ZacharyGong","followers_url":"https://api.github.com/users/ZacharyGong/followers","following_url":"https://api.github.com/users/ZacharyGong/following{/other_user}","gists_url":"https://api.github.com/users/ZacharyGong/gists{/gist_id}","starred_url":"https://api.github.com/users/ZacharyGong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZacharyGong/subscriptions","organizations_url":"https://api.github.com/users/ZacharyGong/orgs","repos_url":"https://api.github.com/users/ZacharyGong/repos","events_url":"https://api.github.com/users/ZacharyGong/events{/privacy}","received_events_url":"https://api.github.com/users/ZacharyGong/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-05-23T16:16:54Z","performed_via_github_app":null},{"id":2363027259,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzNjMwMjcyNTk=","url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/events/2363027259","actor":{"login":"ZacharyGong","id":37173782,"node_id":"MDQ6VXNlcjM3MTczNzgy","avatar_url":"https://avatars.githubusercontent.com/u/37173782?v=4","gravatar_id":"","url":"https://api.github.com/users/ZacharyGong","html_url":"https://github.com/ZacharyGong","followers_url":"https://api.github.com/users/ZacharyGong/followers","following_url":"https://api.github.com/users/ZacharyGong/following{/other_user}","gists_url":"https://api.github.com/users/ZacharyGong/gists{/gist_id}","starred_url":"https://api.github.com/users/ZacharyGong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZacharyGong/subscriptions","organizations_url":"https://api.github.com/users/ZacharyGong/orgs","repos_url":"https://api.github.com/users/ZacharyGong/repos","events_url":"https://api.github.com/users/ZacharyGong/events{/privacy}","received_events_url":"https://api.github.com/users/ZacharyGong/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-05-23T16:16:54Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/495525236","html_url":"https://github.com/sniklaus/pytorch-pwc/issues/24#issuecomment-495525236","issue_url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/24","id":495525236,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NTUyNTIzNg==","user":{"login":"ZacharyGong","id":37173782,"node_id":"MDQ6VXNlcjM3MTczNzgy","avatar_url":"https://avatars.githubusercontent.com/u/37173782?v=4","gravatar_id":"","url":"https://api.github.com/users/ZacharyGong","html_url":"https://github.com/ZacharyGong","followers_url":"https://api.github.com/users/ZacharyGong/followers","following_url":"https://api.github.com/users/ZacharyGong/following{/other_user}","gists_url":"https://api.github.com/users/ZacharyGong/gists{/gist_id}","starred_url":"https://api.github.com/users/ZacharyGong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZacharyGong/subscriptions","organizations_url":"https://api.github.com/users/ZacharyGong/orgs","repos_url":"https://api.github.com/users/ZacharyGong/repos","events_url":"https://api.github.com/users/ZacharyGong/events{/privacy}","received_events_url":"https://api.github.com/users/ZacharyGong/received_events","type":"User","site_admin":false},"created_at":"2019-05-24T08:41:12Z","updated_at":"2019-05-24T09:41:19Z","author_association":"NONE","body":"Hi @sniklaus ,\r\n\r\nI tried the step No.1 in v-iashin's reply. For my case, the code works. I check the flow generated in the multi-GPUs environment, and the flow seems correct. If you can check if this will cause some mistakes, I will be very grateful. \r\n\r\nI leave my original snippet as follow for future review:\r\n\r\n\r\nI wrote a small code snippet to reproduce the problem that I met\r\n```\r\nimport torch\r\nimport torch.nn as nn\r\nfrom flow_generation_model.model import Network as flow_generation_net\r\nimport math\r\n\r\ndef estimate(moduleNetwork,tensorFirst,tensorSecond):\r\n    intWidth = tensorFirst.size(-1)\r\n    intHeight = tensorFirst.size(-2)\r\n\r\n    tensorPreprocessedFirst = tensorFirst\r\n    tensorPreprocessedSecond = tensorSecond\r\n\r\n    intPreprocessedWidth = int(math.floor(math.ceil(intWidth / 64.0) * 64.0))\r\n    intPreprocessedHeight = int(math.floor(math.ceil(intHeight / 64.0) * 64.0))\r\n\r\n    tensorPreprocessedFirst = torch.nn.functional.interpolate(input=tensorPreprocessedFirst, size=(intPreprocessedHeight, intPreprocessedWidth), mode='bilinear', align_corners=False)\r\n    tensorPreprocessedSecond = torch.nn.functional.interpolate(input=tensorPreprocessedSecond, size=(intPreprocessedHeight, intPreprocessedWidth), mode='bilinear', align_corners=False)\r\n\r\n    tensorFlow = 20.0 * torch.nn.functional.interpolate(input=moduleNetwork(tensorPreprocessedFirst, tensorPreprocessedSecond), size=(intHeight, intWidth), mode='bilinear', align_corners=False)\r\n\r\n    tensorFlow[:, 0, :, :] *= float(intWidth) / float(intPreprocessedWidth)\r\n    tensorFlow[:, 1, :, :] *= float(intHeight) / float(intPreprocessedHeight)\r\n    return tensorFlow\r\n\r\nclass Network(nn.Module):\r\n\tdef __init__(self):\r\n\t\tsuper(Network, self).__init__()\r\n\t\tself.flow_generation_net = flow_generation_net()\r\n\r\n\tdef forward(self, x1, x2):\r\n\t\tflow = estimate(self.flow_generation_net, x1, x2)\r\n\t\treturn flow\r\n\r\npwc_net = Network().cuda()\r\ngpus = [0,1]\r\npwc_net = nn.DataParallel(pwc_net, device_ids=gpus)\r\nMSE = nn.MSELoss()\r\n\r\nx1 = torch.rand([4,3,128,128]).cuda()\r\nx2 = torch.rand([4,3,128,128]).cuda()\r\nflow_gt = torch.rand([4,2,128,128]).cuda()\r\n\r\noutput = pwc_net(x1, x2)\r\n#print(output.shape)\r\nloss = MSE(output, flow_gt)\r\nloss.backward()\r\n```\r\n\r\nwhere the `flow_generate_net` is your network in the `run.py`, by running this code, I got the following error:\r\n```\r\nTraceback (most recent call last):\r\n  File \"snippet.py\", line 43, in <module>\r\n    output = pwc_net(x1, x2)\r\n  File \"/opt/conda/envs/pytorch-py3.6/lib/python3.6/site-packages/torch/nn/modules/module.py\", line 477, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/opt/conda/envs/pytorch-py3.6/lib/python3.6/site-packages/torch/nn/parallel/data_parallel.py\", line 123, in forward\r\n    outputs = self.parallel_apply(replicas, inputs, kwargs)\r\n  File \"/opt/conda/envs/pytorch-py3.6/lib/python3.6/site-packages/torch/nn/parallel/data_parallel.py\", line 133, in parallel_apply\r\n    return parallel_apply(replicas, inputs, kwargs, self.device_ids[:len(replicas)])\r\n  File \"/opt/conda/envs/pytorch-py3.6/lib/python3.6/site-packages/torch/nn/parallel/parallel_apply.py\", line 77, in parallel_apply\r\n    raise output\r\n  File \"/opt/conda/envs/pytorch-py3.6/lib/python3.6/site-packages/torch/nn/parallel/parallel_apply.py\", line 53, in _worker\r\n    output = module(*input, **kwargs)\r\n  File \"/opt/conda/envs/pytorch-py3.6/lib/python3.6/site-packages/torch/nn/modules/module.py\", line 477, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"snippet.py\", line 31, in forward\r\n    flow = estimate(self.flow_generation_net, x1, x2)\r\n  File \"snippet.py\", line 19, in estimate\r\n    tensorFlow = 20.0 * torch.nn.functional.interpolate(input=moduleNetwork(tensorPreprocessedFirst, tensorPreprocessedSecond), size=(intHeight, intWidth), mode='bilinear', align_corners=False)\r\n  File \"/opt/conda/envs/pytorch-py3.6/lib/python3.6/site-packages/torch/nn/modules/module.py\", line 477, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/mnt/video/flow_generation_test/flow_generation_model/model.py\", line 242, in forward\r\n    objectEstimate = self.moduleFiv(tensorFirst[-2], tensorSecond[-2], objectEstimate)\r\n  File \"/opt/conda/envs/pytorch-py3.6/lib/python3.6/site-packages/torch/nn/modules/module.py\", line 477, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/mnt/video/flow_generation_test/flow_generation_model/model.py\", line 177, in forward\r\n    tensorVolume = torch.nn.functional.leaky_relu(input=correlation.FunctionCorrelation(tensorFirst=tensorFirst, tensorSecond=Backward(tensorInput=tensorSecond, tensorFlow=tensorFlow * self.dblBackward)), negative_slope=0.1, inplace=False)\r\n  File \"/mnt/video/flow_generation_test/flow_generation_model/model.py\", line 36, in Backward\r\n    tensorOutput = torch.nn.functional.grid_sample(input=tensorInput, grid=(Backward_tensorGrid[str(tensorFlow.size())] + tensorFlow).permute(0, 2, 3, 1), mode='bilinear', padding_mode='zeros')\r\nRuntimeError: arguments are located on different GPUs at /pytorch/aten/src/THC/generated/../generic/THCTensorMathPointwise.cu:234\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/495525236/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ZacharyGong","id":37173782,"node_id":"MDQ6VXNlcjM3MTczNzgy","avatar_url":"https://avatars.githubusercontent.com/u/37173782?v=4","gravatar_id":"","url":"https://api.github.com/users/ZacharyGong","html_url":"https://github.com/ZacharyGong","followers_url":"https://api.github.com/users/ZacharyGong/followers","following_url":"https://api.github.com/users/ZacharyGong/following{/other_user}","gists_url":"https://api.github.com/users/ZacharyGong/gists{/gist_id}","starred_url":"https://api.github.com/users/ZacharyGong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZacharyGong/subscriptions","organizations_url":"https://api.github.com/users/ZacharyGong/orgs","repos_url":"https://api.github.com/users/ZacharyGong/repos","events_url":"https://api.github.com/users/ZacharyGong/events{/privacy}","received_events_url":"https://api.github.com/users/ZacharyGong/received_events","type":"User","site_admin":false}},{"id":2364804194,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjM2NDgwNDE5NA==","url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/events/2364804194","actor":{"login":"sniklaus","id":1238034,"node_id":"MDQ6VXNlcjEyMzgwMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1238034?v=4","gravatar_id":"","url":"https://api.github.com/users/sniklaus","html_url":"https://github.com/sniklaus","followers_url":"https://api.github.com/users/sniklaus/followers","following_url":"https://api.github.com/users/sniklaus/following{/other_user}","gists_url":"https://api.github.com/users/sniklaus/gists{/gist_id}","starred_url":"https://api.github.com/users/sniklaus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sniklaus/subscriptions","organizations_url":"https://api.github.com/users/sniklaus/orgs","repos_url":"https://api.github.com/users/sniklaus/repos","events_url":"https://api.github.com/users/sniklaus/events{/privacy}","received_events_url":"https://api.github.com/users/sniklaus/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-05-24T08:41:13Z","performed_via_github_app":null},{"id":2364804196,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzNjQ4MDQxOTY=","url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/events/2364804196","actor":{"login":"sniklaus","id":1238034,"node_id":"MDQ6VXNlcjEyMzgwMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1238034?v=4","gravatar_id":"","url":"https://api.github.com/users/sniklaus","html_url":"https://github.com/sniklaus","followers_url":"https://api.github.com/users/sniklaus/followers","following_url":"https://api.github.com/users/sniklaus/following{/other_user}","gists_url":"https://api.github.com/users/sniklaus/gists{/gist_id}","starred_url":"https://api.github.com/users/sniklaus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sniklaus/subscriptions","organizations_url":"https://api.github.com/users/sniklaus/orgs","repos_url":"https://api.github.com/users/sniklaus/repos","events_url":"https://api.github.com/users/sniklaus/events{/privacy}","received_events_url":"https://api.github.com/users/sniklaus/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-05-24T08:41:13Z","performed_via_github_app":null},{"id":2364804200,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjM2NDgwNDIwMA==","url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/events/2364804200","actor":{"login":"v-iashin","id":14952597,"node_id":"MDQ6VXNlcjE0OTUyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/14952597?v=4","gravatar_id":"","url":"https://api.github.com/users/v-iashin","html_url":"https://github.com/v-iashin","followers_url":"https://api.github.com/users/v-iashin/followers","following_url":"https://api.github.com/users/v-iashin/following{/other_user}","gists_url":"https://api.github.com/users/v-iashin/gists{/gist_id}","starred_url":"https://api.github.com/users/v-iashin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/v-iashin/subscriptions","organizations_url":"https://api.github.com/users/v-iashin/orgs","repos_url":"https://api.github.com/users/v-iashin/repos","events_url":"https://api.github.com/users/v-iashin/events{/privacy}","received_events_url":"https://api.github.com/users/v-iashin/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-05-24T08:41:13Z","performed_via_github_app":null},{"id":2364804201,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzNjQ4MDQyMDE=","url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/events/2364804201","actor":{"login":"v-iashin","id":14952597,"node_id":"MDQ6VXNlcjE0OTUyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/14952597?v=4","gravatar_id":"","url":"https://api.github.com/users/v-iashin","html_url":"https://github.com/v-iashin","followers_url":"https://api.github.com/users/v-iashin/followers","following_url":"https://api.github.com/users/v-iashin/following{/other_user}","gists_url":"https://api.github.com/users/v-iashin/gists{/gist_id}","starred_url":"https://api.github.com/users/v-iashin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/v-iashin/subscriptions","organizations_url":"https://api.github.com/users/v-iashin/orgs","repos_url":"https://api.github.com/users/v-iashin/repos","events_url":"https://api.github.com/users/v-iashin/events{/privacy}","received_events_url":"https://api.github.com/users/v-iashin/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-05-24T08:41:13Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/495707057","html_url":"https://github.com/sniklaus/pytorch-pwc/issues/24#issuecomment-495707057","issue_url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/24","id":495707057,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NTcwNzA1Nw==","user":{"login":"v-iashin","id":14952597,"node_id":"MDQ6VXNlcjE0OTUyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/14952597?v=4","gravatar_id":"","url":"https://api.github.com/users/v-iashin","html_url":"https://github.com/v-iashin","followers_url":"https://api.github.com/users/v-iashin/followers","following_url":"https://api.github.com/users/v-iashin/following{/other_user}","gists_url":"https://api.github.com/users/v-iashin/gists{/gist_id}","starred_url":"https://api.github.com/users/v-iashin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/v-iashin/subscriptions","organizations_url":"https://api.github.com/users/v-iashin/orgs","repos_url":"https://api.github.com/users/v-iashin/repos","events_url":"https://api.github.com/users/v-iashin/events{/privacy}","received_events_url":"https://api.github.com/users/v-iashin/received_events","type":"User","site_admin":false},"created_at":"2019-05-24T16:50:22Z","updated_at":"2019-05-24T16:50:22Z","author_association":"NONE","body":"Hopefully, it can save some time for you.\r\n\r\nThe problem is that you import this `run.py` module and these two dicts are created once the module is imported. \r\n\r\nNow imagine the following scenario. The first GPU adds a tensor to `Backward_tensorGrid` dict and the second GPU tries to access the dict with the key (`Backward_tensorGrid[str(tensorFlow.size())]`) which maps to the tensor that is on the first GPU. Hence the error `arguments are located on different GPUs`.\r\n\r\nTo verify this try to print the content of these dicts inside of the `Backward`.","reactions":{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/495707057/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"v-iashin","id":14952597,"node_id":"MDQ6VXNlcjE0OTUyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/14952597?v=4","gravatar_id":"","url":"https://api.github.com/users/v-iashin","html_url":"https://github.com/v-iashin","followers_url":"https://api.github.com/users/v-iashin/followers","following_url":"https://api.github.com/users/v-iashin/following{/other_user}","gists_url":"https://api.github.com/users/v-iashin/gists{/gist_id}","starred_url":"https://api.github.com/users/v-iashin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/v-iashin/subscriptions","organizations_url":"https://api.github.com/users/v-iashin/orgs","repos_url":"https://api.github.com/users/v-iashin/repos","events_url":"https://api.github.com/users/v-iashin/events{/privacy}","received_events_url":"https://api.github.com/users/v-iashin/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/495708464","html_url":"https://github.com/sniklaus/pytorch-pwc/issues/24#issuecomment-495708464","issue_url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/24","id":495708464,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NTcwODQ2NA==","user":{"login":"v-iashin","id":14952597,"node_id":"MDQ6VXNlcjE0OTUyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/14952597?v=4","gravatar_id":"","url":"https://api.github.com/users/v-iashin","html_url":"https://github.com/v-iashin","followers_url":"https://api.github.com/users/v-iashin/followers","following_url":"https://api.github.com/users/v-iashin/following{/other_user}","gists_url":"https://api.github.com/users/v-iashin/gists{/gist_id}","starred_url":"https://api.github.com/users/v-iashin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/v-iashin/subscriptions","organizations_url":"https://api.github.com/users/v-iashin/orgs","repos_url":"https://api.github.com/users/v-iashin/repos","events_url":"https://api.github.com/users/v-iashin/events{/privacy}","received_events_url":"https://api.github.com/users/v-iashin/received_events","type":"User","site_admin":false},"created_at":"2019-05-24T16:54:15Z","updated_at":"2019-05-24T16:54:15Z","author_association":"NONE","body":"Now, I think that another solution would be to remove the lines that check whether the value with this key exists in a dict\r\nhttps://github.com/sniklaus/pytorch-pwc/blob/da45293e1e0c125858d56295a41124dea36bc471/run.py#L47\r\nand here\r\nhttps://github.com/sniklaus/pytorch-pwc/blob/da45293e1e0c125858d56295a41124dea36bc471/run.py#L54","reactions":{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/495708464/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"v-iashin","id":14952597,"node_id":"MDQ6VXNlcjE0OTUyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/14952597?v=4","gravatar_id":"","url":"https://api.github.com/users/v-iashin","html_url":"https://github.com/v-iashin","followers_url":"https://api.github.com/users/v-iashin/followers","following_url":"https://api.github.com/users/v-iashin/following{/other_user}","gists_url":"https://api.github.com/users/v-iashin/gists{/gist_id}","starred_url":"https://api.github.com/users/v-iashin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/v-iashin/subscriptions","organizations_url":"https://api.github.com/users/v-iashin/orgs","repos_url":"https://api.github.com/users/v-iashin/repos","events_url":"https://api.github.com/users/v-iashin/events{/privacy}","received_events_url":"https://api.github.com/users/v-iashin/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/495756802","html_url":"https://github.com/sniklaus/pytorch-pwc/issues/24#issuecomment-495756802","issue_url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/24","id":495756802,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NTc1NjgwMg==","user":{"login":"sniklaus","id":1238034,"node_id":"MDQ6VXNlcjEyMzgwMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1238034?v=4","gravatar_id":"","url":"https://api.github.com/users/sniklaus","html_url":"https://github.com/sniklaus","followers_url":"https://api.github.com/users/sniklaus/followers","following_url":"https://api.github.com/users/sniklaus/following{/other_user}","gists_url":"https://api.github.com/users/sniklaus/gists{/gist_id}","starred_url":"https://api.github.com/users/sniklaus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sniklaus/subscriptions","organizations_url":"https://api.github.com/users/sniklaus/orgs","repos_url":"https://api.github.com/users/sniklaus/repos","events_url":"https://api.github.com/users/sniklaus/events{/privacy}","received_events_url":"https://api.github.com/users/sniklaus/received_events","type":"User","site_admin":false},"created_at":"2019-05-24T19:04:43Z","updated_at":"2019-05-24T19:04:43Z","author_association":"OWNER","body":"Thank you for the code @ZacharyGong and thank you for sharing your thoughts with us @v-iashin!\r\n\r\nThe easiest workaround is probably to not use the dictionary as suggested by @v-iashin in his most recent post. That may have a negative impact on performance though that I am unable to predict. Another solution would be to have the tensors in the dict / cache be located on the CPU instead of the GPU, again with a negative effect on performance. The backwards-warping would then be as follows.\r\n\r\n```\r\ndef Backward(tensorInput, tensorFlow):\r\n\tif str(tensorFlow.size()) not in Backward_tensorGrid:\r\n\t\ttensorHorizontal = torch.linspace(-1.0, 1.0, tensorFlow.size(3)).view(1, 1, 1, tensorFlow.size(3)).expand(tensorFlow.size(0), -1, tensorFlow.size(2), -1)\r\n\t\ttensorVertical = torch.linspace(-1.0, 1.0, tensorFlow.size(2)).view(1, 1, tensorFlow.size(2), 1).expand(tensorFlow.size(0), -1, -1, tensorFlow.size(3))\r\n\r\n\t\tBackward_tensorGrid[str(tensorFlow.size())] = torch.cat([ tensorHorizontal, tensorVertical ], 1)\r\n\t# end\r\n\r\n\tif str(tensorFlow.size()) not in Backward_tensorPartial:\r\n\t\tBackward_tensorPartial[str(tensorFlow.size())] = torch.FloatTensor([ tensorFlow.size(0), 1, tensorFlow.size(2), tensorFlow.size(3) ]).fill_(1.0)\r\n\t# end\r\n\r\n\ttensorFlow = torch.cat([ tensorFlow[:, 0:1, :, :] / ((tensorInput.size(3) - 1.0) / 2.0), tensorFlow[:, 1:2, :, :] / ((tensorInput.size(2) - 1.0) / 2.0) ], 1)\r\n\ttensorInput = torch.cat([ tensorInput, Backward_tensorPartial[str(tensorFlow.size())] ].cuda(), 1)\r\n\r\n\ttensorOutput = torch.nn.functional.grid_sample(input=tensorInput, grid=(Backward_tensorGrid[str(tensorFlow.size())].cuda() + tensorFlow).permute(0, 2, 3, 1), mode='bilinear', padding_mode='zeros')\r\n\r\n\ttensorMask = tensorOutput[:, -1:, :, :]; tensorMask[tensorMask > 0.999] = 1.0; tensorMask[tensorMask < 1.0] = 0.0\r\n\r\n\treturn tensorOutput[:, :-1, :, :] * tensorMask\r\n# end\r\n```","reactions":{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/495756802/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sniklaus","id":1238034,"node_id":"MDQ6VXNlcjEyMzgwMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1238034?v=4","gravatar_id":"","url":"https://api.github.com/users/sniklaus","html_url":"https://github.com/sniklaus","followers_url":"https://api.github.com/users/sniklaus/followers","following_url":"https://api.github.com/users/sniklaus/following{/other_user}","gists_url":"https://api.github.com/users/sniklaus/gists{/gist_id}","starred_url":"https://api.github.com/users/sniklaus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sniklaus/subscriptions","organizations_url":"https://api.github.com/users/sniklaus/orgs","repos_url":"https://api.github.com/users/sniklaus/repos","events_url":"https://api.github.com/users/sniklaus/events{/privacy}","received_events_url":"https://api.github.com/users/sniklaus/received_events","type":"User","site_admin":false}},{"id":2366454961,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjM2NjQ1NDk2MQ==","url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/events/2366454961","actor":{"login":"v-iashin","id":14952597,"node_id":"MDQ6VXNlcjE0OTUyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/14952597?v=4","gravatar_id":"","url":"https://api.github.com/users/v-iashin","html_url":"https://github.com/v-iashin","followers_url":"https://api.github.com/users/v-iashin/followers","following_url":"https://api.github.com/users/v-iashin/following{/other_user}","gists_url":"https://api.github.com/users/v-iashin/gists{/gist_id}","starred_url":"https://api.github.com/users/v-iashin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/v-iashin/subscriptions","organizations_url":"https://api.github.com/users/v-iashin/orgs","repos_url":"https://api.github.com/users/v-iashin/repos","events_url":"https://api.github.com/users/v-iashin/events{/privacy}","received_events_url":"https://api.github.com/users/v-iashin/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-05-24T19:04:43Z","performed_via_github_app":null},{"id":2366454963,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzNjY0NTQ5NjM=","url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/events/2366454963","actor":{"login":"v-iashin","id":14952597,"node_id":"MDQ6VXNlcjE0OTUyNTk3","avatar_url":"https://avatars.githubusercontent.com/u/14952597?v=4","gravatar_id":"","url":"https://api.github.com/users/v-iashin","html_url":"https://github.com/v-iashin","followers_url":"https://api.github.com/users/v-iashin/followers","following_url":"https://api.github.com/users/v-iashin/following{/other_user}","gists_url":"https://api.github.com/users/v-iashin/gists{/gist_id}","starred_url":"https://api.github.com/users/v-iashin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/v-iashin/subscriptions","organizations_url":"https://api.github.com/users/v-iashin/orgs","repos_url":"https://api.github.com/users/v-iashin/repos","events_url":"https://api.github.com/users/v-iashin/events{/privacy}","received_events_url":"https://api.github.com/users/v-iashin/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-05-24T19:04:43Z","performed_via_github_app":null},{"id":2366454965,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjM2NjQ1NDk2NQ==","url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/events/2366454965","actor":{"login":"ZacharyGong","id":37173782,"node_id":"MDQ6VXNlcjM3MTczNzgy","avatar_url":"https://avatars.githubusercontent.com/u/37173782?v=4","gravatar_id":"","url":"https://api.github.com/users/ZacharyGong","html_url":"https://github.com/ZacharyGong","followers_url":"https://api.github.com/users/ZacharyGong/followers","following_url":"https://api.github.com/users/ZacharyGong/following{/other_user}","gists_url":"https://api.github.com/users/ZacharyGong/gists{/gist_id}","starred_url":"https://api.github.com/users/ZacharyGong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZacharyGong/subscriptions","organizations_url":"https://api.github.com/users/ZacharyGong/orgs","repos_url":"https://api.github.com/users/ZacharyGong/repos","events_url":"https://api.github.com/users/ZacharyGong/events{/privacy}","received_events_url":"https://api.github.com/users/ZacharyGong/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-05-24T19:04:43Z","performed_via_github_app":null},{"id":2366454967,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzNjY0NTQ5Njc=","url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/events/2366454967","actor":{"login":"ZacharyGong","id":37173782,"node_id":"MDQ6VXNlcjM3MTczNzgy","avatar_url":"https://avatars.githubusercontent.com/u/37173782?v=4","gravatar_id":"","url":"https://api.github.com/users/ZacharyGong","html_url":"https://github.com/ZacharyGong","followers_url":"https://api.github.com/users/ZacharyGong/followers","following_url":"https://api.github.com/users/ZacharyGong/following{/other_user}","gists_url":"https://api.github.com/users/ZacharyGong/gists{/gist_id}","starred_url":"https://api.github.com/users/ZacharyGong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZacharyGong/subscriptions","organizations_url":"https://api.github.com/users/ZacharyGong/orgs","repos_url":"https://api.github.com/users/ZacharyGong/repos","events_url":"https://api.github.com/users/ZacharyGong/events{/privacy}","received_events_url":"https://api.github.com/users/ZacharyGong/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-05-24T19:04:43Z","performed_via_github_app":null},{"id":2367457325,"node_id":"MDExOkNsb3NlZEV2ZW50MjM2NzQ1NzMyNQ==","url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/events/2367457325","actor":{"login":"sniklaus","id":1238034,"node_id":"MDQ6VXNlcjEyMzgwMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1238034?v=4","gravatar_id":"","url":"https://api.github.com/users/sniklaus","html_url":"https://github.com/sniklaus","followers_url":"https://api.github.com/users/sniklaus/followers","following_url":"https://api.github.com/users/sniklaus/following{/other_user}","gists_url":"https://api.github.com/users/sniklaus/gists{/gist_id}","starred_url":"https://api.github.com/users/sniklaus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sniklaus/subscriptions","organizations_url":"https://api.github.com/users/sniklaus/orgs","repos_url":"https://api.github.com/users/sniklaus/repos","events_url":"https://api.github.com/users/sniklaus/events{/privacy}","received_events_url":"https://api.github.com/users/sniklaus/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-05-25T18:15:21Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/496365021","html_url":"https://github.com/sniklaus/pytorch-pwc/issues/24#issuecomment-496365021","issue_url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/24","id":496365021,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NjM2NTAyMQ==","user":{"login":"ZacharyGong","id":37173782,"node_id":"MDQ6VXNlcjM3MTczNzgy","avatar_url":"https://avatars.githubusercontent.com/u/37173782?v=4","gravatar_id":"","url":"https://api.github.com/users/ZacharyGong","html_url":"https://github.com/ZacharyGong","followers_url":"https://api.github.com/users/ZacharyGong/followers","following_url":"https://api.github.com/users/ZacharyGong/following{/other_user}","gists_url":"https://api.github.com/users/ZacharyGong/gists{/gist_id}","starred_url":"https://api.github.com/users/ZacharyGong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZacharyGong/subscriptions","organizations_url":"https://api.github.com/users/ZacharyGong/orgs","repos_url":"https://api.github.com/users/ZacharyGong/repos","events_url":"https://api.github.com/users/ZacharyGong/events{/privacy}","received_events_url":"https://api.github.com/users/ZacharyGong/received_events","type":"User","site_admin":false},"created_at":"2019-05-28T04:57:27Z","updated_at":"2019-05-28T04:57:27Z","author_association":"NONE","body":"Thank you guys, both of you give out good solutions!","reactions":{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/496365021/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ZacharyGong","id":37173782,"node_id":"MDQ6VXNlcjM3MTczNzgy","avatar_url":"https://avatars.githubusercontent.com/u/37173782?v=4","gravatar_id":"","url":"https://api.github.com/users/ZacharyGong","html_url":"https://github.com/ZacharyGong","followers_url":"https://api.github.com/users/ZacharyGong/followers","following_url":"https://api.github.com/users/ZacharyGong/following{/other_user}","gists_url":"https://api.github.com/users/ZacharyGong/gists{/gist_id}","starred_url":"https://api.github.com/users/ZacharyGong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZacharyGong/subscriptions","organizations_url":"https://api.github.com/users/ZacharyGong/orgs","repos_url":"https://api.github.com/users/ZacharyGong/repos","events_url":"https://api.github.com/users/ZacharyGong/events{/privacy}","received_events_url":"https://api.github.com/users/ZacharyGong/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/540231555","html_url":"https://github.com/sniklaus/pytorch-pwc/issues/24#issuecomment-540231555","issue_url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/24","id":540231555,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MDIzMTU1NQ==","user":{"login":"TengdaHan","id":17740581,"node_id":"MDQ6VXNlcjE3NzQwNTgx","avatar_url":"https://avatars.githubusercontent.com/u/17740581?v=4","gravatar_id":"","url":"https://api.github.com/users/TengdaHan","html_url":"https://github.com/TengdaHan","followers_url":"https://api.github.com/users/TengdaHan/followers","following_url":"https://api.github.com/users/TengdaHan/following{/other_user}","gists_url":"https://api.github.com/users/TengdaHan/gists{/gist_id}","starred_url":"https://api.github.com/users/TengdaHan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TengdaHan/subscriptions","organizations_url":"https://api.github.com/users/TengdaHan/orgs","repos_url":"https://api.github.com/users/TengdaHan/repos","events_url":"https://api.github.com/users/TengdaHan/events{/privacy}","received_events_url":"https://api.github.com/users/TengdaHan/received_events","type":"User","site_admin":false},"created_at":"2019-10-09T22:26:27Z","updated_at":"2019-10-09T22:26:27Z","author_association":"NONE","body":"Another potentially efficient solution is to add device id into the dictionary keys. Like this:\r\n\r\n```python\r\nBackward_tensorGrid = {}\r\nBackward_tensorPartial = {}\r\n\r\ndef Backward(tensorInput, tensorFlow):\r\n    if str(tensorFlow.size())+str(tensorFlow.device) not in Backward_tensorGrid:\r\n        tensorHorizontal = torch.linspace(-1.0, 1.0, tensorFlow.size(3)).view(1, 1, 1, tensorFlow.size(3)).expand(tensorFlow.size(0), -1, tensorFlow.size(2), -1)\r\n        tensorVertical = torch.linspace(-1.0, 1.0, tensorFlow.size(2)).view(1, 1, tensorFlow.size(2), 1).expand(tensorFlow.size(0), -1, -1, tensorFlow.size(3))\r\n\r\n        Backward_tensorGrid[str(tensorFlow.size())+str(tensorFlow.device)] = torch.cat([ tensorHorizontal, tensorVertical ], 1).cuda()\r\n    # end\r\n\r\n    if str(tensorFlow.size())+str(tensorFlow.device) not in Backward_tensorPartial:\r\n        Backward_tensorPartial[str(tensorFlow.size())+str(tensorFlow.device)] = tensorFlow.new_ones([ tensorFlow.size(0), 1, tensorFlow.size(2), tensorFlow.size(3) ])\r\n    # end\r\n\r\n    tensorFlow = torch.cat([ tensorFlow[:, 0:1, :, :] / ((tensorInput.size(3) - 1.0) / 2.0), tensorFlow[:, 1:2, :, :] / ((tensorInput.size(2) - 1.0) / 2.0) ], 1)\r\n    tensorInput = torch.cat([ tensorInput, Backward_tensorPartial[str(tensorFlow.size())+str(tensorFlow.device)] ], 1)\r\n\r\n    tensorOutput = torch.nn.functional.grid_sample(input=tensorInput, grid=(Backward_tensorGrid[str(tensorFlow.size())+str(tensorFlow.device)] + tensorFlow).permute(0, 2, 3, 1), mode='bilinear', padding_mode='zeros')\r\n\r\n    tensorMask = tensorOutput[:, -1:, :, :]; tensorMask[tensorMask > 0.999] = 1.0; tensorMask[tensorMask < 1.0] = 0.0\r\n\r\n    return tensorOutput[:, :-1, :, :] * tensorMask\r\n# end\r\n```","reactions":{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/540231555/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"TengdaHan","id":17740581,"node_id":"MDQ6VXNlcjE3NzQwNTgx","avatar_url":"https://avatars.githubusercontent.com/u/17740581?v=4","gravatar_id":"","url":"https://api.github.com/users/TengdaHan","html_url":"https://github.com/TengdaHan","followers_url":"https://api.github.com/users/TengdaHan/followers","following_url":"https://api.github.com/users/TengdaHan/following{/other_user}","gists_url":"https://api.github.com/users/TengdaHan/gists{/gist_id}","starred_url":"https://api.github.com/users/TengdaHan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TengdaHan/subscriptions","organizations_url":"https://api.github.com/users/TengdaHan/orgs","repos_url":"https://api.github.com/users/TengdaHan/repos","events_url":"https://api.github.com/users/TengdaHan/events{/privacy}","received_events_url":"https://api.github.com/users/TengdaHan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/540347287","html_url":"https://github.com/sniklaus/pytorch-pwc/issues/24#issuecomment-540347287","issue_url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/24","id":540347287,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MDM0NzI4Nw==","user":{"login":"sniklaus","id":1238034,"node_id":"MDQ6VXNlcjEyMzgwMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1238034?v=4","gravatar_id":"","url":"https://api.github.com/users/sniklaus","html_url":"https://github.com/sniklaus","followers_url":"https://api.github.com/users/sniklaus/followers","following_url":"https://api.github.com/users/sniklaus/following{/other_user}","gists_url":"https://api.github.com/users/sniklaus/gists{/gist_id}","starred_url":"https://api.github.com/users/sniklaus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sniklaus/subscriptions","organizations_url":"https://api.github.com/users/sniklaus/orgs","repos_url":"https://api.github.com/users/sniklaus/repos","events_url":"https://api.github.com/users/sniklaus/events{/privacy}","received_events_url":"https://api.github.com/users/sniklaus/received_events","type":"User","site_admin":false},"created_at":"2019-10-10T04:23:10Z","updated_at":"2019-10-10T04:23:10Z","author_association":"OWNER","body":"Interesting approach, thank you for sharing!","reactions":{"url":"https://api.github.com/repos/sniklaus/pytorch-pwc/issues/comments/540347287/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sniklaus","id":1238034,"node_id":"MDQ6VXNlcjEyMzgwMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1238034?v=4","gravatar_id":"","url":"https://api.github.com/users/sniklaus","html_url":"https://github.com/sniklaus","followers_url":"https://api.github.com/users/sniklaus/followers","following_url":"https://api.github.com/users/sniklaus/following{/other_user}","gists_url":"https://api.github.com/users/sniklaus/gists{/gist_id}","starred_url":"https://api.github.com/users/sniklaus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sniklaus/subscriptions","organizations_url":"https://api.github.com/users/sniklaus/orgs","repos_url":"https://api.github.com/users/sniklaus/repos","events_url":"https://api.github.com/users/sniklaus/events{/privacy}","received_events_url":"https://api.github.com/users/sniklaus/received_events","type":"User","site_admin":false}}]