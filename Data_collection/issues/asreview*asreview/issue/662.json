{"url":"https://api.github.com/repos/asreview/asreview/issues/662","repository_url":"https://api.github.com/repos/asreview/asreview","labels_url":"https://api.github.com/repos/asreview/asreview/issues/662/labels{/name}","comments_url":"https://api.github.com/repos/asreview/asreview/issues/662/comments","events_url":"https://api.github.com/repos/asreview/asreview/issues/662/events","html_url":"https://github.com/asreview/asreview/issues/662","id":944080799,"node_id":"MDU6SXNzdWU5NDQwODA3OTk=","number":662,"title":"simulation breaks down when n_instances parameter is set too high","user":{"login":"GerbrichFerdinands","id":45358236,"node_id":"MDQ6VXNlcjQ1MzU4MjM2","avatar_url":"https://avatars.githubusercontent.com/u/45358236?v=4","gravatar_id":"","url":"https://api.github.com/users/GerbrichFerdinands","html_url":"https://github.com/GerbrichFerdinands","followers_url":"https://api.github.com/users/GerbrichFerdinands/followers","following_url":"https://api.github.com/users/GerbrichFerdinands/following{/other_user}","gists_url":"https://api.github.com/users/GerbrichFerdinands/gists{/gist_id}","starred_url":"https://api.github.com/users/GerbrichFerdinands/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GerbrichFerdinands/subscriptions","organizations_url":"https://api.github.com/users/GerbrichFerdinands/orgs","repos_url":"https://api.github.com/users/GerbrichFerdinands/repos","events_url":"https://api.github.com/users/GerbrichFerdinands/events{/privacy}","received_events_url":"https://api.github.com/users/GerbrichFerdinands/received_events","type":"User","site_admin":false},"labels":[{"id":1186392107,"node_id":"MDU6TGFiZWwxMTg2MzkyMTA3","url":"https://api.github.com/repos/asreview/asreview/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":{"login":"J535D165","id":12981139,"node_id":"MDQ6VXNlcjEyOTgxMTM5","avatar_url":"https://avatars.githubusercontent.com/u/12981139?v=4","gravatar_id":"","url":"https://api.github.com/users/J535D165","html_url":"https://github.com/J535D165","followers_url":"https://api.github.com/users/J535D165/followers","following_url":"https://api.github.com/users/J535D165/following{/other_user}","gists_url":"https://api.github.com/users/J535D165/gists{/gist_id}","starred_url":"https://api.github.com/users/J535D165/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/J535D165/subscriptions","organizations_url":"https://api.github.com/users/J535D165/orgs","repos_url":"https://api.github.com/users/J535D165/repos","events_url":"https://api.github.com/users/J535D165/events{/privacy}","received_events_url":"https://api.github.com/users/J535D165/received_events","type":"User","site_admin":false},"assignees":[{"login":"J535D165","id":12981139,"node_id":"MDQ6VXNlcjEyOTgxMTM5","avatar_url":"https://avatars.githubusercontent.com/u/12981139?v=4","gravatar_id":"","url":"https://api.github.com/users/J535D165","html_url":"https://github.com/J535D165","followers_url":"https://api.github.com/users/J535D165/followers","following_url":"https://api.github.com/users/J535D165/following{/other_user}","gists_url":"https://api.github.com/users/J535D165/gists{/gist_id}","starred_url":"https://api.github.com/users/J535D165/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/J535D165/subscriptions","organizations_url":"https://api.github.com/users/J535D165/orgs","repos_url":"https://api.github.com/users/J535D165/repos","events_url":"https://api.github.com/users/J535D165/events{/privacy}","received_events_url":"https://api.github.com/users/J535D165/received_events","type":"User","site_admin":false},{"login":"PeterLombaers","id":71253799,"node_id":"MDQ6VXNlcjcxMjUzNzk5","avatar_url":"https://avatars.githubusercontent.com/u/71253799?v=4","gravatar_id":"","url":"https://api.github.com/users/PeterLombaers","html_url":"https://github.com/PeterLombaers","followers_url":"https://api.github.com/users/PeterLombaers/followers","following_url":"https://api.github.com/users/PeterLombaers/following{/other_user}","gists_url":"https://api.github.com/users/PeterLombaers/gists{/gist_id}","starred_url":"https://api.github.com/users/PeterLombaers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PeterLombaers/subscriptions","organizations_url":"https://api.github.com/users/PeterLombaers/orgs","repos_url":"https://api.github.com/users/PeterLombaers/repos","events_url":"https://api.github.com/users/PeterLombaers/events{/privacy}","received_events_url":"https://api.github.com/users/PeterLombaers/received_events","type":"User","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/asreview/asreview/milestones/3","html_url":"https://github.com/asreview/asreview/milestone/3","labels_url":"https://api.github.com/repos/asreview/asreview/milestones/3/labels","id":4732767,"node_id":"MDk6TWlsZXN0b25lNDczMjc2Nw==","number":3,"title":"v1.0","description":"Milestone for the release of version 1.0.","creator":{"login":"J535D165","id":12981139,"node_id":"MDQ6VXNlcjEyOTgxMTM5","avatar_url":"https://avatars.githubusercontent.com/u/12981139?v=4","gravatar_id":"","url":"https://api.github.com/users/J535D165","html_url":"https://github.com/J535D165","followers_url":"https://api.github.com/users/J535D165/followers","following_url":"https://api.github.com/users/J535D165/following{/other_user}","gists_url":"https://api.github.com/users/J535D165/gists{/gist_id}","starred_url":"https://api.github.com/users/J535D165/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/J535D165/subscriptions","organizations_url":"https://api.github.com/users/J535D165/orgs","repos_url":"https://api.github.com/users/J535D165/repos","events_url":"https://api.github.com/users/J535D165/events{/privacy}","received_events_url":"https://api.github.com/users/J535D165/received_events","type":"User","site_admin":false},"open_issues":1,"closed_issues":97,"state":"open","created_at":"2019-10-08T14:25:15Z","updated_at":"2022-06-09T13:24:59Z","due_on":"2022-06-07T07:00:00Z","closed_at":null},"comments":4,"created_at":"2021-07-14T06:12:49Z","updated_at":"2022-03-31T15:59:41Z","closed_at":"2022-03-31T15:59:40Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Describe the bug**\r\nThe `--n_instances` parameter (number of records queried each query) has a ceiling, where the simulation breaks. \r\n\r\n**To Reproduce**\r\nI use the the PTSD dataset (n = 6189), with 5 prior inclusions and 5 prior exclusions, and with `--n_instances` set to 6179 (6189-10, # of records not used for training). \r\n\r\n**Screenshots**\r\n\r\n```\r\ngerbrich asreview simulate van_de_Schoot_2017.csv --n_prior_included 5 --n_prior_excluded 5 --n_instances 6179 --state_file default_10prior_passive.h5 --seed 42 --init_seed 42\r\n\r\n            _____ _____            _\r\n     /\\    / ____|  __ \\          (_)\r\n    /  \\  | (___ | |__) |_____   ___  _____      __\r\n   / /\\ \\  \\___ \\|  _  // _ \\ \\ / / |/ _ \\ \\ /\\ / /\r\n  / ____ \\ ____) | | \\ \\  __/\\ V /| |  __/\\ V  V /\r\n /_/    \\_\\_____/|_|  \\_\\___| \\_/ |_|\\___| \\_/\\_/\r\n\r\n---------------------------------------------------------------------------------\r\n|                                                                                |\r\n|  Welcome to the ASReview Automated Systematic Review software.                 |\r\n|  In this mode the computer will simulate how well the ASReview software        |\r\n|  could have accelerate the systematic review of your dataset.                  |\r\n|  You can sit back and relax while the computer runs this simulation.           |\r\n|                                                                                |\r\n|  GitHub page:        https://github.com/asreview/asreview                      |\r\n|  Questions/remarks:  asreview@uu.nl                                            |\r\n|                                                                                |\r\n---------------------------------------------------------------------------------\r\n\r\nThe following records are prior knowledge:\r\n\r\n4939 - Posttraumatic stress disorder symptom trajectories in Hurricane Katrina affect..   Self-Brown, S., Lai, B. S., Thompson, ..\r\n3483 - Trajectories of Scores on a Screening Instrument for PTSD Among World Trade Ce..   Maslow, C. B., Caramanica, K., Welch, ..\r\n3489 - Growth curve trajectories of distress in burn patients                             Mason, S. T., Corry, N., Gould, N. F.,..\r\n4938 - Maternal posttraumatic stress disorder symptom trajectories following Hurrican..   Self-Brown, S., Lai, B. S., Harbin, S...\r\n4435 - Trajectories of posttraumatic stress symptoms (PTSS) after major war among Pal..   Punam√§ki, R. L., Palosaari, E., Diab, ..\r\n4403 - New approaches to combining pharmacotherapy and psychotherapy for posttraumati..   Pratchett, L. C., Daly, K., Bierer, L...\r\n3496 - Impact of baseline mental health on adherence to interferon-free HCV therapy       Masur, J., Tang, L., Nelson, A., Osinu..\r\n4991 - Profiles of connectedness: Processes of resilience and growth in children with..   Sharp, K. M. H., Willard, V. W., Okado..\r\n1004 - Headache diagnoses among iraq and afghanistan war veterans enrolled in VA: A g..   Carlson, K. F., Taylor, B. C., Hagel, ..\r\n2785 - Clinical Evaluation of a Measure to Assess Combat Exposure                         Keane, T. M., Fairbank, J. A., Caddell..\r\nTraceback (most recent call last):\r\n  File \"/Users/gerbrich/asreview/bin/asreview\", line 8, in <module>\r\n    sys.exit(main())\r\n  File \"/Users/gerbrich/asreview/lib/python3.8/site-packages/asreview/__main__.py\", line 80, in main\r\n    entry.load()().execute(sys.argv[2:])\r\n  File \"/Users/gerbrich/asreview/lib/python3.8/site-packages/asreview/entry_points/simulate.py\", line 47, in execute\r\n    review_simulate(path, **args_dict)\r\n  File \"/Users/gerbrich/asreview/lib/python3.8/site-packages/asreview/review/factory.py\", line 327, in review_simulate\r\n    review(dataset, *args, mode='simulate', **kwargs)\r\n  File \"/Users/gerbrich/asreview/lib/python3.8/site-packages/asreview/review/factory.py\", line 290, in review\r\n    reviewer.review()\r\n  File \"/Users/gerbrich/asreview/lib/python3.8/site-packages/asreview/review/base.py\", line 336, in review\r\n    self._do_review(state, *args, **kwargs)\r\n  File \"/Users/gerbrich/asreview/lib/python3.8/site-packages/asreview/review/base.py\", line 301, in _do_review\r\n    self.log_current_query(state)\r\n  File \"/Users/gerbrich/asreview/lib/python3.8/site-packages/asreview/review/base.py\", line 356, in log_current_query\r\n    state.set_current_queries(self.shared[\"current_queries\"])\r\n  File \"/Users/gerbrich/asreview/lib/python3.8/site-packages/asreview/state/hdf5.py\", line 77, in set_current_queries\r\n    self.f.attrs[\"current_queries\"] = data\r\n  File \"h5py/_objects.pyx\", line 54, in h5py._objects.with_phil.wrapper\r\n  File \"h5py/_objects.pyx\", line 55, in h5py._objects.with_phil.wrapper\r\n  File \"/Users/gerbrich/asreview/lib/python3.8/site-packages/h5py/_hl/attrs.py\", line 100, in __setitem__\r\n    self.create(name, data=value)\r\n  File \"/Users/gerbrich/asreview/lib/python3.8/site-packages/h5py/_hl/attrs.py\", line 201, in create\r\n    attr = h5a.create(self._id, self._e(tempname), htype, space)\r\n  File \"h5py/_objects.pyx\", line 54, in h5py._objects.with_phil.wrapper\r\n  File \"h5py/_objects.pyx\", line 55, in h5py._objects.with_phil.wrapper\r\n  File \"h5py/h5a.pyx\", line 47, in h5py.h5a.create\r\nRuntimeError: Unable to create attribute (object header message is too large)\r\n```\r\n\r\nI think asreview being unable to handle such large `--n_instances` values might\r\nhave something to do with the current design of the state file. I tested it\r\nwith `--n_instances` 10, 100, 1000, 3000, and 4000 as well, which works fine.\r\nWhen I tried at 6000 (or higher), it fails. With a smaller dataset (n = around 1000) I had no problems whatsoever. \r\n\r\n**Version information**\r\n - OS: macOS\r\n - ASReview version 0.17\r\n\r\n**Additional context**\r\nI want to run a model that trains only once, e.g. only on the prior records. I try to arrange for that by making sure the first query consists of *all* the records in the data minus the prior records.\r\n\r\n\r\n","closed_by":{"login":"J535D165","id":12981139,"node_id":"MDQ6VXNlcjEyOTgxMTM5","avatar_url":"https://avatars.githubusercontent.com/u/12981139?v=4","gravatar_id":"","url":"https://api.github.com/users/J535D165","html_url":"https://github.com/J535D165","followers_url":"https://api.github.com/users/J535D165/followers","following_url":"https://api.github.com/users/J535D165/following{/other_user}","gists_url":"https://api.github.com/users/J535D165/gists{/gist_id}","starred_url":"https://api.github.com/users/J535D165/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/J535D165/subscriptions","organizations_url":"https://api.github.com/users/J535D165/orgs","repos_url":"https://api.github.com/users/J535D165/repos","events_url":"https://api.github.com/users/J535D165/events{/privacy}","received_events_url":"https://api.github.com/users/J535D165/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/asreview/asreview/issues/662/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/asreview/asreview/issues/662/timeline","performed_via_github_app":null,"state_reason":"completed"}