{"url":"https://api.github.com/repos/asreview/asreview/issues/1055","repository_url":"https://api.github.com/repos/asreview/asreview","labels_url":"https://api.github.com/repos/asreview/asreview/issues/1055/labels{/name}","comments_url":"https://api.github.com/repos/asreview/asreview/issues/1055/comments","events_url":"https://api.github.com/repos/asreview/asreview/issues/1055/events","html_url":"https://github.com/asreview/asreview/issues/1055","id":1222649275,"node_id":"I_kwDOCdPKjs5I4CW7","number":1055,"title":"The state file does not correspond to the given data file when using custom feature extraction method","user":{"login":"J535D165","id":12981139,"node_id":"MDQ6VXNlcjEyOTgxMTM5","avatar_url":"https://avatars.githubusercontent.com/u/12981139?v=4","gravatar_id":"","url":"https://api.github.com/users/J535D165","html_url":"https://github.com/J535D165","followers_url":"https://api.github.com/users/J535D165/followers","following_url":"https://api.github.com/users/J535D165/following{/other_user}","gists_url":"https://api.github.com/users/J535D165/gists{/gist_id}","starred_url":"https://api.github.com/users/J535D165/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/J535D165/subscriptions","organizations_url":"https://api.github.com/users/J535D165/orgs","repos_url":"https://api.github.com/users/J535D165/repos","events_url":"https://api.github.com/users/J535D165/events{/privacy}","received_events_url":"https://api.github.com/users/J535D165/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-05-02T09:01:40Z","updated_at":"2022-05-05T14:43:18Z","closed_at":"2022-05-05T14:43:18Z","author_association":"MEMBER","active_lock_reason":null,"body":"### Discussed in https://github.com/asreview/asreview/discussions/1048\r\n\r\n<div type='discussions-op-text'>\r\n\r\n<sup>Originally posted by **michagast** April 29, 2022</sup>\r\nHi everyone,\r\n\r\nI am back again this time with a question about asreview lab. I have currently made my own extension for feature extraction for asreview. This can be found [here](https://github.com/michagast/asreview/blob/main/asreviewcontrib/models/enron_fe.py).\r\nThe relevant code is as follows:\r\n```\r\n\r\nfrom asreview.models.feature_extraction.base import BaseFeatureExtraction\r\nimport numpy as np\r\n\r\nimport pandas as pd                 #For data science purposes\r\nimport re                           #For performing regex\r\nimport torch                        #For running models with cuda\r\nfrom transformers import AutoTokenizer, AutoModelForSequenceClassification, pipeline\r\n\r\nclass Enron(BaseFeatureExtraction):\r\n    \"\"\"Custom feature extraction\r\n\r\n    Feature extraction that generates features based on sentiment values and named entity recogntion among other things.\r\n    \"\"\"\r\n\r\n    name = \"enron\"\r\n    label = \"Enron feature extraction\"\r\n\r\n    def __init__(self, *args, **kwargs):\r\n\r\n        super(Enron, self).__init__(*args, **kwargs)\r\n    def transform(self, texts):\r\n        model = AutoModelForSequenceClassification.from_pretrained(\"distilbert-base-uncased-finetuned-sst-2-english\")\r\n\r\n        tokenizernlp = AutoTokenizer.from_pretrained(\"distilbert-base-uncased-finetuned-sst-2-english\")\r\n        sentiment_analysis = pipeline(\"sentiment-analysis\", model=model, tokenizer=tokenizernlp,\r\n                                           max_length=512,\r\n                                           truncation=True, device=0)\r\n        result = np.empty([0])\r\n        for text in texts:\r\n            np.append(result, sentiment_analysis(text))\r\n        return result\r\n```\r\n The feature extraction method properly shows up within asreview lab and can be selected. The program then takes a while to apply the feature extraction to the dataset but after a while it gives the following error:\r\n```\r\nERROR:root:Project enron - ValueError: The state file does not correspond to the given data file, please use another state file or dataset.\r\nTraceback (most recent call last):\r\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.10_3.10.1264.0_x64__qbz5n2kfra8p0\\lib\\runpy.py\", line 196, in _run_module_as_main\r\n    return _run_code(code, main_globals, None,\r\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.10_3.10.1264.0_x64__qbz5n2kfra8p0\\lib\\runpy.py\", line 86, in _run_code\r\n    exec(code, run_globals)\r\n  File \"C:\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.10_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python310\\site-packages\\asreview\\__main__.py\", line 122, in <module>\r\n    main()\r\n  File \"C:AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.10_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python310\\site-packages\\asreview\\__main__.py\", line 80, in main\r\n    entry.load()().execute(sys.argv[2:])\r\n  File \"C:\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.10_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python310\\site-packages\\asreview\\entry_points\\lab.py\", line 112, in execute\r\n    main_run_model(argv)\r\n  File \"C:\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.10_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python310\\site-packages\\asreview\\webapp\\run_model.py\", line 200, in main\r\n    raise err\r\n  File \"C:\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.10_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python310\\site-packages\\asreview\\webapp\\run_model.py\", line 186, in main\r\n    train_model(args.project_id, args.label_method)\r\n  File \"C:\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.10_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python310\\site-packages\\asreview\\webapp\\run_model.py\", line 117, in train_model\r\n    reviewer = get_reviewer(dataset=data_fp, mode=\"minimal\", **asr_kwargs)\r\n  File \"C:\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.10_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python310\\site-packages\\asreview\\review\\factory.py\", line 243, in get_reviewer\r\n    reviewer = MinimalReview(as_data,\r\n  File \"C:\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.10_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python310\\site-packages\\asreview\\review\\minimal.py\", line 21, in __init__\r\n    super(MinimalReview, self).__init__(*args, **kwargs)\r\n  File \"C:\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.10_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python310\\site-packages\\asreview\\review\\base.py\", line 209, in __init__\r\n    raise ValueError(\"The state file does not correspond to the \"\r\nValueError: The state file does not correspond to the given data file, please use another state file or dataset.\r\nERROR:root:Error on training.\r\n```\r\nLong story short, apparently the state file doesn't correspond to the given datafile. However this seems weird as this happens after I have selected the configuration and have asked asreview to train a base model with the given configurations and have thus not changed the dataset in any way. Note that it takes a while for this error to be generated as it seems that feature extraction is working but then suddenly it throws the error. After the error it is not possible to continue to the active learning.\r\n\r\nDoes anybody have a clue as to what causes this error? Please let me know. \r\n\r\nThanks in advance,\r\nMicha</div>","closed_by":{"login":"J535D165","id":12981139,"node_id":"MDQ6VXNlcjEyOTgxMTM5","avatar_url":"https://avatars.githubusercontent.com/u/12981139?v=4","gravatar_id":"","url":"https://api.github.com/users/J535D165","html_url":"https://github.com/J535D165","followers_url":"https://api.github.com/users/J535D165/followers","following_url":"https://api.github.com/users/J535D165/following{/other_user}","gists_url":"https://api.github.com/users/J535D165/gists{/gist_id}","starred_url":"https://api.github.com/users/J535D165/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/J535D165/subscriptions","organizations_url":"https://api.github.com/users/J535D165/orgs","repos_url":"https://api.github.com/users/J535D165/repos","events_url":"https://api.github.com/users/J535D165/events{/privacy}","received_events_url":"https://api.github.com/users/J535D165/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/asreview/asreview/issues/1055/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/asreview/asreview/issues/1055/timeline","performed_via_github_app":null,"state_reason":"completed"}