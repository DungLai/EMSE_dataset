{"url":"https://api.github.com/repos/BloodAxe/pytorch-toolbelt/issues/51","repository_url":"https://api.github.com/repos/BloodAxe/pytorch-toolbelt","labels_url":"https://api.github.com/repos/BloodAxe/pytorch-toolbelt/issues/51/labels{/name}","comments_url":"https://api.github.com/repos/BloodAxe/pytorch-toolbelt/issues/51/comments","events_url":"https://api.github.com/repos/BloodAxe/pytorch-toolbelt/issues/51/events","html_url":"https://github.com/BloodAxe/pytorch-toolbelt/issues/51","id":755026818,"node_id":"MDU6SXNzdWU3NTUwMjY4MTg=","number":51,"title":"Focal loss error","user":{"login":"vbakhteev","id":35462234,"node_id":"MDQ6VXNlcjM1NDYyMjM0","avatar_url":"https://avatars.githubusercontent.com/u/35462234?v=4","gravatar_id":"","url":"https://api.github.com/users/vbakhteev","html_url":"https://github.com/vbakhteev","followers_url":"https://api.github.com/users/vbakhteev/followers","following_url":"https://api.github.com/users/vbakhteev/following{/other_user}","gists_url":"https://api.github.com/users/vbakhteev/gists{/gist_id}","starred_url":"https://api.github.com/users/vbakhteev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vbakhteev/subscriptions","organizations_url":"https://api.github.com/users/vbakhteev/orgs","repos_url":"https://api.github.com/users/vbakhteev/repos","events_url":"https://api.github.com/users/vbakhteev/events{/privacy}","received_events_url":"https://api.github.com/users/vbakhteev/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-12-02T07:36:29Z","updated_at":"2020-12-02T08:07:04Z","closed_at":"2020-12-02T08:06:37Z","author_association":"NONE","active_lock_reason":null,"body":"Multiclass Focal loss returns error.\r\n\r\n``` File \"/Users/vladbahteev/PycharmProjects/segmentation_pipeline/pipelines/multi_task_segmentator.py\", line 61, in one_pass\r\n    loss = criterion(preds, target)\r\n  File \"/Users/vladbahteev/miniconda3/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 727, in _call_impl\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/Users/vladbahteev/miniconda3/lib/python3.7/site-packages/pytorch_toolbelt/losses/joint_loss.py\", line 32, in forward\r\n    return self.first(*input) + self.second(*input)\r\n  File \"/Users/vladbahteev/miniconda3/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 727, in _call_impl\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/Users/vladbahteev/miniconda3/lib/python3.7/site-packages/pytorch_toolbelt/losses/joint_loss.py\", line 18, in forward\r\n    return self.loss(*input) * self.weight\r\n  File \"/Users/vladbahteev/miniconda3/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 727, in _call_impl\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/Users/vladbahteev/miniconda3/lib/python3.7/site-packages/pytorch_toolbelt/losses/focal.py\", line 89, in forward\r\n    loss += self.focal_loss_fn(cls_label_input, cls_label_target)\r\n  File \"/Users/vladbahteev/miniconda3/lib/python3.7/site-packages/pytorch_toolbelt/losses/functional.py\", line 45, in focal_loss_with_logits\r\n    logpt = F.binary_cross_entropy_with_logits(output, target, reduction=\"none\")\r\n  File \"/Users/vladbahteev/miniconda3/lib/python3.7/site-packages/torch/nn/functional.py\", line 2580, in binary_cross_entropy_with_logits\r\n    raise ValueError(\"Target size ({}) must be the same as input size ({})\".format(target.size(), input.size()))\r\nValueError: Target size (torch.Size([5, 1, 256, 256])) must be the same as input size (torch.Size([5, 256, 256]))\r\nException ignored in: <function tqdm.__del__ at 0x7fd03260d400>\r\nTraceback (most recent call last):\r\n  File \"/Users/vladbahteev/miniconda3/lib/python3.7/site-packages/tqdm/std.py\", line 1128, in __del__\r\n  File \"/Users/vladbahteev/miniconda3/lib/python3.7/site-packages/tqdm/std.py\", line 1341, in close\r\n  File \"/Users/vladbahteev/miniconda3/lib/python3.7/site-packages/tqdm/std.py\", line 1520, in display\r\n  File \"/Users/vladbahteev/miniconda3/lib/python3.7/site-packages/tqdm/std.py\", line 1131, in __repr__\r\n  File \"/Users/vladbahteev/miniconda3/lib/python3.7/site-packages/tqdm/std.py\", line 1481, in format_dict\r\nTypeError: cannot unpack non-iterable NoneType object\r\n```\r\n\r\nI think that line 83 in pytorch_toolbelt/losses/focal.py should be changed\r\nfrom `cls_label_input = label_input[:, cls, ...]`\r\nto `cls_label_input = label_input[:, cls, ...].unsqueeze(1)`","closed_by":{"login":"BloodAxe","id":532320,"node_id":"MDQ6VXNlcjUzMjMyMA==","avatar_url":"https://avatars.githubusercontent.com/u/532320?v=4","gravatar_id":"","url":"https://api.github.com/users/BloodAxe","html_url":"https://github.com/BloodAxe","followers_url":"https://api.github.com/users/BloodAxe/followers","following_url":"https://api.github.com/users/BloodAxe/following{/other_user}","gists_url":"https://api.github.com/users/BloodAxe/gists{/gist_id}","starred_url":"https://api.github.com/users/BloodAxe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BloodAxe/subscriptions","organizations_url":"https://api.github.com/users/BloodAxe/orgs","repos_url":"https://api.github.com/users/BloodAxe/repos","events_url":"https://api.github.com/users/BloodAxe/events{/privacy}","received_events_url":"https://api.github.com/users/BloodAxe/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/BloodAxe/pytorch-toolbelt/issues/51/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/BloodAxe/pytorch-toolbelt/issues/51/timeline","performed_via_github_app":null,"state_reason":"completed"}