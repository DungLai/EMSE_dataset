[{"url":"https://api.github.com/repos/SimGus/Chatette/issues/comments/543349651","html_url":"https://github.com/SimGus/Chatette/issues/23#issuecomment-543349651","issue_url":"https://api.github.com/repos/SimGus/Chatette/issues/23","id":543349651,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MzM0OTY1MQ==","user":{"login":"SimGus","id":20604236,"node_id":"MDQ6VXNlcjIwNjA0MjM2","avatar_url":"https://avatars.githubusercontent.com/u/20604236?v=4","gravatar_id":"","url":"https://api.github.com/users/SimGus","html_url":"https://github.com/SimGus","followers_url":"https://api.github.com/users/SimGus/followers","following_url":"https://api.github.com/users/SimGus/following{/other_user}","gists_url":"https://api.github.com/users/SimGus/gists{/gist_id}","starred_url":"https://api.github.com/users/SimGus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SimGus/subscriptions","organizations_url":"https://api.github.com/users/SimGus/orgs","repos_url":"https://api.github.com/users/SimGus/repos","events_url":"https://api.github.com/users/SimGus/events{/privacy}","received_events_url":"https://api.github.com/users/SimGus/received_events","type":"User","site_admin":false},"created_at":"2019-10-17T20:32:07Z","updated_at":"2019-10-17T20:32:07Z","author_association":"OWNER","body":"This is weird, I used to generate ~27k sentences in around a few minutes. That being said, I didn't test performances since v1.4.2, and I made a large refactor which might have decreased performances. I'll check again on v1.6.0.\r\n\r\nWould you mind answering a few questions so that I can have a better understanding of what is going on here?\r\n- I assume you are using a fairly normal computer but I prefer to ask, is your computer particularly slow?\r\n- Can you confirm you are using Chatette v1.6.0?\r\n- Which part of the process is especially slow: parsing, generation or writing the outut file(s)?\r\n- Are your template files particularly convoluted? By that I mean, do you often have very long chains of aliases used inside other aliases, used in other aliases, and so on? Also, do you use a lot of modifiers?\r\n- Could you measure whether it is the memory consumption or the CPU utilization that is the limiting factor? Basically, when you run Chatette, is most of your RAM being used or is the CPU core that it is executing on running at full throttle?\r\n\r\nTo answer your questions, you can see a rule as a tree, where each piece of content would be a node, and branches would be possible choices the generator can make.\r\n\r\nFor example, the template\r\n```\r\n%[intent]\r\n    A single rule with an ~[alias] and a [choice|small choice]\r\n    \r\n~[alias]\r\n    another rule with a [choice|small choice]\r\n    a third rule\r\n```\r\ncould be seen as\r\n![RuleTree](https://user-images.githubusercontent.com/20604236/67043592-b8a12600-f12a-11e9-890f-9c710bbeed34.png)\r\n\r\nTo generate an example, Chatette traverses such a tree. Therefore, several factors can increase generation time:\r\n- the depth of such a tree\r\n- the number of unit references/choices in the rules\r\n- the length of the rules\r\n\r\nThere are a few things I would suggest you do to try and decrease the execution time, aside from the obvious suggestion (e.g. closing all resource intensive application when running Chatette):\r\n- as I said before, try to keep your rule trees as shallow as possible, limiting the amount of unit references and choices you use in them\r\n- limit the amount of generation modifiers if you don't really need them as they add a small overhead during generation\r\n- if you can, split your files in separate files, and run Chatette separately on each of them to avoid regenerating a lot of examples when you only made changes to a handful of units. What I usually do is to have several master files which contain unrelated intents, and one file containing \"common\" aliases that are included in each master file.\r\n- you can maybe try using Chatette v1.5.0 and see if the performance is better. Be careful that some syntax was introduced in v1.6.0 and will not be recognized in previous versions (you can take a look at the [changelog](https://github.com/SimGus/Chatette/blob/master/CHANGELOG.md)).\r\n- you can try using a faster python interpreter such as [pypy](https://pypy.org/)\r\n- you can take a look at the code and try to make it more efficient\r\n- your way of parallelizing the execution using ray certainly is one of the best solution. Chatette obviously has a potential to execute in a multi-threaded way, I might add this in the future.\r\n\r\nOf course, those suggestions are just workarounds, having Chatette execute for an hour for \"only\" 35k examples is not acceptable. Improving the performance of Chatette is the real solution here. I will do it but it will certainly take time.\r\n\r\nOn a side note, if you are using Chatette for machine learning tasks, be careful that you can easily have your models overfit with such a high number of examples.\r\n\r\nI hope this helps and thank you for your kind message :)","reactions":{"url":"https://api.github.com/repos/SimGus/Chatette/issues/comments/543349651/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SimGus","id":20604236,"node_id":"MDQ6VXNlcjIwNjA0MjM2","avatar_url":"https://avatars.githubusercontent.com/u/20604236?v=4","gravatar_id":"","url":"https://api.github.com/users/SimGus","html_url":"https://github.com/SimGus","followers_url":"https://api.github.com/users/SimGus/followers","following_url":"https://api.github.com/users/SimGus/following{/other_user}","gists_url":"https://api.github.com/users/SimGus/gists{/gist_id}","starred_url":"https://api.github.com/users/SimGus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SimGus/subscriptions","organizations_url":"https://api.github.com/users/SimGus/orgs","repos_url":"https://api.github.com/users/SimGus/repos","events_url":"https://api.github.com/users/SimGus/events{/privacy}","received_events_url":"https://api.github.com/users/SimGus/received_events","type":"User","site_admin":false}},{"id":2722673437,"node_id":"MDEyOkxhYmVsZWRFdmVudDI3MjI2NzM0Mzc=","url":"https://api.github.com/repos/SimGus/Chatette/issues/events/2722673437","actor":{"login":"SimGus","id":20604236,"node_id":"MDQ6VXNlcjIwNjA0MjM2","avatar_url":"https://avatars.githubusercontent.com/u/20604236?v=4","gravatar_id":"","url":"https://api.github.com/users/SimGus","html_url":"https://github.com/SimGus","followers_url":"https://api.github.com/users/SimGus/followers","following_url":"https://api.github.com/users/SimGus/following{/other_user}","gists_url":"https://api.github.com/users/SimGus/gists{/gist_id}","starred_url":"https://api.github.com/users/SimGus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SimGus/subscriptions","organizations_url":"https://api.github.com/users/SimGus/orgs","repos_url":"https://api.github.com/users/SimGus/repos","events_url":"https://api.github.com/users/SimGus/events{/privacy}","received_events_url":"https://api.github.com/users/SimGus/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-10-17T20:32:42Z","label":{"name":"feedback","color":"AB47BC"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/SimGus/Chatette/issues/comments/544652246","html_url":"https://github.com/SimGus/Chatette/issues/23#issuecomment-544652246","issue_url":"https://api.github.com/repos/SimGus/Chatette/issues/23","id":544652246,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NDY1MjI0Ng==","user":{"login":"muhnashX","id":51781349,"node_id":"MDQ6VXNlcjUxNzgxMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/51781349?v=4","gravatar_id":"","url":"https://api.github.com/users/muhnashX","html_url":"https://github.com/muhnashX","followers_url":"https://api.github.com/users/muhnashX/followers","following_url":"https://api.github.com/users/muhnashX/following{/other_user}","gists_url":"https://api.github.com/users/muhnashX/gists{/gist_id}","starred_url":"https://api.github.com/users/muhnashX/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muhnashX/subscriptions","organizations_url":"https://api.github.com/users/muhnashX/orgs","repos_url":"https://api.github.com/users/muhnashX/repos","events_url":"https://api.github.com/users/muhnashX/events{/privacy}","received_events_url":"https://api.github.com/users/muhnashX/received_events","type":"User","site_admin":false},"created_at":"2019-10-21T18:44:29Z","updated_at":"2019-10-22T08:48:44Z","author_association":"NONE","body":"Apologies for late reply, things came up and couldn't access the machine on which i'm experimenting.\r\nFirst of all, Thank you for the detailed reply, and yes it helped!! (especially the second half)\r\nregarding your questions:\r\n>I assume you are using a fairly normal computer but I prefer to ask, is your computer particularly slow?\r\n\r\n\r\nWell, it's a Thinkpad with Core i7-8565U CPU and 8 GBs of RAM. \r\n\r\n>Can you confirm you are using Chatette v1.6.0?\r\n\r\n\r\nYes! i'm using version 1.6.0\r\n\r\n>Which part of the process is especially slow: parsing, generation or writing the outut file(s)?```\r\n\r\n\r\nThe generation i think, because the parsing is done quickly and i'm left with the prompt: ```[DBG] Generating training examples...```\r\n\r\n>Are your template files particularly convoluted? By that I mean, do you often have very long chains \r\nof aliases used inside other aliases, used in other aliases, and so on? Also, do you use a lot of modifiers?\r\n\r\nYes kind of, a typical intent definition is basically built of aliases, some of them are nested up to 4 levels.\r\ni.e\r\n [high_level_alias --> sub_alias_lvl1 --> sub_alias_lvl2 --> small_alias that contain slots]\r\ni think here's some work that can be done (flatting and splitting things a bit)\r\n\r\n>Could you measure whether it is the memory consumption or the CPU utilization that is the limiting factor? Basically, when you run Chatette, is most of your RAM being used or is the CPU core that it is executing on running at full throttle?\r\n\r\ni think it's CPU, here's a screenshot from htop when generating today:\r\n![72418144_1367214376785629_2517768549708070912_n](https://user-images.githubusercontent.com/51781349/67230644-f0b3ac00-f43d-11e9-9246-1d412beabe30.png)\r\nthis run took about ~50min\r\n","reactions":{"url":"https://api.github.com/repos/SimGus/Chatette/issues/comments/544652246/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"muhnashX","id":51781349,"node_id":"MDQ6VXNlcjUxNzgxMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/51781349?v=4","gravatar_id":"","url":"https://api.github.com/users/muhnashX","html_url":"https://github.com/muhnashX","followers_url":"https://api.github.com/users/muhnashX/followers","following_url":"https://api.github.com/users/muhnashX/following{/other_user}","gists_url":"https://api.github.com/users/muhnashX/gists{/gist_id}","starred_url":"https://api.github.com/users/muhnashX/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muhnashX/subscriptions","organizations_url":"https://api.github.com/users/muhnashX/orgs","repos_url":"https://api.github.com/users/muhnashX/repos","events_url":"https://api.github.com/users/muhnashX/events{/privacy}","received_events_url":"https://api.github.com/users/muhnashX/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/SimGus/Chatette/issues/comments/544655657","html_url":"https://github.com/SimGus/Chatette/issues/23#issuecomment-544655657","issue_url":"https://api.github.com/repos/SimGus/Chatette/issues/23","id":544655657,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NDY1NTY1Nw==","user":{"login":"muhnashX","id":51781349,"node_id":"MDQ6VXNlcjUxNzgxMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/51781349?v=4","gravatar_id":"","url":"https://api.github.com/users/muhnashX","html_url":"https://github.com/muhnashX","followers_url":"https://api.github.com/users/muhnashX/followers","following_url":"https://api.github.com/users/muhnashX/following{/other_user}","gists_url":"https://api.github.com/users/muhnashX/gists{/gist_id}","starred_url":"https://api.github.com/users/muhnashX/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muhnashX/subscriptions","organizations_url":"https://api.github.com/users/muhnashX/orgs","repos_url":"https://api.github.com/users/muhnashX/repos","events_url":"https://api.github.com/users/muhnashX/events{/privacy}","received_events_url":"https://api.github.com/users/muhnashX/received_events","type":"User","site_admin":false},"created_at":"2019-10-21T18:52:56Z","updated_at":"2019-10-21T18:54:39Z","author_association":"NONE","body":"What i'm going to do is to try to refactor my templates as much as i can, but without hurting the modularity and readability as much (chatette winning point). i would pay time in exchange for nicer syntax as it would be easier to maintain and update.\r\nand regarding performance optimization of v1.6.0 it would be awesome if i can help!! but i lack the experience in that matter. that's why i went for dealing with it as a black box and try to multi process on a high level or use ray.\r\n","reactions":{"url":"https://api.github.com/repos/SimGus/Chatette/issues/comments/544655657/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"muhnashX","id":51781349,"node_id":"MDQ6VXNlcjUxNzgxMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/51781349?v=4","gravatar_id":"","url":"https://api.github.com/users/muhnashX","html_url":"https://github.com/muhnashX","followers_url":"https://api.github.com/users/muhnashX/followers","following_url":"https://api.github.com/users/muhnashX/following{/other_user}","gists_url":"https://api.github.com/users/muhnashX/gists{/gist_id}","starred_url":"https://api.github.com/users/muhnashX/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muhnashX/subscriptions","organizations_url":"https://api.github.com/users/muhnashX/orgs","repos_url":"https://api.github.com/users/muhnashX/repos","events_url":"https://api.github.com/users/muhnashX/events{/privacy}","received_events_url":"https://api.github.com/users/muhnashX/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/SimGus/Chatette/issues/comments/545127330","html_url":"https://github.com/SimGus/Chatette/issues/23#issuecomment-545127330","issue_url":"https://api.github.com/repos/SimGus/Chatette/issues/23","id":545127330,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NTEyNzMzMA==","user":{"login":"SimGus","id":20604236,"node_id":"MDQ6VXNlcjIwNjA0MjM2","avatar_url":"https://avatars.githubusercontent.com/u/20604236?v=4","gravatar_id":"","url":"https://api.github.com/users/SimGus","html_url":"https://github.com/SimGus","followers_url":"https://api.github.com/users/SimGus/followers","following_url":"https://api.github.com/users/SimGus/following{/other_user}","gists_url":"https://api.github.com/users/SimGus/gists{/gist_id}","starred_url":"https://api.github.com/users/SimGus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SimGus/subscriptions","organizations_url":"https://api.github.com/users/SimGus/orgs","repos_url":"https://api.github.com/users/SimGus/repos","events_url":"https://api.github.com/users/SimGus/events{/privacy}","received_events_url":"https://api.github.com/users/SimGus/received_events","type":"User","site_admin":false},"created_at":"2019-10-22T19:57:16Z","updated_at":"2019-10-22T19:57:16Z","author_association":"OWNER","body":"Thanks for your replies :)\r\n\r\nI think I see what the problem is: since v1.6.0, I've been trying to use caching during generation to improve generation time, but for big templates, it will use the whole RAM which makes it very slow. I assumed this would be a problem for much larger files but apparently I was wrong.\r\n\r\nI'll add a way to disable that (or just turn it down) in the next update. It is likely it will take time as I don't have much time at the moment, so I hope you can cope with the current version.\r\nIf you can, trying the previous version (v1.5.2) could help I think.\r\n\r\nThanks again for the heads up!","reactions":{"url":"https://api.github.com/repos/SimGus/Chatette/issues/comments/545127330/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SimGus","id":20604236,"node_id":"MDQ6VXNlcjIwNjA0MjM2","avatar_url":"https://avatars.githubusercontent.com/u/20604236?v=4","gravatar_id":"","url":"https://api.github.com/users/SimGus","html_url":"https://github.com/SimGus","followers_url":"https://api.github.com/users/SimGus/followers","following_url":"https://api.github.com/users/SimGus/following{/other_user}","gists_url":"https://api.github.com/users/SimGus/gists{/gist_id}","starred_url":"https://api.github.com/users/SimGus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SimGus/subscriptions","organizations_url":"https://api.github.com/users/SimGus/orgs","repos_url":"https://api.github.com/users/SimGus/repos","events_url":"https://api.github.com/users/SimGus/events{/privacy}","received_events_url":"https://api.github.com/users/SimGus/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/SimGus/Chatette/issues/comments/552250567","html_url":"https://github.com/SimGus/Chatette/issues/23#issuecomment-552250567","issue_url":"https://api.github.com/repos/SimGus/Chatette/issues/23","id":552250567,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MjI1MDU2Nw==","user":{"login":"SimGus","id":20604236,"node_id":"MDQ6VXNlcjIwNjA0MjM2","avatar_url":"https://avatars.githubusercontent.com/u/20604236?v=4","gravatar_id":"","url":"https://api.github.com/users/SimGus","html_url":"https://github.com/SimGus","followers_url":"https://api.github.com/users/SimGus/followers","following_url":"https://api.github.com/users/SimGus/following{/other_user}","gists_url":"https://api.github.com/users/SimGus/gists{/gist_id}","starred_url":"https://api.github.com/users/SimGus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SimGus/subscriptions","organizations_url":"https://api.github.com/users/SimGus/orgs","repos_url":"https://api.github.com/users/SimGus/repos","events_url":"https://api.github.com/users/SimGus/events{/privacy}","received_events_url":"https://api.github.com/users/SimGus/received_events","type":"User","site_admin":false},"created_at":"2019-11-11T00:14:04Z","updated_at":"2019-11-11T00:14:04Z","author_association":"OWNER","body":"I just released a patch (v1.6.1) which tackles the issue temporarily: the problem came from the caching strategy which is way too aggressive. That patch disables caching when there are more than 50 units (aliases, slots and intents) declared.\r\nI could record about a 4x increase in the execution time, for medium size templates (you can find my benchmarks [here](https://github.com/SimGus/Chatette/blob/master/benchmarks.md)).\r\n\r\nOf course, this is just a temporary solution, I plan to tackle the issue in a cleaner and more robust way in future releases. I will keep this issue open until I am satisfied with the caching strategy, and more generally the execution time.","reactions":{"url":"https://api.github.com/repos/SimGus/Chatette/issues/comments/552250567/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SimGus","id":20604236,"node_id":"MDQ6VXNlcjIwNjA0MjM2","avatar_url":"https://avatars.githubusercontent.com/u/20604236?v=4","gravatar_id":"","url":"https://api.github.com/users/SimGus","html_url":"https://github.com/SimGus","followers_url":"https://api.github.com/users/SimGus/followers","following_url":"https://api.github.com/users/SimGus/following{/other_user}","gists_url":"https://api.github.com/users/SimGus/gists{/gist_id}","starred_url":"https://api.github.com/users/SimGus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SimGus/subscriptions","organizations_url":"https://api.github.com/users/SimGus/orgs","repos_url":"https://api.github.com/users/SimGus/repos","events_url":"https://api.github.com/users/SimGus/events{/privacy}","received_events_url":"https://api.github.com/users/SimGus/received_events","type":"User","site_admin":false}},{"id":2793011315,"node_id":"MDEyOkxhYmVsZWRFdmVudDI3OTMwMTEzMTU=","url":"https://api.github.com/repos/SimGus/Chatette/issues/events/2793011315","actor":{"login":"SimGus","id":20604236,"node_id":"MDQ6VXNlcjIwNjA0MjM2","avatar_url":"https://avatars.githubusercontent.com/u/20604236?v=4","gravatar_id":"","url":"https://api.github.com/users/SimGus","html_url":"https://github.com/SimGus","followers_url":"https://api.github.com/users/SimGus/followers","following_url":"https://api.github.com/users/SimGus/following{/other_user}","gists_url":"https://api.github.com/users/SimGus/gists{/gist_id}","starred_url":"https://api.github.com/users/SimGus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SimGus/subscriptions","organizations_url":"https://api.github.com/users/SimGus/orgs","repos_url":"https://api.github.com/users/SimGus/repos","events_url":"https://api.github.com/users/SimGus/events{/privacy}","received_events_url":"https://api.github.com/users/SimGus/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-11-12T21:06:22Z","label":{"name":"improvement","color":"4DD0E1"},"performed_via_github_app":null},{"id":2793011318,"node_id":"MDEyOkxhYmVsZWRFdmVudDI3OTMwMTEzMTg=","url":"https://api.github.com/repos/SimGus/Chatette/issues/events/2793011318","actor":{"login":"SimGus","id":20604236,"node_id":"MDQ6VXNlcjIwNjA0MjM2","avatar_url":"https://avatars.githubusercontent.com/u/20604236?v=4","gravatar_id":"","url":"https://api.github.com/users/SimGus","html_url":"https://github.com/SimGus","followers_url":"https://api.github.com/users/SimGus/followers","following_url":"https://api.github.com/users/SimGus/following{/other_user}","gists_url":"https://api.github.com/users/SimGus/gists{/gist_id}","starred_url":"https://api.github.com/users/SimGus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SimGus/subscriptions","organizations_url":"https://api.github.com/users/SimGus/orgs","repos_url":"https://api.github.com/users/SimGus/repos","events_url":"https://api.github.com/users/SimGus/events{/privacy}","received_events_url":"https://api.github.com/users/SimGus/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-11-12T21:06:22Z","label":{"name":"in progress","color":"FFC107"},"performed_via_github_app":null}]