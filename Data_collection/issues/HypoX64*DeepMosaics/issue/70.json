{"url":"https://api.github.com/repos/HypoX64/DeepMosaics/issues/70","repository_url":"https://api.github.com/repos/HypoX64/DeepMosaics","labels_url":"https://api.github.com/repos/HypoX64/DeepMosaics/issues/70/labels{/name}","comments_url":"https://api.github.com/repos/HypoX64/DeepMosaics/issues/70/comments","events_url":"https://api.github.com/repos/HypoX64/DeepMosaics/issues/70/events","html_url":"https://github.com/HypoX64/DeepMosaics/issues/70","id":954898818,"node_id":"MDU6SXNzdWU5NTQ4OTg4MTg=","number":70,"title":"exiting due to unkown error","user":{"login":"calvin360","id":61894408,"node_id":"MDQ6VXNlcjYxODk0NDA4","avatar_url":"https://avatars.githubusercontent.com/u/61894408?v=4","gravatar_id":"","url":"https://api.github.com/users/calvin360","html_url":"https://github.com/calvin360","followers_url":"https://api.github.com/users/calvin360/followers","following_url":"https://api.github.com/users/calvin360/following{/other_user}","gists_url":"https://api.github.com/users/calvin360/gists{/gist_id}","starred_url":"https://api.github.com/users/calvin360/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calvin360/subscriptions","organizations_url":"https://api.github.com/users/calvin360/orgs","repos_url":"https://api.github.com/users/calvin360/repos","events_url":"https://api.github.com/users/calvin360/events{/privacy}","received_events_url":"https://api.github.com/users/calvin360/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-07-28T14:10:03Z","updated_at":"2021-08-01T04:50:46Z","closed_at":"2021-08-01T04:50:46Z","author_association":"NONE","active_lock_reason":null,"body":"deep mosiac exits early when rebuilding the video when using google colab. The video being processed has been cut using the windows photo app which might be an issue. The input command is `!python3 deepmosaic.py --media_path=\"/content/DeepMosaics/imgs/MIDD-817(1a).mp4\" --model_path=\"/content/DeepMosaics/pretrained_models/clean_youknow_video.pth\" --mode=\"clean\" --no_preview --gpu_id=0 --fps 0 -ss 00:00:00 -t 00:00:00  --mask_threshold 64` and the output is attached below.\r\n\r\nmakedir: ./result\r\nsegment parameters: 12.4M\r\nnetG parameters: 26.65M\r\nStep:1/4 -- Convert video to images\r\nClean temp...\r\nffmpeg version 3.4.8-0ubuntu0.2 Copyright (c) 2000-2020 the FFmpeg developers\r\n  built with gcc 7 (Ubuntu 7.5.0-3ubuntu1~18.04)\r\n  configuration: --prefix=/usr --extra-version=0ubuntu0.2 --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --enable-gpl --disable-stripping --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-libpulse --enable-librubberband --enable-librsvg --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzmq --enable-libzvbi --enable-omx --enable-openal --enable-opengl --enable-sdl2 --enable-libdc1394 --enable-libdrm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-libopencv --enable-libx264 --enable-shared\r\n  libavutil      55. 78.100 / 55. 78.100\r\n  libavcodec     57.107.100 / 57.107.100\r\n  libavformat    57. 83.100 / 57. 83.100\r\n  libavdevice    57. 10.100 / 57. 10.100\r\n  libavfilter     6.107.100 /  6.107.100\r\n  libavresample   3.  7.  0 /  3.  7.  0\r\n  libswscale      4.  8.100 /  4.  8.100\r\n  libswresample   2.  9.100 /  2.  9.100\r\n  libpostproc    54.  7.100 / 54.  7.100\r\nInput #0, mov,mp4,m4a,3gp,3g2,mj2, from '/content/DeepMosaics/imgs/MIDD-817(1a).mp4':\r\n  Metadata:\r\n    major_brand     : mp42\r\n    minor_version   : 0\r\n    compatible_brands: mp41isom\r\n    creation_time   : 2020-02-12T18:31:23.000000Z\r\n  Duration: 00:29:00.67, start: 0.000000, bitrate: 3902 kb/s\r\n    Stream #0:0(und): Video: h264 (Main) (avc1 / 0x31637661), yuv420p(tv), 1920x1080 [SAR 1:1 DAR 16:9], 3707 kb/s, 30 fps, 30 tbr, 30k tbn, 60 tbc (default)\r\n    Metadata:\r\n      creation_time   : 2021-07-27T15:07:05.000000Z\r\n      handler_name    : VideoHandler\r\n      encoder         : AVC Coding\r\n    Stream #0:1(und): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, stereo, fltp, 192 kb/s (default)\r\n    Metadata:\r\n      creation_time   : 2021-07-27T15:07:05.000000Z\r\n      handler_name    : SoundHandler\r\nStream mapping:\r\n  Stream #0:1 -> #0:0 (aac (native) -> mp3 (libmp3lame))\r\nPress [q] to stop, [?] for help\r\n-async is forwarded to lavfi similarly to -af aresample=async=1:min_hard_comp=0.100000:first_pts=0.\r\nOutput #0, mp3, to './tmp/DeepMosaics_temp/voice_tmp.mp3':\r\n  Metadata:\r\n    major_brand     : mp42\r\n    minor_version   : 0\r\n    compatible_brands: mp41isom\r\n    TSSE            : Lavf57.83.100\r\n    Stream #0:0(und): Audio: mp3 (libmp3lame), 48000 Hz, stereo, fltp, 320 kb/s (default)\r\n    Metadata:\r\n      creation_time   : 2021-07-27T15:07:05.000000Z\r\n      handler_name    : SoundHandler\r\n      encoder         : Lavc57.107.100 libmp3lame\r\n[aac @ 0x560c0eb5f900] decode_band_types: Input buffer exhausted before END element found\r\nError while decoding stream #0:1: Invalid data found when processing input\r\nsize=   67997kB time=00:29:00.67 bitrate= 320.0kbits/s speed=41.7x    \r\nvideo:0kB audio:67996kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.001577%\r\nffmpeg version 3.4.8-0ubuntu0.2 Copyright (c) 2000-2020 the FFmpeg developers\r\n  built with gcc 7 (Ubuntu 7.5.0-3ubuntu1~18.04)\r\n  configuration: --prefix=/usr --extra-version=0ubuntu0.2 --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --enable-gpl --disable-stripping --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-libpulse --enable-librubberband --enable-librsvg --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzmq --enable-libzvbi --enable-omx --enable-openal --enable-opengl --enable-sdl2 --enable-libdc1394 --enable-libdrm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-libopencv --enable-libx264 --enable-shared\r\n  libavutil      55. 78.100 / 55. 78.100\r\n  libavcodec     57.107.100 / 57.107.100\r\n  libavformat    57. 83.100 / 57. 83.100\r\n  libavdevice    57. 10.100 / 57. 10.100\r\n  libavfilter     6.107.100 /  6.107.100\r\n  libavresample   3.  7.  0 /  3.  7.  0\r\n  libswscale      4.  8.100 /  4.  8.100\r\n  libswresample   2.  9.100 /  2.  9.100\r\n  libpostproc    54.  7.100 / 54.  7.100\r\nInput #0, mov,mp4,m4a,3gp,3g2,mj2, from '/content/DeepMosaics/imgs/MIDD-817(1a).mp4':\r\n  Metadata:\r\n    major_brand     : mp42\r\n    minor_version   : 0\r\n    compatible_brands: mp41isom\r\n    creation_time   : 2020-02-12T18:31:23.000000Z\r\n  Duration: 00:29:00.67, start: 0.000000, bitrate: 3902 kb/s\r\n    Stream #0:0(und): Video: h264 (Main) (avc1 / 0x31637661), yuv420p(tv), 1920x1080 [SAR 1:1 DAR 16:9], 3707 kb/s, 30 fps, 30 tbr, 30k tbn, 60 tbc (default)\r\n    Metadata:\r\n      creation_time   : 2021-07-27T15:07:05.000000Z\r\n      handler_name    : VideoHandler\r\n      encoder         : AVC Coding\r\n    Stream #0:1(und): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, stereo, fltp, 192 kb/s (default)\r\n    Metadata:\r\n      creation_time   : 2021-07-27T15:07:05.000000Z\r\n      handler_name    : SoundHandler\r\nStream mapping:\r\n  Stream #0:0 -> #0:0 (h264 (native) -> mjpeg (native))\r\nPress [q] to stop, [?] for help\r\n[swscaler @ 0x55a76142c000] deprecated pixel format used, make sure you did set range correctly\r\nOutput #0, image2, to './tmp/DeepMosaics_temp/video2image/output_%06d.jpg':\r\n  Metadata:\r\n    major_brand     : mp42\r\n    minor_version   : 0\r\n    compatible_brands: mp41isom\r\n    encoder         : Lavf57.83.100\r\n    Stream #0:0(und): Video: mjpeg, yuvj420p(pc), 1920x1080 [SAR 1:1 DAR 16:9], q=2-31, 200 kb/s, 30 fps, 30 tbn, 30 tbc (default)\r\n    Metadata:\r\n      creation_time   : 2021-07-27T15:07:05.000000Z\r\n      handler_name    : VideoHandler\r\n      encoder         : Lavc57.107.100 mjpeg\r\n    Side data:\r\n      cpb: bitrate max/min/avg: 0/0/200000 buffer size: 0 vbv_delay: -1\r\nframe=52220 fps= 52 q=0.0 Lsize=N/A time=00:29:00.66 bitrate=N/A speed=1.73x    \r\nvideo:5994909kB audio:0kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: unknown\r\nStep:2/4 -- Find mosaic location\r\n 52220/52220 [###################################] 100.00% 00:35:41/00:35:41\r\nOptimize mosaic locations...\r\nStep:3/4 -- Clean Mosaic:\r\n 52220/52220 [###################################] 100.00% 01:22:43/01:22:43\r\nStep:4/4 -- Convert images to video\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.7/multiprocessing/queues.py\", line 242, in _feed\r\n    send_bytes(obj)\r\n  File \"/usr/lib/python3.7/multiprocessing/connection.py\", line 200, in send_bytes\r\n    self._send_bytes(m[offset:offset + size])\r\n  File \"/usr/lib/python3.7/multiprocessing/connection.py\", line 397, in _send_bytes\r\n    self._send(header)\r\n  File \"/usr/lib/python3.7/multiprocessing/connection.py\", line 368, in _send\r\n    n = write(self._handle, buf)\r\nBrokenPipeError: [Errno 32] Broken pipe\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.7/multiprocessing/queues.py\", line 242, in _feed\r\n    send_bytes(obj)\r\n  File \"/usr/lib/python3.7/multiprocessing/connection.py\", line 200, in send_bytes\r\n    self._send_bytes(m[offset:offset + size])\r\n  File \"/usr/lib/python3.7/multiprocessing/connection.py\", line 397, in _send_bytes\r\n    self._send(header)\r\n  File \"/usr/lib/python3.7/multiprocessing/connection.py\", line 368, in _send\r\n    n = write(self._handle, buf)\r\nBrokenPipeError: [Errno 32] Broken pipe\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.7/multiprocessing/queues.py\", line 242, in _feed\r\n    send_bytes(obj)\r\n  File \"/usr/lib/python3.7/multiprocessing/connection.py\", line 200, in send_bytes\r\n    self._send_bytes(m[offset:offset + size])\r\n  File \"/usr/lib/python3.7/multiprocessing/connection.py\", line 397, in _send_bytes\r\n    self._send(header)\r\n  File \"/usr/lib/python3.7/multiprocessing/connection.py\", line 368, in _send\r\n    n = write(self._handle, buf)\r\nBrokenPipeError: [Errno 32] Broken pipe\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.7/multiprocessing/queues.py\", line 242, in _feed\r\n    send_bytes(obj)\r\n  File \"/usr/lib/python3.7/multiprocessing/connection.py\", line 200, in send_bytes\r\n    self._send_bytes(m[offset:offset + size])\r\n  File \"/usr/lib/python3.7/multiprocessing/connection.py\", line 397, in _send_bytes\r\n    self._send(header)\r\n  File \"/usr/lib/python3.7/multiprocessing/connection.py\", line 368, in _send\r\n    n = write(self._handle, buf)\r\nBrokenPipeError: [Errno 32] Broken pipe\r\nException in thread Thread-52222:\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.7/threading.py\", line 926, in _bootstrap_inner\r\n    self.run()\r\n  File \"/usr/lib/python3.7/threading.py\", line 870, in run\r\n    self._target(*self._args, **self._kwargs)\r\n  File \"/content/DeepMosaics/cores/clean.py\", line 183, in write_result\r\n    save_ori,imagepath,img_origin,img_fake,x,y,size = write_pool.get()\r\n  File \"/usr/lib/python3.7/multiprocessing/queues.py\", line 94, in get\r\n    res = self._recv_bytes()\r\n  File \"/usr/lib/python3.7/multiprocessing/connection.py\", line 212, in recv_bytes\r\n    self._check_closed()\r\n  File \"/usr/lib/python3.7/multiprocessing/connection.py\", line 136, in _check_closed\r\n    raise OSError(\"handle is closed\")\r\nOSError: handle is closed\r\n\r\nffmpeg version 3.4.8-0ubuntu0.2 Copyright (c) 2000-2020 the FFmpeg developers\r\n  built with gcc 7 (Ubuntu 7.5.0-3ubuntu1~18.04)\r\n  configuration: --prefix=/usr --extra-version=0ubuntu0.2 --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --enable-gpl --disable-stripping --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-libpulse --enable-librubberband --enable-librsvg --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzmq --enable-libzvbi --enable-omx --enable-openal --enable-opengl --enable-sdl2 --enable-libdc1394 --enable-libdrm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-libopencv --enable-libx264 --enable-shared\r\n  libavutil      55. 78.100 / 55. 78.100\r\n  libavcodec     57.107.100 / 57.107.100\r\n  libavformat    57. 83.100 / 57. 83.100\r\n  libavdevice    57. 10.100 / 57. 10.100\r\n  libavfilter     6.107.100 /  6.107.100\r\n  libavresample   3.  7.  0 /  3.  7.  0\r\n  libswscale      4.  8.100 /  4.  8.100\r\n  libswresample   2.  9.100 /  2.  9.100\r\n  libpostproc    54.  7.100 / 54.  7.100\r\n[mjpeg @ 0x55bac588ca00] EOI missing, emulating\r\nInput #0, image2, from './tmp/DeepMosaics_temp/replace_mosaic/output_%06d.jpg':\r\n  Duration: 00:34:48.64, start: 0.000000, bitrate: N/A\r\n    Stream #0:0: Video: mjpeg, yuvj420p(pc, bt470bg/unknown/unknown), 1920x1080 [SAR 1:1 DAR 16:9], 25 fps, 25 tbr, 25 tbn, 25 tbc\r\nStream mapping:\r\n  Stream #0:0 -> #0:0 (mjpeg (native) -> h264 (libx264))\r\nPress [q] to stop, [?] for help\r\n[libx264 @ 0x55bac588de00] using SAR=1/1\r\n[libx264 @ 0x55bac588de00] using cpu capabilities: MMX2 SSE2Fast SSSE3 SSE4.2 AVX FMA3 BMI2 AVX2\r\n[libx264 @ 0x55bac588de00] profile High, level 4.0\r\n[libx264 @ 0x55bac588de00] 264 - core 152 r2854 e9a5903 - H.264/MPEG-4 AVC codec - Copyleft 2003-2017 - http://www.videolan.org/x264.html - options: cabac=1 ref=3 deblock=1:0:0 analyse=0x3:0x113 me=hex subme=7 psy=1 psy_rd=1.00:0.00 mixed_ref=1 me_range=16 chroma_me=1 trellis=1 8x8dct=1 cqm=0 deadzone=21,11 fast_pskip=1 chroma_qp_offset=-2 threads=3 lookahead_threads=1 sliced_threads=0 nr=0 decimate=1 interlaced=0 bluray_compat=0 constrained_intra=0 bframes=3 b_pyramid=2 b_adapt=1 b_bias=0 direct=1 weightb=1 open_gop=0 weightp=2 keyint=250 keyint_min=25 scenecut=40 intra_refresh=0 rc_lookahead=40 rc=crf mbtree=1 crf=23.0 qcomp=0.60 qpmin=0 qpmax=69 qpstep=4 ip_ratio=1.40 aq=1:1.00\r\nOutput #0, mp4, to './tmp/DeepMosaics_temp/video_tmp.mp4':\r\n  Metadata:\r\n    encoder         : Lavf57.83.100\r\n    Stream #0:0: Video: h264 (libx264) (avc1 / 0x31637661), yuvj420p(pc), 1920x1080 [SAR 1:1 DAR 16:9], q=-1--1, 30 fps, 15360 tbn, 30 tbc\r\n    Metadata:\r\n      encoder         : Lavc57.107.100 libx264\r\n    Side data:\r\n      cpb: bitrate max/min/avg: 0/0/0 buffer size: 0 vbv_delay: -1\r\nframe=52216 fps=6.8 q=-1.0 Lsize=  953084kB time=00:29:00.43 bitrate=4486.0kbits/s speed=0.228x    \r\nvideo:952465kB audio:0kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.064936%\r\n[libx264 @ 0x55bac588de00] frame I:272   Avg QP:19.24  size: 58788\r\n[libx264 @ 0x55bac588de00] frame P:13709 Avg QP:22.37  size: 33376\r\n[libx264 @ 0x55bac588de00] frame B:38235 Avg QP:24.08  size: 13124\r\n[libx264 @ 0x55bac588de00] consecutive B-frames:  1.8%  0.5%  3.4% 94.3%\r\n[libx264 @ 0x55bac588de00] mb I  I16..4: 31.2% 64.6%  4.2%\r\n[libx264 @ 0x55bac588de00] mb P  I16..4: 19.8% 31.7%  0.7%  P16..4: 27.7%  7.5%  1.8%  0.0%  0.0%    skip:10.9%\r\n[libx264 @ 0x55bac588de00] mb B  I16..4:  4.3%  6.8%  0.1%  B16..8: 40.9%  4.0%  0.3%  direct: 2.0%  skip:41.6%  L0:55.9% L1:41.1% BI: 3.0%\r\n[libx264 @ 0x55bac588de00] 8x8 transform intra:60.8% inter:90.6%\r\n[libx264 @ 0x55bac588de00] coded y,uvDC,uvAC intra: 30.0% 61.4% 4.8% inter: 8.4% 19.9% 0.2%\r\n[libx264 @ 0x55bac588de00] i16 v,h,dc,p: 29% 26% 15% 30%\r\n[libx264 @ 0x55bac588de00] i8 v,h,dc,ddl,ddr,vr,hd,vl,hu: 32% 24% 31%  2%  2%  2%  2%  2%  2%\r\n[libx264 @ 0x55bac588de00] i4 v,h,dc,ddl,ddr,vr,hd,vl,hu: 36% 20% 13%  3%  8%  8%  6%  4%  2%\r\n[libx264 @ 0x55bac588de00] i8c dc,h,v,p: 42% 25% 27%  5%\r\n[libx264 @ 0x55bac588de00] Weighted P-Frames: Y:0.8% UV:0.7%\r\n[libx264 @ 0x55bac588de00] ref P L0: 68.0%  8.8% 17.5%  5.7%  0.0%\r\n[libx264 @ 0x55bac588de00] ref B L0: 90.9%  7.4%  1.6%\r\n[libx264 @ 0x55bac588de00] ref B L1: 96.0%  4.0%\r\n[libx264 @ 0x55bac588de00] kb/s:4482.87\r\nsh: 1: Syntax error: \"(\" unexpected\r\nClean temp...\r\nFinished!","closed_by":{"login":"calvin360","id":61894408,"node_id":"MDQ6VXNlcjYxODk0NDA4","avatar_url":"https://avatars.githubusercontent.com/u/61894408?v=4","gravatar_id":"","url":"https://api.github.com/users/calvin360","html_url":"https://github.com/calvin360","followers_url":"https://api.github.com/users/calvin360/followers","following_url":"https://api.github.com/users/calvin360/following{/other_user}","gists_url":"https://api.github.com/users/calvin360/gists{/gist_id}","starred_url":"https://api.github.com/users/calvin360/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calvin360/subscriptions","organizations_url":"https://api.github.com/users/calvin360/orgs","repos_url":"https://api.github.com/users/calvin360/repos","events_url":"https://api.github.com/users/calvin360/events{/privacy}","received_events_url":"https://api.github.com/users/calvin360/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/HypoX64/DeepMosaics/issues/70/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/HypoX64/DeepMosaics/issues/70/timeline","performed_via_github_app":null,"state_reason":"completed"}