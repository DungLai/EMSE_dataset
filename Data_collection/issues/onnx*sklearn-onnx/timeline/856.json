[{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/1125478979","html_url":"https://github.com/onnx/sklearn-onnx/issues/856#issuecomment-1125478979","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/856","id":1125478979,"node_id":"IC_kwDOCa0gS85DFXJD","user":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"created_at":"2022-05-12T22:34:04Z","updated_at":"2022-05-12T22:34:04Z","author_association":"COLLABORATOR","body":"The following example works. The different comes from final_type optional. The option was only tested for regressor or classifier, no multi output models. It assumes all outputs are tensors and cast them into tensors with a different element type. I assume you need to merge the sequence of probabilities into one single tensor?\r\n\r\n```python\r\nimport numpy\r\nfrom sklearn.pipeline import Pipeline\r\nfrom sklearn.linear_model import LogisticRegression\r\nfrom sklearn.multioutput import MultiOutputClassifier\r\nfrom skl2onnx import to_onnx\r\nfrom skl2onnx.common.data_types import FloatTensorType, Int64TensorType\r\nfrom onnxruntime import InferenceSession\r\n\r\n\r\nrnd = numpy.random.randn(100, 3)\r\nlabels = (rnd >= 0.5).astype(numpy.int64)\r\n\r\ntraindata = testdata = rnd\r\ntrainlabel = labels\r\n\r\npipe = Pipeline(steps=[\r\n        ('classifier', MultiOutputClassifier(estimator=LogisticRegression()))])\r\npipe.fit(traindata, trainlabel)\r\ny_test = pipe.predict_proba(testdata)\r\nonx6 = to_onnx(pipe, traindata.astype(numpy.float32),\r\n               target_opset=12,\r\n               options={MultiOutputClassifier: {'zipmap': False}})\r\n\r\nsess = InferenceSession(onx6.SerializeToString())\r\n\r\npred_onx = sess.run(None, {\"X\": testdata[:5].astype(numpy.float32)})\r\nprint(\"predict\", pred_onx[0])\r\nprint(\"predict_proba\", pred_onx[1][:1])\r\n```","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/1125478979/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/1129905036","html_url":"https://github.com/onnx/sklearn-onnx/issues/856#issuecomment-1129905036","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/856","id":1129905036,"node_id":"IC_kwDOCa0gS85DWPuM","user":{"login":"SwatiTiwarii","id":46405184,"node_id":"MDQ6VXNlcjQ2NDA1MTg0","avatar_url":"https://avatars.githubusercontent.com/u/46405184?v=4","gravatar_id":"","url":"https://api.github.com/users/SwatiTiwarii","html_url":"https://github.com/SwatiTiwarii","followers_url":"https://api.github.com/users/SwatiTiwarii/followers","following_url":"https://api.github.com/users/SwatiTiwarii/following{/other_user}","gists_url":"https://api.github.com/users/SwatiTiwarii/gists{/gist_id}","starred_url":"https://api.github.com/users/SwatiTiwarii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SwatiTiwarii/subscriptions","organizations_url":"https://api.github.com/users/SwatiTiwarii/orgs","repos_url":"https://api.github.com/users/SwatiTiwarii/repos","events_url":"https://api.github.com/users/SwatiTiwarii/events{/privacy}","received_events_url":"https://api.github.com/users/SwatiTiwarii/received_events","type":"User","site_admin":false},"created_at":"2022-05-18T11:43:04Z","updated_at":"2022-05-18T11:43:22Z","author_association":"NONE","body":"If i disable final_type option , i get following error \r\n\r\n---------------------------------------------------------------------------\r\nFail                                      Traceback (most recent call last)\r\n<ipython-input-29-983461d8171f> in <module>\r\n      1 from onnxruntime import InferenceSession\r\n----> 2 sess = InferenceSession(onx6.SerializeToString())\r\n\r\n~\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\onnxruntime\\capi\\onnxruntime_inference_collection.py in __init__(self, path_or_bytes, sess_options, providers, provider_options, **kwargs)\r\n    333 \r\n    334         try:\r\n--> 335             self._create_inference_session(providers, provider_options, disabled_optimizers)\r\n    336         except ValueError:\r\n    337             if self._enable_fallback:\r\n\r\n~\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\onnxruntime\\capi\\onnxruntime_inference_collection.py in _create_inference_session(self, providers, provider_options, disabled_optimizers)\r\n    370             sess = C.InferenceSession(session_options, self._model_path, True, self._read_config_from_model)\r\n    371         else:\r\n--> 372             sess = C.InferenceSession(session_options, self._model_bytes, False, self._read_config_from_model)\r\n    373 \r\n    374         if disabled_optimizers is None:\r\n\r\nFail: [ONNXRuntimeError] : 1 : FAIL : Type Error: Type (tensor(string)) of output arg (label) of node (Co_Concat) does not match expected type (tensor(int64)).\r\n","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/1129905036/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SwatiTiwarii","id":46405184,"node_id":"MDQ6VXNlcjQ2NDA1MTg0","avatar_url":"https://avatars.githubusercontent.com/u/46405184?v=4","gravatar_id":"","url":"https://api.github.com/users/SwatiTiwarii","html_url":"https://github.com/SwatiTiwarii","followers_url":"https://api.github.com/users/SwatiTiwarii/followers","following_url":"https://api.github.com/users/SwatiTiwarii/following{/other_user}","gists_url":"https://api.github.com/users/SwatiTiwarii/gists{/gist_id}","starred_url":"https://api.github.com/users/SwatiTiwarii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SwatiTiwarii/subscriptions","organizations_url":"https://api.github.com/users/SwatiTiwarii/orgs","repos_url":"https://api.github.com/users/SwatiTiwarii/repos","events_url":"https://api.github.com/users/SwatiTiwarii/events{/privacy}","received_events_url":"https://api.github.com/users/SwatiTiwarii/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/1134205986","html_url":"https://github.com/onnx/sklearn-onnx/issues/856#issuecomment-1134205986","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/856","id":1134205986,"node_id":"IC_kwDOCa0gS85Dmpwi","user":{"login":"SwatiTiwarii","id":46405184,"node_id":"MDQ6VXNlcjQ2NDA1MTg0","avatar_url":"https://avatars.githubusercontent.com/u/46405184?v=4","gravatar_id":"","url":"https://api.github.com/users/SwatiTiwarii","html_url":"https://github.com/SwatiTiwarii","followers_url":"https://api.github.com/users/SwatiTiwarii/followers","following_url":"https://api.github.com/users/SwatiTiwarii/following{/other_user}","gists_url":"https://api.github.com/users/SwatiTiwarii/gists{/gist_id}","starred_url":"https://api.github.com/users/SwatiTiwarii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SwatiTiwarii/subscriptions","organizations_url":"https://api.github.com/users/SwatiTiwarii/orgs","repos_url":"https://api.github.com/users/SwatiTiwarii/repos","events_url":"https://api.github.com/users/SwatiTiwarii/events{/privacy}","received_events_url":"https://api.github.com/users/SwatiTiwarii/received_events","type":"User","site_admin":false},"created_at":"2022-05-23T05:42:56Z","updated_at":"2022-05-23T05:42:56Z","author_association":"NONE","body":"Using \r\nlabels = label.astype(numpy.int64) , has solved this issue for me. \r\nAlongwith ignoring input types\r\n","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/1134205986/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SwatiTiwarii","id":46405184,"node_id":"MDQ6VXNlcjQ2NDA1MTg0","avatar_url":"https://avatars.githubusercontent.com/u/46405184?v=4","gravatar_id":"","url":"https://api.github.com/users/SwatiTiwarii","html_url":"https://github.com/SwatiTiwarii","followers_url":"https://api.github.com/users/SwatiTiwarii/followers","following_url":"https://api.github.com/users/SwatiTiwarii/following{/other_user}","gists_url":"https://api.github.com/users/SwatiTiwarii/gists{/gist_id}","starred_url":"https://api.github.com/users/SwatiTiwarii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SwatiTiwarii/subscriptions","organizations_url":"https://api.github.com/users/SwatiTiwarii/orgs","repos_url":"https://api.github.com/users/SwatiTiwarii/repos","events_url":"https://api.github.com/users/SwatiTiwarii/events{/privacy}","received_events_url":"https://api.github.com/users/SwatiTiwarii/received_events","type":"User","site_admin":false}},{"id":6657901718,"node_id":"CE_lADOCa0gS85JQErvzwAAAAGM14SW","url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/events/6657901718","actor":{"login":"SwatiTiwarii","id":46405184,"node_id":"MDQ6VXNlcjQ2NDA1MTg0","avatar_url":"https://avatars.githubusercontent.com/u/46405184?v=4","gravatar_id":"","url":"https://api.github.com/users/SwatiTiwarii","html_url":"https://github.com/SwatiTiwarii","followers_url":"https://api.github.com/users/SwatiTiwarii/followers","following_url":"https://api.github.com/users/SwatiTiwarii/following{/other_user}","gists_url":"https://api.github.com/users/SwatiTiwarii/gists{/gist_id}","starred_url":"https://api.github.com/users/SwatiTiwarii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SwatiTiwarii/subscriptions","organizations_url":"https://api.github.com/users/SwatiTiwarii/orgs","repos_url":"https://api.github.com/users/SwatiTiwarii/repos","events_url":"https://api.github.com/users/SwatiTiwarii/events{/privacy}","received_events_url":"https://api.github.com/users/SwatiTiwarii/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-05-23T05:43:09Z","state_reason":null,"performed_via_github_app":null}]