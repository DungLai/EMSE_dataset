[{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/551737280","html_url":"https://github.com/onnx/sklearn-onnx/issues/307#issuecomment-551737280","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/307","id":551737280,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MTczNzI4MA==","user":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false},"created_at":"2019-11-08T12:49:08Z","updated_at":"2019-11-08T12:49:08Z","author_association":"COLLABORATOR","body":"Can you share the code you are using?","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/551737280/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/551859336","html_url":"https://github.com/onnx/sklearn-onnx/issues/307#issuecomment-551859336","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/307","id":551859336,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MTg1OTMzNg==","user":{"login":"maxnoe","id":5488440,"node_id":"MDQ6VXNlcjU0ODg0NDA=","avatar_url":"https://avatars.githubusercontent.com/u/5488440?v=4","gravatar_id":"","url":"https://api.github.com/users/maxnoe","html_url":"https://github.com/maxnoe","followers_url":"https://api.github.com/users/maxnoe/followers","following_url":"https://api.github.com/users/maxnoe/following{/other_user}","gists_url":"https://api.github.com/users/maxnoe/gists{/gist_id}","starred_url":"https://api.github.com/users/maxnoe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxnoe/subscriptions","organizations_url":"https://api.github.com/users/maxnoe/orgs","repos_url":"https://api.github.com/users/maxnoe/repos","events_url":"https://api.github.com/users/maxnoe/events{/privacy}","received_events_url":"https://api.github.com/users/maxnoe/received_events","type":"User","site_admin":false},"created_at":"2019-11-08T14:56:36Z","updated_at":"2019-11-08T14:56:43Z","author_association":"CONTRIBUTOR","body":"Here is an example:\r\n\r\n```python\r\nfrom skl2onnx import convert_sklearn\r\nfrom skl2onnx.common.data_types import FloatTensorType\r\nfrom skl2onnx.helpers.onnx_helper import select_model_inputs_outputs\r\nfrom onnx.onnx_pb import StringStringEntryProto\r\nfrom sklearn.ensemble import RandomForestClassifier\r\nimport numpy as np\r\nfrom onnxruntime import InferenceSession\r\n\r\n\r\nfeature_names = 'abcd'\r\nX = np.random.normal(size=(500, len(feature_names)))\r\ny = np.random.randint(0, 2, 500)\r\n\r\nmodel = RandomForestClassifier(n_estimators=10)\r\nmodel.fit(X, y)\r\n\r\nonnx = convert_sklearn(\r\n    model,\r\n    initial_types=[('input', FloatTensorType((None, len(feature_names))))],\r\n)\r\n\r\nmetadata = dict(\r\n    model_author='me',\r\n    feature_names='a,b,c,d',\r\n)\r\nfor key, value in metadata.items():\r\n    onnx.metadata_props.append(StringStringEntryProto(key=key, value=value))\r\n\r\n\r\n# see https://github.com/onnx/sklearn-onnx/issues/202\r\nif hasattr(model, 'predict_proba'):\r\n    onnx = select_model_inputs_outputs(onnx, ['probabilities'])\r\n\r\n\r\nmodel_path = 'test.onnx'\r\nwith open(model_path, 'wb') as f:\r\n    f.write(onnx.SerializeToString())\r\n\r\n\r\nsession = InferenceSession(model_path)\r\nprint(session.get_modelmeta().custom_metadata_map)\r\n```\r\n\r\nThe last statement prints an empty dict. If I set the metadata after `select_model_inputs_outputs`, the meta data is avaialble:\r\n```\r\n{}\r\n```\r\nvs.\r\n\r\n```\r\n{'feature_names': 'a,b,c,d', 'model_author': 'me'}\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/551859336/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"maxnoe","id":5488440,"node_id":"MDQ6VXNlcjU0ODg0NDA=","avatar_url":"https://avatars.githubusercontent.com/u/5488440?v=4","gravatar_id":"","url":"https://api.github.com/users/maxnoe","html_url":"https://github.com/maxnoe","followers_url":"https://api.github.com/users/maxnoe/followers","following_url":"https://api.github.com/users/maxnoe/following{/other_user}","gists_url":"https://api.github.com/users/maxnoe/gists{/gist_id}","starred_url":"https://api.github.com/users/maxnoe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxnoe/subscriptions","organizations_url":"https://api.github.com/users/maxnoe/orgs","repos_url":"https://api.github.com/users/maxnoe/repos","events_url":"https://api.github.com/users/maxnoe/events{/privacy}","received_events_url":"https://api.github.com/users/maxnoe/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/552247544","html_url":"https://github.com/onnx/sklearn-onnx/issues/307#issuecomment-552247544","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/307","id":552247544,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MjI0NzU0NA==","user":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false},"created_at":"2019-11-10T23:39:40Z","updated_at":"2019-11-10T23:39:40Z","author_association":"COLLABORATOR","body":"@xadupre: Did you implement select_model_inputs_outputs()? Are you aware of missing metadata issue?","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/552247544/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false}},{"id":2786349256,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjc4NjM0OTI1Ng==","url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/events/2786349256","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-11-10T23:39:40Z","performed_via_github_app":null},{"id":2786349257,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI3ODYzNDkyNTc=","url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/events/2786349257","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-11-10T23:39:40Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/552353246","html_url":"https://github.com/onnx/sklearn-onnx/issues/307#issuecomment-552353246","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/307","id":552353246,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MjM1MzI0Ng==","user":{"login":"maxnoe","id":5488440,"node_id":"MDQ6VXNlcjU0ODg0NDA=","avatar_url":"https://avatars.githubusercontent.com/u/5488440?v=4","gravatar_id":"","url":"https://api.github.com/users/maxnoe","html_url":"https://github.com/maxnoe","followers_url":"https://api.github.com/users/maxnoe/followers","following_url":"https://api.github.com/users/maxnoe/following{/other_user}","gists_url":"https://api.github.com/users/maxnoe/gists{/gist_id}","starred_url":"https://api.github.com/users/maxnoe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxnoe/subscriptions","organizations_url":"https://api.github.com/users/maxnoe/orgs","repos_url":"https://api.github.com/users/maxnoe/repos","events_url":"https://api.github.com/users/maxnoe/events{/privacy}","received_events_url":"https://api.github.com/users/maxnoe/received_events","type":"User","site_admin":false},"created_at":"2019-11-11T09:02:41Z","updated_at":"2019-11-11T09:02:41Z","author_association":"CONTRIBUTOR","body":"If I read the code correctly, the function creates a new model from the compute graph, thus ignoring any metadata:\r\n\r\nhttps://github.com/onnx/sklearn-onnx/blob/1a0f314eb7f1cbade509e8303a88643e489c3b90/skl2onnx/helpers/onnx_helper.py#L151","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/552353246/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"maxnoe","id":5488440,"node_id":"MDQ6VXNlcjU0ODg0NDA=","avatar_url":"https://avatars.githubusercontent.com/u/5488440?v=4","gravatar_id":"","url":"https://api.github.com/users/maxnoe","html_url":"https://github.com/maxnoe","followers_url":"https://api.github.com/users/maxnoe/followers","following_url":"https://api.github.com/users/maxnoe/following{/other_user}","gists_url":"https://api.github.com/users/maxnoe/gists{/gist_id}","starred_url":"https://api.github.com/users/maxnoe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxnoe/subscriptions","organizations_url":"https://api.github.com/users/maxnoe/orgs","repos_url":"https://api.github.com/users/maxnoe/repos","events_url":"https://api.github.com/users/maxnoe/events{/privacy}","received_events_url":"https://api.github.com/users/maxnoe/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/552640222","html_url":"https://github.com/onnx/sklearn-onnx/issues/307#issuecomment-552640222","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/307","id":552640222,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MjY0MDIyMg==","user":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false},"created_at":"2019-11-11T22:12:05Z","updated_at":"2019-11-11T22:12:05Z","author_association":"COLLABORATOR","body":"Yeah, looks like the meta-data is not being copied.","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/552640222/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false}},{"id":2789492382,"node_id":"MDEyOkxhYmVsZWRFdmVudDI3ODk0OTIzODI=","url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/events/2789492382","actor":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-11-11T22:12:28Z","label":{"name":"bug","color":"d73a4a"},"performed_via_github_app":null},{"id":2802919304,"node_id":"MDExOkNsb3NlZEV2ZW50MjgwMjkxOTMwNA==","url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/events/2802919304","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"event":"closed","commit_id":"43e9c64380396fe71de7ab6dbb499cd52656134f","commit_url":"https://api.github.com/repos/onnx/sklearn-onnx/commits/43e9c64380396fe71de7ab6dbb499cd52656134f","created_at":"2019-11-15T14:54:29Z","state_reason":null,"performed_via_github_app":null}]