[{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/791618758","html_url":"https://github.com/onnx/sklearn-onnx/issues/627#issuecomment-791618758","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/627","id":791618758,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTYxODc1OA==","user":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"created_at":"2021-03-05T19:01:58Z","updated_at":"2021-03-05T19:01:58Z","author_association":"COLLABORATOR","body":"Hi,\r\n\r\nAbout your first model, you may have a look into this code: https://github.com/sdpython/mlprodict/blob/master/mlprodict/onnx_conv/operator_converters/conv_transfer_transformer.py. It implements a converter for this model: https://github.com/sdpython/mlinsights/blob/master/mlinsights/mlmodel/transfer_transformer.py which does a similar thing to what you do. However, returning X, y in a transform is not handled in sklearn-onnx so I don't know how it would behave. I would probably return only y and use a ColumnTransformer with two transformers, yours and one replicating the input. sklearn-onnx would work on such a pipeline. \r\n\r\nThe same remark applies on the second class which does not really follow scikit-learn API as method predict returns two outputs. I would probably merge the two classes into one and write a single converter for it.\r\n\r\nsklearn-onnx handles the pipeline logic for you but every piece must follow scikit-learn API, that means predict, predict_proba, decision_function only returns one output. I hope this answer helps you.\r\n\r\nXavier","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/791618758/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/791659633","html_url":"https://github.com/onnx/sklearn-onnx/issues/627#issuecomment-791659633","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/627","id":791659633,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTY1OTYzMw==","user":{"login":"ManuelMartinG","id":39061366,"node_id":"MDQ6VXNlcjM5MDYxMzY2","avatar_url":"https://avatars.githubusercontent.com/u/39061366?v=4","gravatar_id":"","url":"https://api.github.com/users/ManuelMartinG","html_url":"https://github.com/ManuelMartinG","followers_url":"https://api.github.com/users/ManuelMartinG/followers","following_url":"https://api.github.com/users/ManuelMartinG/following{/other_user}","gists_url":"https://api.github.com/users/ManuelMartinG/gists{/gist_id}","starred_url":"https://api.github.com/users/ManuelMartinG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ManuelMartinG/subscriptions","organizations_url":"https://api.github.com/users/ManuelMartinG/orgs","repos_url":"https://api.github.com/users/ManuelMartinG/repos","events_url":"https://api.github.com/users/ManuelMartinG/events{/privacy}","received_events_url":"https://api.github.com/users/ManuelMartinG/received_events","type":"User","site_admin":false},"created_at":"2021-03-05T20:18:28Z","updated_at":"2021-03-05T20:18:28Z","author_association":"NONE","body":"Thanks a lot for your response @xadupre !\r\n\r\nRegarding returning X and y in the transform, I knew it wasn't very scikit-learn-friendly but I accomodated the inputs for the `ChildLabelsModel` so that it could handle the incoming tuple (X, y) (see where I do `parent_y = X[1][0]`). I will have a deep look at the references you've showed though. I think I would be able to make this model in this way.\r\n\r\nNevertheless, for the second model, the complex part that I haven't been able to figure out is how to mimic the `self.child_estimators[parent_y].predict(X)` into ONNX. Essentially, that line is a sub-model selector depending on the incoming `parent` label. I have tried to define this logic using `OnnxIf` and `OnnxEqual` but I don't know how to specify the 'else_branch` and `then_branch` arguments... and unfortunately not been able to find any example where this operators are used with skl2onnx. Are those operators the right choice to create decision branches? Or should I look into another kind of logic?\r\n\r\nJust to give a bit of context, these classes are defined like this just because of an imposed policy from the inference architecture. From your expert opinion, wouldn't it be easier just to transform the first class model and also all the different sub-models into different `InferenceSessions` from each onnx model? We could just wrap the sub-model selector using a simple Python `dict`.\r\n\r\nThanks for your time,\r\n\r\nManuel\r\n\r\n","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/791659633/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ManuelMartinG","id":39061366,"node_id":"MDQ6VXNlcjM5MDYxMzY2","avatar_url":"https://avatars.githubusercontent.com/u/39061366?v=4","gravatar_id":"","url":"https://api.github.com/users/ManuelMartinG","html_url":"https://github.com/ManuelMartinG","followers_url":"https://api.github.com/users/ManuelMartinG/followers","following_url":"https://api.github.com/users/ManuelMartinG/following{/other_user}","gists_url":"https://api.github.com/users/ManuelMartinG/gists{/gist_id}","starred_url":"https://api.github.com/users/ManuelMartinG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ManuelMartinG/subscriptions","organizations_url":"https://api.github.com/users/ManuelMartinG/orgs","repos_url":"https://api.github.com/users/ManuelMartinG/repos","events_url":"https://api.github.com/users/ManuelMartinG/events{/privacy}","received_events_url":"https://api.github.com/users/ManuelMartinG/received_events","type":"User","site_admin":false}},{"id":4415311585,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDQxNTMxMTU4NQ==","url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/events/4415311585","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-03-05T20:18:29Z","performed_via_github_app":null},{"id":4415311589,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ0MTUzMTE1ODk=","url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/events/4415311589","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-03-05T20:18:29Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/791787169","html_url":"https://github.com/onnx/sklearn-onnx/issues/627#issuecomment-791787169","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/627","id":791787169,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTc4NzE2OQ==","user":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"created_at":"2021-03-05T23:29:09Z","updated_at":"2021-03-05T23:29:46Z","author_association":"COLLABORATOR","body":"You could compute the predictions for all of observations and do a weighted average with weights in {0, 1}, w_{ij} = 1 means observations is predicted by child_estimator[j]. It is not the most efficient way, and really not efficient if the number of child_estimator is high but it works. There are also two ways of doing a loop in ONNX, operators Loop and Scan but they are not always the most efficient way.","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/791787169/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/791906085","html_url":"https://github.com/onnx/sklearn-onnx/issues/627#issuecomment-791906085","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/627","id":791906085,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTkwNjA4NQ==","user":{"login":"ManuelMartinG","id":39061366,"node_id":"MDQ6VXNlcjM5MDYxMzY2","avatar_url":"https://avatars.githubusercontent.com/u/39061366?v=4","gravatar_id":"","url":"https://api.github.com/users/ManuelMartinG","html_url":"https://github.com/ManuelMartinG","followers_url":"https://api.github.com/users/ManuelMartinG/followers","following_url":"https://api.github.com/users/ManuelMartinG/following{/other_user}","gists_url":"https://api.github.com/users/ManuelMartinG/gists{/gist_id}","starred_url":"https://api.github.com/users/ManuelMartinG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ManuelMartinG/subscriptions","organizations_url":"https://api.github.com/users/ManuelMartinG/orgs","repos_url":"https://api.github.com/users/ManuelMartinG/repos","events_url":"https://api.github.com/users/ManuelMartinG/events{/privacy}","received_events_url":"https://api.github.com/users/ManuelMartinG/received_events","type":"User","site_admin":false},"created_at":"2021-03-06T10:04:10Z","updated_at":"2021-03-06T10:04:10Z","author_association":"NONE","body":"Ok! That would be workaround. But in the end, we are executing inference over all of the child_estimators, which in my use case could be >30 because there are >30 parent labels. I only want one child_estimator to make inference as it would be the one selected by the `parent_label`.\r\n\r\nTo sum up and close this issue, what you're saying is that **there's no practical way to embed a decision node inside the ONNX graph so that I can execute just the child_estimator that the `parent_label` says?**. If so, how difficult would that be to implement? (thinking now to contribute)\r\n\r\nThanks for your thoughts! Hope that at least this thread serves well to `sklearn-onnx` users :)","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/791906085/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ManuelMartinG","id":39061366,"node_id":"MDQ6VXNlcjM5MDYxMzY2","avatar_url":"https://avatars.githubusercontent.com/u/39061366?v=4","gravatar_id":"","url":"https://api.github.com/users/ManuelMartinG","html_url":"https://github.com/ManuelMartinG","followers_url":"https://api.github.com/users/ManuelMartinG/followers","following_url":"https://api.github.com/users/ManuelMartinG/following{/other_user}","gists_url":"https://api.github.com/users/ManuelMartinG/gists{/gist_id}","starred_url":"https://api.github.com/users/ManuelMartinG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ManuelMartinG/subscriptions","organizations_url":"https://api.github.com/users/ManuelMartinG/orgs","repos_url":"https://api.github.com/users/ManuelMartinG/repos","events_url":"https://api.github.com/users/ManuelMartinG/events{/privacy}","received_events_url":"https://api.github.com/users/ManuelMartinG/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/791909634","html_url":"https://github.com/onnx/sklearn-onnx/issues/627#issuecomment-791909634","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/627","id":791909634,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTkwOTYzNA==","user":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"created_at":"2021-03-06T10:36:03Z","updated_at":"2021-03-06T10:36:03Z","author_association":"COLLABORATOR","body":"It is possible to that with ONNX but it is not always the most efficient way depending on what you want to do (batch size, number of disinct child_estimator). The ONNX graph can be complex.\r\n\r\nThe converter for the IsolationForest is one of the more complex converter I wrote (https://github.com/onnx/sklearn-onnx/blob/master/skl2onnx/operator_converters/isolation_forest.py, see [IsolationForest ](http://www.xavierdupre.fr/app/mlprodict/helpsphinx/skl_converters/visual-ensemble-022.html?highlight=isolationforest) for a visual representation of the ONNX graph).\r\n\r\nI'm currently thinking about a way to write converters using numpy API. It would be a lot easier to handle complex converters.","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/791909634/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/791911999","html_url":"https://github.com/onnx/sklearn-onnx/issues/627#issuecomment-791911999","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/627","id":791911999,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTkxMTk5OQ==","user":{"login":"ManuelMartinG","id":39061366,"node_id":"MDQ6VXNlcjM5MDYxMzY2","avatar_url":"https://avatars.githubusercontent.com/u/39061366?v=4","gravatar_id":"","url":"https://api.github.com/users/ManuelMartinG","html_url":"https://github.com/ManuelMartinG","followers_url":"https://api.github.com/users/ManuelMartinG/followers","following_url":"https://api.github.com/users/ManuelMartinG/following{/other_user}","gists_url":"https://api.github.com/users/ManuelMartinG/gists{/gist_id}","starred_url":"https://api.github.com/users/ManuelMartinG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ManuelMartinG/subscriptions","organizations_url":"https://api.github.com/users/ManuelMartinG/orgs","repos_url":"https://api.github.com/users/ManuelMartinG/repos","events_url":"https://api.github.com/users/ManuelMartinG/events{/privacy}","received_events_url":"https://api.github.com/users/ManuelMartinG/received_events","type":"User","site_admin":false},"created_at":"2021-03-06T10:57:08Z","updated_at":"2021-03-06T10:57:08Z","author_association":"NONE","body":"That's a scary graph! My onnx graph for these models was getting enormous too... I achieved getting all result labels and probabilities from each `child_estimator` at the end of the graph with an `apply_concat` operation but again, wasn't optimal due to not having the decision branch to select the only one I was interested to make inference. \r\n\r\nThis model is thought to be deployed as a web service for 1-observation inference per request so I wasn't considering batch inference. But the execution efficiency is something we consider very important.\r\n\r\nI think I will convert each child_estimator in a different ONNX model, independently, which is straightforward and don't need explicit converters. Then, I'll make the routing for the model selector with Python.\r\n\r\nThat numpy idea sounds exciting! It's been nice digging deep these days through this library. I'll probably start using it quite heavily in the upcoming months.\r\n\r\nThanks again! ","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/791911999/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ManuelMartinG","id":39061366,"node_id":"MDQ6VXNlcjM5MDYxMzY2","avatar_url":"https://avatars.githubusercontent.com/u/39061366?v=4","gravatar_id":"","url":"https://api.github.com/users/ManuelMartinG","html_url":"https://github.com/ManuelMartinG","followers_url":"https://api.github.com/users/ManuelMartinG/followers","following_url":"https://api.github.com/users/ManuelMartinG/following{/other_user}","gists_url":"https://api.github.com/users/ManuelMartinG/gists{/gist_id}","starred_url":"https://api.github.com/users/ManuelMartinG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ManuelMartinG/subscriptions","organizations_url":"https://api.github.com/users/ManuelMartinG/orgs","repos_url":"https://api.github.com/users/ManuelMartinG/repos","events_url":"https://api.github.com/users/ManuelMartinG/events{/privacy}","received_events_url":"https://api.github.com/users/ManuelMartinG/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/822373460","html_url":"https://github.com/onnx/sklearn-onnx/issues/627#issuecomment-822373460","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/627","id":822373460,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMjM3MzQ2MA==","user":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"created_at":"2021-04-19T10:49:13Z","updated_at":"2021-04-19T10:49:13Z","author_association":"COLLABORATOR","body":"I made a kind of proof of concept about the numpy API for ONNX. It works with decorators. I also wrote a [tutorial](http://www.xavierdupre.fr/app/mlprodict/helpsphinx/tutorial/numpy_api_onnx.html) about it. Here is a current transformer. Method *transform* is implemented with ONNX operators but the syntax is similar to numpy.\r\n\r\n```\r\n@onnxsklearn_class(\"onnx_transform\", op_version=13)\r\nclass DecorrelateTransformerOnnx(TransformerMixin, BaseEstimator):\r\n    def __init__(self, alpha=0.):\r\n        BaseEstimator.__init__(self)\r\n        TransformerMixin.__init__(self)\r\n        self.alpha = alpha\r\n\r\n    def fit(self, X, y=None, sample_weights=None):\r\n        self.pca_ = PCA(X.shape[1])  # pylint: disable=W0201\r\n        self.pca_.fit(X)\r\n        return self\r\n\r\n    def onnx_transform(self, X):\r\n        if X.dtype is None:\r\n            raise AssertionError(\"X.dtype cannot be None.\")\r\n        mean = self.pca_.mean_.astype(X.dtype)\r\n        cmp = self.pca_.components_.T.astype(X.dtype)\r\n        return (X - mean) @ cmp\r\n```","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/822373460/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false}},{"id":4836482197,"node_id":"MDE5OkFkZGVkVG9Qcm9qZWN0RXZlbnQ0ODM2NDgyMTk3","url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/events/4836482197","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"event":"added_to_project","commit_id":null,"commit_url":null,"created_at":"2021-06-03T09:31:49Z","project_card":{"id":62391776,"url":"https://api.github.com/projects/columns/cards/62391776","project_id":12598971,"project_url":"https://api.github.com/projects/12598971","column_name":"Pending user's answer"},"performed_via_github_app":null},{"id":5180210996,"node_id":"MDEyOkxhYmVsZWRFdmVudDUxODAyMTA5OTY=","url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/events/5180210996","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-08-19T11:56:24Z","label":{"name":"pending user response","color":"2465AA"},"performed_via_github_app":null},{"id":5317518426,"node_id":"ATPE_lADOCa0gS84w85zIzwAAAAE88uRa","url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/events/5317518426","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"event":"added_to_project","commit_id":null,"commit_url":null,"created_at":"2021-09-17T07:50:03Z","project_card":{"id":68974442,"url":"https://api.github.com/projects/columns/cards/68974442","project_id":12598926,"project_url":"https://api.github.com/projects/12598926","column_name":"pending user response"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/1326436186","html_url":"https://github.com/onnx/sklearn-onnx/issues/627#issuecomment-1326436186","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/627","id":1326436186,"node_id":"IC_kwDOCa0gS85PD89a","user":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"created_at":"2022-11-24T13:12:15Z","updated_at":"2022-11-24T13:12:15Z","author_association":"COLLABORATOR","body":"Closing the issue, feel free to reopen it.","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/1326436186/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false}},{"id":7885960283,"node_id":"CE_lADOCa0gS84w85zIzwAAAAHWCjRb","url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/events/7885960283","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-11-24T13:12:15Z","state_reason":null,"performed_via_github_app":null},{"id":7885960438,"node_id":"MCIPE_lADOCa0gS84w85zIzwAAAAHWCjT2","url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/events/7885960438","actor":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"event":"moved_columns_in_project","commit_id":null,"commit_url":null,"created_at":"2022-11-24T13:12:16Z","project_card":{"id":68974442,"url":"https://api.github.com/projects/columns/cards/68974442","project_id":12598926,"project_url":"https://api.github.com/projects/12598926","column_name":"Done","previous_column_name":"pending user response"},"performed_via_github_app":null}]