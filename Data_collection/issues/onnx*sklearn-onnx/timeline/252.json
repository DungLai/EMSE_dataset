[{"id":2626813873,"node_id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50MjYyNjgxMzg3Mw==","url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/events/2626813873","actor":{"login":"ikestevens","id":12886679,"node_id":"MDQ6VXNlcjEyODg2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/12886679?v=4","gravatar_id":"","url":"https://api.github.com/users/ikestevens","html_url":"https://github.com/ikestevens","followers_url":"https://api.github.com/users/ikestevens/followers","following_url":"https://api.github.com/users/ikestevens/following{/other_user}","gists_url":"https://api.github.com/users/ikestevens/gists{/gist_id}","starred_url":"https://api.github.com/users/ikestevens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ikestevens/subscriptions","organizations_url":"https://api.github.com/users/ikestevens/orgs","repos_url":"https://api.github.com/users/ikestevens/repos","events_url":"https://api.github.com/users/ikestevens/events{/privacy}","received_events_url":"https://api.github.com/users/ikestevens/received_events","type":"User","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2019-09-11T18:57:31Z","rename":{"from":"Convert MultinomialNB Model to ONNX Error - Non-zero result predicted","to":"Convert MultinomialNB Model to ONNX Prediction Error"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/530576245","html_url":"https://github.com/onnx/sklearn-onnx/issues/252#issuecomment-530576245","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/252","id":530576245,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDU3NjI0NQ==","user":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false},"created_at":"2019-09-11T21:37:02Z","updated_at":"2019-09-11T21:37:02Z","author_association":"COLLABORATOR","body":"Can you share your script? Also, what version of onnxruntime, onnx and skl2onnx are you using?\r\n(onnx_env) prroy-Mac:sklearn-onnx prroy$ pip freeze | grep onnx\r\nonnx==1.5.0\r\nonnxconverter-common==1.5.2\r\nonnxmltools==1.5.0\r\nonnxruntime==0.5.0\r\n\r\nI tried the following script and it seems to work for me.\r\n\r\nimport numpy as np\r\nfrom sklearn.datasets import make_classification\r\nfrom sklearn.naive_bayes import MultinomialNB\r\nfrom sklearn.model_selection import train_test_split\r\nfrom onnxmltools.utils import save_model\r\nfrom onnxruntime import InferenceSession\r\nfrom skl2onnx.convert import convert_sklearn\r\nfrom skl2onnx.common.data_types import FloatTensorType\r\n\r\nX, y = make_classification(n_features=20, n_classes=3, n_samples=1000, random_state=42,\r\n                                             n_redundant=0, n_informative=6)\r\nX = np.abs(X)\r\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.5, random_state=42)\r\nmodel = MultinomialNB().fit(X_train, y_train)\r\nmodel_onnx = convert_sklearn(model, 'mnb', [('input', FloatTensorType([None, X_test.shape[1]]))])\r\nsave_model(model_onnx, 'mnb.onnx')\r\nsess = InferenceSession('mnb.onnx')\r\nres = sess.run(None, input_feed={'input': X_test.astype(np.float32)})\r\nprint(np.mean(np.isclose(model.predict_proba(X_test), list(map(lambda x:\r\n                                                      list(map(lambda y: x[y], x)), res[1])), atol=1e-3)))\r\nprint(np.mean(res[0] == model.predict(X_test)))","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/530576245/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/530955770","html_url":"https://github.com/onnx/sklearn-onnx/issues/252#issuecomment-530955770","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/252","id":530955770,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDk1NTc3MA==","user":{"login":"ikestevens","id":12886679,"node_id":"MDQ6VXNlcjEyODg2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/12886679?v=4","gravatar_id":"","url":"https://api.github.com/users/ikestevens","html_url":"https://github.com/ikestevens","followers_url":"https://api.github.com/users/ikestevens/followers","following_url":"https://api.github.com/users/ikestevens/following{/other_user}","gists_url":"https://api.github.com/users/ikestevens/gists{/gist_id}","starred_url":"https://api.github.com/users/ikestevens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ikestevens/subscriptions","organizations_url":"https://api.github.com/users/ikestevens/orgs","repos_url":"https://api.github.com/users/ikestevens/repos","events_url":"https://api.github.com/users/ikestevens/events{/privacy}","received_events_url":"https://api.github.com/users/ikestevens/received_events","type":"User","site_admin":false},"created_at":"2019-09-12T18:46:16Z","updated_at":"2019-09-12T18:46:16Z","author_association":"NONE","body":"Thank you for the response. After replicating your code and comparing it with mine, I discovered that my issue (dimension mismatch) had to do with the X_test dimensions that I was passing into the sess.run. Once I corrected that, my error was fixed.\r\n\r\nI thought this error had to do with the error I'm getting in Visual Studio when I call the ONNX-ed NB model (I get a prediction \"\" of length zero) in a .NET Framework. Error message is: 'Message: Expected prediction.Label to be \"0\" with a length of 1, but \"\" has a length of zero, differs near (index 0)' So I'll need to resolve that error separately. The ONNX-ed LinearSVC model gets a prediction in VS, but NB does not. Perhaps the LinearSVC model is more lenient for test dimensions, whereas NB is more strict? I'll look into the VS code.\r\n\r\nIf you have any thoughts on why I'm encountering this error in VS, that'd be much appreciated. I'll close this issue though as this looks to be separate from my original error. Thanks!","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/530955770/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ikestevens","id":12886679,"node_id":"MDQ6VXNlcjEyODg2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/12886679?v=4","gravatar_id":"","url":"https://api.github.com/users/ikestevens","html_url":"https://github.com/ikestevens","followers_url":"https://api.github.com/users/ikestevens/followers","following_url":"https://api.github.com/users/ikestevens/following{/other_user}","gists_url":"https://api.github.com/users/ikestevens/gists{/gist_id}","starred_url":"https://api.github.com/users/ikestevens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ikestevens/subscriptions","organizations_url":"https://api.github.com/users/ikestevens/orgs","repos_url":"https://api.github.com/users/ikestevens/repos","events_url":"https://api.github.com/users/ikestevens/events{/privacy}","received_events_url":"https://api.github.com/users/ikestevens/received_events","type":"User","site_admin":false}},{"id":2630197317,"node_id":"MDExOkNsb3NlZEV2ZW50MjYzMDE5NzMxNw==","url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/events/2630197317","actor":{"login":"ikestevens","id":12886679,"node_id":"MDQ6VXNlcjEyODg2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/12886679?v=4","gravatar_id":"","url":"https://api.github.com/users/ikestevens","html_url":"https://github.com/ikestevens","followers_url":"https://api.github.com/users/ikestevens/followers","following_url":"https://api.github.com/users/ikestevens/following{/other_user}","gists_url":"https://api.github.com/users/ikestevens/gists{/gist_id}","starred_url":"https://api.github.com/users/ikestevens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ikestevens/subscriptions","organizations_url":"https://api.github.com/users/ikestevens/orgs","repos_url":"https://api.github.com/users/ikestevens/repos","events_url":"https://api.github.com/users/ikestevens/events{/privacy}","received_events_url":"https://api.github.com/users/ikestevens/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-09-12T18:46:16Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/531376371","html_url":"https://github.com/onnx/sklearn-onnx/issues/252#issuecomment-531376371","issue_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/252","id":531376371,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMTM3NjM3MQ==","user":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false},"created_at":"2019-09-13T20:15:36Z","updated_at":"2019-09-13T20:15:36Z","author_association":"COLLABORATOR","body":"How are you calling prediction in VS? Can you share your code and I can look into it?","reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/comments/531376371/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false}}]