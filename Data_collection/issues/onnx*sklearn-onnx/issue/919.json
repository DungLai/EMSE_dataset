{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/919","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/919/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/919/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/919/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/919","id":1397612105,"node_id":"I_kwDOCa0gS85TTd5J","number":919,"title":"ValueError: Unable to create node 'TreeEnsembleClassifier' with name='WrappedLightGbmBoosterClassifier'.","user":{"login":"Bhuvanamitra","id":7961570,"node_id":"MDQ6VXNlcjc5NjE1NzA=","avatar_url":"https://avatars.githubusercontent.com/u/7961570?v=4","gravatar_id":"","url":"https://api.github.com/users/Bhuvanamitra","html_url":"https://github.com/Bhuvanamitra","followers_url":"https://api.github.com/users/Bhuvanamitra/followers","following_url":"https://api.github.com/users/Bhuvanamitra/following{/other_user}","gists_url":"https://api.github.com/users/Bhuvanamitra/gists{/gist_id}","starred_url":"https://api.github.com/users/Bhuvanamitra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Bhuvanamitra/subscriptions","organizations_url":"https://api.github.com/users/Bhuvanamitra/orgs","repos_url":"https://api.github.com/users/Bhuvanamitra/repos","events_url":"https://api.github.com/users/Bhuvanamitra/events{/privacy}","received_events_url":"https://api.github.com/users/Bhuvanamitra/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2022-10-05T11:00:10Z","updated_at":"2022-10-17T10:00:13Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Hi, I am trying to convert LightGBM Binary Classification model into ONNX.\r\n\r\nI have defined calculate_lightgbm_output_shapes, lightgbm_parser, WrappedLightGbmBoosterClassifier functions and used `update_registered_converter(\r\n            WrappedLightGbmBoosterClassifier,\r\n            'WrappedLightGbmBoosterClassifier',\r\n            calculate_lightgbm_output_shapes,\r\n            convert_lightgbm, parser=lightgbm_parser,\r\n            options={'zipmap': [False, True], 'nocl': [False, True]})` \r\nto update registered converter.\r\n\r\nTo convert the model, I used \r\n`onnx_model = to_onnx(lgm_model, initial_types=[('feature_input', FloatTensorType([None, 2021]))],\r\n            options={WrappedLightGbmBoosterClassifier: {'zipmap': False}}, target_opset={'': 15, 'ai.onnx.ml': 2})`\r\n\r\nBut I am getting the following error\r\n`ValueError: Unable to create node 'TreeEnsembleClassifier' with name='WrappedLightGbmBoosterClassifier'.`\r\n\r\nThis is the error trace : \r\n`File ~/jupyter_dir/jupyter_env/lib/python3.8/site-packages/onnxmltools/convert/lightgbm/operator_converters/LightGbm.py:519, in convert_lightgbm(scope, operator, container)\r\n    515 probability_tensor_name = scope.get_unique_variable_name(\r\n    516     'probability_tensor')\r\n    517 label_tensor_name = scope.get_unique_variable_name('label_tensor')\r\n--> 519 container.add_node(\r\n    520     'TreeEnsembleClassifier', operator.input_full_names,\r\n    521     [label_tensor_name, probability_tensor_name],\r\n    522     op_domain='ai.onnx.ml', **attrs)\r\n    524 prob_tensor = probability_tensor_name\r\n    526 if gbm_model.boosting_type == 'rf':\r\n\r\nFile ~/jupyter_dir/jupyter_env/lib/python3.8/site-packages/skl2onnx/common/_container.py:644, in ModelComponentContainer.add_node(self, op_type, inputs, outputs, op_domain, op_version, name, **attrs)\r\n    641     node = make_node(op_type, inputs, outputs, name=name,\r\n    642                      _dtype=dtype, **attrs)\r\n    643 except ValueError as e:\r\n--> 644     raise ValueError(\"Unable to create node '{}' with name='{}'.\"\r\n    645                      \"\".format(op_type, name)) from e\r\n    646 node.domain = op_domain\r\n    648 self.node_domain_version_pair_sets.add((op_domain, op_version))\r\n\r\nValueError: Unable to create node 'TreeEnsembleClassifier' with name='WrappedLightGbmBoosterClassifier'.`\r\n\r\nI am unable to figure out why this is happening. Please help to resolve this. Thanks in advance. ","closed_by":null,"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/919/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/919/timeline","performed_via_github_app":null,"state_reason":null}