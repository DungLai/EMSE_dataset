{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/649","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/649/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/649/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/649/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/649","id":899945043,"node_id":"MDU6SXNzdWU4OTk5NDUwNDM=","number":649,"title":"Converter fails if parenthesis in input name","user":{"login":"dbanda","id":1960911,"node_id":"MDQ6VXNlcjE5NjA5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/1960911?v=4","gravatar_id":"","url":"https://api.github.com/users/dbanda","html_url":"https://github.com/dbanda","followers_url":"https://api.github.com/users/dbanda/followers","following_url":"https://api.github.com/users/dbanda/following{/other_user}","gists_url":"https://api.github.com/users/dbanda/gists{/gist_id}","starred_url":"https://api.github.com/users/dbanda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbanda/subscriptions","organizations_url":"https://api.github.com/users/dbanda/orgs","repos_url":"https://api.github.com/users/dbanda/repos","events_url":"https://api.github.com/users/dbanda/events{/privacy}","received_events_url":"https://api.github.com/users/dbanda/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-05-24T19:32:00Z","updated_at":"2021-08-26T09:48:54Z","closed_at":"2021-08-26T09:48:54Z","author_association":"NONE","active_lock_reason":null,"body":"The onnx converter creates an invalid model if there are parenthesis in the input name when passed as an initial type. The resulting onnx model is invalid and gives errors on inference .  It looks like onnx is replacing the parenthesis with underscores, is this expected behavior? \r\n\r\n```\r\n# Train a model.\r\nfrom sklearn.datasets import load_iris\r\nfrom sklearn.model_selection import train_test_split\r\nfrom sklearn.ensemble import RandomForestClassifier\r\niris = load_iris()\r\nX, y = iris.data, iris.target\r\nX_train, X_test, y_train, y_test = train_test_split(X, y)\r\nclr = RandomForestClassifier()\r\nclr.fit(X_train, y_train)\r\n\r\n# Convert into ONNX format\r\nfrom skl2onnx import convert_sklearn\r\nfrom skl2onnx.common.data_types import FloatTensorType\r\ninitial_type = [('float(input)', FloatTensorType([None, 4]))]\r\nonx = convert_sklearn(clr, initial_types=initial_type)\r\nwith open(\"rf_iris.onnx\", \"wb\") as f:\r\n    f.write(onx.SerializeToString())\r\n\r\n# Compute the prediction with ONNX Runtime\r\nimport onnxruntime as rt\r\nimport numpy\r\nsess = rt.InferenceSession(\"rf_iris.onnx\")\r\ninput_name = sess.get_inputs()[0].name\r\nlabel_name = sess.get_outputs()[0].name\r\npred_onx = sess.run([label_name], {input_name: X_test.astype(numpy.float32)})[0]\r\n```\r\n\r\nError:\r\n```\r\nTraceback (most recent call last):\r\n  File \"testskl.py\", line 22, in <module>\r\n    sess = rt.InferenceSession(\"rf_iris.onnx\")\r\n  File \"/home/dbanda/miniconda3/envs/raven/lib/python3.6/site-packages/onnxruntime-1.7.0-py3.6-linux-x86_64.egg/onnxruntime/capi/onnxruntime_inference_collection.py\", line 280, in __init__\r\n    self._create_inference_session(providers, provider_options)\r\n  File \"/home/dbanda/miniconda3/envs/raven/lib/python3.6/site-packages/onnxruntime-1.7.0-py3.6-linux-x86_64.egg/onnxruntime/capi/onnxruntime_inference_collection.py\", line 307, in _create_inference_session\r\n    sess = C.InferenceSession(session_options, self._model_path, True, self._read_config_from_model)\r\nonnxruntime.capi.onnxruntime_pybind11_state.Fail: [ONNXRuntimeError] : 1 : FAIL : Load model from rf_iris.onnx failed:This is an invalid model. Node (TreeEnsembleClassifier) input arg (float_input_) does not have type information set by parent node.\r\n```\r\n\r\nEnvironment:\r\n```\r\nonnx==1.6.0\r\nonnxconverter-common==1.8.1\r\nonnxruntime==1.7.0\r\nskl2onnx==1.8.0\r\n```","closed_by":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/649/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/649/timeline","performed_via_github_app":null,"state_reason":"completed"}