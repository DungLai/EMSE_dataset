{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/406","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/406/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/406/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/406/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/406","id":567273487,"node_id":"MDU6SXNzdWU1NjcyNzM0ODc=","number":406,"title":"KNN conversions could be more optimal","user":{"login":"skottmckay","id":979079,"node_id":"MDQ6VXNlcjk3OTA3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/979079?v=4","gravatar_id":"","url":"https://api.github.com/users/skottmckay","html_url":"https://github.com/skottmckay","followers_url":"https://api.github.com/users/skottmckay/followers","following_url":"https://api.github.com/users/skottmckay/following{/other_user}","gists_url":"https://api.github.com/users/skottmckay/gists{/gist_id}","starred_url":"https://api.github.com/users/skottmckay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skottmckay/subscriptions","organizations_url":"https://api.github.com/users/skottmckay/orgs","repos_url":"https://api.github.com/users/skottmckay/repos","events_url":"https://api.github.com/users/skottmckay/events{/privacy}","received_events_url":"https://api.github.com/users/skottmckay/received_events","type":"User","site_admin":false},"labels":[{"id":2026622867,"node_id":"MDU6TGFiZWwyMDI2NjIyODY3","url":"https://api.github.com/repos/onnx/sklearn-onnx/labels/Performance","name":"Performance","color":"37cec7","default":false,"description":""}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-02-19T02:23:28Z","updated_at":"2020-04-30T10:25:38Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"The KNN conversions (SklearnKNNTransformerDistance and SklearnKNNTransformerConnectivity ) produce models with a Sqrt prior to a TopK. As the Sqrt won't change the values selected by TopK, it would be cheaper to do the Sqrt after.\r\n\r\n![image](https://user-images.githubusercontent.com/979079/74795787-91de4080-5312-11ea-9a39-ebb56d50270d.png)\r\n\r\nNote that this problem doesn't occur if CDist is enabled as the Sqrt node goes away in that case.\r\n\r\nFrom @xadupre 'As for sqrt, the fact graph is not optimal is because we have two functions, to build the part of graph related to distance, the other to build the elements. When the distance changes, the converter calls a different function. We should probably revisit that.'","closed_by":null,"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/406/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/406/timeline","performed_via_github_app":null,"state_reason":null}