{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/889","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/889/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/889/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/889/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/889","id":1312787252,"node_id":"I_kwDOCa0gS85OP4s0","number":889,"title":"Converted RandomForestClassifier has wrong prob when having multiple outputs","user":{"login":"icyblade","id":3407450,"node_id":"MDQ6VXNlcjM0MDc0NTA=","avatar_url":"https://avatars.githubusercontent.com/u/3407450?v=4","gravatar_id":"","url":"https://api.github.com/users/icyblade","html_url":"https://github.com/icyblade","followers_url":"https://api.github.com/users/icyblade/followers","following_url":"https://api.github.com/users/icyblade/following{/other_user}","gists_url":"https://api.github.com/users/icyblade/gists{/gist_id}","starred_url":"https://api.github.com/users/icyblade/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icyblade/subscriptions","organizations_url":"https://api.github.com/users/icyblade/orgs","repos_url":"https://api.github.com/users/icyblade/repos","events_url":"https://api.github.com/users/icyblade/events{/privacy}","received_events_url":"https://api.github.com/users/icyblade/received_events","type":"User","site_admin":false},"labels":[{"id":2673847808,"node_id":"MDU6TGFiZWwyNjczODQ3ODA4","url":"https://api.github.com/repos/onnx/sklearn-onnx/labels/pending%20user%20response","name":"pending user response","color":"2465AA","default":false,"description":""},{"id":4532706039,"node_id":"LA_kwDOCa0gS88AAAABDiua9w","url":"https://api.github.com/repos/onnx/sklearn-onnx/labels/done","name":"done","color":"309614","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"xiaowuhu","id":19218188,"node_id":"MDQ6VXNlcjE5MjE4MTg4","avatar_url":"https://avatars.githubusercontent.com/u/19218188?v=4","gravatar_id":"","url":"https://api.github.com/users/xiaowuhu","html_url":"https://github.com/xiaowuhu","followers_url":"https://api.github.com/users/xiaowuhu/followers","following_url":"https://api.github.com/users/xiaowuhu/following{/other_user}","gists_url":"https://api.github.com/users/xiaowuhu/gists{/gist_id}","starred_url":"https://api.github.com/users/xiaowuhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiaowuhu/subscriptions","organizations_url":"https://api.github.com/users/xiaowuhu/orgs","repos_url":"https://api.github.com/users/xiaowuhu/repos","events_url":"https://api.github.com/users/xiaowuhu/events{/privacy}","received_events_url":"https://api.github.com/users/xiaowuhu/received_events","type":"User","site_admin":false},"assignees":[{"login":"xiaowuhu","id":19218188,"node_id":"MDQ6VXNlcjE5MjE4MTg4","avatar_url":"https://avatars.githubusercontent.com/u/19218188?v=4","gravatar_id":"","url":"https://api.github.com/users/xiaowuhu","html_url":"https://github.com/xiaowuhu","followers_url":"https://api.github.com/users/xiaowuhu/followers","following_url":"https://api.github.com/users/xiaowuhu/following{/other_user}","gists_url":"https://api.github.com/users/xiaowuhu/gists{/gist_id}","starred_url":"https://api.github.com/users/xiaowuhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiaowuhu/subscriptions","organizations_url":"https://api.github.com/users/xiaowuhu/orgs","repos_url":"https://api.github.com/users/xiaowuhu/repos","events_url":"https://api.github.com/users/xiaowuhu/events{/privacy}","received_events_url":"https://api.github.com/users/xiaowuhu/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2022-07-21T07:17:36Z","updated_at":"2022-09-17T10:28:24Z","closed_at":"2022-09-17T10:28:24Z","author_association":"NONE","active_lock_reason":null,"body":"# Description\r\nWhen RandomForestClassifier has multiple outputs, the output probabilities from converted ONNX model are not correct (even not sum to 100%).\r\n\r\n# Repro\r\n### Code\r\n```python\r\nimport numpy as np\r\nimport sklearn\r\nimport skl2onnx\r\nimport onnxruntime\r\n\r\nprint(np.__version__)\r\nprint(sklearn.__version__)\r\nprint(skl2onnx.__version__)\r\nprint(onnxruntime.__version__)\r\n\r\nnp.random.seed(0)\r\nmodel = sklearn.ensemble.RandomForestClassifier().fit(\r\n    X=np.random.randint(0, 3, size=(64, 2)),  \r\n    y=np.random.randint(0, 3, size=(64, 2)),  # (64, 1) is fine\r\n)\r\nprint(model.predict_proba([[1, 1]]))\r\n\r\nonnx = skl2onnx.convert_sklearn(\r\n    model=model, \r\n    initial_types=[('X', skl2onnx.common.data_types.Int64TensorType(shape=[None, 2]))],\r\n    options={'zipmap': False},\r\n)\r\nsess = onnxruntime.InferenceSession(onnx.SerializeToString())\r\nprint(sess.run(None, {'X': [[1, 1]]}))\r\n```\r\n\r\n### Output\r\n```\r\n1.21.6\r\n1.0.2\r\n1.11.1\r\n1.9.0\r\n[array([[0.44302889, 0.4279672 , 0.12900391]]), array([[0.44302889, 0.42658636, 0.13038475]])]\r\n[array([[0, 0]], dtype=int64), array([[[0.97, 0.94, 0.59]], [[0.97, 0.97, 0.62]]], dtype=float32)]\r\n```\r\n\r\nAs you can see, the 1st output (from sklearn model) has the probabilities correctly sum to 100%, but the 2nd one (from ONNX model) is not.","closed_by":{"login":"icyblade","id":3407450,"node_id":"MDQ6VXNlcjM0MDc0NTA=","avatar_url":"https://avatars.githubusercontent.com/u/3407450?v=4","gravatar_id":"","url":"https://api.github.com/users/icyblade","html_url":"https://github.com/icyblade","followers_url":"https://api.github.com/users/icyblade/followers","following_url":"https://api.github.com/users/icyblade/following{/other_user}","gists_url":"https://api.github.com/users/icyblade/gists{/gist_id}","starred_url":"https://api.github.com/users/icyblade/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icyblade/subscriptions","organizations_url":"https://api.github.com/users/icyblade/orgs","repos_url":"https://api.github.com/users/icyblade/repos","events_url":"https://api.github.com/users/icyblade/events{/privacy}","received_events_url":"https://api.github.com/users/icyblade/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/889/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/889/timeline","performed_via_github_app":null,"state_reason":"completed"}