{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/489","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/489/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/489/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/489/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/489","id":638155196,"node_id":"MDU6SXNzdWU2MzgxNTUxOTY=","number":489,"title":"Support for target based encoders","user":{"login":"siddharth98765","id":34968251,"node_id":"MDQ6VXNlcjM0OTY4MjUx","avatar_url":"https://avatars.githubusercontent.com/u/34968251?v=4","gravatar_id":"","url":"https://api.github.com/users/siddharth98765","html_url":"https://github.com/siddharth98765","followers_url":"https://api.github.com/users/siddharth98765/followers","following_url":"https://api.github.com/users/siddharth98765/following{/other_user}","gists_url":"https://api.github.com/users/siddharth98765/gists{/gist_id}","starred_url":"https://api.github.com/users/siddharth98765/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/siddharth98765/subscriptions","organizations_url":"https://api.github.com/users/siddharth98765/orgs","repos_url":"https://api.github.com/users/siddharth98765/repos","events_url":"https://api.github.com/users/siddharth98765/events{/privacy}","received_events_url":"https://api.github.com/users/siddharth98765/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-06-13T12:39:03Z","updated_at":"2020-06-16T12:32:44Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"I was trying to implement a Target based encoder for which I was facing difficulty while implementing a converter \r\n\r\n\r\nclass (CategoricalTransformerOnnx(BaseEstimator, util.TransformerWithTargetMixin):\r\n    def __init__(self, cols=None, a=1):\r\n        self.cols = cols\r\n        self.a = a\r\n        self.use_default_cols = cols is None\r\n                \r\n    def fit(self, X, y,**kwargs):\r\n        if self.use_default_cols:\r\n            self.cols = util.get_obj_cols(X)\r\n        else:\r\n            self.cols = util.convert_cols_to_list(self.cols)\r\n\r\n        print(self.cols)\r\n        X_temp = self.transform(X, y)\r\n        return X_temp\r\n     \r\n    #Transformer method we wrote for this transformer \r\n    def transform(self, X , y ):\r\n        for column in self.cols:\r\n            global_mean = y.mean()\r\n            temp = y.groupby(X[column].astype(str)).agg(['cumsum', 'cumcount'])\r\n            X[column] = (temp['cumsum'] - y + global_mean) / (temp['cumcount'] + self.a)           \r\n        return X\r\n\r\ndef cat_shape_calculator(operator):\r\n\r\n    input = operator.inputs[0]      \r\n    N = input.type.shape[0]         # number of observations\r\n    C = 22   # dimension of outputs\r\n\r\n    # new output definition\r\n    #operator.inputs[0].type = FloatTensorType([N, C])\r\n    operator.outputs[0].type = FloatTensorType([N, C])  \r\n    \r\ndef to_onnx_converter(scope, operator, container):\r\n    output = operator.outputs[0]    # output in ONNX graph\r\n    op = operator.raw_operator\r\n    \r\n    print(op)      \r\n    \r\n    name = scope.get_unique_operator_name('CategoricalTransformerOnnx')\r\n    attrs = {'name': scope.get_unique_operator_name('CategoricalTransformerOnnx')}\r\n    #attrs = {}\r\n    container.add_node('CategoricalEncoder',operator.input_full_names,\r\n                       operator.output_full_names, op_domain='ai.onnx.ml',\r\n                       **attrs)\r\n\r\n\r\nupdate_registered_converter(CategoricalTransformerOnnx, 'CustomTransformer',\r\n                            cat_shape_calculator,\r\n                            to_onnx_converter)\r\n\r\nFollowing error\r\nInvalidGraph: [ONNXRuntimeError] : 10 : INVALID_GRAPH : This is an invalid model. Error in Node:CategoricalTransformerOnnx1 : No Op registered for CategoricalEncoder with domain_version of 1\r\nI'm new to onnx platform, so there might some flaw in my code","closed_by":null,"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/489/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/489/timeline","performed_via_github_app":null,"state_reason":null}