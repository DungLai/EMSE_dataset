{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/478","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/478/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/478/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/478/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/478","id":635204134,"node_id":"MDU6SXNzdWU2MzUyMDQxMzQ=","number":478,"title":"Isssue in converting a tfidf-SVM pipeline","user":{"login":"123gkc","id":5730588,"node_id":"MDQ6VXNlcjU3MzA1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/5730588?v=4","gravatar_id":"","url":"https://api.github.com/users/123gkc","html_url":"https://github.com/123gkc","followers_url":"https://api.github.com/users/123gkc/followers","following_url":"https://api.github.com/users/123gkc/following{/other_user}","gists_url":"https://api.github.com/users/123gkc/gists{/gist_id}","starred_url":"https://api.github.com/users/123gkc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/123gkc/subscriptions","organizations_url":"https://api.github.com/users/123gkc/orgs","repos_url":"https://api.github.com/users/123gkc/repos","events_url":"https://api.github.com/users/123gkc/events{/privacy}","received_events_url":"https://api.github.com/users/123gkc/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-06-09T08:04:18Z","updated_at":"2020-09-05T01:48:55Z","closed_at":"2020-06-16T21:51:34Z","author_association":"NONE","active_lock_reason":null,"body":"Hello all -- Recently ran into onnx project in a conference. Trying to export some of my legacy systems to onnx so I can host them on model-server platforms directly.\r\n \r\nI am trying to convert a sklearn pipeline that takes text as input and classifies it using tfidf feature extraction followed by SvmClassifier.\r\nMy code -> \r\n```\r\n    print(X_train.shape)\r\n    print(X_train.head())\r\n    model_pipeline = Pipeline([\r\n        ('vectorizer', TfidfVectorizer(stop_words=stopwords, lowercase=True, use_idf=True, ngram_range=(1,3), max_features=30000)),\r\n        ('feature_selector', SelectKBest(chi2, k=1000)),\r\n        ('classifier', SVC(class_weight='balanced', C=args.C, decision_function_shape='ovo', kernel='rbf', gamma='scale'))  \r\n    ])\r\n    \r\n    model_pipeline.fit(X_train, y_train)\r\n    initial_type = [('left_wing', StringTensorType([None, 1]))]\r\n    onx = convert_sklearn(model_pipeline, \"cv\", initial_types=initial_type)\r\n```\r\n\r\nStdout and stack trace -> \r\n```\r\n(8320,)\r\n0    in david i l c i a l one two zero seven at hot...\r\n1    three payments i can make it three monthly pay...\r\n2    if she's available at if he would like yeah ok...\r\n3    be twenty eight dollars and fifty four cents t...\r\n4    let me can i you on a brief hold really quick ...\r\nName: left_wing, dtype: object\r\nTraceback (most recent call last):\r\n  File \"/home/ec2-user/anaconda3/envs/python3/lib/python3.6/site-packages/skl2onnx/common/_container.py\", line 380, in add_node\r\n    node = make_node(op_type, inputs, outputs, name=name, **attrs)\r\n  File \"/home/ec2-user/anaconda3/envs/python3/lib/python3.6/site-packages/skl2onnx/proto/onnx_helper_modified.py\", line 58, in make_node\r\n    for key, value in sorted(kwargs.items()))\r\n  File \"/home/ec2-user/anaconda3/envs/python3/lib/python3.6/site-packages/skl2onnx/proto/onnx_helper_modified.py\", line 58, in <genexpr>\r\n    for key, value in sorted(kwargs.items()))\r\n  File \"/home/ec2-user/anaconda3/envs/python3/lib/python3.6/site-packages/skl2onnx/proto/onnx_helper_modified.py\", line 173, in make_attribute\r\n    [type(_) for _, __ in zip(value, range(0, 5))]))\r\nValueError: You passed in an iterable attribute but I cannot figure out its applicable type, key='coefficients', type=<class 'scipy.sparse.csr.csr_matrix'>, types=[<class 'scipy.sparse.csr.csr_matrix'>, <class 'scipy.sparse.csr.csr_matrix'>].\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"script.py\", line 112, in <module>\r\n    onx = convert_sklearn(model_pipeline, \"cv\", initial_types=initial_type)\r\n  File \"/home/ec2-user/anaconda3/envs/python3/lib/python3.6/site-packages/skl2onnx/convert.py\", line 138, in convert_sklearn\r\n    dtype=dtype, options=options)\r\n  File \"/home/ec2-user/anaconda3/envs/python3/lib/python3.6/site-packages/skl2onnx/common/_topology.py\", line 977, in convert_topology\r\n    conv(scope, operator, container)\r\n  File \"/home/ec2-user/anaconda3/envs/python3/lib/python3.6/site-packages/skl2onnx/operator_converters/support_vector_machines.py\", line 95, in convert_sklearn_svm\r\n    op_domain='ai.onnx.ml', **svm_attrs)\r\n  File \"/home/ec2-user/anaconda3/envs/python3/lib/python3.6/site-packages/skl2onnx/common/_container.py\", line 383, in add_node\r\n    \"\".format(op_type, name)) from e\r\nValueError: Unable to create node 'SVMClassifier' with name='SVM'.\r\n```\r\n\r\nI am using skl2onnx==1.6.1 and sklearn==0.20.3\r\n\r\nAny pointers/help will be greatly appreciated. Thanks!","closed_by":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/478/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/478/timeline","performed_via_github_app":null,"state_reason":"completed"}