{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/926","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/926/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/926/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/926/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/926","id":1412785996,"node_id":"I_kwDOCa0gS85UNWdM","number":926,"title":"RuntimeError: SimpleImputer takes integer as input but nan values are replaced by float","user":{"login":"singaln","id":34467903,"node_id":"MDQ6VXNlcjM0NDY3OTAz","avatar_url":"https://avatars.githubusercontent.com/u/34467903?v=4","gravatar_id":"","url":"https://api.github.com/users/singaln","html_url":"https://github.com/singaln","followers_url":"https://api.github.com/users/singaln/followers","following_url":"https://api.github.com/users/singaln/following{/other_user}","gists_url":"https://api.github.com/users/singaln/gists{/gist_id}","starred_url":"https://api.github.com/users/singaln/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/singaln/subscriptions","organizations_url":"https://api.github.com/users/singaln/orgs","repos_url":"https://api.github.com/users/singaln/repos","events_url":"https://api.github.com/users/singaln/events{/privacy}","received_events_url":"https://api.github.com/users/singaln/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-10-18T08:24:21Z","updated_at":"2022-11-11T07:20:04Z","closed_at":"2022-11-11T07:20:04Z","author_association":"NONE","active_lock_reason":null,"body":"Dear Developer：\r\n         As the title, I used the numerical feature training model without missing values. When I used skl2onnx for conversion, I got this error: **RuntimeError: SimpleImputer takes integer as input but nan values are replaced by float [2319   18   33    3    3] != [2319.5   18.    33.     3.     3. ]**. I don't understand why the value 2319 is converted to 2319.5. if i delete SimpleImputer function, this code is work.\r\n\r\n```python\r\nfrom sklearn.impute import SimpleImputer\r\nimport numpy as np\r\nfrom skl2onnx import to_onnx\r\nfrom lightgbm import LGBMClassifier\r\nimport pandas as pd\r\nfrom sklearn.pipeline import Pipeline\r\nfrom sklearn.preprocessing import StandardScaler\r\nfrom sklearn.model_selection import train_test_split\r\nfrom sklearn.ensemble import RandomForestClassifier\r\nfrom skl2onnx.common.data_types import FloatTensorType, Int64TensorType, DoubleTensorType, StringTensorType\r\nfrom skl2onnx import convert_sklearn, update_registered_converter\r\nfrom skl2onnx.common.shape_calculator import calculate_linear_classifier_output_shapes\r\nfrom onnxmltools.convert.lightgbm.operator_converters.LightGbm import convert_lightgbm\r\nfrom sklearn.compose import ColumnTransformer\r\n\r\ndata = pd.read_csv('num_data.csv')\r\nprint(pd.isnull(data).any())\r\n\r\nX = data.drop(\"flag\", axis=1)\r\ny = data[\"flag\"]\r\n\r\nnumeric_features = [\"credit_amount\", \"duration_in_month\", \"age_in_years\",\r\n                    \"installment_rate_in_percentage_of_disposable_income\", \"present_residence_since\"]\r\nnumeric_transformer = Pipeline(steps=[\r\n    (\"imputer\", SimpleImputer(strategy=\"median\")),\r\n    (\"scaler\", StandardScaler()),\r\n])\r\npreprocessor = ColumnTransformer(transformers=[\r\n    (\"num\", numeric_transformer, numeric_features)\r\n])\r\n\r\n\r\ndef convert_dataframe_schema(df, drop=None):\r\n    inputs = []\r\n    for k, v in zip(df.columns, df.dtypes):\r\n        if drop is not None and k in drop:\r\n            continue\r\n        if v == 'int64':\r\n            t = Int64TensorType([None, 1])\r\n        elif v == \"float64\":\r\n            t = FloatTensorType([None, 1])\r\n        else:\r\n            t = StringTensorType([None, 1])\r\n        inputs.append((k, t))\r\n    return inputs\r\n\r\n\r\nclf = Pipeline(steps=[\r\n    (\"preprocessor\", preprocessor),\r\n    (\"classifier\",\r\n     LGBMClassifier(n_estimators=200, max_depth=2, learning_rate=0.1, boosting_type=\"gbdt\", importance_type=\"gain\",\r\n                    n_jobs=-1)),\r\n])\r\n\r\nclf.fit(X, y)\r\nprint(clf)\r\n\r\ninitial_inputs = convert_dataframe_schema(X, None)\r\nupdate_registered_converter(LGBMClassifier, 'LightGbmLGBMClassifier',\r\n                            calculate_linear_classifier_output_shapes, convert_lightgbm,\r\n                            options={'nocl': [True, False], 'zipmap': [True, False, 'columns']})\r\nmodel_onnx = convert_sklearn(model=clf, name=\"pipeline_titanic\", initial_types=initial_inputs, verbose=True)\r\nwith open(\"model.onnx\", \"wb\") as f:\r\n    f.write(model_onnx.SerializeToString())\r\n\r\n```\r\n\r\n\r\nThe data:\r\n[new_data.csv](https://github.com/singaln/data/blob/master/new_data.csv)\r\n\r\n**Can you help me solve it， Thanks.**\r\n\r\n","closed_by":{"login":"singaln","id":34467903,"node_id":"MDQ6VXNlcjM0NDY3OTAz","avatar_url":"https://avatars.githubusercontent.com/u/34467903?v=4","gravatar_id":"","url":"https://api.github.com/users/singaln","html_url":"https://github.com/singaln","followers_url":"https://api.github.com/users/singaln/followers","following_url":"https://api.github.com/users/singaln/following{/other_user}","gists_url":"https://api.github.com/users/singaln/gists{/gist_id}","starred_url":"https://api.github.com/users/singaln/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/singaln/subscriptions","organizations_url":"https://api.github.com/users/singaln/orgs","repos_url":"https://api.github.com/users/singaln/repos","events_url":"https://api.github.com/users/singaln/events{/privacy}","received_events_url":"https://api.github.com/users/singaln/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/926/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/926/timeline","performed_via_github_app":null,"state_reason":"completed"}