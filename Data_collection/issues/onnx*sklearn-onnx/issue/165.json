{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/165","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/165/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/165/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/165/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/165","id":452250738,"node_id":"MDU6SXNzdWU0NTIyNTA3Mzg=","number":165,"title":"Issues in OneHotEncoder converter","user":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-06-04T23:25:43Z","updated_at":"2019-09-10T05:28:40Z","closed_at":"2019-09-10T05:28:40Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"1) Doesn't work when categorical_features is set to a subset of feature indices\r\n \r\nenc = OneHotEncoder(categorical_features=[1])\r\nX = np.array([[2, 1], [3, 3], [4, 2]])\r\nenc.fit(X)\r\n\r\nConverting this model gives error because of a typo in call to get_column_indices() [multiple spelled as mutiple]. After fixing this typo:\r\nmodel_onnx = convert_sklearn(enc, 'ohe', [('input', Int64TensorType([1, 2]))])\r\nsave_model(model_onnx, 'ohe.onnx')\r\nsess = InferenceSession('ohe.onnx')\r\nres = sess.run(None, input_feed={'input': np.array([[1, 3]], dtype=np.int64)}) \r\n\r\nModel loading gives the following error:\r\nRuntimeError                              Traceback (most recent call last)\r\n<ipython-input-11-0bad425bfdff> in <module>\r\n      1 model_onnx = convert_sklearn(enc, 'ohe', [('input', Int64TensorType([1, 2]))])\r\n      2 save_model(model_onnx, 'ohe.onnx')\r\n----> 3 sess = InferenceSession('ohe.onnx')\r\n      4 res = sess.run(None, input_feed={'input': np.array([[1, 3]], dtype=np.int64)})\r\n      5 res\r\n\r\n~/Documents/MachineLearning/onnx_projects/onnx_env/lib/python3.6/site-packages/onnxruntime/capi/session.py in __init__(self, path_or_bytes, sess_options)\r\n     27 \r\n     28         if isinstance(path_or_bytes, str):\r\n---> 29             self._sess.load_model(path_or_bytes)\r\n     30         elif isinstance(path_or_bytes, bytes):\r\n     31             self._sess.read_bytes(path_or_bytes)\r\n\r\nRuntimeError: [ONNXRuntimeError] : 1 : GENERAL ERROR : Load model from ohe.onnx failed:Type Error: Type parameter (T1) bound to different types (tensor(float) and tensor(int64) in node (FeatureVectorizer).\r\n\r\nAlso, using float instead of int(or string) features results in output mismatch.\r\n\r\n2) Doesn't work when categorical_features is set with boolean masks.\r\n\r\n3) Doesn't work for string features.\r\n\r\n4) drop='first' or list doesn't work.\r\n\r\n5) dtype=np.str check is not there with int features.\r\n\r\n\r\n","closed_by":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/165/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/165/timeline","performed_via_github_app":null,"state_reason":"completed"}