{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/856","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/856/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/856/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/856/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/856","id":1228950255,"node_id":"I_kwDOCa0gS85JQErv","number":856,"title":"MultiOutputClassifier onnx conversion gives OnnxRuntimeError :10 INVALID_GRAPH","user":{"login":"SwatiTiwarii","id":46405184,"node_id":"MDQ6VXNlcjQ2NDA1MTg0","avatar_url":"https://avatars.githubusercontent.com/u/46405184?v=4","gravatar_id":"","url":"https://api.github.com/users/SwatiTiwarii","html_url":"https://github.com/SwatiTiwarii","followers_url":"https://api.github.com/users/SwatiTiwarii/followers","following_url":"https://api.github.com/users/SwatiTiwarii/following{/other_user}","gists_url":"https://api.github.com/users/SwatiTiwarii/gists{/gist_id}","starred_url":"https://api.github.com/users/SwatiTiwarii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SwatiTiwarii/subscriptions","organizations_url":"https://api.github.com/users/SwatiTiwarii/orgs","repos_url":"https://api.github.com/users/SwatiTiwarii/repos","events_url":"https://api.github.com/users/SwatiTiwarii/events{/privacy}","received_events_url":"https://api.github.com/users/SwatiTiwarii/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-05-08T18:02:52Z","updated_at":"2022-05-23T05:43:09Z","closed_at":"2022-05-23T05:43:09Z","author_association":"NONE","active_lock_reason":null,"body":"I have multiLabel data(each row is float vector of shape 6) set and i am using sklearn MultiOutputClassifier and converting that to onnx.\r\n\r\n\tpipe = Pipeline(steps=[\r\n            ('classifier', MultiOutputClassifier(estimator=LogisticRegression()))])\r\n\tpipe.fit(traindata, trainlabel)\r\n\ty_test = pipe.predict_proba(testdata)\r\n\tfinal_type = [('label', Int64TensorType([1, 3])), ('output', FloatTensorType([1, 3]))] \r\n\tonx6 = to_onnx(pipe, traindata, target_opset=12 ,final_types=final_type ,  options={MultiOutputClassifier: {'zipmap': False}})\r\n \tsess = InferenceSession(onx6.SerializeToString())\r\n\r\n\tpred_onx = sess.run(None, {\"input\": testdata[:5].astype(numpy.float32)})\r\n\tprint(\"predict\", pred_onx[0])\r\n\tprint(\"predict_proba\", pred_onx[1][:1])\r\n\r\n\r\nAbove code is failing on line InferenceSession(onx6.SerializeToString()). \r\n\r\n~\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\onnxruntime\\capi\\onnxruntime_inference_collection.py in __init__(self, path_or_bytes, sess_options, providers, provider_options, **kwargs)\r\n    333 \r\n    334         try:\r\n--> 335             self._create_inference_session(providers, provider_options, disabled_optimizers)\r\n    336         except ValueError:\r\n    337             if self._enable_fallback:\r\n\r\n~\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\onnxruntime\\capi\\onnxruntime_inference_collection.py in _create_inference_session(self, providers, provider_options, disabled_optimizers)\r\n    370             sess = C.InferenceSession(session_options, self._model_path, True, self._read_config_from_model)\r\n    371         else:\r\n--> 372             sess = C.InferenceSession(session_options, self._model_bytes, False, self._read_config_from_model)\r\n    373 \r\n    374         if disabled_optimizers is None:\r\n\r\nInvalidGraph: [ONNXRuntimeError] : 10 : INVALID_GRAPH : This is an invalid model. Type Error: Type 'seq(tensor(double))' of input parameter (probabilities) of operator (Cast) in node (Cast1) is invalid.\r\n\r\n\r\nCan you please let me know hot to convert MultiOutputClassifier to onnx\r\n\r\nonnxconverter-common               1.7.0\r\nonnxmltools                        1.10.0\r\nonnxruntime                        1.11.0\r\nskl2onnx                           1.11.1","closed_by":{"login":"SwatiTiwarii","id":46405184,"node_id":"MDQ6VXNlcjQ2NDA1MTg0","avatar_url":"https://avatars.githubusercontent.com/u/46405184?v=4","gravatar_id":"","url":"https://api.github.com/users/SwatiTiwarii","html_url":"https://github.com/SwatiTiwarii","followers_url":"https://api.github.com/users/SwatiTiwarii/followers","following_url":"https://api.github.com/users/SwatiTiwarii/following{/other_user}","gists_url":"https://api.github.com/users/SwatiTiwarii/gists{/gist_id}","starred_url":"https://api.github.com/users/SwatiTiwarii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SwatiTiwarii/subscriptions","organizations_url":"https://api.github.com/users/SwatiTiwarii/orgs","repos_url":"https://api.github.com/users/SwatiTiwarii/repos","events_url":"https://api.github.com/users/SwatiTiwarii/events{/privacy}","received_events_url":"https://api.github.com/users/SwatiTiwarii/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/856/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/856/timeline","performed_via_github_app":null,"state_reason":"completed"}