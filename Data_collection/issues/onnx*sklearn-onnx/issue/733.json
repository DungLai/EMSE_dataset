{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/733","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/733/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/733/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/733/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/733","id":995517476,"node_id":"I_kwDOCa0gS847VmQk","number":733,"title":"IsolationForest missing access to score_samples() method","user":{"login":"penguinyaro","id":15057517,"node_id":"MDQ6VXNlcjE1MDU3NTE3","avatar_url":"https://avatars.githubusercontent.com/u/15057517?v=4","gravatar_id":"","url":"https://api.github.com/users/penguinyaro","html_url":"https://github.com/penguinyaro","followers_url":"https://api.github.com/users/penguinyaro/followers","following_url":"https://api.github.com/users/penguinyaro/following{/other_user}","gists_url":"https://api.github.com/users/penguinyaro/gists{/gist_id}","starred_url":"https://api.github.com/users/penguinyaro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/penguinyaro/subscriptions","organizations_url":"https://api.github.com/users/penguinyaro/orgs","repos_url":"https://api.github.com/users/penguinyaro/repos","events_url":"https://api.github.com/users/penguinyaro/events{/privacy}","received_events_url":"https://api.github.com/users/penguinyaro/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-09-14T02:30:09Z","updated_at":"2021-09-15T12:01:20Z","closed_at":"2021-09-15T12:01:20Z","author_association":"NONE","active_lock_reason":null,"body":"Similar to #431, it would be helpful to get the anomaly scores from in addition to the prediction.\r\n\r\n```\r\nif_smtp_types = [('float_input', FloatTensorType([None, len(cols)]))] # our input is the number of columns and they are all floats\r\noptions = {id(classifier): {'score_samples': True}}\r\nonx_score = convert_sklearn(classifier, initial_types=if_smtp_types, options=options)\r\nwith open(\"smtp_if_score.onnx\", \"wb\") as f:\r\n    f.write(onx_score.SerializeToString())\r\n```\r\n\r\nHere `classifier` is a trained `sklearn.ensemble.IsolationForest()`.\r\n\r\nI get the following error:\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nNameError                                 Traceback (most recent call last)\r\n<ipython-input-73-1f4325848ac6> in <module>\r\n      3 if_smtp_types = [('float_input', FloatTensorType([None, len(cols)]))] # our input is the number of columns and they are all floats\r\n      4 options = {id(classifier): {'score_samples': True}}\r\n----> 5 onx_score = convert_sklearn(classifier, initial_types=if_smtp_types, options=options)\r\n      6 with open(\"smtp_if_score.onnx\", \"wb\") as f:\r\n      7     f.write(onx_score.SerializeToString())\r\n\r\n~/local/anaconda3/envs/pecoc_boto/lib/python3.8/site-packages/skl2onnx/convert.py in convert_sklearn(model, name, initial_types, doc_string, target_opset, custom_conversion_functions, custom_shape_calculators, custom_parsers, options, intermediate, white_op, black_op, final_types, dtype, verbose)\r\n    160     if verbose >= 1:\r\n    161         print(\"[convert_sklearn] convert_topology\")\r\n--> 162     onnx_model = convert_topology(topology, name, doc_string, target_opset,\r\n    163                                   options=options,\r\n    164                                   remove_identity=not intermediate,\r\n\r\n~/local/anaconda3/envs/pecoc_boto/lib/python3.8/site-packages/skl2onnx/common/_topology.py in convert_topology(topology, model_name, doc_string, target_opset, channel_first_inputs, options, remove_identity, verbose)\r\n   1199                     \"\".format(operator.type,\r\n   1200                               type(getattr(operator, 'raw_model', None))))\r\n-> 1201         container.validate_options(operator)\r\n   1202         conv(scope, operator, container)\r\n   1203 \r\n\r\n~/local/anaconda3/envs/pecoc_boto/lib/python3.8/site-packages/skl2onnx/common/_container.py in validate_options(self, operator)\r\n    664         \"\"\"\r\n    665         skl_op = operator.raw_operator\r\n--> 666         self.get_options(skl_op)\r\n    667 \r\n    668     def get_options(self, model, default_values=None, fail=True):\r\n\r\n~/local/anaconda3/envs/pecoc_boto/lib/python3.8/site-packages/skl2onnx/common/_container.py in get_options(self, model, default_values, fail)\r\n    676         :return: dictionary\r\n    677         \"\"\"\r\n--> 678         return _build_options(\r\n    679             model, self.options, default_values,\r\n    680             self._get_allowed_options(model), fail=fail)\r\n\r\n~/local/anaconda3/envs/pecoc_boto/lib/python3.8/site-packages/skl2onnx/common/_container.py in _build_options(model, defined_options, default_values, allowed_options, fail)\r\n     66             if k not in allowed_options:\r\n     67                 if fail:\r\n---> 68                     raise NameError(\r\n     69                         \"Option '{}' not in {} for class '{}'.\".format(\r\n     70                             k, list(sorted(allowed_options)),\r\n\r\nNameError: Option 'score_samples' not in [] for class 'IsolationForest'.\r\n```","closed_by":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/733/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/733/timeline","performed_via_github_app":null,"state_reason":"completed"}