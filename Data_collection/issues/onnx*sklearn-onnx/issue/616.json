{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/616","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/616/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/616/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/616/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/616","id":808013565,"node_id":"MDU6SXNzdWU4MDgwMTM1NjU=","number":616,"title":"Is it possible to use SimpleImputer to accept input/output of double/float64?","user":{"login":"ag-tcm","id":66845101,"node_id":"MDQ6VXNlcjY2ODQ1MTAx","avatar_url":"https://avatars.githubusercontent.com/u/66845101?v=4","gravatar_id":"","url":"https://api.github.com/users/ag-tcm","html_url":"https://github.com/ag-tcm","followers_url":"https://api.github.com/users/ag-tcm/followers","following_url":"https://api.github.com/users/ag-tcm/following{/other_user}","gists_url":"https://api.github.com/users/ag-tcm/gists{/gist_id}","starred_url":"https://api.github.com/users/ag-tcm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ag-tcm/subscriptions","organizations_url":"https://api.github.com/users/ag-tcm/orgs","repos_url":"https://api.github.com/users/ag-tcm/repos","events_url":"https://api.github.com/users/ag-tcm/events{/privacy}","received_events_url":"https://api.github.com/users/ag-tcm/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2021-02-14T18:10:56Z","updated_at":"2021-08-19T11:58:09Z","closed_at":"2021-08-19T11:58:09Z","author_association":"NONE","active_lock_reason":null,"body":"I've got an sklearn SimpleImputer that I'd like to feed double/float64 tensors and get double/float64 tensors back.\r\nAccording to the [Onnx runtime Imputer docs](https://github.com/onnx/onnx/blob/master/docs/Operators-ml.md#ai.onnx.ml.Imputer), double type tensors are supported. I can create the model without issue, but when I try to use the model I get an exception (from the Java Onnx runtime) while creating the session:\r\n`ai.onnxruntime.OrtException: Error code - ORT_NOT_IMPLEMENTED - message: Could not find an implementation for the node Imputer:Imputer(1)`\r\n\r\nThe workaround appears to be to use the CastTransformer to cast the double input tensor to float as the first item in a pipeline, followed by the SimpleImputer.\r\n\r\nI'd prefer not to apply the cast and use doubles from end to end. \r\n\r\nSide note: I noticed a comment in [test_sklearn_imputer_converter.py](https://github.com/onnx/sklearn-onnx/blob/b7eeb6ce63953c2d3434750596eda7aebad50316/tests/test_sklearn_imputer_converter.py) about sklearn converting \"everything into float before looking into missing values\". Perhaps this is related?\r\n\r\nHere is the code to reproduce the exception as well as the workaround:\r\npython\r\n```\r\nimport skl2onnx\r\nfrom skl2onnx.helpers.onnx_helper import save_onnx_model\r\nfrom skl2onnx.common.data_types import DoubleTensorType\r\nfrom sklearn.impute import SimpleImputer\r\nfrom sklearn.pipeline import Pipeline\r\nfrom skl2onnx.sklapi import CastTransformer\r\nimport numpy as np\r\n\r\nmodel = SimpleImputer(missing_values=float(np.nan), strategy=\"constant\", fill_value=0.5)\r\ndata = np.array([[1, 2], [np.nan, 3], [7, 6]])\r\nmodel.fit(data)\r\n\r\nonnx_model = skl2onnx.to_onnx(model, X=data, initial_types=[('X', DoubleTensorType([None, 2]))], final_types=[('y', DoubleTensorType([None]))])\r\nsave_onnx_model(onnx_model, r'D:\\test_imputer.onnx')\r\n\r\nonnx_model = skl2onnx.to_onnx(Pipeline([('cast32', CastTransformer(dtype=np.float32)), ('imp', model)]), X=data, initial_types=[('X', DoubleTensorType([None, 2]))], final_types=[('y', DoubleTensorType([None]))])\r\nsave_onnx_model(onnx_model, r'D:\\test_imputer2.onnx')\r\n```\r\n\r\njava\r\n```\r\n\t@Test\r\n\tpublic void testImputerDouble() throws OrtException {\r\n\t\tOrtEnvironment env = OrtEnvironment.getEnvironment();\r\n\r\n//Exception is thrown here\r\n\t\tAssertions.assertThrows(OrtException.class, () -> env.createSession(\"D:\\\\test_imputer.onnx\"));\r\n\t\t\r\n//No problem loading this one\r\n\t\tenv.createSession(\"D:\\\\test_imputer2.onnx\");\r\n\t}\r\n```","closed_by":{"login":"xadupre","id":22452781,"node_id":"MDQ6VXNlcjIyNDUyNzgx","avatar_url":"https://avatars.githubusercontent.com/u/22452781?v=4","gravatar_id":"","url":"https://api.github.com/users/xadupre","html_url":"https://github.com/xadupre","followers_url":"https://api.github.com/users/xadupre/followers","following_url":"https://api.github.com/users/xadupre/following{/other_user}","gists_url":"https://api.github.com/users/xadupre/gists{/gist_id}","starred_url":"https://api.github.com/users/xadupre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xadupre/subscriptions","organizations_url":"https://api.github.com/users/xadupre/orgs","repos_url":"https://api.github.com/users/xadupre/repos","events_url":"https://api.github.com/users/xadupre/events{/privacy}","received_events_url":"https://api.github.com/users/xadupre/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/616/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/616/timeline","performed_via_github_app":null,"state_reason":"completed"}