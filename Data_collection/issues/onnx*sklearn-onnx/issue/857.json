{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/857","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/857/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/857/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/857/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/857","id":1228962633,"node_id":"I_kwDOCa0gS85JQHtJ","number":857,"title":"select_model_inputs_outputs changes an output's shape metadata","user":{"login":"jdaciuk","id":77847117,"node_id":"MDQ6VXNlcjc3ODQ3MTE3","avatar_url":"https://avatars.githubusercontent.com/u/77847117?v=4","gravatar_id":"","url":"https://api.github.com/users/jdaciuk","html_url":"https://github.com/jdaciuk","followers_url":"https://api.github.com/users/jdaciuk/followers","following_url":"https://api.github.com/users/jdaciuk/following{/other_user}","gists_url":"https://api.github.com/users/jdaciuk/gists{/gist_id}","starred_url":"https://api.github.com/users/jdaciuk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdaciuk/subscriptions","organizations_url":"https://api.github.com/users/jdaciuk/orgs","repos_url":"https://api.github.com/users/jdaciuk/repos","events_url":"https://api.github.com/users/jdaciuk/events{/privacy}","received_events_url":"https://api.github.com/users/jdaciuk/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-05-08T19:02:26Z","updated_at":"2022-05-09T14:50:01Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"`select_model_inputs_outputs` seems to change the shape metadata of the output selected.  The output itself is still OK.\r\n\r\nFor example\r\n\r\n```python\r\nfrom skl2onnx import convert_sklearn\r\nfrom skl2onnx.common.data_types import FloatTensorType\r\nfrom skl2onnx.helpers.onnx_helper import select_model_inputs_outputs\r\nfrom sklearn.ensemble import RandomForestClassifier\r\nimport numpy as np\r\nimport onnxruntime\r\n\r\n\r\n# Get simple ONNX model\r\nfeature_names = \"abcd\"\r\nX = np.random.normal(size=(500, len(feature_names)))\r\ny = np.random.randint(0, 2, 500)\r\nmodel = RandomForestClassifier(n_estimators=10)\r\nmodel.fit(X, y)\r\n# The output names of onnx_model will be ['output_label', 'output_probability']\r\nonnx_model = convert_sklearn(\r\n    model,\r\n    initial_types=[(\"input\", FloatTensorType((None, len(feature_names))))],\r\n)\r\n\r\n# print session output shape before selecting outputs\r\nwith open(\"model.onnx\", \"wb\") as f:\r\n    f.write(onnx_model.SerializeToString())\r\nsession = onnxruntime.InferenceSession(\"model.onnx\", None)\r\nprint(\"Output 0 shape before using select_model_inputs_outputs\")\r\nprint(session.get_outputs()[0].shape)\r\n\r\n# print session output shape after selecting outputs\r\nonnx_model = select_model_inputs_outputs(onnx_model, outputs=[\"output_label\"])\r\nwith open(\"model.onnx\", \"wb\") as f:\r\n    f.write(onnx_model.SerializeToString())\r\nsession = onnxruntime.InferenceSession(\"model.onnx\", None)\r\nprint(\"\\nOutput 0 shape after using select_model_inputs_outputs\")\r\nprint(session.get_outputs()[0].shape)\r\n```\r\n\r\nPrints\r\n```bash\r\nOutput 0 shape before using select_model_inputs_outputs\r\n[None]\r\n\r\nOutput 0 shape after using select_model_inputs_outputs\r\n[]\r\n```\r\n\r\nIt seems like any original output shape, not just `[None]`, will go to `[]` after selecting it as an output.\r\n\r\nIs this indeed just the output metadata that's being affected?  Is there any workaround for now that would let me correct the shape after selecting model outputs?\r\n\r\nThe larger context is that I'm trying to serve my model with Triton, which complains that my model's output shape is `[]` or empty.\r\n\r\nI'm using `skl2onnx==1.11.1`","closed_by":null,"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/857/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/857/timeline","performed_via_github_app":null,"state_reason":null}