{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/712","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/712/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/712/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/712/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/712","id":976838208,"node_id":"MDU6SXNzdWU5NzY4MzgyMDg=","number":712,"title":"I am facing issues in converting Random forest with complex pipelines ","user":{"login":"RAOMMA","id":26431524,"node_id":"MDQ6VXNlcjI2NDMxNTI0","avatar_url":"https://avatars.githubusercontent.com/u/26431524?v=4","gravatar_id":"","url":"https://api.github.com/users/RAOMMA","html_url":"https://github.com/RAOMMA","followers_url":"https://api.github.com/users/RAOMMA/followers","following_url":"https://api.github.com/users/RAOMMA/following{/other_user}","gists_url":"https://api.github.com/users/RAOMMA/gists{/gist_id}","starred_url":"https://api.github.com/users/RAOMMA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RAOMMA/subscriptions","organizations_url":"https://api.github.com/users/RAOMMA/orgs","repos_url":"https://api.github.com/users/RAOMMA/repos","events_url":"https://api.github.com/users/RAOMMA/events{/privacy}","received_events_url":"https://api.github.com/users/RAOMMA/received_events","type":"User","site_admin":false},"labels":[{"id":2673847808,"node_id":"MDU6TGFiZWwyNjczODQ3ODA4","url":"https://api.github.com/repos/onnx/sklearn-onnx/labels/pending%20user%20response","name":"pending user response","color":"2465AA","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":51,"created_at":"2021-08-23T09:43:36Z","updated_at":"2021-10-10T05:44:15Z","closed_at":"2021-10-10T05:44:15Z","author_association":"NONE","active_lock_reason":null,"body":"categorical_features = ['KLIENTORGNR', 'LEVORGNR']\r\ncategorical_transformer = OneHotEncoder(handle_unknown='ignore')\r\n\r\ntextual_feature = 'clean_FAKTURALINJETEKST'\r\n\r\ncount_vect_transformer = Pipeline(steps=[\r\n    ('count_vect', CountVectorizer(max_df=0.8, min_df=0.05, max_features=1000) )])\r\n\r\npreprocessor = ColumnTransformer(\r\n    transformers=[\r\n        ('cat_transform', categorical_transformer, categorical_features),\r\n        ('count_vector', count_vect_transformer, textual_feature)])\r\n\r\nmodel_RF = RandomForestClassifier(random_state=42, max_depth=50)\r\n\r\n# Append classifier to preprocessing pipeline.\r\n# Now we have a full prediction pipeline.\r\nrf_clf = Pipeline(steps=[('preprocessor', preprocessor),\r\n                      ('classifier', MultiOutputClassifier(estimator = model_RF))])\r\n\r\n\r\n\r\nrf_clf.fit(X_train, y_train)\r\nfrom skl2onnx import convert_sklearn, to_onnx\r\nfrom skl2onnx.common.data_types import FloatTensorType,StringTensorType\r\n#from skl2onnx.operator_converters.RandomForest import convert_sklearn_random_forest_classifier\r\nfeature_input=3\r\ninitial_type = [('strfeat', StringTensorType([None, 2]))]\r\nonx = to_onnx(rf_clf, initial_types=initial_type)\r\nwith open(\"rf_clf.onnx\", \"wb\") as f:\r\n    f.write(onx.SerializeToString())\r\n\r\n**Error IS**\r\n\r\n\r\n\r\nRuntimeError                              Traceback (most recent call last)\r\n/usr/local/lib/python3.7/dist-packages/skl2onnx/_parse.py in parse_sklearn(scope, model, inputs, custom_parsers, final_types)\r\n    542             outputs = _parse_sklearn(\r\n--> 543                 scope.temp(), model, inputs, custom_parsers=custom_parsers)\r\n    544         except RuntimeError:\r\n\r\n16 frames\r\nRuntimeError: Unable to find column name 'KLIENTORGNR'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nRuntimeError                              Traceback (most recent call last)\r\n/usr/local/lib/python3.7/dist-packages/skl2onnx/common/utils.py in get_column_index(i, inputs)\r\n     97             if inp.onnx_name == i:\r\n     98                 return ind, 0\r\n---> 99         raise RuntimeError(\"Unable to find column name '{0}'\".format(i))\r\n    100 \r\n    101 \r\n\r\nRuntimeError: Unable to find column name 'KLIENTORGNR'","closed_by":{"login":"RAOMMA","id":26431524,"node_id":"MDQ6VXNlcjI2NDMxNTI0","avatar_url":"https://avatars.githubusercontent.com/u/26431524?v=4","gravatar_id":"","url":"https://api.github.com/users/RAOMMA","html_url":"https://github.com/RAOMMA","followers_url":"https://api.github.com/users/RAOMMA/followers","following_url":"https://api.github.com/users/RAOMMA/following{/other_user}","gists_url":"https://api.github.com/users/RAOMMA/gists{/gist_id}","starred_url":"https://api.github.com/users/RAOMMA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RAOMMA/subscriptions","organizations_url":"https://api.github.com/users/RAOMMA/orgs","repos_url":"https://api.github.com/users/RAOMMA/repos","events_url":"https://api.github.com/users/RAOMMA/events{/privacy}","received_events_url":"https://api.github.com/users/RAOMMA/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/712/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/712/timeline","performed_via_github_app":null,"state_reason":"completed"}