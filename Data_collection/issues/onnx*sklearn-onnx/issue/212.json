{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/212","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/212/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/212/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/212/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/212","id":461579204,"node_id":"MDU6SXNzdWU0NjE1NzkyMDQ=","number":212,"title":"Multi Output Support","user":{"login":"magnetilo","id":10993772,"node_id":"MDQ6VXNlcjEwOTkzNzcy","avatar_url":"https://avatars.githubusercontent.com/u/10993772?v=4","gravatar_id":"","url":"https://api.github.com/users/magnetilo","html_url":"https://github.com/magnetilo","followers_url":"https://api.github.com/users/magnetilo/followers","following_url":"https://api.github.com/users/magnetilo/following{/other_user}","gists_url":"https://api.github.com/users/magnetilo/gists{/gist_id}","starred_url":"https://api.github.com/users/magnetilo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/magnetilo/subscriptions","organizations_url":"https://api.github.com/users/magnetilo/orgs","repos_url":"https://api.github.com/users/magnetilo/repos","events_url":"https://api.github.com/users/magnetilo/events{/privacy}","received_events_url":"https://api.github.com/users/magnetilo/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-06-27T14:56:15Z","updated_at":"2019-12-30T17:36:58Z","closed_at":"2019-12-30T17:36:57Z","author_association":"NONE","active_lock_reason":null,"body":"Hello everyone,\r\nI would like to convert a multi output random forest classifier to ONNX format. This is not supported at the moment, right?\r\n\r\nHere a simple example:\r\n```python\r\nfrom sklearn.datasets import make_multilabel_classification\r\nfrom sklearn.ensemble import RandomForestClassifier\r\nfrom skl2onnx import convert_sklearn\r\nfrom skl2onnx.common.data_types import FloatTensorType\r\n\r\n# Create multilabel classification dataset:\r\nX, Y = make_multilabel_classification(n_samples=3, n_features=20, n_classes=3, n_labels=2, length=50)\r\n\r\nprint(X)\r\n#[[2. 1. 1. 1. 0. 2. 3. 2. 0. 0. 1. 2. 2. 3. 1. 2. 2. 2. 4. 4.]\r\n# [2. 4. 4. 1. 0. 0. 4. 1. 2. 4. 2. 2. 0. 6. 3. 6. 6. 4. 7. 0.]\r\n# [4. 2. 4. 3. 1. 1. 2. 5. 2. 1. 0. 6. 1. 3. 4. 3. 8. 4. 4. 3.]]\r\n\r\nprint(Y)\r\n#[[1 0 0]\r\n# [1 1 1]\r\n# [0 0 1]]\r\n\r\n\r\n# Train random forest multiple output classifier:\r\nrf = RandomForestClassifier(n_estimators=50, max_depth=5)\r\nrf.fit(X, Y)\r\nY_pred = rf.predict_proba(X) # List of three arrays containing output probabilities \r\n                             # for classes 0 an 1 for each data point\r\n\r\nprint(Y_pred)\r\n#[array([[0.1 , 0.9 ],\r\n#        [0.1 , 0.9 ],\r\n#        [0.66, 0.34]]), \r\n# array([[0.92, 0.08],\r\n#        [0.28, 0.72],\r\n#        [0.9 , 0.1 ]]), \r\n# array([[0.92, 0.08],\r\n#        [0.28, 0.72],\r\n#        [0.9 , 0.1 ]])]\r\n\r\n\r\n# Convert model to ONNX:\r\nonnx = convert_sklearn(rf, initial_types=[('float_input', FloatTensorType([1, X.shape[1]]))])\r\n```\r\n\r\nThe last line throws the following error (for a single-ouput-problem, i.e., n_classes=1, this error does not occur):\r\n\r\n```python\r\n---------------------------------------------------------------------------\r\nAttributeError                            Traceback (most recent call last)\r\n<ipython-input-22-da96fa363e05> in <module>\r\n     37 \r\n     38 # Convert model to ONNX:\r\n---> 39 onnx = convert_sklearn(rf, initial_types=[('float_input', FloatTensorType([1, X.shape[1]]))])\r\n\r\n~\\.conda\\envs\\nn_env\\lib\\site-packages\\skl2onnx\\convert.py in convert_sklearn(model, name, initial_types, doc_string, target_opset, custom_conversion_functions, custom_shape_calculators, custom_parsers, options, intermediate)\r\n    121     topology = parse_sklearn_model(model, initial_types, target_opset,\r\n    122                                    custom_conversion_functions,\r\n--> 123                                    custom_shape_calculators, custom_parsers)\r\n    124 \r\n    125     # Infer variable shapes\r\n\r\n~\\.conda\\envs\\nn_env\\lib\\site-packages\\skl2onnx\\_parse.py in parse_sklearn_model(model, initial_types, target_opset, custom_conversion_functions, custom_shape_calculators, custom_parsers)\r\n    361     # Parse the input scikit-learn model as a Topology object.\r\n    362     outputs = parse_sklearn(scope, model, inputs,\r\n--> 363                             custom_parsers=custom_parsers)\r\n    364 \r\n    365     # The object raw_model_container is a part of the topology we're\r\n\r\n~\\.conda\\envs\\nn_env\\lib\\site-packages\\skl2onnx\\_parse.py in parse_sklearn(scope, model, inputs, custom_parsers)\r\n    297     elif tmodel in sklearn_parsers_map:\r\n    298         outputs = sklearn_parsers_map[tmodel](scope, model, inputs,\r\n--> 299                                               custom_parsers=custom_parsers)\r\n    300     elif isinstance(model, pipeline.Pipeline):\r\n    301         parser = sklearn_parsers_map[pipeline.Pipeline]\r\n\r\n~\\.conda\\envs\\nn_env\\lib\\site-packages\\skl2onnx\\_parse.py in _parse_sklearn_classifier(scope, model, inputs, custom_parsers)\r\n    256     label_type = Int64Type()\r\n    257 \r\n--> 258     if np.issubdtype(model.classes_.dtype, np.floating):\r\n    259         classes = np.array(list(map(lambda x: int(x), classes)))\r\n    260         this_operator.classlabels_int64s = classes\r\n\r\nAttributeError: 'list' object has no attribute 'dtype'\r\n```\r\n\r\n\r\nA similar issue for onnx-tensorflow was reported here: https://github.com/onnx/onnx-tensorflow/issues/203 \r\nWill multi ouput models be supported by sklearn-onnx in the future?","closed_by":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/212/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/212/timeline","performed_via_github_app":null,"state_reason":"completed"}