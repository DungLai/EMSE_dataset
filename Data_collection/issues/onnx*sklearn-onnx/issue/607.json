{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/607","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/607/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/607/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/607/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/607","id":797341605,"node_id":"MDU6SXNzdWU3OTczNDE2MDU=","number":607,"title":"Must provide classlabels_strings or classlabels_int64s but not both.","user":{"login":"janardangaikwad","id":78247193,"node_id":"MDQ6VXNlcjc4MjQ3MTkz","avatar_url":"https://avatars.githubusercontent.com/u/78247193?v=4","gravatar_id":"","url":"https://api.github.com/users/janardangaikwad","html_url":"https://github.com/janardangaikwad","followers_url":"https://api.github.com/users/janardangaikwad/followers","following_url":"https://api.github.com/users/janardangaikwad/following{/other_user}","gists_url":"https://api.github.com/users/janardangaikwad/gists{/gist_id}","starred_url":"https://api.github.com/users/janardangaikwad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janardangaikwad/subscriptions","organizations_url":"https://api.github.com/users/janardangaikwad/orgs","repos_url":"https://api.github.com/users/janardangaikwad/repos","events_url":"https://api.github.com/users/janardangaikwad/events{/privacy}","received_events_url":"https://api.github.com/users/janardangaikwad/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-01-30T05:32:52Z","updated_at":"2021-01-30T15:05:55Z","closed_at":"2021-01-30T15:05:14Z","author_association":"NONE","active_lock_reason":null,"body":"Trying to create an ONNX model for DecisionTreeClassifier for multi-output multi-lable classification. Conversion of the model to ONNX is successful, however, InferenceSession of model causing an error. Need help understanding the error and how to resolve it.\r\n\r\nSource -\r\n\r\nimport sys\r\nimport pandas as pd\r\nfrom onnxconverter_common import Int64TensorType\r\nfrom skl2onnx import convert_sklearn\r\nfrom sklearn.compose import ColumnTransformer\r\nfrom sklearn.impute import SimpleImputer\r\nfrom sklearn.pipeline import Pipeline\r\nfrom sklearn.preprocessing import StandardScaler\r\nfrom sklearn.tree import DecisionTreeClassifier\r\nimport onnxruntime as rt\r\n\r\ndef convert_dataframe_schema(xColumns):\r\n    inputs = []\r\n    for k in xColumns:\r\n        t = Int64TensorType([None, 1])\r\n        inputs.append((k, t))\r\n    return inputs\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    if len(sys.argv) < 2:\r\n        print(\"arguments are not correct\")\r\n        sys.exit()\r\n\r\n    path = sys.argv[1]\r\n    alldata = pd.read_csv(path)\r\n    alldata = alldata.astype('int64', copy=False) #convert to int64\r\n    xColumns = ['C1', 'C2', 'C3', 'C4', 'C5', 'C6', 'C7', 'C8', 'C9', 'C10']\r\n    yColumns = ['Y1', 'Y2','Y3', 'Y4', 'Y5', 'Y6']\r\n    x = alldata.loc[:, xColumns]\r\n    print(alldata)\r\n    y = alldata.loc[:, yColumns]\r\n    numeric_transformer = Pipeline(steps=[\r\n        ('imputer', SimpleImputer(strategy='median')),\r\n        ('scaler', StandardScaler())])\r\n    preprocessor = ColumnTransformer(\r\n        transformers=[\r\n            ('num', numeric_transformer, xColumns),\r\n        ])\r\n    inputs = convert_dataframe_schema(xColumns)\r\n    y = alldata.loc[:, yColumns]\r\n    model = Pipeline(steps=[('precprocessor', preprocessor), ('classifier', DecisionTreeClassifier())])\r\n    model.fit(x, y)\r\n\r\n    modeLName = 'DecisionTreeClassifier' + '.onnx'\r\n    onx = convert_sklearn(model, initial_types=inputs, target_opset=12)\r\n    with open(modeLName, \"wb\") as f:\r\n        f.write(onx.SerializeToString())\r\n    print(\"model generated - \", modeLName)\r\n    sess = rt.InferenceSession(modeLName)\r\n\r\n\r\nError - \r\n2021-01-30 10:59:49.3834024 [W:onnxruntime:, graph.cc:84 onnxruntime::MergeShapeInfo] Error merging shape info for output. 'output_label' source:{,6} target:{}. Falling back to lenient merge.\r\n2021-01-30 10:59:49.3930361 [E:onnxruntime:, inference_session.cc:1268 onnxruntime::InferenceSession::Initialize::<lambda_fa0ef5eee1ef668643e33f2e4e6892e1>::operator ()] Exception during initialization: C:\\a\\1\\s\\onnxruntime\\core\\provid\r\ners\\cpu\\ml\\zipmap.cc:43 onnxruntime::ml::ZipMapOp::ZipMapOp classlabels_strings_.empty() ^ classlabels_int64s_.empty() was false. Must provide classlabels_strings or classlabels_int64s but not both.\r\n\r\nTraceback (most recent call last):\r\n  File \"Tryouts\\test.py\", line 54, in <module>\r\n    sess = rt.InferenceSession(modeLName)\r\n  File \"D:\\Workdir\\Syncplicity\\MineProjects-V1\\ModelView\\venv\\lib\\site-packages\\onnxruntime\\capi\\onnxruntime_inference_collection.py\", line 206, in __init__\r\n    self._create_inference_session(providers, provider_options)\r\n  File \"D:\\Workdir\\Syncplicity\\MineProjects-V1\\ModelView\\venv\\lib\\site-packages\\onnxruntime\\capi\\onnxruntime_inference_collection.py\", line 231, in _create_inference_session\r\n\r\n","closed_by":{"login":"janardangaikwad","id":78247193,"node_id":"MDQ6VXNlcjc4MjQ3MTkz","avatar_url":"https://avatars.githubusercontent.com/u/78247193?v=4","gravatar_id":"","url":"https://api.github.com/users/janardangaikwad","html_url":"https://github.com/janardangaikwad","followers_url":"https://api.github.com/users/janardangaikwad/followers","following_url":"https://api.github.com/users/janardangaikwad/following{/other_user}","gists_url":"https://api.github.com/users/janardangaikwad/gists{/gist_id}","starred_url":"https://api.github.com/users/janardangaikwad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janardangaikwad/subscriptions","organizations_url":"https://api.github.com/users/janardangaikwad/orgs","repos_url":"https://api.github.com/users/janardangaikwad/repos","events_url":"https://api.github.com/users/janardangaikwad/events{/privacy}","received_events_url":"https://api.github.com/users/janardangaikwad/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/607/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/607/timeline","performed_via_github_app":null,"state_reason":"completed"}