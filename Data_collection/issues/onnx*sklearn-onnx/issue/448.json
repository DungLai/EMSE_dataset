{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/448","repository_url":"https://api.github.com/repos/onnx/sklearn-onnx","labels_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/448/labels{/name}","comments_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/448/comments","events_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/448/events","html_url":"https://github.com/onnx/sklearn-onnx/issues/448","id":608898336,"node_id":"MDU6SXNzdWU2MDg4OTgzMzY=","number":448,"title":"OneVsRestClassifier prediction mismatch when raw_scores=True","user":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false},"labels":[{"id":1165979599,"node_id":"MDU6TGFiZWwxMTY1OTc5NTk5","url":"https://api.github.com/repos/onnx/sklearn-onnx/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-04-29T09:11:08Z","updated_at":"2020-05-17T16:06:26Z","closed_at":"2020-05-17T16:06:26Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"```\r\nimport numpy as np\r\nfrom sklearn.datasets import make_classification\r\nfrom sklearn.model_selection import train_test_split\r\nfrom sklearn.multiclass import OneVsRestClassifier\r\nfrom onnxmltools import save_model\r\nfrom onnxruntime import InferenceSession\r\nfrom skl2onnx.common.data_types import FloatTensorType\r\nfrom skl2onnx.convert import convert_sklearn\r\n\r\nX, y = make_classification(n_classes=2, n_samples=1000, random_state=42, n_features=100, n_informative=7)\r\n\r\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.5, random_state=42)\r\nmodel = OneVsRestClassifier(estimator=GradientBoostingClassifier(random_state=42)).fit(X_train, y_train)\r\n\r\noptions = {id(model): {'raw_scores': True}}\r\nonnx_model = convert_sklearn(model, 'lr', [('input', FloatTensorType([None, X_test.shape[1]]))], options=options)\r\nsave_model(onnx_model, 'ovr.onnx')\r\nsess = InferenceSession('ovr.onnx')\r\nres = sess.run(None, input_feed={'input': X_test.astype(np.float32)})\r\nprint(np.mean(res[0] == model.predict(X_test)))\r\n```\r\n>> 0.514\r\n\r\nONNX model always predicts 1 here as it does an argmax on decision function scores, not probabilities(when raw_scores=True).","closed_by":{"login":"prabhat00155","id":7043157,"node_id":"MDQ6VXNlcjcwNDMxNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7043157?v=4","gravatar_id":"","url":"https://api.github.com/users/prabhat00155","html_url":"https://github.com/prabhat00155","followers_url":"https://api.github.com/users/prabhat00155/followers","following_url":"https://api.github.com/users/prabhat00155/following{/other_user}","gists_url":"https://api.github.com/users/prabhat00155/gists{/gist_id}","starred_url":"https://api.github.com/users/prabhat00155/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prabhat00155/subscriptions","organizations_url":"https://api.github.com/users/prabhat00155/orgs","repos_url":"https://api.github.com/users/prabhat00155/repos","events_url":"https://api.github.com/users/prabhat00155/events{/privacy}","received_events_url":"https://api.github.com/users/prabhat00155/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/448/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/onnx/sklearn-onnx/issues/448/timeline","performed_via_github_app":null,"state_reason":"completed"}