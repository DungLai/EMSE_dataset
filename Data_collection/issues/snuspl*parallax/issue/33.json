{"url":"https://api.github.com/repos/snuspl/parallax/issues/33","repository_url":"https://api.github.com/repos/snuspl/parallax","labels_url":"https://api.github.com/repos/snuspl/parallax/issues/33/labels{/name}","comments_url":"https://api.github.com/repos/snuspl/parallax/issues/33/comments","events_url":"https://api.github.com/repos/snuspl/parallax/issues/33/events","html_url":"https://github.com/snuspl/parallax/issues/33","id":617945424,"node_id":"MDU6SXNzdWU2MTc5NDU0MjQ=","number":33,"title":"Training Simple Example issue","user":{"login":"Danielyijun","id":31331016,"node_id":"MDQ6VXNlcjMxMzMxMDE2","avatar_url":"https://avatars.githubusercontent.com/u/31331016?v=4","gravatar_id":"","url":"https://api.github.com/users/Danielyijun","html_url":"https://github.com/Danielyijun","followers_url":"https://api.github.com/users/Danielyijun/followers","following_url":"https://api.github.com/users/Danielyijun/following{/other_user}","gists_url":"https://api.github.com/users/Danielyijun/gists{/gist_id}","starred_url":"https://api.github.com/users/Danielyijun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Danielyijun/subscriptions","organizations_url":"https://api.github.com/users/Danielyijun/orgs","repos_url":"https://api.github.com/users/Danielyijun/repos","events_url":"https://api.github.com/users/Danielyijun/events{/privacy}","received_events_url":"https://api.github.com/users/Danielyijun/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":17,"created_at":"2020-05-14T05:54:37Z","updated_at":"2020-05-15T04:47:20Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"#### Failure Logs\r\n\r\nHi,\r\n\r\nGood day. I have tried to run example: Simple in your code. I have an issue when I was running the example. \r\n\r\n CUDA Toolkit 9.0\r\nCuDNN SDK v7\r\nopenmpi-3.0.0\r\nNCCL 2.1.15(for cuda9.0)\r\n\r\nBelow is the result from running simple example:\r\n\r\n/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:523: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint8 = np.dtype([(\"qint8\", np.int8, 1)])\r\n/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:524: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint8 = np.dtype([(\"quint8\", np.uint8, 1)])\r\n/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint16 = np.dtype([(\"qint16\", np.int16, 1)])\r\n/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:526: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint16 = np.dtype([(\"quint16\", np.uint16, 1)])\r\n/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:527: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint32 = np.dtype([(\"qint32\", np.int32, 1)])\r\n/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:532: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  np_resource = np.dtype([(\"resource\", np.ubyte, 1)])\r\nWARNING:139880522606336:PARALLAX:\u001B[31m\r\n$ ssh -tt -p 22 10.0.0.103 'bash -c \"source /home/jyi/parallax_venv/bin/activate; export PATH=/usr/local/cuda-9.0/bin:$PATH; export LD_LIBRARY_PATH=/usr/local/cuda-9.0/lib64:$LD_LIBRARY_PATH; python3 -m ephemeral_port_reserve\"' </dev/null\u001B[0m\r\nConnection to 10.0.0.103 closed.\r\nWARNING:139880522606336:PARALLAX:\u001B[31m\r\n$ ssh -tt -p 22 10.0.0.103 'bash -c \"source /home/jyi/parallax_venv/bin/activate; export PATH=/usr/local/cuda-9.0/bin:$PATH; export LD_LIBRARY_PATH=/usr/local/cuda-9.0/lib64:$LD_LIBRARY_PATH; python3 -m ephemeral_port_reserve\"' </dev/null\u001B[0m\r\nConnection to 10.0.0.103 closed.\r\nWARNING:139880522606336:PARALLAX:\u001B[31m\r\n$ ssh -tt -p 22 10.0.0.103 'bash -c \"source /home/jyi/parallax_venv/bin/activate; export PATH=/usr/local/cuda-9.0/bin:$PATH; export LD_LIBRARY_PATH=/usr/local/cuda-9.0/lib64:$LD_LIBRARY_PATH; python3 -m ephemeral_port_reserve\"' </dev/null\u001B[0m\r\nConnection to 10.0.0.103 closed.\r\nWARNING:139880522606336:PARALLAX:\u001B[31m\r\n$ ssh -p 22 10.0.0.103 \"mkdir -p /tmp/parallax-jyi\"\u001B[0m\r\nWARNING:139880522606336:PARALLAX:\u001B[31m\r\n$ echo 'bash -c \"export  schroot -c jyi -u jyi;export GRPC_POLL_STRATEGY=poll; CUDA_VISIBLE_DEVICES=1; export PARALLAX_LOG_LEVEL=20; export PARALLAX_HOSTNAME=10.0.0.103; export PARALLAX_SEARCH=False;  source /home/jyi/parallax_venv/bin/activate;  python3 /home/jyi/parallax/parallax/parallax/examples/simple/simple_driver.py \"' | ssh -p 22 10.0.0.103 'cat > /tmp/parallax-jyi/mpi_run.sh; chmod 777 /tmp/parallax-jyi/mpi_run.sh'\u001B[0m\r\nWARNING:139880522606336:PARALLAX:\u001B[31m\r\n$ schroot -c jyi -u jyi;export GRPC_POLL_STRATEGY=poll; export CUDA_VISIBLE_DEVICES=1; source /home/jyi/parallax_venv/bin/activate; export PATH=/Home/.openmpi/bin:$PATH;export LD_LIBRARY_PATH=~/.openmpi/lib/:$LD_LIBRARY_PATH; mpirun -bind-to none -map-by slot --mca plm_rsh_no_tree_spawn 1 --mca orte_base_help_aggregate 0 -x NCCL_DEBUG=INFO  -x PARALLAX_RUN_OPTION=PARALLAX_RUN_MPI -x PARALLAX_RESOURCE_INFO=master_10.0.0.103:40781:^ps_10.0.0.103:44002:^worker_10.0.0.103:46632:1 -np 1 -H 10.0.0.103:1  bash /tmp/parallax-jyi/mpi_run.sh 2>&1\u001B[0m\r\n/bin/sh: 1: schroot: not found\r\n/bin/sh: 1: source: not found\r\nbash: line 0: export: `-c': not a valid identifier\r\nbash: line 0: export: `-u': not a valid identifier\r\n/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:523: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint8 = np.dtype([(\"qint8\", np.int8, 1)])\r\n/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:524: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint8 = np.dtype([(\"quint8\", np.uint8, 1)])\r\n/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint16 = np.dtype([(\"qint16\", np.int16, 1)])\r\n/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:526: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint16 = np.dtype([(\"quint16\", np.uint16, 1)])\r\n/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:527: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint32 = np.dtype([(\"qint32\", np.int32, 1)])\r\n/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:532: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  np_resource = np.dtype([(\"resource\", np.ubyte, 1)])\r\nINFO:139646709864192:PARALLAX:parallel_run(PARALLAX_RUN_MPI)\r\nINFO:139646709864192:PARALLAX:resource master_10.0.0.103:40781:^ps_10.0.0.103:44002:^worker_10.0.0.103:46632:1\r\n--------------------------------------------------------------------------\r\n[[43684,1],0]: A high-performance Open MPI point-to-point messaging module\r\nwas unable to find any relevant network interfaces:\r\n\r\nModule: OpenFabrics (openib)\r\n  Host: node03\r\n\r\nAnother transport will be used instead, although this may result in\r\nlower performance.\r\n\r\nNOTE: You can disable this warning by setting the MCA parameter\r\nbtl_base_warn_component_unused to 0.\r\n--------------------------------------------------------------------------\r\n2020-05-14 05:49:50.857407: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1412] Found device 0 with properties: \r\nname: GeForce GTX 1080 major: 6 minor: 1 memoryClockRate(GHz): 1.7335\r\npciBusID: 0000:03:00.0\r\ntotalMemory: 7.93GiB freeMemory: 7.82GiB\r\n2020-05-14 05:49:50.857465: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1491] Adding visible gpu devices: 0\r\n2020-05-14 05:49:51.340142: I tensorflow/core/common_runtime/gpu/gpu_device.cc:972] Device interconnect StreamExecutor with strength 1 edge matrix:\r\n2020-05-14 05:49:51.340220: I tensorflow/core/common_runtime/gpu/gpu_device.cc:978]      0 \r\n2020-05-14 05:49:51.340235: I tensorflow/core/common_runtime/gpu/gpu_device.cc:991] 0:   N \r\n2020-05-14 05:49:51.340349: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1104] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 7535 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1080, pci bus id: 0000:03:00.0, compute capability: 6.1)\r\n2020-05-14 05:49:51.602832: E tensorflow/core/framework/op_segment.cc:53] Create kernel failed: Not found: No registered 'NGraphVariable' OpKernel for GPU devices compatible with node {{node w}} = NGraphVariable[_class=[\"loc:@w/Assign\"], container=\"\", dtype=DT_FLOAT, just_looking=false, shape=[2,1], shared_name=\"\", _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"]()\r\n\t.  Registered:  device='CPU'\r\n\r\n2020-05-14 05:49:51.602953: E tensorflow/core/common_runtime/executor.cc:630] Executor failed to create kernel. Not found: No registered 'NGraphVariable' OpKernel for GPU devices compatible with node {{node w}} = NGraphVariable[_class=[\"loc:@w/Assign\"], container=\"\", dtype=DT_FLOAT, just_looking=false, shape=[2,1], shared_name=\"\", _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"]()\r\n\t.  Registered:  device='CPU'\r\n\r\n\t [[{{node w}} = NGraphVariable[_class=[\"loc:@w/Assign\"], container=\"\", dtype=DT_FLOAT, just_looking=false, shape=[2,1], shared_name=\"\", _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"]()]]\r\nTraceback (most recent call last):\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1292, in _do_call\r\n    return fn(*args)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1277, in _run_fn\r\n    options, feed_dict, fetch_list, target_list, run_metadata)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1367, in _call_tf_sessionrun\r\n    run_metadata)\r\ntensorflow.python.framework.errors_impl.NotFoundError: No registered 'NGraphVariable' OpKernel for GPU devices compatible with node {{node w}} = NGraphVariable[_class=[\"loc:@w/Assign\"], container=\"\", dtype=DT_FLOAT, just_looking=false, shape=[2,1], shared_name=\"\", _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"]()\r\n\t.  Registered:  device='CPU'\r\n\r\n\t [[{{node w}} = NGraphVariable[_class=[\"loc:@w/Assign\"], container=\"\", dtype=DT_FLOAT, just_looking=false, shape=[2,1], shared_name=\"\", _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"]()]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/jyi/parallax/parallax/parallax/examples/simple/simple_driver.py\", line 137, in <module>\r\n    tf.app.run()\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/platform/app.py\", line 125, in run\r\n    _sys.exit(main(argv))\r\n  File \"/home/jyi/parallax/parallax/parallax/examples/simple/simple_driver.py\", line 133, in main\r\n    parallax.parallel_run(single_gpu_graph, resource_info)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/parallax/core/python/common/runner.py\", line 189, in parallel_run\r\n    return parallax_run_mpi(**kwargs)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/parallax/core/python/mpi/runner.py\", line 192, in parallax_run_mpi\r\n    config=sess_config)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 504, in MonitoredTrainingSession\r\n    stop_grace_period_secs=stop_grace_period_secs)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 921, in __init__\r\n    stop_grace_period_secs=stop_grace_period_secs)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 643, in __init__\r\n    self._sess = _RecoverableSession(self._coordinated_creator)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 1107, in __init__\r\n    _WrappedSession.__init__(self, self._create_session())\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 1112, in _create_session\r\n    return self._sess_creator.create_session()\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 800, in create_session\r\n    self.tf_sess = self._session_creator.create_session()\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 566, in create_session\r\n    init_fn=self._scaffold.init_fn)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/session_manager.py\", line 287, in prepare_session\r\n    sess.run(init_op, feed_dict=init_feed_dict)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 887, in run\r\n    run_metadata_ptr)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1110, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1286, in _do_run\r\n    run_metadata)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1308, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.NotFoundError: No registered 'NGraphVariable' OpKernel for GPU devices compatible with node {{node w}} = NGraphVariable[_class=[\"loc:@w/Assign\"], container=\"\", dtype=DT_FLOAT, just_looking=false, shape=[2,1], shared_name=\"\", _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"]()\r\n\t.  Registered:  device='CPU'\r\n\r\n\t [[{{node w}} = NGraphVariable[_class=[\"loc:@w/Assign\"], container=\"\", dtype=DT_FLOAT, just_looking=false, shape=[2,1], shared_name=\"\", _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"]()]]\r\n\r\nCaused by op 'w', defined at:\r\n  File \"/home/jyi/parallax/parallax/parallax/examples/simple/simple_driver.py\", line 137, in <module>\r\n    tf.app.run()\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/platform/app.py\", line 125, in run\r\n    _sys.exit(main(argv))\r\n  File \"/home/jyi/parallax/parallax/parallax/examples/simple/simple_driver.py\", line 133, in main\r\n    parallax.parallel_run(single_gpu_graph, resource_info)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/parallax/core/python/common/runner.py\", line 189, in parallel_run\r\n    return parallax_run_mpi(**kwargs)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/parallax/core/python/mpi/runner.py\", line 158, in parallax_run_mpi\r\n    tf.train.import_meta_graph(mpi_meta_graph_def)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/saver.py\", line 1666, in import_meta_graph\r\n    meta_graph_or_file, clear_devices, import_scope, **kwargs)[0]\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/saver.py\", line 1688, in _import_meta_graph_with_return_elements\r\n    **kwargs))\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/meta_graph.py\", line 806, in import_scoped_meta_graph_with_return_elements\r\n    return_elements=return_elements)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/util/deprecation.py\", line 488, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/importer.py\", line 442, in import_graph_def\r\n    _ProcessNewOps(graph)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/importer.py\", line 234, in _ProcessNewOps\r\n    for new_op in graph._add_new_tf_operations(compute_devices=False):  # pylint: disable=protected-access\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3438, in _add_new_tf_operations\r\n    for c_op in c_api_util.new_tf_operations(self)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3438, in <listcomp>\r\n    for c_op in c_api_util.new_tf_operations(self)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3297, in _create_op_from_tf_operation\r\n    ret = Operation(c_op, self)\r\n  File \"/home/jyi/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1768, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\nNotFoundError (see above for traceback): No registered 'NGraphVariable' OpKernel for GPU devices compatible with node {{node w}} = NGraphVariable[_class=[\"loc:@w/Assign\"], container=\"\", dtype=DT_FLOAT, just_looking=false, shape=[2,1], shared_name=\"\", _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"]()\r\n\t.  Registered:  device='CPU'\r\n\r\n\t [[{{node w}} = NGraphVariable[_class=[\"loc:@w/Assign\"], container=\"\", dtype=DT_FLOAT, just_looking=false, shape=[2,1], shared_name=\"\", _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"]()]]\r\n\r\n-------------------------------------------------------\r\nPrimary job  terminated normally, but 1 process returned\r\na non-zero exit code. Per user-direction, the job has been aborted.\r\n-------------------------------------------------------\r\n--------------------------------------------------------------------------\r\nmpirun detected that one or more processes exited with non-zero status, thus causing\r\nthe job to be terminated. The first process to do so was:\r\n\r\n  Process name: [[43684,1],0]\r\n  Exit code:    1\r\n--------------------------------------------------------------------------\r\n\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/snuspl/parallax/issues/33/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/snuspl/parallax/issues/33/timeline","performed_via_github_app":null,"state_reason":null}