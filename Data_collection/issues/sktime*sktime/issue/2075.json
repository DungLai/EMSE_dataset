{"url":"https://api.github.com/repos/sktime/sktime/issues/2075","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/2075/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/2075/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/2075/events","html_url":"https://github.com/sktime/sktime/issues/2075","id":1139822830,"node_id":"I_kwDOCVKAsc5D8FDu","number":2075,"title":"[BUG] (in pmdarima package) AutoARIMA outputs flat predictions for close to zero data","user":{"login":"claudia-hm","id":59530433,"node_id":"MDQ6VXNlcjU5NTMwNDMz","avatar_url":"https://avatars.githubusercontent.com/u/59530433?v=4","gravatar_id":"","url":"https://api.github.com/users/claudia-hm","html_url":"https://github.com/claudia-hm","followers_url":"https://api.github.com/users/claudia-hm/followers","following_url":"https://api.github.com/users/claudia-hm/following{/other_user}","gists_url":"https://api.github.com/users/claudia-hm/gists{/gist_id}","starred_url":"https://api.github.com/users/claudia-hm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/claudia-hm/subscriptions","organizations_url":"https://api.github.com/users/claudia-hm/orgs","repos_url":"https://api.github.com/users/claudia-hm/repos","events_url":"https://api.github.com/users/claudia-hm/events{/privacy}","received_events_url":"https://api.github.com/users/claudia-hm/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":3105906374,"node_id":"MDU6TGFiZWwzMTA1OTA2Mzc0","url":"https://api.github.com/repos/sktime/sktime/labels/module:forecasting","name":"module:forecasting","color":"35FCCE","default":false,"description":""}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2022-02-16T10:25:32Z","updated_at":"2022-04-15T19:46:13Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Update by @fkiraly: the below is an issue with `pmdarima` which we directly interface.\r\nWe should watch the issue on `pmdarima` and check whether it needs any action in `sktime`.\r\n\r\n---\r\n\r\nAutoARIMA is returning constant predictions when data is too small., i.e., close to zero.\r\n\r\nInitially, I generated a linear trendy time series with slope 0.5 and intercept 100, plus some noise.\r\n```python\r\na, b = 0.5, 100\r\ny1 = a*np.arange(0,100)+b\r\nnoise = np.random.normal(y1)\r\ny1 = y1 + noise\r\n```\r\nTo obtain forecasts with AutoARIMA I used the following code:\r\n```python\r\nfrom sktime.forecasting.arima import AutoARIMA\r\nfrom sktime.utils.plotting import plot_series\r\n\r\nwindow = 20\r\n\r\ny1_train = pd.Series(y1[:-window], index = pd.Index(np.arange(0, len(y1)-window)))\r\ny1_test = pd.Series(y1[-window:], index = pd.Index(np.arange(len(y1)-window, len(y1))))\r\n\r\nfh = np.arange(1, window+1)\r\nmodel = AutoARIMA()\r\nmodel.fit(y1_train, fh=fh)\r\ny1_pred = model.predict(fh)\r\nplot_series(y1_train, y1_test, y1_pred, labels=[\"train\", \"test\", \"pred\"])\r\n```\r\nwhich gave me the following prediction:\r\n![image](https://user-images.githubusercontent.com/59530433/154240932-bcf7b324-7ac3-457b-8d3d-15b6cf26362a.png)\r\n\r\nThe bug appears when I transform the original time series by dividing it by a high value. I needed to do this to change units.\r\n```python\r\ny1 = y1/(10 ** 6)\r\n```\r\nThis time, when I runned the code above for computing forecasts with AutoARIMA the result is:\r\n![image](https://user-images.githubusercontent.com/59530433/154241448-b8a8224b-d8d1-4794-8ca2-52aacf1b34f5.png)\r\n\r\nand the returned time series is:\r\n```python\r\n80    0.00028\r\n81    0.00028\r\n82    0.00028\r\n83    0.00028\r\n84    0.00028\r\n85    0.00028\r\n86    0.00028\r\n87    0.00028\r\n88    0.00028\r\n89    0.00028\r\n90    0.00028\r\n91    0.00028\r\n92    0.00028\r\n93    0.00028\r\n94    0.00028\r\n95    0.00028\r\n96    0.00028\r\n97    0.00028\r\n98    0.00028\r\n99    0.00028\r\ndtype: float64\r\n```\r\nI expected to obtain a similar forecast to that one of the first image, as the time series is nearly the same. The only transformation that I applied is a change of units.\r\n\r\n\r\n**Versions**\r\nThese are the dependencies and versions:\r\n\r\n```bash\r\n(debug_sktime) claudia@claudia-hm:~/Desktop/debug_sktime$ python --version\r\nPython 3.8.10\r\n(debug_sktime) claudia@claudia-hm:~/Desktop/debug_sktime$ pip freeze\r\ncycler==0.11.0\r\nCython==0.29.27\r\nDeprecated==1.2.13\r\nfonttools==4.29.1\r\njoblib==1.1.0\r\nkiwisolver==1.3.2\r\nllvmlite==0.38.0\r\nmatplotlib==3.5.1\r\nnumba==0.55.1\r\nnumpy==1.21.5\r\npackaging==21.3\r\npandas==1.4.1\r\npatsy==0.5.2\r\nPillow==9.0.1\r\npmdarima==1.8.4\r\npyparsing==3.0.7\r\npython-dateutil==2.8.2\r\npytz==2021.3\r\nscikit-learn==1.0.2\r\nscipy==1.8.0\r\nseaborn==0.11.2\r\nsix==1.16.0\r\nsktime==0.10.0\r\nstatsmodels==0.13.2\r\nthreadpoolctl==3.1.0\r\nurllib3==1.26.8\r\nwrapt==1.13.3\r\n\r\n```\r\n\r\n<!-- Thanks for contributing! -->\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/2075/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/2075/timeline","performed_via_github_app":null,"state_reason":null}