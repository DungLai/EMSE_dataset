{"url":"https://api.github.com/repos/sktime/sktime/issues/550","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/550/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/550/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/550/events","html_url":"https://github.com/sktime/sktime/issues/550","id":771463096,"node_id":"MDU6SXNzdWU3NzE0NjMwOTY=","number":550,"title":"[BUG] Prediction with DatetimeIndex as ForecastingHorizon values","user":{"login":"aiwalter","id":29627036,"node_id":"MDQ6VXNlcjI5NjI3MDM2","avatar_url":"https://avatars.githubusercontent.com/u/29627036?v=4","gravatar_id":"","url":"https://api.github.com/users/aiwalter","html_url":"https://github.com/aiwalter","followers_url":"https://api.github.com/users/aiwalter/followers","following_url":"https://api.github.com/users/aiwalter/following{/other_user}","gists_url":"https://api.github.com/users/aiwalter/gists{/gist_id}","starred_url":"https://api.github.com/users/aiwalter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aiwalter/subscriptions","organizations_url":"https://api.github.com/users/aiwalter/orgs","repos_url":"https://api.github.com/users/aiwalter/repos","events_url":"https://api.github.com/users/aiwalter/events{/privacy}","received_events_url":"https://api.github.com/users/aiwalter/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-12-19T21:57:26Z","updated_at":"2020-12-19T23:32:43Z","closed_at":"2020-12-19T23:00:38Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"**Describe the bug**\r\nThere is an issue with `DatetimeIndex` in `ForecastingHorizon` when doing prediction. Seems this came up by recent commits?\r\n\r\n```python\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-5-0c038f527191> in <module>\r\n      9 forecaster = NaiveForecaster(strategy=\"last\", sp=12)\r\n     10 forecaster.fit(y_train)\r\n---> 11 y_pred = forecaster.predict(fh)\r\n     12 y_pred\r\n\r\n~\\Desktop\\sktime\\sktime\\sktime\\forecasting\\base\\_sktime.py in predict(self, fh, X, return_pred_int, alpha)\r\n    216         self.check_is_fitted()\r\n    217         self._set_fh(fh)\r\n--> 218         return self._predict(self.fh, X, return_pred_int=return_pred_int, alpha=alpha)\r\n    219 \r\n    220     def compute_pred_int(self, y_pred, alpha=DEFAULT_ALPHA):\r\n\r\n~\\Desktop\\sktime\\sktime\\sktime\\forecasting\\base\\_sktime.py in _predict(self, fh, X, return_pred_int, alpha)\r\n    616 \r\n    617         # all values are out-of-sample\r\n--> 618         if fh.is_all_out_of_sample(self.cutoff):\r\n    619             return self._predict_fixed_cutoff(\r\n    620                 fh.to_out_of_sample(self.cutoff), **kwargs\r\n\r\n~\\Desktop\\sktime\\sktime\\sktime\\forecasting\\base\\_fh.py in is_all_out_of_sample(self, cutoff)\r\n    346             cutoff.\r\n    347         \"\"\"\r\n--> 348         return sum(self._is_out_of_sample(cutoff)) == len(self)\r\n    349 \r\n    350     def to_indexer(self, cutoff=None, from_cutoff=True):\r\n\r\n~\\Desktop\\sktime\\sktime\\sktime\\forecasting\\base\\_fh.py in _is_out_of_sample(self, cutoff)\r\n    328         \"\"\"Get index location of out-of-sample values\"\"\"\r\n    329         # return ~self._in_sample_idx(cutoff)\r\n--> 330         return self.to_relative(cutoff).to_pandas() > 0\r\n    331 \r\n    332     def is_all_out_of_sample(self, cutoff=None):\r\n\r\n~\\Desktop\\sktime\\sktime\\sktime\\forecasting\\base\\_fh.py in to_relative(self, cutoff)\r\n    223                 values = _coerce_duration_to_int(values, unit=_get_unit(cutoff))\r\n    224 \r\n--> 225             return self._new(values, is_relative=True)\r\n    226 \r\n    227     @lru_cache(typed=True)\r\n\r\n~\\Desktop\\sktime\\sktime\\sktime\\forecasting\\base\\_fh.py in _new(self, values, is_relative)\r\n    160         if is_relative is None:\r\n    161             is_relative = self.is_relative\r\n--> 162         return type(self)(values, is_relative)\r\n    163 \r\n    164     @property\r\n\r\n~\\Desktop\\sktime\\sktime\\sktime\\forecasting\\base\\_fh.py in __init__(self, values, is_relative)\r\n    137         if not isinstance(is_relative, bool):\r\n    138             raise TypeError(\"`is_relative` must be a boolean\")\r\n--> 139         values = _check_values(values)\r\n    140 \r\n    141         # check types, note that isinstance() does not work here because index\r\n\r\n~\\Desktop\\sktime\\sktime\\sktime\\forecasting\\base\\_fh.py in _check_values(values)\r\n    105     # check values does not contain duplicates\r\n    106     if len(values) != values.nunique():\r\n--> 107         raise ValueError(\"`values` must not contain duplicates.\")\r\n    108 \r\n    109     # return sorted values\r\n\r\nValueError: `values` must not contain duplicates.\r\n```\r\n\r\n**To Reproduce**\r\n```python\r\nfrom sktime.forecasting.all import *\r\n\r\ny = load_airline()\r\ny.index = y.index.to_timestamp()\r\ny_train, y_test = temporal_train_test_split(y, test_size=44)\r\n\r\nfh = ForecastingHorizon(y_test.index[0:5], is_relative=False)\r\n\r\nforecaster = NaiveForecaster(strategy=\"last\", sp=12)\r\nforecaster.fit(y_train)\r\ny_pred = forecaster.predict(fh)\r\ny_pred\r\n```\r\n\r\n**Versions**\r\nCurrent master\r\n","closed_by":{"login":"mloning","id":21020482,"node_id":"MDQ6VXNlcjIxMDIwNDgy","avatar_url":"https://avatars.githubusercontent.com/u/21020482?v=4","gravatar_id":"","url":"https://api.github.com/users/mloning","html_url":"https://github.com/mloning","followers_url":"https://api.github.com/users/mloning/followers","following_url":"https://api.github.com/users/mloning/following{/other_user}","gists_url":"https://api.github.com/users/mloning/gists{/gist_id}","starred_url":"https://api.github.com/users/mloning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mloning/subscriptions","organizations_url":"https://api.github.com/users/mloning/orgs","repos_url":"https://api.github.com/users/mloning/repos","events_url":"https://api.github.com/users/mloning/events{/privacy}","received_events_url":"https://api.github.com/users/mloning/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/550/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/550/timeline","performed_via_github_app":null,"state_reason":"completed"}