{"url":"https://api.github.com/repos/sktime/sktime/issues/805","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/805/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/805/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/805/events","html_url":"https://github.com/sktime/sktime/issues/805","id":856333823,"node_id":"MDU6SXNzdWU4NTYzMzM4MjM=","number":805,"title":"[BUG] _PmdArimaAdapter setting the wrong relative forecasts for frequency 10T","user":{"login":"ParthivNaresh","id":29577911,"node_id":"MDQ6VXNlcjI5NTc3OTEx","avatar_url":"https://avatars.githubusercontent.com/u/29577911?v=4","gravatar_id":"","url":"https://api.github.com/users/ParthivNaresh","html_url":"https://github.com/ParthivNaresh","followers_url":"https://api.github.com/users/ParthivNaresh/followers","following_url":"https://api.github.com/users/ParthivNaresh/following{/other_user}","gists_url":"https://api.github.com/users/ParthivNaresh/gists{/gist_id}","starred_url":"https://api.github.com/users/ParthivNaresh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ParthivNaresh/subscriptions","organizations_url":"https://api.github.com/users/ParthivNaresh/orgs","repos_url":"https://api.github.com/users/ParthivNaresh/repos","events_url":"https://api.github.com/users/ParthivNaresh/events{/privacy}","received_events_url":"https://api.github.com/users/ParthivNaresh/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2021-04-12T20:26:17Z","updated_at":"2022-02-09T14:27:42Z","closed_at":"2022-02-09T14:27:13Z","author_association":"NONE","active_lock_reason":null,"body":"Currently while using a dataset that has a datetime index with a frequency of 10T (separated by 10 minutes), the ForecastingHorizon is setting the relative values to increments of 100. This leads to `n_periods` being set as 100 times the actual length `X.shape[0]` of the exogenous variable used in `predict`. This causes a `ValueError` to be raised by the Arima package `X array dims (n_rows) != n_periods`.\r\n\r\nTo reproduce:\r\n1. Download the dataset `energy_data.csv` from [here](https://archive.ics.uci.edu/ml/machine-learning-databases/00374/).\r\n2. Set the index as `date`.\r\n3. Separate X and y.\r\n4. Set `dates` as the index of `X` convert as a `datetime`.\r\n5. Convert `dates` to PeriodIndex with the appropriate frequency.\r\n6. Initialize `ForecastingHorizon`, followed by fitting and predicting with `AutoArima`.\r\n\r\n```\r\ndata = pd.read_csv(\"../energydata_complete.csv\")\r\ndata = data[:200]\r\ndata.set_index(\"date\", drop=True, inplace=True)\r\nX = data.copy()\r\ny = X.pop(\"Appliances\")\r\n\r\ndates = pd.to_datetime(X.index)\r\nfreq = pd.infer_freq(dates)\r\ndates = dates.to_period(freq=freq)\r\n\r\nX.index = dates\r\ny.index = dates\r\n\r\nfh_ = ForecastingHorizon(y.index[150:200], is_relative=False)\r\n\r\na_clf = sktime_arima.AutoARIMA(start_p=2, start_q=2, max_p=5, max_q=5)\r\nclf = a_clf.fit(X=X[:150], y=y[:150])\r\ny_pred_sk = clf.predict(fh=fh_, X=X[150:200])\r\n```\r\n\r\nThe expectation is that `n_periods = int(fh.to_relative(self.cutoff)[-1])` would set `n_periods` to 50 as there are 50 increments of datetime instances separated by 10 minutes being passed to `predict`. However `fh.to_relative(self.cutoff)` ends up producing this:\r\n\r\n`Int64Index([ 100,  200,  300,  400,  500,  600,  700,  800,  900, 1000, 1100,\r\n            1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2100, 2200,\r\n            2300, 2400, 2500, 2600, 2700, 2800, 2900, 3000, 3100, 3200, 3300,\r\n            3400, 3500, 3600, 3700, 3800, 3900, 4000, 4100, 4200, 4300, 4400,\r\n            4500, 4600, 4700, 4800, 4900, 5000],\r\n           dtype='int64')`\r\n\r\nThis however is the `ForecastingHorizon` that is used to product that relative index with a cutoff of `2016-01-12 17:50`:\r\n\r\n`ForecastingHorizon(['2016-01-12 18:00', '2016-01-12 18:10', '2016-01-12 18:20',\r\n             '2016-01-12 18:30', '2016-01-12 18:40', '2016-01-12 18:50',\r\n             '2016-01-12 19:00', '2016-01-12 19:10', '2016-01-12 19:20',\r\n             '2016-01-12 19:30', '2016-01-12 19:40', '2016-01-12 19:50',\r\n             '2016-01-12 20:00', '2016-01-12 20:10', '2016-01-12 20:20',\r\n             '2016-01-12 20:30', '2016-01-12 20:40', '2016-01-12 20:50',\r\n             '2016-01-12 21:00', '2016-01-12 21:10', '2016-01-12 21:20',\r\n             '2016-01-12 21:30', '2016-01-12 21:40', '2016-01-12 21:50',\r\n             '2016-01-12 22:00', '2016-01-12 22:10', '2016-01-12 22:20',\r\n             '2016-01-12 22:30', '2016-01-12 22:40', '2016-01-12 22:50',\r\n             '2016-01-12 23:00', '2016-01-12 23:10', '2016-01-12 23:20',\r\n             '2016-01-12 23:30', '2016-01-12 23:40', '2016-01-12 23:50',\r\n             '2016-01-13 00:00', '2016-01-13 00:10', '2016-01-13 00:20',\r\n             '2016-01-13 00:30', '2016-01-13 00:40', '2016-01-13 00:50',\r\n             '2016-01-13 01:00', '2016-01-13 01:10', '2016-01-13 01:20',\r\n             '2016-01-13 01:30', '2016-01-13 01:40', '2016-01-13 01:50',\r\n             '2016-01-13 02:00', '2016-01-13 02:10'],\r\n            dtype='period[10T]', name='date', freq='10T', is_relative=False)`\r\n\r\nVersions\r\n- Python (3.8.0)\r\n- Sktime (0.5.3)\r\n- pmdarima (1.8.0)\r\n\r\nSystem:\r\n    python: 3.8.0 | packaged by conda-forge | (default, Nov 22 2019, 19:11:19)  [Clang 9.0.0 (tags/RELEASE_900/final)]\r\nexecutable: /Users/parthiv.naresh/miniconda3/envs/initial_env/bin/python\r\n   machine: macOS-10.15.7-x86_64-i386-64bit\r\n\r\nPython dependencies:\r\n```\r\npip: 21.0.1\r\nsetuptools: 49.6.0.post20201009\r\nsklearn: 0.24.0\r\nsktime: 0.5.3\r\nstatsmodels: 0.12.2\r\nnumpy: 1.19.5\r\nscipy: 1.5.3\r\nCython: 0.29.17\r\npandas: 1.1.5\r\nmatplotlib: 3.3.3\r\njoblib: 1.0.0\r\nnumba: 0.52.0\r\npmdarima: 1.8.0\r\ntsfresh: None\r\n```","closed_by":{"login":"fkiraly","id":7985502,"node_id":"MDQ6VXNlcjc5ODU1MDI=","avatar_url":"https://avatars.githubusercontent.com/u/7985502?v=4","gravatar_id":"","url":"https://api.github.com/users/fkiraly","html_url":"https://github.com/fkiraly","followers_url":"https://api.github.com/users/fkiraly/followers","following_url":"https://api.github.com/users/fkiraly/following{/other_user}","gists_url":"https://api.github.com/users/fkiraly/gists{/gist_id}","starred_url":"https://api.github.com/users/fkiraly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkiraly/subscriptions","organizations_url":"https://api.github.com/users/fkiraly/orgs","repos_url":"https://api.github.com/users/fkiraly/repos","events_url":"https://api.github.com/users/fkiraly/events{/privacy}","received_events_url":"https://api.github.com/users/fkiraly/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/805/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/805/timeline","performed_via_github_app":null,"state_reason":"completed"}