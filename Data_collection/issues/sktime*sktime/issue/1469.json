{"url":"https://api.github.com/repos/sktime/sktime/issues/1469","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/1469/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/1469/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/1469/events","html_url":"https://github.com/sktime/sktime/issues/1469","id":1013403900,"node_id":"I_kwDOCVKAsc48Z1D8","number":1469,"title":"[BUG] ValueError when fitting Prophet and X.index.name=='ds' ","user":{"login":"boukepostma","id":33422940,"node_id":"MDQ6VXNlcjMzNDIyOTQw","avatar_url":"https://avatars.githubusercontent.com/u/33422940?v=4","gravatar_id":"","url":"https://api.github.com/users/boukepostma","html_url":"https://github.com/boukepostma","followers_url":"https://api.github.com/users/boukepostma/followers","following_url":"https://api.github.com/users/boukepostma/following{/other_user}","gists_url":"https://api.github.com/users/boukepostma/gists{/gist_id}","starred_url":"https://api.github.com/users/boukepostma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boukepostma/subscriptions","organizations_url":"https://api.github.com/users/boukepostma/orgs","repos_url":"https://api.github.com/users/boukepostma/repos","events_url":"https://api.github.com/users/boukepostma/events{/privacy}","received_events_url":"https://api.github.com/users/boukepostma/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":3105906374,"node_id":"MDU6TGFiZWwzMTA1OTA2Mzc0","url":"https://api.github.com/repos/sktime/sktime/labels/module:forecasting","name":"module:forecasting","color":"35FCCE","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2021-10-01T14:15:41Z","updated_at":"2021-10-08T11:10:17Z","closed_at":"2021-10-08T11:10:17Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Describe the bug**\r\nThe following error is raised when trying to fit Prophet using X where the name of X's DateTimeIndex is named \"ds\":\r\nValueError: 'ds' is both an index level and a column label, which is ambiguous.\r\n\r\nIt happens in the _merge_X method in the _ProphetAdapter, line 193, because after running line 191, X contains a column and an index called \"ds\".\r\n\r\nA suggested solution would be to add this oneliner before line 189 of .forecasting.base.adapters._fbprophet.py:\r\n```python\r\nX.index.name = \"index\"\r\n```\r\nNote: This assumes that X never has a MultiIndex. Not sure if that ever happens though..\r\n\r\nThis way, the user is still allowed to call X's index \"ds\". Since \"ds\" is the standard name that Prophet users use for their DateTime column, this is the most intuitive and least restrictive solution.\r\n\r\n**To Reproduce**\r\n```python\r\nimport pandas as pd\r\nfrom sktime.datasets import load_airline\r\nfrom sktime.forecasting.fbprophet import Prophet\r\nfrom sktime.forecasting.model_selection import ForecastingGridSearchCV\r\nfrom sktime.forecasting.model_selection import ExpandingWindowSplitter\r\n\r\ny_train = load_airline().to_timestamp(freq='M')\r\n\r\n# Commenting out the following line makes everything run smoothly\r\ny_train.index.name = 'ds'\r\n\r\nX_train = pd.DataFrame({'x1':y_train+200, 'x2':y_train+100})\r\n\r\nforecaster = Prophet(yearly_seasonality=False, weekly_seasonality=False, daily_seasonality=False)\r\nforecaster.fit(y_train, X_train)\r\n```\r\n\r\n**Expected behavior**\r\nNo error\r\n\r\n**Additional context**\r\n\r\n\r\n**Versions**\r\n<details>\r\n\r\nSystem:\r\n    python: 3.9.7 | packaged by conda-forge | (default, Sep 23 2021, 07:24:41) [MSC v.1916 64 bit (AMD64)]\r\nexecutable: C:\\Users\\............\\env\\python.exe\r\n   machine: Windows-10-10.0.19043-SP0\r\n\r\nPython dependencies:\r\n          pip: 21.2.4\r\n   setuptools: 58.1.0\r\n      sklearn: 1.0\r\n       sktime: 0.7.0\r\n  statsmodels: 0.12.2\r\n        numpy: 1.21.2\r\n        scipy: 1.7.1\r\n       Cython: 0.29.24\r\n       pandas: 1.3.3\r\n   matplotlib: 3.4.3\r\n       joblib: 1.0.1\r\n        numba: 0.53.1\r\n     pmdarima: 1.8.3\r\n      tsfresh: None\r\n</details>\r\n","closed_by":{"login":"fkiraly","id":7985502,"node_id":"MDQ6VXNlcjc5ODU1MDI=","avatar_url":"https://avatars.githubusercontent.com/u/7985502?v=4","gravatar_id":"","url":"https://api.github.com/users/fkiraly","html_url":"https://github.com/fkiraly","followers_url":"https://api.github.com/users/fkiraly/followers","following_url":"https://api.github.com/users/fkiraly/following{/other_user}","gists_url":"https://api.github.com/users/fkiraly/gists{/gist_id}","starred_url":"https://api.github.com/users/fkiraly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkiraly/subscriptions","organizations_url":"https://api.github.com/users/fkiraly/orgs","repos_url":"https://api.github.com/users/fkiraly/repos","events_url":"https://api.github.com/users/fkiraly/events{/privacy}","received_events_url":"https://api.github.com/users/fkiraly/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/1469/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/1469/timeline","performed_via_github_app":null,"state_reason":"completed"}