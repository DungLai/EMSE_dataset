{"url":"https://api.github.com/repos/sktime/sktime/issues/518","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/518/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/518/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/518/events","html_url":"https://github.com/sktime/sktime/issues/518","id":755136248,"node_id":"MDU6SXNzdWU3NTUxMzYyNDg=","number":518,"title":"[DOC] Understanding SlidingWindowSplitter better","user":{"login":"ngupta23","id":33585645,"node_id":"MDQ6VXNlcjMzNTg1NjQ1","avatar_url":"https://avatars.githubusercontent.com/u/33585645?v=4","gravatar_id":"","url":"https://api.github.com/users/ngupta23","html_url":"https://github.com/ngupta23","followers_url":"https://api.github.com/users/ngupta23/followers","following_url":"https://api.github.com/users/ngupta23/following{/other_user}","gists_url":"https://api.github.com/users/ngupta23/gists{/gist_id}","starred_url":"https://api.github.com/users/ngupta23/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ngupta23/subscriptions","organizations_url":"https://api.github.com/users/ngupta23/orgs","repos_url":"https://api.github.com/users/ngupta23/repos","events_url":"https://api.github.com/users/ngupta23/events{/privacy}","received_events_url":"https://api.github.com/users/ngupta23/received_events","type":"User","site_admin":false},"labels":[{"id":1203928605,"node_id":"MDU6TGFiZWwxMjAzOTI4NjA1","url":"https://api.github.com/repos/sktime/sktime/labels/documentation","name":"documentation","color":"f4bdf9","default":true,"description":"Documentation & tutorials"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-12-02T10:16:32Z","updated_at":"2021-04-26T18:10:00Z","closed_at":"2021-04-26T18:09:23Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"#### Describe the issue linked to the documentation\r\n\r\nI am trying to understand the `start_with_window` parameter for this class since it is not clear from the outcome. I created a small snippet of code to understand this better (based on the forecasting notebook in the examples folder).\r\n\r\nThe behavior with `start_with_window`=True seems to be OK (this is the classic sliding window behavior) as explained [here](https://eng.uber.com/forecasting-introduction/#:~:text=In%20the%20sliding%20window%20approach,here%20in%20black%2C%20for%20training.&text=On%20the%20other%20hand%2C%20the,of%20data%20to%20work%20with.).\r\n\r\nHowever the behavior with `start_with_window`=False seems to be a little odd. \r\n\r\n1. Why does Fold 1 start with no samples in the training data?\r\n2. Why are there fewer training samples in the first few folds (Fold 1 to Fold 12) than the testing window length. This would not work well for classical techniques such as ARIMA since the accuracy of forecasted values beyond the length of the training data would be really bad due to missing information. Should the training window not be limited to at least the test window size (ideally much bigger). \r\n\r\n### `start_with_window` Evaluation Code\r\n\r\n#### Setup\r\n\r\n```python\r\ny_train = y_train[:36]\r\nlen(y_train)\r\n```\r\n\r\n> 36\r\n\r\n```python\r\nwindow_length=18 # How much of previous history to use to train\r\nfh=np.arange(1, 13)  # How much to forecast (from 1 to 12 or 1 year)\r\nstep_length=1 # How much to step the sliding window\r\n```\r\n\r\n### start_with_window=True\r\n\r\n```python\r\n# For training the regressor\r\ninitial_window = int(len(y_train) * 0.5)\r\n\r\ncv1 = SlidingWindowSplitter(\r\n    initial_window=initial_window,\r\n    window_length=window_length,\r\n    fh=fh,\r\n    step_length=step_length,\r\n    start_with_window=True\r\n)\r\n```\r\n\r\n#### Behavior\r\n\r\n```python\r\nn_splits = cv1.get_n_splits(y_train)\r\nprint(\"-\"*30)\r\nprint(f\"Number of Folds: {n_splits}\")\r\nprint(\"-\"*30)\r\n\r\nfor i, (train, test) in enumerate(cv1.split(y_train)):\r\n    print(f\"\\nFold:{i+1}\")\r\n    print(f\"Train Indices: {train} \\nTest Indices:  {test}\")\r\n```\r\n\r\n> ------------------------------\r\n> Number of Folds: 7\r\n> ------------------------------\r\n> \r\n> Fold:1\r\n> Train Indices: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17] \r\n> Test Indices:  [18 19 20 21 22 23 24 25 26 27 28 29]\r\n> \r\n> Fold:2\r\n> Train Indices: [ 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18] \r\n> Test Indices:  [19 20 21 22 23 24 25 26 27 28 29 30]\r\n> \r\n> Fold:3\r\n> Train Indices: [ 2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19] \r\n> Test Indices:  [20 21 22 23 24 25 26 27 28 29 30 31]\r\n> \r\n> Fold:4\r\n> Train Indices: [ 3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20] \r\n> Test Indices:  [21 22 23 24 25 26 27 28 29 30 31 32]\r\n> \r\n> Fold:5\r\n> Train Indices: [ 4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21] \r\n> Test Indices:  [22 23 24 25 26 27 28 29 30 31 32 33]\r\n> \r\n> Fold:6\r\n> Train Indices: [ 5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22] \r\n> Test Indices:  [23 24 25 26 27 28 29 30 31 32 33 34]\r\n> \r\n> Fold:7\r\n> Train Indices: [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23] \r\n> Test Indices:  [24 25 26 27 28 29 30 31 32 33 34 35]\r\n\r\n\r\n### start_with_window=False\r\n\r\n```python\r\n# For training the regressor\r\ninitial_window = int(len(y_train) * 0.5)\r\n\r\ncv2 = SlidingWindowSplitter(\r\n    initial_window=initial_window,\r\n    window_length=window_length,\r\n    fh=fh,\r\n    step_length=step_length,\r\n    start_with_window=False\r\n)\r\n```\r\n\r\n#### Behavior\r\n\r\n```python\r\nn_splits = cv2.get_n_splits(y_train)\r\nprint(\"-\"*30)\r\nprint(f\"Number of Folds: {n_splits}\")\r\nprint(\"-\"*30)\r\n\r\nfor i, (train, test) in enumerate(cv2.split(y_train)):\r\n    print(f\"\\nFold:{i+1}\")\r\n    print(f\"Train Indices: {train} \\nTest Indices:  {test}\")\r\n```\r\n\r\n------------------------------\r\nNumber of Folds: 25\r\n------------------------------\r\n\r\n> Fold:1\r\n> Train Indices: [] \r\n> Test Indices:  [ 0  1  2  3  4  5  6  7  8  9 10 11]\r\n> \r\n> Fold:2\r\n> Train Indices: [0] \r\n> Test Indices:  [ 1  2  3  4  5  6  7  8  9 10 11 12]\r\n> \r\n> Fold:3\r\n> Train Indices: [0 1] \r\n> Test Indices:  [ 2  3  4  5  6  7  8  9 10 11 12 13]\r\n> \r\n> Fold:4\r\n> Train Indices: [0 1 2] \r\n> Test Indices:  [ 3  4  5  6  7  8  9 10 11 12 13 14]\r\n> \r\n> Fold:5\r\n> Train Indices: [0 1 2 3] \r\n> Test Indices:  [ 4  5  6  7  8  9 10 11 12 13 14 15]\r\n> \r\n> Fold:6\r\n> Train Indices: [0 1 2 3 4] \r\n> Test Indices:  [ 5  6  7  8  9 10 11 12 13 14 15 16]\r\n> \r\n> Fold:7\r\n> Train Indices: [0 1 2 3 4 5] \r\n> Test Indices:  [ 6  7  8  9 10 11 12 13 14 15 16 17]\r\n> \r\n> Fold:8\r\n> Train Indices: [0 1 2 3 4 5 6] \r\n> Test Indices:  [ 7  8  9 10 11 12 13 14 15 16 17 18]\r\n> \r\n> Fold:9\r\n> Train Indices: [0 1 2 3 4 5 6 7] \r\n> Test Indices:  [ 8  9 10 11 12 13 14 15 16 17 18 19]\r\n> \r\n> Fold:10\r\n> Train Indices: [0 1 2 3 4 5 6 7 8] \r\n> Test Indices:  [ 9 10 11 12 13 14 15 16 17 18 19 20]\r\n> \r\n> Fold:11\r\n> Train Indices: [0 1 2 3 4 5 6 7 8 9] \r\n> Test Indices:  [10 11 12 13 14 15 16 17 18 19 20 21]\r\n> \r\n> Fold:12\r\n> Train Indices: [ 0  1  2  3  4  5  6  7  8  9 10] \r\n> Test Indices:  [11 12 13 14 15 16 17 18 19 20 21 22]\r\n> \r\n> Fold:13\r\n> Train Indices: [ 0  1  2  3  4  5  6  7  8  9 10 11] \r\n> Test Indices:  [12 13 14 15 16 17 18 19 20 21 22 23]\r\n> \r\n> Fold:14\r\n> Train Indices: [ 0  1  2  3  4  5  6  7  8  9 10 11 12] \r\n> Test Indices:  [13 14 15 16 17 18 19 20 21 22 23 24]\r\n> \r\n> Fold:15\r\n> Train Indices: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13] \r\n> Test Indices:  [14 15 16 17 18 19 20 21 22 23 24 25]\r\n> \r\n> Fold:16\r\n> Train Indices: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14] \r\n> Test Indices:  [15 16 17 18 19 20 21 22 23 24 25 26]\r\n> \r\n> Fold:17\r\n> Train Indices: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15] \r\n> Test Indices:  [16 17 18 19 20 21 22 23 24 25 26 27]\r\n> \r\n> Fold:18\r\n> Train Indices: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16] \r\n> Test Indices:  [17 18 19 20 21 22 23 24 25 26 27 28]\r\n> \r\n> Fold:19\r\n> Train Indices: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17] \r\n> Test Indices:  [18 19 20 21 22 23 24 25 26 27 28 29]\r\n> \r\n> Fold:20\r\n> Train Indices: [ 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18] \r\n> Test Indices:  [19 20 21 22 23 24 25 26 27 28 29 30]\r\n> \r\n> Fold:21\r\n> Train Indices: [ 2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19] \r\n> Test Indices:  [20 21 22 23 24 25 26 27 28 29 30 31]\r\n> \r\n> Fold:22\r\n> Train Indices: [ 3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20] \r\n> Test Indices:  [21 22 23 24 25 26 27 28 29 30 31 32]\r\n> \r\n> Fold:23\r\n> Train Indices: [ 4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21] \r\n> Test Indices:  [22 23 24 25 26 27 28 29 30 31 32 33]\r\n> \r\n> Fold:24\r\n> Train Indices: [ 5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22] \r\n> Test Indices:  [23 24 25 26 27 28 29 30 31 32 33 34]\r\n> \r\n> Fold:25\r\n> Train Indices: [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23] \r\n> Test Indices:  [24 25 26 27 28 29 30 31 32 33 34 35]\r\n\r\n\r\n#### Suggest a potential alternative/fix\r\n\r\nFor `start_with_window`=False,\r\n\r\n1. Can the training window be made larger than the test window in all folds\r\n2. If not, can a warning be given to the user?\r\n3. Can the default behavior of this argument be changed to `True` instead of `False` as that seems to be working correctly https://github.com/alan-turing-institute/sktime/blob/139b9291fb634cce367f714a6132212b0172e199/sktime/forecasting/model_selection/_split.py#L183 \r\n4. And I think this is linked to https://github.com/alan-turing-institute/sktime/issues/477. Some way to visualize this would be really nice for the end user.\r\n","closed_by":{"login":"mloning","id":21020482,"node_id":"MDQ6VXNlcjIxMDIwNDgy","avatar_url":"https://avatars.githubusercontent.com/u/21020482?v=4","gravatar_id":"","url":"https://api.github.com/users/mloning","html_url":"https://github.com/mloning","followers_url":"https://api.github.com/users/mloning/followers","following_url":"https://api.github.com/users/mloning/following{/other_user}","gists_url":"https://api.github.com/users/mloning/gists{/gist_id}","starred_url":"https://api.github.com/users/mloning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mloning/subscriptions","organizations_url":"https://api.github.com/users/mloning/orgs","repos_url":"https://api.github.com/users/mloning/repos","events_url":"https://api.github.com/users/mloning/events{/privacy}","received_events_url":"https://api.github.com/users/mloning/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/518/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/518/timeline","performed_via_github_app":null,"state_reason":"completed"}