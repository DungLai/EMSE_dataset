{"url":"https://api.github.com/repos/sktime/sktime/issues/1876","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/1876/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/1876/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/1876/events","html_url":"https://github.com/sktime/sktime/issues/1876","id":1103752402,"node_id":"I_kwDOCVKAsc5ByezS","number":1876,"title":"[BUG] Forecasting does not work with 10 minute interval data in PeriodIndex form","user":{"login":"ngupta23","id":33585645,"node_id":"MDQ6VXNlcjMzNTg1NjQ1","avatar_url":"https://avatars.githubusercontent.com/u/33585645?v=4","gravatar_id":"","url":"https://api.github.com/users/ngupta23","html_url":"https://github.com/ngupta23","followers_url":"https://api.github.com/users/ngupta23/followers","following_url":"https://api.github.com/users/ngupta23/following{/other_user}","gists_url":"https://api.github.com/users/ngupta23/gists{/gist_id}","starred_url":"https://api.github.com/users/ngupta23/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ngupta23/subscriptions","organizations_url":"https://api.github.com/users/ngupta23/orgs","repos_url":"https://api.github.com/users/ngupta23/repos","events_url":"https://api.github.com/users/ngupta23/events{/privacy}","received_events_url":"https://api.github.com/users/ngupta23/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":3105906374,"node_id":"MDU6TGFiZWwzMTA1OTA2Mzc0","url":"https://api.github.com/repos/sktime/sktime/labels/module:forecasting","name":"module:forecasting","color":"35FCCE","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"eenticott-shell","id":93924843,"node_id":"U_kgDOBZkt6w","avatar_url":"https://avatars.githubusercontent.com/u/93924843?v=4","gravatar_id":"","url":"https://api.github.com/users/eenticott-shell","html_url":"https://github.com/eenticott-shell","followers_url":"https://api.github.com/users/eenticott-shell/followers","following_url":"https://api.github.com/users/eenticott-shell/following{/other_user}","gists_url":"https://api.github.com/users/eenticott-shell/gists{/gist_id}","starred_url":"https://api.github.com/users/eenticott-shell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eenticott-shell/subscriptions","organizations_url":"https://api.github.com/users/eenticott-shell/orgs","repos_url":"https://api.github.com/users/eenticott-shell/repos","events_url":"https://api.github.com/users/eenticott-shell/events{/privacy}","received_events_url":"https://api.github.com/users/eenticott-shell/received_events","type":"User","site_admin":false},"assignees":[{"login":"eenticott-shell","id":93924843,"node_id":"U_kgDOBZkt6w","avatar_url":"https://avatars.githubusercontent.com/u/93924843?v=4","gravatar_id":"","url":"https://api.github.com/users/eenticott-shell","html_url":"https://github.com/eenticott-shell","followers_url":"https://api.github.com/users/eenticott-shell/followers","following_url":"https://api.github.com/users/eenticott-shell/following{/other_user}","gists_url":"https://api.github.com/users/eenticott-shell/gists{/gist_id}","starred_url":"https://api.github.com/users/eenticott-shell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eenticott-shell/subscriptions","organizations_url":"https://api.github.com/users/eenticott-shell/orgs","repos_url":"https://api.github.com/users/eenticott-shell/repos","events_url":"https://api.github.com/users/eenticott-shell/events{/privacy}","received_events_url":"https://api.github.com/users/eenticott-shell/received_events","type":"User","site_admin":false}],"milestone":null,"comments":16,"created_at":"2022-01-14T14:58:19Z","updated_at":"2022-02-24T12:39:28Z","closed_at":"2022-02-09T14:27:13Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Describe the bug**\r\nWhen data has a period index at 10 minute intervals, the prediction does not work.\r\n\r\nMost likely related to \r\nSeems to be some issue with the indexing - most likely related to `ForecastingHorizon.to_absolute_int()` and how `integers` are computed.\r\n\r\n```python\r\n# Inside to_absolute_int, the following line does not seem to be giving the right integers\r\nintegers = absolute - start\r\n```\r\n\r\n**To Reproduce**\r\n```python\r\nimport pandas as pd\r\nfrom sktime.datasets import load_airline\r\nfrom sktime.forecasting.exp_smoothing import ExponentialSmoothing\r\ny = load_airline()\r\n\r\n# Change index to 10 min interval\r\ntime_range = pd.date_range(\r\n    pd.to_datetime(\"2019-01-01 00:00\"), pd.to_datetime(\"2019-01-01 23:55\"), freq=\"10Min\"\r\n)\r\n\r\n# # Datetime Index works\r\n# y.index = time_range\r\n\r\n# Period Index does not work\r\ny.index = time_range.to_period()\r\n\r\nforecaster = ExponentialSmoothing(trend=\"add\", seasonal=\"multiplicative\", sp=12)\r\nforecaster.fit(y, fh=[1, 2, 3, 4, 5, 6])\r\ny_pred = forecaster.predict()\r\n```\r\n\r\n```python\r\nFile \"C:\\Users\\Nikhil\\.conda\\envs\\pycaret_dev_sktime_0p7\\lib\\runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"C:\\Users\\Nikhil\\.conda\\envs\\pycaret_dev_sktime_0p7\\lib\\runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"c:\\Users\\Nikhil\\.vscode\\extensions\\ms-python.python-2021.12.1559732655\\pythonFiles\\lib\\python\\debugpy\\__main__.py\", line 45, in <module>\r\n    cli.main()\r\n  File \"c:\\Users\\Nikhil\\.vscode\\extensions\\ms-python.python-2021.12.1559732655\\pythonFiles\\lib\\python\\debugpy/..\\debugpy\\server\\cli.py\", line 444, in main\r\n    run()\r\n  File \"c:\\Users\\Nikhil\\.vscode\\extensions\\ms-python.python-2021.12.1559732655\\pythonFiles\\lib\\python\\debugpy/..\\debugpy\\server\\cli.py\", line 285, in run_file\r\n    runpy.run_path(target_as_str, run_name=compat.force_str(\"__main__\"))\r\n  File \"C:\\Users\\Nikhil\\.conda\\envs\\pycaret_dev_sktime_0p7\\lib\\runpy.py\", line 263, in run_path\r\n    pkg_name=pkg_name, script_name=fname)\r\n  File \"C:\\Users\\Nikhil\\.conda\\envs\\pycaret_dev_sktime_0p7\\lib\\runpy.py\", line 96, in _run_module_code\r\n    mod_name, mod_spec, pkg_name, script_name)\r\n  File \"C:\\Users\\Nikhil\\.conda\\envs\\pycaret_dev_sktime_0p7\\lib\\runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"c:\\Users\\Nikhil\\OneDrive\\my_libraries\\my_python_libraries\\pycaret\\pycaret_dev\\time_series_debug.py\", line 33, in <module>\r\n    y_pred = forecaster.predict()\r\n  File \"C:\\Users\\Nikhil\\.conda\\envs\\pycaret_dev_sktime_0p7\\lib\\site-packages\\sktime\\forecasting\\base\\_base.py\", line 242, in predict\r\n    alpha=alpha,\r\n  File \"C:\\Users\\Nikhil\\.conda\\envs\\pycaret_dev_sktime_0p7\\lib\\site-packages\\sktime\\forecasting\\base\\adapters\\_statsmodels.py\", line 92, in _predict\r\n    return y_pred.loc[fh.to_absolute(self.cutoff).to_pandas()]\r\n  File \"C:\\Users\\Nikhil\\.conda\\envs\\pycaret_dev_sktime_0p7\\lib\\site-packages\\pandas\\core\\indexing.py\", line 931, in __getitem__\r\n    return self._getitem_axis(maybe_callable, axis=axis)\r\n  File \"C:\\Users\\Nikhil\\.conda\\envs\\pycaret_dev_sktime_0p7\\lib\\site-packages\\pandas\\core\\indexing.py\", line 1153, in _getitem_axis\r\n    return self._getitem_iterable(key, axis=axis)\r\n  File \"C:\\Users\\Nikhil\\.conda\\envs\\pycaret_dev_sktime_0p7\\lib\\site-packages\\pandas\\core\\indexing.py\", line 1093, in _getitem_iterable\r\n    keyarr, indexer = self._get_listlike_indexer(key, axis)\r\n  File \"C:\\Users\\Nikhil\\.conda\\envs\\pycaret_dev_sktime_0p7\\lib\\site-packages\\pandas\\core\\indexing.py\", line 1314, in _get_listlike_indexer\r\n    self._validate_read_indexer(keyarr, indexer, axis)\r\n  File \"C:\\Users\\Nikhil\\.conda\\envs\\pycaret_dev_sktime_0p7\\lib\\site-packages\\pandas\\core\\indexing.py\", line 1374, in _validate_read_indexer\r\n    raise KeyError(f\"None of [{key}] are in the [{axis_name}]\")\r\nKeyError: \"None of [PeriodIndex(['2019-01-02 00:00', '2019-01-02 00:10', '2019-01-02 00:20',\\n             '2019-01-02 00:30', '2019-01-02 00:40', '2019-01-02 00:50'],\\n            dtype='period[10T]')] are in the [index]\"\r\n```\r\n\r\n**Expected behavior**\r\nShould produce the right forecasts (6 future values at 10 minute intervals - i.e. [PeriodIndex(['2019-01-02 00:00', '2019-01-02 00:10', '2019-01-02 00:20', '2019-01-02 00:30', '2019-01-02 00:40', '2019-01-02 00:50'])\r\n\r\n**Additional context**\r\n<!--\r\nAdd any other context about the problem here.\r\n-->\r\n\r\n**Versions**\r\n<details>\r\n\r\n\r\nSystem:\r\n    python: 3.7.10 (default, Feb 26 2021, 13:06:18) [MSC v.1916 64 bit (AMD64)]\r\nexecutable: C:\\Users\\Nikhil\\.conda\\envs\\pycaret_dev_sktime_0p7\\python.exe\r\n   machine: Windows-10-10.0.19041-SP0\r\n\r\nPython dependencies:\r\n          pip: 21.1.3\r\n   setuptools: 52.0.0.post20210125\r\n      sklearn: 0.24.2\r\n       sktime: 0.8.0\r\n  statsmodels: 0.12.2\r\n        numpy: 1.19.5\r\n        scipy: 1.5.4\r\n       Cython: 0.29.14\r\n       pandas: 1.3.0\r\n   matplotlib: 3.4.2\r\n       joblib: 1.0.1\r\n        numba: 0.53.1\r\n     pmdarima: 1.8.2\r\n      tsfresh: None\r\n\r\n</details>\r\n\r\n<!-- Thanks for contributing! -->\r\n","closed_by":{"login":"fkiraly","id":7985502,"node_id":"MDQ6VXNlcjc5ODU1MDI=","avatar_url":"https://avatars.githubusercontent.com/u/7985502?v=4","gravatar_id":"","url":"https://api.github.com/users/fkiraly","html_url":"https://github.com/fkiraly","followers_url":"https://api.github.com/users/fkiraly/followers","following_url":"https://api.github.com/users/fkiraly/following{/other_user}","gists_url":"https://api.github.com/users/fkiraly/gists{/gist_id}","starred_url":"https://api.github.com/users/fkiraly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkiraly/subscriptions","organizations_url":"https://api.github.com/users/fkiraly/orgs","repos_url":"https://api.github.com/users/fkiraly/repos","events_url":"https://api.github.com/users/fkiraly/events{/privacy}","received_events_url":"https://api.github.com/users/fkiraly/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/1876/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/1876/timeline","performed_via_github_app":null,"state_reason":"completed"}