{"url":"https://api.github.com/repos/sktime/sktime/issues/1228","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/1228/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/1228/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/1228/events","html_url":"https://github.com/sktime/sktime/issues/1228","id":956527618,"node_id":"MDU6SXNzdWU5NTY1Mjc2MTg=","number":1228,"title":"[BUG] sporadic bug in clustering example notebook","user":{"login":"fkiraly","id":7985502,"node_id":"MDQ6VXNlcjc5ODU1MDI=","avatar_url":"https://avatars.githubusercontent.com/u/7985502?v=4","gravatar_id":"","url":"https://api.github.com/users/fkiraly","html_url":"https://github.com/fkiraly","followers_url":"https://api.github.com/users/fkiraly/followers","following_url":"https://api.github.com/users/fkiraly/following{/other_user}","gists_url":"https://api.github.com/users/fkiraly/gists{/gist_id}","starred_url":"https://api.github.com/users/fkiraly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkiraly/subscriptions","organizations_url":"https://api.github.com/users/fkiraly/orgs","repos_url":"https://api.github.com/users/fkiraly/repos","events_url":"https://api.github.com/users/fkiraly/events{/privacy}","received_events_url":"https://api.github.com/users/fkiraly/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":3102332684,"node_id":"MDU6TGFiZWwzMTAyMzMyNjg0","url":"https://api.github.com/repos/sktime/sktime/labels/module:clustering","name":"module:clustering","color":"8C1AAB","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"chrisholder","id":4674372,"node_id":"MDQ6VXNlcjQ2NzQzNzI=","avatar_url":"https://avatars.githubusercontent.com/u/4674372?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisholder","html_url":"https://github.com/chrisholder","followers_url":"https://api.github.com/users/chrisholder/followers","following_url":"https://api.github.com/users/chrisholder/following{/other_user}","gists_url":"https://api.github.com/users/chrisholder/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisholder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisholder/subscriptions","organizations_url":"https://api.github.com/users/chrisholder/orgs","repos_url":"https://api.github.com/users/chrisholder/repos","events_url":"https://api.github.com/users/chrisholder/events{/privacy}","received_events_url":"https://api.github.com/users/chrisholder/received_events","type":"User","site_admin":false},"assignees":[{"login":"chrisholder","id":4674372,"node_id":"MDQ6VXNlcjQ2NzQzNzI=","avatar_url":"https://avatars.githubusercontent.com/u/4674372?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisholder","html_url":"https://github.com/chrisholder","followers_url":"https://api.github.com/users/chrisholder/followers","following_url":"https://api.github.com/users/chrisholder/following{/other_user}","gists_url":"https://api.github.com/users/chrisholder/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisholder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisholder/subscriptions","organizations_url":"https://api.github.com/users/chrisholder/orgs","repos_url":"https://api.github.com/users/chrisholder/repos","events_url":"https://api.github.com/users/chrisholder/events{/privacy}","received_events_url":"https://api.github.com/users/chrisholder/received_events","type":"User","site_admin":false},{"login":"TonyBagnall","id":9594042,"node_id":"MDQ6VXNlcjk1OTQwNDI=","avatar_url":"https://avatars.githubusercontent.com/u/9594042?v=4","gravatar_id":"","url":"https://api.github.com/users/TonyBagnall","html_url":"https://github.com/TonyBagnall","followers_url":"https://api.github.com/users/TonyBagnall/followers","following_url":"https://api.github.com/users/TonyBagnall/following{/other_user}","gists_url":"https://api.github.com/users/TonyBagnall/gists{/gist_id}","starred_url":"https://api.github.com/users/TonyBagnall/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TonyBagnall/subscriptions","organizations_url":"https://api.github.com/users/TonyBagnall/orgs","repos_url":"https://api.github.com/users/TonyBagnall/repos","events_url":"https://api.github.com/users/TonyBagnall/events{/privacy}","received_events_url":"https://api.github.com/users/TonyBagnall/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2021-07-30T08:28:30Z","updated_at":"2022-05-01T15:15:50Z","closed_at":"2022-05-01T15:13:45Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"When running the clustering notebook in PR #1209 completely unrelated to clustering, the test_examples check resulted in the following failure:\r\n\r\n```\r\n[NbConvertApp] Converting notebook examples/partition_based_clustering.ipynb to notebook\r\nTraceback (most recent call last):\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/bin/jupyter-nbconvert\", line 8, in <module>\r\n    sys.exit(main())\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/jupyter_core/application.py\", line 254, in launch_instance\r\n    return super(JupyterApp, cls).launch_instance(argv=argv, **kwargs)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/traitlets/config/application.py\", line 845, in launch_instance\r\n    app.start()\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbconvert/nbconvertapp.py\", line 346, in start\r\n    self.convert_notebooks()\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbconvert/nbconvertapp.py\", line 518, in convert_notebooks\r\n    self.convert_single_notebook(notebook_filename)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbconvert/nbconvertapp.py\", line 483, in convert_single_notebook\r\n    output, resources = self.export_single_notebook(notebook_filename, resources, input_buffer=input_buffer)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbconvert/nbconvertapp.py\", line 412, in export_single_notebook\r\n    output, resources = self.exporter.from_filename(notebook_filename, resources=resources)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbconvert/exporters/exporter.py\", line 181, in from_filename\r\n    return self.from_file(f, resources=resources, **kw)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbconvert/exporters/exporter.py\", line 199, in from_file\r\n    return self.from_notebook_node(nbformat.read(file_stream, as_version=4), resources=resources, **kw)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbconvert/exporters/notebook.py\", line 32, in from_notebook_node\r\n    nb_copy, resources = super().from_notebook_node(nb, resources, **kw)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbconvert/exporters/exporter.py\", line 143, in from_notebook_node\r\n    nb_copy, resources = self._preprocess(nb_copy, resources)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbconvert/exporters/exporter.py\", line 318, in _preprocess\r\n    nbc, resc = preprocessor(nbc, resc)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbconvert/preprocessors/base.py\", line 47, in __call__\r\n    return self.preprocess(nb, resources)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbconvert/preprocessors/execute.py\", line 84, in preprocess\r\n    self.preprocess_cell(cell, resources, index)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbconvert/preprocessors/execute.py\", line 105, in preprocess_cell\r\n    cell = self.execute_cell(cell, index, store_history=True)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbclient/util.py\", line 74, in wrapped\r\n    return just_run(coro(*args, **kwargs))\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbclient/util.py\", line 53, in just_run\r\n    return loop.run_until_complete(coro)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/asyncio/base_events.py\", line 587, in run_until_complete\r\n    return future.result()\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbclient/client.py\", line 857, in async_execute_cell\r\n    self._check_raise_for_error(cell, exec_reply)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nbclient/client.py\", line 760, in _check_raise_for_error\r\n    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)\r\nnbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:\r\n------------------\r\nk_medoids = TimeSeriesKMedoids(\r\n    n_clusters=5,  # Number of desired centers\r\n    init_algorithm=\"forgy\",  # Center initialisation technique\r\n    max_iter=200,  # Maximum number of iterations for refinement on training set\r\n    verbose=False,  # Verbose\r\n    metric=\"dtw\",  # Distance metric to use\r\n)\r\n\r\nk_medoids.fit(X_train)\r\nplot_cluster_algorithm(k_medoids, X_test, k_medoids.n_clusters)\r\n------------------\r\n\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n/tmp/ipykernel_3017/3264997074.py in <module>\r\n      7 )\r\n      8 \r\n----> 9 k_medoids.fit(X_train)\r\n     10 plot_cluster_algorithm(k_medoids, X_test, k_medoids.n_clusters)\r\n\r\n/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/sktime/clustering/_k_medoids.py in fit(self, X, y)\r\n     87         \"\"\"\r\n     88 \r\n---> 89         return super(TimeSeriesKMedoids, self).fit(X)\r\n     90 \r\n     91     def predict(self, X: NumpyOrDF) -> NumpyArray:\r\n\r\n/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/sktime/clustering/base/base.py in fit(self, X, y)\r\n     53 \r\n     54         self._check_params(X)\r\n---> 55         self._fit(X)\r\n     56 \r\n     57         self._is_fitted = True\r\n\r\n/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/sktime/clustering/partitioning/_lloyds_partitioning.py in _fit(self, X, y)\r\n    130 \r\n    131         for _ in range(self.max_iter):\r\n--> 132             self._update_centers(X)\r\n    133 \r\n    134     def _predict(self, X: NumpyArray) -> NumpyArray:\r\n\r\n/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/sktime/clustering/partitioning/_lloyds_partitioning.py in _update_centers(self, data)\r\n    217         new_centers = []\r\n    218         for cluster_series in cluster_values:\r\n--> 219             new_centers_i = self.calculate_new_centers(cluster_series)\r\n    220             new_centers.append(new_centers_i)\r\n    221 \r\n\r\n/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/sktime/clustering/_k_medoids.py in calculate_new_centers(self, cluster_values)\r\n    127 \r\n    128         medoid = Medoids(cluster_values, self._metric)\r\n--> 129         medoid_index = medoid.approximate()\r\n    130         return cluster_values[medoid_index]\r\n\r\n/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/sktime/clustering/partitioning/_cluster_approximations.py in approximate(self)\r\n     36             Index position of the approximation in the series\r\n     37         \"\"\"\r\n---> 38         distance_matrix = compute_pairwise_distances(X=self.series, metric=self.metric)\r\n     39         return np.argmin(sum(distance_matrix))\r\n\r\n/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/sktime/clustering/base/clustering_utils.py in compute_pairwise_distances(metric, X, Y, pairwise_func)\r\n     56         Y = X\r\n     57 \r\n---> 58     return pairwise_func(X=X, Y=Y, metric=dist_wrapper)\r\n     59 \r\n     60 \r\n\r\n/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/sklearn/utils/validation.py in inner_f(*args, **kwargs)\r\n     61             extra_args = len(args) - len(all_args)\r\n     62             if extra_args <= 0:\r\n---> 63                 return f(*args, **kwargs)\r\n     64 \r\n     65             # extra_args > 0\r\n\r\n/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/sklearn/metrics/pairwise.py in pairwise_distances(X, Y, metric, n_jobs, force_all_finite, **kwds)\r\n   1788         func = partial(distance.cdist, metric=metric, **kwds)\r\n   1789 \r\n-> 1790     return _parallel_pairwise(X, Y, func, n_jobs, **kwds)\r\n   1791 \r\n   1792 \r\n\r\n/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/sklearn/metrics/pairwise.py in _parallel_pairwise(X, Y, func, n_jobs, **kwds)\r\n   1357 \r\n   1358     if effective_n_jobs(n_jobs) == 1:\r\n-> 1359         return func(X, Y, **kwds)\r\n   1360 \r\n   1361     # enforce a threading backend to prevent data communication overhead\r\n\r\n/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/sklearn/metrics/pairwise.py in _pairwise_callable(X, Y, metric, force_all_finite, **kwds)\r\n   1377     \"\"\"Handle the callable case for pairwise_{distances,kernels}.\r\n   1378     \"\"\"\r\n-> 1379     X, Y = check_pairwise_arrays(X, Y, force_all_finite=force_all_finite)\r\n   1380 \r\n   1381     if X is Y:\r\n\r\n/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/sklearn/utils/validation.py in inner_f(*args, **kwargs)\r\n     61             extra_args = len(args) - len(all_args)\r\n     62             if extra_args <= 0:\r\n---> 63                 return f(*args, **kwargs)\r\n     64 \r\n     65             # extra_args > 0\r\n\r\n/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/sklearn/metrics/pairwise.py in check_pairwise_arrays(X, Y, precomputed, dtype, accept_sparse, force_all_finite, copy)\r\n    142         X = Y = check_array(X, accept_sparse=accept_sparse, dtype=dtype,\r\n    143                             copy=copy, force_all_finite=force_all_finite,\r\n--> 144                             estimator=estimator)\r\n    145     else:\r\n    146         X = check_array(X, accept_sparse=accept_sparse, dtype=dtype,\r\n\r\n/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/sklearn/utils/validation.py in inner_f(*args, **kwargs)\r\n     61             extra_args = len(args) - len(all_args)\r\n     62             if extra_args <= 0:\r\n---> 63                 return f(*args, **kwargs)\r\n     64 \r\n     65             # extra_args > 0\r\n\r\n/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/sklearn/utils/validation.py in check_array(array, accept_sparse, accept_large_sparse, dtype, order, copy, force_all_finite, ensure_2d, allow_nd, ensure_min_samples, ensure_min_features, estimator)\r\n    696                     \"Reshape your data either using array.reshape(-1, 1) if \"\r\n    697                     \"your data has a single feature or array.reshape(1, -1) \"\r\n--> 698                     \"if it contains a single sample.\".format(array))\r\n    699 \r\n    700         # make sure we actually converted to numeric:\r\n\r\nValueError: Expected 2D array, got 1D array instead:\r\narray=[].\r\nReshape your data either using array.reshape(-1, 1) if your data has a single feature or array.reshape(1, -1) if it contains a single sample.\r\nValueError: Expected 2D array, got 1D array instead:\r\narray=[].\r\nReshape your data either using array.reshape(-1, 1) if your data has a single feature or array.reshape(1, -1) if it contains a single sample.\r\n\r\nError: Process completed with exit code 1.\r\n```","closed_by":{"login":"chrisholder","id":4674372,"node_id":"MDQ6VXNlcjQ2NzQzNzI=","avatar_url":"https://avatars.githubusercontent.com/u/4674372?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisholder","html_url":"https://github.com/chrisholder","followers_url":"https://api.github.com/users/chrisholder/followers","following_url":"https://api.github.com/users/chrisholder/following{/other_user}","gists_url":"https://api.github.com/users/chrisholder/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisholder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisholder/subscriptions","organizations_url":"https://api.github.com/users/chrisholder/orgs","repos_url":"https://api.github.com/users/chrisholder/repos","events_url":"https://api.github.com/users/chrisholder/events{/privacy}","received_events_url":"https://api.github.com/users/chrisholder/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/1228/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/1228/timeline","performed_via_github_app":null,"state_reason":"completed"}