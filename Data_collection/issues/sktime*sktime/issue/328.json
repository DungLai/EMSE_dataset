{"url":"https://api.github.com/repos/sktime/sktime/issues/328","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/328/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/328/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/328/events","html_url":"https://github.com/sktime/sktime/issues/328","id":649827584,"node_id":"MDU6SXNzdWU2NDk4Mjc1ODQ=","number":328,"title":"[BUG] KNeighboursTimeSeriesClassifier throws errors with multivariate time series data when algorithm is set to either 'kd_tree' or 'ball_tree'","user":{"login":"vincent-nich12","id":36476633,"node_id":"MDQ6VXNlcjM2NDc2NjMz","avatar_url":"https://avatars.githubusercontent.com/u/36476633?v=4","gravatar_id":"","url":"https://api.github.com/users/vincent-nich12","html_url":"https://github.com/vincent-nich12","followers_url":"https://api.github.com/users/vincent-nich12/followers","following_url":"https://api.github.com/users/vincent-nich12/following{/other_user}","gists_url":"https://api.github.com/users/vincent-nich12/gists{/gist_id}","starred_url":"https://api.github.com/users/vincent-nich12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincent-nich12/subscriptions","organizations_url":"https://api.github.com/users/vincent-nich12/orgs","repos_url":"https://api.github.com/users/vincent-nich12/repos","events_url":"https://api.github.com/users/vincent-nich12/events{/privacy}","received_events_url":"https://api.github.com/users/vincent-nich12/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-07-02T10:39:49Z","updated_at":"2021-01-11T23:39:54Z","closed_at":"2021-01-06T15:24:56Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Describe the bug**\r\nWhen using ShapeDTW with KNeighborsTimeSeriesClassifier, as ShapeDTW produces a multivariate time series from a univariate one, when its converted to an array it produces a 3D array. When I set the algorithm flag in KNeighborsTimeSeriesClassifier to 'brute' it works absolutely fine. However, when I set the algorithm flag to 'ball_tree' or 'kd_tree' I get errors. For ShapeDTW, the 3D output is absolutely necessary so I guess it would be good if 'ball_tree' and 'kd_tree' work with a 3D input.\r\n\r\n**To Reproduce**\r\n\r\n```python\r\nX = multivariateTimeSeriesData()\r\ny = classLabels()\r\nknn = KNeighborsTimeSeriesClassifier(algorithm='brute')\r\nknn.fit(X)\r\nknn.predict(X,y) # Works fine.\r\nknn = KNeighborsTimeSeriesClassifier(algorithm='kd_tree') \r\nknn.fit(X)\r\nknn.predict(X,y) # Throws - ValueError: kd_tree does not support callable metric '<built-in function dtw_distance>'Function call overhead will resultin very poor performance..\r\nknn = KNeighborsTimeSeriesClassifier(algorithm='ball_tree') \r\nknn.fit(X)\r\nknn.predict(X,y) # Throws - ValueError: Buffer has wrong number of dimensions (expected 2, got 3)\r\n```\r\n\r\n**Expected behavior**\r\nKNeighboursTimeSeriesClassifier supports 3D time series data. \r\n\r\n**Additional context**\r\nTo get ShapeDTW working properly, I inserted at lines 184 and 272 - X = nested_to_3d_numpy(X). This was necessary so that\r\nit converted the data into the correct form for ShapeDTW. 'brute' works even with this line, but 'kd_tree' and 'ball_tree' do not.\r\n\r\n**Versions**\r\n<details>\r\nWindows-10-10.0.18362-SP0\r\n\r\nPython 3.7.6 (default, Jan  8 2020, 20:23:39) [MSC v.1916 64 bit (AMD64)]\r\nNumPy 1.18.1\r\nSciPy 1.4.1\r\nPandas 1.0.3\r\nsktime 0.4.0\r\n</details>\r\n\r\n<!-- Thanks for contributing! -->\r\n","closed_by":{"login":"TonyBagnall","id":9594042,"node_id":"MDQ6VXNlcjk1OTQwNDI=","avatar_url":"https://avatars.githubusercontent.com/u/9594042?v=4","gravatar_id":"","url":"https://api.github.com/users/TonyBagnall","html_url":"https://github.com/TonyBagnall","followers_url":"https://api.github.com/users/TonyBagnall/followers","following_url":"https://api.github.com/users/TonyBagnall/following{/other_user}","gists_url":"https://api.github.com/users/TonyBagnall/gists{/gist_id}","starred_url":"https://api.github.com/users/TonyBagnall/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TonyBagnall/subscriptions","organizations_url":"https://api.github.com/users/TonyBagnall/orgs","repos_url":"https://api.github.com/users/TonyBagnall/repos","events_url":"https://api.github.com/users/TonyBagnall/events{/privacy}","received_events_url":"https://api.github.com/users/TonyBagnall/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/328/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/328/timeline","performed_via_github_app":null,"state_reason":"completed"}