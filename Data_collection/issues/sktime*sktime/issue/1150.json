{"url":"https://api.github.com/repos/sktime/sktime/issues/1150","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/1150/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/1150/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/1150/events","html_url":"https://github.com/sktime/sktime/issues/1150","id":946793193,"node_id":"MDU6SXNzdWU5NDY3OTMxOTM=","number":1150,"title":"[BUG] Build time dependency Cython not declared","user":{"login":"astrojuanlu","id":316517,"node_id":"MDQ6VXNlcjMxNjUxNw==","avatar_url":"https://avatars.githubusercontent.com/u/316517?v=4","gravatar_id":"","url":"https://api.github.com/users/astrojuanlu","html_url":"https://github.com/astrojuanlu","followers_url":"https://api.github.com/users/astrojuanlu/followers","following_url":"https://api.github.com/users/astrojuanlu/following{/other_user}","gists_url":"https://api.github.com/users/astrojuanlu/gists{/gist_id}","starred_url":"https://api.github.com/users/astrojuanlu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astrojuanlu/subscriptions","organizations_url":"https://api.github.com/users/astrojuanlu/orgs","repos_url":"https://api.github.com/users/astrojuanlu/repos","events_url":"https://api.github.com/users/astrojuanlu/events{/privacy}","received_events_url":"https://api.github.com/users/astrojuanlu/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-07-17T10:48:04Z","updated_at":"2022-02-07T17:40:58Z","closed_at":"2022-02-07T17:40:57Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Describe the bug**\r\n\r\nThe `setup.py` file uses `setup_requires` to declare `wheel` as a build-time dependency. However, it looks like Cython is also needed, because I got this eror on a fresh virtualenv with Python 3.7 on Linux Mint:\r\n\r\n```\r\n(.venv) juanlu@arion2:~/Projects/RTD/sktime$ pip install .\r\nProcessing /home/juanlu/Projects/RTD/sktime\r\nRequirement already satisfied: numpy>=1.19.0 in ./.venv/lib/python3.7/site-packages (from sktime==0.7.0) (1.21.0)\r\nRequirement already satisfied: pandas>=1.1.0 in ./.venv/lib/python3.7/site-packages (from sktime==0.7.0) (1.3.0)\r\nRequirement already satisfied: scikit-learn>=0.24.0 in ./.venv/lib/python3.7/site-packages (from sktime==0.7.0) (0.24.2)\r\nRequirement already satisfied: statsmodels>=0.12.1 in ./.venv/lib/python3.7/site-packages (from sktime==0.7.0) (0.12.2)\r\nRequirement already satisfied: numba>=0.50 in ./.venv/lib/python3.7/site-packages (from sktime==0.7.0) (0.53.1)\r\nRequirement already satisfied: wheel in ./.venv/lib/python3.7/site-packages (from sktime==0.7.0) (0.36.2)\r\nRequirement already satisfied: pytz>=2017.3 in ./.venv/lib/python3.7/site-packages (from pandas>=1.1.0->sktime==0.7.0) (2021.1)\r\nRequirement already satisfied: python-dateutil>=2.7.3 in ./.venv/lib/python3.7/site-packages (from pandas>=1.1.0->sktime==0.7.0) (2.8.2)\r\nRequirement already satisfied: joblib>=0.11 in ./.venv/lib/python3.7/site-packages (from scikit-learn>=0.24.0->sktime==0.7.0) (1.0.1)\r\nRequirement already satisfied: threadpoolctl>=2.0.0 in ./.venv/lib/python3.7/site-packages (from scikit-learn>=0.24.0->sktime==0.7.0) (2.2.0)\r\nRequirement already satisfied: scipy>=0.19.1 in ./.venv/lib/python3.7/site-packages (from scikit-learn>=0.24.0->sktime==0.7.0) (1.7.0)\r\nRequirement already satisfied: patsy>=0.5 in ./.venv/lib/python3.7/site-packages (from statsmodels>=0.12.1->sktime==0.7.0) (0.5.1)\r\nRequirement already satisfied: llvmlite<0.37,>=0.36.0rc1 in ./.venv/lib/python3.7/site-packages (from numba>=0.50->sktime==0.7.0) (0.36.0)\r\nRequirement already satisfied: setuptools in ./.venv/lib/python3.7/site-packages (from numba>=0.50->sktime==0.7.0) (47.1.0)\r\nRequirement already satisfied: six>=1.5 in ./.venv/lib/python3.7/site-packages (from python-dateutil>=2.7.3->pandas>=1.1.0->sktime==0.7.0) (1.16.0)\r\nBuilding wheels for collected packages: sktime\r\n  Building wheel for sktime (setup.py) ... error\r\n  ERROR: Command errored out with exit status 1:\r\n   command: /home/juanlu/Projects/RTD/sktime/.venv/bin/python3.7 -u -c 'import sys, setuptools, tokenize; sys.argv[0] = '\"'\"'/tmp/pip-req-build-7f5ynf47/setup.py'\"'\"'; __file__='\"'\"'/tmp/pip-req-build-7f5ynf47/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(__file__);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, __file__, '\"'\"'exec'\"'\"'))' bdist_wheel -d /tmp/pip-wheel-setbtybz\r\n       cwd: /tmp/pip-req-build-7f5ynf47/\r\n  Complete output (27 lines):\r\n  C compiler: x86_64-linux-gnu-gcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fdebug-prefix-map=/build/python3.7-7jazGd/python3.7-3.7.11=. -fstack-protector-strong -Wformat -Werror=format-security -g -fdebug-prefix-map=/build/python3.7-7jazGd/python3.7-3.7.11=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC\r\n\r\n  compile options: '-c'\r\n  extra options: '-fopenmp'\r\n  x86_64-linux-gnu-gcc: test_openmp.c\r\n  x86_64-linux-gnu-gcc -pthread objects/test_openmp.o -o test_openmp -fopenmp\r\n  Traceback (most recent call last):\r\n    File \"<string>\", line 1, in <module>\r\n    File \"/tmp/pip-req-build-7f5ynf47/setup.py\", line 325, in <module>\r\n      setup_package()\r\n    File \"/tmp/pip-req-build-7f5ynf47/setup.py\", line 321, in setup_package\r\n      setup(**metadata)\r\n    File \"/home/juanlu/Projects/RTD/sktime/.venv/lib/python3.7/site-packages/numpy/distutils/core.py\", line 135, in setup\r\n      config = configuration()\r\n    File \"/tmp/pip-req-build-7f5ynf47/setup.py\", line 216, in configuration\r\n      config.add_subpackage(\"sktime\")\r\n    File \"/home/juanlu/Projects/RTD/sktime/.venv/lib/python3.7/site-packages/numpy/distutils/misc_util.py\", line 1018, in add_subpackage\r\n      caller_level = 2)\r\n    File \"/home/juanlu/Projects/RTD/sktime/.venv/lib/python3.7/site-packages/numpy/distutils/misc_util.py\", line 987, in get_subpackage\r\n      caller_level = caller_level + 1)\r\n    File \"/home/juanlu/Projects/RTD/sktime/.venv/lib/python3.7/site-packages/numpy/distutils/misc_util.py\", line 924, in _get_configuration_from_setup_py\r\n      config = setup_module.configuration(*args)\r\n    File \"sktime/setup.py\", line 28, in configuration\r\n      maybe_cythonize_extensions(top_path, config)\r\n    File \"/tmp/pip-req-build-7f5ynf47/sktime/_build_utils/__init__.py\", line 53, in maybe_cythonize_extensions\r\n      import Cython\r\n  ModuleNotFoundError: No module named 'Cython'\r\n  ----------------------------------------\r\n  ERROR: Failed building wheel for sktime\r\n  Running setup.py clean for sktime\r\nFailed to build sktime\r\nInstalling collected packages: sktime\r\n    Running setup.py install for sktime ... error\r\n    ERROR: Command errored out with exit status 1:\r\n     command: /home/juanlu/Projects/RTD/sktime/.venv/bin/python3.7 -u -c 'import sys, setuptools, tokenize; sys.argv[0] = '\"'\"'/tmp/pip-req-build-7f5ynf47/setup.py'\"'\"'; __file__='\"'\"'/tmp/pip-req-build-7f5ynf47/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(__file__);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, __file__, '\"'\"'exec'\"'\"'))' install --record /tmp/pip-record-43rk2weh/install-record.txt --single-version-externally-managed --compile --install-headers /home/juanlu/Projects/RTD/sktime/.venv/include/site/python3.7/sktime\r\n         cwd: /tmp/pip-req-build-7f5ynf47/\r\n    Complete output (27 lines):\r\n    C compiler: x86_64-linux-gnu-gcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fdebug-prefix-map=/build/python3.7-7jazGd/python3.7-3.7.11=. -fstack-protector-strong -Wformat -Werror=format-security -g -fdebug-prefix-map=/build/python3.7-7jazGd/python3.7-3.7.11=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC\r\n\r\n    compile options: '-c'\r\n    extra options: '-fopenmp'\r\n    x86_64-linux-gnu-gcc: test_openmp.c\r\n    x86_64-linux-gnu-gcc -pthread objects/test_openmp.o -o test_openmp -fopenmp\r\n    Traceback (most recent call last):\r\n      File \"<string>\", line 1, in <module>\r\n      File \"/tmp/pip-req-build-7f5ynf47/setup.py\", line 325, in <module>\r\n        setup_package()\r\n      File \"/tmp/pip-req-build-7f5ynf47/setup.py\", line 321, in setup_package\r\n        setup(**metadata)\r\n      File \"/home/juanlu/Projects/RTD/sktime/.venv/lib/python3.7/site-packages/numpy/distutils/core.py\", line 135, in setup\r\n        config = configuration()\r\n      File \"/tmp/pip-req-build-7f5ynf47/setup.py\", line 216, in configuration\r\n        config.add_subpackage(\"sktime\")\r\n      File \"/home/juanlu/Projects/RTD/sktime/.venv/lib/python3.7/site-packages/numpy/distutils/misc_util.py\", line 1018, in add_subpackage\r\n        caller_level = 2)\r\n      File \"/home/juanlu/Projects/RTD/sktime/.venv/lib/python3.7/site-packages/numpy/distutils/misc_util.py\", line 987, in get_subpackage\r\n        caller_level = caller_level + 1)\r\n      File \"/home/juanlu/Projects/RTD/sktime/.venv/lib/python3.7/site-packages/numpy/distutils/misc_util.py\", line 924, in _get_configuration_from_setup_py\r\n        config = setup_module.configuration(*args)\r\n      File \"sktime/setup.py\", line 28, in configuration\r\n        maybe_cythonize_extensions(top_path, config)\r\n      File \"/tmp/pip-req-build-7f5ynf47/sktime/_build_utils/__init__.py\", line 53, in maybe_cythonize_extensions\r\n        import Cython\r\n    ModuleNotFoundError: No module named 'Cython'\r\n    ----------------------------------------\r\nERROR: Command errored out with exit status 1: /home/juanlu/Projects/RTD/sktime/.venv/bin/python3.7 -u -c 'import sys, setuptools, tokenize; sys.argv[0] = '\"'\"'/tmp/pip-req-build-7f5ynf47/setup.py'\"'\"'; __file__='\"'\"'/tmp/pip-req-build-7f5ynf47/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(__file__);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, __file__, '\"'\"'exec'\"'\"'))' install --record /tmp/pip-record-43rk2weh/install-record.txt --single-version-externally-managed --compile --install-headers /home/juanlu/Projects/RTD/sktime/.venv/include/site/python3.7/sktime Check the logs for full command output.\r\nWARNING: You are using pip version 20.1.1; however, version 21.1.3 is available.\r\nYou should consider upgrading via the '/home/juanlu/Projects/RTD/sktime/.venv/bin/python3.7 -m pip install --upgrade pip' command.\r\n```\r\n\r\n**Expected behavior**\r\n`pip` installs all required build-time dependencies.\r\n\r\n**Additional context**\r\nInstead of `setup_requires`, would the project be open to switching to PEP-518 `pyproject.toml` build-time dependencies instead? It would look something like this:\r\n\r\n```diff\r\ndiff --git a/pyproject.toml b/pyproject.toml\r\nnew file mode 100644\r\nindex 00000000..2bf5ec80\r\n--- /dev/null\r\n+++ b/pyproject.toml\r\n@@ -0,0 +1,3 @@\r\n+[build-system]\r\n+requires = [\"setuptools\", \"wheel\", \"Cython\"]\r\n+build-backend = \"setuptools.build_meta\"\r\ndiff --git a/setup.py b/setup.py\r\nindex 89ddbc96..5f35b06b 100644\r\n--- a/setup.py\r\n+++ b/setup.py\r\n@@ -101,8 +101,6 @@ CLASSIFIERS = [\r\n     \"Programming Language :: Python :: 3.8\",\r\n ]\r\n \r\n-SETUP_REQUIRES = [\"wheel\"]\r\n-\r\n # Optional setuptools features\r\n # For some commands, use setuptools\r\n SETUPTOOLS_COMMANDS = {\r\n@@ -278,7 +276,6 @@ def setup_package():\r\n         classifiers=CLASSIFIERS,\r\n         cmdclass=cmdclass,\r\n         python_requires=\">={}\".format(MIN_PYTHON_VERSION),\r\n-        setup_requires=SETUP_REQUIRES,\r\n         install_requires=INSTALL_REQUIRES,\r\n         extras_require=EXTRAS_REQUIRE,\r\n         **extra_setuptools_args\r\n\r\n```\r\n\r\nHowever, it didn't work because there is some extra logic in `setup.py`:\r\n\r\nhttps://github.com/alan-turing-institute/sktime/blob/9ca7587bedc861b039a3d9a822ed7ad03ba935ad/setup.py#L314-L315\r\n\r\nas well as `sktime/setup.py` (which fails while doing `from sktime._build_utils import maybe_cythonize_extensions`).","closed_by":{"login":"fkiraly","id":7985502,"node_id":"MDQ6VXNlcjc5ODU1MDI=","avatar_url":"https://avatars.githubusercontent.com/u/7985502?v=4","gravatar_id":"","url":"https://api.github.com/users/fkiraly","html_url":"https://github.com/fkiraly","followers_url":"https://api.github.com/users/fkiraly/followers","following_url":"https://api.github.com/users/fkiraly/following{/other_user}","gists_url":"https://api.github.com/users/fkiraly/gists{/gist_id}","starred_url":"https://api.github.com/users/fkiraly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkiraly/subscriptions","organizations_url":"https://api.github.com/users/fkiraly/orgs","repos_url":"https://api.github.com/users/fkiraly/repos","events_url":"https://api.github.com/users/fkiraly/events{/privacy}","received_events_url":"https://api.github.com/users/fkiraly/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/1150/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/1150/timeline","performed_via_github_app":null,"state_reason":"completed"}