{"url":"https://api.github.com/repos/sktime/sktime/issues/3582","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/3582/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/3582/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/3582/events","html_url":"https://github.com/sktime/sktime/issues/3582","id":1408201350,"node_id":"I_kwDOCVKAsc5T73KG","number":3582,"title":"[BUG] Numba error when setting n_jobs","user":{"login":"henrydeclety","id":15074586,"node_id":"MDQ6VXNlcjE1MDc0NTg2","avatar_url":"https://avatars.githubusercontent.com/u/15074586?v=4","gravatar_id":"","url":"https://api.github.com/users/henrydeclety","html_url":"https://github.com/henrydeclety","followers_url":"https://api.github.com/users/henrydeclety/followers","following_url":"https://api.github.com/users/henrydeclety/following{/other_user}","gists_url":"https://api.github.com/users/henrydeclety/gists{/gist_id}","starred_url":"https://api.github.com/users/henrydeclety/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henrydeclety/subscriptions","organizations_url":"https://api.github.com/users/henrydeclety/orgs","repos_url":"https://api.github.com/users/henrydeclety/repos","events_url":"https://api.github.com/users/henrydeclety/events{/privacy}","received_events_url":"https://api.github.com/users/henrydeclety/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":3102418261,"node_id":"MDU6TGFiZWwzMTAyNDE4MjYx","url":"https://api.github.com/repos/sktime/sktime/labels/module:classification","name":"module:classification","color":"BEB114","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2022-10-13T17:49:33Z","updated_at":"2022-10-18T15:11:19Z","closed_at":"2022-10-18T15:11:19Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the bug**\r\n<!--\r\n-->\r\nNumba error when setting n_jobs\r\n\r\n**To Reproduce**\r\n<!--\r\n-->\r\nHow can i upload my dataset? It has to be related to my dataset because it works fine with sktime datasets.\r\n\r\n```python\r\nestimators = [(\"oscillator\", DrCIF(n_jobs=6), oscillator_columns)]\r\nensemble_model = ColumnEnsembleClassifier(estimators=estimators, remainder=\"passthrough\")\r\nensemble_model.fit(exog, endog)\r\n```\r\n\r\n**Additional context**\r\n<!--\r\n-->\r\nI get the following error when I fit the classifier and set n_jobs (to 6 for exemple). I have double check my dataset, everything seems fine (ive tried applying np.median to all entries and no problem with that).\r\n\r\n```\r\nnumba.core.errors.TypingError: Failed in nopython mode pipeline (step: nopython frontend)\r\nNo implementation of function Function(<function median at 0x7fecff6e0160>) found for signature:\r\n \r\n >>> median(readonly array(float64, 1d, C))\r\n \r\nThere are 2 candidate implementations:\r\n  - Of which 2 did not match due to:\r\n  Overload in function 'np_median': File: numba/np/arraymath.py: Line 1447.\r\n    With argument(s): '(readonly array(float64, 1d, C))':\r\n   Rejected as the implementation raised a specific error:\r\n     TypingError: Failed in nopython mode pipeline (step: nopython frontend)\r\n   No implementation of function Function(<function _median_inner at 0x7fecdee57820>) found for signature:\r\n    \r\n    >>> _median_inner(readonly array(float64, 1d, C), int64)\r\n    \r\n   There are 2 candidate implementations:\r\n         - Of which 2 did not match due to:\r\n         Overload in function 'register_jitable.<locals>.wrap.<locals>.ov_wrap': File: numba/core/extending.py: Line 159.\r\n           With argument(s): '(readonly array(float64, 1d, C), int64)':\r\n          Rejected as the implementation raised a specific error:\r\n            TypingError: Failed in nopython mode pipeline (step: nopython frontend)\r\n          No implementation of function Function(<function _select_two at 0x7fecdee57700>) found for signature:\r\n           \r\n           >>> _select_two(readonly array(float64, 1d, C), int64, Literal[int](0), int64)\r\n           \r\n          There are 2 candidate implementations:\r\n                - Of which 1 did not match due to:\r\n                Overload in function 'register_jitable.<locals>.wrap.<locals>.ov_wrap': File: numba/core/extending.py: Line 159.\r\n                  With argument(s): '(readonly array(float64, 1d, C), int64, int64, int64)':\r\n                 Rejected as the implementation raised a specific error:\r\n                   TypingError: Failed in nopython mode pipeline (step: nopython frontend)\r\n                 No implementation of function Function(<function _partition_factory.<locals>._partition at 0x7fecdee57280>) found for signature:\r\n                  \r\n                  >>> _partition(readonly array(float64, 1d, C), int64, int64)\r\n                  \r\n                 There are 2 candidate implementations:\r\n                       - Of which 2 did not match due to:\r\n                       Overload in function 'register_jitable.<locals>.wrap.<locals>.ov_wrap': File: numba/core/extending.py: Line 159.\r\n                         With argument(s): '(readonly array(float64, 1d, C), int64, int64)':\r\n                        Rejected as the implementation raised a specific error:\r\n                          TypingError: Failed in nopython mode pipeline (step: nopython frontend)\r\n                        No implementation of function Function(<built-in function setitem>) found for signature:\r\n                         \r\n                         >>> setitem(readonly array(float64, 1d, C), int64, float64)\r\n                         \r\n                        There are 16 candidate implementations:\r\n                              - Of which 14 did not match due to:\r\n                              Overload of function 'setitem': File: <numerous>: Line N/A.\r\n                                With argument(s): '(readonly array(float64, 1d, C), int64, float64)':\r\n                               No match.\r\n                              - Of which 2 did not match due to:\r\n                              Overload in function 'SetItemBuffer.generic': File: numba/core/typing/arraydecl.py: Line 176.\r\n                                With argument(s): '(readonly array(float64, 1d, C), int64, float64)':\r\n                               Rejected as the implementation raised a specific error:\r\n                                 NumbaTypeError: Cannot modify readonly array of type: readonly array(float64, 1d, C)\r\n                          raised from /home/henry/anaconda3/lib/python3.9/site-packages/numba/core/typing/arraydecl.py:183\r\n                        \r\n                        During: typing of setitem at /home/henry/anaconda3/lib/python3.9/site-packages/numba/np/arraymath.py (1354)\r\n                        \r\n                        File \"../../anaconda3/lib/python3.9/site-packages/numba/np/arraymath.py\", line 1354:\r\n                            def _partition(A, low, high):\r\n                                <source elided>\r\n                                if pivotimpl(A[mid], A[low]):\r\n                                    A[low], A[mid] = A[mid], A[low]\r\n                                    ^\r\n                 \r\n                   raised from /home/henry/anaconda3/lib/python3.9/site-packages/numba/core/typeinfer.py:1086\r\n                 \r\n                 During: resolving callee type: Function(<function _partition_factory.<locals>._partition at 0x7fecdee57280>)\r\n                 During: typing of call at /home/henry/anaconda3/lib/python3.9/site-packages/numba/np/arraymath.py (1416)\r\n                 \r\n                 \r\n                 File \"../../anaconda3/lib/python3.9/site-packages/numba/np/arraymath.py\", line 1416:\r\n                 def _select_two(arry, k, low, high):\r\n                     <source elided>\r\n                         assert high > low  # by construction\r\n                         i = _partition(arry, low, high)\r\n                         ^\r\n          \r\n            raised from /home/henry/anaconda3/lib/python3.9/site-packages/numba/core/typeinfer.py:1086\r\n                - Of which 1 did not match due to:\r\n                Overload in function 'register_jitable.<locals>.wrap.<locals>.ov_wrap': File: numba/core/extending.py: Line 159.\r\n                  With argument(s): '(readonly array(float64, 1d, C), int64, Literal[int](0), int64)':\r\n                 Rejected as the implementation raised a specific error:\r\n                   TypingError: Failed in nopython mode pipeline (step: nopython frontend)\r\n                 No implementation of function Function(<function _partition_factory.<locals>._partition at 0x7fecdee57280>) found for signature:\r\n                  \r\n                  >>> _partition(readonly array(float64, 1d, C), Literal[int](0), int64)\r\n                  \r\n                 There are 2 candidate implementations:\r\n                       - Of which 1 did not match due to:\r\n                       Overload in function 'register_jitable.<locals>.wrap.<locals>.ov_wrap': File: numba/core/extending.py: Line 159.\r\n                         With argument(s): '(readonly array(float64, 1d, C), int64, int64)':\r\n                        Rejected as the implementation raised a specific error:\r\n                          TypingError: Failed in nopython mode pipeline (step: nopython frontend)\r\n                        No implementation of function Function(<built-in function setitem>) found for signature:\r\n                         \r\n                         >>> setitem(readonly array(float64, 1d, C), int64, float64)\r\n                         \r\n                        There are 16 candidate implementations:\r\n                              - Of which 14 did not match due to:\r\n                              Overload of function 'setitem': File: <numerous>: Line N/A.\r\n                                With argument(s): '(readonly array(float64, 1d, C), int64, float64)':\r\n                               No match.\r\n                              - Of which 2 did not match due to:\r\n                              Overload in function 'SetItemBuffer.generic': File: numba/core/typing/arraydecl.py: Line 176.\r\n                                With argument(s): '(readonly array(float64, 1d, C), int64, float64)':\r\n                               Rejected as the implementation raised a specific error:\r\n                                 NumbaTypeError: Cannot modify readonly array of type: readonly array(float64, 1d, C)\r\n                          raised from /home/henry/anaconda3/lib/python3.9/site-packages/numba/core/typing/arraydecl.py:183\r\n                        \r\n                        During: typing of setitem at /home/henry/anaconda3/lib/python3.9/site-packages/numba/np/arraymath.py (1354)\r\n                        \r\n                        File \"../../anaconda3/lib/python3.9/site-packages/numba/np/arraymath.py\", line 1354:\r\n                            def _partition(A, low, high):\r\n                                <source elided>\r\n                                if pivotimpl(A[mid], A[low]):\r\n                                    A[low], A[mid] = A[mid], A[low]\r\n                                    ^\r\n                 \r\n                   raised from /home/henry/anaconda3/lib/python3.9/site-packages/numba/core/typeinfer.py:1086\r\n                       - Of which 1 did not match due to:\r\n                       Overload in function 'register_jitable.<locals>.wrap.<locals>.ov_wrap': File: numba/core/extending.py: Line 159.\r\n                         With argument(s): '(readonly array(float64, 1d, C), Literal[int](0), int64)':\r\n                        Rejected as the implementation raised a specific error:\r\n                          TypingError: Failed in nopython mode pipeline (step: nopython frontend)\r\n                        No implementation of function Function(<built-in function setitem>) found for signature:\r\n                         \r\n                         >>> setitem(readonly array(float64, 1d, C), Literal[int](0), float64)\r\n                         \r\n                        There are 16 candidate implementations:\r\n                              - Of which 14 did not match due to:\r\n                              Overload of function 'setitem': File: <numerous>: Line N/A.\r\n                                With argument(s): '(readonly array(float64, 1d, C), int64, float64)':\r\n                               No match.\r\n                              - Of which 2 did not match due to:\r\n                              Overload in function 'SetItemBuffer.generic': File: numba/core/typing/arraydecl.py: Line 176.\r\n                                With argument(s): '(readonly array(float64, 1d, C), int64, float64)':\r\n                               Rejected as the implementation raised a specific error:\r\n                                 NumbaTypeError: Cannot modify readonly array of type: readonly array(float64, 1d, C)\r\n                          raised from /home/henry/anaconda3/lib/python3.9/site-packages/numba/core/typing/arraydecl.py:183\r\n                        \r\n                        During: typing of setitem at /home/henry/anaconda3/lib/python3.9/site-packages/numba/np/arraymath.py (1354)\r\n                        \r\n                        File \"../../anaconda3/lib/python3.9/site-packages/numba/np/arraymath.py\", line 1354:\r\n                            def _partition(A, low, high):\r\n                                <source elided>\r\n                                if pivotimpl(A[mid], A[low]):\r\n                                    A[low], A[mid] = A[mid], A[low]\r\n                                    ^\r\n                 \r\n                   raised from /home/henry/anaconda3/lib/python3.9/site-packages/numba/core/typeinfer.py:1086\r\n                 \r\n                 During: resolving callee type: Function(<function _partition_factory.<locals>._partition at 0x7fecdee57280>)\r\n                 During: typing of call at /home/henry/anaconda3/lib/python3.9/site-packages/numba/np/arraymath.py (1416)\r\n                 \r\n                 \r\n                 File \"../../anaconda3/lib/python3.9/site-packages/numba/np/arraymath.py\", line 1416:\r\n                 def _select_two(arry, k, low, high):\r\n                     <source elided>\r\n                         assert high > low  # by construction\r\n                         i = _partition(arry, low, high)\r\n                         ^\r\n          \r\n            raised from /home/henry/anaconda3/lib/python3.9/site-packages/numba/core/typeinfer.py:1086\r\n          \r\n          During: resolving callee type: Function(<function _select_two at 0x7fecdee57700>)\r\n          During: typing of call at /home/henry/anaconda3/lib/python3.9/site-packages/numba/np/arraymath.py (1441)\r\n          \r\n          \r\n          File \"../../anaconda3/lib/python3.9/site-packages/numba/np/arraymath.py\", line 1441:\r\n          def _median_inner(temp_arry, n):\r\n              <source elided>\r\n              if n & 1 == 0:\r\n                  a, b = _select_two(temp_arry, half - 1, low, high)\r\n                  ^\r\n   \r\n     raised from /home/henry/anaconda3/lib/python3.9/site-packages/numba/core/typeinfer.py:1086\r\n   \r\n   During: resolving callee type: Function(<function _median_inner at 0x7fecdee57820>)\r\n   During: typing of call at /home/henry/anaconda3/lib/python3.9/site-packages/numba/np/arraymath.py (1457)\r\n   \r\n   \r\n   File \"../../anaconda3/lib/python3.9/site-packages/numba/np/arraymath.py\", line 1457:\r\n       def median_impl(a):\r\n           <source elided>\r\n           n = temp_arry.shape[0]\r\n           return _median_inner(temp_arry, n)\r\n           ^\r\n\r\n  raised from /home/henry/anaconda3/lib/python3.9/site-packages/numba/core/typeinfer.py:1086\r\n\r\nDuring: resolving callee type: Function(<function median at 0x7fecff6e0160>)\r\nDuring: typing of call at /home/henry/anaconda3/lib/python3.9/site-packages/sktime/utils/numba/stats.py (17)\r\n\r\n\r\nFile \"../../anaconda3/lib/python3.9/site-packages/sktime/utils/numba/stats.py\", line 17:\r\ndef median(X):\r\n    <source elided>\r\n    \"\"\"Numba median function for a single time series.\"\"\"\r\n    return np.median(X)\r\n```\r\n\r\n<!--\r\nPlease run the following code snippet and paste the output here:\r\n \r\nfrom sktime import show_versions; show_versions()\r\n-->\r\n\r\nSystem:\r\n    python: 3.9.12 (main, Apr  5 2022, 06:56:58)  [GCC 7.5.0]\r\nexecutable: /home/henry/anaconda3/bin/python\r\n   machine: Linux-5.15.0-50-generic-x86_64-with-glibc2.31\r\n\r\nPython dependencies:\r\n          pip: 21.2.4\r\n   setuptools: 61.2.0\r\n      sklearn: 1.0.2\r\n       sktime: 0.13.4\r\n  statsmodels: 0.13.2\r\n        numpy: 1.21.5\r\n        scipy: 1.7.3\r\n       pandas: 1.4.2\r\n   matplotlib: 3.5.1\r\n       joblib: 1.1.0\r\n        numba: 0.55.1\r\n     pmdarima: None\r\n      tsfresh: None\r\n\r\n<!-- Thanks for contributing! -->\r\n","closed_by":{"login":"MatthewMiddlehurst","id":25731235,"node_id":"MDQ6VXNlcjI1NzMxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/25731235?v=4","gravatar_id":"","url":"https://api.github.com/users/MatthewMiddlehurst","html_url":"https://github.com/MatthewMiddlehurst","followers_url":"https://api.github.com/users/MatthewMiddlehurst/followers","following_url":"https://api.github.com/users/MatthewMiddlehurst/following{/other_user}","gists_url":"https://api.github.com/users/MatthewMiddlehurst/gists{/gist_id}","starred_url":"https://api.github.com/users/MatthewMiddlehurst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MatthewMiddlehurst/subscriptions","organizations_url":"https://api.github.com/users/MatthewMiddlehurst/orgs","repos_url":"https://api.github.com/users/MatthewMiddlehurst/repos","events_url":"https://api.github.com/users/MatthewMiddlehurst/events{/privacy}","received_events_url":"https://api.github.com/users/MatthewMiddlehurst/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/3582/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/3582/timeline","performed_via_github_app":null,"state_reason":"completed"}