{"url":"https://api.github.com/repos/sktime/sktime/issues/1194","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/1194/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/1194/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/1194/events","html_url":"https://github.com/sktime/sktime/issues/1194","id":951814791,"node_id":"MDU6SXNzdWU5NTE4MTQ3OTE=","number":1194,"title":"[BUG] Fix timing bug in `test_evaluate_common_configs`","user":{"login":"fkiraly","id":7985502,"node_id":"MDQ6VXNlcjc5ODU1MDI=","avatar_url":"https://avatars.githubusercontent.com/u/7985502?v=4","gravatar_id":"","url":"https://api.github.com/users/fkiraly","html_url":"https://github.com/fkiraly","followers_url":"https://api.github.com/users/fkiraly/followers","following_url":"https://api.github.com/users/fkiraly/following{/other_user}","gists_url":"https://api.github.com/users/fkiraly/gists{/gist_id}","starred_url":"https://api.github.com/users/fkiraly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkiraly/subscriptions","organizations_url":"https://api.github.com/users/fkiraly/orgs","repos_url":"https://api.github.com/users/fkiraly/repos","events_url":"https://api.github.com/users/fkiraly/events{/privacy}","received_events_url":"https://api.github.com/users/fkiraly/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1118163266,"node_id":"MDU6TGFiZWwxMTE4MTYzMjY2","url":"https://api.github.com/repos/sktime/sktime/labels/good%20first%20issue","name":"good first issue","color":"9eff91","default":true,"description":"Good for newcomers"},{"id":3105906374,"node_id":"MDU6TGFiZWwzMTA1OTA2Mzc0","url":"https://api.github.com/repos/sktime/sktime/labels/module:forecasting","name":"module:forecasting","color":"35FCCE","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"RNKuhns","id":26907244,"node_id":"MDQ6VXNlcjI2OTA3MjQ0","avatar_url":"https://avatars.githubusercontent.com/u/26907244?v=4","gravatar_id":"","url":"https://api.github.com/users/RNKuhns","html_url":"https://github.com/RNKuhns","followers_url":"https://api.github.com/users/RNKuhns/followers","following_url":"https://api.github.com/users/RNKuhns/following{/other_user}","gists_url":"https://api.github.com/users/RNKuhns/gists{/gist_id}","starred_url":"https://api.github.com/users/RNKuhns/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RNKuhns/subscriptions","organizations_url":"https://api.github.com/users/RNKuhns/orgs","repos_url":"https://api.github.com/users/RNKuhns/repos","events_url":"https://api.github.com/users/RNKuhns/events{/privacy}","received_events_url":"https://api.github.com/users/RNKuhns/received_events","type":"User","site_admin":false},"assignees":[{"login":"RNKuhns","id":26907244,"node_id":"MDQ6VXNlcjI2OTA3MjQ0","avatar_url":"https://avatars.githubusercontent.com/u/26907244?v=4","gravatar_id":"","url":"https://api.github.com/users/RNKuhns","html_url":"https://github.com/RNKuhns","followers_url":"https://api.github.com/users/RNKuhns/followers","following_url":"https://api.github.com/users/RNKuhns/following{/other_user}","gists_url":"https://api.github.com/users/RNKuhns/gists{/gist_id}","starred_url":"https://api.github.com/users/RNKuhns/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RNKuhns/subscriptions","organizations_url":"https://api.github.com/users/RNKuhns/orgs","repos_url":"https://api.github.com/users/RNKuhns/repos","events_url":"https://api.github.com/users/RNKuhns/events{/privacy}","received_events_url":"https://api.github.com/users/RNKuhns/received_events","type":"User","site_admin":false},{"login":"aiwalter","id":29627036,"node_id":"MDQ6VXNlcjI5NjI3MDM2","avatar_url":"https://avatars.githubusercontent.com/u/29627036?v=4","gravatar_id":"","url":"https://api.github.com/users/aiwalter","html_url":"https://github.com/aiwalter","followers_url":"https://api.github.com/users/aiwalter/followers","following_url":"https://api.github.com/users/aiwalter/following{/other_user}","gists_url":"https://api.github.com/users/aiwalter/gists{/gist_id}","starred_url":"https://api.github.com/users/aiwalter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aiwalter/subscriptions","organizations_url":"https://api.github.com/users/aiwalter/orgs","repos_url":"https://api.github.com/users/aiwalter/repos","events_url":"https://api.github.com/users/aiwalter/events{/privacy}","received_events_url":"https://api.github.com/users/aiwalter/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2021-07-23T18:38:46Z","updated_at":"2021-12-04T23:02:46Z","closed_at":"2021-12-04T23:02:46Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"Strange fail in `test_evaluate_common_configs`, from #1191 but unrelated to the PR.\r\nOpening an issue for investigating it. I think this relates to code of @Aiwalter and @RNKuhns.\r\n\r\nSee details for error message:\r\n<details>\r\n```\r\n=================================== FAILURES ===================================\r\n__ test_evaluate_common_configs[scoring0-update-5-10-0-SlidingWindowSplitter] __\r\n\r\nCV = <class 'sktime.forecasting.model_selection._split.SlidingWindowSplitter'>\r\nfh = 0, window_length = 10, step_length = 5, strategy = 'update'\r\nscoring = MeanAbsolutePercentageError(multioutput='uniform_average', symmetric=True)\r\n\r\n    @pytest.mark.parametrize(\"CV\", [SlidingWindowSplitter, ExpandingWindowSplitter])\r\n    @pytest.mark.parametrize(\"fh\", TEST_FHS)\r\n    @pytest.mark.parametrize(\"window_length\", [7, 10])\r\n    @pytest.mark.parametrize(\"step_length\", TEST_STEP_LENGTHS)\r\n    @pytest.mark.parametrize(\"strategy\", [\"refit\", \"update\"])\r\n    @pytest.mark.parametrize(\r\n        \"scoring\",\r\n        [\r\n            MeanAbsolutePercentageError(symmetric=True),\r\n            MeanAbsoluteScaledError(),\r\n        ],\r\n    )\r\n    def test_evaluate_common_configs(CV, fh, window_length, step_length, strategy, scoring):\r\n        y = make_forecasting_problem(n_timepoints=30, index_type=\"int\")\r\n        forecaster = NaiveForecaster()\r\n        cv = CV(fh, window_length, step_length=step_length)\r\n    \r\n        out = evaluate(\r\n            forecaster=forecaster, y=y, cv=cv, strategy=strategy, scoring=scoring\r\n        )\r\n>       _check_evaluate_output(out, cv, y, scoring)\r\n\r\nCV         = <class 'sktime.forecasting.model_selection._split.SlidingWindowSplitter'>\r\ncv         = SlidingWindowSplitter(fh=0, step_length=5)\r\nfh         = 0\r\nforecaster = NaiveForecaster(sp=1, strategy='last', window_length=None)\r\nout        =    cutoff  fit_time  ...  pred_time  test_MeanAbsolutePercentageError\r\n0    12.0  0.000662  ...   0.010524             ...                   0.181488\r\n4    32.0  0.003227  ...   0.009938                          0.874410\r\n\r\n[5 rows x 5 columns]\r\nscoring    = MeanAbsolutePercentageError(multioutput='uniform_average', symmetric=True)\r\nstep_length = 5\r\nstrategy   = 'update'\r\nwindow_length = 10\r\ny          = 3     1.173194\r\n4     2.696492\r\n5     1.143635\r\n6     2.163111\r\n7     1.289422\r\n8     3.973296\r\n9     1.902029\r\n10    1.26309...26    2.226616\r\n27    1.856131\r\n28    2.628671\r\n29    1.621899\r\n30    2.767501\r\n31    2.553693\r\n32    1.000000\r\ndtype: float64\r\n\r\n../../../../hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/sktime/forecasting/model_evaluation/tests/test_evaluate.py:96: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nout =    cutoff  fit_time  ...  pred_time  test_MeanAbsolutePercentageError\r\n0    12.0  0.000662  ...   0.010524             ...                   0.181488\r\n4    32.0  0.003227  ...   0.009938                          0.874410\r\n\r\n[5 rows x 5 columns]\r\ncv = SlidingWindowSplitter(fh=0, step_length=5)\r\ny = 3     1.173194\r\n4     2.696492\r\n5     1.143635\r\n6     2.163111\r\n7     1.289422\r\n8     3.973296\r\n9     1.902029\r\n10    1.26309...26    2.226616\r\n27    1.856131\r\n28    2.628671\r\n29    1.621899\r\n30    2.767501\r\n31    2.553693\r\n32    1.000000\r\ndtype: float64\r\nscoring = MeanAbsolutePercentageError(multioutput='uniform_average', symmetric=True)\r\n\r\n    def _check_evaluate_output(out, cv, y, scoring):\r\n        assert isinstance(out, pd.DataFrame)\r\n    \r\n        # Check column names.\r\n        assert set(out.columns) == {\r\n            \"cutoff\",\r\n            \"fit_time\",\r\n            \"len_train_window\",\r\n            \"pred_time\",\r\n            f\"test_{scoring.name}\",\r\n        }\r\n    \r\n        # Check number of rows against number of splits.\r\n        n_splits = cv.get_n_splits(y)\r\n        assert out.shape[0] == n_splits\r\n    \r\n        # Check if all timings are positive.\r\n>       assert np.all(out.filter(like=\"_time\") >= 0)\r\nE       AssertionError: assert False\r\nE        +  where False = <function all at 0x119006280>(   fit_time  pred_time\\n0  0.000662   0.010524\\n1  0.003379   0.009592\\n2  0.002953   0.009244\\n3  0.003312  -0.037367\\n4  0.003227   0.009938 >= 0)\r\nE        +    where <function all at 0x119006280> = np.all\r\nE        +    and      fit_time  pred_time\\n0  0.000662   0.010524\\n1  0.003379   0.009592\\n2  0.002953   0.009244\\n3  0.003312  -0.037367\\n4  0.003227   0.009938 = <bound method NDFrame.filter of    cutoff  fit_time  ...  pred_time  test_MeanAbsolutePercentageError\\n0    12.0  0.000...                  0.181488\\n4    32.0  0.003227  ...   0.009938                          0.874410\\n\\n[5 rows x 5 columns]>(like='_time')\r\nE        +      where <bound method NDFrame.filter of    cutoff  fit_time  ...  pred_time  test_MeanAbsolutePercentageError\\n0    12.0  0.000...                  0.181488\\n4    32.0  0.003227  ...   0.009938                          0.874410\\n\\n[5 rows x 5 columns]> =    cutoff  fit_time  ...  pred_time  test_MeanAbsolutePercentageError\\n0    12.0  0.000662  ...   0.010524             ...                   0.181488\\n4    32.0  0.003227  ...   0.009938                          0.874410\\n\\n[5 rows x 5 columns].filter\r\n\r\ncv         = SlidingWindowSplitter(fh=0, step_length=5)\r\nn_splits   = 5\r\nout        =    cutoff  fit_time  ...  pred_time  test_MeanAbsolutePercentageError\r\n0    12.0  0.000662  ...   0.010524             ...                   0.181488\r\n4    32.0  0.003227  ...   0.009938                          0.874410\r\n\r\n[5 rows x 5 columns]\r\nscoring    = MeanAbsolutePercentageError(multioutput='uniform_average', symmetric=True)\r\ny          = 3     1.173194\r\n4     2.696492\r\n5     1.143635\r\n6     2.163111\r\n7     1.289422\r\n8     3.973296\r\n9     1.902029\r\n10    1.26309...26    2.226616\r\n27    1.856131\r\n28    2.628671\r\n29    1.621899\r\n30    2.767501\r\n31    2.553693\r\n32    1.000000\r\ndtype: float64\r\n\r\n../../../../hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/sktime/forecasting/model_evaluation/tests/test_evaluate.py:48: AssertionError\r\n=============================== warnings summary ===============================\r\nforecasting/fbprophet.py::sktime.forecasting.fbprophet.Prophet\r\n  /Users/runner/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/Cython/Build/Inline.py:4: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses\r\n    import imp\r\n\r\nforecasting/tests/test_all_forecasters.py: 47 warnings\r\nforecasting/tests/test_sktime_forecasters.py: 5 warnings\r\ntests/test_all_estimators.py: 2 warnings\r\n  /Users/runner/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/statsmodels/tsa/holtwinters/model.py:427: FutureWarning: After 0.13 initialization must be handled at model creation\r\n    warnings.warn(\r\n\r\nforecasting/tests/test_all_forecasters.py: 12 warnings\r\n  /Users/runner/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/statsmodels/tsa/base/tsa_model.py:380: DeprecationWarning: No supported index is available. In the next version, calling this method in a model without a supported index will result in an exception.\r\n    warnings.warn('No supported index is available. In the next'\r\n\r\nforecasting/tests/test_naive.py: 16 warnings\r\n  /Users/runner/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/sktime/forecasting/naive.py:203: RuntimeWarning: Mean of empty slice\r\n    y_pred = np.nanmean(last_window, axis=0)\r\n\r\ntransformations/tests/test_all_transformers.py::test_all_transformers[HampelFilter]\r\n  /Users/runner/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/numpy/lib/nanfunctions.py:1113: RuntimeWarning: All-NaN slice encountered\r\n    r, k = function_base._ureduce(a, func=_nanmedian, axis=axis, out=out,\r\n\r\n-- Docs: https://docs.pytest.org/en/stable/warnings.html\r\n\r\n---------- coverage: platform darwin, python 3.8.11-final-0 ----------\r\nCoverage XML written to file coverage.xml\r\n```\r\n<details>","closed_by":{"login":"mloning","id":21020482,"node_id":"MDQ6VXNlcjIxMDIwNDgy","avatar_url":"https://avatars.githubusercontent.com/u/21020482?v=4","gravatar_id":"","url":"https://api.github.com/users/mloning","html_url":"https://github.com/mloning","followers_url":"https://api.github.com/users/mloning/followers","following_url":"https://api.github.com/users/mloning/following{/other_user}","gists_url":"https://api.github.com/users/mloning/gists{/gist_id}","starred_url":"https://api.github.com/users/mloning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mloning/subscriptions","organizations_url":"https://api.github.com/users/mloning/orgs","repos_url":"https://api.github.com/users/mloning/repos","events_url":"https://api.github.com/users/mloning/events{/privacy}","received_events_url":"https://api.github.com/users/mloning/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/1194/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/1194/timeline","performed_via_github_app":null,"state_reason":"completed"}