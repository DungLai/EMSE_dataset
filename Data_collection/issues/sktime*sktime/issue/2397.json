{"url":"https://api.github.com/repos/sktime/sktime/issues/2397","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/2397/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/2397/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/2397/events","html_url":"https://github.com/sktime/sktime/issues/2397","id":1194053197,"node_id":"I_kwDOCVKAsc5HK85N","number":2397,"title":"[BUG] ShapeletTransformClassifier numba error when dtype is not float64","user":{"login":"srggrs","id":34258464,"node_id":"MDQ6VXNlcjM0MjU4NDY0","avatar_url":"https://avatars.githubusercontent.com/u/34258464?v=4","gravatar_id":"","url":"https://api.github.com/users/srggrs","html_url":"https://github.com/srggrs","followers_url":"https://api.github.com/users/srggrs/followers","following_url":"https://api.github.com/users/srggrs/following{/other_user}","gists_url":"https://api.github.com/users/srggrs/gists{/gist_id}","starred_url":"https://api.github.com/users/srggrs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/srggrs/subscriptions","organizations_url":"https://api.github.com/users/srggrs/orgs","repos_url":"https://api.github.com/users/srggrs/repos","events_url":"https://api.github.com/users/srggrs/events{/privacy}","received_events_url":"https://api.github.com/users/srggrs/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1118163266,"node_id":"MDU6TGFiZWwxMTE4MTYzMjY2","url":"https://api.github.com/repos/sktime/sktime/labels/good%20first%20issue","name":"good first issue","color":"9eff91","default":true,"description":"Good for newcomers"},{"id":3102418261,"node_id":"MDU6TGFiZWwzMTAyNDE4MjYx","url":"https://api.github.com/repos/sktime/sktime/labels/module:classification","name":"module:classification","color":"BEB114","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-04-06T05:27:55Z","updated_at":"2022-10-20T11:48:00Z","closed_at":"2022-10-20T11:48:00Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the bug**\r\nSeems that when using `ShapeletTransformClassifier` there is some Numba accelerated functions that break if the data in the input data frame are of type `int32`.\r\n\r\n**To Reproduce**\r\nMRE as below:\r\n\r\n```python\r\nimport warnings\r\nwarnings.simplefilter('ignore', category=FutureWarning)\r\n\r\nimport numpy as np\r\nimport pandas as pd\r\n\r\nfrom sklearn.model_selection import train_test_split\r\n\r\nfrom sktime.classification.shapelet_based import ShapeletTransformClassifier\r\nfrom sktime.contrib.vector_classifiers._rotation_forest import RotationForest\r\n\r\n# make fake data\r\ndata = pd.DataFrame(np.random.random((5000, 250))).astype(np.float32)\r\n\r\n# reshape to input into Shapelet Classifier\r\ndata4train = data.apply(lambda row: pd.Series({\r\n  'time-series': pd.Series(row.values)\r\n}), axis=1)\r\n\r\n# make targets\r\ntargets = pd.Series(2500 * [1] + 2500 * [0])\r\n\r\n# train test split\r\nX_train, X_test, y_train, y_test = train_test_split(\r\n  data4train, targets, test_size=0.7, random_state=42\r\n)\r\n\r\n# train\r\nclf = ShapeletTransformClassifier(\r\n    estimator=RotationForest(n_estimators=3),\r\n    n_shapelet_samples=500,\r\n    max_shapelets=20,\r\n    batch_size=100,\r\n)\r\n\r\nclf.fit(X_train, y_train)\r\n```\r\n\r\n**Expected behavior**\r\nwill not throw an error, and also enforce conversion to float32 or float64 within the classifier?\r\n**Additional context**\r\nremoving conversion to `float32` (hence `dtype == float64`) will make the code running without issues.\r\n\r\n**Versions**\r\nnumba 0.55.1\r\nsklearn 0.24.1\r\nsktime 0.11.0\r\npandas 1.4.2\r\npython 3.8.10\r\n\r\n**Stacktrace output**\r\n```bash\r\nTypingError: Failed in nopython mode pipeline (step: nopython frontend)\r\nCannot unify array(float64, 1d, C) and array(float32, 1d, C) for 'X_n.2', defined at /path_to_mypython/python/lib/python3.8/site-packages/sktime/utils/numba/general.py (39)\r\n\r\nFile \"../python/lib/python3.8/site-packages/sktime/utils/numba/general.py\", line 39:\r\ndef z_normalise_series(X):\r\n    <source elided>\r\n\r\n    return X_n\r\n```","closed_by":{"login":"patrickzib","id":7783034,"node_id":"MDQ6VXNlcjc3ODMwMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/7783034?v=4","gravatar_id":"","url":"https://api.github.com/users/patrickzib","html_url":"https://github.com/patrickzib","followers_url":"https://api.github.com/users/patrickzib/followers","following_url":"https://api.github.com/users/patrickzib/following{/other_user}","gists_url":"https://api.github.com/users/patrickzib/gists{/gist_id}","starred_url":"https://api.github.com/users/patrickzib/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/patrickzib/subscriptions","organizations_url":"https://api.github.com/users/patrickzib/orgs","repos_url":"https://api.github.com/users/patrickzib/repos","events_url":"https://api.github.com/users/patrickzib/events{/privacy}","received_events_url":"https://api.github.com/users/patrickzib/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/2397/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/2397/timeline","performed_via_github_app":null,"state_reason":"completed"}