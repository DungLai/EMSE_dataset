{"url":"https://api.github.com/repos/sktime/sktime/issues/3539","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/3539/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/3539/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/3539/events","html_url":"https://github.com/sktime/sktime/issues/3539","id":1400828706,"node_id":"I_kwDOCVKAsc5TfvMi","number":3539,"title":"[BUG] Unable to save `TapNet` estimators because of `Lambda` layers","user":{"login":"achieveordie","id":54197164,"node_id":"MDQ6VXNlcjU0MTk3MTY0","avatar_url":"https://avatars.githubusercontent.com/u/54197164?v=4","gravatar_id":"","url":"https://api.github.com/users/achieveordie","html_url":"https://github.com/achieveordie","followers_url":"https://api.github.com/users/achieveordie/followers","following_url":"https://api.github.com/users/achieveordie/following{/other_user}","gists_url":"https://api.github.com/users/achieveordie/gists{/gist_id}","starred_url":"https://api.github.com/users/achieveordie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/achieveordie/subscriptions","organizations_url":"https://api.github.com/users/achieveordie/orgs","repos_url":"https://api.github.com/users/achieveordie/repos","events_url":"https://api.github.com/users/achieveordie/events{/privacy}","received_events_url":"https://api.github.com/users/achieveordie/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":3102418261,"node_id":"MDU6TGFiZWwzMTAyNDE4MjYx","url":"https://api.github.com/repos/sktime/sktime/labels/module:classification","name":"module:classification","color":"BEB114","default":false,"description":""},{"id":3471101012,"node_id":"LA_kwDOCVKAsc7O5MxU","url":"https://api.github.com/repos/sktime/sktime/labels/module:regression","name":"module:regression","color":"943567","default":false,"description":""}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-10-07T08:41:06Z","updated_at":"2022-10-07T12:10:29Z","closed_at":null,"author_association":"COLLABORATOR","active_lock_reason":null,"body":"**Describe the bug**\r\n<!--\r\nA clear and concise description of what the bug is.\r\n-->\r\nThe underlying `keras` model of `TapNetClassifier` and `TapNetRegressor` cannot be saved using `model.save()` because of `Lambda` layers in the implementation.\r\n\r\n**To Reproduce**\r\n<!--\r\nAdd a Minimal, Complete, and Verifiable example (for more details, see e.g. https://stackoverflow.com/help/mcve\r\n\r\nIf the code is too long, feel free to put it in a public gist and link it in the issue: https://gist.github.com\r\n-->\r\n\r\n```python\r\nimport numpy as np\r\nfrom sktime.classification.deep_learning.tapnet import TapNetClassifier\r\n\r\nX = np.random.randn(15, 28, 16)\r\ny = np.random.randint(0, high=2, size=(15, ))\r\n\r\ntapnet = TapNetClassifier()\r\ntapnet.fit(X, y)\r\n\r\ntapnet.save(\"tapnet\")\r\n```\r\n\r\nError Trace:\r\n```python\r\n...\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\site-packages\\keras\\utils\\traceback_utils.py\", line 67, in error_handler\r\n    raise e.with_traceback(filtered_tb) from None\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\copy.py\", line 146, in deepcopy\r\n    y = copier(x, memo)\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\copy.py\", line 230, in _deepcopy_dict\r\n    y[deepcopy(key, memo)] = deepcopy(value, memo)\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\copy.py\", line 146, in deepcopy\r\n    y = copier(x, memo)\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\copy.py\", line 205, in _deepcopy_list\r\n    append(deepcopy(a, memo))\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\copy.py\", line 172, in deepcopy\r\n    y = _reconstruct(x, memo, *rv)\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\copy.py\", line 296, in _reconstruct\r\n    value = deepcopy(value, memo)\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\copy.py\", line 146, in deepcopy\r\n    y = copier(x, memo)\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\copy.py\", line 230, in _deepcopy_dict\r\n    y[deepcopy(key, memo)] = deepcopy(value, memo)\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\copy.py\", line 146, in deepcopy\r\n    y = copier(x, memo)\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\copy.py\", line 210, in _deepcopy_tuple\r\n    y = [deepcopy(a, memo) for a in x]\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\copy.py\", line 210, in <listcomp>\r\n    y = [deepcopy(a, memo) for a in x]\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\copy.py\", line 146, in deepcopy\r\n    y = copier(x, memo)\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\copy.py\", line 210, in _deepcopy_tuple\r\n    y = [deepcopy(a, memo) for a in x]\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\copy.py\", line 210, in <listcomp>\r\n    y = [deepcopy(a, memo) for a in x]\r\n  File \"D:\\Anaconda\\envs\\sktime-dev\\lib\\copy.py\", line 161, in deepcopy\r\n    rv = reductor(4)\r\nTypeError: cannot pickle 'module' object\r\n```\r\n\r\n**Additional context**\r\n<!--\r\nAdd any other context about the problem here.\r\n-->\r\nThis issue was known during migration and needs to be worked upon. The solution is subclassing `tf.keras.layers.Layer` to perform the same operation that `Lambda` layers currently do.\r\n\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/3539/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/3539/timeline","performed_via_github_app":null,"state_reason":null}