{"url":"https://api.github.com/repos/sktime/sktime/issues/3990","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/3990/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/3990/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/3990/events","html_url":"https://github.com/sktime/sktime/issues/3990","id":1510084785,"node_id":"I_kwDOCVKAsc5aAhCx","number":3990,"title":"[ENH] Improve space and time performance during `transform` when using `PeriodIndex` for time related transformers","user":{"login":"KishManani","id":30973056,"node_id":"MDQ6VXNlcjMwOTczMDU2","avatar_url":"https://avatars.githubusercontent.com/u/30973056?v=4","gravatar_id":"","url":"https://api.github.com/users/KishManani","html_url":"https://github.com/KishManani","followers_url":"https://api.github.com/users/KishManani/followers","following_url":"https://api.github.com/users/KishManani/following{/other_user}","gists_url":"https://api.github.com/users/KishManani/gists{/gist_id}","starred_url":"https://api.github.com/users/KishManani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KishManani/subscriptions","organizations_url":"https://api.github.com/users/KishManani/orgs","repos_url":"https://api.github.com/users/KishManani/repos","events_url":"https://api.github.com/users/KishManani/events{/privacy}","received_events_url":"https://api.github.com/users/KishManani/received_events","type":"User","site_admin":false},"labels":[{"id":3745673790,"node_id":"LA_kwDOCVKAsc7fQnI-","url":"https://api.github.com/repos/sktime/sktime/labels/module:datatypes","name":"module:datatypes","color":"bfdadc","default":false,"description":""},{"id":3796180314,"node_id":"LA_kwDOCVKAsc7iRR1a","url":"https://api.github.com/repos/sktime/sktime/labels/enhancement","name":"enhancement","color":"fef2c0","default":true,"description":"Adding new functionality"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2022-12-24T12:52:09Z","updated_at":"2022-12-30T14:06:56Z","closed_at":"2022-12-30T14:06:56Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Is your feature request related to a problem? Please describe.**\r\nThe `DateTimeFeatures` and `TimeSince` transformer are a lot slower and takes up a lot more memory than expected when working with pandas Periods. I think this is due to some of the type checking happening in the `transform` method rather than the implementation in the `_transform` method. On large datasets (e.g., M5 dataset) my kernel surprisingly dies when using `DateTimeFeatures`. \r\n\r\nHere is an example to show the issue:\r\n ```python\r\nimport pandas as pd\r\nimport numpy as np\r\nfrom sktime.transformations.series.date import DateTimeFeatures\r\nfrom sktime.transformations.series.time_since import TimeSince\r\n\r\n# Create time series with datetime index\r\nts_datetime = pd.DataFrame(data={\"y\":np.random.rand(50000)},\r\n                        index=pd.date_range(start=\"2000-01-01\", freq=\"D\", periods=50000))\r\n\r\n# Create time series with period index\r\nts_period = pd.DataFrame(data={\"y\":np.random.rand(50000)},\r\n                        index=pd.period_range(start=\"2000-01-01\", freq=\"D\", periods=50000))\r\n\r\n# Instantiate transformers\r\ndate_time_transformer = DateTimeFeatures(manual_selection=[\r\n    \"day_of_month\",\r\n    \"month_of_year\",\r\n    \"day_of_week\",\r\n])\r\n\r\ntime_since_transformer = TimeSince()\r\n\r\n# Select timeseries with datetime or period index\r\nts = ts_period\r\n\r\n# Fit transformers\r\ndate_time_transformer.fit(ts)\r\ntime_since_transformer.fit(ts)\r\n\r\n# Time the runs\r\n%%timeit\r\nresults = time_since_transformer.transform(ts)\r\n# 3.66 s ± 199 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)\r\n\r\n%%timeit\r\nresults = time_since_transformer._transform(ts)\r\n# 184 ms ± 4.48 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)\r\n\r\n%%timeit\r\nresult = date_time_transformer.transform(ts)\r\n# 3.41 s ± 131 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)\r\n\r\n%%timeit\r\nresult = date_time_transformer._transform(ts)\r\n# 24 ms ± 9.31 ms per loop (mean ± std. dev. of 7 runs, 100 loops each)\r\n```\r\n\r\nThe time difference between running `transform` and `_transform` when the time series has a `PeriodIndex` are large (e.g., for `DateTimeFeatures` there is over a factor of 100 in the execution time).  \r\n\r\nThis issue does not seem to occur when the index is a `DatetimeIndex`. \r\n\r\n**Version**\r\nSystem:\r\n    python: 3.8.7 (default, May  6 2021, 21:53:45)  [Clang 12.0.0 (clang-1200.0.32.29)]\r\nexecutable: /Users/kishan_manani/.pyenv/versions/3.8.7/envs/udemy-ts/bin/python3.8\r\n   machine: macOS-11.6.6-x86_64-i386-64bit\r\n\r\nPython dependencies:\r\n          pip: 22.3.1\r\n   setuptools: 49.2.1\r\n      sklearn: 1.1.3\r\n       sktime: 0.15.0\r\n  statsmodels: 0.13.2\r\n        numpy: 1.21.6\r\n        scipy: 1.8.1\r\n       pandas: 1.4.4\r\n   matplotlib: 3.6.2\r\n       joblib: 1.2.0\r\n        numba: 0.56.4\r\n     pmdarima: 1.8.5\r\n      tsfresh: 0.19.0","closed_by":{"login":"fkiraly","id":7985502,"node_id":"MDQ6VXNlcjc5ODU1MDI=","avatar_url":"https://avatars.githubusercontent.com/u/7985502?v=4","gravatar_id":"","url":"https://api.github.com/users/fkiraly","html_url":"https://github.com/fkiraly","followers_url":"https://api.github.com/users/fkiraly/followers","following_url":"https://api.github.com/users/fkiraly/following{/other_user}","gists_url":"https://api.github.com/users/fkiraly/gists{/gist_id}","starred_url":"https://api.github.com/users/fkiraly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkiraly/subscriptions","organizations_url":"https://api.github.com/users/fkiraly/orgs","repos_url":"https://api.github.com/users/fkiraly/repos","events_url":"https://api.github.com/users/fkiraly/events{/privacy}","received_events_url":"https://api.github.com/users/fkiraly/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/3990/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/3990/timeline","performed_via_github_app":null,"state_reason":"completed"}