{"url":"https://api.github.com/repos/sktime/sktime/issues/1597","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/1597/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/1597/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/1597/events","html_url":"https://github.com/sktime/sktime/issues/1597","id":1048762682,"node_id":"I_kwDOCVKAsc4-gtk6","number":1597,"title":"[BUG] Tests running with Numba parallel enabled","user":{"login":"chrisholder","id":4674372,"node_id":"MDQ6VXNlcjQ2NzQzNzI=","avatar_url":"https://avatars.githubusercontent.com/u/4674372?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisholder","html_url":"https://github.com/chrisholder","followers_url":"https://api.github.com/users/chrisholder/followers","following_url":"https://api.github.com/users/chrisholder/following{/other_user}","gists_url":"https://api.github.com/users/chrisholder/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisholder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisholder/subscriptions","organizations_url":"https://api.github.com/users/chrisholder/orgs","repos_url":"https://api.github.com/users/chrisholder/repos","events_url":"https://api.github.com/users/chrisholder/events{/privacy}","received_events_url":"https://api.github.com/users/chrisholder/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":3129824911,"node_id":"MDU6TGFiZWwzMTI5ODI0OTEx","url":"https://api.github.com/repos/sktime/sktime/labels/module:distances","name":"module:distances","color":"FD4F8F","default":false,"description":""}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-11-09T15:48:04Z","updated_at":"2022-02-23T13:34:38Z","closed_at":null,"author_association":"COLLABORATOR","active_lock_reason":null,"body":"**Describe the bug**\r\n<!--\r\nA clear and concise description of what the bug is.\r\n-->\r\nThis is a bug with our cicd pipeline and the test suite that is run to check a pr passes.\r\n\r\nNumba has a feature that makes multithreading automatic. See here: https://numba.pydata.org/numba-doc/latest/user/parallel.html for more details. While this a great feature and has numerous benefits such as ease of implementation and great performance gains, during sktimes 'checks' (the tests that run when you pr) an error occurs where the test suite cannot run the code in mutliple threads. This essentially stops anyone from being able to take advantage of this automatic threading in future prs (I had to remove it from my distance pr to get the tests to pass). This is a screenshot of the error:\r\n\r\n![image](https://user-images.githubusercontent.com/4674372/140956013-242051ff-3065-45f9-b626-91213407a667.png)\r\n\r\nIn addition (im assuming haven't tested) this also means future tests to check if something can be threaded correctly using pythons native threading library will also fail if set to more than 1 thread (this is a guess I have not tested if this is the case).\r\n\r\n**To Reproduce**\r\n<!--\r\nAdd a Minimal, Complete, and Verifiable example (for more details, see e.g. https://stackoverflow.com/help/mcve\r\n\r\nIf the code is too long, feel free to put it in a public gist and link it in the issue: https://gist.github.com\r\n-->\r\nTry run the tests with any code that is auto threaded like the example below:\r\n\r\n```python\r\nfrom numba import njit, prange\r\n\r\n@njit(parallel=True)\r\ndef prange_test(A):\r\n    s = 0\r\n    # Without \"parallel=True\" in the jit-decorator\r\n    # the prange statement is equivalent to range\r\n    for i in prange(A.shape[0]):\r\n        s += A[i]\r\n    return s\r\n```\r\n\r\n**Expected behavior**\r\n<!--\r\nA clear and concise description of what you expected to happen.\r\n-->\r\nOverall while there are concerns raised over if we should be automatically threading things using this numba feature, I think the main point is currently our test suite does not support multithreading which is a desirable feature.\r\n\r\n**Additional context**\r\n<!--\r\nAdd any other context about the problem here.\r\n-->\r\n\r\n**Versions**\r\n<details>\r\n\r\n<!--\r\nPlease run the following code snippet and paste the output here:\r\n \r\nfrom sktime import show_versions; show_versions()\r\n-->\r\n\r\n</details>\r\n\r\n<!-- Thanks for contributing! -->\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/1597/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/1597/timeline","performed_via_github_app":null,"state_reason":null}