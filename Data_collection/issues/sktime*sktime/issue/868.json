{"url":"https://api.github.com/repos/sktime/sktime/issues/868","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/868/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/868/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/868/events","html_url":"https://github.com/sktime/sktime/issues/868","id":891409419,"node_id":"MDU6SXNzdWU4OTE0MDk0MTk=","number":868,"title":"[BUG] KeyError when forecasting using non-unit frequencies","user":{"login":"ckastner","id":15859947,"node_id":"MDQ6VXNlcjE1ODU5OTQ3","avatar_url":"https://avatars.githubusercontent.com/u/15859947?v=4","gravatar_id":"","url":"https://api.github.com/users/ckastner","html_url":"https://github.com/ckastner","followers_url":"https://api.github.com/users/ckastner/followers","following_url":"https://api.github.com/users/ckastner/following{/other_user}","gists_url":"https://api.github.com/users/ckastner/gists{/gist_id}","starred_url":"https://api.github.com/users/ckastner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ckastner/subscriptions","organizations_url":"https://api.github.com/users/ckastner/orgs","repos_url":"https://api.github.com/users/ckastner/repos","events_url":"https://api.github.com/users/ckastner/events{/privacy}","received_events_url":"https://api.github.com/users/ckastner/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-05-13T21:47:46Z","updated_at":"2021-05-17T18:32:43Z","closed_at":"2021-05-17T18:32:43Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Describe the bug**\r\n\r\nI happen to have a time series with a frequency of 30 minutes. Attempting to use this during forecasting triggers a `KeyError` in pandas.\r\n\r\nThis is because the datetime module assumes that the frequency is always 1 of some unit, ie `(1, freq)`:\r\n\r\nhttps://github.com/alan-turing-institute/sktime/blob/4be4866ac50f0c6ce422716d529e95bfbf25411d/sktime/utils/datetime.py#L41-L44\r\n\r\nHowever, the frequency in my case in `30T`, which is called as `pd.Timedelta(1, \"30T\")`, which triggers the `KeyError`. Instead, The expected call is `pd.Timedelta(30, \"T\")`.\r\n\r\nThe `freqstr` returned by pandas seems to be parsed into a compact one-letter representation. At least, when I manually specified a frequency of `30mins`, reading the frequency returned `30T`. If this is generally true, then a `freqstr` of length > 1 implies that `freqstr[:-1]` hold the number of actual units.\r\n\r\nHowever, a cleaner solution might be to fix this in `_get_freq`:\r\nhttps://github.com/alan-turing-institute/sktime/blob/4be4866ac50f0c6ce422716d529e95bfbf25411d/sktime/utils/datetime.py#L53-L58\r\n\r\n**To Reproduce**\r\n\r\n```python\r\nimport numpy as np\r\nimport pandas as pd\r\n\r\nfrom sktime.forecasting.base import ForecastingHorizon\r\nfrom sktime.forecasting.ets import AutoETS\r\n\r\ns = pd.Series(\r\n    np.random.rand(100),\r\n    index=pd.date_range('20130101 09:00:00', freq='30T', periods=100)\r\n)\r\n\r\ny_train = s[:80]\r\ny_test = s[80:]\r\nfh = ForecastingHorizon(y_test.index, is_relative=False)\r\nforecaster = AutoETS(auto=True, sp=5, n_jobs=-1)\r\nforecaster.fit(y_train)\r\n\r\n# KeyError\r\ny_pred = forecaster.predict(fh)\r\n```\r\n\r\n**Versions**\r\n\r\n```\r\nSystem:\r\n    python: 3.7.3 (default, Jan 22 2021, 20:04:44)  [GCC 8.3.0]\r\nexecutable: /home/christian/TUWien/Energy-efficient Distributed Systems/venv/bin/python3\r\n   machine: Linux-5.10.0-0.bpo.5-amd64-x86_64-with-debian-10.9\r\n\r\nPython dependencies:\r\n          pip: 18.1\r\n   setuptools: 40.8.0\r\n      sklearn: 0.24.2\r\n       sktime: 0.6.0\r\n  statsmodels: 0.12.2\r\n        numpy: 1.19.5\r\n        scipy: 1.6.3\r\n       Cython: 0.29.23\r\n       pandas: 1.2.4\r\n   matplotlib: 3.4.2\r\n       joblib: 1.0.1\r\n        numba: None\r\n     pmdarima: 1.8.2\r\n      tsfresh: None\r\n```","closed_by":{"login":"mloning","id":21020482,"node_id":"MDQ6VXNlcjIxMDIwNDgy","avatar_url":"https://avatars.githubusercontent.com/u/21020482?v=4","gravatar_id":"","url":"https://api.github.com/users/mloning","html_url":"https://github.com/mloning","followers_url":"https://api.github.com/users/mloning/followers","following_url":"https://api.github.com/users/mloning/following{/other_user}","gists_url":"https://api.github.com/users/mloning/gists{/gist_id}","starred_url":"https://api.github.com/users/mloning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mloning/subscriptions","organizations_url":"https://api.github.com/users/mloning/orgs","repos_url":"https://api.github.com/users/mloning/repos","events_url":"https://api.github.com/users/mloning/events{/privacy}","received_events_url":"https://api.github.com/users/mloning/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/868/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/868/timeline","performed_via_github_app":null,"state_reason":"completed"}