{"url":"https://api.github.com/repos/sktime/sktime/issues/3567","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/3567/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/3567/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/3567/events","html_url":"https://github.com/sktime/sktime/issues/3567","id":1403800505,"node_id":"I_kwDOCVKAsc5TrEu5","number":3567,"title":"[ENH] turning `numba` into a soft dependency","user":{"login":"fkiraly","id":7985502,"node_id":"MDQ6VXNlcjc5ODU1MDI=","avatar_url":"https://avatars.githubusercontent.com/u/7985502?v=4","gravatar_id":"","url":"https://api.github.com/users/fkiraly","html_url":"https://github.com/fkiraly","followers_url":"https://api.github.com/users/fkiraly/followers","following_url":"https://api.github.com/users/fkiraly/following{/other_user}","gists_url":"https://api.github.com/users/fkiraly/gists{/gist_id}","starred_url":"https://api.github.com/users/fkiraly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkiraly/subscriptions","organizations_url":"https://api.github.com/users/fkiraly/orgs","repos_url":"https://api.github.com/users/fkiraly/repos","events_url":"https://api.github.com/users/fkiraly/events{/privacy}","received_events_url":"https://api.github.com/users/fkiraly/received_events","type":"User","site_admin":false},"labels":[{"id":1631667223,"node_id":"MDU6TGFiZWwxNjMxNjY3MjIz","url":"https://api.github.com/repos/sktime/sktime/labels/maintenance","name":"maintenance","color":"ea761e","default":false,"description":"Continuous integration, unit testing & package distribution"},{"id":3796180314,"node_id":"LA_kwDOCVKAsc7iRR1a","url":"https://api.github.com/repos/sktime/sktime/labels/enhancement","name":"enhancement","color":"fef2c0","default":true,"description":"Adding new functionality"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":61,"created_at":"2022-10-10T23:10:54Z","updated_at":"2022-12-25T18:43:33Z","closed_at":null,"author_association":"COLLABORATOR","active_lock_reason":null,"body":"I think we should turn `numba` into a soft dependency, since it is not core to the framework, but used only in specific estimators.\r\n\r\n---\r\n\r\nkey arguments for:\r\n\r\n* the only key change is giving users the choice `numba` yes/no\r\n* for users with `numba` installed, the `sktime` experience remains precisely the same\r\n  * users without `numba` will be able to use `sktime`, currently they cannot\r\n  * users without `numba` will still be able to find `numba` based estimators using `all_estimators`, similar to other soft dependencies\r\n* it should be easier to upgrade `sktime` to newer python or package versions, of core dependencies, as `numba` is slow to update compatibility\r\n* makes python 3.11 compatibility possible, at current date\r\n* architectural: reduces coupling, increases layer separation; minimize soft dependencies, see context below\r\n\r\nkey arguments against:\r\n\r\nI don't really see any except the work required\r\n\r\n---\r\n\r\nUpdate: more context on architectural and usage benefits.\r\n\r\nthe general desideratum is \"minimize dependencies\". This is an explicit architectural north star of scikit-learn as well as sktime.\r\n\r\nSee e.g., this paper on sklearn design,\r\nhttps://mblondel.org/publications/lbuitinck-ecmlpkdd2013.pdf\r\nsearch for \"dependencies\" in the text.\r\n\r\nIn the past 6 months, we have made the interfaces of estimators much clearer, including that we can manage python versions and package dependencies on the estimator level, rather than at the sktime package level\r\n\r\nThis has prompted multiple lines of refactoring around \"minimize dependencies\":\r\n\r\n* migrate sktime-dl into sktime because we can isolate tensorflow to estimators\r\n* isolate `statsmodels`\r\n* isolate `numba`\r\n* newly added annotation module soft dependencies are fully isolated\r\n\r\n`statsmodels` isolation and soft dep is very similar, see this PR: https://github.com/sktime/sktime/pull/3821\r\n\r\n---\r\n\r\nFAQ\r\n\r\n> does this remove `numba` support from `sktime`?\r\n\r\nNo, `numba` will still be supported and used in estimators.\r\nIt will only change to be optional, for people who do not want (or need) to use estimators that depend on `numba`.\r\n\r\n> will this impact performance of `sktime`?\r\n\r\nNo. For users who have `numba` installed, the experience is precisely the same. The logic of `numba` based estimators stays the same.\r\n\r\nNo change in estimator accuracy or speed. (evidence: look at the tests in https://github.com/sktime/sktime/pull/3843 which test for both)\r\n\r\nThe only change is that users get a choice whether they want `numba` or not.\r\n\r\n> How can this be implemented within the estimators? Numba requires tags/decorators at each function to be compiled.\r\n\r\nSee https://github.com/sktime/sktime/pull/3631\r\n\r\nstrategy is the same as any dependency isolation on estimator level and uses the `sktime` base class layer:\r\n\r\n* move `numba` imports into functions and classes, where possible\r\n* add the package dependency tag to `numba` dependent estimators to isolate them\r\n* use `pytest.skipif` to conditionally skip `numba` dependent non-suite tests if `numba` is not installed\r\n* specific to `numba` due to use of decorators: where loose functions are decorated with `jit` and `njit`, move them to a private module `_orig_modulename_numba`, and move imports of that into functions or classes\r\n\r\nSame as isolating any soft dependency, see, e.g., same strategy for `statsmodels`:\r\n\r\nhttps://github.com/sktime/sktime/pull/3445\r\nhttps://github.com/sktime/sktime/pull/3515\r\nhttps://github.com/sktime/sktime/pull/3632\r\nhttps://github.com/sktime/sktime/pull/3821","closed_by":{"login":"patrickzib","id":7783034,"node_id":"MDQ6VXNlcjc3ODMwMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/7783034?v=4","gravatar_id":"","url":"https://api.github.com/users/patrickzib","html_url":"https://github.com/patrickzib","followers_url":"https://api.github.com/users/patrickzib/followers","following_url":"https://api.github.com/users/patrickzib/following{/other_user}","gists_url":"https://api.github.com/users/patrickzib/gists{/gist_id}","starred_url":"https://api.github.com/users/patrickzib/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/patrickzib/subscriptions","organizations_url":"https://api.github.com/users/patrickzib/orgs","repos_url":"https://api.github.com/users/patrickzib/repos","events_url":"https://api.github.com/users/patrickzib/events{/privacy}","received_events_url":"https://api.github.com/users/patrickzib/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/3567/reactions","total_count":7,"+1":2,"-1":5,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/3567/timeline","performed_via_github_app":null,"state_reason":"reopened"}