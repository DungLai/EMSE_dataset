{"url":"https://api.github.com/repos/sktime/sktime/issues/1760","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/1760/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/1760/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/1760/events","html_url":"https://github.com/sktime/sktime/issues/1760","id":1080202793,"node_id":"I_kwDOCVKAsc5AYpYp","number":1760,"title":"[BUG] Error when predicting from (T)BATS when the forecasting horizon is longer than the time series used in training","user":{"login":"Garrus990","id":31692791,"node_id":"MDQ6VXNlcjMxNjkyNzkx","avatar_url":"https://avatars.githubusercontent.com/u/31692791?v=4","gravatar_id":"","url":"https://api.github.com/users/Garrus990","html_url":"https://github.com/Garrus990","followers_url":"https://api.github.com/users/Garrus990/followers","following_url":"https://api.github.com/users/Garrus990/following{/other_user}","gists_url":"https://api.github.com/users/Garrus990/gists{/gist_id}","starred_url":"https://api.github.com/users/Garrus990/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Garrus990/subscriptions","organizations_url":"https://api.github.com/users/Garrus990/orgs","repos_url":"https://api.github.com/users/Garrus990/repos","events_url":"https://api.github.com/users/Garrus990/events{/privacy}","received_events_url":"https://api.github.com/users/Garrus990/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":3105906374,"node_id":"MDU6TGFiZWwzMTA1OTA2Mzc0","url":"https://api.github.com/repos/sktime/sktime/labels/module:forecasting","name":"module:forecasting","color":"35FCCE","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2021-12-14T20:40:19Z","updated_at":"2022-02-16T12:26:39Z","closed_at":"2022-02-16T12:26:39Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the bug**\r\nIn sktime 0.9.0 there is an error, when `predict` function is called on a fitted (T)BATS model in case when forecast horizon is longer than the time series used for training. This is purely sktime-related, since the forecasts from `_forecaster` are still possible.\r\n\r\n**To Reproduce**\r\n```python\r\nfrom sktime.forecasting.tbats import TBATS\r\nfrom sktime.forecasting.bats import BATS\r\nfrom statsmodels.tsa.arima_process import arma_generate_sample\r\n\r\n# dummy time series for predictions - length 50\r\ny = pd.Series(arma_generate_sample([2], [2], (50, 1)).flatten())\r\ntbats_model = TBATS()  # the same for BATS\r\ntbats_model.fit(y=y)\r\n\r\ntbats_model.predict(np.arange(1, 10))  #OK\r\ntbats_model.predict(np.arange(1, 25))  #OK\r\ntbats_model.predict(np.arange(1, 50))  #OK\r\ntbats_model.predict(np.arange(1, 51))  #OK\r\ntbats_model.predict(np.arange(1, 52))  #ERROR (forecast horizon of 51 steps)\r\ntbats_model._forecaster.forecast(52) #OK\r\n```\r\n\r\n**Expected behavior**\r\nWell, no error I guess.\r\n\r\n**Additional context**\r\nError message:\r\n```\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n~\\AppData\\Local\\Temp\\4/ipykernel_24092/2542756290.py in <module>\r\n----> 1 tbats_model.predict(np.arange(1, 52))\r\n\r\nc:\\<hidden>\\.venv\\lib\\site-packages\\sktime\\forecasting\\base\\_base.py in predict(self, fh, X, return_pred_int, alpha, keep_old_return_type)\r\n    195         # this is how it is supposed to be after the refactor is complete and effective\r\n    196         if not return_pred_int:\r\n--> 197             y_pred = self._predict(\r\n    198                 self.fh,\r\n    199                 X=X_inner,\r\n\r\nc:\\<hidden>\\.venv\\lib\\site-packages\\sktime\\forecasting\\base\\adapters\\_tbats.py in _predict(self, fh, X, return_pred_int, alpha)\r\n    125             lower = pd.Series(out[\"lower_bound\"])\r\n    126             upper = pd.Series(out[\"upper_bound\"])\r\n--> 127             pred_int = self._get_pred_int(lower=lower, upper=upper)\r\n    128 \r\n    129         else:\r\n\r\nc:\\<hidden>\\.venv\\lib\\site-packages\\sktime\\forecasting\\base\\adapters\\_tbats.py in _get_pred_int(self, lower, upper)\r\n    186             pred_int[\"idx\"].isin(fh_out.to_indexer(self.cutoff).values)\r\n    187         ]\r\n--> 188         pred_int.index = fh_out.to_absolute(self.cutoff)\r\n    189         pred_int = pred_int.drop(columns=[\"idx\"])\r\n    190         return pred_int\r\n\r\nc:\\<hidden>\\.venv\\lib\\site-packages\\pandas\\core\\generic.py in __setattr__(self, name, value)\r\n   5476         try:\r\n   5477             object.__getattribute__(self, name)\r\n-> 5478             return object.__setattr__(self, name, value)\r\n   5479         except AttributeError:\r\n   5480             pass\r\n\r\npandas\\_libs\\properties.pyx in pandas._libs.properties.AxisProperty.__set__()\r\n\r\nc:\\<hidden>\\.venv\\lib\\site-packages\\pandas\\core\\generic.py in _set_axis(self, axis, labels)\r\n    668     def _set_axis(self, axis: int, labels: Index) -> None:\r\n    669         labels = ensure_index(labels)\r\n--> 670         self._mgr.set_axis(axis, labels)\r\n    671         self._clear_item_cache()\r\n    672 \r\n\r\nc:\\<hidden>\\.venv\\lib\\site-packages\\pandas\\core\\internals\\managers.py in set_axis(self, axis, new_labels)\r\n    218 \r\n    219         if new_len != old_len:\r\n--> 220             raise ValueError(\r\n    221                 f\"Length mismatch: Expected axis has {old_len} elements, new \"\r\n    222                 f\"values have {new_len} elements\"\r\n\r\nValueError: Length mismatch: Expected axis has 1 elements, new values have 51 elements\r\n```\r\n\r\n**Versions**\r\n<details>\r\n\r\nSystem:\r\n    python: 3.9.5 (tags/v3.9.5:0a7dcbd, May  3 2021, 17:27:52) [MSC v.1928 64 bit (AMD64)]\r\nexecutable: c:\\<hidden>\\.venv\\scripts\\python.exe\r\n   machine: Windows-10-10.0.18363-SP0\r\n\r\nPython dependencies:\r\n          pip: 21.3.1\r\n   setuptools: 56.0.0\r\n      sklearn: 0.24.2\r\n       sktime: 0.9.0\r\n  statsmodels: 0.12.1\r\n        numpy: 1.19.3\r\n        scipy: 1.7.3\r\n       Cython: 0.29.25\r\n       pandas: 1.2.5\r\n   matplotlib: 3.5.1\r\n       joblib: 1.0.1\r\n        numba: 0.54.1\r\n     pmdarima: 1.8.2\r\n      tsfresh: None\r\n</details>","closed_by":{"login":"Garrus990","id":31692791,"node_id":"MDQ6VXNlcjMxNjkyNzkx","avatar_url":"https://avatars.githubusercontent.com/u/31692791?v=4","gravatar_id":"","url":"https://api.github.com/users/Garrus990","html_url":"https://github.com/Garrus990","followers_url":"https://api.github.com/users/Garrus990/followers","following_url":"https://api.github.com/users/Garrus990/following{/other_user}","gists_url":"https://api.github.com/users/Garrus990/gists{/gist_id}","starred_url":"https://api.github.com/users/Garrus990/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Garrus990/subscriptions","organizations_url":"https://api.github.com/users/Garrus990/orgs","repos_url":"https://api.github.com/users/Garrus990/repos","events_url":"https://api.github.com/users/Garrus990/events{/privacy}","received_events_url":"https://api.github.com/users/Garrus990/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/1760/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/1760/timeline","performed_via_github_app":null,"state_reason":"completed"}