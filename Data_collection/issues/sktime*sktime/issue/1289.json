{"url":"https://api.github.com/repos/sktime/sktime/issues/1289","repository_url":"https://api.github.com/repos/sktime/sktime","labels_url":"https://api.github.com/repos/sktime/sktime/issues/1289/labels{/name}","comments_url":"https://api.github.com/repos/sktime/sktime/issues/1289/comments","events_url":"https://api.github.com/repos/sktime/sktime/issues/1289/events","html_url":"https://github.com/sktime/sktime/issues/1289","id":970245365,"node_id":"MDU6SXNzdWU5NzAyNDUzNjU=","number":1289,"title":"[BUG] TSFreshFeatureExtractor RuntimeError outside of main","user":{"login":"MatthewMiddlehurst","id":25731235,"node_id":"MDQ6VXNlcjI1NzMxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/25731235?v=4","gravatar_id":"","url":"https://api.github.com/users/MatthewMiddlehurst","html_url":"https://github.com/MatthewMiddlehurst","followers_url":"https://api.github.com/users/MatthewMiddlehurst/followers","following_url":"https://api.github.com/users/MatthewMiddlehurst/following{/other_user}","gists_url":"https://api.github.com/users/MatthewMiddlehurst/gists{/gist_id}","starred_url":"https://api.github.com/users/MatthewMiddlehurst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MatthewMiddlehurst/subscriptions","organizations_url":"https://api.github.com/users/MatthewMiddlehurst/orgs","repos_url":"https://api.github.com/users/MatthewMiddlehurst/repos","events_url":"https://api.github.com/users/MatthewMiddlehurst/events{/privacy}","received_events_url":"https://api.github.com/users/MatthewMiddlehurst/received_events","type":"User","site_admin":false},"labels":[{"id":1118163262,"node_id":"MDU6TGFiZWwxMTE4MTYzMjYy","url":"https://api.github.com/repos/sktime/sktime/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":3105907331,"node_id":"MDU6TGFiZWwzMTA1OTA3MzMx","url":"https://api.github.com/repos/sktime/sktime/labels/module:transformations","name":"module:transformations","color":"0865AF","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2021-08-13T09:50:49Z","updated_at":"2022-11-14T15:30:28Z","closed_at":"2022-11-14T15:30:28Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Describe the bug**\r\n\r\nWhen using the TSFreshFeatureExtractor transformer, the following error is continuously output to the terminal. After noticing this wasn't an issue with the tests or functions used to generate test results, I found that this does not occur when the code is run inside main. `if __name__ == \"__main__\":`.\r\n\r\nIt is totally possible this is just me being Python illiterate, and its common sense that it should be run this way with a main, but will create an issue just in case :).\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"<string>\", line 1, in <module>\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\multiprocessing\\spawn.py\", line 116, in spawn_main\r\n    exitcode = _main(fd, parent_sentinel)\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\multiprocessing\\spawn.py\", line 125, in _main\r\n    prepare(preparation_data)\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\multiprocessing\\spawn.py\", line 236, in prepare\r\n    _fixup_main_from_path(data['init_main_from_path'])\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\multiprocessing\\spawn.py\", line 287, in _fixup_main_from_path\r\n    main_content = runpy.run_path(main_path,\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\runpy.py\", line 268, in run_path\r\n    return _run_module_code(code, init_globals, run_name,\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\runpy.py\", line 97, in _run_module_code\r\n    _run_code(code, mod_globals, init_globals,\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\runpy.py\", line 87, in _run_code\r\n    exec(code, run_globals)\r\n  File \"D:\\CMP Machine Learning\\sktime-workshop-boss\\sktime\\contrib\\local_code.py\", line 12, in <module>\r\n    tsfresh.fit_transform(X_train, y_train)\r\n  File \"D:\\CMP Machine Learning\\sktime-workshop-boss\\sktime\\transformations\\base.py\", line 91, in fit_transform\r\n    return self.fit(Z, X).transform(Z)\r\n  File \"D:\\CMP Machine Learning\\sktime-workshop-boss\\sktime\\transformations\\panel\\tsfresh.py\", line 176, in transform\r\n    Xt = extract_features(\r\n  File \"D:\\CMP Machine Learning\\sktime-workshop-boss\\venv\\lib\\site-packages\\tsfresh\\feature_extraction\\extraction.py\", line 152, in extract_features\r\n    result = _do_extraction(df=timeseries_container,\r\n  File \"D:\\CMP Machine Learning\\sktime-workshop-boss\\venv\\lib\\site-packages\\tsfresh\\feature_extraction\\extraction.py\", line 240, in _do_extraction\r\n    distributor = MultiprocessingDistributor(n_workers=n_jobs,\r\n  File \"D:\\CMP Machine Learning\\sktime-workshop-boss\\venv\\lib\\site-packages\\tsfresh\\utilities\\distribution.py\", line 420, in __init__\r\n    self.pool = Pool(processes=n_workers, initializer=initialize_warnings_in_workers, initargs=(show_warnings,))\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\multiprocessing\\context.py\", line 119, in Pool\r\n    return Pool(processes, initializer, initargs, maxtasksperchild,\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\multiprocessing\\pool.py\", line 212, in __init__\r\n    self._repopulate_pool()\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\multiprocessing\\pool.py\", line 303, in _repopulate_pool\r\n    return self._repopulate_pool_static(self._ctx, self.Process,\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\multiprocessing\\pool.py\", line 326, in _repopulate_pool_static\r\n    w.start()\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\multiprocessing\\process.py\", line 121, in start\r\n    self._popen = self._Popen(self)\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\multiprocessing\\context.py\", line 327, in _Popen\r\n    return Popen(process_obj)\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\multiprocessing\\popen_spawn_win32.py\", line 45, in __init__\r\n    prep_data = spawn.get_preparation_data(process_obj._name)\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\multiprocessing\\spawn.py\", line 154, in get_preparation_data\r\n    _check_not_importing_main()\r\n  File \"C:\\Users\\Matthew Middlehurst\\AppData\\Local\\Programs\\Python\\Python39\\lib\\multiprocessing\\spawn.py\", line 134, in _check_not_importing_main\r\n    raise RuntimeError('''\r\nRuntimeError: \r\n        An attempt has been made to start a new process before the\r\n        current process has finished its bootstrapping phase.\r\n        This probably means that you are not using fork to start your\r\n        child processes and you have forgotten to use the proper idiom\r\n        in the main module:\r\n            if __name__ == '__main__':\r\n                freeze_support()\r\n                ...\r\n        The \"freeze_support()\" line can be omitted if the program\r\n        is not going to be frozen to produce an executable.\r\n```\r\n\r\nTransformed data will eventually be output however.\r\n\r\n```\r\n    dim_0__variance_larger_than_standard_deviation  ...  dim_0__matrix_profile__feature_\"75\"__threshold_0.98\r\n0                                              0.0  ...                                           3.334879  \r\n1                                              0.0  ...                                           3.334879  \r\n2                                              0.0  ...                                           3.334879  \r\n3                                              0.0  ...                                           3.334879  \r\n4                                              0.0  ...                                           3.334879  \r\n..                                             ...  ...                                                ...  \r\n62                                             0.0  ...                                           3.334879  \r\n63                                             0.0  ...                                           3.334879  \r\n64                                             0.0  ...                                           3.334879  \r\n65                                             0.0  ...                                           3.334879  \r\n66                                             0.0  ...                                           3.334879  \r\n[67 rows x 787 columns]\r\n```\r\n\r\n\r\n**To Reproduce**\r\n\r\n```\r\nfrom sktime.datasets import load_italy_power_demand\r\nfrom sktime.transformations.panel.tsfresh import TSFreshFeatureExtractor\r\n\r\nX_train, y_train = load_italy_power_demand(split=\"train\", return_X_y=True)\r\n\r\ntsfresh = TSFreshFeatureExtractor(\r\n    default_fc_parameters=\"comprehensive\",\r\n    show_warnings=False,\r\n    disable_progressbar=True,\r\n)\r\n\r\nt = tsfresh.fit_transform(X_train, y_train)\r\nprint(t)\r\n```\r\n\r\n**Versions**\r\n\r\nThis occurs on both my machines running Windows 10, one using Python 3.8 and the other 3.9.\r\n\r\n```\r\nSystem:\r\n    python: 3.8.5 (default, Sep  3 2020, 21:29:08) [MSC v.1916 64 bit (AMD64)]\r\nexecutable: E:\\_ProgramFiles\\Anaconda3\\envs\\sktime-workshop-boss\\python.exe\r\n   machine: Windows-10-10.0.19041-SP0\r\nPython dependencies:\r\n          pip: 20.2.4\r\n   setuptools: 50.3.0.post20201006\r\n      sklearn: 0.24.2\r\n       sktime: 0.7.0\r\n  statsmodels: 0.12.1\r\n        numpy: 1.19.4\r\n        scipy: 1.5.3\r\n       Cython: 0.29.21\r\n       pandas: 1.1.4\r\n   matplotlib: 3.4.2\r\n       joblib: 0.17.0\r\n        numba: 0.51.2\r\n     pmdarima: None\r\n      tsfresh: 0.18.0\r\n```\r\n\r\n","closed_by":{"login":"MatthewMiddlehurst","id":25731235,"node_id":"MDQ6VXNlcjI1NzMxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/25731235?v=4","gravatar_id":"","url":"https://api.github.com/users/MatthewMiddlehurst","html_url":"https://github.com/MatthewMiddlehurst","followers_url":"https://api.github.com/users/MatthewMiddlehurst/followers","following_url":"https://api.github.com/users/MatthewMiddlehurst/following{/other_user}","gists_url":"https://api.github.com/users/MatthewMiddlehurst/gists{/gist_id}","starred_url":"https://api.github.com/users/MatthewMiddlehurst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MatthewMiddlehurst/subscriptions","organizations_url":"https://api.github.com/users/MatthewMiddlehurst/orgs","repos_url":"https://api.github.com/users/MatthewMiddlehurst/repos","events_url":"https://api.github.com/users/MatthewMiddlehurst/events{/privacy}","received_events_url":"https://api.github.com/users/MatthewMiddlehurst/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sktime/sktime/issues/1289/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sktime/sktime/issues/1289/timeline","performed_via_github_app":null,"state_reason":"completed"}