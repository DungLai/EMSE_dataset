[{"id":2441332886,"node_id":"MDEyOkxhYmVsZWRFdmVudDI0NDEzMzI4ODY=","url":"https://api.github.com/repos/mozilla/bugbug/issues/events/2441332886","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-06-26T15:35:45Z","label":{"name":"http_service","color":"fbca04"},"performed_via_github_app":null},{"id":2443595443,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQyNDQzNTk1NDQz","url":"https://api.github.com/repos/mozilla/bugbug/issues/events/2443595443","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2019-06-27T09:18:55Z","assignee":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/506266515","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-506266515","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":506266515,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjI2NjUxNQ==","user":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"created_at":"2019-06-27T09:19:20Z","updated_at":"2019-06-27T09:19:20Z","author_association":"COLLABORATOR","body":"For 1, we likely need batch checkout as pulselistener, as otherwise we can't clone mozilla-central on Heroku.","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/506266515/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/506267846","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-506267846","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":506267846,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjI2Nzg0Ng==","user":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"created_at":"2019-06-27T09:22:52Z","updated_at":"2019-06-27T09:22:52Z","author_association":"COLLABORATOR","body":"I'm starting to write this as a script, which we can then move to an API endpoint.","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/506267846/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false}},{"id":2443607789,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQyNDQzNjA3Nzg5","url":"https://api.github.com/repos/mozilla/bugbug/issues/events/2443607789","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2019-06-27T09:23:02Z","assignee":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/506271503","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-506271503","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":506271503,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjI3MTUwMw==","user":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false},"created_at":"2019-06-27T09:32:37Z","updated_at":"2019-06-27T09:32:37Z","author_association":"CONTRIBUTOR","body":"Sounds good, the hardest part seems to be applying the patch locally as it involves the disk. Does `https://github.com/mozilla/bugbug/blob/master/bugbug/repository.py#L270` is retrieving all the information needed for the commits or other functions are retrieving other information?","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/506271503/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/506273870","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-506273870","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":506273870,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjI3Mzg3MA==","user":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"created_at":"2019-06-27T09:39:42Z","updated_at":"2019-06-27T09:39:42Z","author_association":"COLLABORATOR","body":"There are other functions too, all called from https://github.com/mozilla/bugbug/blob/89bba8efcaa418a8d2a0bfcfea4713e758e521ac/bugbug/repository.py#L662 (log, calculate_experiences, _transform). I should improve the names of these functions.","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/506273870/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/506650225","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-506650225","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":506650225,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjY1MDIyNQ==","user":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false},"created_at":"2019-06-28T08:27:02Z","updated_at":"2019-06-28T08:27:02Z","author_association":"CONTRIBUTOR","body":"I take a look at what we are actually reading from the mercurial repository and I think that the data that requires to actually apply the patch is https://github.com/mozilla/bugbug/blob/master/bugbug/repository.py#L239.\r\n\r\nI think we should be able to do all the work in-memory, maybe with a custom Mercurial extension so we don't need to fiddle with applying a patch then stripping it right after.","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/506650225/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/507616078","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-507616078","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":507616078,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNzYxNjA3OA==","user":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"created_at":"2019-07-02T10:23:32Z","updated_at":"2019-07-02T10:23:32Z","author_association":"COLLABORATOR","body":"I've added a script to the repo: https://github.com/mozilla/bugbug/commit/96ebe8777a333d08105fb39d83cee2cb052bae2c.\r\nIt is currently applying the patch and then reverting it, but we can try to avoid that (filed #664).","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/507616078/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508081165","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-508081165","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":508081165,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODA4MTE2NQ==","user":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"created_at":"2019-07-03T12:55:41Z","updated_at":"2019-07-03T12:55:41Z","author_association":"COLLABORATOR","body":"There is now a hook https://tools.taskcluster.net/hooks/project-relman/bugbug-classify-patch which makes it easy to classify a Phabricator diff.\r\nThe downside of the hook vs a server is that we need to clone the Mercurial repository multiple times (whenever we trigger the hook) rather than just once (whenever we start the server). The upside is that it is very simple.","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508081165/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508476924","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-508476924","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":508476924,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODQ3NjkyNA==","user":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false},"created_at":"2019-07-04T13:09:18Z","updated_at":"2019-07-04T13:09:18Z","author_association":"CONTRIBUTOR","body":"> I've added a script to the repo: [96ebe87](https://github.com/mozilla/bugbug/commit/96ebe8777a333d08105fb39d83cee2cb052bae2c).\r\n> It is currently applying the patch and then reverting it, but we can try to avoid that (filed #664).\r\n\r\nI don't see where the patch is reverted, did you send all of your commits?\r\n\r\nI've answered on https://github.com/mozilla/bugbug/issues/664 for how we could avoid applying the patch on disk.\r\n\r\nDo you want to starts using the hook in the HTTP service? I'm not sure if we can classify a single bug in a satisfying time, we are currently waiting only 100 seconds.","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508476924/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508479693","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-508479693","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":508479693,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODQ3OTY5Mw==","user":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"created_at":"2019-07-04T13:18:32Z","updated_at":"2019-07-04T13:18:32Z","author_association":"COLLABORATOR","body":"> I don't see where the patch is reverted, did you send all of your commits?\r\n\r\nWhen you run the script, the first step is cloning (https://github.com/mozilla/bugbug/blob/2997d222b00abe57ea8513a91044187c73f56cb1/bugbug/repository.py#L752) and cleaning (https://github.com/mozilla/bugbug/blob/2997d222b00abe57ea8513a91044187c73f56cb1/bugbug/repository.py#L733). So it is not reverted after beign applied, but on the second run of the script.\r\n\r\n> Do you want to starts using the hook in the HTTP service? I'm not sure if we can classify a single bug in a satisfying time, we are currently waiting only 100 seconds.\r\n\r\nWe can probably avoid some of the steps that the script takes (e.g. we can pull periodically instead of for each classification).\r\nCould you check what parts of the script take a long time? You can use 125397 as the diff_id.","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508479693/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508487928","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-508487928","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":508487928,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODQ4NzkyOA==","user":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false},"created_at":"2019-07-04T13:44:57Z","updated_at":"2019-07-04T13:44:57Z","author_association":"CONTRIBUTOR","body":"> > I don't see where the patch is reverted, did you send all of your commits?\r\n> \r\n> When you run the script, the first step is cloning (\r\n> \r\n> https://github.com/mozilla/bugbug/blob/2997d222b00abe57ea8513a91044187c73f56cb1/bugbug/repository.py#L752\r\n> ) and cleaning (\r\n> \r\n> https://github.com/mozilla/bugbug/blob/2997d222b00abe57ea8513a91044187c73f56cb1/bugbug/repository.py#L733\r\n> ). So it is not reverted after beign applied, but on the second run of the script.\r\n\r\nIndeed the clone is stripping the outgoing commits which is a bit surprising.\r\n> \r\n> > Do you want to starts using the hook in the HTTP service? I'm not sure if we can classify a single bug in a satisfying time, we are currently waiting only 100 seconds.\r\n> \r\n> We can probably avoid some of the steps that the script takes (e.g. we can pull periodically instead of for each classification).\r\n> Could you check what parts of the script take a long time? You can use 125397 as the diff_id.\r\n\r\nI tried running the script locally already but I got an error, https://github.com/mozilla/bugbug/issues/671. I will time the working part so far.","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508487928/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508537062","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-508537062","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":508537062,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODUzNzA2Mg==","user":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false},"created_at":"2019-07-04T16:45:20Z","updated_at":"2019-07-04T16:45:20Z","author_association":"CONTRIBUTOR","body":"Here are some of the slowest timings for the commit_classifier script:\r\n\r\n- The initial clone took 27 minutes.\r\n- Then the check + stripping takes ~13-15s.\r\n- Downloading the data version takes ~3s.\r\n- Downloading the data took ~32s.\r\n- Iterating on all the commit takes ~19s.\r\n- Applying the phab patch takes ~9-18s.\r\n  - Where getting the patch from phabricator is around ~5-14s.\r\n  - And importing it is around ~1-2s.\r\n- Downloading the commits after the patch has been applied is ~21-24s.\r\n- Classification is pretty quick actually ~3.5s.\r\n\r\nHere are the raw timings:\r\n\r\n```\r\nFull clone\r\n==========\r\n\r\nTimer unit: 1e-06 s\r\n\r\nTotal time: 1710.61 s\r\nFile: /home/lothiraldan/project/mozilla-automl/bugbug/scripts/commit_classifier.py\r\nFunction: update_commit_db at line 40\r\n\r\nLine #      Hits         Time  Per Hit   % Time  Line Contents\r\n==============================================================\r\n    40                                               @profile\r\n    41                                               def update_commit_db(self):\r\n    42         1 1660847444.0 1660847444.0     97.1          repository.clone(self.repo_dir)\r\n    43                                           \r\n    44         1    1574629.0 1574629.0      0.1          db.download_version(repository.COMMITS_DB)\r\n    45         1        617.0    617.0      0.0          if db.is_old_version(repository.COMMITS_DB) or not os.path.exists(\r\n    46         1         11.0     11.0      0.0              repository.COMMITS_DB\r\n    47                                                   ):\r\n    48                                                       db.download(repository.COMMITS_DB, force=True, support_files_too=True)\r\n    49                                           \r\n    50    399171   16963656.0     42.5      1.0          for commit in repository.get_commits():\r\n    51    399170     238914.0      0.6      0.0              pass\r\n    52                                           \r\n    53         1          3.0      3.0      0.0          rev_start = \"children({})\".format(commit[\"node\"])\r\n    54                                           \r\n    55         1   30986175.0 30986175.0      1.8          repository.download_commits(self.repo_dir, rev_start)\r\n\r\nTotal time: 1711.03 s\r\nFile: /home/lothiraldan/project/mozilla-automl/bugbug/scripts/commit_classifier.py\r\nFunction: classify at line 95\r\n\r\nLine #      Hits         Time  Per Hit   % Time  Line Contents\r\n==============================================================\r\n    95                                               @profile\r\n    96                                               def classify(self, diff_id):\r\n    97         1 1711027980.0 1711027980.0    100.0          self.update_commit_db()\r\n\r\nClone ok, no data\r\n=================\r\n\r\nTimer unit: 1e-06 s\r\n\r\nTotal time: 213.921 s\r\nFile: /home/lothiraldan/project/mozilla-automl/bugbug/scripts/commit_classifier.py\r\nFunction: update_commit_db at line 40\r\n\r\nLine #      Hits         Time  Per Hit   % Time  Line Contents\r\n==============================================================\r\n    40                                               @profile\r\n    41                                               def update_commit_db(self):\r\n    42         1   14490475.0 14490475.0      6.8          repository.clone(self.repo_dir)\r\n    43                                           \r\n    44         1    3208754.0 3208754.0      1.5          db.download_version(repository.COMMITS_DB)\r\n    45         1         72.0     72.0      0.0          if db.is_old_version(repository.COMMITS_DB) or not os.path.exists(\r\n    46         1         15.0     15.0      0.0              repository.COMMITS_DB\r\n    47                                                   ):\r\n    48         1   32315039.0 32315039.0     15.1              db.download(repository.COMMITS_DB, force=True, support_files_too=True)\r\n    49                                           \r\n    50    400724   21069859.0     52.6      9.8          for commit in repository.get_commits():\r\n    51    400723     339702.0      0.8      0.2              pass\r\n    52                                           \r\n    53         1          3.0      3.0      0.0          rev_start = \"children({})\".format(commit[\"node\"])\r\n    54                                           \r\n    55         1  142496599.0 142496599.0     66.6          repository.download_commits(self.repo_dir, rev_start)\r\n\r\nTotal time: 18.6953 s\r\nFile: /home/lothiraldan/project/mozilla-automl/bugbug/scripts/commit_classifier.py\r\nFunction: apply_phab at line 57\r\n\r\nLine #      Hits         Time  Per Hit   % Time  Line Contents\r\n==============================================================\r\n    57                                               @profile\r\n    58                                               def apply_phab(self, hg, diff_id):\r\n    59         1          3.0      3.0      0.0          phabricator_api = PhabricatorAPI(\r\n    60         1     758300.0 758300.0      4.1              api_key=get_secret(\"PHABRICATOR_TOKEN\"), url=get_secret(\"PHABRICATOR_URL\")\r\n    61                                                   )\r\n    62                                           \r\n    63         1     770260.0 770260.0      4.1          diffs = phabricator_api.search_diffs(diff_id=diff_id)\r\n    64         1          4.0      4.0      0.0          assert len(diffs) == 1, \"No diff available for {}\".format(diff_id)\r\n    65         1          2.0      2.0      0.0          diff = diffs[0]\r\n    66                                           \r\n    67                                                   # Get the stack of patches\r\n    68         1   14378246.0 14378246.0     76.9          base, patches = phabricator_api.load_patches_stack(hg, diff)\r\n    69         1          4.0      4.0      0.0          assert len(patches) > 0, \"No patches to apply\"\r\n    70                                           \r\n    71                                                   # Load all the diffs details with commits messages\r\n    72         1          2.0      2.0      0.0          diffs = phabricator_api.search_diffs(\r\n    73         1     792468.0 792468.0      4.2              diff_phid=[p[0] for p in patches], attachments={\"commits\": True}\r\n    74                                                   )\r\n    75         1          3.0      3.0      0.0          commits = {\r\n    76                                                       diff[\"phid\"]: diff[\"attachments\"][\"commits\"].get(\"commits\", [])\r\n    77         1          9.0      9.0      0.0              for diff in diffs\r\n    78                                                   }\r\n    79                                           \r\n    80                                                   # First apply patches on local repo\r\n    81         2          4.0      2.0      0.0          for diff_phid, patch in patches:\r\n    82         1          1.0      1.0      0.0              commit = commits.get(diff_phid)\r\n    83                                           \r\n    84         1          1.0      1.0      0.0              message = \"\"\r\n    85         1          1.0      1.0      0.0              if commit:\r\n    86         1          9.0      9.0      0.0                  message += \"{}\\n\".format(commit[0][\"message\"])\r\n    87                                           \r\n    88         1        196.0    196.0      0.0              logger.info(f\"Applying {diff_phid}\")\r\n    89         1          6.0      6.0      0.0              hg.import_(\r\n    90         1          9.0      9.0      0.0                  patches=io.BytesIO(patch.encode(\"utf-8\")),\r\n    91         1          1.0      1.0      0.0                  message=message,\r\n    92         1    1995735.0 1995735.0     10.7                  user=\"bugbug\",\r\n    93                                                       )\r\n\r\nTotal time: 262.725 s\r\nFile: /home/lothiraldan/project/mozilla-automl/bugbug/scripts/commit_classifier.py\r\nFunction: classify at line 95\r\n\r\nLine #      Hits         Time  Per Hit   % Time  Line Contents\r\n==============================================================\r\n    95                                               @profile\r\n    96                                               def classify(self, diff_id):\r\n    97         1  214484165.0 214484165.0     81.6          self.update_commit_db()\r\n    98                                           \r\n    99         1     753935.0 753935.0      0.3          with hglib.open(self.repo_dir) as hg:\r\n   100         1   18695383.0 18695383.0      7.1              self.apply_phab(hg, diff_id)\r\n   101                                           \r\n   102         1     109676.0 109676.0      0.0              patch_rev = hg.log(revrange=\"not public()\")[0].node\r\n   103                                           \r\n   104                                                       # Analyze patch.\r\n   105         1          7.0      7.0      0.0              commits = repository.download_commits(\r\n   106         1   24489193.0 24489193.0      9.3                  self.repo_dir, rev_start=patch_rev.decode(\"utf-8\"), ret=True, save=False\r\n   107                                                       )\r\n   108                                           \r\n   109         1         17.0     17.0      0.0          probs, importance = self.model.classify(\r\n   110         1    3656144.0 3656144.0      1.4              commits[-1], probabilities=True, importances=True\r\n   111                                                   )\r\n   112                                           \r\n   113         1     471758.0 471758.0      0.2          feature_names = self.model.get_feature_names()\r\n   114                                           \r\n   115         1          2.0      2.0      0.0          features = []\r\n   116         1          2.0      2.0      0.0          for i, (val, feature_index, is_positive) in enumerate(\r\n   117         4         26.0      6.5      0.0              importance[\"importances\"]\r\n   118                                                   ):\r\n   119         3          3.0      1.0      0.0              features.append(\r\n   120                                                           [\r\n   121         3          3.0      1.0      0.0                      i + 1,\r\n   122         3          6.0      2.0      0.0                      feature_names[int(feature_index)],\r\n   123         3         21.0      7.0      0.0                      f'({\"+\" if (is_positive) else \"-\"}{val})',\r\n   124                                                           ]\r\n   125                                                       )\r\n   126                                           \r\n   127         1       4203.0   4203.0      0.0          with open(\"probs.json\", \"w\") as f:\r\n   128         1        178.0    178.0      0.0              json.dump(probs[0].tolist(), f)\r\n   129                                           \r\n   130         1        129.0    129.0      0.0          with open(\"importance.html\", \"w\") as f:\r\n   131         1      59847.0  59847.0      0.0              f.write(importance[\"html\"])\r\n\r\nClone ok, data ok\r\n=================\r\n\r\nTimer unit: 1e-06 s\r\n\r\nTotal time: 34.2974 s\r\nFile: /home/lothiraldan/project/mozilla-automl/bugbug/scripts/commit_classifier.py\r\nFunction: update_commit_db at line 40\r\n\r\nLine #      Hits         Time  Per Hit   % Time  Line Contents\r\n==============================================================\r\n    40                                               @profile\r\n    41                                               def update_commit_db(self):\r\n    42         1   12583395.0 12583395.0     36.7          repository.clone(self.repo_dir)\r\n    43                                           \r\n    44         1    1662951.0 1662951.0      4.8          db.download_version(repository.COMMITS_DB)\r\n    45         1         60.0     60.0      0.0          if db.is_old_version(repository.COMMITS_DB) or not os.path.exists(\r\n    46         1          9.0      9.0      0.0              repository.COMMITS_DB\r\n    47                                                   ):\r\n    48                                                       db.download(repository.COMMITS_DB, force=True, support_files_too=True)\r\n    49                                           \r\n    50    400943   19349343.0     48.3     56.4          for commit in repository.get_commits():\r\n    51    400942     299068.0      0.7      0.9              pass\r\n    52                                           \r\n    53         1          4.0      4.0      0.0          rev_start = \"children({})\".format(commit[\"node\"])\r\n    54                                           \r\n    55         1     402599.0 402599.0      1.2          repository.download_commits(self.repo_dir, rev_start)\r\n\r\nTotal time: 9.3412 s\r\nFile: /home/lothiraldan/project/mozilla-automl/bugbug/scripts/commit_classifier.py\r\nFunction: apply_phab at line 57\r\n\r\nLine #      Hits         Time  Per Hit   % Time  Line Contents\r\n==============================================================\r\n    57                                               @profile\r\n    58                                               def apply_phab(self, hg, diff_id):\r\n    59         1          3.0      3.0      0.0          phabricator_api = PhabricatorAPI(\r\n    60         1     783401.0 783401.0      8.4              api_key=get_secret(\"PHABRICATOR_TOKEN\"), url=get_secret(\"PHABRICATOR_URL\")\r\n    61                                                   )\r\n    62                                           \r\n    63         1     713519.0 713519.0      7.6          diffs = phabricator_api.search_diffs(diff_id=diff_id)\r\n    64         1          4.0      4.0      0.0          assert len(diffs) == 1, \"No diff available for {}\".format(diff_id)\r\n    65         1          1.0      1.0      0.0          diff = diffs[0]\r\n    66                                           \r\n    67                                                   # Get the stack of patches\r\n    68         1    5420510.0 5420510.0     58.0          base, patches = phabricator_api.load_patches_stack(hg, diff)\r\n    69         1          2.0      2.0      0.0          assert len(patches) > 0, \"No patches to apply\"\r\n    70                                           \r\n    71                                                   # Load all the diffs details with commits messages\r\n    72         1          2.0      2.0      0.0          diffs = phabricator_api.search_diffs(\r\n    73         1     719767.0 719767.0      7.7              diff_phid=[p[0] for p in patches], attachments={\"commits\": True}\r\n    74                                                   )\r\n    75         1          2.0      2.0      0.0          commits = {\r\n    76                                                       diff[\"phid\"]: diff[\"attachments\"][\"commits\"].get(\"commits\", [])\r\n    77         1          3.0      3.0      0.0              for diff in diffs\r\n    78                                                   }\r\n    79                                           \r\n    80                                                   # First apply patches on local repo\r\n    81         2          5.0      2.5      0.0          for diff_phid, patch in patches:\r\n    82         1          1.0      1.0      0.0              commit = commits.get(diff_phid)\r\n    83                                           \r\n    84         1          1.0      1.0      0.0              message = \"\"\r\n    85         1          1.0      1.0      0.0              if commit:\r\n    86         1          8.0      8.0      0.0                  message += \"{}\\n\".format(commit[0][\"message\"])\r\n    87                                           \r\n    88         1        147.0    147.0      0.0              logger.info(f\"Applying {diff_phid}\")\r\n    89         1          2.0      2.0      0.0              hg.import_(\r\n    90         1          6.0      6.0      0.0                  patches=io.BytesIO(patch.encode(\"utf-8\")),\r\n    91         1          1.0      1.0      0.0                  message=message,\r\n    92         1    1703812.0 1703812.0     18.2                  user=\"bugbug\",\r\n    93                                                       )\r\n\r\nTotal time: 70.1244 s\r\nFile: /home/lothiraldan/project/mozilla-automl/bugbug/scripts/commit_classifier.py\r\nFunction: classify at line 95\r\n\r\nLine #      Hits         Time  Per Hit   % Time  Line Contents\r\n==============================================================\r\n    95                                               @profile\r\n    96                                               def classify(self, diff_id):\r\n    97         1   34765407.0 34765407.0     49.6          self.update_commit_db()\r\n    98                                           \r\n    99         1     394179.0 394179.0      0.6          with hglib.open(self.repo_dir) as hg:\r\n   100         1    9341290.0 9341290.0     13.3              self.apply_phab(hg, diff_id)\r\n   101                                           \r\n   102         1      77083.0  77083.0      0.1              patch_rev = hg.log(revrange=\"not public()\")[0].node\r\n   103                                           \r\n   104                                                       # Analyze patch.\r\n   105         1          7.0      7.0      0.0              commits = repository.download_commits(\r\n   106         1   21335090.0 21335090.0     30.4                  self.repo_dir, rev_start=patch_rev.decode(\"utf-8\"), ret=True, save=False\r\n   107                                                       )\r\n   108                                           \r\n   109         1         16.0     16.0      0.0          probs, importance = self.model.classify(\r\n   110         1    3739291.0 3739291.0      5.3              commits[-1], probabilities=True, importances=True\r\n   111                                                   )\r\n   112                                           \r\n   113         1     422042.0 422042.0      0.6          feature_names = self.model.get_feature_names()\r\n   114                                           \r\n   115         1          3.0      3.0      0.0          features = []\r\n   116         1          2.0      2.0      0.0          for i, (val, feature_index, is_positive) in enumerate(\r\n   117         4         23.0      5.8      0.0              importance[\"importances\"]\r\n   118                                                   ):\r\n   119         3          2.0      0.7      0.0              features.append(\r\n   120                                                           [\r\n   121         3          3.0      1.0      0.0                      i + 1,\r\n   122         3          5.0      1.7      0.0                      feature_names[int(feature_index)],\r\n   123         3         26.0      8.7      0.0                      f'({\"+\" if (is_positive) else \"-\"}{val})',\r\n   124                                                           ]\r\n   125                                                       )\r\n   126                                           \r\n   127         1       3964.0   3964.0      0.0          with open(\"probs.json\", \"w\") as f:\r\n   128         1        132.0    132.0      0.0              json.dump(probs[0].tolist(), f)\r\n   129                                           \r\n   130         1         48.0     48.0      0.0          with open(\"importance.html\", \"w\") as f:\r\n   131         1      45827.0  45827.0      0.1              f.write(importance[\"html\"])\r\n```","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508537062/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508538401","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-508538401","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":508538401,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODUzODQwMQ==","user":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"created_at":"2019-07-04T16:52:26Z","updated_at":"2019-07-04T16:52:26Z","author_association":"COLLABORATOR","body":"Some of those steps will only be done once at startup (e.g. clone). Could you get the timing also of a second run?","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508538401/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508786533","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-508786533","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":508786533,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODc4NjUzMw==","user":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false},"created_at":"2019-07-05T15:01:26Z","updated_at":"2019-07-05T15:01:26Z","author_association":"CONTRIBUTOR","body":"Here are the extracted timings for the raw timings pasted in top.\r\n\r\n# Run 1\r\n\r\nThe repository was not there nor the DB.\r\n\r\nTotal time: 28 minutes 30 seconds\r\n\r\n* Repository clone: 27 minutes 40 seconds\r\n* Iterating on all commit: 16.96 seconds.\r\n* Download all the commits before applying the patch: 30.99 seconds.\r\n\r\nThen the run failed because I didn't had a phabricator token.\r\n\r\n# Run 2\r\n\r\nThe repository was cloned but not the DBs.\r\n\r\nTotal time: 3 minutes 34 seconds\r\n\r\n* Repository checking + stripping: 14.49 seconds.\r\n* Download the data version: 3.2 seconds.\r\n* Download the data: 32.30 seconds.\r\n* Iterating on all commits: 21 seconds.\r\n* Download all the commits before applying the patch: 142.50 seconds.\r\n* Applying the phab patch: 18.70s.\r\n  * Getting the patch from phabricator: 14.37s.\r\n  * Importing the patches: 2s.\r\n* Downloading the commits after the patch has been applied: 24.49s\r\n* Actual classification: 3.65s.\r\n\r\n# Run 3\r\n\r\nThe repository was cloned and the DBs were downloaded and up-to-date.\r\n\r\nTotal time: 34.30s.\r\n\r\n* Repository checking + stripping: 12.58 seconds.\r\n* Download the data version: 1.66 seconds.\r\n* Download the data: DB up-to-date.\r\n* Iterating on all commits: 19.35 seconds.\r\n* Download all the commits before applying the patch: 0.4 seconds.\r\n* Applying the phab patch: 9.34s.\r\n  * Getting the patch from phabricator: 5.42s.\r\n  * Importing the patches: 1.70s.\r\n* Downloading the commits after the patch has been applied: 21.33s\r\n* Actual classification: 3.74s.\r\n\r\nHere are a table of timings:\r\n\r\n|                                                          \t| Run 1                 \t| Run 2          \t| Run 3         \t|\r\n|----------------------------------------------------------\t|-----------------------\t|----------------\t|---------------\t|\r\n| Repository clone                                         \t| 27 minutes 40 seconds \t|                \t|               \t|\r\n| Repository check + stripping                             \t|                       \t| 14.49 seconds  \t| 12.58 seconds \t|\r\n| Download the data version                                \t| 1.57 seconds          \t| 3.2 seconds    \t| 1.66 seconds  \t|\r\n| Download the data                                        \t|                       \t| 32.30 seconds  \t| 1.66 seconds  \t|\r\n| Iterating on all commits                                 \t| 16.96 seconds         \t| 21 seconds     \t| 19.35 seconds \t|\r\n| Download all the commits before applying the patch       \t| 30.99 seconds         \t| 142.50 seconds \t| 0.4 seconds   \t|\r\n| Applying the phab patch                                  \t|                       \t| 18.70s         \t| 9.34s         \t|\r\n| # Getting the patch from phabricator                     \t|                       \t| 14.37s         \t| 5.42s         \t|\r\n| # Importing the patches                                  \t|                       \t| 2s             \t| 1.70s         \t|\r\n| Downloading the commits after the patch has been applied \t|                       \t| 24.49s         \t| 21.33s        \t|\r\n| Actual classification                                    \t|                       \t| 3.65s          \t| 3.74s         \t|","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508786533/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508800844","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-508800844","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":508800844,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODgwMDg0NA==","user":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false},"created_at":"2019-07-05T15:51:45Z","updated_at":"2019-07-05T15:52:05Z","author_association":"CONTRIBUTOR","body":"Here is the timings from `bugbug.repository.download_commits`, bear in mind that it is called two times, one before applying the patch and one after:\r\n\r\nTimings:\r\n\r\nTotal time: 41.10s per call.\r\n\r\n* Getting the first commit node: 1.49s per call.\r\n* Getting the log of commits: 6.12s per call.\r\n* Downloading the component mapping: 2.90s per call.\r\n* Computing the experiences: 28.87s per call.\r\n* Transformating the commits: 1.31s per call.\r\n\r\nHere is the raw data:\r\n\r\n```\r\nTimer unit: 1e-06 s\r\n\r\nTotal time: 82.2131 s\r\nFile: /home/lothiraldan/project/mozilla-automl/bugbug/bugbug/repository.py\r\nFunction: download_commits at line 672\r\n\r\nLine #      Hits         Time  Per Hit   % Time  Line Contents\r\n==============================================================\r\n   672                                           @profile\r\n   673                                           def download_commits(repo_dir, rev_start=0, ret=False, save=True):\r\n   674         2     915472.0 457736.0      1.1      hg = hglib.open(repo_dir)\r\n   675                                           \r\n   676         2     381175.0 190587.5      0.5      revs = get_revs(hg, rev_start)\r\n   677         2         12.0      6.0      0.0      if len(revs) == 0:\r\n   678                                                   print(\"No commits to analyze\")\r\n   679                                                   return []\r\n   680                                           \r\n   681         2    2989620.0 1494810.0      3.6      first_pushdate = hg_log(hg, [b\"0\"])[0].pushdate\r\n   682                                           \r\n   683         2     120654.0  60327.0      0.1      hg.close()\r\n   684                                           \r\n   685         2        154.0     77.0      0.0      processes = multiprocessing.cpu_count()\r\n   686                                           \r\n   687         2         89.0     44.5      0.0      print(f\"Mining {len(revs)} commits using {processes} processes...\")\r\n   688                                           \r\n   689         2         10.0      5.0      0.0      CHUNK_SIZE = 256\r\n   690         2         46.0     23.0      0.0      revs_groups = [revs[i : (i + CHUNK_SIZE)] for i in range(0, len(revs), CHUNK_SIZE)]\r\n   691                                           \r\n   692         2         24.0     12.0      0.0      with concurrent.futures.ProcessPoolExecutor(\r\n   693         2       2751.0   1375.5      0.0          initializer=_init, initargs=(repo_dir,)\r\n   694         2          5.0      2.5      0.0      ) as executor:\r\n   695         2     280236.0 140118.0      0.3          commits = executor.map(_hg_log, revs_groups, chunksize=20)\r\n   696         2      25639.0  12819.5      0.0          commits = tqdm(commits, total=len(revs_groups))\r\n   697         2   12268623.0 6134311.5     14.9          commits = list(itertools.chain.from_iterable(commits))\r\n   698                                           \r\n   699         2         81.0     40.5      0.0      print(\"Downloading file->component mapping...\")\r\n   700                                           \r\n   701         2    5806262.0 2903131.0      7.1      download_component_mapping()\r\n   702                                           \r\n   703         2       6208.0   3104.0      0.0      commits_to_ignore = get_commits_to_ignore(repo_dir, commits)\r\n   704         2         46.0     23.0      0.0      print(f\"{len(commits_to_ignore)} commits to ignore\")\r\n   705                                           \r\n   706         2   57751710.0 28875855.0     70.2      calculate_experiences(commits, commits_to_ignore, first_pushdate, save)\r\n   707                                           \r\n   708                                               # Exclude commits to ignore.\r\n   709         2        144.0     72.0      0.0      commits = [commit for commit in commits if commit not in commits_to_ignore]\r\n   710                                           \r\n   711         2          5.0      2.5      0.0      commits_num = len(commits)\r\n   712                                           \r\n   713         2         79.0     39.5      0.0      print(f\"Mining {commits_num} commits using {processes} processes...\")\r\n   714                                           \r\n   715                                               global rs_parsepatch\r\n   716         2      19399.0   9699.5      0.0      import rs_parsepatch\r\n   717                                           \r\n   718         2          7.0      3.5      0.0      with concurrent.futures.ProcessPoolExecutor(\r\n   719         2       2942.0   1471.0      0.0          initializer=_init, initargs=(repo_dir,)\r\n   720         2         19.0      9.5      0.0      ) as executor:\r\n   721         2     190258.0  95129.0      0.2          commits = executor.map(_transform, commits, chunksize=64)\r\n   722         2       9058.0   4529.0      0.0          commits = tqdm(commits, total=commits_num)\r\n   723                                           \r\n   724         2          7.0      3.5      0.0          if ret:\r\n   725         1    1310102.0 1310102.0      1.6              commits = list(commits)\r\n   726                                           \r\n   727         2          3.0      1.5      0.0          if save:\r\n   728         1       5343.0   5343.0      0.0              db.append(COMMITS_DB, commits)\r\n   729                                           \r\n   730         2        146.0     73.0      0.0          if ret:\r\n   731         1     126814.0 126814.0      0.2              return commits\r\n```","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508800844/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508802265","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-508802265","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":508802265,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODgwMjI2NQ==","user":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false},"created_at":"2019-07-05T15:57:21Z","updated_at":"2019-07-05T15:57:21Z","author_association":"CONTRIBUTOR","body":"`bugbug.repository.calculate_experiences` time seems mostly taken by loading the experience pickle file (66%) and dumping it (32.9%).","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/508802265/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/509165925","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-509165925","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":509165925,"node_id":"MDEyOklzc3VlQ29tbWVudDUwOTE2NTkyNQ==","user":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"created_at":"2019-07-08T10:11:08Z","updated_at":"2019-07-08T10:11:08Z","author_association":"COLLABORATOR","body":">  Getting the first commit node: 1.49s per call.\r\n    Getting the log of commits: 6.12s per call.\r\n    Downloading the component mapping: 2.90s per call.\r\n    Computing the experiences: 28.87s per call.\r\n    Transformating the commits: 1.31s per call.\r\n\r\nWe could do a few of these steps only periodically (e.g. once per day) given that the data won't change much between two subsequent runs.\r\n`Getting the log of commits` can be sped up by avoiding using multiple processes (we pay a big startup cost for analyzing only a few patches in this case).\r\n`Downloading the component mapping` can definitely be done only periodically.\r\n`Computing the experiences` the load of the pickle file can definitely be done only periodically. The dump is already avoided in this case (as save is False).\r\n`Transformating the commits` like `Getting the log of commits`.","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/509165925/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false}},{"id":2994050483,"node_id":"MDE1OlVuYXNzaWduZWRFdmVudDI5OTQwNTA0ODM=","url":"https://api.github.com/repos/mozilla/bugbug/issues/events/2994050483","actor":{"login":"La0","id":101004,"node_id":"MDQ6VXNlcjEwMTAwNA==","avatar_url":"https://avatars.githubusercontent.com/u/101004?v=4","gravatar_id":"","url":"https://api.github.com/users/La0","html_url":"https://github.com/La0","followers_url":"https://api.github.com/users/La0/followers","following_url":"https://api.github.com/users/La0/following{/other_user}","gists_url":"https://api.github.com/users/La0/gists{/gist_id}","starred_url":"https://api.github.com/users/La0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/La0/subscriptions","organizations_url":"https://api.github.com/users/La0/orgs","repos_url":"https://api.github.com/users/La0/repos","events_url":"https://api.github.com/users/La0/events{/privacy}","received_events_url":"https://api.github.com/users/La0/received_events","type":"User","site_admin":false},"event":"unassigned","commit_id":null,"commit_url":null,"created_at":"2020-01-30T16:34:36Z","assignee":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false},"performed_via_github_app":null},{"id":2994050492,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQyOTk0MDUwNDky","url":"https://api.github.com/repos/mozilla/bugbug/issues/events/2994050492","actor":{"login":"La0","id":101004,"node_id":"MDQ6VXNlcjEwMTAwNA==","avatar_url":"https://avatars.githubusercontent.com/u/101004?v=4","gravatar_id":"","url":"https://api.github.com/users/La0","html_url":"https://github.com/La0","followers_url":"https://api.github.com/users/La0/followers","following_url":"https://api.github.com/users/La0/following{/other_user}","gists_url":"https://api.github.com/users/La0/gists{/gist_id}","starred_url":"https://api.github.com/users/La0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/La0/subscriptions","organizations_url":"https://api.github.com/users/La0/orgs","repos_url":"https://api.github.com/users/La0/repos","events_url":"https://api.github.com/users/La0/events{/privacy}","received_events_url":"https://api.github.com/users/La0/received_events","type":"User","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2020-01-30T16:34:36Z","assignee":{"login":"La0","id":101004,"node_id":"MDQ6VXNlcjEwMTAwNA==","avatar_url":"https://avatars.githubusercontent.com/u/101004?v=4","gravatar_id":"","url":"https://api.github.com/users/La0","html_url":"https://github.com/La0","followers_url":"https://api.github.com/users/La0/followers","following_url":"https://api.github.com/users/La0/following{/other_user}","gists_url":"https://api.github.com/users/La0/gists{/gist_id}","starred_url":"https://api.github.com/users/La0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/La0/subscriptions","organizations_url":"https://api.github.com/users/La0/orgs","repos_url":"https://api.github.com/users/La0/repos","events_url":"https://api.github.com/users/La0/events{/privacy}","received_events_url":"https://api.github.com/users/La0/received_events","type":"User","site_admin":false},"performed_via_github_app":null},{"id":3059971886,"node_id":"MDE5OkFkZGVkVG9Qcm9qZWN0RXZlbnQzMDU5OTcxODg2","url":"https://api.github.com/repos/mozilla/bugbug/issues/events/3059971886","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"event":"added_to_project","commit_id":null,"commit_url":null,"created_at":"2020-02-21T10:20:52Z","project_card":{"id":33462552,"url":"https://api.github.com/projects/columns/cards/33462552","project_id":3274900,"project_url":"https://api.github.com/projects/3274900","column_name":"To do"},"performed_via_github_app":null},{"id":3121037228,"node_id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50MzEyMTAzNzIyOA==","url":"https://api.github.com/repos/mozilla/bugbug/issues/events/3121037228","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2020-03-12T00:53:19Z","rename":{"from":"Support classifying commits","to":"Support classifying commits for test selection"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/597952331","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-597952331","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":597952331,"node_id":"MDEyOklzc3VlQ29tbWVudDU5Nzk1MjMzMQ==","user":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"created_at":"2020-03-12T00:53:33Z","updated_at":"2020-03-12T00:53:33Z","author_association":"COLLABORATOR","body":"This should now be done, modulo possible bugs to fix.","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/597952331/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false}},{"id":3121037581,"node_id":"MDExOkNsb3NlZEV2ZW50MzEyMTAzNzU4MQ==","url":"https://api.github.com/repos/mozilla/bugbug/issues/events/3121037581","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-03-12T00:53:33Z","state_reason":null,"performed_via_github_app":null},{"id":3121037606,"node_id":"MDI2Ok1vdmVkQ29sdW1uc0luUHJvamVjdEV2ZW50MzEyMTAzNzYwNg==","url":"https://api.github.com/repos/mozilla/bugbug/issues/events/3121037606","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"event":"moved_columns_in_project","commit_id":null,"commit_url":null,"created_at":"2020-03-12T00:53:34Z","project_card":{"id":33462552,"url":"https://api.github.com/projects/columns/cards/33462552","project_id":3274900,"project_url":"https://api.github.com/projects/3274900","column_name":"Done","previous_column_name":"To do"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/597952412","html_url":"https://github.com/mozilla/bugbug/issues/632#issuecomment-597952412","issue_url":"https://api.github.com/repos/mozilla/bugbug/issues/632","id":597952412,"node_id":"MDEyOklzc3VlQ29tbWVudDU5Nzk1MjQxMg==","user":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"created_at":"2020-03-12T00:53:50Z","updated_at":"2020-03-12T00:53:50Z","author_association":"COLLABORATOR","body":"(and improvements to make it faster)","reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/comments/597952412/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false}}]