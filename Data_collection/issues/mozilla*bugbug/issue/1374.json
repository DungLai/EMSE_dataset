{"url":"https://api.github.com/repos/mozilla/bugbug/issues/1374","repository_url":"https://api.github.com/repos/mozilla/bugbug","labels_url":"https://api.github.com/repos/mozilla/bugbug/issues/1374/labels{/name}","comments_url":"https://api.github.com/repos/mozilla/bugbug/issues/1374/comments","events_url":"https://api.github.com/repos/mozilla/bugbug/issues/1374/events","html_url":"https://github.com/mozilla/bugbug/issues/1374","id":576847653,"node_id":"MDU6SXNzdWU1NzY4NDc2NTM=","number":1374,"title":"Make sure our memory usage is low enough to use a Standard-2x dyno","user":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"labels":[{"id":864568511,"node_id":"MDU6TGFiZWw4NjQ1Njg1MTE=","url":"https://api.github.com/repos/mozilla/bugbug/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"},{"id":1334014691,"node_id":"MDU6TGFiZWwxMzM0MDE0Njkx","url":"https://api.github.com/repos/mozilla/bugbug/labels/http_service","name":"http_service","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"assignees":[{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2020-03-06T10:44:17Z","updated_at":"2020-03-20T18:42:42Z","closed_at":"2020-03-20T18:41:53Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"If we use a Standard-2x dyno, we crash while cloning mozilla-central:\r\n```\r\n2020-03-06T10:01:30.905674+00:00 app[worker.1]: 2020-03-06 10:01:30,905:INFO:bugbug_http.boot:Cloning mozilla-central in /tmp/bugbug-hg...\r\n2020-03-06T10:08:14.456259+00:00 heroku[worker.1]: Process running mem=1484M(144.6%)\r\n2020-03-06T10:08:14.456466+00:00 heroku[worker.1]: Error R14 (Memory quota exceeded)\r\n2020-03-06T10:08:32.835085+00:00 heroku[worker.1]: Process running mem=1654M(158.6%)\r\n2020-03-06T10:08:32.835150+00:00 heroku[worker.1]: Error R14 (Memory quota exceeded)\r\n2020-03-06T10:08:53.580686+00:00 heroku[worker.1]: Process running mem=1838M(169.0%)\r\n2020-03-06T10:08:53.580798+00:00 heroku[worker.1]: Error R14 (Memory quota exceeded)\r\n2020-03-06T10:09:13.675078+00:00 heroku[worker.1]: Process running mem=1959M(179.8%)\r\n2020-03-06T10:09:13.675226+00:00 heroku[worker.1]: Error R14 (Memory quota exceeded)\r\n2020-03-06T10:09:33.801092+00:00 heroku[worker.1]: Process running mem=1980M(185.9%)\r\n2020-03-06T10:09:33.801173+00:00 heroku[worker.1]: Error R14 (Memory quota exceeded)\r\n2020-03-06T10:09:53.841634+00:00 heroku[worker.1]: Process running mem=2127M(198.4%)\r\n2020-03-06T10:09:53.841634+00:00 heroku[worker.1]: Error R14 (Memory quota exceeded)\r\n2020-03-06T10:10:13.904876+00:00 heroku[worker.1]: Process running mem=2106M(204.2%)\r\n2020-03-06T10:10:13.905040+00:00 heroku[worker.1]: Error R15 (Memory quota vastly exceeded)\r\n2020-03-06T10:10:13.905199+00:00 heroku[worker.1]: Stopping process with SIGKILL\r\n2020-03-06T10:10:14.225164+00:00 heroku[worker.1]: State changed from up to crashed\r\n```\r\n\r\nIf we use a Performance-M one, we're all good.\r\n\r\nIt's strange because on code-review we are doing mostly the same thing (using robustcheckout to clone), but we are *not* running out of memory with a Standard-2x.\r\n\r\nMoreover, if we look at the memory usage on Heroku, we see that when we have a Standard-2x we use more memory (> 2 GB) that when we have a Performance-M (~1,8 GB). If we had the same memory usage, we'd be good with Standard-2x:\r\n![wtf](https://user-images.githubusercontent.com/1616846/76076765-c6532d00-5f9f-11ea-9dcd-a5400e0bdff1.png)","closed_by":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/1374/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mozilla/bugbug/issues/1374/timeline","performed_via_github_app":null,"state_reason":"completed"}