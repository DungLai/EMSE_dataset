{"url":"https://api.github.com/repos/mozilla/bugbug/issues/450","repository_url":"https://api.github.com/repos/mozilla/bugbug","labels_url":"https://api.github.com/repos/mozilla/bugbug/issues/450/labels{/name}","comments_url":"https://api.github.com/repos/mozilla/bugbug/issues/450/comments","events_url":"https://api.github.com/repos/mozilla/bugbug/issues/450/events","html_url":"https://github.com/mozilla/bugbug/issues/450","id":445022227,"node_id":"MDU6SXNzdWU0NDUwMjIyMjc=","number":450,"title":"Bug classification can choke on a single bug when giving a list","user":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"assignees":[{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2019-05-16T15:29:45Z","updated_at":"2019-05-17T18:07:00Z","closed_at":"2019-05-17T18:07:00Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"When calling `model.classify` with a list of bug data, a single bug might trigger a error like the following one:\r\n\r\n```python\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.7/site-packages/rq/worker.py\", line 799, in perform_job\r\n    rv = job.perform()\r\n  File \"/usr/local/lib/python3.7/site-packages/rq/job.py\", line 600, in perform\r\n    self._result = self._execute()\r\n  File \"/usr/local/lib/python3.7/site-packages/rq/job.py\", line 606, in _execute\r\n    return self.func(*self.args, **self.kwargs)\r\n  File \"./bugbug_http_service/models.py\", line 101, in classify_bug\r\n    probs = model.classify(list(bugs.values()), True)\r\n  File \"/usr/local/lib/python3.7/site-packages/bugbug/model.py\", line 191, in classify\r\n    X = self.extraction_pipeline.transform(items)\r\n  File \"/usr/local/lib/python3.7/site-packages/sklearn/pipeline.py\", line 540, in _transform\r\n    Xt = transform.transform(Xt)\r\n  File \"/usr/local/lib/python3.7/site-packages/bugbug/bug_features.py\", line 431, in transform\r\n    bug = bug_snapshot.rollback(bug, self.rollback_when)\r\n  File \"/usr/local/lib/python3.7/site-packages/bugbug/bug_snapshot.py\", line 600, in rollback\r\n    ), f'Current value for field {field} of {bug[\"id\"]}:\\n{bug[field]}\\nis different from previous value:\\n{new_value}'\r\nAssertionError: Current value for field product of 812809:\r\n```\r\nAs we are classifying a batch, it is problematic as no other bugs in the batch will be classified.\r\n\r\nhttps://github.com/mozilla/bugbug/pull/321/files#diff-7908c821177e4af7e08af4a9ca055d60R99","closed_by":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/450/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mozilla/bugbug/issues/450/timeline","performed_via_github_app":null,"state_reason":"completed"}