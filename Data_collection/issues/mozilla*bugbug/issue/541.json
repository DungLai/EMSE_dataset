{"url":"https://api.github.com/repos/mozilla/bugbug/issues/541","repository_url":"https://api.github.com/repos/mozilla/bugbug","labels_url":"https://api.github.com/repos/mozilla/bugbug/issues/541/labels{/name}","comments_url":"https://api.github.com/repos/mozilla/bugbug/issues/541/comments","events_url":"https://api.github.com/repos/mozilla/bugbug/issues/541/events","html_url":"https://github.com/mozilla/bugbug/issues/541","id":451883431,"node_id":"MDU6SXNzdWU0NTE4ODM0MzE=","number":541,"title":"Use more diverse bugs in the duplicate classifier","user":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-06-04T09:12:39Z","updated_at":"2019-06-04T13:51:15Z","closed_at":"2019-06-04T13:51:15Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"I think this is why we are seeing artificially high results.\r\n\r\nSince we limit the number of non-duplicate bugs, because of the way we are generating the couples (combination of first bug ID with all other bug IDs, then second bug ID with all other bug IDs, and so on) we end up generating couples where the first element is always the same. Indeed, when we do the combination of the first bug ID with all other bug IDs, we already reach the total number of labels we wanted.\r\n\r\nAdding this snippet in the code right after we add the labels (setting `classes = {}` before each step):\r\n```Python\r\n        from collections import Counter\r\n        all_ids_selected = list(sum(([bug_id1, bug_id2] for bug_id1, bug_id2 in classes.keys()), []))\r\n        print(Counter(all_ids_selected).most_common(24))\r\n        print(f\"Unique bugs: {len(set(all_ids_selected))}\")\r\n```\r\nI see for purely duplicates:\r\n```\r\n[(1390125, 27), (1435472, 22), (1332714, 19), (1412559, 17), (1373490, 15), (1370401, 13), (1386222, 13), (1387340, 13), (1345661, 12), (1460221, 12), (1324399, 11), (1372041, 11), (1389484, 11), (1324255, 10), (1350277, 10), (1392633, 10), (1393213, 10), (1397278, 10), (1330552, 9), (1348432, 9), (1360392, 9), (1363372, 9), (1377950, 9), (1389476, 9)]\r\nUnique bugs: 11493\r\n```\r\nFor hybrid:\r\n```\r\n[(1376257, 3500), (1310752, 1), (35, 1), (101, 1), (1310831, 1), (786819, 1), (1049215, 1), (1311731, 1), (1311790, 1), (1311797, 1), (1311830, 1), (1049816, 1), (1312165, 1), (1050244, 1), (1312587, 1), (1312588, 1), (788319, 1), (1312610, 1), (1312611, 1), (1312613, 1), (1312619, 1), (1312621, 1), (1313019, 1), (1146776, 1)]\r\nUnique bugs: 3501\r\n```\r\nFor purely non-duplicates:\r\n```\r\n[(1310752, 3500), (35, 1), (101, 1), (1310831, 1), (786819, 1), (1049215, 1), (1311731, 1), (1311790, 1), (1311797, 1), (1311830, 1), (1049816, 1), (1312165, 1), (1050244, 1), (1312587, 1), (1312588, 1), (788319, 1), (1312610, 1), (1312611, 1), (1312613, 1), (1312619, 1), (1312621, 1), (1313019, 1), (1146776, 1), (1313272, 1)]\r\nUnique bugs: 3501\r\n```\r\n\r\nSo basically, for duplicate bugs we are good, we already have diverse bugs.\r\nFor non-duplicates instead, we are overfitting as all our labels either contain 1376257 or 1310752.","closed_by":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/541/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mozilla/bugbug/issues/541/timeline","performed_via_github_app":null,"state_reason":"completed"}