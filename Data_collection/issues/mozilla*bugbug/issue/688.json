{"url":"https://api.github.com/repos/mozilla/bugbug/issues/688","repository_url":"https://api.github.com/repos/mozilla/bugbug","labels_url":"https://api.github.com/repos/mozilla/bugbug/issues/688/labels{/name}","comments_url":"https://api.github.com/repos/mozilla/bugbug/issues/688/comments","events_url":"https://api.github.com/repos/mozilla/bugbug/issues/688/events","html_url":"https://github.com/mozilla/bugbug/issues/688","id":466577751,"node_id":"MDU6SXNzdWU0NjY1Nzc3NTE=","number":688,"title":"commit_classifier should fail more clearly when a patch fails to apply","user":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"labels":[{"id":864568511,"node_id":"MDU6TGFiZWw4NjQ1Njg1MTE=","url":"https://api.github.com/repos/mozilla/bugbug/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2019-07-10T23:40:52Z","updated_at":"2019-07-10T23:40:52Z","closed_at":null,"author_association":"COLLABORATOR","active_lock_reason":null,"body":"Here's a failure when analyzying diff 2092:\r\n```\r\n[taskcluster 2019-07-10 23:02:38.320Z] Task ID: FRXAdmgrTvW8S9EJlQJUKA\r\n[taskcluster 2019-07-10 23:02:38.320Z] Worker ID: i-08e78eb425d338012\r\n[taskcluster 2019-07-10 23:02:38.320Z] Worker Group: us-west-2\r\n[taskcluster 2019-07-10 23:02:38.320Z] Worker Node Type: m5d.xlarge\r\n[taskcluster 2019-07-10 23:02:38.320Z] Worker Type: taskcluster-generic\r\n[taskcluster 2019-07-10 23:02:38.320Z] Public IP: 52.24.14.133\r\n[taskcluster 2019-07-10 23:02:38.320Z] using cache \"bugbug-mercurial-repository\" -> /cache\r\n\r\n01f3b6f74410 - Started downloading\r\n163142c4383b - Started downloading\r\nfc7181108d40 - Started downloading\r\n01f3b6f74410 - Downloaded in 0.044 seconds\r\n163142c4383b - Downloaded in 0.161 seconds\r\nfc7181108d40 - Downloaded in 0.227 seconds\r\neeed0da1db91 - Started downloading\r\neeed0da1db91 - Downloaded in 0.001 seconds\r\nea6d6fd23371 - Started downloading\r\nea6d6fd23371 - Downloaded in 0.058 seconds\r\n4ead6828b3f7 - Started downloading\r\n4ead6828b3f7 - Downloaded in 0.001 seconds\r\n6aaa23becf86 - Started downloading\r\n38b2941251a6 - Started downloading\r\n38b2941251a6 - Downloaded in 0.028 seconds\r\ne5011c48d98f - Started downloading\r\ne5011c48d98f - Downloaded in 0.028 seconds\r\nadce71c8776c - Started downloading\r\n22c80e7a6b6e - Started downloading\r\n22c80e7a6b6e - Downloaded in 0.086 seconds\r\n3585903a67e7 - Started downloading\r\n3585903a67e7 - Downloaded in 0.181 seconds\r\n67f1262bd104 - Started downloading\r\n67f1262bd104 - Downloaded in 0 seconds\r\nadce71c8776c - Downloaded in 1.205 seconds\r\n6aaa23becf86 - Downloaded in 2.524 seconds\r\nDigest: sha256:c7d2a2ff681aba5c458c393369275ffbacec603cb76f5d641f93aa8b42ce9311\r\nStatus: Downloaded newer image for mozilla/bugbug-commit-retrieval:v0.0.64\r\n[taskcluster 2019-07-10 23:02:57.790Z] === Task Starting ===\r\nINFO:matplotlib.font_manager:generated new fontManager\r\n/usr/local/lib/python3.7/site-packages/sklearn/externals/joblib/__init__.py:15: DeprecationWarning: sklearn.externals.joblib is deprecated in 0.21 and will be removed in 0.23. Please import this functionality directly from joblib, which can be installed with: pip install joblib. If this warning is raised when loading pickled models, you may need to re-serialize those models with scikit-learn 0.21+.\r\n  warnings.warn(msg, category=DeprecationWarning)\r\nINFO:bugbug.repository:mozilla-central cloned\r\nINFO:bugbug.repository:Pulling and updating mozilla-central\r\nINFO:bugbug.repository:mozilla-central pulled and updated\r\nDownloading https://index.taskcluster.net/v1/task/project.relman.bugbug.data_commits.latest/artifacts/public/commits.json.version to data/commits.json.version\r\nDownloading https://index.taskcluster.net/v1/task/project.relman.bugbug.data_commits.latest/artifacts/public/commits.json.zst to data/commits.json.zst\r\nDownloading https://index.taskcluster.net/v1/task/project.relman.bugbug.data_commits.latest/artifacts/public/commit_experiences.pickle.zst to data/commit_experiences.pickle.zst\r\nGetting revs from children(404680ad41e4e7d08aa46081a70095486f14e15f) to tip...\r\nMining 363 commits using 4 processes...\r\n\r\n  0% 0/2 [00:00<?, ?it/s]\r\n 50% 1/2 [00:07<00:07,  7.64s/it]\r\n100% 2/2 [00:07<00:00,  3.82s/it]\r\nDownloading file->component mapping...\r\n33 commits to ignore\r\nAnalyzing experiences from 363 commits...\r\n\r\n  0% 0/363 [00:00<?, ?it/s]\r\n100% 363/363 [00:00<00:00, 416447.58it/s]\r\n\r\n  0% 0/363 [00:00<?, ?it/s]\r\n 13% 46/363 [00:00<00:00, 457.92it/s]\r\n 27% 97/363 [00:00<00:00, 467.42it/s]\r\n 40% 145/363 [00:00<00:00, 465.22it/s]\r\n 64% 234/363 [00:00<00:00, 541.81it/s]\r\n 78% 282/363 [00:00<00:00, 486.71it/s]\r\n 97% 352/363 [00:00<00:00, 535.60it/s]\r\n100% 363/363 [00:00<00:00, 541.68it/s]\r\nMining 330 commits using 4 processes...\r\n\r\n  0% 0/330 [00:00<?, ?it/s]\r\n  0% 1/330 [00:14<1:21:09, 14.80s/it]\r\n 20% 65/330 [00:15<45:45, 10.36s/it] \r\n 39% 129/330 [00:19<24:22,  7.27s/it]\r\n 78% 257/330 [00:23<06:12,  5.10s/it]\r\n100% 330/330 [00:23<00:00, 14.05it/s]\r\nINFO:libmozdata.phabricator:Authenticated on https://phabricator.services.mozilla.com/api/ as Code Review Bot\r\nINFO:libmozdata.phabricator:Loading parent diff PHID-DREV-ll7wr52yex72oblff4lg\r\nINFO:libmozdata.phabricator:Found a parent with landed revision d3a59e1b1be58fc4f824dc62ded7ba7d57f89157, stopping stack here\r\nINFO:libmozdata.phabricator:Updating repo to revision d3a59e1b1be58fc4f824dc62ded7ba7d57f89157\r\nINFO:libmozdata.phabricator:Updated repo to revision b'd3a59e1b1be58fc4f824dc62ded7ba7d57f89157'\r\nINFO:scripts.commit_classifier:Applying PHID-DIFF-pfdszum2ohicagscjkmo\r\nTraceback (most recent call last):\r\n  File \"/usr/local/bin/bugbug-classify-commit\", line 10, in <module>\r\n    sys.exit(main())\r\n  File \"/usr/local/lib/python3.7/site-packages/scripts/commit_classifier.py\", line 141, in main\r\n    classifier.classify(args.diff_id)\r\n  File \"/usr/local/lib/python3.7/site-packages/scripts/commit_classifier.py\", line 97, in classify\r\n    self.apply_phab(hg, diff_id)\r\n  File \"/usr/local/lib/python3.7/site-packages/scripts/commit_classifier.py\", line 90, in apply_phab\r\n    user=\"bugbug\",\r\n  File \"/usr/local/lib/python3.7/site-packages/hglib/client.py\", line 996, in import_\r\n    self.rawcommand(args, prompt=prompt, input=input)\r\n  File \"/usr/local/lib/python3.7/site-packages/hglib/client.py\", line 263, in rawcommand\r\n    raise error.CommandError(args, ret, out, err)\r\nhglib.error.CommandError: (255, b'applying patch from stdin\\n/bin/sh: 1: vi: not found', b'abort: edit failed: vi exited with status 127')\r\n[taskcluster 2019-07-10 23:09:04.864Z] === Task Finished ===\r\n[taskcluster 2019-07-10 23:09:04.966Z] Artifact \"public/importance.html\" not found at \"/importance.html\"\r\n[taskcluster 2019-07-10 23:09:05.040Z] Artifact \"public/probs.json\" not found at \"/probs.json\"\r\n[taskcluster 2019-07-10 23:09:05.722Z] Unsuccessful task run with exit code: 1 completed in 387.403 seconds\r\n```\r\n\r\nProbably the patch failed to apply and mercurial tried to run vi to let the user solve conflicts.","closed_by":null,"reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/688/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mozilla/bugbug/issues/688/timeline","performed_via_github_app":null,"state_reason":null}