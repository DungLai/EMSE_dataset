{"url":"https://api.github.com/repos/mozilla/bugbug/issues/2855","repository_url":"https://api.github.com/repos/mozilla/bugbug","labels_url":"https://api.github.com/repos/mozilla/bugbug/issues/2855/labels{/name}","comments_url":"https://api.github.com/repos/mozilla/bugbug/issues/2855/comments","events_url":"https://api.github.com/repos/mozilla/bugbug/issues/2855/events","html_url":"https://github.com/mozilla/bugbug/issues/2855","id":1182896012,"node_id":"I_kwDOB3H77M5GgY-M","number":2855,"title":"Failing to build on Apple M1","user":{"login":"suhaibmujahid","id":4151357,"node_id":"MDQ6VXNlcjQxNTEzNTc=","avatar_url":"https://avatars.githubusercontent.com/u/4151357?v=4","gravatar_id":"","url":"https://api.github.com/users/suhaibmujahid","html_url":"https://github.com/suhaibmujahid","followers_url":"https://api.github.com/users/suhaibmujahid/followers","following_url":"https://api.github.com/users/suhaibmujahid/following{/other_user}","gists_url":"https://api.github.com/users/suhaibmujahid/gists{/gist_id}","starred_url":"https://api.github.com/users/suhaibmujahid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/suhaibmujahid/subscriptions","organizations_url":"https://api.github.com/users/suhaibmujahid/orgs","repos_url":"https://api.github.com/users/suhaibmujahid/repos","events_url":"https://api.github.com/users/suhaibmujahid/events{/privacy}","received_events_url":"https://api.github.com/users/suhaibmujahid/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-03-28T05:09:59Z","updated_at":"2022-03-29T21:46:00Z","closed_at":"2022-03-29T21:46:00Z","author_association":"MEMBER","active_lock_reason":null,"body":"Running `pip install -r requirements.txt` gives the following error:\r\n\r\n```\r\nBuilding wheels for collected packages: llvmlite\r\n  Building wheel for llvmlite (setup.py) ... error\r\n  error: subprocess-exited-with-error\r\n\r\n  × python setup.py bdist_wheel did not run successfully.\r\n  │ exit code: 1\r\n  ╰─> [15 lines of output]\r\n      running bdist_wheel\r\n      ~/repos/mozilla/bugbug/venv/bin/python /private/var/folders/z4/12lcyr2n3c37kzjfksk6hwx40000gn/T/pip-install-045kded6/llvmlite_e0783b5b2e3b48288cdb7a651eb9c07b/ffi/build.py\r\n      LLVM version... 13.0.1\r\n\r\n      Traceback (most recent call last):\r\n        File \"/private/var/folders/z4/12lcyr2n3c37kzjfksk6hwx40000gn/T/pip-install-045kded6/llvmlite_e0783b5b2e3b48288cdb7a651eb9c07b/ffi/build.py\", line 220, in <module>\r\n          main()\r\n        File \"/private/var/folders/z4/12lcyr2n3c37kzjfksk6hwx40000gn/T/pip-install-045kded6/llvmlite_e0783b5b2e3b48288cdb7a651eb9c07b/ffi/build.py\", line 214, in main\r\n          main_posix('osx', '.dylib')\r\n        File \"/private/var/folders/z4/12lcyr2n3c37kzjfksk6hwx40000gn/T/pip-install-045kded6/llvmlite_e0783b5b2e3b48288cdb7a651eb9c07b/ffi/build.py\", line 172, in main_posix\r\n          raise RuntimeError(msg)\r\n      RuntimeError: Building llvmlite requires LLVM 10.0.x or 9.0.x, got '13.0.1'. Be sure to set LLVM_CONFIG to the right executable path.\r\n      Read the documentation at http://llvmlite.pydata.org/ for more information about building llvmlite.\r\n\r\n      error: command '~/repos/mozilla/bugbug/venv/bin/python' failed with exit code 1\r\n      [end of output]\r\n\r\n  note: This error originates from a subprocess, and is likely not a problem with pip.\r\n  ERROR: Failed building wheel for llvmlite\r\n  Running setup.py clean for llvmlite\r\nFailed to build llvmlite\r\nInstalling collected packages: llvmlite, numba\r\n  Attempting uninstall: llvmlite\r\n    Found existing installation: llvmlite 0.38.0\r\n    Uninstalling llvmlite-0.38.0:\r\n      Successfully uninstalled llvmlite-0.38.0\r\n  Running setup.py install for llvmlite ... error\r\n  error: subprocess-exited-with-error\r\n\r\n  × Running setup.py install for llvmlite did not run successfully.\r\n  │ exit code: 1\r\n  ╰─> [20 lines of output]\r\n      running install\r\n      ~/repos/mozilla/bugbug/venv/lib/python3.9/site-packages/setuptools/command/install.py:34: SetuptoolsDeprecationWarning: setup.py install is deprecated. Use build and pip and other standards-based tools.\r\n        warnings.warn(\r\n      running build\r\n      got version from file /private/var/folders/z4/12lcyr2n3c37kzjfksk6hwx40000gn/T/pip-install-045kded6/llvmlite_e0783b5b2e3b48288cdb7a651eb9c07b/llvmlite/_version.py {'version': '0.36.0', 'full': 'e6bb8d137d922bec8beeb01a237254778759becd'}\r\n      running build_ext\r\n      ~/repos/mozilla/bugbug/venv/bin/python /private/var/folders/z4/12lcyr2n3c37kzjfksk6hwx40000gn/T/pip-install-045kded6/llvmlite_e0783b5b2e3b48288cdb7a651eb9c07b/ffi/build.py\r\n      LLVM version... 13.0.1\r\n\r\n      Traceback (most recent call last):\r\n        File \"/private/var/folders/z4/12lcyr2n3c37kzjfksk6hwx40000gn/T/pip-install-045kded6/llvmlite_e0783b5b2e3b48288cdb7a651eb9c07b/ffi/build.py\", line 220, in <module>\r\n          main()\r\n        File \"/private/var/folders/z4/12lcyr2n3c37kzjfksk6hwx40000gn/T/pip-install-045kded6/llvmlite_e0783b5b2e3b48288cdb7a651eb9c07b/ffi/build.py\", line 214, in main\r\n          main_posix('osx', '.dylib')\r\n        File \"/private/var/folders/z4/12lcyr2n3c37kzjfksk6hwx40000gn/T/pip-install-045kded6/llvmlite_e0783b5b2e3b48288cdb7a651eb9c07b/ffi/build.py\", line 172, in main_posix\r\n          raise RuntimeError(msg)\r\n      RuntimeError: Building llvmlite requires LLVM 10.0.x or 9.0.x, got '13.0.1'. Be sure to set LLVM_CONFIG to the right executable path.\r\n      Read the documentation at http://llvmlite.pydata.org/ for more information about building llvmlite.\r\n\r\n      error: command '~/repos/mozilla/bugbug/venv/bin/python' failed with exit code 1\r\n      [end of output]\r\n\r\n  note: This error originates from a subprocess, and is likely not a problem with pip.\r\n  WARNING: No metadata found in ./venv/lib/python3.9/site-packages\r\n  Rolling back uninstall of llvmlite\r\n  Moving to ~/repos/mozilla/bugbug/venv/lib/python3.9/site-packages/llvmlite-0.38.0.dist-info/\r\n   from ~/repos/mozilla/bugbug/venv/lib/python3.9/site-packages/~lvmlite-0.38.0.dist-info\r\n  Moving to ~/repos/mozilla/bugbug/venv/lib/python3.9/site-packages/llvmlite/\r\n   from ~/repos/mozilla/bugbug/venv/lib/python3.9/site-packages/~lvmlite\r\nerror: legacy-install-failure\r\n\r\n× Encountered error while trying to install package.\r\n╰─> llvmlite\r\n\r\nnote: This is an issue with the package mentioned above, not pip.\r\nhint: See above for output from the failure.\r\n```\r\n\r\n\r\nThis happens because pip tries to build llvmlite `v0.36.0` in order to solve a dependency conflict on the version of NumPy.\r\nBugbug requires `numpy==1.22.3`. Howeber, Numba (a transitive dependency of `shap[plots]==0.40.0`) requires `numpy<=1.21`.\r\n\r\n\r\nUsing the `numpy==1.21.5` to satisfy `numpy` solve the issue and avoid building `llvmlite`. However, running `python3 -m scripts.trainer defect` gives the following error:\r\n\r\n```\r\nRuntimeError: module compiled against API version 0xf but this version of numpy is 0xe\r\n```\r\n\r\nI guess resolving https://github.com/numba/llvmlite/issues/799 could fix this issue since then we can have wheels for `llvmlite` and depend on the correct NumPy version.","closed_by":{"login":"marco-c","id":1616846,"node_id":"MDQ6VXNlcjE2MTY4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1616846?v=4","gravatar_id":"","url":"https://api.github.com/users/marco-c","html_url":"https://github.com/marco-c","followers_url":"https://api.github.com/users/marco-c/followers","following_url":"https://api.github.com/users/marco-c/following{/other_user}","gists_url":"https://api.github.com/users/marco-c/gists{/gist_id}","starred_url":"https://api.github.com/users/marco-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marco-c/subscriptions","organizations_url":"https://api.github.com/users/marco-c/orgs","repos_url":"https://api.github.com/users/marco-c/repos","events_url":"https://api.github.com/users/marco-c/events{/privacy}","received_events_url":"https://api.github.com/users/marco-c/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mozilla/bugbug/issues/2855/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mozilla/bugbug/issues/2855/timeline","performed_via_github_app":null,"state_reason":"completed"}