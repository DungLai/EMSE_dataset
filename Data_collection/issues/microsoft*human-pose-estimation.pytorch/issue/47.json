{"url":"https://api.github.com/repos/microsoft/human-pose-estimation.pytorch/issues/47","repository_url":"https://api.github.com/repos/microsoft/human-pose-estimation.pytorch","labels_url":"https://api.github.com/repos/microsoft/human-pose-estimation.pytorch/issues/47/labels{/name}","comments_url":"https://api.github.com/repos/microsoft/human-pose-estimation.pytorch/issues/47/comments","events_url":"https://api.github.com/repos/microsoft/human-pose-estimation.pytorch/issues/47/events","html_url":"https://github.com/microsoft/human-pose-estimation.pytorch/issues/47","id":374749455,"node_id":"MDU6SXNzdWUzNzQ3NDk0NTU=","number":47,"title":"Confusion in inference.py","user":{"login":"xizero00","id":7960365,"node_id":"MDQ6VXNlcjc5NjAzNjU=","avatar_url":"https://avatars.githubusercontent.com/u/7960365?v=4","gravatar_id":"","url":"https://api.github.com/users/xizero00","html_url":"https://github.com/xizero00","followers_url":"https://api.github.com/users/xizero00/followers","following_url":"https://api.github.com/users/xizero00/following{/other_user}","gists_url":"https://api.github.com/users/xizero00/gists{/gist_id}","starred_url":"https://api.github.com/users/xizero00/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xizero00/subscriptions","organizations_url":"https://api.github.com/users/xizero00/orgs","repos_url":"https://api.github.com/users/xizero00/repos","events_url":"https://api.github.com/users/xizero00/events{/privacy}","received_events_url":"https://api.github.com/users/xizero00/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-10-28T12:38:47Z","updated_at":"2018-11-06T08:22:00Z","closed_at":"2018-11-06T08:22:00Z","author_association":"NONE","active_lock_reason":null,"body":"Hi @leoxiaobin \r\nI am confused about the following code:\r\n\r\n[px and py](https://github.com/Microsoft/human-pose-estimation.pytorch/blob/master/lib/core/inference.py#L60-L61)\r\n\r\n```python\r\n    coords, maxvals = get_max_preds(batch_heatmaps)\r\n    ....\r\n    # post-processing\r\n    if config.TEST.POST_PROCESS:\r\n        for n in range(coords.shape[0]):\r\n            for p in range(coords.shape[1]):\r\n                hm = batch_heatmaps[n][p]\r\n                px = int(math.floor(coords[n][p][0] + 0.5))\r\n                py = int(math.floor(coords[n][p][1] + 0.5))\r\n                if 1 < px < heatmap_width-1 and 1 < py < heatmap_height-1:\r\n                    diff = np.array([hm[py][px+1] - hm[py][px-1],\r\n                                     hm[py+1][px]-hm[py-1][px]])\r\n                    coords[n][p] += np.sign(diff) * .25\r\n```\r\ncoords[n][p][0] is an integer (get_max_preds returns the integer coordinates).\r\nHere we plus 0.5 and then use a floor function.\r\nThis will make it equal to coords[n][p][0]\r\nso +0.5 here is useless?\r\nAm I right?\r\n\r\nIn addition, I find that the hourglass code is different.\r\n[hourglass](https://github.com/princeton-vl/pose-hg-train/blob/master/src/util/pose.lua#L78-L107)\r\n```lua\r\n -- Very simple post-processing step to improve performance at tight PCK thresholds\r\n    for i = 1,p:size(1) do\r\n        for j = 1,p:size(2) do\r\n            local hm = tmpOutput[i][j]\r\n            local pX,pY = p[i][j][1], p[i][j][2]\r\n            scores[i][j] = hm[pY][pX]\r\n            if pX > 1 and pX < opt.outputRes and pY > 1 and pY < opt.outputRes then\r\n               local diff = torch.Tensor({hm[pY][pX+1]-hm[pY][pX-1], hm[pY+1][pX]-hm[pY-1][pX]})\r\n               p[i][j]:add(diff:sign():mul(.25))\r\n            end\r\n        end\r\n    end\r\n    p:add(0.5)\r\n```\r\nThey plus 0.5 after getting the sub pixel coordinates.\r\n\r\nWould you please explain the difference?\r\nThanks!\r\n","closed_by":{"login":"xizero00","id":7960365,"node_id":"MDQ6VXNlcjc5NjAzNjU=","avatar_url":"https://avatars.githubusercontent.com/u/7960365?v=4","gravatar_id":"","url":"https://api.github.com/users/xizero00","html_url":"https://github.com/xizero00","followers_url":"https://api.github.com/users/xizero00/followers","following_url":"https://api.github.com/users/xizero00/following{/other_user}","gists_url":"https://api.github.com/users/xizero00/gists{/gist_id}","starred_url":"https://api.github.com/users/xizero00/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xizero00/subscriptions","organizations_url":"https://api.github.com/users/xizero00/orgs","repos_url":"https://api.github.com/users/xizero00/repos","events_url":"https://api.github.com/users/xizero00/events{/privacy}","received_events_url":"https://api.github.com/users/xizero00/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/microsoft/human-pose-estimation.pytorch/issues/47/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/microsoft/human-pose-estimation.pytorch/issues/47/timeline","performed_via_github_app":null,"state_reason":"completed"}