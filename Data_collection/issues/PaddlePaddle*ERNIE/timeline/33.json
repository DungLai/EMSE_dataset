[{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/473779917","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/33#issuecomment-473779917","issue_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/33","id":473779917,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Mzc3OTkxNw==","user":{"login":"zhanghan1992","id":40751364,"node_id":"MDQ6VXNlcjQwNzUxMzY0","avatar_url":"https://avatars.githubusercontent.com/u/40751364?v=4","gravatar_id":"","url":"https://api.github.com/users/zhanghan1992","html_url":"https://github.com/zhanghan1992","followers_url":"https://api.github.com/users/zhanghan1992/followers","following_url":"https://api.github.com/users/zhanghan1992/following{/other_user}","gists_url":"https://api.github.com/users/zhanghan1992/gists{/gist_id}","starred_url":"https://api.github.com/users/zhanghan1992/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhanghan1992/subscriptions","organizations_url":"https://api.github.com/users/zhanghan1992/orgs","repos_url":"https://api.github.com/users/zhanghan1992/repos","events_url":"https://api.github.com/users/zhanghan1992/events{/privacy}","received_events_url":"https://api.github.com/users/zhanghan1992/received_events","type":"User","site_admin":false},"created_at":"2019-03-18T05:57:28Z","updated_at":"2019-03-18T05:57:28Z","author_association":"COLLABORATOR","body":"首字和非首字是按同样的方式mask，你再理解下代码吧","reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/473779917/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"zhanghan1992","id":40751364,"node_id":"MDQ6VXNlcjQwNzUxMzY0","avatar_url":"https://avatars.githubusercontent.com/u/40751364?v=4","gravatar_id":"","url":"https://api.github.com/users/zhanghan1992","html_url":"https://github.com/zhanghan1992","followers_url":"https://api.github.com/users/zhanghan1992/followers","following_url":"https://api.github.com/users/zhanghan1992/following{/other_user}","gists_url":"https://api.github.com/users/zhanghan1992/gists{/gist_id}","starred_url":"https://api.github.com/users/zhanghan1992/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhanghan1992/subscriptions","organizations_url":"https://api.github.com/users/zhanghan1992/orgs","repos_url":"https://api.github.com/users/zhanghan1992/repos","events_url":"https://api.github.com/users/zhanghan1992/events{/privacy}","received_events_url":"https://api.github.com/users/zhanghan1992/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/473782317","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/33#issuecomment-473782317","issue_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/33","id":473782317,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Mzc4MjMxNw==","user":{"login":"xiaochang129","id":45583476,"node_id":"MDQ6VXNlcjQ1NTgzNDc2","avatar_url":"https://avatars.githubusercontent.com/u/45583476?v=4","gravatar_id":"","url":"https://api.github.com/users/xiaochang129","html_url":"https://github.com/xiaochang129","followers_url":"https://api.github.com/users/xiaochang129/followers","following_url":"https://api.github.com/users/xiaochang129/following{/other_user}","gists_url":"https://api.github.com/users/xiaochang129/gists{/gist_id}","starred_url":"https://api.github.com/users/xiaochang129/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiaochang129/subscriptions","organizations_url":"https://api.github.com/users/xiaochang129/orgs","repos_url":"https://api.github.com/users/xiaochang129/repos","events_url":"https://api.github.com/users/xiaochang129/events{/privacy}","received_events_url":"https://api.github.com/users/xiaochang129/received_events","type":"User","site_admin":false},"created_at":"2019-03-18T06:10:32Z","updated_at":"2019-03-18T06:10:32Z","author_association":"NONE","body":"不是一样的方法，你再看下代码吧","reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/473782317/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"xiaochang129","id":45583476,"node_id":"MDQ6VXNlcjQ1NTgzNDc2","avatar_url":"https://avatars.githubusercontent.com/u/45583476?v=4","gravatar_id":"","url":"https://api.github.com/users/xiaochang129","html_url":"https://github.com/xiaochang129","followers_url":"https://api.github.com/users/xiaochang129/followers","following_url":"https://api.github.com/users/xiaochang129/following{/other_user}","gists_url":"https://api.github.com/users/xiaochang129/gists{/gist_id}","starred_url":"https://api.github.com/users/xiaochang129/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiaochang129/subscriptions","organizations_url":"https://api.github.com/users/xiaochang129/orgs","repos_url":"https://api.github.com/users/xiaochang129/repos","events_url":"https://api.github.com/users/xiaochang129/events{/privacy}","received_events_url":"https://api.github.com/users/xiaochang129/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/473785235","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/33#issuecomment-473785235","issue_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/33","id":473785235,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Mzc4NTIzNQ==","user":{"login":"zhanghan1992","id":40751364,"node_id":"MDQ6VXNlcjQwNzUxMzY0","avatar_url":"https://avatars.githubusercontent.com/u/40751364?v=4","gravatar_id":"","url":"https://api.github.com/users/zhanghan1992","html_url":"https://github.com/zhanghan1992","followers_url":"https://api.github.com/users/zhanghan1992/followers","following_url":"https://api.github.com/users/zhanghan1992/following{/other_user}","gists_url":"https://api.github.com/users/zhanghan1992/gists{/gist_id}","starred_url":"https://api.github.com/users/zhanghan1992/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhanghan1992/subscriptions","organizations_url":"https://api.github.com/users/zhanghan1992/orgs","repos_url":"https://api.github.com/users/zhanghan1992/repos","events_url":"https://api.github.com/users/zhanghan1992/events{/privacy}","received_events_url":"https://api.github.com/users/zhanghan1992/received_events","type":"User","site_admin":false},"created_at":"2019-03-18T06:25:19Z","updated_at":"2019-03-18T06:45:16Z","author_association":"COLLABORATOR","body":"只根据首字的prob是否大于0.15决定该词是否mask；因此如果mask，首字的基准概率是0.15，非首字的基准概率是1.0；按基准概率的80%, 10%, 10%决定替换的token，首字和非首字的处理是一样的","reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/473785235/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"zhanghan1992","id":40751364,"node_id":"MDQ6VXNlcjQwNzUxMzY0","avatar_url":"https://avatars.githubusercontent.com/u/40751364?v=4","gravatar_id":"","url":"https://api.github.com/users/zhanghan1992","html_url":"https://github.com/zhanghan1992","followers_url":"https://api.github.com/users/zhanghan1992/followers","following_url":"https://api.github.com/users/zhanghan1992/following{/other_user}","gists_url":"https://api.github.com/users/zhanghan1992/gists{/gist_id}","starred_url":"https://api.github.com/users/zhanghan1992/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhanghan1992/subscriptions","organizations_url":"https://api.github.com/users/zhanghan1992/orgs","repos_url":"https://api.github.com/users/zhanghan1992/repos","events_url":"https://api.github.com/users/zhanghan1992/events{/privacy}","received_events_url":"https://api.github.com/users/zhanghan1992/received_events","type":"User","site_admin":false}},{"id":2209374655,"node_id":"MDExOkNsb3NlZEV2ZW50MjIwOTM3NDY1NQ==","url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/events/2209374655","actor":{"login":"zhanghan1992","id":40751364,"node_id":"MDQ6VXNlcjQwNzUxMzY0","avatar_url":"https://avatars.githubusercontent.com/u/40751364?v=4","gravatar_id":"","url":"https://api.github.com/users/zhanghan1992","html_url":"https://github.com/zhanghan1992","followers_url":"https://api.github.com/users/zhanghan1992/followers","following_url":"https://api.github.com/users/zhanghan1992/following{/other_user}","gists_url":"https://api.github.com/users/zhanghan1992/gists{/gist_id}","starred_url":"https://api.github.com/users/zhanghan1992/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhanghan1992/subscriptions","organizations_url":"https://api.github.com/users/zhanghan1992/orgs","repos_url":"https://api.github.com/users/zhanghan1992/repos","events_url":"https://api.github.com/users/zhanghan1992/events{/privacy}","received_events_url":"https://api.github.com/users/zhanghan1992/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-03-18T06:30:19Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/473793961","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/33#issuecomment-473793961","issue_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/33","id":473793961,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Mzc5Mzk2MQ==","user":{"login":"xiaochang129","id":45583476,"node_id":"MDQ6VXNlcjQ1NTgzNDc2","avatar_url":"https://avatars.githubusercontent.com/u/45583476?v=4","gravatar_id":"","url":"https://api.github.com/users/xiaochang129","html_url":"https://github.com/xiaochang129","followers_url":"https://api.github.com/users/xiaochang129/followers","following_url":"https://api.github.com/users/xiaochang129/following{/other_user}","gists_url":"https://api.github.com/users/xiaochang129/gists{/gist_id}","starred_url":"https://api.github.com/users/xiaochang129/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiaochang129/subscriptions","organizations_url":"https://api.github.com/users/xiaochang129/orgs","repos_url":"https://api.github.com/users/xiaochang129/repos","events_url":"https://api.github.com/users/xiaochang129/events{/privacy}","received_events_url":"https://api.github.com/users/xiaochang129/received_events","type":"User","site_admin":false},"created_at":"2019-03-18T07:08:14Z","updated_at":"2019-03-18T07:08:14Z","author_association":"NONE","body":"首字和非首字的mask概率是一样的，但按照代码实现的方法，因为基准概率不同，mask的方法是不同的","reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/473793961/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"xiaochang129","id":45583476,"node_id":"MDQ6VXNlcjQ1NTgzNDc2","avatar_url":"https://avatars.githubusercontent.com/u/45583476?v=4","gravatar_id":"","url":"https://api.github.com/users/xiaochang129","html_url":"https://github.com/xiaochang129","followers_url":"https://api.github.com/users/xiaochang129/followers","following_url":"https://api.github.com/users/xiaochang129/following{/other_user}","gists_url":"https://api.github.com/users/xiaochang129/gists{/gist_id}","starred_url":"https://api.github.com/users/xiaochang129/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiaochang129/subscriptions","organizations_url":"https://api.github.com/users/xiaochang129/orgs","repos_url":"https://api.github.com/users/xiaochang129/repos","events_url":"https://api.github.com/users/xiaochang129/events{/privacy}","received_events_url":"https://api.github.com/users/xiaochang129/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/476570747","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/33#issuecomment-476570747","issue_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/33","id":476570747,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjU3MDc0Nw==","user":{"login":"BucherLi","id":12195338,"node_id":"MDQ6VXNlcjEyMTk1MzM4","avatar_url":"https://avatars.githubusercontent.com/u/12195338?v=4","gravatar_id":"","url":"https://api.github.com/users/BucherLi","html_url":"https://github.com/BucherLi","followers_url":"https://api.github.com/users/BucherLi/followers","following_url":"https://api.github.com/users/BucherLi/following{/other_user}","gists_url":"https://api.github.com/users/BucherLi/gists{/gist_id}","starred_url":"https://api.github.com/users/BucherLi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BucherLi/subscriptions","organizations_url":"https://api.github.com/users/BucherLi/orgs","repos_url":"https://api.github.com/users/BucherLi/repos","events_url":"https://api.github.com/users/BucherLi/events{/privacy}","received_events_url":"https://api.github.com/users/BucherLi/received_events","type":"User","site_admin":false},"created_at":"2019-03-26T10:46:34Z","updated_at":"2019-03-26T10:46:34Z","author_association":"NONE","body":"> 首字和其他字的mask方法不一致\r\n\r\n不是按照词mask的吗，你是说首词和其他词mask方法不一致？","reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/476570747/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BucherLi","id":12195338,"node_id":"MDQ6VXNlcjEyMTk1MzM4","avatar_url":"https://avatars.githubusercontent.com/u/12195338?v=4","gravatar_id":"","url":"https://api.github.com/users/BucherLi","html_url":"https://github.com/BucherLi","followers_url":"https://api.github.com/users/BucherLi/followers","following_url":"https://api.github.com/users/BucherLi/following{/other_user}","gists_url":"https://api.github.com/users/BucherLi/gists{/gist_id}","starred_url":"https://api.github.com/users/BucherLi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BucherLi/subscriptions","organizations_url":"https://api.github.com/users/BucherLi/orgs","repos_url":"https://api.github.com/users/BucherLi/repos","events_url":"https://api.github.com/users/BucherLi/events{/privacy}","received_events_url":"https://api.github.com/users/BucherLi/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/476955280","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/33#issuecomment-476955280","issue_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/33","id":476955280,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Njk1NTI4MA==","user":{"login":"xiaochang129","id":45583476,"node_id":"MDQ6VXNlcjQ1NTgzNDc2","avatar_url":"https://avatars.githubusercontent.com/u/45583476?v=4","gravatar_id":"","url":"https://api.github.com/users/xiaochang129","html_url":"https://github.com/xiaochang129","followers_url":"https://api.github.com/users/xiaochang129/followers","following_url":"https://api.github.com/users/xiaochang129/following{/other_user}","gists_url":"https://api.github.com/users/xiaochang129/gists{/gist_id}","starred_url":"https://api.github.com/users/xiaochang129/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiaochang129/subscriptions","organizations_url":"https://api.github.com/users/xiaochang129/orgs","repos_url":"https://api.github.com/users/xiaochang129/repos","events_url":"https://api.github.com/users/xiaochang129/events{/privacy}","received_events_url":"https://api.github.com/users/xiaochang129/received_events","type":"User","site_admin":false},"created_at":"2019-03-27T03:26:26Z","updated_at":"2019-03-27T03:26:26Z","author_association":"NONE","body":"嗯，不一致","reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/476955280/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"xiaochang129","id":45583476,"node_id":"MDQ6VXNlcjQ1NTgzNDc2","avatar_url":"https://avatars.githubusercontent.com/u/45583476?v=4","gravatar_id":"","url":"https://api.github.com/users/xiaochang129","html_url":"https://github.com/xiaochang129","followers_url":"https://api.github.com/users/xiaochang129/followers","following_url":"https://api.github.com/users/xiaochang129/following{/other_user}","gists_url":"https://api.github.com/users/xiaochang129/gists{/gist_id}","starred_url":"https://api.github.com/users/xiaochang129/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiaochang129/subscriptions","organizations_url":"https://api.github.com/users/xiaochang129/orgs","repos_url":"https://api.github.com/users/xiaochang129/repos","events_url":"https://api.github.com/users/xiaochang129/events{/privacy}","received_events_url":"https://api.github.com/users/xiaochang129/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/503036848","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/33#issuecomment-503036848","issue_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/33","id":503036848,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzAzNjg0OA==","user":{"login":"randomtutu","id":25904625,"node_id":"MDQ6VXNlcjI1OTA0NjI1","avatar_url":"https://avatars.githubusercontent.com/u/25904625?v=4","gravatar_id":"","url":"https://api.github.com/users/randomtutu","html_url":"https://github.com/randomtutu","followers_url":"https://api.github.com/users/randomtutu/followers","following_url":"https://api.github.com/users/randomtutu/following{/other_user}","gists_url":"https://api.github.com/users/randomtutu/gists{/gist_id}","starred_url":"https://api.github.com/users/randomtutu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/randomtutu/subscriptions","organizations_url":"https://api.github.com/users/randomtutu/orgs","repos_url":"https://api.github.com/users/randomtutu/repos","events_url":"https://api.github.com/users/randomtutu/events{/privacy}","received_events_url":"https://api.github.com/users/randomtutu/received_events","type":"User","site_admin":false},"created_at":"2019-06-18T10:00:12Z","updated_at":"2019-06-18T10:00:12Z","author_association":"NONE","body":"代码的维护同学，你好呀\r\n\r\n因为要用到以词为单位的mask方式，而且之前看到这个地方有争议，所以我最近仔细看了一下代码。\r\n\r\n我先说一下我的结论，mask的方式确实是词，但是概率应该不是15%。\r\n\r\n解释一下为什么，\r\n\r\n> 首先，假设输入语料里有M个‘词’\r\n> \r\n> 那么，假如要mask 15% 的词，那么mask词的数目应该是0.15*M\r\n> \r\n> 代码`prob_mask = np.random.rand(total_token_num)`可以理解为对每一个token分配一个概率，而token得分布是正太分布。\r\n> \r\n> 而在判断是否要mask的时候用的条件是 `prob <= 0.15 and token_seg_label == 0`, prob代表token分配得到的概率，token_seg_label=0表示词首。且判断完成之后，是不会用到token的prob的了。\r\n> \r\n> 并且，显然的是token是否为‘词首’ 与 token分配得到的概率的分布 是独立的两个分布\r\n> \r\n> 因此，最终mask的数目因该是0.15 * M * P(词首)，P(词首)代表一个token为词首的概率。\r\n> \r\n> 如有不妥请指正\r\n\r\n最后，感谢你们的工作，感觉很好。","reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/503036848/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"randomtutu","id":25904625,"node_id":"MDQ6VXNlcjI1OTA0NjI1","avatar_url":"https://avatars.githubusercontent.com/u/25904625?v=4","gravatar_id":"","url":"https://api.github.com/users/randomtutu","html_url":"https://github.com/randomtutu","followers_url":"https://api.github.com/users/randomtutu/followers","following_url":"https://api.github.com/users/randomtutu/following{/other_user}","gists_url":"https://api.github.com/users/randomtutu/gists{/gist_id}","starred_url":"https://api.github.com/users/randomtutu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/randomtutu/subscriptions","organizations_url":"https://api.github.com/users/randomtutu/orgs","repos_url":"https://api.github.com/users/randomtutu/repos","events_url":"https://api.github.com/users/randomtutu/events{/privacy}","received_events_url":"https://api.github.com/users/randomtutu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/508378948","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/33#issuecomment-508378948","issue_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/33","id":508378948,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODM3ODk0OA==","user":{"login":"zhanghan1992","id":40751364,"node_id":"MDQ6VXNlcjQwNzUxMzY0","avatar_url":"https://avatars.githubusercontent.com/u/40751364?v=4","gravatar_id":"","url":"https://api.github.com/users/zhanghan1992","html_url":"https://github.com/zhanghan1992","followers_url":"https://api.github.com/users/zhanghan1992/followers","following_url":"https://api.github.com/users/zhanghan1992/following{/other_user}","gists_url":"https://api.github.com/users/zhanghan1992/gists{/gist_id}","starred_url":"https://api.github.com/users/zhanghan1992/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhanghan1992/subscriptions","organizations_url":"https://api.github.com/users/zhanghan1992/orgs","repos_url":"https://api.github.com/users/zhanghan1992/repos","events_url":"https://api.github.com/users/zhanghan1992/events{/privacy}","received_events_url":"https://api.github.com/users/zhanghan1992/received_events","type":"User","site_admin":false},"created_at":"2019-07-04T07:49:25Z","updated_at":"2019-07-04T07:49:25Z","author_association":"COLLABORATOR","body":"> 代码的维护同学，你好呀\r\n> \r\n> 因为要用到以词为单位的mask方式，而且之前看到这个地方有争议，所以我最近仔细看了一下代码。\r\n> \r\n> 我先说一下我的结论，mask的方式确实是词，但是概率应该不是15%。\r\n> \r\n> 解释一下为什么，\r\n> \r\n> > 首先，假设输入语料里有M个‘词’\r\n> > 那么，假如要mask 15% 的词，那么mask词的数目应该是0.15*M\r\n> > 代码`prob_mask = np.random.rand(total_token_num)`可以理解为对每一个token分配一个概率，而token得分布是正太分布。\r\n> > 而在判断是否要mask的时候用的条件是 `prob <= 0.15 and token_seg_label == 0`, prob代表token分配得到的概率，token_seg_label=0表示词首。且判断完成之后，是不会用到token的prob的了。\r\n> > 并且，显然的是token是否为‘词首’ 与 token分配得到的概率的分布 是独立的两个分布\r\n> > 因此，最终mask的数目因该是0.15 * M * P(词首)，P(词首)代表一个token为词首的概率。\r\n> > 如有不妥请指正\r\n> \r\n> 最后，感谢你们的工作，感觉很好。\r\n\r\n你算的这个是一个token既是词首又被mask的概率。并不是整体的mask概率","reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/508378948/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"zhanghan1992","id":40751364,"node_id":"MDQ6VXNlcjQwNzUxMzY0","avatar_url":"https://avatars.githubusercontent.com/u/40751364?v=4","gravatar_id":"","url":"https://api.github.com/users/zhanghan1992","html_url":"https://github.com/zhanghan1992","followers_url":"https://api.github.com/users/zhanghan1992/followers","following_url":"https://api.github.com/users/zhanghan1992/following{/other_user}","gists_url":"https://api.github.com/users/zhanghan1992/gists{/gist_id}","starred_url":"https://api.github.com/users/zhanghan1992/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhanghan1992/subscriptions","organizations_url":"https://api.github.com/users/zhanghan1992/orgs","repos_url":"https://api.github.com/users/zhanghan1992/repos","events_url":"https://api.github.com/users/zhanghan1992/events{/privacy}","received_events_url":"https://api.github.com/users/zhanghan1992/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/508393957","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/33#issuecomment-508393957","issue_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/33","id":508393957,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODM5Mzk1Nw==","user":{"login":"zhanghan1992","id":40751364,"node_id":"MDQ6VXNlcjQwNzUxMzY0","avatar_url":"https://avatars.githubusercontent.com/u/40751364?v=4","gravatar_id":"","url":"https://api.github.com/users/zhanghan1992","html_url":"https://github.com/zhanghan1992","followers_url":"https://api.github.com/users/zhanghan1992/followers","following_url":"https://api.github.com/users/zhanghan1992/following{/other_user}","gists_url":"https://api.github.com/users/zhanghan1992/gists{/gist_id}","starred_url":"https://api.github.com/users/zhanghan1992/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhanghan1992/subscriptions","organizations_url":"https://api.github.com/users/zhanghan1992/orgs","repos_url":"https://api.github.com/users/zhanghan1992/repos","events_url":"https://api.github.com/users/zhanghan1992/events{/privacy}","received_events_url":"https://api.github.com/users/zhanghan1992/received_events","type":"User","site_admin":false},"created_at":"2019-07-04T08:35:17Z","updated_at":"2019-07-04T08:41:07Z","author_association":"COLLABORATOR","body":"针对mask机制的疑问，统一回复下。\r\n\r\ntoken的mask概率：对于词首token，显而易见mask概率是0.15；对于非词首token，是否被mask的取决于其词首，因此被mask的概率也是0.15。\r\nmask的替换方式，对于首字，被替换成[MASK]的概率是p(0.15 * 0.2 <prob[beg]<0.15) = 0.12；对于非首字，被替换成[MASK]的概率是p（ prob[token_index] > 0.2 | prob[beg] < 0.15) * p(prob[beg] < 0.15) = 0.8 * 0.15=0.12。首字和非首字的替换方式是一样的。","reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/508393957/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"zhanghan1992","id":40751364,"node_id":"MDQ6VXNlcjQwNzUxMzY0","avatar_url":"https://avatars.githubusercontent.com/u/40751364?v=4","gravatar_id":"","url":"https://api.github.com/users/zhanghan1992","html_url":"https://github.com/zhanghan1992","followers_url":"https://api.github.com/users/zhanghan1992/followers","following_url":"https://api.github.com/users/zhanghan1992/following{/other_user}","gists_url":"https://api.github.com/users/zhanghan1992/gists{/gist_id}","starred_url":"https://api.github.com/users/zhanghan1992/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhanghan1992/subscriptions","organizations_url":"https://api.github.com/users/zhanghan1992/orgs","repos_url":"https://api.github.com/users/zhanghan1992/repos","events_url":"https://api.github.com/users/zhanghan1992/events{/privacy}","received_events_url":"https://api.github.com/users/zhanghan1992/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/508398642","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/33#issuecomment-508398642","issue_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/33","id":508398642,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODM5ODY0Mg==","user":{"login":"randomtutu","id":25904625,"node_id":"MDQ6VXNlcjI1OTA0NjI1","avatar_url":"https://avatars.githubusercontent.com/u/25904625?v=4","gravatar_id":"","url":"https://api.github.com/users/randomtutu","html_url":"https://github.com/randomtutu","followers_url":"https://api.github.com/users/randomtutu/followers","following_url":"https://api.github.com/users/randomtutu/following{/other_user}","gists_url":"https://api.github.com/users/randomtutu/gists{/gist_id}","starred_url":"https://api.github.com/users/randomtutu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/randomtutu/subscriptions","organizations_url":"https://api.github.com/users/randomtutu/orgs","repos_url":"https://api.github.com/users/randomtutu/repos","events_url":"https://api.github.com/users/randomtutu/events{/privacy}","received_events_url":"https://api.github.com/users/randomtutu/received_events","type":"User","site_admin":false},"created_at":"2019-07-04T08:49:04Z","updated_at":"2019-07-04T08:56:24Z","author_association":"NONE","body":"> > 代码的维护同学，你好呀\r\n> > 因为要用到以词为单位的mask方式，而且之前看到这个地方有争议，所以我最近仔细看了一下代码。\r\n> > 我先说一下我的结论，mask的方式确实是词，但是概率应该不是15%。\r\n> > 解释一下为什么，\r\n> > > 首先，假设输入语料里有M个‘词’\r\n> > > 那么，假如要mask 15% 的词，那么mask词的数目应该是0.15*M\r\n> > > 代码`prob_mask = np.random.rand(total_token_num)`可以理解为对每一个token分配一个概率，而token得分布是正太分布。\r\n> > > 而在判断是否要mask的时候用的条件是 `prob <= 0.15 and token_seg_label == 0`, prob代表token分配得到的概率，token_seg_label=0表示词首。且判断完成之后，是不会用到token的prob的了。\r\n> > > 并且，显然的是token是否为‘词首’ 与 token分配得到的概率的分布 是独立的两个分布\r\n> > > 因此，最终mask的数目因该是0.15 * M * P(词首)，P(词首)代表一个token为词首的概率。\r\n> > > 如有不妥请指正\r\n> > \r\n> > \r\n> > 最后，感谢你们的工作，感觉很好。\r\n> \r\n> 你算的这个是一个token既是词首又被mask的概率。并不是整体的mask概率\r\n\r\n你说得没错，确实是既是词首又被mask的概率。\r\n\r\n但是，重要的是想要mask的是词，首先需要有词首才会进入mask的流程。\r\n\r\n虽然进入mask流程后，总体用的概率是15%。\r\n\r\n` if prob > 0.15: \r\n                    pass\r\n                else: # 小于等于0.15进mask流程\r\n                    for index in xrange(beg, token_index):\r\n                        prob = prob_mask[prob_index + index]\r\n                        base_prob = 1.0\r\n                        # 下面的if语句，更改首字的基准，因为第一个if语句已经判断了prob[首字]<=0.15\r\n                        if index == beg: \r\n                            base_prob = 0.15\r\n                        # 下面的if语句要问一个问题，对于非首字，p(prob<=0.15 | 词首) 是不是等于p(prob<=0.15)? 如果答案是肯定的，那么才会有结论：15%tokens被mask。\r\n                        # 谨慎一点，我大概能理解你的出发点，应该是词首代表词，非词首的字也是由词首决定的，所以对于所有的mask的token就是0.15。但是非词首的prob其实和之前词首的prob是有关联的，在一个正态分布里面。关键就是两种方法，假如有50个词，100个token，1）每次random一个随机数 and 是否词首和2）生成一个100个随机数的列表，然后根据token的位置来取值 and 是否词首，两者是不是有差别。\r\n                        # 不过我真的感觉其实实现方法不是那么重要，关键是模型效果好。我也不是有意抬杠，主要的出发点其实是怕别人看到楼主的描述就对这个工作不信任，所以解释一下。\r\n                         # 最后的结论：确实是mask的词~~\r\n                        if base_prob * 0.2 < prob <= base_prob:\r\n                            mask_label.append(sent[index])\r\n                            sent[index] = MASK\r\n                            mask_flag = True\r\n                            mask_pos.append(sent_index * max_len + index)\r\n                        elif base_prob * 0.1 < prob <= base_prob * 0.2:\r\n                            mask_label.append(sent[index])\r\n                            sent[index] = replace_ids[prob_index + index]\r\n                            mask_flag = True\r\n                            mask_pos.append(sent_index * max_len + index)\r\n                        else:\r\n                            mask_label.append(sent[index])\r\n                            mask_pos.append(sent_index * max_len + index)`\r\n最后，感谢回复！","reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/508398642/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"randomtutu","id":25904625,"node_id":"MDQ6VXNlcjI1OTA0NjI1","avatar_url":"https://avatars.githubusercontent.com/u/25904625?v=4","gravatar_id":"","url":"https://api.github.com/users/randomtutu","html_url":"https://github.com/randomtutu","followers_url":"https://api.github.com/users/randomtutu/followers","following_url":"https://api.github.com/users/randomtutu/following{/other_user}","gists_url":"https://api.github.com/users/randomtutu/gists{/gist_id}","starred_url":"https://api.github.com/users/randomtutu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/randomtutu/subscriptions","organizations_url":"https://api.github.com/users/randomtutu/orgs","repos_url":"https://api.github.com/users/randomtutu/repos","events_url":"https://api.github.com/users/randomtutu/events{/privacy}","received_events_url":"https://api.github.com/users/randomtutu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/517257841","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/33#issuecomment-517257841","issue_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/33","id":517257841,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNzI1Nzg0MQ==","user":{"login":"Sherriiie","id":18524194,"node_id":"MDQ6VXNlcjE4NTI0MTk0","avatar_url":"https://avatars.githubusercontent.com/u/18524194?v=4","gravatar_id":"","url":"https://api.github.com/users/Sherriiie","html_url":"https://github.com/Sherriiie","followers_url":"https://api.github.com/users/Sherriiie/followers","following_url":"https://api.github.com/users/Sherriiie/following{/other_user}","gists_url":"https://api.github.com/users/Sherriiie/gists{/gist_id}","starred_url":"https://api.github.com/users/Sherriiie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sherriiie/subscriptions","organizations_url":"https://api.github.com/users/Sherriiie/orgs","repos_url":"https://api.github.com/users/Sherriiie/repos","events_url":"https://api.github.com/users/Sherriiie/events{/privacy}","received_events_url":"https://api.github.com/users/Sherriiie/received_events","type":"User","site_admin":false},"created_at":"2019-08-01T12:07:48Z","updated_at":"2019-08-01T12:08:38Z","author_association":"NONE","body":"> 针对mask机制的疑问，统一回复下。\r\n> \r\n> token的mask概率：对于词首token，显而易见mask概率是0.15；对于非词首token，是否被mask的取决于其词首，因此被mask的概率也是0.15。\r\n> mask的替换方式，对于首字，被替换成[MASK]的概率是p(0.15 * 0.2 <prob[beg]<0.15) = 0.12；对于非首字，被替换成[MASK]的概率是p（ prob[token_index] > 0.2 | prob[beg] < 0.15) * p(prob[beg] < 0.15) = 0.8 * 0.15=0.12。首字和非首字的替换方式是一样的。\r\n\r\nErnie2.0 里面提到的entity 被mask 的概率是100%， 这个逻辑在代码的哪里实现的？在哪里区分要mask的是 phrase or entity的？ ","reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/comments/517257841/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Sherriiie","id":18524194,"node_id":"MDQ6VXNlcjE4NTI0MTk0","avatar_url":"https://avatars.githubusercontent.com/u/18524194?v=4","gravatar_id":"","url":"https://api.github.com/users/Sherriiie","html_url":"https://github.com/Sherriiie","followers_url":"https://api.github.com/users/Sherriiie/followers","following_url":"https://api.github.com/users/Sherriiie/following{/other_user}","gists_url":"https://api.github.com/users/Sherriiie/gists{/gist_id}","starred_url":"https://api.github.com/users/Sherriiie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sherriiie/subscriptions","organizations_url":"https://api.github.com/users/Sherriiie/orgs","repos_url":"https://api.github.com/users/Sherriiie/repos","events_url":"https://api.github.com/users/Sherriiie/events{/privacy}","received_events_url":"https://api.github.com/users/Sherriiie/received_events","type":"User","site_admin":false}}]