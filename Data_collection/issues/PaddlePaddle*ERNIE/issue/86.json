{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/86","repository_url":"https://api.github.com/repos/PaddlePaddle/ERNIE","labels_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/86/labels{/name}","comments_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/86/comments","events_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/86/events","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/86","id":431785341,"node_id":"MDU6SXNzdWU0MzE3ODUzNDE=","number":86,"title":"保存ernie embedding inference model报错","user":{"login":"GeminiHu","id":13281461,"node_id":"MDQ6VXNlcjEzMjgxNDYx","avatar_url":"https://avatars.githubusercontent.com/u/13281461?v=4","gravatar_id":"","url":"https://api.github.com/users/GeminiHu","html_url":"https://github.com/GeminiHu","followers_url":"https://api.github.com/users/GeminiHu/followers","following_url":"https://api.github.com/users/GeminiHu/following{/other_user}","gists_url":"https://api.github.com/users/GeminiHu/gists{/gist_id}","starred_url":"https://api.github.com/users/GeminiHu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GeminiHu/subscriptions","organizations_url":"https://api.github.com/users/GeminiHu/orgs","repos_url":"https://api.github.com/users/GeminiHu/repos","events_url":"https://api.github.com/users/GeminiHu/events{/privacy}","received_events_url":"https://api.github.com/users/GeminiHu/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-04-11T01:09:43Z","updated_at":"2019-04-13T10:34:39Z","closed_at":"2019-04-13T10:34:39Z","author_association":"NONE","active_lock_reason":null,"body":"报错代码:\r\n`fluid.io.save_inference_model(dirname='./infer_model', feeded_var_names=[pyreader.name],\r\n                                  target_vars=[graph_vars[\"cls_embeddings\"]], executor=exe)`\r\n\r\n报错信息：\r\n`-----------  Configuration Arguments -----------\r\nbatch_size: 1\r\ndata_set: ./task_data/txt_match/test.tsv\r\ndo_lower_case: True\r\nernie_config_path: config/ernie_config.json\r\ninit_pretraining_params: ./checkpoints/step_9000\r\nmax_seq_len: 510\r\noutput_dir: ./test\r\nuse_cuda: True\r\nvocab_path: config/vocab.txt\r\n------------------------------------------------\r\nattention_probs_dropout_prob: 0.1\r\nhidden_act: relu\r\nhidden_dropout_prob: 0.1\r\nhidden_size: 768\r\ninitializer_range: 0.02\r\nmax_position_embeddings: 513\r\nnum_attention_heads: 12\r\nnum_hidden_layers: 12\r\ntype_vocab_size: 2\r\nvocab_size: 18000\r\n------------------------------------------------\r\nDevice count: 2\r\nTotal num examples: 1200\r\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\r\nreader_double_buffer\r\nW0410 16:55:00.093608 35269 device_context.cc:263] Please NOTE: device: 1, CUDA Capability: 70, Driver API Version: 9.1, Runtime API Version: 9.0\r\nW0410 16:55:00.093653 35269 device_context.cc:271] device: 1, cuDNN Version: 7.0.\r\nLoad pretraining parameters from ./checkpoints/step_9000.\r\n##################################################\r\nTraceback (most recent call last):\r\n  File \"ernir_encoder.py\", line 195, in <module>\r\n    main(args)\r\n  File \"ernir_encoder.py\", line 156, in main\r\n    target_vars=[graph_vars[\"cls_embeddings\"]], executor=exe)\r\n  File \"/home/huyichen/anaconda3/lib/python3.7/site-packages/paddle/fluid/io.py\", line 954, in save_inference_model\r\n    var, 1., name=\"save_infer_model/scale_{}\".format(i))\r\n  File \"/home/huyichen/anaconda3/lib/python3.7/site-packages/paddle/fluid/layers/nn.py\", line 8857, in scale\r\n    'bias_after_scale': bias_after_scale\r\n  File \"/home/huyichen/anaconda3/lib/python3.7/site-packages/paddle/fluid/layer_helper.py\", line 56, in append_op\r\n    return self.main_program.current_block().append_op(*args, **kwargs)\r\n  File \"/home/huyichen/anaconda3/lib/python3.7/site-packages/paddle/fluid/framework.py\", line 1317, in append_op\r\n    attrs=kwargs.get(\"attrs\", None))\r\n  File \"/home/huyichen/anaconda3/lib/python3.7/site-packages/paddle/fluid/framework.py\", line 726, in __init__\r\n    self.desc.infer_var_type(self.block.desc)\r\npaddle.fluid.core.EnforceNotMet:  at [/paddle/paddle/fluid/operators/detail/safe_ref.h:28]\r\nPaddlePaddle Call Stacks: \r\n0       0x7f48ecfdd515p void paddle::platform::EnforceNotMet::Init<char const*>(char const*, char const*, int) + 357\r\n1       0x7f48ecfdd899p paddle::platform::EnforceNotMet::EnforceNotMet(std::__exception_ptr::exception_ptr, char const*, int) + 137\r\n2       0x7f48ed84babfp paddle::operators::ScaleOpVarTypeInference::operator()(paddle::framework::OpDesc const&, paddle::framework::BlockDesc*) const + 431\r\n3       0x7f48ed84bba3p std::_Function_handler<void (paddle::framework::OpDesc const&, paddle::framework::BlockDesc*), paddle::framework::details::OpInfoFiller<paddle::operators::ScaleOpVarTypeInference, (paddle::framework::details::OpInfoFillType)3>::operator()(char const*, paddle::framework::OpInfo*) const::{lambda(paddle::framework::OpDesc const&, paddle::framework::BlockDesc*)#1}>::_M_invoke(std::_Any_data const&, paddle::framework::OpDesc const&, paddle::framework::BlockDesc*) + 35\r\n4       0x7f48ed0df292p paddle::framework::OpDesc::InferVarType(paddle::framework::BlockDesc*) const + 98\r\n5       0x7f48ed053333p\r\n6       0x7f48ed0088cep\r\n7       0x556025e52004p _PyMethodDef_RawFastCallKeywords + 612\r\n8       0x556025e52121p _PyCFunction_FastCallKeywords + 33\r\n9       0x556025eae40ep _PyEval_EvalFrameDefault + 21294\r\n10      0x556025deef19p _PyEval_EvalCodeWithName + 761\r\n11      0x556025df01e8p _PyFunction_FastCallDict + 984\r\n12      0x556025e06cb3p _PyObject_Call_Prepend + 99\r\n13      0x556025e49c0ap\r\n14      0x556025e522d8p _PyObject_FastCallKeywords + 296\r\n15      0x556025eae98ap _PyEval_EvalFrameDefault + 22698\r\n16      0x556025deef19p _PyEval_EvalCodeWithName + 761\r\n17      0x556025df01e8p _PyFunction_FastCallDict + 984\r\n18      0x556025e06cb3p _PyObject_Call_Prepend + 99\r\n19      0x556025dfb7dep PyObject_Call + 110\r\n20      0x556025eaaf1ep _PyEval_EvalFrameDefault + 7742\r\n21      0x556025deef19p _PyEval_EvalCodeWithName + 761\r\n22      0x556025e51337p _PyFunction_FastCallKeywords + 903\r\n23      0x556025eaa5d5p _PyEval_EvalFrameDefault + 5365\r\n24      0x556025deef19p _PyEval_EvalCodeWithName + 761\r\n25      0x556025e51337p _PyFunction_FastCallKeywords + 903\r\n26      0x556025eaa5d5p _PyEval_EvalFrameDefault + 5365\r\n27      0x556025deef19p _PyEval_EvalCodeWithName + 761\r\n28      0x556025e51337p _PyFunction_FastCallKeywords + 903\r\n29      0x556025eaa5d5p _PyEval_EvalFrameDefault + 5365\r\n30      0x556025e510abp _PyFunction_FastCallKeywords + 251\r\n31      0x556025ea97d6p _PyEval_EvalFrameDefault + 1782\r\n32      0x556025deef19p _PyEval_EvalCodeWithName + 761\r\n33      0x556025defdd4p PyEval_EvalCodeEx + 68\r\n34      0x556025defdfcp PyEval_EvalCode + 28\r\n35      0x556025f089e4p\r\n36      0x556025f12bd1p PyRun_FileExFlags + 161\r\n37      0x556025f12dc3p PyRun_SimpleFileExFlags + 451\r\n38      0x556025f13edbp\r\n39      0x556025f13fbcp _Py_UnixMain + 60\r\n40      0x7f4918882830p __libc_start_main + 240\r\n41      0x556025eb8ed2p`\r\n\r\n尝试方案：\r\n参照BERT predict_classifier.py文件找到save_inference_model的使用,  其中feed_target_names参数来自于该行代码:\r\n`predict_pyreader, probs, feed_target_names = create_model(...)`\r\n但是model.classifier中create_model函数的返回值是pyreader, loss, probs, accuracy, num_seqs\r\n似乎这里使用的create_model不是predict_classifier.py第29行导入的函数?\r\n\r\n希望帮我解决save ernie embedding inference model的问题，如果其他地方我有什么理解错误的麻烦指正！谢谢！\r\n","closed_by":{"login":"tianxin1860","id":6829601,"node_id":"MDQ6VXNlcjY4Mjk2MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6829601?v=4","gravatar_id":"","url":"https://api.github.com/users/tianxin1860","html_url":"https://github.com/tianxin1860","followers_url":"https://api.github.com/users/tianxin1860/followers","following_url":"https://api.github.com/users/tianxin1860/following{/other_user}","gists_url":"https://api.github.com/users/tianxin1860/gists{/gist_id}","starred_url":"https://api.github.com/users/tianxin1860/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tianxin1860/subscriptions","organizations_url":"https://api.github.com/users/tianxin1860/orgs","repos_url":"https://api.github.com/users/tianxin1860/repos","events_url":"https://api.github.com/users/tianxin1860/events{/privacy}","received_events_url":"https://api.github.com/users/tianxin1860/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/86/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/86/timeline","performed_via_github_app":null,"state_reason":"completed"}