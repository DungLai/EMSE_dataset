{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/690","repository_url":"https://api.github.com/repos/PaddlePaddle/ERNIE","labels_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/690/labels{/name}","comments_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/690/comments","events_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/690/events","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/690","id":909153349,"node_id":"MDU6SXNzdWU5MDkxNTMzNDk=","number":690,"title":"通过ERNIE finetuning后利用--inference_model_dir参数保存的模型无法用Paddle Inference去加载预测","user":{"login":"xiaoranchenwai","id":17871734,"node_id":"MDQ6VXNlcjE3ODcxNzM0","avatar_url":"https://avatars.githubusercontent.com/u/17871734?v=4","gravatar_id":"","url":"https://api.github.com/users/xiaoranchenwai","html_url":"https://github.com/xiaoranchenwai","followers_url":"https://api.github.com/users/xiaoranchenwai/followers","following_url":"https://api.github.com/users/xiaoranchenwai/following{/other_user}","gists_url":"https://api.github.com/users/xiaoranchenwai/gists{/gist_id}","starred_url":"https://api.github.com/users/xiaoranchenwai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiaoranchenwai/subscriptions","organizations_url":"https://api.github.com/users/xiaoranchenwai/orgs","repos_url":"https://api.github.com/users/xiaoranchenwai/repos","events_url":"https://api.github.com/users/xiaoranchenwai/events{/privacy}","received_events_url":"https://api.github.com/users/xiaoranchenwai/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-06-02T06:19:43Z","updated_at":"2022-05-17T17:27:33Z","closed_at":"2021-06-04T09:43:25Z","author_association":"NONE","active_lock_reason":null,"body":"训练过程中添加了args.inference_model_dir参数如下：\r\n    if args.inference_model_dir is not None:\r\n        class InferenceModel(ErnieModelForSequenceClassification):\r\n            def forward(self, ids, sids):\r\n                _, logits = super(InferenceModel, self).forward(ids, sids)\r\n                return logits\r\n        model.__class__ = InferenceModel\r\n        log.debug('saving inference model')\r\n        src_placeholder = P.zeros([2, 2], dtype='int64')\r\n        sent_placehodler = P.zeros([2, 2], dtype='int64')\r\n        _, static = P.jit.TracedLayer.trace(\r\n            model, inputs=[src_placeholder, sent_placehodler])\r\n        static.save_inference_model(str(args.inference_model_dir))\r\n        log.debug('done')\r\n最后保存的文件格式为：inference_model.pdiparams和inference_model.pdmodel两个文件，无法用inference中的代码去加载预测。","closed_by":{"login":"xiaoranchenwai","id":17871734,"node_id":"MDQ6VXNlcjE3ODcxNzM0","avatar_url":"https://avatars.githubusercontent.com/u/17871734?v=4","gravatar_id":"","url":"https://api.github.com/users/xiaoranchenwai","html_url":"https://github.com/xiaoranchenwai","followers_url":"https://api.github.com/users/xiaoranchenwai/followers","following_url":"https://api.github.com/users/xiaoranchenwai/following{/other_user}","gists_url":"https://api.github.com/users/xiaoranchenwai/gists{/gist_id}","starred_url":"https://api.github.com/users/xiaoranchenwai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiaoranchenwai/subscriptions","organizations_url":"https://api.github.com/users/xiaoranchenwai/orgs","repos_url":"https://api.github.com/users/xiaoranchenwai/repos","events_url":"https://api.github.com/users/xiaoranchenwai/events{/privacy}","received_events_url":"https://api.github.com/users/xiaoranchenwai/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/690/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/690/timeline","performed_via_github_app":null,"state_reason":"completed"}