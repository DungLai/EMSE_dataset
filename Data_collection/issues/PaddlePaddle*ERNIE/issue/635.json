{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/635","repository_url":"https://api.github.com/repos/PaddlePaddle/ERNIE","labels_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/635/labels{/name}","comments_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/635/comments","events_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/635/events","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/635","id":819542829,"node_id":"MDU6SXNzdWU4MTk1NDI4Mjk=","number":635,"title":"tokenizing_ernie.truncate长度问题","user":{"login":"Mryangkaitong","id":23132307,"node_id":"MDQ6VXNlcjIzMTMyMzA3","avatar_url":"https://avatars.githubusercontent.com/u/23132307?v=4","gravatar_id":"","url":"https://api.github.com/users/Mryangkaitong","html_url":"https://github.com/Mryangkaitong","followers_url":"https://api.github.com/users/Mryangkaitong/followers","following_url":"https://api.github.com/users/Mryangkaitong/following{/other_user}","gists_url":"https://api.github.com/users/Mryangkaitong/gists{/gist_id}","starred_url":"https://api.github.com/users/Mryangkaitong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mryangkaitong/subscriptions","organizations_url":"https://api.github.com/users/Mryangkaitong/orgs","repos_url":"https://api.github.com/users/Mryangkaitong/repos","events_url":"https://api.github.com/users/Mryangkaitong/events{/privacy}","received_events_url":"https://api.github.com/users/Mryangkaitong/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-03-02T02:31:13Z","updated_at":"2021-03-03T07:17:13Z","closed_at":"2021-03-03T07:17:13Z","author_association":"NONE","active_lock_reason":null,"body":"在使用tokenizing_ernie对句对进行编码的时候：\r\n\r\nErnieTokenizer.encode(text_a, text_b, max_seq_len-3)\r\n\r\n最后在规范化句子总长度时会调用truncate：\r\nhttps://github.com/PaddlePaddle/ERNIE/blob/develop/ernie/tokenizing_ernie.py#L187\r\n\r\n`\r\ndef truncate(self, id1, id2, seqlen):\r\n        len1 = len(id1)\r\n        len2 = len(id2)\r\n        half = seqlen // 2\r\n        if len1 > len2:\r\n            len1_truncated, len2_truncated = max(half, seqlen - len2), min(\r\n                half, len2)\r\n        else:\r\n            len1_truncated, len2_truncated = min(half, seqlen - len1), max(\r\n                half, seqlen - len1)\r\n        return id1[:len1_truncated], id2[:len2_truncated]\r\n\r\n`\r\n假设原始的text_a,text_b即 id1, id2的长度是138和258，设置的max_len=128 ，那么此时seqlen=max_len-3=125\r\nlen1=138, len2=258, 那么len1_truncated=-13，len2_truncated=62， 那么id1[:len1_truncated]的长度就是125， id2[:len2_truncated]就是62， 经过build_for_ernie加上cls，sep,sep后总长度就是125+62+3=190 ,和预设置的max_len=128不一致？请问这个怎么理解呢？","closed_by":{"login":"Mryangkaitong","id":23132307,"node_id":"MDQ6VXNlcjIzMTMyMzA3","avatar_url":"https://avatars.githubusercontent.com/u/23132307?v=4","gravatar_id":"","url":"https://api.github.com/users/Mryangkaitong","html_url":"https://github.com/Mryangkaitong","followers_url":"https://api.github.com/users/Mryangkaitong/followers","following_url":"https://api.github.com/users/Mryangkaitong/following{/other_user}","gists_url":"https://api.github.com/users/Mryangkaitong/gists{/gist_id}","starred_url":"https://api.github.com/users/Mryangkaitong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mryangkaitong/subscriptions","organizations_url":"https://api.github.com/users/Mryangkaitong/orgs","repos_url":"https://api.github.com/users/Mryangkaitong/repos","events_url":"https://api.github.com/users/Mryangkaitong/events{/privacy}","received_events_url":"https://api.github.com/users/Mryangkaitong/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/635/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/635/timeline","performed_via_github_app":null,"state_reason":"completed"}