{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/180","repository_url":"https://api.github.com/repos/PaddlePaddle/ERNIE","labels_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/180/labels{/name}","comments_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/180/comments","events_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/180/events","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/180","id":461282649,"node_id":"MDU6SXNzdWU0NjEyODI2NDk=","number":180,"title":"如何理解batch中序列的mask实现","user":{"login":"shiyazhou121","id":15082798,"node_id":"MDQ6VXNlcjE1MDgyNzk4","avatar_url":"https://avatars.githubusercontent.com/u/15082798?v=4","gravatar_id":"","url":"https://api.github.com/users/shiyazhou121","html_url":"https://github.com/shiyazhou121","followers_url":"https://api.github.com/users/shiyazhou121/followers","following_url":"https://api.github.com/users/shiyazhou121/following{/other_user}","gists_url":"https://api.github.com/users/shiyazhou121/gists{/gist_id}","starred_url":"https://api.github.com/users/shiyazhou121/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shiyazhou121/subscriptions","organizations_url":"https://api.github.com/users/shiyazhou121/orgs","repos_url":"https://api.github.com/users/shiyazhou121/repos","events_url":"https://api.github.com/users/shiyazhou121/events{/privacy}","received_events_url":"https://api.github.com/users/shiyazhou121/received_events","type":"User","site_admin":false},"labels":[{"id":1421593303,"node_id":"MDU6TGFiZWwxNDIxNTkzMzAz","url":"https://api.github.com/repos/PaddlePaddle/ERNIE/labels/user","name":"user","color":"fbffa3","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-06-27T03:21:08Z","updated_at":"2019-06-27T06:23:40Z","closed_at":"2019-06-27T06:23:40Z","author_association":"NONE","active_lock_reason":null,"body":"在同一个batch里，为了统一长度对短序列加入pad=0。经过scale后补位的部分变成-10000，比如mask矩阵如下\r\n[[0 0 -10000]\r\n[0 0 -10000]\r\n[-10000 -10000 -10000]]\r\n在self-attention时，是将q*k后的矩阵加上mask矩阵，经过softmax后，mask[0][2]后mask[1][2]等于0，实现了掩码功能，但第三行是[0.3333, 0.3333, 0.3333]，再乘v后，第三行不为0。\r\n如果是多层mul_heads_attention的话，掩码貌似失去了功能。\r\n\r\n![image](https://user-images.githubusercontent.com/15082798/60231673-a1fd6780-98cc-11e9-8fc0-36139d899483.png)\r\n![image](https://user-images.githubusercontent.com/15082798/60231686-afb2ed00-98cc-11e9-8b37-a846b2bf4b0c.png)\r\n\r\n","closed_by":{"login":"shiyazhou121","id":15082798,"node_id":"MDQ6VXNlcjE1MDgyNzk4","avatar_url":"https://avatars.githubusercontent.com/u/15082798?v=4","gravatar_id":"","url":"https://api.github.com/users/shiyazhou121","html_url":"https://github.com/shiyazhou121","followers_url":"https://api.github.com/users/shiyazhou121/followers","following_url":"https://api.github.com/users/shiyazhou121/following{/other_user}","gists_url":"https://api.github.com/users/shiyazhou121/gists{/gist_id}","starred_url":"https://api.github.com/users/shiyazhou121/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shiyazhou121/subscriptions","organizations_url":"https://api.github.com/users/shiyazhou121/orgs","repos_url":"https://api.github.com/users/shiyazhou121/repos","events_url":"https://api.github.com/users/shiyazhou121/events{/privacy}","received_events_url":"https://api.github.com/users/shiyazhou121/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/180/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/180/timeline","performed_via_github_app":null,"state_reason":"completed"}