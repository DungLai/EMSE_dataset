{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/598","repository_url":"https://api.github.com/repos/PaddlePaddle/ERNIE","labels_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/598/labels{/name}","comments_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/598/comments","events_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/598/events","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/598","id":751989507,"node_id":"MDU6SXNzdWU3NTE5ODk1MDc=","number":598,"title":"ERNIE运行Demo中的finetune_seq2seq_dygraph.py出现问题","user":{"login":"herb711","id":38155482,"node_id":"MDQ6VXNlcjM4MTU1NDgy","avatar_url":"https://avatars.githubusercontent.com/u/38155482?v=4","gravatar_id":"","url":"https://api.github.com/users/herb711","html_url":"https://github.com/herb711","followers_url":"https://api.github.com/users/herb711/followers","following_url":"https://api.github.com/users/herb711/following{/other_user}","gists_url":"https://api.github.com/users/herb711/gists{/gist_id}","starred_url":"https://api.github.com/users/herb711/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/herb711/subscriptions","organizations_url":"https://api.github.com/users/herb711/orgs","repos_url":"https://api.github.com/users/herb711/repos","events_url":"https://api.github.com/users/herb711/events{/privacy}","received_events_url":"https://api.github.com/users/herb711/received_events","type":"User","site_admin":false},"labels":[{"id":1256169225,"node_id":"MDU6TGFiZWwxMjU2MTY5MjI1","url":"https://api.github.com/repos/PaddlePaddle/ERNIE/labels/wontfix","name":"wontfix","color":"ffffff","default":true,"description":"This will not be worked on"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-11-27T05:22:53Z","updated_at":"2021-02-05T04:48:13Z","closed_at":"2021-02-05T04:48:13Z","author_association":"NONE","active_lock_reason":null,"body":"# 在ai studio中运行如下代码：\r\n\r\n```\r\n!python ERNIE/demo/seq2seq/finetune_seq2seq_dygraph.py \\\r\n--from_pretrained ernie-1.0 \\\r\n--data_dir work/datasets/medical \\\r\n--max_steps 128 \\\r\n--save_dir work/save\r\n```\r\n\r\n发生错误。错误显示如下：\r\n\r\n\r\n[INFO] 2020-11-24 23:23:28,189 [modeling_ernie.py:  201]:\tget pretrain dir from https://ernie-github.cdn.bcebos.com/model-ernie1.0.1.tar.gz\r\n[DEBUG] 2020-11-24 23:23:28,190 [file_utils.py:   58]:\thttps://ernie-github.cdn.bcebos.com/model-ernie1.0.1.tar.gz cached in /home/aistudio/.paddle-ernie-cache\r\n[DEBUG] 2020-11-24 23:23:28,190 [modeling_ernie.py:  242]:\tinit ErnieModel with config: {'attention_probs_dropout_prob': 0.1, 'hidden_act': 'relu', 'hidden_dropout_prob': 0.1, 'hidden_size': 768, 'initializer_range': 0.02, 'max_position_embeddings': 513, 'num_attention_heads': 12, 'num_hidden_layers': 12, 'type_vocab_size': 2, 'vocab_size': 18000, 'return_additional_info': True, 'has_pooler': False}\r\nW1124 23:23:28.191437   207 device_context.cc:252] Please NOTE: device: 0, CUDA Capability: 70, Driver API Version: 10.1, Runtime API Version: 9.0\r\nW1124 23:23:28.196331   207 device_context.cc:260] device: 0, cuDNN Version: 7.6.\r\n[INFO] 2020-11-24 23:23:31,189 [modeling_ernie.py:  219]:\tloading pretrained model from /home/aistudio/.paddle-ernie-cache/466eabcffd6d6a83ae9cb97dd1a167bd\r\n/opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/paddle/fluid/dygraph/layers.py:717: UserWarning: Varibale [ pooler.weight pooler.bias ] are not used, because not included in layers state_dict\r\n  format(\" \".join(unused_para_list)))\r\n[INFO] 2020-11-24 23:23:34,437 [tokenizing_ernie.py:   89]:\tget pretrain dir from https://ernie-github.cdn.bcebos.com/model-ernie1.0.1.tar.gz\r\n[DEBUG] 2020-11-24 23:23:34,437 [file_utils.py:   58]:\thttps://ernie-github.cdn.bcebos.com/model-ernie1.0.1.tar.gz cached in /home/aistudio/.paddle-ernie-cache\r\n[DEBUG] 2020-11-24 23:23:34,447 [tokenizing_ernie.py:  134]:\tregex: (\\[PAD\\])|(\\[SEP\\])|(\\[UNK\\])|(\\[CLS\\])|([a-zA-Z0-9]+|\\S)\r\n[INFO] 2020-11-24 23:23:34,449 [finetune_seq2seq_dygraph.py:   83]:\tTraining starts with args: Namespace(attn_token='[MASK]', beam_width=5, bsz=8, data_dir='work/datasets/medical', eval_bsz=20, eval_steps=5000, from_pretrained='ernie-1.0', inference_model_dir=None, init_checkpoint=None, label_smooth=0.1, length_penalty=1.0, lr=5e-05, max_decode_len=120, max_encode_len=640, max_steps=128, noise_prob=0.7, predict_output_dir=None, save_dir='work/save', skip_eval_steps=1, tgt_type_id=3, use_random_noice=False, warmup_proportion=0.1, wd=0.01)\r\n[INFO] 2020-11-24 23:23:34,453 [feature_column.py:  353]:\treading raw files from work/datasets/medical/train/1.tsv\r\n[INFO] 2020-11-24 23:23:34,453 [feature_column.py:  353]:\treading raw files from work/datasets/medical/dev/1.tsv\r\n[DEBUG] 2020-11-24 23:23:34,453 [finetune_seq2seq_dygraph.py:  216]:\tshard 0 of 1\r\n[ERROR] 2020-11-24 23:23:34,456 [functional.py:   69]:\t'[NOISE]'\r\nTraceback (most recent call last):\r\n  File \"/home/aistudio/ERNIE/propeller/paddle/data/functional.py\", line 66, in _gen\r\n    for idx, i in enumerate(self.generator()):\r\n  File \"/home/aistudio/ERNIE/propeller/data/functional.py\", line 282, in _wrapper\r\n    for item in _gen():\r\n  File \"/home/aistudio/ERNIE/propeller/data/functional.py\", line 135, in _gen\r\n    for i in dataset():\r\n  File \"/home/aistudio/ERNIE/propeller/data/functional.py\", line 282, in _wrapper\r\n    for item in _gen():\r\n  File \"/home/aistudio/ERNIE/propeller/data/functional.py\", line 240, in _gen\r\n    buf = list(itertools.islice(iterable, batch_size))\r\n  File \"/home/aistudio/ERNIE/propeller/data/functional.py\", line 282, in _wrapper\r\n    for item in _gen():\r\n  File \"/home/aistudio/ERNIE/propeller/data/functional.py\", line 74, in _gen\r\n    buf.append(next(iterable))\r\n  File \"/home/aistudio/ERNIE/propeller/data/functional.py\", line 282, in _wrapper\r\n    for item in _gen():\r\n  File \"/home/aistudio/ERNIE/propeller/data/functional.py\", line 148, in _gen\r\n    for i in ret:\r\n  File \"/home/aistudio/ERNIE/propeller/data/functional.py\", line 282, in _wrapper\r\n    for item in _gen():\r\n  File \"/home/aistudio/ERNIE/propeller/data/functional.py\", line 137, in _gen\r\n    yield fn(*i)\r\n  File \"ERNIE/demo/seq2seq/finetune_seq2seq_dygraph.py\", line 130, in map_fn\r\n    tgt_ids = make_some_noice(tgt_ids) #corrupted\r\n  File \"ERNIE/demo/seq2seq/finetune_seq2seq_dygraph.py\", line 110, in make_some_noice\r\n    noice_ids = np.ones_like(ids) * tokenizer.vocab['[NOISE]']\r\nKeyError: '[NOISE]'\r\n[WARNING] 2020-11-24 23:23:34,458 [   reader.py:  912]:\tDygraphDataLoader reader thread raised an exception.\r\nTraceback (most recent call last):\r\n  File \"ERNIE/demo/seq2seq/finetune_seq2seq_dygraph.py\", line 318, in <module>\r\n    seq2seq(ernie, tokenizer, args)\r\n  File \"ERNIE/demo/seq2seq/finetune_seq2seq_dygraph.py\", line 234, in seq2seq\r\n    for step, data in enumerate(train_ds.start(place)):\r\n  File \"/opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/paddle/fluid/reader.py\", line 804, in __next__\r\n    return self._reader.read_next_var_list()\r\npaddle.fluid.core_avx.EnforceNotMet: \r\n\r\n--------------------------------------------\r\nC++ Call Stacks (More useful to developers):\r\n--------------------------------------------\r\n0   std::string paddle::platform::GetTraceBackString<std::string const&>(std::string const&, char const*, int)\r\n1   paddle::platform::EnforceNotMet::EnforceNotMet(std::string const&, char const*, int)\r\n2   paddle::operators::reader::BlockingQueue<std::vector<paddle::framework::LoDTensor, std::allocator<paddle::framework::LoDTensor> > >::Receive(std::vector<paddle::framework::LoDTensor, std::allocator<paddle::framework::LoDTensor> >*)\r\n3   paddle::operators::reader::PyReader::ReadNext(std::vector<paddle::framework::LoDTensor, std::allocator<paddle::framework::LoDTensor> >*)\r\n4   std::_Function_handler<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> (), std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<unsigned long>, std::__future_base::_Result_base::_Deleter>, unsigned long> >::_M_invoke(std::_Any_data const&)\r\n5   std::__future_base::_State_base::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>&, bool&)\r\n6   ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const\r\n\r\n----------------------\r\nError Message Summary:\r\n----------------------\r\nError: Blocking queue is killed because the data reader raises an exception\r\n  [Hint: Expected killed_ != true, but received killed_:1 == true:1.] at (/paddle/paddle/fluid/operators/reader/blocking_queue.h:141)\r\n","closed_by":{"login":"stale[bot]","id":26384082,"node_id":"MDM6Qm90MjYzODQwODI=","avatar_url":"https://avatars.githubusercontent.com/in/1724?v=4","gravatar_id":"","url":"https://api.github.com/users/stale%5Bbot%5D","html_url":"https://github.com/apps/stale","followers_url":"https://api.github.com/users/stale%5Bbot%5D/followers","following_url":"https://api.github.com/users/stale%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stale%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/stale%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/stale%5Bbot%5D/repos","events_url":"https://api.github.com/users/stale%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/stale%5Bbot%5D/received_events","type":"Bot","site_admin":false},"reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/598/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/598/timeline","performed_via_github_app":null,"state_reason":"completed"}