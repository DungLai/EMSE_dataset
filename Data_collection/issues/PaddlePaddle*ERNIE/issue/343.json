{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/343","repository_url":"https://api.github.com/repos/PaddlePaddle/ERNIE","labels_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/343/labels{/name}","comments_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/343/comments","events_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/343/events","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/343","id":507005971,"node_id":"MDU6SXNzdWU1MDcwMDU5NzE=","number":343,"title":"encode.sh报错：The shape of Input(Length) should be [batch_size]","user":{"login":"mapingshuo","id":23031310,"node_id":"MDQ6VXNlcjIzMDMxMzEw","avatar_url":"https://avatars.githubusercontent.com/u/23031310?v=4","gravatar_id":"","url":"https://api.github.com/users/mapingshuo","html_url":"https://github.com/mapingshuo","followers_url":"https://api.github.com/users/mapingshuo/followers","following_url":"https://api.github.com/users/mapingshuo/following{/other_user}","gists_url":"https://api.github.com/users/mapingshuo/gists{/gist_id}","starred_url":"https://api.github.com/users/mapingshuo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mapingshuo/subscriptions","organizations_url":"https://api.github.com/users/mapingshuo/orgs","repos_url":"https://api.github.com/users/mapingshuo/repos","events_url":"https://api.github.com/users/mapingshuo/events{/privacy}","received_events_url":"https://api.github.com/users/mapingshuo/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"tianxin1860","id":6829601,"node_id":"MDQ6VXNlcjY4Mjk2MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6829601?v=4","gravatar_id":"","url":"https://api.github.com/users/tianxin1860","html_url":"https://github.com/tianxin1860","followers_url":"https://api.github.com/users/tianxin1860/followers","following_url":"https://api.github.com/users/tianxin1860/following{/other_user}","gists_url":"https://api.github.com/users/tianxin1860/gists{/gist_id}","starred_url":"https://api.github.com/users/tianxin1860/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tianxin1860/subscriptions","organizations_url":"https://api.github.com/users/tianxin1860/orgs","repos_url":"https://api.github.com/users/tianxin1860/repos","events_url":"https://api.github.com/users/tianxin1860/events{/privacy}","received_events_url":"https://api.github.com/users/tianxin1860/received_events","type":"User","site_admin":false},"assignees":[{"login":"tianxin1860","id":6829601,"node_id":"MDQ6VXNlcjY4Mjk2MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6829601?v=4","gravatar_id":"","url":"https://api.github.com/users/tianxin1860","html_url":"https://github.com/tianxin1860","followers_url":"https://api.github.com/users/tianxin1860/followers","following_url":"https://api.github.com/users/tianxin1860/following{/other_user}","gists_url":"https://api.github.com/users/tianxin1860/gists{/gist_id}","starred_url":"https://api.github.com/users/tianxin1860/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tianxin1860/subscriptions","organizations_url":"https://api.github.com/users/tianxin1860/orgs","repos_url":"https://api.github.com/users/tianxin1860/repos","events_url":"https://api.github.com/users/tianxin1860/events{/privacy}","received_events_url":"https://api.github.com/users/tianxin1860/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2019-10-15T04:58:46Z","updated_at":"2019-11-25T02:54:09Z","closed_at":"2019-11-25T02:53:41Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, 我在使用encode.py来计算一句话的embedding, 正如Readme介绍的那样：https://github.com/PaddlePaddle/ERNIE#faq1-how-to-get-sentencetokens-embedding-of-ernie \r\n\r\n我的encode脚本为：\r\n\r\n```shell\r\nTASK_DATA_PATH=.\r\nMODEL_PATH=/path/to/model\r\nexport FLAGS_sync_nccl_allreduce=1\r\nexport CUDA_VISIBLE_DEVICES=4\r\n\r\npython -u ernie_encoder.py \\\r\n                   --use_cuda true \\\r\n                   --batch_size 3 \\\r\n                   --output_dir \"./test\" \\\r\n                   --init_pretraining_params ${MODEL_PATH}/trained_chinese/params \\\r\n                   --data_set ${TASK_DATA_PATH}/baidu_input/dev.tsv \\\r\n                   --vocab_path ${MODEL_PATH}/vocab.txt \\\r\n                   --max_seq_len 128 \\\r\n                   --ernie_config_path ${MODEL_PATH}/ernie_config.json\r\n```\r\n其中，baidu_input/dev.tsv 如下：\r\n\r\n```shell\r\nlabel\\ttext_a\\n\r\n0\\t你吃了么\\n\r\n1\\t我吃过了\\n\r\n0\\t谢谢你啊\\n\r\n```\r\n模型报错：\r\n```shell\r\nDevice count: 1\r\nTotal num examples: 3\r\nWARNING:root:paddle.fluid.layers.py_reader() may be deprecated in the near future. Please use paddle.fluid.io.PyReader() instead.\r\nTraceback (most recent call last):\r\n  File \"ernie_encoder.py\", line 182, in <module>\r\n    main(args)\r\n  File \"ernie_encoder.py\", line 130, in main\r\n    args, pyreader_name='reader', ernie_config=ernie_config)\r\n  File \"ernie_encoder.py\", line 77, in create_model\r\n    unpad_enc_out = fluid.layers.sequence_unpad(enc_out, length=seq_lens)\r\n  File \"/home/mapingshuo/paddle_release_home/python-distribute/lib/python2.7/site-packages/paddle/fluid/layers/nn.py\", line 4842, in sequence_unpad\r\n    outputs={'Out': out})\r\n  File \"/home/mapingshuo/paddle_release_home/python-distribute/lib/python2.7/site-packages/paddle/fluid/layer_helper.py\", line 43, in append_op\r\n    return self.main_program.current_block().append_op(*args, **kwargs)\r\n  File \"/home/mapingshuo/paddle_release_home/python-distribute/lib/python2.7/site-packages/paddle/fluid/framework.py\", line 2116, in append_op\r\n    attrs=kwargs.get(\"attrs\", None))\r\n  File \"/home/mapingshuo/paddle_release_home/python-distribute/lib/python2.7/site-packages/paddle/fluid/framework.py\", line 1499, in __init__\r\n    self.desc.infer_shape(self.block.desc)\r\npaddle.fluid.core_avx.EnforceNotMet:\r\n\r\n--------------------------------------------\r\nC++ Call Stacks (More useful to developers):\r\n--------------------------------------------\r\n0   std::string paddle::platform::GetTraceBackString<std::string const&>(std::string const&, char const*, int)\r\n1   paddle::platform::EnforceNotMet::EnforceNotMet(std::string const&, char const*, int)\r\n2   paddle::operators::SequenceUnpadOp::InferShape(paddle::framework::InferShapeContext*) const\r\n3   paddle::framework::OpDesc::InferShape(paddle::framework::BlockDesc const&) const\r\n\r\n------------------------------------------\r\nPython Call Stacks (More useful to users):\r\n------------------------------------------\r\n  File \"/home/mapingshuo/paddle_release_home/python-distribute/lib/python2.7/site-packages/paddle/fluid/framework.py\", line 2116, in append_op\r\n    attrs=kwargs.get(\"attrs\", None))\r\n  File \"/home/mapingshuo/paddle_release_home/python-distribute/lib/python2.7/site-packages/paddle/fluid/layer_helper.py\", line 43, in append_op\r\n    return self.main_program.current_block().append_op(*args, **kwargs)\r\n  File \"/home/mapingshuo/paddle_release_home/python-distribute/lib/python2.7/site-packages/paddle/fluid/layers/nn.py\", line 4842, in sequence_unpad\r\n    outputs={'Out': out})\r\n  File \"ernie_encoder.py\", line 77, in create_model\r\n    unpad_enc_out = fluid.layers.sequence_unpad(enc_out, length=seq_lens)\r\n  File \"ernie_encoder.py\", line 130, in main\r\n    args, pyreader_name='reader', ernie_config=ernie_config)\r\n  File \"ernie_encoder.py\", line 182, in <module>\r\n    main(args)\r\n\r\n----------------------\r\nError Message Summary:\r\n----------------------\r\nPaddleCheckError: Expected len_dims.size() == 1, but received len_dims.size():2 != 1:1.\r\nThe shape of Input(Length) should be [batch_size]. at [/home/mapingshuo/Paddle/paddle/fluid/operators/sequence_ops/sequence_unpad_op.cc:41]\r\n  [operator < sequence_unpad > error]\r\n```\r\n请问是什么原因，谢谢","closed_by":{"login":"mapingshuo","id":23031310,"node_id":"MDQ6VXNlcjIzMDMxMzEw","avatar_url":"https://avatars.githubusercontent.com/u/23031310?v=4","gravatar_id":"","url":"https://api.github.com/users/mapingshuo","html_url":"https://github.com/mapingshuo","followers_url":"https://api.github.com/users/mapingshuo/followers","following_url":"https://api.github.com/users/mapingshuo/following{/other_user}","gists_url":"https://api.github.com/users/mapingshuo/gists{/gist_id}","starred_url":"https://api.github.com/users/mapingshuo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mapingshuo/subscriptions","organizations_url":"https://api.github.com/users/mapingshuo/orgs","repos_url":"https://api.github.com/users/mapingshuo/repos","events_url":"https://api.github.com/users/mapingshuo/events{/privacy}","received_events_url":"https://api.github.com/users/mapingshuo/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/343/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/343/timeline","performed_via_github_app":null,"state_reason":"completed"}