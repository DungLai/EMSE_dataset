{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/440","repository_url":"https://api.github.com/repos/PaddlePaddle/ERNIE","labels_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/440/labels{/name}","comments_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/440/comments","events_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/440/events","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/440","id":617901980,"node_id":"MDU6SXNzdWU2MTc5MDE5ODA=","number":440,"title":"load inference model之后执行预测时报错\"should be Variable or str\"","user":{"login":"thuwangzhe","id":26269263,"node_id":"MDQ6VXNlcjI2MjY5MjYz","avatar_url":"https://avatars.githubusercontent.com/u/26269263?v=4","gravatar_id":"","url":"https://api.github.com/users/thuwangzhe","html_url":"https://github.com/thuwangzhe","followers_url":"https://api.github.com/users/thuwangzhe/followers","following_url":"https://api.github.com/users/thuwangzhe/following{/other_user}","gists_url":"https://api.github.com/users/thuwangzhe/gists{/gist_id}","starred_url":"https://api.github.com/users/thuwangzhe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thuwangzhe/subscriptions","organizations_url":"https://api.github.com/users/thuwangzhe/orgs","repos_url":"https://api.github.com/users/thuwangzhe/repos","events_url":"https://api.github.com/users/thuwangzhe/events{/privacy}","received_events_url":"https://api.github.com/users/thuwangzhe/received_events","type":"User","site_admin":false},"labels":[{"id":1256169225,"node_id":"MDU6TGFiZWwxMjU2MTY5MjI1","url":"https://api.github.com/repos/PaddlePaddle/ERNIE/labels/wontfix","name":"wontfix","color":"ffffff","default":true,"description":"This will not be worked on"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2020-05-14T03:46:54Z","updated_at":"2020-07-13T11:56:47Z","closed_at":"2020-07-13T11:56:47Z","author_association":"NONE","active_lock_reason":null,"body":"用save_inference_model的方式保存了模型文件，在执行预测时加载模型:\r\n```python\r\n[self.predict_prog, self.feed_target_names, self.fetch_targets] = (fluid.io.load_inference_model(dirname=args.init_checkpoint, executor=self.exe))\r\nself.predict_exe = fluid.ParallelExecutor(\r\n            use_cuda=args.use_cuda, main_program=self.predict_prog)\r\nnp_vecs = self.predict_exe.run(fetch_list=[self.fetch_targets])\r\n```\r\n\r\n之后报错\r\n```bash\r\nTraceback (most recent call last):\r\n  File \"main.py\", line 147, in <module>\r\n    main()\r\n  File \"main.py\", line 81, in main\r\n    predictor.process_file(input_filename,input_filename+'.txt')\r\n  File \"/home/disk0/wangzhe23/qb_shuangta_12_128/predict.py\", line 100, in process_file\r\n    np_vecs = self.predict_exe.run(fetch_list=[self.fetch_targets])\r\n  File \"/home/disk0/wangzhe23/tools/python27_paddle_1.5.0/lib/python2.7/site-packages/paddle/fluid/parallel_executor.py\", line 280, in run\r\n    return_numpy=return_numpy)\r\n  File \"/home/disk0/wangzhe23/tools/python27_paddle_1.5.0/lib/python2.7/site-packages/paddle/fluid/executor.py\", line 665, in run\r\n    return_numpy=return_numpy)\r\n  File \"/home/disk0/wangzhe23/tools/python27_paddle_1.5.0/lib/python2.7/site-packages/paddle/fluid/executor.py\", line 526, in _run_parallel\r\n    fetch_var_names = list(map(_to_name_str, fetch_list))\r\n  File \"/home/disk0/wangzhe23/tools/python27_paddle_1.5.0/lib/python2.7/site-packages/paddle/fluid/executor.py\", line 247, in _to_name_str\r\n    raise TypeError(str(var) + \" should be Variable or str\")\r\nTypeError: [name: \"save_infer_model/scale_0\"\r\ntype {\r\n  type: LOD_TENSOR\r\n  lod_tensor {\r\n    tensor {\r\n      data_type: FP32\r\n      dims: -1\r\n      dims: 128\r\n    }\r\n    lod_level: 0\r\n  }\r\n}\r\npersistable: false\r\n] should be Variable or str\r\n```\r\n\r\n这个save_infer_model/scale_0输出的向量就是我需要的output向量，不知道为什么会有这样的错误，排查了很久没有解决，辛苦review一下是哪里的问题","closed_by":{"login":"baiyfbupt","id":28884066,"node_id":"MDQ6VXNlcjI4ODg0MDY2","avatar_url":"https://avatars.githubusercontent.com/u/28884066?v=4","gravatar_id":"","url":"https://api.github.com/users/baiyfbupt","html_url":"https://github.com/baiyfbupt","followers_url":"https://api.github.com/users/baiyfbupt/followers","following_url":"https://api.github.com/users/baiyfbupt/following{/other_user}","gists_url":"https://api.github.com/users/baiyfbupt/gists{/gist_id}","starred_url":"https://api.github.com/users/baiyfbupt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/baiyfbupt/subscriptions","organizations_url":"https://api.github.com/users/baiyfbupt/orgs","repos_url":"https://api.github.com/users/baiyfbupt/repos","events_url":"https://api.github.com/users/baiyfbupt/events{/privacy}","received_events_url":"https://api.github.com/users/baiyfbupt/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/440/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/440/timeline","performed_via_github_app":null,"state_reason":"completed"}