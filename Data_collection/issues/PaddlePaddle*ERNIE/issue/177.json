{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/177","repository_url":"https://api.github.com/repos/PaddlePaddle/ERNIE","labels_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/177/labels{/name}","comments_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/177/comments","events_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/177/events","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/177","id":459820666,"node_id":"MDU6SXNzdWU0NTk4MjA2NjY=","number":177,"title":"数据量大时的预测错误","user":{"login":"DominicXWang","id":49054294,"node_id":"MDQ6VXNlcjQ5MDU0Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/49054294?v=4","gravatar_id":"","url":"https://api.github.com/users/DominicXWang","html_url":"https://github.com/DominicXWang","followers_url":"https://api.github.com/users/DominicXWang/followers","following_url":"https://api.github.com/users/DominicXWang/following{/other_user}","gists_url":"https://api.github.com/users/DominicXWang/gists{/gist_id}","starred_url":"https://api.github.com/users/DominicXWang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DominicXWang/subscriptions","organizations_url":"https://api.github.com/users/DominicXWang/orgs","repos_url":"https://api.github.com/users/DominicXWang/repos","events_url":"https://api.github.com/users/DominicXWang/events{/privacy}","received_events_url":"https://api.github.com/users/DominicXWang/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-06-24T10:45:42Z","updated_at":"2019-06-25T06:30:57Z","closed_at":"2019-06-25T06:30:57Z","author_association":"NONE","active_lock_reason":null,"body":"将chnsenticorp 数据集中的文本替换成自己需要的文本，然后用ernie_encoder.py导出词向量遇到问题。\r\n小数据：5000条以下，正常执行\r\n中等规模2-4万，有时报错，有时正常\r\n10万以上行，都会报错。\r\n\r\n每次报错不同，分两种：\r\n第一种是\r\nLoad pretraining parameters from /home/X/tools/py27/ernie/model/params.\r\nTraceback (most recent call last):\r\n  File \"ernie_encoder.py\", line 182, in <module>\r\n    main(args)\r\n  File \"ernie_encoder.py\", line 160, in main\r\n    return_numpy=False)\r\n  File \"/home/X/.jumbo/lib/python2.7/lib/python2.7/site-packages/paddle/fluid/executor.py\", line 565, in run\r\n    use_program_cache=use_program_cache)\r\n  File \"/home/X/.jumbo/lib/python2.7/lib/python2.7/site-packages/paddle/fluid/executor.py\", line 642, in _run\r\n    exe.run(program.desc, scope, 0, True, True, fetch_var_name)\r\npaddle.fluid.core.EnforceNotMet: Invoke operator sequence_unpad error.\r\nPython Callstacks:\r\n  File \"/home/X/.jumbo/lib/python2.7/lib/python2.7/site-packages/paddle/fluid/framework.py\", line 1654, in append_op\r\n    attrs=kwargs.get(\"attrs\", None))\r\n  File \"/home/X/.jumbo/lib/python2.7/lib/python2.7/site-packages/paddle/fluid/layer_helper.py\", line 43, in append_op\r\n    return self.main_program.current_block().append_op(*args, **kwargs)\r\n  File \"/home/X/.jumbo/lib/python2.7/lib/python2.7/site-packages/paddle/fluid/layers/nn.py\", line 4120, in sequence_unpad\r\n    outputs={'Out': out})\r\n  File \"ernie_encoder.py\", line 75, in create_model\r\n    unpad_enc_out = fluid.layers.sequence_unpad(enc_out, length=seq_lens)\r\n  File \"ernie_encoder.py\", line 128, in main\r\n    args, pyreader_name='reader', ernie_config=ernie_config)\r\n  File \"ernie_encoder.py\", line 182, in <module>\r\n    main(args)\r\nC++ Callstacks:\r\nEnforce failed. Expected numel() * SizeOfType(type()) <= memory_size(), but received numel() * SizeOfType(type()):16195584 > memory_size():3735552.\r\nTensor's dims_ is out of bound. Call Tensor::mutable_data first to re-allocate memory.\r\nor maybe the required data-type mismatches the data already stored. at [/paddle/paddle/fluid/framework/tensor.cc:28]\r\nPaddlePaddle Call Stacks:\r\n0       0x7f561f86cb68p void paddle::platform::EnforceNotMet::Init<std::string>(std::string, char const*, int) + 360\r\n1       0x7f561f86ceb7p paddle::platform::EnforceNotMet::EnforceNotMet(std::string const&, char const*, int) + 87\r\n2       0x7f56215525cap paddle::framework::Tensor::check_memory_size() const + 394\r\n3       0x7f56211bb903p paddle::operators::math::UnpaddingLoDTensorFunctor<paddle::platform::CUDADeviceContext, float>::operator()(paddle::platform::CUDADeviceContext const&, paddle::framework::LoDTensor const&, paddle::framework::LoDTensor*, int, int, bool, paddle::operators::math::PadLayout) + 611\r\n4       0x7f562069e2a5p paddle::operators::SequenceUnpadOpKernel<paddle::platform::CUDADeviceContext, float>::Compute(paddle::framework::ExecutionContext const&) const + 981\r\n5       0x7f562069e4a3p std::_Function_handler<void (paddle::framework::ExecutionContext const&), paddle::framework::OpKernelRegistrarFunctor<paddle::platform::CUDAPlace, false, 0ul, paddle::operators::SequenceUnpadOpKernel<paddle::platform::CUDADeviceContext, float>, paddle::operators::SequenceUnpadOpKernel<paddle::platform::CUDADeviceContext, double>, paddle::operators::SequenceUnpadOpKernel<paddle::platform::CUDADeviceContext, int>, paddle::operators::SequenceUnpadOpKernel<paddle::platform::CUDADeviceContext, long> >::operator()(char const*, char const*, int) const::{lambda(paddle::framework::ExecutionContext const&)#1}>::_M_invoke(std::_Any_data const&, paddle::framework::ExecutionContext const&) + 35\r\n6       0x7f56214fe6f6p paddle::framework::OperatorWithKernel::RunImpl(paddle::framework::Scope const&, boost::variant<paddle::platform::CUDAPlace, paddle::platform::CPUPlace, paddle::platform::CUDAPinnedPlace, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_> const&, paddle::framework::RuntimeContext*) const + 662\r\n7       0x7f56214fee64p paddle::framework::OperatorWithKernel::RunImpl(paddle::framework::Scope const&, boost::variant<paddle::platform::CUDAPlace, paddle::platform::CPUPlace, paddle::platform::CUDAPinnedPlace, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_> const&) const + 292\r\n8       0x7f56214fc78cp paddle::framework::OperatorBase::Run(paddle::framework::Scope const&, boost::variant<paddle::platform::CUDAPlace, paddle::platform::CPUPlace, paddle::platform::CUDAPinnedPlace, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_> const&) + 332\r\n9       0x7f561f9e18bep paddle::framework::Executor::RunPreparedContext(paddle::framework::ExecutorPrepareContext*, paddle::framework::Scope*, bool, bool, bool) + 382\r\n10      0x7f561f9e26ffp paddle::framework::Executor::Run(paddle::framework::ProgramDesc const&, paddle::framework::Scope*, int, bool, bool, std::vector<std::string, std::allocator<std::string> > const&, bool) + 143\r\n11      0x7f561f85c35ep\r\n12      0x7f561f89f72ep\r\n13      0x7f56836264e2p PyEval_EvalFrameEx + 29874\r\n14      0x7f56836287fdp PyEval_EvalCodeEx + 2061\r\n15      0x7f5683625982p PyEval_EvalFrameEx + 26962\r\n16      0x7f56836287fdp PyEval_EvalCodeEx + 2061\r\n17      0x7f5683625982p PyEval_EvalFrameEx + 26962\r\n18      0x7f5683625a9dp PyEval_EvalFrameEx + 27245\r\n19      0x7f56836287fdp PyEval_EvalCodeEx + 2061\r\n20      0x7f5683628932p PyEval_EvalCode + 50\r\n21      0x7f5683654882p PyRun_FileExFlags + 146\r\n22      0x7f5683655bf9p PyRun_SimpleFileExFlags + 217\r\n23      0x7f568366bb0dp Py_Main + 3149\r\n24        0x38bfc21b45p __libc_start_main + 245\r\n25            0x400691p\r\n请问这是某一个batch分配现存时的错误吗？reader里没有控制机制吗？\r\n\r\n另一种错误是\r\nLoad pretraining parameters from /home/X/tools/py367gcc48_paddle/ernie/model/params.\r\n*** Aborted at 1561361472 (unix time) try \"date -d @1561361472\" if you are using GNU date ***\r\nPC: @                0x0 (unknown)\r\n*** SIGFPE (@0x7ff61b501850) received by PID 14084 (TID 0x7ff67d886740) from PID 458233936; stack trace: ***\r\n    @       0x38c040f130 (unknown)\r\n    @     0x7ff61b501850 paddle::operators::math::UnpaddingLoDTensorFunctor<>::operator()()\r\n    @     0x7ff61a9e42a5 paddle::operators::SequenceUnpadOpKernel<>::Compute()\r\n    @     0x7ff61a9e44a3 _ZNSt17_Function_handlerIFvRKN6paddle9framework16ExecutionContextEEZNKS1_24OpKernelRegistrarFunctorINS0_8platform9CUDAPlaceELb0ELm0EINS0_9operators21SequenceUnpadOpKernelINS7_17CUDADeviceContextEfEENSA_ISB_dEENSA_ISB_iEENSA_ISB_lEEEEclEPKcSI_iEUlS4_E_E9_M_invokeERKSt9_Any_dataS4_\r\n    @     0x7ff61b8446f6 paddle::framework::OperatorWithKernel::RunImpl()\r\n    @     0x7ff61b844e64 paddle::framework::OperatorWithKernel::RunImpl()\r\n    @     0x7ff61b84278c paddle::framework::OperatorBase::Run()\r\n    @     0x7ff619d278be paddle::framework::Executor::RunPreparedContext()\r\n    @     0x7ff619d286ff paddle::framework::Executor::Run()\r\n    @     0x7ff619ba235e _ZZN8pybind1112cpp_function10initializeIZN6paddle6pybindL18pybind11_init_coreERNS_6moduleEEUlRNS2_9framework8ExecutorERKNS6_11ProgramDescEPNS6_5ScopeEibbRKSt6vectorISsSaISsEEE97_vIS8_SB_SD_ibbSI_EINS_4nameENS_9is_methodENS_7siblingEEEEvOT_PFT0_DpT1_EDpRKT2_ENUlRNS_6detail13function_callEE1_4_FUNES10_\r\n    @     0x7ff619be572e pybind11::cpp_function::dispatcher()\r\n    @     0x7ff67d9ac4e2 PyEval_EvalFrameEx\r\n    @     0x7ff67d9ae7fd PyEval_EvalCodeEx\r\n    @     0x7ff67d9ab982 PyEval_EvalFrameEx\r\n    @     0x7ff67d9ae7fd PyEval_EvalCodeEx\r\n    @     0x7ff67d9ab982 PyEval_EvalFrameEx\r\n    @     0x7ff67d9aba9d PyEval_EvalFrameEx\r\n    @     0x7ff67d9ae7fd PyEval_EvalCodeEx\r\n    @     0x7ff67d9ae932 PyEval_EvalCode\r\n    @     0x7ff67d9da882 PyRun_FileExFlags\r\n    @     0x7ff67d9dbbf9 PyRun_SimpleFileExFlags\r\n    @     0x7ff67d9f1b0d Py_Main\r\n    @       0x38bfc21b45 (unknown)\r\n    @           0x400691 (unknown)\r\n    @                0x0 (unknown)\r\n\r\n相同环境和代码测试多遍（未shuffle），发现出错时两个错误都可能出现，没有什么规律","closed_by":{"login":"tianxin1860","id":6829601,"node_id":"MDQ6VXNlcjY4Mjk2MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6829601?v=4","gravatar_id":"","url":"https://api.github.com/users/tianxin1860","html_url":"https://github.com/tianxin1860","followers_url":"https://api.github.com/users/tianxin1860/followers","following_url":"https://api.github.com/users/tianxin1860/following{/other_user}","gists_url":"https://api.github.com/users/tianxin1860/gists{/gist_id}","starred_url":"https://api.github.com/users/tianxin1860/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tianxin1860/subscriptions","organizations_url":"https://api.github.com/users/tianxin1860/orgs","repos_url":"https://api.github.com/users/tianxin1860/repos","events_url":"https://api.github.com/users/tianxin1860/events{/privacy}","received_events_url":"https://api.github.com/users/tianxin1860/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/177/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/177/timeline","performed_via_github_app":null,"state_reason":"completed"}