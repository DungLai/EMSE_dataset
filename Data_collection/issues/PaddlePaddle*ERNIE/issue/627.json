{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/627","repository_url":"https://api.github.com/repos/PaddlePaddle/ERNIE","labels_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/627/labels{/name}","comments_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/627/comments","events_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/627/events","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/627","id":798915768,"node_id":"MDU6SXNzdWU3OTg5MTU3Njg=","number":627,"title":"请问ERNIE-GEN的评价代码中为什么要去掉预测文件中「单词数小于4的句子」呢？","user":{"login":"daizh","id":15260093,"node_id":"MDQ6VXNlcjE1MjYwMDkz","avatar_url":"https://avatars.githubusercontent.com/u/15260093?v=4","gravatar_id":"","url":"https://api.github.com/users/daizh","html_url":"https://github.com/daizh","followers_url":"https://api.github.com/users/daizh/followers","following_url":"https://api.github.com/users/daizh/following{/other_user}","gists_url":"https://api.github.com/users/daizh/gists{/gist_id}","starred_url":"https://api.github.com/users/daizh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daizh/subscriptions","organizations_url":"https://api.github.com/users/daizh/orgs","repos_url":"https://api.github.com/users/daizh/repos","events_url":"https://api.github.com/users/daizh/events{/privacy}","received_events_url":"https://api.github.com/users/daizh/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-02-02T04:27:11Z","updated_at":"2021-02-02T05:56:52Z","closed_at":"2021-02-02T05:56:52Z","author_association":"NONE","active_lock_reason":null,"body":"您好，我看到在`eval/tasks/cnndm/cnndm/eval.py:254`的评价代码中，会把预测文件中「单词数小于4的句子」去掉。\r\n\r\n这样去掉句子会导致rouge结果下降吧？请问为什么要这么做呢？\r\n\r\n十分感谢！\r\n\r\n```\r\ndef process_eval(eval_fn):\r\n....\r\n    pred_list = []\r\n    with open(eval_fn, \"r\") as f_in:\r\n        for l in f_in:\r\n            buf = []\r\n            for sentence in l.strip().split(\"[X_SEP]\"):\r\n                sentence = fix_tokenization(sentence)\r\n                if any(get_f1(sentence, s) > 1.0 for s in buf):\r\n                    continue\r\n                s_len = len(sentence.split())\r\n                if s_len <= 4:     # 去掉单词数小于4的句子？\r\n                    continue\r\n                buf.append(sentence)\r\n            if args.duplicate_rate and args.duplicate_rate < 1:\r\n                buf = remove_duplicate(buf, args.duplicate_rate)\r\n            if args.trunc_len:\r\n                num_left = args.trunc_len\r\n                trunc_list = []\r\n                for bit in buf:\r\n                    tk_list = bit.split()\r\n                    n = min(len(tk_list), num_left)\r\n                    trunc_list.append(' '.join(tk_list[:n]))\r\n                    num_left -= n\r\n                    if num_left <= 0:\r\n                        break\r\n            else:\r\n                trunc_list = buf\r\n            line = \"\\n\".join(trunc_list)\r\n            pred_list.append(line)\r\n    with open(eval_fn+'.post', 'w') as f_out:\r\n        for l in pred_list:\r\n            f_out.write(l.replace('\\n', ' [X_SEP] ').strip())\r\n            f_out.write('\\n')\r\n\r\n```","closed_by":{"login":"zhanghan1992","id":40751364,"node_id":"MDQ6VXNlcjQwNzUxMzY0","avatar_url":"https://avatars.githubusercontent.com/u/40751364?v=4","gravatar_id":"","url":"https://api.github.com/users/zhanghan1992","html_url":"https://github.com/zhanghan1992","followers_url":"https://api.github.com/users/zhanghan1992/followers","following_url":"https://api.github.com/users/zhanghan1992/following{/other_user}","gists_url":"https://api.github.com/users/zhanghan1992/gists{/gist_id}","starred_url":"https://api.github.com/users/zhanghan1992/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhanghan1992/subscriptions","organizations_url":"https://api.github.com/users/zhanghan1992/orgs","repos_url":"https://api.github.com/users/zhanghan1992/repos","events_url":"https://api.github.com/users/zhanghan1992/events{/privacy}","received_events_url":"https://api.github.com/users/zhanghan1992/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/627/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/627/timeline","performed_via_github_app":null,"state_reason":"completed"}