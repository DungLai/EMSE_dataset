{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/479","repository_url":"https://api.github.com/repos/PaddlePaddle/ERNIE","labels_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/479/labels{/name}","comments_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/479/comments","events_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/479/events","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/479","id":627980418,"node_id":"MDU6SXNzdWU2Mjc5ODA0MTg=","number":479,"title":"ResourceExhaustedError：Out of memory error on GPU 0.","user":{"login":"Firework471","id":30025892,"node_id":"MDQ6VXNlcjMwMDI1ODky","avatar_url":"https://avatars.githubusercontent.com/u/30025892?v=4","gravatar_id":"","url":"https://api.github.com/users/Firework471","html_url":"https://github.com/Firework471","followers_url":"https://api.github.com/users/Firework471/followers","following_url":"https://api.github.com/users/Firework471/following{/other_user}","gists_url":"https://api.github.com/users/Firework471/gists{/gist_id}","starred_url":"https://api.github.com/users/Firework471/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Firework471/subscriptions","organizations_url":"https://api.github.com/users/Firework471/orgs","repos_url":"https://api.github.com/users/Firework471/repos","events_url":"https://api.github.com/users/Firework471/events{/privacy}","received_events_url":"https://api.github.com/users/Firework471/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2020-05-31T15:01:05Z","updated_at":"2020-06-04T07:38:16Z","closed_at":"2020-06-04T07:38:16Z","author_association":"NONE","active_lock_reason":null,"body":"错误信息：\r\nRuntimeError: \r\n\r\n--------------------------------------------\r\nC++ Call Stacks (More useful to developers):\r\n--------------------------------------------\r\nWindows not support stack backtrace yet.\r\n\r\n----------------------\r\nError Message Summary:\r\n----------------------\r\nResourceExhaustedError: \r\n\r\nOut of memory error on GPU 0. Cannot allocate 25.000244MB memory on GPU 0, available memory is only 2.349999MB.\r\n\r\nPlease check whether there is any other process using GPU 0.\r\n1. If yes, please stop them, or start PaddlePaddle on another GPU.\r\n2. If no, please try one of the following suggestions:\r\n   1) Decrease the batch size of your model.\r\n   2) FLAGS_fraction_of_gpu_memory_to_use is 0.50 now, please set it to a higher value but less than 1.0.\r\n      The command is `export FLAGS_fraction_of_gpu_memory_to_use=xxx`.\r\n\r\n at (D:\\1.7.1\\paddle\\paddle\\fluid\\memory\\detail\\system_allocator.cc:150)\r\n\r\n\r\n部分代码（基本是按照教程写的）：\r\n    for j in range(len(train_data) // BATCH):\r\n        feature, label = get_batch_data(train_data, j)\r\n        loss, _ = ernie(feature, labels=label) # ernie模型的返回值包含(loss, logits)；其中logits目前暂时不需要使用\r\n        loss.backward()\r\n        optimizer.minimize(loss)\r\n        ernie.clear_gradients()\r\n        if j % 10 == 0:\r\n            print('train %d: loss %.5f' % (j, loss.numpy()))\r\n        # evaluate\r\n        if j % 100 == 0:\r\n            all_pred, all_label = [], []\r\n            with D.base._switch_tracer_mode_guard_(is_train=False): # 在这个with域内ernie不会进行梯度计算；\r\n                ernie.eval() # 控制模型进入eval模式，这将会关闭所有的dropout；\r\n                for j in range(len(test_data) // BATCH):\r\n                    feature, label = get_batch_data(test_data, j)\r\n                    loss, logits = ernie(feature, labels=label)\r\n                    all_pred.extend(L.argmax(logits, -1).numpy())\r\n                    all_label.extend(label.numpy())\r\n                ernie.train()\r\n            f1 = f1_score(all_label, all_pred, average='macro')\r\n            acc = (np.array(all_label) == np.array(all_pred)).astype(np.float32).mean()\r\n            print('acc %.5f' % acc)\r\n调试的啥时候出错的地方是loss, _ = ernie(feature, labels=label) 这一行\r\n在代码前面加了\r\nos.environ['FLAGS_fraction_of_gpu_memory_to_use'] = \"0.9\"\r\nos.environ[\"FLAGS_eager_delete_tensor_gb\"] = \"0\"\r\n并且把batch调成1依然还是出现同样的错误，希望各位大佬不吝赐教，感激感激！","closed_by":{"login":"Firework471","id":30025892,"node_id":"MDQ6VXNlcjMwMDI1ODky","avatar_url":"https://avatars.githubusercontent.com/u/30025892?v=4","gravatar_id":"","url":"https://api.github.com/users/Firework471","html_url":"https://github.com/Firework471","followers_url":"https://api.github.com/users/Firework471/followers","following_url":"https://api.github.com/users/Firework471/following{/other_user}","gists_url":"https://api.github.com/users/Firework471/gists{/gist_id}","starred_url":"https://api.github.com/users/Firework471/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Firework471/subscriptions","organizations_url":"https://api.github.com/users/Firework471/orgs","repos_url":"https://api.github.com/users/Firework471/repos","events_url":"https://api.github.com/users/Firework471/events{/privacy}","received_events_url":"https://api.github.com/users/Firework471/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/479/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/479/timeline","performed_via_github_app":null,"state_reason":"completed"}