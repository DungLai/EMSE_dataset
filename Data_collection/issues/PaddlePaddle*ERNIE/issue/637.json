{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/637","repository_url":"https://api.github.com/repos/PaddlePaddle/ERNIE","labels_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/637/labels{/name}","comments_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/637/comments","events_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/637/events","html_url":"https://github.com/PaddlePaddle/ERNIE/issues/637","id":833349567,"node_id":"MDU6SXNzdWU4MzMzNDk1Njc=","number":637,"title":"Paddle-Inference-Demo  ernie-varlen 运行报错 TensorRT's tensor input requires at least 2 dimensions, but input read_file_0.tmp_0 has 1 dims.","user":{"login":"ustcdane","id":3815859,"node_id":"MDQ6VXNlcjM4MTU4NTk=","avatar_url":"https://avatars.githubusercontent.com/u/3815859?v=4","gravatar_id":"","url":"https://api.github.com/users/ustcdane","html_url":"https://github.com/ustcdane","followers_url":"https://api.github.com/users/ustcdane/followers","following_url":"https://api.github.com/users/ustcdane/following{/other_user}","gists_url":"https://api.github.com/users/ustcdane/gists{/gist_id}","starred_url":"https://api.github.com/users/ustcdane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ustcdane/subscriptions","organizations_url":"https://api.github.com/users/ustcdane/orgs","repos_url":"https://api.github.com/users/ustcdane/repos","events_url":"https://api.github.com/users/ustcdane/events{/privacy}","received_events_url":"https://api.github.com/users/ustcdane/received_events","type":"User","site_admin":false},"labels":[{"id":1256169225,"node_id":"MDU6TGFiZWwxMjU2MTY5MjI1","url":"https://api.github.com/repos/PaddlePaddle/ERNIE/labels/wontfix","name":"wontfix","color":"ffffff","default":true,"description":"This will not be worked on"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2021-03-17T02:47:45Z","updated_at":"2021-05-28T07:39:41Z","closed_at":"2021-05-28T07:39:41Z","author_association":"NONE","active_lock_reason":null,"body":"运行 demo  ernie-varlen \r\nhttps://github.com/PaddlePaddle/Paddle-Inference-Demo/tree/master/c%2B%2B/ernie-varlen\r\n\r\nLinux环境：\r\nCentOS Linux release 7.4.1708 (Core) \r\nLinux version 3.10.0-693.el7.x86_64 (builder@kbuilder.dev.centos.org) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC) ) #1 SMP Tue Aug 22 21:09:27 UTC 2017\r\n\r\n前向库：\r\nhttps://paddle-inference-lib.bj.bcebos.com/2.0.0-rc0-gpu-cuda10-cudnn7-avx-mkl/paddle_inference.tgz\r\n模型：\r\ndemo页面自带的 ernie_model_4.tar.gz\r\nTR:\r\nTensorRT-6.0.1.5.CentOS-7.6.x86_64-gnu.cuda-10.0.cudnn7.6.tar.gz\r\n编译通过，运行模型出现如下错误：\r\n\r\n./build/ernie_varlen_test --model_dir=./ernie_model_4\r\n\r\n报错：\r\n\r\n> I0316 20:46:29.055225 163963 tensorrt_subgraph_pass.cc:118] ---  detect a sub-graph with 81 nodes\r\n\r\nW0316 20:46:29.058228 163963 tensorrt_subgraph_pass.cc:293] The Paddle lib links the 6015 version TensorRT, make sure the runtime TensorRT you are using is no less than this version, otherwise, there might be Segfault!\r\nI0316 20:46:29.058288 163963 tensorrt_subgraph_pass.cc:329] Prepare TRT engine (Optimize model structure, Select OP kernel etc). This process may cost a lot of time.\r\nI0316 20:46:29.536973 163963 op_converter.h:187] trt input [matmul_0.tmp_0] dynamic shape info not set, please check and retry.\r\nterminate called after throwing an instance of 'paddle::platform::EnforceNotMet'\r\n  what():  \r\n\r\n>   --------------------------------------\r\n> C++ Traceback (most recent call last):\r\n>   --------------------------------------\r\n0   paddle_infer::CreatePredictor(paddle::AnalysisConfig const&)\r\n1   paddle_infer::Predictor::Predictor(paddle::AnalysisConfig const&)\r\n2   std::unique_ptr<paddle::PaddlePredictor, std::default_delete<paddle::PaddlePredictor> > paddle::CreatePaddlePredictor<paddle::AnalysisConfig, (paddle::PaddleEngineKind)2>(paddle::AnalysisConfig const&)\r\n3   paddle::AnalysisPredictor::Init(std::shared_ptr<paddle::framework::Scope> const&, std::shared_ptr<paddle::framework::ProgramDesc> const&)\r\n4   paddle::AnalysisPredictor::PrepareProgram(std::shared_ptr<paddle::framework::ProgramDesc> const&)\r\n5   paddle::AnalysisPredictor::OptimizeInferenceProgram()\r\n6   paddle::inference::analysis::Analyzer::RunAnalysis(paddle::inference::analysis::Argument*)\r\n7   paddle::inference::analysis::IrAnalysisPass::RunImpl(paddle::inference::analysis::Argument*)\r\n8   paddle::inference::analysis::IRPassManager::Apply(std::unique_ptr<paddle::framework::ir::Graph, std::default_delete<paddle::framework::ir::Graph> >)\r\n9   paddle::framework::ir::Pass::Apply(paddle::framework::ir::Graph*) const\r\n10  paddle::inference::analysis::TensorRtSubgraphPass::ApplyImpl(paddle::framework::ir::Graph*) const\r\n11  paddle::inference::analysis::TensorRtSubgraphPass::CreateTensorRTOp(paddle::framework::ir::Node*, paddle::framework::ir::Graph*, std::vector<std::string, std::allocator<std::string> > const&, std::vector<std::string, std::allocator<std::string> >*) const\r\n12  paddle::inference::tensorrt::OpConverter::ConvertBlockToTRTEngine(paddle::framework::BlockDesc*, paddle::framework::Scope const&, std::vector<std::string, std::allocator<std::string> > const&, std::unordered_set<std::string, std::hash<std::string>, std::equal_to<std::string>, std::allocator<std::string> > const&, std::vector<std::string, std::allocator<std::string> > const&, paddle::inference::tensorrt::TensorRTEngine*)\r\n13  paddle::platform::EnforceNotMet::EnforceNotMet(std::string const&, char const*, int)\r\n14  paddle::platform::GetCurrentTraceBackString()\r\n> ----------------------\r\n> Error Message Summary:\r\n> ----------------------\r\n> InvalidArgumentError: TensorRT's tensor input requires at least 2 dimensions, but input read_file_0.tmp_0 has 1 dims.\r\n  [Hint: Expected shape.size() > 1UL, but received shape.size():1 <= 1UL:1.] (at /paddle/paddle/fluid/inference/tensorrt/engine.h:78)\r\n","closed_by":{"login":"stale[bot]","id":26384082,"node_id":"MDM6Qm90MjYzODQwODI=","avatar_url":"https://avatars.githubusercontent.com/in/1724?v=4","gravatar_id":"","url":"https://api.github.com/users/stale%5Bbot%5D","html_url":"https://github.com/apps/stale","followers_url":"https://api.github.com/users/stale%5Bbot%5D/followers","following_url":"https://api.github.com/users/stale%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stale%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/stale%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/stale%5Bbot%5D/repos","events_url":"https://api.github.com/users/stale%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/stale%5Bbot%5D/received_events","type":"Bot","site_admin":false},"reactions":{"url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/637/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/PaddlePaddle/ERNIE/issues/637/timeline","performed_via_github_app":null,"state_reason":"completed"}