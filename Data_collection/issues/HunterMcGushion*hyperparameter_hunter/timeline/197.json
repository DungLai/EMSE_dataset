[{"url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/comments/532991917","html_url":"https://github.com/HunterMcGushion/hyperparameter_hunter/issues/197#issuecomment-532991917","issue_url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/197","id":532991917,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjk5MTkxNw==","user":{"login":"HunterMcGushion","id":11300915,"node_id":"MDQ6VXNlcjExMzAwOTE1","avatar_url":"https://avatars.githubusercontent.com/u/11300915?v=4","gravatar_id":"","url":"https://api.github.com/users/HunterMcGushion","html_url":"https://github.com/HunterMcGushion","followers_url":"https://api.github.com/users/HunterMcGushion/followers","following_url":"https://api.github.com/users/HunterMcGushion/following{/other_user}","gists_url":"https://api.github.com/users/HunterMcGushion/gists{/gist_id}","starred_url":"https://api.github.com/users/HunterMcGushion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HunterMcGushion/subscriptions","organizations_url":"https://api.github.com/users/HunterMcGushion/orgs","repos_url":"https://api.github.com/users/HunterMcGushion/repos","events_url":"https://api.github.com/users/HunterMcGushion/events{/privacy}","received_events_url":"https://api.github.com/users/HunterMcGushion/received_events","type":"User","site_admin":false},"created_at":"2019-09-19T06:46:14Z","updated_at":"2019-09-19T06:49:14Z","author_association":"OWNER","body":"Thanks for opening this! Sorry I don't have a more helpful update, but I just wanted to say that I'm looking into this, and I do think there's a bug here. I'm making some regression tests using the Iris dataset, with a single label-encoded target column, so I'll probably ask you to try to reproduce some of my results when I'm further along in the bug hunt. \r\n\r\nIn the meantime, have you tried adjusting the `do_predict_proba` kwarg of your `Environment`? Are you expecting `log_loss` to be called with a single column of label-encoded predictions, or four columns of class probabilities? Because I believe the former won't work, as `log_loss` automatically assumes a 1-dimensional `y_pred` to be binary...\r\n\r\nLike I said, I need to investigate some more, but I'd really appreciate you commenting any of your findings here!\r\n\r\n*Edit: Thanks for looking for related issues, as well!*","reactions":{"url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/comments/532991917/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HunterMcGushion","id":11300915,"node_id":"MDQ6VXNlcjExMzAwOTE1","avatar_url":"https://avatars.githubusercontent.com/u/11300915?v=4","gravatar_id":"","url":"https://api.github.com/users/HunterMcGushion","html_url":"https://github.com/HunterMcGushion","followers_url":"https://api.github.com/users/HunterMcGushion/followers","following_url":"https://api.github.com/users/HunterMcGushion/following{/other_user}","gists_url":"https://api.github.com/users/HunterMcGushion/gists{/gist_id}","starred_url":"https://api.github.com/users/HunterMcGushion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HunterMcGushion/subscriptions","organizations_url":"https://api.github.com/users/HunterMcGushion/orgs","repos_url":"https://api.github.com/users/HunterMcGushion/repos","events_url":"https://api.github.com/users/HunterMcGushion/events{/privacy}","received_events_url":"https://api.github.com/users/HunterMcGushion/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/comments/533011228","html_url":"https://github.com/HunterMcGushion/hyperparameter_hunter/issues/197#issuecomment-533011228","issue_url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/197","id":533011228,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMzAxMTIyOA==","user":{"login":"chwang1991","id":39996696,"node_id":"MDQ6VXNlcjM5OTk2Njk2","avatar_url":"https://avatars.githubusercontent.com/u/39996696?v=4","gravatar_id":"","url":"https://api.github.com/users/chwang1991","html_url":"https://github.com/chwang1991","followers_url":"https://api.github.com/users/chwang1991/followers","following_url":"https://api.github.com/users/chwang1991/following{/other_user}","gists_url":"https://api.github.com/users/chwang1991/gists{/gist_id}","starred_url":"https://api.github.com/users/chwang1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chwang1991/subscriptions","organizations_url":"https://api.github.com/users/chwang1991/orgs","repos_url":"https://api.github.com/users/chwang1991/repos","events_url":"https://api.github.com/users/chwang1991/events{/privacy}","received_events_url":"https://api.github.com/users/chwang1991/received_events","type":"User","site_admin":false},"created_at":"2019-09-19T07:47:44Z","updated_at":"2019-09-19T07:47:44Z","author_association":"NONE","body":"Thanks for your quick reply!\r\n\r\nSure I tried setting `do_predict_proba=True` but it didn't help. Seems that it refused to accept multi-column predicts for some reason.\r\n\r\nI have to say `log_loss` is a bit special 'cause it requires `(n_samples,n_classes)` y_pred, while other examples you tested before, I guess, forced the input `y_pred` to be 1 column.\r\n\r\nHere is the code I used to test:\r\n```\r\nimport numpy as np\r\nimport pandas as pd\r\nfrom sklearn.datasets import make_classification\r\nfrom sklearn.ensemble import RandomForestClassifier\r\nfrom sklearn import metrics\r\nfrom hyperparameter_hunter import Environment, CVExperiment, BayesianOptPro\r\n\r\n# make a toy dataset\r\nx,y = make_classification(n_samples=1000,n_classes=4,n_informative=10)\r\ntrain_df = pd.DataFrame(x, columns=range(x.shape[1]))\r\ntrain_df[\"y\"] = y\r\n\r\n'''\r\nTEST 1\r\nmetrics=[\"log_loss\"]\r\ndo_predict_proba=False\r\n\r\nValueError: y_true and y_pred contain different number of classes 4, 2. \r\nPlease provide the true labels explicitly through the labels argument. Classes found in y_true: [0 1 2 3]\r\n'''\r\nenv1 = Environment(\r\n    train_dataset=train_df,\r\n    results_path=\"HyperparameterHunterAssets\",\r\n    target_column=\"y\",\r\n    metrics=[\"log_loss\"],\r\n    do_predict_proba=False,\r\n    cv_type=\"StratifiedKFold\",\r\n    cv_params=dict(n_splits=5, random_state=32),\r\n    verbose=1,\r\n)\r\n\r\n'''\r\nTEST 2\r\nmetrics=dict(logloss=lambda y_true, y_pred: metrics.log_loss(y_true, y_pred, labels=[0,1,2,3]))\r\ndo_predict_proba=False\r\n\r\nValueError: The number of classes in labels is different from that in y_pred. \r\nClasses found in labels: [0 1 2 3]\r\n'''\r\nenv2 = Environment(\r\n    train_dataset=train_df,\r\n    results_path=\"HyperparameterHunterAssets\",\r\n    target_column=\"y\",\r\n    metrics=dict(logloss=lambda y_true, y_pred: metrics.log_loss(y_true, y_pred, labels=[0,1,2,3])),\r\n    do_predict_proba=False,\r\n    cv_type=\"StratifiedKFold\",\r\n    cv_params=dict(n_splits=5, random_state=32),\r\n    verbose=1,\r\n)\r\n\r\n'''\r\nTEST 3\r\nmetrics=[\"log_loss\"]\r\ndo_predict_proba=True\r\n\r\nValueError: Wrong number of items passed 4, placement implies 1\r\n'''\r\nenv3 = Environment(\r\n    train_dataset=train_df,\r\n    results_path=\"HyperparameterHunterAssets\",\r\n    target_column=\"y\",\r\n    metrics=[\"log_loss\"],\r\n    do_predict_proba=True,\r\n    cv_type=\"StratifiedKFold\",\r\n    cv_params=dict(n_splits=5, random_state=32),\r\n    verbose=1,\r\n)\r\n\r\n'''\r\nTEST 4\r\nmetrics=dict(logloss=lambda y_true, y_pred: metrics.log_loss(y_true, y_pred, labels=[0,1,2,3]))\r\ndo_predict_proba=True\r\n\r\nValueError: Wrong number of items passed 4, placement implies 1\r\n'''\r\nenv4 = Environment(\r\n    train_dataset=train_df,\r\n    results_path=\"HyperparameterHunterAssets\",\r\n    target_column=\"y\",\r\n    metrics=dict(logloss=lambda y_true, y_pred: metrics.log_loss(y_true, y_pred, labels=[0,1,2,3])),\r\n    do_predict_proba=True,\r\n    cv_type=\"StratifiedKFold\",\r\n    cv_params=dict(n_splits=5, random_state=32),\r\n    verbose=1,\r\n)\r\n\r\n\r\nexperiment = CVExperiment(\r\n    model_initializer=RandomForestClassifier,\r\n    model_init_params=dict(n_estimators=10),\r\n)\r\n```","reactions":{"url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/comments/533011228/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"chwang1991","id":39996696,"node_id":"MDQ6VXNlcjM5OTk2Njk2","avatar_url":"https://avatars.githubusercontent.com/u/39996696?v=4","gravatar_id":"","url":"https://api.github.com/users/chwang1991","html_url":"https://github.com/chwang1991","followers_url":"https://api.github.com/users/chwang1991/followers","following_url":"https://api.github.com/users/chwang1991/following{/other_user}","gists_url":"https://api.github.com/users/chwang1991/gists{/gist_id}","starred_url":"https://api.github.com/users/chwang1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chwang1991/subscriptions","organizations_url":"https://api.github.com/users/chwang1991/orgs","repos_url":"https://api.github.com/users/chwang1991/repos","events_url":"https://api.github.com/users/chwang1991/events{/privacy}","received_events_url":"https://api.github.com/users/chwang1991/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/comments/534739023","html_url":"https://github.com/HunterMcGushion/hyperparameter_hunter/issues/197#issuecomment-534739023","issue_url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/197","id":534739023,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNDczOTAyMw==","user":{"login":"HunterMcGushion","id":11300915,"node_id":"MDQ6VXNlcjExMzAwOTE1","avatar_url":"https://avatars.githubusercontent.com/u/11300915?v=4","gravatar_id":"","url":"https://api.github.com/users/HunterMcGushion","html_url":"https://github.com/HunterMcGushion","followers_url":"https://api.github.com/users/HunterMcGushion/followers","following_url":"https://api.github.com/users/HunterMcGushion/following{/other_user}","gists_url":"https://api.github.com/users/HunterMcGushion/gists{/gist_id}","starred_url":"https://api.github.com/users/HunterMcGushion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HunterMcGushion/subscriptions","organizations_url":"https://api.github.com/users/HunterMcGushion/orgs","repos_url":"https://api.github.com/users/HunterMcGushion/repos","events_url":"https://api.github.com/users/HunterMcGushion/events{/privacy}","received_events_url":"https://api.github.com/users/HunterMcGushion/received_events","type":"User","site_admin":false},"created_at":"2019-09-24T20:41:19Z","updated_at":"2019-09-24T20:41:19Z","author_association":"OWNER","body":"@chwang1991,\r\n\r\nThanks for posting your sample code! It's very helpful! Sorry for the delay, but I've been busy with other things lately. I'm looking at this issue again today, and I have to agree with you `log_loss` does seem rather weird. Although I may just be thinking that because I haven't done too much experimentation with other metrics. \r\n\r\nDo you know of any other metrics that behave similarly or might cause other problems?\r\nAlso, do you think that another `Environment` kwarg might be necessary to clear up behavior in situations like this? `do_predict_proba` seems like half of the solution... But I'm thinking we need one kwarg to declare how predictions should be passed to metrics, then a second to declare how predictions should be saved in a situation like this. I'd love to hear your thoughts!\r\n","reactions":{"url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/comments/534739023/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HunterMcGushion","id":11300915,"node_id":"MDQ6VXNlcjExMzAwOTE1","avatar_url":"https://avatars.githubusercontent.com/u/11300915?v=4","gravatar_id":"","url":"https://api.github.com/users/HunterMcGushion","html_url":"https://github.com/HunterMcGushion","followers_url":"https://api.github.com/users/HunterMcGushion/followers","following_url":"https://api.github.com/users/HunterMcGushion/following{/other_user}","gists_url":"https://api.github.com/users/HunterMcGushion/gists{/gist_id}","starred_url":"https://api.github.com/users/HunterMcGushion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HunterMcGushion/subscriptions","organizations_url":"https://api.github.com/users/HunterMcGushion/orgs","repos_url":"https://api.github.com/users/HunterMcGushion/repos","events_url":"https://api.github.com/users/HunterMcGushion/events{/privacy}","received_events_url":"https://api.github.com/users/HunterMcGushion/received_events","type":"User","site_admin":false}},{"id":2659478155,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjY1OTQ3ODE1NQ==","url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/events/2659478155","actor":{"login":"chwang1991","id":39996696,"node_id":"MDQ6VXNlcjM5OTk2Njk2","avatar_url":"https://avatars.githubusercontent.com/u/39996696?v=4","gravatar_id":"","url":"https://api.github.com/users/chwang1991","html_url":"https://github.com/chwang1991","followers_url":"https://api.github.com/users/chwang1991/followers","following_url":"https://api.github.com/users/chwang1991/following{/other_user}","gists_url":"https://api.github.com/users/chwang1991/gists{/gist_id}","starred_url":"https://api.github.com/users/chwang1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chwang1991/subscriptions","organizations_url":"https://api.github.com/users/chwang1991/orgs","repos_url":"https://api.github.com/users/chwang1991/repos","events_url":"https://api.github.com/users/chwang1991/events{/privacy}","received_events_url":"https://api.github.com/users/chwang1991/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-09-24T20:41:19Z","performed_via_github_app":null},{"id":2659478156,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI2NTk0NzgxNTY=","url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/events/2659478156","actor":{"login":"chwang1991","id":39996696,"node_id":"MDQ6VXNlcjM5OTk2Njk2","avatar_url":"https://avatars.githubusercontent.com/u/39996696?v=4","gravatar_id":"","url":"https://api.github.com/users/chwang1991","html_url":"https://github.com/chwang1991","followers_url":"https://api.github.com/users/chwang1991/followers","following_url":"https://api.github.com/users/chwang1991/following{/other_user}","gists_url":"https://api.github.com/users/chwang1991/gists{/gist_id}","starred_url":"https://api.github.com/users/chwang1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chwang1991/subscriptions","organizations_url":"https://api.github.com/users/chwang1991/orgs","repos_url":"https://api.github.com/users/chwang1991/repos","events_url":"https://api.github.com/users/chwang1991/events{/privacy}","received_events_url":"https://api.github.com/users/chwang1991/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-09-24T20:41:19Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/comments/536419527","html_url":"https://github.com/HunterMcGushion/hyperparameter_hunter/issues/197#issuecomment-536419527","issue_url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/197","id":536419527,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNjQxOTUyNw==","user":{"login":"chwang1991","id":39996696,"node_id":"MDQ6VXNlcjM5OTk2Njk2","avatar_url":"https://avatars.githubusercontent.com/u/39996696?v=4","gravatar_id":"","url":"https://api.github.com/users/chwang1991","html_url":"https://github.com/chwang1991","followers_url":"https://api.github.com/users/chwang1991/followers","following_url":"https://api.github.com/users/chwang1991/following{/other_user}","gists_url":"https://api.github.com/users/chwang1991/gists{/gist_id}","starred_url":"https://api.github.com/users/chwang1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chwang1991/subscriptions","organizations_url":"https://api.github.com/users/chwang1991/orgs","repos_url":"https://api.github.com/users/chwang1991/repos","events_url":"https://api.github.com/users/chwang1991/events{/privacy}","received_events_url":"https://api.github.com/users/chwang1991/received_events","type":"User","site_admin":false},"created_at":"2019-09-30T06:23:43Z","updated_at":"2019-09-30T06:23:43Z","author_association":"NONE","body":"@HunterMcGushion \r\n\r\nSorry for my late reply, bit busy these days...\r\n\r\nI think there are only two metrics that accept multi-column predicted probabilities: `log_loss` and `hinge_loss`. I think `do_predict_proba` is enough, as you already indicated in the document:\r\n\r\n> If True, it will call models.Model.model.predict_proba(), and the values in all columns will be used as the actual prediction values\r\n\r\nI know in most cases there is no need to take `proba` into consideration, even `logloss` is mostly applied as loss function rather than metric, but in my recent case I have to evaluate how much \"confidence\" the model has in the results so I can improve it.","reactions":{"url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/comments/536419527/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"chwang1991","id":39996696,"node_id":"MDQ6VXNlcjM5OTk2Njk2","avatar_url":"https://avatars.githubusercontent.com/u/39996696?v=4","gravatar_id":"","url":"https://api.github.com/users/chwang1991","html_url":"https://github.com/chwang1991","followers_url":"https://api.github.com/users/chwang1991/followers","following_url":"https://api.github.com/users/chwang1991/following{/other_user}","gists_url":"https://api.github.com/users/chwang1991/gists{/gist_id}","starred_url":"https://api.github.com/users/chwang1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chwang1991/subscriptions","organizations_url":"https://api.github.com/users/chwang1991/orgs","repos_url":"https://api.github.com/users/chwang1991/repos","events_url":"https://api.github.com/users/chwang1991/events{/privacy}","received_events_url":"https://api.github.com/users/chwang1991/received_events","type":"User","site_admin":false}},{"id":2672029253,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjY3MjAyOTI1Mw==","url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/events/2672029253","actor":{"login":"HunterMcGushion","id":11300915,"node_id":"MDQ6VXNlcjExMzAwOTE1","avatar_url":"https://avatars.githubusercontent.com/u/11300915?v=4","gravatar_id":"","url":"https://api.github.com/users/HunterMcGushion","html_url":"https://github.com/HunterMcGushion","followers_url":"https://api.github.com/users/HunterMcGushion/followers","following_url":"https://api.github.com/users/HunterMcGushion/following{/other_user}","gists_url":"https://api.github.com/users/HunterMcGushion/gists{/gist_id}","starred_url":"https://api.github.com/users/HunterMcGushion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HunterMcGushion/subscriptions","organizations_url":"https://api.github.com/users/HunterMcGushion/orgs","repos_url":"https://api.github.com/users/HunterMcGushion/repos","events_url":"https://api.github.com/users/HunterMcGushion/events{/privacy}","received_events_url":"https://api.github.com/users/HunterMcGushion/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-09-30T06:23:43Z","performed_via_github_app":null},{"id":2672029254,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI2NzIwMjkyNTQ=","url":"https://api.github.com/repos/HunterMcGushion/hyperparameter_hunter/issues/events/2672029254","actor":{"login":"HunterMcGushion","id":11300915,"node_id":"MDQ6VXNlcjExMzAwOTE1","avatar_url":"https://avatars.githubusercontent.com/u/11300915?v=4","gravatar_id":"","url":"https://api.github.com/users/HunterMcGushion","html_url":"https://github.com/HunterMcGushion","followers_url":"https://api.github.com/users/HunterMcGushion/followers","following_url":"https://api.github.com/users/HunterMcGushion/following{/other_user}","gists_url":"https://api.github.com/users/HunterMcGushion/gists{/gist_id}","starred_url":"https://api.github.com/users/HunterMcGushion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HunterMcGushion/subscriptions","organizations_url":"https://api.github.com/users/HunterMcGushion/orgs","repos_url":"https://api.github.com/users/HunterMcGushion/repos","events_url":"https://api.github.com/users/HunterMcGushion/events{/privacy}","received_events_url":"https://api.github.com/users/HunterMcGushion/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-09-30T06:23:43Z","performed_via_github_app":null}]