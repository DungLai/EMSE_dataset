[{"url":"https://api.github.com/repos/MillionIntegrals/vel/issues/comments/493839612","html_url":"https://github.com/MillionIntegrals/vel/issues/47#issuecomment-493839612","issue_url":"https://api.github.com/repos/MillionIntegrals/vel/issues/47","id":493839612,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MzgzOTYxMg==","user":{"login":"MillionIntegrals","id":2262651,"node_id":"MDQ6VXNlcjIyNjI2NTE=","avatar_url":"https://avatars.githubusercontent.com/u/2262651?v=4","gravatar_id":"","url":"https://api.github.com/users/MillionIntegrals","html_url":"https://github.com/MillionIntegrals","followers_url":"https://api.github.com/users/MillionIntegrals/followers","following_url":"https://api.github.com/users/MillionIntegrals/following{/other_user}","gists_url":"https://api.github.com/users/MillionIntegrals/gists{/gist_id}","starred_url":"https://api.github.com/users/MillionIntegrals/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MillionIntegrals/subscriptions","organizations_url":"https://api.github.com/users/MillionIntegrals/orgs","repos_url":"https://api.github.com/users/MillionIntegrals/repos","events_url":"https://api.github.com/users/MillionIntegrals/events{/privacy}","received_events_url":"https://api.github.com/users/MillionIntegrals/received_events","type":"User","site_admin":false},"created_at":"2019-05-20T05:02:30Z","updated_at":"2019-05-20T05:02:30Z","author_association":"OWNER","body":"Your intuitions are right there.\r\n\r\n- `scale_float_frames` means that 8-bit (byte) atari grayscale images taking values between 0 and 255 will be scaled into 32-bit floating point numbers between 0.0 and 1.0. This is a suitable input for a neural network, but also takes 4 times more memory\r\n- Therefore, especially when using a replay buffer (which often takes a lot of memory, on the order of gigabytes even for simple DQN learning) we take observations as smaller byte arrays, store them as such in the replay buffer and then sample them like that from the replay buffer into the observation of the neural net\r\n- But, just like you've said since networks in general take floating point inputs, this scaling must be done somewhere. It is done in this simple module called `vel.module.input.image_to_tensor`. It's definition is rather brief:\r\n\r\n```\r\nclass ImageToTensor(BackboneModel):\r\n    \"\"\"\r\n    Convert simple image to tensor.\r\n\r\n    Flip channels to a [C, W, H] order and potentially convert 8-bit color values to floats\r\n    \"\"\"\r\n\r\n    def __init__(self):\r\n        super().__init__()\r\n\r\n    def reset_weights(self):\r\n        pass\r\n\r\n    def forward(self, image):\r\n        result = image.permute(0, 3, 1, 2).contiguous()\r\n\r\n        if result.dtype == torch.uint8:\r\n            result = result.type(torch.float) / 255.0\r\n        else:\r\n            result = result.type(torch.float)\r\n\r\n        return result\r\n```\r\n\r\nIt is configured in the model section in the yaml config, as an example here:\r\n\r\n```\r\nmodel:\r\n  name: vel.rl.models.q_model\r\n\r\n  input_block:\r\n    name: vel.modules.input.image_to_tensor\r\n\r\n  backbone:\r\n    name: vel.rl.models.backbone.nature_cnn\r\n    input_width: 84\r\n    input_height: 84\r\n    input_channels: 4  # The same as frame_history\r\n```\r\n\r\nIn general, I tried to factor each model in such way that they have a \"input block\" that maps whatever input the neural network receives into actual floating point number array of the right shape so that later it can be used in transformation downstream.\r\n\r\nLet me know if you have any other questions.","reactions":{"url":"https://api.github.com/repos/MillionIntegrals/vel/issues/comments/493839612/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"MillionIntegrals","id":2262651,"node_id":"MDQ6VXNlcjIyNjI2NTE=","avatar_url":"https://avatars.githubusercontent.com/u/2262651?v=4","gravatar_id":"","url":"https://api.github.com/users/MillionIntegrals","html_url":"https://github.com/MillionIntegrals","followers_url":"https://api.github.com/users/MillionIntegrals/followers","following_url":"https://api.github.com/users/MillionIntegrals/following{/other_user}","gists_url":"https://api.github.com/users/MillionIntegrals/gists{/gist_id}","starred_url":"https://api.github.com/users/MillionIntegrals/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MillionIntegrals/subscriptions","organizations_url":"https://api.github.com/users/MillionIntegrals/orgs","repos_url":"https://api.github.com/users/MillionIntegrals/repos","events_url":"https://api.github.com/users/MillionIntegrals/events{/privacy}","received_events_url":"https://api.github.com/users/MillionIntegrals/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/MillionIntegrals/vel/issues/comments/493880139","html_url":"https://github.com/MillionIntegrals/vel/issues/47#issuecomment-493880139","issue_url":"https://api.github.com/repos/MillionIntegrals/vel/issues/47","id":493880139,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5Mzg4MDEzOQ==","user":{"login":"phizaz","id":451667,"node_id":"MDQ6VXNlcjQ1MTY2Nw==","avatar_url":"https://avatars.githubusercontent.com/u/451667?v=4","gravatar_id":"","url":"https://api.github.com/users/phizaz","html_url":"https://github.com/phizaz","followers_url":"https://api.github.com/users/phizaz/followers","following_url":"https://api.github.com/users/phizaz/following{/other_user}","gists_url":"https://api.github.com/users/phizaz/gists{/gist_id}","starred_url":"https://api.github.com/users/phizaz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/phizaz/subscriptions","organizations_url":"https://api.github.com/users/phizaz/orgs","repos_url":"https://api.github.com/users/phizaz/repos","events_url":"https://api.github.com/users/phizaz/events{/privacy}","received_events_url":"https://api.github.com/users/phizaz/received_events","type":"User","site_admin":false},"created_at":"2019-05-20T08:02:17Z","updated_at":"2019-05-20T08:02:17Z","author_association":"NONE","body":"@MillionIntegrals It seems that `image_to_tensor` is safe to use regardless of the flag of the environment?","reactions":{"url":"https://api.github.com/repos/MillionIntegrals/vel/issues/comments/493880139/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"phizaz","id":451667,"node_id":"MDQ6VXNlcjQ1MTY2Nw==","avatar_url":"https://avatars.githubusercontent.com/u/451667?v=4","gravatar_id":"","url":"https://api.github.com/users/phizaz","html_url":"https://github.com/phizaz","followers_url":"https://api.github.com/users/phizaz/followers","following_url":"https://api.github.com/users/phizaz/following{/other_user}","gists_url":"https://api.github.com/users/phizaz/gists{/gist_id}","starred_url":"https://api.github.com/users/phizaz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/phizaz/subscriptions","organizations_url":"https://api.github.com/users/phizaz/orgs","repos_url":"https://api.github.com/users/phizaz/repos","events_url":"https://api.github.com/users/phizaz/events{/privacy}","received_events_url":"https://api.github.com/users/phizaz/received_events","type":"User","site_admin":false}},{"id":2352257597,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjM1MjI1NzU5Nw==","url":"https://api.github.com/repos/MillionIntegrals/vel/issues/events/2352257597","actor":{"login":"MillionIntegrals","id":2262651,"node_id":"MDQ6VXNlcjIyNjI2NTE=","avatar_url":"https://avatars.githubusercontent.com/u/2262651?v=4","gravatar_id":"","url":"https://api.github.com/users/MillionIntegrals","html_url":"https://github.com/MillionIntegrals","followers_url":"https://api.github.com/users/MillionIntegrals/followers","following_url":"https://api.github.com/users/MillionIntegrals/following{/other_user}","gists_url":"https://api.github.com/users/MillionIntegrals/gists{/gist_id}","starred_url":"https://api.github.com/users/MillionIntegrals/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MillionIntegrals/subscriptions","organizations_url":"https://api.github.com/users/MillionIntegrals/orgs","repos_url":"https://api.github.com/users/MillionIntegrals/repos","events_url":"https://api.github.com/users/MillionIntegrals/events{/privacy}","received_events_url":"https://api.github.com/users/MillionIntegrals/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-05-20T08:02:17Z","performed_via_github_app":null},{"id":2352257598,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzNTIyNTc1OTg=","url":"https://api.github.com/repos/MillionIntegrals/vel/issues/events/2352257598","actor":{"login":"MillionIntegrals","id":2262651,"node_id":"MDQ6VXNlcjIyNjI2NTE=","avatar_url":"https://avatars.githubusercontent.com/u/2262651?v=4","gravatar_id":"","url":"https://api.github.com/users/MillionIntegrals","html_url":"https://github.com/MillionIntegrals","followers_url":"https://api.github.com/users/MillionIntegrals/followers","following_url":"https://api.github.com/users/MillionIntegrals/following{/other_user}","gists_url":"https://api.github.com/users/MillionIntegrals/gists{/gist_id}","starred_url":"https://api.github.com/users/MillionIntegrals/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MillionIntegrals/subscriptions","organizations_url":"https://api.github.com/users/MillionIntegrals/orgs","repos_url":"https://api.github.com/users/MillionIntegrals/repos","events_url":"https://api.github.com/users/MillionIntegrals/events{/privacy}","received_events_url":"https://api.github.com/users/MillionIntegrals/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-05-20T08:02:17Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/MillionIntegrals/vel/issues/comments/494425018","html_url":"https://github.com/MillionIntegrals/vel/issues/47#issuecomment-494425018","issue_url":"https://api.github.com/repos/MillionIntegrals/vel/issues/47","id":494425018,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NDQyNTAxOA==","user":{"login":"MillionIntegrals","id":2262651,"node_id":"MDQ6VXNlcjIyNjI2NTE=","avatar_url":"https://avatars.githubusercontent.com/u/2262651?v=4","gravatar_id":"","url":"https://api.github.com/users/MillionIntegrals","html_url":"https://github.com/MillionIntegrals","followers_url":"https://api.github.com/users/MillionIntegrals/followers","following_url":"https://api.github.com/users/MillionIntegrals/following{/other_user}","gists_url":"https://api.github.com/users/MillionIntegrals/gists{/gist_id}","starred_url":"https://api.github.com/users/MillionIntegrals/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MillionIntegrals/subscriptions","organizations_url":"https://api.github.com/users/MillionIntegrals/orgs","repos_url":"https://api.github.com/users/MillionIntegrals/repos","events_url":"https://api.github.com/users/MillionIntegrals/events{/privacy}","received_events_url":"https://api.github.com/users/MillionIntegrals/received_events","type":"User","site_admin":false},"created_at":"2019-05-21T14:50:43Z","updated_at":"2019-05-21T14:50:43Z","author_association":"OWNER","body":"Yes, it just happens in a different stage of processing. If you'd like to have something between the env and a network that needs floating point inputs then it's good to set `scale_float_frames` to true, otherwise it's not needed.","reactions":{"url":"https://api.github.com/repos/MillionIntegrals/vel/issues/comments/494425018/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"MillionIntegrals","id":2262651,"node_id":"MDQ6VXNlcjIyNjI2NTE=","avatar_url":"https://avatars.githubusercontent.com/u/2262651?v=4","gravatar_id":"","url":"https://api.github.com/users/MillionIntegrals","html_url":"https://github.com/MillionIntegrals","followers_url":"https://api.github.com/users/MillionIntegrals/followers","following_url":"https://api.github.com/users/MillionIntegrals/following{/other_user}","gists_url":"https://api.github.com/users/MillionIntegrals/gists{/gist_id}","starred_url":"https://api.github.com/users/MillionIntegrals/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MillionIntegrals/subscriptions","organizations_url":"https://api.github.com/users/MillionIntegrals/orgs","repos_url":"https://api.github.com/users/MillionIntegrals/repos","events_url":"https://api.github.com/users/MillionIntegrals/events{/privacy}","received_events_url":"https://api.github.com/users/MillionIntegrals/received_events","type":"User","site_admin":false}},{"id":2356752745,"node_id":"MDExOkNsb3NlZEV2ZW50MjM1Njc1Mjc0NQ==","url":"https://api.github.com/repos/MillionIntegrals/vel/issues/events/2356752745","actor":{"login":"phizaz","id":451667,"node_id":"MDQ6VXNlcjQ1MTY2Nw==","avatar_url":"https://avatars.githubusercontent.com/u/451667?v=4","gravatar_id":"","url":"https://api.github.com/users/phizaz","html_url":"https://github.com/phizaz","followers_url":"https://api.github.com/users/phizaz/followers","following_url":"https://api.github.com/users/phizaz/following{/other_user}","gists_url":"https://api.github.com/users/phizaz/gists{/gist_id}","starred_url":"https://api.github.com/users/phizaz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/phizaz/subscriptions","organizations_url":"https://api.github.com/users/phizaz/orgs","repos_url":"https://api.github.com/users/phizaz/repos","events_url":"https://api.github.com/users/phizaz/events{/privacy}","received_events_url":"https://api.github.com/users/phizaz/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-05-21T16:25:15Z","state_reason":null,"performed_via_github_app":null}]