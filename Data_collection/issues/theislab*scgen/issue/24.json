{"url":"https://api.github.com/repos/theislab/scgen/issues/24","repository_url":"https://api.github.com/repos/theislab/scgen","labels_url":"https://api.github.com/repos/theislab/scgen/issues/24/labels{/name}","comments_url":"https://api.github.com/repos/theislab/scgen/issues/24/comments","events_url":"https://api.github.com/repos/theislab/scgen/issues/24/events","html_url":"https://github.com/theislab/scgen/issues/24","id":649042523,"node_id":"MDU6SXNzdWU2NDkwNDI1MjM=","number":24,"title":"Metadata shuffled when applying batch correction","user":{"login":"fhausmann","id":52006590,"node_id":"MDQ6VXNlcjUyMDA2NTkw","avatar_url":"https://avatars.githubusercontent.com/u/52006590?v=4","gravatar_id":"","url":"https://api.github.com/users/fhausmann","html_url":"https://github.com/fhausmann","followers_url":"https://api.github.com/users/fhausmann/followers","following_url":"https://api.github.com/users/fhausmann/following{/other_user}","gists_url":"https://api.github.com/users/fhausmann/gists{/gist_id}","starred_url":"https://api.github.com/users/fhausmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fhausmann/subscriptions","organizations_url":"https://api.github.com/users/fhausmann/orgs","repos_url":"https://api.github.com/users/fhausmann/repos","events_url":"https://api.github.com/users/fhausmann/events{/privacy}","received_events_url":"https://api.github.com/users/fhausmann/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-07-01T14:47:01Z","updated_at":"2020-08-02T04:13:14Z","closed_at":"2020-08-02T04:13:13Z","author_association":"NONE","active_lock_reason":null,"body":"**Description:**\r\nWhen trying to run `batch_removal` metadata (anndata.obs) get shuffled and are not corresponding to the obs_names.\r\nIt is probably related to/ a consequence of: https://github.com/theislab/scgen/issues/7 \r\n\r\n**Version:**\r\nscgen: '1.1.4'\r\n\r\n**Code to reproduce:** \r\n```python\r\nimport scgen\r\nimport scanpy as sc\r\nimport pandas as pd\r\nimport anndata\r\n\r\nclass DummyNet: # To not require full training for reproducing the issue\r\n\r\n    def to_latent(self, data, *unused_args, **unused_kwargs):\r\n        return data\r\n\r\n    def reconstruct(self, data, *unused_args, **unused_kwargs):\r\n        return data\r\n\r\nmetadata = pd.DataFrame({\r\n    'cell_type': [\r\n        'celltyp1', 'celltyp1', 'celltyp1', 'celltyp2', \"celltyp2\", \"celltyp2\",\r\n        \"celltype3\"\r\n    ],\r\n    'batch': [\r\n        'batch1', 'batch1', 'batch2', 'batch1', 'batch2', 'batch2', 'batch2'\r\n    ]\r\n})\r\n\r\nmetadata.index = metadata.cell_type + \"_\" + metadata.batch + '_' + metadata.index.astype(str)\r\n\r\nmetadata=metadata.sample(frac=1) # To shuffle the dataframe\r\n\r\ntest_data  = anndata.AnnData(np.zeros((metadata.index.size,100)),obs=metadata)\r\n\r\nscgen_results = scgen.batch_removal(DummyNet(),test_data) \r\n\r\nscgen_metadata = scgen_results.obs.copy()\r\n\r\ncomparison = pd.merge(metadata,scgen_metadata,left_index=True,right_index=True, suffixes=('_original','_scgen'))\r\n\r\nprint(comparison)\r\n```\r\nThanks in advance for your help.","closed_by":{"login":"M0hammadL","id":33202701,"node_id":"MDQ6VXNlcjMzMjAyNzAx","avatar_url":"https://avatars.githubusercontent.com/u/33202701?v=4","gravatar_id":"","url":"https://api.github.com/users/M0hammadL","html_url":"https://github.com/M0hammadL","followers_url":"https://api.github.com/users/M0hammadL/followers","following_url":"https://api.github.com/users/M0hammadL/following{/other_user}","gists_url":"https://api.github.com/users/M0hammadL/gists{/gist_id}","starred_url":"https://api.github.com/users/M0hammadL/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/M0hammadL/subscriptions","organizations_url":"https://api.github.com/users/M0hammadL/orgs","repos_url":"https://api.github.com/users/M0hammadL/repos","events_url":"https://api.github.com/users/M0hammadL/events{/privacy}","received_events_url":"https://api.github.com/users/M0hammadL/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/theislab/scgen/issues/24/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/theislab/scgen/issues/24/timeline","performed_via_github_app":null,"state_reason":"completed"}