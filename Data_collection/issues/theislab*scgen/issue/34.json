{"url":"https://api.github.com/repos/theislab/scgen/issues/34","repository_url":"https://api.github.com/repos/theislab/scgen","labels_url":"https://api.github.com/repos/theislab/scgen/issues/34/labels{/name}","comments_url":"https://api.github.com/repos/theislab/scgen/issues/34/comments","events_url":"https://api.github.com/repos/theislab/scgen/issues/34/events","html_url":"https://github.com/theislab/scgen/issues/34","id":728632166,"node_id":"MDU6SXNzdWU3Mjg2MzIxNjY=","number":34,"title":"Error in \"pred, delta\" part. KeyError: 'condition'","user":{"login":"levinhein","id":68268222,"node_id":"MDQ6VXNlcjY4MjY4MjIy","avatar_url":"https://avatars.githubusercontent.com/u/68268222?v=4","gravatar_id":"","url":"https://api.github.com/users/levinhein","html_url":"https://github.com/levinhein","followers_url":"https://api.github.com/users/levinhein/followers","following_url":"https://api.github.com/users/levinhein/following{/other_user}","gists_url":"https://api.github.com/users/levinhein/gists{/gist_id}","starred_url":"https://api.github.com/users/levinhein/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/levinhein/subscriptions","organizations_url":"https://api.github.com/users/levinhein/orgs","repos_url":"https://api.github.com/users/levinhein/repos","events_url":"https://api.github.com/users/levinhein/events{/privacy}","received_events_url":"https://api.github.com/users/levinhein/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-10-24T02:05:29Z","updated_at":"2021-05-19T07:29:06Z","closed_at":"2021-05-19T07:29:06Z","author_association":"NONE","active_lock_reason":null,"body":"Hello. I encountered an error as shown below. May I ask if this error mean that I cannot run an h5ad data if the condition in my actual data is not categorized as \"condition\"? My experiment condition label on data is \"response\", and not \"condition\". Or this error means different?\r\n\r\n**SCRIPT:**\r\n```\r\npred, delta = scg.predict(adata=train_new, adata_to_predict=NR_CD4T,\r\n                          conditions={\"ctrl\": \"NR\", \"stim\": \"R\"}, cell_type_key=\"celltype\", condition_key=\"response\")\r\n\r\n```\r\n**ERROR:**\r\n```\r\n---------------------------------------------------------------------------\r\nKeyError                                  Traceback (most recent call last)\r\n~/anaconda3/envs/scgen_test/lib/python3.7/site-packages/pandas/core/indexes/base.py in get_loc(self, key, method, tolerance)\r\n   2890             try:\r\n-> 2891                 return self._engine.get_loc(casted_key)\r\n   2892             except KeyError as err:\r\n\r\npandas/_libs/index.pyx in pandas._libs.index.IndexEngine.get_loc()\r\n\r\npandas/_libs/index.pyx in pandas._libs.index.IndexEngine.get_loc()\r\n\r\npandas/_libs/hashtable_class_helper.pxi in pandas._libs.hashtable.PyObjectHashTable.get_item()\r\n\r\npandas/_libs/hashtable_class_helper.pxi in pandas._libs.hashtable.PyObjectHashTable.get_item()\r\n\r\nKeyError: 'condition'\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nKeyError                                  Traceback (most recent call last)\r\n<ipython-input-12-f1fd2259e7a8> in <module>\r\n      1 pred, delta = scg.predict(adata=train_new, adata_to_predict=NR_CD4T,\r\n----> 2                           conditions={\"ctrl\": \"NR\", \"stim\": \"R\"}, cell_type_key=\"celltype\", condition_key=\"response\")\r\n\r\n~/anaconda3/envs/scgen_test/lib/python3.7/site-packages/scgen/models/_vae_keras.py in predict(self, adata, conditions, cell_type_key, condition_key, adata_to_predict, celltype_to_predict, obs_key)\r\n    320         \"\"\"\r\n    321         if obs_key == \"all\":\r\n--> 322             ctrl_x = adata[adata.obs[\"condition\"] == conditions[\"ctrl\"], :]\r\n    323             stim_x = adata[adata.obs[\"condition\"] == conditions[\"stim\"], :]\r\n    324             ctrl_x = balancer(ctrl_x, cell_type_key=cell_type_key, condition_key=condition_key)\r\n\r\n~/anaconda3/envs/scgen_test/lib/python3.7/site-packages/pandas/core/frame.py in __getitem__(self, key)\r\n   2900             if self.columns.nlevels > 1:\r\n   2901                 return self._getitem_multilevel(key)\r\n-> 2902             indexer = self.columns.get_loc(key)\r\n   2903             if is_integer(indexer):\r\n   2904                 indexer = [indexer]\r\n\r\n~/anaconda3/envs/scgen_test/lib/python3.7/site-packages/pandas/core/indexes/base.py in get_loc(self, key, method, tolerance)\r\n   2891                 return self._engine.get_loc(casted_key)\r\n   2892             except KeyError as err:\r\n-> 2893                 raise KeyError(key) from err\r\n   2894 \r\n   2895         if tolerance is not None:\r\n\r\nKeyError: 'condition'\r\n\r\n```","closed_by":{"login":"M0hammadL","id":33202701,"node_id":"MDQ6VXNlcjMzMjAyNzAx","avatar_url":"https://avatars.githubusercontent.com/u/33202701?v=4","gravatar_id":"","url":"https://api.github.com/users/M0hammadL","html_url":"https://github.com/M0hammadL","followers_url":"https://api.github.com/users/M0hammadL/followers","following_url":"https://api.github.com/users/M0hammadL/following{/other_user}","gists_url":"https://api.github.com/users/M0hammadL/gists{/gist_id}","starred_url":"https://api.github.com/users/M0hammadL/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/M0hammadL/subscriptions","organizations_url":"https://api.github.com/users/M0hammadL/orgs","repos_url":"https://api.github.com/users/M0hammadL/repos","events_url":"https://api.github.com/users/M0hammadL/events{/privacy}","received_events_url":"https://api.github.com/users/M0hammadL/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/theislab/scgen/issues/34/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/theislab/scgen/issues/34/timeline","performed_via_github_app":null,"state_reason":"completed"}