{"url":"https://api.github.com/repos/theislab/scgen/issues/49","repository_url":"https://api.github.com/repos/theislab/scgen","labels_url":"https://api.github.com/repos/theislab/scgen/issues/49/labels{/name}","comments_url":"https://api.github.com/repos/theislab/scgen/issues/49/comments","events_url":"https://api.github.com/repos/theislab/scgen/issues/49/events","html_url":"https://github.com/theislab/scgen/issues/49","id":941030585,"node_id":"MDU6SXNzdWU5NDEwMzA1ODU=","number":49,"title":"ValueError: could not convert integer scalar","user":{"login":"acmullen-med","id":61470482,"node_id":"MDQ6VXNlcjYxNDcwNDgy","avatar_url":"https://avatars.githubusercontent.com/u/61470482?v=4","gravatar_id":"","url":"https://api.github.com/users/acmullen-med","html_url":"https://github.com/acmullen-med","followers_url":"https://api.github.com/users/acmullen-med/followers","following_url":"https://api.github.com/users/acmullen-med/following{/other_user}","gists_url":"https://api.github.com/users/acmullen-med/gists{/gist_id}","starred_url":"https://api.github.com/users/acmullen-med/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/acmullen-med/subscriptions","organizations_url":"https://api.github.com/users/acmullen-med/orgs","repos_url":"https://api.github.com/users/acmullen-med/repos","events_url":"https://api.github.com/users/acmullen-med/events{/privacy}","received_events_url":"https://api.github.com/users/acmullen-med/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2021-07-09T19:58:51Z","updated_at":"2021-09-10T21:01:31Z","closed_at":"2021-09-10T21:01:31Z","author_association":"NONE","active_lock_reason":null,"body":"I am trying to replicate the results of the perturbation experiment with some of my own data but am running into an error\r\n\r\n```\r\n>>> pred, delta = model.predict(\r\n    ctrl_key='18h',\r\n    stim_key='24h',\r\n    celltype_to_predict='tbx16'\r\n)\r\nObservation names are not unique. To make them unique, call `.obs_names_make_unique`.\r\nObservation names are not unique. To make them unique, call `.obs_names_make_unique`.\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 4, in <module>\r\n  File \"/net/vol1/home/.local/lib/python3.7/site-packages/scgen/_scgen.py\", line 155, in predict\r\n    ctrl_adata.X = ctrl_adata.X.A\r\n  File \"/net/gs/vol3/software/modules-sw-python/3.7.7/scvi-tools/0.10.1/Linux/CentOS7/x86_64/lib/python3.7/site-packages/anndata/_core/anndata.py\", line 684, in X\r\n    self._adata_ref._X[oidx, vidx] = value\r\n  File \"/net/gs/vol3/software/modules-sw-python/3.7.7/scvi-tools/0.10.1/Linux/CentOS7/x86_64/lib/python3.7/site-packages/scipy/sparse/_index.py\", line 116, in __setitem__\r\n    self._set_arrayXarray_sparse(i, j, x)\r\n  File \"/net/gs/vol3/software/modules-sw-python/3.7.7/scvi-tools/0.10.1/Linux/CentOS7/x86_64/lib/python3.7/site-packages/scipy/sparse/compressed.py\", line 808, in _set_arrayXarray_sparse\r\n    self._zero_many(*self._swap((row, col)))\r\n  File \"/net/gs/vol3/software/modules-sw-python/3.7.7/scvi-tools/0.10.1/Linux/CentOS7/x86_64/lib/python3.7/site-packages/scipy/sparse/compressed.py\", line 929, in _zero_many\r\n    i, j, offsets)\r\nValueError: could not convert integer scalar\r\n```\r\n\r\nI found https://github.com/theislab/anndata/issues/339 and tried \r\n\r\n```\r\n>>> model.adata = model.adata.copy()\r\n>>> pred, delta = model.predict(\r\n    ctrl_key='18h',\r\n    stim_key='24h',\r\n    celltype_to_predict='tbx16'\r\n)\r\n```\r\n\r\nbut got the same result.\r\n\r\nI had no issues with training. Strangely, I don't seem to have this issue if I subset the data and only predict on 5% of data or if I use the sample data provided. Is there a size limit for the number of cells that this package will work with?\r\n\r\nI am not using conda.\r\n\r\nRelevant packages:\r\nsc.__version__\r\n'1.7.2'\r\nscipy.__version__\r\n'1.6.3'\r\nnp.__version__\r\n'1.20.3'\r\nanndata.__version__\r\n'0.7.6'\r\nscgen.__version__\r\n'2.0.0'\r\n\r\nI have tried to update my libraries to the most current versions. Any guidance you could provide would be great","closed_by":{"login":"acmullen-med","id":61470482,"node_id":"MDQ6VXNlcjYxNDcwNDgy","avatar_url":"https://avatars.githubusercontent.com/u/61470482?v=4","gravatar_id":"","url":"https://api.github.com/users/acmullen-med","html_url":"https://github.com/acmullen-med","followers_url":"https://api.github.com/users/acmullen-med/followers","following_url":"https://api.github.com/users/acmullen-med/following{/other_user}","gists_url":"https://api.github.com/users/acmullen-med/gists{/gist_id}","starred_url":"https://api.github.com/users/acmullen-med/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/acmullen-med/subscriptions","organizations_url":"https://api.github.com/users/acmullen-med/orgs","repos_url":"https://api.github.com/users/acmullen-med/repos","events_url":"https://api.github.com/users/acmullen-med/events{/privacy}","received_events_url":"https://api.github.com/users/acmullen-med/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/theislab/scgen/issues/49/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/theislab/scgen/issues/49/timeline","performed_via_github_app":null,"state_reason":"completed"}