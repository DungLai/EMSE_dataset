[{"actor":{"login":"Daliya-K","id":65295990,"node_id":"MDQ6VXNlcjY1Mjk1OTkw","avatar_url":"https://avatars.githubusercontent.com/u/65295990?v=4","gravatar_id":"","url":"https://api.github.com/users/Daliya-K","html_url":"https://github.com/Daliya-K","followers_url":"https://api.github.com/users/Daliya-K/followers","following_url":"https://api.github.com/users/Daliya-K/following{/other_user}","gists_url":"https://api.github.com/users/Daliya-K/gists{/gist_id}","starred_url":"https://api.github.com/users/Daliya-K/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Daliya-K/subscriptions","organizations_url":"https://api.github.com/users/Daliya-K/orgs","repos_url":"https://api.github.com/users/Daliya-K/repos","events_url":"https://api.github.com/users/Daliya-K/events{/privacy}","received_events_url":"https://api.github.com/users/Daliya-K/received_events","type":"User","site_admin":false},"created_at":"2020-10-19T17:37:35Z","updated_at":"2020-10-19T17:37:35Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/theislab/scgen/issues/32","repository_url":"https://api.github.com/repos/theislab/scgen","labels_url":"https://api.github.com/repos/theislab/scgen/issues/32/labels{/name}","comments_url":"https://api.github.com/repos/theislab/scgen/issues/32/comments","events_url":"https://api.github.com/repos/theislab/scgen/issues/32/events","html_url":"https://github.com/theislab/scgen/issues/32","id":724832045,"node_id":"MDU6SXNzdWU3MjQ4MzIwNDU=","number":32,"title":"batch_removal AssertionError","user":{"login":"Daliya-K","id":65295990,"node_id":"MDQ6VXNlcjY1Mjk1OTkw","avatar_url":"https://avatars.githubusercontent.com/u/65295990?v=4","gravatar_id":"","url":"https://api.github.com/users/Daliya-K","html_url":"https://github.com/Daliya-K","followers_url":"https://api.github.com/users/Daliya-K/followers","following_url":"https://api.github.com/users/Daliya-K/following{/other_user}","gists_url":"https://api.github.com/users/Daliya-K/gists{/gist_id}","starred_url":"https://api.github.com/users/Daliya-K/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Daliya-K/subscriptions","organizations_url":"https://api.github.com/users/Daliya-K/orgs","repos_url":"https://api.github.com/users/Daliya-K/repos","events_url":"https://api.github.com/users/Daliya-K/events{/privacy}","received_events_url":"https://api.github.com/users/Daliya-K/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-10-19T17:37:35Z","updated_at":"2021-05-19T07:30:22Z","closed_at":"2021-05-19T07:30:22Z","author_association":"NONE","active_lock_reason":null,"repository":{"id":159543308,"node_id":"MDEwOlJlcG9zaXRvcnkxNTk1NDMzMDg=","name":"scgen","full_name":"theislab/scgen","private":false,"owner":{"login":"theislab","id":22319415,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIyMzE5NDE1","avatar_url":"https://avatars.githubusercontent.com/u/22319415?v=4","gravatar_id":"","url":"https://api.github.com/users/theislab","html_url":"https://github.com/theislab","followers_url":"https://api.github.com/users/theislab/followers","following_url":"https://api.github.com/users/theislab/following{/other_user}","gists_url":"https://api.github.com/users/theislab/gists{/gist_id}","starred_url":"https://api.github.com/users/theislab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theislab/subscriptions","organizations_url":"https://api.github.com/users/theislab/orgs","repos_url":"https://api.github.com/users/theislab/repos","events_url":"https://api.github.com/users/theislab/events{/privacy}","received_events_url":"https://api.github.com/users/theislab/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/theislab/scgen","description":"Single cell perturbation prediction","fork":false,"url":"https://api.github.com/repos/theislab/scgen","forks_url":"https://api.github.com/repos/theislab/scgen/forks","keys_url":"https://api.github.com/repos/theislab/scgen/keys{/key_id}","collaborators_url":"https://api.github.com/repos/theislab/scgen/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/theislab/scgen/teams","hooks_url":"https://api.github.com/repos/theislab/scgen/hooks","issue_events_url":"https://api.github.com/repos/theislab/scgen/issues/events{/number}","events_url":"https://api.github.com/repos/theislab/scgen/events","assignees_url":"https://api.github.com/repos/theislab/scgen/assignees{/user}","branches_url":"https://api.github.com/repos/theislab/scgen/branches{/branch}","tags_url":"https://api.github.com/repos/theislab/scgen/tags","blobs_url":"https://api.github.com/repos/theislab/scgen/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/theislab/scgen/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/theislab/scgen/git/refs{/sha}","trees_url":"https://api.github.com/repos/theislab/scgen/git/trees{/sha}","statuses_url":"https://api.github.com/repos/theislab/scgen/statuses/{sha}","languages_url":"https://api.github.com/repos/theislab/scgen/languages","stargazers_url":"https://api.github.com/repos/theislab/scgen/stargazers","contributors_url":"https://api.github.com/repos/theislab/scgen/contributors","subscribers_url":"https://api.github.com/repos/theislab/scgen/subscribers","subscription_url":"https://api.github.com/repos/theislab/scgen/subscription","commits_url":"https://api.github.com/repos/theislab/scgen/commits{/sha}","git_commits_url":"https://api.github.com/repos/theislab/scgen/git/commits{/sha}","comments_url":"https://api.github.com/repos/theislab/scgen/comments{/number}","issue_comment_url":"https://api.github.com/repos/theislab/scgen/issues/comments{/number}","contents_url":"https://api.github.com/repos/theislab/scgen/contents/{+path}","compare_url":"https://api.github.com/repos/theislab/scgen/compare/{base}...{head}","merges_url":"https://api.github.com/repos/theislab/scgen/merges","archive_url":"https://api.github.com/repos/theislab/scgen/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/theislab/scgen/downloads","issues_url":"https://api.github.com/repos/theislab/scgen/issues{/number}","pulls_url":"https://api.github.com/repos/theislab/scgen/pulls{/number}","milestones_url":"https://api.github.com/repos/theislab/scgen/milestones{/number}","notifications_url":"https://api.github.com/repos/theislab/scgen/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/theislab/scgen/labels{/name}","releases_url":"https://api.github.com/repos/theislab/scgen/releases{/id}","deployments_url":"https://api.github.com/repos/theislab/scgen/deployments","created_at":"2018-11-28T17:59:06Z","updated_at":"2023-01-17T15:58:17Z","pushed_at":"2022-04-25T17:04:48Z","git_url":"git://github.com/theislab/scgen.git","ssh_url":"git@github.com:theislab/scgen.git","clone_url":"https://github.com/theislab/scgen.git","svn_url":"https://github.com/theislab/scgen","homepage":"https://scgen.readthedocs.io","size":72318,"stargazers_count":181,"watchers_count":181,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":44,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":8,"license":{"key":"gpl-3.0","name":"GNU General Public License v3.0","spdx_id":"GPL-3.0","url":"https://api.github.com/licenses/gpl-3.0","node_id":"MDc6TGljZW5zZTk="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["bioinformatics","deep-learning","generative-model","scrna-seq","single-cell","single-cell-genomics","transcriptomics"],"visibility":"public","forks":44,"open_issues":8,"watchers":181,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Hi,\r\nI have a similar issue to #30  with batch_removal. The training of the network works, but running batch_removal throws an error:\r\n```\r\nadata = sc.read(path+\"Aggr.adata.h5ad\", cache=True)\r\nnetwork = scgen.VAEArithKeras(x_dimension= adata.shape[1], model_path=\"./models/batch\")\r\nnetwork.train(train_data=adata, n_epochs=100)\r\ncorrected_adata =  scgen.batch_removal(network=network, adata=adata, batch_key=\"batch\", cell_label_key=\"cell_type\")\r\n\r\n ---------------------------------------------------------------------------\r\n AssertionError                            Traceback (most recent call last)\r\n<ipython-input-20-83ab6f5c386a> in <module>\r\n      1 t = time.process_time()\r\n----> 2 corrected_adata =  scgen.batch_removal(network=network, adata=adata, batch_key=\"batch\", cell_label_key=\"cell_type\")\r\n      3 elapsed_time = time.process_time() - t\r\n\r\n~/anaconda3/lib/python3.7/site-packages/scgen/models/util.py in batch_removal(network, adata, batch_key, cell_label_key)\r\n    287             temp_cell[batch_ind[study]].X = batch_list[study].X\r\n    288         shared_ct.append(temp_cell)\r\n--> 289     all_shared_ann = anndata.AnnData.concatenate(*shared_ct, batch_key=\"concat_batch\", index_unique=None)\r\n    290     if \"concat_batch\" in all_shared_ann.obs.columns:\r\n    291         del all_shared_ann.obs[\"concat_batch\"]\r\n\r\n~/anaconda3/lib/python3.7/site-packages/anndata/_core/anndata.py in concatenate(self, join, batch_key, batch_categories, uns_merge, index_unique, fill_value, *adatas)\r\n   1703             uns_merge=uns_merge,\r\n   1704             fill_value=fill_value,\r\n-> 1705             index_unique=index_unique,\r\n   1706         )\r\n   1707 \r\n\r\n~/anaconda3/lib/python3.7/site-packages/anndata/_core/merge.py in concat(adatas, join, batch_key, batch_categories, uns_merge, index_unique, fill_value)\r\n    470         # Current behaviour is mostly for backwards compat. It's like make_names_unique, but\r\n    471         # unfortunately the behaviour is different.\r\n--> 472         partial(merge_outer, batch_keys=batch_categories, merge=merge_same),\r\n    473     )\r\n    474 \r\n\r\n~/anaconda3/lib/python3.7/site-packages/anndata/_core/merge.py in merge_dataframes(dfs, new_index, merge_strategy)\r\n    403 \r\n    404 def merge_dataframes(dfs, new_index, merge_strategy=merge_unique):\r\n--> 405     dfs = [df.reindex(index=new_index) for df in dfs]\r\n    406     # New dataframe with all shared data\r\n    407     new_df = pd.DataFrame(merge_strategy(dfs), index=new_index)\r\n\r\n~/anaconda3/lib/python3.7/site-packages/anndata/_core/merge.py in <listcomp>(.0)\r\n    403 \r\n    404 def merge_dataframes(dfs, new_index, merge_strategy=merge_unique):\r\n--> 405     dfs = [df.reindex(index=new_index) for df in dfs]\r\n    406     # New dataframe with all shared data\r\n    407     new_df = pd.DataFrame(merge_strategy(dfs), index=new_index)\r\n\r\n~/anaconda3/lib/python3.7/site-packages/pandas/util/_decorators.py in wrapper(*args, **kwargs)\r\n    225         @wraps(func)\r\n    226         def wrapper(*args, **kwargs) -> Callable[..., Any]:\r\n--> 227             return func(*args, **kwargs)\r\n    228 \r\n    229         kind = inspect.Parameter.POSITIONAL_OR_KEYWORD\r\n\r\n~/anaconda3/lib/python3.7/site-packages/pandas/core/frame.py in reindex(self, *args, **kwargs)\r\n   3854         kwargs.pop(\"axis\", None)\r\n   3855         kwargs.pop(\"labels\", None)\r\n-> 3856         return self._ensure_type(super().reindex(**kwargs))\r\n   3857 \r\n   3858     def drop(\r\n\r\n~/anaconda3/lib/python3.7/site-packages/pandas/core/base.py in _ensure_type(self, obj)\r\n     91         Used by type checkers.\r\n     92         \"\"\"\r\n---> 93         assert isinstance(obj, type(self)), type(obj)\r\n     94         return obj\r\n     95 \r\n\r\nAssertionError: <class 'pandas.core.frame.DataFrame'>\r\n\r\n```\r\n\r\n\r\nI will be very grateful for some help!\r\n\r\nanndata==0.7.3\r\nscanpy==1.5.2.dev7+ge33a2f33\r\nscgen===1.1.5.dev2-3004bc0\r\nscipy==1.4.1\r\nscikit-learn==0.22.1\r\npandas==1.0.1\r\n\r\n","reactions":{"url":"https://api.github.com/repos/theislab/scgen/issues/32/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/theislab/scgen/issues/32/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/theislab/scgen/issues/comments/843825803","html_url":"https://github.com/theislab/scgen/issues/30#issuecomment-843825803","issue_url":"https://api.github.com/repos/theislab/scgen/issues/30","id":843825803,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MzgyNTgwMw==","user":{"login":"M0hammadL","id":33202701,"node_id":"MDQ6VXNlcjMzMjAyNzAx","avatar_url":"https://avatars.githubusercontent.com/u/33202701?v=4","gravatar_id":"","url":"https://api.github.com/users/M0hammadL","html_url":"https://github.com/M0hammadL","followers_url":"https://api.github.com/users/M0hammadL/followers","following_url":"https://api.github.com/users/M0hammadL/following{/other_user}","gists_url":"https://api.github.com/users/M0hammadL/gists{/gist_id}","starred_url":"https://api.github.com/users/M0hammadL/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/M0hammadL/subscriptions","organizations_url":"https://api.github.com/users/M0hammadL/orgs","repos_url":"https://api.github.com/users/M0hammadL/repos","events_url":"https://api.github.com/users/M0hammadL/events{/privacy}","received_events_url":"https://api.github.com/users/M0hammadL/received_events","type":"User","site_admin":false},"created_at":"2021-05-19T07:29:22Z","updated_at":"2021-05-19T07:29:22Z","author_association":"COLLABORATOR","body":"Hi\r\n\r\nWe have released a new PyTorch version of the code. Please use this version.\r\n\r\nBest\r\nMo","reactions":{"url":"https://api.github.com/repos/theislab/scgen/issues/comments/843825803/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"M0hammadL","id":33202701,"node_id":"MDQ6VXNlcjMzMjAyNzAx","avatar_url":"https://avatars.githubusercontent.com/u/33202701?v=4","gravatar_id":"","url":"https://api.github.com/users/M0hammadL","html_url":"https://github.com/M0hammadL","followers_url":"https://api.github.com/users/M0hammadL/followers","following_url":"https://api.github.com/users/M0hammadL/following{/other_user}","gists_url":"https://api.github.com/users/M0hammadL/gists{/gist_id}","starred_url":"https://api.github.com/users/M0hammadL/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/M0hammadL/subscriptions","organizations_url":"https://api.github.com/users/M0hammadL/orgs","repos_url":"https://api.github.com/users/M0hammadL/repos","events_url":"https://api.github.com/users/M0hammadL/events{/privacy}","received_events_url":"https://api.github.com/users/M0hammadL/received_events","type":"User","site_admin":false}},{"id":4764763911,"node_id":"MDExOkNsb3NlZEV2ZW50NDc2NDc2MzkxMQ==","url":"https://api.github.com/repos/theislab/scgen/issues/events/4764763911","actor":{"login":"M0hammadL","id":33202701,"node_id":"MDQ6VXNlcjMzMjAyNzAx","avatar_url":"https://avatars.githubusercontent.com/u/33202701?v=4","gravatar_id":"","url":"https://api.github.com/users/M0hammadL","html_url":"https://github.com/M0hammadL","followers_url":"https://api.github.com/users/M0hammadL/followers","following_url":"https://api.github.com/users/M0hammadL/following{/other_user}","gists_url":"https://api.github.com/users/M0hammadL/gists{/gist_id}","starred_url":"https://api.github.com/users/M0hammadL/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/M0hammadL/subscriptions","organizations_url":"https://api.github.com/users/M0hammadL/orgs","repos_url":"https://api.github.com/users/M0hammadL/repos","events_url":"https://api.github.com/users/M0hammadL/events{/privacy}","received_events_url":"https://api.github.com/users/M0hammadL/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-05-19T07:29:25Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/theislab/scgen/issues/comments/1101319797","html_url":"https://github.com/theislab/scgen/issues/30#issuecomment-1101319797","issue_url":"https://api.github.com/repos/theislab/scgen/issues/30","id":1101319797,"node_id":"IC_kwDOCYJwDM5BpM51","user":{"login":"gauravsinghrathore","id":34302005,"node_id":"MDQ6VXNlcjM0MzAyMDA1","avatar_url":"https://avatars.githubusercontent.com/u/34302005?v=4","gravatar_id":"","url":"https://api.github.com/users/gauravsinghrathore","html_url":"https://github.com/gauravsinghrathore","followers_url":"https://api.github.com/users/gauravsinghrathore/followers","following_url":"https://api.github.com/users/gauravsinghrathore/following{/other_user}","gists_url":"https://api.github.com/users/gauravsinghrathore/gists{/gist_id}","starred_url":"https://api.github.com/users/gauravsinghrathore/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gauravsinghrathore/subscriptions","organizations_url":"https://api.github.com/users/gauravsinghrathore/orgs","repos_url":"https://api.github.com/users/gauravsinghrathore/repos","events_url":"https://api.github.com/users/gauravsinghrathore/events{/privacy}","received_events_url":"https://api.github.com/users/gauravsinghrathore/received_events","type":"User","site_admin":false},"created_at":"2022-04-18T11:12:04Z","updated_at":"2022-04-18T11:12:04Z","author_association":"NONE","body":"same problem. I have everything updated. I try to concatenate multiple adatas and then train model further going to batch correction. \r\ngdown==4.4.0\r\nmatplotlib==3.5.1\r\nscgen==2.1.0\r\nnumpy==1.21.6\r\nscanpy==1.9.1\r\n ","reactions":{"url":"https://api.github.com/repos/theislab/scgen/issues/comments/1101319797/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"gauravsinghrathore","id":34302005,"node_id":"MDQ6VXNlcjM0MzAyMDA1","avatar_url":"https://avatars.githubusercontent.com/u/34302005?v=4","gravatar_id":"","url":"https://api.github.com/users/gauravsinghrathore","html_url":"https://github.com/gauravsinghrathore","followers_url":"https://api.github.com/users/gauravsinghrathore/followers","following_url":"https://api.github.com/users/gauravsinghrathore/following{/other_user}","gists_url":"https://api.github.com/users/gauravsinghrathore/gists{/gist_id}","starred_url":"https://api.github.com/users/gauravsinghrathore/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gauravsinghrathore/subscriptions","organizations_url":"https://api.github.com/users/gauravsinghrathore/orgs","repos_url":"https://api.github.com/users/gauravsinghrathore/repos","events_url":"https://api.github.com/users/gauravsinghrathore/events{/privacy}","received_events_url":"https://api.github.com/users/gauravsinghrathore/received_events","type":"User","site_admin":false}}]