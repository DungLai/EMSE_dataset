[{"url":"https://api.github.com/repos/skalavala/mysmarthome/issues/comments/1188361913","html_url":"https://github.com/skalavala/mysmarthome/issues/2#issuecomment-1188361913","issue_url":"https://api.github.com/repos/skalavala/mysmarthome/issues/2","id":1188361913,"node_id":"IC_kwDOCtjF2s5G1Pa5","user":{"login":"FoUStep","id":14996435,"node_id":"MDQ6VXNlcjE0OTk2NDM1","avatar_url":"https://avatars.githubusercontent.com/u/14996435?v=4","gravatar_id":"","url":"https://api.github.com/users/FoUStep","html_url":"https://github.com/FoUStep","followers_url":"https://api.github.com/users/FoUStep/followers","following_url":"https://api.github.com/users/FoUStep/following{/other_user}","gists_url":"https://api.github.com/users/FoUStep/gists{/gist_id}","starred_url":"https://api.github.com/users/FoUStep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/FoUStep/subscriptions","organizations_url":"https://api.github.com/users/FoUStep/orgs","repos_url":"https://api.github.com/users/FoUStep/repos","events_url":"https://api.github.com/users/FoUStep/events{/privacy}","received_events_url":"https://api.github.com/users/FoUStep/received_events","type":"User","site_admin":false},"created_at":"2022-07-18T21:57:15Z","updated_at":"2022-07-18T22:02:11Z","author_association":"NONE","body":"Just found this gem. It shows everyone logged in at the portal (to either download the client or whatever). \r\n\r\nYou need to change the portal into the gateway as shown above, along with <current-user/> and a change into the counting code. Change all this in the sensor.py file, restart your entire Home Assistant host and it'll work.\r\n\r\nLike this:\r\n`<show><global-protect-gateway><current-user/></global-protect-gateway></show>`\r\n\r\nAlso look for this piece:\r\n```\r\n    def parse_globalprotect_users(self):\r\n        user_count = 0\r\n        vpn_users = []\r\n        root = ET.fromstring(self._gp_users)\r\n        nodes = root.findall('result/gp-portal-users/user')\r\n        for user in nodes:\r\n            user_count += 1\r\n            vpn_users.append(user.find('username').text)\r\n```\r\n\r\nChange the nodes rule into:\r\n```\r\n    def parse_globalprotect_users(self):\r\n        user_count = 0\r\n        vpn_users = []\r\n        root = ET.fromstring(self._gp_users)\r\n        nodes = root.findall('result/entry')\r\n        for user in nodes:\r\n            user_count += 1\r\n            vpn_users.append(user.find('username').text)\r\n```\r\n\r\nTested this on PAN-OS 10.2 on a PA-220. It works.\r\n","reactions":{"url":"https://api.github.com/repos/skalavala/mysmarthome/issues/comments/1188361913/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"FoUStep","id":14996435,"node_id":"MDQ6VXNlcjE0OTk2NDM1","avatar_url":"https://avatars.githubusercontent.com/u/14996435?v=4","gravatar_id":"","url":"https://api.github.com/users/FoUStep","html_url":"https://github.com/FoUStep","followers_url":"https://api.github.com/users/FoUStep/followers","following_url":"https://api.github.com/users/FoUStep/following{/other_user}","gists_url":"https://api.github.com/users/FoUStep/gists{/gist_id}","starred_url":"https://api.github.com/users/FoUStep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/FoUStep/subscriptions","organizations_url":"https://api.github.com/users/FoUStep/orgs","repos_url":"https://api.github.com/users/FoUStep/repos","events_url":"https://api.github.com/users/FoUStep/events{/privacy}","received_events_url":"https://api.github.com/users/FoUStep/received_events","type":"User","site_admin":false}}]