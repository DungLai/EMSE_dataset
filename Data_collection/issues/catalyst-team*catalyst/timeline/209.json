[{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/comments/497999045","html_url":"https://github.com/catalyst-team/catalyst/issues/209#issuecomment-497999045","issue_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/209","id":497999045,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5Nzk5OTA0NQ==","user":{"login":"ngxbac","id":11550123,"node_id":"MDQ6VXNlcjExNTUwMTIz","avatar_url":"https://avatars.githubusercontent.com/u/11550123?v=4","gravatar_id":"","url":"https://api.github.com/users/ngxbac","html_url":"https://github.com/ngxbac","followers_url":"https://api.github.com/users/ngxbac/followers","following_url":"https://api.github.com/users/ngxbac/following{/other_user}","gists_url":"https://api.github.com/users/ngxbac/gists{/gist_id}","starred_url":"https://api.github.com/users/ngxbac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ngxbac/subscriptions","organizations_url":"https://api.github.com/users/ngxbac/orgs","repos_url":"https://api.github.com/users/ngxbac/repos","events_url":"https://api.github.com/users/ngxbac/events{/privacy}","received_events_url":"https://api.github.com/users/ngxbac/received_events","type":"User","site_admin":false},"created_at":"2019-06-02T04:50:16Z","updated_at":"2019-06-02T04:51:02Z","author_association":"CONTRIBUTOR","body":"I hacked the process as following to work with multi GPUs. \r\nI am not sure the final result is wrong or not.\r\n\r\n```\r\ndef process_components(\r\n    model: _Model,\r\n    criterion: _Criterion = None,\r\n    optimizer: _Optimizer = None,\r\n    scheduler: _Scheduler = None,\r\n    distributed_params: Dict = None\r\n) -> Tuple[_Model, _Criterion, _Optimizer, _Scheduler, torch.device]:\r\n\r\n    distributed_params = distributed_params or {}\r\n    distributed_params = copy.deepcopy(distributed_params)\r\n    device = UtilsFactory.get_device()\r\n\r\n    if torch.cuda.is_available():\r\n        cudnn.benchmark = True\r\n\r\n    model = model.to(device)\r\n\r\n    if is_wrapped_with_ddp(model):\r\n        pass\r\n    elif len(distributed_params) > 0:\r\n        UtilsFactory.assert_fp16_available()\r\n        from apex import amp\r\n\r\n        distributed_rank = distributed_params.pop(\"rank\", -1)\r\n\r\n        # if distributed_rank > -1:\r\n        #     torch.cuda.set_device(distributed_rank)\r\n        #     torch.distributed.init_process_group(\r\n        #         backend=\"nccl\", init_method=\"env://\")\r\n\r\n        model, optimizer = amp.initialize(\r\n            model, optimizer, **distributed_params)\r\n\r\n        # if distributed_rank > -1:\r\n            # from apex.parallel import DistributedDataParallel\r\n            # model = DistributedDataParallel(model)\r\n        model = torch.nn.DataParallel(model)\r\n    elif torch.cuda.device_count() > 1:\r\n        model = torch.nn.DataParallel(model)\r\n\r\n    model = model.to(device)\r\n\r\n    return model, criterion, optimizer, scheduler, device\r\n```","reactions":{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/comments/497999045/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ngxbac","id":11550123,"node_id":"MDQ6VXNlcjExNTUwMTIz","avatar_url":"https://avatars.githubusercontent.com/u/11550123?v=4","gravatar_id":"","url":"https://api.github.com/users/ngxbac","html_url":"https://github.com/ngxbac","followers_url":"https://api.github.com/users/ngxbac/followers","following_url":"https://api.github.com/users/ngxbac/following{/other_user}","gists_url":"https://api.github.com/users/ngxbac/gists{/gist_id}","starred_url":"https://api.github.com/users/ngxbac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ngxbac/subscriptions","organizations_url":"https://api.github.com/users/ngxbac/orgs","repos_url":"https://api.github.com/users/ngxbac/repos","events_url":"https://api.github.com/users/ngxbac/events{/privacy}","received_events_url":"https://api.github.com/users/ngxbac/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/comments/498203545","html_url":"https://github.com/catalyst-team/catalyst/issues/209#issuecomment-498203545","issue_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/209","id":498203545,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODIwMzU0NQ==","user":{"login":"Scitator","id":7606451,"node_id":"MDQ6VXNlcjc2MDY0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/7606451?v=4","gravatar_id":"","url":"https://api.github.com/users/Scitator","html_url":"https://github.com/Scitator","followers_url":"https://api.github.com/users/Scitator/followers","following_url":"https://api.github.com/users/Scitator/following{/other_user}","gists_url":"https://api.github.com/users/Scitator/gists{/gist_id}","starred_url":"https://api.github.com/users/Scitator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Scitator/subscriptions","organizations_url":"https://api.github.com/users/Scitator/orgs","repos_url":"https://api.github.com/users/Scitator/repos","events_url":"https://api.github.com/users/Scitator/events{/privacy}","received_events_url":"https://api.github.com/users/Scitator/received_events","type":"User","site_admin":false},"created_at":"2019-06-03T10:32:00Z","updated_at":"2019-06-03T10:32:00Z","author_association":"MEMBER","body":"Hi,\r\n\r\nSo, for now true distributed training with fp16 support is available thought Config API only, an example bash script available on our [19.06 release notes](https://github.com/catalyst-team/catalyst/releases/tag/v19.06)\r\n\r\nNevertheless, your workaround looks good (and should work fine, I think). I suggest you to contribute this solution with `if torch.cuda.device_count() > 1` check if it's not a distributed training case. ","reactions":{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/comments/498203545/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Scitator","id":7606451,"node_id":"MDQ6VXNlcjc2MDY0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/7606451?v=4","gravatar_id":"","url":"https://api.github.com/users/Scitator","html_url":"https://github.com/Scitator","followers_url":"https://api.github.com/users/Scitator/followers","following_url":"https://api.github.com/users/Scitator/following{/other_user}","gists_url":"https://api.github.com/users/Scitator/gists{/gist_id}","starred_url":"https://api.github.com/users/Scitator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Scitator/subscriptions","organizations_url":"https://api.github.com/users/Scitator/orgs","repos_url":"https://api.github.com/users/Scitator/repos","events_url":"https://api.github.com/users/Scitator/events{/privacy}","received_events_url":"https://api.github.com/users/Scitator/received_events","type":"User","site_admin":false}},{"id":2384432871,"node_id":"MDEyOkxhYmVsZWRFdmVudDIzODQ0MzI4NzE=","url":"https://api.github.com/repos/catalyst-team/catalyst/issues/events/2384432871","actor":{"login":"Scitator","id":7606451,"node_id":"MDQ6VXNlcjc2MDY0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/7606451?v=4","gravatar_id":"","url":"https://api.github.com/users/Scitator","html_url":"https://github.com/Scitator","followers_url":"https://api.github.com/users/Scitator/followers","following_url":"https://api.github.com/users/Scitator/following{/other_user}","gists_url":"https://api.github.com/users/Scitator/gists{/gist_id}","starred_url":"https://api.github.com/users/Scitator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Scitator/subscriptions","organizations_url":"https://api.github.com/users/Scitator/orgs","repos_url":"https://api.github.com/users/Scitator/repos","events_url":"https://api.github.com/users/Scitator/events{/privacy}","received_events_url":"https://api.github.com/users/Scitator/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-06-03T10:32:30Z","label":{"name":"enhancement","color":"a2eeef"},"performed_via_github_app":null},{"id":2384433353,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQyMzg0NDMzMzUz","url":"https://api.github.com/repos/catalyst-team/catalyst/issues/events/2384433353","actor":{"login":"Scitator","id":7606451,"node_id":"MDQ6VXNlcjc2MDY0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/7606451?v=4","gravatar_id":"","url":"https://api.github.com/users/Scitator","html_url":"https://github.com/Scitator","followers_url":"https://api.github.com/users/Scitator/followers","following_url":"https://api.github.com/users/Scitator/following{/other_user}","gists_url":"https://api.github.com/users/Scitator/gists{/gist_id}","starred_url":"https://api.github.com/users/Scitator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Scitator/subscriptions","organizations_url":"https://api.github.com/users/Scitator/orgs","repos_url":"https://api.github.com/users/Scitator/repos","events_url":"https://api.github.com/users/Scitator/events{/privacy}","received_events_url":"https://api.github.com/users/Scitator/received_events","type":"User","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2019-06-03T10:32:43Z","assignee":{"login":"Scitator","id":7606451,"node_id":"MDQ6VXNlcjc2MDY0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/7606451?v=4","gravatar_id":"","url":"https://api.github.com/users/Scitator","html_url":"https://github.com/Scitator","followers_url":"https://api.github.com/users/Scitator/followers","following_url":"https://api.github.com/users/Scitator/following{/other_user}","gists_url":"https://api.github.com/users/Scitator/gists{/gist_id}","starred_url":"https://api.github.com/users/Scitator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Scitator/subscriptions","organizations_url":"https://api.github.com/users/Scitator/orgs","repos_url":"https://api.github.com/users/Scitator/repos","events_url":"https://api.github.com/users/Scitator/events{/privacy}","received_events_url":"https://api.github.com/users/Scitator/received_events","type":"User","site_admin":false},"performed_via_github_app":null},{"actor":{"login":"Scitator","id":7606451,"node_id":"MDQ6VXNlcjc2MDY0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/7606451?v=4","gravatar_id":"","url":"https://api.github.com/users/Scitator","html_url":"https://github.com/Scitator","followers_url":"https://api.github.com/users/Scitator/followers","following_url":"https://api.github.com/users/Scitator/following{/other_user}","gists_url":"https://api.github.com/users/Scitator/gists{/gist_id}","starred_url":"https://api.github.com/users/Scitator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Scitator/subscriptions","organizations_url":"https://api.github.com/users/Scitator/orgs","repos_url":"https://api.github.com/users/Scitator/repos","events_url":"https://api.github.com/users/Scitator/events{/privacy}","received_events_url":"https://api.github.com/users/Scitator/received_events","type":"User","site_admin":false},"created_at":"2019-06-04T04:34:53Z","updated_at":"2019-06-04T04:34:53Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/213","repository_url":"https://api.github.com/repos/catalyst-team/catalyst","labels_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/213/labels{/name}","comments_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/213/comments","events_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/213/events","html_url":"https://github.com/catalyst-team/catalyst/pull/213","id":451793712,"node_id":"MDExOlB1bGxSZXF1ZXN0Mjg0ODEyMjE1","number":213,"title":"DataParallel for fp16 apex","user":{"login":"Scitator","id":7606451,"node_id":"MDQ6VXNlcjc2MDY0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/7606451?v=4","gravatar_id":"","url":"https://api.github.com/users/Scitator","html_url":"https://github.com/Scitator","followers_url":"https://api.github.com/users/Scitator/followers","following_url":"https://api.github.com/users/Scitator/following{/other_user}","gists_url":"https://api.github.com/users/Scitator/gists{/gist_id}","starred_url":"https://api.github.com/users/Scitator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Scitator/subscriptions","organizations_url":"https://api.github.com/users/Scitator/orgs","repos_url":"https://api.github.com/users/Scitator/repos","events_url":"https://api.github.com/users/Scitator/events{/privacy}","received_events_url":"https://api.github.com/users/Scitator/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2019-06-04T04:34:53Z","updated_at":"2019-06-04T07:44:51Z","closed_at":"2019-06-04T05:03:36Z","author_association":"MEMBER","active_lock_reason":null,"draft":false,"repository":{"id":145385156,"node_id":"MDEwOlJlcG9zaXRvcnkxNDUzODUxNTY=","name":"catalyst","full_name":"catalyst-team/catalyst","private":false,"owner":{"login":"catalyst-team","id":46644555,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ2NjQ0NTU1","avatar_url":"https://avatars.githubusercontent.com/u/46644555?v=4","gravatar_id":"","url":"https://api.github.com/users/catalyst-team","html_url":"https://github.com/catalyst-team","followers_url":"https://api.github.com/users/catalyst-team/followers","following_url":"https://api.github.com/users/catalyst-team/following{/other_user}","gists_url":"https://api.github.com/users/catalyst-team/gists{/gist_id}","starred_url":"https://api.github.com/users/catalyst-team/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/catalyst-team/subscriptions","organizations_url":"https://api.github.com/users/catalyst-team/orgs","repos_url":"https://api.github.com/users/catalyst-team/repos","events_url":"https://api.github.com/users/catalyst-team/events{/privacy}","received_events_url":"https://api.github.com/users/catalyst-team/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/catalyst-team/catalyst","description":"Accelerated deep learning R&D","fork":false,"url":"https://api.github.com/repos/catalyst-team/catalyst","forks_url":"https://api.github.com/repos/catalyst-team/catalyst/forks","keys_url":"https://api.github.com/repos/catalyst-team/catalyst/keys{/key_id}","collaborators_url":"https://api.github.com/repos/catalyst-team/catalyst/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/catalyst-team/catalyst/teams","hooks_url":"https://api.github.com/repos/catalyst-team/catalyst/hooks","issue_events_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/events{/number}","events_url":"https://api.github.com/repos/catalyst-team/catalyst/events","assignees_url":"https://api.github.com/repos/catalyst-team/catalyst/assignees{/user}","branches_url":"https://api.github.com/repos/catalyst-team/catalyst/branches{/branch}","tags_url":"https://api.github.com/repos/catalyst-team/catalyst/tags","blobs_url":"https://api.github.com/repos/catalyst-team/catalyst/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/catalyst-team/catalyst/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/catalyst-team/catalyst/git/refs{/sha}","trees_url":"https://api.github.com/repos/catalyst-team/catalyst/git/trees{/sha}","statuses_url":"https://api.github.com/repos/catalyst-team/catalyst/statuses/{sha}","languages_url":"https://api.github.com/repos/catalyst-team/catalyst/languages","stargazers_url":"https://api.github.com/repos/catalyst-team/catalyst/stargazers","contributors_url":"https://api.github.com/repos/catalyst-team/catalyst/contributors","subscribers_url":"https://api.github.com/repos/catalyst-team/catalyst/subscribers","subscription_url":"https://api.github.com/repos/catalyst-team/catalyst/subscription","commits_url":"https://api.github.com/repos/catalyst-team/catalyst/commits{/sha}","git_commits_url":"https://api.github.com/repos/catalyst-team/catalyst/git/commits{/sha}","comments_url":"https://api.github.com/repos/catalyst-team/catalyst/comments{/number}","issue_comment_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/comments{/number}","contents_url":"https://api.github.com/repos/catalyst-team/catalyst/contents/{+path}","compare_url":"https://api.github.com/repos/catalyst-team/catalyst/compare/{base}...{head}","merges_url":"https://api.github.com/repos/catalyst-team/catalyst/merges","archive_url":"https://api.github.com/repos/catalyst-team/catalyst/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/catalyst-team/catalyst/downloads","issues_url":"https://api.github.com/repos/catalyst-team/catalyst/issues{/number}","pulls_url":"https://api.github.com/repos/catalyst-team/catalyst/pulls{/number}","milestones_url":"https://api.github.com/repos/catalyst-team/catalyst/milestones{/number}","notifications_url":"https://api.github.com/repos/catalyst-team/catalyst/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/catalyst-team/catalyst/labels{/name}","releases_url":"https://api.github.com/repos/catalyst-team/catalyst/releases{/id}","deployments_url":"https://api.github.com/repos/catalyst-team/catalyst/deployments","created_at":"2018-08-20T07:56:13Z","updated_at":"2023-01-18T13:14:34Z","pushed_at":"2023-01-10T09:45:30Z","git_url":"git://github.com/catalyst-team/catalyst.git","ssh_url":"git@github.com:catalyst-team/catalyst.git","clone_url":"https://github.com/catalyst-team/catalyst.git","svn_url":"https://github.com/catalyst-team/catalyst","homepage":"https://catalyst-team.com","size":54739,"stargazers_count":3065,"watchers_count":3065,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":381,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":5,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["computer-vision","deep-learning","distributed-computing","image-classification","image-processing","image-segmentation","information-retrieval","infrastructure","machine-learning","metric-learning","natural-language-processing","object-detection","python","pytorch","recommender-system","reinforcement-learning","reproducibility","research","text-classification","text-segmentation"],"visibility":"public","forks":381,"open_issues":5,"watchers":3065,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/catalyst-team/catalyst/pulls/213","html_url":"https://github.com/catalyst-team/catalyst/pull/213","diff_url":"https://github.com/catalyst-team/catalyst/pull/213.diff","patch_url":"https://github.com/catalyst-team/catalyst/pull/213.patch","merged_at":"2019-06-04T05:03:36Z"},"body":"Fix for https://github.com/catalyst-team/catalyst/issues/209","reactions":{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/213/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/213/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":2393161489,"node_id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50MjM5MzE2MTQ4OQ==","url":"https://api.github.com/repos/catalyst-team/catalyst/issues/events/2393161489","actor":{"login":"Scitator","id":7606451,"node_id":"MDQ6VXNlcjc2MDY0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/7606451?v=4","gravatar_id":"","url":"https://api.github.com/users/Scitator","html_url":"https://github.com/Scitator","followers_url":"https://api.github.com/users/Scitator/followers","following_url":"https://api.github.com/users/Scitator/following{/other_user}","gists_url":"https://api.github.com/users/Scitator/gists{/gist_id}","starred_url":"https://api.github.com/users/Scitator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Scitator/subscriptions","organizations_url":"https://api.github.com/users/Scitator/orgs","repos_url":"https://api.github.com/users/Scitator/repos","events_url":"https://api.github.com/users/Scitator/events{/privacy}","received_events_url":"https://api.github.com/users/Scitator/received_events","type":"User","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2019-06-06T04:46:53Z","rename":{"from":"Multi-GPUs with Apex FP16","to":"[solved] Multi-GPUs with Apex FP16"},"performed_via_github_app":null},{"id":2393161582,"node_id":"MDExOkNsb3NlZEV2ZW50MjM5MzE2MTU4Mg==","url":"https://api.github.com/repos/catalyst-team/catalyst/issues/events/2393161582","actor":{"login":"Scitator","id":7606451,"node_id":"MDQ6VXNlcjc2MDY0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/7606451?v=4","gravatar_id":"","url":"https://api.github.com/users/Scitator","html_url":"https://github.com/Scitator","followers_url":"https://api.github.com/users/Scitator/followers","following_url":"https://api.github.com/users/Scitator/following{/other_user}","gists_url":"https://api.github.com/users/Scitator/gists{/gist_id}","starred_url":"https://api.github.com/users/Scitator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Scitator/subscriptions","organizations_url":"https://api.github.com/users/Scitator/orgs","repos_url":"https://api.github.com/users/Scitator/repos","events_url":"https://api.github.com/users/Scitator/events{/privacy}","received_events_url":"https://api.github.com/users/Scitator/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-06-06T04:46:58Z","state_reason":null,"performed_via_github_app":null}]