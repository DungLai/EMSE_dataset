{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1119","repository_url":"https://api.github.com/repos/catalyst-team/catalyst","labels_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1119/labels{/name}","comments_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1119/comments","events_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1119/events","html_url":"https://github.com/catalyst-team/catalyst/issues/1119","id":830984804,"node_id":"MDU6SXNzdWU4MzA5ODQ4MDQ=","number":1119,"title":"Documentation broken at several instances","user":{"login":"Binbose","id":25252778,"node_id":"MDQ6VXNlcjI1MjUyNzc4","avatar_url":"https://avatars.githubusercontent.com/u/25252778?v=4","gravatar_id":"","url":"https://api.github.com/users/Binbose","html_url":"https://github.com/Binbose","followers_url":"https://api.github.com/users/Binbose/followers","following_url":"https://api.github.com/users/Binbose/following{/other_user}","gists_url":"https://api.github.com/users/Binbose/gists{/gist_id}","starred_url":"https://api.github.com/users/Binbose/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Binbose/subscriptions","organizations_url":"https://api.github.com/users/Binbose/orgs","repos_url":"https://api.github.com/users/Binbose/repos","events_url":"https://api.github.com/users/Binbose/events{/privacy}","received_events_url":"https://api.github.com/users/Binbose/received_events","type":"User","site_admin":false},"labels":[{"id":1029400270,"node_id":"MDU6TGFiZWwxMDI5NDAwMjcw","url":"https://api.github.com/repos/catalyst-team/catalyst/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1029400273,"node_id":"MDU6TGFiZWwxMDI5NDAwMjcz","url":"https://api.github.com/repos/catalyst-team/catalyst/labels/help%20wanted","name":"help wanted","color":"008672","default":true,"description":"Extra attention is needed"}],"state":"closed","locked":false,"assignee":{"login":"bagxi","id":19803638,"node_id":"MDQ6VXNlcjE5ODAzNjM4","avatar_url":"https://avatars.githubusercontent.com/u/19803638?v=4","gravatar_id":"","url":"https://api.github.com/users/bagxi","html_url":"https://github.com/bagxi","followers_url":"https://api.github.com/users/bagxi/followers","following_url":"https://api.github.com/users/bagxi/following{/other_user}","gists_url":"https://api.github.com/users/bagxi/gists{/gist_id}","starred_url":"https://api.github.com/users/bagxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagxi/subscriptions","organizations_url":"https://api.github.com/users/bagxi/orgs","repos_url":"https://api.github.com/users/bagxi/repos","events_url":"https://api.github.com/users/bagxi/events{/privacy}","received_events_url":"https://api.github.com/users/bagxi/received_events","type":"User","site_admin":false},"assignees":[{"login":"ditwoo","id":7264490,"node_id":"MDQ6VXNlcjcyNjQ0OTA=","avatar_url":"https://avatars.githubusercontent.com/u/7264490?v=4","gravatar_id":"","url":"https://api.github.com/users/ditwoo","html_url":"https://github.com/ditwoo","followers_url":"https://api.github.com/users/ditwoo/followers","following_url":"https://api.github.com/users/ditwoo/following{/other_user}","gists_url":"https://api.github.com/users/ditwoo/gists{/gist_id}","starred_url":"https://api.github.com/users/ditwoo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ditwoo/subscriptions","organizations_url":"https://api.github.com/users/ditwoo/orgs","repos_url":"https://api.github.com/users/ditwoo/repos","events_url":"https://api.github.com/users/ditwoo/events{/privacy}","received_events_url":"https://api.github.com/users/ditwoo/received_events","type":"User","site_admin":false},{"login":"Scitator","id":7606451,"node_id":"MDQ6VXNlcjc2MDY0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/7606451?v=4","gravatar_id":"","url":"https://api.github.com/users/Scitator","html_url":"https://github.com/Scitator","followers_url":"https://api.github.com/users/Scitator/followers","following_url":"https://api.github.com/users/Scitator/following{/other_user}","gists_url":"https://api.github.com/users/Scitator/gists{/gist_id}","starred_url":"https://api.github.com/users/Scitator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Scitator/subscriptions","organizations_url":"https://api.github.com/users/Scitator/orgs","repos_url":"https://api.github.com/users/Scitator/repos","events_url":"https://api.github.com/users/Scitator/events{/privacy}","received_events_url":"https://api.github.com/users/Scitator/received_events","type":"User","site_admin":false},{"login":"bagxi","id":19803638,"node_id":"MDQ6VXNlcjE5ODAzNjM4","avatar_url":"https://avatars.githubusercontent.com/u/19803638?v=4","gravatar_id":"","url":"https://api.github.com/users/bagxi","html_url":"https://github.com/bagxi","followers_url":"https://api.github.com/users/bagxi/followers","following_url":"https://api.github.com/users/bagxi/following{/other_user}","gists_url":"https://api.github.com/users/bagxi/gists{/gist_id}","starred_url":"https://api.github.com/users/bagxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagxi/subscriptions","organizations_url":"https://api.github.com/users/bagxi/orgs","repos_url":"https://api.github.com/users/bagxi/repos","events_url":"https://api.github.com/users/bagxi/events{/privacy}","received_events_url":"https://api.github.com/users/bagxi/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2021-03-13T20:18:08Z","updated_at":"2021-03-15T06:53:58Z","closed_at":"2021-03-15T06:53:58Z","author_association":"NONE","active_lock_reason":null,"body":"## üêõ Bug Report\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\nI am trying to get a simple segmentation model to work, but the documentation and all examples I found seem to be a bit outdated. Here is a collection of things that seem to not work (anymore), that I found before I gave up.\r\n\r\nIn the examples for segmentation on the catalyst github page you import \r\n`from catalyst.data.transforms import ToTensor`\r\nwhich fails with \r\n`ModuleNotFoundError: No module named 'catalyst.data.transforms'`\r\nWhich I fixed by using\r\n`from catalyst.contrib.data.cv import ToTensor`\r\n\r\n\r\nNext, when running:\r\n`runner = dl.SupervisedRunner(input_key=\"features\", output_key=\"logits\", target_key=\"targets\", loss_key=\"loss\")`\r\nI get the error\r\n`TypeError: __init__() got an unexpected keyword argument 'target_key'`\r\nLooking into the code, I changed target_key to input_target_key, I don't know if that is the right one though. But nevertheless, after that, I got the error\r\n`TypeError: __init__() got an unexpected keyword argument 'loss_key'`\r\nIn the source code I couldn't find anything similar, so I just deleted the argument.\r\nNow I got the error \r\n`AttributeError: module 'catalyst.dl' has no attribute 'IOUCallback'`\r\nAt this point I gave up, and instead tried this colab notebook I found on the pytorch toolbelt github page:\r\nhttps://colab.research.google.com/drive/1OUPJYU7TzH5Vz1si6FBkooackuIlzaGr#scrollTo=7b9UfZkNmYv_\r\n\r\nI tried to adapt it using\r\n```\r\noptimizer = Adam(model.parameters(), lr=1e-3)\r\nscheduler = ReduceLROnPlateau(optimizer, mode='max', patience=5, factor=0.2)\r\nearly_stopping = EarlyStoppingCallback(patience=20, metric='iou', minimize=False)\r\n\r\n# model training\r\nrunner = SupervisedRunner()\r\nrunner.train(\r\n    model=model,\r\n    criterion=nn.CrossEntropyLoss(),\r\n    optimizer=optimizer,\r\n    callbacks=[\r\n        early_stopping,\r\n        SchedulerCallback(reduced_metric='iou'),\r\n    ],\r\n    logdir='runs/UNet/baseline',\r\n    loaders=data_loaders,\r\n    num_epochs=num_epochs,\r\n    scheduler=scheduler,\r\n    verbose=False,\r\n    main_metric='iou',\r\n    minimize_metric=False\r\n)\r\n```\r\nbut got the error:\r\n```\r\nAssertionError                            Traceback (most recent call last)\r\n<ipython-input-20-88c36aa1005e> in <module>\r\n     11 # model training\r\n     12 runner = SupervisedRunner()\r\n---> 13 runner.train(\r\n     14     model=model,\r\n     15     criterion=nn.CrossEntropyLoss(),\r\n\r\n~/anaconda3/envs/mol2str/lib/python3.9/site-packages/catalyst/runners/runner.py in train(self, model, criterion, optimizer, scheduler, datasets, loaders, callbacks, logdir, resume, num_epochs, valid_loader, main_metric, minimize_metric, verbose, stage_kwargs, checkpoint_data, fp16, distributed, check, overfit, timeit, load_best_on_end, initial_seed, state_kwargs)\r\n    212         )\r\n    213         self.experiment = experiment\r\n--> 214         distributed_cmd_run(self.run_experiment, distributed)\r\n    215 \r\n    216     def infer(\r\n\r\n~/anaconda3/envs/mol2str/lib/python3.9/site-packages/catalyst/utils/scripts.py in distributed_cmd_run(worker_fn, distributed, *args, **kwargs)\r\n    176         or world_size <= 1\r\n    177     ):\r\n--> 178         worker_fn(*args, **kwargs)\r\n    179     elif local_rank is not None:\r\n    180         torch.cuda.set_device(int(local_rank))\r\n\r\n~/anaconda3/envs/mol2str/lib/python3.9/site-packages/catalyst/core/runner.py in run_experiment(self, experiment)\r\n    827         except (Exception, KeyboardInterrupt) as ex:\r\n    828             self.exception = ex\r\n--> 829             self._run_event(\"on_exception\")\r\n    830         return self\r\n    831 \r\n\r\n~/anaconda3/envs/mol2str/lib/python3.9/site-packages/catalyst/core/runner.py in _run_event(self, event)\r\n    756             getattr(self, event)(self)\r\n    757         for callback in self.callbacks.values():\r\n--> 758             getattr(callback, event)(self)\r\n    759         if _is_substring(event, (\"end\",)):\r\n    760             getattr(self, event)(self)\r\n\r\n~/anaconda3/envs/mol2str/lib/python3.9/site-packages/catalyst/callbacks/exception.py in on_exception(self, runner)\r\n     32 \r\n     33         if runner.need_exception_reraise:\r\n---> 34             raise exception\r\n     35 \r\n     36 \r\n\r\n~/anaconda3/envs/mol2str/lib/python3.9/site-packages/catalyst/core/runner.py in run_experiment(self, experiment)\r\n    824         self.experiment = experiment or self.experiment\r\n    825         try:\r\n--> 826             self._run_experiment()\r\n    827         except (Exception, KeyboardInterrupt) as ex:\r\n    828             self.exception = ex\r\n\r\n~/anaconda3/envs/mol2str/lib/python3.9/site-packages/catalyst/core/runner.py in _run_experiment(self)\r\n    809         self._run_event(\"on_experiment_start\")\r\n    810         for self.stage in self.experiment.stages:\r\n--> 811             self._run_stage()\r\n    812         self._run_event(\"on_experiment_end\")\r\n    813 \r\n\r\n~/anaconda3/envs/mol2str/lib/python3.9/site-packages/catalyst/core/runner.py in _run_stage(self)\r\n    800         self._run_event(\"on_stage_start\")\r\n    801         while self.epoch < self.num_epochs + 1:\r\n--> 802             self._run_epoch()\r\n    803             if self.need_early_stop:\r\n    804                 self.need_early_stop = False\r\n\r\n~/anaconda3/envs/mol2str/lib/python3.9/site-packages/catalyst/core/runner.py in _run_epoch(self)\r\n    795         for self.loader_key, self.loader in self.loaders.items():\r\n    796             self._run_loader()\r\n--> 797         self._run_event(\"on_epoch_end\")\r\n    798 \r\n    799     def _run_stage(self) -> None:\r\n\r\n~/anaconda3/envs/mol2str/lib/python3.9/site-packages/catalyst/core/runner.py in _run_event(self, event)\r\n    756             getattr(self, event)(self)\r\n    757         for callback in self.callbacks.values():\r\n--> 758             getattr(callback, event)(self)\r\n    759         if _is_substring(event, (\"end\",)):\r\n    760             getattr(self, event)(self)\r\n\r\n~/anaconda3/envs/mol2str/lib/python3.9/site-packages/catalyst/callbacks/validation.py in on_epoch_end(self, runner)\r\n     42             if k.startswith(runner.valid_loader)\r\n     43         }\r\n---> 44         assert (\r\n     45             runner.main_metric in runner.valid_metrics\r\n     46         ), f\"{runner.main_metric} value is not available by the epoch end\"\r\n\r\nAssertionError: iou value is not available by the epoch end\r\n```\r\nI also found some other documentation errors, such as in the SchedulerCallback documentation https://catalyst-team.github.io/catalyst/api/callbacks.html?highlight=schedulercallback#catalyst.callbacks.scheduler.SchedulerCallback , the arguments seem to not match the code. Instead of `metic_key` I used `reduced_metric` (adapted from the script above), but I don't actually know if this is doing what it is supposed to.\r\n\r\n\r\n\r\n### How To Reproduce\r\n1. Fresh pip install\r\n2. Run example scripts\r\n\r\n\r\n\r\n#### Code sample\r\n<!-- \r\nIdeally attach a minimal code sample to reproduce the decried issue. \r\nMinimal means having the shortest code but still preserving the bug. \r\nYou could use minimal examples - https://github.com/catalyst-team/catalyst#minimal-examples.\r\n-->\r\n\r\n#### Screenshots\r\n<!-- If applicable, add screenshots to help explain your problem.  -->\r\n\r\n\r\n### Expected behavior\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\n\r\n### Environment\r\n\r\n# example checklist, fill with your info\r\nCatalyst version: 20.04.2\r\nPyTorch version: 1.8.0\r\nTensorFlow version: N/A\r\nTensorBoard version: 2.2.1\r\nOS: Mac OSX 10.15.4\r\nPython version: 3.8\r\n```\r\n\r\n\r\n### Checklist\r\n- [x ] bug description.\r\n- [ ] steps to reproduce.\r\n- [ ] expected behavior.\r\n- [ ] environment.\r\n- [x ] code sample / screenshots.\r\n- [ ] I know, that I could [join Catalyst slack (#__questions channel)](https://join.slack.com/t/catalyst-team-core/shared_invite/zt-d9miirnn-z86oKDzFMKlMG4fgFdZafw) for issue discussion.\r\n","closed_by":{"login":"Scitator","id":7606451,"node_id":"MDQ6VXNlcjc2MDY0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/7606451?v=4","gravatar_id":"","url":"https://api.github.com/users/Scitator","html_url":"https://github.com/Scitator","followers_url":"https://api.github.com/users/Scitator/followers","following_url":"https://api.github.com/users/Scitator/following{/other_user}","gists_url":"https://api.github.com/users/Scitator/gists{/gist_id}","starred_url":"https://api.github.com/users/Scitator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Scitator/subscriptions","organizations_url":"https://api.github.com/users/Scitator/orgs","repos_url":"https://api.github.com/users/Scitator/repos","events_url":"https://api.github.com/users/Scitator/events{/privacy}","received_events_url":"https://api.github.com/users/Scitator/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1119/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1119/timeline","performed_via_github_app":null,"state_reason":"completed"}