{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/655","repository_url":"https://api.github.com/repos/catalyst-team/catalyst","labels_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/655/labels{/name}","comments_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/655/comments","events_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/655/events","html_url":"https://github.com/catalyst-team/catalyst/issues/655","id":563956260,"node_id":"MDU6SXNzdWU1NjM5NTYyNjA=","number":655,"title":"optimize model grads collections","user":{"login":"ogvalt","id":10532355,"node_id":"MDQ6VXNlcjEwNTMyMzU1","avatar_url":"https://avatars.githubusercontent.com/u/10532355?v=4","gravatar_id":"","url":"https://api.github.com/users/ogvalt","html_url":"https://github.com/ogvalt","followers_url":"https://api.github.com/users/ogvalt/followers","following_url":"https://api.github.com/users/ogvalt/following{/other_user}","gists_url":"https://api.github.com/users/ogvalt/gists{/gist_id}","starred_url":"https://api.github.com/users/ogvalt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ogvalt/subscriptions","organizations_url":"https://api.github.com/users/ogvalt/orgs","repos_url":"https://api.github.com/users/ogvalt/repos","events_url":"https://api.github.com/users/ogvalt/events{/privacy}","received_events_url":"https://api.github.com/users/ogvalt/received_events","type":"User","site_admin":false},"labels":[{"id":1029400272,"node_id":"MDU6TGFiZWwxMDI5NDAwMjcy","url":"https://api.github.com/repos/catalyst-team/catalyst/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-02-12T12:07:42Z","updated_at":"2020-04-22T12:45:21Z","closed_at":"2020-04-22T12:45:21Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Is your feature request related to a problem? Please describe.**\r\nI've work with my recent approach to collecting model gradients and find out that is not that optimal (#576 #581 ). \r\nThe main problem is that I need to initialize optimizer in my code with flag save_model_grads an then pass it in callback list. eg:\r\n\r\n```\r\n# train.py\r\noptimizer_with_grad_collection = OptimizerCallback(save_model_grads=True)\r\n...\r\nrunner.train(...\r\ncallbacks = [\r\noptimizer_with_grad_collection,\r\n...\r\n],\r\n)\r\n```\r\n(Also I found that the way that is used to collecting gradients slows down model training and I've already prepared faster solution)\r\n\r\n**Describe the solution you'd like**\r\nI want to rollback some changes that I've done and make everything looks like this:\r\n```\r\n# train.py\r\nrunner.train(\r\nstate_kwargs = {\"model_grads\": {}}\r\n...\r\n)\r\n# optimizer.py\r\nclass OptimizerCallback(Callback):\r\n...\r\ndef on_batch_end(self, state):\r\n...\r\nif hasattr(state, \"model_grads\"):\r\n   # collect grads\r\n```","closed_by":{"login":"Scitator","id":7606451,"node_id":"MDQ6VXNlcjc2MDY0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/7606451?v=4","gravatar_id":"","url":"https://api.github.com/users/Scitator","html_url":"https://github.com/Scitator","followers_url":"https://api.github.com/users/Scitator/followers","following_url":"https://api.github.com/users/Scitator/following{/other_user}","gists_url":"https://api.github.com/users/Scitator/gists{/gist_id}","starred_url":"https://api.github.com/users/Scitator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Scitator/subscriptions","organizations_url":"https://api.github.com/users/Scitator/orgs","repos_url":"https://api.github.com/users/Scitator/repos","events_url":"https://api.github.com/users/Scitator/events{/privacy}","received_events_url":"https://api.github.com/users/Scitator/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/655/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/655/timeline","performed_via_github_app":null,"state_reason":"completed"}