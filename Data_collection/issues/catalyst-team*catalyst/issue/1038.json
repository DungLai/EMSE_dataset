{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1038","repository_url":"https://api.github.com/repos/catalyst-team/catalyst","labels_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1038/labels{/name}","comments_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1038/comments","events_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1038/events","html_url":"https://github.com/catalyst-team/catalyst/issues/1038","id":770945846,"node_id":"MDU6SXNzdWU3NzA5NDU4NDY=","number":1038,"title":"Bug in IoU function","user":{"login":"smivv","id":17829173,"node_id":"MDQ6VXNlcjE3ODI5MTcz","avatar_url":"https://avatars.githubusercontent.com/u/17829173?v=4","gravatar_id":"","url":"https://api.github.com/users/smivv","html_url":"https://github.com/smivv","followers_url":"https://api.github.com/users/smivv/followers","following_url":"https://api.github.com/users/smivv/following{/other_user}","gists_url":"https://api.github.com/users/smivv/gists{/gist_id}","starred_url":"https://api.github.com/users/smivv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smivv/subscriptions","organizations_url":"https://api.github.com/users/smivv/orgs","repos_url":"https://api.github.com/users/smivv/repos","events_url":"https://api.github.com/users/smivv/events{/privacy}","received_events_url":"https://api.github.com/users/smivv/received_events","type":"User","site_admin":false},"labels":[{"id":1029400270,"node_id":"MDU6TGFiZWwxMDI5NDAwMjcw","url":"https://api.github.com/repos/catalyst-team/catalyst/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1029400273,"node_id":"MDU6TGFiZWwxMDI5NDAwMjcz","url":"https://api.github.com/repos/catalyst-team/catalyst/labels/help%20wanted","name":"help wanted","color":"008672","default":true,"description":"Extra attention is needed"}],"state":"closed","locked":false,"assignee":{"login":"bagxi","id":19803638,"node_id":"MDQ6VXNlcjE5ODAzNjM4","avatar_url":"https://avatars.githubusercontent.com/u/19803638?v=4","gravatar_id":"","url":"https://api.github.com/users/bagxi","html_url":"https://github.com/bagxi","followers_url":"https://api.github.com/users/bagxi/followers","following_url":"https://api.github.com/users/bagxi/following{/other_user}","gists_url":"https://api.github.com/users/bagxi/gists{/gist_id}","starred_url":"https://api.github.com/users/bagxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagxi/subscriptions","organizations_url":"https://api.github.com/users/bagxi/orgs","repos_url":"https://api.github.com/users/bagxi/repos","events_url":"https://api.github.com/users/bagxi/events{/privacy}","received_events_url":"https://api.github.com/users/bagxi/received_events","type":"User","site_admin":false},"assignees":[{"login":"ditwoo","id":7264490,"node_id":"MDQ6VXNlcjcyNjQ0OTA=","avatar_url":"https://avatars.githubusercontent.com/u/7264490?v=4","gravatar_id":"","url":"https://api.github.com/users/ditwoo","html_url":"https://github.com/ditwoo","followers_url":"https://api.github.com/users/ditwoo/followers","following_url":"https://api.github.com/users/ditwoo/following{/other_user}","gists_url":"https://api.github.com/users/ditwoo/gists{/gist_id}","starred_url":"https://api.github.com/users/ditwoo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ditwoo/subscriptions","organizations_url":"https://api.github.com/users/ditwoo/orgs","repos_url":"https://api.github.com/users/ditwoo/repos","events_url":"https://api.github.com/users/ditwoo/events{/privacy}","received_events_url":"https://api.github.com/users/ditwoo/received_events","type":"User","site_admin":false},{"login":"Scitator","id":7606451,"node_id":"MDQ6VXNlcjc2MDY0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/7606451?v=4","gravatar_id":"","url":"https://api.github.com/users/Scitator","html_url":"https://github.com/Scitator","followers_url":"https://api.github.com/users/Scitator/followers","following_url":"https://api.github.com/users/Scitator/following{/other_user}","gists_url":"https://api.github.com/users/Scitator/gists{/gist_id}","starred_url":"https://api.github.com/users/Scitator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Scitator/subscriptions","organizations_url":"https://api.github.com/users/Scitator/orgs","repos_url":"https://api.github.com/users/Scitator/repos","events_url":"https://api.github.com/users/Scitator/events{/privacy}","received_events_url":"https://api.github.com/users/Scitator/received_events","type":"User","site_admin":false},{"login":"bagxi","id":19803638,"node_id":"MDQ6VXNlcjE5ODAzNjM4","avatar_url":"https://avatars.githubusercontent.com/u/19803638?v=4","gravatar_id":"","url":"https://api.github.com/users/bagxi","html_url":"https://github.com/bagxi","followers_url":"https://api.github.com/users/bagxi/followers","following_url":"https://api.github.com/users/bagxi/following{/other_user}","gists_url":"https://api.github.com/users/bagxi/gists{/gist_id}","starred_url":"https://api.github.com/users/bagxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagxi/subscriptions","organizations_url":"https://api.github.com/users/bagxi/orgs","repos_url":"https://api.github.com/users/bagxi/repos","events_url":"https://api.github.com/users/bagxi/events{/privacy}","received_events_url":"https://api.github.com/users/bagxi/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2020-12-18T14:49:53Z","updated_at":"2020-12-18T17:36:37Z","closed_at":"2020-12-18T17:36:37Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"## üêõ Bug Report\r\nHello!\r\n\r\nI think current implementation of IoU function is not correct and that's why:\r\n\r\nIf targets and outputs are empty (all zeros), IoU = 1. That's correct.\r\nBut if we set one pixel of outputs equal to 1, we will receive IoU = 0 which is wrong.\r\n\r\n### How To Reproduce\r\n\r\nTo reproduce just run this code in console.\r\n\r\n```\r\nimport torch\r\nfrom catalyst.metrics.iou import iou\r\n\r\noutputs = torch.zeros(size=(32, 3, 224, 224))\r\ntargets = torch.zeros(size=(32, 3, 224, 224))\r\n\r\nprint(f\"Result for empty targets and empty outputs: {iou(outputs, targets, activation='none')}\")\r\n\r\noutputs[0, 0, 0, 0] = torch.tensor(1)\r\n\r\nprint(f\"Result for empty targets and almost empty outputs: {iou(outputs, targets, activation='none')}\")\r\n\r\n# output\r\n# Result for empty targets and empty outputs: 1.0\r\n# Result for empty targets and almost empty outputs: 0.0\r\n```\r\n\r\n### Expected behavior\r\n\r\nI believe it should be ~ 1 in the second case too. So in my understanding we should compare zeros too.\r\nBecause currently if we try to apply this IoU function to binary classification which has zeros targets (empty mask) and output will be good, but with several points (some sort of noise), the result will be closer to 0 than to 1.\r\n\r\n### Environment\r\n\r\n```bash\r\nCatalyst version: 20.11\r\nPyTorch version: 1.7.1\r\nIs debug build: No\r\nCUDA used to build PyTorch: None\r\nTensorFlow version: N/A\r\nTensorBoard version: 2.4.0\r\n\r\nOS: Mac OSX 10.15.7\r\nGCC version: Could not collect\r\nCMake version: Could not collect\r\n\r\nPython version: 3.8\r\nIs CUDA available: No\r\nCUDA runtime version: No CUDA\r\nGPU models and configuration: No CUDA\r\nNvidia driver version: No CUDA\r\ncuDNN version: No CUDA\r\n\r\nVersions of relevant libraries:\r\n[pip3] catalyst==20.11\r\n[pip3] numpy==1.19.4\r\n[pip3] tensorboard==2.4.0\r\n[pip3] tensorboard-plugin-wit==1.7.0\r\n[pip3] tensorboardX==2.1\r\n[pip3] torch==1.7.1\r\n[conda] Could not collect\r\n```\r\n\r\n\r\n### Additional context\r\n\r\n### Checklist\r\n- [x] bug description.\r\n- [x] steps to reproduce.\r\n- [x] expected behavior.\r\n- [x] environment.\r\n- [x] code sample / screenshots.\r\n- [x] I know, that I could [join Catalyst slack (#__questions channel)](https://join.slack.com/t/catalyst-team-core/shared_invite/zt-d9miirnn-z86oKDzFMKlMG4fgFdZafw) for issue discussion.\r\n","closed_by":{"login":"smivv","id":17829173,"node_id":"MDQ6VXNlcjE3ODI5MTcz","avatar_url":"https://avatars.githubusercontent.com/u/17829173?v=4","gravatar_id":"","url":"https://api.github.com/users/smivv","html_url":"https://github.com/smivv","followers_url":"https://api.github.com/users/smivv/followers","following_url":"https://api.github.com/users/smivv/following{/other_user}","gists_url":"https://api.github.com/users/smivv/gists{/gist_id}","starred_url":"https://api.github.com/users/smivv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smivv/subscriptions","organizations_url":"https://api.github.com/users/smivv/orgs","repos_url":"https://api.github.com/users/smivv/repos","events_url":"https://api.github.com/users/smivv/events{/privacy}","received_events_url":"https://api.github.com/users/smivv/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1038/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1038/timeline","performed_via_github_app":null,"state_reason":"completed"}