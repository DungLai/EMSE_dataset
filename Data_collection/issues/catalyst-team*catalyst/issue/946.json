{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/946","repository_url":"https://api.github.com/repos/catalyst-team/catalyst","labels_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/946/labels{/name}","comments_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/946/comments","events_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/946/events","html_url":"https://github.com/catalyst-team/catalyst/issues/946","id":709942873,"node_id":"MDU6SXNzdWU3MDk5NDI4NzM=","number":946,"title":"Multi-GPU train error","user":{"login":"adriangrepo","id":37989457,"node_id":"MDQ6VXNlcjM3OTg5NDU3","avatar_url":"https://avatars.githubusercontent.com/u/37989457?v=4","gravatar_id":"","url":"https://api.github.com/users/adriangrepo","html_url":"https://github.com/adriangrepo","followers_url":"https://api.github.com/users/adriangrepo/followers","following_url":"https://api.github.com/users/adriangrepo/following{/other_user}","gists_url":"https://api.github.com/users/adriangrepo/gists{/gist_id}","starred_url":"https://api.github.com/users/adriangrepo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adriangrepo/subscriptions","organizations_url":"https://api.github.com/users/adriangrepo/orgs","repos_url":"https://api.github.com/users/adriangrepo/repos","events_url":"https://api.github.com/users/adriangrepo/events{/privacy}","received_events_url":"https://api.github.com/users/adriangrepo/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"ditwoo","id":7264490,"node_id":"MDQ6VXNlcjcyNjQ0OTA=","avatar_url":"https://avatars.githubusercontent.com/u/7264490?v=4","gravatar_id":"","url":"https://api.github.com/users/ditwoo","html_url":"https://github.com/ditwoo","followers_url":"https://api.github.com/users/ditwoo/followers","following_url":"https://api.github.com/users/ditwoo/following{/other_user}","gists_url":"https://api.github.com/users/ditwoo/gists{/gist_id}","starred_url":"https://api.github.com/users/ditwoo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ditwoo/subscriptions","organizations_url":"https://api.github.com/users/ditwoo/orgs","repos_url":"https://api.github.com/users/ditwoo/repos","events_url":"https://api.github.com/users/ditwoo/events{/privacy}","received_events_url":"https://api.github.com/users/ditwoo/received_events","type":"User","site_admin":false},"assignees":[{"login":"ditwoo","id":7264490,"node_id":"MDQ6VXNlcjcyNjQ0OTA=","avatar_url":"https://avatars.githubusercontent.com/u/7264490?v=4","gravatar_id":"","url":"https://api.github.com/users/ditwoo","html_url":"https://github.com/ditwoo","followers_url":"https://api.github.com/users/ditwoo/followers","following_url":"https://api.github.com/users/ditwoo/following{/other_user}","gists_url":"https://api.github.com/users/ditwoo/gists{/gist_id}","starred_url":"https://api.github.com/users/ditwoo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ditwoo/subscriptions","organizations_url":"https://api.github.com/users/ditwoo/orgs","repos_url":"https://api.github.com/users/ditwoo/repos","events_url":"https://api.github.com/users/ditwoo/events{/privacy}","received_events_url":"https://api.github.com/users/ditwoo/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2020-09-28T05:26:33Z","updated_at":"2020-09-28T08:11:21Z","closed_at":"2020-09-28T08:10:59Z","author_association":"NONE","active_lock_reason":null,"body":"Similar to closed issue #334.\r\n\r\ntorch: 1.6.0, catalyst: 20.09.1, Ubuntu 18.04, cuda toolkit 10.2\r\n\r\nOn running the classification-tutorial.ipynb on local machine runs fine with 1 GPU, but with multiple GPU's get the following error:\r\n\r\n```\r\nRuntimeError: Caught RuntimeError in replica 1 on device 1.\r\nOriginal Traceback (most recent call last):\r\n  File \"/home/me/miniconda3/envs/catalyst/lib/python3.8/site-packages/torch/nn/parallel/parallel_apply.py\", line 60, in _worker\r\n    output = module(*input, **kwargs)\r\n  File \"/home/me/miniconda3/envs/catalyst/lib/python3.8/site-packages/torch/nn/modules/module.py\", line 722, in _call_impl\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/home/me/miniconda3/envs/catalyst/lib/python3.8/site-packages/pretrainedmodels/models/torchvision_models.py\", line 340, in forward\r\n    x = self.features(input)\r\n  File \"/home/me/miniconda3/envs/catalyst/lib/python3.8/site-packages/pretrainedmodels/models/torchvision_models.py\", line 322, in features\r\n    x = self.conv1(input)\r\n  File \"/home/me/miniconda3/envs/catalyst/lib/python3.8/site-packages/torch/nn/modules/module.py\", line 722, in _call_impl\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/home/me/miniconda3/envs/catalyst/lib/python3.8/site-packages/torch/nn/modules/conv.py\", line 419, in forward\r\n    return self._conv_forward(input, self.weight)\r\n  File \"/home/me/miniconda3/envs/catalyst/lib/python3.8/site-packages/torch/nn/modules/conv.py\", line 415, in _conv_forward\r\n    return F.conv2d(input, weight, self.bias, self.stride,\r\nRuntimeError: Expected tensor for argument #1 'input' to have the same device as tensor for argument #2 'weight'; but device 1 does not equal 0 (while checking arguments for cudnn_convolution)\r\n\r\n```\r\n\r\nSetup:\r\n```\r\nos.environ[\"CUDA_VISIBLE_DEVICES\"] = \"0,1\"  \r\ntorch.cuda.device_count()\r\n->2\r\n```\r\n\r\nI dont have a colab paid account to test multi-gpu option on colab.\r\n\r\nThe following tests wotk fine with multi-GPU's:\r\n\r\n```\r\nUSE_APEX=\"1\" USE_DDP=\"1\" CUDA_VISIBLE_DEVICES=\"0,1\"     bash ./bin/tests/check_dl_core_.sh\r\n```\r\n\r\nI can confirm that multi-gpu also works OK with pytorch-lightning on this machine. \r\n\r\nAny ideas to help debug this?\r\n","closed_by":{"login":"adriangrepo","id":37989457,"node_id":"MDQ6VXNlcjM3OTg5NDU3","avatar_url":"https://avatars.githubusercontent.com/u/37989457?v=4","gravatar_id":"","url":"https://api.github.com/users/adriangrepo","html_url":"https://github.com/adriangrepo","followers_url":"https://api.github.com/users/adriangrepo/followers","following_url":"https://api.github.com/users/adriangrepo/following{/other_user}","gists_url":"https://api.github.com/users/adriangrepo/gists{/gist_id}","starred_url":"https://api.github.com/users/adriangrepo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adriangrepo/subscriptions","organizations_url":"https://api.github.com/users/adriangrepo/orgs","repos_url":"https://api.github.com/users/adriangrepo/repos","events_url":"https://api.github.com/users/adriangrepo/events{/privacy}","received_events_url":"https://api.github.com/users/adriangrepo/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/946/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/946/timeline","performed_via_github_app":null,"state_reason":"completed"}