{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1391","repository_url":"https://api.github.com/repos/catalyst-team/catalyst","labels_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1391/labels{/name}","comments_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1391/comments","events_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1391/events","html_url":"https://github.com/catalyst-team/catalyst/issues/1391","id":1110046365,"node_id":"I_kwDOCKpmxM5CKfad","number":1391,"title":"MultilabelPrecisionRecallF1SupportCallback do not working","user":{"login":"Inkorak","id":52286717,"node_id":"MDQ6VXNlcjUyMjg2NzE3","avatar_url":"https://avatars.githubusercontent.com/u/52286717?v=4","gravatar_id":"","url":"https://api.github.com/users/Inkorak","html_url":"https://github.com/Inkorak","followers_url":"https://api.github.com/users/Inkorak/followers","following_url":"https://api.github.com/users/Inkorak/following{/other_user}","gists_url":"https://api.github.com/users/Inkorak/gists{/gist_id}","starred_url":"https://api.github.com/users/Inkorak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Inkorak/subscriptions","organizations_url":"https://api.github.com/users/Inkorak/orgs","repos_url":"https://api.github.com/users/Inkorak/repos","events_url":"https://api.github.com/users/Inkorak/events{/privacy}","received_events_url":"https://api.github.com/users/Inkorak/received_events","type":"User","site_admin":false},"labels":[{"id":1029400270,"node_id":"MDU6TGFiZWwxMDI5NDAwMjcw","url":"https://api.github.com/repos/catalyst-team/catalyst/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1029400273,"node_id":"MDU6TGFiZWwxMDI5NDAwMjcz","url":"https://api.github.com/repos/catalyst-team/catalyst/labels/help%20wanted","name":"help wanted","color":"008672","default":true,"description":"Extra attention is needed"}],"state":"closed","locked":false,"assignee":{"login":"bagxi","id":19803638,"node_id":"MDQ6VXNlcjE5ODAzNjM4","avatar_url":"https://avatars.githubusercontent.com/u/19803638?v=4","gravatar_id":"","url":"https://api.github.com/users/bagxi","html_url":"https://github.com/bagxi","followers_url":"https://api.github.com/users/bagxi/followers","following_url":"https://api.github.com/users/bagxi/following{/other_user}","gists_url":"https://api.github.com/users/bagxi/gists{/gist_id}","starred_url":"https://api.github.com/users/bagxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagxi/subscriptions","organizations_url":"https://api.github.com/users/bagxi/orgs","repos_url":"https://api.github.com/users/bagxi/repos","events_url":"https://api.github.com/users/bagxi/events{/privacy}","received_events_url":"https://api.github.com/users/bagxi/received_events","type":"User","site_admin":false},"assignees":[{"login":"ditwoo","id":7264490,"node_id":"MDQ6VXNlcjcyNjQ0OTA=","avatar_url":"https://avatars.githubusercontent.com/u/7264490?v=4","gravatar_id":"","url":"https://api.github.com/users/ditwoo","html_url":"https://github.com/ditwoo","followers_url":"https://api.github.com/users/ditwoo/followers","following_url":"https://api.github.com/users/ditwoo/following{/other_user}","gists_url":"https://api.github.com/users/ditwoo/gists{/gist_id}","starred_url":"https://api.github.com/users/ditwoo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ditwoo/subscriptions","organizations_url":"https://api.github.com/users/ditwoo/orgs","repos_url":"https://api.github.com/users/ditwoo/repos","events_url":"https://api.github.com/users/ditwoo/events{/privacy}","received_events_url":"https://api.github.com/users/ditwoo/received_events","type":"User","site_admin":false},{"login":"Scitator","id":7606451,"node_id":"MDQ6VXNlcjc2MDY0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/7606451?v=4","gravatar_id":"","url":"https://api.github.com/users/Scitator","html_url":"https://github.com/Scitator","followers_url":"https://api.github.com/users/Scitator/followers","following_url":"https://api.github.com/users/Scitator/following{/other_user}","gists_url":"https://api.github.com/users/Scitator/gists{/gist_id}","starred_url":"https://api.github.com/users/Scitator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Scitator/subscriptions","organizations_url":"https://api.github.com/users/Scitator/orgs","repos_url":"https://api.github.com/users/Scitator/repos","events_url":"https://api.github.com/users/Scitator/events{/privacy}","received_events_url":"https://api.github.com/users/Scitator/received_events","type":"User","site_admin":false},{"login":"bagxi","id":19803638,"node_id":"MDQ6VXNlcjE5ODAzNjM4","avatar_url":"https://avatars.githubusercontent.com/u/19803638?v=4","gravatar_id":"","url":"https://api.github.com/users/bagxi","html_url":"https://github.com/bagxi","followers_url":"https://api.github.com/users/bagxi/followers","following_url":"https://api.github.com/users/bagxi/following{/other_user}","gists_url":"https://api.github.com/users/bagxi/gists{/gist_id}","starred_url":"https://api.github.com/users/bagxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagxi/subscriptions","organizations_url":"https://api.github.com/users/bagxi/orgs","repos_url":"https://api.github.com/users/bagxi/repos","events_url":"https://api.github.com/users/bagxi/events{/privacy}","received_events_url":"https://api.github.com/users/bagxi/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2022-01-21T04:33:06Z","updated_at":"2022-01-25T05:01:54Z","closed_at":"2022-01-24T22:15:19Z","author_association":"NONE","active_lock_reason":null,"body":"## 🐛 Bug Report\r\nFirst, it has no threshold argument, as shown in the minimal example.\r\nAnd if we fix it and use it without threshold argument. All metrics are always zero\r\nAnd if you add an argument with the num_classes, then nothing changes either. The metrics are still zero.\r\n\r\n### How To Reproduce\r\nJust use minimal example in your docs for multilabel classification with MultilabelPrecisionRecallF1SupportCallback.\r\n\r\n#### Code sample\r\n```\r\nimport torch\r\nfrom torch.utils.data import DataLoader, TensorDataset\r\nfrom catalyst import dl\r\n\r\n# sample data\r\nnum_samples, num_features, num_classes = int(1e4), int(1e1), 4\r\nX = torch.rand(num_samples, num_features)\r\ny = (torch.rand(num_samples, num_classes) > 0.5).to(torch.float32)\r\n\r\n# pytorch loaders\r\ndataset = TensorDataset(X, y)\r\nloader = DataLoader(dataset, batch_size=32, num_workers=1)\r\nloaders = {\"train\": loader, \"valid\": loader}\r\n\r\n# model, criterion, optimizer, scheduler\r\nmodel = torch.nn.Linear(num_features, num_classes)\r\ncriterion = torch.nn.BCEWithLogitsLoss()\r\noptimizer = torch.optim.Adam(model.parameters())\r\nscheduler = torch.optim.lr_scheduler.MultiStepLR(optimizer, [2])\r\n\r\n# model training\r\nrunner = dl.SupervisedRunner(\r\n    input_key=\"features\", output_key=\"logits\", target_key=\"targets\", loss_key=\"loss\"\r\n)\r\nrunner.train(\r\n    model=model,\r\n    criterion=criterion,\r\n    optimizer=optimizer,\r\n    scheduler=scheduler,\r\n    loaders=loaders,\r\n    logdir=\"./logdir\",\r\n    num_epochs=3,\r\n    valid_loader=\"valid\",\r\n    valid_metric=\"accuracy\",\r\n    minimize_valid_metric=False,\r\n    verbose=True,\r\n    callbacks=[\r\n        dl.BatchTransformCallback(\r\n            transform=torch.sigmoid,\r\n            scope=\"on_batch_end\",\r\n            input_key=\"logits\",\r\n            output_key=\"scores\"\r\n        ),\r\n        dl.AUCCallback(input_key=\"scores\", target_key=\"targets\"),\r\n        # uncomment for extra metrics:\r\n        dl.MultilabelAccuracyCallback(input_key=\"scores\", target_key=\"targets\", threshold=0.5),\r\n        dl.MultilabelPrecisionRecallF1SupportCallback(\r\n             input_key=\"scores\", target_key=\"targets\", \r\n         ),\r\n    ]\r\n)\r\n\r\n```\r\n### Expected behavior\r\nI expect it to work.\r\n\r\n### Environment\r\nCatalyst version: 21.12\r\nPyTorch version: 1.10.0+cu111\r\nIs debug build: No\r\nCUDA used to build PyTorch: 11.1\r\nTensorFlow version: 2.7.0\r\nTensorBoard version: 2.7.0\r\n\r\nOS: Ubuntu 18.04.5 LTS\r\nGCC version: (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0\r\nCMake version: version 3.12.0\r\n\r\nPython version: 3.7\r\nIs CUDA available: No\r\nCUDA runtime version: No CUDA\r\nGPU models and configuration: No CUDA\r\nNvidia driver version: No CUDA\r\ncuDNN version: No CUDA\r\n\r\n### Checklist\r\n- [x] bug description\r\n- [x] steps to reproduce\r\n- [ ] expected behavior\r\n- [x] environment\r\n- [ ] code sample / screenshots\r\n  \r\n### FAQ\r\nPlease review the FAQ before submitting an issue:\r\n- [x] I have read the [documentation and FAQ](https://catalyst-team.github.io/catalyst/)\r\n- [x] I have reviewed the [minimal examples section](https://github.com/catalyst-team/catalyst#minimal-examples)\r\n- [ ] I have checked the [changelog](https://github.com/catalyst-team/catalyst/blob/master/CHANGELOG.md) for main framework updates\r\n- [ ] I have read the [contribution guide](https://github.com/catalyst-team/catalyst/blob/master/CONTRIBUTING.md)\r\n- [ ] I have joined [Catalyst slack (#__questions channel)](https://join.slack.com/t/catalyst-team-core/shared_invite/zt-d9miirnn-z86oKDzFMKlMG4fgFdZafw) for issue discussion","closed_by":{"login":"bagxi","id":19803638,"node_id":"MDQ6VXNlcjE5ODAzNjM4","avatar_url":"https://avatars.githubusercontent.com/u/19803638?v=4","gravatar_id":"","url":"https://api.github.com/users/bagxi","html_url":"https://github.com/bagxi","followers_url":"https://api.github.com/users/bagxi/followers","following_url":"https://api.github.com/users/bagxi/following{/other_user}","gists_url":"https://api.github.com/users/bagxi/gists{/gist_id}","starred_url":"https://api.github.com/users/bagxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagxi/subscriptions","organizations_url":"https://api.github.com/users/bagxi/orgs","repos_url":"https://api.github.com/users/bagxi/repos","events_url":"https://api.github.com/users/bagxi/events{/privacy}","received_events_url":"https://api.github.com/users/bagxi/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1391/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/1391/timeline","performed_via_github_app":null,"state_reason":"completed"}