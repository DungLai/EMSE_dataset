{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/764","repository_url":"https://api.github.com/repos/catalyst-team/catalyst","labels_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/764/labels{/name}","comments_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/764/comments","events_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/764/events","html_url":"https://github.com/catalyst-team/catalyst/issues/764","id":604519512,"node_id":"MDU6SXNzdWU2MDQ1MTk1MTI=","number":764,"title":"Resuming training repeats the last epoch","user":{"login":"YaLTeR","id":1794388,"node_id":"MDQ6VXNlcjE3OTQzODg=","avatar_url":"https://avatars.githubusercontent.com/u/1794388?v=4","gravatar_id":"","url":"https://api.github.com/users/YaLTeR","html_url":"https://github.com/YaLTeR","followers_url":"https://api.github.com/users/YaLTeR/followers","following_url":"https://api.github.com/users/YaLTeR/following{/other_user}","gists_url":"https://api.github.com/users/YaLTeR/gists{/gist_id}","starred_url":"https://api.github.com/users/YaLTeR/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YaLTeR/subscriptions","organizations_url":"https://api.github.com/users/YaLTeR/orgs","repos_url":"https://api.github.com/users/YaLTeR/repos","events_url":"https://api.github.com/users/YaLTeR/events{/privacy}","received_events_url":"https://api.github.com/users/YaLTeR/received_events","type":"User","site_admin":false},"labels":[{"id":1029400270,"node_id":"MDU6TGFiZWwxMDI5NDAwMjcw","url":"https://api.github.com/repos/catalyst-team/catalyst/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1029400277,"node_id":"MDU6TGFiZWwxMDI5NDAwMjc3","url":"https://api.github.com/repos/catalyst-team/catalyst/labels/wontfix","name":"wontfix","color":"ffffff","default":true,"description":"This will not be worked on"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2020-04-22T07:23:09Z","updated_at":"2020-12-25T23:42:38Z","closed_at":"2020-12-25T23:42:38Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Describe the bug**\r\nWhen resuming the training from a checkpoint, the last epoch is repeated. So for example if the checkpoint was after 4 epochs of training, after resuming the epoch will be 4 again instead of 5.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Train the model with the default `CheckpointCallback`.\r\n2. Try to resume training from any checkpoint with the default `CheckpointCallback`.\r\n\r\nColab notebook based on the MNIST tutorial: https://colab.research.google.com/drive/1hf1q0vrgc4Sh5tCnZR4WFsDkZJIzO9-e\r\n\r\n```python\r\nimport torch\r\nfrom torch.utils.data import DataLoader, TensorDataset\r\nfrom catalyst.dl import SupervisedRunner\r\n\r\nlogdir = \"./logdir\"\r\n\r\nnum_samples, num_features = int(1e4), int(1e1)\r\nX, y = torch.rand(num_samples, num_features), torch.rand(num_samples)\r\ndataset = TensorDataset(X, y)\r\nloader = DataLoader(dataset, batch_size=32, num_workers=1)\r\nloaders = {\"train\": loader, \"valid\": loader}\r\n\r\nmodel = torch.nn.Linear(num_features, 1)\r\ncriterion = torch.nn.MSELoss()\r\noptimizer = torch.optim.Adam(model.parameters())\r\nscheduler = torch.optim.lr_scheduler.MultiStepLR(optimizer, [3, 6])\r\n\r\nrunner = SupervisedRunner()\r\nrunner.train(\r\n    model=model,\r\n    criterion=criterion,\r\n    optimizer=optimizer,\r\n    scheduler=scheduler,\r\n    loaders=loaders,\r\n    logdir=logdir,\r\n    num_epochs=4  # Train for 4 epochs\r\n)\r\n\r\n# Let's train for 4 more epochs\r\n# Issue: the training starts at epoch = 4 instead of epoch = 5,\r\n# so the 4th epoch is repeated\r\nrunner.train(\r\n    model=model,\r\n    criterion=criterion,\r\n    optimizer=optimizer,\r\n    scheduler=scheduler,\r\n    loaders=loaders,\r\n    logdir=logdir,\r\n    num_epochs=8,\r\n    verbose=True,\r\n    resume='logdir/checkpoints/last_full.pth'\r\n)\r\n```\r\n\r\n**Expected behavior**\r\nThe next epoch is selected. So if a checkpoint is after n epochs of training the n+1th epoch is selected.\r\n\r\n**Screenshots**\r\nNote the vertical step on the 4th epoch because it was repeated.\r\n![изображение](https://user-images.githubusercontent.com/1794388/79951898-38190480-8482-11ea-9f56-681133e2d57b.png)\r\n","closed_by":{"login":"stale[bot]","id":26384082,"node_id":"MDM6Qm90MjYzODQwODI=","avatar_url":"https://avatars.githubusercontent.com/in/1724?v=4","gravatar_id":"","url":"https://api.github.com/users/stale%5Bbot%5D","html_url":"https://github.com/apps/stale","followers_url":"https://api.github.com/users/stale%5Bbot%5D/followers","following_url":"https://api.github.com/users/stale%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stale%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/stale%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/stale%5Bbot%5D/repos","events_url":"https://api.github.com/users/stale%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/stale%5Bbot%5D/received_events","type":"Bot","site_admin":false},"reactions":{"url":"https://api.github.com/repos/catalyst-team/catalyst/issues/764/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/catalyst-team/catalyst/issues/764/timeline","performed_via_github_app":null,"state_reason":"completed"}