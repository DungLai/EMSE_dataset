{"url":"https://api.github.com/repos/uber-research/deep-neuroevolution/issues/31","repository_url":"https://api.github.com/repos/uber-research/deep-neuroevolution","labels_url":"https://api.github.com/repos/uber-research/deep-neuroevolution/issues/31/labels{/name}","comments_url":"https://api.github.com/repos/uber-research/deep-neuroevolution/issues/31/comments","events_url":"https://api.github.com/repos/uber-research/deep-neuroevolution/issues/31/events","html_url":"https://github.com/uber-research/deep-neuroevolution/issues/31","id":457770319,"node_id":"MDU6SXNzdWU0NTc3NzAzMTk=","number":31,"title":"[es_distributed/tf_util.py] ValueError: Dimension 0 in both shapes must be equal, but are 4608 and 18. Shapes are [4608] and [18]. From merging shape 12 with other shapes. for 'concat/concat_dim' (op: 'Pack') with input shapes: [4096], [16], [16], [16], [8192], [32], [32], [32], [991232], [ 256], [256], [256], [4608], [18].","user":{"login":"dragon28","id":4351285,"node_id":"MDQ6VXNlcjQzNTEyODU=","avatar_url":"https://avatars.githubusercontent.com/u/4351285?v=4","gravatar_id":"","url":"https://api.github.com/users/dragon28","html_url":"https://github.com/dragon28","followers_url":"https://api.github.com/users/dragon28/followers","following_url":"https://api.github.com/users/dragon28/following{/other_user}","gists_url":"https://api.github.com/users/dragon28/gists{/gist_id}","starred_url":"https://api.github.com/users/dragon28/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dragon28/subscriptions","organizations_url":"https://api.github.com/users/dragon28/orgs","repos_url":"https://api.github.com/users/dragon28/repos","events_url":"https://api.github.com/users/dragon28/events{/privacy}","received_events_url":"https://api.github.com/users/dragon28/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-06-19T02:00:51Z","updated_at":"2019-07-31T13:15:11Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Hello People,\r\n\r\nI managed to find some error, when I tested the ES algorithm.\r\n\r\n```\r\npython3 -m es_distributed.main master --master_socket_path /tmp/es_redis_master.sock --algo es --exp_file configurations/frostbite_es.json                       [67/67]\r\nfile configurations/frostbite_es.json /tmp/es_redis_master.sock --algo es --exp_f                                                                                       \r\n[2019-06-04 23:15:37,056 pid=22170] run_master: {'exp': {'config': {'calc_obstat_prob': 0.0, 'episodes_per_batch': 5000, 'eval_prob': 0.01, 'l2coeff': 0.005, 'noise_std\r\nev': 0.005, 'snapshot_freq': 20, 'timesteps_per_batch': 10000, 'return_proc_mode': 'centered_rank', 'episode_cutoff_mode': 5000}, 'env_id': 'FrostbiteNoFrameskip-v4', '\r\noptimizer': {'args': {'stepsize': 0.01}, 'type': 'adam'}, 'policy': {'args': {}, 'type': 'ESAtariPolicy'}}, 'log_dir': '/tmp/es_master_22170', 'master_redis_cfg': {'uni\r\nx_socket_path': '/tmp/es_redis_master.sock'}}                                                                                                                           \r\n[2019-06-04 23:15:38,083 pid=22170] Tabular logging to /tmp/es_master_22170                                                                                             \r\n2019-06-04 23:15:38.894940: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 3410300000 Hz                                                      \r\n2019-06-04 23:15:38.895374: I tensorflow/compiler/xla/service/service.cc:150] XLA service 0x40bfa50 executing computations on platform Host. Devices:                   \r\n2019-06-04 23:15:38.895393: I tensorflow/compiler/xla/service/service.cc:158]   StreamExecutor device (0): <undefined>, <undefined>                                     \r\n[2019-06-04 23:15:38,904 pid=22170] From /home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py:263: colocate_with (from tensorfl\r\now.python.framework.ops) is deprecated and will be removed in a future version.                                                                                         \r\nInstructions for updating:                                                                                                                                              \r\nColocations handled automatically by placer.                                                                                                                            \r\n[2019-06-04 23:15:38,991 pid=22170] From /home/dragon/.local/lib/python3.6/site-packages/tensorflow/contrib/layers/python/layers/layers.py:1624: flatten (from tensorflo\r\nw.python.layers.core) is deprecated and will be removed in a future version.                                                                                            \r\nInstructions for updating:                                                                                                                                              \r\nUse keras.layers.flatten instead.                                                                                                                                       \r\n[2019-06-04 23:15:39,054 pid=22170] From /home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/util/decorator_utils.py:145: GraphKeys.VARIABLES (from tensor\r\nflow.python.framework.ops) is deprecated and will be removed in a future version.                                                                                       \r\nInstructions for updating:                                                                                                                                              \r\nUse `tf.GraphKeys.GLOBAL_VARIABLES` instead.\r\nTraceback (most recent call last):                                                                                                                               [45/67]\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1659, in _create_c_op\r\n    c_op = c_api.TF_FinishOperation(op_desc)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Dimension 0 in both shapes must be equal, but are 4608 and 18. Shapes are [4608] and [18].\r\n        From merging shape 12 with other shapes. for 'concat/concat_dim' (op: 'Pack') with input shapes: [4096], [16], [16], [16], [8192], [32], [32], [32], [991232], [\r\n256], [256], [256], [4608], [18].\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.6/runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"/usr/lib/python3.6/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/home/dragon/machine_learning/deep-neuroevolution/es_distributed/main.py\", line 90, in <module>\r\n    cli()\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/click/core.py\", line 764, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/click/core.py\", line 717, in main\r\n    rv = self.invoke(ctx)\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/click/core.py\", line 1137, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\nFile \"/home/dragon/.local/lib/python3.6/site-packages/click/core.py\", line 956, in invoke                                                                      [23/67]\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/click/core.py\", line 555, in invoke\r\n    return callback(*args, **kwargs)\r\n  File \"/home/dragon/machine_learning/deep-neuroevolution/es_distributed/main.py\", line 61, in master\r\n    algo.run_master({'unix_socket_path': master_socket_path}, log_dir, exp)\r\n  File \"/home/dragon/machine_learning/deep-neuroevolution/es_distributed/es.py\", line 147, in run_master\r\n    config, env, sess, policy = setup(exp, single_threaded=False)\r\n  File \"/home/dragon/machine_learning/deep-neuroevolution/es_distributed/es.py\", line 136, in setup\r\n    policy = getattr(policies, exp['policy']['type'])(env.observation_space, env.action_space, **exp['policy']['args'])\r\n  File \"/home/dragon/machine_learning/deep-neuroevolution/es_distributed/policies.py\", line 24, in __init__\r\n    self._getflat = U.GetFlat(self.trainable_variables)\r\n  File \"/home/dragon/machine_learning/deep-neuroevolution/es_distributed/tf_util.py\", line 244, in __init__ \r\n    self.op = tf.concat(0, [tf.reshape(v, [numel(v)]) for v in var_list])                                     \r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py\", line 180, in wrapper\r\n    return target(*args, **kwargs)\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 1253, in concat\r\n    dtype=dtypes.int32).get_shape().assert_is_compatible_with(\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1039, in convert_to_tensor\r\n    return convert_to_tensor_v2(value, dtype, preferred_dtype, name)\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1097, in convert_to_tensor_v2\r\n    as_ref=False)\r\nFile \"/home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1175, in internal_convert_to_tensor                                   \r\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 1102, in _autopacking_conversion_function\r\n    return _autopacking_helper(v, dtype, name or \"packed\")\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 1054, in _autopacking_helper\r\n    return gen_array_ops.pack(elems_as_tensors, name=scope)\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 5448, in pack\r\n    \"Pack\", values=values, axis=axis, name=name)\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 788, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/util/deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3300, in create_op\r\n    op_def=op_def)\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1823, in __init__\r\n    control_input_ops)\r\n  File \"/home/dragon/.local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1662, in _create_c_op\r\n    raise ValueError(str(e))\r\nValueError: Dimension 0 in both shapes must be equal, but are 4608 and 18. Shapes are [4608] and [18].\r\nFrom merging shape 12 with other shapes. for 'concat/concat_dim' (op: 'Pack') with input shapes: [4096], [16], [16], [16], [8192], [32], [32], [32], [991232], [\r\n256], [256], [256], [4608], [18].\r\n\r\n```\r\n\r\nMost of these errors were related to `es_distributed/tf_util.py` file which was originated from the `tf.concat` function or method.\r\n\r\nBelow were some of the changes:\r\n\r\n1) `def concatenate(arrs, axis=0)` function at line 30 - 31\r\n\r\nfrom:\r\n\r\n```\r\ndef concatenate(arrs, axis=0):\r\n    return tf.concat(axis, arrs)\r\n```\r\n\r\nto:\r\n\r\n```\r\ndef concatenate(arrs, axis=0):\r\n    return tf.concat(arrs, axis)\r\n```\r\n\r\n2) `def flatgrad(loss, var_list)` function at line 219 - 222\r\n\r\nfrom:\r\n\r\n```\r\ndef flatgrad(loss, var_list):\r\n    grads = tf.gradients(loss, var_list)\r\n    return tf.concat(0, [tf.reshape(grad, [numel(v)])\r\n        for (v, grad) in zip(var_list, grads)])\r\n```\r\n\r\nto:\r\n\r\n```\r\ndef flatgrad(loss, var_list):\r\n    grads = tf.gradients(loss, var_list)\r\n    return tf.concat([tf.reshape(grad, [numel(v)], 0)\r\n        for (v, grad) in zip(var_list, grads)])\r\n```\r\n\r\n3) `def __init__(self, var_list)` function at line 243 -244\r\n\r\nfrom:\r\n\r\n ```\r\ndef __init__(self, var_list):\r\n        self.op = tf.concat(0, [tf.reshape(v, [numel(v)]) for v in var_list])\r\n```\r\n\r\nto:\r\n\r\n ```\r\ndef __init__(self, var_list):\r\n        self.op = tf.concat([tf.reshape(v, [numel(v)]) for v in var_list], 0)\r\n```\r\n\r\nMy environment information:\r\nUbuntu 18.04 x64\r\nPython 3.6.8\r\ntensorflow 1.13.1\r\nClick 7.0\r\natari-py 0.1.15\r\nnumpy 1.16.3\r\ngym 0.12.1\r\nbaselines 0.1.5\r\n\r\nThanks","closed_by":null,"reactions":{"url":"https://api.github.com/repos/uber-research/deep-neuroevolution/issues/31/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"timeline_url":"https://api.github.com/repos/uber-research/deep-neuroevolution/issues/31/timeline","performed_via_github_app":null,"state_reason":null}