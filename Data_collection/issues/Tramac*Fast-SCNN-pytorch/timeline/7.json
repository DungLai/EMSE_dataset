[{"url":"https://api.github.com/repos/Tramac/Fast-SCNN-pytorch/issues/comments/518987037","html_url":"https://github.com/Tramac/Fast-SCNN-pytorch/issues/7#issuecomment-518987037","issue_url":"https://api.github.com/repos/Tramac/Fast-SCNN-pytorch/issues/7","id":518987037,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODk4NzAzNw==","user":{"login":"priancho","id":1505880,"node_id":"MDQ6VXNlcjE1MDU4ODA=","avatar_url":"https://avatars.githubusercontent.com/u/1505880?v=4","gravatar_id":"","url":"https://api.github.com/users/priancho","html_url":"https://github.com/priancho","followers_url":"https://api.github.com/users/priancho/followers","following_url":"https://api.github.com/users/priancho/following{/other_user}","gists_url":"https://api.github.com/users/priancho/gists{/gist_id}","starred_url":"https://api.github.com/users/priancho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/priancho/subscriptions","organizations_url":"https://api.github.com/users/priancho/orgs","repos_url":"https://api.github.com/users/priancho/repos","events_url":"https://api.github.com/users/priancho/events{/privacy}","received_events_url":"https://api.github.com/users/priancho/received_events","type":"User","site_admin":false},"created_at":"2019-08-07T08:01:10Z","updated_at":"2019-08-09T03:25:42Z","author_association":"NONE","body":"Hi @kame-hameha ,\r\n\r\nI faced the same issue and solved the problem based on the following pytorch discussion post:\r\n* https://discuss.pytorch.org/t/solved-keyerror-unexpected-key-module-encoder-embedding-weight-in-state-dict/1686/14\r\n\r\nIn short, a model trained with `nn.DataParallel` have state names with the prefix `module.`, whereas loading this model w/o `nn.DataParallel` expects state names w/o `module.` prefix.\r\nAs a result, missing keys and unexpected keys error occurs.\r\n\r\nThe following code snippet is what I used to fix this issue.\r\nHope it helps you :-)\r\n\r\n```python\r\n#\r\n# models/fast_scnn.py:get_fast_scnn()\r\n#\r\ndef get_fast_scnn(model_file, dataset='citys', pretrained=False, root='./weights', map_cpu=False, **kwargs):\r\n    from data_loader import datasets\r\n    from collections import OrderedDict\r\n\r\n    def convert_state_dict(data):\r\n        \"\"\"Remove 'module.' prefix.\r\n        \"\"\"\r\n        new_state_dict = OrderedDict()\r\n        for k, v in data.items():\r\n            name = k[7:]\r\n            new_state_dict[name] = v\r\n        return new_state_dict\r\n\r\n    acronyms = {\r\n        'pascal_voc': 'voc',\r\n        'pascal_aug': 'voc',\r\n        'ade20k': 'ade',\r\n        'coco': 'coco',\r\n        'citys': 'citys',\r\n    }\r\n\r\n    model = FastSCNN(datasets[dataset].NUM_CLASS, **kwargs)\r\n    if pretrained:\r\n        if(map_cpu):\r\n            state_dict = torch.load(os.path.join(root, model_file), map_location='cpu')\r\n        else:\r\n            state_dict = torch.load(os.path.join(root, model_file))\r\n        model.load_state_dict(convert_state_dict(state_dict))\r\n\r\n    return model\r\n```","reactions":{"url":"https://api.github.com/repos/Tramac/Fast-SCNN-pytorch/issues/comments/518987037/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"priancho","id":1505880,"node_id":"MDQ6VXNlcjE1MDU4ODA=","avatar_url":"https://avatars.githubusercontent.com/u/1505880?v=4","gravatar_id":"","url":"https://api.github.com/users/priancho","html_url":"https://github.com/priancho","followers_url":"https://api.github.com/users/priancho/followers","following_url":"https://api.github.com/users/priancho/following{/other_user}","gists_url":"https://api.github.com/users/priancho/gists{/gist_id}","starred_url":"https://api.github.com/users/priancho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/priancho/subscriptions","organizations_url":"https://api.github.com/users/priancho/orgs","repos_url":"https://api.github.com/users/priancho/repos","events_url":"https://api.github.com/users/priancho/events{/privacy}","received_events_url":"https://api.github.com/users/priancho/received_events","type":"User","site_admin":false}},{"id":2539146996,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjUzOTE0Njk5Ng==","url":"https://api.github.com/repos/Tramac/Fast-SCNN-pytorch/issues/events/2539146996","actor":{"login":"kame-hameha","id":42476564,"node_id":"MDQ6VXNlcjQyNDc2NTY0","avatar_url":"https://avatars.githubusercontent.com/u/42476564?v=4","gravatar_id":"","url":"https://api.github.com/users/kame-hameha","html_url":"https://github.com/kame-hameha","followers_url":"https://api.github.com/users/kame-hameha/followers","following_url":"https://api.github.com/users/kame-hameha/following{/other_user}","gists_url":"https://api.github.com/users/kame-hameha/gists{/gist_id}","starred_url":"https://api.github.com/users/kame-hameha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kame-hameha/subscriptions","organizations_url":"https://api.github.com/users/kame-hameha/orgs","repos_url":"https://api.github.com/users/kame-hameha/repos","events_url":"https://api.github.com/users/kame-hameha/events{/privacy}","received_events_url":"https://api.github.com/users/kame-hameha/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-08-07T08:01:10Z","performed_via_github_app":null},{"id":2539146998,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI1MzkxNDY5OTg=","url":"https://api.github.com/repos/Tramac/Fast-SCNN-pytorch/issues/events/2539146998","actor":{"login":"kame-hameha","id":42476564,"node_id":"MDQ6VXNlcjQyNDc2NTY0","avatar_url":"https://avatars.githubusercontent.com/u/42476564?v=4","gravatar_id":"","url":"https://api.github.com/users/kame-hameha","html_url":"https://github.com/kame-hameha","followers_url":"https://api.github.com/users/kame-hameha/followers","following_url":"https://api.github.com/users/kame-hameha/following{/other_user}","gists_url":"https://api.github.com/users/kame-hameha/gists{/gist_id}","starred_url":"https://api.github.com/users/kame-hameha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kame-hameha/subscriptions","organizations_url":"https://api.github.com/users/kame-hameha/orgs","repos_url":"https://api.github.com/users/kame-hameha/repos","events_url":"https://api.github.com/users/kame-hameha/events{/privacy}","received_events_url":"https://api.github.com/users/kame-hameha/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-08-07T08:01:10Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/Tramac/Fast-SCNN-pytorch/issues/comments/521581591","html_url":"https://github.com/Tramac/Fast-SCNN-pytorch/issues/7#issuecomment-521581591","issue_url":"https://api.github.com/repos/Tramac/Fast-SCNN-pytorch/issues/7","id":521581591,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMTU4MTU5MQ==","user":{"login":"feitiandemiaomi","id":18325462,"node_id":"MDQ6VXNlcjE4MzI1NDYy","avatar_url":"https://avatars.githubusercontent.com/u/18325462?v=4","gravatar_id":"","url":"https://api.github.com/users/feitiandemiaomi","html_url":"https://github.com/feitiandemiaomi","followers_url":"https://api.github.com/users/feitiandemiaomi/followers","following_url":"https://api.github.com/users/feitiandemiaomi/following{/other_user}","gists_url":"https://api.github.com/users/feitiandemiaomi/gists{/gist_id}","starred_url":"https://api.github.com/users/feitiandemiaomi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/feitiandemiaomi/subscriptions","organizations_url":"https://api.github.com/users/feitiandemiaomi/orgs","repos_url":"https://api.github.com/users/feitiandemiaomi/repos","events_url":"https://api.github.com/users/feitiandemiaomi/events{/privacy}","received_events_url":"https://api.github.com/users/feitiandemiaomi/received_events","type":"User","site_admin":false},"created_at":"2019-08-15T09:36:04Z","updated_at":"2019-08-15T09:36:04Z","author_association":"NONE","body":"@priancho @kame-hameha  There has an easy way to solve it, when you train the model ,please modify the way to save model, in train.py  :\r\ntorch.save(model.state_dict(), save_path)  into   torch.save(model.module.state_dict(), save_path)","reactions":{"url":"https://api.github.com/repos/Tramac/Fast-SCNN-pytorch/issues/comments/521581591/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"feitiandemiaomi","id":18325462,"node_id":"MDQ6VXNlcjE4MzI1NDYy","avatar_url":"https://avatars.githubusercontent.com/u/18325462?v=4","gravatar_id":"","url":"https://api.github.com/users/feitiandemiaomi","html_url":"https://github.com/feitiandemiaomi","followers_url":"https://api.github.com/users/feitiandemiaomi/followers","following_url":"https://api.github.com/users/feitiandemiaomi/following{/other_user}","gists_url":"https://api.github.com/users/feitiandemiaomi/gists{/gist_id}","starred_url":"https://api.github.com/users/feitiandemiaomi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/feitiandemiaomi/subscriptions","organizations_url":"https://api.github.com/users/feitiandemiaomi/orgs","repos_url":"https://api.github.com/users/feitiandemiaomi/repos","events_url":"https://api.github.com/users/feitiandemiaomi/events{/privacy}","received_events_url":"https://api.github.com/users/feitiandemiaomi/received_events","type":"User","site_admin":false}},{"id":2559031924,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjU1OTAzMTkyNA==","url":"https://api.github.com/repos/Tramac/Fast-SCNN-pytorch/issues/events/2559031924","actor":{"login":"priancho","id":1505880,"node_id":"MDQ6VXNlcjE1MDU4ODA=","avatar_url":"https://avatars.githubusercontent.com/u/1505880?v=4","gravatar_id":"","url":"https://api.github.com/users/priancho","html_url":"https://github.com/priancho","followers_url":"https://api.github.com/users/priancho/followers","following_url":"https://api.github.com/users/priancho/following{/other_user}","gists_url":"https://api.github.com/users/priancho/gists{/gist_id}","starred_url":"https://api.github.com/users/priancho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/priancho/subscriptions","organizations_url":"https://api.github.com/users/priancho/orgs","repos_url":"https://api.github.com/users/priancho/repos","events_url":"https://api.github.com/users/priancho/events{/privacy}","received_events_url":"https://api.github.com/users/priancho/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-08-15T09:36:04Z","performed_via_github_app":null},{"id":2559031926,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI1NTkwMzE5MjY=","url":"https://api.github.com/repos/Tramac/Fast-SCNN-pytorch/issues/events/2559031926","actor":{"login":"priancho","id":1505880,"node_id":"MDQ6VXNlcjE1MDU4ODA=","avatar_url":"https://avatars.githubusercontent.com/u/1505880?v=4","gravatar_id":"","url":"https://api.github.com/users/priancho","html_url":"https://github.com/priancho","followers_url":"https://api.github.com/users/priancho/followers","following_url":"https://api.github.com/users/priancho/following{/other_user}","gists_url":"https://api.github.com/users/priancho/gists{/gist_id}","starred_url":"https://api.github.com/users/priancho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/priancho/subscriptions","organizations_url":"https://api.github.com/users/priancho/orgs","repos_url":"https://api.github.com/users/priancho/repos","events_url":"https://api.github.com/users/priancho/events{/privacy}","received_events_url":"https://api.github.com/users/priancho/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-08-15T09:36:04Z","performed_via_github_app":null},{"id":2559031928,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjU1OTAzMTkyOA==","url":"https://api.github.com/repos/Tramac/Fast-SCNN-pytorch/issues/events/2559031928","actor":{"login":"kame-hameha","id":42476564,"node_id":"MDQ6VXNlcjQyNDc2NTY0","avatar_url":"https://avatars.githubusercontent.com/u/42476564?v=4","gravatar_id":"","url":"https://api.github.com/users/kame-hameha","html_url":"https://github.com/kame-hameha","followers_url":"https://api.github.com/users/kame-hameha/followers","following_url":"https://api.github.com/users/kame-hameha/following{/other_user}","gists_url":"https://api.github.com/users/kame-hameha/gists{/gist_id}","starred_url":"https://api.github.com/users/kame-hameha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kame-hameha/subscriptions","organizations_url":"https://api.github.com/users/kame-hameha/orgs","repos_url":"https://api.github.com/users/kame-hameha/repos","events_url":"https://api.github.com/users/kame-hameha/events{/privacy}","received_events_url":"https://api.github.com/users/kame-hameha/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-08-15T09:36:04Z","performed_via_github_app":null},{"id":2559031929,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI1NTkwMzE5Mjk=","url":"https://api.github.com/repos/Tramac/Fast-SCNN-pytorch/issues/events/2559031929","actor":{"login":"kame-hameha","id":42476564,"node_id":"MDQ6VXNlcjQyNDc2NTY0","avatar_url":"https://avatars.githubusercontent.com/u/42476564?v=4","gravatar_id":"","url":"https://api.github.com/users/kame-hameha","html_url":"https://github.com/kame-hameha","followers_url":"https://api.github.com/users/kame-hameha/followers","following_url":"https://api.github.com/users/kame-hameha/following{/other_user}","gists_url":"https://api.github.com/users/kame-hameha/gists{/gist_id}","starred_url":"https://api.github.com/users/kame-hameha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kame-hameha/subscriptions","organizations_url":"https://api.github.com/users/kame-hameha/orgs","repos_url":"https://api.github.com/users/kame-hameha/repos","events_url":"https://api.github.com/users/kame-hameha/events{/privacy}","received_events_url":"https://api.github.com/users/kame-hameha/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-08-15T09:36:04Z","performed_via_github_app":null}]