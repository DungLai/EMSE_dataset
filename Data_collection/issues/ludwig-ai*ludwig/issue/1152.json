{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1152","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1152/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1152/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1152/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/1152","id":857838616,"node_id":"MDU6SXNzdWU4NTc4Mzg2MTY=","number":1152,"title":"Is it possible to get the Top-k predictions from ludwig test and the probability/confidence of each?","user":{"login":"farazk86","id":33456896,"node_id":"MDQ6VXNlcjMzNDU2ODk2","avatar_url":"https://avatars.githubusercontent.com/u/33456896?v=4","gravatar_id":"","url":"https://api.github.com/users/farazk86","html_url":"https://github.com/farazk86","followers_url":"https://api.github.com/users/farazk86/followers","following_url":"https://api.github.com/users/farazk86/following{/other_user}","gists_url":"https://api.github.com/users/farazk86/gists{/gist_id}","starred_url":"https://api.github.com/users/farazk86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farazk86/subscriptions","organizations_url":"https://api.github.com/users/farazk86/orgs","repos_url":"https://api.github.com/users/farazk86/repos","events_url":"https://api.github.com/users/farazk86/events{/privacy}","received_events_url":"https://api.github.com/users/farazk86/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-04-14T12:15:48Z","updated_at":"2021-04-24T00:44:00Z","closed_at":"2021-04-24T00:43:59Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, \r\n\r\nI am using ludwig to train a translation model between two notations. Due to a bug in the current version(https://github.com/ludwig-ai/ludwig/issues/1130) I am forced to use the ``Tensorflow 1.x`` version of ludwig. \r\n\r\nBut my question is that, when running ``ludwid test`` and ``ludwig predict``, is it possible to get the Top 5 possible translations for the given input along with the confidence of each? Rather than the single prediction it produces for  each input?\r\n\r\nI am using a ``sequence encoder`` to train the model:\r\n\r\n```yaml\r\ntraining:\r\n    epochs: 500\r\n    early_stop: 50\r\n    batch_size: 128\r\n#    dropout_rate: 0.3\r\n\r\ninput_features:\r\n    -\r\n        name: column1\r\n        type: sequence\r\n        encoder: rnn\r\n        cell_type: lstm\r\n        reduce_output: null\r\n\r\noutput_features:\r\n    -\r\n        name: column2\r\n        type: sequence\r\n        decoder: generator\r\n        cell_type: lstm\r\n        attention: bahdanau\r\n        loss:\r\n            type: sampled_softmax_cross_entropy\r\n```\r\nThis is a sample from my data:\r\n\r\n```\r\ncolumn1,column2\r\nk k klk k hjkj hg k kg h k jlk k kj kg hk k k k k k k k klk kjh jkj hg ghk kj kh khgh hg,N S SHL S LHHL LL H SL H H LHL S SL HL HH S S S S S S S SHL SLL HHL LL SHH SL HL HLLH SL\r\nhk lk kh klk l lmlk lml mn m klm mn m ml lj kl klk kjhj jh h h h klm l lm l l l l lk lmkl lkk hjh h h klk kj k klm mlkj kl ml lk lk m lk jkjh jh k k hkh hg hk lm kj gh hg hjk jh,NH HL SL HHL H SHLL HHL HH L LHH SH L SL SL HH LHL SLLH SL S S S HHH L SH L S S S SL HHLH SLS LHL S S HHL SL H SHH SLLL HH HL SL HL H LL LHLL HL H S LHL SL HH HH LL LH SL HHH LL\r\nkj klkjkjh ghg hj j j jh jk hj ghjh hg g fg g g g hjhg hjh gf gh hkjklkjh hjhg hg,NL HHLLHLL LHL HH S S SL HH LH LHHL SL S LH S S S HHLL HHL LL HH SHLHHLLL SHLL HL\r\ng j k l k h k k g g g k k kj g hk k kj h kj h g g,N H H H L L H S L S S H S SL L HH S SL L HL L L S\r\nhkj k k k k kkk kh kl kmlkjk kj h hl l l lk kmlm jlkk j hl l l lk k k kmlm k k k kmlk k k k k kml k kkk hjkjhj jh jkl ljl lmlkj kjhg hg kk hk h kkkh jkl lmlk lkj,NHL H S S S SSS SL HH LHLLLH SL L SH S S SL SHLH LHLS L LH S S SL S S SHLH L S S SHLL S S S S SHL L SSS LHHLLH SL HHH SLH SHLLL HLLL HL HS LH L HSSL HHH SHLL HLL\r\ne e e e de dcded edb cb dc de dc bcdc cb c ac c c bcdcb d dededc bc dcbc ba,N S S S LH LLHHL HLL HL HL HH LL LHHL SL H LH S S LHHLL H SHLHLL LH HLLH LL\r\ng j k l l l k h l k j g h g f gh h k k jk h h g g,N H H H S S L L H L L L H L L HH S H S LH L S L S\r\nf fedf d dfe fg g g ggf ed df ef d dhj h hgf g f efg fe de dd c ed d cd d df ghgfg e,N SLLH L SHL HH S S SSL LL SH LH L SHH L SLL H L LHH LL LH LS L HL S LH S SH HHLLH L\r\nd fgh g g g g gh g g g ge g fgh fe dfc de fefed dc f ghg g gh g g gh g ghkjh jkjh g ghjhgh hg h gf g h kl kjkl lk h gf hkj klk kjh jh hg hg gh g g g fgh fe dfc de fefed g ghgf gh g ghkjh jkjh ghjhgh hg,N HHH L S S S SH L S S SL H LHH LL LHL HH HLHLL SL H HHL S SH L S SH L SHHLL HHLL L SHHLLH SL H LL H H HH LLHH SL L LL HHL HHL SLL HL SL HL SH L S S LHH LL LHL HH HLHLL H SHLL HH L SHHLL HHLL LHHLLH SL\r\n```\r\nAnd using ``ludwig test`` on the trained model produces 3 files: ``column2_predictions.csv``, ``column2_probability.csv`` and ``column2_last_predictions.csv``\r\n\r\nThe last_predictions file only contains the last word of the sequence whereas the predictions contains the full predicted output for the input string.\r\n\r\nIs the probability given in the ``column2_probability.csv`` the probability for the last_prediction or the full predicted output? As some of the probabilities in the probability.csv are ``inf`` whereas there are mistakes in the translated output - thats why I'm asking what are these probabilities for?\r\n\r\nThanks","closed_by":{"login":"w4nderlust","id":349256,"node_id":"MDQ6VXNlcjM0OTI1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/349256?v=4","gravatar_id":"","url":"https://api.github.com/users/w4nderlust","html_url":"https://github.com/w4nderlust","followers_url":"https://api.github.com/users/w4nderlust/followers","following_url":"https://api.github.com/users/w4nderlust/following{/other_user}","gists_url":"https://api.github.com/users/w4nderlust/gists{/gist_id}","starred_url":"https://api.github.com/users/w4nderlust/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/w4nderlust/subscriptions","organizations_url":"https://api.github.com/users/w4nderlust/orgs","repos_url":"https://api.github.com/users/w4nderlust/repos","events_url":"https://api.github.com/users/w4nderlust/events{/privacy}","received_events_url":"https://api.github.com/users/w4nderlust/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1152/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1152/timeline","performed_via_github_app":null,"state_reason":"completed"}