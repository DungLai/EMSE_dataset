{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2483","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2483/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2483/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2483/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/2483","id":1372015970,"node_id":"I_kwDOCbx2hs5Rx01i","number":2483,"title":"nightly Ludwig seems use ray air API incorrectly","user":{"login":"Jeffwan","id":4739316,"node_id":"MDQ6VXNlcjQ3MzkzMTY=","avatar_url":"https://avatars.githubusercontent.com/u/4739316?v=4","gravatar_id":"","url":"https://api.github.com/users/Jeffwan","html_url":"https://github.com/Jeffwan","followers_url":"https://api.github.com/users/Jeffwan/followers","following_url":"https://api.github.com/users/Jeffwan/following{/other_user}","gists_url":"https://api.github.com/users/Jeffwan/gists{/gist_id}","starred_url":"https://api.github.com/users/Jeffwan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jeffwan/subscriptions","organizations_url":"https://api.github.com/users/Jeffwan/orgs","repos_url":"https://api.github.com/users/Jeffwan/repos","events_url":"https://api.github.com/users/Jeffwan/events{/privacy}","received_events_url":"https://api.github.com/users/Jeffwan/received_events","type":"User","site_admin":false},"labels":[{"id":1174068769,"node_id":"MDU6TGFiZWwxMTc0MDY4NzY5","url":"https://api.github.com/repos/ludwig-ai/ludwig/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":{"login":"tgaddair","id":1742912,"node_id":"MDQ6VXNlcjE3NDI5MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1742912?v=4","gravatar_id":"","url":"https://api.github.com/users/tgaddair","html_url":"https://github.com/tgaddair","followers_url":"https://api.github.com/users/tgaddair/followers","following_url":"https://api.github.com/users/tgaddair/following{/other_user}","gists_url":"https://api.github.com/users/tgaddair/gists{/gist_id}","starred_url":"https://api.github.com/users/tgaddair/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tgaddair/subscriptions","organizations_url":"https://api.github.com/users/tgaddair/orgs","repos_url":"https://api.github.com/users/tgaddair/repos","events_url":"https://api.github.com/users/tgaddair/events{/privacy}","received_events_url":"https://api.github.com/users/tgaddair/received_events","type":"User","site_admin":false},"assignees":[{"login":"tgaddair","id":1742912,"node_id":"MDQ6VXNlcjE3NDI5MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1742912?v=4","gravatar_id":"","url":"https://api.github.com/users/tgaddair","html_url":"https://github.com/tgaddair","followers_url":"https://api.github.com/users/tgaddair/followers","following_url":"https://api.github.com/users/tgaddair/following{/other_user}","gists_url":"https://api.github.com/users/tgaddair/gists{/gist_id}","starred_url":"https://api.github.com/users/tgaddair/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tgaddair/subscriptions","organizations_url":"https://api.github.com/users/tgaddair/orgs","repos_url":"https://api.github.com/users/tgaddair/repos","events_url":"https://api.github.com/users/tgaddair/events{/privacy}","received_events_url":"https://api.github.com/users/tgaddair/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2022-09-13T21:16:10Z","updated_at":"2022-09-14T16:23:12Z","closed_at":"2022-09-14T04:53:11Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the bug**\r\n\r\n`hyperopt` throws an error and seems it's incorrect usage on ray air API. \r\n\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\n```\r\n    # TODO: write our own data loader\r\n    mushroom_edibility_df = mushroom_edibility.load()\r\n\r\n    automl_config = create_auto_config(\r\n        dataset=mushroom_edibility_df,\r\n        target=target_column,\r\n        time_limit_s=time_limit_s,\r\n        tune_for_memory=tune_for_memory,\r\n        user_config=None,\r\n        random_seed=default_random_seed,\r\n        use_reference_config=False,\r\n    )\r\n\r\n    auto_train_results = train_with_config(\r\n        dataset=mushroom_edibility_df,\r\n        config=automl_config,\r\n        output_directory=output_dir,\r\n        random_seed= default_random_seed,\r\n    )\r\n\r\n```\r\n\r\nlogs\r\n\r\n```\r\n\r\n2022-09-13 21:02:26,099\tINFO timeout.py:54 -- Reached timeout of 180 seconds. Stopping all trials.\r\n== Status ==\r\nCurrent time: 2022-09-13 21:02:26 (running for 00:03:00.88)\r\nMemory usage on this node: 3.6/7.7 GiB\r\nUsing AsyncHyperBand: num_stopped=2\r\nBracket: Iter 72.000: 1.0\r\nResources requested: 0/6 CPUs, 0/0 GPUs, 0.0/4.36 GiB heap, 0.0/2.18 GiB objects\r\nCurrent best trial: f5a3c492 with metric_score=1.0 and parameters={'trainer.learning_rate': 0.005, 'trainer.decay_rate': 0.8, 'trainer.decay_steps': 500, 'combiner.size': 16, 'combiner.output_size': 16, 'combiner.num_steps': 4, 'combiner.relaxation_factor': 1.0, 'combiner.sparsity': 0.0001, 'combiner.bn_virtual_bs': 256, 'combiner.bn_momentum': 0.2}\r\nResult logdir: /tmp/automl/artifact/hyperopt\r\nNumber of trials: 9/10 (9 TERMINATED)\r\n+----------------+------------+----------------+------------------------+------------------------+----------------------+------------------------+------------------------+-----------------+---------------------+----------------------+-----------------------+------------------------+--------+------------------+----------------+\r\n| Trial name     | status     | loc            |   combiner.bn_momentum |   combiner.bn_virtu... |   combiner.num_steps |   combiner.output_size |   combiner.relaxati... |   combiner.size |   combiner.sparsity |   trainer.decay_rate |   trainer.decay_steps |   trainer.learning_... |   iter |   total time (s) |   metric_score |\r\n|----------------+------------+----------------+------------------------+------------------------+----------------------+------------------------+------------------------+-----------------+---------------------+----------------------+-----------------------+------------------------+--------+------------------+----------------|\r\n| trial_f2fdbd9c | TERMINATED | 172.17.0.2:362 |                   0.05 |                    512 |                    3 |                      8 |                    2   |              16 |              0.1    |                 0.95 |                   500 |                  0.025 |     54 |        173.326   |       0.997537 |\r\n| trial_f59ff54c | TERMINATED | 172.17.0.2:396 |                   0.4  |                   2048 |                    9 |                      8 |                    1.5 |               8 |              0.001  |                 0.95 |                 10000 |                  0.005 |     13 |         76.7784  |       0.985222 |\r\n| trial_f5a3c492 | TERMINATED | 172.17.0.2:398 |                   0.2  |                    256 |                    4 |                     16 |                    1   |              16 |              0.0001 |                 0.8  |                   500 |                  0.005 |     44 |        167.486   |       1        |\r\n| trial_f5a82dd4 | TERMINATED | 172.17.0.2:400 |                   0.2  |                   2048 |                    6 |                    128 |                    1   |              24 |              0      |                 0.95 |                 20000 |                  0.01  |     24 |        159.313   |       1        |\r\n| trial_f5acaa94 | TERMINATED | 172.17.0.2:404 |                   0.4  |                    512 |                    9 |                     32 |                    2   |              24 |              1e-06  |                 0.95 |                 20000 |                  0.005 |     23 |        162.771   |       1        |\r\n| trial_f5b17f6a | TERMINATED | 172.17.0.2:406 |                   0.3  |                    256 |                    4 |                     24 |                    1.2 |              32 |              0.0001 |                 0.9  |                  8000 |                  0.005 |     45 |        167.616   |       1        |\r\n| trial_f5b87b3a | TERMINATED | 172.17.0.2:725 |                   0.3  |                    512 |                    7 |                    128 |                    1   |               8 |              0.001  |                 0.95 |                 10000 |                  0.025 |      8 |         72.1376  |       0.997537 |\r\n| trial_285573b8 | TERMINATED | 172.17.0.2:892 |                   0.02 |                   1024 |                    6 |                     32 |                    2   |               8 |              0      |                 0.9  |                 10000 |                  0.01  |      1 |          5.96841 |       0.561576 |\r\n| trial_582786d0 | TERMINATED |                |                   0.4  |                    256 |                    4 |                     16 |                    2   |              24 |              0.01   |                 0.95 |                  2000 |                  0.005 |        |                  |                |\r\n+----------------+------------+----------------+------------------------+------------------------+----------------------+------------------------+------------------------+-----------------+---------------------+----------------------+-----------------------+------------------------+--------+------------------+----------------+\r\n\r\n\r\n2022-09-13 21:04:26,204\tINFO tune.py:758 -- Total run time: 300.97 seconds (180.84 seconds for the tuning loop).\r\nTraceback (most recent call last):\r\n  File \"auto_train.py\", line 182, in <module>\r\n    run_job(args.dataset, args.target, args.time_limit_s, args.tune_for_memory ,args.output_directory)\r\n  File \"auto_train.py\", line 48, in run_job\r\n    auto_train_results = train_with_config(\r\n  File \"/usr/local/lib/python3.8/site-packages/ludwig/automl/automl.py\", line 209, in train_with_config\r\n    hyperopt_results = _train(\r\n  File \"/usr/local/lib/python3.8/site-packages/ludwig/automl/automl.py\", line 308, in _train\r\n    hyperopt_results = hyperopt(\r\n  File \"/usr/local/lib/python3.8/site-packages/ludwig/hyperopt/run.py\", line 329, in hyperopt\r\n    hyperopt_results = hyperopt_executor.execute(\r\n  File \"/usr/local/lib/python3.8/site-packages/ludwig/hyperopt/execution.py\", line 828, in execute\r\n    self._evaluate_best_model(\r\n  File \"/usr/local/lib/python3.8/site-packages/ludwig/hyperopt/execution.py\", line 385, in _evaluate_best_model\r\n    os.path.join(best_model_path, \"model\"),\r\n  File \"/usr/local/lib/python3.8/posixpath.py\", line 76, in join\r\n    a = os.fspath(a)\r\n  File \"/usr/local/lib/python3.8/site-packages/ray/air/checkpoint.py\", line 616, in __fspath__\r\n    raise TypeError(\r\nTypeError: You cannot use `air.Checkpoint` objects directly as paths. Use `Checkpoint.to_directory()` or `Checkpoint.as_directory()` instead.\r\n```\r\n\r\n\r\n\r\n\r\n**Expected behavior**\r\nThe job should finish successfully.\r\n\r\n**Screenshots**\r\n\r\n![image](https://user-images.githubusercontent.com/4739316/190010540-23681dac-9ef8-44e9-8731-1bec5f596b74.png)\r\n\r\n**Environment (please complete the following information):**\r\n\r\n- OS: \\[e.g. iOS\\] linux\r\n- Version \\[e.g. 22\\]  same as ludwig container image\r\n- Python version 3.8\r\n- Ludwig version  ludwig:release-0.6 ludwig:nightly\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n","closed_by":{"login":"tgaddair","id":1742912,"node_id":"MDQ6VXNlcjE3NDI5MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1742912?v=4","gravatar_id":"","url":"https://api.github.com/users/tgaddair","html_url":"https://github.com/tgaddair","followers_url":"https://api.github.com/users/tgaddair/followers","following_url":"https://api.github.com/users/tgaddair/following{/other_user}","gists_url":"https://api.github.com/users/tgaddair/gists{/gist_id}","starred_url":"https://api.github.com/users/tgaddair/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tgaddair/subscriptions","organizations_url":"https://api.github.com/users/tgaddair/orgs","repos_url":"https://api.github.com/users/tgaddair/repos","events_url":"https://api.github.com/users/tgaddair/events{/privacy}","received_events_url":"https://api.github.com/users/tgaddair/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2483/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2483/timeline","performed_via_github_app":null,"state_reason":"completed"}