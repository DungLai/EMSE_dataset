{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1686","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1686/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1686/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1686/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/1686","id":1106283849,"node_id":"I_kwDOCbx2hs5B8I1J","number":1686,"title":"Update support for torchmetrics 0.7","user":{"login":"tgaddair","id":1742912,"node_id":"MDQ6VXNlcjE3NDI5MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1742912?v=4","gravatar_id":"","url":"https://api.github.com/users/tgaddair","html_url":"https://github.com/tgaddair","followers_url":"https://api.github.com/users/tgaddair/followers","following_url":"https://api.github.com/users/tgaddair/following{/other_user}","gists_url":"https://api.github.com/users/tgaddair/gists{/gist_id}","starred_url":"https://api.github.com/users/tgaddair/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tgaddair/subscriptions","organizations_url":"https://api.github.com/users/tgaddair/orgs","repos_url":"https://api.github.com/users/tgaddair/repos","events_url":"https://api.github.com/users/tgaddair/events{/privacy}","received_events_url":"https://api.github.com/users/tgaddair/received_events","type":"User","site_admin":false},"labels":[{"id":1738145946,"node_id":"MDU6TGFiZWwxNzM4MTQ1OTQ2","url":"https://api.github.com/repos/ludwig-ai/ludwig/labels/dependencies","name":"dependencies","color":"6b0029","default":false,"description":"Pull requests that update a dependency file"}],"state":"closed","locked":false,"assignee":{"login":"geoffreyangus","id":29719151,"node_id":"MDQ6VXNlcjI5NzE5MTUx","avatar_url":"https://avatars.githubusercontent.com/u/29719151?v=4","gravatar_id":"","url":"https://api.github.com/users/geoffreyangus","html_url":"https://github.com/geoffreyangus","followers_url":"https://api.github.com/users/geoffreyangus/followers","following_url":"https://api.github.com/users/geoffreyangus/following{/other_user}","gists_url":"https://api.github.com/users/geoffreyangus/gists{/gist_id}","starred_url":"https://api.github.com/users/geoffreyangus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geoffreyangus/subscriptions","organizations_url":"https://api.github.com/users/geoffreyangus/orgs","repos_url":"https://api.github.com/users/geoffreyangus/repos","events_url":"https://api.github.com/users/geoffreyangus/events{/privacy}","received_events_url":"https://api.github.com/users/geoffreyangus/received_events","type":"User","site_admin":false},"assignees":[{"login":"geoffreyangus","id":29719151,"node_id":"MDQ6VXNlcjI5NzE5MTUx","avatar_url":"https://avatars.githubusercontent.com/u/29719151?v=4","gravatar_id":"","url":"https://api.github.com/users/geoffreyangus","html_url":"https://github.com/geoffreyangus","followers_url":"https://api.github.com/users/geoffreyangus/followers","following_url":"https://api.github.com/users/geoffreyangus/following{/other_user}","gists_url":"https://api.github.com/users/geoffreyangus/gists{/gist_id}","starred_url":"https://api.github.com/users/geoffreyangus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geoffreyangus/subscriptions","organizations_url":"https://api.github.com/users/geoffreyangus/orgs","repos_url":"https://api.github.com/users/geoffreyangus/repos","events_url":"https://api.github.com/users/geoffreyangus/events{/privacy}","received_events_url":"https://api.github.com/users/geoffreyangus/received_events","type":"User","site_admin":false}],"milestone":null,"comments":0,"created_at":"2022-01-17T21:45:23Z","updated_at":"2022-04-06T20:56:26Z","closed_at":"2022-04-06T20:56:26Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"Related: https://github.com/ludwig-ai/ludwig/pull/1685\r\n\r\nExample:\r\n\r\n```\r\npytest -vs \"tests/integration_tests/test_api.py::test_api_intent_classification\"\r\n```\r\n\r\nError:\r\n\r\n```\r\ntests/integration_tests/utils.py:432: in run_api_experiment\r\n    dataset=data_csv, skip_save_processed_input=True, skip_save_progress=True, skip_save_unprocessed_output=True\r\nludwig/api.py:537: in train\r\n    save_path=model_dir,\r\nludwig/models/trainer.py:763: in train\r\n    self.eval_batch_size,\r\nludwig/models/trainer.py:1037: in evaluation\r\n    metrics, predictions = predictor.batch_evaluation(dataset, collect_predictions=False, dataset_name=dataset_name)\r\nludwig/models/predictor.py:177: in batch_evaluation\r\n    preds = self.model.evaluation_step(inputs, targets)\r\nludwig/models/ecd.py:166: in evaluation_step\r\n    self.update_metrics(targets, predictions)\r\nludwig/models/ecd.py:221: in update_metrics\r\n    self.eval_loss_metric.update(self.eval_loss(targets, predictions)[0])\r\nludwig/models/ecd.py:211: in eval_loss\r\n    of_eval_loss = of_obj.eval_loss(targets[of_name], predictions[of_name])\r\nludwig/features/base_feature.py:263: in eval_loss\r\n    return self.eval_loss_function(predictions[prediction_key].detach(), targets)\r\n../../.venv/ludwig/torch/lib/python3.7/site-packages/torch/nn/modules/module.py:1102: in _call_impl\r\n    return forward_call(*input, **kwargs)\r\n../../.venv/ludwig/torch/lib/python3.7/site-packages/torchmetrics/metric.py:218: in forward\r\n    self._forward_cache = self.compute()\r\n../../.venv/ludwig/torch/lib/python3.7/site-packages/torchmetrics/metric.py:380: in wrapped_func\r\n    value = compute(*args, **kwargs)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = SoftmaxCrossEntropyMetric(\r\n  (avg): MeanMetric()\r\n  (softmax_cross_entropy_function): SoftmaxCrossEntropyLoss(\r\n    (loss_fn): CrossEntropyLoss()\r\n  )\r\n)\r\n\r\n    def compute(self) -> Tensor:\r\n>       return self.avg.compute()[0]\r\nE       IndexError: invalid index of a 0-dim tensor. Use `tensor.item()` in Python or `tensor.item<T>()` in C++ to convert a 0-dim tensor to a number\r\n\r\nludwig/modules/metric_modules.py:162: IndexError\r\n```","closed_by":{"login":"tgaddair","id":1742912,"node_id":"MDQ6VXNlcjE3NDI5MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1742912?v=4","gravatar_id":"","url":"https://api.github.com/users/tgaddair","html_url":"https://github.com/tgaddair","followers_url":"https://api.github.com/users/tgaddair/followers","following_url":"https://api.github.com/users/tgaddair/following{/other_user}","gists_url":"https://api.github.com/users/tgaddair/gists{/gist_id}","starred_url":"https://api.github.com/users/tgaddair/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tgaddair/subscriptions","organizations_url":"https://api.github.com/users/tgaddair/orgs","repos_url":"https://api.github.com/users/tgaddair/repos","events_url":"https://api.github.com/users/tgaddair/events{/privacy}","received_events_url":"https://api.github.com/users/tgaddair/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1686/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1686/timeline","performed_via_github_app":null,"state_reason":"completed"}