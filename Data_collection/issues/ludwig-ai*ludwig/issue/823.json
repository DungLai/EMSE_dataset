{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/823","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/823/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/823/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/823/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/823","id":678981992,"node_id":"MDU6SXNzdWU2Nzg5ODE5OTI=","number":823,"title":"Latest master (TF2) dropout on RNN is broken","user":{"login":"carlogrisetti","id":4464640,"node_id":"MDQ6VXNlcjQ0NjQ2NDA=","avatar_url":"https://avatars.githubusercontent.com/u/4464640?v=4","gravatar_id":"","url":"https://api.github.com/users/carlogrisetti","html_url":"https://github.com/carlogrisetti","followers_url":"https://api.github.com/users/carlogrisetti/followers","following_url":"https://api.github.com/users/carlogrisetti/following{/other_user}","gists_url":"https://api.github.com/users/carlogrisetti/gists{/gist_id}","starred_url":"https://api.github.com/users/carlogrisetti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/carlogrisetti/subscriptions","organizations_url":"https://api.github.com/users/carlogrisetti/orgs","repos_url":"https://api.github.com/users/carlogrisetti/repos","events_url":"https://api.github.com/users/carlogrisetti/events{/privacy}","received_events_url":"https://api.github.com/users/carlogrisetti/received_events","type":"User","site_admin":false},"labels":[{"id":1434966350,"node_id":"MDU6TGFiZWwxNDM0OTY2MzUw","url":"https://api.github.com/repos/ludwig-ai/ludwig/labels/looking%20into%20it","name":"looking into it","color":"ffa54f","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2020-08-14T08:07:14Z","updated_at":"2020-08-17T18:39:17Z","closed_at":"2020-08-16T22:42:13Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Issue presents with this input feature combination\r\nFeature type: timeseries\r\nEncoder: rnn\r\nDropout: true\r\n\r\nIt's correctly working with these two input feature combinations\r\nFeature type: timeseries\r\nEncoder: rnn\r\nDropout: false\r\n\r\nFeature type: timeseries\r\nEncoder: stacked_cnn\r\nDropout: true\r\n\r\n(thus it seems to be related to rnn+dropout)\r\nHere it is the stack trace:\r\n\r\n\r\n\r\n\r\nTraceback (most recent call last):\r\n  File \"c:\\program files\\python36\\lib\\runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"c:\\program files\\python36\\lib\\runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"C:\\Program Files\\Python36\\Scripts\\ludwig.exe\\__main__.py\", line 7, in <module>\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\ludwig\\cli.py\", line 125, in main\r\n    CLI()\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\ludwig\\cli.py\", line 66, in __init__\r\n    getattr(self, args.command)()\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\ludwig\\cli.py\", line 76, in train\r\n    train.cli(sys.argv[2:])\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\ludwig\\train.py\", line 825, in cli\r\n    full_train(**vars(args))\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\ludwig\\train.py\", line 361, in full_train\r\n    debug=debug\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\ludwig\\train.py\", line 532, in train\r\n    **model_definition[TRAINING]\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\ludwig\\models\\trainer.py\", line 483, in train\r\n    regularization_lambda\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\eager\\def_function.py\", line 564, in __call__\r\n    return self._python_function(*args, **kwds)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\eager\\function.py\", line 3294, in bound_method_wrapper\r\n    return wrapped_fn(weak_instance(), *args, **kwargs)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\ludwig\\models\\ecd.py\", line 152, in train_step\r\n    logits = self((inputs, targets), training=True)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\keras\\engine\\base_layer.py\", line 968, in __call__\r\n    outputs = self.call(cast_inputs, *args, **kwargs)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\eager\\def_function.py\", line 564, in __call__\r\n    return self._python_function(*args, **kwds)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\eager\\function.py\", line 3294, in bound_method_wrapper\r\n    return wrapped_fn(weak_instance(), *args, **kwargs)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\ludwig\\models\\ecd.py\", line 71, in call\r\n    mask=mask)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\keras\\engine\\base_layer.py\", line 968, in __call__\r\n    outputs = self.call(cast_inputs, *args, **kwargs)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\ludwig\\features\\timeseries_feature.py\", line 142, in call\r\n    inputs_exp, training=training, mask=mask\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\keras\\engine\\base_layer.py\", line 968, in __call__\r\n    outputs = self.call(cast_inputs, *args, **kwargs)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\ludwig\\encoders\\sequence_encoders.py\", line 1491, in call\r\n    mask=mask\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\keras\\engine\\base_layer.py\", line 968, in __call__\r\n    outputs = self.call(cast_inputs, *args, **kwargs)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\ludwig\\modules\\recurrent_modules.py\", line 103, in call\r\n    outputs = layer(hidden, training=training, mask=mask)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\keras\\layers\\recurrent.py\", line 654, in __call__\r\n    return super(RNN, self).__call__(inputs, **kwargs)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\keras\\engine\\base_layer.py\", line 968, in __call__\r\n    outputs = self.call(cast_inputs, *args, **kwargs)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\keras\\layers\\recurrent_v2.py\", line 1147, in call\r\n    dropout_mask = self.get_dropout_mask_for_cell(inputs, training, count=4)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\keras\\layers\\recurrent.py\", line 1156, in get_dropout_mask_for_cell\r\n    return self._dropout_mask_cache.setdefault(kwargs=init_kwargs)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\keras\\backend.py\", line 6180, in setdefault\r\n    default = self.default_factory(**kwargs)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\keras\\layers\\recurrent.py\", line 1128, in _create_dropout_mask\r\n    count=count)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\keras\\layers\\recurrent.py\", line 2850, in _generate_dropout_mask\r\n    for _ in range(count)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\keras\\layers\\recurrent.py\", line 2850, in <listcomp>\r\n    for _ in range(count)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\keras\\backend.py\", line 4361, in in_train_phase\r\n    return x()\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\keras\\layers\\recurrent.py\", line 2845, in dropped_inputs\r\n    return K.dropout(ones, rate)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\keras\\backend.py\", line 4768, in dropout\r\n    return nn.dropout_v2(x, rate=level, noise_shape=noise_shape, seed=seed)\r\n  File \"c:\\program files\\python36\\lib\\site-packages\\tensorflow\\python\\ops\\nn_ops.py\", line 4423, in dropout_v2\r\n    \"range [0, 1), got %g\" % rate)\r\nValueError: rate must be a scalar tensor or a float in the range [0, 1), got 1\r\n","closed_by":{"login":"w4nderlust","id":349256,"node_id":"MDQ6VXNlcjM0OTI1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/349256?v=4","gravatar_id":"","url":"https://api.github.com/users/w4nderlust","html_url":"https://github.com/w4nderlust","followers_url":"https://api.github.com/users/w4nderlust/followers","following_url":"https://api.github.com/users/w4nderlust/following{/other_user}","gists_url":"https://api.github.com/users/w4nderlust/gists{/gist_id}","starred_url":"https://api.github.com/users/w4nderlust/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/w4nderlust/subscriptions","organizations_url":"https://api.github.com/users/w4nderlust/orgs","repos_url":"https://api.github.com/users/w4nderlust/repos","events_url":"https://api.github.com/users/w4nderlust/events{/privacy}","received_events_url":"https://api.github.com/users/w4nderlust/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/823/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/823/timeline","performed_via_github_app":null,"state_reason":"completed"}