{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/283","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/283/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/283/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/283/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/283","id":432191292,"node_id":"MDU6SXNzdWU0MzIxOTEyOTI=","number":283,"title":"Cannot reproduce NLU example from the website","user":{"login":"shrinivaskallol","id":32042766,"node_id":"MDQ6VXNlcjMyMDQyNzY2","avatar_url":"https://avatars.githubusercontent.com/u/32042766?v=4","gravatar_id":"","url":"https://api.github.com/users/shrinivaskallol","html_url":"https://github.com/shrinivaskallol","followers_url":"https://api.github.com/users/shrinivaskallol/followers","following_url":"https://api.github.com/users/shrinivaskallol/following{/other_user}","gists_url":"https://api.github.com/users/shrinivaskallol/gists{/gist_id}","starred_url":"https://api.github.com/users/shrinivaskallol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shrinivaskallol/subscriptions","organizations_url":"https://api.github.com/users/shrinivaskallol/orgs","repos_url":"https://api.github.com/users/shrinivaskallol/repos","events_url":"https://api.github.com/users/shrinivaskallol/events{/privacy}","received_events_url":"https://api.github.com/users/shrinivaskallol/received_events","type":"User","site_admin":false},"labels":[{"id":1174068769,"node_id":"MDU6TGFiZWwxMTc0MDY4NzY5","url":"https://api.github.com/repos/ludwig-ai/ludwig/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-04-11T18:55:38Z","updated_at":"2019-04-12T23:30:20Z","closed_at":"2019-04-12T23:30:20Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the bug**\r\nCannot reproduce the Natural language understanding result with the data and the model definition file displayed on the website in Ludwig>examples>Natural language understanding\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nmodel_definition = {}\r\nmodel_definition['input_features'] = [{'name': 'utterance', 'type': 'text', 'level':'word','encoder':'rnn','cell_type': 'lstm',\r\n                                        'bidirectional': 'true','num_layers': 2,'reduce_output': 'none'}\r\n                                     ]\r\n\r\nmodel_definition['output_features'] = [{'name': 'intent', 'type': 'category', 'reduce_input': 'sum',\r\n                                        'num_fc_layers': 1,'fc_size': 64},\r\n                                      {'name':'slots','type':'sequence', 'decoder':'tagger'}]\r\n\r\n\r\n\r\nmodel_definition['preprocessing'] = { 'sequence': {   'fill_value': '',\r\n                                         'format': 'space',\r\n                                         'lowercase': False,\r\n                                         'missing_value_strategy': 'fill_with_const',\r\n                                         'most_common': 20000,\r\n                                         'padding': 'left',\r\n                                         'padding_symbol': '<PAD>',\r\n                                         'sequence_length_limit': 256,\r\n                                         'unknown_symbol': '<UNK>'},\r\n                                     \r\n                                         'text': {'char_format': 'characters',\r\n                                         'char_most_common': 70,\r\n                                         'char_sequence_length_limit': 1024,\r\n                                         'fill_value': '',\r\n                                         'lowercase': True,\r\n                                         'missing_value_strategy': 'fill_with_const',\r\n                                         'padding': 'right',\r\n                                         'padding_symbol': '<PAD>',\r\n                                         'unknown_symbol': '<UNK>',\r\n                                         'word_format': 'space',\r\n                                         'word_most_common': 20000,\r\n                                         'word_sequence_length_limit': 256}}\r\n\r\n\r\ndata = pd.DataFrame({'utterance': ['I want a pizza','Book a flight to Boston','Book a flight at 7pm to London'],\r\n                   'intent': ['order_food','book_flight','book_flight'],\r\n                   'slots':['O O O B-Food_type','O O O O B-City', 'O O O O B-Departure_time O B-City']})\r\n\r\n\r\n\r\nmodel = ludwig.LudwigModel(model_definition)\r\n\r\ntrained_model = model.train(data_df=data, random_seed=42)\r\n\r\nERROR MESSAGE:\r\n---------------------------------------------------------------------------\r\nInvalidArgumentError                      Traceback (most recent call last)\r\n~/anaconda3/lib/python3.7/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\r\n   1333     try:\r\n-> 1334       return fn(*args)\r\n   1335     except errors.OpError as e:\r\n\r\n~/anaconda3/lib/python3.7/site-packages/tensorflow/python/client/session.py in _run_fn(feed_dict, fetch_list, target_list, options, run_metadata)\r\n   1318       return self._call_tf_sessionrun(\r\n-> 1319           options, feed_dict, fetch_list, target_list, run_metadata)\r\n   1320 \r\n\r\n~/anaconda3/lib/python3.7/site-packages/tensorflow/python/client/session.py in _call_tf_sessionrun(self, options, feed_dict, fetch_list, target_list, run_metadata)\r\n   1406         self._session, options, feed_dict, fetch_list, target_list,\r\n-> 1407         run_metadata)\r\n   1408 \r\n\r\nInvalidArgumentError: Paddings must be non-negative: 0 -1\r\n\t [[{{node slots/loss_slots/Pad}}]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nInvalidArgumentError                      Traceback (most recent call last)\r\n<ipython-input-45-b0a795ad9640> in <module>\r\n----> 1 trained_model = model.train(data_df=data, random_seed=42)\r\n\r\n~/anaconda3/lib/python3.7/site-packages/ludwig/api.py in train(self, data_df, data_train_df, data_validation_df, data_test_df, data_csv, data_train_csv, data_validation_csv, data_test_csv, data_hdf5, data_train_hdf5, data_validation_hdf5, data_test_hdf5, train_set_metadata_json, dataset_type, model_name, model_load_path, model_resume_path, skip_save_model, skip_save_progress, skip_save_log, skip_save_processed_input, output_directory, gpus, gpu_fraction, random_seed, logging_level, debug, **kwargs)\r\n    516             gpu_fraction=gpu_fraction,\r\n    517             random_seed=random_seed,\r\n--> 518             debug=debug\r\n    519         )\r\n    520 \r\n\r\n~/anaconda3/lib/python3.7/site-packages/ludwig/train.py in train(training_set, validation_set, test_set, model_definition, save_path, model_load_path, resume, skip_save_model, skip_save_progress, skip_save_log, gpus, gpu_fraction, use_horovod, random_seed, debug)\r\n    428         gpus=gpus, gpu_fraction=gpu_fraction,\r\n    429         random_seed=random_seed,\r\n--> 430         **model_definition['training']\r\n    431     )\r\n    432 \r\n\r\n~/anaconda3/lib/python3.7/site-packages/ludwig/models/model.py in train(self, training_set, validation_set, test_set, validation_field, validation_measure, save_path, regularization_lambda, epochs, learning_rate, batch_size, eval_batch_size, bucketing_field, dropout_rate, early_stop, reduce_learning_rate_on_plateau, reduce_learning_rate_on_plateau_patience, reduce_learning_rate_on_plateau_rate, increase_batch_size_on_plateau, increase_batch_size_on_plateau_patience, increase_batch_size_on_plateau_rate, increase_batch_size_on_plateau_max, learning_rate_warmup_epochs, resume, skip_save_model, skip_save_progress, skip_save_log, gpus, gpu_fraction, random_seed, **kwargs)\r\n    519                         learning_rate=current_learning_rate,\r\n    520                         dropout_rate=dropout_rate,\r\n--> 521                         is_training=True\r\n    522                     )\r\n    523                 )\r\n\r\n~/anaconda3/lib/python3.7/site-packages/tensorflow/python/client/session.py in run(self, fetches, feed_dict, options, run_metadata)\r\n    927     try:\r\n    928       result = self._run(None, fetches, feed_dict, options_ptr,\r\n--> 929                          run_metadata_ptr)\r\n    930       if run_metadata:\r\n    931         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\r\n\r\n~/anaconda3/lib/python3.7/site-packages/tensorflow/python/client/session.py in _run(self, handle, fetches, feed_dict, options, run_metadata)\r\n   1150     if final_fetches or final_targets or (handle and feed_dict_tensor):\r\n   1151       results = self._do_run(handle, final_targets, final_fetches,\r\n-> 1152                              feed_dict_tensor, options, run_metadata)\r\n   1153     else:\r\n   1154       results = []\r\n\r\n~/anaconda3/lib/python3.7/site-packages/tensorflow/python/client/session.py in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\r\n   1326     if handle is None:\r\n   1327       return self._do_call(_run_fn, feeds, fetches, targets, options,\r\n-> 1328                            run_metadata)\r\n   1329     else:\r\n   1330       return self._do_call(_prun_fn, handle, feeds, fetches)\r\n\r\n~/anaconda3/lib/python3.7/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\r\n   1346           pass\r\n   1347       message = error_interpolation.interpolate(message, self._graph)\r\n-> 1348       raise type(e)(node_def, op, message)\r\n   1349 \r\n   1350   def _extend_graph(self):\r\n\r\nInvalidArgumentError: Paddings must be non-negative: 0 -1\r\n\t [[node slots/loss_slots/Pad (defined at /Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/models/modules/loss_modules.py:66) ]]\r\n\r\nCaused by op 'slots/loss_slots/Pad', defined at:\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py\", line 16, in <module>\r\n    app.launch_new_instance()\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/traitlets/config/application.py\", line 658, in launch_instance\r\n    app.start()\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ipykernel/kernelapp.py\", line 505, in start\r\n    self.io_loop.start()\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/platform/asyncio.py\", line 132, in start\r\n    self.asyncio_loop.run_forever()\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/asyncio/base_events.py\", line 528, in run_forever\r\n    self._run_once()\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/asyncio/base_events.py\", line 1764, in _run_once\r\n    handle._run()\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/asyncio/events.py\", line 88, in _run\r\n    self._context.run(self._callback, *self._args)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/ioloop.py\", line 758, in _run_callback\r\n    ret = callback()\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/stack_context.py\", line 300, in null_wrapper\r\n    return fn(*args, **kwargs)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/gen.py\", line 1233, in inner\r\n    self.run()\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/gen.py\", line 1147, in run\r\n    yielded = self.gen.send(value)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ipykernel/kernelbase.py\", line 357, in process_one\r\n    yield gen.maybe_future(dispatch(*args))\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/gen.py\", line 326, in wrapper\r\n    yielded = next(result)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ipykernel/kernelbase.py\", line 267, in dispatch_shell\r\n    yield gen.maybe_future(handler(stream, idents, msg))\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/gen.py\", line 326, in wrapper\r\n    yielded = next(result)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ipykernel/kernelbase.py\", line 534, in execute_request\r\n    user_expressions, allow_stdin,\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/gen.py\", line 326, in wrapper\r\n    yielded = next(result)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ipykernel/ipkernel.py\", line 294, in do_execute\r\n    res = shell.run_cell(code, store_history=store_history, silent=silent)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ipykernel/zmqshell.py\", line 536, in run_cell\r\n    return super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/IPython/core/interactiveshell.py\", line 2819, in run_cell\r\n    raw_cell, store_history, silent, shell_futures)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/IPython/core/interactiveshell.py\", line 2845, in _run_cell\r\n    return runner(coro)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/IPython/core/async_helpers.py\", line 67, in _pseudo_sync_runner\r\n    coro.send(None)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/IPython/core/interactiveshell.py\", line 3020, in run_cell_async\r\n    interactivity=interactivity, compiler=compiler, result=result)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/IPython/core/interactiveshell.py\", line 3185, in run_ast_nodes\r\n    if (yield from self.run_code(code, result)):\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/IPython/core/interactiveshell.py\", line 3267, in run_code\r\n    exec(code_obj, self.user_global_ns, self.user_ns)\r\n  File \"<ipython-input-45-b0a795ad9640>\", line 1, in <module>\r\n    trained_model = model.train(data_df=data, random_seed=42)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/api.py\", line 518, in train\r\n    debug=debug\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/train.py\", line 413, in train\r\n    debug=debug\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/models/model.py\", line 109, in __init__\r\n    **kwargs\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/models/model.py\", line 183, in __build\r\n    is_training=self.is_training\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/models/outputs.py\", line 43, in build_outputs\r\n    **kwargs\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/models/outputs.py\", line 93, in build_single_output\r\n    **kwargs\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/features/base_feature.py\", line 314, in concat_dependencies_and_build_output\r\n    **kwargs\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/features/sequence_feature.py\", line 250, in build_output\r\n    kwarg=kwargs\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/features/sequence_feature.py\", line 299, in build_sequence_output\r\n    class_biases\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/features/sequence_feature.py\", line 497, in sequence_loss\r\n    eval_logits\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/models/modules/loss_modules.py\", line 66, in seq2seq_sequence_loss\r\n    padded_logits = tf.pad(logits, [[0, 0], [0, difference], [0, 0]])\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tensorflow/python/ops/array_ops.py\", line 2299, in pad\r\n    result = gen_array_ops.pad(tensor, paddings, name=name)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 5539, in pad\r\n    \"Pad\", input=input, paddings=paddings, name=name)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 788, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tensorflow/python/util/deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tensorflow/python/framework/ops.py\", line 3300, in create_op\r\n    op_def=op_def)\r\n  File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tensorflow/python/framework/ops.py\", line 1801, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\nInvalidArgumentError (see above for traceback): Paddings must be non-negative: 0 -1\r\n\t [[node slots/loss_slots/Pad (defined at /Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/models/modules/loss_modules.py:66) ]]\r\n**Expected behavior**\r\ntrained model and multivariate prediction\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Environment (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n - Version [e.g. 22]\r\n- Python version 3.7.1\r\n- Ludwig version 0.1.1\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n","closed_by":{"login":"w4nderlust","id":349256,"node_id":"MDQ6VXNlcjM0OTI1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/349256?v=4","gravatar_id":"","url":"https://api.github.com/users/w4nderlust","html_url":"https://github.com/w4nderlust","followers_url":"https://api.github.com/users/w4nderlust/followers","following_url":"https://api.github.com/users/w4nderlust/following{/other_user}","gists_url":"https://api.github.com/users/w4nderlust/gists{/gist_id}","starred_url":"https://api.github.com/users/w4nderlust/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/w4nderlust/subscriptions","organizations_url":"https://api.github.com/users/w4nderlust/orgs","repos_url":"https://api.github.com/users/w4nderlust/repos","events_url":"https://api.github.com/users/w4nderlust/events{/privacy}","received_events_url":"https://api.github.com/users/w4nderlust/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/283/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/283/timeline","performed_via_github_app":null,"state_reason":"completed"}