{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/585","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/585/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/585/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/585/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/585","id":530830662,"node_id":"MDU6SXNzdWU1MzA4MzA2NjI=","number":585,"title":"learning_curves() function fails with ValueError: x and y must have same first dimension","user":{"login":"jimthompson5802","id":1425269,"node_id":"MDQ6VXNlcjE0MjUyNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1425269?v=4","gravatar_id":"","url":"https://api.github.com/users/jimthompson5802","html_url":"https://github.com/jimthompson5802","followers_url":"https://api.github.com/users/jimthompson5802/followers","following_url":"https://api.github.com/users/jimthompson5802/following{/other_user}","gists_url":"https://api.github.com/users/jimthompson5802/gists{/gist_id}","starred_url":"https://api.github.com/users/jimthompson5802/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimthompson5802/subscriptions","organizations_url":"https://api.github.com/users/jimthompson5802/orgs","repos_url":"https://api.github.com/users/jimthompson5802/repos","events_url":"https://api.github.com/users/jimthompson5802/events{/privacy}","received_events_url":"https://api.github.com/users/jimthompson5802/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-12-02T00:53:49Z","updated_at":"2019-12-19T20:38:57Z","closed_at":"2019-12-19T20:38:57Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"**Describe the bug**\r\nlearning_curves() function fails when plotting two more more models at once.  Error message:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/opt/project/sandbox/mwe.py\", line 76, in <module>\r\n    learning_curves(train_stats_list,'y', model_names=model_names, output_directory='./viz', file_format='png')\r\n  File \"/usr/local/lib/python3.6/dist-packages/ludwig-0.2.1-py3.6.egg/ludwig/visualize.py\", line 740, in learning_curves\r\n  File \"/usr/local/lib/python3.6/dist-packages/ludwig-0.2.1-py3.6.egg/ludwig/utils/visualization_utils.py\", line 94, in learning_curves_plot\r\n  File \"/usr/local/lib/python3.6/dist-packages/matplotlib/axes/_axes.py\", line 1666, in plot\r\n    lines = [*self._get_lines(*args, data=data, **kwargs)]\r\n  File \"/usr/local/lib/python3.6/dist-packages/matplotlib/axes/_base.py\", line 225, in __call__\r\n    yield from self._plot_args(this, kwargs)\r\n  File \"/usr/local/lib/python3.6/dist-packages/matplotlib/axes/_base.py\", line 391, in _plot_args\r\n    x, y = self._xy_from_xy(x, y)\r\n  File \"/usr/local/lib/python3.6/dist-packages/matplotlib/axes/_base.py\", line 270, in _xy_from_xy\r\n    \"have shapes {} and {}\".format(x.shape, y.shape))\r\nValueError: x and y must have same first dimension, but have shapes (100,) and (24,)\r\n```\r\nLudwig version: 0.2.1\r\n\r\n**To Reproduce**\r\nThis program will reproduce the error:\r\n```\r\n#\r\n# Minimum Working Example for learning curves Plot error with early stopping\r\n#\r\n\r\n\r\n#%%\r\nimport numpy as np\r\nimport pandas as pd\r\nimport warnings\r\nwarnings.simplefilter('ignore')\r\n\r\nimport ludwig\r\nfrom ludwig.api import LudwigModel\r\nfrom ludwig.visualize import learning_curves\r\n\r\nprint(ludwig.__version__)\r\n\r\n#%%\r\nNUM_ROWS = 5000\r\nNUM_COLS = 20\r\n\r\n#%% create synthetic training data explanatory variables\r\nnp.random.seed(42)\r\n\r\n# create relevant explanatory variables\r\nX = np.random.rand(NUM_ROWS, NUM_COLS)\r\nX_df = pd.DataFrame(X)\r\nX_df.columns = ['X_' + '{:0>3d}'.format(i+1) for i in range(NUM_COLS)]\r\n\r\n#%% create response variable\r\nnp.random.seed(21)\r\nbeta = -2 + 4 * np.random.rand(NUM_COLS)\r\nbeta = np.insert(beta, 0, 1)\r\nprint(beta)\r\n\r\n# closure to create response variable\r\ndef create_logistic(beta):\r\n    return lambda x: 1.0 / (np.exp(-np.sum(np.insert(x, 0, 1) * beta)) + 1)\r\n\r\ncalc_logistic = create_logistic(beta)\r\n\r\n# Create response binary response variable\r\nlogit_y = pd.Series(np.apply_along_axis(calc_logistic, 1, X))\r\nprint(logit_y.describe())\r\n\r\n# create binary classification response variable\r\ny = (logit_y > logit_y.describe()['50%']).astype('int')\r\ny_df = pd.DataFrame(y)\r\ny_df.columns = ['y']\r\n\r\ndf_train = pd.concat([X_df, y_df], axis=1)\r\n\r\n#%% setup two models to train\r\nmodel_definitions = [\r\n    {\r\n        'input_features': [{'name': 'X_'+'{:0>3d}'.format(i+1), 'type': 'numerical'} for i in range(NUM_COLS)],\r\n        'output_features': [{'name':'y', 'type':'binary', 'fc_layers':[{'fc_size':128}]}]\r\n    },\r\n     {\r\n        'input_features': [{'name': 'X_'+'{:0>3d}'.format(i+1), 'type': 'numerical'} for i in range(NUM_COLS)],\r\n        'output_features': [{'name':'y', 'type':'binary', 'fc_layers':[{'fc_size':128}, {'fc_size': 64}, {'fc_size': 32}]}],\r\n    }\r\n]\r\n\r\nmodel_names = ['model1', 'model2']\r\n\r\ntrain_stats_list = []\r\n\r\n# train the models\r\nfor i in range(len(model_definitions)):\r\n    print('training model:', model_names[i])\r\n    model = LudwigModel(model_definition=model_definitions[i])\r\n    train_stats = model.train(data_df=df_train)\r\n    train_stats_list.append(train_stats)\r\n\r\n# create learning_curve plot for the training\r\nlearning_curves(train_stats_list,'y', model_names=model_names, output_directory='./viz', file_format='png')\r\n```\r\n\r\n**Expected behavior**\r\nLearning rate curve plot for the multiple model training.\r\n\r\n**Screenshots**\r\nSee error message above.\r\n\r\n**Environment (please complete the following information):**\r\n - OS: MacOS 10.15.2\r\n - Docker Container base image: Ubuntu 18.04\r\n - TensorFlow: 1.14.0\r\n- Python version: 3.6.8\r\n- Ludwig version: 0.2.1\r\n\r\n**Additional context**\r\nFrom what I can tell the error occurs because early stopping caused different number of epochs to be recorded for the two model training runs.  \r\n\r\nIf I can determine root cause, I'll submit a PR to fix.\r\n","closed_by":{"login":"jimthompson5802","id":1425269,"node_id":"MDQ6VXNlcjE0MjUyNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1425269?v=4","gravatar_id":"","url":"https://api.github.com/users/jimthompson5802","html_url":"https://github.com/jimthompson5802","followers_url":"https://api.github.com/users/jimthompson5802/followers","following_url":"https://api.github.com/users/jimthompson5802/following{/other_user}","gists_url":"https://api.github.com/users/jimthompson5802/gists{/gist_id}","starred_url":"https://api.github.com/users/jimthompson5802/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimthompson5802/subscriptions","organizations_url":"https://api.github.com/users/jimthompson5802/orgs","repos_url":"https://api.github.com/users/jimthompson5802/repos","events_url":"https://api.github.com/users/jimthompson5802/events{/privacy}","received_events_url":"https://api.github.com/users/jimthompson5802/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/585/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/585/timeline","performed_via_github_app":null,"state_reason":"completed"}