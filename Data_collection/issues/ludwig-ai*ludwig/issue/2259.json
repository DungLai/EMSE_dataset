{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2259","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2259/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2259/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2259/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/2259","id":1301750295,"node_id":"I_kwDOCbx2hs5NlyIX","number":2259,"title":"Incorrect predictions are produced","user":{"login":"jimthompson5802","id":1425269,"node_id":"MDQ6VXNlcjE0MjUyNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1425269?v=4","gravatar_id":"","url":"https://api.github.com/users/jimthompson5802","html_url":"https://github.com/jimthompson5802","followers_url":"https://api.github.com/users/jimthompson5802/followers","following_url":"https://api.github.com/users/jimthompson5802/following{/other_user}","gists_url":"https://api.github.com/users/jimthompson5802/gists{/gist_id}","starred_url":"https://api.github.com/users/jimthompson5802/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimthompson5802/subscriptions","organizations_url":"https://api.github.com/users/jimthompson5802/orgs","repos_url":"https://api.github.com/users/jimthompson5802/repos","events_url":"https://api.github.com/users/jimthompson5802/events{/privacy}","received_events_url":"https://api.github.com/users/jimthompson5802/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"justinxzhao","id":3459541,"node_id":"MDQ6VXNlcjM0NTk1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/3459541?v=4","gravatar_id":"","url":"https://api.github.com/users/justinxzhao","html_url":"https://github.com/justinxzhao","followers_url":"https://api.github.com/users/justinxzhao/followers","following_url":"https://api.github.com/users/justinxzhao/following{/other_user}","gists_url":"https://api.github.com/users/justinxzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/justinxzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinxzhao/subscriptions","organizations_url":"https://api.github.com/users/justinxzhao/orgs","repos_url":"https://api.github.com/users/justinxzhao/repos","events_url":"https://api.github.com/users/justinxzhao/events{/privacy}","received_events_url":"https://api.github.com/users/justinxzhao/received_events","type":"User","site_admin":false},"assignees":[{"login":"justinxzhao","id":3459541,"node_id":"MDQ6VXNlcjM0NTk1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/3459541?v=4","gravatar_id":"","url":"https://api.github.com/users/justinxzhao","html_url":"https://github.com/justinxzhao","followers_url":"https://api.github.com/users/justinxzhao/followers","following_url":"https://api.github.com/users/justinxzhao/following{/other_user}","gists_url":"https://api.github.com/users/justinxzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/justinxzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinxzhao/subscriptions","organizations_url":"https://api.github.com/users/justinxzhao/orgs","repos_url":"https://api.github.com/users/justinxzhao/repos","events_url":"https://api.github.com/users/justinxzhao/events{/privacy}","received_events_url":"https://api.github.com/users/justinxzhao/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2022-07-12T08:51:02Z","updated_at":"2022-07-13T01:05:03Z","closed_at":"2022-07-13T01:05:03Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"**Describe the bug**\r\nAfter merge of PR #2027, incorrect predictions are generated.\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\n1. Checkout repo to commit aa0c63b\r\n1. Run this simple linear regression model\r\n\r\n```\r\nimport logging\r\nfrom typing import Callable, Union, Dict, Any, Optional\r\nimport shutil\r\n\r\nimport pandas as pd\r\n\r\nfrom sklearn.datasets import make_regression\r\nimport matplotlib.pyplot as plt\r\n\r\nimport torch\r\nfrom torch import Tensor\r\n\r\n\r\nfrom ludwig.api import LudwigModel\r\n\r\n\r\n\r\n\r\n# self test\r\nif __name__ == \"__main__\":\r\n    import numpy as np\r\n\r\n    config = {\r\n        \"input_features\": [\r\n            {\"type\": \"number\", \"name\": \"x00\"},\r\n        ],\r\n        \"output_features\": [\r\n            {\r\n                \"name\": \"y\",\r\n                \"type\": \"number\",\r\n            },\r\n        ],\r\n        \"trainer\":{\r\n            \"epochs\": 50,\r\n            \"learning_rate\": 0.001,\r\n            \"optimizer\": {\"type\": \"sgd\", \"momentum\": 0.9},\r\n        },\r\n    }\r\n\r\n    # Generate some non-linear noisy training data\r\n    n_points = 500\r\n    np.random.seed(1919)\r\n    x_train = np.linspace(-1, 1, n_points)[:, np.newaxis]\r\n    y_train = x_train + 0.4 * x_train * np.random.randn(n_points)[:, np.newaxis]\r\n    # plt.figure(1)\r\n    # plt.scatter(x_train, y_train, alpha=0.2);\r\n    # plt.xlabel('x')\r\n    # plt.ylabel('y')\r\n    # plt.savefig(\"raw2_data.png\")\r\n    df = pd.DataFrame(\r\n        np.hstack([x_train.reshape(-1,1), y_train.reshape(-1,1)]),\r\n        columns=[\"x00\", \"y\"]\r\n    )\r\n    df.to_csv('data/train.csv', index=False)\r\n    print(df.head(10))\r\n\r\n    model = LudwigModel(\r\n        config=config,\r\n        logging_level=logging.WARN\r\n    )\r\n\r\n    shutil.rmtree(\"/tmp/results\", ignore_errors=True)\r\n    training_stats, preprocessed_data, results_dir = model.train(\r\n        training_set=\"data/train.csv\", output_directory=\"/tmp/results\", random_seed=1919\r\n    )\r\n\r\n    for n, w in model.model.named_parameters():\r\n        print(n, w)\r\n\r\n    predictions = model.predict(\"data/train.csv\")\r\n    print(f\"test data predictions head:\\n{predictions[0].head(10)}\")\r\n    print(f\"test data predictions head:\\n{predictions[0].tail(10)}\")\r\n\r\n    plt.figure(4)\r\n    plt.scatter(x_train, y_train, marker='.', alpha=0.2, label='data')\r\n    y_preds = model.predict(df)\r\n    y_hat = y_preds[0][\"y_predictions\"]\r\n    plt.plot(x_train, y_hat, color='black', label='model $\\mu$')\r\n    plt.xlabel('x')\r\n    plt.ylabel('y')\r\n    plt.legend()\r\n    plt.savefig(\"linear_regression_plot.png\")\r\n\r\n\r\n    print(model.model)\r\n\r\n    from io import StringIO\r\n    my_data = \"\"\"x00\r\n    -0.99\r\n    0\r\n    0.99\r\n    \"\"\"\r\n\r\n    preds = model.predict(pd.read_csv(StringIO(my_data)))\r\n    print(preds)\r\n\r\n\r\n    print(\"all done\")\r\n```\r\nThis will produce this plot, which  is incorrect.\r\n<img width=\"651\" alt=\"image\" src=\"https://user-images.githubusercontent.com/1425269/178448632-42c5ebf1-6b83-4b3a-a70e-36dcbaaf915f.png\">\r\n\r\n\r\n**Expected behavior**\r\nRunning the same program at the prior commit d0e8439  the plot looks like this, which is the expected result\r\n<img width=\"643\" alt=\"image\" src=\"https://user-images.githubusercontent.com/1425269/178449058-317e0a53-0742-4f40-9612-f623a50fb2fd.png\">\r\n\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Environment (please complete the following information):**\r\n\r\n- OS: MacOS 12.4 with Docker Desktop 4.6.0 \r\n- Python version 3.8\r\n- Ludwig version. 0.6.dev\r\n\r\n","closed_by":{"login":"justinxzhao","id":3459541,"node_id":"MDQ6VXNlcjM0NTk1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/3459541?v=4","gravatar_id":"","url":"https://api.github.com/users/justinxzhao","html_url":"https://github.com/justinxzhao","followers_url":"https://api.github.com/users/justinxzhao/followers","following_url":"https://api.github.com/users/justinxzhao/following{/other_user}","gists_url":"https://api.github.com/users/justinxzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/justinxzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinxzhao/subscriptions","organizations_url":"https://api.github.com/users/justinxzhao/orgs","repos_url":"https://api.github.com/users/justinxzhao/repos","events_url":"https://api.github.com/users/justinxzhao/events{/privacy}","received_events_url":"https://api.github.com/users/justinxzhao/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2259/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2259/timeline","performed_via_github_app":null,"state_reason":"completed"}