{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/705","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/705/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/705/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/705/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/705","id":614035337,"node_id":"MDU6SXNzdWU2MTQwMzUzMzc=","number":705,"title":"Dst tensor is not initialized.","user":{"login":"donfour10","id":55831555,"node_id":"MDQ6VXNlcjU1ODMxNTU1","avatar_url":"https://avatars.githubusercontent.com/u/55831555?v=4","gravatar_id":"","url":"https://api.github.com/users/donfour10","html_url":"https://github.com/donfour10","followers_url":"https://api.github.com/users/donfour10/followers","following_url":"https://api.github.com/users/donfour10/following{/other_user}","gists_url":"https://api.github.com/users/donfour10/gists{/gist_id}","starred_url":"https://api.github.com/users/donfour10/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/donfour10/subscriptions","organizations_url":"https://api.github.com/users/donfour10/orgs","repos_url":"https://api.github.com/users/donfour10/repos","events_url":"https://api.github.com/users/donfour10/events{/privacy}","received_events_url":"https://api.github.com/users/donfour10/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2020-05-07T12:54:52Z","updated_at":"2020-09-28T23:59:13Z","closed_at":"2020-09-28T23:58:58Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the bug**\r\nI'm have trained a model with this definition on my GPU.\r\n\r\n![image](https://user-images.githubusercontent.com/55831555/81293330-6c3d1980-906d-11ea-9e5b-50eb5b231413.png)\r\n\r\nThe training works properly but when I try to test or predict on this model, I get a ERROR:\r\n\r\n---\r\n\r\n2020-05-07 14:06:47.078732: I tensorflow/core/common_runtime/bfc_allocator.cc:818] total_region_allocated_bytes_: 7972913152 memory_limit_: 7972913152 available bytes: 0 curr_region_allocation_bytes_: 8589934592\r\n2020-05-07 14:06:47.078742: I tensorflow/core/common_runtime/bfc_allocator.cc:824] Stats: \r\nLimit:                  7972913152\r\nInUse:                  7972913152\r\nMaxInUse:               7972913152\r\nNumAllocs:                    2388\r\nMaxAllocSize:            125018112\r\n\r\n2020-05-07 14:06:47.078800: W tensorflow/core/common_runtime/bfc_allocator.cc:319] ****************************************************************************************************\r\nTraceback (most recent call last):\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/tensorflow/python/client/session.py\", line 1356, in _do_call\r\n    return fn(*args)\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/tensorflow/python/client/session.py\", line 1341, in _run_fn\r\n    options, feed_dict, fetch_list, target_list, run_metadata)\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/tensorflow/python/client/session.py\", line 1429, in _call_tf_sessionrun\r\n    run_metadata)\r\ntensorflow.python.framework.errors_impl.InternalError: Dst tensor is not initialized.\r\n         [[{{node save/RestoreV2}}]]\r\n\r\n---\r\n\r\nI know this is a tensorflow error and that the meaning is, that my GPU is out of memory, but I think that something is not right there. Because the train command is working also and after the training of each epoch there's even executed a test. So i don't get why then the test say's, my GPU gets out of memory.\r\n\r\nI even tried to lower my test/predict dataset and do it with only one Row as input, but the same error message occures.\r\n\r\n**To Reproduce**\r\ninput features: text\r\nencoder: bert (https://storage.googleapis.com/bert_models/2019_05_30/wwm_uncased_L-24_H-1024_A-16.zip)\r\noutput feature: set of categories\r\n\r\ntrain cmd (is working):\r\nludwig train --data_csv /analyst/ludwig_experiments/datasets/norm_and_imp_targets/training.csv -mdf /analyst/model_definition.yaml --output_directory /analyst/ludwig_experiments/datasets/norm_and_imp_targets/results --experiment_name bert --gpus 0\r\n\r\ntest cmd(also tried predict cmd):\r\nludwig test --data_csv /analyst/ludwig_experiments/datasets/norm_and_imp_targets/pred_test.csv --m /analyst/ludwig_experiments/datasets/norm_and_imp_targets/results/bert_run_20/model -od /analyst/ludwig_experiments/datasets/norm_and_imp_targets/results/bert_run_20/test -g 0 -bs 1\r\n\r\nIf you need a sample of data, contact me and I see if I can provide something to you.\r\n\r\n**Expected behavior**\r\nTest will be executed and I can see my predictions and probabilities.\r\n\r\n**Environment (please complete the following information):**\r\n- OS: Ubuntu\r\n- Version 19.01\r\n- Python version 3.7.5\r\n- Ludwig version 0.2.1\r\n\r\n**Additional context**\r\nI add the lower part of the ERROR massage here. I thought the upper part which I inserted above is the important part, but maybe I'm wrong.\r\n\r\nThanks in advance!\r\n\r\n---\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/dustingpu/.local/bin/ludwig\", line 10, in <module>\r\n    sys.exit(main())\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/ludwig/cli.py\", line 108, in main\r\n    CLI()\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/ludwig/cli.py\", line 64, in __init__\r\n    getattr(self, args.command)()\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/ludwig/cli.py\", line 89, in test\r\n    test_performance.cli(sys.argv[2:])\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/ludwig/test_performance.py\", line 164, in cli\r\n    full_predict(**vars(args))\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/ludwig/predict.py\", line 100, in full_predict\r\n    debug\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/ludwig/predict.py\", line 182, in predict\r\n    gpu_fraction=gpu_fraction\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/ludwig/models/model.py\", line 1236, in predict\r\n    self.restore(session, self.weights_save_path)\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/ludwig/models/model.py\", line 1371, in restore\r\n    self.saver.restore(session, weights_path)\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/tensorflow/python/training/saver.py\", line 1286, in restore\r\n    {self.saver_def.filename_tensor_name: save_path})\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/tensorflow/python/client/session.py\", line 950, in run\r\n    run_metadata_ptr)\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/tensorflow/python/client/session.py\", line 1173, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/tensorflow/python/client/session.py\", line 1350, in _do_run\r\n    run_metadata)\r\n  File \"/home/dustingpu/.local/lib/python3.7/site-packages/tensorflow/python/client/session.py\", line 1370, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InternalError: Dst tensor is not initialized.\r\n         [[node save/RestoreV2 (defined at /lib/python3.7/site-packages/ludwig/models/model.py:216) ]]\r\n\r\nOriginal stack trace for 'save/RestoreV2':\r\n  File \"/bin/ludwig\", line 10, in <module>\r\n    sys.exit(main())\r\n  File \"/lib/python3.7/site-packages/ludwig/cli.py\", line 108, in main\r\n    CLI()\r\n  File \"/lib/python3.7/site-packages/ludwig/cli.py\", line 64, in __init__\r\n    getattr(self, args.command)()\r\n  File \"/lib/python3.7/site-packages/ludwig/cli.py\", line 89, in test\r\n    test_performance.cli(sys.argv[2:])\r\n  File \"/lib/python3.7/site-packages/ludwig/test_performance.py\", line 164, in cli\r\n    full_predict(**vars(args))\r\n  File \"/lib/python3.7/site-packages/ludwig/predict.py\", line 89, in full_predict\r\n    use_horovod=use_horovod)\r\n  File \"/lib/python3.7/site-packages/ludwig/models/model.py\", line 1677, in load_model_and_definition\r\n    model = Model.load(model_dir, use_horovod=use_horovod)\r\n  File \"/lib/python3.7/site-packages/ludwig/models/model.py\", line 1380, in load\r\n    model = Model(use_horovod=use_horovod, **hyperparameters)\r\n  File \"/lib/python3.7/site-packages/ludwig/models/model.py\", line 113, in __init__\r\n    **kwargs\r\n  File \"/lib/python3.7/site-packages/ludwig/models/model.py\", line 216, in __build\r\n    self.saver = tf.compat.v1.train.Saver()\r\n  File \"/lib/python3.7/site-packages/tensorflow/python/training/saver.py\", line 825, in __init__\r\n    self.build()\r\n  File \"/lib/python3.7/site-packages/tensorflow/python/training/saver.py\", line 837, in build\r\n    self._build(self._filename, build_save=True, build_restore=True)\r\n  File \"/lib/python3.7/site-packages/tensorflow/python/training/saver.py\", line 875, in _build\r\n    build_restore=build_restore)\r\n  File \"/lib/python3.7/site-packages/tensorflow/python/training/saver.py\", line 508, in _build_internal\r\n    restore_sequentially, reshape)\r\n  File \"/lib/python3.7/site-packages/tensorflow/python/training/saver.py\", line 328, in _AddRestoreOps\r\n    restore_sequentially)\r\n  File \"/lib/python3.7/site-packages/tensorflow/python/training/saver.py\", line 575, in bulk_restore\r\n    return io_ops.restore_v2(filename_tensor, names, slices, dtypes)\r\n  File \"/lib/python3.7/site-packages/tensorflow/python/ops/gen_io_ops.py\", line 1696, in restore_v2\r\n    name=name)\r\n  File \"/lib/python3.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 788, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/lib/python3.7/site-packages/tensorflow/python/util/deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"/lib/python3.7/site-packages/tensorflow/python/framework/ops.py\", line 3616, in create_op\r\n    op_def=op_def)\r\n  File \"/lib/python3.7/site-packages/tensorflow/python/framework/ops.py\", line 2005, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\n---\r\n","closed_by":{"login":"w4nderlust","id":349256,"node_id":"MDQ6VXNlcjM0OTI1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/349256?v=4","gravatar_id":"","url":"https://api.github.com/users/w4nderlust","html_url":"https://github.com/w4nderlust","followers_url":"https://api.github.com/users/w4nderlust/followers","following_url":"https://api.github.com/users/w4nderlust/following{/other_user}","gists_url":"https://api.github.com/users/w4nderlust/gists{/gist_id}","starred_url":"https://api.github.com/users/w4nderlust/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/w4nderlust/subscriptions","organizations_url":"https://api.github.com/users/w4nderlust/orgs","repos_url":"https://api.github.com/users/w4nderlust/repos","events_url":"https://api.github.com/users/w4nderlust/events{/privacy}","received_events_url":"https://api.github.com/users/w4nderlust/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/705/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/705/timeline","performed_via_github_app":null,"state_reason":"completed"}