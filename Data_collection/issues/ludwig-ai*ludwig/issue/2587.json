{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2587","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2587/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2587/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2587/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/2587","id":1395521814,"node_id":"I_kwDOCbx2hs5TLfkW","number":2587,"title":"`Set` output features fail to save in Dask/Ray Backend","user":{"login":"geoffreyangus","id":29719151,"node_id":"MDQ6VXNlcjI5NzE5MTUx","avatar_url":"https://avatars.githubusercontent.com/u/29719151?v=4","gravatar_id":"","url":"https://api.github.com/users/geoffreyangus","html_url":"https://github.com/geoffreyangus","followers_url":"https://api.github.com/users/geoffreyangus/followers","following_url":"https://api.github.com/users/geoffreyangus/following{/other_user}","gists_url":"https://api.github.com/users/geoffreyangus/gists{/gist_id}","starred_url":"https://api.github.com/users/geoffreyangus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geoffreyangus/subscriptions","organizations_url":"https://api.github.com/users/geoffreyangus/orgs","repos_url":"https://api.github.com/users/geoffreyangus/repos","events_url":"https://api.github.com/users/geoffreyangus/events{/privacy}","received_events_url":"https://api.github.com/users/geoffreyangus/received_events","type":"User","site_admin":false},"labels":[{"id":1174068769,"node_id":"MDU6TGFiZWwxMTc0MDY4NzY5","url":"https://api.github.com/repos/ludwig-ai/ludwig/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-10-04T00:49:54Z","updated_at":"2022-10-04T00:49:54Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Error:\r\n```\r\nE                       ray.exceptions.RayTaskError(ValueError): ray::_map_block_nosplit() (pid=99553, ip=127.0.0.1)\r\nE                         File \"/Users/geoffreyangus/repositories/predibase/ludwig/venv38/lib/python3.8/site-packages/ray/air/util/tensor_extensions/pandas.py\", line 720, in __init__\r\nE                           raise TypeError(\r\nE                       TypeError: Tried to convert an ndarray of ndarray pointers (object dtype) to a well-typed ndarray but this failed; convert the ndarray to a well-typed ndarray before casting it as a TensorArray, and note that ragged tensors are NOT supported by TensorArray. First 5 subndarray types: [dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32')]\r\nE                       \r\nE                       The above exception was the direct cause of the following exception:\r\nE                       \r\nE                       ray::_map_block_nosplit() (pid=99553, ip=127.0.0.1)\r\nE                         File \"/Users/geoffreyangus/repositories/predibase/ludwig/venv38/lib/python3.8/site-packages/ray/data/_internal/compute.py\", line 449, in _map_block_nosplit\r\nE                           for new_block in block_fn(block, *fn_args, **fn_kwargs):\r\nE                         File \"/Users/geoffreyangus/repositories/predibase/ludwig/venv38/lib/python3.8/site-packages/ray/data/dataset.py\", line 480, in transform\r\nE                           yield output_buffer.next()\r\nE                         File \"/Users/geoffreyangus/repositories/predibase/ludwig/venv38/lib/python3.8/site-packages/ray/data/_internal/output_buffer.py\", line 74, in next\r\nE                           block = self._buffer.build()\r\nE                         File \"/Users/geoffreyangus/repositories/predibase/ludwig/venv38/lib/python3.8/site-packages/ray/data/_internal/delegating_block_builder.py\", line 64, in build\r\nE                           return self._builder.build()\r\nE                         File \"/Users/geoffreyangus/repositories/predibase/ludwig/venv38/lib/python3.8/site-packages/ray/data/_internal/table_block.py\", line 85, in build\r\nE                           return self._concat_tables(tables)\r\nE                         File \"/Users/geoffreyangus/repositories/predibase/ludwig/venv38/lib/python3.8/site-packages/ray/data/_internal/pandas_block.py\", line 110, in _concat_tables\r\nE                           df = _cast_ndarray_columns_to_tensor_extension(df)\r\nE                         File \"/Users/geoffreyangus/repositories/predibase/ludwig/venv38/lib/python3.8/site-packages/ray/air/util/data_batch_conversion.py\", line 160, in _cast_ndarray_columns_to_tensor_extension\r\nE                           raise ValueError(\r\nE                       ValueError: Tried to cast column set_FE746_probabilities to the TensorArray tensor extension type but the conversion failed. To disable automatic casting to this tensor extension, set ctx = DatasetContext.get_current(); ctx.enable_tensor_extension_casting = False.\r\n```\r\nThis is somewhat expected, because, for each sample, the Set feature outputs only the probabilities of the categories that were positively identified. This means that across the dataset, each sample may have a probabilities list of varying size.\r\n\r\nTo reproduce, navigate to `tests/integration_tests/test_ray.py::test_ray_save_outputs` , uncomment the `set_feature()` output feature, then run the test.","closed_by":null,"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2587/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2587/timeline","performed_via_github_app":null,"state_reason":null}