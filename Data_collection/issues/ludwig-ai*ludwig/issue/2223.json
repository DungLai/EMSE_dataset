{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2223","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2223/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2223/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2223/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/2223","id":1290288747,"node_id":"I_kwDOCbx2hs5M6D5r","number":2223,"title":"Cannot mix NumPy dtypes float64 and float32 ","user":{"login":"farazk86","id":33456896,"node_id":"MDQ6VXNlcjMzNDU2ODk2","avatar_url":"https://avatars.githubusercontent.com/u/33456896?v=4","gravatar_id":"","url":"https://api.github.com/users/farazk86","html_url":"https://github.com/farazk86","followers_url":"https://api.github.com/users/farazk86/followers","following_url":"https://api.github.com/users/farazk86/following{/other_user}","gists_url":"https://api.github.com/users/farazk86/gists{/gist_id}","starred_url":"https://api.github.com/users/farazk86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farazk86/subscriptions","organizations_url":"https://api.github.com/users/farazk86/orgs","repos_url":"https://api.github.com/users/farazk86/repos","events_url":"https://api.github.com/users/farazk86/events{/privacy}","received_events_url":"https://api.github.com/users/farazk86/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-06-30T15:17:37Z","updated_at":"2022-07-05T13:40:45Z","closed_at":"2022-07-05T13:40:45Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the bug**\r\n\r\nI have a text dataset where each row has multiple labels. I am trying to perform multi-label classification on it. Cant share the dataset but has the following simple structure\r\n```\r\n| both_text      | labels                               |\r\n|----------------|--------------------------------------|\r\n| Free text here | economy health labour                |\r\n| Free text here | health lawcrime tactical             |\r\n| Free text here | economy health education environment |\r\n```\r\n\r\n\r\n\r\n**To Reproduce**\r\n\r\nI'm using the following config file to train my model\r\n\r\n```yaml\r\nconfig_transformer = {\r\n    \"input_features\": [\r\n        {\r\n            \"name\": \"both_text\",\r\n            \"type\": \"text\",\r\n            \"preprocessing\": {\r\n                \"tokenizer\": \"space\",\r\n            },\r\n            \"encoder\": \"transformer\",\r\n            \"num_layers\": 3,  # the number of transformer blocks\r\n            \"reduce_output\": None,\r\n        }\r\n    ],\r\n    \"preprocessing\": {\r\n        \"split_probabilities\": [0.8, 0.1, 0.1],\r\n    },\r\n    \"output_features\": [\r\n        {\r\n            \"name\": \"labels\",\r\n            \"type\": \"set\",\r\n        },\r\n    ],\r\n    \"trainer\": {\r\n        \"epochs\": 50,\r\n        \"early_stop\": 3,\r\n        \"batch_size\": 128,\r\n    }\r\n\r\n}\r\n```\r\n\r\nThe below code to train and evaluate\r\n\r\n```python\r\ntrain_stats, preprocessed_data, train_output_directory = model.train(dataset=train_df, experiment_name=experiment)\r\n\r\n# evaluate the model and save the results\r\ntest_stats, predictions, test_output_directory = model.evaluate(\r\n  test_df,\r\n  collect_predictions=True,\r\n  collect_overall_stats=True,\r\n  output_directory=os.path.join('results', experiment + '_run', 'pred_results'),\r\n  skip_save_predictions=False,\r\n  skip_save_eval_stats=False,\r\n)\r\n```\r\n\r\nThe training goes ahead fine but at the evaluation stage I get the following error:\r\n\r\n```\r\nCannot mix NumPy dtypes float64 and float32', 'Conversion failed for column labels_probabilities with type object\r\n```\r\n\r\nDoing a Google search on that led me to this SO answer: https://stackoverflow.com/questions/67502942/arrowtypeerror-did-not-pass-numpy-dtype-object-conversion-failed-for-column\r\n\r\nI did as advised and downgraded my numpy model to ``1.19.5`` and that seems to fix the problem and now my prediction output generates.\r\n\r\nDont know how this will affect the rest of Ludwig, but just wanted to bring this to the attention of the devs :)\r\n\r\n\r\n\r\n**Environment (please complete the following information):**\r\n\r\n- OS: \\[e.g. iOS\\] Windows 10\r\n- Version \\[e.g. 22\\] 64 bit\r\n- Python version 3.8.10\r\n- Ludwig version 0.5.3\r\n\r\n\r\n","closed_by":{"login":"farazk86","id":33456896,"node_id":"MDQ6VXNlcjMzNDU2ODk2","avatar_url":"https://avatars.githubusercontent.com/u/33456896?v=4","gravatar_id":"","url":"https://api.github.com/users/farazk86","html_url":"https://github.com/farazk86","followers_url":"https://api.github.com/users/farazk86/followers","following_url":"https://api.github.com/users/farazk86/following{/other_user}","gists_url":"https://api.github.com/users/farazk86/gists{/gist_id}","starred_url":"https://api.github.com/users/farazk86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farazk86/subscriptions","organizations_url":"https://api.github.com/users/farazk86/orgs","repos_url":"https://api.github.com/users/farazk86/repos","events_url":"https://api.github.com/users/farazk86/events{/privacy}","received_events_url":"https://api.github.com/users/farazk86/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2223/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2223/timeline","performed_via_github_app":null,"state_reason":"completed"}