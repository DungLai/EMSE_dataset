{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/670","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/670/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/670/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/670/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/670","id":592974113,"node_id":"MDU6SXNzdWU1OTI5NzQxMTM=","number":670,"title":"MNIST Example fails with AttributeError: 'NoneType' object has no attribute 'read' if pillow>7.0.0","user":{"login":"jplehmann","id":460964,"node_id":"MDQ6VXNlcjQ2MDk2NA==","avatar_url":"https://avatars.githubusercontent.com/u/460964?v=4","gravatar_id":"","url":"https://api.github.com/users/jplehmann","html_url":"https://github.com/jplehmann","followers_url":"https://api.github.com/users/jplehmann/followers","following_url":"https://api.github.com/users/jplehmann/following{/other_user}","gists_url":"https://api.github.com/users/jplehmann/gists{/gist_id}","starred_url":"https://api.github.com/users/jplehmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jplehmann/subscriptions","organizations_url":"https://api.github.com/users/jplehmann/orgs","repos_url":"https://api.github.com/users/jplehmann/repos","events_url":"https://api.github.com/users/jplehmann/events{/privacy}","received_events_url":"https://api.github.com/users/jplehmann/received_events","type":"User","site_admin":false},"labels":[{"id":1738145946,"node_id":"MDU6TGFiZWwxNzM4MTQ1OTQ2","url":"https://api.github.com/repos/ludwig-ai/ludwig/labels/dependencies","name":"dependencies","color":"6b0029","default":false,"description":"Pull requests that update a dependency file"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2020-04-02T23:16:23Z","updated_at":"2020-04-04T03:51:55Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"**Describe the bug**\r\nTrying to reproduce the MNIST demo.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\nFollow instructions at: https://uber.github.io/ludwig/examples/#image-classification-mnist\r\n\r\nI have a directory like so:\r\n```\r\n$ pwd\r\n/Users/john/git/ludwig-sandbox/MNIST/mnist_png/mnist_png\r\n\r\n$ ls\r\ntraining\r\ntesting\r\nmnist_dataset_training.csv\r\nmnist_dataset_testing.csv\r\nmodel_definition.yaml\r\nresults\r\n\r\ntime ludwig train   --data_train_csv mnist_dataset_training.csv   --data_test_csv  mnist_dataset_testing.csv   --model_definition_file model_definition.yaml\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/john/.venv/ludwig/bin/ludwig\", line 11, in <module>\r\n    load_entry_point('ludwig==0.2.2.4', 'console_scripts', 'ludwig')()\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/ludwig/cli.py\", line 118, in main\r\n    CLI()\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/ludwig/cli.py\", line 64, in __init__\r\n    getattr(self, args.command)()\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/ludwig/cli.py\", line 74, in train\r\n    train.cli(sys.argv[2:])\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/ludwig/train.py\", line 806, in cli\r\n    full_train(**vars(args))\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/ludwig/train.py\", line 301, in full_train\r\n    random_seed=random_seed\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/ludwig/data/preprocessing.py\", line 339, in preprocess_for_training\r\n    random_seed=random_seed\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/ludwig/data/preprocessing.py\", line 528, in preprocess_for_training_by_type\r\n    random_seed=random_seed\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/ludwig/data/preprocessing.py\", line 655, in _preprocess_csv_for_training\r\n    random_seed=random_seed\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/ludwig/data/preprocessing.py\", line 96, in build_dataset_df\r\n    global_preprocessing_parameters\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/ludwig/data/preprocessing.py\", line 171, in build_data\r\n    preprocessing_parameters\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/ludwig/features/image_feature.py\", line 269, in add_feature_data\r\n    preprocessing_parameters, first_image_path\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/ludwig/features/image_feature.py\", line 179, in _finalize_preprocessing_parameters\r\n    first_image = imread(first_image_path)\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/skimage/io/_io.py\", line 62, in imread\r\n    img = call_plugin('imread', fname, plugin=plugin, **plugin_args)\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/skimage/io/manage_plugins.py\", line 214, in call_plugin\r\n    return func(*args, **kwargs)\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/skimage/io/_plugins/pil_plugin.py\", line 37, in imread\r\n    return pil_to_ndarray(im, dtype=dtype, img_num=img_num)\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/skimage/io/_plugins/pil_plugin.py\", line 67, in pil_to_ndarray\r\n    image.seek(i)\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/PIL/PngImagePlugin.py\", line 748, in seek\r\n    self._seek(f)\r\n  File \"/Users/john/.venv/ludwig/lib/python3.7/site-packages/PIL/PngImagePlugin.py\", line 791, in _seek\r\n    cid, pos, length = self.png.read()\r\nAttributeError: 'NoneType' object has no attribute 'read'\r\n```\r\n\r\nPlease provide code, yaml definition file and a sample of data in order to entirely reproduce the issue.\r\nIssues that are not reproducible will be ignored.\r\n\r\n**Expected behavior**\r\nI expect it to run the experiment.\r\n\r\n**Environment (please complete the following information):**\r\n - OS: OSX\r\n - Version: 10.15.4\r\n- Python version `Python 3.7.3`\r\n- Ludwig version `ludwig==0.2.2.4`\r\n\r\n**Additional context**\r\nI put a breakpoint in the pil plugin and inspected the path it's using, which seems entirely valid.  I think the permissions on all the dirs are valid... \r\n```\r\n$ ll /Users/john/git/ludwig-sandbox/MNIST/mnist_png/mnist_png/training/0/16585.png \r\n-rw-r----- 1 john staff 315 Dec 10  2015 /Users/john/git/ludwig-sandbox/MNIST/mnist_png/mnist_png/training/0/16585.png\r\n```","closed_by":null,"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/670/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/670/timeline","performed_via_github_app":null,"state_reason":null}