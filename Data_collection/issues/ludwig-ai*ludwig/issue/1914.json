{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1914","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1914/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1914/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1914/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/1914","id":1203673118,"node_id":"I_kwDOCbx2hs5Hvpge","number":1914,"title":"Fresh install of ludwig does not work without torchtext and torchvision.  Also psutil missing from requirements.txt","user":{"login":"dantreiman","id":687280,"node_id":"MDQ6VXNlcjY4NzI4MA==","avatar_url":"https://avatars.githubusercontent.com/u/687280?v=4","gravatar_id":"","url":"https://api.github.com/users/dantreiman","html_url":"https://github.com/dantreiman","followers_url":"https://api.github.com/users/dantreiman/followers","following_url":"https://api.github.com/users/dantreiman/following{/other_user}","gists_url":"https://api.github.com/users/dantreiman/gists{/gist_id}","starred_url":"https://api.github.com/users/dantreiman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dantreiman/subscriptions","organizations_url":"https://api.github.com/users/dantreiman/orgs","repos_url":"https://api.github.com/users/dantreiman/repos","events_url":"https://api.github.com/users/dantreiman/events{/privacy}","received_events_url":"https://api.github.com/users/dantreiman/received_events","type":"User","site_admin":false},"labels":[{"id":4032822844,"node_id":"LA_kwDOCbx2hs7wX_48","url":"https://api.github.com/repos/ludwig-ai/ludwig/labels/productivity%20and%20code%20quality","name":"productivity and code quality","color":"bfd4f2","default":false,"description":"Engineer productivity, maintainability, consistency, readability"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-04-13T19:01:37Z","updated_at":"2022-04-18T23:56:37Z","closed_at":"2022-04-18T23:56:37Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"TL;DR: I recommend we move `torchvision`, `torchtext` and `ray` into the default requirements.txt\r\n\r\nMy reasoning is this: new users should be able to use all of the features of Ludwig without extra steps, including text, images, and ray parallelism.\r\n\r\n---\r\n\r\nLudwig's code today does not isolate the text and vision dependencies, and this easily goes unnoticed because most DL environments with torch have torchtext and torchvision installed already.  Though we could untangle and encapsulate these python deps I do not think it is worth the added complexity.\r\n\r\nI think the cost of installing `torchvision` and `torchtext` is trivial compared to the engineering cost of maintaining optional dependencies on these packages and gracefully handling errors when these packages are not installed.\r\n\r\nIf someone is developing a container, and they aren't using images and they really need to forgo installing `torchvision` to save space, that is a 1% case, and we can provide a way to do that but it should not be the default.  Maybe we could make a `ludwig-serve` package that strips away all but the minimial dependencies for serving?  Just a thought.\r\n\r\n---\r\n\r\nHere is the log of a new install I just ran today:\r\n\r\nIn a new conda environment `temp39`, I installed ludwig `pip install -e .` then try to train higgs:\r\n\r\n```\r\n(temp39) daniel@Daniel-M1-Pro higgs % python train_higgs_small.py\r\nNote: NumExpr detected 10 cores but \"NUMEXPR_MAX_THREADS\" not set, so enforcing safe limit of 8.\r\nNumExpr defaulting to 8 threads.\r\nTraceback (most recent call last):\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/examples/tabnet/higgs/train_higgs_small.py\", line 3, in <module>\r\n    from ludwig.api import LudwigModel\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/api.py\", line 38, in <module>\r\n    from ludwig.backend import Backend, initialize_backend\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/backend/__init__.py\", line 20, in <module>\r\n    from ludwig.backend.base import Backend, LocalBackend\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/backend/base.py\", line 25, in <module>\r\n    from ludwig.models.ecd import ECD\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/models/ecd.py\", line 10, in <module>\r\n    from ludwig.combiners.combiners import Combiner, get_combiner_class\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/combiners/combiners.py\", line 25, in <module>\r\n    import ludwig.marshmallow.marshmallow_schema_utils as schema\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/marshmallow/marshmallow_schema_utils.py\", line 10, in <module>\r\n    from ludwig.modules.reduction_modules import reduce_mode_registry\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/modules/reduction_modules.py\", line 19, in <module>\r\n    from ludwig.modules.attention_modules import FeedForwardAttentionReducer\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/modules/attention_modules.py\", line 21, in <module>\r\n    from ludwig.utils.torch_utils import get_activation, LudwigModule\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/utils/torch_utils.py\", line 12, in <module>\r\n    from ludwig.utils.strings_utils import SpecialSymbol\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/utils/strings_utils.py\", line 29, in <module>\r\n    from ludwig.utils.tokenizers import tokenizer_registry\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/utils/tokenizers.py\", line 21, in <module>\r\n    import torchtext\r\nModuleNotFoundError: No module named 'torchtext'\r\n```\r\n\r\nTo fix this, I install the text dependencies:  `pip install -e \".[text]\"`\r\n\r\nAfter installing `torchtext`:\r\n\r\n```\r\n(temp39) daniel@Daniel-M1-Pro higgs % python train_higgs_small.py\r\nNote: NumExpr detected 10 cores but \"NUMEXPR_MAX_THREADS\" not set, so enforcing safe limit of 8.\r\nNumExpr defaulting to 8 threads.\r\nTraceback (most recent call last):\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/examples/tabnet/higgs/train_higgs_small.py\", line 3, in <module>\r\n    from ludwig.api import LudwigModel\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/api.py\", line 38, in <module>\r\n    from ludwig.backend import Backend, initialize_backend\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/backend/__init__.py\", line 20, in <module>\r\n    from ludwig.backend.base import Backend, LocalBackend\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/backend/base.py\", line 25, in <module>\r\n    from ludwig.models.ecd import ECD\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/models/ecd.py\", line 10, in <module>\r\n    from ludwig.combiners.combiners import Combiner, get_combiner_class\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/combiners/combiners.py\", line 27, in <module>\r\n    from ludwig.encoders.sequence_encoders import ParallelCNN, StackedCNN, StackedCNNRNN, StackedParallelCNN, StackedRNN\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/encoders/__init__.py\", line 8, in <module>\r\n    import ludwig.encoders.image_encoders\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/encoders/image_encoders.py\", line 24, in <module>\r\n    from ludwig.modules.convolutional_modules import Conv2DStack, ResNet\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/modules/convolutional_modules.py\", line 22, in <module>\r\n    from ludwig.utils.image_utils import get_img_output_shape\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/ludwig/utils/image_utils.py\", line 26, in <module>\r\n    import torchvision.transforms.functional as F\r\nModuleNotFoundError: No module named 'torchvision'\r\n```\r\n\r\nAfter installing `pip install -e \".[image]\"`\r\n\r\n```\r\n(temp39) daniel@Daniel-M1-Pro higgs % python train_higgs_small.py\r\nNote: NumExpr detected 10 cores but \"NUMEXPR_MAX_THREADS\" not set, so enforcing safe limit of 8.\r\nNumExpr defaulting to 8 threads.\r\nimport ray failed with exception: No module named 'ray'\r\nTraceback (most recent call last):\r\n  File \"/Users/daniel/Desktop/github/dantreiman-ludwig/examples/tabnet/higgs/train_higgs_small.py\", line 3, in <module>\r\n    from ludwig.api import LudwigModel\r\n  File \"/Users/daniel/mambaforge/envs/temp39/lib/python3.9/site-packages/ludwig/api.py\", line 66, in <module>\r\n    from ludwig.models.predictor import (\r\n  File \"/Users/daniel/mambaforge/envs/temp39/lib/python3.9/site-packages/ludwig/models/predictor.py\", line 10, in <module>\r\n    import psutil\r\nModuleNotFoundError: No module named 'psutil'\r\n```\r\n\r\nOops, we also need to install `psutil`. `pip install psutil`:\r\n\r\nOk now it trains, but I don't have ray so it only uses one core:\r\n```\r\n(temp39) daniel@Daniel-M1-Pro higgs % python train_higgs_small.py\r\nNote: NumExpr detected 10 cores but \"NUMEXPR_MAX_THREADS\" not set, so enforcing safe limit of 8.\r\nNumExpr defaulting to 8 threads.\r\nimport ray failed with exception: No module named 'ray'\r\n```\r\n","closed_by":{"login":"tgaddair","id":1742912,"node_id":"MDQ6VXNlcjE3NDI5MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1742912?v=4","gravatar_id":"","url":"https://api.github.com/users/tgaddair","html_url":"https://github.com/tgaddair","followers_url":"https://api.github.com/users/tgaddair/followers","following_url":"https://api.github.com/users/tgaddair/following{/other_user}","gists_url":"https://api.github.com/users/tgaddair/gists{/gist_id}","starred_url":"https://api.github.com/users/tgaddair/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tgaddair/subscriptions","organizations_url":"https://api.github.com/users/tgaddair/orgs","repos_url":"https://api.github.com/users/tgaddair/repos","events_url":"https://api.github.com/users/tgaddair/events{/privacy}","received_events_url":"https://api.github.com/users/tgaddair/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1914/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1914/timeline","performed_via_github_app":null,"state_reason":"completed"}