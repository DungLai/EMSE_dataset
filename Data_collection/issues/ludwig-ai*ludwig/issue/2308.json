{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2308","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2308/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2308/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2308/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/2308","id":1317101464,"node_id":"I_kwDOCbx2hs5OgV-Y","number":2308,"title":"Metadata mismatch while calculating overall stats","user":{"login":"arnavgarg1","id":106701836,"node_id":"U_kgDOBlwkDA","avatar_url":"https://avatars.githubusercontent.com/u/106701836?v=4","gravatar_id":"","url":"https://api.github.com/users/arnavgarg1","html_url":"https://github.com/arnavgarg1","followers_url":"https://api.github.com/users/arnavgarg1/followers","following_url":"https://api.github.com/users/arnavgarg1/following{/other_user}","gists_url":"https://api.github.com/users/arnavgarg1/gists{/gist_id}","starred_url":"https://api.github.com/users/arnavgarg1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arnavgarg1/subscriptions","organizations_url":"https://api.github.com/users/arnavgarg1/orgs","repos_url":"https://api.github.com/users/arnavgarg1/repos","events_url":"https://api.github.com/users/arnavgarg1/events{/privacy}","received_events_url":"https://api.github.com/users/arnavgarg1/received_events","type":"User","site_admin":false},"labels":[{"id":1174068769,"node_id":"MDU6TGFiZWwxMTc0MDY4NzY5","url":"https://api.github.com/repos/ludwig-ai/ludwig/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":{"login":"arnavgarg1","id":106701836,"node_id":"U_kgDOBlwkDA","avatar_url":"https://avatars.githubusercontent.com/u/106701836?v=4","gravatar_id":"","url":"https://api.github.com/users/arnavgarg1","html_url":"https://github.com/arnavgarg1","followers_url":"https://api.github.com/users/arnavgarg1/followers","following_url":"https://api.github.com/users/arnavgarg1/following{/other_user}","gists_url":"https://api.github.com/users/arnavgarg1/gists{/gist_id}","starred_url":"https://api.github.com/users/arnavgarg1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arnavgarg1/subscriptions","organizations_url":"https://api.github.com/users/arnavgarg1/orgs","repos_url":"https://api.github.com/users/arnavgarg1/repos","events_url":"https://api.github.com/users/arnavgarg1/events{/privacy}","received_events_url":"https://api.github.com/users/arnavgarg1/received_events","type":"User","site_admin":false},"assignees":[{"login":"arnavgarg1","id":106701836,"node_id":"U_kgDOBlwkDA","avatar_url":"https://avatars.githubusercontent.com/u/106701836?v=4","gravatar_id":"","url":"https://api.github.com/users/arnavgarg1","html_url":"https://github.com/arnavgarg1","followers_url":"https://api.github.com/users/arnavgarg1/followers","following_url":"https://api.github.com/users/arnavgarg1/following{/other_user}","gists_url":"https://api.github.com/users/arnavgarg1/gists{/gist_id}","starred_url":"https://api.github.com/users/arnavgarg1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arnavgarg1/subscriptions","organizations_url":"https://api.github.com/users/arnavgarg1/orgs","repos_url":"https://api.github.com/users/arnavgarg1/repos","events_url":"https://api.github.com/users/arnavgarg1/events{/privacy}","received_events_url":"https://api.github.com/users/arnavgarg1/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2022-07-25T16:45:46Z","updated_at":"2022-08-04T17:07:04Z","closed_at":"2022-08-04T17:07:04Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"On occassion, I see the following error in `model.evaluate()` while computing overall stats using a sample of the dataframe. I haven't been able to reproduce this error consistently, but it does surface from time to time. \r\n\r\nThis was seen while training a small image dataset with only 1 image input feature and a categorical output feature.\r\n\r\n```\r\nFull computation of stats only supported for pandas dataframes. Sampling the first 10000 rows of the feature and target dataframes for computing overall stats.\r\nTraceback (most recent call last):\r\n  File \"/home/ray/train_ispy2.py\", line 145, in <module>\r\n    app()\r\n  File \"/home/ray/train_ispy2.py\", line 126, in app\r\n    eval_stats, train_stats, _, _ = model.experiment(\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/ludwig/api.py\", line 1147, in experiment\r\n    eval_stats, _, _ = self.evaluate(\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/ludwig/api.py\", line 912, in evaluate\r\n    overall_stats = calculate_overall_stats(\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/ludwig/models/predictor.py\", line 309, in calculate_overall_stats\r\n    feature_df = feature_df.head(n=STATS_SAMPLE_SIZE, npartitions=-1, compute=True)\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/dataframe/core.py\", line 1219, in head\r\n    return self._head(n=n, npartitions=npartitions, compute=compute, safe=safe)\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/dataframe/core.py\", line 1253, in _head\r\n    result = result.compute()\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/base.py\", line 312, in compute\r\n    (result,) = compute(self, traverse=False, **kwargs)\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/base.py\", line 600, in compute\r\n    results = schedule(dsk, keys, **kwargs)\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/ray/util/dask/scheduler.py\", line 202, in ray_dask_get\r\n    result = ray_get_unpack(object_refs, progress_bar_actor=pb_actor)\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/ray/util/dask/scheduler.py\", line 503, in ray_get_unpack\r\n    computed_result = get_result(object_refs)\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/ray/util/dask/scheduler.py\", line 490, in get_result\r\n    return ray.get(object_refs)\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/ray/_private/client_mode_hook.py\", line 105, in wrapper\r\n    return func(*args, **kwargs)\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/ray/worker.py\", line 1809, in get\r\n    raise value.as_instanceof_cause()\r\nray.exceptions.RayTaskError(ValueError): ray::dask:('head-200-10000-rename-814aae6336586f7ac43cb63c641e157b', 0) (pid=22528, ip=192.168.13.44)\r\n  At least one of the input arguments for this task could not be computed:\r\nray.exceptions.RayTaskError: ray::dask:('head-partial-10000-rename-814aae6336586f7ac43cb63c641e157b', 156) (pid=22280, ip=192.168.13.44)\r\n  At least one of the input arguments for this task could not be computed:\r\nray.exceptions.RayTaskError: ray::dask:('block_to_df-rename-814aae6336586f7ac43cb63c641e157b', 156) (pid=22276, ip=192.168.13.44)\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/ray/util/dask/scheduler.py\", line 431, in dask_task_wrapper\r\n    result = func(*actual_args)\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/optimization.py\", line 990, in __call__\r\n    return core.get(self.dsk, self.outkey, dict(zip(self.inkeys, args)))\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/core.py\", line 149, in get\r\n    result = _execute_task(task, cache)\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/core.py\", line 119, in _execute_task\r\n    return func(*(_execute_task(a, cache) for a in args))\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/core.py\", line 119, in <genexpr>\r\n    return func(*(_execute_task(a, cache) for a in args))\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/core.py\", line 113, in _execute_task\r\n    return [_execute_task(a, cache) for a in arg]\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/core.py\", line 113, in <listcomp>\r\n    return [_execute_task(a, cache) for a in arg]\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/core.py\", line 119, in _execute_task\r\n    return func(*(_execute_task(a, cache) for a in args))\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/core.py\", line 119, in <genexpr>\r\n    return func(*(_execute_task(a, cache) for a in args))\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/core.py\", line 113, in _execute_task\r\n    return [_execute_task(a, cache) for a in arg]\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/core.py\", line 113, in <listcomp>\r\n    return [_execute_task(a, cache) for a in arg]\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/core.py\", line 119, in _execute_task\r\n    return func(*(_execute_task(a, cache) for a in args))\r\n  File \"/home/ray/anaconda3/lib/python3.8/site-packages/dask/dataframe/utils.py\", line 400, in check_meta\r\n    raise ValueError(\r\nValueError: Metadata mismatch found in `from_delayed`.\r\n```","closed_by":{"login":"geoffreyangus","id":29719151,"node_id":"MDQ6VXNlcjI5NzE5MTUx","avatar_url":"https://avatars.githubusercontent.com/u/29719151?v=4","gravatar_id":"","url":"https://api.github.com/users/geoffreyangus","html_url":"https://github.com/geoffreyangus","followers_url":"https://api.github.com/users/geoffreyangus/followers","following_url":"https://api.github.com/users/geoffreyangus/following{/other_user}","gists_url":"https://api.github.com/users/geoffreyangus/gists{/gist_id}","starred_url":"https://api.github.com/users/geoffreyangus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geoffreyangus/subscriptions","organizations_url":"https://api.github.com/users/geoffreyangus/orgs","repos_url":"https://api.github.com/users/geoffreyangus/repos","events_url":"https://api.github.com/users/geoffreyangus/events{/privacy}","received_events_url":"https://api.github.com/users/geoffreyangus/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2308/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2308/timeline","performed_via_github_app":null,"state_reason":"completed"}