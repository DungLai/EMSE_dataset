{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1991","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1991/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1991/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1991/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/1991","id":1221677689,"node_id":"I_kwDOCbx2hs5I0VJ5","number":1991,"title":"Evaluation failing because `target` is not integer Tensor.","user":{"login":"geoffreyangus","id":29719151,"node_id":"MDQ6VXNlcjI5NzE5MTUx","avatar_url":"https://avatars.githubusercontent.com/u/29719151?v=4","gravatar_id":"","url":"https://api.github.com/users/geoffreyangus","html_url":"https://github.com/geoffreyangus","followers_url":"https://api.github.com/users/geoffreyangus/followers","following_url":"https://api.github.com/users/geoffreyangus/following{/other_user}","gists_url":"https://api.github.com/users/geoffreyangus/gists{/gist_id}","starred_url":"https://api.github.com/users/geoffreyangus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geoffreyangus/subscriptions","organizations_url":"https://api.github.com/users/geoffreyangus/orgs","repos_url":"https://api.github.com/users/geoffreyangus/repos","events_url":"https://api.github.com/users/geoffreyangus/events{/privacy}","received_events_url":"https://api.github.com/users/geoffreyangus/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2022-04-30T00:51:00Z","updated_at":"2022-07-13T16:25:37Z","closed_at":"2022-06-06T16:50:45Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"When evaluating with Ray, the user may get the following error:\r\n\r\n```\r\n File \"/home/ray/anaconda3/lib/python3.7/site-packages/torchmetrics/classification/accuracy.py\", line 222, in update\r\n    mode = _mode(preds, target, self.threshold, self.top_k, self.num_classes, self.multiclass, self.ignore_index)\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/torchmetrics/functional/classification/accuracy.py\", line 66, in _mode\r\n    ignore_index=ignore_index,\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/torchmetrics/utilities/checks.py\", line 265, in _check_classification_inputs\r\n    _basic_input_validation(preds, target, threshold, multiclass, ignore_index)\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/torchmetrics/utilities/checks.py\", line 44, in _basic_input_validation\r\n    raise ValueError(\"The `target` has to be an integer tensor.\")\r\nValueError: The `target` has to be an integer tensor.\r\n```\r\n\r\nThis error can be reproduced by running the following:\r\n\r\n```\r\nfrom ludwig.api import LudwigModel\r\nfrom ludwig.backend import RAY\r\n\r\nmodel = LudwigModel(config, backend=\"ray\")\r\nmodel.train(\r\n    dataset=data_csv,\r\n    skip_save_training_description=True,\r\n    skip_save_training_statistics=True,\r\n    skip_save_model=True,\r\n    skip_save_progress=True,\r\n    skip_save_log=True,\r\n    skip_save_processed_input=True,\r\n    output_directory=output_dir,\r\n)\r\nmodel.evaluate(\r\n    dataset=data_csv,\r\n    skip_save_unprocessed_output=True,\r\n    skip_save_predictions=True,\r\n    skip_save_eval_stats=True,\r\n    collect_predictions=False,\r\n    collect_overall_stats=False,\r\n    output_directory=output_dir,\r\n)\r\n```\r\n\r\nAlternatively, simply run a test which calls `model.evaluate` such as `tests/integration_tests/test_api.py::test_api_skip_parameters_evaluate` where all skip params are True, and set the `LudwigModel` created in `run_api_commands` to have `backend=\"ray\"`.","closed_by":{"login":"geoffreyangus","id":29719151,"node_id":"MDQ6VXNlcjI5NzE5MTUx","avatar_url":"https://avatars.githubusercontent.com/u/29719151?v=4","gravatar_id":"","url":"https://api.github.com/users/geoffreyangus","html_url":"https://github.com/geoffreyangus","followers_url":"https://api.github.com/users/geoffreyangus/followers","following_url":"https://api.github.com/users/geoffreyangus/following{/other_user}","gists_url":"https://api.github.com/users/geoffreyangus/gists{/gist_id}","starred_url":"https://api.github.com/users/geoffreyangus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geoffreyangus/subscriptions","organizations_url":"https://api.github.com/users/geoffreyangus/orgs","repos_url":"https://api.github.com/users/geoffreyangus/repos","events_url":"https://api.github.com/users/geoffreyangus/events{/privacy}","received_events_url":"https://api.github.com/users/geoffreyangus/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1991/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1991/timeline","performed_via_github_app":null,"state_reason":"completed"}