{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/379","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/379/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/379/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/379/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/379","id":457600664,"node_id":"MDU6SXNzdWU0NTc2MDA2NjQ=","number":379,"title":"Potential Bug with Dataframe.shift when used with Dataframe.loc","user":{"login":"nchrisr","id":24297785,"node_id":"MDQ6VXNlcjI0Mjk3Nzg1","avatar_url":"https://avatars.githubusercontent.com/u/24297785?v=4","gravatar_id":"","url":"https://api.github.com/users/nchrisr","html_url":"https://github.com/nchrisr","followers_url":"https://api.github.com/users/nchrisr/followers","following_url":"https://api.github.com/users/nchrisr/following{/other_user}","gists_url":"https://api.github.com/users/nchrisr/gists{/gist_id}","starred_url":"https://api.github.com/users/nchrisr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nchrisr/subscriptions","organizations_url":"https://api.github.com/users/nchrisr/orgs","repos_url":"https://api.github.com/users/nchrisr/repos","events_url":"https://api.github.com/users/nchrisr/events{/privacy}","received_events_url":"https://api.github.com/users/nchrisr/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2019-06-18T17:14:27Z","updated_at":"2019-06-18T17:33:09Z","closed_at":"2019-06-18T17:33:09Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the bug**\r\nI am trying to use the ```Dataframe. shift()```  function to move certain rows of data into their correct columns, and the ```Dataframe.shift()``` function is doing some weird things, it is creating an empty column of ```nan(s)``` and moves one of the columns to the end of the ```dataframe```.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. make a variable using the data set string below: \r\n```\r\n\"2010-01-12 18:00:00\",\"$GPGGA\",\"180439\",\"7249.2150\",\"N\",\"11754.4238\",\"W\",\"2\",\"10\",\"0.9\",\"-8.1\",\"M\",\"-12.4\",\"M\",\"\",\"*57\",\"\",\"\",\"\"\r\n\"2010-01-12 17:30:00\",\"$GPGGA\",\"173439\",\"7249.2160\",\"N\",\"11754.4233\",\"W\",\"2\",\"11\",\"0.8\",\"-4.5\",\"M\",\"-12.4\",\"M\",\"\",\"*5B\",\"\",\"\",\"\"\r\n\"2010-01-12 17:00:00\",\"$GPGGA\",\"170439\",\"7249.2152\",\"N\",\"11754.4235\",\"W\",\"2\",\"11\",\"0.8\",\"-3.1\",\"M\",\"-12.4\",\"M\",\"\",\"*5C\",\"\",\"\",\"\"\r\n\"2010-01-12 16:30:00\",\"N\",\"11754.4210\",\"W\",\"2\",\"09\",\"1.1\",\"-13.1\",\"M\",\"-12.4\",\"M\",\"\",\"*6C\",\"\",\"\",\"\",\"\",\"\",\"\"\r\n\"2010-01-12 16:00:00\",\"N\",\"11754.4229\",\"W\",\"2\",\"10\",\"0.9\",\"-2.9\",\"M\",\"-12.4\",\"M\",\"\",\"*53\",\"\",\"\",\"\",\"\",\"\",\"\"\r\n\"2010-01-12 15:30:00\",\"N\",\"11754.4269\",\"W\",\"2\",\"09\",\"0.8\",\"-4.3\",\"M\",\"-12.4\",\"M\",\"\",\"*54\",\"\",\"\",\"\",\"\",\"\",\"\"\r\n\"2010-01-12 15:00:00\",\"N\",\"11754.4267\",\"W\",\"2\",\"10\",\"0.8\",\"-1.6\",\"M\",\"-12.4\",\"M\",\"\",\"*56\",\"\",\"\",\"\",\"\",\"\",\"\"\r\n\"2010-01-12 14:30:00\",\"$GPGGA\",\"143439\",\"7249.2152\",\"N\",\"11754.4253\",\"W\",\"2\",\"11\",\"0.7\",\"-4.3\",\"M\",\"-12.4\",\"M\",\"\",\"*56\",\"\",\"\",\"\"\r\n\"2010-01-12 14:00:00\",\"N\",\"11754.4245\",\"W\",\"2\",\"10\",\"0.9\",\"-7.0\",\"M\",\"-12.4\",\"M\",\"\",\"*50\",\"\",\"\",\"\",\"\",\"\",\"\"\r\n\"2010-01-12 13:30:00\",\"$GPGGA\",\"133439\",\"7249.2134\",\"N\",\"11754.4243\",\"W\",\"2\",\"11\",\"0.7\",\"-10.7\",\"M\",\"-12.4\",\"M\",\"\",\"*61\",\"\",\"\",\"\"\r\n\"2010-01-12 13:00:00\",\"N\",\"11754.4245\",\"W\",\"2\",\"10\",\"0.8\",\"-5.5\",\"M\",\"-12.4\",\"M\",\"\",\"*56\",\"\",\"\",\"\",\"\",\"\",\"\"\r\n\"2010-01-12 12:30:00\",\"N\",\"11754.4226\",\"W\",\"2\",\"10\",\"0.9\",\"-7.1\",\"M\",\"-12.4\",\"M\",\"\",\"*59\",\"\",\"\",\"\",\"\",\"\",\"\"\r\n\"2010-01-12 12:00:00\",\"N\",\"11754.4238\",\"W\",\"2\",\"10\",\"0.8\",\"-6.5\",\"M\",\"-12.4\",\"M\",\"\",\"*51\",\"\",\"\",\"\",\"\",\"\",\"\"\r\n\"2010-01-12 11:30:00\",\"N\",\"11754.4227\",\"W\",\"2\",\"10\",\"0.8\",\"0.1\",\"M\",\"-12.4\",\"M\",\"\",\"*73\",\"\",\"\",\"\",\"\",\"\",\"\"\r\n\"2010-01-12 11:00:00\",\"-7.4\",\"M\",\"-12.4\",\"M\",\"\",\"*5F\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"\r\n\"2010-01-12 10:30:00\",\"N\",\"11754.4271\",\"W\",\"2\",\"08\",\"1.1\",\"-8.4\",\"M\",\"-12.4\",\"M\",\"\",\"*5A\",\"\",\"\",\"\",\"\",\"\",\"\"\r\n```\r\n\r\n2. Read this data into a string and process it using the code below:\r\n\r\n```\r\nimport pandas as pd\r\nimport StringIO\r\n\r\ngps_string = # insert above string here\r\ngps_df = pd.read_csv(StringIO.StringIO(gps_string), header=None, index_col=0)\r\ngps_df.to_csv(\"xxt.csv\") # creating a file for debugging purposes\r\nrows_to_shift = gps_df[gps_df[15].isnull()].index\r\nx = len(rows_to_shift)\r\ncount = 0\r\nwhile x > 0:\r\n    # This section was added only for debugging purposes\r\n    prev = gps_df.loc[rows_to_shift]\r\n    prev.to_csv(str(count) + \"prev.csv\") # create this file for debugging puposes\r\n    nxt = prev.shift(periods=1, axis=1)\r\n    nxt.to_csv(str(count)+\"nxt.csv\")\r\n    # Debugging code ends here\r\n\r\n     gps_df.loc[rows_to_shift] = gps_df.loc[rows_to_shift].shift(periods=1, axis=1)\r\n     gps_df.to_csv(str(count)+\"f.csv\") # create this file for debugging purposes\r\n     rows_to_shift = gps_df[gps_df[15].isnull()].index\r\n      x = len(rows_to_shift)\r\n      count += 1\r\n```\r\n\r\n**Expected behavior**\r\nI expected that this code would shift the data rows such that all the cells which have '*' in them will be in the same column, and also move the columns to the left of them as well. As an example, a data row that looks like this:\r\n\r\n```\"2010-01-12 11:00:00\",\"-7.4\",\"M\",\"-12.4\",\"M\",\"\",\"*5F\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\" ```\r\n\r\nwould be changed to this:\r\n\r\n``` \"2010-01-12 11:00:00\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"-7.4\",\"M\",\"-12.4\",\"M\",\"\",\"*5F\",\"\",\"\",\"\" ```\r\n\r\nHowever, after one iteration of the loop (I had noticed unexpected results when the loop was allowed to execute completely so I saved a file in between to see what was going wrong), I save the file and noticed some unexpected behavior . \r\n\r\n**Screenshots**\r\n\r\nOriginal data:\r\n<img width=\"1272\" alt=\"Screen Shot 2019-06-17 at 2 34 03 PM\" src=\"https://user-images.githubusercontent.com/24297785/59704339-80f89080-91c1-11e9-8ff9-9406b8b6e192.png\">\r\n\r\nOutput after one iteration of the loop:\r\n\r\n<img width=\"1244\" alt=\"Screen Shot 2019-06-17 at 2 50 13 PM\" src=\"https://user-images.githubusercontent.com/24297785/59704362-8ce45280-91c1-11e9-977c-ed9a4c9727da.png\">\r\n\r\nAs seen above, the data that was originally in column 10 (column 9 with zero index) has been move to column 15 (column 14 with zero indes) for some reason. Also a column with ```null``` values has been created in column 6 (column 5 with zero index)\r\n\r\n**Environment :**\r\n- OS: Windows 10 (also tested on Mac OS Mojave as well)\r\n- Pandas version 0.24.2 (also encountered the same error with 0.22.0)\r\n- Python2.7 \r\n","closed_by":{"login":"nchrisr","id":24297785,"node_id":"MDQ6VXNlcjI0Mjk3Nzg1","avatar_url":"https://avatars.githubusercontent.com/u/24297785?v=4","gravatar_id":"","url":"https://api.github.com/users/nchrisr","html_url":"https://github.com/nchrisr","followers_url":"https://api.github.com/users/nchrisr/followers","following_url":"https://api.github.com/users/nchrisr/following{/other_user}","gists_url":"https://api.github.com/users/nchrisr/gists{/gist_id}","starred_url":"https://api.github.com/users/nchrisr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nchrisr/subscriptions","organizations_url":"https://api.github.com/users/nchrisr/orgs","repos_url":"https://api.github.com/users/nchrisr/repos","events_url":"https://api.github.com/users/nchrisr/events{/privacy}","received_events_url":"https://api.github.com/users/nchrisr/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/379/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/379/timeline","performed_via_github_app":null,"state_reason":"completed"}