{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1484","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1484/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1484/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1484/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/1484","id":1052763255,"node_id":"I_kwDOCbx2hs4-v-R3","number":1484,"title":"Higgs Tabnet example terminates with out-of-memory error","user":{"login":"jimthompson5802","id":1425269,"node_id":"MDQ6VXNlcjE0MjUyNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1425269?v=4","gravatar_id":"","url":"https://api.github.com/users/jimthompson5802","html_url":"https://github.com/jimthompson5802","followers_url":"https://api.github.com/users/jimthompson5802/followers","following_url":"https://api.github.com/users/jimthompson5802/following{/other_user}","gists_url":"https://api.github.com/users/jimthompson5802/gists{/gist_id}","starred_url":"https://api.github.com/users/jimthompson5802/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimthompson5802/subscriptions","organizations_url":"https://api.github.com/users/jimthompson5802/orgs","repos_url":"https://api.github.com/users/jimthompson5802/repos","events_url":"https://api.github.com/users/jimthompson5802/events{/privacy}","received_events_url":"https://api.github.com/users/jimthompson5802/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"jimthompson5802","id":1425269,"node_id":"MDQ6VXNlcjE0MjUyNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1425269?v=4","gravatar_id":"","url":"https://api.github.com/users/jimthompson5802","html_url":"https://github.com/jimthompson5802","followers_url":"https://api.github.com/users/jimthompson5802/followers","following_url":"https://api.github.com/users/jimthompson5802/following{/other_user}","gists_url":"https://api.github.com/users/jimthompson5802/gists{/gist_id}","starred_url":"https://api.github.com/users/jimthompson5802/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimthompson5802/subscriptions","organizations_url":"https://api.github.com/users/jimthompson5802/orgs","repos_url":"https://api.github.com/users/jimthompson5802/repos","events_url":"https://api.github.com/users/jimthompson5802/events{/privacy}","received_events_url":"https://api.github.com/users/jimthompson5802/received_events","type":"User","site_admin":false},"assignees":[{"login":"jimthompson5802","id":1425269,"node_id":"MDQ6VXNlcjE0MjUyNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1425269?v=4","gravatar_id":"","url":"https://api.github.com/users/jimthompson5802","html_url":"https://github.com/jimthompson5802","followers_url":"https://api.github.com/users/jimthompson5802/followers","following_url":"https://api.github.com/users/jimthompson5802/following{/other_user}","gists_url":"https://api.github.com/users/jimthompson5802/gists{/gist_id}","starred_url":"https://api.github.com/users/jimthompson5802/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimthompson5802/subscriptions","organizations_url":"https://api.github.com/users/jimthompson5802/orgs","repos_url":"https://api.github.com/users/jimthompson5802/repos","events_url":"https://api.github.com/users/jimthompson5802/events{/privacy}","received_events_url":"https://api.github.com/users/jimthompson5802/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2021-11-13T20:18:59Z","updated_at":"2021-11-14T01:38:11Z","closed_at":"2021-11-14T01:38:11Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"**Describe the bug**\r\n`examples/tabnet/higgs/train_higgs_small.py` terminates with exit code 137 (out-of-memory).  During training this Warning message appears:\r\n```\r\n/usr/local/lib/python3.8/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.\r\n  warnings.warn(*args, **kwargs)\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nExecute `python examples/tabnet/higgs/train_higgs_small.py`.\r\nNote: to reduce run-time to reproduce error, I specified a local `cache_dir` to download data only once and use only a 5% sample of the downloaded data.\r\n\r\n\r\n**Additional context**\r\nExcerpt from training log with logging level set to DEBUG\r\n```\r\n/usr/local/lib/python3.8/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.\r\n  warnings.warn(*args, **kwargs)\r\n\r\n╒══════════╕\r\n│ TRAINING │\r\n╘══════════╛\r\n\r\n\r\nEpoch    1\r\nTraining:   3%|▎         | 1/33 [00:00<00:19,  1.64it/s]training: completed batch 1 memory used: 1310.01MB\r\nTraining:   6%|▌         | 2/33 [00:01<00:18,  1.72it/s]training: completed batch 2 memory used: 1572.86MB\r\nTraining:   9%|▉         | 3/33 [00:01<00:16,  1.80it/s]training: completed batch 3 memory used: 1574.69MB\r\nTraining:  12%|█▏        | 4/33 [00:02<00:16,  1.81it/s]training: completed batch 4 memory used: 1574.64MB\r\n\r\n<<<<<< deleted similar log messages >>>>\r\n\r\nTraining:  85%|████████▍ | 28/33 [00:16<00:03,  1.55it/s]training: completed batch 28 memory used: 1506.58MB\r\nTraining:  88%|████████▊ | 29/33 [00:16<00:02,  1.61it/s]training: completed batch 29 memory used: 1506.53MB\r\nTraining:  91%|█████████ | 30/33 [00:17<00:01,  1.69it/s]training: completed batch 30 memory used: 1506.50MB\r\nTraining:  94%|█████████▍| 31/33 [00:17<00:01,  1.73it/s]training: completed batch 31 memory used: 1506.44MB\r\nTraining:  97%|█████████▋| 32/33 [00:18<00:00,  1.77it/s]training: completed batch 32 memory used: 1506.39MB\r\ntraining: completed batch 33 memory used: 1417.73MB\r\nTraining: 100%|██████████| 33/33 [00:18<00:00,  1.80it/s]\r\nEvaluation train:   0%|          | 0/2 [00:00<?, ?it/s]evaluation for train: obtained next batch memory used: 1434.19MB\r\n\r\nProcess finished with exit code 137 (interrupted by signal 9: SIGKILL)\r\n```\r\n\r\nWhile running the above, here is `top` output from just before error termination.   During processing of the first batch in \"Evaluation train:\", the memory used by the `python` program grew from around 5% to over 95% before terminating with 137 exit code.\r\n```\r\ntop - 20:02:58 up  8:46,  0 users,  load average: 9.75, 5.25, 3.85\r\nTasks:   3 total,   2 running,   1 sleeping,   0 stopped,   0 zombie\r\n%Cpu(s): 45.6 us, 26.4 sy,  0.0 ni, 25.0 id,  2.8 wa,  0.0 hi,  0.1 si,  0.0 st\r\nGiB Mem :     12.7 total,      0.1 free,     12.4 used,      0.2 buff/cache\r\nGiB Swap:      1.0 total,      0.4 free,      0.6 used.      0.0 avail Mem \r\n\r\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                                             \r\n    1 root      20   0   24.3g  12.1g  16.9m R 928.7  95.5  13:19.44 python                                              \r\n   61 root      20   0    9.6m   2.0m   1.6m R   0.7   0.0   0:00.65 top                                                  \r\n   54 root      20   0    5.6m   1.8m   1.4m S   0.0   0.0   0:00.06 bash  \r\n```  \r\n","closed_by":{"login":"jimthompson5802","id":1425269,"node_id":"MDQ6VXNlcjE0MjUyNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1425269?v=4","gravatar_id":"","url":"https://api.github.com/users/jimthompson5802","html_url":"https://github.com/jimthompson5802","followers_url":"https://api.github.com/users/jimthompson5802/followers","following_url":"https://api.github.com/users/jimthompson5802/following{/other_user}","gists_url":"https://api.github.com/users/jimthompson5802/gists{/gist_id}","starred_url":"https://api.github.com/users/jimthompson5802/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimthompson5802/subscriptions","organizations_url":"https://api.github.com/users/jimthompson5802/orgs","repos_url":"https://api.github.com/users/jimthompson5802/repos","events_url":"https://api.github.com/users/jimthompson5802/events{/privacy}","received_events_url":"https://api.github.com/users/jimthompson5802/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1484/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1484/timeline","performed_via_github_app":null,"state_reason":"completed"}