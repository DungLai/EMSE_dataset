{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1040","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1040/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1040/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1040/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/1040","id":756848756,"node_id":"MDU6SXNzdWU3NTY4NDg3NTY=","number":1040,"title":"Hyperopt: Category feature preprocessing in hyperopt raising Attribute Error","user":{"login":"michaelbzhu","id":17104161,"node_id":"MDQ6VXNlcjE3MTA0MTYx","avatar_url":"https://avatars.githubusercontent.com/u/17104161?v=4","gravatar_id":"","url":"https://api.github.com/users/michaelbzhu","html_url":"https://github.com/michaelbzhu","followers_url":"https://api.github.com/users/michaelbzhu/followers","following_url":"https://api.github.com/users/michaelbzhu/following{/other_user}","gists_url":"https://api.github.com/users/michaelbzhu/gists{/gist_id}","starred_url":"https://api.github.com/users/michaelbzhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/michaelbzhu/subscriptions","organizations_url":"https://api.github.com/users/michaelbzhu/orgs","repos_url":"https://api.github.com/users/michaelbzhu/repos","events_url":"https://api.github.com/users/michaelbzhu/events{/privacy}","received_events_url":"https://api.github.com/users/michaelbzhu/received_events","type":"User","site_admin":false},"labels":[{"id":1174068769,"node_id":"MDU6TGFiZWwxMTc0MDY4NzY5","url":"https://api.github.com/repos/ludwig-ai/ludwig/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":{"login":"tgaddair","id":1742912,"node_id":"MDQ6VXNlcjE3NDI5MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1742912?v=4","gravatar_id":"","url":"https://api.github.com/users/tgaddair","html_url":"https://github.com/tgaddair","followers_url":"https://api.github.com/users/tgaddair/followers","following_url":"https://api.github.com/users/tgaddair/following{/other_user}","gists_url":"https://api.github.com/users/tgaddair/gists{/gist_id}","starred_url":"https://api.github.com/users/tgaddair/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tgaddair/subscriptions","organizations_url":"https://api.github.com/users/tgaddair/orgs","repos_url":"https://api.github.com/users/tgaddair/repos","events_url":"https://api.github.com/users/tgaddair/events{/privacy}","received_events_url":"https://api.github.com/users/tgaddair/received_events","type":"User","site_admin":false},"assignees":[{"login":"tgaddair","id":1742912,"node_id":"MDQ6VXNlcjE3NDI5MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1742912?v=4","gravatar_id":"","url":"https://api.github.com/users/tgaddair","html_url":"https://github.com/tgaddair","followers_url":"https://api.github.com/users/tgaddair/followers","following_url":"https://api.github.com/users/tgaddair/following{/other_user}","gists_url":"https://api.github.com/users/tgaddair/gists{/gist_id}","starred_url":"https://api.github.com/users/tgaddair/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tgaddair/subscriptions","organizations_url":"https://api.github.com/users/tgaddair/orgs","repos_url":"https://api.github.com/users/tgaddair/repos","events_url":"https://api.github.com/users/tgaddair/events{/privacy}","received_events_url":"https://api.github.com/users/tgaddair/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2020-12-04T06:39:51Z","updated_at":"2020-12-06T19:53:23Z","closed_at":"2020-12-06T19:52:51Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"So I'm running `hyperopt()` with the following arguments\r\n```\r\nhyperopt(\r\n    config=config,\r\n    training_set=train_data,\r\n    validation_set=validation_data,\r\n    test_set=test_data,\r\n    skip_save_progress=True,\r\n    skip_save_model=True,\r\n    skip_save_processed_input=True\r\n)\r\n```\r\n\r\nand I'm getting a `AttributeError: 'int' object has no attribute 'strip'` during the data preprocessing step\r\n```\r\n---------------------------------------------------------------------------\r\nAttributeError                            Traceback (most recent call last)\r\n<ipython-input-13-c2e6c8f1ae7c> in <module>()\r\n     10     skip_save_progress=True,\r\n     11     skip_save_model=False,\r\n---> 12     skip_save_processed_input=True\r\n     13 )\r\n/usr/local/lib/python3.6/dist-packages/ludwig/hyperopt/run.py in hyperopt(config, dataset, training_set, validation_set, test_set, training_set_metadata, data_format, experiment_name, model_name, skip_save_training_description, skip_save_training_statistics, skip_save_model, skip_save_progress, skip_save_log, skip_save_processed_input, skip_save_unprocessed_output, skip_save_predictions, skip_save_eval_stats, skip_save_hyperopt_statistics, output_directory, gpus, gpu_memory_limit, allow_parallel_threads, use_horovod, random_seed, debug, **kwargs)\r\n    289         random_seed=random_seed,\r\n    290         debug=debug,\r\n--> 291         **kwargs\r\n    292     )\r\n    293 \r\n/usr/local/lib/python3.6/dist-packages/ludwig/hyperopt/execution.py in execute(self, config, dataset, training_set, validation_set, test_set, training_set_metadata, data_format, experiment_name, model_name, skip_save_training_description, skip_save_training_statistics, skip_save_model, skip_save_progress, skip_save_log, skip_save_processed_input, skip_save_unprocessed_output, skip_save_predictions, skip_save_eval_stats, output_directory, gpus, gpu_memory_limit, allow_parallel_threads, use_horovod, random_seed, debug, **kwargs)\r\n    149                     skip_collect_overall_stats=False,\r\n    150                     random_seed=random_seed,\r\n--> 151                     debug=debug,\r\n    152                 )\r\n    153                 metric_score = self.get_metric_score(eval_stats)\r\n/usr/local/lib/python3.6/dist-packages/ludwig/api.py in experiment(self, dataset, training_set, validation_set, test_set, training_set_metadata, data_format, experiment_name, model_name, model_load_path, model_resume_path, eval_split, skip_save_training_description, skip_save_training_statistics, skip_save_model, skip_save_progress, skip_save_log, skip_save_processed_input, skip_save_unprocessed_output, skip_save_predictions, skip_save_eval_stats, skip_collect_predictions, skip_collect_overall_stats, output_directory, random_seed, debug, **kwargs)\r\n   1054             output_directory=output_directory,\r\n   1055             random_seed=random_seed,\r\n-> 1056             debug=debug,\r\n   1057         )\r\n   1058 \r\n/usr/local/lib/python3.6/dist-packages/ludwig/api.py in train(self, dataset, training_set, validation_set, test_set, training_set_metadata, data_format, experiment_name, model_name, model_resume_path, skip_save_training_description, skip_save_training_statistics, skip_save_model, skip_save_progress, skip_save_log, skip_save_processed_input, output_directory, random_seed, debug, **kwargs)\r\n    415                     random_seed=random_seed,\r\n    416                     devbug=debug,\r\n--> 417                     **kwargs,\r\n    418                 )\r\n    419                 (training_set,\r\n/usr/local/lib/python3.6/dist-packages/ludwig/api.py in preprocess(self, dataset, training_set, validation_set, test_set, training_set_metadata, data_format, skip_save_processed_input, random_seed, debug, **kwargs)\r\n   1261             preprocessing_params=self.config[PREPROCESSING],\r\n   1262             backend=self.backend,\r\n-> 1263             random_seed=random_seed\r\n   1264         )\r\n   1265 \r\n/usr/local/lib/python3.6/dist-packages/ludwig/data/preprocessing.py in preprocess_for_training(config, dataset, training_set, validation_set, test_set, training_set_metadata, data_format, skip_save_processed_input, preprocessing_params, backend, random_seed)\r\n   1395         preprocessing_params=preprocessing_params,\r\n   1396         backend=backend,\r\n-> 1397         random_seed=random_seed\r\n   1398     )\r\n   1399     training_set, test_set, validation_set, training_set_metadata = processed\r\n/usr/local/lib/python3.6/dist-packages/ludwig/data/preprocessing.py in preprocess_for_training(features, dataset, training_set, validation_set, test_set, training_set_metadata, skip_save_processed_input, preprocessing_params, backend, random_seed)\r\n    183             preprocessing_params=preprocessing_params,\r\n    184             backend=backend,\r\n--> 185             random_seed=random_seed\r\n    186         )\r\n    187 \r\n/usr/local/lib/python3.6/dist-packages/ludwig/data/preprocessing.py in _preprocess_df_for_training(features, dataset, training_set, validation_set, test_set, training_set_metadata, preprocessing_params, backend, random_seed)\r\n   1645         metadata=training_set_metadata,\r\n   1646         random_seed=random_seed,\r\n-> 1647         backend=backend\r\n   1648     )\r\n   1649 \r\n/usr/local/lib/python3.6/dist-packages/ludwig/data/preprocessing.py in build_dataset(dataset_df, features, global_preprocessing_parameters, metadata, backend, random_seed)\r\n   1013             features,\r\n   1014             global_preprocessing_parameters,\r\n-> 1015             backend\r\n   1016         )\r\n   1017 \r\n/usr/local/lib/python3.6/dist-packages/ludwig/data/preprocessing.py in build_metadata(dataset_df, features, global_preprocessing_parameters, backend)\r\n   1122                 column,\r\n   1123                 preprocessing_parameters,\r\n-> 1124                 backend\r\n   1125             )\r\n   1126 \r\n/usr/local/lib/python3.6/dist-packages/ludwig/features/category_feature.py in get_feature_meta(column, preprocessing_parameters, backend)\r\n     65             lowercase=preprocessing_parameters['lowercase'],\r\n     66             add_padding=False,\r\n---> 67             processor=backend.df_engine\r\n     68         )\r\n     69         return {\r\n/usr/local/lib/python3.6/dist-packages/ludwig/utils/strings_utils.py in create_vocabulary(data, tokenizer_type, add_unknown, add_padding, lowercase, num_most_frequent, vocab_file, unknown_symbol, padding_symbol, pretrained_model_name_or_path, processor)\r\n    139         vocab = load_vocabulary(vocab_file)\r\n    140 \r\n--> 141     processed_lines = data.map(lambda line: tokenizer(line.lower() if lowercase else line))\r\n    142     processed_counts = processed_lines.explode().value_counts(sort=False)\r\n    143     processed_counts = processor.compute(processed_counts)\r\n/usr/local/lib/python3.6/dist-packages/pandas/core/series.py in map(self, arg, na_action)\r\n   3980         dtype: object\r\n   3981         \"\"\"\r\n-> 3982         new_values = super()._map_values(arg, na_action=na_action)\r\n   3983         return self._constructor(new_values, index=self.index).__finalize__(\r\n   3984             self, method=\"map\"\r\n/usr/local/lib/python3.6/dist-packages/pandas/core/base.py in _map_values(self, mapper, na_action)\r\n   1158 \r\n   1159         # mapper is a function\r\n-> 1160         new_values = map_f(values, mapper)\r\n   1161 \r\n   1162         return new_values\r\npandas/_libs/lib.pyx in pandas._libs.lib.map_infer()\r\n/usr/local/lib/python3.6/dist-packages/ludwig/utils/strings_utils.py in <lambda>(line)\r\n    139         vocab = load_vocabulary(vocab_file)\r\n    140 \r\n--> 141     processed_lines = data.map(lambda line: tokenizer(line.lower() if lowercase else line))\r\n    142     processed_counts = processed_lines.explode().value_counts(sort=False)\r\n    143     processed_counts = processor.compute(processed_counts)\r\n/usr/local/lib/python3.6/dist-packages/ludwig/utils/strings_utils.py in __call__(self, text)\r\n    305 class StrippedStringToListTokenizer(BaseTokenizer):\r\n    306     def __call__(self, text):\r\n--> 307         return [text.strip()]\r\n    308 \r\n    309 \r\nAttributeError: 'int' object has no attribute 'strip'\r\n```\r\n\r\n**Environment :**\r\n - Run on Google Colab\r\n- Python version: 3.6\r\n- Ludwig version: Using ludwig from github repo up to commit fcb01e3b18c0b3304c4ff0b1f0b8b4ede518f762\r\n\r\nSeems like this is related to the recent commits (on Dec 3, 2020) as this bug hasn't happened before\r\n\r\n","closed_by":{"login":"w4nderlust","id":349256,"node_id":"MDQ6VXNlcjM0OTI1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/349256?v=4","gravatar_id":"","url":"https://api.github.com/users/w4nderlust","html_url":"https://github.com/w4nderlust","followers_url":"https://api.github.com/users/w4nderlust/followers","following_url":"https://api.github.com/users/w4nderlust/following{/other_user}","gists_url":"https://api.github.com/users/w4nderlust/gists{/gist_id}","starred_url":"https://api.github.com/users/w4nderlust/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/w4nderlust/subscriptions","organizations_url":"https://api.github.com/users/w4nderlust/orgs","repos_url":"https://api.github.com/users/w4nderlust/repos","events_url":"https://api.github.com/users/w4nderlust/events{/privacy}","received_events_url":"https://api.github.com/users/w4nderlust/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1040/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1040/timeline","performed_via_github_app":null,"state_reason":"completed"}