{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2288","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2288/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2288/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2288/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/2288","id":1306773238,"node_id":"I_kwDOCbx2hs5N48b2","number":2288,"title":"Generating hyperopt hiplot report raises TypeError unhashable type: dict exception","user":{"login":"jimthompson5802","id":1425269,"node_id":"MDQ6VXNlcjE0MjUyNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1425269?v=4","gravatar_id":"","url":"https://api.github.com/users/jimthompson5802","html_url":"https://github.com/jimthompson5802","followers_url":"https://api.github.com/users/jimthompson5802/followers","following_url":"https://api.github.com/users/jimthompson5802/following{/other_user}","gists_url":"https://api.github.com/users/jimthompson5802/gists{/gist_id}","starred_url":"https://api.github.com/users/jimthompson5802/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimthompson5802/subscriptions","organizations_url":"https://api.github.com/users/jimthompson5802/orgs","repos_url":"https://api.github.com/users/jimthompson5802/repos","events_url":"https://api.github.com/users/jimthompson5802/events{/privacy}","received_events_url":"https://api.github.com/users/jimthompson5802/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"hungcs","id":85463385,"node_id":"MDQ6VXNlcjg1NDYzMzg1","avatar_url":"https://avatars.githubusercontent.com/u/85463385?v=4","gravatar_id":"","url":"https://api.github.com/users/hungcs","html_url":"https://github.com/hungcs","followers_url":"https://api.github.com/users/hungcs/followers","following_url":"https://api.github.com/users/hungcs/following{/other_user}","gists_url":"https://api.github.com/users/hungcs/gists{/gist_id}","starred_url":"https://api.github.com/users/hungcs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hungcs/subscriptions","organizations_url":"https://api.github.com/users/hungcs/orgs","repos_url":"https://api.github.com/users/hungcs/repos","events_url":"https://api.github.com/users/hungcs/events{/privacy}","received_events_url":"https://api.github.com/users/hungcs/received_events","type":"User","site_admin":false},"assignees":[{"login":"hungcs","id":85463385,"node_id":"MDQ6VXNlcjg1NDYzMzg1","avatar_url":"https://avatars.githubusercontent.com/u/85463385?v=4","gravatar_id":"","url":"https://api.github.com/users/hungcs","html_url":"https://github.com/hungcs","followers_url":"https://api.github.com/users/hungcs/followers","following_url":"https://api.github.com/users/hungcs/following{/other_user}","gists_url":"https://api.github.com/users/hungcs/gists{/gist_id}","starred_url":"https://api.github.com/users/hungcs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hungcs/subscriptions","organizations_url":"https://api.github.com/users/hungcs/orgs","repos_url":"https://api.github.com/users/hungcs/repos","events_url":"https://api.github.com/users/hungcs/events{/privacy}","received_events_url":"https://api.github.com/users/hungcs/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2022-07-16T10:38:00Z","updated_at":"2022-08-04T17:22:58Z","closed_at":"2022-08-04T17:22:57Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"**Describe the bug**\r\n@hungcs reported following error when executing `hyperopt_report_cli(\"/Users/hw/datasets/hyperopt_statistics_4.json\")`\r\n\r\n```\r\n File \"g.py\", line 15, in <module>\r\n    g = hyperopt_report_cli(\"/Users/hw/datasets/hyperopt_statistics_4.json\", \"/Users/hw/datasets/hyp\")\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/ludwig/visualize.py\", line 3660, in hyperopt_report_cli\r\n    hyperopt_report(hyperopt_stats_path, output_directory=output_directory, file_format=file_format)\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/ludwig/visualize.py\", line 3684, in hyperopt_report\r\n    visualization_utils.hyperopt_report(\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/ludwig/utils/visualization_utils.py\", line 1323, in hyperopt_report\r\n    hyperopt_pair_plot(\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/ludwig/utils/visualization_utils.py\", line 1397, in hyperopt_pair_plot\r\n    heatmap = hyperopt_results_df.pivot_table(index=param1, columns=param2, values=metric, aggfunc=\"mean\")\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/frame.py\", line 8038, in pivot_table\r\n    return pivot_table(\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/reshape/pivot.py\", line 95, in pivot_table\r\n    table = __internal_pivot_table(\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/reshape/pivot.py\", line 165, in __internal_pivot_table\r\n    agged = grouped.agg(aggfunc)\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/groupby/generic.py\", line 869, in aggregate\r\n    result = op.agg()\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/apply.py\", line 165, in agg\r\n    return self.apply_str()\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/apply.py\", line 546, in apply_str\r\n    return self._try_aggregate_string_function(obj, f, *self.args, **self.kwargs)\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/apply.py\", line 616, in _try_aggregate_string_function\r\n    return f(*args, **kwargs)\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/groupby/groupby.py\", line 1956, in mean\r\n    result = self._cython_agg_general(\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/groupby/groupby.py\", line 1597, in _cython_agg_general\r\n    res = self._wrap_agged_manager(new_mgr)\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/groupby/generic.py\", line 1434, in _wrap_agged_manager\r\n    index = self.grouper.result_index\r\n  File \"pandas/_libs/properties.pyx\", line 37, in pandas._libs.properties.CachedProperty.__get__\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/groupby/ops.py\", line 895, in result_index\r\n    codes = self.reconstructed_codes\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/groupby/ops.py\", line 871, in reconstructed_codes\r\n    codes = self.codes\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/groupby/ops.py\", line 793, in codes\r\n    return [ping.codes for ping in self.groupings]\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/groupby/ops.py\", line 793, in <listcomp>\r\n    return [ping.codes for ping in self.groupings]\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/groupby/grouper.py\", line 622, in codes\r\n    return self._codes_and_uniques[0]\r\n  File \"pandas/_libs/properties.pyx\", line 37, in pandas._libs.properties.CachedProperty.__get__\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/groupby/grouper.py\", line 690, in _codes_and_uniques\r\n    codes, uniques = algorithms.factorize(\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/algorithms.py\", line 763, in factorize\r\n    codes, uniques = factorize_array(\r\n  File \"/Users/hw/mambaforge/envs/based/lib/python3.8/site-packages/pandas/core/algorithms.py\", line 560, in factorize_array\r\n    uniques, codes = table.factorize(\r\n  File \"pandas/_libs/hashtable_class_helper.pxi\", line 5394, in pandas._libs.hashtable.PyObjectHashTable.factorize\r\n  File \"pandas/_libs/hashtable_class_helper.pxi\", line 5310, in pandas._libs.hashtable.PyObjectHashTable._unique\r\nTypeError: unhashable type: 'dict'\r\n```\r\n\r\n**Expected behavior**\r\nGeneration of the required files for the hyperopt hiplot visualization\r\n\r\n**Environment (please complete the following information):**\r\n\r\n- Ludwig version: 0.6.dev\r\n\r\n**Additional context**\r\nRoot cause appears to be an interaction between hyperopt and mflow().   In the hyperopt output file `hyperopt_statistics.json` file, find `mlflow` related dictionary embedded in the hyperopt `parameters` section:\r\n![image](https://user-images.githubusercontent.com/1425269/179351432-00bda625-2281-4c77-a88a-59faa6d66192.png)\r\n\r\nThis is an example call used to run hyperopt:\r\n```\r\n results = train_with_config(\r\n        dataset=train_dataset,\r\n        config=config,\r\n        output_directory=output_directory,\r\n        experiment_name=exp_name,\r\n        callbacks=[MlflowCallback(), *callbacks],\r\n        logging_level=logging.INFO,\r\n    )\r\n```\r\n","closed_by":{"login":"dalianaliu","id":33500844,"node_id":"MDQ6VXNlcjMzNTAwODQ0","avatar_url":"https://avatars.githubusercontent.com/u/33500844?v=4","gravatar_id":"","url":"https://api.github.com/users/dalianaliu","html_url":"https://github.com/dalianaliu","followers_url":"https://api.github.com/users/dalianaliu/followers","following_url":"https://api.github.com/users/dalianaliu/following{/other_user}","gists_url":"https://api.github.com/users/dalianaliu/gists{/gist_id}","starred_url":"https://api.github.com/users/dalianaliu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dalianaliu/subscriptions","organizations_url":"https://api.github.com/users/dalianaliu/orgs","repos_url":"https://api.github.com/users/dalianaliu/repos","events_url":"https://api.github.com/users/dalianaliu/events{/privacy}","received_events_url":"https://api.github.com/users/dalianaliu/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2288/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2288/timeline","performed_via_github_app":null,"state_reason":"completed"}