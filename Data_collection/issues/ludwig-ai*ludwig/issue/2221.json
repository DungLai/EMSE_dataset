{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2221","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2221/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2221/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2221/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/2221","id":1289762927,"node_id":"I_kwDOCbx2hs5M4Dhv","number":2221,"title":"KeyError: 'class_weights'","user":{"login":"jiangweiatgithub","id":14370779,"node_id":"MDQ6VXNlcjE0MzcwNzc5","avatar_url":"https://avatars.githubusercontent.com/u/14370779?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangweiatgithub","html_url":"https://github.com/jiangweiatgithub","followers_url":"https://api.github.com/users/jiangweiatgithub/followers","following_url":"https://api.github.com/users/jiangweiatgithub/following{/other_user}","gists_url":"https://api.github.com/users/jiangweiatgithub/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangweiatgithub/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangweiatgithub/subscriptions","organizations_url":"https://api.github.com/users/jiangweiatgithub/orgs","repos_url":"https://api.github.com/users/jiangweiatgithub/repos","events_url":"https://api.github.com/users/jiangweiatgithub/events{/privacy}","received_events_url":"https://api.github.com/users/jiangweiatgithub/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":{"login":"justinxzhao","id":3459541,"node_id":"MDQ6VXNlcjM0NTk1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/3459541?v=4","gravatar_id":"","url":"https://api.github.com/users/justinxzhao","html_url":"https://github.com/justinxzhao","followers_url":"https://api.github.com/users/justinxzhao/followers","following_url":"https://api.github.com/users/justinxzhao/following{/other_user}","gists_url":"https://api.github.com/users/justinxzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/justinxzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinxzhao/subscriptions","organizations_url":"https://api.github.com/users/justinxzhao/orgs","repos_url":"https://api.github.com/users/justinxzhao/repos","events_url":"https://api.github.com/users/justinxzhao/events{/privacy}","received_events_url":"https://api.github.com/users/justinxzhao/received_events","type":"User","site_admin":false},"assignees":[{"login":"justinxzhao","id":3459541,"node_id":"MDQ6VXNlcjM0NTk1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/3459541?v=4","gravatar_id":"","url":"https://api.github.com/users/justinxzhao","html_url":"https://github.com/justinxzhao","followers_url":"https://api.github.com/users/justinxzhao/followers","following_url":"https://api.github.com/users/justinxzhao/following{/other_user}","gists_url":"https://api.github.com/users/justinxzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/justinxzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinxzhao/subscriptions","organizations_url":"https://api.github.com/users/justinxzhao/orgs","repos_url":"https://api.github.com/users/justinxzhao/repos","events_url":"https://api.github.com/users/justinxzhao/events{/privacy}","received_events_url":"https://api.github.com/users/justinxzhao/received_events","type":"User","site_admin":false},{"login":"ShreyaR","id":5787923,"node_id":"MDQ6VXNlcjU3ODc5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/5787923?v=4","gravatar_id":"","url":"https://api.github.com/users/ShreyaR","html_url":"https://github.com/ShreyaR","followers_url":"https://api.github.com/users/ShreyaR/followers","following_url":"https://api.github.com/users/ShreyaR/following{/other_user}","gists_url":"https://api.github.com/users/ShreyaR/gists{/gist_id}","starred_url":"https://api.github.com/users/ShreyaR/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ShreyaR/subscriptions","organizations_url":"https://api.github.com/users/ShreyaR/orgs","repos_url":"https://api.github.com/users/ShreyaR/repos","events_url":"https://api.github.com/users/ShreyaR/events{/privacy}","received_events_url":"https://api.github.com/users/ShreyaR/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2022-06-30T08:12:00Z","updated_at":"2022-09-29T18:10:24Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"I have trying to train an English-Chinese MT model, got the following issue:\r\nludwig experiment --dataset alt_en-US_zh-CN_200k.tsv --config mt_en_sch.yaml\r\nNote: NumExpr detected 16 cores but \"NUMEXPR_MAX_THREADS\" not set, so enforcing safe limit of 8.\r\nNumExpr defaulting to 8 threads.\r\nray.init() failed: Could not find any running Ray instance. Please specify the one to connect to by setting `--address` flag or `RAY_ADDRESS` environment variable.\r\n███████████████████████\r\n█ █ █ █  ▜█ █ █ █ █   █\r\n█ █ █ █ █ █ █ █ █ █ ███\r\n█ █   █ █ █ █ █ █ █ ▌ █\r\n█ █████ █ █ █ █ █ █ █ █\r\n█     █  ▟█     █ █   █\r\n███████████████████████\r\nludwig v0.5.3 - Experiment\r\n\r\n\r\n╒════════════════════════╕\r\n│ EXPERIMENT DESCRIPTION │\r\n╘════════════════════════╛\r\n\r\n╒══════════════════╤════════════════════════════════════════════════════════════════════════════╕\r\n│ Experiment name  │ experiment                                                                 │\r\n├──────────────────┼────────────────────────────────────────────────────────────────────────────┤\r\n│ Model name       │ run                                                                        │\r\n├──────────────────┼────────────────────────────────────────────────────────────────────────────┤\r\n│ Output directory │ D:\\repos2\\ludwig05\\mt_01\\results\\experiment_run_7                          │\r\n├──────────────────┼────────────────────────────────────────────────────────────────────────────┤\r\n│ ludwig_version   │ '0.5.3'                                                                    │\r\n├──────────────────┼────────────────────────────────────────────────────────────────────────────┤\r\n│ command          │ ('D:\\\\ProgramData\\\\Anaconda3\\\\envs\\\\ludwig05\\\\Scripts\\\\ludwig experiment ' │\r\n│                  │  '--dataset alt_en-US_zh-CN_200k.tsv --config mt_en_sch.yaml')             │\r\n├──────────────────┼────────────────────────────────────────────────────────────────────────────┤\r\n│ random_seed      │ 42                                                                         │\r\n├──────────────────┼────────────────────────────────────────────────────────────────────────────┤\r\n│ dataset          │ 'alt_en-US_zh-CN_200k.tsv'                                                 │\r\n├──────────────────┼────────────────────────────────────────────────────────────────────────────┤\r\n│ data_format      │ 'tsv'                                                                      │\r\n├──────────────────┼────────────────────────────────────────────────────────────────────────────┤\r\n│ torch_version    │ '1.11.0+cu113'                                                             │\r\n├──────────────────┼────────────────────────────────────────────────────────────────────────────┤\r\n│ compute          │ {'gpu_type': 'Quadro RTX 5000', 'gpus_per_node': 1, 'num_nodes': 1}        │\r\n╘══════════════════╧════════════════════════════════════════════════════════════════════════════╛\r\n\r\n╒═══════════════╕\r\n│ LUDWIG CONFIG │\r\n╘═══════════════╛\r\n\r\n{   'combiner': {   'activation': 'relu',\r\n                    'bias_initializer': 'zeros',\r\n                    'dropout': 0.0,\r\n                    'fc_layers': None,\r\n                    'flatten_inputs': False,\r\n                    'norm': None,\r\n                    'norm_params': None,\r\n                    'num_fc_layers': 0,\r\n                    'output_size': 256,\r\n                    'residual': False,\r\n                    'type': 'concat',\r\n                    'use_bias': True,\r\n                    'weights_initializer': 'xavier_uniform'},\r\n    'input_features': [   {   'cell_type': 'lstm',\r\n                              'column': 'English',\r\n                              'encoder': 'rnn',\r\n                              'name': 'English',\r\n                              'preprocessing': {   'tokenizer': 'english_tokenize'},\r\n                              'proc_column': 'English_N2u1qg',\r\n                              'reduce_output': None,\r\n                              'tied': None,\r\n                              'type': 'text'}],\r\n    'output_features': [   {   'attention': 'bahdanau',\r\n                               'cell_type': 'lstm',\r\n                               'column': 'Chinese',\r\n                               'decoder': 'generator',\r\n                               'dependencies': [],\r\n                               'loss': {   'type': 'softmax_cross_entropy',\r\n                                           'unique': False},\r\n                               'name': 'Chinese',\r\n                               'preprocessing': {   'missing_value_strategy': 'drop_row',\r\n                                                    'tokenizer': 'characters'},\r\n                               'proc_column': 'Chinese_Pe0sb6',\r\n                               'reduce_dependencies': 'sum',\r\n                               'reduce_input': None,\r\n                               'type': 'text'}],\r\n    'preprocessing': {   'audio': {   'audio_feature': {   'num_filter_bands': 80,\r\n                                                           'type': 'fbank',\r\n                                                           'window_length_in_s': 0.04,\r\n                                                           'window_shift_in_s': 0.02},\r\n                                      'audio_file_length_limit_in_s': 7.5,\r\n                                      'in_memory': True,\r\n                                      'missing_value_strategy': 'backfill',\r\n                                      'norm': None,\r\n                                      'padding_value': 0},\r\n                         'bag': {   'fill_value': '<UNK>',\r\n                                    'lowercase': False,\r\n                                    'missing_value_strategy': 'fill_with_const',\r\n                                    'most_common': 10000,\r\n                                    'tokenizer': 'space'},\r\n                         'binary': {   'missing_value_strategy': 'fill_with_false'},\r\n                         'category': {   'fill_value': '<UNK>',\r\n                                         'lowercase': False,\r\n                                         'missing_value_strategy': 'fill_with_const',\r\n                                         'most_common': 10000},\r\n                         'date': {   'datetime_format': None,\r\n                                     'fill_value': '',\r\n                                     'missing_value_strategy': 'fill_with_const'},\r\n                         'force_split': False,\r\n                         'h3': {   'fill_value': 576495936675512319,\r\n                                   'missing_value_strategy': 'fill_with_const'},\r\n                         'image': {   'in_memory': True,\r\n                                      'infer_image_dimensions': True,\r\n                                      'infer_image_max_height': 256,\r\n                                      'infer_image_max_width': 256,\r\n                                      'infer_image_num_channels': True,\r\n                                      'infer_image_sample_size': 100,\r\n                                      'missing_value_strategy': 'backfill',\r\n                                      'num_processes': 1,\r\n                                      'resize_method': 'interpolate',\r\n                                      'scaling': 'pixel_normalization'},\r\n                         'number': {   'fill_value': 0,\r\n                                       'missing_value_strategy': 'fill_with_const',\r\n                                       'normalization': None},\r\n                         'oversample_minority': None,\r\n                         'sample_ratio': 1.0,\r\n                         'sequence': {   'fill_value': '<UNK>',\r\n                                         'lowercase': False,\r\n                                         'max_sequence_length': 256,\r\n                                         'missing_value_strategy': 'fill_with_const',\r\n                                         'most_common': 20000,\r\n                                         'padding': 'right',\r\n                                         'padding_symbol': '<PAD>',\r\n                                         'tokenizer': 'space',\r\n                                         'unknown_symbol': '<UNK>',\r\n                                         'vocab_file': None},\r\n                         'set': {   'fill_value': '<UNK>',\r\n                                    'lowercase': False,\r\n                                    'missing_value_strategy': 'fill_with_const',\r\n                                    'most_common': 10000,\r\n                                    'tokenizer': 'space'},\r\n                         'split_probabilities': (0.7, 0.1, 0.2),\r\n                         'stratify': None,\r\n                         'text': {   'fill_value': '<UNK>',\r\n                                     'lowercase': True,\r\n                                     'max_sequence_length': 256,\r\n                                     'missing_value_strategy': 'fill_with_const',\r\n                                     'most_common': 20000,\r\n                                     'padding': 'right',\r\n                                     'padding_symbol': '<PAD>',\r\n                                     'pretrained_model_name_or_path': None,\r\n                                     'tokenizer': 'space_punct',\r\n                                     'unknown_symbol': '<UNK>',\r\n                                     'vocab_file': None},\r\n                         'timeseries': {   'fill_value': '',\r\n                                           'missing_value_strategy': 'fill_with_const',\r\n                                           'padding': 'right',\r\n                                           'padding_value': 0,\r\n                                           'timeseries_length_limit': 256,\r\n                                           'tokenizer': 'space'},\r\n                         'undersample_majority': None,\r\n                         'vector': {   'fill_value': '',\r\n                                       'missing_value_strategy': 'fill_with_const'}},\r\n    'trainer': {   'batch_size': 96,\r\n                   'checkpoints_per_epoch': 0,\r\n                   'decay': False,\r\n                   'decay_rate': 0.96,\r\n                   'decay_steps': 10000,\r\n                   'early_stop': 5,\r\n                   'epochs': 100,\r\n                   'eval_batch_size': None,\r\n                   'evaluate_training_set': True,\r\n                   'gradient_clipping': {   'clipglobalnorm': 0.5,\r\n                                            'clipnorm': None,\r\n                                            'clipvalue': None},\r\n                   'increase_batch_size_eval_metric': 'loss',\r\n                   'increase_batch_size_eval_split': 'training',\r\n                   'increase_batch_size_on_plateau': 0,\r\n                   'increase_batch_size_on_plateau_max': 512,\r\n                   'increase_batch_size_on_plateau_patience': 5,\r\n                   'increase_batch_size_on_plateau_rate': 2.0,\r\n                   'learning_rate': 0.001,\r\n                   'learning_rate_scaling': 'linear',\r\n                   'learning_rate_warmup_epochs': 1.0,\r\n                   'optimizer': {   'amsgrad': False,\r\n                                    'betas': (0.9, 0.999),\r\n                                    'eps': 1e-08,\r\n                                    'lr': 0.001,\r\n                                    'type': 'adam',\r\n                                    'weight_decay': 0.0},\r\n                   'reduce_learning_rate_eval_metric': 'loss',\r\n                   'reduce_learning_rate_eval_split': 'training',\r\n                   'reduce_learning_rate_on_plateau': 0.0,\r\n                   'reduce_learning_rate_on_plateau_patience': 5,\r\n                   'reduce_learning_rate_on_plateau_rate': 0.5,\r\n                   'regularization_lambda': 0.0,\r\n                   'regularization_type': 'l2',\r\n                   'should_shuffle': True,\r\n                   'staircase': False,\r\n                   'steps_per_checkpoint': 0,\r\n                   'train_steps': None,\r\n                   'validation_field': 'combined',\r\n                   'validation_metric': 'loss'}}\r\n\r\n╒═══════════════╕\r\n│ PREPROCESSING │\r\n╘═══════════════╛\r\n\r\nUsing full raw dataset, no hdf5 and json file with the same name have been found\r\nBuilding dataset (it may take a while)\r\nLoading NLP pipeline\r\nBuilding dataset: DONE\r\nWriting preprocessed training set cache\r\nWriting preprocessed test set cache\r\nWriting preprocessed validation set cache\r\nWriting train set metadata\r\n\r\nDataset sizes:\r\n╒════════════╤════════╕\r\n│ Dataset    │   Size │\r\n╞════════════╪════════╡\r\n│ Training   │ 137501 │\r\n├────────────┼────────┤\r\n│ Validation │  19670 │\r\n├────────────┼────────┤\r\n│ Test       │  39446 │\r\n╘════════════╧════════╛\r\n\r\n╒═══════╕\r\n│ MODEL │\r\n╘═══════╛\r\n\r\nTraceback (most recent call last):\r\n  File \"d:\\programdata\\anaconda3\\envs\\ludwig05\\lib\\runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"d:\\programdata\\anaconda3\\envs\\ludwig05\\lib\\runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"D:\\ProgramData\\Anaconda3\\envs\\ludwig05\\Scripts\\ludwig.exe\\__main__.py\", line 7, in <module>\r\n  File \"d:\\programdata\\anaconda3\\envs\\ludwig05\\lib\\site-packages\\ludwig\\cli.py\", line 164, in main\r\n    CLI()\r\n  File \"d:\\programdata\\anaconda3\\envs\\ludwig05\\lib\\site-packages\\ludwig\\cli.py\", line 64, in __init__\r\n    getattr(self, args.command)()\r\n  File \"d:\\programdata\\anaconda3\\envs\\ludwig05\\lib\\site-packages\\ludwig\\cli.py\", line 84, in experiment\r\n    experiment.cli(sys.argv[2:])\r\n  File \"d:\\programdata\\anaconda3\\envs\\ludwig05\\lib\\site-packages\\ludwig\\experiment.py\", line 524, in cli\r\n    experiment_cli(**vars(args))\r\n  File \"d:\\programdata\\anaconda3\\envs\\ludwig05\\lib\\site-packages\\ludwig\\experiment.py\", line 240, in experiment_cli\r\n    random_seed=random_seed,\r\n  File \"d:\\programdata\\anaconda3\\envs\\ludwig05\\lib\\site-packages\\ludwig\\api.py\", line 1122, in experiment\r\n    random_seed=random_seed,\r\n  File \"d:\\programdata\\anaconda3\\envs\\ludwig05\\lib\\site-packages\\ludwig\\api.py\", line 493, in train\r\n    update_config_with_metadata(self.config, training_set_metadata)\r\n  File \"d:\\programdata\\anaconda3\\envs\\ludwig05\\lib\\site-packages\\ludwig\\features\\feature_registries.py\", line 100, in update_config_with_metadata\r\n    feature.update_config_with_metadata(output_feature, training_set_metadata[output_feature[NAME]])\r\n  File \"d:\\programdata\\anaconda3\\envs\\ludwig05\\lib\\site-packages\\ludwig\\features\\text_feature.py\", line 289, in update_config_with_metadata\r\n    if isinstance(output_feature[LOSS][\"class_weights\"], (list, tuple)):\r\nKeyError: 'class_weights'","closed_by":null,"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2221/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/2221/timeline","performed_via_github_app":null,"state_reason":null}