{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1648","repository_url":"https://api.github.com/repos/ludwig-ai/ludwig","labels_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1648/labels{/name}","comments_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1648/comments","events_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1648/events","html_url":"https://github.com/ludwig-ai/ludwig/issues/1648","id":1094651139,"node_id":"I_kwDOCbx2hs5BPw0D","number":1648,"title":"CUDA out of memory error during batch evaluation","user":{"login":"tgaddair","id":1742912,"node_id":"MDQ6VXNlcjE3NDI5MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1742912?v=4","gravatar_id":"","url":"https://api.github.com/users/tgaddair","html_url":"https://github.com/tgaddair","followers_url":"https://api.github.com/users/tgaddair/followers","following_url":"https://api.github.com/users/tgaddair/following{/other_user}","gists_url":"https://api.github.com/users/tgaddair/gists{/gist_id}","starred_url":"https://api.github.com/users/tgaddair/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tgaddair/subscriptions","organizations_url":"https://api.github.com/users/tgaddair/orgs","repos_url":"https://api.github.com/users/tgaddair/repos","events_url":"https://api.github.com/users/tgaddair/events{/privacy}","received_events_url":"https://api.github.com/users/tgaddair/received_events","type":"User","site_admin":false},"labels":[{"id":1174068769,"node_id":"MDU6TGFiZWwxMTc0MDY4NzY5","url":"https://api.github.com/repos/ludwig-ai/ludwig/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":{"login":"ShreyaR","id":5787923,"node_id":"MDQ6VXNlcjU3ODc5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/5787923?v=4","gravatar_id":"","url":"https://api.github.com/users/ShreyaR","html_url":"https://github.com/ShreyaR","followers_url":"https://api.github.com/users/ShreyaR/followers","following_url":"https://api.github.com/users/ShreyaR/following{/other_user}","gists_url":"https://api.github.com/users/ShreyaR/gists{/gist_id}","starred_url":"https://api.github.com/users/ShreyaR/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ShreyaR/subscriptions","organizations_url":"https://api.github.com/users/ShreyaR/orgs","repos_url":"https://api.github.com/users/ShreyaR/repos","events_url":"https://api.github.com/users/ShreyaR/events{/privacy}","received_events_url":"https://api.github.com/users/ShreyaR/received_events","type":"User","site_admin":false},"assignees":[{"login":"ShreyaR","id":5787923,"node_id":"MDQ6VXNlcjU3ODc5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/5787923?v=4","gravatar_id":"","url":"https://api.github.com/users/ShreyaR","html_url":"https://github.com/ShreyaR","followers_url":"https://api.github.com/users/ShreyaR/followers","following_url":"https://api.github.com/users/ShreyaR/following{/other_user}","gists_url":"https://api.github.com/users/ShreyaR/gists{/gist_id}","starred_url":"https://api.github.com/users/ShreyaR/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ShreyaR/subscriptions","organizations_url":"https://api.github.com/users/ShreyaR/orgs","repos_url":"https://api.github.com/users/ShreyaR/repos","events_url":"https://api.github.com/users/ShreyaR/events{/privacy}","received_events_url":"https://api.github.com/users/ShreyaR/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2022-01-05T18:52:42Z","updated_at":"2022-03-16T20:17:59Z","closed_at":"2022-03-16T20:17:59Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"This occurs when using AutoML on the Higgs dataset with PyTorch:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"run_auto_train_1hr.py\", line 13, in <module>\r\n    tune_for_memory=False\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/automl/automl.py\", line 103, in auto_train\r\n    return train_with_config(dataset, config, output_directory=output_directory, random_seed=random_seed, **kwargs)\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/automl/automl.py\", line 172, in train_with_config\r\n    config, dataset, output_directory=output_directory, model_name=model_name, random_seed=random_seed, **kwargs\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/automl/automl.py\", line 262, in _train\r\n    **kwargs,\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/hyperopt/run.py\", line 331, in hyperopt\r\n    **kwargs,\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/hyperopt/execution.py\", line 740, in execute\r\n    debug=debug,\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/api.py\", line 833, in evaluate\r\n    collect_predictions=collect_predictions or collect_overall_stats,\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/models/predictor.py\", line 174, in batch_evaluation\r\n    preds = self.model.evaluation_step(inputs, targets)\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/models/ecd.py\", line 187, in evaluation_step\r\n    predictions = self.predictions(inputs, output_features=None)\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/models/ecd.py\", line 178, in predictions\r\n    outputs = self(inputs)\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/models/ecd.py\", line 133, in forward\r\n    combiner_outputs = self.combiner(encoder_outputs)\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/combiners/combiners.py\", line 491, in forward\r\n    hidden, aggregated_mask, masks = self.tabnet(hidden)\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/modules/tabnet_modules.py\", line 111, in forward\r\n    x = self.feature_transforms[0](masked_features)  # [b_s, s + o_s]\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/modules/tabnet_modules.py\", line 314, in forward\r\n    hidden = (self.blocks[n](hidden) + hidden) * (0.5 ** 0.5)  # [b_s, s]\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/modules/tabnet_modules.py\", line 201, in forward\r\n    hidden = glu(hidden)  # [bs, s]\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/modules/activation_modules.py\", line 12, in glu\r\n    return nn.functional.glu(x, dim)\r\n  File \"/home/ray/anaconda3/lib/python3.7/site-packages/torch/nn/functional.py\", line 1335, in glu\r\n    return torch._C._nn.glu(input, dim)\r\nRuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 14.76 GiB total capacity; 13.55 GiB already allocated; 19.75 MiB free; 13.65 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\r\n```\r\n\r\ncc @anneholler for repro script and other details.","closed_by":{"login":"justinxzhao","id":3459541,"node_id":"MDQ6VXNlcjM0NTk1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/3459541?v=4","gravatar_id":"","url":"https://api.github.com/users/justinxzhao","html_url":"https://github.com/justinxzhao","followers_url":"https://api.github.com/users/justinxzhao/followers","following_url":"https://api.github.com/users/justinxzhao/following{/other_user}","gists_url":"https://api.github.com/users/justinxzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/justinxzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinxzhao/subscriptions","organizations_url":"https://api.github.com/users/justinxzhao/orgs","repos_url":"https://api.github.com/users/justinxzhao/repos","events_url":"https://api.github.com/users/justinxzhao/events{/privacy}","received_events_url":"https://api.github.com/users/justinxzhao/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1648/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1648/timeline","performed_via_github_app":null,"state_reason":"completed"}