[{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1019563321","html_url":"https://github.com/ludwig-ai/ludwig/issues/1705#issuecomment-1019563321","issue_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1705","id":1019563321,"node_id":"IC_kwDOCbx2hs48xU05","user":{"login":"amholler","id":86269492,"node_id":"MDQ6VXNlcjg2MjY5NDky","avatar_url":"https://avatars.githubusercontent.com/u/86269492?v=4","gravatar_id":"","url":"https://api.github.com/users/amholler","html_url":"https://github.com/amholler","followers_url":"https://api.github.com/users/amholler/followers","following_url":"https://api.github.com/users/amholler/following{/other_user}","gists_url":"https://api.github.com/users/amholler/gists{/gist_id}","starred_url":"https://api.github.com/users/amholler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amholler/subscriptions","organizations_url":"https://api.github.com/users/amholler/orgs","repos_url":"https://api.github.com/users/amholler/repos","events_url":"https://api.github.com/users/amholler/events{/privacy}","received_events_url":"https://api.github.com/users/amholler/received_events","type":"User","site_admin":false},"created_at":"2022-01-23T20:43:09Z","updated_at":"2022-01-23T20:43:09Z","author_association":"COLLABORATOR","body":"The stack dump is:\r\n```\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m 2022-01-23 08:17:12,441       ERROR function_runner.py:268 -- Runner Thread raised error.\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m Traceback (most recent call last):\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ray/tune/function_runner.py\", line 262, in run\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     self._entrypoint()\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ray/tune/function_runner.py\", line 331, in entrypoint\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     self._status_reporter.get_checkpoint())\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ray/util/tracing/tracing_helper.py\", line 451, in _resume_span\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     return method(self, *_args, **_kwargs)\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ray/tune/function_runner.py\", line 597, in _trainable_func\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     output = fn()\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ray/tune/utils/trainable.py\", line 344, in inner\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     trainable(config, **fn_kwargs)\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/hyperopt/execution.py\", line 699, in run_experiment_trial\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     config, checkpoint_dir, local_hyperopt_dict, self.decode_ctx, _is_ray_backend(backend)\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/hyperopt/execution.py\", line 568, in _run_experiment\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     _run()\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/hyperopt/execution.py\", line 535, in _run\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     parameters=config,\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/hyperopt/execution.py\", line 920, in run_experiment\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     debug=debug,\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/api.py\", line 1078, in experiment\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     debug=debug,\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/api.py\", line 538, in train\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     save_path=model_dir,\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/models/trainer.py\", line 741, in train\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     self._train_loop(batcher, progress_tracker, save_path, train_summary_writer, progress_bar)\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/models/trainer.py\", line 931, in _train_loop\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     targets,\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/models/trainer.py\", line 307, in train_step\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     model_outputs = self.model((inputs, targets))\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 1102, in _call_impl\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     return forward_call(*input, **kwargs)\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/models/ecd.py\", line 141, in forward\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     combiner_outputs = self.combiner(encoder_outputs)\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 1102, in _call_impl\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     return forward_call(*input, **kwargs)\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/combiners/combiners.py\", line 491, in forward\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     hidden, aggregated_mask, masks = self.tabnet(hidden)\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 1102, in _call_impl\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     return forward_call(*input, **kwargs)\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/modules/tabnet_modules.py\", line 118, in forward\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     mask_values = self.attentive_transforms[step_i](x[:, self.output_size :], prior_scales)  # [b_s, i_s]\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 1102, in _call_impl\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     return forward_call(*input, **kwargs)\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/modules/tabnet_modules.py\", line 252, in forward\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     return self.sparsemax(hidden)  # [b_s, s]\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 1102, in _call_impl\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     return forward_call(*input, **kwargs)\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/utils/torch_utils.py\", line 305, in forward\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     return sparsemax(input, self.dim)\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/utils/torch_utils.py\", line 252, in forward\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     tau, supp_size = SparsemaxFunction._threshold_and_support(input, dim=dim)\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m   File \"/home/ray/anaconda3/lib/python3.7/site-packages/ludwig/utils/torch_utils.py\", line 285, in _threshold_and_support\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m     input_srt, _ = torch.sort(input, descending=True, dim=dim)\r\n^[[2m^[[36m(ImplicitFunc pid=26034, ip=172.31.10.68)^[[0m RuntimeError: CUDA out of memory. Tried to allocate 322.00 MiB (GPU 0; 14.76 GiB total capacity; 13.30 GiB already allocated; 119.75 MiB free; 13.54 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\r\n```","reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1019563321/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"amholler","id":86269492,"node_id":"MDQ6VXNlcjg2MjY5NDky","avatar_url":"https://avatars.githubusercontent.com/u/86269492?v=4","gravatar_id":"","url":"https://api.github.com/users/amholler","html_url":"https://github.com/amholler","followers_url":"https://api.github.com/users/amholler/followers","following_url":"https://api.github.com/users/amholler/following{/other_user}","gists_url":"https://api.github.com/users/amholler/gists{/gist_id}","starred_url":"https://api.github.com/users/amholler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amholler/subscriptions","organizations_url":"https://api.github.com/users/amholler/orgs","repos_url":"https://api.github.com/users/amholler/repos","events_url":"https://api.github.com/users/amholler/events{/privacy}","received_events_url":"https://api.github.com/users/amholler/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1019563624","html_url":"https://github.com/ludwig-ai/ludwig/issues/1705#issuecomment-1019563624","issue_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1705","id":1019563624,"node_id":"IC_kwDOCbx2hs48xU5o","user":{"login":"amholler","id":86269492,"node_id":"MDQ6VXNlcjg2MjY5NDky","avatar_url":"https://avatars.githubusercontent.com/u/86269492?v=4","gravatar_id":"","url":"https://api.github.com/users/amholler","html_url":"https://github.com/amholler","followers_url":"https://api.github.com/users/amholler/followers","following_url":"https://api.github.com/users/amholler/following{/other_user}","gists_url":"https://api.github.com/users/amholler/gists{/gist_id}","starred_url":"https://api.github.com/users/amholler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amholler/subscriptions","organizations_url":"https://api.github.com/users/amholler/orgs","repos_url":"https://api.github.com/users/amholler/repos","events_url":"https://api.github.com/users/amholler/events{/privacy}","received_events_url":"https://api.github.com/users/amholler/received_events","type":"User","site_admin":false},"created_at":"2022-01-23T20:45:00Z","updated_at":"2022-01-23T20:45:27Z","author_association":"COLLABORATOR","body":"Note that kdd datasets require fixes on master and tf-legacy; PRs are available.","reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1019563624/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"amholler","id":86269492,"node_id":"MDQ6VXNlcjg2MjY5NDky","avatar_url":"https://avatars.githubusercontent.com/u/86269492?v=4","gravatar_id":"","url":"https://api.github.com/users/amholler","html_url":"https://github.com/amholler","followers_url":"https://api.github.com/users/amholler/followers","following_url":"https://api.github.com/users/amholler/following{/other_user}","gists_url":"https://api.github.com/users/amholler/gists{/gist_id}","starred_url":"https://api.github.com/users/amholler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amholler/subscriptions","organizations_url":"https://api.github.com/users/amholler/orgs","repos_url":"https://api.github.com/users/amholler/repos","events_url":"https://api.github.com/users/amholler/events{/privacy}","received_events_url":"https://api.github.com/users/amholler/received_events","type":"User","site_admin":false}},{"id":5945026741,"node_id":"RTE_lADOCbx2hs5CR3gKzwAAAAFiWei1","url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/events/5945026741","actor":{"login":"justinxzhao","id":3459541,"node_id":"MDQ6VXNlcjM0NTk1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/3459541?v=4","gravatar_id":"","url":"https://api.github.com/users/justinxzhao","html_url":"https://github.com/justinxzhao","followers_url":"https://api.github.com/users/justinxzhao/followers","following_url":"https://api.github.com/users/justinxzhao/following{/other_user}","gists_url":"https://api.github.com/users/justinxzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/justinxzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinxzhao/subscriptions","organizations_url":"https://api.github.com/users/justinxzhao/orgs","repos_url":"https://api.github.com/users/justinxzhao/repos","events_url":"https://api.github.com/users/justinxzhao/events{/privacy}","received_events_url":"https://api.github.com/users/justinxzhao/received_events","type":"User","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2022-01-24T19:37:26Z","rename":{"from":"pytorch/master CUDA OOM for kdd appetency w/automl; same config seems to train okay on tensorflow/pytorch","to":"pytorch/master CUDA OOM for kdd appetency w/automl; same config seems to train okay on tensorflow/tf-legacy"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1020594726","html_url":"https://github.com/ludwig-ai/ludwig/issues/1705#issuecomment-1020594726","issue_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1705","id":1020594726,"node_id":"IC_kwDOCbx2hs481Qom","user":{"login":"amholler","id":86269492,"node_id":"MDQ6VXNlcjg2MjY5NDky","avatar_url":"https://avatars.githubusercontent.com/u/86269492?v=4","gravatar_id":"","url":"https://api.github.com/users/amholler","html_url":"https://github.com/amholler","followers_url":"https://api.github.com/users/amholler/followers","following_url":"https://api.github.com/users/amholler/following{/other_user}","gists_url":"https://api.github.com/users/amholler/gists{/gist_id}","starred_url":"https://api.github.com/users/amholler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amholler/subscriptions","organizations_url":"https://api.github.com/users/amholler/orgs","repos_url":"https://api.github.com/users/amholler/repos","events_url":"https://api.github.com/users/amholler/events{/privacy}","received_events_url":"https://api.github.com/users/amholler/received_events","type":"User","site_admin":false},"created_at":"2022-01-24T22:06:12Z","updated_at":"2022-01-24T22:06:12Z","author_association":"COLLABORATOR","body":"The problem can be reproduced by running\r\nhttps://github.com/ludwig-ai/experiments/blob/main/automl/validation/kdd/run_auto_train_1hr.py","reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1020594726/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"amholler","id":86269492,"node_id":"MDQ6VXNlcjg2MjY5NDky","avatar_url":"https://avatars.githubusercontent.com/u/86269492?v=4","gravatar_id":"","url":"https://api.github.com/users/amholler","html_url":"https://github.com/amholler","followers_url":"https://api.github.com/users/amholler/followers","following_url":"https://api.github.com/users/amholler/following{/other_user}","gists_url":"https://api.github.com/users/amholler/gists{/gist_id}","starred_url":"https://api.github.com/users/amholler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amholler/subscriptions","organizations_url":"https://api.github.com/users/amholler/orgs","repos_url":"https://api.github.com/users/amholler/repos","events_url":"https://api.github.com/users/amholler/events{/privacy}","received_events_url":"https://api.github.com/users/amholler/received_events","type":"User","site_admin":false}},{"id":6020724418,"node_id":"AE_lADOCbx2hs5CR3gKzwAAAAFm3PbC","url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/events/6020724418","actor":{"login":"justinxzhao","id":3459541,"node_id":"MDQ6VXNlcjM0NTk1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/3459541?v=4","gravatar_id":"","url":"https://api.github.com/users/justinxzhao","html_url":"https://github.com/justinxzhao","followers_url":"https://api.github.com/users/justinxzhao/followers","following_url":"https://api.github.com/users/justinxzhao/following{/other_user}","gists_url":"https://api.github.com/users/justinxzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/justinxzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinxzhao/subscriptions","organizations_url":"https://api.github.com/users/justinxzhao/orgs","repos_url":"https://api.github.com/users/justinxzhao/repos","events_url":"https://api.github.com/users/justinxzhao/events{/privacy}","received_events_url":"https://api.github.com/users/justinxzhao/received_events","type":"User","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2022-02-07T16:39:12Z","assignee":{"login":"justinxzhao","id":3459541,"node_id":"MDQ6VXNlcjM0NTk1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/3459541?v=4","gravatar_id":"","url":"https://api.github.com/users/justinxzhao","html_url":"https://github.com/justinxzhao","followers_url":"https://api.github.com/users/justinxzhao/followers","following_url":"https://api.github.com/users/justinxzhao/following{/other_user}","gists_url":"https://api.github.com/users/justinxzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/justinxzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinxzhao/subscriptions","organizations_url":"https://api.github.com/users/justinxzhao/orgs","repos_url":"https://api.github.com/users/justinxzhao/repos","events_url":"https://api.github.com/users/justinxzhao/events{/privacy}","received_events_url":"https://api.github.com/users/justinxzhao/received_events","type":"User","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1031761122","html_url":"https://github.com/ludwig-ai/ludwig/issues/1705#issuecomment-1031761122","issue_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1705","id":1031761122,"node_id":"IC_kwDOCbx2hs49f2zi","user":{"login":"amholler","id":86269492,"node_id":"MDQ6VXNlcjg2MjY5NDky","avatar_url":"https://avatars.githubusercontent.com/u/86269492?v=4","gravatar_id":"","url":"https://api.github.com/users/amholler","html_url":"https://github.com/amholler","followers_url":"https://api.github.com/users/amholler/followers","following_url":"https://api.github.com/users/amholler/following{/other_user}","gists_url":"https://api.github.com/users/amholler/gists{/gist_id}","starred_url":"https://api.github.com/users/amholler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amholler/subscriptions","organizations_url":"https://api.github.com/users/amholler/orgs","repos_url":"https://api.github.com/users/amholler/repos","events_url":"https://api.github.com/users/amholler/events{/privacy}","received_events_url":"https://api.github.com/users/amholler/received_events","type":"User","site_admin":false},"created_at":"2022-02-07T18:06:00Z","updated_at":"2022-02-07T18:41:26Z","author_association":"COLLABORATOR","body":"Running on 3 node ray cluster, all nodes g4dn.4xlarge https://aws.amazon.com/ec2/instance-types/g4/","reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1031761122/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"amholler","id":86269492,"node_id":"MDQ6VXNlcjg2MjY5NDky","avatar_url":"https://avatars.githubusercontent.com/u/86269492?v=4","gravatar_id":"","url":"https://api.github.com/users/amholler","html_url":"https://github.com/amholler","followers_url":"https://api.github.com/users/amholler/followers","following_url":"https://api.github.com/users/amholler/following{/other_user}","gists_url":"https://api.github.com/users/amholler/gists{/gist_id}","starred_url":"https://api.github.com/users/amholler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amholler/subscriptions","organizations_url":"https://api.github.com/users/amholler/orgs","repos_url":"https://api.github.com/users/amholler/repos","events_url":"https://api.github.com/users/amholler/events{/privacy}","received_events_url":"https://api.github.com/users/amholler/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1032078379","html_url":"https://github.com/ludwig-ai/ludwig/issues/1705#issuecomment-1032078379","issue_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1705","id":1032078379,"node_id":"IC_kwDOCbx2hs49hEQr","user":{"login":"justinxzhao","id":3459541,"node_id":"MDQ6VXNlcjM0NTk1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/3459541?v=4","gravatar_id":"","url":"https://api.github.com/users/justinxzhao","html_url":"https://github.com/justinxzhao","followers_url":"https://api.github.com/users/justinxzhao/followers","following_url":"https://api.github.com/users/justinxzhao/following{/other_user}","gists_url":"https://api.github.com/users/justinxzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/justinxzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinxzhao/subscriptions","organizations_url":"https://api.github.com/users/justinxzhao/orgs","repos_url":"https://api.github.com/users/justinxzhao/repos","events_url":"https://api.github.com/users/justinxzhao/events{/privacy}","received_events_url":"https://api.github.com/users/justinxzhao/received_events","type":"User","site_admin":false},"created_at":"2022-02-08T00:19:55Z","updated_at":"2022-02-08T00:19:55Z","author_association":"COLLABORATOR","body":"I'm able to reproduce the OOM on Torch with the highlighted parameters, which uses a batch size of 8192.\r\n\r\nHowever, I get the same OOM error on Tensorflow.\r\n\r\nI tried a few different batch sizes on both Torch and Tensorflow on ray, using `nvidia-smi` to monitor memory usage.\r\n\r\nOverall we see that at each batch size, Torch uses a bit more memory than Tensorflow. 4096 is already quite close to the memory max of 15k MiB memory limit for both branches, so it's not surprising that 8192 is too large for either branch. \r\n![image](https://user-images.githubusercontent.com/3459541/152893318-f8ec0451-99b8-44e4-918d-6913557cff2f.png)\r\n\r\n@anneholler I'm curious if you're able to reproduce this finding on your end. If the OOM isn't unique to torch, then I think we can close the issue.","reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1032078379/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"justinxzhao","id":3459541,"node_id":"MDQ6VXNlcjM0NTk1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/3459541?v=4","gravatar_id":"","url":"https://api.github.com/users/justinxzhao","html_url":"https://github.com/justinxzhao","followers_url":"https://api.github.com/users/justinxzhao/followers","following_url":"https://api.github.com/users/justinxzhao/following{/other_user}","gists_url":"https://api.github.com/users/justinxzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/justinxzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinxzhao/subscriptions","organizations_url":"https://api.github.com/users/justinxzhao/orgs","repos_url":"https://api.github.com/users/justinxzhao/repos","events_url":"https://api.github.com/users/justinxzhao/events{/privacy}","received_events_url":"https://api.github.com/users/justinxzhao/received_events","type":"User","site_admin":false}},{"id":6023151413,"node_id":"MEE_lADOCbx2hs5CR3gKzwAAAAFnAf81","url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/events/6023151413","actor":{"login":"anneholler","id":1827252,"node_id":"MDQ6VXNlcjE4MjcyNTI=","avatar_url":"https://avatars.githubusercontent.com/u/1827252?v=4","gravatar_id":"","url":"https://api.github.com/users/anneholler","html_url":"https://github.com/anneholler","followers_url":"https://api.github.com/users/anneholler/followers","following_url":"https://api.github.com/users/anneholler/following{/other_user}","gists_url":"https://api.github.com/users/anneholler/gists{/gist_id}","starred_url":"https://api.github.com/users/anneholler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anneholler/subscriptions","organizations_url":"https://api.github.com/users/anneholler/orgs","repos_url":"https://api.github.com/users/anneholler/repos","events_url":"https://api.github.com/users/anneholler/events{/privacy}","received_events_url":"https://api.github.com/users/anneholler/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-02-08T00:19:55Z","performed_via_github_app":null},{"id":6023151416,"node_id":"SE_lADOCbx2hs5CR3gKzwAAAAFnAf84","url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/events/6023151416","actor":{"login":"anneholler","id":1827252,"node_id":"MDQ6VXNlcjE4MjcyNTI=","avatar_url":"https://avatars.githubusercontent.com/u/1827252?v=4","gravatar_id":"","url":"https://api.github.com/users/anneholler","html_url":"https://github.com/anneholler","followers_url":"https://api.github.com/users/anneholler/followers","following_url":"https://api.github.com/users/anneholler/following{/other_user}","gists_url":"https://api.github.com/users/anneholler/gists{/gist_id}","starred_url":"https://api.github.com/users/anneholler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anneholler/subscriptions","organizations_url":"https://api.github.com/users/anneholler/orgs","repos_url":"https://api.github.com/users/anneholler/repos","events_url":"https://api.github.com/users/anneholler/events{/privacy}","received_events_url":"https://api.github.com/users/anneholler/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-02-08T00:19:55Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1032973093","html_url":"https://github.com/ludwig-ai/ludwig/issues/1705#issuecomment-1032973093","issue_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1705","id":1032973093,"node_id":"IC_kwDOCbx2hs49kesl","user":{"login":"amholler","id":86269492,"node_id":"MDQ6VXNlcjg2MjY5NDky","avatar_url":"https://avatars.githubusercontent.com/u/86269492?v=4","gravatar_id":"","url":"https://api.github.com/users/amholler","html_url":"https://github.com/amholler","followers_url":"https://api.github.com/users/amholler/followers","following_url":"https://api.github.com/users/amholler/following{/other_user}","gists_url":"https://api.github.com/users/amholler/gists{/gist_id}","starred_url":"https://api.github.com/users/amholler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amholler/subscriptions","organizations_url":"https://api.github.com/users/amholler/orgs","repos_url":"https://api.github.com/users/amholler/repos","events_url":"https://api.github.com/users/amholler/events{/privacy}","received_events_url":"https://api.github.com/users/amholler/received_events","type":"User","site_admin":false},"created_at":"2022-02-08T19:19:09Z","updated_at":"2022-02-08T19:19:09Z","author_association":"COLLABORATOR","body":"```\r\nHi, Justin,\r\n\r\nThanks for looking at the problem and for producing the interesting memory use graphs.\r\n\r\nUnfortunately, I can still reproduce the problem.\r\n  \r\nTo aid repro, I've created a 5min run (ignore the \"1hr\" in script name) that can be executed on a single node [head-only]\r\nRay gpu-enabled cluster [g4dn.4xlarge], in which the troublesome config is passed as an initial point to evaluate.\r\n This script passes on the tf-legacy branch:\r\n  https://github.com/ludwig-ai/experiments/blob/main/automl/validation/kdd/run_auto_train_1hr_repro_tf.py\r\n This comparable script fails on the master branch:\r\n  https://github.com/ludwig-ai/experiments/blob/main/automl/validation/kdd/run_auto_train_1hr_repro_master.py\r\n\r\nOne thought is that the problem could be associated with the datatypes inferred for the input features,\r\nwhich are quite a bit different between master and tf-legacy.\r\n Latest automl config produced by Master:\r\n  https://github.com/ludwig-ai/experiments/blob/main/automl/validation/kdd/auto_config.json.automl.appetency.master\r\n Latest automl config produced by tf-legacy:\r\n  https://github.com/ludwig-ai/experiments/blob/main/automl/validation/kdd/auto_config.json.automl.appetency.tf\r\n\r\nI'm thinking that in your repro work yesterday, you may have used the master inferred datatypes in your tf-legacy run,\r\nand if the datatypes are the problem, that could be what made your tf-legacy runs fail.\r\n```","reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1032973093/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"amholler","id":86269492,"node_id":"MDQ6VXNlcjg2MjY5NDky","avatar_url":"https://avatars.githubusercontent.com/u/86269492?v=4","gravatar_id":"","url":"https://api.github.com/users/amholler","html_url":"https://github.com/amholler","followers_url":"https://api.github.com/users/amholler/followers","following_url":"https://api.github.com/users/amholler/following{/other_user}","gists_url":"https://api.github.com/users/amholler/gists{/gist_id}","starred_url":"https://api.github.com/users/amholler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amholler/subscriptions","organizations_url":"https://api.github.com/users/amholler/orgs","repos_url":"https://api.github.com/users/amholler/repos","events_url":"https://api.github.com/users/amholler/events{/privacy}","received_events_url":"https://api.github.com/users/amholler/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1033284759","html_url":"https://github.com/ludwig-ai/ludwig/issues/1705#issuecomment-1033284759","issue_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1705","id":1033284759,"node_id":"IC_kwDOCbx2hs49lqyX","user":{"login":"justinxzhao","id":3459541,"node_id":"MDQ6VXNlcjM0NTk1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/3459541?v=4","gravatar_id":"","url":"https://api.github.com/users/justinxzhao","html_url":"https://github.com/justinxzhao","followers_url":"https://api.github.com/users/justinxzhao/followers","following_url":"https://api.github.com/users/justinxzhao/following{/other_user}","gists_url":"https://api.github.com/users/justinxzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/justinxzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinxzhao/subscriptions","organizations_url":"https://api.github.com/users/justinxzhao/orgs","repos_url":"https://api.github.com/users/justinxzhao/repos","events_url":"https://api.github.com/users/justinxzhao/events{/privacy}","received_events_url":"https://api.github.com/users/justinxzhao/received_events","type":"User","site_admin":false},"created_at":"2022-02-09T02:39:09Z","updated_at":"2022-02-09T02:39:09Z","author_association":"COLLABORATOR","body":"Thanks for supplying the repro scripts! Definitely very useful for drilling into this more deeply.\r\n\r\nIndeed, for my runs, I was using the same explicitly specified types for both master and tf-legacy, rather than relying on each branch's automatically inferred types.\r\n\r\nIt appears that indeed the type assignment differences are the culprit. Master assigns the `text` type to many more columns than `tf-legacy` does, probably related to [this change](https://github.com/ludwig-ai/ludwig/pull/1542). Here's a sampling:\r\n\r\n`master`:\r\n```\r\n{'column': 'Var191', 'name': 'Var191', 'type': 'category'},\r\n                    {'column': 'Var192', 'name': 'Var192', 'type': 'text'},\r\n                    {'column': 'Var193', 'name': 'Var193', 'type': 'text'},\r\n                    {'column': 'Var194', 'name': 'Var194', 'type': 'category'},\r\n                    {'column': 'Var195', 'name': 'Var195', 'type': 'text'},\r\n                    {'column': 'Var196', 'name': 'Var196', 'type': 'category'},\r\n                    {'column': 'Var197', 'name': 'Var197', 'type': 'text'},\r\n                    {'column': 'Var198', 'name': 'Var198', 'type': 'text'},\r\n                    {'column': 'Var199', 'name': 'Var199', 'type': 'text'},\r\n                    {'column': 'Var200', 'name': 'Var200', 'type': 'text'},\r\n                    {'column': 'Var201', 'name': 'Var201', 'type': 'category'},\r\n                    {'column': 'Var202', 'name': 'Var202', 'type': 'text'},\r\n                    {'column': 'Var203', 'name': 'Var203', 'type': 'category'},\r\n                    {'column': 'Var204', 'name': 'Var204', 'type': 'text'},\r\n                    {'column': 'Var205', 'name': 'Var205', 'type': 'category'},\r\n                    {'column': 'Var206', 'name': 'Var206', 'type': 'text'},\r\n                    {'column': 'Var207', 'name': 'Var207', 'type': 'category'},\r\n                    {'column': 'Var208', 'name': 'Var208', 'type': 'category'},\r\n                    {'column': 'Var210', 'name': 'Var210', 'type': 'category'},\r\n                    {'column': 'Var211', 'name': 'Var211', 'type': 'category'},\r\n                    {'column': 'Var212', 'name': 'Var212', 'type': 'text'},\r\n                    {'column': 'Var213', 'name': 'Var213', 'type': 'category'},\r\n                    {'column': 'Var214', 'name': 'Var214', 'type': 'text'},\r\n                    {'column': 'Var215', 'name': 'Var215', 'type': 'category'},\r\n                    {'column': 'Var216', 'name': 'Var216', 'type': 'text'},\r\n                    {'column': 'Var217', 'name': 'Var217', 'type': 'text'},\r\n                    {'column': 'Var218', 'name': 'Var218', 'type': 'category'},\r\n                    {'column': 'Var219', 'name': 'Var219', 'type': 'text'},\r\n                    {'column': 'Var220', 'name': 'Var220', 'type': 'text'},\r\n                    {'column': 'Var221', 'name': 'Var221', 'type': 'category'},\r\n                    {'column': 'Var222', 'name': 'Var222', 'type': 'text'},\r\n                    {'column': 'Var223', 'name': 'Var223', 'type': 'category'},\r\n                    {'column': 'Var224', 'name': 'Var224', 'type': 'category'},\r\n                    {'column': 'Var225', 'name': 'Var225', 'type': 'category'},\r\n                    {'column': 'Var226', 'name': 'Var226', 'type': 'text'},\r\n                    {'column': 'Var227', 'name': 'Var227', 'type': 'category'},\r\n                    {'column': 'Var228', 'name': 'Var228', 'type': 'text'},\r\n                    {'column': 'Var229', 'name': 'Var229', 'type': 'category'}\r\n```\r\n\r\nvs. `tf-legacy`\r\n\r\n```\r\n{'column': 'Var191', 'name': 'Var191', 'type': 'category'},\r\n                    {'column': 'Var192', 'name': 'Var192', 'type': 'category'},\r\n                    {'column': 'Var193', 'name': 'Var193', 'type': 'category'},\r\n                    {'column': 'Var194', 'name': 'Var194', 'type': 'category'},\r\n                    {'column': 'Var195', 'name': 'Var195', 'type': 'category'},\r\n                    {'column': 'Var196', 'name': 'Var196', 'type': 'category'},\r\n                    {'column': 'Var197', 'name': 'Var197', 'type': 'category'},\r\n                    {'column': 'Var198', 'name': 'Var198', 'type': 'category'},\r\n                    {'column': 'Var199', 'name': 'Var199', 'type': 'category'},\r\n                    {'column': 'Var200', 'name': 'Var200', 'type': 'category'},\r\n                    {'column': 'Var201', 'name': 'Var201', 'type': 'category'},\r\n                    {'column': 'Var202', 'name': 'Var202', 'type': 'category'},\r\n                    {'column': 'Var203', 'name': 'Var203', 'type': 'category'},\r\n                    {'column': 'Var204', 'name': 'Var204', 'type': 'category'},\r\n                    {'column': 'Var205', 'name': 'Var205', 'type': 'category'},\r\n                    {'column': 'Var206', 'name': 'Var206', 'type': 'category'},\r\n                    {'column': 'Var207', 'name': 'Var207', 'type': 'category'},\r\n                    {'column': 'Var208', 'name': 'Var208', 'type': 'category'},\r\n                    {'column': 'Var209', 'name': 'Var209', 'type': 'numerical'},\r\n                    {'column': 'Var210', 'name': 'Var210', 'type': 'category'},\r\n                    {'column': 'Var211', 'name': 'Var211', 'type': 'category'},\r\n                    {'column': 'Var212', 'name': 'Var212', 'type': 'category'},\r\n                    {'column': 'Var213', 'name': 'Var213', 'type': 'category'},\r\n                    {'column': 'Var214', 'name': 'Var214', 'type': 'category'},\r\n                    {'column': 'Var215', 'name': 'Var215', 'type': 'category'},\r\n                    {'column': 'Var216', 'name': 'Var216', 'type': 'category'},\r\n                    {'column': 'Var217', 'name': 'Var217', 'type': 'category'},\r\n                    {'column': 'Var218', 'name': 'Var218', 'type': 'category'},\r\n                    {'column': 'Var219', 'name': 'Var219', 'type': 'category'},\r\n                    {'column': 'Var220', 'name': 'Var220', 'type': 'category'},\r\n                    {'column': 'Var221', 'name': 'Var221', 'type': 'category'},\r\n                    {'column': 'Var222', 'name': 'Var222', 'type': 'category'},\r\n                    {'column': 'Var223', 'name': 'Var223', 'type': 'category'},\r\n                    {'column': 'Var224', 'name': 'Var224', 'type': 'category'},\r\n                    {'column': 'Var225', 'name': 'Var225', 'type': 'category'},\r\n                    {'column': 'Var226', 'name': 'Var226', 'type': 'category'},\r\n                    {'column': 'Var227', 'name': 'Var227', 'type': 'category'},\r\n                    {'column': 'Var228', 'name': 'Var228', 'type': 'category'},\r\n                    {'column': 'Var229', 'name': 'Var229', 'type': 'category'},\r\n```\r\n\r\nThe default encoder for text features is a `parallel_cnn`, which is significantly heavier than the default single dense layer encoder for category features. It's not surprising that the config with many more text features runs into OOM (on both branches). Additionally, when I use `tf-legacy`'s column typing for `torch`, then torch no longer gets the OOM error. :)\r\n\r\nThis issue is now resolved in the sense that we see the same OOM / non-OOM behavior across both branches with the exact same config, just that the branches assign different types.\r\n\r\nIt's still an open question about whether we should fix the type assignment, and/or downgrade the text feature's default encoder to something a bit less intense, like `embed`, which might be good to do anyways.","reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1033284759/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"justinxzhao","id":3459541,"node_id":"MDQ6VXNlcjM0NTk1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/3459541?v=4","gravatar_id":"","url":"https://api.github.com/users/justinxzhao","html_url":"https://github.com/justinxzhao","followers_url":"https://api.github.com/users/justinxzhao/followers","following_url":"https://api.github.com/users/justinxzhao/following{/other_user}","gists_url":"https://api.github.com/users/justinxzhao/gists{/gist_id}","starred_url":"https://api.github.com/users/justinxzhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinxzhao/subscriptions","organizations_url":"https://api.github.com/users/justinxzhao/orgs","repos_url":"https://api.github.com/users/justinxzhao/repos","events_url":"https://api.github.com/users/justinxzhao/events{/privacy}","received_events_url":"https://api.github.com/users/justinxzhao/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1046070882","html_url":"https://github.com/ludwig-ai/ludwig/issues/1705#issuecomment-1046070882","issue_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/1705","id":1046070882,"node_id":"IC_kwDOCbx2hs4-WcZi","user":{"login":"amholler","id":86269492,"node_id":"MDQ6VXNlcjg2MjY5NDky","avatar_url":"https://avatars.githubusercontent.com/u/86269492?v=4","gravatar_id":"","url":"https://api.github.com/users/amholler","html_url":"https://github.com/amholler","followers_url":"https://api.github.com/users/amholler/followers","following_url":"https://api.github.com/users/amholler/following{/other_user}","gists_url":"https://api.github.com/users/amholler/gists{/gist_id}","starred_url":"https://api.github.com/users/amholler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amholler/subscriptions","organizations_url":"https://api.github.com/users/amholler/orgs","repos_url":"https://api.github.com/users/amholler/repos","events_url":"https://api.github.com/users/amholler/events{/privacy}","received_events_url":"https://api.github.com/users/amholler/received_events","type":"User","site_admin":false},"created_at":"2022-02-19T17:47:47Z","updated_at":"2022-02-19T17:47:47Z","author_association":"COLLABORATOR","body":"https://github.com/ludwig-ai/ludwig/pull/1755","reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/1046070882/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"amholler","id":86269492,"node_id":"MDQ6VXNlcjg2MjY5NDky","avatar_url":"https://avatars.githubusercontent.com/u/86269492?v=4","gravatar_id":"","url":"https://api.github.com/users/amholler","html_url":"https://github.com/amholler","followers_url":"https://api.github.com/users/amholler/followers","following_url":"https://api.github.com/users/amholler/following{/other_user}","gists_url":"https://api.github.com/users/amholler/gists{/gist_id}","starred_url":"https://api.github.com/users/amholler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amholler/subscriptions","organizations_url":"https://api.github.com/users/amholler/orgs","repos_url":"https://api.github.com/users/amholler/repos","events_url":"https://api.github.com/users/amholler/events{/privacy}","received_events_url":"https://api.github.com/users/amholler/received_events","type":"User","site_admin":false}}]