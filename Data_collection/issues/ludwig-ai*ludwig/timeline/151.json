[{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/468564262","html_url":"https://github.com/ludwig-ai/ludwig/issues/151#issuecomment-468564262","issue_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/151","id":468564262,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODU2NDI2Mg==","user":{"login":"w4nderlust","id":349256,"node_id":"MDQ6VXNlcjM0OTI1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/349256?v=4","gravatar_id":"","url":"https://api.github.com/users/w4nderlust","html_url":"https://github.com/w4nderlust","followers_url":"https://api.github.com/users/w4nderlust/followers","following_url":"https://api.github.com/users/w4nderlust/following{/other_user}","gists_url":"https://api.github.com/users/w4nderlust/gists{/gist_id}","starred_url":"https://api.github.com/users/w4nderlust/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/w4nderlust/subscriptions","organizations_url":"https://api.github.com/users/w4nderlust/orgs","repos_url":"https://api.github.com/users/w4nderlust/repos","events_url":"https://api.github.com/users/w4nderlust/events{/privacy}","received_events_url":"https://api.github.com/users/w4nderlust/received_events","type":"User","site_admin":false},"created_at":"2019-03-01T06:57:28Z","updated_at":"2019-03-01T06:57:28Z","author_association":"COLLABORATOR","body":"Let me explain a little bit how things work, i may in the future copy this explanation inside the docs:\r\nWhen you use `--horovod` what happens is that every worker loads the entire data in memory (you can specify to read it form the hdf5 file if it doesn't fit in memory). Each worker will then run a different batch in parallel of `batch_size`. The fact the the batches are different is ensured by the `DistributedBatcher` class.\r\nThis means that if you specify batch 50 and you have 8 workers, you are effectively working with a batch of 400. The horovod implementation compensates for this adjusting the learning rate. You can look at the itnernals if you are interested.\r\nNow, directly to your problem: 500x250 images are huge for current standards in available GPU memory, and that's the reason you are getting the `ResourceExhaustedError`. Depending on the task, downsampling them to much smaller dimensions should work really well, not decreasing performances a lot (in most cases improving them), reducing ram consumption, speeding up computation, and allowing you to use the freed ram with a larger batch size, that will speed up computation even further.\r\nThe way to do it is providing width and heigh parameters to the image preprocessing (if you do, preprocessing needs to be done again, make sure you delete the hdf5 and json files). At the moment the parameters should be set in the image feature itself, like `{name: img, type: image, width: 128, height: 128}`, but there is an open pull request to fix this to `{name: img, type: image, preprocessing: {width: 128, height: 128}}` which will be accepted most likely by the end of the week.\r\nLet me know if this is clear and if applying this suggestions you are able to solve your issues.","reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/468564262/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"w4nderlust","id":349256,"node_id":"MDQ6VXNlcjM0OTI1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/349256?v=4","gravatar_id":"","url":"https://api.github.com/users/w4nderlust","html_url":"https://github.com/w4nderlust","followers_url":"https://api.github.com/users/w4nderlust/followers","following_url":"https://api.github.com/users/w4nderlust/following{/other_user}","gists_url":"https://api.github.com/users/w4nderlust/gists{/gist_id}","starred_url":"https://api.github.com/users/w4nderlust/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/w4nderlust/subscriptions","organizations_url":"https://api.github.com/users/w4nderlust/orgs","repos_url":"https://api.github.com/users/w4nderlust/repos","events_url":"https://api.github.com/users/w4nderlust/events{/privacy}","received_events_url":"https://api.github.com/users/w4nderlust/received_events","type":"User","site_admin":false}},{"id":2173193659,"node_id":"MDEyOkxhYmVsZWRFdmVudDIxNzMxOTM2NTk=","url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/events/2173193659","actor":{"login":"w4nderlust","id":349256,"node_id":"MDQ6VXNlcjM0OTI1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/349256?v=4","gravatar_id":"","url":"https://api.github.com/users/w4nderlust","html_url":"https://github.com/w4nderlust","followers_url":"https://api.github.com/users/w4nderlust/followers","following_url":"https://api.github.com/users/w4nderlust/following{/other_user}","gists_url":"https://api.github.com/users/w4nderlust/gists{/gist_id}","starred_url":"https://api.github.com/users/w4nderlust/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/w4nderlust/subscriptions","organizations_url":"https://api.github.com/users/w4nderlust/orgs","repos_url":"https://api.github.com/users/w4nderlust/repos","events_url":"https://api.github.com/users/w4nderlust/events{/privacy}","received_events_url":"https://api.github.com/users/w4nderlust/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-03-01T06:57:37Z","label":{"name":"question","color":"d876e3"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/468583402","html_url":"https://github.com/ludwig-ai/ludwig/issues/151#issuecomment-468583402","issue_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/151","id":468583402,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODU4MzQwMg==","user":{"login":"tboo","id":19666785,"node_id":"MDQ6VXNlcjE5NjY2Nzg1","avatar_url":"https://avatars.githubusercontent.com/u/19666785?v=4","gravatar_id":"","url":"https://api.github.com/users/tboo","html_url":"https://github.com/tboo","followers_url":"https://api.github.com/users/tboo/followers","following_url":"https://api.github.com/users/tboo/following{/other_user}","gists_url":"https://api.github.com/users/tboo/gists{/gist_id}","starred_url":"https://api.github.com/users/tboo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tboo/subscriptions","organizations_url":"https://api.github.com/users/tboo/orgs","repos_url":"https://api.github.com/users/tboo/repos","events_url":"https://api.github.com/users/tboo/events{/privacy}","received_events_url":"https://api.github.com/users/tboo/received_events","type":"User","site_admin":false},"created_at":"2019-03-01T08:22:42Z","updated_at":"2019-03-01T08:23:17Z","author_association":"NONE","body":"Thanks so much for taking the time to clarify the data processing to a non-computer scientist :) I do realize that the image dimensions are in my case far larger than what people usually use in image classification. The problem is: 500x250 is already after 8 fold down-sampling of the original images. Since these are biological images you reach at some point a sub-sampling sweet spot at which you get rid of the distinguishing details. Nevertheless I will have to get a bit creative (crops) but it helps to understand how the data are handled. So thanks again and keep up the awesome work.","reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/468583402/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tboo","id":19666785,"node_id":"MDQ6VXNlcjE5NjY2Nzg1","avatar_url":"https://avatars.githubusercontent.com/u/19666785?v=4","gravatar_id":"","url":"https://api.github.com/users/tboo","html_url":"https://github.com/tboo","followers_url":"https://api.github.com/users/tboo/followers","following_url":"https://api.github.com/users/tboo/following{/other_user}","gists_url":"https://api.github.com/users/tboo/gists{/gist_id}","starred_url":"https://api.github.com/users/tboo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tboo/subscriptions","organizations_url":"https://api.github.com/users/tboo/orgs","repos_url":"https://api.github.com/users/tboo/repos","events_url":"https://api.github.com/users/tboo/events{/privacy}","received_events_url":"https://api.github.com/users/tboo/received_events","type":"User","site_admin":false}},{"id":2173335419,"node_id":"MDExOkNsb3NlZEV2ZW50MjE3MzMzNTQxOQ==","url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/events/2173335419","actor":{"login":"tboo","id":19666785,"node_id":"MDQ6VXNlcjE5NjY2Nzg1","avatar_url":"https://avatars.githubusercontent.com/u/19666785?v=4","gravatar_id":"","url":"https://api.github.com/users/tboo","html_url":"https://github.com/tboo","followers_url":"https://api.github.com/users/tboo/followers","following_url":"https://api.github.com/users/tboo/following{/other_user}","gists_url":"https://api.github.com/users/tboo/gists{/gist_id}","starred_url":"https://api.github.com/users/tboo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tboo/subscriptions","organizations_url":"https://api.github.com/users/tboo/orgs","repos_url":"https://api.github.com/users/tboo/repos","events_url":"https://api.github.com/users/tboo/events{/privacy}","received_events_url":"https://api.github.com/users/tboo/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-03-01T08:22:42Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/468838387","html_url":"https://github.com/ludwig-ai/ludwig/issues/151#issuecomment-468838387","issue_url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/151","id":468838387,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODgzODM4Nw==","user":{"login":"w4nderlust","id":349256,"node_id":"MDQ6VXNlcjM0OTI1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/349256?v=4","gravatar_id":"","url":"https://api.github.com/users/w4nderlust","html_url":"https://github.com/w4nderlust","followers_url":"https://api.github.com/users/w4nderlust/followers","following_url":"https://api.github.com/users/w4nderlust/following{/other_user}","gists_url":"https://api.github.com/users/w4nderlust/gists{/gist_id}","starred_url":"https://api.github.com/users/w4nderlust/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/w4nderlust/subscriptions","organizations_url":"https://api.github.com/users/w4nderlust/orgs","repos_url":"https://api.github.com/users/w4nderlust/repos","events_url":"https://api.github.com/users/w4nderlust/events{/privacy}","received_events_url":"https://api.github.com/users/w4nderlust/received_events","type":"User","site_admin":false},"created_at":"2019-03-01T22:50:12Z","updated_at":"2019-03-01T22:50:12Z","author_association":"COLLABORATOR","body":"Got it, yeas I can imagine how in some usecases resolution is really important. I would still suggest you to try downsizing through preprocessing as a trade-off, some pattern that lead to some outcomes may be missed, but maybe the accuracy that you get is good enough. It all depends on your task and expected performance.\r\nAnother possible trade-off is model size, for instance the number for filters for each layer and the number of layers. If you decrease the number of filters at the first layers (the ones that work on the full size fo the image) and increase them ad the last layers, you can potentially use larger images without sacrificing performance. For instance [VGG](https://gist.github.com/baraldilorenzo/07d7802847aaad0a35d3) has first 64 filter for the first 2 layers, than 128 for the following 2 layers, then 256 and then 516. You can do something similar with the first 4 layers for instance with just 8 / 16 / 32 filters.","reactions":{"url":"https://api.github.com/repos/ludwig-ai/ludwig/issues/comments/468838387/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"w4nderlust","id":349256,"node_id":"MDQ6VXNlcjM0OTI1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/349256?v=4","gravatar_id":"","url":"https://api.github.com/users/w4nderlust","html_url":"https://github.com/w4nderlust","followers_url":"https://api.github.com/users/w4nderlust/followers","following_url":"https://api.github.com/users/w4nderlust/following{/other_user}","gists_url":"https://api.github.com/users/w4nderlust/gists{/gist_id}","starred_url":"https://api.github.com/users/w4nderlust/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/w4nderlust/subscriptions","organizations_url":"https://api.github.com/users/w4nderlust/orgs","repos_url":"https://api.github.com/users/w4nderlust/repos","events_url":"https://api.github.com/users/w4nderlust/events{/privacy}","received_events_url":"https://api.github.com/users/w4nderlust/received_events","type":"User","site_admin":false}}]