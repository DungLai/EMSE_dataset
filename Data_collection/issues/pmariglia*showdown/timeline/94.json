[{"url":"https://api.github.com/repos/pmariglia/showdown/issues/comments/997519342","html_url":"https://github.com/pmariglia/showdown/issues/94#issuecomment-997519342","issue_url":"https://api.github.com/repos/pmariglia/showdown/issues/94","id":997519342,"node_id":"IC_kwDOCpNhO847dO_u","user":{"login":"mingu600","id":16931003,"node_id":"MDQ6VXNlcjE2OTMxMDAz","avatar_url":"https://avatars.githubusercontent.com/u/16931003?v=4","gravatar_id":"","url":"https://api.github.com/users/mingu600","html_url":"https://github.com/mingu600","followers_url":"https://api.github.com/users/mingu600/followers","following_url":"https://api.github.com/users/mingu600/following{/other_user}","gists_url":"https://api.github.com/users/mingu600/gists{/gist_id}","starred_url":"https://api.github.com/users/mingu600/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mingu600/subscriptions","organizations_url":"https://api.github.com/users/mingu600/orgs","repos_url":"https://api.github.com/users/mingu600/repos","events_url":"https://api.github.com/users/mingu600/events{/privacy}","received_events_url":"https://api.github.com/users/mingu600/received_events","type":"User","site_admin":false},"created_at":"2021-12-20T01:37:19Z","updated_at":"2021-12-20T01:38:03Z","author_association":"CONTRIBUTOR","body":"Here's my proposal for a change for Defiant, for example:\r\n\r\n```\r\ndef defiant(attacking_move, attacking_pokemon, defending_pokemon):\r\n    attacking_move = attacking_move.copy()\r\n    if attacking_move['target'] == 'normal':\r\n        if constants.BOOSTS in attacking_move:\r\n            attacking_move[constants.BOOSTS] = attacking_move[constants.BOOSTS].copy()\r\n            for boost in attacking_move[constants.BOOSTS].copy():\r\n                if attacking_move[constants.BOOSTS][boost] < 0:\r\n                    if constants.ATTACK not in attacking_move[constants.BOOSTS]:\r\n                            attacking_move[constants.BOOSTS][constants.ATTACK] = 2\r\n                    else:\r\n                        attacking_move[constants.BOOSTS][constants.ATTACK] += 2\r\n        elif attacking_move[constants.SECONDARY] and constants.BOOSTS in attacking_move[constants.SECONDARY]:\r\n            attacking_move[constants.SECONDARY] = attacking_move[constants.SECONDARY].copy()\r\n            attacking_move[constants.SECONDARY][constants.BOOSTS] = attacking_move[constants.SECONDARY] [constants.BOOSTS].copy()\r\n            for boost in attacking_move[constants.SECONDARY][constants.BOOSTS].copy():\r\n                if attacking_move[constants.SECONDARY][constants.BOOSTS][boost] < 0:\r\n                    if constants.ATTACK not in attacking_move[constants.SECONDARY][constants.BOOSTS]:\r\n                        attacking_move[constants.SECONDARY][constants.BOOSTS][constants.ATTACK] = 2\r\n                    else:\r\n                        attacking_move[constants.SECONDARY][constants.BOOSTS][constants.ATTACK] += 2\r\n    return attacking_move\r\n```","reactions":{"url":"https://api.github.com/repos/pmariglia/showdown/issues/comments/997519342/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mingu600","id":16931003,"node_id":"MDQ6VXNlcjE2OTMxMDAz","avatar_url":"https://avatars.githubusercontent.com/u/16931003?v=4","gravatar_id":"","url":"https://api.github.com/users/mingu600","html_url":"https://github.com/mingu600","followers_url":"https://api.github.com/users/mingu600/followers","following_url":"https://api.github.com/users/mingu600/following{/other_user}","gists_url":"https://api.github.com/users/mingu600/gists{/gist_id}","starred_url":"https://api.github.com/users/mingu600/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mingu600/subscriptions","organizations_url":"https://api.github.com/users/mingu600/orgs","repos_url":"https://api.github.com/users/mingu600/repos","events_url":"https://api.github.com/users/mingu600/events{/privacy}","received_events_url":"https://api.github.com/users/mingu600/received_events","type":"User","site_admin":false}},{"id":5793718672,"node_id":"REFE_lADOCpNhO85AoCKezwAAAAFZVSGQ","url":"https://api.github.com/repos/pmariglia/showdown/issues/events/5793718672","actor":{"login":"pmariglia","id":25304649,"node_id":"MDQ6VXNlcjI1MzA0NjQ5","avatar_url":"https://avatars.githubusercontent.com/u/25304649?v=4","gravatar_id":"","url":"https://api.github.com/users/pmariglia","html_url":"https://github.com/pmariglia","followers_url":"https://api.github.com/users/pmariglia/followers","following_url":"https://api.github.com/users/pmariglia/following{/other_user}","gists_url":"https://api.github.com/users/pmariglia/gists{/gist_id}","starred_url":"https://api.github.com/users/pmariglia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pmariglia/subscriptions","organizations_url":"https://api.github.com/users/pmariglia/orgs","repos_url":"https://api.github.com/users/pmariglia/repos","events_url":"https://api.github.com/users/pmariglia/events{/privacy}","received_events_url":"https://api.github.com/users/pmariglia/received_events","type":"User","site_admin":false},"event":"referenced","commit_id":"70635fd55aa46ae42749dfbf65713600abd1c969","commit_url":"https://api.github.com/repos/pmariglia/showdown/commits/70635fd55aa46ae42749dfbf65713600abd1c969","created_at":"2021-12-20T15:53:02Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/pmariglia/showdown/issues/comments/998050911","html_url":"https://github.com/pmariglia/showdown/issues/94#issuecomment-998050911","issue_url":"https://api.github.com/repos/pmariglia/showdown/issues/94","id":998050911,"node_id":"IC_kwDOCpNhO847fQxf","user":{"login":"pmariglia","id":25304649,"node_id":"MDQ6VXNlcjI1MzA0NjQ5","avatar_url":"https://avatars.githubusercontent.com/u/25304649?v=4","gravatar_id":"","url":"https://api.github.com/users/pmariglia","html_url":"https://github.com/pmariglia","followers_url":"https://api.github.com/users/pmariglia/followers","following_url":"https://api.github.com/users/pmariglia/following{/other_user}","gists_url":"https://api.github.com/users/pmariglia/gists{/gist_id}","starred_url":"https://api.github.com/users/pmariglia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pmariglia/subscriptions","organizations_url":"https://api.github.com/users/pmariglia/orgs","repos_url":"https://api.github.com/users/pmariglia/repos","events_url":"https://api.github.com/users/pmariglia/events{/privacy}","received_events_url":"https://api.github.com/users/pmariglia/received_events","type":"User","site_admin":false},"created_at":"2021-12-20T15:55:41Z","updated_at":"2021-12-20T15:56:10Z","author_association":"OWNER","body":"Wow thanks for catching this @mingu600!\r\n\r\nYeah as is evidence by that atrocious code, some parts of the engine are completely spaghetti and can lead to ugly situations like this. The real problem is the handling of things like the side-effects of boosts should be done in some sort of callback handler, but that would require a larger re-design of the engine.\r\n\r\nI try to keep tests for the battle mechanics as much as possible, but clearly I was missing these edge cases.\r\n\r\nI've added a fix for defiant and competitive here based on your suggestion: 70635fd55aa46ae42749dfbf65713600abd1c969.\r\n\r\nI do not see anything wrong with weakarmor - could you elaborate on that one?\r\n\r\nclearbody, whitesmoke, and fullmetalbody are in a constant variable which is used elsewhere in the engine: https://github.com/pmariglia/showdown/blob/70635fd55aa46ae42749dfbf65713600abd1c969/constants.py#L360-L364\r\n\r\n^ There are problems with that logic too, it isn't perfect. I try not to prioritize the edgiest of edge-cases, but it's something I'll be sure to make a note of.","reactions":{"url":"https://api.github.com/repos/pmariglia/showdown/issues/comments/998050911/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pmariglia","id":25304649,"node_id":"MDQ6VXNlcjI1MzA0NjQ5","avatar_url":"https://avatars.githubusercontent.com/u/25304649?v=4","gravatar_id":"","url":"https://api.github.com/users/pmariglia","html_url":"https://github.com/pmariglia","followers_url":"https://api.github.com/users/pmariglia/followers","following_url":"https://api.github.com/users/pmariglia/following{/other_user}","gists_url":"https://api.github.com/users/pmariglia/gists{/gist_id}","starred_url":"https://api.github.com/users/pmariglia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pmariglia/subscriptions","organizations_url":"https://api.github.com/users/pmariglia/orgs","repos_url":"https://api.github.com/users/pmariglia/repos","events_url":"https://api.github.com/users/pmariglia/events{/privacy}","received_events_url":"https://api.github.com/users/pmariglia/received_events","type":"User","site_admin":false}},{"id":5793734359,"node_id":"MEE_lADOCpNhO85AoCKezwAAAAFZVV7X","url":"https://api.github.com/repos/pmariglia/showdown/issues/events/5793734359","actor":{"login":"mingu600","id":16931003,"node_id":"MDQ6VXNlcjE2OTMxMDAz","avatar_url":"https://avatars.githubusercontent.com/u/16931003?v=4","gravatar_id":"","url":"https://api.github.com/users/mingu600","html_url":"https://github.com/mingu600","followers_url":"https://api.github.com/users/mingu600/followers","following_url":"https://api.github.com/users/mingu600/following{/other_user}","gists_url":"https://api.github.com/users/mingu600/gists{/gist_id}","starred_url":"https://api.github.com/users/mingu600/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mingu600/subscriptions","organizations_url":"https://api.github.com/users/mingu600/orgs","repos_url":"https://api.github.com/users/mingu600/repos","events_url":"https://api.github.com/users/mingu600/events{/privacy}","received_events_url":"https://api.github.com/users/mingu600/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-12-20T15:55:42Z","performed_via_github_app":null},{"id":5793734363,"node_id":"SE_lADOCpNhO85AoCKezwAAAAFZVV7b","url":"https://api.github.com/repos/pmariglia/showdown/issues/events/5793734363","actor":{"login":"mingu600","id":16931003,"node_id":"MDQ6VXNlcjE2OTMxMDAz","avatar_url":"https://avatars.githubusercontent.com/u/16931003?v=4","gravatar_id":"","url":"https://api.github.com/users/mingu600","html_url":"https://github.com/mingu600","followers_url":"https://api.github.com/users/mingu600/followers","following_url":"https://api.github.com/users/mingu600/following{/other_user}","gists_url":"https://api.github.com/users/mingu600/gists{/gist_id}","starred_url":"https://api.github.com/users/mingu600/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mingu600/subscriptions","organizations_url":"https://api.github.com/users/mingu600/orgs","repos_url":"https://api.github.com/users/mingu600/repos","events_url":"https://api.github.com/users/mingu600/events{/privacy}","received_events_url":"https://api.github.com/users/mingu600/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-12-20T15:55:42Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/pmariglia/showdown/issues/comments/998135068","html_url":"https://github.com/pmariglia/showdown/issues/94#issuecomment-998135068","issue_url":"https://api.github.com/repos/pmariglia/showdown/issues/94","id":998135068,"node_id":"IC_kwDOCpNhO847flUc","user":{"login":"mingu600","id":16931003,"node_id":"MDQ6VXNlcjE2OTMxMDAz","avatar_url":"https://avatars.githubusercontent.com/u/16931003?v=4","gravatar_id":"","url":"https://api.github.com/users/mingu600","html_url":"https://github.com/mingu600","followers_url":"https://api.github.com/users/mingu600/followers","following_url":"https://api.github.com/users/mingu600/following{/other_user}","gists_url":"https://api.github.com/users/mingu600/gists{/gist_id}","starred_url":"https://api.github.com/users/mingu600/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mingu600/subscriptions","organizations_url":"https://api.github.com/users/mingu600/orgs","repos_url":"https://api.github.com/users/mingu600/repos","events_url":"https://api.github.com/users/mingu600/events{/privacy}","received_events_url":"https://api.github.com/users/mingu600/received_events","type":"User","site_admin":false},"created_at":"2021-12-20T17:35:18Z","updated_at":"2021-12-20T17:35:18Z","author_association":"CONTRIBUTOR","body":"No worries, I was just super confused why my Slowbro kept getting +4 attack boosts :P\r\n\r\nForgive me if I'm wrong, but the way weak armor is currently written, isn't the attacker getting the weak armor stat changes, and not the defender?","reactions":{"url":"https://api.github.com/repos/pmariglia/showdown/issues/comments/998135068/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mingu600","id":16931003,"node_id":"MDQ6VXNlcjE2OTMxMDAz","avatar_url":"https://avatars.githubusercontent.com/u/16931003?v=4","gravatar_id":"","url":"https://api.github.com/users/mingu600","html_url":"https://github.com/mingu600","followers_url":"https://api.github.com/users/mingu600/followers","following_url":"https://api.github.com/users/mingu600/following{/other_user}","gists_url":"https://api.github.com/users/mingu600/gists{/gist_id}","starred_url":"https://api.github.com/users/mingu600/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mingu600/subscriptions","organizations_url":"https://api.github.com/users/mingu600/orgs","repos_url":"https://api.github.com/users/mingu600/repos","events_url":"https://api.github.com/users/mingu600/events{/privacy}","received_events_url":"https://api.github.com/users/mingu600/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pmariglia/showdown/issues/comments/998138644","html_url":"https://github.com/pmariglia/showdown/issues/94#issuecomment-998138644","issue_url":"https://api.github.com/repos/pmariglia/showdown/issues/94","id":998138644,"node_id":"IC_kwDOCpNhO847fmMU","user":{"login":"pmariglia","id":25304649,"node_id":"MDQ6VXNlcjI1MzA0NjQ5","avatar_url":"https://avatars.githubusercontent.com/u/25304649?v=4","gravatar_id":"","url":"https://api.github.com/users/pmariglia","html_url":"https://github.com/pmariglia","followers_url":"https://api.github.com/users/pmariglia/followers","following_url":"https://api.github.com/users/pmariglia/following{/other_user}","gists_url":"https://api.github.com/users/pmariglia/gists{/gist_id}","starred_url":"https://api.github.com/users/pmariglia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pmariglia/subscriptions","organizations_url":"https://api.github.com/users/pmariglia/orgs","repos_url":"https://api.github.com/users/pmariglia/repos","events_url":"https://api.github.com/users/pmariglia/events{/privacy}","received_events_url":"https://api.github.com/users/pmariglia/received_events","type":"User","site_admin":false},"created_at":"2021-12-20T17:40:59Z","updated_at":"2021-12-20T17:40:59Z","author_association":"OWNER","body":"> No worries, I was just super confused why my Slowbro kept getting +4 attack boosts :P\r\n> \r\n> Forgive me if I'm wrong, but the way weak armor is currently written, isn't the attacker getting the weak armor stat changes, and not the defender?\r\n\r\nI dont think so? Check out this test: https://github.com/pmariglia/showdown/blob/70635fd55aa46ae42749dfbf65713600abd1c969/tests/test_battle_mechanics.py#L6846-L6865\r\n\r\nThe attacker (the bot) is using `tackle`, and the defender (the opponent) takes damage, loses defense, and gains speed.\r\n\r\nThe module where weakarmor is defined is `modify_attack_against.py`. Anything changed in there is changing a move that is being used on a pokemon. In the case of weakarmor, it is changing the tackle to include the defense drop and the speed boost.","reactions":{"url":"https://api.github.com/repos/pmariglia/showdown/issues/comments/998138644/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pmariglia","id":25304649,"node_id":"MDQ6VXNlcjI1MzA0NjQ5","avatar_url":"https://avatars.githubusercontent.com/u/25304649?v=4","gravatar_id":"","url":"https://api.github.com/users/pmariglia","html_url":"https://github.com/pmariglia","followers_url":"https://api.github.com/users/pmariglia/followers","following_url":"https://api.github.com/users/pmariglia/following{/other_user}","gists_url":"https://api.github.com/users/pmariglia/gists{/gist_id}","starred_url":"https://api.github.com/users/pmariglia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pmariglia/subscriptions","organizations_url":"https://api.github.com/users/pmariglia/orgs","repos_url":"https://api.github.com/users/pmariglia/repos","events_url":"https://api.github.com/users/pmariglia/events{/privacy}","received_events_url":"https://api.github.com/users/pmariglia/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pmariglia/showdown/issues/comments/998177132","html_url":"https://github.com/pmariglia/showdown/issues/94#issuecomment-998177132","issue_url":"https://api.github.com/repos/pmariglia/showdown/issues/94","id":998177132,"node_id":"IC_kwDOCpNhO847fvls","user":{"login":"mingu600","id":16931003,"node_id":"MDQ6VXNlcjE2OTMxMDAz","avatar_url":"https://avatars.githubusercontent.com/u/16931003?v=4","gravatar_id":"","url":"https://api.github.com/users/mingu600","html_url":"https://github.com/mingu600","followers_url":"https://api.github.com/users/mingu600/followers","following_url":"https://api.github.com/users/mingu600/following{/other_user}","gists_url":"https://api.github.com/users/mingu600/gists{/gist_id}","starred_url":"https://api.github.com/users/mingu600/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mingu600/subscriptions","organizations_url":"https://api.github.com/users/mingu600/orgs","repos_url":"https://api.github.com/users/mingu600/repos","events_url":"https://api.github.com/users/mingu600/events{/privacy}","received_events_url":"https://api.github.com/users/mingu600/received_events","type":"User","site_admin":false},"created_at":"2021-12-20T18:38:49Z","updated_at":"2021-12-20T18:38:49Z","author_association":"CONTRIBUTOR","body":"Sounds like it's working properly! I'll close the issue","reactions":{"url":"https://api.github.com/repos/pmariglia/showdown/issues/comments/998177132/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mingu600","id":16931003,"node_id":"MDQ6VXNlcjE2OTMxMDAz","avatar_url":"https://avatars.githubusercontent.com/u/16931003?v=4","gravatar_id":"","url":"https://api.github.com/users/mingu600","html_url":"https://github.com/mingu600","followers_url":"https://api.github.com/users/mingu600/followers","following_url":"https://api.github.com/users/mingu600/following{/other_user}","gists_url":"https://api.github.com/users/mingu600/gists{/gist_id}","starred_url":"https://api.github.com/users/mingu600/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mingu600/subscriptions","organizations_url":"https://api.github.com/users/mingu600/orgs","repos_url":"https://api.github.com/users/mingu600/repos","events_url":"https://api.github.com/users/mingu600/events{/privacy}","received_events_url":"https://api.github.com/users/mingu600/received_events","type":"User","site_admin":false}},{"id":5794607023,"node_id":"CE_lADOCpNhO85AoCKezwAAAAFZYq-v","url":"https://api.github.com/repos/pmariglia/showdown/issues/events/5794607023","actor":{"login":"mingu600","id":16931003,"node_id":"MDQ6VXNlcjE2OTMxMDAz","avatar_url":"https://avatars.githubusercontent.com/u/16931003?v=4","gravatar_id":"","url":"https://api.github.com/users/mingu600","html_url":"https://github.com/mingu600","followers_url":"https://api.github.com/users/mingu600/followers","following_url":"https://api.github.com/users/mingu600/following{/other_user}","gists_url":"https://api.github.com/users/mingu600/gists{/gist_id}","starred_url":"https://api.github.com/users/mingu600/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mingu600/subscriptions","organizations_url":"https://api.github.com/users/mingu600/orgs","repos_url":"https://api.github.com/users/mingu600/repos","events_url":"https://api.github.com/users/mingu600/events{/privacy}","received_events_url":"https://api.github.com/users/mingu600/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-12-20T18:38:49Z","state_reason":null,"performed_via_github_app":null}]