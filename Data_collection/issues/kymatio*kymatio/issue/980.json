{"url":"https://api.github.com/repos/kymatio/kymatio/issues/980","repository_url":"https://api.github.com/repos/kymatio/kymatio","labels_url":"https://api.github.com/repos/kymatio/kymatio/issues/980/labels{/name}","comments_url":"https://api.github.com/repos/kymatio/kymatio/issues/980/comments","events_url":"https://api.github.com/repos/kymatio/kymatio/issues/980/events","html_url":"https://github.com/kymatio/kymatio/issues/980","id":1507941478,"node_id":"I_kwDOCQLq_c5Z4Vxm","number":980,"title":"Converted TFJS-model not working","user":{"login":"martinknr","id":121238296,"node_id":"U_kgDOBznzGA","avatar_url":"https://avatars.githubusercontent.com/u/121238296?v=4","gravatar_id":"","url":"https://api.github.com/users/martinknr","html_url":"https://github.com/martinknr","followers_url":"https://api.github.com/users/martinknr/followers","following_url":"https://api.github.com/users/martinknr/following{/other_user}","gists_url":"https://api.github.com/users/martinknr/gists{/gist_id}","starred_url":"https://api.github.com/users/martinknr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinknr/subscriptions","organizations_url":"https://api.github.com/users/martinknr/orgs","repos_url":"https://api.github.com/users/martinknr/repos","events_url":"https://api.github.com/users/martinknr/events{/privacy}","received_events_url":"https://api.github.com/users/martinknr/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-12-22T14:00:45Z","updated_at":"2022-12-22T14:00:45Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"I am currently trying to convert a simple Keras model with a Scattering1D Layer to TFJS.\r\nThe conversion seems to work, but when i try to execute the model i get an error:\r\nError: Failed to cast to unknown dtype null\r\n\r\nHas anyone successfully converted a model which is working in Javascript/Typescript? Any idea what i am doing wrong or what i could try to get it running?\r\n\r\nSteps to reproduce (im working in windows 10):\r\ncreate new conda env:\r\n- conda create -n tfjs_model python=3.8 tensorflow\r\n- activate tfjs_model\r\n- pip install kymatio tensorflowjs\r\n\r\ncreate a simple model with:\r\n```\r\nimport tensorflow as tf\r\nfrom kymatio.keras import Scattering1D\r\nT = 2**10\r\nJ = 5\r\nQ = 8\r\nscattering = Scattering1D(J, Q=Q, max_order=2)\r\nmodel = tf.keras.models.Sequential()\r\nmodel.add(tf.keras.Input(shape=(T)))\r\nmodel.add(scattering)\r\nmodel.compile(metrics='accuracy', loss=None)\r\nmodel.save('scatter_transform')\r\n```\r\n\r\nThe resulting model can be used in python as expected:\r\n```\r\nimport tensorflow as tf\r\nmodel = tf.keras.models.load_model('scatter_transform')\r\nmodel.summary()\r\ndata_tensor = tf.zeros([1, 1024], tf.float32)\r\nres = model.predict(data_tensor)\r\nprint(res.shape)\r\n```\r\n\r\nConvert the model to a tfjs graph model by running:\r\n`tensorflowjs_converter scatter_transform scatter_transform_js`\r\n\r\nI am able to open the resulting model (model.json with one group-shard and a total size of ~2mb), but when i try to execute the model i get the error message:\r\n```\r\nC:\\Scripts\\typescript test\\tensorflow_model\\0_bugreport\\node_modules\\@tensorflow\\tfjs-converter\\dist\\tf-converter.node.js:12600\r\nthrow new Error(\"Failed to cast to unknown dtype \".concat(dtype));\r\n\r\nError: Failed to cast to unknown dtype null\r\nat cast_ (C:\\Scripts\\typescript test\\tensorflow_model\\0_bugreport\\node_modules\\@tensorflow\\tfjs-converter\\dist\\tf-converter.node.js:12600:15)\r\nat Object.cast__op [as cast] (C:\\Scripts\\typescript test\\tensorflow_model\\0_bugreport\\node_modules\\@tensorflow\\tfjs-converter\\dist\\tf-converter.node.js:11981:29)\r\nat executeOp$1 (C:\\Scripts\\typescript test\\tensorflow_model\\0_bugreport\\node_modules\\@tensorflow\\tfjs-converter\\dist\\tf-converter.node.js:29382:25)\r\nat C:\\Scripts\\typescript test\\tensorflow_model\\0_bugreport\\node_modules\\@tensorflow\\tfjs-converter\\dist\\tf-converter.node.js:29492:50\r\nat C:\\Scripts\\typescript test\\tensorflow_model\\0_bugreport\\node_modules\\@tensorflow\\tfjs-core\\dist\\tf-core.node.js:4478:22\r\nat Engine.scopedRun (C:\\Scripts\\typescript test\\tensorflow_model\\0_bugreport\\node_modules\\@tensorflow\\tfjs-core\\dist\\tf-core.node.js:4488:23)\r\nat Engine.tidy (C:\\Scripts\\typescript test\\tensorflow_model\\0_bugreport\\node_modules\\@tensorflow\\tfjs-core\\dist\\tf-core.node.js:4477:21)\r\nat tidy (C:\\Scripts\\typescript test\\tensorflow_model\\0_bugreport\\node_modules\\@tensorflow\\tfjs-core\\dist\\tf-core.node.js:9102:19)\r\nat C:\\Scripts\\typescript test\\tensorflow_model\\0_bugreport\\node_modules\\@tensorflow\\tfjs-converter\\dist\\tf-converter.node.js:29492:24\r\nat executeOp (C:\\Scripts\\typescript test\\tensorflow_model\\0_bugreport\\node_modules\\@tensorflow\\tfjs-converter\\dist\\tf-converter.node.js:29508:7)\r\n```\r\n\r\nJS-Code:\r\n```\r\nimport * as tf from '@tensorflow/tfjs-node'\r\nconsole.log('testing keras model...')\r\nasync function runModel() {\r\n\tconst model_ = await tf.loadGraphModel('file://scatter_transform_js/model.json');\r\n\tconst data = tf.zeros([1, 1024], 'float32');\r\n\tconsole.log(data.shape)\r\n\t//console.log(model_)\r\n\tconst res = model_.execute(data)\r\n\tconsole.log((res).arraySync())\r\n\tconsole.log('finished')\r\n}\r\nrunModel()\r\n```\r\nwith package.json:\r\n```\r\n{\r\n  \"name\": \"TFJS Scattering1D-Layer\",\r\n  \"type\": \"module\",\r\n  \"dependencies\": {\r\n    \"@tensorflow/tfjs-node\": \"^4.1.0\"\r\n  }\r\n}\r\n```","closed_by":null,"reactions":{"url":"https://api.github.com/repos/kymatio/kymatio/issues/980/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/kymatio/kymatio/issues/980/timeline","performed_via_github_app":null,"state_reason":null}