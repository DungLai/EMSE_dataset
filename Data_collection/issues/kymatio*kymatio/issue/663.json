{"url":"https://api.github.com/repos/kymatio/kymatio/issues/663","repository_url":"https://api.github.com/repos/kymatio/kymatio","labels_url":"https://api.github.com/repos/kymatio/kymatio/issues/663/labels{/name}","comments_url":"https://api.github.com/repos/kymatio/kymatio/issues/663/comments","events_url":"https://api.github.com/repos/kymatio/kymatio/issues/663/events","html_url":"https://github.com/kymatio/kymatio/issues/663","id":806786682,"node_id":"MDU6SXNzdWU4MDY3ODY2ODI=","number":663,"title":"Flaky TF FFT unit test","user":{"login":"janden","id":3976052,"node_id":"MDQ6VXNlcjM5NzYwNTI=","avatar_url":"https://avatars.githubusercontent.com/u/3976052?v=4","gravatar_id":"","url":"https://api.github.com/users/janden","html_url":"https://github.com/janden","followers_url":"https://api.github.com/users/janden/followers","following_url":"https://api.github.com/users/janden/following{/other_user}","gists_url":"https://api.github.com/users/janden/gists{/gist_id}","starred_url":"https://api.github.com/users/janden/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janden/subscriptions","organizations_url":"https://api.github.com/users/janden/orgs","repos_url":"https://api.github.com/users/janden/repos","events_url":"https://api.github.com/users/janden/events{/privacy}","received_events_url":"https://api.github.com/users/janden/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-02-11T22:16:40Z","updated_at":"2022-06-23T22:09:01Z","closed_at":"2022-06-23T22:09:01Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"So I keep getting intermittent test failures on GH Actions with the 2D FFT unit test:\r\n```\r\n=================================== FAILURES ===================================\r\n____________________ TestFFT.test_fft[TensorFlowBackend2D] _____________________\r\n\r\nself = <test_tensorflow_backend_2d.TestFFT object at 0x7f093716c9a0>\r\nbackend = <class 'kymatio.scattering2d.backend.tensorflow_backend.TensorFlowBackend2D'>\r\n\r\n    @pytest.mark.parametrize('backend', backends)\r\n    def test_fft(self, backend):\r\n        x = np.random.randn(2, 2)\r\n    \r\n        y = np.array([[x[0, 0] + x[0, 1] + x[1, 0] + x[1, 1],\r\n                       x[0, 0] - x[0, 1] + x[1, 0] - x[1, 1]],\r\n                      [x[0, 0] + x[0, 1] - x[1, 0] - x[1, 1],\r\n                       x[0, 0] - x[0, 1] - x[1, 0] + x[1, 1]]])\r\n    \r\n        z = backend.rfft(x)\r\n>       assert np.allclose(y, z)\r\nE       assert False\r\nE        +  where False = <function allclose at 0x7f098b65b550>(array([[ 2.95330393e+00, -4.98718912e-01],\\n       [-1.51491472e-03,  7.56337531e-01]]), <tf.Tensor: shape=(2, 2), dtype=complex64, numpy=\\narray([[ 2.9533038e+00+0.j, -4.9871886e-01+0.j],\\n       [-1.5148520e-03+0.j,  7.5633746e-01+0.j]], dtype=complex64)>)\r\nE        +    where <function allclose at 0x7f098b65b550> = np.allclose\r\n\r\ntests/scattering2d/test_tensorflow_backend_2d.py:141: AssertionError\r\n```\r\nIt doesn't reproduce locally. Likely this has to do with the cheap FFT implementation that they use (although it's surprising that it fails for such small arrays). The thing to do might be to relax the precision a bit.","closed_by":{"login":"lostanlen","id":3943142,"node_id":"MDQ6VXNlcjM5NDMxNDI=","avatar_url":"https://avatars.githubusercontent.com/u/3943142?v=4","gravatar_id":"","url":"https://api.github.com/users/lostanlen","html_url":"https://github.com/lostanlen","followers_url":"https://api.github.com/users/lostanlen/followers","following_url":"https://api.github.com/users/lostanlen/following{/other_user}","gists_url":"https://api.github.com/users/lostanlen/gists{/gist_id}","starred_url":"https://api.github.com/users/lostanlen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lostanlen/subscriptions","organizations_url":"https://api.github.com/users/lostanlen/orgs","repos_url":"https://api.github.com/users/lostanlen/repos","events_url":"https://api.github.com/users/lostanlen/events{/privacy}","received_events_url":"https://api.github.com/users/lostanlen/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/kymatio/kymatio/issues/663/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/kymatio/kymatio/issues/663/timeline","performed_via_github_app":null,"state_reason":"completed"}