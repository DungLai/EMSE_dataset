{"url":"https://api.github.com/repos/kymatio/kymatio/issues/859","repository_url":"https://api.github.com/repos/kymatio/kymatio","labels_url":"https://api.github.com/repos/kymatio/kymatio/issues/859/labels{/name}","comments_url":"https://api.github.com/repos/kymatio/kymatio/issues/859/comments","events_url":"https://api.github.com/repos/kymatio/kymatio/issues/859/events","html_url":"https://github.com/kymatio/kymatio/issues/859","id":1266263725,"node_id":"I_kwDOCQLq_c5Leaat","number":859,"title":"Options for padding","user":{"login":"flyIchtus","id":95094184,"node_id":"U_kgDOBasFqA","avatar_url":"https://avatars.githubusercontent.com/u/95094184?v=4","gravatar_id":"","url":"https://api.github.com/users/flyIchtus","html_url":"https://github.com/flyIchtus","followers_url":"https://api.github.com/users/flyIchtus/followers","following_url":"https://api.github.com/users/flyIchtus/following{/other_user}","gists_url":"https://api.github.com/users/flyIchtus/gists{/gist_id}","starred_url":"https://api.github.com/users/flyIchtus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyIchtus/subscriptions","organizations_url":"https://api.github.com/users/flyIchtus/orgs","repos_url":"https://api.github.com/users/flyIchtus/repos","events_url":"https://api.github.com/users/flyIchtus/events{/privacy}","received_events_url":"https://api.github.com/users/flyIchtus/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2022-06-09T14:57:09Z","updated_at":"2022-08-23T10:46:37Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Working with scattering for weather forecasts image analysis, I was wondering what influence the type of padding did have on results.\r\n\r\nThe reflection padding implemented by default seems to produce high gradients on the boundaries. After a few subsamplings, the large values on the boundary gain a certain weight in the spatial average, that could lead to estimation biases.\r\n\r\nThis is visible on orientation averaged second-order coefficients.\r\n\r\nQuestion 1 : have the topic already been discussed ?\r\n\r\nQuestion 2 : what about providing numpy padding modes as an option to scattering ?\r\n\r\nNow for a bit of demo, if it adds to the discussion.\r\nAfter a fork and 1 or 2 adds on numpy frontend/backend, one comes to the following  code :\r\n\r\n```\r\nfrom kymatio import Scattering2D\r\nimport numpy as np\r\nimport matplotlib.pyplot as plt\r\n\r\nwind_norm=np.load('wind_norm.npy')\r\n\r\nJ,L=4,8\r\n\r\n# defining indexing of order 2 coefficients\r\n\r\norder2_ind=[[[[L**2*(j1*(J-1)-j1*(j1-1)//2)\\\r\n                           +L*(j2-j1-1)\\\r\n                           +L*(J-j1-1)*l1\\\r\n                           +l2 \\\r\n                            for l2 in range(L)]\\\r\n                            for l1 in range(L)]\\\r\n                            for j2 in range(j1+1,J)] \\\r\n                            for j1 in range(J-1)]\r\n\r\ndef order2(data, pad_type):\r\n    \r\n    \"\"\"  \r\n    compute orientation averaged l2 coefficients\r\n    \"\"\"\r\n    scattering=Scattering2D(4,data.shape,8,\r\n             max_order=2,pre_pad=False,\r\n             frontend='numpy',backend='numpy',\r\n             out_type='array', pad_type=pad_type)\r\n    \r\n    ################### order 2 coefficients\r\n\r\n    results_order2=scattering(data)[1+4*8:]\r\n    \r\n    ################### averaging over l2 orientations\r\n\r\n    S2_j1j2l1=[]\r\n    for j1 in range(J-1):\r\n        for j2 in range(J-j1-1):\r\n            for l1 in range(L):\r\n    \r\n                S2_j1j2l1.append(\r\n                        np.mean(results_order2[order2_ind[j1][j2][l1],:,:],axis=0)\r\n                        )\r\n    S2_j1j2l1=np.array(S2_j1j2l1)\r\n\r\n    return S2_j1j2l1\r\n\r\nS2_symm=order2(wind_norm, 'symmetric')\r\nS2_reflect=order2(wind_norm, 'reflect')\r\n\r\nratio=100*(S2_symm/S2_reflect -1.0)\r\n\r\n\r\nprint(ratio.min(), ratio.max(), ratio.mean())\r\n\r\nplt.imshow(ratio[-1][::-1,:])\r\nplt.colorbar()\r\nplt.show() \r\n\r\n```\r\n\r\nThe data is downloadable in the zip attached.\r\n[wind_norm.zip](https://github.com/kymatio/kymatio/files/8871604/wind_norm.zip)\r\n\r\nThe result of this yields:\r\n\r\n`\r\n-19.169381905671035 13.210792343005728 -0.07116768707598231\r\n`\r\n![ratio_plot](https://user-images.githubusercontent.com/95094184/172886063-2b9c7451-b51a-4b54-9e41-1bab66570f30.png)\r\n\r\nHere both transforms coincide at the center, but not on the border. Overestimation by reflection padding is manifest here.\r\n\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/kymatio/kymatio/issues/859/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/kymatio/kymatio/issues/859/timeline","performed_via_github_app":null,"state_reason":null}