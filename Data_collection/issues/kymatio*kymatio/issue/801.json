{"url":"https://api.github.com/repos/kymatio/kymatio/issues/801","repository_url":"https://api.github.com/repos/kymatio/kymatio","labels_url":"https://api.github.com/repos/kymatio/kymatio/issues/801/labels{/name}","comments_url":"https://api.github.com/repos/kymatio/kymatio/issues/801/comments","events_url":"https://api.github.com/repos/kymatio/kymatio/issues/801/events","html_url":"https://github.com/kymatio/kymatio/issues/801","id":1179524984,"node_id":"I_kwDOCQLq_c5GTh94","number":801,"title":"AttributeError: 'Tensor' object has no attribute 'ndim'","user":{"login":"ryankshah","id":6048879,"node_id":"MDQ6VXNlcjYwNDg4Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/6048879?v=4","gravatar_id":"","url":"https://api.github.com/users/ryankshah","html_url":"https://github.com/ryankshah","followers_url":"https://api.github.com/users/ryankshah/followers","following_url":"https://api.github.com/users/ryankshah/following{/other_user}","gists_url":"https://api.github.com/users/ryankshah/gists{/gist_id}","starred_url":"https://api.github.com/users/ryankshah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ryankshah/subscriptions","organizations_url":"https://api.github.com/users/ryankshah/orgs","repos_url":"https://api.github.com/users/ryankshah/repos","events_url":"https://api.github.com/users/ryankshah/events{/privacy}","received_events_url":"https://api.github.com/users/ryankshah/received_events","type":"User","site_admin":false},"labels":[{"id":1076176418,"node_id":"MDU6TGFiZWwxMDc2MTc2NDE4","url":"https://api.github.com/repos/kymatio/kymatio/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1076176421,"node_id":"MDU6TGFiZWwxMDc2MTc2NDIx","url":"https://api.github.com/repos/kymatio/kymatio/labels/help%20wanted","name":"help wanted","color":"008672","default":true,"description":"Extra attention is needed"},{"id":1090201815,"node_id":"MDU6TGFiZWwxMDkwMjAxODE1","url":"https://api.github.com/repos/kymatio/kymatio/labels/high%20priority","name":"high priority","color":"AA0000","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/kymatio/kymatio/milestones/6","html_url":"https://github.com/kymatio/kymatio/milestone/6","labels_url":"https://api.github.com/repos/kymatio/kymatio/milestones/6/labels","id":4908848,"node_id":"MDk6TWlsZXN0b25lNDkwODg0OA==","number":6,"title":"0.3.alpha","description":"","creator":{"login":"lostanlen","id":3943142,"node_id":"MDQ6VXNlcjM5NDMxNDI=","avatar_url":"https://avatars.githubusercontent.com/u/3943142?v=4","gravatar_id":"","url":"https://api.github.com/users/lostanlen","html_url":"https://github.com/lostanlen","followers_url":"https://api.github.com/users/lostanlen/followers","following_url":"https://api.github.com/users/lostanlen/following{/other_user}","gists_url":"https://api.github.com/users/lostanlen/gists{/gist_id}","starred_url":"https://api.github.com/users/lostanlen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lostanlen/subscriptions","organizations_url":"https://api.github.com/users/lostanlen/orgs","repos_url":"https://api.github.com/users/lostanlen/repos","events_url":"https://api.github.com/users/lostanlen/events{/privacy}","received_events_url":"https://api.github.com/users/lostanlen/received_events","type":"User","site_admin":false},"open_issues":13,"closed_issues":30,"state":"open","created_at":"2019-12-06T12:39:56Z","updated_at":"2022-07-06T15:35:01Z","due_on":null,"closed_at":null},"comments":11,"created_at":"2022-03-24T13:33:15Z","updated_at":"2022-06-15T17:45:52Z","closed_at":"2022-06-15T17:45:51Z","author_association":"NONE","active_lock_reason":null,"body":"I was following the classification tutorial for 1D wavelet scattering and I receive the error:\r\n\r\n```python\r\nTraceback (most recent call last):\r\n  File \"filter_signals_fft.py\", line 145, in <module>\r\n    x = Scattering1D(J, Q=Q)(x_in)\r\n  File \"C:\\Users\\xwb18152\\AppData\\Roaming\\Python\\Python38\\site-packages\\keras\\utils\\traceback_utils.py\", line 67, in error_handler\r\n    raise e.with_traceback(filtered_tb) from None\r\n  File \"C:\\Users\\xwb18152\\AppData\\Roaming\\Python\\Python38\\site-packages\\tensorflow\\python\\autograph\\impl\\api.py\", line 692, in wrapper\r\n    raise e.ag_error_metadata.to_exception(e)\r\nAttributeError: Exception encountered when calling layer \"scattering1d\" (type Scattering1D).        \r\n\r\nin user code:\r\n\r\n    File \"C:\\Users\\xwb18152\\AppData\\Roaming\\Python\\Python38\\site-packages\\kymatio\\frontend\\keras_frontend.py\", line 17, in call  *\r\n        return self.scattering(x)\r\n    File \"C:\\Users\\xwb18152\\AppData\\Roaming\\Python\\Python38\\site-packages\\kymatio\\frontend\\keras_frontend.py\", line 14, in scattering  *\r\n        return self.S.scattering(x)\r\n    File \"C:\\Users\\xwb18152\\AppData\\Roaming\\Python\\Python38\\site-packages\\kymatio\\scattering1d\\frontend\\tensorflow_frontend.py\", line 53, in scattering  *\r\n        S = scattering1d(x, self.pad_fn, self.backend.unpad, self.backend, self.J, self.log2_T, self.psi1_f, self.psi2_f,\r\n    File \"C:\\Users\\xwb18152\\AppData\\Roaming\\Python\\Python38\\site-packages\\kymatio\\scattering1d\\core\\scattering1d.py\", line 76, in scattering1d  *\r\n        U_0 = pad_fn(x)\r\n    File \"C:\\Users\\xwb18152\\AppData\\Roaming\\Python\\Python38\\site-packages\\kymatio\\scattering1d\\frontend\\base_frontend.py\", line 80, in pad_fn  *\r\n        self.pad_mode)\r\n    File \"C:\\Users\\xwb18152\\AppData\\Roaming\\Python\\Python38\\site-packages\\kymatio\\scattering1d\\backend\\tensorflow_backend.py\", line 71, in pad  *\r\n        return agnostic.pad(x, pad_left, pad_right, pad_mode, axis=axis)\r\n    File \"C:\\Users\\xwb18152\\AppData\\Roaming\\Python\\Python38\\site-packages\\kymatio\\scattering1d\\backend\\agnostic_backend.py\", line 36, in pad  *\r\n        axis_idx = axis if axis >= 0 else (x.ndim + axis)\r\n\r\n    AttributeError: 'Tensor' object has no attribute 'ndim'\r\n\r\n\r\nCall arguments received:\r\n  â€¢ x=tf.Tensor(shape=(None, 4194304), dtype=float32)\r\n```\r\n\r\nI'm not sure why this is the case. I am running Python 3.8.2 [MSC v.1916 64 bit (AMD64)] on win32. Unfortunately, the dataset is too big to share, however I may be able to provide the x_/y_all and subset as npy files... Below is the code I am using:\r\n\r\n```python\r\nimport tensorflow.compat.v2 as tf\r\nimport numpy as np\r\nimport pandas as pd\r\nimport os\r\nfrom random import shuffle\r\nimport scipy.io.wavfile\r\nfrom pathlib import Path\r\nfrom scipy import signal\r\nfrom scipy.signal import butter, sosfilt, sosfreqz\r\nimport librosa\r\nfrom sklearn.model_selection import train_test_split\r\nimport matplotlib.pyplot as plt\r\nfrom tensorflow.keras import layers\r\nfrom kymatio.keras import Scattering1D\r\n# from sys import getsizeof\r\n\r\ntf.enable_v2_behavior()\r\n\r\n# Set seed for reproducibility\r\nSEED = 42\r\nnp.random.seed(SEED)\r\n\r\n# We now loop through all recording samples for each movement\r\n# to add to dataset (x/y_all)\r\nmovements = 'xyz xy xz x yz y z'.split() # 'xyz xy xz x yz y z'.split()\r\nmovements_dict = dict(zip(movements, [7, 4, 5, 1, 6, 2, 3]))\r\n\r\nlen_max_files = 0.4\r\nlen_files = 0\r\nfor m in movements:\r\n\tfiles = [fle for fle in os.listdir(f'D:/rf_recordings/move_{m}') if fle.endswith('.wav') and fle.split('_')[3] == '1']\r\n\tlen_files += int(len(files) * len_max_files)\r\n\r\n# len([fle for fle in os.listdir(f'D:/rf_recordings/') if fle.endswith('.wav') and fle.split('_')[3] == '1'])\r\nprint(len_files)\r\n\r\n# Our sampling rate is 2MHz, so a T value of 2**22=~4.2MHz\r\n# corresponds to just over 2s (our samples are pretty much\r\n# all 2s so we could pad...)\r\nT = 2**22\r\n\r\nJ = 6\r\nQ = 16\r\nlog_eps = 1e-6\r\n\r\nx_all = np.zeros((len_files, T))\r\ny_all = np.zeros(len_files, dtype=np.uint8)\r\nsubset = np.zeros(len_files, dtype=np.uint8)\r\n\r\nprint('Reading in movement signals')\r\nfor m in movements:\r\n\tprint(m)\r\n\tfiles = [fle for fle in os.listdir(f'D:/rf_recordings/move_{m}') if fle.endswith('.wav') and fle.split('_')[3] == '1']\r\n\tshuffle(files)\r\n\tfiles = files[int(len(files) * len_max_files):]\r\n\r\n\tratio = int(len(files)*0.2)\r\n\ttrain_files = files[ratio:]\r\n\ttest_files = files[:ratio]\r\n\r\n\t# print(train_files, len(test_files))\r\n\r\n\tfor k, filename in enumerate(files):\r\n\t\tname = filename.split('_')\r\n\t\tmovedist = name[3]\r\n\t\tspeed = name[5]\r\n\t\ty = movements_dict[m]\r\n\r\n\t\tif filename in train_files:\r\n\t\t\tsubset[k] = 0\r\n\t\telse:\r\n\t\t\tsubset[k] = 1\r\n\r\n\t\t# Read in the sample WAV file\r\n\t\tfs, x = scipy.io.wavfile.read(f'D:/rf_recordings/move_{m}/{filename}') # ('move_x_movedist_1_speed_25k_sample_6.wav') #\r\n\r\n\t\t# y = movements_dict[m] # keep as m for now but we will have to do this with params also later.\r\n\t\t# We convert to mono by averaging the left and right channels.\r\n\t\tx = np.mean(x, axis=1)\r\n\t\tx = np.asarray(x, dtype='float') # np.float32)\r\n\t\t# Once the recording is in memory, we normalise it to +1/-1\r\n\t\t# x = x / np.max(np.abs(x))\r\n\t\tx /= np.max(np.abs(x))\r\n\r\n\t\t## Pad signal to T\r\n\t\tx_pad = librosa.util.fix_length(x, size=T)\r\n\t\t# print(x.shape, x_pad.shape)\r\n\r\n\t\t# If it's too long, truncate it.\r\n\t\tif len(x) > T:\r\n\t\t\tx = x[:T]\r\n\t\t# If it's too short, zero-pad it.\r\n\t\tstart = (T - len(x)) // 2\r\n\r\n\t\tx_all[k, start:start+len(x)] = x\r\n\t\ty_all[k] = y\r\n\r\n\t\t# ## The signal is now zero-padded with shape (4194304,)\r\n\t\t# Sx = scattering(x_pad)\r\n\t\t# meta = scattering.meta()\r\n\t\t# order0 = np.where(meta['order'] == 0)\r\n\t\t# order1 = np.where(meta['order'] == 1)\r\n\t\t# order2 = np.where(meta['order'] == 2)\r\n\t\t#\r\n\t\t# plt.figure(figsize=(8, 8))\r\n\t\t# plt.subplot(3, 1, 1)\r\n\t\t# plt.plot(Sx[order0][0])\r\n\t\t# plt.title('Zeroth-order scattering')\r\n\t\t# plt.subplot(3, 1, 2)\r\n\t\t# plt.imshow(Sx[order1], aspect='auto')\r\n\t\t# plt.title('First-order scattering')\r\n\t\t# plt.subplot(3, 1, 3)\r\n\t\t# plt.imshow(Sx[order2], aspect='auto')\r\n\t\t# plt.title('Second-order scattering')\r\n\t\t# plt.show()\r\nprint('Done reading!')\r\n\r\n\r\nx_in = layers.Input(shape=(T))\r\nx = Scattering1D(J, Q=Q)(x_in)\r\nx = layers.Lambda(lambda x: x[..., 1:, :])(x)\r\n# To increase discriminability, we take the logarithm of the scattering\r\n# coefficients (after adding a small constant to make sure nothing blows up\r\n# when scattering coefficients are close to zero). This is known as the\r\n# log-scattering transform.\r\nx = layers.Lambda(lambda x: tf.math.log(tf.abs(x) + log_eps))(x)\r\nx = layers.GlobalAveragePooling1D(data_format='channels_first')(x)\r\nx = layers.BatchNormalization(axis=1)(x)\r\nx_out = layers.Dense(10, activation='softmax')(x)\r\nmodel = tf.keras.models.Model(x_in, x_out)\r\nmodel.summary()\r\n```\r\n","closed_by":{"login":"MuawizChaudhary","id":39755015,"node_id":"MDQ6VXNlcjM5NzU1MDE1","avatar_url":"https://avatars.githubusercontent.com/u/39755015?v=4","gravatar_id":"","url":"https://api.github.com/users/MuawizChaudhary","html_url":"https://github.com/MuawizChaudhary","followers_url":"https://api.github.com/users/MuawizChaudhary/followers","following_url":"https://api.github.com/users/MuawizChaudhary/following{/other_user}","gists_url":"https://api.github.com/users/MuawizChaudhary/gists{/gist_id}","starred_url":"https://api.github.com/users/MuawizChaudhary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MuawizChaudhary/subscriptions","organizations_url":"https://api.github.com/users/MuawizChaudhary/orgs","repos_url":"https://api.github.com/users/MuawizChaudhary/repos","events_url":"https://api.github.com/users/MuawizChaudhary/events{/privacy}","received_events_url":"https://api.github.com/users/MuawizChaudhary/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/kymatio/kymatio/issues/801/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/kymatio/kymatio/issues/801/timeline","performed_via_github_app":null,"state_reason":"completed"}