{"url":"https://api.github.com/repos/Stick-To/CenterNet-tensorflow/issues/22","repository_url":"https://api.github.com/repos/Stick-To/CenterNet-tensorflow","labels_url":"https://api.github.com/repos/Stick-To/CenterNet-tensorflow/issues/22/labels{/name}","comments_url":"https://api.github.com/repos/Stick-To/CenterNet-tensorflow/issues/22/comments","events_url":"https://api.github.com/repos/Stick-To/CenterNet-tensorflow/issues/22/events","html_url":"https://github.com/Stick-To/CenterNet-tensorflow/issues/22","id":509702037,"node_id":"MDU6SXNzdWU1MDk3MDIwMzc=","number":22,"title":"SparseTensor Error! Indices are not valid (out of bounds)","user":{"login":"unlabeledData","id":15307994,"node_id":"MDQ6VXNlcjE1MzA3OTk0","avatar_url":"https://avatars.githubusercontent.com/u/15307994?v=4","gravatar_id":"","url":"https://api.github.com/users/unlabeledData","html_url":"https://github.com/unlabeledData","followers_url":"https://api.github.com/users/unlabeledData/followers","following_url":"https://api.github.com/users/unlabeledData/following{/other_user}","gists_url":"https://api.github.com/users/unlabeledData/gists{/gist_id}","starred_url":"https://api.github.com/users/unlabeledData/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/unlabeledData/subscriptions","organizations_url":"https://api.github.com/users/unlabeledData/orgs","repos_url":"https://api.github.com/users/unlabeledData/repos","events_url":"https://api.github.com/users/unlabeledData/events{/privacy}","received_events_url":"https://api.github.com/users/unlabeledData/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-10-21T02:50:07Z","updated_at":"2019-10-21T09:15:45Z","closed_at":"2019-10-21T09:15:45Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, I try your code under tensorflow 1.4 and train on COCO dataset. I met some bugs and have no idea to solve it. Could you give me a hand?\r\n\r\nIn TF 1.4, `tf.boolean_mask doesn't support axis, so I remove it.\r\nFor the same TF version reason, I use tensor.sparse_tensor_to_dense and tf.SparseTensor.\r\n\r\n>InvalidArgumentError (see above for traceback): Indices are not valid (out of bounds).  Shape: [128,128]\r\n\t [[Node: get_loss/cond_649/SparseToDense = SparseToDense[T=DT_FLOAT, Tindices=DT_INT64, validate_indices=false, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](get_loss/cond_649/strided_slice/Switch, get_loss/cond_649/SparseToDense/Switch/_15033, get_loss/cond_649/ones_like/_15035, get_loss/cond_649/SparseToDense/default_value)]]\r\n\r\nThe codes are:\r\n `        for i in range(self.num_classes):\r\n\r\n            i = tf.Print(i, [i], 'i')\r\n            exist_i = tf.equal(classid, i)\r\n            reduce_i = tf.boolean_mask(\r\n                keyp_penalty_reduce, exist_i)\r\n            reduce_i = tf.Print(\r\n                reduce_i, [tf.shape(reduce_i)], 'tf.shape(reduce_i)')\r\n            reduce_i = tf.cond(\r\n                tf.equal(tf.shape(reduce_i)[0], 0),\r\n                lambda: zero_like_keyp,\r\n                lambda: tf.expand_dims(\r\n                    tf.reduce_max(reduce_i, axis=0), axis=-1)\r\n            )\r\n            reduction.append(reduce_i)\r\n\r\n            gbbox_yx_i = tf.boolean_mask(gbbox_yx, exist_i)\r\n            gbbox_yx_i = tf.Print(\r\n                gbbox_yx_i, [tf.shape(gbbox_yx_i)], 'tf.shape(gbbox_yx_i)')\r\n            pshape = tf.to_int64(pshape)\r\n\r\n            gt_keypoints_i = tf.cond(\r\n                tf.equal(tf.shape(gbbox_yx_i)[0], 0),\r\n                lambda: zero_like_keyp,\r\n                lambda: tf.expand_dims(tf.sparse_tensor_to_dense(tf.SparseTensor(gbbox_yx_i, tf.ones_like(\r\n                    gbbox_yx_i[..., 0], tf.float32), dense_shape=pshape), validate_indices=False), axis=-1)\r\n                # sparse_to_dense version\r\n            )\r\n            gt_keypoints.append(gt_keypoints_i)`\r\n\r\n","closed_by":{"login":"unlabeledData","id":15307994,"node_id":"MDQ6VXNlcjE1MzA3OTk0","avatar_url":"https://avatars.githubusercontent.com/u/15307994?v=4","gravatar_id":"","url":"https://api.github.com/users/unlabeledData","html_url":"https://github.com/unlabeledData","followers_url":"https://api.github.com/users/unlabeledData/followers","following_url":"https://api.github.com/users/unlabeledData/following{/other_user}","gists_url":"https://api.github.com/users/unlabeledData/gists{/gist_id}","starred_url":"https://api.github.com/users/unlabeledData/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/unlabeledData/subscriptions","organizations_url":"https://api.github.com/users/unlabeledData/orgs","repos_url":"https://api.github.com/users/unlabeledData/repos","events_url":"https://api.github.com/users/unlabeledData/events{/privacy}","received_events_url":"https://api.github.com/users/unlabeledData/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Stick-To/CenterNet-tensorflow/issues/22/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Stick-To/CenterNet-tensorflow/issues/22/timeline","performed_via_github_app":null,"state_reason":"completed"}