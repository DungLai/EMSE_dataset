[{"id":6907004429,"node_id":"MEE_lADOCQmIhc5M3DkmzwAAAAGbsIYN","url":"https://api.github.com/repos/google-research/google-research/issues/events/6907004429","actor":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-06-30T02:34:05Z","performed_via_github_app":null},{"id":6907004433,"node_id":"SE_lADOCQmIhc5M3DkmzwAAAAGbsIYR","url":"https://api.github.com/repos/google-research/google-research/issues/events/6907004433","actor":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-06-30T02:34:05Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170799874","html_url":"https://github.com/google-research/google-research/issues/1187#issuecomment-1170799874","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1187","id":1170799874,"node_id":"IC_kwDOCQmIhc5FyP0C","user":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false},"created_at":"2022-06-30T05:59:41Z","updated_at":"2022-06-30T05:59:41Z","author_association":"CONTRIBUTOR","body":"Hi!\r\nDoes it still run out of memory if the batch size  is reduced\r\n(maybe try batch size of 1 as a test).\r\n\r\nViT Large experiments have high accelerator memory requirement.\r\nIn my experience the peak memory usage happens during the forward pass as the activations are stored.\r\n(activations are the outputs of each layer that is stored to compute gradients during backward pass).\r\nThe first dimension of the activations is the batch size, so if you reduce the batch size you may be able to run this experiment on hardware with smaller accelerator memory.\r\n\r\nFor example, as described in the paper, the first segment of ViT/L experiment was run on TPUv3 that provides ~16GB per core, for this part of the training batch size was set to 32 (higher values would OOM).\r\nThe rest of the experiment was run on TPUv4 that provides ~32GB per mega-core, that allowed to increase batch size to 64.\r\nKeep in mind that experiments with smaller batch size will take more time to complete.\r\n\r\nThanks for asking this question that can be useful also for other users!\r\nLet me know if you have any other question.\r\n","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170799874/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170817885","html_url":"https://github.com/google-research/google-research/issues/1187#issuecomment-1170817885","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1187","id":1170817885,"node_id":"IC_kwDOCQmIhc5FyUNd","user":{"login":"adamantboy","id":20296728,"node_id":"MDQ6VXNlcjIwMjk2NzI4","avatar_url":"https://avatars.githubusercontent.com/u/20296728?v=4","gravatar_id":"","url":"https://api.github.com/users/adamantboy","html_url":"https://github.com/adamantboy","followers_url":"https://api.github.com/users/adamantboy/followers","following_url":"https://api.github.com/users/adamantboy/following{/other_user}","gists_url":"https://api.github.com/users/adamantboy/gists{/gist_id}","starred_url":"https://api.github.com/users/adamantboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamantboy/subscriptions","organizations_url":"https://api.github.com/users/adamantboy/orgs","repos_url":"https://api.github.com/users/adamantboy/repos","events_url":"https://api.github.com/users/adamantboy/events{/privacy}","received_events_url":"https://api.github.com/users/adamantboy/received_events","type":"User","site_admin":false},"created_at":"2022-06-30T06:26:47Z","updated_at":"2022-06-30T06:45:00Z","author_association":"NONE","body":"> Hi! Does it still run out of memory if the batch size is reduced (maybe try batch size of 1 as a test).\r\n> \r\n> ViT Large experiments have high accelerator memory requirement. In my experience the peak memory usage happens during the forward pass as the activations are stored. (activations are the outputs of each layer that is stored to compute gradients during backward pass). The first dimension of the activations is the batch size, so if you reduce the batch size you may be able to run this experiment on hardware with smaller accelerator memory.\r\n> \r\n> For example, as described in the paper, the first segment of ViT/L experiment was run on TPUv3 that provides ~16GB per core, for this part of the training batch size was set to 32 (higher values would OOM). The rest of the experiment was run on TPUv4 that provides ~32GB per mega-core, that allowed to increase batch size to 64. Keep in mind that experiments with smaller batch size will take more time to complete.\r\n> \r\n> Thanks for asking this question that can be useful also for other users! Let me know if you have any other question.\r\n\r\nThank you for your immediate reply.\r\nIt's very slow when the batch size was set to 2, spent 5 hours on one generation, but it could run indeed.I used 8 A100 gpus, 80GB per gpu. Your total TPUv4 memory is 2048GB(32GBX64 megacore), my total A100 memory is 640GB(80GBX8).I'm confused about the memory number one train_step compiled can use  in your experiment, 32GB or 2048GB?.If it was 32GB, then my 80GB is sufficient, otherwise it's not enough.","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170817885/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adamantboy","id":20296728,"node_id":"MDQ6VXNlcjIwMjk2NzI4","avatar_url":"https://avatars.githubusercontent.com/u/20296728?v=4","gravatar_id":"","url":"https://api.github.com/users/adamantboy","html_url":"https://github.com/adamantboy","followers_url":"https://api.github.com/users/adamantboy/followers","following_url":"https://api.github.com/users/adamantboy/following{/other_user}","gists_url":"https://api.github.com/users/adamantboy/gists{/gist_id}","starred_url":"https://api.github.com/users/adamantboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamantboy/subscriptions","organizations_url":"https://api.github.com/users/adamantboy/orgs","repos_url":"https://api.github.com/users/adamantboy/repos","events_url":"https://api.github.com/users/adamantboy/events{/privacy}","received_events_url":"https://api.github.com/users/adamantboy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170828017","html_url":"https://github.com/google-research/google-research/issues/1187#issuecomment-1170828017","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1187","id":1170828017,"node_id":"IC_kwDOCQmIhc5FyWrx","user":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false},"created_at":"2022-06-30T06:40:30Z","updated_at":"2022-06-30T06:40:30Z","author_association":"CONTRIBUTOR","body":"oh ok, 80G should be enough.\r\nHow long does it take to OOM?\r\nFor example, does it crash at the very first train step?","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170828017/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170834632","html_url":"https://github.com/google-research/google-research/issues/1187#issuecomment-1170834632","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1187","id":1170834632,"node_id":"IC_kwDOCQmIhc5FyYTI","user":{"login":"adamantboy","id":20296728,"node_id":"MDQ6VXNlcjIwMjk2NzI4","avatar_url":"https://avatars.githubusercontent.com/u/20296728?v=4","gravatar_id":"","url":"https://api.github.com/users/adamantboy","html_url":"https://github.com/adamantboy","followers_url":"https://api.github.com/users/adamantboy/followers","following_url":"https://api.github.com/users/adamantboy/following{/other_user}","gists_url":"https://api.github.com/users/adamantboy/gists{/gist_id}","starred_url":"https://api.github.com/users/adamantboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamantboy/subscriptions","organizations_url":"https://api.github.com/users/adamantboy/orgs","repos_url":"https://api.github.com/users/adamantboy/repos","events_url":"https://api.github.com/users/adamantboy/events{/privacy}","received_events_url":"https://api.github.com/users/adamantboy/received_events","type":"User","site_admin":false},"created_at":"2022-06-30T06:49:13Z","updated_at":"2022-06-30T07:10:12Z","author_association":"NONE","body":"> oh ok, 80G should be enough. How long does it take to OOM? For example, does it crash at the very first train step?\r\n\r\nyes, it crashes at first train step when the batch size is big.It's weird that it wants to preallocate 100GB+ memory.","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170834632/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adamantboy","id":20296728,"node_id":"MDQ6VXNlcjIwMjk2NzI4","avatar_url":"https://avatars.githubusercontent.com/u/20296728?v=4","gravatar_id":"","url":"https://api.github.com/users/adamantboy","html_url":"https://github.com/adamantboy","followers_url":"https://api.github.com/users/adamantboy/followers","following_url":"https://api.github.com/users/adamantboy/following{/other_user}","gists_url":"https://api.github.com/users/adamantboy/gists{/gist_id}","starred_url":"https://api.github.com/users/adamantboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamantboy/subscriptions","organizations_url":"https://api.github.com/users/adamantboy/orgs","repos_url":"https://api.github.com/users/adamantboy/repos","events_url":"https://api.github.com/users/adamantboy/events{/privacy}","received_events_url":"https://api.github.com/users/adamantboy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170861875","html_url":"https://github.com/google-research/google-research/issues/1187#issuecomment-1170861875","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1187","id":1170861875,"node_id":"IC_kwDOCQmIhc5Fye8z","user":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false},"created_at":"2022-06-30T07:23:25Z","updated_at":"2022-06-30T07:23:25Z","author_association":"CONTRIBUTOR","body":"Could you try to add this function to the colab\r\n```\r\ndef delete_live_buffers():\r\n  for device in jax.local_devices():\r\n    lbs = device.live_buffers()\r\n    for lb in lbs:\r\n      lb.delete()\r\n```\r\n\r\nand add a call to it just before each call to\r\n```\r\ngc.collect()\r\n```\r\n\r\nAnd check if this allows you to increase the batch size to 4 or higher.\r\nIf not would be interesting to know if you see the same error or a different one.","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170861875/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170915826","html_url":"https://github.com/google-research/google-research/issues/1187#issuecomment-1170915826","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1187","id":1170915826,"node_id":"IC_kwDOCQmIhc5FysHy","user":{"login":"adamantboy","id":20296728,"node_id":"MDQ6VXNlcjIwMjk2NzI4","avatar_url":"https://avatars.githubusercontent.com/u/20296728?v=4","gravatar_id":"","url":"https://api.github.com/users/adamantboy","html_url":"https://github.com/adamantboy","followers_url":"https://api.github.com/users/adamantboy/followers","following_url":"https://api.github.com/users/adamantboy/following{/other_user}","gists_url":"https://api.github.com/users/adamantboy/gists{/gist_id}","starred_url":"https://api.github.com/users/adamantboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamantboy/subscriptions","organizations_url":"https://api.github.com/users/adamantboy/orgs","repos_url":"https://api.github.com/users/adamantboy/repos","events_url":"https://api.github.com/users/adamantboy/events{/privacy}","received_events_url":"https://api.github.com/users/adamantboy/received_events","type":"User","site_admin":false},"created_at":"2022-06-30T08:20:55Z","updated_at":"2022-06-30T08:20:55Z","author_association":"NONE","body":"> Could you try to add this function to the colab\r\n> \r\n> ```\r\n> def delete_live_buffers():\r\n>   for device in jax.local_devices():\r\n>     lbs = device.live_buffers()\r\n>     for lb in lbs:\r\n>       lb.delete()\r\n> ```\r\n> \r\n> and add a call to it just before each call to\r\n> \r\n> ```\r\n> gc.collect()\r\n> ```\r\n> \r\n> And check if this allows you to increase the batch size to 4 or higher. If not would be interesting to know if you see the same error or a different one.\r\n\r\nI tried it. The error is same, but the memory preallocated is reduced to 70-90GB when the batch size is 64 indeed.And the batch size can be set to 4 with no OOM error.\r\n\r\n- Error message, batch size 64:\r\n```bash\r\n2022-06-30 15:50:02.179408: W external/org_tensorflow/tensorflow/core/common_runtime/bfc_allocator.cc:479] Allocator (GPU_3_bfc) ran out of memory trying to allocate 74.65GiB (rounded to 80159329536)requested by op \r\n2022-06-30 15:50:06.549646: W external/org_tensorflow/tensorflow/core/common_runtime/bfc_allocator.cc:491] ***_________________________________________________________________________________________________\r\n2022-06-30 15:50:33.277741: E external/org_tensorflow/tensorflow/compiler/xla/pjrt/pjrt_stream_executor_client.cc:2141] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 80159329472 bytes.\r\nBufferAssignment OOM Debugging.\r\nBufferAssignment stats:\r\n             parameter allocation:    1.33GiB\r\n              constant allocation:         8B\r\n        maybe_live_out allocation:  288.38MiB\r\n     preallocated temp allocation:   74.65GiB\r\n  preallocated temp fragmentation:       212B (0.00%)\r\n                 total allocation:   75.98GiB\r\n              total fragmentation:    19.2KiB (0.00%)\r\nPeak buffers:\r\n        Buffer 1:\r\n                Size: 1.27GiB\r\n                XLA Label: custom-call\r\n                Shape: f32[64,16,577,577]\r\n                ==========================\r\n\r\n        Buffer 2:\r\n                Size: 1.27GiB\r\n                XLA Label: custom-call\r\n                Shape: f32[64,16,577,577]\r\n                ==========================\r\n```","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170915826/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adamantboy","id":20296728,"node_id":"MDQ6VXNlcjIwMjk2NzI4","avatar_url":"https://avatars.githubusercontent.com/u/20296728?v=4","gravatar_id":"","url":"https://api.github.com/users/adamantboy","html_url":"https://github.com/adamantboy","followers_url":"https://api.github.com/users/adamantboy/followers","following_url":"https://api.github.com/users/adamantboy/following{/other_user}","gists_url":"https://api.github.com/users/adamantboy/gists{/gist_id}","starred_url":"https://api.github.com/users/adamantboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamantboy/subscriptions","organizations_url":"https://api.github.com/users/adamantboy/orgs","repos_url":"https://api.github.com/users/adamantboy/repos","events_url":"https://api.github.com/users/adamantboy/events{/privacy}","received_events_url":"https://api.github.com/users/adamantboy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170940234","html_url":"https://github.com/google-research/google-research/issues/1187#issuecomment-1170940234","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1187","id":1170940234,"node_id":"IC_kwDOCQmIhc5FyyFK","user":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false},"created_at":"2022-06-30T08:44:38Z","updated_at":"2022-06-30T08:44:38Z","author_association":"CONTRIBUTOR","body":"oh great,\nthen I'll add that function in the colab.\nWhat's the highest batch size you can reach now?\n\n\nOn Thu, Jun 30, 2022 at 10:21 AM adamantboy ***@***.***>\nwrote:\n\n> Could you try to add this function to the colab\n>\n> def delete_live_buffers():\n>   for device in jax.local_devices():\n>     lbs = device.live_buffers()\n>     for lb in lbs:\n>       lb.delete()\n>\n> and add a call to it just before each call to\n>\n> gc.collect()\n>\n> And check if this allows you to increase the batch size to 4 or higher. If\n> not would be interesting to know if you see the same error or a different\n> one.\n>\n> I tried it. The error is same, but the memory preallocated is reduced to\n> 70-90GB when the batch size is 64 indeed.And the batch size can be set to 4\n> with no OOM error.\n>\n>    - Error message, batch size 64:\n>\n> 2022-06-30 15:50:02.179408: W external/org_tensorflow/tensorflow/core/common_runtime/bfc_allocator.cc:479] Allocator (GPU_3_bfc) ran out of memory trying to allocate 74.65GiB (rounded to 80159329536)requested by op\n> 2022-06-30 15:50:06.549646: W external/org_tensorflow/tensorflow/core/common_runtime/bfc_allocator.cc:491] ***_________________________________________________________________________________________________\n> 2022-06-30 15:50:33.277741: E external/org_tensorflow/tensorflow/compiler/xla/pjrt/pjrt_stream_executor_client.cc:2141] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 80159329472 bytes.\n> BufferAssignment OOM Debugging.\n> BufferAssignment stats:\n>              parameter allocation:    1.33GiB\n>               constant allocation:         8B\n>         maybe_live_out allocation:  288.38MiB\n>      preallocated temp allocation:   74.65GiB\n>   preallocated temp fragmentation:       212B (0.00%)\n>                  total allocation:   75.98GiB\n>               total fragmentation:    19.2KiB (0.00%)\n> Peak buffers:\n>         Buffer 1:\n>                 Size: 1.27GiB\n>                 XLA Label: custom-call\n>                 Shape: f32[64,16,577,577]\n>                 ==========================\n>\n>         Buffer 2:\n>                 Size: 1.27GiB\n>                 XLA Label: custom-call\n>                 Shape: f32[64,16,577,577]\n>                 ==========================\n>\n> —\n> Reply to this email directly, view it on GitHub\n> <https://github.com/google-research/google-research/issues/1187#issuecomment-1170915826>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AADGZ5CBMDIRMRYMVQXC3Y3VRVKHTANCNFSM52HXRSJA>\n> .\n> You are receiving this because you were mentioned.Message ID:\n> ***@***.***>\n>\n","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170940234/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170953598","html_url":"https://github.com/google-research/google-research/issues/1187#issuecomment-1170953598","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1187","id":1170953598,"node_id":"IC_kwDOCQmIhc5Fy1V-","user":{"login":"adamantboy","id":20296728,"node_id":"MDQ6VXNlcjIwMjk2NzI4","avatar_url":"https://avatars.githubusercontent.com/u/20296728?v=4","gravatar_id":"","url":"https://api.github.com/users/adamantboy","html_url":"https://github.com/adamantboy","followers_url":"https://api.github.com/users/adamantboy/followers","following_url":"https://api.github.com/users/adamantboy/following{/other_user}","gists_url":"https://api.github.com/users/adamantboy/gists{/gist_id}","starred_url":"https://api.github.com/users/adamantboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamantboy/subscriptions","organizations_url":"https://api.github.com/users/adamantboy/orgs","repos_url":"https://api.github.com/users/adamantboy/repos","events_url":"https://api.github.com/users/adamantboy/events{/privacy}","received_events_url":"https://api.github.com/users/adamantboy/received_events","type":"User","site_admin":false},"created_at":"2022-06-30T08:57:33Z","updated_at":"2022-07-01T02:23:40Z","author_association":"NONE","body":"> oh great, then I'll add that function in the colab. What's the highest batch size you can reach now?\r\n> […](#)\r\n> On Thu, Jun 30, 2022 at 10:21 AM adamantboy ***@***.***> wrote: Could you try to add this function to the colab def delete_live_buffers(): for device in jax.local_devices(): lbs = device.live_buffers() for lb in lbs: lb.delete() and add a call to it just before each call to gc.collect() And check if this allows you to increase the batch size to 4 or higher. If not would be interesting to know if you see the same error or a different one. I tried it. The error is same, but the memory preallocated is reduced to 70-90GB when the batch size is 64 indeed.And the batch size can be set to 4 with no OOM error. - Error message, batch size 64: 2022-06-30 15:50:02.179408: W external/org_tensorflow/tensorflow/core/common_runtime/bfc_allocator.cc:479] Allocator (GPU_3_bfc) ran out of memory trying to allocate 74.65GiB (rounded to 80159329536)requested by op 2022-06-30 15:50:06.549646: W external/org_tensorflow/tensorflow/core/common_runtime/bfc_allocator.cc:491] ***_________________________________________________________________________________________________ 2022-06-30 15:50:33.277741: E external/org_tensorflow/tensorflow/compiler/xla/pjrt/pjrt_stream_executor_client.cc:2141] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 80159329472 bytes. BufferAssignment OOM Debugging. BufferAssignment stats: parameter allocation: 1.33GiB constant allocation: 8B maybe_live_out allocation: 288.38MiB preallocated temp allocation: 74.65GiB preallocated temp fragmentation: 212B (0.00%) total allocation: 75.98GiB total fragmentation: 19.2KiB (0.00%) Peak buffers: Buffer 1: Size: 1.27GiB XLA Label: custom-call Shape: f32[64,16,577,577] ========================== Buffer 2: Size: 1.27GiB XLA Label: custom-call Shape: f32[64,16,577,577] ========================== — Reply to this email directly, view it on GitHub <[#1187 (comment)](https://github.com/google-research/google-research/issues/1187#issuecomment-1170915826)>, or unsubscribe <https://github.com/notifications/unsubscribe-auth/AADGZ5CBMDIRMRYMVQXC3Y3VRVKHTANCNFSM52HXRSJA> . You are receiving this because you were mentioned.Message ID: ***@***.***>\r\n\r\nMy highest batch size is 32.My time cost of one generation is 9 hours, is it normal?\r\n```bash\r\ntime    LOOP    COMPevl  COMPtrn   PREP    TRN+EVL    1stEVAL\r\n(s)     91.7    189.5    635.2     32.2    33853.0    123.8\r\n```\r\nI'm still confused.Your total TPUv4 memory is 2048GB(32GBX64 megacore), my total A100 memory is 640GB(80GBX8).I'm confused about the memory number one train_step compiled can use in your experiment, 32GB or 2048GB?.If it was 32GB, then my 80GB is sufficient but why is my batch size smaller then 64, otherwise my memory is not enough to use batch size 64.","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1170953598/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adamantboy","id":20296728,"node_id":"MDQ6VXNlcjIwMjk2NzI4","avatar_url":"https://avatars.githubusercontent.com/u/20296728?v=4","gravatar_id":"","url":"https://api.github.com/users/adamantboy","html_url":"https://github.com/adamantboy","followers_url":"https://api.github.com/users/adamantboy/followers","following_url":"https://api.github.com/users/adamantboy/following{/other_user}","gists_url":"https://api.github.com/users/adamantboy/gists{/gist_id}","starred_url":"https://api.github.com/users/adamantboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamantboy/subscriptions","organizations_url":"https://api.github.com/users/adamantboy/orgs","repos_url":"https://api.github.com/users/adamantboy/repos","events_url":"https://api.github.com/users/adamantboy/events{/privacy}","received_events_url":"https://api.github.com/users/adamantboy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1172666350","html_url":"https://github.com/google-research/google-research/issues/1187#issuecomment-1172666350","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1187","id":1172666350,"node_id":"IC_kwDOCQmIhc5F5Xfu","user":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false},"created_at":"2022-07-01T19:47:33Z","updated_at":"2022-07-01T19:47:33Z","author_association":"CONTRIBUTOR","body":"regarding the def \"delete_live_buffers()\" method.\ncould you confirm that it helps reducing the memory usage?\nin the case I'll commit that change also to the published code.\nThanks!\n\nOn Thu, Jun 30, 2022 at 11:28 AM Andrea Gesmundo ***@***.***>\nwrote:\n\n> Each sampled path is trained on a distinct core, so all the parameters and\n> activations of a path need to fit in the memory of 1 \"core\".\n> Each core trains in parallel on the same batch of data.\n> FYI the TPUv4 experiments were using 32 megacores each having ~32G (not 64)\n> Yes I'm not sure why it wouldn't fit in 80G if it fits on 32G in my\n> experiments\n> A single A100 machine has 80G but how many cores are on 1 machine? (I\n> think we are assuming there is only 1 core per machine but maybe it is\n> more, e.g. if there are 4 cores then each core can use only 80/4=20G of\n> memory)\n>\n>\n> On Thu, Jun 30, 2022 at 10:57 AM adamantboy ***@***.***>\n> wrote:\n>\n>> oh great, then I'll add that function in the colab. What's the highest\n>> batch size you can reach now?\n>> … <#m_9119296503949766251_m_6047855296256924580_>\n>> On Thu, Jun 30, 2022 at 10:21 AM adamantboy *@*.***> wrote: Could you\n>> try to add this function to the colab def delete_live_buffers(): for device\n>> in jax.local_devices(): lbs = device.live_buffers() for lb in lbs:\n>> lb.delete() and add a call to it just before each call to gc.collect() And\n>> check if this allows you to increase the batch size to 4 or higher. If not\n>> would be interesting to know if you see the same error or a different one.\n>> I tried it. The error is same, but the memory preallocated is reduced to\n>> 70-90GB when the batch size is 64 indeed.And the batch size can be set to 4\n>> with no OOM error. - Error message, batch size 64: 2022-06-30\n>> 15:50:02.179408: W\n>> external/org_tensorflow/tensorflow/core/common_runtime/bfc_allocator.cc:479]\n>> Allocator (GPU_3_bfc) ran out of memory trying to allocate 74.65GiB\n>> (rounded to 80159329536)requested by op 2022-06-30 15:50:06.549646: W\n>> external/org_tensorflow/tensorflow/core/common_runtime/bfc_allocator.cc:491]\n>> *_________________________________________________________________________________________________\n>> 2022-06-30 15:50:33.277741: E\n>> external/org_tensorflow/tensorflow/compiler/xla/pjrt/pjrt_stream_executor_client.cc:2141]\n>> Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while\n>> trying to allocate 80159329472 bytes. BufferAssignment OOM Debugging.\n>> BufferAssignment stats: parameter allocation: 1.33GiB constant allocation:\n>> 8B maybe_live_out allocation: 288.38MiB preallocated temp allocation:\n>> 74.65GiB preallocated temp fragmentation: 212B (0.00%) total allocation:\n>> 75.98GiB total fragmentation: 19.2KiB (0.00%) Peak buffers: Buffer 1: Size:\n>> 1.27GiB XLA Label: custom-call Shape: f32[64,16,577,577]\n>> ========================== Buffer 2: Size: 1.27GiB XLA Label: custom-call\n>> Shape: f32[64,16,577,577] ========================== — Reply to this email\n>> directly, view it on GitHub <#1187 (comment)\n>> <https://github.com/google-research/google-research/issues/1187#issuecomment-1170915826>>,\n>> or unsubscribe\n>> https://github.com/notifications/unsubscribe-auth/AADGZ5CBMDIRMRYMVQXC3Y3VRVKHTANCNFSM52HXRSJA\n>> <https://github.com/notifications/unsubscribe-auth/AADGZ5CBMDIRMRYMVQXC3Y3VRVKHTANCNFSM52HXRSJA>\n>> . You are receiving this because you were mentioned.Message ID: @.*>\n>>\n>> I'm still confused.\n>> Your total TPUv4 memory is 2048GB(32GBX64 megacore), my total A100 memory\n>> is 640GB(80GBX8).I'm confused about the memory number one train_step\n>> compiled can use in your experiment, 32GB or 2048GB?.If it was 32GB, then\n>> my 80GB is sufficient but why my batch size is smaller then 64, otherwise\n>> it's not enough.\n>>\n>> —\n>> Reply to this email directly, view it on GitHub\n>> <https://github.com/google-research/google-research/issues/1187#issuecomment-1170953598>,\n>> or unsubscribe\n>> <https://github.com/notifications/unsubscribe-auth/AADGZ5DRQZ7ZCOXN2B77ZD3VRVOQXANCNFSM52HXRSJA>\n>> .\n>> You are receiving this because you were mentioned.Message ID:\n>> ***@***.***>\n>>\n>\n","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1172666350/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1172668908","html_url":"https://github.com/google-research/google-research/issues/1187#issuecomment-1172668908","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1187","id":1172668908,"node_id":"IC_kwDOCQmIhc5F5YHs","user":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false},"created_at":"2022-07-01T19:52:31Z","updated_at":"2022-07-01T19:52:31Z","author_association":"CONTRIBUTOR","body":"Also FYI\nGoogle can give free access to TPUs for research if you are interested.\nYou can find more information and apply here in the case you are interested:\nhttps://sites.research.google/trc/about/\nI'm not very familiar with the process but let me know if I can help.\n\n\nOn Fri, Jul 1, 2022 at 9:47 PM Andrea Gesmundo ***@***.***> wrote:\n\n> regarding the def \"delete_live_buffers()\" method.\n> could you confirm that it helps reducing the memory usage?\n> in the case I'll commit that change also to the published code.\n> Thanks!\n>\n> On Thu, Jun 30, 2022 at 11:28 AM Andrea Gesmundo ***@***.***>\n> wrote:\n>\n>> Each sampled path is trained on a distinct core, so all the parameters\n>> and activations of a path need to fit in the memory of 1 \"core\".\n>> Each core trains in parallel on the same batch of data.\n>> FYI the TPUv4 experiments were using 32 megacores each having ~32G (not\n>> 64)\n>> Yes I'm not sure why it wouldn't fit in 80G if it fits on 32G in my\n>> experiments\n>> A single A100 machine has 80G but how many cores are on 1 machine? (I\n>> think we are assuming there is only 1 core per machine but maybe it is\n>> more, e.g. if there are 4 cores then each core can use only 80/4=20G of\n>> memory)\n>>\n>>\n>> On Thu, Jun 30, 2022 at 10:57 AM adamantboy ***@***.***>\n>> wrote:\n>>\n>>> oh great, then I'll add that function in the colab. What's the highest\n>>> batch size you can reach now?\n>>> … <#m_-1470306883118412883_m_9119296503949766251_m_6047855296256924580_>\n>>> On Thu, Jun 30, 2022 at 10:21 AM adamantboy *@*.***> wrote: Could you\n>>> try to add this function to the colab def delete_live_buffers(): for device\n>>> in jax.local_devices(): lbs = device.live_buffers() for lb in lbs:\n>>> lb.delete() and add a call to it just before each call to gc.collect() And\n>>> check if this allows you to increase the batch size to 4 or higher. If not\n>>> would be interesting to know if you see the same error or a different one.\n>>> I tried it. The error is same, but the memory preallocated is reduced to\n>>> 70-90GB when the batch size is 64 indeed.And the batch size can be set to 4\n>>> with no OOM error. - Error message, batch size 64: 2022-06-30\n>>> 15:50:02.179408: W\n>>> external/org_tensorflow/tensorflow/core/common_runtime/bfc_allocator.cc:479]\n>>> Allocator (GPU_3_bfc) ran out of memory trying to allocate 74.65GiB\n>>> (rounded to 80159329536)requested by op 2022-06-30 15:50:06.549646: W\n>>> external/org_tensorflow/tensorflow/core/common_runtime/bfc_allocator.cc:491]\n>>> *_________________________________________________________________________________________________\n>>> 2022-06-30 15:50:33.277741: E\n>>> external/org_tensorflow/tensorflow/compiler/xla/pjrt/pjrt_stream_executor_client.cc:2141]\n>>> Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while\n>>> trying to allocate 80159329472 bytes. BufferAssignment OOM Debugging.\n>>> BufferAssignment stats: parameter allocation: 1.33GiB constant allocation:\n>>> 8B maybe_live_out allocation: 288.38MiB preallocated temp allocation:\n>>> 74.65GiB preallocated temp fragmentation: 212B (0.00%) total allocation:\n>>> 75.98GiB total fragmentation: 19.2KiB (0.00%) Peak buffers: Buffer 1: Size:\n>>> 1.27GiB XLA Label: custom-call Shape: f32[64,16,577,577]\n>>> ========================== Buffer 2: Size: 1.27GiB XLA Label: custom-call\n>>> Shape: f32[64,16,577,577] ========================== — Reply to this email\n>>> directly, view it on GitHub <#1187 (comment)\n>>> <https://github.com/google-research/google-research/issues/1187#issuecomment-1170915826>>,\n>>> or unsubscribe\n>>> https://github.com/notifications/unsubscribe-auth/AADGZ5CBMDIRMRYMVQXC3Y3VRVKHTANCNFSM52HXRSJA\n>>> <https://github.com/notifications/unsubscribe-auth/AADGZ5CBMDIRMRYMVQXC3Y3VRVKHTANCNFSM52HXRSJA>\n>>> . You are receiving this because you were mentioned.Message ID: @.*>\n>>>\n>>> I'm still confused.\n>>> Your total TPUv4 memory is 2048GB(32GBX64 megacore), my total A100\n>>> memory is 640GB(80GBX8).I'm confused about the memory number one train_step\n>>> compiled can use in your experiment, 32GB or 2048GB?.If it was 32GB, then\n>>> my 80GB is sufficient but why my batch size is smaller then 64, otherwise\n>>> it's not enough.\n>>>\n>>> —\n>>> Reply to this email directly, view it on GitHub\n>>> <https://github.com/google-research/google-research/issues/1187#issuecomment-1170953598>,\n>>> or unsubscribe\n>>> <https://github.com/notifications/unsubscribe-auth/AADGZ5DRQZ7ZCOXN2B77ZD3VRVOQXANCNFSM52HXRSJA>\n>>> .\n>>> You are receiving this because you were mentioned.Message ID:\n>>> ***@***.***>\n>>>\n>>\n","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1172668908/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1173460311","html_url":"https://github.com/google-research/google-research/issues/1187#issuecomment-1173460311","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1187","id":1173460311,"node_id":"IC_kwDOCQmIhc5F8ZVX","user":{"login":"adamantboy","id":20296728,"node_id":"MDQ6VXNlcjIwMjk2NzI4","avatar_url":"https://avatars.githubusercontent.com/u/20296728?v=4","gravatar_id":"","url":"https://api.github.com/users/adamantboy","html_url":"https://github.com/adamantboy","followers_url":"https://api.github.com/users/adamantboy/followers","following_url":"https://api.github.com/users/adamantboy/following{/other_user}","gists_url":"https://api.github.com/users/adamantboy/gists{/gist_id}","starred_url":"https://api.github.com/users/adamantboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamantboy/subscriptions","organizations_url":"https://api.github.com/users/adamantboy/orgs","repos_url":"https://api.github.com/users/adamantboy/repos","events_url":"https://api.github.com/users/adamantboy/events{/privacy}","received_events_url":"https://api.github.com/users/adamantboy/received_events","type":"User","site_admin":false},"created_at":"2022-07-04T07:36:41Z","updated_at":"2022-07-04T07:36:41Z","author_association":"NONE","body":"> \r\n\r\n\r\n\r\n> regarding the def \"delete_live_buffers()\" method. could you confirm that it helps reducing the memory usage? in the case I'll commit that change also to the published code. Thanks! On Thu, Jun 30, 2022 at 11:28 AM Andrea Gesmundo ***@***.***> wrote:\r\n> […](#)\r\n> Each sampled path is trained on a distinct core, so all the parameters and activations of a path need to fit in the memory of 1 \"core\". Each core trains in parallel on the same batch of data. FYI the TPUv4 experiments were using 32 megacores each having ~32G (not 64) Yes I'm not sure why it wouldn't fit in 80G if it fits on 32G in my experiments A single A100 machine has 80G but how many cores are on 1 machine? (I think we are assuming there is only 1 core per machine but maybe it is more, e.g. if there are 4 cores then each core can use only 80/4=20G of memory) On Thu, Jun 30, 2022 at 10:57 AM adamantboy ***@***.***> wrote: > oh great, then I'll add that function in the colab. What's the highest > batch size you can reach now? > … <#m_9119296503949766251_m_6047855296256924580_> > On Thu, Jun 30, 2022 at 10:21 AM adamantboy *@*.***> wrote: Could you > try to add this function to the colab def delete_live_buffers(): for device > in jax.local_devices(): lbs = device.live_buffers() for lb in lbs: > lb.delete() and add a call to it just before each call to gc.collect() And > check if this allows you to increase the batch size to 4 or higher. If not > would be interesting to know if you see the same error or a different one. > I tried it. The error is same, but the memory preallocated is reduced to > 70-90GB when the batch size is 64 indeed.And the batch size can be set to 4 > with no OOM error. - Error message, batch size 64: 2022-06-30 > 15:50:02.179408: W > external/org_tensorflow/tensorflow/core/common_runtime/bfc_allocator.cc:479] > Allocator (GPU_3_bfc) ran out of memory trying to allocate 74.65GiB > (rounded to 80159329536)requested by op 2022-06-30 15:50:06.549646: W > external/org_tensorflow/tensorflow/core/common_runtime/bfc_allocator.cc:491] > *_________________________________________________________________________________________________ > 2022-06-30 15:50:33.277741: E > external/org_tensorflow/tensorflow/compiler/xla/pjrt/pjrt_stream_executor_client.cc:2141] > Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while > trying to allocate 80159329472 bytes. BufferAssignment OOM Debugging. > BufferAssignment stats: parameter allocation: 1.33GiB constant allocation: > 8B maybe_live_out allocation: 288.38MiB preallocated temp allocation: > 74.65GiB preallocated temp fragmentation: 212B (0.00%) total allocation: > 75.98GiB total fragmentation: 19.2KiB (0.00%) Peak buffers: Buffer 1: Size: > 1.27GiB XLA Label: custom-call Shape: f32[64,16,577,577] > ========================== Buffer 2: Size: 1.27GiB XLA Label: custom-call > Shape: f32[64,16,577,577] ========================== — Reply to this email > directly, view it on GitHub <#1187 (comment) > <[#1187 (comment)](https://github.com/google-research/google-research/issues/1187#issuecomment-1170915826)>>, > or unsubscribe > https://github.com/notifications/unsubscribe-auth/AADGZ5CBMDIRMRYMVQXC3Y3VRVKHTANCNFSM52HXRSJA > <https://github.com/notifications/unsubscribe-auth/AADGZ5CBMDIRMRYMVQXC3Y3VRVKHTANCNFSM52HXRSJA> > . You are receiving this because you were mentioned.Message ID: @.*> > > I'm still confused. > Your total TPUv4 memory is 2048GB(32GBX64 megacore), my total A100 memory > is 640GB(80GBX8).I'm confused about the memory number one train_step > compiled can use in your experiment, 32GB or 2048GB?.If it was 32GB, then > my 80GB is sufficient but why my batch size is smaller then 64, otherwise > it's not enough. > > — > Reply to this email directly, view it on GitHub > <[#1187 (comment)](https://github.com/google-research/google-research/issues/1187#issuecomment-1170953598)>, > or unsubscribe > <https://github.com/notifications/unsubscribe-auth/AADGZ5DRQZ7ZCOXN2B77ZD3VRVOQXANCNFSM52HXRSJA> > . > You are receiving this because you were mentioned.Message ID: > ***@***.***> >\r\n\r\nI trained it again with batch size 32 and no delete_live_buffers function, it could run too.","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1173460311/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adamantboy","id":20296728,"node_id":"MDQ6VXNlcjIwMjk2NzI4","avatar_url":"https://avatars.githubusercontent.com/u/20296728?v=4","gravatar_id":"","url":"https://api.github.com/users/adamantboy","html_url":"https://github.com/adamantboy","followers_url":"https://api.github.com/users/adamantboy/followers","following_url":"https://api.github.com/users/adamantboy/following{/other_user}","gists_url":"https://api.github.com/users/adamantboy/gists{/gist_id}","starred_url":"https://api.github.com/users/adamantboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamantboy/subscriptions","organizations_url":"https://api.github.com/users/adamantboy/orgs","repos_url":"https://api.github.com/users/adamantboy/repos","events_url":"https://api.github.com/users/adamantboy/events{/privacy}","received_events_url":"https://api.github.com/users/adamantboy/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1173576441","html_url":"https://github.com/google-research/google-research/issues/1187#issuecomment-1173576441","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1187","id":1173576441,"node_id":"IC_kwDOCQmIhc5F81r5","user":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false},"created_at":"2022-07-04T09:23:38Z","updated_at":"2022-07-04T09:23:38Z","author_association":"CONTRIBUTOR","body":"great! thank you for confirming!\r\nI have committed the change.","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1173576441/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1173582948","html_url":"https://github.com/google-research/google-research/issues/1187#issuecomment-1173582948","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1187","id":1173582948,"node_id":"IC_kwDOCQmIhc5F83Rk","user":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false},"created_at":"2022-07-04T09:28:57Z","updated_at":"2022-07-04T09:28:57Z","author_association":"CONTRIBUTOR","body":"oh sorry I think I mis-read you last comment.\r\nyou are saying that you don't see a positive effect from \"delete_live_buffers\" right? (so it is not needed).","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1173582948/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1173639175","html_url":"https://github.com/google-research/google-research/issues/1187#issuecomment-1173639175","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1187","id":1173639175,"node_id":"IC_kwDOCQmIhc5F9FAH","user":{"login":"adamantboy","id":20296728,"node_id":"MDQ6VXNlcjIwMjk2NzI4","avatar_url":"https://avatars.githubusercontent.com/u/20296728?v=4","gravatar_id":"","url":"https://api.github.com/users/adamantboy","html_url":"https://github.com/adamantboy","followers_url":"https://api.github.com/users/adamantboy/followers","following_url":"https://api.github.com/users/adamantboy/following{/other_user}","gists_url":"https://api.github.com/users/adamantboy/gists{/gist_id}","starred_url":"https://api.github.com/users/adamantboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamantboy/subscriptions","organizations_url":"https://api.github.com/users/adamantboy/orgs","repos_url":"https://api.github.com/users/adamantboy/repos","events_url":"https://api.github.com/users/adamantboy/events{/privacy}","received_events_url":"https://api.github.com/users/adamantboy/received_events","type":"User","site_admin":false},"created_at":"2022-07-04T10:20:56Z","updated_at":"2022-07-04T10:20:56Z","author_association":"NONE","body":"> oh sorry I think I mis-read you last comment. you are saying that you don't see a positive effect from \"delete_live_buffers\" right? (so it is not needed).\r\n\r\n\r\n\r\n> oh sorry I think I mis-read you last comment. you are saying that you don't see a positive effect from \"delete_live_buffers\" right? (so it is not needed).\r\n\r\nIt's not need, i think.","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1173639175/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adamantboy","id":20296728,"node_id":"MDQ6VXNlcjIwMjk2NzI4","avatar_url":"https://avatars.githubusercontent.com/u/20296728?v=4","gravatar_id":"","url":"https://api.github.com/users/adamantboy","html_url":"https://github.com/adamantboy","followers_url":"https://api.github.com/users/adamantboy/followers","following_url":"https://api.github.com/users/adamantboy/following{/other_user}","gists_url":"https://api.github.com/users/adamantboy/gists{/gist_id}","starred_url":"https://api.github.com/users/adamantboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamantboy/subscriptions","organizations_url":"https://api.github.com/users/adamantboy/orgs","repos_url":"https://api.github.com/users/adamantboy/repos","events_url":"https://api.github.com/users/adamantboy/events{/privacy}","received_events_url":"https://api.github.com/users/adamantboy/received_events","type":"User","site_admin":false}},{"id":6999558148,"node_id":"CE_lADOCQmIhc5M3DkmzwAAAAGhNMgE","url":"https://api.github.com/repos/google-research/google-research/issues/events/6999558148","actor":{"login":"adamantboy","id":20296728,"node_id":"MDQ6VXNlcjIwMjk2NzI4","avatar_url":"https://avatars.githubusercontent.com/u/20296728?v=4","gravatar_id":"","url":"https://api.github.com/users/adamantboy","html_url":"https://github.com/adamantboy","followers_url":"https://api.github.com/users/adamantboy/followers","following_url":"https://api.github.com/users/adamantboy/following{/other_user}","gists_url":"https://api.github.com/users/adamantboy/gists{/gist_id}","starred_url":"https://api.github.com/users/adamantboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamantboy/subscriptions","organizations_url":"https://api.github.com/users/adamantboy/orgs","repos_url":"https://api.github.com/users/adamantboy/repos","events_url":"https://api.github.com/users/adamantboy/events{/privacy}","received_events_url":"https://api.github.com/users/adamantboy/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-07-15T06:39:22Z","state_reason":null,"performed_via_github_app":null},{"id":7010456594,"node_id":"REE_lADOCQmIhc5M3DkmzwAAAAGh2xQS","url":"https://api.github.com/repos/google-research/google-research/issues/events/7010456594","actor":{"login":"adamantboy","id":20296728,"node_id":"MDQ6VXNlcjIwMjk2NzI4","avatar_url":"https://avatars.githubusercontent.com/u/20296728?v=4","gravatar_id":"","url":"https://api.github.com/users/adamantboy","html_url":"https://github.com/adamantboy","followers_url":"https://api.github.com/users/adamantboy/followers","following_url":"https://api.github.com/users/adamantboy/following{/other_user}","gists_url":"https://api.github.com/users/adamantboy/gists{/gist_id}","starred_url":"https://api.github.com/users/adamantboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamantboy/subscriptions","organizations_url":"https://api.github.com/users/adamantboy/orgs","repos_url":"https://api.github.com/users/adamantboy/repos","events_url":"https://api.github.com/users/adamantboy/events{/privacy}","received_events_url":"https://api.github.com/users/adamantboy/received_events","type":"User","site_admin":false},"event":"reopened","commit_id":null,"commit_url":null,"created_at":"2022-07-18T09:42:32Z","state_reason":"reopened","performed_via_github_app":null},{"id":7010462110,"node_id":"CE_lADOCQmIhc5M3DkmzwAAAAGh2yme","url":"https://api.github.com/repos/google-research/google-research/issues/events/7010462110","actor":{"login":"adamantboy","id":20296728,"node_id":"MDQ6VXNlcjIwMjk2NzI4","avatar_url":"https://avatars.githubusercontent.com/u/20296728?v=4","gravatar_id":"","url":"https://api.github.com/users/adamantboy","html_url":"https://github.com/adamantboy","followers_url":"https://api.github.com/users/adamantboy/followers","following_url":"https://api.github.com/users/adamantboy/following{/other_user}","gists_url":"https://api.github.com/users/adamantboy/gists{/gist_id}","starred_url":"https://api.github.com/users/adamantboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamantboy/subscriptions","organizations_url":"https://api.github.com/users/adamantboy/orgs","repos_url":"https://api.github.com/users/adamantboy/repos","events_url":"https://api.github.com/users/adamantboy/events{/privacy}","received_events_url":"https://api.github.com/users/adamantboy/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-07-18T09:43:18Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1274240924","html_url":"https://github.com/google-research/google-research/issues/1187#issuecomment-1274240924","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1187","id":1274240924,"node_id":"IC_kwDOCQmIhc5L81-c","user":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false},"created_at":"2022-10-11T07:48:16Z","updated_at":"2022-10-11T07:48:16Z","author_association":"CONTRIBUTOR","body":"Each sampled path is trained on a distinct core, so all the parameters and\nactivations of a path need to fit in the memory of 1 \"core\".\nEach core trains in parallel on the same batch of data.\nFYI the TPUv4 experiments were using 32 megacores each having ~32G (not 64)\nYes I'm not sure why it wouldn't fit in 80G if it fits on 32G in my\nexperiments\nA single A100 machine has 80G but how many cores are on 1 machine? (I think\nwe are assuming there is only 1 core per machine but maybe it is more, e.g.\nif there are 4 cores then each core can use only 80/4=20G of memory)\n\n\nOn Thu, Jun 30, 2022 at 10:57 AM adamantboy ***@***.***>\nwrote:\n\n> oh great, then I'll add that function in the colab. What's the highest\n> batch size you can reach now?\n> … <#m_6047855296256924580_>\n> On Thu, Jun 30, 2022 at 10:21 AM adamantboy *@*.***> wrote: Could you try\n> to add this function to the colab def delete_live_buffers(): for device in\n> jax.local_devices(): lbs = device.live_buffers() for lb in lbs: lb.delete()\n> and add a call to it just before each call to gc.collect() And check if\n> this allows you to increase the batch size to 4 or higher. If not would be\n> interesting to know if you see the same error or a different one. I tried\n> it. The error is same, but the memory preallocated is reduced to 70-90GB\n> when the batch size is 64 indeed.And the batch size can be set to 4 with no\n> OOM error. - Error message, batch size 64: 2022-06-30 15:50:02.179408: W\n> external/org_tensorflow/tensorflow/core/common_runtime/bfc_allocator.cc:479]\n> Allocator (GPU_3_bfc) ran out of memory trying to allocate 74.65GiB\n> (rounded to 80159329536)requested by op 2022-06-30 15:50:06.549646: W\n> external/org_tensorflow/tensorflow/core/common_runtime/bfc_allocator.cc:491]\n> *_________________________________________________________________________________________________\n> 2022-06-30 15:50:33.277741: E\n> external/org_tensorflow/tensorflow/compiler/xla/pjrt/pjrt_stream_executor_client.cc:2141]\n> Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while\n> trying to allocate 80159329472 bytes. BufferAssignment OOM Debugging.\n> BufferAssignment stats: parameter allocation: 1.33GiB constant allocation:\n> 8B maybe_live_out allocation: 288.38MiB preallocated temp allocation:\n> 74.65GiB preallocated temp fragmentation: 212B (0.00%) total allocation:\n> 75.98GiB total fragmentation: 19.2KiB (0.00%) Peak buffers: Buffer 1: Size:\n> 1.27GiB XLA Label: custom-call Shape: f32[64,16,577,577]\n> ========================== Buffer 2: Size: 1.27GiB XLA Label: custom-call\n> Shape: f32[64,16,577,577] ========================== — Reply to this email\n> directly, view it on GitHub <#1187 (comment)\n> <https://github.com/google-research/google-research/issues/1187#issuecomment-1170915826>>,\n> or unsubscribe\n> https://github.com/notifications/unsubscribe-auth/AADGZ5CBMDIRMRYMVQXC3Y3VRVKHTANCNFSM52HXRSJA\n> <https://github.com/notifications/unsubscribe-auth/AADGZ5CBMDIRMRYMVQXC3Y3VRVKHTANCNFSM52HXRSJA>\n> . You are receiving this because you were mentioned.Message ID: @.*>\n>\n> I'm still confused.\n> Your total TPUv4 memory is 2048GB(32GBX64 megacore), my total A100 memory\n> is 640GB(80GBX8).I'm confused about the memory number one train_step\n> compiled can use in your experiment, 32GB or 2048GB?.If it was 32GB, then\n> my 80GB is sufficient but why my batch size is smaller then 64, otherwise\n> it's not enough.\n>\n> —\n> Reply to this email directly, view it on GitHub\n> <https://github.com/google-research/google-research/issues/1187#issuecomment-1170953598>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AADGZ5DRQZ7ZCOXN2B77ZD3VRVOQXANCNFSM52HXRSJA>\n> .\n> You are receiving this because you were mentioned.Message ID:\n> ***@***.***>\n>\n","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1274240924/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"agesmundo","id":421108,"node_id":"MDQ6VXNlcjQyMTEwOA==","avatar_url":"https://avatars.githubusercontent.com/u/421108?v=4","gravatar_id":"","url":"https://api.github.com/users/agesmundo","html_url":"https://github.com/agesmundo","followers_url":"https://api.github.com/users/agesmundo/followers","following_url":"https://api.github.com/users/agesmundo/following{/other_user}","gists_url":"https://api.github.com/users/agesmundo/gists{/gist_id}","starred_url":"https://api.github.com/users/agesmundo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agesmundo/subscriptions","organizations_url":"https://api.github.com/users/agesmundo/orgs","repos_url":"https://api.github.com/users/agesmundo/repos","events_url":"https://api.github.com/users/agesmundo/events{/privacy}","received_events_url":"https://api.github.com/users/agesmundo/received_events","type":"User","site_admin":false}}]