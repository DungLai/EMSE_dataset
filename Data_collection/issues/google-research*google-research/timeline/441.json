[{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/722098762","html_url":"https://github.com/google-research/google-research/issues/441#issuecomment-722098762","issue_url":"https://api.github.com/repos/google-research/google-research/issues/441","id":722098762,"node_id":"MDEyOklzc3VlQ29tbWVudDcyMjA5ODc2Mg==","user":{"login":"ahuizxc","id":29008478,"node_id":"MDQ6VXNlcjI5MDA4NDc4","avatar_url":"https://avatars.githubusercontent.com/u/29008478?v=4","gravatar_id":"","url":"https://api.github.com/users/ahuizxc","html_url":"https://github.com/ahuizxc","followers_url":"https://api.github.com/users/ahuizxc/followers","following_url":"https://api.github.com/users/ahuizxc/following{/other_user}","gists_url":"https://api.github.com/users/ahuizxc/gists{/gist_id}","starred_url":"https://api.github.com/users/ahuizxc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ahuizxc/subscriptions","organizations_url":"https://api.github.com/users/ahuizxc/orgs","repos_url":"https://api.github.com/users/ahuizxc/repos","events_url":"https://api.github.com/users/ahuizxc/events{/privacy}","received_events_url":"https://api.github.com/users/ahuizxc/received_events","type":"User","site_admin":false},"created_at":"2020-11-05T02:43:27Z","updated_at":"2020-11-05T02:44:00Z","author_association":"NONE","body":"> if I use clang-8,it works,but I have to use gcc10 to build scann and there is a error. Anyone knows how to solve. it likes the different rule between clang and gcc.\r\n> \r\n> command：\r\n> CC=gcc bazel build -c opt --copt=-mavx2 --copt=-mfma --cxxopt=\"-D_GLIBCXX_USE_CXX11_ABI=0\" --cxxopt=\"-std=c++17\" --copt=-fsized-deallocation --copt=-w :build_pip_pkg\r\n> \r\n> --->\r\n> ERROR: /home/xuyao/src/google-research/scann/scann/distance_measures/one_to_one/BUILD.bazel:146:11: C++ compilation of rule '//scann/distance_measures/one_to_one:dot_product_sse4' failed (Exit 1): gcc failed: error executing command /home/xuyao/gcc9.3.0/bin/gcc -U_FORTIFY_SOURCE -fstack-protector -Wall -Wunused-but-set-parameter -Wno-free-nonheap-object -fno-omit-frame-pointer -g0 -O2 '-D_FORTIFY_SOURCE=1' -DNDEBUG ... (remaining 58 argument(s) skipped)\r\n> scann/distance_measures/one_to_one/dot_product_sse4.cc: In lambda function:\r\n> scann/distance_measures/one_to_one/dot_product_sse4.cc:30:62: error: expected '{' before '->' token\r\n> 30 | auto as_m128i = [](const Byte* x) SCANN_SSE4_INLINE_LAMBDA -> __m128i* {\r\n> | ^~\r\n> scann/distance_measures/one_to_one/dot_product_sse4.cc: In function 'double tensorflow::scann_ops::dp_internal::DenseDotProductByteImpl(const Byte*, const Byte*, size_t)':\r\n> scann/distance_measures/one_to_one/dot_product_sse4.cc:30:74: error: expected primary-expression before '{' token\r\n> 30 | auto as_m128i = [](const Byte* x) SCANN_SSE4_INLINE_LAMBDA -> __m128i* {\r\n> | ^\r\n> scann/distance_measures/one_to_one/dot_product_sse4.cc:30:74: error: expected ',' or ';' before '{' token\r\n> scann/distance_measures/one_to_one/dot_product_sse4.cc: In lambda function:\r\n> scann/distance_measures/one_to_one/dot_product_sse4.cc:169:64: error: expected '{' before '->' token\r\n> 169 | auto as_m128i = [](const int8_t* x) SCANN_SSE4_INLINE_LAMBDA -> __m128i* {\r\n> | ^~\r\n> scann/distance_measures/one_to_one/dot_product_sse4.cc: In function 'double tensorflow::scann_ops::dp_internal::DenseDotProductSse4(const tensorflow::scann_ops::DatapointPtr&, const tensorflow::scann_ops::DatapointPtr&)':\r\n\r\nscann/utils/common.h\r\nline 130,132\r\nchange to \r\n\r\n``\r\n#define SCANN_INLINE_LAMBDA\r\n\r\n#define SCANN_OUTLINE\r\n```\r\n\r\nwhen disable these marco, it will solve this error.\r\n","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/722098762/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ahuizxc","id":29008478,"node_id":"MDQ6VXNlcjI5MDA4NDc4","avatar_url":"https://avatars.githubusercontent.com/u/29008478?v=4","gravatar_id":"","url":"https://api.github.com/users/ahuizxc","html_url":"https://github.com/ahuizxc","followers_url":"https://api.github.com/users/ahuizxc/followers","following_url":"https://api.github.com/users/ahuizxc/following{/other_user}","gists_url":"https://api.github.com/users/ahuizxc/gists{/gist_id}","starred_url":"https://api.github.com/users/ahuizxc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ahuizxc/subscriptions","organizations_url":"https://api.github.com/users/ahuizxc/orgs","repos_url":"https://api.github.com/users/ahuizxc/repos","events_url":"https://api.github.com/users/ahuizxc/events{/privacy}","received_events_url":"https://api.github.com/users/ahuizxc/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/722111730","html_url":"https://github.com/google-research/google-research/issues/441#issuecomment-722111730","issue_url":"https://api.github.com/repos/google-research/google-research/issues/441","id":722111730,"node_id":"MDEyOklzc3VlQ29tbWVudDcyMjExMTczMA==","user":{"login":"miniuig","id":49297079,"node_id":"MDQ6VXNlcjQ5Mjk3MDc5","avatar_url":"https://avatars.githubusercontent.com/u/49297079?v=4","gravatar_id":"","url":"https://api.github.com/users/miniuig","html_url":"https://github.com/miniuig","followers_url":"https://api.github.com/users/miniuig/followers","following_url":"https://api.github.com/users/miniuig/following{/other_user}","gists_url":"https://api.github.com/users/miniuig/gists{/gist_id}","starred_url":"https://api.github.com/users/miniuig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/miniuig/subscriptions","organizations_url":"https://api.github.com/users/miniuig/orgs","repos_url":"https://api.github.com/users/miniuig/repos","events_url":"https://api.github.com/users/miniuig/events{/privacy}","received_events_url":"https://api.github.com/users/miniuig/received_events","type":"User","site_admin":false},"created_at":"2020-11-05T03:04:33Z","updated_at":"2020-11-05T03:04:33Z","author_association":"NONE","body":"> > if I use clang-8,it works,but I have to use gcc10 to build scann and there is a error. Anyone knows how to solve. it likes the different rule between clang and gcc.\r\n> > command：\r\n> > CC=gcc bazel build -c opt --copt=-mavx2 --copt=-mfma --cxxopt=\"-D_GLIBCXX_USE_CXX11_ABI=0\" --cxxopt=\"-std=c++17\" --copt=-fsized-deallocation --copt=-w :build_pip_pkg\r\n> > --->\r\n> > ERROR: /home/xuyao/src/google-research/scann/scann/distance_measures/one_to_one/BUILD.bazel:146:11: C++ compilation of rule '//scann/distance_measures/one_to_one:dot_product_sse4' failed (Exit 1): gcc failed: error executing command /home/xuyao/gcc9.3.0/bin/gcc -U_FORTIFY_SOURCE -fstack-protector -Wall -Wunused-but-set-parameter -Wno-free-nonheap-object -fno-omit-frame-pointer -g0 -O2 '-D_FORTIFY_SOURCE=1' -DNDEBUG ... (remaining 58 argument(s) skipped)\r\n> > scann/distance_measures/one_to_one/dot_product_sse4.cc: In lambda function:\r\n> > scann/distance_measures/one_to_one/dot_product_sse4.cc:30:62: error: expected '{' before '->' token\r\n> > 30 | auto as_m128i = [](const Byte* x) SCANN_SSE4_INLINE_LAMBDA -> __m128i* {\r\n> > | ^~\r\n> > scann/distance_measures/one_to_one/dot_product_sse4.cc: In function 'double tensorflow::scann_ops::dp_internal::DenseDotProductByteImpl(const Byte*, const Byte*, size_t)':\r\n> > scann/distance_measures/one_to_one/dot_product_sse4.cc:30:74: error: expected primary-expression before '{' token\r\n> > 30 | auto as_m128i = [](const Byte* x) SCANN_SSE4_INLINE_LAMBDA -> __m128i* {\r\n> > | ^\r\n> > scann/distance_measures/one_to_one/dot_product_sse4.cc:30:74: error: expected ',' or ';' before '{' token\r\n> > scann/distance_measures/one_to_one/dot_product_sse4.cc: In lambda function:\r\n> > scann/distance_measures/one_to_one/dot_product_sse4.cc:169:64: error: expected '{' before '->' token\r\n> > 169 | auto as_m128i = [](const int8_t* x) SCANN_SSE4_INLINE_LAMBDA -> __m128i* {\r\n> > | ^~\r\n> > scann/distance_measures/one_to_one/dot_product_sse4.cc: In function 'double tensorflow::scann_ops::dp_internal::DenseDotProductSse4(const tensorflow::scann_ops::DatapointPtr&, const tensorflow::scann_ops::DatapointPtr&)':\r\n> \r\n> scann/utils/common.h\r\n> line 130,132\r\n> change to\r\n> \r\n> ``\r\n> #define SCANN_INLINE_LAMBDA\r\n> \r\n> #define SCANN_OUTLINE\r\n> \r\n> ```\r\n> \r\n> when disable these marco, it will solve this error.\r\n> ```\r\n\r\nThank you. About lamda issue, it has been solved. But there is a new issue, can you help me have a look.\r\n\r\n\r\n./scann/distance_measures/many_to_many/many_to_many_impl.inc:158:59: error: cannot convert '__m128i' to '__m128'\r\n  158 |             __m128i int8s = _mm_loadl_pi(_mm_setzero_si128(),\r\n      |                                          ~~~~~~~~~~~~~~~~~^~\r\n      |                                                           |\r\n      |                                                           __m128i\r\nIn file included from /home/intel/gcc10/bin/../lib/gcc/x86_64-pc-linux-gnu/10.1.0/include/emmintrin.h:31,\r\n                 from external/com_google_absl/absl/container/internal/have_sse.h:42,\r\n                 from external/com_google_absl/absl/container/internal/hashtablez_sampler.h:49,\r\n                 from external/com_google_absl/absl/container/internal/raw_hash_set.h:113,\r\n                 from external/com_google_absl/absl/container/internal/raw_hash_map.h:24,\r\n                 from external/com_google_absl/absl/container/flat_hash_map.h:41,\r\n                 from ./scann/utils/common.h:27,\r\n                 from ./scann/utils/types.h:24,\r\n                 from ./scann/data_format/gfv_properties.h:21,\r\n                 from ./scann/data_format/gfv_conversion.h:24,\r\n                 from ./scann/data_format/datapoint.h:21,\r\n                 from ./scann/distance_measures/many_to_many/many_to_many.h:22,\r\n                 from scann/distance_measures/many_to_many/many_to_many_double_results.cc:17:\r\n/home/intel/gcc10/bin/../lib/gcc/x86_64-pc-linux-gnu/10.1.0/include/xmmintrin.h:800:22: note:   initializing argument 1 of '__m128 _mm_loadl_pi(__m128, const __m64*)'\r\n  800 | _mm_loadl_pi (__m128 __A, __m64 const *__P)\r\n      |               ~~~~~~~^~~\r\n","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/722111730/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"miniuig","id":49297079,"node_id":"MDQ6VXNlcjQ5Mjk3MDc5","avatar_url":"https://avatars.githubusercontent.com/u/49297079?v=4","gravatar_id":"","url":"https://api.github.com/users/miniuig","html_url":"https://github.com/miniuig","followers_url":"https://api.github.com/users/miniuig/followers","following_url":"https://api.github.com/users/miniuig/following{/other_user}","gists_url":"https://api.github.com/users/miniuig/gists{/gist_id}","starred_url":"https://api.github.com/users/miniuig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/miniuig/subscriptions","organizations_url":"https://api.github.com/users/miniuig/orgs","repos_url":"https://api.github.com/users/miniuig/repos","events_url":"https://api.github.com/users/miniuig/events{/privacy}","received_events_url":"https://api.github.com/users/miniuig/received_events","type":"User","site_admin":false}}]