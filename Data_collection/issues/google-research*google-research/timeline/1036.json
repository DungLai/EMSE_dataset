[{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1115032314","html_url":"https://github.com/google-research/google-research/issues/1036#issuecomment-1115032314","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1036","id":1115032314,"node_id":"IC_kwDOCQmIhc5Cdgr6","user":{"login":"remimar","id":52075800,"node_id":"MDQ6VXNlcjUyMDc1ODAw","avatar_url":"https://avatars.githubusercontent.com/u/52075800?v=4","gravatar_id":"","url":"https://api.github.com/users/remimar","html_url":"https://github.com/remimar","followers_url":"https://api.github.com/users/remimar/followers","following_url":"https://api.github.com/users/remimar/following{/other_user}","gists_url":"https://api.github.com/users/remimar/gists{/gist_id}","starred_url":"https://api.github.com/users/remimar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/remimar/subscriptions","organizations_url":"https://api.github.com/users/remimar/orgs","repos_url":"https://api.github.com/users/remimar/repos","events_url":"https://api.github.com/users/remimar/events{/privacy}","received_events_url":"https://api.github.com/users/remimar/received_events","type":"User","site_admin":false},"created_at":"2022-05-02T15:25:09Z","updated_at":"2022-05-02T15:25:09Z","author_association":"NONE","body":"Hi, I am trying to replicate results on FlyingChairs testing set and on KITTI training set. Here are the commands I ran and the corresponding outputs:\r\n\r\n## Eval on provided checkpoints\r\n\r\n### FlyingChairs\r\nI ran:\r\n```\r\npython -m smurf_evaluator --eval_on=\"chairs:/data/FlyingChairs_tfrecord/test\" --global_gpu_batch_size=1 --num_gpus=1 --checkpoint_dir='/path/to/checkpoint'\r\n```\r\nI got:\r\n``` \r\nI0407 13:16:56.373906 139860221076224 smurf_evaluator.py:82] New checkpoint found: /home/users/rmarsal/dev/smurf/checkpoints/smurf/chairs/ckpt-76\r\n:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::\r\nchairs-EPE: 1.966786, chairs-ER: 0.058409, chairs-best-occl-thresh: -1.000000, chairs-census: 1.770922, chairs-eval-time(s): 271.058564, chairs-inf-time(ms): 308.539359, chairs-occl-f-max: -1.000000, chairs-smooth1: 0.000000, chairs-smooth2: 0.008453, chairs-total_loss: 1.779375\r\n```\r\nShould I had to expect EPE 1.72 with this checkpoint as in Table 2 in the paper ? I also tried to set the height and the weight to 368 and 496 as in the paper but the performance are slightly worse.\r\n\r\n### KITTI\r\nI ran:\r\n```\r\npython -m smurf_evaluator --eval_on=\"kitti:/data/kitti_data/data_scene_flow_training-tfrecords\" --global_gpu_batch_size=1 --num_gpus=1 --checkpoint_dir='/path/to/checkpoint'\r\n```\r\nIt returns:\r\n```\r\nWaiting for a new checkpoint, at /home/users/rmarsal/dev/smurf/checkpoints/smurf/kitti, latest is /home/users/rmarsal/dev/smurf/checkpoints/smurf/kitti/ckpt-31\r\n::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::\r\nkitti-EPE(noc): 30.468662, kitti-EPE(occ): 39.341362, kitti-ER(noc): 0.955546, kitti-ER(occ): 0.958396, kitti-best-occl-thresh: 0.000000, kitti-eval-time(s): 194.786156, kitti-inf-time(ms): 402.838845, kitti-occl-f-max: 0.240043\r\n```\r\nI tried different image dimension : 384 1280 and 296 696 but the result is still roughly the same.\r\n\r\n## Re-training models\r\n\r\n### FlyingChairs\r\n\r\nI ran this with the settings of the repo:\r\n```\r\npython -m smurf_main --from_scratch=True \\\r\n--train_on=\"chairs:/data/FlyingChairs_tfrecord/train\" --eval_on=\"chairs:/data/FlyingChairs_tfrecord/test\" \\\r\n--plot_dir=$PATH_CHAIRS --checkpoint_dir=$PATH_CHAIRS \\\r\n--global_gpu_batch_size=8 --num_gpus=8  \\\r\n--height=384 --width=512 \\\r\n--weight_smooth1=2.0 --weight_smooth2=0.0 \\\r\n--evaluate_during_train=True \\\r\n```\r\nAs settings of the repo are slightly different from those of the paper I tried them too:\r\n```\r\npython -m smurf_main --from_scratch=True \\\r\n--train_on=\"chairs:/data/FlyingChairs_tfrecord/train\" --eval_on=\"chairs:/data/FlyingChairs_tfrecord/test\" \\\r\n--plot_dir=$PATH_CHAIRS --checkpoint_dir=$PATH_CHAIRS \\\r\n--global_gpu_batch_size=8 --num_gpus=8  \\\r\n--selfsup_after_num_steps=30000 --selfsup_ramp_up_steps=7500 \\\r\n--lr_decay_after_num_steps=60000 \\\r\n--weight_smooth1=4.0 --weight_smooth2=0.0 \\\r\n--selfsup_mask='none' \\\r\n```\r\nBut the model did not learn anything in both cases: EPE remain above 11.\r\n\r\n\r\n### KITTI\r\n\r\nI fine-tuned the FlyingChairs model provided for KITTI with the setting of the repo:\r\n```\r\npython -m smurf_main\r\n--train_on=\"kitti:/data/kitti/data_scene_flow/_test_384x1280_fullseq-tfrecords\" --eval_on=\"kitti:/data/kitti/data_scene_flow/_training-tfrecords\" \\\r\n--init_checkpoint_dir='/path/to/chairs/checkpoints'\r\n--global_gpu_batch_size=8 --num_gpus=8  \\\r\n--height=296 --width=696 \\\r\n--occlusion_estimation='brox'\r\n```\r\nI got:\r\n```\r\nStep is 76000\r\n75 -- total-loss: 12.162772, census-loss: 11.476587, data-time: 4.658461, learning-rate: 0.000000, selfsup-loss: 0.651478, smooth1-loss: 0.000000, smooth2-loss: 0.034706, supervision-loss: 0.000000, train-time: 3135.333538\r\n::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::\r\nkitti-EPE(noc): 1.903955, kitti-EPE(occ): 2.641327, kitti-ER(noc): 0.075511, kitti-ER(occ): 0.086005, kitti-best-occl-thresh: 0.974359, kitti-eval-time(s): 126.104367, kitti-inf-time(ms): 186.461623, kitti-occl-f-max: 0.906196\r\n```\r\nI also tried the same training from scratch and the result become:\r\n```\r\nStep is 76000\r\n75 -- total-loss: 10.951851, census-loss: 10.805418, data-time: 4.501820, learning-rate: 0.000006, selfsup-loss: 0.129271, smooth1-loss: 0.000000, smooth2-loss: 0.017162, supervision-loss: 0.000000, train-time: 3094.687700\r\n::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::\r\nkitti-EPE(noc): 1.975226, kitti-EPE(occ): 2.862183, kitti-ER(noc): 0.077030, kitti-ER(occ): 0.090028, kitti-best-occl-thresh: 0.974359, kitti-eval-time(s): 126.648766, kitti-inf-time(ms): 194.172957, kitti-occl-f-max: 0.903836\r\n```\r\n\r\nAs settings of the repo are slightly different from those of the paper I tried them too:\r\n```\r\npython -m smurf_main \\\r\n    --reset_global_step=True --reset_optimizer=True \\\r\n    --evaluate_during_train=True \\\r\n    --train_on=\"kitti:/data/kitti/data_scene_flow/_test_384x1280_fullseq-tfrecords\" --eval_on=\"kitti:/data/kitti/data_scene_flow/_training-tfrecords\" \\\r\n    --checkpoint_dir=$PATH_KITTI \\\r\n    --plot_dir=$PATH_KITTI \\\r\n    --init_checkpoint_dir='/path/to/chairs/checkpoints' \\\r\n    --global_gpu_batch_size=8 \\\r\n    --num_gpus=8 \\\r\n    --height=296 \\\r\n    --width=696 \\\r\n    --occlusion_estimation='brox' \\\r\n    --weight_smooth1=0.0 \\\r\n    --weight_smooth2=4.0 \\\r\n    --num_train_steps=75000 \\\r\n    --selfsup_after_num_steps=30000 \\\r\n    --selfsup_ramp_up_steps=7500 \\\r\n    --lr_decay_after_num_steps=60000 \\\r\n    --lr_decay_steps=1500 \\\r\n    --dropout_rate=0 \\\r\n    --selfsup_mask='none' \\\r\n    --occ_after_num_steps_brox=0 \\\r\n```\r\nI got:\r\n```\r\nStep is 76000\r\n75 -- total-loss: 12.162772, census-loss: 11.476587, data-time: 4.658461, learning-rate: 0.000000, selfsup-loss: 0.651478, smooth1-loss: 0.000000, smooth2-loss: 0.034706, supervision-loss: 0.000000, train-time: 3135.333538\r\n::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::\r\nkitti-EPE(noc): 1.903955, kitti-EPE(occ): 2.641327, kitti-ER(noc): 0.075511, kitti-ER(occ): 0.086005, kitti-best-occl-thresh: 0.974359, kitti-eval-time(s): 126.104367, kitti-inf-time(ms): 186.461623, kitti-occl-f-max: 0.906196\r\n```\r\nI expected at least one of the previous configuration to match the performance of the paper without multi-frame supervision (i.e EPE=2.45 and ER(occ)=7.53) but I am actually far from them. \r\n\r\n@AustinCStone how to reproduce the performance of your paper? Should I trust the instructions of the \"Experimental Details\" section of your repo or the hyperparameters indicated in your paper? Do you notice any mistake in the commands above that could explain such disparities between the results I got and those of your paper?\r\n\r\nThank you","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1115032314/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"remimar","id":52075800,"node_id":"MDQ6VXNlcjUyMDc1ODAw","avatar_url":"https://avatars.githubusercontent.com/u/52075800?v=4","gravatar_id":"","url":"https://api.github.com/users/remimar","html_url":"https://github.com/remimar","followers_url":"https://api.github.com/users/remimar/followers","following_url":"https://api.github.com/users/remimar/following{/other_user}","gists_url":"https://api.github.com/users/remimar/gists{/gist_id}","starred_url":"https://api.github.com/users/remimar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/remimar/subscriptions","organizations_url":"https://api.github.com/users/remimar/orgs","repos_url":"https://api.github.com/users/remimar/repos","events_url":"https://api.github.com/users/remimar/events{/privacy}","received_events_url":"https://api.github.com/users/remimar/received_events","type":"User","site_admin":false}},{"id":6534314595,"node_id":"MEE_lADOCQmIhc5GAmQ-zwAAAAGFebpj","url":"https://api.github.com/repos/google-research/google-research/issues/events/6534314595","actor":{"login":"AustinCStone","id":5209976,"node_id":"MDQ6VXNlcjUyMDk5NzY=","avatar_url":"https://avatars.githubusercontent.com/u/5209976?v=4","gravatar_id":"","url":"https://api.github.com/users/AustinCStone","html_url":"https://github.com/AustinCStone","followers_url":"https://api.github.com/users/AustinCStone/followers","following_url":"https://api.github.com/users/AustinCStone/following{/other_user}","gists_url":"https://api.github.com/users/AustinCStone/gists{/gist_id}","starred_url":"https://api.github.com/users/AustinCStone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AustinCStone/subscriptions","organizations_url":"https://api.github.com/users/AustinCStone/orgs","repos_url":"https://api.github.com/users/AustinCStone/repos","events_url":"https://api.github.com/users/AustinCStone/events{/privacy}","received_events_url":"https://api.github.com/users/AustinCStone/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-05-02T15:25:09Z","performed_via_github_app":null},{"id":6534314605,"node_id":"SE_lADOCQmIhc5GAmQ-zwAAAAGFebpt","url":"https://api.github.com/repos/google-research/google-research/issues/events/6534314605","actor":{"login":"AustinCStone","id":5209976,"node_id":"MDQ6VXNlcjUyMDk5NzY=","avatar_url":"https://avatars.githubusercontent.com/u/5209976?v=4","gravatar_id":"","url":"https://api.github.com/users/AustinCStone","html_url":"https://github.com/AustinCStone","followers_url":"https://api.github.com/users/AustinCStone/followers","following_url":"https://api.github.com/users/AustinCStone/following{/other_user}","gists_url":"https://api.github.com/users/AustinCStone/gists{/gist_id}","starred_url":"https://api.github.com/users/AustinCStone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AustinCStone/subscriptions","organizations_url":"https://api.github.com/users/AustinCStone/orgs","repos_url":"https://api.github.com/users/AustinCStone/repos","events_url":"https://api.github.com/users/AustinCStone/events{/privacy}","received_events_url":"https://api.github.com/users/AustinCStone/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-05-02T15:25:09Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1115042950","html_url":"https://github.com/google-research/google-research/issues/1036#issuecomment-1115042950","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1036","id":1115042950,"node_id":"IC_kwDOCQmIhc5CdjSG","user":{"login":"pszyu","id":10527705,"node_id":"MDQ6VXNlcjEwNTI3NzA1","avatar_url":"https://avatars.githubusercontent.com/u/10527705?v=4","gravatar_id":"","url":"https://api.github.com/users/pszyu","html_url":"https://github.com/pszyu","followers_url":"https://api.github.com/users/pszyu/followers","following_url":"https://api.github.com/users/pszyu/following{/other_user}","gists_url":"https://api.github.com/users/pszyu/gists{/gist_id}","starred_url":"https://api.github.com/users/pszyu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pszyu/subscriptions","organizations_url":"https://api.github.com/users/pszyu/orgs","repos_url":"https://api.github.com/users/pszyu/repos","events_url":"https://api.github.com/users/pszyu/events{/privacy}","received_events_url":"https://api.github.com/users/pszyu/received_events","type":"User","site_admin":false},"created_at":"2022-05-02T15:35:29Z","updated_at":"2022-05-02T15:35:29Z","author_association":"NONE","body":" \r\n\r\n> Thank you for the good work of SMURF. I am trying to replicate the reported performance on the training set of the Sintel dataset, namely 1.71 EPE on Clean and 2.58 EPE on Final.\r\n> \r\n> I used apply_smurf.py on the sintel sequences but cannot get the same performance. Could you please provide some instructions on what commands to run?\r\n> \r\n> Thank you.\r\n\r\nIt turns out that the provided Sintel model is Sintel-Test (which is useful to me as well). In case this information is useful @remimar. In addition, adjusting max_rec_iters can make a difference, say 16.","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1115042950/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pszyu","id":10527705,"node_id":"MDQ6VXNlcjEwNTI3NzA1","avatar_url":"https://avatars.githubusercontent.com/u/10527705?v=4","gravatar_id":"","url":"https://api.github.com/users/pszyu","html_url":"https://github.com/pszyu","followers_url":"https://api.github.com/users/pszyu/followers","following_url":"https://api.github.com/users/pszyu/following{/other_user}","gists_url":"https://api.github.com/users/pszyu/gists{/gist_id}","starred_url":"https://api.github.com/users/pszyu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pszyu/subscriptions","organizations_url":"https://api.github.com/users/pszyu/orgs","repos_url":"https://api.github.com/users/pszyu/repos","events_url":"https://api.github.com/users/pszyu/events{/privacy}","received_events_url":"https://api.github.com/users/pszyu/received_events","type":"User","site_admin":false}},{"id":6534383809,"node_id":"MEE_lADOCQmIhc5GAmQ-zwAAAAGFesjB","url":"https://api.github.com/repos/google-research/google-research/issues/events/6534383809","actor":{"login":"remimar","id":52075800,"node_id":"MDQ6VXNlcjUyMDc1ODAw","avatar_url":"https://avatars.githubusercontent.com/u/52075800?v=4","gravatar_id":"","url":"https://api.github.com/users/remimar","html_url":"https://github.com/remimar","followers_url":"https://api.github.com/users/remimar/followers","following_url":"https://api.github.com/users/remimar/following{/other_user}","gists_url":"https://api.github.com/users/remimar/gists{/gist_id}","starred_url":"https://api.github.com/users/remimar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/remimar/subscriptions","organizations_url":"https://api.github.com/users/remimar/orgs","repos_url":"https://api.github.com/users/remimar/repos","events_url":"https://api.github.com/users/remimar/events{/privacy}","received_events_url":"https://api.github.com/users/remimar/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-05-02T15:35:29Z","performed_via_github_app":null},{"id":6534383816,"node_id":"SE_lADOCQmIhc5GAmQ-zwAAAAGFesjI","url":"https://api.github.com/repos/google-research/google-research/issues/events/6534383816","actor":{"login":"remimar","id":52075800,"node_id":"MDQ6VXNlcjUyMDc1ODAw","avatar_url":"https://avatars.githubusercontent.com/u/52075800?v=4","gravatar_id":"","url":"https://api.github.com/users/remimar","html_url":"https://github.com/remimar","followers_url":"https://api.github.com/users/remimar/followers","following_url":"https://api.github.com/users/remimar/following{/other_user}","gists_url":"https://api.github.com/users/remimar/gists{/gist_id}","starred_url":"https://api.github.com/users/remimar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/remimar/subscriptions","organizations_url":"https://api.github.com/users/remimar/orgs","repos_url":"https://api.github.com/users/remimar/repos","events_url":"https://api.github.com/users/remimar/events{/privacy}","received_events_url":"https://api.github.com/users/remimar/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-05-02T15:35:29Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1289614470","html_url":"https://github.com/google-research/google-research/issues/1036#issuecomment-1289614470","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1036","id":1289614470,"node_id":"IC_kwDOCQmIhc5M3fSG","user":{"login":"abhijay9","id":11029633,"node_id":"MDQ6VXNlcjExMDI5NjMz","avatar_url":"https://avatars.githubusercontent.com/u/11029633?v=4","gravatar_id":"","url":"https://api.github.com/users/abhijay9","html_url":"https://github.com/abhijay9","followers_url":"https://api.github.com/users/abhijay9/followers","following_url":"https://api.github.com/users/abhijay9/following{/other_user}","gists_url":"https://api.github.com/users/abhijay9/gists{/gist_id}","starred_url":"https://api.github.com/users/abhijay9/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abhijay9/subscriptions","organizations_url":"https://api.github.com/users/abhijay9/orgs","repos_url":"https://api.github.com/users/abhijay9/repos","events_url":"https://api.github.com/users/abhijay9/events{/privacy}","received_events_url":"https://api.github.com/users/abhijay9/received_events","type":"User","site_admin":false},"created_at":"2022-10-24T21:04:01Z","updated_at":"2022-10-24T21:04:01Z","author_association":"NONE","body":"What should be the EPE of the Flying Chairs pre-trained model on the Chairs test dataset? ","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1289614470/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"abhijay9","id":11029633,"node_id":"MDQ6VXNlcjExMDI5NjMz","avatar_url":"https://avatars.githubusercontent.com/u/11029633?v=4","gravatar_id":"","url":"https://api.github.com/users/abhijay9","html_url":"https://github.com/abhijay9","followers_url":"https://api.github.com/users/abhijay9/followers","following_url":"https://api.github.com/users/abhijay9/following{/other_user}","gists_url":"https://api.github.com/users/abhijay9/gists{/gist_id}","starred_url":"https://api.github.com/users/abhijay9/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abhijay9/subscriptions","organizations_url":"https://api.github.com/users/abhijay9/orgs","repos_url":"https://api.github.com/users/abhijay9/repos","events_url":"https://api.github.com/users/abhijay9/events{/privacy}","received_events_url":"https://api.github.com/users/abhijay9/received_events","type":"User","site_admin":false}}]