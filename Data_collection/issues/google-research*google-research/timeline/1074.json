[{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1133821907","html_url":"https://github.com/google-research/google-research/issues/1074#issuecomment-1133821907","issue_url":"https://api.github.com/repos/google-research/google-research/issues/1074","id":1133821907,"node_id":"IC_kwDOCQmIhc5DlL_T","user":{"login":"rmkn85","id":1399628,"node_id":"MDQ6VXNlcjEzOTk2Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/1399628?v=4","gravatar_id":"","url":"https://api.github.com/users/rmkn85","html_url":"https://github.com/rmkn85","followers_url":"https://api.github.com/users/rmkn85/followers","following_url":"https://api.github.com/users/rmkn85/following{/other_user}","gists_url":"https://api.github.com/users/rmkn85/gists{/gist_id}","starred_url":"https://api.github.com/users/rmkn85/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmkn85/subscriptions","organizations_url":"https://api.github.com/users/rmkn85/orgs","repos_url":"https://api.github.com/users/rmkn85/repos","events_url":"https://api.github.com/users/rmkn85/events{/privacy}","received_events_url":"https://api.github.com/users/rmkn85/received_events","type":"User","site_admin":false},"created_at":"2022-05-22T05:29:44Z","updated_at":"2022-05-22T05:29:44Z","author_association":"CONTRIBUTOR","body":"in WORKSPACE file, replace these:\r\n\r\n```\r\nhttp_archive(\r\n  name = \"com_google_absl\",\r\n  urls = [\"https://github.com/abseil/abseil-cpp/archive/98eb410c93ad059f9bba1bf43f5bb916fc92a5ea.zip\"],\r\n  strip_prefix = \"abseil-cpp-98eb410c93ad059f9bba1bf43f5bb916fc92a5ea\",\r\n)\r\n\r\nhttp_archive(\r\n    name = \"com_google_googletest\",\r\n    strip_prefix = \"googletest-release-1.11.0\",\r\n    urls = [\"https://github.com/google/googletest/archive/refs/tags/release-1.11.0.zip\"],\r\n)\r\n\r\nhttp_archive(\r\n    name = \"rules_cc\",\r\n    strip_prefix = \"rules_cc-main\",\r\n    urls = [\"https://github.com/bazelbuild/rules_cc/archive/refs/heads/main.zip\"],\r\n)\r\n```","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/1133821907/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rmkn85","id":1399628,"node_id":"MDQ6VXNlcjEzOTk2Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/1399628?v=4","gravatar_id":"","url":"https://api.github.com/users/rmkn85","html_url":"https://github.com/rmkn85","followers_url":"https://api.github.com/users/rmkn85/followers","following_url":"https://api.github.com/users/rmkn85/following{/other_user}","gists_url":"https://api.github.com/users/rmkn85/gists{/gist_id}","starred_url":"https://api.github.com/users/rmkn85/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmkn85/subscriptions","organizations_url":"https://api.github.com/users/rmkn85/orgs","repos_url":"https://api.github.com/users/rmkn85/repos","events_url":"https://api.github.com/users/rmkn85/events{/privacy}","received_events_url":"https://api.github.com/users/rmkn85/received_events","type":"User","site_admin":false}},{"actor":{"login":"wookayin","id":1009873,"node_id":"MDQ6VXNlcjEwMDk4NzM=","avatar_url":"https://avatars.githubusercontent.com/u/1009873?v=4","gravatar_id":"","url":"https://api.github.com/users/wookayin","html_url":"https://github.com/wookayin","followers_url":"https://api.github.com/users/wookayin/followers","following_url":"https://api.github.com/users/wookayin/following{/other_user}","gists_url":"https://api.github.com/users/wookayin/gists{/gist_id}","starred_url":"https://api.github.com/users/wookayin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wookayin/subscriptions","organizations_url":"https://api.github.com/users/wookayin/orgs","repos_url":"https://api.github.com/users/wookayin/repos","events_url":"https://api.github.com/users/wookayin/events{/privacy}","received_events_url":"https://api.github.com/users/wookayin/received_events","type":"User","site_admin":false},"created_at":"2022-10-27T22:10:41Z","updated_at":"2022-10-27T22:10:41Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/deepmind/labmaze/issues/4","repository_url":"https://api.github.com/repos/deepmind/labmaze","labels_url":"https://api.github.com/repos/deepmind/labmaze/issues/4/labels{/name}","comments_url":"https://api.github.com/repos/deepmind/labmaze/issues/4/comments","events_url":"https://api.github.com/repos/deepmind/labmaze/issues/4/events","html_url":"https://github.com/deepmind/labmaze/issues/4","id":1426322148,"node_id":"I_kwDODKFC5M5VA_Lk","number":4,"title":"Python 3.11: build error, and missing py311 wheel files (as a dm-control dependency)","user":{"login":"wookayin","id":1009873,"node_id":"MDQ6VXNlcjEwMDk4NzM=","avatar_url":"https://avatars.githubusercontent.com/u/1009873?v=4","gravatar_id":"","url":"https://api.github.com/users/wookayin","html_url":"https://github.com/wookayin","followers_url":"https://api.github.com/users/wookayin/followers","following_url":"https://api.github.com/users/wookayin/following{/other_user}","gists_url":"https://api.github.com/users/wookayin/gists{/gist_id}","starred_url":"https://api.github.com/users/wookayin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wookayin/subscriptions","organizations_url":"https://api.github.com/users/wookayin/orgs","repos_url":"https://api.github.com/users/wookayin/repos","events_url":"https://api.github.com/users/wookayin/events{/privacy}","received_events_url":"https://api.github.com/users/wookayin/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2022-10-27T22:10:41Z","updated_at":"2022-12-05T18:43:30Z","closed_at":"2022-12-05T18:43:30Z","author_association":"NONE","active_lock_reason":null,"repository":{"id":211895012,"node_id":"MDEwOlJlcG9zaXRvcnkyMTE4OTUwMTI=","name":"labmaze","full_name":"deepmind/labmaze","private":false,"owner":{"login":"deepmind","id":8596759,"node_id":"MDEyOk9yZ2FuaXphdGlvbjg1OTY3NTk=","avatar_url":"https://avatars.githubusercontent.com/u/8596759?v=4","gravatar_id":"","url":"https://api.github.com/users/deepmind","html_url":"https://github.com/deepmind","followers_url":"https://api.github.com/users/deepmind/followers","following_url":"https://api.github.com/users/deepmind/following{/other_user}","gists_url":"https://api.github.com/users/deepmind/gists{/gist_id}","starred_url":"https://api.github.com/users/deepmind/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepmind/subscriptions","organizations_url":"https://api.github.com/users/deepmind/orgs","repos_url":"https://api.github.com/users/deepmind/repos","events_url":"https://api.github.com/users/deepmind/events{/privacy}","received_events_url":"https://api.github.com/users/deepmind/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/deepmind/labmaze","description":"A standalone release of DeepMind Lab's maze generator with Python bindings.","fork":false,"url":"https://api.github.com/repos/deepmind/labmaze","forks_url":"https://api.github.com/repos/deepmind/labmaze/forks","keys_url":"https://api.github.com/repos/deepmind/labmaze/keys{/key_id}","collaborators_url":"https://api.github.com/repos/deepmind/labmaze/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/deepmind/labmaze/teams","hooks_url":"https://api.github.com/repos/deepmind/labmaze/hooks","issue_events_url":"https://api.github.com/repos/deepmind/labmaze/issues/events{/number}","events_url":"https://api.github.com/repos/deepmind/labmaze/events","assignees_url":"https://api.github.com/repos/deepmind/labmaze/assignees{/user}","branches_url":"https://api.github.com/repos/deepmind/labmaze/branches{/branch}","tags_url":"https://api.github.com/repos/deepmind/labmaze/tags","blobs_url":"https://api.github.com/repos/deepmind/labmaze/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/deepmind/labmaze/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/deepmind/labmaze/git/refs{/sha}","trees_url":"https://api.github.com/repos/deepmind/labmaze/git/trees{/sha}","statuses_url":"https://api.github.com/repos/deepmind/labmaze/statuses/{sha}","languages_url":"https://api.github.com/repos/deepmind/labmaze/languages","stargazers_url":"https://api.github.com/repos/deepmind/labmaze/stargazers","contributors_url":"https://api.github.com/repos/deepmind/labmaze/contributors","subscribers_url":"https://api.github.com/repos/deepmind/labmaze/subscribers","subscription_url":"https://api.github.com/repos/deepmind/labmaze/subscription","commits_url":"https://api.github.com/repos/deepmind/labmaze/commits{/sha}","git_commits_url":"https://api.github.com/repos/deepmind/labmaze/git/commits{/sha}","comments_url":"https://api.github.com/repos/deepmind/labmaze/comments{/number}","issue_comment_url":"https://api.github.com/repos/deepmind/labmaze/issues/comments{/number}","contents_url":"https://api.github.com/repos/deepmind/labmaze/contents/{+path}","compare_url":"https://api.github.com/repos/deepmind/labmaze/compare/{base}...{head}","merges_url":"https://api.github.com/repos/deepmind/labmaze/merges","archive_url":"https://api.github.com/repos/deepmind/labmaze/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/deepmind/labmaze/downloads","issues_url":"https://api.github.com/repos/deepmind/labmaze/issues{/number}","pulls_url":"https://api.github.com/repos/deepmind/labmaze/pulls{/number}","milestones_url":"https://api.github.com/repos/deepmind/labmaze/milestones{/number}","notifications_url":"https://api.github.com/repos/deepmind/labmaze/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/deepmind/labmaze/labels{/name}","releases_url":"https://api.github.com/repos/deepmind/labmaze/releases{/id}","deployments_url":"https://api.github.com/repos/deepmind/labmaze/deployments","created_at":"2019-09-30T15:41:10Z","updated_at":"2023-01-09T08:10:48Z","pushed_at":"2022-11-03T18:19:11Z","git_url":"git://github.com/deepmind/labmaze.git","ssh_url":"git@github.com:deepmind/labmaze.git","clone_url":"https://github.com/deepmind/labmaze.git","svn_url":"https://github.com/deepmind/labmaze","homepage":"","size":4401,"stargazers_count":48,"watchers_count":48,"language":"C++","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":13,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":13,"open_issues":1,"watchers":48,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Python 3.11 is brand new, and as of today labmaze (and dm-control who has a dependency on labmaze) cannot be installed as https://pypi.org/project/labmaze/#files do not have python3.11 wheel files yet.\r\n\r\nAs it lacks a prebuilt wheel file, pip would try building from source but the build will fail. I think bazelfile needs to be updated to catch up.\r\n\r\n/cc @saran-t \r\n\r\n## use_cpp_toolchain v.s. find_cpp_toolchain\r\n\r\nThe first build error is `file '@bazel_tools//tools/cpp:toolchain_utils.bzl' does not contain symbol 'use_cpp_toolchain' (did you mean 'find_cpp_toolchain'?)`\r\n\r\n```\r\nbazel build //labmaze/cc/python:_defaults --symlink_prefix=build/temp.macosx-11.0-arm64-cpython-311/bazel- --compilation_mode=opt\r\n      WARNING: Option 'host_javabase' is deprecated                                                                                                             \r\n      WARNING: Option 'host_java_toolchain' is deprecated                   \r\n      WARNING: Option 'java_toolchain' is deprecated                                                                                                            \r\n      Loading:                                                                                                                                                  \r\n      Loading: 0 packages loaded                                                \r\n      Analyzing: target //labmaze/cc/python:_defaults (0 packages loaded, 0 targets configured)            \r\n      ERROR: Traceback (most recent call last):                                                                                                                 \r\n          File \"/private/var/tmp/_bazel_$USER/ce0c0847eec94d5226bf2741ba1c144b/external/rules_cc/cc/private/rules_impl/compiler_flag.bzl\", line 17, column 76\r\n, in <toplevel>                                                                                                                                                 \r\n                  load(\"@bazel_tools//tools/cpp:toolchain_utils.bzl\", \"find_cpp_toolchain\", \"use_cpp_toolchain\")\r\n      Error: file '@bazel_tools//tools/cpp:toolchain_utils.bzl' does not contain symbol 'use_cpp_toolchain' (did you mean 'find_cpp_toolchain'?)\r\n      ERROR: /private/var/folders/j8/gm77k5cn5xg6b55_hx7fk5dc0000gn/T/pip-install-i5nxdys1/labmaze_f730bf84b1844ac7aee1e6a65ebcbaf1/labmaze/cc/python/BUILD:24:1\r\n9: Target '//labmaze/cc/python:_defaults.so' depends on toolchain '@local_config_cc//:cc-compiler-darwin_arm64', which cannot be found: error loading package '@\r\nlocal_config_cc//': at /private/var/tmp/_bazel_wookayin/ce0c0847eec94d5226bf2741ba1c144b/external/rules_cc/cc/defs.bzl:18:6: initialization of module 'cc/privat\r\ne/rules_impl/compiler_flag.bzl' failed'                                         \r\n```\r\n\r\nNot sure why this happens, but applying a patch similar to https://github.com/google/mediapipe/issues/3457#issuecomment-1164620044 would be a workaround.\r\n\r\n## pybind11\r\n\r\nAnother error is pybind11 version issue, similar to https://github.com/deepmind/tree/pull/91. We should update it to v2.10.0 or higher to support python 3.11.\r\n\r\nThe `WORKSPACE` file:\r\n\r\n```\r\nhttp_archive(\r\n    name = \"pybind11\",\r\n    build_file = \"@//bazel:pybind11.BUILD\",\r\n    sha256 = \"225df6e6dea7cea7c5754d4ed954e9ca7c43947b849b3795f87cb56437f1bd19\",\r\n    strip_prefix = \"pybind11-2.10.0\",\r\n    url = \"https://github.com/pybind/pybind11/archive/v2.10.0.zip\",\r\n)\r\n```\r\n\r\n\r\n## unexpected keyword 'visibility' in call to _config_setting_group \r\n\r\ngoogle-research/google-research#1074\r\n\r\nI replaced `abseil-cpp-master` with a legacy version suggested by @rmkn85. However I left googletest and rules_cc intact.\r\n\r\n```\r\nhttp_archive(\r\n  name = \"com_google_absl\",\r\n  urls = [\"https://github.com/abseil/abseil-cpp/archive/98eb410c93ad059f9bba1bf43f5bb916fc92a5ea.zip\"],\r\n  strip_prefix = \"abseil-cpp-98eb410c93ad059f9bba1bf43f5bb916fc92a5ea\",\r\n)\r\n```\r\n\r\nAfter these manual patches, I was able to install labmaze on python 3.11.\r\n\r\n<details>\r\n<summary>A full diff that worked for me</summary>\r\n\r\n```diff\r\ndiff --git WORKSPACE WORKSPACE\r\nindex 32c8bc2..a7f5488 100644\r\n--- WORKSPACE\r\n+++ WORKSPACE\r\n@@ -25,9 +25,9 @@ http_archive(\r\n )\r\n \r\n http_archive(\r\n-    name = \"com_google_absl\",\r\n-    strip_prefix = \"abseil-cpp-master\",\r\n-    urls = [\"https://github.com/abseil/abseil-cpp/archive/master.zip\"],\r\n+  name = \"com_google_absl\",\r\n+  urls = [\"https://github.com/abseil/abseil-cpp/archive/98eb410c93ad059f9bba1bf43f5bb916fc92a5ea.zip\"],\r\n+  strip_prefix = \"abseil-cpp-98eb410c93ad059f9bba1bf43f5bb916fc92a5ea\",\r\n )\r\n \r\n http_archive(\r\n@@ -39,14 +39,14 @@ http_archive(\r\n http_archive(\r\n     name = \"pybind11\",\r\n     build_file = \"@//bazel:pybind11.BUILD\",\r\n-    sha256 = \"1f844c071d9d98f5bb08458f128baa0aa08a9e5939a6b42276adb1bacd8b483e\",\r\n-    strip_prefix = \"pybind11-2.3.0\",\r\n-    url = \"https://github.com/pybind/pybind11/archive/v2.3.0.zip\",\r\n+    sha256 = \"225df6e6dea7cea7c5754d4ed954e9ca7c43947b849b3795f87cb56437f1bd19\",\r\n+    strip_prefix = \"pybind11-2.10.0\",\r\n+    url = \"https://github.com/pybind/pybind11/archive/v2.10.0.zip\",\r\n )\r\n \r\n new_local_repository(\r\n     name = \"python_headers\",\r\n-    path = \"/usr/include/python2.7\",  # May be overwritten by setup.py.\r\n+    path = \"$HOME/.miniforge3/envs/py311/include/python3.11\",  # May be overwritten by setup.py.\r\n     build_file = \"@//bazel:python_headers.BUILD\"\r\n )\r\n \r\n@@ -55,8 +55,8 @@ new_local_repository(\r\n # (https://docs.bazel.build/versions/master/external.html#transitive-dependencies)\r\n http_archive(\r\n     name = \"rules_cc\",\r\n-    strip_prefix = \"rules_cc-main\",\r\n-    urls = [\"https://github.com/bazelbuild/rules_cc/archive/main.zip\"],\r\n+    strip_prefix = \"rules_cc-8bb0eb5c5ccd96b91753bb112096bb6993d16d13\",\r\n+    urls = [\"https://github.com/bazelbuild/rules_cc/archive/8bb0eb5.zip\"],\r\n )\r\n \r\n load(\"@bazel_skylib//:workspace.bzl\", \"bazel_skylib_workspace\")\r\n```\r\n\r\n</details>","reactions":{"url":"https://api.github.com/repos/deepmind/labmaze/issues/4/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/deepmind/labmaze/issues/4/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"}]