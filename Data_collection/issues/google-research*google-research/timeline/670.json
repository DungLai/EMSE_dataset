[{"id":4590651234,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDU5MDY1MTIzNA==","url":"https://api.github.com/repos/google-research/google-research/issues/events/4590651234","actor":{"login":"agarwl","id":12142945,"node_id":"MDQ6VXNlcjEyMTQyOTQ1","avatar_url":"https://avatars.githubusercontent.com/u/12142945?v=4","gravatar_id":"","url":"https://api.github.com/users/agarwl","html_url":"https://github.com/agarwl","followers_url":"https://api.github.com/users/agarwl/followers","following_url":"https://api.github.com/users/agarwl/following{/other_user}","gists_url":"https://api.github.com/users/agarwl/gists{/gist_id}","starred_url":"https://api.github.com/users/agarwl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agarwl/subscriptions","organizations_url":"https://api.github.com/users/agarwl/orgs","repos_url":"https://api.github.com/users/agarwl/repos","events_url":"https://api.github.com/users/agarwl/events{/privacy}","received_events_url":"https://api.github.com/users/agarwl/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-13T23:09:56Z","performed_via_github_app":null},{"id":4590651235,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ1OTA2NTEyMzU=","url":"https://api.github.com/repos/google-research/google-research/issues/events/4590651235","actor":{"login":"agarwl","id":12142945,"node_id":"MDQ6VXNlcjEyMTQyOTQ1","avatar_url":"https://avatars.githubusercontent.com/u/12142945?v=4","gravatar_id":"","url":"https://api.github.com/users/agarwl","html_url":"https://github.com/agarwl","followers_url":"https://api.github.com/users/agarwl/followers","following_url":"https://api.github.com/users/agarwl/following{/other_user}","gists_url":"https://api.github.com/users/agarwl/gists{/gist_id}","starred_url":"https://api.github.com/users/agarwl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agarwl/subscriptions","organizations_url":"https://api.github.com/users/agarwl/orgs","repos_url":"https://api.github.com/users/agarwl/repos","events_url":"https://api.github.com/users/agarwl/events{/privacy}","received_events_url":"https://api.github.com/users/agarwl/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-13T23:09:56Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/819128314","html_url":"https://github.com/google-research/google-research/issues/670#issuecomment-819128314","issue_url":"https://api.github.com/repos/google-research/google-research/issues/670","id":819128314,"node_id":"MDEyOklzc3VlQ29tbWVudDgxOTEyODMxNA==","user":{"login":"agarwl","id":12142945,"node_id":"MDQ6VXNlcjEyMTQyOTQ1","avatar_url":"https://avatars.githubusercontent.com/u/12142945?v=4","gravatar_id":"","url":"https://api.github.com/users/agarwl","html_url":"https://github.com/agarwl","followers_url":"https://api.github.com/users/agarwl/followers","following_url":"https://api.github.com/users/agarwl/following{/other_user}","gists_url":"https://api.github.com/users/agarwl/gists{/gist_id}","starred_url":"https://api.github.com/users/agarwl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agarwl/subscriptions","organizations_url":"https://api.github.com/users/agarwl/orgs","repos_url":"https://api.github.com/users/agarwl/repos","events_url":"https://api.github.com/users/agarwl/events{/privacy}","received_events_url":"https://api.github.com/users/agarwl/received_events","type":"User","site_admin":false},"created_at":"2021-04-14T00:08:17Z","updated_at":"2021-04-14T00:08:17Z","author_association":"CONTRIBUTOR","body":"From the error, it seems as if some summary op is complaining about some gpu/cpu placement issue (I am assuming you are using tf2). Some possible suggestions to investigate this issue more: \r\n - Have you tried turning off the contrastive loss summary [here](https://github.com/google-research/google-research/blob/master/pse/dm_control/agents/pse_drq_agent.py#L348) (simply use a [OrderedDict](https://github.com/google-research/google-research/blob/8b51f2bcf6799d4885ce5997ed5a5111110c67db/pse/dm_control/agents/pse_drq_agent.py#L32) without contrastive loss)?\r\n - Try using a pdb at the [statement](https://github.com/google-research/google-research/blob/master/pse/dm_control/agents/pse_drq_agent.py#L328) when non-zero contrastive loss comes into play and see if an error is thrown there. \r\n- Try running the code on CPU (if that works, it's clear that it's some weird op placement issue). Let me know what you find.","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/819128314/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"agarwl","id":12142945,"node_id":"MDQ6VXNlcjEyMTQyOTQ1","avatar_url":"https://avatars.githubusercontent.com/u/12142945?v=4","gravatar_id":"","url":"https://api.github.com/users/agarwl","html_url":"https://github.com/agarwl","followers_url":"https://api.github.com/users/agarwl/followers","following_url":"https://api.github.com/users/agarwl/following{/other_user}","gists_url":"https://api.github.com/users/agarwl/gists{/gist_id}","starred_url":"https://api.github.com/users/agarwl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agarwl/subscriptions","organizations_url":"https://api.github.com/users/agarwl/orgs","repos_url":"https://api.github.com/users/agarwl/repos","events_url":"https://api.github.com/users/agarwl/events{/privacy}","received_events_url":"https://api.github.com/users/agarwl/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/819149481","html_url":"https://github.com/google-research/google-research/issues/670#issuecomment-819149481","issue_url":"https://api.github.com/repos/google-research/google-research/issues/670","id":819149481,"node_id":"MDEyOklzc3VlQ29tbWVudDgxOTE0OTQ4MQ==","user":{"login":"h8907283","id":19578156,"node_id":"MDQ6VXNlcjE5NTc4MTU2","avatar_url":"https://avatars.githubusercontent.com/u/19578156?v=4","gravatar_id":"","url":"https://api.github.com/users/h8907283","html_url":"https://github.com/h8907283","followers_url":"https://api.github.com/users/h8907283/followers","following_url":"https://api.github.com/users/h8907283/following{/other_user}","gists_url":"https://api.github.com/users/h8907283/gists{/gist_id}","starred_url":"https://api.github.com/users/h8907283/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/h8907283/subscriptions","organizations_url":"https://api.github.com/users/h8907283/orgs","repos_url":"https://api.github.com/users/h8907283/repos","events_url":"https://api.github.com/users/h8907283/events{/privacy}","received_events_url":"https://api.github.com/users/h8907283/received_events","type":"User","site_admin":false},"created_at":"2021-04-14T01:07:17Z","updated_at":"2021-04-14T01:09:33Z","author_association":"NONE","body":"@agarwl Thanks for your lightning quick response! The machine I'm using is a 4-GPU lambda box. When I was reporting failure, I had `export CUDA_VISIBLE_DEVICES=0,1,2,3`. After I disabled all of them, i.e. `export CUDA_VISIBLE_DEVICES=`, non-zero `contrastive_loss_weight` training seems to be working now without code changes. I'll keep this going a bit.\r\n\r\nThe confusing part is when `contrastive_loss_weight` was set to zero, training with the use of GPU worked fine. Is it possible the episode data loading caused the CPU/GPU mismatch?\r\n\r\nFor the code to be able to load the GCP dataset, I added FLAGS.data_dir. This `data_dir` points to `some_path/cartpole-swingup/1/seed_0/`. I thought this was the correct path because the code looks for a file named `episodes2`.\r\n\r\nBTW, I also tried `export CUDA_VISIBLE_DEVICES=0` but this also failed.","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/819149481/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"h8907283","id":19578156,"node_id":"MDQ6VXNlcjE5NTc4MTU2","avatar_url":"https://avatars.githubusercontent.com/u/19578156?v=4","gravatar_id":"","url":"https://api.github.com/users/h8907283","html_url":"https://github.com/h8907283","followers_url":"https://api.github.com/users/h8907283/followers","following_url":"https://api.github.com/users/h8907283/following{/other_user}","gists_url":"https://api.github.com/users/h8907283/gists{/gist_id}","starred_url":"https://api.github.com/users/h8907283/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/h8907283/subscriptions","organizations_url":"https://api.github.com/users/h8907283/orgs","repos_url":"https://api.github.com/users/h8907283/repos","events_url":"https://api.github.com/users/h8907283/events{/privacy}","received_events_url":"https://api.github.com/users/h8907283/received_events","type":"User","site_admin":false}},{"id":4590913537,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDU5MDkxMzUzNw==","url":"https://api.github.com/repos/google-research/google-research/issues/events/4590913537","actor":{"login":"agarwl","id":12142945,"node_id":"MDQ6VXNlcjEyMTQyOTQ1","avatar_url":"https://avatars.githubusercontent.com/u/12142945?v=4","gravatar_id":"","url":"https://api.github.com/users/agarwl","html_url":"https://github.com/agarwl","followers_url":"https://api.github.com/users/agarwl/followers","following_url":"https://api.github.com/users/agarwl/following{/other_user}","gists_url":"https://api.github.com/users/agarwl/gists{/gist_id}","starred_url":"https://api.github.com/users/agarwl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agarwl/subscriptions","organizations_url":"https://api.github.com/users/agarwl/orgs","repos_url":"https://api.github.com/users/agarwl/repos","events_url":"https://api.github.com/users/agarwl/events{/privacy}","received_events_url":"https://api.github.com/users/agarwl/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-14T01:07:17Z","performed_via_github_app":null},{"id":4590913540,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ1OTA5MTM1NDA=","url":"https://api.github.com/repos/google-research/google-research/issues/events/4590913540","actor":{"login":"agarwl","id":12142945,"node_id":"MDQ6VXNlcjEyMTQyOTQ1","avatar_url":"https://avatars.githubusercontent.com/u/12142945?v=4","gravatar_id":"","url":"https://api.github.com/users/agarwl","html_url":"https://github.com/agarwl","followers_url":"https://api.github.com/users/agarwl/followers","following_url":"https://api.github.com/users/agarwl/following{/other_user}","gists_url":"https://api.github.com/users/agarwl/gists{/gist_id}","starred_url":"https://api.github.com/users/agarwl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agarwl/subscriptions","organizations_url":"https://api.github.com/users/agarwl/orgs","repos_url":"https://api.github.com/users/agarwl/repos","events_url":"https://api.github.com/users/agarwl/events{/privacy}","received_events_url":"https://api.github.com/users/agarwl/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-14T01:07:17Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/819152111","html_url":"https://github.com/google-research/google-research/issues/670#issuecomment-819152111","issue_url":"https://api.github.com/repos/google-research/google-research/issues/670","id":819152111,"node_id":"MDEyOklzc3VlQ29tbWVudDgxOTE1MjExMQ==","user":{"login":"h8907283","id":19578156,"node_id":"MDQ6VXNlcjE5NTc4MTU2","avatar_url":"https://avatars.githubusercontent.com/u/19578156?v=4","gravatar_id":"","url":"https://api.github.com/users/h8907283","html_url":"https://github.com/h8907283","followers_url":"https://api.github.com/users/h8907283/followers","following_url":"https://api.github.com/users/h8907283/following{/other_user}","gists_url":"https://api.github.com/users/h8907283/gists{/gist_id}","starred_url":"https://api.github.com/users/h8907283/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/h8907283/subscriptions","organizations_url":"https://api.github.com/users/h8907283/orgs","repos_url":"https://api.github.com/users/h8907283/repos","events_url":"https://api.github.com/users/h8907283/events{/privacy}","received_events_url":"https://api.github.com/users/h8907283/received_events","type":"User","site_admin":false},"created_at":"2021-04-14T01:15:56Z","updated_at":"2021-04-14T01:15:56Z","author_association":"NONE","body":"Another unrelated question. The latest and stable tf-agents version is 0.7.1. In this version, the Learner does not support `run_optimizer_variable_init`. This is only supported in the tf-agents mainline. Should we use the tf-agents mainline (or nightly) or tf-agents 0.7.1?","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/819152111/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"h8907283","id":19578156,"node_id":"MDQ6VXNlcjE5NTc4MTU2","avatar_url":"https://avatars.githubusercontent.com/u/19578156?v=4","gravatar_id":"","url":"https://api.github.com/users/h8907283","html_url":"https://github.com/h8907283","followers_url":"https://api.github.com/users/h8907283/followers","following_url":"https://api.github.com/users/h8907283/following{/other_user}","gists_url":"https://api.github.com/users/h8907283/gists{/gist_id}","starred_url":"https://api.github.com/users/h8907283/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/h8907283/subscriptions","organizations_url":"https://api.github.com/users/h8907283/orgs","repos_url":"https://api.github.com/users/h8907283/repos","events_url":"https://api.github.com/users/h8907283/events{/privacy}","received_events_url":"https://api.github.com/users/h8907283/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/819199421","html_url":"https://github.com/google-research/google-research/issues/670#issuecomment-819199421","issue_url":"https://api.github.com/repos/google-research/google-research/issues/670","id":819199421,"node_id":"MDEyOklzc3VlQ29tbWVudDgxOTE5OTQyMQ==","user":{"login":"agarwl","id":12142945,"node_id":"MDQ6VXNlcjEyMTQyOTQ1","avatar_url":"https://avatars.githubusercontent.com/u/12142945?v=4","gravatar_id":"","url":"https://api.github.com/users/agarwl","html_url":"https://github.com/agarwl","followers_url":"https://api.github.com/users/agarwl/followers","following_url":"https://api.github.com/users/agarwl/following{/other_user}","gists_url":"https://api.github.com/users/agarwl/gists{/gist_id}","starred_url":"https://api.github.com/users/agarwl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agarwl/subscriptions","organizations_url":"https://api.github.com/users/agarwl/orgs","repos_url":"https://api.github.com/users/agarwl/repos","events_url":"https://api.github.com/users/agarwl/events{/privacy}","received_events_url":"https://api.github.com/users/agarwl/received_events","type":"User","site_admin":false},"created_at":"2021-04-14T03:19:12Z","updated_at":"2021-04-14T03:21:13Z","author_association":"CONTRIBUTOR","body":"I think I have used the latest version (as that's the version we work with internally) -- this `run_optimizer_variable_init` version seems like a flag used by DrQ and set to False (so I suppose you should use the mainline version).\r\n\r\nRegarding CPU/GPU issue, it is likely that it is caused by the dataset being loaded on the CPU. Since the dataset is a `tf.data.TFRecordDataset`, I thought it should be automatically moved to the GPU but maybe we need an explicit with `with tf.device('/gpu:0')` call when running the contrastive part (also suggested by this [stackoverflow post](https://stackoverflow.com/questions/56008764/tensorflow-dataset-api-not-using-gpu/56026280)). Maybe something like [`prefetch_to_device`](https://www.tensorflow.org/api_docs/python/tf/data/experimental/prefetch_to_device) might help here to fix the issue. Yes, the dataset path seems fine to me otherwise it would thrown error in the data loading part itself. ","reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/comments/819199421/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"agarwl","id":12142945,"node_id":"MDQ6VXNlcjEyMTQyOTQ1","avatar_url":"https://avatars.githubusercontent.com/u/12142945?v=4","gravatar_id":"","url":"https://api.github.com/users/agarwl","html_url":"https://github.com/agarwl","followers_url":"https://api.github.com/users/agarwl/followers","following_url":"https://api.github.com/users/agarwl/following{/other_user}","gists_url":"https://api.github.com/users/agarwl/gists{/gist_id}","starred_url":"https://api.github.com/users/agarwl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agarwl/subscriptions","organizations_url":"https://api.github.com/users/agarwl/orgs","repos_url":"https://api.github.com/users/agarwl/repos","events_url":"https://api.github.com/users/agarwl/events{/privacy}","received_events_url":"https://api.github.com/users/agarwl/received_events","type":"User","site_admin":false}},{"id":4594521970,"node_id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDU5NDUyMTk3MA==","url":"https://api.github.com/repos/google-research/google-research/issues/events/4594521970","actor":{"login":"h8907283","id":19578156,"node_id":"MDQ6VXNlcjE5NTc4MTU2","avatar_url":"https://avatars.githubusercontent.com/u/19578156?v=4","gravatar_id":"","url":"https://api.github.com/users/h8907283","html_url":"https://github.com/h8907283","followers_url":"https://api.github.com/users/h8907283/followers","following_url":"https://api.github.com/users/h8907283/following{/other_user}","gists_url":"https://api.github.com/users/h8907283/gists{/gist_id}","starred_url":"https://api.github.com/users/h8907283/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/h8907283/subscriptions","organizations_url":"https://api.github.com/users/h8907283/orgs","repos_url":"https://api.github.com/users/h8907283/repos","events_url":"https://api.github.com/users/h8907283/events{/privacy}","received_events_url":"https://api.github.com/users/h8907283/received_events","type":"User","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2021-04-14T15:59:53Z","rename":{"from":"PSE on dm-control failed to run when contrastive_loss_weight isn't zero.","to":"PSE on dm-control failed to run when contrastive_loss_weight > 0."},"performed_via_github_app":null}]