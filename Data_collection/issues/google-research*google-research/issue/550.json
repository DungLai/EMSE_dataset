{"url":"https://api.github.com/repos/google-research/google-research/issues/550","repository_url":"https://api.github.com/repos/google-research/google-research","labels_url":"https://api.github.com/repos/google-research/google-research/issues/550/labels{/name}","comments_url":"https://api.github.com/repos/google-research/google-research/issues/550/comments","events_url":"https://api.github.com/repos/google-research/google-research/issues/550/events","html_url":"https://github.com/google-research/google-research/issues/550","id":799673805,"node_id":"MDU6SXNzdWU3OTk2NzM4MDU=","number":550,"title":"[uflow] NotImplementerError with numpy==1.20.0","user":{"login":"iegorval","id":23455259,"node_id":"MDQ6VXNlcjIzNDU1MjU5","avatar_url":"https://avatars.githubusercontent.com/u/23455259?v=4","gravatar_id":"","url":"https://api.github.com/users/iegorval","html_url":"https://github.com/iegorval","followers_url":"https://api.github.com/users/iegorval/followers","following_url":"https://api.github.com/users/iegorval/following{/other_user}","gists_url":"https://api.github.com/users/iegorval/gists{/gist_id}","starred_url":"https://api.github.com/users/iegorval/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iegorval/subscriptions","organizations_url":"https://api.github.com/users/iegorval/orgs","repos_url":"https://api.github.com/users/iegorval/repos","events_url":"https://api.github.com/users/iegorval/events{/privacy}","received_events_url":"https://api.github.com/users/iegorval/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-02-02T20:48:43Z","updated_at":"2021-02-02T20:48:43Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"I am using the following command:\r\n`python -m uflow.uflow_main --train_on=\"sintel:/mnt/d/Courses/CTU/Diploma/data/sintel-test-tf/test/final/\" --plot_dir=/mnt/d/Courses/CTU/Diploma/data/results/sintel-plots/ --checkpoint_dir=/mnt/d/Courses/CTU/Diploma/data/results/sintel-checkpoints/`\r\n\r\nThis gave me the following traceback with the `NonImplementedError`. This was solved by downgrading the `numpy` to 1.19.5. I guess, either the code should be updated to fix the error, or the `requirements.txt` should be updated to include only compatible numpy versions instead of `numpy>=1.18.3`, which installs the incompatible newer version.\r\n\r\n```\r\n.Traceback (most recent call last):\r\n  File \"/home/iegorval/anaconda3/lib/python3.7/runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"/home/iegorval/anaconda3/lib/python3.7/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/home/iegorval/Diploma/google-research/uflow/uflow_main.py\", line 379, in <module>\r\n    app.run(main)\r\n  File \"/home/iegorval/anaconda3/lib/python3.7/site-packages/absl/app.py\", line 303, in run\r\n    _run_main(main, args)\r\n  File \"/home/iegorval/anaconda3/lib/python3.7/site-packages/absl/app.py\", line 251, in _run_main\r\n    sys.exit(main(argv))\r\n  File \"/home/iegorval/Diploma/google-research/uflow/uflow_main.py\", line 345, in main\r\n    occ_active=occ_active)\r\n  File \"/home/iegorval/Diploma/google-research/uflow/uflow_net.py\", line 549, in train\r\n    occ_active=occ_active)\r\n  File \"/home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/eager/def_function.py\", line 828, in __call__\r\n    result = self._call(*args, **kwds)\r\n  File \"/home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/eager/def_function.py\", line 871, in _call\r\n    self._initialize(args, kwds, add_initializers_to=initializers)\r\n  File \"/home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/eager/def_function.py\", line 726, in _initialize\r\n    *args, **kwds))\r\n  File \"/home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/eager/function.py\", line 2969, in _get_concrete_function_internal_garbage_collected\r\n    graph_function, _ = self._maybe_define_function(args, kwargs)\r\n  File \"/home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/eager/function.py\", line 3361, in _maybe_define_function\r\n    graph_function = self._create_graph_function(args, kwargs)\r\n  File \"/home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/eager/function.py\", line 3206, in _create_graph_function\r\n    capture_by_value=self._capture_by_value),\r\n  File \"/home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/framework/func_graph.py\", line 990, in func_graph_from_py_func\r\n    func_outputs = python_func(*func_args, **func_kwargs)\r\n  File \"/home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/eager/def_function.py\", line 634, in wrapped_fn\r\n    out = weak_wrapped_fn().__wrapped__(*args, **kwds)\r\n  File \"/home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/eager/function.py\", line 3887, in bound_method_wrapper\r\n    return wrapped_fn(*args, **kwargs)\r\n  File \"/home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/framework/func_graph.py\", line 977, in wrapper\r\n    raise e.ag_error_metadata.to_exception(e)\r\nNotImplementedError: in user code:\r\n\r\n    /home/iegorval/Diploma/google-research/uflow/uflow_net.py:482 train_step  *\r\n        weights,\r\n    /home/iegorval/Diploma/google-research/uflow/uflow_net.py:453 train_step_no_tf_function  *\r\n        losses, gradients, variables = self._loss_and_grad(\r\n    /home/iegorval/Diploma/google-research/uflow/uflow_net.py:625 _loss_and_grad  *\r\n        losses = self.compute_loss(\r\n    /home/iegorval/Diploma/google-research/uflow/uflow_net.py:668 compute_loss  *\r\n        flows, selfsup_transform_fns = uflow_utils.compute_features_and_flow(\r\n    /home/iegorval/Diploma/google-research/uflow/uflow_utils.py:982 compute_features_and_flow  *\r\n        flow = teacher_flow_model(\r\n    /home/iegorval/Diploma/google-research/uflow/uflow_model.py:209 call  *\r\n        warp_up = uflow_utils.flow_to_warp(flow_up)\r\n    /home/iegorval/Diploma/google-research/uflow/uflow_utils.py:40 flow_to_warp  *\r\n        i_grid, j_grid = tf.meshgrid(\r\n    /home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/util/dispatch.py:201 wrapper  **\r\n        return target(*args, **kwargs)\r\n    /home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/ops/array_ops.py:3552 meshgrid\r\n        mult_fact = ones(shapes, output_dtype)\r\n    /home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/util/dispatch.py:201 wrapper\r\n        return target(*args, **kwargs)\r\n    /home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/ops/array_ops.py:3120 ones\r\n        output = _constant_if_small(one, shape, dtype, name)\r\n    /home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/ops/array_ops.py:2804 _constant_if_small\r\n        if np.prod(shape) < 1000:\r\n    <__array_function__ internals>:6 prod\r\n        \r\n    /home/iegorval/anaconda3/lib/python3.7/site-packages/numpy/core/fromnumeric.py:3031 prod\r\n        keepdims=keepdims, initial=initial, where=where)\r\n    /home/iegorval/anaconda3/lib/python3.7/site-packages/numpy/core/fromnumeric.py:87 _wrapreduction\r\n        return ufunc.reduce(obj, axis, dtype, out, **passkwargs)\r\n    /home/iegorval/anaconda3/lib/python3.7/site-packages/tensorflow/python/framework/ops.py:855 __array__\r\n        \" a NumPy call, which is not supported\".format(self.name))\r\n\r\n    NotImplementedError: Cannot convert a symbolic Tensor (pwc_flow/meshgrid/Size:0) to a numpy array. This error may indicate that you're trying to pass a Tensor to a NumPy call, which is not supported\r\n\r\n```","closed_by":null,"reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/550/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google-research/google-research/issues/550/timeline","performed_via_github_app":null,"state_reason":null}