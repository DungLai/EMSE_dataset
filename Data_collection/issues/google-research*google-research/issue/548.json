{"url":"https://api.github.com/repos/google-research/google-research/issues/548","repository_url":"https://api.github.com/repos/google-research/google-research","labels_url":"https://api.github.com/repos/google-research/google-research/issues/548/labels{/name}","comments_url":"https://api.github.com/repos/google-research/google-research/issues/548/comments","events_url":"https://api.github.com/repos/google-research/google-research/issues/548/events","html_url":"https://github.com/google-research/google-research/issues/548","id":798523385,"node_id":"MDU6SXNzdWU3OTg1MjMzODU=","number":548,"title":"[slot_attention] Effective dimensions of LayerNormalization","user":{"login":"vadimkantorov","id":1041752,"node_id":"MDQ6VXNlcjEwNDE3NTI=","avatar_url":"https://avatars.githubusercontent.com/u/1041752?v=4","gravatar_id":"","url":"https://api.github.com/users/vadimkantorov","html_url":"https://github.com/vadimkantorov","followers_url":"https://api.github.com/users/vadimkantorov/followers","following_url":"https://api.github.com/users/vadimkantorov/following{/other_user}","gists_url":"https://api.github.com/users/vadimkantorov/gists{/gist_id}","starred_url":"https://api.github.com/users/vadimkantorov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vadimkantorov/subscriptions","organizations_url":"https://api.github.com/users/vadimkantorov/orgs","repos_url":"https://api.github.com/users/vadimkantorov/repos","events_url":"https://api.github.com/users/vadimkantorov/events{/privacy}","received_events_url":"https://api.github.com/users/vadimkantorov/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2021-02-01T16:44:40Z","updated_at":"2021-02-03T14:29:01Z","closed_at":"2021-02-03T14:29:01Z","author_association":"NONE","active_lock_reason":null,"body":"@tkipf @dosovits, In https://github.com/google-research/google-research/blob/0c1bbe5/slot_attention/model.py#L43-L45:\r\n```python\r\nself.norm_inputs = layers.LayerNormalization()\r\nself.norm_slots = layers.LayerNormalization()\r\nself.norm_mlp = layers.LayerNormalization()\r\n```\r\n\r\nWith default arguments of [LayerNormalization](https://www.tensorflow.org/api_docs/python/tf/keras/layers/LayerNormalization), this means that implicitly `axis=-1`, `center=True`, `scale=True`\r\n\r\nDoes it mean that for it's equivalent (in PyTorch lingo) to:\r\n```python\r\nclass SlotAttentionLayerNorm(torch.nn.Module):\r\n   def __init__(self, inputs_size, epsilon = 1e-3):\r\n     super().__init__()\r\n     self.gamma = torch.nn.Parameter(torch.ones(inputs_size))\r\n     self.beta = torch.nn.Parameter(torch.zeros(inputs_size))\r\n     self.epsilon = epsilon\r\n\r\n  def forward(self, inputs):\r\n     # inputs` has shape [batch_size, num_inputs, inputs_size].\r\n     var, mean = torch.var_mean(inputs, dim = -1, keepdim = True)\r\n     return (inputs - mean) / (var + self.epsilon).sqrt() * self.gamma + self.beta\r\n```\r\n\r\nIronically, this seems to match what PyTorch LayerNorm does, but it doesn't match what LayerNorm is supposed to be doing (or even InstanceNorm for that matter). i.e. computing stats per whole batch instance `batch[b, ...]` :)\r\n![image](https://user-images.githubusercontent.com/1041752/106493465-746d9c80-64b9-11eb-992d-70b0323696cc.png)\r\n\r\nIf the above code is true, it's computing stats per `batch[b, h, w]` and standardizes the embedding vector themselves (does it even make sense?).\r\n\r\nThanks!","closed_by":{"login":"vadimkantorov","id":1041752,"node_id":"MDQ6VXNlcjEwNDE3NTI=","avatar_url":"https://avatars.githubusercontent.com/u/1041752?v=4","gravatar_id":"","url":"https://api.github.com/users/vadimkantorov","html_url":"https://github.com/vadimkantorov","followers_url":"https://api.github.com/users/vadimkantorov/followers","following_url":"https://api.github.com/users/vadimkantorov/following{/other_user}","gists_url":"https://api.github.com/users/vadimkantorov/gists{/gist_id}","starred_url":"https://api.github.com/users/vadimkantorov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vadimkantorov/subscriptions","organizations_url":"https://api.github.com/users/vadimkantorov/orgs","repos_url":"https://api.github.com/users/vadimkantorov/repos","events_url":"https://api.github.com/users/vadimkantorov/events{/privacy}","received_events_url":"https://api.github.com/users/vadimkantorov/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/548/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google-research/google-research/issues/548/timeline","performed_via_github_app":null,"state_reason":"completed"}