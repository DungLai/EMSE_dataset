{"url":"https://api.github.com/repos/google-research/google-research/issues/828","repository_url":"https://api.github.com/repos/google-research/google-research","labels_url":"https://api.github.com/repos/google-research/google-research/issues/828/labels{/name}","comments_url":"https://api.github.com/repos/google-research/google-research/issues/828/comments","events_url":"https://api.github.com/repos/google-research/google-research/issues/828/events","html_url":"https://github.com/google-research/google-research/issues/828","id":1006157490,"node_id":"I_kwDOCQmIhc47-L6y","number":828,"title":"[kws_streaming] Error about converting stream_state_internal KWS model to tflite with micro preprocess","user":{"login":"wenjingyang","id":4407779,"node_id":"MDQ6VXNlcjQ0MDc3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4407779?v=4","gravatar_id":"","url":"https://api.github.com/users/wenjingyang","html_url":"https://github.com/wenjingyang","followers_url":"https://api.github.com/users/wenjingyang/followers","following_url":"https://api.github.com/users/wenjingyang/following{/other_user}","gists_url":"https://api.github.com/users/wenjingyang/gists{/gist_id}","starred_url":"https://api.github.com/users/wenjingyang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wenjingyang/subscriptions","organizations_url":"https://api.github.com/users/wenjingyang/orgs","repos_url":"https://api.github.com/users/wenjingyang/repos","events_url":"https://api.github.com/users/wenjingyang/events{/privacy}","received_events_url":"https://api.github.com/users/wenjingyang/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2021-09-24T07:14:30Z","updated_at":"2021-10-19T08:10:22Z","closed_at":"2021-10-19T08:10:22Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, \r\nI had problem to convert stream_state_internal KWS model to tflite. I have tried to convert from both tfpb and h5. The issue is same. Does anyone have any idea? I used \"micro\" as preprocess.\r\n\r\nThanks. \r\n\r\nModel: \r\n[ds_cnn_stream.zip](https://github.com/google-research/google-research/files/7223822/ds_cnn_stream.zip)\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/temp/anaconda3/envs/py38/lib/python3.8/site-packages/tensorflow/python/framework/importer.py\", line 496, in _import_graph_def_internal\r\n    results = c_api.TF_GraphImportGraphDefWithResults(\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Input 0 of node functional_1/stream/AssignVariableOp was passed float from functional_1/stream/ReadVariableOp/resource:0 incompatible with expected resource.\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"run_convert.py\", line 16, in <module>\r\n    tfmodel = converter.convert()\r\n  File \"/home/temp/anaconda3/envs/py38/lib/python3.8/site-packages/tensorflow/lite/python/lite.py\", line 808, in convert\r\n    _convert_to_constants.convert_variables_to_constants_v2_as_graph(\r\n  File \"/home/temp/anaconda3/envs/py38/lib/python3.8/site-packages/tensorflow/python/framework/convert_to_constants.py\", line 1108, in convert_variables_to_constants_v2_as_graph\r\n    frozen_func = _construct_concrete_function(func, output_graph_def,\r\n  File \"/home/temp/anaconda3/envs/py38/lib/python3.8/site-packages/tensorflow/python/framework/convert_to_constants.py\", line 999, in _construct_concrete_function\r\n    new_func = wrap_function.function_from_graph_def(output_graph_def,\r\n  File \"/home/temp/anaconda3/envs/py38/lib/python3.8/site-packages/tensorflow/python/eager/wrap_function.py\", line 650, in function_from_graph_def\r\n    wrapped_import = wrap_function(_imports_graph_def, [])\r\n  File \"/home/temp/anaconda3/envs/py38/lib/python3.8/site-packages/tensorflow/python/eager/wrap_function.py\", line 621, in wrap_function\r\n    func_graph.func_graph_from_py_func(\r\n  File \"/home/temp/anaconda3/envs/py38/lib/python3.8/site-packages/tensorflow/python/framework/func_graph.py\", line 986, in func_graph_from_py_func\r\n    func_outputs = python_func(*func_args, **func_kwargs)\r\n  File \"/home/temp/anaconda3/envs/py38/lib/python3.8/site-packages/tensorflow/python/eager/wrap_function.py\", line 87, in __call__\r\n    return self.call_with_variable_creator_scope(self._fn)(*args, **kwargs)\r\n  File \"/home/temp/anaconda3/envs/py38/lib/python3.8/site-packages/tensorflow/python/eager/wrap_function.py\", line 93, in wrapped\r\n    return fn(*args, **kwargs)\r\n  File \"/home/temp/anaconda3/envs/py38/lib/python3.8/site-packages/tensorflow/python/eager/wrap_function.py\", line 648, in _imports_graph_def\r\n    importer.import_graph_def(graph_def, name=\"\")\r\n  File \"/home/temp/anaconda3/envs/py38/lib/python3.8/site-packages/tensorflow/python/util/deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"/home/temp/anaconda3/envs/py38/lib/python3.8/site-packages/tensorflow/python/framework/importer.py\", line 400, in import_graph_def\r\n    return _import_graph_def_internal(\r\n  File \"/home/temp/anaconda3/envs/py38/lib/python3.8/site-packages/tensorflow/python/framework/importer.py\", line 501, in _import_graph_def_internal\r\n    raise ValueError(str(e))\r\nValueError: Input 0 of node functional_1/stream/AssignVariableOp was passed float from functional_1/stream/ReadVariableOp/resource:0 incompatible with expected resource.\r\n","closed_by":{"login":"wenjingyang","id":4407779,"node_id":"MDQ6VXNlcjQ0MDc3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4407779?v=4","gravatar_id":"","url":"https://api.github.com/users/wenjingyang","html_url":"https://github.com/wenjingyang","followers_url":"https://api.github.com/users/wenjingyang/followers","following_url":"https://api.github.com/users/wenjingyang/following{/other_user}","gists_url":"https://api.github.com/users/wenjingyang/gists{/gist_id}","starred_url":"https://api.github.com/users/wenjingyang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wenjingyang/subscriptions","organizations_url":"https://api.github.com/users/wenjingyang/orgs","repos_url":"https://api.github.com/users/wenjingyang/repos","events_url":"https://api.github.com/users/wenjingyang/events{/privacy}","received_events_url":"https://api.github.com/users/wenjingyang/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/828/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google-research/google-research/issues/828/timeline","performed_via_github_app":null,"state_reason":"completed"}