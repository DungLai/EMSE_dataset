{"url":"https://api.github.com/repos/google-research/google-research/issues/581","repository_url":"https://api.github.com/repos/google-research/google-research","labels_url":"https://api.github.com/repos/google-research/google-research/issues/581/labels{/name}","comments_url":"https://api.github.com/repos/google-research/google-research/issues/581/comments","events_url":"https://api.github.com/repos/google-research/google-research/issues/581/events","html_url":"https://github.com/google-research/google-research/issues/581","id":812874310,"node_id":"MDU6SXNzdWU4MTI4NzQzMTA=","number":581,"title":"CuBERT Pretraining Dedup Process code? Identical SHAs in manifest","user":{"login":"DNGros","id":5520022,"node_id":"MDQ6VXNlcjU1MjAwMjI=","avatar_url":"https://avatars.githubusercontent.com/u/5520022?v=4","gravatar_id":"","url":"https://api.github.com/users/DNGros","html_url":"https://github.com/DNGros","followers_url":"https://api.github.com/users/DNGros/followers","following_url":"https://api.github.com/users/DNGros/following{/other_user}","gists_url":"https://api.github.com/users/DNGros/gists{/gist_id}","starred_url":"https://api.github.com/users/DNGros/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DNGros/subscriptions","organizations_url":"https://api.github.com/users/DNGros/orgs","repos_url":"https://api.github.com/users/DNGros/repos","events_url":"https://api.github.com/users/DNGros/events{/privacy}","received_events_url":"https://api.github.com/users/DNGros/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-02-21T15:00:00Z","updated_at":"2021-03-09T18:18:20Z","closed_at":"2021-03-09T18:18:19Z","author_association":"NONE","active_lock_reason":null,"body":"When downloading the CuBERT pretraining corpus, I encountered some questions with the deduping process. Section 3.2 of [the paper](https://arxiv.org/pdf/2001.00059.pdf) mentions that there was a deduping process:\r\n\r\n> .... This brought the dataset to 14.3 million files. We then further deduplicated the remaining files, by clustering them into equivalence classes holding similar files according to the same similarity metric, and keeping only one exemplar per equivalence class.This helps avoid biasing the pre-trained embedding. Finally,we removed files that could not be parsed. In the end, we were left with 7.4 million Python files containing over 9.3 billion tokens. This is our Python pre-training code corpus.\r\n\r\nI downloaded [the manifest files](https://console.cloud.google.com/storage/browser/cubert/20200621_Python/github_python_minus_ethpy150open_deduplicated_manifest). There are indeed ~7.4M blobs. However, only about 4.1M of the SHAs are unique, implying over 3M point to repeat files. There about 0.9M instances of the SHA e69de29bb2d1d6434b8b29ae775ad8c2e48c5391 which appears to correspond to an empty file. There are also thousands that correspond things like Django default files or 2626 instances of a SHA that corresponds to [a file from chardetection](https://github.com/splunk/TA-GitHubStats/blob/ce4eab957e6d9840d4230209b17d85d0162bc3e7/bin/chardet/euckrfreq.py) which could slightly confuse modeling. See [this gist](https://gist.github.com/DNGros/1a1bfaaac0544b1b53bf20a301d61b50) if want to see how I checked the SHAs.\r\n\r\nAny thoughts on why there might be identical SHAs? I don't see the scripts used for deduping in the repo, but deduping is rather difficult, so I get there are ways it could go wrong in confusing ways.\r\n\r\nCC: @adityakanade @maniatis","closed_by":{"login":"DNGros","id":5520022,"node_id":"MDQ6VXNlcjU1MjAwMjI=","avatar_url":"https://avatars.githubusercontent.com/u/5520022?v=4","gravatar_id":"","url":"https://api.github.com/users/DNGros","html_url":"https://github.com/DNGros","followers_url":"https://api.github.com/users/DNGros/followers","following_url":"https://api.github.com/users/DNGros/following{/other_user}","gists_url":"https://api.github.com/users/DNGros/gists{/gist_id}","starred_url":"https://api.github.com/users/DNGros/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DNGros/subscriptions","organizations_url":"https://api.github.com/users/DNGros/orgs","repos_url":"https://api.github.com/users/DNGros/repos","events_url":"https://api.github.com/users/DNGros/events{/privacy}","received_events_url":"https://api.github.com/users/DNGros/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/581/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google-research/google-research/issues/581/timeline","performed_via_github_app":null,"state_reason":"completed"}