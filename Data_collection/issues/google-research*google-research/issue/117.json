{"url":"https://api.github.com/repos/google-research/google-research/issues/117","repository_url":"https://api.github.com/repos/google-research/google-research","labels_url":"https://api.github.com/repos/google-research/google-research/issues/117/labels{/name}","comments_url":"https://api.github.com/repos/google-research/google-research/issues/117/comments","events_url":"https://api.github.com/repos/google-research/google-research/issues/117/events","html_url":"https://github.com/google-research/google-research/issues/117","id":518184437,"node_id":"MDU6SXNzdWU1MTgxODQ0Mzc=","number":117,"title":"AlBERT v2 got No gradient defined for operation 'module_apply_tokens/bert/encoder/transformer/group_0_11/layer_11/inner_group_0/ffn_1/intermediate/output/dense/einsum/Einsum error","user":{"login":"liuqiangict","id":5917797,"node_id":"MDQ6VXNlcjU5MTc3OTc=","avatar_url":"https://avatars.githubusercontent.com/u/5917797?v=4","gravatar_id":"","url":"https://api.github.com/users/liuqiangict","html_url":"https://github.com/liuqiangict","followers_url":"https://api.github.com/users/liuqiangict/followers","following_url":"https://api.github.com/users/liuqiangict/following{/other_user}","gists_url":"https://api.github.com/users/liuqiangict/gists{/gist_id}","starred_url":"https://api.github.com/users/liuqiangict/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuqiangict/subscriptions","organizations_url":"https://api.github.com/users/liuqiangict/orgs","repos_url":"https://api.github.com/users/liuqiangict/repos","events_url":"https://api.github.com/users/liuqiangict/events{/privacy}","received_events_url":"https://api.github.com/users/liuqiangict/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-11-06T01:43:45Z","updated_at":"2019-11-06T03:23:45Z","closed_at":"2019-11-06T03:23:45Z","author_association":"NONE","active_lock_reason":null,"body":"When I try using the albert v2  as follow command, got errors as below. while v1 works good as expected.\r\n\r\nCUDA_VISIBLE_DEVICES=0 python run_classifier_with_tfhub.py \\\r\n    --trainnig_data_dir=./data/train/ \\\r\n    --validation_data_dir=./data/eval/ \\\r\n    --do_lower_case=False \\\r\n    --albert_hub_module_handle=https://tfhub.dev/google/albert_xxlarge/2 \\\r\n    --spm_model_file=./model/albert_xxlarge/30k-clean.model \\\r\n    --task_name=MRPC \\\r\n    --max_seq_length=128 \\\r\n    --do_train \\\r\n    --do_eval \\\r\n    --train_batch_size=16 \\\r\n    --eval_batch_size=4 \\\r\n    --learning_rate=2e-5 \\\r\n    --num_train_epochs=3.0 \\\r\n    --output_dir=./xxlarge\r\n\r\n\r\nTraceback (most recent call last):\r\n  File \"run_classifier_with_tfhub.py\", line 366, in <module>\r\n    tf.app.run()\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow_core/python/platform/app.py\", line 40, in run\r\n    _run(main=main, argv=argv, flags_parser=_parse_flags_tolerate_undef)\r\n  File \"/usr/local/lib/python3.6/dist-packages/absl/app.py\", line 300, in run\r\n    _run_main(main, args)\r\n  File \"/usr/local/lib/python3.6/dist-packages/absl/app.py\", line 251, in _run_main\r\n    sys.exit(main(argv))\r\n  File \"run_classifier_with_tfhub.py\", line 269, in main\r\n    estimator.train(input_fn=train_input_fn, max_steps=num_train_steps)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py\", line 3035, in train\r\n    rendezvous.raise_errors()\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow_estimator/python/estimator/tpu/error_handling.py\", line 136, in raise_errors\r\n    six.reraise(typ, value, traceback)\r\n  File \"/usr/local/lib/python3.6/dist-packages/six.py\", line 696, in reraise\r\n    raise value\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py\", line 3030, in train\r\n    saving_listeners=saving_listeners)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow_estimator/python/estimator/estimator.py\", line 370, in train\r\n    loss = self._train_model(input_fn, hooks, saving_listeners)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow_estimator/python/estimator/estimator.py\", line 1161, in _train_model\r\n    return self._train_model_default(input_fn, hooks, saving_listeners)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow_estimator/python/estimator/estimator.py\", line 1191, in _train_model_default\r\n    features, labels, ModeKeys.TRAIN, self.config)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py\", line 2857, in _call_model_fn\r\n    config)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow_estimator/python/estimator/estimator.py\", line 1149, in _call_model_fn\r\n    model_fn_results = self._model_fn(features=features, **kwargs)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py\", line 3126, in _model_fn\r\n    features, labels, is_export_mode=is_export_mode)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py\", line 1663, in call_without_tpu\r\n    return self._call_model_fn(features, labels, is_export_mode=is_export_mode)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py\", line 1994, in _call_model_fn\r\n    estimator_spec = self._model_fn(features=features, **kwargs)\r\n  File \"run_classifier_with_tfhub.py\", line 123, in model_fn\r\n    total_loss, learning_rate, num_train_steps, num_warmup_steps, use_tpu)\r\n  File \"/home/qiangliu/Git/Mine/albert_online/optimization.py\", line 103, in create_optimizer\r\n    grads = tf.gradients(loss, tvars)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow_core/python/ops/gradients_impl.py\", line 158, in gradients\r\n    unconnected_gradients)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow_core/python/ops/gradients_util.py\", line 637, in _GradientsHelper\r\n    (op.name, op.type))\r\nLookupError: **No gradient defined for operation 'module_apply_tokens/bert/encoder/transformer/group_0_11/layer_11/inner_group_0/ffn_1/intermediate/output/dense/einsum/Einsum**' (op type: Einsum)\r\n\r\nDid I missed something there?","closed_by":{"login":"liuqiangict","id":5917797,"node_id":"MDQ6VXNlcjU5MTc3OTc=","avatar_url":"https://avatars.githubusercontent.com/u/5917797?v=4","gravatar_id":"","url":"https://api.github.com/users/liuqiangict","html_url":"https://github.com/liuqiangict","followers_url":"https://api.github.com/users/liuqiangict/followers","following_url":"https://api.github.com/users/liuqiangict/following{/other_user}","gists_url":"https://api.github.com/users/liuqiangict/gists{/gist_id}","starred_url":"https://api.github.com/users/liuqiangict/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuqiangict/subscriptions","organizations_url":"https://api.github.com/users/liuqiangict/orgs","repos_url":"https://api.github.com/users/liuqiangict/repos","events_url":"https://api.github.com/users/liuqiangict/events{/privacy}","received_events_url":"https://api.github.com/users/liuqiangict/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/117/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google-research/google-research/issues/117/timeline","performed_via_github_app":null,"state_reason":"completed"}