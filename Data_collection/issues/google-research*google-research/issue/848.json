{"url":"https://api.github.com/repos/google-research/google-research/issues/848","repository_url":"https://api.github.com/repos/google-research/google-research","labels_url":"https://api.github.com/repos/google-research/google-research/issues/848/labels{/name}","comments_url":"https://api.github.com/repos/google-research/google-research/issues/848/comments","events_url":"https://api.github.com/repos/google-research/google-research/issues/848/events","html_url":"https://github.com/google-research/google-research/issues/848","id":1029193631,"node_id":"I_kwDOCQmIhc49WD-f","number":848,"title":"[kws_Sreaming] Error while reloading trained weights in CRNN model","user":{"login":"vishalkevat007","id":29162378,"node_id":"MDQ6VXNlcjI5MTYyMzc4","avatar_url":"https://avatars.githubusercontent.com/u/29162378?v=4","gravatar_id":"","url":"https://api.github.com/users/vishalkevat007","html_url":"https://github.com/vishalkevat007","followers_url":"https://api.github.com/users/vishalkevat007/followers","following_url":"https://api.github.com/users/vishalkevat007/following{/other_user}","gists_url":"https://api.github.com/users/vishalkevat007/gists{/gist_id}","starred_url":"https://api.github.com/users/vishalkevat007/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vishalkevat007/subscriptions","organizations_url":"https://api.github.com/users/vishalkevat007/orgs","repos_url":"https://api.github.com/users/vishalkevat007/repos","events_url":"https://api.github.com/users/vishalkevat007/events{/privacy}","received_events_url":"https://api.github.com/users/vishalkevat007/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2021-10-18T14:26:33Z","updated_at":"2021-10-29T01:38:27Z","closed_at":"2021-10-29T01:38:26Z","author_association":"NONE","active_lock_reason":null,"body":"@rybakov I have been trying to resume the CRNN model training by loading the \"best_weights.h5\" in HDF5 format. \r\nI have changed the [train.py](https://github.com/google-research/google-research/blob/master/kws_streaming/train/train.py) code by adding \r\n`model.save_weights(flags.train_dir + 'best_weights.h5')`  after [here](https://github.com/google-research/google-research/blob/master/kws_streaming/train/train.py#L201) \r\nand loading back the model using `model.load_weights(flags.train_dir + 'best_weights.h5')` [here](https://github.com/google-research/google-research/blob/master/kws_streaming/train/train.py#L129)\r\n\r\nBut I am getting an error saying `AttributeError: 'GRU' object has no attribute 'reset_after'`\r\n\r\n```\r\n~\\anaconda3\\envs\\tf-nightly\\lib\\site-packages\\keras\\engine\\training_v1.py in load_weights(self, filepath, by_name, skip_mismatch)\r\n    212         raise ValueError('Load weights is not yet supported with TPUStrategy '\r\n    213                          'with steps_per_run greater than 1.')\r\n--> 214     return super(Model, self).load_weights(filepath, by_name, skip_mismatch)\r\n    215 \r\n    216   @tf.__internal__.tracking.no_automatic_dependency_tracking\r\n\r\n~\\anaconda3\\envs\\tf-nightly\\lib\\site-packages\\keras\\utils\\traceback_utils.py in error_handler(*args, **kwargs)\r\n     65     except Exception as e:  # pylint: disable=broad-except\r\n     66       filtered_tb = _process_traceback_frames(e.__traceback__)\r\n---> 67       raise e.with_traceback(filtered_tb) from None\r\n     68     finally:\r\n     69       del filtered_tb\r\n\r\n~\\anaconda3\\envs\\tf-nightly\\lib\\site-packages\\keras\\saving\\hdf5_format.py in _convert_rnn_weights(layer, weights)\r\n    561     if target_class == 'CuDNNGRU':\r\n    562       target = 'CuDNNGRU'\r\n--> 563     elif layer.reset_after:\r\n    564       target = 'GRU(reset_after=True)'\r\n    565     else:\r\n\r\nAttributeError: 'GRU' object has no attribute 'reset_after'\r\n```\r\nPreviously I used SVDF model in which there was no such error while reloading the \"best_weights.h5\" , the weights were loading successfully for the SVDF model. \r\n\r\nI am using a big custom dataset, that's why I need to resume the model training from previously left accuracy. Can you @rybakov please help me to fix this for CRNN model.","closed_by":{"login":"vishalkevat007","id":29162378,"node_id":"MDQ6VXNlcjI5MTYyMzc4","avatar_url":"https://avatars.githubusercontent.com/u/29162378?v=4","gravatar_id":"","url":"https://api.github.com/users/vishalkevat007","html_url":"https://github.com/vishalkevat007","followers_url":"https://api.github.com/users/vishalkevat007/followers","following_url":"https://api.github.com/users/vishalkevat007/following{/other_user}","gists_url":"https://api.github.com/users/vishalkevat007/gists{/gist_id}","starred_url":"https://api.github.com/users/vishalkevat007/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vishalkevat007/subscriptions","organizations_url":"https://api.github.com/users/vishalkevat007/orgs","repos_url":"https://api.github.com/users/vishalkevat007/repos","events_url":"https://api.github.com/users/vishalkevat007/events{/privacy}","received_events_url":"https://api.github.com/users/vishalkevat007/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/848/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google-research/google-research/issues/848/timeline","performed_via_github_app":null,"state_reason":"completed"}