{"url":"https://api.github.com/repos/google-research/google-research/issues/427","repository_url":"https://api.github.com/repos/google-research/google-research","labels_url":"https://api.github.com/repos/google-research/google-research/issues/427/labels{/name}","comments_url":"https://api.github.com/repos/google-research/google-research/issues/427/comments","events_url":"https://api.github.com/repos/google-research/google-research/issues/427/events","html_url":"https://github.com/google-research/google-research/issues/427","id":724804465,"node_id":"MDU6SXNzdWU3MjQ4MDQ0NjU=","number":427,"title":"[ScaNN] searcher serialize fails with std::bad_alloc, plenty of space left on machine","user":{"login":"orm011","id":565364,"node_id":"MDQ6VXNlcjU2NTM2NA==","avatar_url":"https://avatars.githubusercontent.com/u/565364?v=4","gravatar_id":"","url":"https://api.github.com/users/orm011","html_url":"https://github.com/orm011","followers_url":"https://api.github.com/users/orm011/followers","following_url":"https://api.github.com/users/orm011/following{/other_user}","gists_url":"https://api.github.com/users/orm011/gists{/gist_id}","starred_url":"https://api.github.com/users/orm011/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orm011/subscriptions","organizations_url":"https://api.github.com/users/orm011/orgs","repos_url":"https://api.github.com/users/orm011/repos","events_url":"https://api.github.com/users/orm011/events{/privacy}","received_events_url":"https://api.github.com/users/orm011/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-10-19T17:05:17Z","updated_at":"2021-02-05T04:23:01Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"The input data was ~10M vectors of 2048 dim each, the searcher was successfully built after 14 minutes, and there were hundreds of GB to spare (several multiples of the space used by the searcher itself), but it was not possible to to save it\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nMemoryError                               Traceback (most recent call last)\r\n<ipython-input-33-3451ef45ab69> in <module>\r\n      1 os.makedirs('.data/scann_artifacts/test', exist_ok=True)\r\n----> 2 searcher.serialize('./data/scann_artifacts/test')\r\n\r\n~/.conda/envs/vsms/lib/python3.7/site-packages/scann/scann_ops/py/scann_ops_pybind.py in serialize(self, artifacts_dir)\r\n     70 \r\n     71   def serialize(self, artifacts_dir):\r\n---> 72     self.searcher.serialize(artifacts_dir)\r\n     73 \r\n     74 \r\n\r\nMemoryError: std::bad_alloc\r\n```\r\n\r\nThe problem goes away if I build the searcher with the first 2M vectors.","closed_by":null,"reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/427/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google-research/google-research/issues/427/timeline","performed_via_github_app":null,"state_reason":null}