{"url":"https://api.github.com/repos/google-research/google-research/issues/408","repository_url":"https://api.github.com/repos/google-research/google-research","labels_url":"https://api.github.com/repos/google-research/google-research/issues/408/labels{/name}","comments_url":"https://api.github.com/repos/google-research/google-research/issues/408/comments","events_url":"https://api.github.com/repos/google-research/google-research/issues/408/events","html_url":"https://github.com/google-research/google-research/issues/408","id":711438626,"node_id":"MDU6SXNzdWU3MTE0Mzg2MjY=","number":408,"title":"Move KWS preprocessing layers and fail to save model","user":{"login":"tu1258","id":59950011,"node_id":"MDQ6VXNlcjU5OTUwMDEx","avatar_url":"https://avatars.githubusercontent.com/u/59950011?v=4","gravatar_id":"","url":"https://api.github.com/users/tu1258","html_url":"https://github.com/tu1258","followers_url":"https://api.github.com/users/tu1258/followers","following_url":"https://api.github.com/users/tu1258/following{/other_user}","gists_url":"https://api.github.com/users/tu1258/gists{/gist_id}","starred_url":"https://api.github.com/users/tu1258/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tu1258/subscriptions","organizations_url":"https://api.github.com/users/tu1258/orgs","repos_url":"https://api.github.com/users/tu1258/repos","events_url":"https://api.github.com/users/tu1258/events{/privacy}","received_events_url":"https://api.github.com/users/tu1258/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-09-29T20:44:50Z","updated_at":"2020-09-30T13:31:14Z","closed_at":"2020-09-30T13:31:14Z","author_association":"NONE","active_lock_reason":null,"body":"I put some work to minimize the code. What I exactly do is to move the sublayers inside SpeechFeature layer to model.py(let's say tc_resnet.py for instance). But now I fail to save model.(It can be trained without any bug.) This is not a bug, it's just my dumb question instead but maybe @rybakov know what I should do? I am sorry to bother you again. I've done so many changes but the the code structure doesn't change much.\r\n\r\n### To make it clear, this is what I do. I think you would understand instantly ðŸ˜„\r\n```\r\n  # net = speech_features.SpeechFeatures(\r\n  #       speech_features.SpeechFeatures.get_params(flags),\r\n  #       name='feature_layer')(\r\n  #         net)\r\n  net = dataframe.DataFrame(\r\n        inference_batch_size=1,\r\n        frame_size=frame_size,\r\n        frame_step=frame_stride)(\r\n        net)\r\n  net = windowing.Windowing(\r\n        window_size=frame_size, \r\n        window_type=flags.window_type)(\r\n        net)\r\n  net = magnitude_rdft_mel.MagnitudeRDFTmel(\r\n        num_mel_bins=flags.mel_num_bins,\r\n        lower_edge_hertz=flags.mel_lower_edge_hertz,\r\n        upper_edge_hertz=flags.mel_upper_edge_hertz,\r\n        sample_rate=flags.sample_rate,\r\n        mel_non_zero_only=flags.mel_non_zero_only)(\r\n        net)\r\n  net = Lambda(lambda x: tf.math.log(tf.math.maximum(x, flags.log_epsilon)))(net)\r\n  net = dct.DCT(num_features=flags.dct_num_features)(net)\r\n```\r\n\r\nThe error I got when running this line `model.save(path_model, include_optimizer=False, save_format='tf')`\r\n**Error**\r\n`'Not JSON Serializable:', Namespace(background_frequency=0.8, background_volume=0.1, batch_size=1, bn=0, channels='36, 36, 36, 36, 36, 36, 36', clip_duration_ms=1000, data_dir='./data_test', dct_num_features=30, debug=0, desired_samples=16000, dropout=0.0, eval_step_interval=200, first_kernel='(1,1)', generate=0, groups=1, how_many_training_epochs='1', kernel_size='(3,1)', label_count=12, learning_rate='0.001', log_epsilon=1e-12, lr_schedule='linear', mel_lower_edge_hertz=20.0, mel_non_zero_only=1, mel_num_bins=80, mel_upper_edge_hertz=7000.0, mobile=1, optimizer='adam', preemph=0.0, print=0, qkeras=0, resample=0.15, residual=0, sample_rate=16000, save_step_interval=1000, silence_percentage=10.0, spectrogram_length=49, start_checkpoint='', summaries_dir='./tcn/kws_test/logs/', testing_percentage=10, time_shift_ms=100.0, train=1, train_dir='./tcn/kws_test', unknown_percentage=10.0, validation_percentage=10, volume_resample=0.0, wanted_words='yes,no,up,down,left,right,on,off,stop,go', window_size_ms=40.0, window_size_samples=640, window_stride_ms=20.0, window_stride_samples=320, window_type='hann'))`","closed_by":{"login":"tu1258","id":59950011,"node_id":"MDQ6VXNlcjU5OTUwMDEx","avatar_url":"https://avatars.githubusercontent.com/u/59950011?v=4","gravatar_id":"","url":"https://api.github.com/users/tu1258","html_url":"https://github.com/tu1258","followers_url":"https://api.github.com/users/tu1258/followers","following_url":"https://api.github.com/users/tu1258/following{/other_user}","gists_url":"https://api.github.com/users/tu1258/gists{/gist_id}","starred_url":"https://api.github.com/users/tu1258/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tu1258/subscriptions","organizations_url":"https://api.github.com/users/tu1258/orgs","repos_url":"https://api.github.com/users/tu1258/repos","events_url":"https://api.github.com/users/tu1258/events{/privacy}","received_events_url":"https://api.github.com/users/tu1258/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/408/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google-research/google-research/issues/408/timeline","performed_via_github_app":null,"state_reason":"completed"}