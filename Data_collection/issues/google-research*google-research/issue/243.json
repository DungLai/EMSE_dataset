{"url":"https://api.github.com/repos/google-research/google-research/issues/243","repository_url":"https://api.github.com/repos/google-research/google-research","labels_url":"https://api.github.com/repos/google-research/google-research/issues/243/labels{/name}","comments_url":"https://api.github.com/repos/google-research/google-research/issues/243/comments","events_url":"https://api.github.com/repos/google-research/google-research/issues/243/events","html_url":"https://github.com/google-research/google-research/issues/243","id":598401765,"node_id":"MDU6SXNzdWU1OTg0MDE3NjU=","number":243,"title":"TabNet Training is slow","user":{"login":"ptuls","id":1995167,"node_id":"MDQ6VXNlcjE5OTUxNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1995167?v=4","gravatar_id":"","url":"https://api.github.com/users/ptuls","html_url":"https://github.com/ptuls","followers_url":"https://api.github.com/users/ptuls/followers","following_url":"https://api.github.com/users/ptuls/following{/other_user}","gists_url":"https://api.github.com/users/ptuls/gists{/gist_id}","starred_url":"https://api.github.com/users/ptuls/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptuls/subscriptions","organizations_url":"https://api.github.com/users/ptuls/orgs","repos_url":"https://api.github.com/users/ptuls/repos","events_url":"https://api.github.com/users/ptuls/events{/privacy}","received_events_url":"https://api.github.com/users/ptuls/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-04-12T03:31:41Z","updated_at":"2021-10-31T03:02:04Z","closed_at":"2020-04-12T07:35:15Z","author_association":"NONE","active_lock_reason":null,"body":"First of, I'd like to thank the authors for their interesting work! I'm not sure how to make a pull request to this repository, so I'll leave my thoughts here regarding TabNet training. \r\n\r\n**Problem**:\r\nTabNet training is slow because the parsing of the CSV is performed on the entire file each time, instead of performed over a single batch each time (see [line](https://github.com/google-research/google-research/blob/432ad195830f3722e2d2bc6dfe5f39991c384806/tabnet/data_helper_covertype.py#L126)). This results in overhead in CPU processing, reducing the utilization of the GPU. \r\n\r\n**Solution**:\r\nIn order to improve the training speed, we set the batching operation before the mapping operation so that the mapping operation only operates on a smaller set of data each iteration as follows:\r\n```\r\n    dataset = dataset.batch(batch_size, drop_remainder=True)\r\n    dataset = dataset.map(parse_csv, num_parallel_calls=n_parallel)\r\n\r\n    # Repeat after shuffling, to prevent separate epochs from blending together.\r\n    dataset = dataset.repeat(num_epochs)\r\n    return dataset\r\n```\r\nIn terms of GPU utilization on an RTX2080Ti, I am getting about 70% utilization compared to 28% previously. More could potentially be done but this is a start.\r\n\r\n**Caveat**:\r\nThe unfortunate side-effect of this is that the last small batch would be dropped. Fortunately this has not impacted accuracy on a test set.\r\n\r\nPadding was tried, but I think I am not getting the shapes right, so I've used this as a solution in the interim.\r\n\r\n**Testing**:\r\nShown here are the test accuracy and test loss when tested on the CoverType dataset. When tested on the CoverType dataset, the accuracy reached on the test set is 96.23% for the final model.\r\n\r\n![image](https://user-images.githubusercontent.com/1995167/79059722-bcb89580-7cc0-11ea-9bb6-3087f2a58fdf.png)\r\n\r\n![image](https://user-images.githubusercontent.com/1995167/79059768-2f297580-7cc1-11ea-9027-2acf825d0eb3.png)\r\n","closed_by":{"login":"ptuls","id":1995167,"node_id":"MDQ6VXNlcjE5OTUxNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1995167?v=4","gravatar_id":"","url":"https://api.github.com/users/ptuls","html_url":"https://github.com/ptuls","followers_url":"https://api.github.com/users/ptuls/followers","following_url":"https://api.github.com/users/ptuls/following{/other_user}","gists_url":"https://api.github.com/users/ptuls/gists{/gist_id}","starred_url":"https://api.github.com/users/ptuls/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptuls/subscriptions","organizations_url":"https://api.github.com/users/ptuls/orgs","repos_url":"https://api.github.com/users/ptuls/repos","events_url":"https://api.github.com/users/ptuls/events{/privacy}","received_events_url":"https://api.github.com/users/ptuls/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/243/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google-research/google-research/issues/243/timeline","performed_via_github_app":null,"state_reason":"completed"}