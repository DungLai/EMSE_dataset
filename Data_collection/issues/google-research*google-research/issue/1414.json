{"url":"https://api.github.com/repos/google-research/google-research/issues/1414","repository_url":"https://api.github.com/repos/google-research/google-research","labels_url":"https://api.github.com/repos/google-research/google-research/issues/1414/labels{/name}","comments_url":"https://api.github.com/repos/google-research/google-research/issues/1414/comments","events_url":"https://api.github.com/repos/google-research/google-research/issues/1414/events","html_url":"https://github.com/google-research/google-research/issues/1414","id":1483559189,"node_id":"I_kwDOCQmIhc5YbVEV","number":1414,"title":"kws_streaming Expected bool for argument 'enable_pcan' not 1","user":{"login":"StuartIanNaylor","id":2593098,"node_id":"MDQ6VXNlcjI1OTMwOTg=","avatar_url":"https://avatars.githubusercontent.com/u/2593098?v=4","gravatar_id":"","url":"https://api.github.com/users/StuartIanNaylor","html_url":"https://github.com/StuartIanNaylor","followers_url":"https://api.github.com/users/StuartIanNaylor/followers","following_url":"https://api.github.com/users/StuartIanNaylor/following{/other_user}","gists_url":"https://api.github.com/users/StuartIanNaylor/gists{/gist_id}","starred_url":"https://api.github.com/users/StuartIanNaylor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/StuartIanNaylor/subscriptions","organizations_url":"https://api.github.com/users/StuartIanNaylor/orgs","repos_url":"https://api.github.com/users/StuartIanNaylor/repos","events_url":"https://api.github.com/users/StuartIanNaylor/events{/privacy}","received_events_url":"https://api.github.com/users/StuartIanNaylor/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-12-08T04:04:31Z","updated_at":"2022-12-09T12:35:23Z","closed_at":"2022-12-09T12:35:22Z","author_association":"NONE","active_lock_reason":null,"body":"@rybakov \r\nI thought I would try a ds_cnn on a esp32-s3 and thought the following would be correct as `--preprocess 'micro'` is needed as the other micro params are defaults.\r\n```\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.10/runpy.py\", line 196, in _run_module_as_main\r\n    return _run_code(code, main_globals, None,\r\n  File \"/usr/lib/python3.10/runpy.py\", line 86, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/home/stuart/GoogleKWS/kws_streaming/train/model_train_eval.py\", line 380, in <module>\r\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\r\n  File \"/home/stuart/GoogleKWS/venv/lib/python3.10/site-packages/tensorflow/python/platform/app.py\", line 36, in run\r\n    _run(main=main, argv=argv, flags_parser=_parse_flags_tolerate_undef)\r\n  File \"/home/stuart/GoogleKWS/venv/lib/python3.10/site-packages/absl/app.py\", line 308, in run\r\n    _run_main(main, args)\r\n  File \"/home/stuart/GoogleKWS/venv/lib/python3.10/site-packages/absl/app.py\", line 254, in _run_main\r\n    sys.exit(main(argv))\r\n  File \"/home/stuart/GoogleKWS/kws_streaming/train/model_train_eval.py\", line 156, in main\r\n    train.train(flags)\r\n  File \"/home/stuart/GoogleKWS/kws_streaming/train/train.py\", line 55, in train\r\n    audio_processor = input_data.AudioProcessor(flags)\r\n  File \"/home/stuart/GoogleKWS/kws_streaming/data/input_data.py\", line 127, in __init__\r\n    self.prepare_processing_graph(flags)\r\n  File \"/home/stuart/GoogleKWS/kws_streaming/data/input_data.py\", line 520, in prepare_processing_graph\r\n    micro_frontend = frontend_op.audio_microfrontend(\r\n  File \"/home/stuart/GoogleKWS/venv/lib/python3.10/site-packages/tensorflow/lite/experimental/microfrontend/python/ops/audio_microfrontend_op.py\", line 104, in audio_microfrontend\r\n    return gen_audio_microfrontend_op.audio_microfrontend(\r\n  File \"/home/stuart/GoogleKWS/venv/lib/python3.10/site-packages/tensorflow/lite/experimental/microfrontend/ops/gen_audio_microfrontend_op.py\", line 217, in audio_microfrontend\r\n    enable_pcan = _execute.make_bool(enable_pcan, \"enable_pcan\")\r\n  File \"/home/stuart/GoogleKWS/venv/lib/python3.10/site-packages/tensorflow/python/eager/execute.py\", line 175, in make_bool\r\n    raise TypeError(\"Expected bool for argument '%s' not %s.\" %\r\nTypeError: Expected bool for argument 'enable_pcan' not 1.\r\n```\r\nI am using tensorflow2.11.0 as trying to work out what works best with my RTX30 series card and CUDA, so maybe its a bug due to being fresh or maybe its the params I used.\r\nIts been a while since I looked at kws_streaming when I had a Gtx1070 as also when end checking accuracy the cuda drivers do not seem to like a GRU layer and accuracy shows approx 30% even though via TFLite they run well.\r\nSo could all be me as my memory is bad and still a bit confused, but I have enabled --feature_type 'mfcc_op' as the esp32-s3 has no problem with fft and --preprocess 'micro' but get the above.\r\nThe examples are great but would be wonderful to have one also for micro but still scratching my head slightly as with [esp32_dl ](https://github.com/espressif/esp-dl) Onnx like with others seems to be flavor of the month so maybe it just take a full TF model and convert from there, but anyway...\r\n```\r\n$CMD_TRAIN \\\r\n--data_url '' \\\r\n--data_dir $DATA_PATH/ \\\r\n--train_dir $MODELS_PATH/ds_cnn_stream_micro/ \\\r\n--split_data 0 \\\r\n--wanted_words 'heymarvin,noise,unk,h1m1,h2m1,h1m2,h2m2' \\\r\n--mel_upper_edge_hertz 7600 \\\r\n--how_many_training_steps 10000,10000,5000,5000,5000,5000 \\\r\n--learning_rate 0.001,0.0005,0.0002,0.0001,0.00005,0.00001 \\\r\n--window_size_ms 40.0 \\\r\n--window_stride_ms 20.0 \\\r\n--mel_num_bins 40 \\\r\n--dct_num_features 20 \\\r\n--resample 0.0 \\\r\n--background_frequency 0.0 \\\r\n--alsologtostderr \\\r\n--train 1 \\\r\n--lr_schedule 'exp' \\\r\n--use_spec_augment 1 \\\r\n--time_masks_number 2 \\\r\n--time_mask_max_size 10 \\\r\n--frequency_masks_number 2 \\\r\n--frequency_mask_max_size 5 \\\r\n--feature_type 'mfcc_op' \\\r\n--fft_magnitude_squared 1 \\\r\n--preprocess 'micro' \\\r\nds_cnn \\\r\n--cnn1_kernel_size \"(3,3)\" \\\r\n--cnn1_dilation_rate \"(2,1)\" \\\r\n--cnn1_strides \"(1,1)\" \\\r\n--cnn1_padding \"valid\" \\\r\n--cnn1_filters 300 \\\r\n--cnn1_act 'relu' \\\r\n--bn_momentum 0.98 \\\r\n--bn_center 1 \\\r\n--bn_scale 0 \\\r\n--bn_renorm 0 \\\r\n--dw2_kernel_size '(3,3),(3,3),(10,3),(5,3),(10,3)' \\\r\n--dw2_dilation_rate '(1,1),(2,2),(1,1),(2,2),(1,1)' \\\r\n--dw2_strides '(1,1),(1,1),(1,1),(1,1),(1,1)' \\\r\n--dw2_padding \"valid\" \\\r\n--dw2_act \"'relu','relu','relu','relu','relu'\" \\\r\n--cnn2_filters '300,300,300,300,300' \\\r\n--cnn2_act \"'relu','relu','relu','relu','relu'\" \\\r\n--dropout1 0.2\r\n```\r\n\r\nIs that correct and all that is needed is --fft_magnitude_squared & --preprocess 'micro'  or should it of just been ---preprocess 'micro'?\r\nAlso since I last looked there are a few more quantisation flags that I will also have to have a look at but thought would just ask whilst here as for quant from memory you just enabled --feature_type 'mfcc_op' is that different now?\r\n\r\nThanks.\r\n\r\nPS yeah `--micro_enable_pcan True \\` fixes it","closed_by":{"login":"StuartIanNaylor","id":2593098,"node_id":"MDQ6VXNlcjI1OTMwOTg=","avatar_url":"https://avatars.githubusercontent.com/u/2593098?v=4","gravatar_id":"","url":"https://api.github.com/users/StuartIanNaylor","html_url":"https://github.com/StuartIanNaylor","followers_url":"https://api.github.com/users/StuartIanNaylor/followers","following_url":"https://api.github.com/users/StuartIanNaylor/following{/other_user}","gists_url":"https://api.github.com/users/StuartIanNaylor/gists{/gist_id}","starred_url":"https://api.github.com/users/StuartIanNaylor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/StuartIanNaylor/subscriptions","organizations_url":"https://api.github.com/users/StuartIanNaylor/orgs","repos_url":"https://api.github.com/users/StuartIanNaylor/repos","events_url":"https://api.github.com/users/StuartIanNaylor/events{/privacy}","received_events_url":"https://api.github.com/users/StuartIanNaylor/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/1414/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google-research/google-research/issues/1414/timeline","performed_via_github_app":null,"state_reason":"completed"}