{"url":"https://api.github.com/repos/google-research/google-research/issues/282","repository_url":"https://api.github.com/repos/google-research/google-research","labels_url":"https://api.github.com/repos/google-research/google-research/issues/282/labels{/name}","comments_url":"https://api.github.com/repos/google-research/google-research/issues/282/comments","events_url":"https://api.github.com/repos/google-research/google-research/issues/282/events","html_url":"https://github.com/google-research/google-research/issues/282","id":623882121,"node_id":"MDU6SXNzdWU2MjM4ODIxMjE=","number":282,"title":"Implement the distributed version of dql_grasping","user":{"login":"YantianZha","id":9017839,"node_id":"MDQ6VXNlcjkwMTc4Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/9017839?v=4","gravatar_id":"","url":"https://api.github.com/users/YantianZha","html_url":"https://github.com/YantianZha","followers_url":"https://api.github.com/users/YantianZha/followers","following_url":"https://api.github.com/users/YantianZha/following{/other_user}","gists_url":"https://api.github.com/users/YantianZha/gists{/gist_id}","starred_url":"https://api.github.com/users/YantianZha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YantianZha/subscriptions","organizations_url":"https://api.github.com/users/YantianZha/orgs","repos_url":"https://api.github.com/users/YantianZha/repos","events_url":"https://api.github.com/users/YantianZha/events{/privacy}","received_events_url":"https://api.github.com/users/YantianZha/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-05-24T15:03:13Z","updated_at":"2020-05-24T15:03:13Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Hello All,\r\n\r\nI am using TensorFlow-gpu 1.15.2 python3 on Ubuntu 18.04. I noted that the dql_grasping was originally made on a distributed system but I cannot find the corresponding pipeline code. Hence I decide to make one by following [this tutorial](https://github.com/tensorflow/examples/blob/master/community/en/docs/deploy/distributed.md). My purpose is to run the distributed version of dql_grasping on a machine with 1 CPU and multiple GPUs (this can be extended later). However, I got the following error regarding the initialization some slim variables. Note that these TruncatedNormal variables are defined in dql_grasping/tf_modules.py\r\n\r\nIf anyone happens to have similar issue, or already have the working code of running drl_grasping in a distributed system, please let me know. Thanks!\r\n  \r\nFile \"/home/yy/DRL/google-research-master/dql_grasping/run_train_collect_eval.py\", line 144, in <module>\r\n    app.run(main)\r\n  File \"/home/yy/.local/lib/python3.6/site-packages/absl/app.py\", line 299, in run\r\n    _run_main(main, args)\r\n  File \"/home/yy/.local/lib/python3.6/site-packages/absl/app.py\", line 250, in _run_main\r\n    sys.exit(main(argv))\r\n  File \"/home/yy/DRL/google-research-master/dql_grasping/run_train_collect_eval_parallel.py\", line 124, in main\r\n    worker_device=worker_device)\r\n  File \"/home/yy/DRL/venv/lib/python3.6/site-packages/gin/config.py\", line 1078, in gin_wrapper\r\n    utils.augment_exception_message_and_reraise(e, err_str)\r\n  File \"/home/yy/DRL/venv/lib/python3.6/site-packages/gin/utils.py\", line 49, in augment_exception_message_and_reraise\r\n    six.raise_from(proxy.with_traceback(exception.__traceback__), None)\r\n  File \"<string>\", line 3, in raise_from\r\n  File \"/home/yy/DRL/venv/lib/python3.6/site-packages/gin/config.py\", line 1055, in gin_wrapper\r\n    return fn(*new_args, **new_kwargs)\r\n  File \"/home/yy/DRL/google-research-master/dql_grasping/train_collect_eval.py\", line 127, in train_collect_eval\r\n    policy = policy_class()\r\n  File \"/home/yy/DRL/venv/lib/python3.6/site-packages/gin/config.py\", line 1078, in gin_wrapper\r\n    utils.augment_exception_message_and_reraise(e, err_str)\r\n  File \"/home/yy/DRL/venv/lib/python3.6/site-packages/gin/utils.py\", line 49, in augment_exception_message_and_reraise\r\n    six.raise_from(proxy.with_traceback(exception.__traceback__), None)\r\n  File \"<string>\", line 3, in raise_from\r\n  File \"/home/yy/DRL/venv/lib/python3.6/site-packages/gin/config.py\", line 1055, in gin_wrapper\r\n    return fn(*new_args, **new_kwargs)\r\n  File \"/home/yy/DRL/google-research-master/dql_grasping/policies.py\", line 178, in __init__\r\n    self._greedy_policy = greedy_policy_class()\r\n  File \"/home/yy/DRL/venv/lib/python3.6/site-packages/gin/config.py\", line 1078, in gin_wrapper\r\n    utils.augment_exception_message_and_reraise(e, err_str)\r\n  File \"/home/yy/DRL/venv/lib/python3.6/site-packages/gin/utils.py\", line 49, in augment_exception_message_and_reraise\r\n    six.raise_from(proxy.with_traceback(exception.__traceback__), None)\r\n  File \"<string>\", line 3, in raise_from\r\n  File \"/home/yy/DRL/venv/lib/python3.6/site-packages/gin/config.py\", line 1055, in gin_wrapper\r\n    return fn(*new_args, **new_kwargs)\r\n  File \"/home/yy/DRL/google-research-master/dql_grasping/policies.py\", line 237, in __init__\r\n    q_func, state_shape, use_gpu=use_gpu, checkpoint=checkpoint)\r\n  File \"/home/yy/DRL/google-research-master/dql_grasping/policies.py\", line 107, in __init__\r\n    self._sess.run(init_op)\r\n  File \"/home/yy/DRL/venv/lib/python3.6/site-packages/tensorflow_core/python/client/session.py\", line 956, in run\r\n    run_metadata_ptr)\r\n  File \"/home/yy/DRL/venv/lib/python3.6/site-packages/tensorflow_core/python/client/session.py\", line 1180, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"/home/yy/DRL/venv/lib/python3.6/site-packages/tensorflow_core/python/client/session.py\", line 1359, in _do_run\r\n    run_metadata)\r\n  File \"/home/yy/DRL/venv/lib/python3.6/site-packages/tensorflow_core/python/client/session.py\", line 1384, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Cannot assign a device for operation q_func/Conv/weights/Initializer/truncated_normal/TruncatedNormal: Could not satisfy explicit device specification '' because the node node q_func/Conv/weights/Initializer/truncated_normal/TruncatedNormal (defined at /DRL/venv/lib/python3.6/site-packages/tensorflow_core/python/framework/ops.py:1748) placed on device Device assignments active during op 'q_func/Conv/weights/Initializer/truncated_normal/TruncatedNormal' creation:\r\n...\r\nColocation Debug Info:\r\nColocation group had the following types and supported devices: \r\nRoot Member(assigned_device_name_index_=-1 requested_device_name_='/job:ps/task:0/device:CPU:0' assigned_device_name_='' resource_device_name_='/job:ps/task:0/device:CPU:0' supported_device_types_=[GPU, CPU, XLA_CPU, XLA_GPU] possible_devices_=[]\r\nReadVariableOp: GPU CPU XLA_CPU XLA_GPU \r\nAssignVariableOp: GPU CPU XLA_CPU XLA_GPU \r\nMul: GPU CPU XLA_CPU XLA_GPU \r\nTruncatedNormal: GPU CPU XLA_CPU XLA_GPU \r\nAdd: GPU CPU XLA_CPU XLA_GPU \r\nVarHandleOp: GPU CPU XLA_CPU XLA_GPU \r\nConst: GPU CPU XLA_CPU XLA_GPU \r\nVarIsInitializedOp: GPU CPU XLA_CPU XLA_GPU \r\n\r\nColocation members, user-requested devices, and framework assigned devices, if any:\r\n  q_func/Conv/weights/Initializer/truncated_normal/shape (Const) \r\n  q_func/Conv/weights/Initializer/truncated_normal/mean (Const) \r\n  q_func/Conv/weights/Initializer/truncated_normal/stddev (Const) \r\n  q_func/Conv/weights/Initializer/truncated_normal/TruncatedNormal (TruncatedNormal) \r\n  q_func/Conv/weights/Initializer/truncated_normal/mul (Mul) \r\n  q_func/Conv/weights/Initializer/truncated_normal (Add) \r\n  q_func/Conv/weights (VarHandleOp) /job:ps/task:0/device:CPU:0\r\n  q_func/Conv/weights/IsInitialized/VarIsInitializedOp (VarIsInitializedOp) /job:worker/task:0\r\n  q_func/Conv/weights/Assign (AssignVariableOp) /job:ps/task:0/device:CPU:0\r\n  q_func/Conv/weights/Read/ReadVariableOp (ReadVariableOp) /job:ps/task:0/device:CPU:0\r\n  q_func/Conv/Conv2D/ReadVariableOp (ReadVariableOp) /job:ps/task:0/device:CPU:0\r\n  save/AssignVariableOp_2 (AssignVariableOp) /job:ps/task:0/device:CPU:0\r\n\r\n\t [[node q_func/Conv/weights/Initializer/truncated_normal/TruncatedNormal (defined at /DRL/venv/lib/python3.6/site-packages/tensorflow_core/python/framework/ops.py:1748) ]]Additional information about colocations:No node-device colocations were active during op 'q_func/Conv/weights/Initializer/truncated_normal/TruncatedNormal' creation.\r\nDevice assignments active during op 'q_func/Conv/weights/Initializer/truncated_normal/TruncatedNormal' creation:\r\n  with tf.device(None): </home/yy/DRL/venv/lib/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1535>\r\n  with tf.device(): </home/yy/DRL/venv/lib/python3.6/site-packages/tensorflow_core/contrib/framework/python/ops/variables.py:268>\r\n  with tf.device(_ReplicaDeviceChooser.device_function</home/yy/DRL/venv/lib/python3.6/site-packages/tensorflow_core/python/training/device_setter.py, 99>): </home/yy/DRL/google-research-master/dql_grasping/train_collect_eval.py:126>\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/282/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google-research/google-research/issues/282/timeline","performed_via_github_app":null,"state_reason":null}