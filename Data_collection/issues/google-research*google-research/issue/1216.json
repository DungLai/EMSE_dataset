{"url":"https://api.github.com/repos/google-research/google-research/issues/1216","repository_url":"https://api.github.com/repos/google-research/google-research","labels_url":"https://api.github.com/repos/google-research/google-research/issues/1216/labels{/name}","comments_url":"https://api.github.com/repos/google-research/google-research/issues/1216/comments","events_url":"https://api.github.com/repos/google-research/google-research/issues/1216/events","html_url":"https://github.com/google-research/google-research/issues/1216","id":1321132965,"node_id":"I_kwDOCQmIhc5OvuOl","number":1216,"title":"[Poem] L2-VIPE checkpoint exception","user":{"login":"YQZ530","id":35812742,"node_id":"MDQ6VXNlcjM1ODEyNzQy","avatar_url":"https://avatars.githubusercontent.com/u/35812742?v=4","gravatar_id":"","url":"https://api.github.com/users/YQZ530","html_url":"https://github.com/YQZ530","followers_url":"https://api.github.com/users/YQZ530/followers","following_url":"https://api.github.com/users/YQZ530/following{/other_user}","gists_url":"https://api.github.com/users/YQZ530/gists{/gist_id}","starred_url":"https://api.github.com/users/YQZ530/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YQZ530/subscriptions","organizations_url":"https://api.github.com/users/YQZ530/orgs","repos_url":"https://api.github.com/users/YQZ530/repos","events_url":"https://api.github.com/users/YQZ530/events{/privacy}","received_events_url":"https://api.github.com/users/YQZ530/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-07-28T15:32:36Z","updated_at":"2022-09-14T19:55:28Z","closed_at":"2022-09-14T19:55:28Z","author_association":"NONE","active_lock_reason":null,"body":"Hello,\r\nwhen I try to run infer.py with L2-VIPE checkpoint I got couples of exceptions and they all related to something called \" NOT_FOUND: Key SimpleModel/OutputLogits/C0/embedding_stddevs/bias not found in checkpoint\".  Anyone has any idea to fix that? Thank you.\r\n\r\n\r\nfull stack trace:\r\n\r\nWARNING:tensorflow:From /Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/compat/v2_compat.py:107: disable_resource_variables (from tensorflow.python.ops.variable_scope) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nnon-resource variables are not supported in the long term\r\n/Users/labptop/Desktop/Models/ViewInvariantModel/poem/core/models.py:85: UserWarning: `tf.layers.batch_normalization` is deprecated and will be removed in a future version. Please use `tf.keras.layers.BatchNormalization` instead. In particular, `tf.control_dependencies(tf.GraphKeys.UPDATE_OPS)` should not be used (consult the `tf.keras.layers.BatchNormalization` documentation).\r\n  net = tf.layers.batch_normalization(\r\nINFO:tensorflow:Graph was finalized.\r\nI0728 11:22:16.444565 4388341248 monitored_session.py:243] Graph was finalized.\r\n2022-07-28 11:22:16.444939: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA\r\nTo enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\r\nINFO:tensorflow:Restoring parameters from ./poem/tmp/checkpoint2/model.ckpt-01104395\r\nI0728 11:22:16.446062 4388341248 saver.py:1412] Restoring parameters from ./poem/tmp/checkpoint2/model.ckpt-01104395\r\n2022-07-28 11:22:16.450572: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:354] MLIR V1 optimization pass is not enabled\r\n2022-07-28 11:22:16.479388: W tensorflow/core/framework/op_kernel.cc:1745] OP_REQUIRES failed at save_restore_v2_ops.cc:228 : NOT_FOUND: Key SimpleModel/OutputLogits/C0/embedding_stddevs/bias not found in checkpoint\r\nTraceback (most recent call last):\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/client/session.py\", line 1377, in _do_call\r\n    return fn(*args)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/client/session.py\", line 1360, in _run_fn\r\n    return self._call_tf_sessionrun(options, feed_dict, fetch_list,\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/client/session.py\", line 1453, in _call_tf_sessionrun\r\n    return tf_session.TF_SessionRun_wrapper(self._session, options, feed_dict,\r\ntensorflow.python.framework.errors_impl.NotFoundError: Key SimpleModel/OutputLogits/C0/embedding_stddevs/bias not found in checkpoint\r\n         [[{{node save/RestoreV2}}]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 1417, in restore\r\n    sess.run(self.saver_def.restore_op_name,\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/client/session.py\", line 967, in run\r\n    result = self._run(None, fetches, feed_dict, options_ptr,\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/client/session.py\", line 1190, in _run\r\n    results = self._do_run(handle, final_targets, final_fetches,\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/client/session.py\", line 1370, in _do_run\r\n    return self._do_call(_run_fn, feeds, fetches, targets, options,\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/client/session.py\", line 1396, in _do_call\r\n    raise type(e)(node_def, op, message)  # pylint: disable=no-value-for-parameter\r\ntensorflow.python.framework.errors_impl.NotFoundError: Graph execution error:\r\n\r\nDetected at node 'save/RestoreV2' defined at (most recent call last):\r\n    File \"/Users/labptop/Desktop/Models/ViewInvariantModel/infer.py\", line 283, in <module>\r\n      app.run(main)\r\n    File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/absl/app.py\", line 308, in run\r\n      _run_main(main, args)\r\n    File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/absl/app.py\", line 254, in _run_main\r\n      sys.exit(main(argv))\r\n    File \"/Users/labptop/Desktop/Models/ViewInvariantModel/infer.py\", line 253, in main\r\n      saver = tf.train.Saver()\r\nNode: 'save/RestoreV2'\r\nKey SimpleModel/OutputLogits/C0/embedding_stddevs/bias not found in checkpoint\r\n         [[{{node save/RestoreV2}}]]\r\n\r\nOriginal stack trace for 'save/RestoreV2':\r\n  File \"/Users/labptop/Desktop/Models/ViewInvariantModel/infer.py\", line 283, in <module>\r\n    app.run(main)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/absl/app.py\", line 308, in run\r\n    _run_main(main, args)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/absl/app.py\", line 254, in _run_main\r\n    sys.exit(main(argv))\r\n  File \"/Users/labptop/Desktop/Models/ViewInvariantModel/infer.py\", line 253, in main\r\n    saver = tf.train.Saver()\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 933, in __init__\r\n    self.build()\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 945, in build\r\n    self._build(self._filename, build_save=True, build_restore=True)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 973, in _build\r\n    self.saver_def = self._builder._build_internal(  # pylint: disable=protected-access\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 543, in _build_internal\r\n    restore_op = self._AddRestoreOps(filename_tensor, saveables,\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 363, in _AddRestoreOps\r\n    all_tensors = self.bulk_restore(filename_tensor, saveables, preferred_shard,\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 611, in bulk_restore\r\n    return io_ops.restore_v2(filename_tensor, names, slices, dtypes)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/ops/gen_io_ops.py\", line 1501, in restore_v2\r\n    _, _, _op, _outputs = _op_def_library._apply_op_helper(\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/framework/op_def_library.py\", line 797, in _apply_op_helper\r\n    op = g._create_op_internal(op_type_name, inputs, dtypes=None,\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/framework/ops.py\", line 3754, in _create_op_internal\r\n    ret = Operation(\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/framework/ops.py\", line 2133, in __init__\r\n    self._traceback = tf_stack.extract_stack_for_node(self._c_op)\r\n\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/py_checkpoint_reader.py\", line 66, in get_tensor\r\n    return CheckpointReader.CheckpointReader_GetTensor(\r\nRuntimeError: Key _CHECKPOINTABLE_OBJECT_GRAPH not found in checkpoint\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 1428, in restore\r\n    names_to_keys = object_graph_key_mapping(save_path)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 1749, in object_graph_key_mapping\r\n    object_graph_string = reader.get_tensor(trackable.OBJECT_GRAPH_PROTO_KEY)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/py_checkpoint_reader.py\", line 71, in get_tensor\r\n    error_translator(e)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/py_checkpoint_reader.py\", line 31, in error_translator\r\n    raise errors_impl.NotFoundError(None, None, error_message)\r\ntensorflow.python.framework.errors_impl.NotFoundError: Key _CHECKPOINTABLE_OBJECT_GRAPH not found in checkpoint\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/labptop/Desktop/Models/ViewInvariantModel/infer.py\", line 283, in <module>\r\n    app.run(main)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/absl/app.py\", line 308, in run\r\n    _run_main(main, args)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/absl/app.py\", line 254, in _run_main\r\n    sys.exit(main(argv))\r\n  File \"/Users/labptop/Desktop/Models/ViewInvariantModel/infer.py\", line 262, in main\r\n    with tf.train.MonitoredSession(\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/monitored_session.py\", line 1054, in __init__\r\n    super(MonitoredSession, self).__init__(\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/monitored_session.py\", line 757, in __init__\r\n    self._sess = _RecoverableSession(self._coordinated_creator)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/monitored_session.py\", line 1263, in __init__\r\n    _WrappedSession.__init__(self, self._create_session())\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/monitored_session.py\", line 1268, in _create_session\r\n    return self._sess_creator.create_session()\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/monitored_session.py\", line 910, in create_session\r\n    self.tf_sess = self._session_creator.create_session()\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/monitored_session.py\", line 669, in create_session\r\n    return self._get_session_manager().prepare_session(\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/session_manager.py\", line 310, in prepare_session\r\n    sess, is_loaded_from_checkpoint = self._restore_checkpoint(\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/session_manager.py\", line 229, in _restore_checkpoint\r\n    _restore_checkpoint_and_maybe_run_saved_model_initializers(\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/session_manager.py\", line 67, in _restore_checkpoint_and_maybe_run_saved_model_initializers\r\n    saver.restore(sess, path)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 1433, in restore\r\n    raise _wrap_restore_error_with_msg(\r\ntensorflow.python.framework.errors_impl.NotFoundError: Restoring from checkpoint failed. This is most likely due to a Variable name or other graph key that is missing from the checkpoint. Please ensure that you have not altered the graph expected based on the checkpoint. Original error:\r\n\r\nGraph execution error:\r\n\r\nDetected at node 'save/RestoreV2' defined at (most recent call last):\r\n    File \"/Users/labptop/Desktop/Models/ViewInvariantModel/infer.py\", line 283, in <module>\r\n      app.run(main)\r\n    File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/absl/app.py\", line 308, in run\r\n      _run_main(main, args)\r\n    File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/absl/app.py\", line 254, in _run_main\r\n      sys.exit(main(argv))\r\n    File \"/Users/labptop/Desktop/Models/ViewInvariantModel/infer.py\", line 253, in main\r\n      saver = tf.train.Saver()\r\nNode: 'save/RestoreV2'\r\nKey SimpleModel/OutputLogits/C0/embedding_stddevs/bias not found in checkpoint\r\n         [[{{node save/RestoreV2}}]]\r\n\r\nOriginal stack trace for 'save/RestoreV2':\r\n  File \"/Users/labptop/Desktop/Models/ViewInvariantModel/infer.py\", line 283, in <module>\r\n    app.run(main)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/absl/app.py\", line 308, in run\r\n    _run_main(main, args)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/absl/app.py\", line 254, in _run_main\r\n    sys.exit(main(argv))\r\n  File \"/Users/labptop/Desktop/Models/ViewInvariantModel/infer.py\", line 253, in main\r\n    saver = tf.train.Saver()\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 933, in __init__\r\n    self.build()\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 945, in build\r\n    self._build(self._filename, build_save=True, build_restore=True)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 973, in _build\r\n    self.saver_def = self._builder._build_internal(  # pylint: disable=protected-access\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 543, in _build_internal\r\n    restore_op = self._AddRestoreOps(filename_tensor, saveables,\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 363, in _AddRestoreOps\r\n    all_tensors = self.bulk_restore(filename_tensor, saveables, preferred_shard,\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/training/saver.py\", line 611, in bulk_restore\r\n    return io_ops.restore_v2(filename_tensor, names, slices, dtypes)\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/ops/gen_io_ops.py\", line 1501, in restore_v2\r\n    _, _, _op, _outputs = _op_def_library._apply_op_helper(\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/framework/op_def_library.py\", line 797, in _apply_op_helper\r\n    op = g._create_op_internal(op_type_name, inputs, dtypes=None,\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/framework/ops.py\", line 3754, in _create_op_internal\r\n    ret = Operation(\r\n  File \"/Users/labptop/opt/anaconda3/envs/model1/lib/python3.9/site-packages/tensorflow/python/framework/ops.py\", line 2133, in __init__\r\n    self._traceback = tf_stack.extract_stack_for_node(self._c_op)\r\n\r\n\r\n","closed_by":{"login":"YQZ530","id":35812742,"node_id":"MDQ6VXNlcjM1ODEyNzQy","avatar_url":"https://avatars.githubusercontent.com/u/35812742?v=4","gravatar_id":"","url":"https://api.github.com/users/YQZ530","html_url":"https://github.com/YQZ530","followers_url":"https://api.github.com/users/YQZ530/followers","following_url":"https://api.github.com/users/YQZ530/following{/other_user}","gists_url":"https://api.github.com/users/YQZ530/gists{/gist_id}","starred_url":"https://api.github.com/users/YQZ530/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YQZ530/subscriptions","organizations_url":"https://api.github.com/users/YQZ530/orgs","repos_url":"https://api.github.com/users/YQZ530/repos","events_url":"https://api.github.com/users/YQZ530/events{/privacy}","received_events_url":"https://api.github.com/users/YQZ530/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/1216/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google-research/google-research/issues/1216/timeline","performed_via_github_app":null,"state_reason":"completed"}