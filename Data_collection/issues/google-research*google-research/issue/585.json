{"url":"https://api.github.com/repos/google-research/google-research/issues/585","repository_url":"https://api.github.com/repos/google-research/google-research","labels_url":"https://api.github.com/repos/google-research/google-research/issues/585/labels{/name}","comments_url":"https://api.github.com/repos/google-research/google-research/issues/585/comments","events_url":"https://api.github.com/repos/google-research/google-research/issues/585/events","html_url":"https://github.com/google-research/google-research/issues/585","id":815624443,"node_id":"MDU6SXNzdWU4MTU2MjQ0NDM=","number":585,"title":"Problem in running behavior_regularized_actor_critic","user":{"login":"SamuelePolimi","id":17749114,"node_id":"MDQ6VXNlcjE3NzQ5MTE0","avatar_url":"https://avatars.githubusercontent.com/u/17749114?v=4","gravatar_id":"","url":"https://api.github.com/users/SamuelePolimi","html_url":"https://github.com/SamuelePolimi","followers_url":"https://api.github.com/users/SamuelePolimi/followers","following_url":"https://api.github.com/users/SamuelePolimi/following{/other_user}","gists_url":"https://api.github.com/users/SamuelePolimi/gists{/gist_id}","starred_url":"https://api.github.com/users/SamuelePolimi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SamuelePolimi/subscriptions","organizations_url":"https://api.github.com/users/SamuelePolimi/orgs","repos_url":"https://api.github.com/users/SamuelePolimi/repos","events_url":"https://api.github.com/users/SamuelePolimi/events{/privacy}","received_events_url":"https://api.github.com/users/SamuelePolimi/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-02-24T16:11:32Z","updated_at":"2021-02-24T16:11:32Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Hi, \r\n\r\nThe dependencies you detail in the `requirements.txt` are not working.\r\n\r\nLong story short: \r\n\r\n1. Update the `readme.md` by saying that to run the code, `python==3.6` is needed (I actually tested in on `python3.6.9`). (This step can be made via `virtualenv --python=/usr/bin/python3.6 ~/env`)\r\n2. Update the `requirements.txt` as follow:\r\n\r\n```\r\ntensorflow==2.2.0\r\ntensorflow-probability=0.10.1\r\ncloudpickle==1.3.0\r\n```\r\n\r\nHere, I detail the reason for this update.\r\n\r\n\r\nI followed all the steps described, using virtual env and installing the prerequisites.\r\nDoing that, I get the following error from `pip`:\r\n\r\n```\r\nCollecting absl-py>=0.5.0\r\n  Using cached absl_py-0.11.0-py3-none-any.whl (127 kB)\r\nCollecting numpy>=1.13.3\r\n  Using cached numpy-1.20.1-cp38-cp38-manylinux2010_x86_64.whl (15.4 MB)\r\nERROR: Could not find a version that satisfies the requirement tensorflow==1.14.0\r\nERROR: No matching distribution found for tensorflow==1.14.0\r\n```\r\n\r\nI found out that this issue is given because I was using python 3.8.\r\nI, therefore, recreated the virtual environment using python 3.6.\r\nDoing that, the installation of the requirements proceed fine. However, once running \r\n\r\n```\r\npython -m train_online \\\r\n --sub_dir=0 \\\r\n --env_name=HalfCheetah-v2 \\\r\n --eval_target=4000 \\\r\n --agent_name=sac \\\r\n --total_train_steps=500000 \\\r\n --gin_bindings=\"train_eval_online.model_params=(((300, 300), (200, 200),), 2)\" \\\r\n --gin_bindings=\"train_eval_online.batch_size=256\" \\\r\n --gin_bindings=\"train_eval_online.optimizers=(('adam', 0.0005),)\"\r\n```\r\n\r\nI get a long list of warnings \r\n\r\n```\r\n/home/samuele/env/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint8 = np.dtype([(\"qint8\", np.int8, 1)])\r\n/home/samuele/env/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint8 = np.dtype([(\"quint8\", np.uint8, 1)])\r\n/home/samuele/env/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint16 = np.dtype([(\"qint16\", np.int16, 1)])\r\n/home/samuele/env/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint16 = np.dtype([(\"quint16\", np.uint16, 1)])\r\n/home/samuele/env/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint32 = np.dtype([(\"qint32\", np.int32, 1)])\r\n/home/samuele/env/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  np_resource = np.dtype([(\"resource\", np.ubyte, 1)])\r\n/home/samuele/env/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint8 = np.dtype([(\"qint8\", np.int8, 1)])\r\n/home/samuele/env/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint8 = np.dtype([(\"quint8\", np.uint8, 1)])\r\n/home/samuele/env/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint16 = np.dtype([(\"qint16\", np.int16, 1)])\r\n/home/samuele/env/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint16 = np.dtype([(\"quint16\", np.uint16, 1)])\r\n/home/samuele/env/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint32 = np.dtype([(\"qint32\", np.int32, 1)])\r\n/home/samuele/env/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  np_resource = np.dtype([(\"resource\", np.ubyte, 1)])\r\n```\r\n\r\n followed by an error\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.6/runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"/usr/lib/python3.6/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/home/samuele/Projects/google_research/behavior_regularized_offline_rl/brac/train_online.py\", line 35, in <module>\r\n    tf.compat.v1.enable_v2_behavior()\r\nAttributeError: module 'tensorflow._api.v1.compat.v1.compat' has no attribute 'v1'\r\n```\r\n\r\nAfter seeing this error, I installed the newest `tensorflow==2.4.1`, which, instead, raises the issue\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.6/runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"/usr/lib/python3.6/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/home/samuele/Projects/google_research/behavior_regularized_offline_rl/brac/train_online.py\", line 32, in <module>\r\n    from behavior_regularized_offline_rl.brac import train_eval_online\r\n  File \"/home/samuele/Projects/google_research/behavior_regularized_offline_rl/brac/train_eval_online.py\", line 32, in <module>\r\n    from behavior_regularized_offline_rl.brac import train_eval_utils\r\n  File \"/home/samuele/Projects/google_research/behavior_regularized_offline_rl/brac/train_eval_utils.py\", line 25, in <module>\r\n    from tf_agents.environments import suite_mujoco\r\n  File \"/home/samuele/env/lib/python3.6/site-packages/tf_agents/environments/__init__.py\", line 26, in <module>\r\n    from tf_agents.environments import utils\r\n  File \"/home/samuele/env/lib/python3.6/site-packages/tf_agents/environments/utils.py\", line 25, in <module>\r\n    from tf_agents.policies import random_py_policy\r\n  File \"/home/samuele/env/lib/python3.6/site-packages/tf_agents/policies/__init__.py\", line 18, in <module>\r\n    from tf_agents.policies import actor_policy\r\n  File \"/home/samuele/env/lib/python3.6/site-packages/tf_agents/policies/actor_policy.py\", line 29, in <module>\r\n    from tf_agents.networks import network\r\n  File \"/home/samuele/env/lib/python3.6/site-packages/tf_agents/networks/__init__.py\", line 18, in <module>\r\n    from tf_agents.networks import actor_distribution_network\r\n  File \"/home/samuele/env/lib/python3.6/site-packages/tf_agents/networks/actor_distribution_network.py\", line 26, in <module>\r\n    from tf_agents.networks import categorical_projection_network\r\n  File \"/home/samuele/env/lib/python3.6/site-packages/tf_agents/networks/categorical_projection_network.py\", line 26, in <module>\r\n    from tf_agents.networks import network\r\n  File \"/home/samuele/env/lib/python3.6/site-packages/tf_agents/networks/network.py\", line 32, in <module>\r\n    from tensorflow.python.keras.engine import network as keras_network  # TF internal\r\nImportError: cannot import name 'network'\r\n```\r\nTo solve this, I found out that one needs to use `tensorflow-2.2.0`.\r\n\r\nDoing that, however, I had a problem with cloudpickle:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.6/runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"/usr/lib/python3.6/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/home/samuele/Projects/google_research/behavior_regularized_offline_rl/brac/train_online.py\", line 31, in <module>\r\n    from behavior_regularized_offline_rl.brac import agents\r\n  File \"/home/samuele/Projects/google_research/behavior_regularized_offline_rl/brac/agents.py\", line 21, in <module>\r\n    from behavior_regularized_offline_rl.brac import bc_agent\r\n  File \"/home/samuele/Projects/google_research/behavior_regularized_offline_rl/brac/bc_agent.py\", line 25, in <module>\r\n    from behavior_regularized_offline_rl.brac import networks\r\n  File \"/home/samuele/Projects/google_research/behavior_regularized_offline_rl/brac/networks.py\", line 24, in <module>\r\n    import tensorflow_probability as tfp\r\n  File \"/home/samuele/env/lib/python3.6/site-packages/tensorflow_probability/__init__.py\", line 76, in <module>\r\n    from tensorflow_probability.python import *  # pylint: disable=wildcard-import\r\n  File \"/home/samuele/env/lib/python3.6/site-packages/tensorflow_probability/python/__init__.py\", line 23, in <module>\r\n    from tensorflow_probability.python import distributions\r\n  File \"/home/samuele/env/lib/python3.6/site-packages/tensorflow_probability/python/distributions/__init__.py\", line 88, in <module>\r\n    from tensorflow_probability.python.distributions.pixel_cnn import PixelCNN\r\n  File \"/home/samuele/env/lib/python3.6/site-packages/tensorflow_probability/python/distributions/pixel_cnn.py\", line 37, in <module>\r\n    from tensorflow_probability.python.layers import weight_norm\r\n  File \"/home/samuele/env/lib/python3.6/site-packages/tensorflow_probability/python/layers/__init__.py\", line 31, in <module>\r\n    from tensorflow_probability.python.layers.distribution_layer import CategoricalMixtureOfOneHotCategorical\r\n  File \"/home/samuele/env/lib/python3.6/site-packages/tensorflow_probability/python/layers/distribution_layer.py\", line 28, in <module>\r\n    from cloudpickle.cloudpickle import CloudPickler\r\nImportError: cannot import name 'CloudPickler'\r\n```\r\n\r\nI found out that there is an incompatibility between `tensorflow-probability` and `cloudpickle`.\r\nI've therefore switched to `tensorflow-probability-0.10.1` that aims to overcome this issue and requires `cloudpickle==1.3.0`.\r\n\r\nThis solved the problem.\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/585/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google-research/google-research/issues/585/timeline","performed_via_github_app":null,"state_reason":null}