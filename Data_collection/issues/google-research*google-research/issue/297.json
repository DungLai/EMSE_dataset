{"url":"https://api.github.com/repos/google-research/google-research/issues/297","repository_url":"https://api.github.com/repos/google-research/google-research","labels_url":"https://api.github.com/repos/google-research/google-research/issues/297/labels{/name}","comments_url":"https://api.github.com/repos/google-research/google-research/issues/297/comments","events_url":"https://api.github.com/repos/google-research/google-research/issues/297/events","html_url":"https://github.com/google-research/google-research/issues/297","id":639416183,"node_id":"MDU6SXNzdWU2Mzk0MTYxODM=","number":297,"title":"when I want to copy a layer, there is a error - 'no inbound_nodes'","user":{"login":"Lebhoryi","id":28487306,"node_id":"MDQ6VXNlcjI4NDg3MzA2","avatar_url":"https://avatars.githubusercontent.com/u/28487306?v=4","gravatar_id":"","url":"https://api.github.com/users/Lebhoryi","html_url":"https://github.com/Lebhoryi","followers_url":"https://api.github.com/users/Lebhoryi/followers","following_url":"https://api.github.com/users/Lebhoryi/following{/other_user}","gists_url":"https://api.github.com/users/Lebhoryi/gists{/gist_id}","starred_url":"https://api.github.com/users/Lebhoryi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lebhoryi/subscriptions","organizations_url":"https://api.github.com/users/Lebhoryi/orgs","repos_url":"https://api.github.com/users/Lebhoryi/repos","events_url":"https://api.github.com/users/Lebhoryi/events{/privacy}","received_events_url":"https://api.github.com/users/Lebhoryi/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-06-16T06:49:55Z","updated_at":"2020-06-21T19:58:30Z","closed_at":"2020-06-17T02:03:58Z","author_association":"NONE","active_lock_reason":null,"body":"The project is KWS-streaming.\r\n\r\nIn training, it is OK for me. But when trying to convert non-streaming model to streaming model about 'STREAM_INTERNAL_STATE_INFERENCE' state, I have met a problem.\r\n\r\n- It convert streaming model failed. The information is follow:\r\n```shell\r\nWARNING: failed to convert to SavedModel: 'Node' object has no attribute 'outputs'\r\n```\r\n\r\nMy question:\r\n1. How could I  convert non-stream model to stream model successfully?\r\n2. My view as follow is right or not ?If right, how to solve it?\r\n\r\nThe coding is here:\r\n1. [ test.convert_model_saved](https://github.com/google-research/google-research/blob/c880344f15d2453ab7eccbfea0b259c7019094f6/kws_streaming/train/model_train_eval.py#L162)\r\n2. [utils.model_to_saved(model, flags, path_model, mode)](https://github.com/google-research/google-research/blob/c880344f15d2453ab7eccbfea0b259c7019094f6/kws_streaming/train/test.py#L610)\r\n3. [model = to_streaming_inference()](https://github.com/google-research/google-research/blob/c880344f15d2453ab7eccbfea0b259c7019094f6/kws_streaming/models/utils.py#L369)\r\n4. [model_inference = convert_to_inference_model()](https://github.com/google-research/google-research/blob/c880344f15d2453ab7eccbfea0b259c7019094f6/kws_streaming/models/utils.py#L283)\r\n5. [new_model = _clone_model(model, input_tensors)](https://github.com/google-research/google-research/blob/c880344f15d2453ab7eccbfea0b259c7019094f6/kws_streaming/models/utils.py#L243)\r\n6. [models._clone_layers_and_model_config()](https://github.com/google-research/google-research/blob/c880344f15d2453ab7eccbfea0b259c7019094f6/kws_streaming/models/utils.py#L122)\r\n\r\nThe problem is in six, there hava something wrong when `clone layer configs`. In my opinion, maybe the question is after copying layers config, the new layers losses the `inbound nodes`, so the new layers not support any  `input` or `output`. The fisrt input layer looks ok beacause it have inbounds nodes. However the others is wrong. \r\n\r\nemm, I could not solve it, need some help. thx\r\n\r\n> the pc & training information:\r\n- ubuntu 16.04, tf 2.2.0\r\n```shell\r\n--data_dir ../data \\\r\n--lr_schedule linear \\\r\n--background_volume 0.1 \\\r\n--l2_weight_decay 0.0 \\\r\n--background_frequency 0.8 \\\r\n--split_data 1 \\\r\n--time_shift_ms 100.0 \\\r\n--how_many_training_steps 10000,5000 \\\r\n--eval_step_interval 400 \\\r\n--learning_rate 0.0001,0.00005 \\\r\n--batch_size 100 \\\r\n--wanted_words yes,no,up,down,left,right,on,off,stop,go \\\r\n--train_dir ./speech_commands_train/ \\\r\n--save_step_interval 100 \\\r\n--start_checkpoint '' \\\r\n--resample 0.15 \\\r\n--train 1 \\\r\n--window_size_ms 40 \\\r\n--window_stride_ms 40 \\\r\n--dct_num_features 20 \\\r\n--preprocess mfcc \\\r\n--feature_type mfcc_tf \\\r\n--mel_lower_edge_hertz 20.0 \\\r\n--mel_upper_edge_hertz 7000 \\\r\n--fft_magnitude_squared 0 \\\r\n--mel_num_bins 40 \\\r\ncnn \\\r\n--cnn_filters 64,64,64,64,128,64,128 \\\r\n--cnn_kernel_size '(3,3),(5,3),(5,3),(5,3),(5,2),(5,1),(3,1)' \\\r\n--cnn_dilation_rate '(1,1),(1,1),(1,1),(1,1),(1,1),(1,1),(1,1)'\r\n```","closed_by":{"login":"Lebhoryi","id":28487306,"node_id":"MDQ6VXNlcjI4NDg3MzA2","avatar_url":"https://avatars.githubusercontent.com/u/28487306?v=4","gravatar_id":"","url":"https://api.github.com/users/Lebhoryi","html_url":"https://github.com/Lebhoryi","followers_url":"https://api.github.com/users/Lebhoryi/followers","following_url":"https://api.github.com/users/Lebhoryi/following{/other_user}","gists_url":"https://api.github.com/users/Lebhoryi/gists{/gist_id}","starred_url":"https://api.github.com/users/Lebhoryi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lebhoryi/subscriptions","organizations_url":"https://api.github.com/users/Lebhoryi/orgs","repos_url":"https://api.github.com/users/Lebhoryi/repos","events_url":"https://api.github.com/users/Lebhoryi/events{/privacy}","received_events_url":"https://api.github.com/users/Lebhoryi/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/297/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google-research/google-research/issues/297/timeline","performed_via_github_app":null,"state_reason":"completed"}