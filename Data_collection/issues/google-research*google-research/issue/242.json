{"url":"https://api.github.com/repos/google-research/google-research/issues/242","repository_url":"https://api.github.com/repos/google-research/google-research","labels_url":"https://api.github.com/repos/google-research/google-research/issues/242/labels{/name}","comments_url":"https://api.github.com/repos/google-research/google-research/issues/242/comments","events_url":"https://api.github.com/repos/google-research/google-research/issues/242/events","html_url":"https://github.com/google-research/google-research/issues/242","id":597160862,"node_id":"MDU6SXNzdWU1OTcxNjA4NjI=","number":242,"title":"TFLite for speech_embedding?","user":{"login":"samzurcher","id":2626,"node_id":"MDQ6VXNlcjI2MjY=","avatar_url":"https://avatars.githubusercontent.com/u/2626?v=4","gravatar_id":"","url":"https://api.github.com/users/samzurcher","html_url":"https://github.com/samzurcher","followers_url":"https://api.github.com/users/samzurcher/followers","following_url":"https://api.github.com/users/samzurcher/following{/other_user}","gists_url":"https://api.github.com/users/samzurcher/gists{/gist_id}","starred_url":"https://api.github.com/users/samzurcher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samzurcher/subscriptions","organizations_url":"https://api.github.com/users/samzurcher/orgs","repos_url":"https://api.github.com/users/samzurcher/repos","events_url":"https://api.github.com/users/samzurcher/events{/privacy}","received_events_url":"https://api.github.com/users/samzurcher/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-04-09T09:49:00Z","updated_at":"2020-04-10T09:15:07Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"@kevinkilgour \r\n\r\nI tried to convert the model provided at https://tfhub.dev/google/speech_embedding/1 to TFLite but unfortunately failed.\r\n\r\n### Setup:\r\n- tensorflow 2.2.0rc2\r\n- tensorflow-hub 0.8.0\r\n\r\n### Conversion\r\nI tried the following:\r\n1. Manually downloaded the model from https://tfhub.dev/google/speech_embedding/1?tf-hub-format=compressed\r\n2. ```\r\n   converter = tf.lite.TFLiteConverter.from_saved_model(\r\n    \"speech_embedding\",\r\n    tags=[]\r\n   )\r\n   tflite_model = converter.convert()\r\n   ```\r\n### Error\r\nI get the following error:\r\n```\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-90-2fa2b3d63f8a> in <module>\r\n      3     tags=[]\r\n      4 )\r\n----> 5 tflite_model = converter.convert()\r\n      6 \r\n      7 # converter.experimental_new_converter = True\r\n\r\n~/.local/lib/python3.7/site-packages/tensorflow/lite/python/lite.py in convert(self)\r\n    481               \"None is only supported in the 1st dimension. Tensor '{0}' has \"\r\n    482               \"invalid shape '{1}'.\".format(\r\n--> 483                   _get_tensor_name(tensor), shape_list))\r\n    484         elif shape_list and shape_list[0] is None:\r\n    485           # Set the batch size to 1 if undefined.\r\n\r\nValueError: None is only supported in the 1st dimension. Tensor 'samples' has invalid shape '[None, None]'.\r\n```\r\n\r\nI tried as well to enable the new converter (`converter.experimental_new_converter = True`) but that didn't help either.\r\n\r\n### Questions\r\n1. Do you guys have a tflite version of the model that you would be willing to publish to tfhub?\r\n2. Am I doing something wrong with the conversion? If so, please let me know.\r\n3. Is there something you guys would need to change in the model to support TFLite? If so, would you be willing to perform that necessary change?\r\n\r\nThanks a lot for your help and the great work you have done with the speech_embedding model. Much appreciated.\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/google-research/google-research/issues/242/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google-research/google-research/issues/242/timeline","performed_via_github_app":null,"state_reason":null}