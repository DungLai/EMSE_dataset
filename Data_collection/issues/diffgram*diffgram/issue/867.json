{"url":"https://api.github.com/repos/diffgram/diffgram/issues/867","repository_url":"https://api.github.com/repos/diffgram/diffgram","labels_url":"https://api.github.com/repos/diffgram/diffgram/issues/867/labels{/name}","comments_url":"https://api.github.com/repos/diffgram/diffgram/issues/867/comments","events_url":"https://api.github.com/repos/diffgram/diffgram/issues/867/events","html_url":"https://github.com/diffgram/diffgram/issues/867","id":1245815673,"node_id":"I_kwDOCM48Rc5KQaN5","number":867,"title":"Extension Handling - Image case","user":{"login":"anthony-sarkis","id":18080164,"node_id":"MDQ6VXNlcjE4MDgwMTY0","avatar_url":"https://avatars.githubusercontent.com/u/18080164?v=4","gravatar_id":"","url":"https://api.github.com/users/anthony-sarkis","html_url":"https://github.com/anthony-sarkis","followers_url":"https://api.github.com/users/anthony-sarkis/followers","following_url":"https://api.github.com/users/anthony-sarkis/following{/other_user}","gists_url":"https://api.github.com/users/anthony-sarkis/gists{/gist_id}","starred_url":"https://api.github.com/users/anthony-sarkis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anthony-sarkis/subscriptions","organizations_url":"https://api.github.com/users/anthony-sarkis/orgs","repos_url":"https://api.github.com/users/anthony-sarkis/repos","events_url":"https://api.github.com/users/anthony-sarkis/events{/privacy}","received_events_url":"https://api.github.com/users/anthony-sarkis/received_events","type":"User","site_admin":false},"labels":[{"id":2935242619,"node_id":"MDU6TGFiZWwyOTM1MjQyNjE5","url":"https://api.github.com/repos/diffgram/diffgram/labels/lowpriority","name":"lowpriority","color":"397733","default":false,"description":""},{"id":3905123644,"node_id":"LA_kwDOCM48Rc7ow3U8","url":"https://api.github.com/repos/diffgram/diffgram/labels/image-annotation","name":"image-annotation","color":"1DB3FC","default":false,"description":""}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-05-23T23:59:08Z","updated_at":"2022-05-23T23:59:08Z","closed_at":null,"author_association":"MEMBER","active_lock_reason":null,"body":"\r\nIf an image is provided with a URL like `...example.random_ABC` where `random_ABC` is not a valid extension, it will throw an error. \r\n\r\nHowever, it may be a better user experience, that if the response header `content-type` is set, we treat it as an OR function. e.g. that a bad extension with a good `content-type` then the `content-type` will be used. \r\n\r\nA starting point would be to refactor  the `content-type` code\r\nhttps://github.com/diffgram/diffgram/blob/30b87c6e25b6394c2203ee1cd959c4ae8c31fd4c/walrus/methods/input/process_media.py#L2172\r\ninto a function,\r\nand then better integrate it with `get_file_name_and_extension()` or `determine_media_type()`\r\n\r\nThe extension handling logic in `save_raw_image_file()` is not necessarily bad, execution should not get there unless we already know it has a valid extension.\r\ne.g. potentially `determine_media_type()` and setting the extension should be bundled as an \"atomic\" operation, so if we think we know the media type, then we must also know the extension.\r\n\r\nIn general this is some pretty old code that could use further refactoring. For example setting the `url_signed_expiry` and running `build_secure_url` in this context is going to need to be reviewed too in the new security paradigm. \r\n\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/diffgram/diffgram/issues/867/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diffgram/diffgram/issues/867/timeline","performed_via_github_app":null,"state_reason":null}