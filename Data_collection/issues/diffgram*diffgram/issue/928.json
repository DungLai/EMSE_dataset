{"url":"https://api.github.com/repos/diffgram/diffgram/issues/928","repository_url":"https://api.github.com/repos/diffgram/diffgram","labels_url":"https://api.github.com/repos/diffgram/diffgram/issues/928/labels{/name}","comments_url":"https://api.github.com/repos/diffgram/diffgram/issues/928/comments","events_url":"https://api.github.com/repos/diffgram/diffgram/issues/928/events","html_url":"https://github.com/diffgram/diffgram/issues/928","id":1274081046,"node_id":"I_kwDOCM48Rc5L8O8W","number":928,"title":"Better error message if fernet_key changes [Low priority]","user":{"login":"anthony-sarkis","id":18080164,"node_id":"MDQ6VXNlcjE4MDgwMTY0","avatar_url":"https://avatars.githubusercontent.com/u/18080164?v=4","gravatar_id":"","url":"https://api.github.com/users/anthony-sarkis","html_url":"https://github.com/anthony-sarkis","followers_url":"https://api.github.com/users/anthony-sarkis/followers","following_url":"https://api.github.com/users/anthony-sarkis/following{/other_user}","gists_url":"https://api.github.com/users/anthony-sarkis/gists{/gist_id}","starred_url":"https://api.github.com/users/anthony-sarkis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anthony-sarkis/subscriptions","organizations_url":"https://api.github.com/users/anthony-sarkis/orgs","repos_url":"https://api.github.com/users/anthony-sarkis/repos","events_url":"https://api.github.com/users/anthony-sarkis/events{/privacy}","received_events_url":"https://api.github.com/users/anthony-sarkis/received_events","type":"User","site_admin":false},"labels":[{"id":2935242619,"node_id":"MDU6TGFiZWwyOTM1MjQyNjE5","url":"https://api.github.com/repos/diffgram/diffgram/labels/lowpriority","name":"lowpriority","color":"397733","default":false,"description":""},{"id":4240215961,"node_id":"LA_kwDOCM48Rc78vI-Z","url":"https://api.github.com/repos/diffgram/diffgram/labels/connections","name":"connections","color":"281965","default":false,"description":""}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-06-16T21:05:06Z","updated_at":"2022-06-16T21:05:06Z","closed_at":null,"author_association":"MEMBER","active_lock_reason":null,"body":"Low priority\r\n\r\n### Context\r\nThis happened when a user reinstalled Diffgram but used the existing database. (install not update) \r\nI updated the forgot password for [super admin docs here](https://diffgram.readme.io/docs/super-admin-manual-actions-bugfixes#forgot-password)\r\n\r\nFor security purposes there is a key that gets generated at install called `fernet_key` https://github.com/diffgram/diffgram/blob/d1700ab616ea715d2b2c183aa6509fb8b4feef42/install.py#L489\r\nThat key is random. As part of the encryption process for secrets for connections it uses that.\r\nThat way even if the database is breached, the key would also have to be known to access the data.\r\nMy guess is that the key changed, and is invalid when loading, so it can't access the encrypted secret.\r\n\r\n### Desired result\r\nProbably batter error message. Perhaps catching an error with fernet creation or just assuming that if it's none we throw something. Could potentially point to this ticket or some other docs on how to reset stuff etc.\r\n\r\nAlso for security we should have a better way to rotate this key.\r\n\r\n### Workarounds\r\nRecreate resources (e.g. recreate ABC connection)\r\nDon't change the fernet key / Restore it if changed\r\n\r\n### Error\r\n`NoneType` object has not attribute `encrypt`\r\n![image](https://user-images.githubusercontent.com/18080164/174162360-28c72197-8371-4c76-808e-30501781eb67.png)\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/diffgram/diffgram/issues/928/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diffgram/diffgram/issues/928/timeline","performed_via_github_app":null,"state_reason":null}