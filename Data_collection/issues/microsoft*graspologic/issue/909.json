{"url":"https://api.github.com/repos/microsoft/graspologic/issues/909","repository_url":"https://api.github.com/repos/microsoft/graspologic","labels_url":"https://api.github.com/repos/microsoft/graspologic/issues/909/labels{/name}","comments_url":"https://api.github.com/repos/microsoft/graspologic/issues/909/comments","events_url":"https://api.github.com/repos/microsoft/graspologic/issues/909/events","html_url":"https://github.com/microsoft/graspologic/issues/909","id":1117772968,"node_id":"I_kwDOCM7Erc5Cn9yo","number":909,"title":"[BUG] MyPy test failures on main","user":{"login":"bdpedigo","id":25714207,"node_id":"MDQ6VXNlcjI1NzE0MjA3","avatar_url":"https://avatars.githubusercontent.com/u/25714207?v=4","gravatar_id":"","url":"https://api.github.com/users/bdpedigo","html_url":"https://github.com/bdpedigo","followers_url":"https://api.github.com/users/bdpedigo/followers","following_url":"https://api.github.com/users/bdpedigo/following{/other_user}","gists_url":"https://api.github.com/users/bdpedigo/gists{/gist_id}","starred_url":"https://api.github.com/users/bdpedigo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bdpedigo/subscriptions","organizations_url":"https://api.github.com/users/bdpedigo/orgs","repos_url":"https://api.github.com/users/bdpedigo/repos","events_url":"https://api.github.com/users/bdpedigo/events{/privacy}","received_events_url":"https://api.github.com/users/bdpedigo/received_events","type":"User","site_admin":false},"labels":[{"id":1048646805,"node_id":"MDU6TGFiZWwxMDQ4NjQ2ODA1","url":"https://api.github.com/repos/microsoft/graspologic/labels/bug","name":"bug","color":"cded2d","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2022-01-28T19:36:48Z","updated_at":"2022-02-01T21:24:53Z","closed_at":"2022-02-01T21:24:53Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"Looks like mypy is failing on the current main. I am not sure what changed / how this got into main unless it was just caused by a update to mypy itself.\r\n\r\nExample: this PR which changed nothing about the code https://github.com/microsoft/graspologic/pull/908\r\nTest output (unit-and-doc-test): \r\n```{pytb}\r\nRun mypy ./graspologic\r\ngraspologic\\match\\qap.py:420: error: Argument \"key\" to \"sorted\" has incompatible type \"Callable[[Union[Sequence[Sequence[Sequence[Sequence[Sequence[Any]]]]], _SupportsArray[dtype[Any]], Sequence[_SupportsArray[dtype[Any]]], Sequence[Sequence[_SupportsArray[dtype[Any]]]], Sequence[Sequence[Sequence[_SupportsArray[dtype[Any]]]]], Sequence[Sequence[Sequence[Sequence[_SupportsArray[dtype[Any]]]]]], complex, Sequence[Union[complex, str, bytes]], Sequence[Sequence[Union[complex, str, bytes]]], Sequence[Sequence[Sequence[Union[complex, str, bytes]]]], Sequence[Sequence[Sequence[Sequence[Union[complex, str, bytes]]]]]]], Union[Sequence[Sequence[Sequence[Sequence[Any]]]], Any, _SupportsArray[dtype[Any]], Sequence[_SupportsArray[dtype[Any]]], Sequence[Sequence[_SupportsArray[dtype[Any]]]], Sequence[Sequence[Sequence[_SupportsArray[dtype[Any]]]]], complex, Sequence[Union[complex, str, bytes]], Sequence[Sequence[Union[complex, str, bytes]]], Sequence[Sequence[Sequence[Union[complex, str, bytes]]]]]]\"; expected \"Callable[[Union[Sequence[Sequence[Sequence[Sequence[Sequence[Any]]]]], _SupportsArray[dtype[Any]], Sequence[_SupportsArray[dtype[Any]]], Sequence[Sequence[_SupportsArray[dtype[Any]]]], Sequence[Sequence[Sequence[_SupportsArray[dtype[Any]]]]], Sequence[Sequence[Sequence[Sequence[_SupportsArray[dtype[Any]]]]]], complex, Sequence[Union[complex, str, bytes]], Sequence[Sequence[Union[complex, str, bytes]]], Sequence[Sequence[Sequence[Union[complex, str, bytes]]]], Sequence[Sequence[Sequence[Sequence[Union[complex, str, bytes]]]]]]], Union[SupportsDunderLT, SupportsDunderGT]]\"\r\ngraspologic\\match\\qap.py:420: error: Value of type \"Union[Sequence[Sequence[Sequence[Sequence[Sequence[Any]]]]], _SupportsArray[dtype[Any]], Sequence[_SupportsArray[dtype[Any]]], Sequence[Sequence[_SupportsArray[dtype[Any]]]], Sequence[Sequence[Sequence[_SupportsArray[dtype[Any]]]]], Sequence[Sequence[Sequence[Sequence[_SupportsArray[dtype[Any]]]]]], complex, Sequence[Union[complex, str, bytes]], Sequence[Sequence[Union[complex, str, bytes]]], Sequence[Sequence[Sequence[Union[complex, str, bytes]]]], Sequence[Sequence[Sequence[Sequence[Union[complex, str, bytes]]]]]]\" is not indexable\r\ngraspologic\\match\\qap.py:420: error: Incompatible return value type (got \"Union[Sequence[Sequence[Sequence[Sequence[Any]]]], Any, _SupportsArray[dtype[Any]], Sequence[_SupportsArray[dtype[Any]]], Sequence[Sequence[_SupportsArray[dtype[Any]]]], Sequence[Sequence[Sequence[_SupportsArray[dtype[Any]]]]], complex, Sequence[Union[complex, str, bytes]], Sequence[Sequence[Union[complex, str, bytes]]], Sequence[Sequence[Sequence[Union[complex, str, bytes]]]]]\", expected \"Union[SupportsDunderLT, SupportsDunderGT]\")\r\ngraspologic\\match\\qap.py:433: error: Item \"int\" of \"Union[int, RandomState, Generator, None]\" has no attribute \"permutation\"\r\ngraspologic\\match\\qap.py:433: error: Item \"None\" of \"Union[int, RandomState, Generator, None]\" has no attribute \"permutation\"\r\ngraspologic\\match\\qap.py:457: error: Item \"int\" of \"Union[int, RandomState, Generator, None]\" has no attribute \"uniform\"\r\ngraspologic\\match\\qap.py:457: error: Item \"None\" of \"Union[int, RandomState, Generator, None]\" has no attribute \"uniform\"\r\ngraspologic\\cluster\\autogmm.py:559: error: Incompatible types in assignment (expression has type \"List[Optional[RandomState]]\", variable has type \"ndarray[Any, dtype[signedinteger[Any]]]\")\r\ngraspologic\\embed\\base.py:439: error: <nothing> has no attribute \"ndim\"\r\ngraspologic\\embed\\base.py:441: error: <nothing> has no attribute \"ndim\"\r\ngraspologic\\embed\\base.py:444: error: <nothing> has no attribute \"shape\"\r\ngraspologic\\embed\\base.py:446: error: <nothing> has no attribute \"shape\"\r\ngraspologic\\embed\\base.py:449: error: Incompatible types in assignment (expression has type \"Union[ndarray[Any, Any], Any]\", variable has type \"List[Union[ndarray[Any, Any], Any]]\")\r\ngraspologic\\embed\\case.py:205: error: Incompatible types in assignment (expression has type \"floating[Any]\", variable has type \"float\")\r\nFound 14 errors in 4 files (checked 79 source files)\r\nError: Process completed with exit code 1.\r\n```\r\n\r\nSide note: when I get the latest version of mypy and run it locally on `main`, I actually get \r\n```\r\nFound 393 errors in 55 files (checked 78 source files)\r\n``` \r\n\r\nI wont post the whole traceback but these errors involve basically every module in the library. Many are private functions.\r\n\r\n**A few larger points for discussion**: \r\n- Would anyone be opposed to taking mypy out of unit-and-doc-test and putting it as it's own check, much like black has its own code-format-check? It seems unnecessary to check on every os/version like we do for actual tests.\r\n- Can someone explain to me what mypy gives us that beartype doesn't? I know it is static and beartype is dynamic, right? but in practice what is this doing for us? \r\n   - If nothing, can we remove? \r\n- What is our policy on mypy compatibility for legacy code that is private? \r\n- any tips on getting mypy to tell me what the function is that is actually causing the error? --verbose did not do it for me.","closed_by":{"login":"bdpedigo","id":25714207,"node_id":"MDQ6VXNlcjI1NzE0MjA3","avatar_url":"https://avatars.githubusercontent.com/u/25714207?v=4","gravatar_id":"","url":"https://api.github.com/users/bdpedigo","html_url":"https://github.com/bdpedigo","followers_url":"https://api.github.com/users/bdpedigo/followers","following_url":"https://api.github.com/users/bdpedigo/following{/other_user}","gists_url":"https://api.github.com/users/bdpedigo/gists{/gist_id}","starred_url":"https://api.github.com/users/bdpedigo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bdpedigo/subscriptions","organizations_url":"https://api.github.com/users/bdpedigo/orgs","repos_url":"https://api.github.com/users/bdpedigo/repos","events_url":"https://api.github.com/users/bdpedigo/events{/privacy}","received_events_url":"https://api.github.com/users/bdpedigo/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/microsoft/graspologic/issues/909/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/microsoft/graspologic/issues/909/timeline","performed_via_github_app":null,"state_reason":"completed"}