{"url":"https://api.github.com/repos/JayYip/m3tl/issues/87","repository_url":"https://api.github.com/repos/JayYip/m3tl","labels_url":"https://api.github.com/repos/JayYip/m3tl/issues/87/labels{/name}","comments_url":"https://api.github.com/repos/JayYip/m3tl/issues/87/comments","events_url":"https://api.github.com/repos/JayYip/m3tl/issues/87/events","html_url":"https://github.com/JayYip/m3tl/issues/87","id":891543889,"node_id":"MDU6SXNzdWU4OTE1NDM4ODk=","number":87,"title":"'TFBertEmbeddings' object has no attribute 'word_embeddings'","user":{"login":"wwewwt","id":3361335,"node_id":"MDQ6VXNlcjMzNjEzMzU=","avatar_url":"https://avatars.githubusercontent.com/u/3361335?v=4","gravatar_id":"","url":"https://api.github.com/users/wwewwt","html_url":"https://github.com/wwewwt","followers_url":"https://api.github.com/users/wwewwt/followers","following_url":"https://api.github.com/users/wwewwt/following{/other_user}","gists_url":"https://api.github.com/users/wwewwt/gists{/gist_id}","starred_url":"https://api.github.com/users/wwewwt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwewwt/subscriptions","organizations_url":"https://api.github.com/users/wwewwt/orgs","repos_url":"https://api.github.com/users/wwewwt/repos","events_url":"https://api.github.com/users/wwewwt/events{/privacy}","received_events_url":"https://api.github.com/users/wwewwt/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2021-05-14T02:38:15Z","updated_at":"2021-11-29T08:12:38Z","closed_at":"2021-11-29T08:12:37Z","author_association":"NONE","active_lock_reason":null,"body":"代码：\r\nfrom bert_multitask_learning import train_bert_multitask, eval_bert_multitask, predict_bert_multitask\r\nproblem_type_dict = {'toy_cls': 'cls', 'toy_seq_tag': 'seq_tag'}\r\n\r\nproblem = 'toy_cls&toy_seq_tag'\r\nmodel = train_bert_multitask(\r\n    problem=problem,\r\n    num_epochs=1,\r\n    problem_type_dict=problem_type_dict,\r\n    processing_fn_dict=processing_fn_dict,\r\n    #continue_training=True\r\n)\r\n\r\n\r\n\r\n\r\n报错：\r\n/root/.local/lib/python3.7/site-packages/bert_multitask_learning/run_bert_multitask.py in train_bert_multitask(problem, num_gpus, num_epochs, model_dir, params, problem_type_dict, processing_fn_dict, model, create_tf_record_only, steps_per_epoch, warmup_ratio, continue_training, mirrored_strategy)\r\n    257 \r\n    258     model = create_keras_model(\r\n--> 259         mirrored_strategy=mirrored_strategy, params=params, mode=mode, inputs_to_build_model=one_batch)\r\n    260 \r\n    261     _train_bert_multitask_keras_model(\r\n\r\n/root/.local/lib/python3.7/site-packages/bert_multitask_learning/run_bert_multitask.py in create_keras_model(mirrored_strategy, params, mode, inputs_to_build_model, model)\r\n     91     if mirrored_strategy is not None:\r\n     92          with mirrored_strategy.scope():\r\n---> 93              model = _get_model_wrapper(params, mode, inputs_to_build_model, model)\r\n     94     else:\r\n     95         model = _get_model_wrapper(params, mode, inputs_to_build_model, model)\r\n\r\n/root/.local/lib/python3.7/site-packages/bert_multitask_learning/run_bert_multitask.py in _get_model_wrapper(params, mode, inputs_to_build_model, model)\r\n     51     def _get_model_wrapper(params, mode, inputs_to_build_model, model):\r\n     52         if model is None:\r\n---> 53             model = BertMultiTask(params)\r\n     54             # model.run_eagerly = True\r\n     55         if mode == 'resume':\r\n\r\n/root/.local/lib/python3.7/site-packages/bert_multitask_learning/model_fn.py in __init__(self, params, name)\r\n    261         self.params = params\r\n    262         # initialize body model, aka transformers\r\n--> 263         self.body = BertMultiTaskBody(params=self.params)\r\n    264         # mlm might need word embedding from bert\r\n    265         # build sub-model\r\n\r\n/root/.local/lib/python3.7/site-packages/bert_multitask_learning/model_fn.py in __init__(self, params, name)\r\n     63         super(BertMultiTaskBody, self).__init__(name=name)\r\n     64         self.params = params\r\n---> 65         self.bert = MultiModalBertModel(params=self.params)\r\n     66         if self.params.custom_pooled_hidden_size:\r\n     67             self.custom_pooled_layer = tf.keras.layers.Dense(\r\n\r\n/root/.local/lib/python3.7/site-packages/bert_multitask_learning/modeling.py in __init__(self, params, use_one_hot_embeddings)\r\n     40         # multimodal input dense\r\n     41         embedding_dim = get_embedding_table_from_model(\r\n---> 42             self.bert_model).shape[-1]\r\n     43         self.modal_name_list = ['image', 'others']\r\n     44         self.multimodal_dense = {modal_name: tf.keras.layers.Dense(\r\n\r\n/root/.local/lib/python3.7/site-packages/bert_multitask_learning/utils.py in get_embedding_table_from_model(model)\r\n    397 def get_embedding_table_from_model(model):\r\n    398     base_model = get_transformer_main_model(model)\r\n--> 399     return base_model.embeddings.word_embeddings\r\n    400 \r\n    401 \r\n\r\nAttributeError: 'TFBertEmbeddings' object has no attribute 'word_embeddings'\r\n\r\n","closed_by":{"login":"JayYip","id":15050572,"node_id":"MDQ6VXNlcjE1MDUwNTcy","avatar_url":"https://avatars.githubusercontent.com/u/15050572?v=4","gravatar_id":"","url":"https://api.github.com/users/JayYip","html_url":"https://github.com/JayYip","followers_url":"https://api.github.com/users/JayYip/followers","following_url":"https://api.github.com/users/JayYip/following{/other_user}","gists_url":"https://api.github.com/users/JayYip/gists{/gist_id}","starred_url":"https://api.github.com/users/JayYip/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JayYip/subscriptions","organizations_url":"https://api.github.com/users/JayYip/orgs","repos_url":"https://api.github.com/users/JayYip/repos","events_url":"https://api.github.com/users/JayYip/events{/privacy}","received_events_url":"https://api.github.com/users/JayYip/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/JayYip/m3tl/issues/87/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/JayYip/m3tl/issues/87/timeline","performed_via_github_app":null,"state_reason":"completed"}