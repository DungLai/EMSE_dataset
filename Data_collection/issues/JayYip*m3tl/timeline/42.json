[{"url":"https://api.github.com/repos/JayYip/m3tl/issues/comments/631199937","html_url":"https://github.com/JayYip/m3tl/issues/42#issuecomment-631199937","issue_url":"https://api.github.com/repos/JayYip/m3tl/issues/42","id":631199937,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMTE5OTkzNw==","user":{"login":"JayYip","id":15050572,"node_id":"MDQ6VXNlcjE1MDUwNTcy","avatar_url":"https://avatars.githubusercontent.com/u/15050572?v=4","gravatar_id":"","url":"https://api.github.com/users/JayYip","html_url":"https://github.com/JayYip","followers_url":"https://api.github.com/users/JayYip/followers","following_url":"https://api.github.com/users/JayYip/following{/other_user}","gists_url":"https://api.github.com/users/JayYip/gists{/gist_id}","starred_url":"https://api.github.com/users/JayYip/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JayYip/subscriptions","organizations_url":"https://api.github.com/users/JayYip/orgs","repos_url":"https://api.github.com/users/JayYip/repos","events_url":"https://api.github.com/users/JayYip/events{/privacy}","received_events_url":"https://api.github.com/users/JayYip/received_events","type":"User","site_admin":false},"created_at":"2020-05-20T02:40:20Z","updated_at":"2020-05-20T02:40:20Z","author_association":"OWNER","body":"你的理解大致上是正确的, 但是这里的交替训练的采样粒度是instance而不是batch","reactions":{"url":"https://api.github.com/repos/JayYip/m3tl/issues/comments/631199937/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"JayYip","id":15050572,"node_id":"MDQ6VXNlcjE1MDUwNTcy","avatar_url":"https://avatars.githubusercontent.com/u/15050572?v=4","gravatar_id":"","url":"https://api.github.com/users/JayYip","html_url":"https://github.com/JayYip","followers_url":"https://api.github.com/users/JayYip/followers","following_url":"https://api.github.com/users/JayYip/following{/other_user}","gists_url":"https://api.github.com/users/JayYip/gists{/gist_id}","starred_url":"https://api.github.com/users/JayYip/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JayYip/subscriptions","organizations_url":"https://api.github.com/users/JayYip/orgs","repos_url":"https://api.github.com/users/JayYip/repos","events_url":"https://api.github.com/users/JayYip/events{/privacy}","received_events_url":"https://api.github.com/users/JayYip/received_events","type":"User","site_admin":false}},{"id":3354460144,"node_id":"MDExOkNsb3NlZEV2ZW50MzM1NDQ2MDE0NA==","url":"https://api.github.com/repos/JayYip/m3tl/issues/events/3354460144","actor":{"login":"JayYip","id":15050572,"node_id":"MDQ6VXNlcjE1MDUwNTcy","avatar_url":"https://avatars.githubusercontent.com/u/15050572?v=4","gravatar_id":"","url":"https://api.github.com/users/JayYip","html_url":"https://github.com/JayYip","followers_url":"https://api.github.com/users/JayYip/followers","following_url":"https://api.github.com/users/JayYip/following{/other_user}","gists_url":"https://api.github.com/users/JayYip/gists{/gist_id}","starred_url":"https://api.github.com/users/JayYip/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JayYip/subscriptions","organizations_url":"https://api.github.com/users/JayYip/orgs","repos_url":"https://api.github.com/users/JayYip/repos","events_url":"https://api.github.com/users/JayYip/events{/privacy}","received_events_url":"https://api.github.com/users/JayYip/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-05-20T02:40:21Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/JayYip/m3tl/issues/comments/631228407","html_url":"https://github.com/JayYip/m3tl/issues/42#issuecomment-631228407","issue_url":"https://api.github.com/repos/JayYip/m3tl/issues/42","id":631228407,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMTIyODQwNw==","user":{"login":"nefujiangping","id":16358182,"node_id":"MDQ6VXNlcjE2MzU4MTgy","avatar_url":"https://avatars.githubusercontent.com/u/16358182?v=4","gravatar_id":"","url":"https://api.github.com/users/nefujiangping","html_url":"https://github.com/nefujiangping","followers_url":"https://api.github.com/users/nefujiangping/followers","following_url":"https://api.github.com/users/nefujiangping/following{/other_user}","gists_url":"https://api.github.com/users/nefujiangping/gists{/gist_id}","starred_url":"https://api.github.com/users/nefujiangping/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nefujiangping/subscriptions","organizations_url":"https://api.github.com/users/nefujiangping/orgs","repos_url":"https://api.github.com/users/nefujiangping/repos","events_url":"https://api.github.com/users/nefujiangping/events{/privacy}","received_events_url":"https://api.github.com/users/nefujiangping/received_events","type":"User","site_admin":false},"created_at":"2020-05-20T04:26:32Z","updated_at":"2020-05-20T04:26:32Z","author_association":"NONE","body":"嗯。阅读了一下源码，明白了。\r\n\r\n我现在理解是这样的：\r\n假设problem = ‘A|B|C’，训练时，每一个instance (example)会从ABC任务中采样一个，但是ABC三个任务的loss都会计算一下（没被采样到的任务使用的dummy labels），最后对于每一个instance，将没有被采样到的任务的loss置为0。针对一个任务，置为0的实现方式是乘了一个loss_multiplier(shape为(batch_size, ))。\r\n\r\n如果我上面的理解是正确的，那么针对某一个任务(比如A)，计算一个batch的平均loss时，除以这个batch中A被采样到的次数是否更合理一些呢？而不是除以batch_size。源码中[这里](https://github.com/JayYip/bert-multitask-learning/blob/1e1e12a0d0e77b4a77cbb0d7a1ea46199e37e6be/bert_multitask_learning/top_utils.py#L74)使用的reduce_mean。","reactions":{"url":"https://api.github.com/repos/JayYip/m3tl/issues/comments/631228407/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nefujiangping","id":16358182,"node_id":"MDQ6VXNlcjE2MzU4MTgy","avatar_url":"https://avatars.githubusercontent.com/u/16358182?v=4","gravatar_id":"","url":"https://api.github.com/users/nefujiangping","html_url":"https://github.com/nefujiangping","followers_url":"https://api.github.com/users/nefujiangping/followers","following_url":"https://api.github.com/users/nefujiangping/following{/other_user}","gists_url":"https://api.github.com/users/nefujiangping/gists{/gist_id}","starred_url":"https://api.github.com/users/nefujiangping/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nefujiangping/subscriptions","organizations_url":"https://api.github.com/users/nefujiangping/orgs","repos_url":"https://api.github.com/users/nefujiangping/repos","events_url":"https://api.github.com/users/nefujiangping/events{/privacy}","received_events_url":"https://api.github.com/users/nefujiangping/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/JayYip/m3tl/issues/comments/631886033","html_url":"https://github.com/JayYip/m3tl/issues/42#issuecomment-631886033","issue_url":"https://api.github.com/repos/JayYip/m3tl/issues/42","id":631886033,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMTg4NjAzMw==","user":{"login":"JayYip","id":15050572,"node_id":"MDQ6VXNlcjE1MDUwNTcy","avatar_url":"https://avatars.githubusercontent.com/u/15050572?v=4","gravatar_id":"","url":"https://api.github.com/users/JayYip","html_url":"https://github.com/JayYip","followers_url":"https://api.github.com/users/JayYip/followers","following_url":"https://api.github.com/users/JayYip/following{/other_user}","gists_url":"https://api.github.com/users/JayYip/gists{/gist_id}","starred_url":"https://api.github.com/users/JayYip/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JayYip/subscriptions","organizations_url":"https://api.github.com/users/JayYip/orgs","repos_url":"https://api.github.com/users/JayYip/repos","events_url":"https://api.github.com/users/JayYip/events{/privacy}","received_events_url":"https://api.github.com/users/JayYip/received_events","type":"User","site_admin":false},"created_at":"2020-05-21T05:16:17Z","updated_at":"2020-05-21T05:16:17Z","author_association":"OWNER","body":"我在[这里](https://github.com/JayYip/bert-multitask-learning/blob/1e1e12a0d0e77b4a77cbb0d7a1ea46199e37e6be/bert_multitask_learning/model_fn.py#L146)做了一些处理. 假设A在batch中被采样到`k`次, 那么A的batch loss形状为`[k]`. 这么处理的话就可以直接做mean, 并且计算效率也会更高.","reactions":{"url":"https://api.github.com/repos/JayYip/m3tl/issues/comments/631886033/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"JayYip","id":15050572,"node_id":"MDQ6VXNlcjE1MDUwNTcy","avatar_url":"https://avatars.githubusercontent.com/u/15050572?v=4","gravatar_id":"","url":"https://api.github.com/users/JayYip","html_url":"https://github.com/JayYip","followers_url":"https://api.github.com/users/JayYip/followers","following_url":"https://api.github.com/users/JayYip/following{/other_user}","gists_url":"https://api.github.com/users/JayYip/gists{/gist_id}","starred_url":"https://api.github.com/users/JayYip/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JayYip/subscriptions","organizations_url":"https://api.github.com/users/JayYip/orgs","repos_url":"https://api.github.com/users/JayYip/repos","events_url":"https://api.github.com/users/JayYip/events{/privacy}","received_events_url":"https://api.github.com/users/JayYip/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/JayYip/m3tl/issues/comments/632488926","html_url":"https://github.com/JayYip/m3tl/issues/42#issuecomment-632488926","issue_url":"https://api.github.com/repos/JayYip/m3tl/issues/42","id":632488926,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMjQ4ODkyNg==","user":{"login":"nefujiangping","id":16358182,"node_id":"MDQ6VXNlcjE2MzU4MTgy","avatar_url":"https://avatars.githubusercontent.com/u/16358182?v=4","gravatar_id":"","url":"https://api.github.com/users/nefujiangping","html_url":"https://github.com/nefujiangping","followers_url":"https://api.github.com/users/nefujiangping/followers","following_url":"https://api.github.com/users/nefujiangping/following{/other_user}","gists_url":"https://api.github.com/users/nefujiangping/gists{/gist_id}","starred_url":"https://api.github.com/users/nefujiangping/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nefujiangping/subscriptions","organizations_url":"https://api.github.com/users/nefujiangping/orgs","repos_url":"https://api.github.com/users/nefujiangping/repos","events_url":"https://api.github.com/users/nefujiangping/events{/privacy}","received_events_url":"https://api.github.com/users/nefujiangping/received_events","type":"User","site_admin":false},"created_at":"2020-05-22T05:24:17Z","updated_at":"2020-05-22T05:24:17Z","author_association":"NONE","body":"原来是这样啊，学习了，谢谢你的回复。","reactions":{"url":"https://api.github.com/repos/JayYip/m3tl/issues/comments/632488926/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nefujiangping","id":16358182,"node_id":"MDQ6VXNlcjE2MzU4MTgy","avatar_url":"https://avatars.githubusercontent.com/u/16358182?v=4","gravatar_id":"","url":"https://api.github.com/users/nefujiangping","html_url":"https://github.com/nefujiangping","followers_url":"https://api.github.com/users/nefujiangping/followers","following_url":"https://api.github.com/users/nefujiangping/following{/other_user}","gists_url":"https://api.github.com/users/nefujiangping/gists{/gist_id}","starred_url":"https://api.github.com/users/nefujiangping/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nefujiangping/subscriptions","organizations_url":"https://api.github.com/users/nefujiangping/orgs","repos_url":"https://api.github.com/users/nefujiangping/repos","events_url":"https://api.github.com/users/nefujiangping/events{/privacy}","received_events_url":"https://api.github.com/users/nefujiangping/received_events","type":"User","site_admin":false}}]