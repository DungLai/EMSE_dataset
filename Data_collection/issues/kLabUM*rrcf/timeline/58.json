[{"url":"https://api.github.com/repos/kLabUM/rrcf/issues/comments/507758032","html_url":"https://github.com/kLabUM/rrcf/issues/58#issuecomment-507758032","issue_url":"https://api.github.com/repos/kLabUM/rrcf/issues/58","id":507758032,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNzc1ODAzMg==","user":{"login":"nerooooooz","id":43416943,"node_id":"MDQ6VXNlcjQzNDE2OTQz","avatar_url":"https://avatars.githubusercontent.com/u/43416943?v=4","gravatar_id":"","url":"https://api.github.com/users/nerooooooz","html_url":"https://github.com/nerooooooz","followers_url":"https://api.github.com/users/nerooooooz/followers","following_url":"https://api.github.com/users/nerooooooz/following{/other_user}","gists_url":"https://api.github.com/users/nerooooooz/gists{/gist_id}","starred_url":"https://api.github.com/users/nerooooooz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nerooooooz/subscriptions","organizations_url":"https://api.github.com/users/nerooooooz/orgs","repos_url":"https://api.github.com/users/nerooooooz/repos","events_url":"https://api.github.com/users/nerooooooz/events{/privacy}","received_events_url":"https://api.github.com/users/nerooooooz/received_events","type":"User","site_admin":false},"created_at":"2019-07-02T16:48:07Z","updated_at":"2019-07-02T16:48:07Z","author_association":"NONE","body":"Same question on timeDecay...and I also wonder if this one is good for trending data because there are a lot of points with high codisp in my test for trending data (no anomalys)...","reactions":{"url":"https://api.github.com/repos/kLabUM/rrcf/issues/comments/507758032/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nerooooooz","id":43416943,"node_id":"MDQ6VXNlcjQzNDE2OTQz","avatar_url":"https://avatars.githubusercontent.com/u/43416943?v=4","gravatar_id":"","url":"https://api.github.com/users/nerooooooz","html_url":"https://github.com/nerooooooz","followers_url":"https://api.github.com/users/nerooooooz/followers","following_url":"https://api.github.com/users/nerooooooz/following{/other_user}","gists_url":"https://api.github.com/users/nerooooooz/gists{/gist_id}","starred_url":"https://api.github.com/users/nerooooooz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nerooooooz/subscriptions","organizations_url":"https://api.github.com/users/nerooooooz/orgs","repos_url":"https://api.github.com/users/nerooooooz/repos","events_url":"https://api.github.com/users/nerooooooz/events{/privacy}","received_events_url":"https://api.github.com/users/nerooooooz/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/kLabUM/rrcf/issues/comments/508274470","html_url":"https://github.com/kLabUM/rrcf/issues/58#issuecomment-508274470","issue_url":"https://api.github.com/repos/kLabUM/rrcf/issues/58","id":508274470,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODI3NDQ3MA==","user":{"login":"mdbartos","id":8175317,"node_id":"MDQ6VXNlcjgxNzUzMTc=","avatar_url":"https://avatars.githubusercontent.com/u/8175317?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbartos","html_url":"https://github.com/mdbartos","followers_url":"https://api.github.com/users/mdbartos/followers","following_url":"https://api.github.com/users/mdbartos/following{/other_user}","gists_url":"https://api.github.com/users/mdbartos/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbartos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbartos/subscriptions","organizations_url":"https://api.github.com/users/mdbartos/orgs","repos_url":"https://api.github.com/users/mdbartos/repos","events_url":"https://api.github.com/users/mdbartos/events{/privacy}","received_events_url":"https://api.github.com/users/mdbartos/received_events","type":"User","site_admin":false},"created_at":"2019-07-03T22:22:01Z","updated_at":"2019-07-03T22:22:01Z","author_association":"MEMBER","body":"There are a lot of different ways one could implement time decay. Here's one way using batch mode. I just used a series of rolling gaussian pdfs to define the sampling frequency.\r\n\r\n```python\r\nimport numpy as np\r\nimport pandas as pd\r\nimport scipy.stats\r\nimport rrcf\r\nfrom matplotlib import pyplot as plt\r\nimport seaborn as sns\r\n\r\n# Read data\r\ntaxi = pd.read_csv('../resources/nyc_taxi.csv', index_col=0)\r\ntaxi.index = pd.to_datetime(taxi.index)\r\ndata = taxi['value'].astype(float).values\r\nn = data.shape[0]\r\n\r\n# Set tree parameters\r\nnum_trees = 200\r\nshingle_size = 48\r\ntree_size = 1000\r\n\r\n# Use the \"shingle\" generator to create rolling window\r\npoints = rrcf.shingle(data, size=shingle_size)\r\npoints = np.vstack([point for point in points])\r\nnum_points = points.shape[0]\r\n\r\n# Chunk data into segments\r\nnum_chunks = 40\r\nchunk_size = num_points // num_chunks\r\nchunks = (chunk * chunk_size for chunk in range(num_chunks))\r\n\r\nforest = []\r\npdfs = []\r\nfor chunk in chunks:\r\n    # Create probability density function for sample\r\n    g = scipy.stats.norm(loc=chunk, scale=400).pdf(np.linspace(0, num_points, num_points))\r\n    g *= (1/g.sum())\r\n    # Sample data with probability density function defined by g\r\n    ixs = np.random.choice(num_points, size=(num_points // tree_size, tree_size), \r\n                                             replace=False, p=g)\r\n    # Create trees from sampled points\r\n    trees = [rrcf.RCTree(points[ix], index_labels=ix) for ix in ixs]\r\n    forest.extend(trees)\r\n    # Store pdf for plotting purposes\r\n    pdfs.append(g)\r\n    \r\n# Compute CoDisp\r\navg_codisp = pd.Series(0.0, index=np.arange(num_points))\r\nindex = np.zeros(num_points)\r\nfor tree in forest:\r\n    codisp = pd.Series({leaf : tree.codisp(leaf)\r\n                        for leaf in tree.leaves})\r\n    avg_codisp[codisp.index] += codisp\r\n    np.add.at(index, codisp.index.values, 1)\r\navg_codisp /= index\r\navg_codisp.index = taxi.iloc[(shingle_size - 1):].index\r\n```\r\n\r\nPlotting:\r\n```python\r\n# Plot results\r\nfig, ax = plt.subplots(3, figsize=(10, 9))\r\n(taxi['value'] / 1000).plot(ax=ax[0], color='0.5', alpha=0.8)\r\navg_codisp.plot(ax=ax[2], color='#E8685D', alpha=0.8, label='RRCF')\r\nfor pdf in pdfs[1:]:\r\n    pd.Series(pdf, index=avg_codisp.index).plot(ax=ax[1], c='0.6')    \r\nax[0].set_title('Taxi passenger timeseries')\r\nax[1].set_title('Rolling probability density functions')\r\nax[2].set_title('Anomaly score')\r\nax[0].set_ylabel('Thousands of passengers')\r\nax[1].set_ylabel('p(x)')\r\nax[2].set_ylabel('CoDisp')\r\nax[0].set_xlabel('')\r\nax[1].set_xlabel('')\r\nax[2].set_xlabel('')\r\nplt.tight_layout()\r\nplt.savefig('decay_example.png')\r\n```\r\n\r\n![decay_example](https://user-images.githubusercontent.com/8175317/60628267-b0f98380-9dbe-11e9-95b8-6f88f4085894.png)","reactions":{"url":"https://api.github.com/repos/kLabUM/rrcf/issues/comments/508274470/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mdbartos","id":8175317,"node_id":"MDQ6VXNlcjgxNzUzMTc=","avatar_url":"https://avatars.githubusercontent.com/u/8175317?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbartos","html_url":"https://github.com/mdbartos","followers_url":"https://api.github.com/users/mdbartos/followers","following_url":"https://api.github.com/users/mdbartos/following{/other_user}","gists_url":"https://api.github.com/users/mdbartos/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbartos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbartos/subscriptions","organizations_url":"https://api.github.com/users/mdbartos/orgs","repos_url":"https://api.github.com/users/mdbartos/repos","events_url":"https://api.github.com/users/mdbartos/events{/privacy}","received_events_url":"https://api.github.com/users/mdbartos/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/kLabUM/rrcf/issues/comments/587553065","html_url":"https://github.com/kLabUM/rrcf/issues/58#issuecomment-587553065","issue_url":"https://api.github.com/repos/kLabUM/rrcf/issues/58","id":587553065,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NzU1MzA2NQ==","user":{"login":"vidbap","id":61200471,"node_id":"MDQ6VXNlcjYxMjAwNDcx","avatar_url":"https://avatars.githubusercontent.com/u/61200471?v=4","gravatar_id":"","url":"https://api.github.com/users/vidbap","html_url":"https://github.com/vidbap","followers_url":"https://api.github.com/users/vidbap/followers","following_url":"https://api.github.com/users/vidbap/following{/other_user}","gists_url":"https://api.github.com/users/vidbap/gists{/gist_id}","starred_url":"https://api.github.com/users/vidbap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vidbap/subscriptions","organizations_url":"https://api.github.com/users/vidbap/orgs","repos_url":"https://api.github.com/users/vidbap/repos","events_url":"https://api.github.com/users/vidbap/events{/privacy}","received_events_url":"https://api.github.com/users/vidbap/received_events","type":"User","site_admin":false},"created_at":"2020-02-18T16:36:38Z","updated_at":"2020-02-18T16:36:38Z","author_association":"NONE","body":"Awesome example, thank you @mdbartos \r\n#1. Doesn't the shingle size determine the time decay - how much of the past data to use defined by this rolling window?  So, why would we do batching as proposed and advantages of doing a sampling on it?\r\n\r\n#2.  Attribution Score - I would also be interested in adding this as a feature.  AWS has a random cut forest implementation in Kinesis Stream Analytics with \"explanation\" that does exactly this, however, we want to use it in our datacenter to track operations anomalies.\r\n\r\nBest regards.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/kLabUM/rrcf/issues/comments/587553065/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vidbap","id":61200471,"node_id":"MDQ6VXNlcjYxMjAwNDcx","avatar_url":"https://avatars.githubusercontent.com/u/61200471?v=4","gravatar_id":"","url":"https://api.github.com/users/vidbap","html_url":"https://github.com/vidbap","followers_url":"https://api.github.com/users/vidbap/followers","following_url":"https://api.github.com/users/vidbap/following{/other_user}","gists_url":"https://api.github.com/users/vidbap/gists{/gist_id}","starred_url":"https://api.github.com/users/vidbap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vidbap/subscriptions","organizations_url":"https://api.github.com/users/vidbap/orgs","repos_url":"https://api.github.com/users/vidbap/repos","events_url":"https://api.github.com/users/vidbap/events{/privacy}","received_events_url":"https://api.github.com/users/vidbap/received_events","type":"User","site_admin":false}},{"id":3047905769,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzA0NzkwNTc2OQ==","url":"https://api.github.com/repos/kLabUM/rrcf/issues/events/3047905769","actor":{"login":"mdbartos","id":8175317,"node_id":"MDQ6VXNlcjgxNzUzMTc=","avatar_url":"https://avatars.githubusercontent.com/u/8175317?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbartos","html_url":"https://github.com/mdbartos","followers_url":"https://api.github.com/users/mdbartos/followers","following_url":"https://api.github.com/users/mdbartos/following{/other_user}","gists_url":"https://api.github.com/users/mdbartos/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbartos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbartos/subscriptions","organizations_url":"https://api.github.com/users/mdbartos/orgs","repos_url":"https://api.github.com/users/mdbartos/repos","events_url":"https://api.github.com/users/mdbartos/events{/privacy}","received_events_url":"https://api.github.com/users/mdbartos/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-02-18T16:36:38Z","performed_via_github_app":null},{"id":3047905771,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMwNDc5MDU3NzE=","url":"https://api.github.com/repos/kLabUM/rrcf/issues/events/3047905771","actor":{"login":"mdbartos","id":8175317,"node_id":"MDQ6VXNlcjgxNzUzMTc=","avatar_url":"https://avatars.githubusercontent.com/u/8175317?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbartos","html_url":"https://github.com/mdbartos","followers_url":"https://api.github.com/users/mdbartos/followers","following_url":"https://api.github.com/users/mdbartos/following{/other_user}","gists_url":"https://api.github.com/users/mdbartos/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbartos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbartos/subscriptions","organizations_url":"https://api.github.com/users/mdbartos/orgs","repos_url":"https://api.github.com/users/mdbartos/repos","events_url":"https://api.github.com/users/mdbartos/events{/privacy}","received_events_url":"https://api.github.com/users/mdbartos/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-02-18T16:36:38Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/kLabUM/rrcf/issues/comments/595697416","html_url":"https://github.com/kLabUM/rrcf/issues/58#issuecomment-595697416","issue_url":"https://api.github.com/repos/kLabUM/rrcf/issues/58","id":595697416,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NTY5NzQxNg==","user":{"login":"Aubindb","id":39379554,"node_id":"MDQ6VXNlcjM5Mzc5NTU0","avatar_url":"https://avatars.githubusercontent.com/u/39379554?v=4","gravatar_id":"","url":"https://api.github.com/users/Aubindb","html_url":"https://github.com/Aubindb","followers_url":"https://api.github.com/users/Aubindb/followers","following_url":"https://api.github.com/users/Aubindb/following{/other_user}","gists_url":"https://api.github.com/users/Aubindb/gists{/gist_id}","starred_url":"https://api.github.com/users/Aubindb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Aubindb/subscriptions","organizations_url":"https://api.github.com/users/Aubindb/orgs","repos_url":"https://api.github.com/users/Aubindb/repos","events_url":"https://api.github.com/users/Aubindb/events{/privacy}","received_events_url":"https://api.github.com/users/Aubindb/received_events","type":"User","site_admin":false},"created_at":"2020-03-06T10:09:38Z","updated_at":"2020-03-06T10:09:38Z","author_association":"NONE","body":"Hello, \r\n\r\nI would also be grateful for an example in high dimension. I managed to adapt the shingling to get multidimensional rolling windows I'm struggling to adapt the rest of the batch example.\r\n\r\nThank you!!","reactions":{"url":"https://api.github.com/repos/kLabUM/rrcf/issues/comments/595697416/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Aubindb","id":39379554,"node_id":"MDQ6VXNlcjM5Mzc5NTU0","avatar_url":"https://avatars.githubusercontent.com/u/39379554?v=4","gravatar_id":"","url":"https://api.github.com/users/Aubindb","html_url":"https://github.com/Aubindb","followers_url":"https://api.github.com/users/Aubindb/followers","following_url":"https://api.github.com/users/Aubindb/following{/other_user}","gists_url":"https://api.github.com/users/Aubindb/gists{/gist_id}","starred_url":"https://api.github.com/users/Aubindb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Aubindb/subscriptions","organizations_url":"https://api.github.com/users/Aubindb/orgs","repos_url":"https://api.github.com/users/Aubindb/repos","events_url":"https://api.github.com/users/Aubindb/events{/privacy}","received_events_url":"https://api.github.com/users/Aubindb/received_events","type":"User","site_admin":false}},{"id":4282118233,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDI4MjExODIzMw==","url":"https://api.github.com/repos/kLabUM/rrcf/issues/events/4282118233","actor":{"login":"mdbartos","id":8175317,"node_id":"MDQ6VXNlcjgxNzUzMTc=","avatar_url":"https://avatars.githubusercontent.com/u/8175317?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbartos","html_url":"https://github.com/mdbartos","followers_url":"https://api.github.com/users/mdbartos/followers","following_url":"https://api.github.com/users/mdbartos/following{/other_user}","gists_url":"https://api.github.com/users/mdbartos/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbartos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbartos/subscriptions","organizations_url":"https://api.github.com/users/mdbartos/orgs","repos_url":"https://api.github.com/users/mdbartos/repos","events_url":"https://api.github.com/users/mdbartos/events{/privacy}","received_events_url":"https://api.github.com/users/mdbartos/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-02-02T22:38:03Z","performed_via_github_app":null},{"id":4282118234,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQyODIxMTgyMzQ=","url":"https://api.github.com/repos/kLabUM/rrcf/issues/events/4282118234","actor":{"login":"mdbartos","id":8175317,"node_id":"MDQ6VXNlcjgxNzUzMTc=","avatar_url":"https://avatars.githubusercontent.com/u/8175317?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbartos","html_url":"https://github.com/mdbartos","followers_url":"https://api.github.com/users/mdbartos/followers","following_url":"https://api.github.com/users/mdbartos/following{/other_user}","gists_url":"https://api.github.com/users/mdbartos/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbartos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbartos/subscriptions","organizations_url":"https://api.github.com/users/mdbartos/orgs","repos_url":"https://api.github.com/users/mdbartos/repos","events_url":"https://api.github.com/users/mdbartos/events{/privacy}","received_events_url":"https://api.github.com/users/mdbartos/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-02-02T22:38:03Z","performed_via_github_app":null}]