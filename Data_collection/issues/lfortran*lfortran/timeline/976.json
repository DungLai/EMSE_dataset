[{"actor":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"created_at":"2022-11-02T06:27:02Z","updated_at":"2022-11-02T06:27:02Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/512","repository_url":"https://api.github.com/repos/lfortran/lfortran","labels_url":"https://api.github.com/repos/lfortran/lfortran/issues/512/labels{/name}","comments_url":"https://api.github.com/repos/lfortran/lfortran/issues/512/comments","events_url":"https://api.github.com/repos/lfortran/lfortran/issues/512/events","html_url":"https://github.com/lfortran/lfortran/issues/512","id":1338781431,"node_id":"I_kwDOCpMuHc5PzC73","number":512,"title":"Compile minpack","user":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"labels":[{"id":4432142216,"node_id":"LA_kwDOCpMuHc8AAAABCC0fiA","url":"https://api.github.com/repos/lfortran/lfortran/labels/SciPy","name":"SciPy","color":"d4c5f9","default":false,"description":"issues related to enable LFortran to compile the entire FORTRAN codebase in SciPy"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":29,"created_at":"2022-08-15T09:58:36Z","updated_at":"2023-01-17T14:08:39Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"repository":{"id":177417757,"node_id":"MDEwOlJlcG9zaXRvcnkxNzc0MTc3NTc=","name":"lfortran","full_name":"lfortran/lfortran","private":false,"owner":{"login":"lfortran","id":40613057,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQwNjEzMDU3","avatar_url":"https://avatars.githubusercontent.com/u/40613057?v=4","gravatar_id":"","url":"https://api.github.com/users/lfortran","html_url":"https://github.com/lfortran","followers_url":"https://api.github.com/users/lfortran/followers","following_url":"https://api.github.com/users/lfortran/following{/other_user}","gists_url":"https://api.github.com/users/lfortran/gists{/gist_id}","starred_url":"https://api.github.com/users/lfortran/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lfortran/subscriptions","organizations_url":"https://api.github.com/users/lfortran/orgs","repos_url":"https://api.github.com/users/lfortran/repos","events_url":"https://api.github.com/users/lfortran/events{/privacy}","received_events_url":"https://api.github.com/users/lfortran/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/lfortran/lfortran","description":"Official main repository for LFortran","fork":false,"url":"https://api.github.com/repos/lfortran/lfortran","forks_url":"https://api.github.com/repos/lfortran/lfortran/forks","keys_url":"https://api.github.com/repos/lfortran/lfortran/keys{/key_id}","collaborators_url":"https://api.github.com/repos/lfortran/lfortran/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/lfortran/lfortran/teams","hooks_url":"https://api.github.com/repos/lfortran/lfortran/hooks","issue_events_url":"https://api.github.com/repos/lfortran/lfortran/issues/events{/number}","events_url":"https://api.github.com/repos/lfortran/lfortran/events","assignees_url":"https://api.github.com/repos/lfortran/lfortran/assignees{/user}","branches_url":"https://api.github.com/repos/lfortran/lfortran/branches{/branch}","tags_url":"https://api.github.com/repos/lfortran/lfortran/tags","blobs_url":"https://api.github.com/repos/lfortran/lfortran/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/lfortran/lfortran/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/lfortran/lfortran/git/refs{/sha}","trees_url":"https://api.github.com/repos/lfortran/lfortran/git/trees{/sha}","statuses_url":"https://api.github.com/repos/lfortran/lfortran/statuses/{sha}","languages_url":"https://api.github.com/repos/lfortran/lfortran/languages","stargazers_url":"https://api.github.com/repos/lfortran/lfortran/stargazers","contributors_url":"https://api.github.com/repos/lfortran/lfortran/contributors","subscribers_url":"https://api.github.com/repos/lfortran/lfortran/subscribers","subscription_url":"https://api.github.com/repos/lfortran/lfortran/subscription","commits_url":"https://api.github.com/repos/lfortran/lfortran/commits{/sha}","git_commits_url":"https://api.github.com/repos/lfortran/lfortran/git/commits{/sha}","comments_url":"https://api.github.com/repos/lfortran/lfortran/comments{/number}","issue_comment_url":"https://api.github.com/repos/lfortran/lfortran/issues/comments{/number}","contents_url":"https://api.github.com/repos/lfortran/lfortran/contents/{+path}","compare_url":"https://api.github.com/repos/lfortran/lfortran/compare/{base}...{head}","merges_url":"https://api.github.com/repos/lfortran/lfortran/merges","archive_url":"https://api.github.com/repos/lfortran/lfortran/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/lfortran/lfortran/downloads","issues_url":"https://api.github.com/repos/lfortran/lfortran/issues{/number}","pulls_url":"https://api.github.com/repos/lfortran/lfortran/pulls{/number}","milestones_url":"https://api.github.com/repos/lfortran/lfortran/milestones{/number}","notifications_url":"https://api.github.com/repos/lfortran/lfortran/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/lfortran/lfortran/labels{/name}","releases_url":"https://api.github.com/repos/lfortran/lfortran/releases{/id}","deployments_url":"https://api.github.com/repos/lfortran/lfortran/deployments","created_at":"2019-03-24T13:22:20Z","updated_at":"2023-01-19T07:32:40Z","pushed_at":"2023-01-19T19:07:25Z","git_url":"git://github.com/lfortran/lfortran.git","ssh_url":"git@github.com:lfortran/lfortran.git","clone_url":"https://github.com/lfortran/lfortran.git","svn_url":"https://github.com/lfortran/lfortran","homepage":"https://lfortran.org/","size":19098,"stargazers_count":504,"watchers_count":504,"language":"C++","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":52,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":582,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["compiler","fortran","interactive","jupyter","jupyter-kernels","jupyter-notebook","library","repl"],"visibility":"public","forks":52,"open_issues":582,"watchers":504,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"### TODO to public a blog post\r\n\r\n* [x] add CI: https://github.com/lfortran/lfortran/pull/1182\r\n* [ ] get rid of all the three \"XX\" commits in the minpack repo (by fixing it in LFortran)\r\n* [ ] get all examples working\r\n* [ ] should run at our CI correctly for a few weeks to reach \"beta\" (ideally 2 months, but we can \"overwrite\" this requirement)\r\n* [ ] write up a blog post and announce\r\n\r\n### Tracking examples\r\n- [x] examples_hybrd\r\n- [x] examples_hybrd1\r\n- [ ] examples_lmder1\r\n   - #1150 \r\n   - #1133\r\n- [x] examples_lmdif1\r\n  - #1122\r\n- [ ] examples_primes\r\n   - #967 \r\n\r\n\r\n---------\r\n\r\n\r\n\r\n\r\n### Highest Priority\r\n\r\nThe code now compiles to binary (with just minimal source modifications, see below), but doesn't produce correct answers due to:\r\n\r\n* [x] https://github.com/lfortran/lfortran/issues/971 (fixed by #972)\r\n* [x] https://github.com/lfortran/lfortran/issues/976\r\n\r\nAnd perhaps other issues that we have not identified yet.\r\n\r\n---------\r\n\r\n### AST->ASR\r\n\r\nThese must be fixed, but the workaround is relatively simple by modifying Minpack sources, so are lower priority than the above.\r\n\r\nKnown TODO items for ASR (we commented out code for now):\r\n\r\n* [ ] equivalence statement\r\n* [x] statement functions (https://github.com/lfortran/lfortran/pull/911)\r\n* [x] implicit external (#950)\r\n* [ ] implied do loop (#981)\r\n* [x] do loop non-constant integer increment (#909, #946, #979)\r\n* [x] argument callback (undeclared)\r\n* [x] external function declared as \"double precision f\", when it should probably be \"external f\"\r\n* [x] implicit interface failure\r\n* [ ] LFortran also prints several warnings for missing features that are ignored, so we have to fix those\r\n* [x] The -I and -J options (https://github.com/lfortran/lfortran/pull/930)\r\n* [ ] `format()`: this is not strictly needed to get the correct answer and might not even be needed for SciPy, but it would be good to have it, so that things format on the screen correctly\r\n\r\n\r\n---------------\r\n\r\nSteps:\r\n\r\nhttps://github.com/certik/minpack/tree/scipy\r\n\r\n```console\r\ngit clone https://github.com/certik/minpack.git\r\ncd minpack\r\ngit checkout -t origin/scipy\r\nFC=lfortran cmake .\r\nmake\r\nctest\r\n```\r\n\r\nAll files compile to ASR as of 04d5732088ba195865ee9ccf322a4eea55070424, and when compiled sequentially, there is a failure in the LLVM backend:\r\n```console\r\n$ make\r\n[  2%] Building Fortran object src/CMakeFiles/minpack.dir/minpack.f90.o\r\n[  4%] Building Fortran object src/CMakeFiles/minpack.dir/covar.f.o\r\n[  6%] Building Fortran object src/CMakeFiles/minpack.dir/errjac.f.o\r\n[  8%] Building Fortran object src/CMakeFiles/minpack.dir/hybipt.f.o\r\n[ 10%] Building Fortran object src/CMakeFiles/minpack.dir/lhesfcn.f.o\r\nInternal Compiler Error: Unhandled exception\r\nTraceback (most recent call last):\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/bin/lfortran.cpp\", line 1726\r\n    return compile_to_object_file(arg_file, outfile, false,\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/bin/lfortran.cpp\", line 733\r\n    result = fe.get_asr2(input, lm, diagnostics);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/fortran_evaluator.cpp\", line 227\r\n    Result<ASR::TranslationUnit_t*> res2 = get_asr3(*ast, diagnostics);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/fortran_evaluator.cpp\", line 249\r\n    compiler_options.symtab_only, compiler_options);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/semantics/ast_to_asr.cpp\", line 53\r\n    auto res = body_visitor(al, ast, diagnostics, unit, compiler_options, template_type_parameters);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/semantics/ast_body_visitor.cpp\", line 1685\r\n    b.template_type_parameters = template_type_parameters;\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/semantics/ast_body_visitor.cpp\", line 106\r\n    visit_ast(*x.m_items[i]);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/ast.h\", line 4694\r\n    void visit_ast(const ast_t &b) { visit_ast_t(b, self()); }\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/ast.h\", line 4652\r\n    case astType::mod: { v.visit_mod((const mod_t &)x); return; }\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/ast.h\", line 4702\r\n    void visit_program_unit(const program_unit_t &b) { visit_program_unit_t(b, self()); }\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/ast.h\", line 4306\r\n    case program_unitType::Subroutine: { v.visit_Subroutine((const Subroutine_t &)x); return; }\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/semantics/ast_body_visitor.cpp\", line 975\r\n    transform_stmts(body, x.n_body, x.m_body);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/semantics/ast_body_visitor.cpp\", line 83\r\n    this->visit_stmt(*m_body[i]);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/ast.h\", line 4737\r\n    void visit_stmt(const stmt_t &b) { visit_stmt_t(b, self()); }\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/ast.h\", line 4412\r\n    case stmtType::Format: { v.visit_Format((const Format_t &)x); return; }\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/semantics/ast_common_visitor.h\", line 872\r\n    throw SemanticError(\"The value in data must be a constant\",\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/asr.h\", line 40\r\n    LFORTRAN_ASSERT(is_a<T>(*f));\r\nAssertFailed: is_a<T>(*f)\r\nmake[2]: *** [src/CMakeFiles/minpack.dir/lhesfcn.f.o] Error 1\r\nmake[1]: *** [src/CMakeFiles/minpack.dir/all] Error 2\r\nmake: *** [all] Error 2\r\n```\r\n\r\nCurrently as of 88b1ef7c5ea99fe40aa05190a68634fbc4e1497e it fails with:\r\n\r\n```console\r\n$ make\r\nScanning dependencies of target minpack\r\n[  2%] Building Fortran object src/CMakeFiles/minpack.dir/minpack.f90.o\r\n[  4%] Building Fortran object src/CMakeFiles/minpack.dir/covar.f.o\r\n[  6%] Building Fortran object src/CMakeFiles/minpack.dir/errjac.f.o\r\n[  8%] Building Fortran object src/CMakeFiles/minpack.dir/hybipt.f.o\r\n[ 10%] Building Fortran object src/CMakeFiles/minpack.dir/lhesfcn.f.o\r\nTraceback (most recent call last):\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/bin/lfortran.cpp\", line 1726\r\n    return compile_to_object_file(arg_file, outfile, false,\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/bin/lfortran.cpp\", line 733\r\n    result = fe.get_asr2(input, lm, diagnostics);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/fortran_evaluator.cpp\", line 227\r\n    Result<ASR::TranslationUnit_t*> res2 = get_asr3(*ast, diagnostics);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/fortran_evaluator.cpp\", line 249\r\n    compiler_options.symtab_only, compiler_options);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/semantics/ast_to_asr.cpp\", line 53\r\n    auto res = body_visitor(al, ast, diagnostics, unit, compiler_options, template_type_parameters);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/semantics/ast_body_visitor.cpp\", line 1812\r\n    b.template_type_parameters = template_type_parameters;\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/semantics/ast_body_visitor.cpp\", line 114\r\n    visit_ast(*x.m_items[i]);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/ast.h\", line 4694\r\n    void visit_ast(const ast_t &b) { visit_ast_t(b, self()); }\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/ast.h\", line 4652\r\n    case astType::mod: { v.visit_mod((const mod_t &)x); return; }\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/ast.h\", line 4702\r\n    void visit_program_unit(const program_unit_t &b) { visit_program_unit_t(b, self()); }\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/ast.h\", line 4306\r\n    case program_unitType::Subroutine: { v.visit_Subroutine((const Subroutine_t &)x); return; }\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/semantics/ast_body_visitor.cpp\", line 990\r\n    transform_stmts(body, x.n_body, x.m_body);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/semantics/ast_body_visitor.cpp\", line 90\r\n    this->visit_stmt(*m_body[i]);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/ast.h\", line 4737\r\n    void visit_stmt(const stmt_t &b) { visit_stmt_t(b, self()); }\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/ast.h\", line 4412\r\n    case stmtType::Format: { v.visit_Format((const Format_t &)x); return; }\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/semantics/ast_common_visitor.h\", line 917\r\n    current_body->push_back(al, assign_stmt);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/semantics/ast_common_visitor.h\", line 917\r\n    current_body->push_back(al, assign_stmt);\r\n  Binary file \"/usr/lib/system/libsystem_platform.dylib\", local address: 0x1803244e3\r\nSegfault: Signal SIGSEGV (segmentation fault) received\r\nmake[2]: *** [src/CMakeFiles/minpack.dir/lhesfcn.f.o] Error 1\r\nmake[1]: *** [src/CMakeFiles/minpack.dir/all] Error 2\r\nmake: *** [all] Error 2\r\n```\r\n\r\nwhich is a slight regression caused by #864. As of 8e41e7f7e (a slightly prior commit) the error is:\r\n```console\r\n$ make\r\n[  2%] Building Fortran object src/CMakeFiles/minpack.dir/minpack.f90.o\r\n[  4%] Building Fortran object src/CMakeFiles/minpack.dir/covar.f.o\r\n[  6%] Building Fortran object src/CMakeFiles/minpack.dir/errjac.f.o\r\n[  8%] Building Fortran object src/CMakeFiles/minpack.dir/hybipt.f.o\r\n[ 10%] Building Fortran object src/CMakeFiles/minpack.dir/lhesfcn.f.o\r\nsemantic error: Object type ArrayItem is not implemented yet.\r\n  --> /Users/ondrej/repos/lfortran/minpack/src/lhesfcn.f:64:12\r\n   |\r\n64 |       data y(1),y(2),y(3),y(4),y(5),y(6),y(7),y(8),y(9),y(10),y(11),\r\n   |            ^^^^ \r\n\r\n\r\nNote: if any of the above error or warning messages are not clear or are lacking\r\ncontext please report it to us (we consider that a bug that needs to be fixed).\r\nmake[2]: *** [src/CMakeFiles/minpack.dir/lhesfcn.f.o] Error 1\r\nmake[1]: *** [src/CMakeFiles/minpack.dir/all] Error 2\r\nmake: *** [all] Error 2\r\n```\r\nWhich shows where the issue is.\r\n\r\n\r\n\r\n----------------\r\n\r\n*Original issue*: https://gitlab.com/lfortran/lfortran/-/issues/664\r\n\r\nIt would be very useful to have LFortran able to compile Minpack, currently it fails with commit 74d6438a8\r\n\r\n```\r\n❯ lfortran --version\r\nLFortran version: 0.14.0-1345-g74d6438a8\r\nPlatform: Linux\r\nDefault target: x86_64-unknown-linux-gnu\r\n❯ fpm build --compiler lfortran\r\nminpack.f90                            failed.\r\n[   7%]Compiling...\r\nsemantic error: Value of a parameter variable must evaluate to a compile time constant\r\n  --> ././src/minpack.f90:20:5\r\n   |\r\n20 |     real(wp), parameter, private :: epsmch = dpmpar(1) !! the machine precision\r\n   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ \r\n\r\n\r\nNote: if any of the above error or warning messages are not clear or are lacking\r\ncontext please report it to us (we consider that a bug that needs to be fixed).\r\n```\r\n\r\nWith a minor patch:\r\n\r\n```diff\r\ndiff --git a/src/minpack.f90 b/src/minpack.f90\r\nindex 65fe5b1..ad60201 100644\r\n--- a/src/minpack.f90\r\n+++ b/src/minpack.f90\r\n@@ -17,7 +17,7 @@ module minpack_module\r\n                                                    tiny(1.0_wp), &\r\n                                                    huge(1.0_wp)] !! machine constants\r\n \r\n-    real(wp), parameter, private :: epsmch = dpmpar(1) !! the machine precision\r\n+    real(wp), parameter, private :: epsmch = epsilon(1.0_wp) !! the machine precision\r\n     real(wp), parameter, private :: one = 1.0_wp\r\n     real(wp), parameter, private :: zero = 0.0_wp\r\n \r\n```\r\n\r\nI'm getting an error for the procedure pointer\r\n\r\n```\r\n❯ fpm build --compiler lfortran\r\nminpack.f90                            failed.\r\n[   7%]Compiling...\r\nsemantic error: Type not implemented yet.\r\n   --> ./src/minpack.f90:438:9\r\n    |\r\n438 |         procedure(func) :: fcn !! the user-supplied subroutine which\r\n    |         ^^^^^^^^^^^^^^^^^^^^^^ \r\n\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/512/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/lfortran/lfortran/issues/512/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":7728181847,"node_id":"RTE_lADOCpMuHc5VY0w9zwAAAAHMorJX","url":"https://api.github.com/repos/lfortran/lfortran/issues/events/7728181847","actor":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2022-11-03T00:50:55Z","rename":{"from":"Minpack wrong value","to":"Passing `a(1,n)` as `a(1:m,n)`"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1301530302","html_url":"https://github.com/lfortran/lfortran/issues/976#issuecomment-1301530302","issue_url":"https://api.github.com/repos/lfortran/lfortran/issues/976","id":1301530302,"node_id":"IC_kwDOCpMuHc5Nk8a-","user":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"created_at":"2022-11-03T00:51:33Z","updated_at":"2022-11-03T00:59:57Z","author_association":"CONTRIBUTOR","body":"Found the problem:\r\n```diff\r\n--- a/src/qrfac.f\r\n+++ b/src/qrfac.f\r\n@@ -86,16 +86,19 @@ c     **********\r\n c\r\n c     epsmch is the machine precision.\r\n c\r\n       epsmch = dpmpar(1)\r\n c\r\n c     compute the initial column norms and initialize several arrays.\r\n c\r\n       do 10 j = 1, n\r\n-         acnorm(j) = enorm(m,a(1,j))\r\n+         acnorm(j) = enorm(m,a(1:m,j))\r\n          rdiag(j) = acnorm(j)\r\n          wa(j) = rdiag(j)\r\n          if (pivot) ipvt(j) = j\r\n    10    continue\r\n c\r\n c     reduce a to r with householder transformations.\r\n c\r\n```\r\nThis is passing an array section (slice) `a(1:m,j)`, by passing an element `a(1,j)`, and it implicitly means `m` elements from it, whatever the function takes. I think it must always mean in the inner most index (the contiguous index).\r\n\r\nHowever, `enorm` is an implicit function, inferred from the arguments... So this is ambiguous, the signature can either be `(integer, real)` or `(integer, real :: x(n))`.","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1301530302/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false}},{"id":7728195980,"node_id":"RTE_lADOCpMuHc5VY0w9zwAAAAHMoumM","url":"https://api.github.com/repos/lfortran/lfortran/issues/events/7728195980","actor":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2022-11-03T00:55:35Z","rename":{"from":"Passing `a(1,n)` as `a(1:m,n)`","to":"Passing array section `a(1:m,n)` as `a(1,n)`"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1301601482","html_url":"https://github.com/lfortran/lfortran/issues/976#issuecomment-1301601482","issue_url":"https://api.github.com/repos/lfortran/lfortran/issues/976","id":1301601482,"node_id":"IC_kwDOCpMuHc5NlNzK","user":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"created_at":"2022-11-03T03:27:57Z","updated_at":"2022-11-03T04:07:35Z","author_association":"CONTRIBUTOR","body":"I think the only way out of this is for the implicit interface function to be declared as `bind(C)` and pass everything using the usual convention, so a real gets passed as a pointer. Then everything should just work. See #978.","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1301601482/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false}},{"actor":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"created_at":"2022-11-03T04:03:00Z","updated_at":"2022-11-03T04:03:00Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/978","repository_url":"https://api.github.com/repos/lfortran/lfortran","labels_url":"https://api.github.com/repos/lfortran/lfortran/issues/978/labels{/name}","comments_url":"https://api.github.com/repos/lfortran/lfortran/issues/978/comments","events_url":"https://api.github.com/repos/lfortran/lfortran/issues/978/events","html_url":"https://github.com/lfortran/lfortran/pull/978","id":1434069061,"node_id":"PR_kwDOCpMuHc5CGxWU","number":978,"title":"Make all implicit interfaces BindC","user":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2022-11-03T04:03:00Z","updated_at":"2022-12-04T08:59:55Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":true,"repository":{"id":177417757,"node_id":"MDEwOlJlcG9zaXRvcnkxNzc0MTc3NTc=","name":"lfortran","full_name":"lfortran/lfortran","private":false,"owner":{"login":"lfortran","id":40613057,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQwNjEzMDU3","avatar_url":"https://avatars.githubusercontent.com/u/40613057?v=4","gravatar_id":"","url":"https://api.github.com/users/lfortran","html_url":"https://github.com/lfortran","followers_url":"https://api.github.com/users/lfortran/followers","following_url":"https://api.github.com/users/lfortran/following{/other_user}","gists_url":"https://api.github.com/users/lfortran/gists{/gist_id}","starred_url":"https://api.github.com/users/lfortran/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lfortran/subscriptions","organizations_url":"https://api.github.com/users/lfortran/orgs","repos_url":"https://api.github.com/users/lfortran/repos","events_url":"https://api.github.com/users/lfortran/events{/privacy}","received_events_url":"https://api.github.com/users/lfortran/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/lfortran/lfortran","description":"Official main repository for LFortran","fork":false,"url":"https://api.github.com/repos/lfortran/lfortran","forks_url":"https://api.github.com/repos/lfortran/lfortran/forks","keys_url":"https://api.github.com/repos/lfortran/lfortran/keys{/key_id}","collaborators_url":"https://api.github.com/repos/lfortran/lfortran/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/lfortran/lfortran/teams","hooks_url":"https://api.github.com/repos/lfortran/lfortran/hooks","issue_events_url":"https://api.github.com/repos/lfortran/lfortran/issues/events{/number}","events_url":"https://api.github.com/repos/lfortran/lfortran/events","assignees_url":"https://api.github.com/repos/lfortran/lfortran/assignees{/user}","branches_url":"https://api.github.com/repos/lfortran/lfortran/branches{/branch}","tags_url":"https://api.github.com/repos/lfortran/lfortran/tags","blobs_url":"https://api.github.com/repos/lfortran/lfortran/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/lfortran/lfortran/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/lfortran/lfortran/git/refs{/sha}","trees_url":"https://api.github.com/repos/lfortran/lfortran/git/trees{/sha}","statuses_url":"https://api.github.com/repos/lfortran/lfortran/statuses/{sha}","languages_url":"https://api.github.com/repos/lfortran/lfortran/languages","stargazers_url":"https://api.github.com/repos/lfortran/lfortran/stargazers","contributors_url":"https://api.github.com/repos/lfortran/lfortran/contributors","subscribers_url":"https://api.github.com/repos/lfortran/lfortran/subscribers","subscription_url":"https://api.github.com/repos/lfortran/lfortran/subscription","commits_url":"https://api.github.com/repos/lfortran/lfortran/commits{/sha}","git_commits_url":"https://api.github.com/repos/lfortran/lfortran/git/commits{/sha}","comments_url":"https://api.github.com/repos/lfortran/lfortran/comments{/number}","issue_comment_url":"https://api.github.com/repos/lfortran/lfortran/issues/comments{/number}","contents_url":"https://api.github.com/repos/lfortran/lfortran/contents/{+path}","compare_url":"https://api.github.com/repos/lfortran/lfortran/compare/{base}...{head}","merges_url":"https://api.github.com/repos/lfortran/lfortran/merges","archive_url":"https://api.github.com/repos/lfortran/lfortran/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/lfortran/lfortran/downloads","issues_url":"https://api.github.com/repos/lfortran/lfortran/issues{/number}","pulls_url":"https://api.github.com/repos/lfortran/lfortran/pulls{/number}","milestones_url":"https://api.github.com/repos/lfortran/lfortran/milestones{/number}","notifications_url":"https://api.github.com/repos/lfortran/lfortran/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/lfortran/lfortran/labels{/name}","releases_url":"https://api.github.com/repos/lfortran/lfortran/releases{/id}","deployments_url":"https://api.github.com/repos/lfortran/lfortran/deployments","created_at":"2019-03-24T13:22:20Z","updated_at":"2023-01-19T07:32:40Z","pushed_at":"2023-01-19T19:07:25Z","git_url":"git://github.com/lfortran/lfortran.git","ssh_url":"git@github.com:lfortran/lfortran.git","clone_url":"https://github.com/lfortran/lfortran.git","svn_url":"https://github.com/lfortran/lfortran","homepage":"https://lfortran.org/","size":19098,"stargazers_count":504,"watchers_count":504,"language":"C++","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":52,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":582,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["compiler","fortran","interactive","jupyter","jupyter-kernels","jupyter-notebook","library","repl"],"visibility":"public","forks":52,"open_issues":582,"watchers":504,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/lfortran/lfortran/pulls/978","html_url":"https://github.com/lfortran/lfortran/pull/978","diff_url":"https://github.com/lfortran/lfortran/pull/978.diff","patch_url":"https://github.com/lfortran/lfortran/pull/978.patch","merged_at":null},"body":"Towards #976.\r\n\r\nTODO:\r\n* [x] Fix Minpack to compile again with this PR\r\n* [ ] Figure out how to add tests that do not require implicit typing or interfaces, but test the new changes","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/978/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/lfortran/lfortran/issues/978/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1312372984","html_url":"https://github.com/lfortran/lfortran/issues/976#issuecomment-1312372984","issue_url":"https://api.github.com/repos/lfortran/lfortran/issues/976","id":1312372984,"node_id":"IC_kwDOCpMuHc5OOTj4","user":{"login":"czgdp1807","id":36567889,"node_id":"MDQ6VXNlcjM2NTY3ODg5","avatar_url":"https://avatars.githubusercontent.com/u/36567889?v=4","gravatar_id":"","url":"https://api.github.com/users/czgdp1807","html_url":"https://github.com/czgdp1807","followers_url":"https://api.github.com/users/czgdp1807/followers","following_url":"https://api.github.com/users/czgdp1807/following{/other_user}","gists_url":"https://api.github.com/users/czgdp1807/gists{/gist_id}","starred_url":"https://api.github.com/users/czgdp1807/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/czgdp1807/subscriptions","organizations_url":"https://api.github.com/users/czgdp1807/orgs","repos_url":"https://api.github.com/users/czgdp1807/repos","events_url":"https://api.github.com/users/czgdp1807/events{/privacy}","received_events_url":"https://api.github.com/users/czgdp1807/received_events","type":"User","site_admin":false},"created_at":"2022-11-12T05:30:15Z","updated_at":"2022-11-12T05:30:15Z","author_association":"MEMBER","body":"I thought about this issue and following are my observations on it. \r\n\r\nI think the constraints are as follows,\r\n\r\n1. You don't know the signature of `enorm` when processing the calls, `enorm(m,a(1,j))` or `enorm(m,a(1:m,j))`. \r\n2. `enorm` can accept both `(integer, real)` and `(integer, real :: x(n))`.\r\n3. At the time of processing the calls, `enorm(m,a(1,j))` or `enorm(m,a(1:m,j))` we don't know if `enorm` is an implicit interface function or a normal Fortran function.\r\n\r\nI have a question as well, **Do we know in which file `enorm` is defined?**. \r\n\r\nCase 1 - **If we know in which file `enorm` is defined when compiling the minpack project**\r\n\r\nI think this case is easy we can simply load the ASR from `.mod` of the file in which `enorm` is defined and check the signature of `enorm` to figure out what arguments are accepted by `enorm` and which version of `enorm` is being called.\r\n\r\nFor example `enorm` is defined at the following place in `minpack`,\r\n\r\nhttps://github.com/certik/minpack/blob/12f30bc2d6971fde7a32d59e80c635289376e14a/ex/file02#L316\r\n\r\nIt accepts the second argument of type, `real :: x(n)`, so we will know that we need to pass a pointer and not the loaded value. In addition, AFAIK, array arguments which have non-empty dimensions accept only the pointer to data and not the descriptor. So this should work without `bindC`.\r\n\r\nCase 2 - **If we don't know where `enorm` is defined when compiling the minpack project**\r\n\r\nWell in this case we don't know at all the meaning of `enorm(m, a(1, j))`. However if we assume that `enorm` is `bindC` then I think `a(1, j)` will be passed by value. `bindC` functions don't accept pointers for values, instead its the normal `source` Fortran functions which accept pointers to single values. See the LLVM output below for [bindc_01b.f90](https://github.com/lfortran/lfortran/blob/main/integration_tests/bindc_01b.f90),\r\n\r\n```llvm\r\ndeclare void @print_ptr_c(i32, void*)\r\n\r\ndeclare void @ret_ptr_c(void**)\r\n```\r\n\r\nYou can see `print_ptr_c` accepts the first value as `i32` and not `i32*` and its a `bindC` function. However normal Fortran functions accept `i32*` for normal integer values and arrays which have non-empty dimensions. For example see the LLVM output of the following function,\r\n\r\nhttps://github.com/lfortran/lfortran/blob/400a0c5cac61f05605bed8f1ba5a5f2e427203e0/integration_tests/arrays_19.f90#L12-L15\r\n\r\n```llvm\r\ndefine void @f(i32* %n, i32* %x)\r\n```\r\n\r\nYou can see `f` which is a normal Fortran function defines pointer for both `n` and `x`. So AFAICT following will be the LLVM signature of `enorm` if its treated as a normal Fortran function,\r\n\r\n```llvm\r\ndefine f32 @enorm(i32* %n, f32* %x)\r\n```\r\n\r\nand the way it will be called is as follows,\r\n\r\n```llvm\r\ncall f32 @enorm(i32* %call_arg_value, f32* %pointer_to_data)\r\n```\r\n\r\nI think we won't be required to worry for functions like `enorm` until they have array arguments with non-empty dimensions or in other words until they don't have assumed shaped arrays. \r\n\r\n@certik Let me know if the issue you are facing is different from what I have written about in this comment.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1312372984/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"czgdp1807","id":36567889,"node_id":"MDQ6VXNlcjM2NTY3ODg5","avatar_url":"https://avatars.githubusercontent.com/u/36567889?v=4","gravatar_id":"","url":"https://api.github.com/users/czgdp1807","html_url":"https://github.com/czgdp1807","followers_url":"https://api.github.com/users/czgdp1807/followers","following_url":"https://api.github.com/users/czgdp1807/following{/other_user}","gists_url":"https://api.github.com/users/czgdp1807/gists{/gist_id}","starred_url":"https://api.github.com/users/czgdp1807/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/czgdp1807/subscriptions","organizations_url":"https://api.github.com/users/czgdp1807/orgs","repos_url":"https://api.github.com/users/czgdp1807/repos","events_url":"https://api.github.com/users/czgdp1807/events{/privacy}","received_events_url":"https://api.github.com/users/czgdp1807/received_events","type":"User","site_admin":false}},{"id":7796134885,"node_id":"MEE_lADOCpMuHc5VY0w9zwAAAAHQr5Pl","url":"https://api.github.com/repos/lfortran/lfortran/issues/events/7796134885","actor":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-11-12T05:30:15Z","performed_via_github_app":null},{"id":7796134891,"node_id":"SE_lADOCpMuHc5VY0w9zwAAAAHQr5Pr","url":"https://api.github.com/repos/lfortran/lfortran/issues/events/7796134891","actor":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-11-12T05:30:15Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1312376317","html_url":"https://github.com/lfortran/lfortran/issues/976#issuecomment-1312376317","issue_url":"https://api.github.com/repos/lfortran/lfortran/issues/976","id":1312376317,"node_id":"IC_kwDOCpMuHc5OOUX9","user":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"created_at":"2022-11-12T05:47:06Z","updated_at":"2022-11-12T05:47:06Z","author_association":"CONTRIBUTOR","body":"I think that's roughly it. If LFortran is to be used as a drop in replacement to GFortran, it's the number 2. that we need to handle.\r\n\r\nAs a nice bonus I would love to link at the ASR level, in which case there is no problem, as you remarked. But I suspect we need to support the separate independent compilation, currently it is enabled with an option.","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1312376317/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1312388347","html_url":"https://github.com/lfortran/lfortran/issues/976#issuecomment-1312388347","issue_url":"https://api.github.com/repos/lfortran/lfortran/issues/976","id":1312388347,"node_id":"IC_kwDOCpMuHc5OOXT7","user":{"login":"czgdp1807","id":36567889,"node_id":"MDQ6VXNlcjM2NTY3ODg5","avatar_url":"https://avatars.githubusercontent.com/u/36567889?v=4","gravatar_id":"","url":"https://api.github.com/users/czgdp1807","html_url":"https://github.com/czgdp1807","followers_url":"https://api.github.com/users/czgdp1807/followers","following_url":"https://api.github.com/users/czgdp1807/following{/other_user}","gists_url":"https://api.github.com/users/czgdp1807/gists{/gist_id}","starred_url":"https://api.github.com/users/czgdp1807/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/czgdp1807/subscriptions","organizations_url":"https://api.github.com/users/czgdp1807/orgs","repos_url":"https://api.github.com/users/czgdp1807/repos","events_url":"https://api.github.com/users/czgdp1807/events{/privacy}","received_events_url":"https://api.github.com/users/czgdp1807/received_events","type":"User","site_admin":false},"created_at":"2022-11-12T06:46:29Z","updated_at":"2022-11-12T06:46:29Z","author_association":"MEMBER","body":"> As a nice bonus I would love to link at the ASR level\r\n\r\nCorrect. However, its only possible in case 1 i.e., when we know which functions are defined in which file. One way is to store the file path as the module name of the function in the ASR node, `ExternalSymbol`. That way we will always know which function is available in which file and case 2 will never arise.\r\n\r\nIf we don't have access to the file path then I think `enorm` should be treated as a normal function and that will always accept values and arrays both as pointers. Note that `bindC` functions always accept values as I showed in my comment above. For arrays we pass `void*` (i.e., `CPtr`) to `bindC` functions.\r\n\r\nThe case of implicit interface functions returning arrays, I think in their definition they will be converted to subroutines with arrays being returned present as `intent(out)` argument. Also they will have always have non-empty dimension arguments (because of the Fortran rules I guess) so they will be accepted as pointer to data and not descriptor. Now at the call site following cases will come up,\r\n\r\n1. Destination array is an assumed shaped array - Now we can assume (again because of the Fortran rules for returned arrays) that implicit interface functions returning an array is always explicit shaped (i.e., with non-empty dimensions), so we will extract the data pointer of assumed shaped destination array and pass it to our implicit interface function. So it will work.\r\n2. Destination array is an explicit shaped array - Nothing to worry here as well because it will always be passed as pointer to data and if it is present in local scope then we can extract the pointer to data from the descriptor and pass it to our implicit interface function. So same thing as above case.\r\n\r\nIs there any other case left for implicit interface functions returning arrays?","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1312388347/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"czgdp1807","id":36567889,"node_id":"MDQ6VXNlcjM2NTY3ODg5","avatar_url":"https://avatars.githubusercontent.com/u/36567889?v=4","gravatar_id":"","url":"https://api.github.com/users/czgdp1807","html_url":"https://github.com/czgdp1807","followers_url":"https://api.github.com/users/czgdp1807/followers","following_url":"https://api.github.com/users/czgdp1807/following{/other_user}","gists_url":"https://api.github.com/users/czgdp1807/gists{/gist_id}","starred_url":"https://api.github.com/users/czgdp1807/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/czgdp1807/subscriptions","organizations_url":"https://api.github.com/users/czgdp1807/orgs","repos_url":"https://api.github.com/users/czgdp1807/repos","events_url":"https://api.github.com/users/czgdp1807/events{/privacy}","received_events_url":"https://api.github.com/users/czgdp1807/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1336222514","html_url":"https://github.com/lfortran/lfortran/issues/976#issuecomment-1336222514","issue_url":"https://api.github.com/repos/lfortran/lfortran/issues/976","id":1336222514,"node_id":"IC_kwDOCpMuHc5PpSMy","user":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"created_at":"2022-12-03T19:17:56Z","updated_at":"2022-12-03T19:28:26Z","author_association":"CONTRIBUTOR","body":"With #978, all the interfaces are now correct. The last bug is in `src/qrfac.f` (see above), for the line `acnorm(j) = enorm(m,a(1,j))` it generates:\r\n```llvm\r\n  %22 = getelementptr inbounds double, double* %a, i32 %20\r\n  %23 = load double, double* %22, align 8\r\n  store double %23, double* %call_arg_value1, align 8\r\n  %24 = call double @enorm(i32* %m, double* %call_arg_value1)\r\n```\r\nBut it should generate:\r\n```llvm\r\n  %22 = getelementptr inbounds double, double* %a, i32 %20\r\n  %24 = call double @enorm(i32* %m, double* %22)\r\n```\r\nEssentially we need to pass the pointer to the original value in the array, instead of taking it out, storing in a temporary variable, and passing as an argument.\r\n\r\nThen this particular problem will start working.","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1336222514/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1336245381","html_url":"https://github.com/lfortran/lfortran/issues/976#issuecomment-1336245381","issue_url":"https://api.github.com/repos/lfortran/lfortran/issues/976","id":1336245381,"node_id":"IC_kwDOCpMuHc5PpXyF","user":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"created_at":"2022-12-03T19:41:08Z","updated_at":"2022-12-03T19:54:14Z","author_association":"CONTRIBUTOR","body":"I made progress with this patch:\r\n```diff\r\n--- a/src/libasr/codegen/asr_to_llvm.cpp\r\n+++ b/src/libasr/codegen/asr_to_llvm.cpp\r\n@@ -6071,6 +6071,9 @@ public:\r\n                                 && orig_arg->m_value_attr) {\r\n                                 use_value = true;\r\n                             }\r\n+                            if (ASR::is_a<ASR::ArrayItem_t>(*x.m_args[i].m_value)) {\r\n+                                use_value = true;\r\n+                            }\r\n                             if (!use_value) {\r\n                                 // Create alloca to get a pointer, but do it\r\n                                 // at the beginning of the function to avoid\r\n```\r\nI now get:\r\n```llvm\r\n  %22 = getelementptr inbounds double, double* %a, i32 %20\r\n  %23 = load double, double* %22, align 8\r\n  %24 = call double @enorm(i32* %m, double %23)\r\n```\r\nThis is of course malformed, but it got rid of the store. Now we need to get rid of the load.\r\n\r\nAnd this patch gets rid of the extra load:\r\n```diff\r\n--- a/src/libasr/codegen/asr_to_llvm.cpp\r\n+++ b/src/libasr/codegen/asr_to_llvm.cpp\r\n@@ -5984,8 +5984,7 @@ public:\r\n                 ptr_loads = !LLVM::is_llvm_struct(arg_type);\r\n                 this->visit_expr_wrapper(x.m_args[i].m_value);\r\n                 if( x_abi == ASR::abiType::BindC ) {\r\n-                    if( ASR::is_a<ASR::ArrayItem_t>(*x.m_args[i].m_value) ||\r\n-                        ASR::is_a<ASR::StructInstanceMember_t>(*x.m_args[i].m_value) ||\r\n+                    if( ASR::is_a<ASR::StructInstanceMember_t>(*x.m_args[i].m_value) ||\r\n                         (ASR::is_a<ASR::CPtr_t>(*arg_type) &&\r\n                             ASR::is_a<ASR::StructInstanceMember_t>(*x.m_args[i].m_value)) ) {\r\n                         tmp = LLVM::CreateLoad(*builder, tmp);\r\n```\r\nNow it produces:\r\n```llvm\r\n  %22 = getelementptr inbounds double, double* %a, i32 %20\r\n  %23 = call double @enorm(i32* %m, double* %22)\r\n```\r\nWhich is what we need.","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1336245381/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1336248409","html_url":"https://github.com/lfortran/lfortran/issues/976#issuecomment-1336248409","issue_url":"https://api.github.com/repos/lfortran/lfortran/issues/976","id":1336248409,"node_id":"IC_kwDOCpMuHc5PpYhZ","user":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"created_at":"2022-12-03T20:02:34Z","updated_at":"2022-12-03T20:02:34Z","author_association":"CONTRIBUTOR","body":"I implemented the above fix in https://github.com/lfortran/lfortran/pull/1064.\r\n\r\nOne can check using:\r\n```diff\r\ndiff --git a/src/enorm.f b/src/enorm.f\r\nindex 21557c1..7a01c59 100644\r\n--- a/src/enorm.f\r\n+++ b/src/enorm.f\r\n@@ -43,6 +43,7 @@ c     **********\r\n       double precision agiant,floatn,one,rdwarf,rgiant,s1,s2,s3,xabs,\r\n      *                 x1max,x3max,zero\r\n       data one,zero,rdwarf,rgiant /1.0d0,0.0d0,3.834d-20,1.304d19/\r\n+      if (n >= 2) print *, n, x(1), x(2)\r\n       s1 = zero\r\n       s2 = zero\r\n       s3 = zero\r\n```\r\nThat now it produces similar values as gfortran:\r\n```console\r\nminpack/lf(scipy21) $ make -j && ./examples/example_hybrd\r\n[ 95%] Built target minpack\r\n[100%] Built target example_hybrd\r\n3.00000000000000000e+00\r\nOK\r\n9 -2.00000000000000000e+00 -1.00000000000000000e+00\r\n9 6.99999999998473221e+00 -9.99999999997818856e-01\r\n9 -1.99999999999563771e+00 6.99999999998473221e+00\r\n9 0.00000000000000000e+00 -1.99999999999563771e+00\r\n9 0.00000000000000000e+00 0.00000000000000000e+00\r\n9 0.00000000000000000e+00 0.00000000000000000e+00\r\n9 0.00000000000000000e+00 0.00000000000000000e+00\r\n9 0.00000000000000000e+00 0.00000000000000000e+00\r\n9 0.00000000000000000e+00 0.00000000000000000e+00\r\n9 0.00000000000000000e+00 0.00000000000000000e+00\r\n9 6.99999999998473221e+00 -9.99999999997818856e-01\r\n8 6.64680374313904920e+00 -9.99999999997818856e-01\r\n7 6.62754123251247762e+00 -9.99999999997818856e-01\r\n6 6.62657999375152507e+00 -9.99999999997818856e-01\r\n5 6.62653480341571033e+00 -9.99999999997818856e-01\r\n4 6.62653273768893314e+00 -9.99999999997818856e-01\r\n3 6.62653264450988377e+00 -9.99999999997818856e-01\r\n2 6.62653264033395129e+00 -9.99999999997818856e-01\r\n9 -1.00000000000000000e+00 -1.00000000000000000e+00\r\n9 -3.61927662929031058e-01 -2.66746820249427641e-01\r\n9 3.61927662929031058e-01 2.66746820249427641e-01\r\n9 -2.61983266382177948e-01 -1.42307732224178807e-01\r\n9 0.00000000000000000e+00 -4.44089209850062616e-16\r\n9 -6.38072337070968887e-01 -7.33253179750572359e-01\r\n9 -5.59169393778249021e-02 -4.26288057180610122e-02\r\n9 5.59169393778249021e-02 4.26288057180610122e-02\r\n9 -4.30272591409344152e-02 -2.51217643073173846e-02\r\n9 -2.77555756156289135e-17 2.77555756156289135e-17\r\n9 -5.82155397693143950e-01 -6.90624374032511312e-01\r\n9 -1.19963265674825782e-02 -9.34794679066310898e-03\r\n9 1.19963265674825782e-02 9.34794679066310898e-03\r\n9 1.91290833295876261e-03 7.93468804999308830e-04\r\n9 -1.04083408558608426e-17 0.00000000000000000e+00\r\n9 -5.70159071125661332e-01 -6.81276427241848226e-01\r\n9 1.23383390466557221e-04 7.10528903936718755e-05\r\n9 -1.23383390466557221e-04 -7.10528903936718755e-05\r\n9 1.40344085822086129e-03 7.82171197039494004e-04\r\n9 0.00000000000000000e+00 0.00000000000000000e+00\r\n9 -5.70282454516127912e-01 -6.81347480132241889e-01\r\n9 2.90301678921930039e-04 2.21185175203396188e-04\r\n9 -2.90301678921930039e-04 -2.21185175203396188e-04\r\n9 3.12521805709398137e-04 1.80975305243080697e-04\r\n9 0.00000000000000000e+00 0.00000000000000000e+00\r\n9 -5.70572756195049879e-01 -6.81568665307445309e-01\r\n9 7.61544946018748539e-05 5.67849759349528844e-05\r\n9 -7.61544946018748539e-05 -5.67849759349528844e-05\r\n9 2.38099552327675212e-05 1.17966714952011387e-05\r\n9 -5.42101086242752217e-20 2.71050543121376109e-20\r\n9 -5.70648910689651734e-01 -6.81625450283380285e-01\r\n9 4.49043052366352506e-06 2.51728853542246916e-06\r\n9 -4.49043052366352506e-06 -2.51728853542246916e-06\r\n9 5.12336325764195522e-06 1.76553562414305532e-06\r\n9 -6.77626357803440271e-21 0.00000000000000000e+00\r\n9 -5.70653401120175374e-01 -6.81627967571915683e-01\r\n9 1.00663903010432391e-06 3.68131309893057791e-07\r\n9 -1.00663903010432391e-06 -3.68131309893057791e-07\r\n9 5.41938815601383794e-07 3.87223308973005942e-08\r\n9 0.00000000000000000e+00 -8.47032947254300339e-22\r\n9 -5.70654407759205506e-01 -6.81628335703225563e-01\r\n9 1.13833380345826003e-07 1.84960365898067169e-08\r\n9 -1.13833380345826003e-07 -1.84960365898067169e-08\r\n9 -2.24073593013685013e-08 -4.87565725570959785e-08\r\n9 1.05879118406787542e-22 -2.64697796016968856e-23\r\n9 -5.70654521592585895e-01 -6.81628354199262154e-01\r\n9 -1.10201759229982186e-08 -1.14834042721403841e-08\r\n9 1.10201759229982186e-08 1.14834042721403841e-08\r\n9 1.28412123157062297e-08 -5.35836885973139943e-09\r\n9 -9.92616735063633210e-24 1.32348898008484428e-23\r\n9 -5.70654510572410012e-01 -6.81628342715857927e-01\r\n9 1.43631811842256612e-09 -1.36072310092672165e-09\r\n9 -1.43631811842256612e-09 1.36072310092672165e-09\r\n9 2.53224619051195532e-09 -3.56674467738571366e-10\r\n9 1.65436122510605535e-24 -3.10192729707385378e-25\r\n9 -5.70654512008728076e-01 -6.81628341355134837e-01\r\nDone\r\n9 2.53224619051195532e-09 -3.56674467738571366e-10\r\n3.20285655606697024e-09 15 1\r\nComputed:\r\n-5.70654512008728076e-01\r\n-6.81628341355134837e-01\r\n-7.01732451588553130e-01\r\n-7.04212939801392657e-01\r\n-7.01369048199748324e-01\r\n-6.91865644303652494e-01\r\n-6.65792012508090947e-01\r\n-5.96034200751178744e-01\r\n-4.16412063091758433e-01\r\n\r\nReference:\r\n-5.70654499999999953e-01 -6.81628299999999965e-01 -7.01732499999999981e-01 -7.04212900000000031e-01 -7.01369000000000020e-01 -6.91865599999999970e-01 -6.65792000000000050e-01 -5.96034199999999958e-01 -4.16412100000000007e-01\r\n```\r\nvs\r\n```console\r\nminpack/gf(scipy21) $ make -j && ./examples/example_hybrd\r\n[ 95%] Built target minpack\r\n[100%] Built target example_hybrd\r\n   3.0000000000000000     \r\n OK\r\n           9  -2.0000000000000000       -1.0000000000000000     \r\n           9   6.9999999999847322      -0.99999999999781886     \r\n           9  -1.9999999999956377        6.9999999999847322     \r\n           9   0.0000000000000000       -1.9999999999956377     \r\n           9   0.0000000000000000        0.0000000000000000     \r\n           9   0.0000000000000000        0.0000000000000000     \r\n           9   0.0000000000000000        0.0000000000000000     \r\n           9   0.0000000000000000        0.0000000000000000     \r\n           9   0.0000000000000000        0.0000000000000000     \r\n           9   0.0000000000000000        0.0000000000000000     \r\n           9   6.9999999999847322      -0.99999999999781886     \r\n           8   6.6468037431390492      -0.99999999999781886     \r\n           7   6.6275412325124776      -0.99999999999781886     \r\n           6   6.6265799937515251      -0.99999999999781886     \r\n           5   6.6265348034157103      -0.99999999999781886     \r\n           4   6.6265327376889331      -0.99999999999781886     \r\n           3   6.6265326445098838      -0.99999999999781886     \r\n           2   6.6265326403339513      -0.99999999999781886     \r\n           9  -1.0000000000000000       -1.0000000000000000     \r\n           9 -0.36192766292903106      -0.26674682024942764     \r\n           9  0.36192766292903106       0.26674682024942764     \r\n           9 -0.26198326638217795      -0.14230773222417881     \r\n           9   0.0000000000000000       -4.4408920985006262E-016\r\n           9 -0.63807233707096889      -0.73325317975057236     \r\n           9  -5.5916939377824902E-002  -4.2628805718061012E-002\r\n           9   5.5916939377824902E-002   4.2628805718061012E-002\r\n           9  -4.3027259140934415E-002  -2.5121764307317385E-002\r\n           9  -2.7755575615628914E-017   2.7755575615628914E-017\r\n           9 -0.58215539769314395      -0.69062437403251131     \r\n           9  -1.1996326567482578E-002  -9.3479467906631090E-003\r\n           9   1.1996326567482578E-002   9.3479467906631090E-003\r\n           9   1.9129083329587626E-003   7.9346880499930883E-004\r\n           9  -1.0408340855860843E-017   0.0000000000000000     \r\n           9 -0.57015907112566133      -0.68127642724184823     \r\n           9   1.2338339046655722E-004   7.1052890393671876E-005\r\n           9  -1.2338339046655722E-004  -7.1052890393671876E-005\r\n           9   1.4034408582208613E-003   7.8217119703949400E-004\r\n           9   0.0000000000000000        0.0000000000000000     \r\n           9 -0.57028245451612791      -0.68134748013224189     \r\n           9   2.9030167892193004E-004   2.2118517520339619E-004\r\n           9  -2.9030167892193004E-004  -2.2118517520339619E-004\r\n           9   3.1252180570939814E-004   1.8097530524308070E-004\r\n           9   0.0000000000000000        0.0000000000000000     \r\n           9 -0.57057275619504988      -0.68156866530744531     \r\n           9   7.6154494601874854E-005   5.6784975934952884E-005\r\n           9  -7.6154494601874854E-005  -5.6784975934952884E-005\r\n           9   2.3809955232767521E-005   1.1796671495201139E-005\r\n           9  -5.4210108624275222E-020   2.7105054312137611E-020\r\n           9 -0.57064891068965173      -0.68162545028338029     \r\n           9   4.4857779002617385E-006   2.5113567623290315E-006\r\n           9  -4.4857779002617385E-006  -2.5113567623290315E-006\r\n           9   5.1360777231224120E-006   1.7837530799091894E-006\r\n           9  -6.7762635780344027E-021   0.0000000000000000     \r\n           9 -0.57065339646755198      -0.68162796164014261     \r\n           9   1.0094002248786974E-006   3.7059138475880110E-007\r\n           9  -1.0094002248786974E-006  -3.7059138475880110E-007\r\n           9   5.4498711343775597E-007   4.8566932253635287E-008\r\n           9   0.0000000000000000        0.0000000000000000     \r\n           9 -0.57065440586777683      -0.68162833223152741     \r\n           9   1.0251621611681931E-007   1.4062919442170022E-008\r\n           9  -1.0251621611681931E-007  -1.4062919442170022E-008\r\n           9   3.1558961888222825E-008  -2.1259772386983400E-008\r\n           9   1.0587911840678754E-022  -2.6469779601696886E-023\r\n           9 -0.57065450838399290      -0.68162834629444691     \r\n           9   3.2166661883050329E-009  -4.0032162753492036E-009\r\n           9  -3.2166661883050329E-009   4.0032162753492036E-009\r\n           9   6.5601106769008766E-009  -4.1754728563603294E-009\r\n           9   0.0000000000000000       -3.3087224502121107E-024\r\n           9 -0.57065451160065905      -0.68162834229123059     \r\n Done\r\n           9   6.5601106769008766E-009  -4.1754728563603294E-009\r\n   1.1926358347598092E-008          14           1\r\n Computed:\r\n -0.57065451160065905      -0.68162834229123059      -0.70173245256347117      -0.70421294008375235      -0.70136904762728880      -0.69186564337991419      -0.66579201215468919      -0.59603420128081663      -0.41641206299847200     \r\n Reference:\r\n -0.57065449999999995      -0.68162829999999996      -0.70173249999999998      -0.70421290000000003      -0.70136900000000002      -0.69186559999999997      -0.66579200000000005      -0.59603419999999996      -0.41641210000000001     \r\n```","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1336248409/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1336249652","html_url":"https://github.com/lfortran/lfortran/issues/976#issuecomment-1336249652","issue_url":"https://api.github.com/repos/lfortran/lfortran/issues/976","id":1336249652,"node_id":"IC_kwDOCpMuHc5PpY00","user":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"created_at":"2022-12-03T20:09:43Z","updated_at":"2022-12-03T20:09:43Z","author_association":"CONTRIBUTOR","body":"I think we have it......\r\n\r\nTry the following patch:\r\n```diff\r\ndiff --git a/examples/example_hybrd.f90 b/examples/example_hybrd.f90\r\nindex 7490f96..ce07fed 100644\r\n--- a/examples/example_hybrd.f90\r\n+++ b/examples/example_hybrd.f90\r\n@@ -98,7 +98,7 @@ contains\r\n         return\r\n 5       continue\r\n         do k = 1, n\r\n-            temp = (three - two*x(k))*x(k)\r\n+            temp = (three - 2.5_8*x(k))*x(k)\r\n             temp1 = zero\r\n             if (k /= 1) temp1 = x(k - 1)\r\n             temp2 = zero\r\n```\r\nI get again agreement of LFortran and GFortran. For the original code both actually agree with the reference results that are provided to single precision accuracy.\r\n\r\nThe differences might be related to some single/double precision corruption, a common problem in Fortran. We can track things down more carefully, but things looks good so far!","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1336249652/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false}},{"actor":{"login":"Smit-create","id":55887635,"node_id":"MDQ6VXNlcjU1ODg3NjM1","avatar_url":"https://avatars.githubusercontent.com/u/55887635?v=4","gravatar_id":"","url":"https://api.github.com/users/Smit-create","html_url":"https://github.com/Smit-create","followers_url":"https://api.github.com/users/Smit-create/followers","following_url":"https://api.github.com/users/Smit-create/following{/other_user}","gists_url":"https://api.github.com/users/Smit-create/gists{/gist_id}","starred_url":"https://api.github.com/users/Smit-create/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Smit-create/subscriptions","organizations_url":"https://api.github.com/users/Smit-create/orgs","repos_url":"https://api.github.com/users/Smit-create/repos","events_url":"https://api.github.com/users/Smit-create/events{/privacy}","received_events_url":"https://api.github.com/users/Smit-create/received_events","type":"User","site_admin":false},"created_at":"2022-12-08T05:30:19Z","updated_at":"2022-12-08T05:30:19Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/1073","repository_url":"https://api.github.com/repos/lfortran/lfortran","labels_url":"https://api.github.com/repos/lfortran/lfortran/issues/1073/labels{/name}","comments_url":"https://api.github.com/repos/lfortran/lfortran/issues/1073/comments","events_url":"https://api.github.com/repos/lfortran/lfortran/issues/1073/events","html_url":"https://github.com/lfortran/lfortran/pull/1073","id":1478161402,"node_id":"PR_kwDOCpMuHc5EblDn","number":1073,"title":"Fix LLVM backend for implicit interface and BindC changes","user":{"login":"Smit-create","id":55887635,"node_id":"MDQ6VXNlcjU1ODg3NjM1","avatar_url":"https://avatars.githubusercontent.com/u/55887635?v=4","gravatar_id":"","url":"https://api.github.com/users/Smit-create","html_url":"https://github.com/Smit-create","followers_url":"https://api.github.com/users/Smit-create/followers","following_url":"https://api.github.com/users/Smit-create/following{/other_user}","gists_url":"https://api.github.com/users/Smit-create/gists{/gist_id}","starred_url":"https://api.github.com/users/Smit-create/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Smit-create/subscriptions","organizations_url":"https://api.github.com/users/Smit-create/orgs","repos_url":"https://api.github.com/users/Smit-create/repos","events_url":"https://api.github.com/users/Smit-create/events{/privacy}","received_events_url":"https://api.github.com/users/Smit-create/received_events","type":"User","site_admin":false},"labels":[{"id":4362099631,"node_id":"LA_kwDOCpMuHc8AAAABBABbrw","url":"https://api.github.com/repos/lfortran/lfortran/labels/llvm","name":"llvm","color":"3E9A67","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2022-12-06T04:28:23Z","updated_at":"2022-12-08T15:08:40Z","closed_at":"2022-12-08T15:08:16Z","author_association":"MEMBER","active_lock_reason":null,"draft":false,"repository":{"id":177417757,"node_id":"MDEwOlJlcG9zaXRvcnkxNzc0MTc3NTc=","name":"lfortran","full_name":"lfortran/lfortran","private":false,"owner":{"login":"lfortran","id":40613057,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQwNjEzMDU3","avatar_url":"https://avatars.githubusercontent.com/u/40613057?v=4","gravatar_id":"","url":"https://api.github.com/users/lfortran","html_url":"https://github.com/lfortran","followers_url":"https://api.github.com/users/lfortran/followers","following_url":"https://api.github.com/users/lfortran/following{/other_user}","gists_url":"https://api.github.com/users/lfortran/gists{/gist_id}","starred_url":"https://api.github.com/users/lfortran/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lfortran/subscriptions","organizations_url":"https://api.github.com/users/lfortran/orgs","repos_url":"https://api.github.com/users/lfortran/repos","events_url":"https://api.github.com/users/lfortran/events{/privacy}","received_events_url":"https://api.github.com/users/lfortran/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/lfortran/lfortran","description":"Official main repository for LFortran","fork":false,"url":"https://api.github.com/repos/lfortran/lfortran","forks_url":"https://api.github.com/repos/lfortran/lfortran/forks","keys_url":"https://api.github.com/repos/lfortran/lfortran/keys{/key_id}","collaborators_url":"https://api.github.com/repos/lfortran/lfortran/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/lfortran/lfortran/teams","hooks_url":"https://api.github.com/repos/lfortran/lfortran/hooks","issue_events_url":"https://api.github.com/repos/lfortran/lfortran/issues/events{/number}","events_url":"https://api.github.com/repos/lfortran/lfortran/events","assignees_url":"https://api.github.com/repos/lfortran/lfortran/assignees{/user}","branches_url":"https://api.github.com/repos/lfortran/lfortran/branches{/branch}","tags_url":"https://api.github.com/repos/lfortran/lfortran/tags","blobs_url":"https://api.github.com/repos/lfortran/lfortran/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/lfortran/lfortran/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/lfortran/lfortran/git/refs{/sha}","trees_url":"https://api.github.com/repos/lfortran/lfortran/git/trees{/sha}","statuses_url":"https://api.github.com/repos/lfortran/lfortran/statuses/{sha}","languages_url":"https://api.github.com/repos/lfortran/lfortran/languages","stargazers_url":"https://api.github.com/repos/lfortran/lfortran/stargazers","contributors_url":"https://api.github.com/repos/lfortran/lfortran/contributors","subscribers_url":"https://api.github.com/repos/lfortran/lfortran/subscribers","subscription_url":"https://api.github.com/repos/lfortran/lfortran/subscription","commits_url":"https://api.github.com/repos/lfortran/lfortran/commits{/sha}","git_commits_url":"https://api.github.com/repos/lfortran/lfortran/git/commits{/sha}","comments_url":"https://api.github.com/repos/lfortran/lfortran/comments{/number}","issue_comment_url":"https://api.github.com/repos/lfortran/lfortran/issues/comments{/number}","contents_url":"https://api.github.com/repos/lfortran/lfortran/contents/{+path}","compare_url":"https://api.github.com/repos/lfortran/lfortran/compare/{base}...{head}","merges_url":"https://api.github.com/repos/lfortran/lfortran/merges","archive_url":"https://api.github.com/repos/lfortran/lfortran/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/lfortran/lfortran/downloads","issues_url":"https://api.github.com/repos/lfortran/lfortran/issues{/number}","pulls_url":"https://api.github.com/repos/lfortran/lfortran/pulls{/number}","milestones_url":"https://api.github.com/repos/lfortran/lfortran/milestones{/number}","notifications_url":"https://api.github.com/repos/lfortran/lfortran/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/lfortran/lfortran/labels{/name}","releases_url":"https://api.github.com/repos/lfortran/lfortran/releases{/id}","deployments_url":"https://api.github.com/repos/lfortran/lfortran/deployments","created_at":"2019-03-24T13:22:20Z","updated_at":"2023-01-19T07:32:40Z","pushed_at":"2023-01-19T19:07:25Z","git_url":"git://github.com/lfortran/lfortran.git","ssh_url":"git@github.com:lfortran/lfortran.git","clone_url":"https://github.com/lfortran/lfortran.git","svn_url":"https://github.com/lfortran/lfortran","homepage":"https://lfortran.org/","size":19098,"stargazers_count":504,"watchers_count":504,"language":"C++","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":52,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":582,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["compiler","fortran","interactive","jupyter","jupyter-kernels","jupyter-notebook","library","repl"],"visibility":"public","forks":52,"open_issues":582,"watchers":504,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/lfortran/lfortran/pulls/1073","html_url":"https://github.com/lfortran/lfortran/pull/1073","diff_url":"https://github.com/lfortran/lfortran/pull/1073.diff","patch_url":"https://github.com/lfortran/lfortran/pull/1073.patch","merged_at":"2022-12-08T15:08:16Z"},"body":"Part of #1064 ","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/1073/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/lfortran/lfortran/issues/1073/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1377818419","html_url":"https://github.com/lfortran/lfortran/issues/976#issuecomment-1377818419","issue_url":"https://api.github.com/repos/lfortran/lfortran/issues/976","id":1377818419,"node_id":"IC_kwDOCpMuHc5SH9cz","user":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"created_at":"2023-01-10T20:38:26Z","updated_at":"2023-01-10T20:38:26Z","author_association":"CONTRIBUTOR","body":"I think this issue is fixed, but let's double check before closing this.","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1377818419/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false}}]