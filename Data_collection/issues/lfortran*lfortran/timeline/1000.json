[{"actor":{"login":"meow464","id":70211708,"node_id":"MDQ6VXNlcjcwMjExNzA4","avatar_url":"https://avatars.githubusercontent.com/u/70211708?v=4","gravatar_id":"","url":"https://api.github.com/users/meow464","html_url":"https://github.com/meow464","followers_url":"https://api.github.com/users/meow464/followers","following_url":"https://api.github.com/users/meow464/following{/other_user}","gists_url":"https://api.github.com/users/meow464/gists{/gist_id}","starred_url":"https://api.github.com/users/meow464/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meow464/subscriptions","organizations_url":"https://api.github.com/users/meow464/orgs","repos_url":"https://api.github.com/users/meow464/repos","events_url":"https://api.github.com/users/meow464/events{/privacy}","received_events_url":"https://api.github.com/users/meow464/received_events","type":"User","site_admin":false},"created_at":"2022-11-08T19:57:38Z","updated_at":"2022-11-08T19:57:38Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/969","repository_url":"https://api.github.com/repos/lfortran/lfortran","labels_url":"https://api.github.com/repos/lfortran/lfortran/issues/969/labels{/name}","comments_url":"https://api.github.com/repos/lfortran/lfortran/issues/969/comments","events_url":"https://api.github.com/repos/lfortran/lfortran/issues/969/events","html_url":"https://github.com/lfortran/lfortran/pull/969","id":1430630802,"node_id":"PR_kwDOCpMuHc5B7Obp","number":969,"title":"Cross compilation2","user":{"login":"meow464","id":70211708,"node_id":"MDQ6VXNlcjcwMjExNzA4","avatar_url":"https://avatars.githubusercontent.com/u/70211708?v=4","gravatar_id":"","url":"https://api.github.com/users/meow464","html_url":"https://github.com/meow464","followers_url":"https://api.github.com/users/meow464/followers","following_url":"https://api.github.com/users/meow464/following{/other_user}","gists_url":"https://api.github.com/users/meow464/gists{/gist_id}","starred_url":"https://api.github.com/users/meow464/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meow464/subscriptions","organizations_url":"https://api.github.com/users/meow464/orgs","repos_url":"https://api.github.com/users/meow464/repos","events_url":"https://api.github.com/users/meow464/events{/privacy}","received_events_url":"https://api.github.com/users/meow464/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":26,"created_at":"2022-10-31T23:36:38Z","updated_at":"2023-01-06T17:20:35Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":true,"repository":{"id":177417757,"node_id":"MDEwOlJlcG9zaXRvcnkxNzc0MTc3NTc=","name":"lfortran","full_name":"lfortran/lfortran","private":false,"owner":{"login":"lfortran","id":40613057,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQwNjEzMDU3","avatar_url":"https://avatars.githubusercontent.com/u/40613057?v=4","gravatar_id":"","url":"https://api.github.com/users/lfortran","html_url":"https://github.com/lfortran","followers_url":"https://api.github.com/users/lfortran/followers","following_url":"https://api.github.com/users/lfortran/following{/other_user}","gists_url":"https://api.github.com/users/lfortran/gists{/gist_id}","starred_url":"https://api.github.com/users/lfortran/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lfortran/subscriptions","organizations_url":"https://api.github.com/users/lfortran/orgs","repos_url":"https://api.github.com/users/lfortran/repos","events_url":"https://api.github.com/users/lfortran/events{/privacy}","received_events_url":"https://api.github.com/users/lfortran/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/lfortran/lfortran","description":"Official main repository for LFortran","fork":false,"url":"https://api.github.com/repos/lfortran/lfortran","forks_url":"https://api.github.com/repos/lfortran/lfortran/forks","keys_url":"https://api.github.com/repos/lfortran/lfortran/keys{/key_id}","collaborators_url":"https://api.github.com/repos/lfortran/lfortran/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/lfortran/lfortran/teams","hooks_url":"https://api.github.com/repos/lfortran/lfortran/hooks","issue_events_url":"https://api.github.com/repos/lfortran/lfortran/issues/events{/number}","events_url":"https://api.github.com/repos/lfortran/lfortran/events","assignees_url":"https://api.github.com/repos/lfortran/lfortran/assignees{/user}","branches_url":"https://api.github.com/repos/lfortran/lfortran/branches{/branch}","tags_url":"https://api.github.com/repos/lfortran/lfortran/tags","blobs_url":"https://api.github.com/repos/lfortran/lfortran/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/lfortran/lfortran/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/lfortran/lfortran/git/refs{/sha}","trees_url":"https://api.github.com/repos/lfortran/lfortran/git/trees{/sha}","statuses_url":"https://api.github.com/repos/lfortran/lfortran/statuses/{sha}","languages_url":"https://api.github.com/repos/lfortran/lfortran/languages","stargazers_url":"https://api.github.com/repos/lfortran/lfortran/stargazers","contributors_url":"https://api.github.com/repos/lfortran/lfortran/contributors","subscribers_url":"https://api.github.com/repos/lfortran/lfortran/subscribers","subscription_url":"https://api.github.com/repos/lfortran/lfortran/subscription","commits_url":"https://api.github.com/repos/lfortran/lfortran/commits{/sha}","git_commits_url":"https://api.github.com/repos/lfortran/lfortran/git/commits{/sha}","comments_url":"https://api.github.com/repos/lfortran/lfortran/comments{/number}","issue_comment_url":"https://api.github.com/repos/lfortran/lfortran/issues/comments{/number}","contents_url":"https://api.github.com/repos/lfortran/lfortran/contents/{+path}","compare_url":"https://api.github.com/repos/lfortran/lfortran/compare/{base}...{head}","merges_url":"https://api.github.com/repos/lfortran/lfortran/merges","archive_url":"https://api.github.com/repos/lfortran/lfortran/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/lfortran/lfortran/downloads","issues_url":"https://api.github.com/repos/lfortran/lfortran/issues{/number}","pulls_url":"https://api.github.com/repos/lfortran/lfortran/pulls{/number}","milestones_url":"https://api.github.com/repos/lfortran/lfortran/milestones{/number}","notifications_url":"https://api.github.com/repos/lfortran/lfortran/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/lfortran/lfortran/labels{/name}","releases_url":"https://api.github.com/repos/lfortran/lfortran/releases{/id}","deployments_url":"https://api.github.com/repos/lfortran/lfortran/deployments","created_at":"2019-03-24T13:22:20Z","updated_at":"2023-01-19T07:32:40Z","pushed_at":"2023-01-19T19:07:25Z","git_url":"git://github.com/lfortran/lfortran.git","ssh_url":"git@github.com:lfortran/lfortran.git","clone_url":"https://github.com/lfortran/lfortran.git","svn_url":"https://github.com/lfortran/lfortran","homepage":"https://lfortran.org/","size":19098,"stargazers_count":504,"watchers_count":504,"language":"C++","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":52,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":582,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["compiler","fortran","interactive","jupyter","jupyter-kernels","jupyter-notebook","library","repl"],"visibility":"public","forks":52,"open_issues":582,"watchers":504,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/lfortran/lfortran/pulls/969","html_url":"https://github.com/lfortran/lfortran/pull/969","diff_url":"https://github.com/lfortran/lfortran/pull/969.diff","patch_url":"https://github.com/lfortran/lfortran/pull/969.patch","merged_at":null},"body":"Tests currently not passing because I made changes to the build system. CI will need changes too.\r\n\r\nMy [cross-compilation](https://github.com/meow464/lfortran/tree/cross-compilation2) branch.\r\n\r\nFor now you need to do some manual copying and pasting, the next pull request will enable automatic routing based on the triple. I tested this on x86_64 -> aarch64, macOS and Linux. If you don't have an aarch64 machine you can use qemu+linux to test the binaries. The instructions are relatively simple:\r\n\r\n### Linux x86 -> arm64\r\n\r\nFirst compile lfortran:\r\n\r\n```\r\n./build0.sh\r\nmkdir build && cd build\r\n\r\ncmake -DCMAKE_C_COMPILER=clang \\\r\n           -DCMAKE_CXX_COMPILER=clang++ \\\r\n           -DCMAKE_BUILD_TYPE=Debug \\\r\n           -DWITH_LLVM=yes \\\r\n           -DWITH_TARGET_AARCH64=Yes \\\r\n           -DCMAKE_INSTALL_PREFIX=`pwd`/../install ..\r\n\r\nmake -j12\r\nmake install\r\n\r\ncmake -DCMAKE_Fortran_COMPILER=../install/bin/lfortran \\\r\n           -DWITH_RUNTIME_LIBRARY=Yes\r\n\r\nmake -j12\r\nmake install\r\n```\r\n\r\nThen cross compile the runtime. You will need a cmake toolchain file for the target architecture, I used [aarch64-linux](https://gist.github.com/meow464/00bd0b89567e9c621846b3b3a74b589e).\r\n\r\nOn Linux will also need to install gcc and g++ for aarch64, I use debian and installed them with apt: `sudo apt install gcc make gcc-aarch64-linux-gnu binutils-aarch64-linux-gnu g++-aarch64-linux-gnu`\r\n\r\n```\r\nmkdir build_aarch64 && cd build_aarch6\r\n\r\ncmake ..\\\r\n      -DCMAKE_TOOLCHAIN_FILE=./aarch64-linux-gnu.toolchain.cmake\\\r\n      -DCMAKE_BUILD_TYPE=Debug\\\r\n      -DWITH_LLVM=yes\\\r\n      -DCMAKE_INSTALL_PREFIX=\"$(pwd)/../install_aarch64\"\\\r\n      -DCMAKE_Fortran_COMPILER=\"$(pwd)/../install/bin/lfortran\"\\\r\n      -DWITH_ZLIB=NO\\\r\n      -DWITH_RUNTIME_LIBRARY_ONLY=YES\r\n\t  \r\nmake -j12\r\nmake install\r\n```\r\n\r\nNow move the compiler to the cross compilation runtime.\r\n\r\n```\r\ncp  install/bin/lfortran install_aarch64/bin/lfortran\r\n```\r\n\r\nYou can test it with a hello world or [this simple program](https://gist.github.com/meow464/44e86a02fe77ed0625e2f2a6f281a904).\r\n\r\nUse `LFORTRAN_CC=/usr/bin/aarch64-linux-gnu-gcc lfortran --static --link-with-gcc --target arm64-linux`. You don't need to use `--static` but then you will have to copy `liblfortran_runtime.so` to the appropriate location on the target system.\r\n\r\nAlternatively you can use [qemu userspace](https://www.qemu.org/docs/master/user/main.html) emulation and call `qemu-aarch64-static hello_world`. You can configure your system to simply run aarch64 binaries as if they were native, [debian instructions](https://wiki.debian.org/QemuUserEmulation).\r\n\r\n### macOS x86 -> iPhone arm64\r\n\r\n```\r\n./build0.sh\r\nmkdir build && cd build\r\n\r\ncmake -DCMAKE_C_COMPILER=clang \\\r\n           -DCMAKE_CXX_COMPILER=clang++ \\\r\n           -DCMAKE_BUILD_TYPE=Debug \\\r\n           -DWITH_LLVM=yes \\\r\n           -DWITH_TARGET_AARCH64=Yes \\\r\n           -DCMAKE_INSTALL_PREFIX=`pwd`/../install .. \r\n\r\nmake -j12\r\nmake install\r\n\r\ncmake -DCMAKE_Fortran_COMPILER=../install/bin/lfortran \\\r\n           -DWITH_RUNTIME_LIBRARY=Yes\r\n\r\nmake -j12\r\nmake install\r\n\r\n```\r\n[iOS toolchain](https://github.com/leetal/ios-cmake).\r\n\r\n```\r\nmkdir build_aarch64 && cd build_aarch64\r\n\r\ncmake ../ -DCMAKE_BUILD_TYPE=Debug \\\r\n      -DWITH_LLVM=yes \\\r\n      -DCMAKE_INSTALL_PREFIX=`pwd`/../iphone_install \\\r\n      -DWITH_ZLIB=No \\\r\n      -DWITH_TARGET_AARCH64=Yes \\\r\n      -DWITH_RUNTIME_LIBRARY_ONLY=Yes \\\r\n      -DCMAKE_Fortran_COMPILER=../install/bin/lfortran \\\r\n      -DCMAKE_TOOLCHAIN_FILE=../ios.toolchain.cmake \\\r\n      -DPLATFORM=OS64 \\\r\n      -DENABLE_BITCODE=No\r\n\r\nmake -j12\r\nmake install\r\n```\r\nNow move the compiler to the cross compilation runtime.\r\n```\r\ncp install/bin/lfortran iphone_install/bin/lfortran\r\n```\r\nNow we can compile this [example](https://gist.github.com/meow464/d01c6005ef69fb729b44f801c1c2dbdc) that uses iso_c_binding:\r\n```\r\nSDKROOT=$(xcrun --sdk iphoneos --show-sdk-path) ./iphone_install/bin/lfortran --target arm64-apple-ios --generate-object-code -c addnums.f90 -o addnums.o\r\n```\r\nTo actually use the binary you need to copy it and `liblfortran_runtime_static.a` to your XCode project. Don't forget to call the fortran subroutine from main.m as in the example. You should see the result \"5\" on the console log on XCode.\r\n\r\nOne great news is that apple no longer requires embedded bitcode and will drop support for it in future releases. This massively simplifies the iOS port.\r\n\r\nNote:\r\n\r\n1. This changes the build steps to a two stage build so I still need to change the CI;\r\n2. This is for the runtime only. Cross compiling the compiler itself shouldn't be take much (or any) work besides having the cross compiler dependencies on the target sysroot;\r\n3. Is ZLIB necessary for the runtime? For now I'm keeping it off but it's just a matter of installing it on the sysroot or passing linker parameters `-L`.\r\n4. The next pull requests will add `share/lfortran-aarch64-linux` and the likes and automatically select the runtime based on `--target`, better organize the CMakeLists.txt and move the libraries to `lib/lfortran` instead of `share/lfortran`.\r\n","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/969/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/lfortran/lfortran/issues/969/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1307891171","html_url":"https://github.com/lfortran/lfortran/issues/1000#issuecomment-1307891171","issue_url":"https://api.github.com/repos/lfortran/lfortran/issues/1000","id":1307891171,"node_id":"IC_kwDOCpMuHc5N9NXj","user":{"login":"meow464","id":70211708,"node_id":"MDQ6VXNlcjcwMjExNzA4","avatar_url":"https://avatars.githubusercontent.com/u/70211708?v=4","gravatar_id":"","url":"https://api.github.com/users/meow464","html_url":"https://github.com/meow464","followers_url":"https://api.github.com/users/meow464/followers","following_url":"https://api.github.com/users/meow464/following{/other_user}","gists_url":"https://api.github.com/users/meow464/gists{/gist_id}","starred_url":"https://api.github.com/users/meow464/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meow464/subscriptions","organizations_url":"https://api.github.com/users/meow464/orgs","repos_url":"https://api.github.com/users/meow464/repos","events_url":"https://api.github.com/users/meow464/events{/privacy}","received_events_url":"https://api.github.com/users/meow464/received_events","type":"User","site_admin":false},"created_at":"2022-11-08T22:08:17Z","updated_at":"2022-11-08T22:08:17Z","author_association":"CONTRIBUTOR","body":"`-Linst/share/lfortran/lib/ -l:liblfortran_runtime.so` doesn't work either.  This shouldn't work because the symbols are never added there but just for completeness.","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1307891171/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"meow464","id":70211708,"node_id":"MDQ6VXNlcjcwMjExNzA4","avatar_url":"https://avatars.githubusercontent.com/u/70211708?v=4","gravatar_id":"","url":"https://api.github.com/users/meow464","html_url":"https://github.com/meow464","followers_url":"https://api.github.com/users/meow464/followers","following_url":"https://api.github.com/users/meow464/following{/other_user}","gists_url":"https://api.github.com/users/meow464/gists{/gist_id}","starred_url":"https://api.github.com/users/meow464/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meow464/subscriptions","organizations_url":"https://api.github.com/users/meow464/orgs","repos_url":"https://api.github.com/users/meow464/repos","events_url":"https://api.github.com/users/meow464/events{/privacy}","received_events_url":"https://api.github.com/users/meow464/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1308036199","html_url":"https://github.com/lfortran/lfortran/issues/1000#issuecomment-1308036199","issue_url":"https://api.github.com/repos/lfortran/lfortran/issues/1000","id":1308036199,"node_id":"IC_kwDOCpMuHc5N9wxn","user":{"login":"meow464","id":70211708,"node_id":"MDQ6VXNlcjcwMjExNzA4","avatar_url":"https://avatars.githubusercontent.com/u/70211708?v=4","gravatar_id":"","url":"https://api.github.com/users/meow464","html_url":"https://github.com/meow464","followers_url":"https://api.github.com/users/meow464/followers","following_url":"https://api.github.com/users/meow464/following{/other_user}","gists_url":"https://api.github.com/users/meow464/gists{/gist_id}","starred_url":"https://api.github.com/users/meow464/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meow464/subscriptions","organizations_url":"https://api.github.com/users/meow464/orgs","repos_url":"https://api.github.com/users/meow464/repos","events_url":"https://api.github.com/users/meow464/events{/privacy}","received_events_url":"https://api.github.com/users/meow464/received_events","type":"User","site_admin":false},"created_at":"2022-11-09T00:42:38Z","updated_at":"2022-11-09T00:42:38Z","author_association":"CONTRIBUTOR","body":"The runtime is currently compiled with the cpp backend. When trying to enable --generate-object-code for the cpp backend with [this branch](https://github.com/lfortran/lfortran/compare/main...meow464:lfortran:object-code-cpp-backend), I get:\r\n\r\n<details>\r\n<summary>\r\nerrors\r\n</summary>\r\n\r\n```\r\n[1/6] LFortran Compiling impure/lfortran_intrinsic_bit.f90                                                                                                                                                  \r\nFAILED: src/runtime/lfortran_intrinsic_bit.mod /home/tuco/Projetos/LFortran/lfortran-main/build/src/runtime/lfortran_intrinsic_bit.mod                                                                               \r\ncd /home/tuco/Projetos/LFortran/lfortran-main/build/src/runtime && /home/tuco/Projetos/LFortran/lfortran-main/build/src/bin/lfortran --openmp --backend=cpp --generate-object-code -c /home/tuco/Projetos/LFortran/lf\r\nortran-main/src/bin/../runtime/impure/lfortran_intrinsic_bit.f90 -o lfortran_intrinsic_bit.o                                                                                                                         \r\nIn file included from /home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/Kokkos_OpenMP.hpp:223,                                                                                                               \r\n                 from /home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/decl/Kokkos_Declare_OPENMP.hpp:49,                                                                                                   \r\n                 from /home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/KokkosCore_Config_DeclareBackend.hpp:47,                                                                                             \r\n                 from /home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/Kokkos_Core.hpp:53,       \r\n                 from lfortran_intrinsic_bit.o.tmp.cpp:7:                                                                                                                                                            \r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp: In static member function ‘static void Kokkos::OpenMP::partition_master(const F&, int, int)’:                               \r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:184:11: warning: ‘static void Kokkos::OpenMP::partition_master(const F&, int, int)’ is deprecated [-Wdeprecated-declarations]\r\n  184 |     Exec* prev_instance = Impl::t_openmp_instance;                                                \r\n      |           ^~~~~~~~~~~~~                                                                                                                                                                                      \r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:175:24: note: declared here                                                                                                  \r\n  175 | KOKKOS_DEPRECATED void OpenMP::partition_master(F const& f, int num_partitions,                   \r\n      |                        ^~~~~~                                                                                                                                                                                \r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:195:37: warning: ‘static void Kokkos::OpenMP::partition_master(const F&, int, int)’ is deprecated [-Wdeprecated-declarations]\r\n  195 |         ptr = space.allocate(sizeof(Exec));\r\n      |                                     ^~~~                                                                                                                                                                     \r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:175:24: note: declared here                                                                                                  \r\n  175 | KOKKOS_DEPRECATED void OpenMP::partition_master(F const& f, int num_partitions,                   \r\n      |                        ^~~~~~                                                                                                                                                                                \r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:202:43: warning: ‘static void Kokkos::OpenMP::partition_master(const F&, int, int)’ is deprecated [-Wdeprecated-declarations]\r\n  202 |       Impl::t_openmp_instance = new (ptr) Exec(partition_size);                                   \r\n      |                                           ^~~~                                                                                                                                                               \r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:175:24: note: declared here                                                                                                  \r\n  175 | KOKKOS_DEPRECATED void OpenMP::partition_master(F const& f, int num_partitions,\r\n      |                        ^~~~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:217:56: warning: ‘static void Kokkos::OpenMP::partition_master(const F&, int, int)’ is deprecated [-Wdeprecated-declarations]\r\n  217 |       space.deallocate(Impl::t_openmp_instance, sizeof(Exec));\r\n      |                                                        ^~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:175:24: note: declared here\r\n  175 | KOKKOS_DEPRECATED void OpenMP::partition_master(F const& f, int num_partitions,\r\n      |                        ^~~~~~\r\nlfortran_intrinsic_bit.o.tmp.cpp: In function ‘void mvbits32(int32_t, int32_t, int32_t, int32_t&, int32_t)’:\r\nlfortran_intrinsic_bit.o.tmp.cpp:32:10: error: ‘c_mvbits32’ was not declared in this scope; did you mean ‘mvbits32’?\r\n   32 |     to = c_mvbits32(from, frompos, len, to, topos);\r\n      |          ^~~~~~~~~~\r\n      |          mvbits32\r\nlfortran_intrinsic_bit.o.tmp.cpp: In function ‘void mvbits64(int64_t, int32_t, int32_t, int64_t&, int32_t)’:\r\nlfortran_intrinsic_bit.o.tmp.cpp:37:10: error: ‘c_mvbits64’ was not declared in this scope; did you mean ‘mvbits64’?\r\n   37 |     to = c_mvbits64(from, frompos, len, to, topos);\r\n      |          ^~~~~~~~~~\r\n      |          mvbits64\r\nThe command 'g++ -fopenmp -std=c++17 -I/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include -I/home/tuco/Projetos/LFortran/lfortran-main/src/libasr/runtime -o lfortran_intrinsic_bit.o -c lfortran_intrinsic_bi\r\nt.o.tmp.cpp' failed.\r\n\r\n[2/6] LFortran Compiling pure/lfortran_intrinsic_iso_c_binding.f90\r\nFAILED: src/runtime/lfortran_intrinsic_iso_c_binding.mod /home/tuco/Projetos/LFortran/lfortran-main/build/src/runtime/lfortran_intrinsic_iso_c_binding.mod \r\ncd /home/tuco/Projetos/LFortran/lfortran-main/build/src/runtime && /home/tuco/Projetos/LFortran/lfortran-main/build/src/bin/lfortran --openmp --backend=cpp --generate-object-code -c /home/tuco/Projetos/LFortran/lf\r\nortran-main/src/bin/../runtime/pure/lfortran_intrinsic_iso_c_binding.f90 -o lfortran_intrinsic_iso_c_binding.o\r\nIn file included from /home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/Kokkos_OpenMP.hpp:223,\r\n                 from /home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/decl/Kokkos_Declare_OPENMP.hpp:49,\r\n                 from /home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/KokkosCore_Config_DeclareBackend.hpp:47,\r\n                 from /home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/Kokkos_Core.hpp:53,\r\n                 from lfortran_intrinsic_iso_c_binding.o.tmp.cpp:7:\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp: In static member function ‘static void Kokkos::OpenMP::partition_master(const F&, int, int)’:\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:184:11: warning: ‘static void Kokkos::OpenMP::partition_master(const F&, int, int)’ is deprecated [-Wdeprecated-declarations]\r\n  184 |     Exec* prev_instance = Impl::t_openmp_instance;\r\n      |           ^~~~~~~~~~~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:175:24: note: declared here\r\n  175 | KOKKOS_DEPRECATED void OpenMP::partition_master(F const& f, int num_partitions,\r\n      |                        ^~~~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:195:37: warning: ‘static void Kokkos::OpenMP::partition_master(const F&, int, int)’ is deprecated [-Wdeprecated-declarations]\r\n  195 |         ptr = space.allocate(sizeof(Exec));\r\n      |                                     ^~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:175:24: note: declared here\r\n  175 | KOKKOS_DEPRECATED void OpenMP::partition_master(F const& f, int num_partitions,\r\n      |                        ^~~~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:202:43: warning: ‘static void Kokkos::OpenMP::partition_master(const F&, int, int)’ is deprecated [-Wdeprecated-declarations]\r\n  202 |       Impl::t_openmp_instance = new (ptr) Exec(partition_size);\r\n      |                                           ^~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:175:24: note: declared here\r\n  175 | KOKKOS_DEPRECATED void OpenMP::partition_master(F const& f, int num_partitions,\r\n      |                        ^~~~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:217:56: warning: ‘static void Kokkos::OpenMP::partition_master(const F&, int, int)’ is deprecated [-Wdeprecated-declarations]\r\n  217 |       space.deallocate(Impl::t_openmp_instance, sizeof(Exec));\r\n      |                                                        ^~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:175:24: note: declared here\r\n  175 | KOKKOS_DEPRECATED void OpenMP::partition_master(F const& f, int num_partitions,\r\n      |                        ^~~~~~\r\nlfortran_intrinsic_iso_c_binding.o.tmp.cpp: At global scope:\r\nlfortran_intrinsic_iso_c_binding.o.tmp.cpp:26:25: error: expected ‘)’ before ‘x’\r\n   26 | std::string char(int32_t x);\r\n      |                 ~       ^~\r\n      |                         )\r\nThe command 'g++ -fopenmp -std=c++17 -I/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include -I/home/tuco/Projetos/LFortran/lfortran-main/src/libasr/runtime -o lfortran_intrinsic_iso_c_binding.o -c lfortran_in\r\ntrinsic_iso_c_binding.o.tmp.cpp' failed.\r\n\r\n[3/6] LFortran Compiling pure/lfortran_intrinsic_math2.f90\r\nIn file included from /home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/Kokkos_OpenMP.hpp:223,\r\n                 from /home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/decl/Kokkos_Declare_OPENMP.hpp:49,\r\n                 from /home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/KokkosCore_Config_DeclareBackend.hpp:47,\r\n                 from /home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/Kokkos_Core.hpp:53,\r\n                 from lfortran_intrinsic_math2.o.tmp.cpp:7:\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp: In static member function ‘static void Kokkos::OpenMP::partition_master(const F&, int, int)’:\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:184:11: warning: ‘static void Kokkos::OpenMP::partition_master(const F&, int, int)’ is deprecated [-Wdeprecated-declarations]\r\n  184 |     Exec* prev_instance = Impl::t_openmp_instance;\r\n      |           ^~~~~~~~~~~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:175:24: note: declared here\r\n  175 | KOKKOS_DEPRECATED void OpenMP::partition_master(F const& f, int num_partitions,\r\n      |                        ^~~~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:195:37: warning: ‘static void Kokkos::OpenMP::partition_master(const F&, int, int)’ is deprecated [-Wdeprecated-declarations]\r\n  195 |         ptr = space.allocate(sizeof(Exec));\r\n      |                                     ^~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:175:24: note: declared here\r\n  175 | KOKKOS_DEPRECATED void OpenMP::partition_master(F const& f, int num_partitions,\r\n      |                        ^~~~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:202:43: warning: ‘static void Kokkos::OpenMP::partition_master(const F&, int, int)’ is deprecated [-Wdeprecated-declarations]\r\n  202 |       Impl::t_openmp_instance = new (ptr) Exec(partition_size);\r\n      |                                           ^~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:175:24: note: declared here\r\n  175 | KOKKOS_DEPRECATED void OpenMP::partition_master(F const& f, int num_partitions,\r\n      |                        ^~~~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:217:56: warning: ‘static void Kokkos::OpenMP::partition_master(const F&, int, int)’ is deprecated [-Wdeprecated-declarations]\r\n  217 |       space.deallocate(Impl::t_openmp_instance, sizeof(Exec));\r\n      |                                                        ^~~~\r\n/home/tuco/local/opt/miniconda3/envs/lfortran-dev/include/OpenMP/Kokkos_OpenMP_Exec.hpp:175:24: note: declared here\r\n  175 | KOKKOS_DEPRECATED void OpenMP::partition_master(F const& f, int num_partitions,\r\n      |                        ^~~~~~\r\nninja: build stopped: subcommand failed.\r\n\r\n```\r\n\r\n</details>\r\n\r\nI'm not very familiar with kokkos, I'm using kokkos-3.6.01. Should I be using a different version?","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1308036199/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"meow464","id":70211708,"node_id":"MDQ6VXNlcjcwMjExNzA4","avatar_url":"https://avatars.githubusercontent.com/u/70211708?v=4","gravatar_id":"","url":"https://api.github.com/users/meow464","html_url":"https://github.com/meow464","followers_url":"https://api.github.com/users/meow464/followers","following_url":"https://api.github.com/users/meow464/following{/other_user}","gists_url":"https://api.github.com/users/meow464/gists{/gist_id}","starred_url":"https://api.github.com/users/meow464/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meow464/subscriptions","organizations_url":"https://api.github.com/users/meow464/orgs","repos_url":"https://api.github.com/users/meow464/repos","events_url":"https://api.github.com/users/meow464/events{/privacy}","received_events_url":"https://api.github.com/users/meow464/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1309088290","html_url":"https://github.com/lfortran/lfortran/issues/1000#issuecomment-1309088290","issue_url":"https://api.github.com/repos/lfortran/lfortran/issues/1000","id":1309088290,"node_id":"IC_kwDOCpMuHc5OBxoi","user":{"login":"meow464","id":70211708,"node_id":"MDQ6VXNlcjcwMjExNzA4","avatar_url":"https://avatars.githubusercontent.com/u/70211708?v=4","gravatar_id":"","url":"https://api.github.com/users/meow464","html_url":"https://github.com/meow464","followers_url":"https://api.github.com/users/meow464/followers","following_url":"https://api.github.com/users/meow464/following{/other_user}","gists_url":"https://api.github.com/users/meow464/gists{/gist_id}","starred_url":"https://api.github.com/users/meow464/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meow464/subscriptions","organizations_url":"https://api.github.com/users/meow464/orgs","repos_url":"https://api.github.com/users/meow464/repos","events_url":"https://api.github.com/users/meow464/events{/privacy}","received_events_url":"https://api.github.com/users/meow464/received_events","type":"User","site_admin":false},"created_at":"2022-11-09T17:21:25Z","updated_at":"2022-11-09T17:21:25Z","author_association":"CONTRIBUTOR","body":"It seems the function [c_mvbits](https://github.com/lfortran/lfortran/blob/ca31276c120ec08661d70aea266f870ddc866ec7/src/runtime/impure/lfortran_intrinsic_bit.f90#L376) is being compiled with the wrong name by the cpp backend:\r\n```\r\npure integer(int64) function c_mvbits64(from, frompos, len, to, topos) bind(c, name=\"_lfortran_mvbits64\")\r\n```\r\nthe implementation with  the correct name is available in [lfortran_intrinsics.h](https://github.com/lfortran/lfortran/blob/6345cb21229eaeb451aeee8aa9c77ba1327f0364/src/libasr/runtime/lfortran_intrinsics.h#L186)\r\n\r\nCreating c_mvbit functions in lfortran_intrinsics bypasses this problem, now we need to figure out why the cpp backend is not respecting binc(c, name).","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1309088290/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"meow464","id":70211708,"node_id":"MDQ6VXNlcjcwMjExNzA4","avatar_url":"https://avatars.githubusercontent.com/u/70211708?v=4","gravatar_id":"","url":"https://api.github.com/users/meow464","html_url":"https://github.com/meow464","followers_url":"https://api.github.com/users/meow464/followers","following_url":"https://api.github.com/users/meow464/following{/other_user}","gists_url":"https://api.github.com/users/meow464/gists{/gist_id}","starred_url":"https://api.github.com/users/meow464/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meow464/subscriptions","organizations_url":"https://api.github.com/users/meow464/orgs","repos_url":"https://api.github.com/users/meow464/repos","events_url":"https://api.github.com/users/meow464/events{/privacy}","received_events_url":"https://api.github.com/users/meow464/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1309104758","html_url":"https://github.com/lfortran/lfortran/issues/1000#issuecomment-1309104758","issue_url":"https://api.github.com/repos/lfortran/lfortran/issues/1000","id":1309104758,"node_id":"IC_kwDOCpMuHc5OB1p2","user":{"login":"meow464","id":70211708,"node_id":"MDQ6VXNlcjcwMjExNzA4","avatar_url":"https://avatars.githubusercontent.com/u/70211708?v=4","gravatar_id":"","url":"https://api.github.com/users/meow464","html_url":"https://github.com/meow464","followers_url":"https://api.github.com/users/meow464/followers","following_url":"https://api.github.com/users/meow464/following{/other_user}","gists_url":"https://api.github.com/users/meow464/gists{/gist_id}","starred_url":"https://api.github.com/users/meow464/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meow464/subscriptions","organizations_url":"https://api.github.com/users/meow464/orgs","repos_url":"https://api.github.com/users/meow464/repos","events_url":"https://api.github.com/users/meow464/events{/privacy}","received_events_url":"https://api.github.com/users/meow464/received_events","type":"User","site_admin":false},"created_at":"2022-11-09T17:35:27Z","updated_at":"2022-11-09T17:35:27Z","author_association":"CONTRIBUTOR","body":"The next problem is with:\r\n<details>\r\n<summary>\r\nlfortran_iso_c_binding.o.tmp.cpp\r\n</summary>\r\n\r\n```\r\n#include <iostream>\r\n#include <string>\r\n#include <vector>\r\n#include <cassert>\r\n#include <cmath>\r\n#include <complex>\r\n#include <Kokkos_Core.hpp>\r\n#include <lfortran_intrinsics.h>\r\n\r\ntemplate <typename T>\r\nKokkos::View<T*> from_std_vector(const std::vector<T> &v)\r\n{\r\n    Kokkos::View<T*> r(\"r\", v.size());\r\n    for (size_t i=0; i < v.size(); i++) {\r\n        r(i) = v[i];\r\n    }\r\n    return r;\r\n}\r\n\r\n\r\nstruct dimension_descriptor\r\n{\r\n    int32_t lower_bound, length;\r\n};\r\n// Forward declarations\r\nstd::string char(int32_t x);\r\nvoid move_alloc(int32_t &from, int32_t &to);\r\n\r\ntemplate <typename T0>\r\nvoid c_f_pointer(struct cptr, int32_t &fptr, T0* shape);\r\n\r\n// Implementations\r\nvoid move_alloc(int32_t &from, int32_t &to);\r\n\r\n\r\ntemplate <typename T0>\r\nvoid c_f_pointer(struct cptr, int32_t &fptr, T0* shape);\r\n```\r\n\r\n</details>\r\n\r\nThis line seems incorrect:\r\n```\r\nstd::string char(int32_t x);\r\n``` \r\n\r\nthe fortran code is from [lfortran_iso_c_binding.f90](https://github.com/lfortran/lfortran/blob/main/src/runtime/pure/lfortran_intrinsic_iso_c_binding.f90#L36):\r\n```\r\n    subroutine c_f_pointer(cptr, fptr, shape)\r\n    import c_ptr\r\n    type(c_ptr), intent(in) :: cptr\r\n    !type(*), pointer, intent(out) :: fptr\r\n    integer, pointer, intent(out) :: fptr\r\n    integer, intent(in), optional :: shape(:)\r\n    end subroutine\r\n\r\n    !type(c_ptr) function c_loc(x)\r\n    integer function c_loc(x)\r\n    import c_ptr\r\n    !type(*), intent(in) :: x\r\n    integer, intent(in) :: x\r\n    end function\r\n```\r\n\r\nFor starters, why would the backed try to generate `std::string char(int32_t x);` from an integer? \r\nIf it was reading the commented `    !type(*), intent(in) :: x` it would make more sense, right? But deleting those lines does nothing.","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1309104758/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"meow464","id":70211708,"node_id":"MDQ6VXNlcjcwMjExNzA4","avatar_url":"https://avatars.githubusercontent.com/u/70211708?v=4","gravatar_id":"","url":"https://api.github.com/users/meow464","html_url":"https://github.com/meow464","followers_url":"https://api.github.com/users/meow464/followers","following_url":"https://api.github.com/users/meow464/following{/other_user}","gists_url":"https://api.github.com/users/meow464/gists{/gist_id}","starred_url":"https://api.github.com/users/meow464/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meow464/subscriptions","organizations_url":"https://api.github.com/users/meow464/orgs","repos_url":"https://api.github.com/users/meow464/repos","events_url":"https://api.github.com/users/meow464/events{/privacy}","received_events_url":"https://api.github.com/users/meow464/received_events","type":"User","site_admin":false}},{"id":7775838901,"node_id":"RTE_lADOCpMuHc5V4SFHzwAAAAHPeeK1","url":"https://api.github.com/repos/lfortran/lfortran/issues/events/7775838901","actor":{"login":"meow464","id":70211708,"node_id":"MDQ6VXNlcjcwMjExNzA4","avatar_url":"https://avatars.githubusercontent.com/u/70211708?v=4","gravatar_id":"","url":"https://api.github.com/users/meow464","html_url":"https://github.com/meow464","followers_url":"https://api.github.com/users/meow464/followers","following_url":"https://api.github.com/users/meow464/following{/other_user}","gists_url":"https://api.github.com/users/meow464/gists{/gist_id}","starred_url":"https://api.github.com/users/meow464/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meow464/subscriptions","organizations_url":"https://api.github.com/users/meow464/orgs","repos_url":"https://api.github.com/users/meow464/repos","events_url":"https://api.github.com/users/meow464/events{/privacy}","received_events_url":"https://api.github.com/users/meow464/received_events","type":"User","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2022-11-09T17:37:48Z","rename":{"from":"Intrinsics missing: lfortran object code and C main program","to":"Intrinsics missing, lfortran object code and C main program [Cpp bakcend][--generate-object-code]"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1309736382","html_url":"https://github.com/lfortran/lfortran/issues/1000#issuecomment-1309736382","issue_url":"https://api.github.com/repos/lfortran/lfortran/issues/1000","id":1309736382,"node_id":"IC_kwDOCpMuHc5OEP2-","user":{"login":"meow464","id":70211708,"node_id":"MDQ6VXNlcjcwMjExNzA4","avatar_url":"https://avatars.githubusercontent.com/u/70211708?v=4","gravatar_id":"","url":"https://api.github.com/users/meow464","html_url":"https://github.com/meow464","followers_url":"https://api.github.com/users/meow464/followers","following_url":"https://api.github.com/users/meow464/following{/other_user}","gists_url":"https://api.github.com/users/meow464/gists{/gist_id}","starred_url":"https://api.github.com/users/meow464/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meow464/subscriptions","organizations_url":"https://api.github.com/users/meow464/orgs","repos_url":"https://api.github.com/users/meow464/repos","events_url":"https://api.github.com/users/meow464/events{/privacy}","received_events_url":"https://api.github.com/users/meow464/received_events","type":"User","site_admin":false},"created_at":"2022-11-10T03:59:17Z","updated_at":"2022-11-10T03:59:17Z","author_association":"CONTRIBUTOR","body":"Hmm stopping to think about it, even if I get --generate-object-code to work with the c++ backend the object files will have c++ mangling and not the expected name....","reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/comments/1309736382/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"meow464","id":70211708,"node_id":"MDQ6VXNlcjcwMjExNzA4","avatar_url":"https://avatars.githubusercontent.com/u/70211708?v=4","gravatar_id":"","url":"https://api.github.com/users/meow464","html_url":"https://github.com/meow464","followers_url":"https://api.github.com/users/meow464/followers","following_url":"https://api.github.com/users/meow464/following{/other_user}","gists_url":"https://api.github.com/users/meow464/gists{/gist_id}","starred_url":"https://api.github.com/users/meow464/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meow464/subscriptions","organizations_url":"https://api.github.com/users/meow464/orgs","repos_url":"https://api.github.com/users/meow464/repos","events_url":"https://api.github.com/users/meow464/events{/privacy}","received_events_url":"https://api.github.com/users/meow464/received_events","type":"User","site_admin":false}}]