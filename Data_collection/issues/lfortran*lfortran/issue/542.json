{"url":"https://api.github.com/repos/lfortran/lfortran/issues/542","repository_url":"https://api.github.com/repos/lfortran/lfortran","labels_url":"https://api.github.com/repos/lfortran/lfortran/issues/542/labels{/name}","comments_url":"https://api.github.com/repos/lfortran/lfortran/issues/542/comments","events_url":"https://api.github.com/repos/lfortran/lfortran/issues/542/events","html_url":"https://github.com/lfortran/lfortran/issues/542","id":1338783971,"node_id":"I_kwDOCpMuHc5PzDjj","number":542,"title":"Mandelbrot example not working perfectly with LFortran","user":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-08-15T10:01:26Z","updated_at":"2022-08-15T10:01:26Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"*Original issue*: https://gitlab.com/lfortran/lfortran/-/issues/702\n\nI tried the following `mandelbrot` example (**source**: Fortran section of https://rosettacode.org/wiki/Mandelbrot_set) with `gfortran` and `lfortran`. It seems both are generating different images.\n\n```fortran\nprogram mandelbrot\n \n    implicit none\n    integer  , parameter :: rk       = selected_real_kind (9, 99)\n    integer  , parameter :: i_max    =  800\n    integer  , parameter :: j_max    =  600\n    integer  , parameter :: n_max    =  100\n    real (rk), parameter :: x_centre = -0.5_rk\n    real (rk), parameter :: y_centre =  0.0_rk\n    real (rk), parameter :: width    =  4.0_rk\n    real (rk), parameter :: height   =  3.0_rk\n    real (rk), parameter :: dx_di    =   width / i_max\n    real (rk), parameter :: dy_dj    = -height / j_max\n    real (rk), parameter :: x_offset = x_centre - 0.5_rk * (i_max + 1) * dx_di\n    real (rk), parameter :: y_offset = y_centre - 0.5_rk * (j_max + 1) * dy_dj\n    integer, dimension (i_max, j_max) :: image\n    integer   :: i\n    integer   :: j\n    integer   :: n\n    real (rk) :: x\n    real (rk) :: y\n    real (rk) :: x_0\n    real (rk) :: y_0\n    real (rk) :: x_sqr\n    real (rk) :: y_sqr\n   \n    do j = 1, j_max\n      y_0 = y_offset + dy_dj * j\n      do i = 1, i_max\n        x_0 = x_offset + dx_di * i\n        x = 0.0_rk\n        y = 0.0_rk\n        n = 0\n        do\n          x_sqr = x ** 2\n          y_sqr = y ** 2\n          if (x_sqr + y_sqr > 4.0_rk) then\n            image (i, j) = 255\n            exit\n          end if\n          if (n == n_max) then\n            image (i, j) = 0\n            exit\n          end if\n          y = y_0 + 2.0_rk * x * y\n          x = x_0 + x_sqr - y_sqr\n          n = n + 1\n        end do\n      end do\n    end do\n\n    ! print statements for lfortran\n    print *, 'P2'\n    print *, i_max, j_max\n    print *, 255\n\n    ! print statement for gfortran\n    print '(a/ i0, 1x, i0/ i0)', 'P2', i_max, j_max, 255\n\n    ! common print statement for both lfortran and gfortran\n    print '(i0)', image\n   \n  end program mandelbrot\n```\n\nWhen `gfortran` is used, we get the following image:\n\n![image](/uploads/198c58dcb822c8aaed9cf56e992ddd01/image.png)\n\nWhen `lfortran` is used, we get the following image:\n\n![image](/uploads/64208970d8a6514e1b6d87042e4a65a1/image.png)\n\n**Steps to generate image:**\n1. compile using `lfortran`/`gfortran` (When using with `lfortran`, please comment out the print statement for `gfortran` as it is not needed. Similarly, when using `gfortran`, please comment out the first three print statements corresponding to `lfortran`)\n```bash\nlfortran/gfortran mandelbrot.f90 -o mandelbrot.out\n```\n2. run the executable and save output to `.pgm` image\n```bash\n./mandelbrot.out > mandelbrot.pgm\n```","closed_by":null,"reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/542/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/lfortran/lfortran/issues/542/timeline","performed_via_github_app":null,"state_reason":null}