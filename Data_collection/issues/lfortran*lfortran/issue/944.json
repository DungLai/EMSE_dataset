{"url":"https://api.github.com/repos/lfortran/lfortran/issues/944","repository_url":"https://api.github.com/repos/lfortran/lfortran","labels_url":"https://api.github.com/repos/lfortran/lfortran/issues/944/labels{/name}","comments_url":"https://api.github.com/repos/lfortran/lfortran/issues/944/comments","events_url":"https://api.github.com/repos/lfortran/lfortran/issues/944/events","html_url":"https://github.com/lfortran/lfortran/issues/944","id":1418550331,"node_id":"I_kwDOCpMuHc5UjVw7","number":944,"title":"Bug: Invalid GetElementPtrInst indices for type","user":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"czgdp1807","id":36567889,"node_id":"MDQ6VXNlcjM2NTY3ODg5","avatar_url":"https://avatars.githubusercontent.com/u/36567889?v=4","gravatar_id":"","url":"https://api.github.com/users/czgdp1807","html_url":"https://github.com/czgdp1807","followers_url":"https://api.github.com/users/czgdp1807/followers","following_url":"https://api.github.com/users/czgdp1807/following{/other_user}","gists_url":"https://api.github.com/users/czgdp1807/gists{/gist_id}","starred_url":"https://api.github.com/users/czgdp1807/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/czgdp1807/subscriptions","organizations_url":"https://api.github.com/users/czgdp1807/orgs","repos_url":"https://api.github.com/users/czgdp1807/repos","events_url":"https://api.github.com/users/czgdp1807/events{/privacy}","received_events_url":"https://api.github.com/users/czgdp1807/received_events","type":"User","site_admin":false},"assignees":[{"login":"czgdp1807","id":36567889,"node_id":"MDQ6VXNlcjM2NTY3ODg5","avatar_url":"https://avatars.githubusercontent.com/u/36567889?v=4","gravatar_id":"","url":"https://api.github.com/users/czgdp1807","html_url":"https://github.com/czgdp1807","followers_url":"https://api.github.com/users/czgdp1807/followers","following_url":"https://api.github.com/users/czgdp1807/following{/other_user}","gists_url":"https://api.github.com/users/czgdp1807/gists{/gist_id}","starred_url":"https://api.github.com/users/czgdp1807/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/czgdp1807/subscriptions","organizations_url":"https://api.github.com/users/czgdp1807/orgs","repos_url":"https://api.github.com/users/czgdp1807/repos","events_url":"https://api.github.com/users/czgdp1807/events{/privacy}","received_events_url":"https://api.github.com/users/czgdp1807/received_events","type":"User","site_admin":false}],"milestone":null,"comments":0,"created_at":"2022-10-21T15:56:28Z","updated_at":"2022-10-22T17:10:01Z","closed_at":"2022-10-22T17:10:01Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"We should never get internal LLVM errors. This is a bug in verify() or in the LLVM backend.\r\n\r\n\r\nGit bisect shows it was caused by cf481fd69d4b6cd781eb0734997599421ceacc1b.\r\n\r\n```\r\n$ make      \r\n[  2%] Building Fortran object src/CMakeFiles/minpack.dir/minpack.f90.o\r\n[  4%] Building Fortran object src/CMakeFiles/minpack.dir/covar.f.o\r\n[  7%] Building Fortran object src/CMakeFiles/minpack.dir/errjac.f.o\r\n[  9%] Building Fortran object src/CMakeFiles/minpack.dir/hybipt.f.o\r\n[ 12%] Building Fortran object src/CMakeFiles/minpack.dir/lhesfcn.f.o\r\n[ 14%] Building Fortran object src/CMakeFiles/minpack.dir/lmdipt.f.o\r\n[ 17%] Building Fortran object src/CMakeFiles/minpack.dir/ocpipt.f.o\r\n[ 19%] Building Fortran object src/CMakeFiles/minpack.dir/r1updt.f.o\r\n[ 21%] Building Fortran object src/CMakeFiles/minpack.dir/vecjac.f.o\r\n[ 24%] Building Fortran object src/CMakeFiles/minpack.dir/chkder.f.o\r\n[ 26%] Building Fortran object src/CMakeFiles/minpack.dir/dmchar.f.o\r\n[ 29%] Building Fortran object src/CMakeFiles/minpack.dir/fdjac1.f.o\r\nAssertion failed: (Ty && \"Invalid GetElementPtrInst indices for type!\"), function checkGEPType, file Instructions.h, line 897.\r\nTraceback (most recent call last):\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/bin/lfortran.cpp\", line 1736\r\n    return compile_to_object_file(arg_file, outfile, false,\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/bin/lfortran.cpp\", line 763\r\n    res = fe.get_llvm3(*asr, lpm, diagnostics);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/fortran_evaluator.cpp\", line 320\r\n    compiler_options, run_fn);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/codegen/asr_to_llvm.cpp\", line 6127\r\n    v.nested_func_types = pass_find_nested_vars(asr, context,\r\n  File \"../libasr/asr.h\", line 4080\r\n  File \"../libasr/asr.h\", line 4057\r\n  File \"../libasr/asr.h\", line 4081\r\n  File \"../libasr/asr.h\", line 3836\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/codegen/asr_to_llvm.cpp\", line 1145\r\n    visit_symbol(*item.second);\r\n  File \"../libasr/asr.h\", line 4083\r\n  File \"../libasr/asr.h\", line 3846\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/codegen/asr_to_llvm.cpp\", line 3021\r\n    visit_procedures(x);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/codegen/asr_to_llvm.cpp\", line 3335\r\n    this->visit_stmt(*x.m_body[i]);\r\n  File \"../libasr/asr.h\", line 4098\r\n  File \"../libasr/asr.h\", line 3894\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/codegen/asr_to_llvm.cpp\", line 4037\r\n    }, [=]() {\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/codegen/asr_to_llvm.cpp\", line 325\r\n    start_new_block(loopbody); {\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/codegen/asr_to_llvm.cpp\", line 4039\r\n    this->visit_stmt(*x.m_body[i]);\r\n  File \"../libasr/asr.h\", line 4098\r\n  File \"../libasr/asr.h\", line 3892\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/codegen/asr_to_llvm.cpp\", line 5823\r\n    std::vector<llvm::Value *> args2 = convert_call_args(x, m_name);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/codegen/asr_to_llvm.cpp\", line 5494\r\n    tmp = arr_descr->convert_to_argument(tmp, arg->m_type, new_arr_type,\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/codegen/llvm_array_utils.cpp\", line 127\r\n    return LLVM::CreateLoad(*builder, get_pointer_to_data(tmp));\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/codegen/llvm_array_utils.cpp\", line 368\r\n    return llvm_utils->create_gep(arr, 0);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/codegen/llvm_utils.cpp\", line 120\r\n    return LLVM::CreateGEP(*builder, ds, idx_vec);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/codegen/llvm_utils.cpp\", line 26\r\n    return builder.CreateGEP(t2, x, idx);\r\n  File \"/Users/ondrej/mambaforge/envs/lf/include/llvm/IR/IRBuilder.h\", line 1773\r\n    return Insert(GetElementPtrInst::Create(Ty, Ptr, IdxList), Name);\r\n  File \"/Users/ondrej/mambaforge/envs/lf/include/llvm/IR/Instructions.h\", line 943\r\n    NameStr, InsertBefore);\r\n  File \"/Users/ondrej/mambaforge/envs/lf/include/llvm/IR/Instructions.h\", line 1151\r\n    }\r\n  File \"/Users/ondrej/mambaforge/envs/lf/include/llvm/IR/Instructions.h\", line 1143\r\n    : Instruction(getGEPReturnType(PointeeType, Ptr, IdxList), GetElementPtr,\r\n  File \"/Users/ondrej/mambaforge/envs/lf/include/llvm/IR/Instructions.h\", line 1074\r\n    Type *PtrTy = PointerType::get(checkGEPType(getIndexedType(ElTy, IdxList)),\r\n  File \"/Users/ondrej/mambaforge/envs/lf/include/llvm/IR/Instructions.h\", line 897\r\n    assert(Ty && \"Invalid GetElementPtrInst indices for type!\");\r\n  Binary file \"/usr/lib/system/libsystem_c.dylib\", local address: 0x18024972b\r\n  Binary file \"/usr/lib/system/libsystem_c.dylib\", local address: 0x18024a313\r\n  Binary file \"/usr/lib/system/libsystem_pthread.dylib\", local address: 0x18030ceaf\r\n  Binary file \"/usr/lib/system/libsystem_platform.dylib\", local address: 0x1803244e3\r\nAbort: Signal SIGABRT (abort) received\r\n\r\n/bin/sh: line 1: 95645 Abort trap: 6           /Users/ondrej/bin/lfortran --generate-object-code --no-warnings --fixed-form --implicit-typing --allow-implicit-interface -c /Users/ondrej/repos/lfortran/minpack/src/fdjac1.f -o CMakeFiles/minpack.dir/fdjac1.f.o\r\nmake[2]: *** [src/CMakeFiles/minpack.dir/fdjac1.f.o] Error 134\r\nmake[1]: *** [src/CMakeFiles/minpack.dir/all] Error 2\r\nmake: *** [all] Error 2\r\n```\r\n\r\nWe need to investigate.","closed_by":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/944/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/lfortran/lfortran/issues/944/timeline","performed_via_github_app":null,"state_reason":"completed"}