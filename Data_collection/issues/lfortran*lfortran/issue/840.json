{"url":"https://api.github.com/repos/lfortran/lfortran/issues/840","repository_url":"https://api.github.com/repos/lfortran/lfortran","labels_url":"https://api.github.com/repos/lfortran/lfortran/issues/840/labels{/name}","comments_url":"https://api.github.com/repos/lfortran/lfortran/issues/840/comments","events_url":"https://api.github.com/repos/lfortran/lfortran/issues/840/events","html_url":"https://github.com/lfortran/lfortran/issues/840","id":1394326448,"node_id":"I_kwDOCpMuHc5TG7uw","number":840,"title":"Array with expression type","user":{"login":"ansharlubis","id":22386644,"node_id":"MDQ6VXNlcjIyMzg2NjQ0","avatar_url":"https://avatars.githubusercontent.com/u/22386644?v=4","gravatar_id":"","url":"https://api.github.com/users/ansharlubis","html_url":"https://github.com/ansharlubis","followers_url":"https://api.github.com/users/ansharlubis/followers","following_url":"https://api.github.com/users/ansharlubis/following{/other_user}","gists_url":"https://api.github.com/users/ansharlubis/gists{/gist_id}","starred_url":"https://api.github.com/users/ansharlubis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ansharlubis/subscriptions","organizations_url":"https://api.github.com/users/ansharlubis/orgs","repos_url":"https://api.github.com/users/ansharlubis/repos","events_url":"https://api.github.com/users/ansharlubis/events{/privacy}","received_events_url":"https://api.github.com/users/ansharlubis/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-10-03T08:13:41Z","updated_at":"2022-10-03T20:40:44Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"The following program where the array is typed with a `size` expression does not work yet.\r\n````\r\nprogram test\r\n\r\nreal :: x(1), y(1), z(1)\r\n\r\nz = f(x, y)\r\n\r\ncontains\r\n\r\nfunction f(a, b) result(r)\r\nreal, intent(in) :: a(:), b(:)\r\nreal :: r(size(a))\r\ninteger :: i\r\ndo i = 1, size(a)\r\n    r(i) = a(i) + b(i)\r\nend do\r\nend function\r\n\r\nend program\r\n````\r\nThe resulting error is:\r\n````\r\nInternal Compiler Error: Unhandled exception\r\nTraceback (most recent call last):\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/bin/lfortran.cpp\", line 1726\r\n    err = compile_to_object_file(arg_file, tmp_o, false,\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/bin/lfortran.cpp\", line 743\r\n    res = fe.get_llvm3(*asr, lpm, diagnostics);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/lfortran/fortran_evaluator.cpp\", line 318\r\n    compiler_options.platform, run_fn);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/codegen/asr_to_llvm.cpp\", line 5699\r\n    pass_manager.apply_passes(al, &asr, pass_options);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/pass/pass_manager.h\", line 172\r\n    _apply_passes(al, asr, _passes, pass_options);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/pass/pass_manager.h\", line 85\r\n    _passes_db[passes[i]](al, *asr, pass_options);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/pass/pass_array_by_data.cpp\", line 423\r\n    LFORTRAN_ASSERT(asr_verify(unit));\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/asr_verify.cpp\", line 521\r\n    v.visit_TranslationUnit(unit);\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/asr_verify.cpp\", line 110\r\n    for (auto &a : x.m_global_scope->get_scope()) {\r\n  File \"../libasr/asr.h\", line 3799\r\n  File \"../libasr/asr.h\", line 3572\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/asr_verify.cpp\", line 145\r\n    for (auto &a : x.m_symtab->get_scope()) {\r\n  File \"../libasr/asr.h\", line 3799\r\n  File \"../libasr/asr.h\", line 3573\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/asr_verify.cpp\", line 247\r\n    for (auto &a : x.m_symtab->get_scope()) {\r\n  File \"../libasr/asr.h\", line 3799\r\n  File \"../libasr/asr.h\", line 3578\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/asr_verify.cpp\", line 298\r\n    visit_ttype(*x.m_type);\r\n  File \"../libasr/asr.h\", line 3927\r\n  File \"../libasr/asr.h\", line 3718\r\n  File \"../libasr/asr.h\", line 4833\r\n  File \"../libasr/asr.h\", line 4899\r\n  File \"../libasr/asr.h\", line 3855\r\n  File \"../libasr/asr.h\", line 3686\r\n  File \"../libasr/asr.h\", line 4658\r\n  File \"../libasr/asr.h\", line 3855\r\n  File \"../libasr/asr.h\", line 3682\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/asr_verify.cpp\", line 337\r\n    require(symtab_in_scope(current_symtab, x.m_v),\r\n  File \"/Users/ondrej/repos/lfortran/lfortran/src/libasr/asr_verify.cpp\", line 49\r\n    throw LCompilersException(\"ASR verify failed: \" + error_msg);\r\nLCompilersException: ASR verify failed: Var::m_v `a` cannot point outside of its symbol table\r\n````","closed_by":null,"reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/840/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/lfortran/lfortran/issues/840/timeline","performed_via_github_app":null,"state_reason":null}