{"url":"https://api.github.com/repos/lfortran/lfortran/issues/946","repository_url":"https://api.github.com/repos/lfortran/lfortran","labels_url":"https://api.github.com/repos/lfortran/lfortran/issues/946/labels{/name}","comments_url":"https://api.github.com/repos/lfortran/lfortran/issues/946/comments","events_url":"https://api.github.com/repos/lfortran/lfortran/issues/946/events","html_url":"https://github.com/lfortran/lfortran/issues/946","id":1419018714,"node_id":"I_kwDOCpMuHc5UlIHa","number":946,"title":"LLVM: do loop with a skip and continue inside fails","user":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"labels":[{"id":1287342341,"node_id":"MDU6TGFiZWwxMjg3MzQyMzQx","url":"https://api.github.com/repos/lfortran/lfortran/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2022-10-22T01:27:05Z","updated_at":"2022-11-04T03:39:24Z","closed_at":"2022-11-04T03:39:24Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Here is a minimal reproducible example:\r\n```fortran\r\nsubroutine f()\r\ninteger :: i, n\r\ndo i = 1, 10, n\r\n    100 continue\r\nend do\r\nend subroutine\r\n```\r\nWhich fails. If you remove `100 continue`, or if you remove `, n`, it will work. Here is the failure:\r\n```console\r\n$ lfortran --show-llvm a.f90 \r\n; ModuleID = 'LFortran'\r\nsource_filename = \"LFortran\"\r\n\r\ndefine void @f() {\r\n.entry:\r\n  %i = alloca i32, align 4\r\n  %n = alloca i32, align 4\r\n  %0 = load i32, i32* %n, align 4\r\n  %1 = icmp sgt i32 %0, 0\r\n  br i1 %1, label %then, label %else\r\n\r\nthen:                                             ; preds = %.entry\r\n  %2 = load i32, i32* %n, align 4\r\n  %3 = sub i32 1, %2\r\n  store i32 %3, i32* %i, align 4\r\n  br label %loop.head\r\n\r\nloop.head:                                        ; preds = %goto_target3, %then\r\n  %4 = load i32, i32* %i, align 4\r\n  %5 = load i32, i32* %n, align 4\r\n  %6 = add i32 %4, %5\r\n  %7 = icmp sle i32 %6, 10\r\n  br i1 %7, label %loop.body, label %loop.end\r\n\r\nloop.body:                                        ; preds = %loop.head\r\n  %8 = load i32, i32* %i, align 4\r\n  %9 = load i32, i32* %n, align 4\r\n  %10 = add i32 %8, %9\r\n  store i32 %10, i32* %i, align 4\r\n  br label %goto_target3\r\n\r\ngoto_target3:                                     ; preds = %loop.body2, %loop.body\r\n  br label %loop.head\r\n  br label %loop.head1\r\n\r\nloop.end4:                                        ; preds = %loop.head1\r\n  br label %ifcont\r\n\r\nifcont:                                           ; preds = %loop.end4, %loop.end\r\n  br label %return\r\n\r\nreturn:                                           ; preds = %ifcont\r\n  ret void\r\n}\r\nlfortran(79209,0x108308580) malloc: *** error for object 0x60000293ce40: pointer being freed was not allocated\r\nlfortran(79209,0x108308580) malloc: *** set a breakpoint in malloc_error_break to debug\r\nTraceback (most recent call last):\r\n  Binary file \"/usr/lib/system/libsystem_malloc.dylib\", local address: 0x180121fa7\r\n  Binary file \"/usr/lib/system/libsystem_malloc.dylib\", local address: 0x18013305f\r\n  Binary file \"/usr/lib/system/libsystem_malloc.dylib\", local address: 0x18012fa1b\r\n  Binary file \"/usr/lib/system/libsystem_c.dylib\", local address: 0x18024a313\r\n  Binary file \"/usr/lib/system/libsystem_pthread.dylib\", local address: 0x18030ceaf\r\n  Binary file \"/usr/lib/system/libsystem_platform.dylib\", local address: 0x1803244e3\r\nAbort: Signal SIGABRT (abort) received\r\n\r\nzsh: abort      lfortran --show-llvm a.f90\r\n```\r\n\r\nIt is not clear if the issue is with continue, or with the do loop.","closed_by":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/946/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/lfortran/lfortran/issues/946/timeline","performed_via_github_app":null,"state_reason":"completed"}