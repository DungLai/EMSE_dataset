{"url":"https://api.github.com/repos/lfortran/lfortran/issues/407","repository_url":"https://api.github.com/repos/lfortran/lfortran","labels_url":"https://api.github.com/repos/lfortran/lfortran/issues/407/labels{/name}","comments_url":"https://api.github.com/repos/lfortran/lfortran/issues/407/comments","events_url":"https://api.github.com/repos/lfortran/lfortran/issues/407/events","html_url":"https://github.com/lfortran/lfortran/issues/407","id":1338734992,"node_id":"I_kwDOCpMuHc5Py3mQ","number":407,"title":"cmake doesn't work with LFortran on Windows","user":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-08-15T09:11:45Z","updated_at":"2022-08-15T09:11:45Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"*Original issue*: https://gitlab.com/lfortran/lfortran/-/issues/536\n\nWhen trying to compile a cmake projects using LFortran as the Fortran compiler on Windows, one [gets](https://ci.appveyor.com/project/certik/lfortran-ts83e/builds/40476056):\n```console\n$ cd integration_tests\n$ export FC=\"C:\\\\projects\\\\lfortran-ts83e\\\\src\\\\bin\\\\lfortran.exe\"\n$ cmake -G ninja -DCMAKE_Fortran_PREPROCESS=OFF -DCMAKE_VERBOSE_MAKEFILE=ON -DLFORTRAN_BACKEND=llvm .\nCMake suite maintained and supported by Kitware (kitware.com/cmake).\n-- The C compiler identification is MSVC 19.16.27035.0\n-- The Fortran compiler identification is unknown\n-- Detecting C compiler ABI info\n-- Detecting C compiler ABI info - done\n-- Check for working C compiler: C:/Program Files (x86)/Microsoft Visual Studio/2017/Community/VC/Tools/MSVC/14.16.27023/bin/Hostx64/x64/cl.exe - skipped\n-- Detecting C compile features\n-- Detecting C compile features - done\n-- Detecting Fortran compiler ABI info\nCMake Error: Error required internal CMake variable not set, cmake may not be built correctly.\nMissing variable is:\nCMAKE_Fortran_PREPROCESS_SOURCE\nCMake Error at C:/Miniconda37-x64/Library/share/cmake-3.21/Modules/CMakeDetermineCompilerABI.cmake:49 (try_compile):\n  Failed to generate test project build system.\nCall Stack (most recent call first):\n  C:/Miniconda37-x64/Library/share/cmake-3.21/Modules/CMakeTestFortranCompiler.cmake:20 (CMAKE_DETERMINE_COMPILER_ABI)\n  CMakeLists.txt:3 (project)\n-- Configuring incomplete, errors occurred!\nSee also \"C:/projects/lfortran-ts83e/integration_tests/build-lfortran-llvm/CMakeFiles/CMakeOutput.log\".\nSee also \"C:/projects/lfortran-ts83e/integration_tests/build-lfortran-llvm/CMakeFiles/CMakeError.log\".\n```\nThis is using CMake 3.21.1 and Ninja 1.10.2. This seems like a bug in CMake.\n\nWe might need to switch to just use `fpm`.","closed_by":null,"reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/407/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/lfortran/lfortran/issues/407/timeline","performed_via_github_app":null,"state_reason":null}