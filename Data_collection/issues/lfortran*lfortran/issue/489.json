{"url":"https://api.github.com/repos/lfortran/lfortran/issues/489","repository_url":"https://api.github.com/repos/lfortran/lfortran","labels_url":"https://api.github.com/repos/lfortran/lfortran/issues/489/labels{/name}","comments_url":"https://api.github.com/repos/lfortran/lfortran/issues/489/comments","events_url":"https://api.github.com/repos/lfortran/lfortran/issues/489/events","html_url":"https://github.com/lfortran/lfortran/issues/489","id":1338779578,"node_id":"I_kwDOCpMuHc5PzCe6","number":489,"title":"Build fails with homebrew toolchain","user":{"login":"certik","id":20568,"node_id":"MDQ6VXNlcjIwNTY4","avatar_url":"https://avatars.githubusercontent.com/u/20568?v=4","gravatar_id":"","url":"https://api.github.com/users/certik","html_url":"https://github.com/certik","followers_url":"https://api.github.com/users/certik/followers","following_url":"https://api.github.com/users/certik/following{/other_user}","gists_url":"https://api.github.com/users/certik/gists{/gist_id}","starred_url":"https://api.github.com/users/certik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/certik/subscriptions","organizations_url":"https://api.github.com/users/certik/orgs","repos_url":"https://api.github.com/users/certik/repos","events_url":"https://api.github.com/users/certik/events{/privacy}","received_events_url":"https://api.github.com/users/certik/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-08-15T09:56:26Z","updated_at":"2022-08-15T09:56:26Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"*Original issue*: https://gitlab.com/lfortran/lfortran/-/issues/639\n\nI'm trying to create a formula for LFortran in homebrew ([homebrew-corehttps://gitlab.com/lfortran/lfortran/-/issues/92088](https://github.com/Homebrew/homebrew-core/pull/92088)), building 0.14.0 currently fails with:\n\n```\n  ==> Downloading https://lfortran.github.io/tarballs/release/lfortran-0.14.0.tar.gz\n  Already downloaded: /Users/brew/Library/Caches/Homebrew/downloads/a2cafbbe75c0ad045754d066d39f2f76dbaf1edffdf9831bc80f23435d63af5f--lfortran-0.14.0.tar.gz\n  ==> Verifying checksum for 'a2cafbbe75c0ad045754d066d39f2f76dbaf1edffdf9831bc80f23435d63af5f--lfortran-0.14.0.tar.gz'\n  tar --extract --no-same-owner --file /Users/brew/Library/Caches/Homebrew/downloads/a2cafbbe75c0ad045754d066d39f2f76dbaf1edffdf9831bc80f23435d63af5f--lfortran-0.14.0.tar.gz --directory /private/tmp/d20211227-19486-1eud6la\n  cp -pR /private/tmp/d20211227-19486-1eud6la/lfortran-0.14.0/. /private/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0\n  chmod -Rf +w /private/tmp/d20211227-19486-1eud6la\n  ==> cmake -DCMAKE_INSTALL_PREFIX=/opt/homebrew/Cellar/lfortran/0.14.0 -DCMAKE_INSTALL_LIBDIR=lib -DCMAKE_BUILD_TYPE=Release -DCMAKE_FIND_FRAMEWORK=LAST -DCMAKE_VERBOSE_MAKEFILE=ON -Wno-dev -DBUILD_TESTING=OFF -DCMAKE_OSX_SYSROOT=/Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -G Ninja -B build\n  -- The C compiler identification is AppleClang 13.0.0.13000029\n  -- The CXX compiler identification is AppleClang 13.0.0.13000029\n  -- Detecting C compiler ABI info\n  -- Detecting C compiler ABI info - done\n  -- Check for working C compiler: /opt/homebrew/Library/Homebrew/shims/mac/super/clang - skipped\n  -- Detecting C compile features\n  -- Detecting C compile features - done\n  -- Detecting CXX compiler ABI info\n  -- Detecting CXX compiler ABI info - done\n  -- Check for working CXX compiler: /opt/homebrew/Library/Homebrew/shims/mac/super/clang++ - skipped\n  -- Detecting CXX compile features\n  -- Detecting CXX compile features - done\n  -- Found ZLIB: /opt/homebrew/opt/zlib/lib/libz.a (found version \"1.2.11\") \n\n  Configuration results\n  ---------------------\n  LFORTRAN_VERSION: 0.14.0\n  CPACK_PACKAGE_FILE_NAME: lfortran-0.14.0-Darwin\n  C compiler      : /opt/homebrew/Library/Homebrew/shims/mac/super/clang\n  C++ compiler    : /opt/homebrew/Library/Homebrew/shims/mac/super/clang++\n  Build type: Release\n  C compiler flags      : -O3 -DNDEBUG\n  C++ compiler flags    : -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG\n  Installation prefix: /opt/homebrew/Cellar/lfortran/0.14.0\n  WITH_LFORTRAN_ASSERT: no\n  LFORTRAN_STATIC_BIN: no\n  WITH_STACKTRACE: no\n  WITH_UNWIND: no\n  WITH_BFD: no\n  WITH_DWARFDUMP: no\n  WITH_LINKH: no\n  WITH_MACHO: no\n  HAVE_LFORTRAN_DEMANGLE: yes\n  WITH_LLVM: no\n  WITH_XEUS: no\n  WITH_JSON: no\n  WITH_FMT: no\n  WITH_LFORTRAN_BINARY_MODFILES: YES\n  WITH_RUNTIME_LIBRARY: YES\n  WITH_TARGET_AARCH64: no\n  WITH_TARGET_X86: no\n  -- Configuring done\n  -- Generating done\n  CMake Warning:\n    Manually-specified variables were not used by the project:\n  \n      BUILD_TESTING\n  \n  \n  -- Build files have been written to: /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build\n  ==> cmake --build build\n  [1/79] cd /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src/lfortran/tests && /opt/homebrew/Cellar/cmake/3.22.1/bin/cmake -E copy /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/lfortran/tests/ref_pickle.txt /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src/lfortran/tests/ref_pickle.txt\n  [2/79] /opt/homebrew/Library/Homebrew/shims/mac/super/clang++  -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIC -std=gnu++17 -MD -MT src/lfortran/CMakeFiles/lfortran_lib.dir/parser/parser.tab.cc.o -MF src/lfortran/CMakeFiles/lfortran_lib.dir/parser/parser.tab.cc.o.d -o src/lfortran/CMakeFiles/lfortran_lib.dir/parser/parser.tab.cc.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/lfortran/parser/parser.tab.cc\n  FAILED: src/lfortran/CMakeFiles/lfortran_lib.dir/parser/parser.tab.cc.o \n  /opt/homebrew/Library/Homebrew/shims/mac/super/clang++  -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIC -std=gnu++17 -MD -MT src/lfortran/CMakeFiles/lfortran_lib.dir/parser/parser.tab.cc.o -MF src/lfortran/CMakeFiles/lfortran_lib.dir/parser/parser.tab.cc.o.d -o src/lfortran/CMakeFiles/lfortran_lib.dir/parser/parser.tab.cc.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/lfortran/parser/parser.tab.cc\n  clang: error: the clang compiler does not support '-march=native'\n  [3/79] /opt/homebrew/Library/Homebrew/shims/mac/super/clang++  -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/bin/tpl -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIE -std=gnu++17 -MD -MT src/bin/CMakeFiles/lfortran.dir/lfortran.cpp.o -MF src/bin/CMakeFiles/lfortran.dir/lfortran.cpp.o.d -o src/bin/CMakeFiles/lfortran.dir/lfortran.cpp.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/bin/lfortran.cpp\n  FAILED: src/bin/CMakeFiles/lfortran.dir/lfortran.cpp.o \n  /opt/homebrew/Library/Homebrew/shims/mac/super/clang++  -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/bin/tpl -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIE -std=gnu++17 -MD -MT src/bin/CMakeFiles/lfortran.dir/lfortran.cpp.o -MF src/bin/CMakeFiles/lfortran.dir/lfortran.cpp.o.d -o src/bin/CMakeFiles/lfortran.dir/lfortran.cpp.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/bin/lfortran.cpp\n  clang: error: the clang compiler does not support '-march=native'\n  [4/79] /opt/homebrew/Library/Homebrew/shims/mac/super/clang++  -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIE -std=gnu++17 -MD -MT src/bin/CMakeFiles/cpptranslate.dir/cpptranslate.cpp.o -MF src/bin/CMakeFiles/cpptranslate.dir/cpptranslate.cpp.o.d -o src/bin/CMakeFiles/cpptranslate.dir/cpptranslate.cpp.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/bin/cpptranslate.cpp\n  FAILED: src/bin/CMakeFiles/cpptranslate.dir/cpptranslate.cpp.o \n  /opt/homebrew/Library/Homebrew/shims/mac/super/clang++  -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIE -std=gnu++17 -MD -MT src/bin/CMakeFiles/cpptranslate.dir/cpptranslate.cpp.o -MF src/bin/CMakeFiles/cpptranslate.dir/cpptranslate.cpp.o.d -o src/bin/CMakeFiles/cpptranslate.dir/cpptranslate.cpp.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/bin/cpptranslate.cpp\n  clang: error: the clang compiler does not support '-march=native'\n  [5/79] /opt/homebrew/Library/Homebrew/shims/mac/super/clang++   -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIC -std=gnu++17 -MD -MT src/tests/CMakeFiles/doctest.dir/doctest.cpp.o -MF src/tests/CMakeFiles/doctest.dir/doctest.cpp.o.d -o src/tests/CMakeFiles/doctest.dir/doctest.cpp.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/tests/doctest.cpp\n  FAILED: src/tests/CMakeFiles/doctest.dir/doctest.cpp.o \n  /opt/homebrew/Library/Homebrew/shims/mac/super/clang++   -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIC -std=gnu++17 -MD -MT src/tests/CMakeFiles/doctest.dir/doctest.cpp.o -MF src/tests/CMakeFiles/doctest.dir/doctest.cpp.o.d -o src/tests/CMakeFiles/doctest.dir/doctest.cpp.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/tests/doctest.cpp\n  clang: error: the clang compiler does not support '-march=native'\n  [6/79] /opt/homebrew/Library/Homebrew/shims/mac/super/clang++  -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIE -std=gnu++17 -MD -MT src/bin/CMakeFiles/parse.dir/parse.cpp.o -MF src/bin/CMakeFiles/parse.dir/parse.cpp.o.d -o src/bin/CMakeFiles/parse.dir/parse.cpp.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/bin/parse.cpp\n  FAILED: src/bin/CMakeFiles/parse.dir/parse.cpp.o \n  /opt/homebrew/Library/Homebrew/shims/mac/super/clang++  -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIE -std=gnu++17 -MD -MT src/bin/CMakeFiles/parse.dir/parse.cpp.o -MF src/bin/CMakeFiles/parse.dir/parse.cpp.o.d -o src/bin/CMakeFiles/parse.dir/parse.cpp.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/bin/parse.cpp\n  clang: error: the clang compiler does not support '-march=native'\n  [7/79] /opt/homebrew/Library/Homebrew/shims/mac/super/clang++  -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIE -std=gnu++17 -MD -MT src/bin/CMakeFiles/parse2.dir/parse2.cpp.o -MF src/bin/CMakeFiles/parse2.dir/parse2.cpp.o.d -o src/bin/CMakeFiles/parse2.dir/parse2.cpp.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/bin/parse2.cpp\n  FAILED: src/bin/CMakeFiles/parse2.dir/parse2.cpp.o \n  /opt/homebrew/Library/Homebrew/shims/mac/super/clang++  -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIE -std=gnu++17 -MD -MT src/bin/CMakeFiles/parse2.dir/parse2.cpp.o -MF src/bin/CMakeFiles/parse2.dir/parse2.cpp.o.d -o src/bin/CMakeFiles/parse2.dir/parse2.cpp.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/bin/parse2.cpp\n  clang: error: the clang compiler does not support '-march=native'\n  [8/79] /opt/homebrew/Library/Homebrew/shims/mac/super/clang++  -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIC -std=gnu++17 -MD -MT src/lfortran/CMakeFiles/lfortran_lib.dir/parser/tokenizer.cpp.o -MF src/lfortran/CMakeFiles/lfortran_lib.dir/parser/tokenizer.cpp.o.d -o src/lfortran/CMakeFiles/lfortran_lib.dir/parser/tokenizer.cpp.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/lfortran/parser/tokenizer.cpp\n  FAILED: src/lfortran/CMakeFiles/lfortran_lib.dir/parser/tokenizer.cpp.o \n  /opt/homebrew/Library/Homebrew/shims/mac/super/clang++  -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIC -std=gnu++17 -MD -MT src/lfortran/CMakeFiles/lfortran_lib.dir/parser/tokenizer.cpp.o -MF src/lfortran/CMakeFiles/lfortran_lib.dir/parser/tokenizer.cpp.o.d -o src/lfortran/CMakeFiles/lfortran_lib.dir/parser/tokenizer.cpp.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/lfortran/parser/tokenizer.cpp\n  clang: error: the clang compiler does not support '-march=native'\n  [9/79] /opt/homebrew/Library/Homebrew/shims/mac/super/clang++  -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIC -std=gnu++17 -MD -MT src/lfortran/CMakeFiles/lfortran_lib.dir/parser/parser.cpp.o -MF src/lfortran/CMakeFiles/lfortran_lib.dir/parser/parser.cpp.o.d -o src/lfortran/CMakeFiles/lfortran_lib.dir/parser/parser.cpp.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/lfortran/parser/parser.cpp\n  FAILED: src/lfortran/CMakeFiles/lfortran_lib.dir/parser/parser.cpp.o \n  /opt/homebrew/Library/Homebrew/shims/mac/super/clang++  -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/build/src -I/tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src -Wall -Wextra -O3 -march=native -funroll-loops -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIC -std=gnu++17 -MD -MT src/lfortran/CMakeFiles/lfortran_lib.dir/parser/parser.cpp.o -MF src/lfortran/CMakeFiles/lfortran_lib.dir/parser/parser.cpp.o.d -o src/lfortran/CMakeFiles/lfortran_lib.dir/parser/parser.cpp.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/lfortran/parser/parser.cpp\n  clang: error: the clang compiler does not support '-march=native'\n  [10/79] /opt/homebrew/Library/Homebrew/shims/mac/super/clang -Dlfortran_runtime_EXPORTS  -O3 -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIC -MD -MT src/runtime/legacy/CMakeFiles/lfortran_runtime.dir/__/impure/lfortran_intrinsics.c.o -MF src/runtime/legacy/CMakeFiles/lfortran_runtime.dir/__/impure/lfortran_intrinsics.c.o.d -o src/runtime/legacy/CMakeFiles/lfortran_runtime.dir/__/impure/lfortran_intrinsics.c.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/runtime/impure/lfortran_intrinsics.c\n  [11/79] /opt/homebrew/Library/Homebrew/shims/mac/super/clang   -O3 -DNDEBUG -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk -fPIC -MD -MT src/runtime/legacy/CMakeFiles/lfortran_runtime_static.dir/__/impure/lfortran_intrinsics.c.o -MF src/runtime/legacy/CMakeFiles/lfortran_runtime_static.dir/__/impure/lfortran_intrinsics.c.o.d -o src/runtime/legacy/CMakeFiles/lfortran_runtime_static.dir/__/impure/lfortran_intrinsics.c.o -c /tmp/lfortran-20211227-19486-1let3ao/lfortran-0.14.0/src/runtime/impure/lfortran_intrinsics.c\n  ninja: build stopped: subcommand failed.\n```\n\nThe offending `-march=native` is set in:\n\nhttps://gitlab.com/lfortran/lfortran/-/blob/d58864d1ddfb4a1b3a5aa8bacacd3d701ba42be3/cmake/UserOverride.cmake#L22\n\nWhat is the best way to fix this issue for building in homebrew? Should I patch the tarball or is there an easier way to remove this overwrite?","closed_by":null,"reactions":{"url":"https://api.github.com/repos/lfortran/lfortran/issues/489/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/lfortran/lfortran/issues/489/timeline","performed_via_github_app":null,"state_reason":null}