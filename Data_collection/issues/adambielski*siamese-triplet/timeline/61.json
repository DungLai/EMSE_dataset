[{"url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/comments/831758950","html_url":"https://github.com/adambielski/siamese-triplet/issues/61#issuecomment-831758950","issue_url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/61","id":831758950,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMTc1ODk1MA==","user":{"login":"bth5032","id":6195617,"node_id":"MDQ6VXNlcjYxOTU2MTc=","avatar_url":"https://avatars.githubusercontent.com/u/6195617?v=4","gravatar_id":"","url":"https://api.github.com/users/bth5032","html_url":"https://github.com/bth5032","followers_url":"https://api.github.com/users/bth5032/followers","following_url":"https://api.github.com/users/bth5032/following{/other_user}","gists_url":"https://api.github.com/users/bth5032/gists{/gist_id}","starred_url":"https://api.github.com/users/bth5032/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bth5032/subscriptions","organizations_url":"https://api.github.com/users/bth5032/orgs","repos_url":"https://api.github.com/users/bth5032/repos","events_url":"https://api.github.com/users/bth5032/events{/privacy}","received_events_url":"https://api.github.com/users/bth5032/received_events","type":"User","site_admin":false},"created_at":"2021-05-04T08:07:56Z","updated_at":"2021-05-04T08:07:56Z","author_association":"NONE","body":"Can you expand on this, I'm running into the same issue, but you seem to be implying the issue is somehow at the dataset level, but the offending code is called for each batch of data. \r\n\r\n\r\nI don't understand your example, there are way less than 181 labels in\r\n\r\n```python\r\nTRAINING\r\nlabels: [ 4  4 34 34 11 11  3  3  2  2 13 13 32 32 16 16 22 22 39 39 29 29 25 25\r\n  8  8 24 24 37 37 41 41 44 44 18 18 21 21 31 31 23 23  1  1 15 15  7  7\r\n 26 26 28 28 14 14 19 19]\r\n``` \r\n\r\nso why does that code show 0/181? \r\n\r\nI'm really confused as to what the entire set has to do with anything because this seems like a scenario where you can have a bad batch, not a bad training/validation set. Can you expand on how many examples are being sent to `get_triplets` inside of `OnlineTripletLoss.forward()` per batch in your test cases (i.e. in your 'train' and 'validation' set)?? \r\n\r\nIt looks like you're only sending in one example in the case of the validation set because you only print one 'label' and you always hit the continue. Obviously you can't do contrastive loss with only one example, so I'm guessing I'm misunderstanding something here.","reactions":{"url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/comments/831758950/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bth5032","id":6195617,"node_id":"MDQ6VXNlcjYxOTU2MTc=","avatar_url":"https://avatars.githubusercontent.com/u/6195617?v=4","gravatar_id":"","url":"https://api.github.com/users/bth5032","html_url":"https://github.com/bth5032","followers_url":"https://api.github.com/users/bth5032/followers","following_url":"https://api.github.com/users/bth5032/following{/other_user}","gists_url":"https://api.github.com/users/bth5032/gists{/gist_id}","starred_url":"https://api.github.com/users/bth5032/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bth5032/subscriptions","organizations_url":"https://api.github.com/users/bth5032/orgs","repos_url":"https://api.github.com/users/bth5032/repos","events_url":"https://api.github.com/users/bth5032/events{/privacy}","received_events_url":"https://api.github.com/users/bth5032/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/comments/831771856","html_url":"https://github.com/adambielski/siamese-triplet/issues/61#issuecomment-831771856","issue_url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/61","id":831771856,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMTc3MTg1Ng==","user":{"login":"bth5032","id":6195617,"node_id":"MDQ6VXNlcjYxOTU2MTc=","avatar_url":"https://avatars.githubusercontent.com/u/6195617?v=4","gravatar_id":"","url":"https://api.github.com/users/bth5032","html_url":"https://github.com/bth5032","followers_url":"https://api.github.com/users/bth5032/followers","following_url":"https://api.github.com/users/bth5032/following{/other_user}","gists_url":"https://api.github.com/users/bth5032/gists{/gist_id}","starred_url":"https://api.github.com/users/bth5032/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bth5032/subscriptions","organizations_url":"https://api.github.com/users/bth5032/orgs","repos_url":"https://api.github.com/users/bth5032/repos","events_url":"https://api.github.com/users/bth5032/events{/privacy}","received_events_url":"https://api.github.com/users/bth5032/received_events","type":"User","site_admin":false},"created_at":"2021-05-04T08:31:02Z","updated_at":"2021-05-04T08:39:04Z","author_association":"NONE","body":"After looking at the code for a while, I think what's happening is that if you send in a batch where NONE of your entries has a positive example, then you hit that continue statement for every element in the batch. In which case, there are no triplets since you need at least 1 positive and one negative example to make a triplet. That's why `len(triplets) == 0`.\r\n\r\nI think the line you pointed out \r\n\r\n```python\r\nif len(triplets) == 0:\r\n            triplets.append([anchor_positive[0], anchor_positive[1], negative_indices[0]])\r\n```\r\n\r\nis just a typo as, `anchor_positive` is only defined in the nested for loop above. Clearly, the author was trying to have a default return case when there are no triplets in the batch, but I too am unsure exactly what he was trying to do there because there is no case where that if statement should work properly. \r\n\r\nPresumably we could just return a constant 1x3 vector in that if statement and the gradient of the loss in that case would be zero and not change the network at all, which is probably the behavior we want.","reactions":{"url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/comments/831771856/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bth5032","id":6195617,"node_id":"MDQ6VXNlcjYxOTU2MTc=","avatar_url":"https://avatars.githubusercontent.com/u/6195617?v=4","gravatar_id":"","url":"https://api.github.com/users/bth5032","html_url":"https://github.com/bth5032","followers_url":"https://api.github.com/users/bth5032/followers","following_url":"https://api.github.com/users/bth5032/following{/other_user}","gists_url":"https://api.github.com/users/bth5032/gists{/gist_id}","starred_url":"https://api.github.com/users/bth5032/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bth5032/subscriptions","organizations_url":"https://api.github.com/users/bth5032/orgs","repos_url":"https://api.github.com/users/bth5032/repos","events_url":"https://api.github.com/users/bth5032/events{/privacy}","received_events_url":"https://api.github.com/users/bth5032/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/comments/831970438","html_url":"https://github.com/adambielski/siamese-triplet/issues/61#issuecomment-831970438","issue_url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/61","id":831970438,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMTk3MDQzOA==","user":{"login":"Trotts","id":9531671,"node_id":"MDQ6VXNlcjk1MzE2NzE=","avatar_url":"https://avatars.githubusercontent.com/u/9531671?v=4","gravatar_id":"","url":"https://api.github.com/users/Trotts","html_url":"https://github.com/Trotts","followers_url":"https://api.github.com/users/Trotts/followers","following_url":"https://api.github.com/users/Trotts/following{/other_user}","gists_url":"https://api.github.com/users/Trotts/gists{/gist_id}","starred_url":"https://api.github.com/users/Trotts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Trotts/subscriptions","organizations_url":"https://api.github.com/users/Trotts/orgs","repos_url":"https://api.github.com/users/Trotts/repos","events_url":"https://api.github.com/users/Trotts/events{/privacy}","received_events_url":"https://api.github.com/users/Trotts/received_events","type":"User","site_admin":false},"created_at":"2021-05-04T14:07:23Z","updated_at":"2021-05-04T14:07:23Z","author_association":"NONE","body":"@bth5032 my hunch as to what was causing the issue may be incorrect, it was simply based on the fact that the code was failing to create batches just for this dataset. I believe the offending line is a typo, have you had any luck with your proposed solution?","reactions":{"url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/comments/831970438/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Trotts","id":9531671,"node_id":"MDQ6VXNlcjk1MzE2NzE=","avatar_url":"https://avatars.githubusercontent.com/u/9531671?v=4","gravatar_id":"","url":"https://api.github.com/users/Trotts","html_url":"https://github.com/Trotts","followers_url":"https://api.github.com/users/Trotts/followers","following_url":"https://api.github.com/users/Trotts/following{/other_user}","gists_url":"https://api.github.com/users/Trotts/gists{/gist_id}","starred_url":"https://api.github.com/users/Trotts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Trotts/subscriptions","organizations_url":"https://api.github.com/users/Trotts/orgs","repos_url":"https://api.github.com/users/Trotts/repos","events_url":"https://api.github.com/users/Trotts/events{/privacy}","received_events_url":"https://api.github.com/users/Trotts/received_events","type":"User","site_admin":false}},{"id":4683608966,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDY4MzYwODk2Ng==","url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/events/4683608966","actor":{"login":"bth5032","id":6195617,"node_id":"MDQ6VXNlcjYxOTU2MTc=","avatar_url":"https://avatars.githubusercontent.com/u/6195617?v=4","gravatar_id":"","url":"https://api.github.com/users/bth5032","html_url":"https://github.com/bth5032","followers_url":"https://api.github.com/users/bth5032/followers","following_url":"https://api.github.com/users/bth5032/following{/other_user}","gists_url":"https://api.github.com/users/bth5032/gists{/gist_id}","starred_url":"https://api.github.com/users/bth5032/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bth5032/subscriptions","organizations_url":"https://api.github.com/users/bth5032/orgs","repos_url":"https://api.github.com/users/bth5032/repos","events_url":"https://api.github.com/users/bth5032/events{/privacy}","received_events_url":"https://api.github.com/users/bth5032/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-05-04T14:07:24Z","performed_via_github_app":null},{"id":4683608969,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ2ODM2MDg5Njk=","url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/events/4683608969","actor":{"login":"bth5032","id":6195617,"node_id":"MDQ6VXNlcjYxOTU2MTc=","avatar_url":"https://avatars.githubusercontent.com/u/6195617?v=4","gravatar_id":"","url":"https://api.github.com/users/bth5032","html_url":"https://github.com/bth5032","followers_url":"https://api.github.com/users/bth5032/followers","following_url":"https://api.github.com/users/bth5032/following{/other_user}","gists_url":"https://api.github.com/users/bth5032/gists{/gist_id}","starred_url":"https://api.github.com/users/bth5032/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bth5032/subscriptions","organizations_url":"https://api.github.com/users/bth5032/orgs","repos_url":"https://api.github.com/users/bth5032/repos","events_url":"https://api.github.com/users/bth5032/events{/privacy}","received_events_url":"https://api.github.com/users/bth5032/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-05-04T14:07:24Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/comments/832151418","html_url":"https://github.com/adambielski/siamese-triplet/issues/61#issuecomment-832151418","issue_url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/61","id":832151418,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMjE1MTQxOA==","user":{"login":"bth5032","id":6195617,"node_id":"MDQ6VXNlcjYxOTU2MTc=","avatar_url":"https://avatars.githubusercontent.com/u/6195617?v=4","gravatar_id":"","url":"https://api.github.com/users/bth5032","html_url":"https://github.com/bth5032","followers_url":"https://api.github.com/users/bth5032/followers","following_url":"https://api.github.com/users/bth5032/following{/other_user}","gists_url":"https://api.github.com/users/bth5032/gists{/gist_id}","starred_url":"https://api.github.com/users/bth5032/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bth5032/subscriptions","organizations_url":"https://api.github.com/users/bth5032/orgs","repos_url":"https://api.github.com/users/bth5032/repos","events_url":"https://api.github.com/users/bth5032/events{/privacy}","received_events_url":"https://api.github.com/users/bth5032/received_events","type":"User","site_admin":false},"created_at":"2021-05-04T18:27:08Z","updated_at":"2021-05-04T18:27:08Z","author_association":"NONE","body":"Hi, yeah I ran a test overnight, just returning a constant vector, in my case \r\n\r\n```python\r\nif len(triplets) == 0:\r\n            triplets.append([0,0,0])\r\n````\r\nfixed the crash and the model seems to be training just fine","reactions":{"url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/comments/832151418/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":2,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bth5032","id":6195617,"node_id":"MDQ6VXNlcjYxOTU2MTc=","avatar_url":"https://avatars.githubusercontent.com/u/6195617?v=4","gravatar_id":"","url":"https://api.github.com/users/bth5032","html_url":"https://github.com/bth5032","followers_url":"https://api.github.com/users/bth5032/followers","following_url":"https://api.github.com/users/bth5032/following{/other_user}","gists_url":"https://api.github.com/users/bth5032/gists{/gist_id}","starred_url":"https://api.github.com/users/bth5032/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bth5032/subscriptions","organizations_url":"https://api.github.com/users/bth5032/orgs","repos_url":"https://api.github.com/users/bth5032/repos","events_url":"https://api.github.com/users/bth5032/events{/privacy}","received_events_url":"https://api.github.com/users/bth5032/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/comments/832511152","html_url":"https://github.com/adambielski/siamese-triplet/issues/61#issuecomment-832511152","issue_url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/61","id":832511152,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMjUxMTE1Mg==","user":{"login":"Trotts","id":9531671,"node_id":"MDQ6VXNlcjk1MzE2NzE=","avatar_url":"https://avatars.githubusercontent.com/u/9531671?v=4","gravatar_id":"","url":"https://api.github.com/users/Trotts","html_url":"https://github.com/Trotts","followers_url":"https://api.github.com/users/Trotts/followers","following_url":"https://api.github.com/users/Trotts/following{/other_user}","gists_url":"https://api.github.com/users/Trotts/gists{/gist_id}","starred_url":"https://api.github.com/users/Trotts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Trotts/subscriptions","organizations_url":"https://api.github.com/users/Trotts/orgs","repos_url":"https://api.github.com/users/Trotts/repos","events_url":"https://api.github.com/users/Trotts/events{/privacy}","received_events_url":"https://api.github.com/users/Trotts/received_events","type":"User","site_admin":false},"created_at":"2021-05-05T08:29:10Z","updated_at":"2021-05-05T08:29:10Z","author_association":"NONE","body":"Great stuff, thank you for taking the time to test that. I ran into this issue but solved it by changing the split of my train-test set. This is a much better solution. ","reactions":{"url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/comments/832511152/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Trotts","id":9531671,"node_id":"MDQ6VXNlcjk1MzE2NzE=","avatar_url":"https://avatars.githubusercontent.com/u/9531671?v=4","gravatar_id":"","url":"https://api.github.com/users/Trotts","html_url":"https://github.com/Trotts","followers_url":"https://api.github.com/users/Trotts/followers","following_url":"https://api.github.com/users/Trotts/following{/other_user}","gists_url":"https://api.github.com/users/Trotts/gists{/gist_id}","starred_url":"https://api.github.com/users/Trotts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Trotts/subscriptions","organizations_url":"https://api.github.com/users/Trotts/orgs","repos_url":"https://api.github.com/users/Trotts/repos","events_url":"https://api.github.com/users/Trotts/events{/privacy}","received_events_url":"https://api.github.com/users/Trotts/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/comments/833324676","html_url":"https://github.com/adambielski/siamese-triplet/issues/61#issuecomment-833324676","issue_url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/61","id":833324676,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzMyNDY3Ng==","user":{"login":"bth5032","id":6195617,"node_id":"MDQ6VXNlcjYxOTU2MTc=","avatar_url":"https://avatars.githubusercontent.com/u/6195617?v=4","gravatar_id":"","url":"https://api.github.com/users/bth5032","html_url":"https://github.com/bth5032","followers_url":"https://api.github.com/users/bth5032/followers","following_url":"https://api.github.com/users/bth5032/following{/other_user}","gists_url":"https://api.github.com/users/bth5032/gists{/gist_id}","starred_url":"https://api.github.com/users/bth5032/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bth5032/subscriptions","organizations_url":"https://api.github.com/users/bth5032/orgs","repos_url":"https://api.github.com/users/bth5032/repos","events_url":"https://api.github.com/users/bth5032/events{/privacy}","received_events_url":"https://api.github.com/users/bth5032/received_events","type":"User","site_admin":false},"created_at":"2021-05-06T08:10:46Z","updated_at":"2021-05-06T08:10:46Z","author_association":"NONE","body":"Hey no problem, thanks for making the post, definitely saved me some time on this!","reactions":{"url":"https://api.github.com/repos/adambielski/siamese-triplet/issues/comments/833324676/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bth5032","id":6195617,"node_id":"MDQ6VXNlcjYxOTU2MTc=","avatar_url":"https://avatars.githubusercontent.com/u/6195617?v=4","gravatar_id":"","url":"https://api.github.com/users/bth5032","html_url":"https://github.com/bth5032","followers_url":"https://api.github.com/users/bth5032/followers","following_url":"https://api.github.com/users/bth5032/following{/other_user}","gists_url":"https://api.github.com/users/bth5032/gists{/gist_id}","starred_url":"https://api.github.com/users/bth5032/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bth5032/subscriptions","organizations_url":"https://api.github.com/users/bth5032/orgs","repos_url":"https://api.github.com/users/bth5032/repos","events_url":"https://api.github.com/users/bth5032/events{/privacy}","received_events_url":"https://api.github.com/users/bth5032/received_events","type":"User","site_admin":false}}]