[{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/619119570","html_url":"https://github.com/beringresearch/ivis/issues/66#issuecomment-619119570","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/66","id":619119570,"node_id":"MDEyOklzc3VlQ29tbWVudDYxOTExOTU3MA==","user":{"login":"idroz","id":12413294,"node_id":"MDQ6VXNlcjEyNDEzMjk0","avatar_url":"https://avatars.githubusercontent.com/u/12413294?v=4","gravatar_id":"","url":"https://api.github.com/users/idroz","html_url":"https://github.com/idroz","followers_url":"https://api.github.com/users/idroz/followers","following_url":"https://api.github.com/users/idroz/following{/other_user}","gists_url":"https://api.github.com/users/idroz/gists{/gist_id}","starred_url":"https://api.github.com/users/idroz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/idroz/subscriptions","organizations_url":"https://api.github.com/users/idroz/orgs","repos_url":"https://api.github.com/users/idroz/repos","events_url":"https://api.github.com/users/idroz/events{/privacy}","received_events_url":"https://api.github.com/users/idroz/received_events","type":"User","site_admin":false},"created_at":"2020-04-24T16:36:52Z","updated_at":"2020-04-24T16:36:52Z","author_association":"COLLABORATOR","body":"Hi - agree that this would be a useful feature to implement.\r\n\r\nProbably a bigger challenge would come in during model saving/loading. A custom loss function would need to have a reliable mechanism of serialisation.\r\n\r\nIf this is to be implemented, personal preference is to consider one of the latter two approaches that you propose, as they don't introduce additional parameters to `Ivis.__init__`. @Szubie for additional input on this.\r\n\r\nIf you feel up to it, do fork the repo and we can work jointly on this.\r\n","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/619119570/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"idroz","id":12413294,"node_id":"MDQ6VXNlcjEyNDEzMjk0","avatar_url":"https://avatars.githubusercontent.com/u/12413294?v=4","gravatar_id":"","url":"https://api.github.com/users/idroz","html_url":"https://github.com/idroz","followers_url":"https://api.github.com/users/idroz/followers","following_url":"https://api.github.com/users/idroz/following{/other_user}","gists_url":"https://api.github.com/users/idroz/gists{/gist_id}","starred_url":"https://api.github.com/users/idroz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/idroz/subscriptions","organizations_url":"https://api.github.com/users/idroz/orgs","repos_url":"https://api.github.com/users/idroz/repos","events_url":"https://api.github.com/users/idroz/events{/privacy}","received_events_url":"https://api.github.com/users/idroz/received_events","type":"User","site_admin":false}},{"id":3270188330,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI3MDE4ODMzMA==","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/3270188330","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-24T16:36:52Z","performed_via_github_app":null},{"id":3270188335,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyNzAxODgzMzU=","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/3270188335","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-24T16:36:52Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/620491684","html_url":"https://github.com/beringresearch/ivis/issues/66#issuecomment-620491684","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/66","id":620491684,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMDQ5MTY4NA==","user":{"login":"mihajenko","id":2692678,"node_id":"MDQ6VXNlcjI2OTI2Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/2692678?v=4","gravatar_id":"","url":"https://api.github.com/users/mihajenko","html_url":"https://github.com/mihajenko","followers_url":"https://api.github.com/users/mihajenko/followers","following_url":"https://api.github.com/users/mihajenko/following{/other_user}","gists_url":"https://api.github.com/users/mihajenko/gists{/gist_id}","starred_url":"https://api.github.com/users/mihajenko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mihajenko/subscriptions","organizations_url":"https://api.github.com/users/mihajenko/orgs","repos_url":"https://api.github.com/users/mihajenko/repos","events_url":"https://api.github.com/users/mihajenko/events{/privacy}","received_events_url":"https://api.github.com/users/mihajenko/received_events","type":"User","site_admin":false},"created_at":"2020-04-28T09:31:18Z","updated_at":"2020-04-28T09:31:49Z","author_association":"NONE","body":"I want to clarify something: if we define a triplet loss function with a custom distance metric, that means this same metric should also be used when indexing the vectors. Which means custom triplet loss functions are limited by `Annoy`'s metric offerings.\r\n\r\nDoes this reveal a bug, since the `Annoy` index in this library is set as fixed to `angular`?\r\n\r\nFor my use case, I have to incorporate the Jaccard distance into the triplet loss function. But the `Annoy` index doesn't have support for it, so my only option is to implement it in `Annoy` as well.\r\n\r\nAm I understanding `ivis`' implementation correctly?\r\n\r\nI'd be willing to work on this issue, of course. But if the `Annoy` backend poses such fundamental constraints, then we should also define a triplet loss function validation procedure, which should check if the used distance metric are supported on the indexer.","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/620491684/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mihajenko","id":2692678,"node_id":"MDQ6VXNlcjI2OTI2Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/2692678?v=4","gravatar_id":"","url":"https://api.github.com/users/mihajenko","html_url":"https://github.com/mihajenko","followers_url":"https://api.github.com/users/mihajenko/followers","following_url":"https://api.github.com/users/mihajenko/following{/other_user}","gists_url":"https://api.github.com/users/mihajenko/gists{/gist_id}","starred_url":"https://api.github.com/users/mihajenko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mihajenko/subscriptions","organizations_url":"https://api.github.com/users/mihajenko/orgs","repos_url":"https://api.github.com/users/mihajenko/repos","events_url":"https://api.github.com/users/mihajenko/events{/privacy}","received_events_url":"https://api.github.com/users/mihajenko/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/620683286","html_url":"https://github.com/beringresearch/ivis/issues/66#issuecomment-620683286","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/66","id":620683286,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMDY4MzI4Ng==","user":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"created_at":"2020-04-28T15:37:20Z","updated_at":"2020-04-28T15:37:20Z","author_association":"COLLABORATOR","body":"Hi,\r\n\r\nI agree that handling the passing of a custom loss function would be a nice feature to have. As you said, the loss functions are written in a quite consistent manner and it shouldn't be too difficult for a user to provide their own in theory. We could provide some guidance in documentation as well if this feature is popular. I would lean towards your suggestion of reusing the existing `distance` keyword argument to keep the API clean.\r\n\r\n \r\n> I want to clarify something: if we define a triplet loss function with a custom distance metric, that means this same metric should also be used when indexing the vectors. Which means custom triplet loss functions are limited by `Annoy`'s metric offerings.\r\n> \r\n> Does this reveal a bug, since the `Annoy` index in this library is set as fixed to `angular`?\r\n\r\nThe k-Nearest-Neighbour (KNN) retrieval process using Annoy is currently treated as a completely separate component from the neural network training procedure. We just need to get a KNN matrix out of Annoy, it shouldn't matter whether the metric Annoy uses to retrieve KNN is different from the metric the network uses to embed into the embedding dims. The loss function the user selects only effects how the network learns to embed data in its embedding layers during training, which impacts how the visualizations look. \r\n\r\nWe settled on Annoy as a default for ease of use and fast speed. The default of 'angular' distance was used as we found that it performed well across all the datasets we used it on, and did not want to make the API surface too large. If there is interest in selecting different Annoy distance metrics we may provide the option.\r\n\r\nIt should actually technically be possible to swap out Annoy for another algorithm that retrieves KNN - we are thinking about implementing a feature in ivis where the user can provide an already-built KNN matrix. This would enable users to compute the KNNs using whatever algorithm they want and provide them to ivis.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/620683286/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/620898246","html_url":"https://github.com/beringresearch/ivis/issues/66#issuecomment-620898246","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/66","id":620898246,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMDg5ODI0Ng==","user":{"login":"mihajenko","id":2692678,"node_id":"MDQ6VXNlcjI2OTI2Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/2692678?v=4","gravatar_id":"","url":"https://api.github.com/users/mihajenko","html_url":"https://github.com/mihajenko","followers_url":"https://api.github.com/users/mihajenko/followers","following_url":"https://api.github.com/users/mihajenko/following{/other_user}","gists_url":"https://api.github.com/users/mihajenko/gists{/gist_id}","starred_url":"https://api.github.com/users/mihajenko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mihajenko/subscriptions","organizations_url":"https://api.github.com/users/mihajenko/orgs","repos_url":"https://api.github.com/users/mihajenko/repos","events_url":"https://api.github.com/users/mihajenko/events{/privacy}","received_events_url":"https://api.github.com/users/mihajenko/received_events","type":"User","site_admin":false},"created_at":"2020-04-28T22:58:40Z","updated_at":"2020-04-28T22:58:40Z","author_association":"NONE","body":"I misunderstood the dependency between the KNN metrics and the triplet loss metrics, thank you for clarifying. Apart from possible serialization issues, I don't see much in the way of implementing the custom triplet loss feature.\r\n\r\nWhen someone has a concrete usecase for it, I'll focus on this issue again.\r\n\r\nThe feature with the bigger priority for me would actually be a swappable KNN index. To that end, I am integrating the [NGT](https://github.com/yahoojapan/NGT) indexer into `ivis`, because it supports the metric that I need. Feature branch is here: https://github.com/mihajenko/ivis/tree/feature/ngt-backend","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/620898246/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mihajenko","id":2692678,"node_id":"MDQ6VXNlcjI2OTI2Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/2692678?v=4","gravatar_id":"","url":"https://api.github.com/users/mihajenko","html_url":"https://github.com/mihajenko","followers_url":"https://api.github.com/users/mihajenko/followers","following_url":"https://api.github.com/users/mihajenko/following{/other_user}","gists_url":"https://api.github.com/users/mihajenko/gists{/gist_id}","starred_url":"https://api.github.com/users/mihajenko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mihajenko/subscriptions","organizations_url":"https://api.github.com/users/mihajenko/orgs","repos_url":"https://api.github.com/users/mihajenko/repos","events_url":"https://api.github.com/users/mihajenko/events{/privacy}","received_events_url":"https://api.github.com/users/mihajenko/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/758764509","html_url":"https://github.com/beringresearch/ivis/issues/66#issuecomment-758764509","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/66","id":758764509,"node_id":"MDEyOklzc3VlQ29tbWVudDc1ODc2NDUwOQ==","user":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"created_at":"2021-01-12T16:13:11Z","updated_at":"2021-01-12T16:25:54Z","author_association":"COLLABORATOR","body":"Hi, since this issue was opened there have been some relevant changes to ivis.\r\n\r\n1) It is now possible to pass custom loss functions to ivis as requested in this issue. The simplest way to do this is to pass the desired _callable_ to the `distance` kwarg when constructing the ivis object. (Alternatively you can register a loss function globally using the `register_loss` function in the ivis.nn.losses module and reference by name string).\r\n\r\n2) The neighbour retrieval component of ivis is now swappable to any arbitrary implementation by providing an instance of the `collections.abc.Sequence` class to the `neighbour_matrix` kwarg. To implement the methods of the Sequence class, this object must have a `__len__` method that matches the number of rows in dataset, and a `__getitem__` method that returns a list of neighbour indices for the row with the given index. Check the `ivis.data.neighbour_retrieval` module for examples.\r\n   - For example, the neighbour_matrix argument could be a 2D numpy array (rows x neighbours).\r\n\r\n\r\nHopefully these changes make it easier to use your own classes to customize the behaviour of ivis.","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/758764509/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false}},{"id":4239400315,"node_id":"MDExOkNsb3NlZEV2ZW50NDIzOTQwMDMxNQ==","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/4239400315","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-01-22T16:33:01Z","state_reason":null,"performed_via_github_app":null}]