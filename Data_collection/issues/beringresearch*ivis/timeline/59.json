[{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/579211766","html_url":"https://github.com/beringresearch/ivis/issues/59#issuecomment-579211766","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/59","id":579211766,"node_id":"MDEyOklzc3VlQ29tbWVudDU3OTIxMTc2Ng==","user":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"created_at":"2020-01-28T11:58:19Z","updated_at":"2020-01-28T11:58:19Z","author_association":"COLLABORATOR","body":"Hi thanks for raising this, we agree that this would be a useful feature to have. We are looking into whether we could support the use of generators with ivis.","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/579211766/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/585186758","html_url":"https://github.com/beringresearch/ivis/issues/59#issuecomment-585186758","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/59","id":585186758,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NTE4Njc1OA==","user":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"created_at":"2020-02-12T12:39:46Z","updated_at":"2020-02-12T12:39:46Z","author_association":"COLLABORATOR","body":"Just as an update to this, using a generator to train ivis is difficult since the triplet sampling algorithm may need to retrieve KNNs or negative points that are not in the batch - we normally index the dataset to retrieve these efficiently, but a generator can only be iterated over.\r\n\r\nWe are exploring other potential ways we could make training on out-of-memory data easier, so will leave this issue open as we look into it.","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/585186758/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/585239627","html_url":"https://github.com/beringresearch/ivis/issues/59#issuecomment-585239627","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/59","id":585239627,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NTIzOTYyNw==","user":{"login":"candalfigomoro","id":50733646,"node_id":"MDQ6VXNlcjUwNzMzNjQ2","avatar_url":"https://avatars.githubusercontent.com/u/50733646?v=4","gravatar_id":"","url":"https://api.github.com/users/candalfigomoro","html_url":"https://github.com/candalfigomoro","followers_url":"https://api.github.com/users/candalfigomoro/followers","following_url":"https://api.github.com/users/candalfigomoro/following{/other_user}","gists_url":"https://api.github.com/users/candalfigomoro/gists{/gist_id}","starred_url":"https://api.github.com/users/candalfigomoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/candalfigomoro/subscriptions","organizations_url":"https://api.github.com/users/candalfigomoro/orgs","repos_url":"https://api.github.com/users/candalfigomoro/repos","events_url":"https://api.github.com/users/candalfigomoro/events{/privacy}","received_events_url":"https://api.github.com/users/candalfigomoro/received_events","type":"User","site_admin":false},"created_at":"2020-02-12T14:46:30Z","updated_at":"2020-02-12T14:47:11Z","author_association":"CONTRIBUTOR","body":"@Szubie \r\nThank you very much for the update.\r\n\r\nAs a side note, in https://bering-ivis.readthedocs.io/en/latest/oom_datasets.html I read:\r\n\r\n> When training on a h5 dataset, we recommend to use the shuffle_mode='batch' option in the fit method. This will speed up the training process by pulling a batch of data from disk and shuffling tethat batch, rather than shuffling across the whole dataset.\r\n\r\nI don't know if this is a custom training strategy, but if you use the keras' fit() method, my understanding is that \"batch shuffle\" doesn't shuffle rows inside batches, but it shuffles the batches order (please correct me if I'm wrong).\r\n","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/585239627/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"candalfigomoro","id":50733646,"node_id":"MDQ6VXNlcjUwNzMzNjQ2","avatar_url":"https://avatars.githubusercontent.com/u/50733646?v=4","gravatar_id":"","url":"https://api.github.com/users/candalfigomoro","html_url":"https://github.com/candalfigomoro","followers_url":"https://api.github.com/users/candalfigomoro/followers","following_url":"https://api.github.com/users/candalfigomoro/following{/other_user}","gists_url":"https://api.github.com/users/candalfigomoro/gists{/gist_id}","starred_url":"https://api.github.com/users/candalfigomoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/candalfigomoro/subscriptions","organizations_url":"https://api.github.com/users/candalfigomoro/orgs","repos_url":"https://api.github.com/users/candalfigomoro/repos","events_url":"https://api.github.com/users/candalfigomoro/events{/privacy}","received_events_url":"https://api.github.com/users/candalfigomoro/received_events","type":"User","site_admin":false}},{"id":3031096175,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzAzMTA5NjE3NQ==","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/3031096175","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-02-12T14:46:30Z","performed_via_github_app":null},{"id":3031096178,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMwMzEwOTYxNzg=","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/3031096178","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-02-12T14:46:30Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/585261143","html_url":"https://github.com/beringresearch/ivis/issues/59#issuecomment-585261143","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/59","id":585261143,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NTI2MTE0Mw==","user":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"created_at":"2020-02-12T15:29:57Z","updated_at":"2020-02-12T15:30:23Z","author_association":"COLLABORATOR","body":"> I don't know if this is a custom training strategy, but if you use the keras' fit() method, my understanding is that \"batch shuffle\" doesn't shuffle rows inside batches, but it shuffles the batches order (please correct me if I'm wrong).\r\n\r\nThat's right. \r\n\r\nEach triplet is made up of three data points: 1) the anchor, 2) the positive example (one of the k-nearest neighbors), and 3) a negative example. The keras `fit` method only shuffles the anchors -  when using the 'batch' shuffle mode, anchors are shuffled within a batch. \r\n\r\nBut each anchor data point then needs to be combined with a positive and negative example in order to create a triplet. And these points may be in a completely different part of the data, outside of the current batch of 'anchors'. \r\n\r\nFor each anchor, we can retrieve the index of a positive example using the AnnoyIndex, but to actually retrieve the data at that index we need an indexable data structure (at least at the moment).\r\n\r\n","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/585261143/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/758794141","html_url":"https://github.com/beringresearch/ivis/issues/59#issuecomment-758794141","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/59","id":758794141,"node_id":"MDEyOklzc3VlQ29tbWVudDc1ODc5NDE0MQ==","user":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"created_at":"2021-01-12T16:56:12Z","updated_at":"2023-01-11T11:21:20Z","author_association":"COLLABORATOR","body":"Hi, we have recently introduced initial support for training on arbitrary out-of-memory datasets using ivis by formalizing the interface that input data must conform to.\r\n\r\nIvis will accept `ivis.data.sequence.IndexableDataset` instances in its `fit`, `transform` and `fit_transform` methods. An _IndexableDataset_ inherits from `collections.abc.Sequence` and defines one new method, `shape`, that takes no arguments and returns the expected shape of the dataset (for example, [rows, columns]).\r\n\r\nThe `collections.abc.Sequence` class requires `__len__` (returns number of rows) and `__getitem__` (returns data at row index) to be implemented. When implementing the `__getitem__` method we can customize how the data is retrieved to behave in any way desired. \r\n\r\nAs an example, we have provided a `ivis.data.sequence.ImageDataset` class for loading images from disk for reference, which reads image files from disk into memory when indexed.\r\n\r\n\r\nThis is still quite a new feature and we may enhance it based on the feedback we get, so any thoughts on your experience with this would be valued if you end up trying it. We also want to, in time, expand the classes we provide to cover some common use-cases.\r\n","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/758794141/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/1378611999","html_url":"https://github.com/beringresearch/ivis/issues/59#issuecomment-1378611999","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/59","id":1378611999,"node_id":"IC_kwDOCJ2sz85SK_Mf","user":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"created_at":"2023-01-11T11:31:10Z","updated_at":"2023-01-11T11:31:10Z","author_association":"COLLABORATOR","body":"As an update to this issue, support for data stored outside of memory has been improved with the new `get_batch` method which will be called in preference to `__getitem__` if possible. Fetching full batches of data at once can greatly improve performance when running ivis on an out-of-memory data store.\r\n\r\nFor an example of using ivis on data stored in a sqlite database we've added the following jupyter notebook:\r\nhttps://github.com/beringresearch/ivis/blob/master/notebooks/using_ivis_with_sqlite.ipynb\r\n\r\nBy using `get_batch` the SqliteDB class is able to get all the data required for an ivis training step in a single SQL query. The same techniques used in the notebook can be used to adapt any out-of-memory dataset with minimal code.\r\n\r\nClosing this issue now as it has now been addressed.","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/1378611999/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false}},{"id":8200749864,"node_id":"CE_lADOCJ2sz84hH1vbzwAAAAHozYMo","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/8200749864","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2023-01-11T11:31:10Z","state_reason":null,"performed_via_github_app":null}]