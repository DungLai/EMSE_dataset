[{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/614760932","html_url":"https://github.com/beringresearch/ivis/issues/65#issuecomment-614760932","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/65","id":614760932,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNDc2MDkzMg==","user":{"login":"idroz","id":12413294,"node_id":"MDQ6VXNlcjEyNDEzMjk0","avatar_url":"https://avatars.githubusercontent.com/u/12413294?v=4","gravatar_id":"","url":"https://api.github.com/users/idroz","html_url":"https://github.com/idroz","followers_url":"https://api.github.com/users/idroz/followers","following_url":"https://api.github.com/users/idroz/following{/other_user}","gists_url":"https://api.github.com/users/idroz/gists{/gist_id}","starred_url":"https://api.github.com/users/idroz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/idroz/subscriptions","organizations_url":"https://api.github.com/users/idroz/orgs","repos_url":"https://api.github.com/users/idroz/repos","events_url":"https://api.github.com/users/idroz/events{/privacy}","received_events_url":"https://api.github.com/users/idroz/received_events","type":"User","site_admin":false},"created_at":"2020-04-16T16:34:28Z","updated_at":"2020-04-16T16:34:28Z","author_association":"COLLABORATOR","body":"Hi - glad you're enjoying ivis!\r\n\r\nWe've been noticing some weird threading issues that relate to the latest tensorflow 2.1. @Szubie is working on a larger fix to address this via data generators.\r\n\r\nMeanwhile, could you try downgrading tensorflow to version 1.15 and let us know if that solves your hanging thread issue? Since R wrapper for ivis installs it into a virtualenv, the steps to downgrade would be:\r\n\r\n1. From R REPL find out where your local virtual environments are stored:\r\n```R\r\n> reticulate::virtualenv_root()\r\n```\r\n\r\n2. Assuming that your venvs are in `~/.virtualenvs`, activate the `ivis` environment from command line:\r\n```bash\r\n$ source ~/.virtualenvs/ivis/bin/activate\r\n```\r\n\r\n3. Finally, downgrade tensorflow to pip:\r\n```bash\r\n$ python -m pip install tensorflow==1.15\r\n```\r\n\r\nAfter this restart R and reload the ivis package.","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/614760932/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"idroz","id":12413294,"node_id":"MDQ6VXNlcjEyNDEzMjk0","avatar_url":"https://avatars.githubusercontent.com/u/12413294?v=4","gravatar_id":"","url":"https://api.github.com/users/idroz","html_url":"https://github.com/idroz","followers_url":"https://api.github.com/users/idroz/followers","following_url":"https://api.github.com/users/idroz/following{/other_user}","gists_url":"https://api.github.com/users/idroz/gists{/gist_id}","starred_url":"https://api.github.com/users/idroz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/idroz/subscriptions","organizations_url":"https://api.github.com/users/idroz/orgs","repos_url":"https://api.github.com/users/idroz/repos","events_url":"https://api.github.com/users/idroz/events{/privacy}","received_events_url":"https://api.github.com/users/idroz/received_events","type":"User","site_admin":false}},{"id":3240790594,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI0MDc5MDU5NA==","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/3240790594","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-16T16:34:28Z","performed_via_github_app":null},{"id":3240790597,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyNDA3OTA1OTc=","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/3240790597","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-16T16:34:28Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/614777505","html_url":"https://github.com/beringresearch/ivis/issues/65#issuecomment-614777505","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/65","id":614777505,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNDc3NzUwNQ==","user":{"login":"sheffe","id":3778733,"node_id":"MDQ6VXNlcjM3Nzg3MzM=","avatar_url":"https://avatars.githubusercontent.com/u/3778733?v=4","gravatar_id":"","url":"https://api.github.com/users/sheffe","html_url":"https://github.com/sheffe","followers_url":"https://api.github.com/users/sheffe/followers","following_url":"https://api.github.com/users/sheffe/following{/other_user}","gists_url":"https://api.github.com/users/sheffe/gists{/gist_id}","starred_url":"https://api.github.com/users/sheffe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sheffe/subscriptions","organizations_url":"https://api.github.com/users/sheffe/orgs","repos_url":"https://api.github.com/users/sheffe/repos","events_url":"https://api.github.com/users/sheffe/events{/privacy}","received_events_url":"https://api.github.com/users/sheffe/received_events","type":"User","site_admin":false},"created_at":"2020-04-16T17:05:37Z","updated_at":"2020-04-16T17:05:37Z","author_association":"CONTRIBUTOR","body":"@idroz thanks for the fix and clear instructions here. It's now working as expected -- I've run a few training iterations and don't see any ongoing weird behavior now.\r\n\r\nI'm not sure if this is helpful for further diagnosis, but the extent of ongoing resource usage seemed correlated to the overall complexity of the fit() call -- increasing data size or increasing `ntrees`/`search_k`/`n_epochs_without_progress` tended to boost the level of after-termination resource consumption. I don't have any good metrics for that correlation, but it seemed consistent over ~200 training sessions. All CPU, no GPU.\r\n\r\nAnother observation: before downgrading tensorflow to 1.15 per your suggestion, I'd get this error `W tensorflow/core/kernels/data/generator_dataset_op.cc:103] Error occurred when finalizing GeneratorDataset iterator: Cancelled: Operation was cancelled` with every training epoch. That message has disappeared with the downgrade. Comparing embedding results before/after the downgrade, I can't see any material effect on the output or metrics like training speed.\r\n\r\n(You've solved my problem (thanks!) but I'll leave the issue close decision to you, since sounds like it ties to more systematic changes.)","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/614777505/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sheffe","id":3778733,"node_id":"MDQ6VXNlcjM3Nzg3MzM=","avatar_url":"https://avatars.githubusercontent.com/u/3778733?v=4","gravatar_id":"","url":"https://api.github.com/users/sheffe","html_url":"https://github.com/sheffe","followers_url":"https://api.github.com/users/sheffe/followers","following_url":"https://api.github.com/users/sheffe/following{/other_user}","gists_url":"https://api.github.com/users/sheffe/gists{/gist_id}","starred_url":"https://api.github.com/users/sheffe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sheffe/subscriptions","organizations_url":"https://api.github.com/users/sheffe/orgs","repos_url":"https://api.github.com/users/sheffe/repos","events_url":"https://api.github.com/users/sheffe/events{/privacy}","received_events_url":"https://api.github.com/users/sheffe/received_events","type":"User","site_admin":false}},{"id":3240910782,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI0MDkxMDc4Mg==","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/3240910782","actor":{"login":"idroz","id":12413294,"node_id":"MDQ6VXNlcjEyNDEzMjk0","avatar_url":"https://avatars.githubusercontent.com/u/12413294?v=4","gravatar_id":"","url":"https://api.github.com/users/idroz","html_url":"https://github.com/idroz","followers_url":"https://api.github.com/users/idroz/followers","following_url":"https://api.github.com/users/idroz/following{/other_user}","gists_url":"https://api.github.com/users/idroz/gists{/gist_id}","starred_url":"https://api.github.com/users/idroz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/idroz/subscriptions","organizations_url":"https://api.github.com/users/idroz/orgs","repos_url":"https://api.github.com/users/idroz/repos","events_url":"https://api.github.com/users/idroz/events{/privacy}","received_events_url":"https://api.github.com/users/idroz/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-16T17:05:37Z","performed_via_github_app":null},{"id":3240910784,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyNDA5MTA3ODQ=","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/3240910784","actor":{"login":"idroz","id":12413294,"node_id":"MDQ6VXNlcjEyNDEzMjk0","avatar_url":"https://avatars.githubusercontent.com/u/12413294?v=4","gravatar_id":"","url":"https://api.github.com/users/idroz","html_url":"https://github.com/idroz","followers_url":"https://api.github.com/users/idroz/followers","following_url":"https://api.github.com/users/idroz/following{/other_user}","gists_url":"https://api.github.com/users/idroz/gists{/gist_id}","starred_url":"https://api.github.com/users/idroz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/idroz/subscriptions","organizations_url":"https://api.github.com/users/idroz/orgs","repos_url":"https://api.github.com/users/idroz/repos","events_url":"https://api.github.com/users/idroz/events{/privacy}","received_events_url":"https://api.github.com/users/idroz/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-16T17:05:37Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/614780532","html_url":"https://github.com/beringresearch/ivis/issues/65#issuecomment-614780532","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/65","id":614780532,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNDc4MDUzMg==","user":{"login":"idroz","id":12413294,"node_id":"MDQ6VXNlcjEyNDEzMjk0","avatar_url":"https://avatars.githubusercontent.com/u/12413294?v=4","gravatar_id":"","url":"https://api.github.com/users/idroz","html_url":"https://github.com/idroz","followers_url":"https://api.github.com/users/idroz/followers","following_url":"https://api.github.com/users/idroz/following{/other_user}","gists_url":"https://api.github.com/users/idroz/gists{/gist_id}","starred_url":"https://api.github.com/users/idroz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/idroz/subscriptions","organizations_url":"https://api.github.com/users/idroz/orgs","repos_url":"https://api.github.com/users/idroz/repos","events_url":"https://api.github.com/users/idroz/events{/privacy}","received_events_url":"https://api.github.com/users/idroz/received_events","type":"User","site_admin":false},"created_at":"2020-04-16T17:11:20Z","updated_at":"2020-04-16T17:12:30Z","author_association":"COLLABORATOR","body":"Glad it worked. \r\n\r\nThe issue you describe most certainly relates to a documented tensorflow problem: https://github.com/tensorflow/tensorflow/issues/35100. \r\n\r\nNightly TF build seems to have fixed it, so hoping that the next stable TF release will be able to sort it out.\r\n\r\nWill ping here when either data generator solves the problem or TF team pushes a working update!","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/614780532/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"idroz","id":12413294,"node_id":"MDQ6VXNlcjEyNDEzMjk0","avatar_url":"https://avatars.githubusercontent.com/u/12413294?v=4","gravatar_id":"","url":"https://api.github.com/users/idroz","html_url":"https://github.com/idroz","followers_url":"https://api.github.com/users/idroz/followers","following_url":"https://api.github.com/users/idroz/following{/other_user}","gists_url":"https://api.github.com/users/idroz/gists{/gist_id}","starred_url":"https://api.github.com/users/idroz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/idroz/subscriptions","organizations_url":"https://api.github.com/users/idroz/orgs","repos_url":"https://api.github.com/users/idroz/repos","events_url":"https://api.github.com/users/idroz/events{/privacy}","received_events_url":"https://api.github.com/users/idroz/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/628093317","html_url":"https://github.com/beringresearch/ivis/issues/65#issuecomment-628093317","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/65","id":628093317,"node_id":"MDEyOklzc3VlQ29tbWVudDYyODA5MzMxNw==","user":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"created_at":"2020-05-13T16:12:28Z","updated_at":"2020-05-13T16:12:28Z","author_association":"COLLABORATOR","body":"Hi, we have pushed a new update to ivis here: https://github.com/beringresearch/ivis/commit/ecaf4cc31c93a0bf5cba7aa90c3d73c74bf7f6b0 \r\n\r\nThis update stops TensorFlow 2.1 from spawning new Threads without closing them. This takes care of the warning error seen on every epoch of training, and should also fix the issue you've been seeing in R with the subprocess not terminating correctly.\r\n\r\nPlease give it a go, hopefully it solves the issues you've been encountering!","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/628093317/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false}},{"id":3433040575,"node_id":"MDExOkNsb3NlZEV2ZW50MzQzMzA0MDU3NQ==","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/3433040575","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-06-11T08:22:22Z","state_reason":null,"performed_via_github_app":null}]