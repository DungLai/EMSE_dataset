[{"id":4943662258,"node_id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDk0MzY2MjI1OA==","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/4943662258","actor":{"login":"imatheussm","id":4311541,"node_id":"MDQ6VXNlcjQzMTE1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/4311541?v=4","gravatar_id":"","url":"https://api.github.com/users/imatheussm","html_url":"https://github.com/imatheussm","followers_url":"https://api.github.com/users/imatheussm/followers","following_url":"https://api.github.com/users/imatheussm/following{/other_user}","gists_url":"https://api.github.com/users/imatheussm/gists{/gist_id}","starred_url":"https://api.github.com/users/imatheussm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imatheussm/subscriptions","organizations_url":"https://api.github.com/users/imatheussm/orgs","repos_url":"https://api.github.com/users/imatheussm/repos","events_url":"https://api.github.com/users/imatheussm/events{/privacy}","received_events_url":"https://api.github.com/users/imatheussm/received_events","type":"User","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2021-06-27T08:02:40Z","rename":{"from":"Model not fitted error after caching and reloading fitted `Ivis` instance","to":"`NotFittedError` after caching and reloading fitted `Ivis` instance"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/869241679","html_url":"https://github.com/beringresearch/ivis/issues/101#issuecomment-869241679","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/101","id":869241679,"node_id":"MDEyOklzc3VlQ29tbWVudDg2OTI0MTY3OQ==","user":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"created_at":"2021-06-27T23:40:07Z","updated_at":"2021-06-27T23:40:07Z","author_association":"COLLABORATOR","body":"Thanks for reporting this.\r\n\r\nI will look into making Ivis models serializable using pickle, is sounds like a useful feature if we can do it. Hopefully that will solve the issues you're encountering.","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/869241679/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/869252815","html_url":"https://github.com/beringresearch/ivis/issues/101#issuecomment-869252815","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/101","id":869252815,"node_id":"MDEyOklzc3VlQ29tbWVudDg2OTI1MjgxNQ==","user":{"login":"imatheussm","id":4311541,"node_id":"MDQ6VXNlcjQzMTE1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/4311541?v=4","gravatar_id":"","url":"https://api.github.com/users/imatheussm","html_url":"https://github.com/imatheussm","followers_url":"https://api.github.com/users/imatheussm/followers","following_url":"https://api.github.com/users/imatheussm/following{/other_user}","gists_url":"https://api.github.com/users/imatheussm/gists{/gist_id}","starred_url":"https://api.github.com/users/imatheussm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imatheussm/subscriptions","organizations_url":"https://api.github.com/users/imatheussm/orgs","repos_url":"https://api.github.com/users/imatheussm/repos","events_url":"https://api.github.com/users/imatheussm/events{/privacy}","received_events_url":"https://api.github.com/users/imatheussm/received_events","type":"User","site_admin":false},"created_at":"2021-06-28T00:35:11Z","updated_at":"2021-06-28T00:35:11Z","author_association":"CONTRIBUTOR","body":"I was coding a solution here, which consisted in renaming the currently defined `Ivis.__getstate__()` to `Ivis._get_json()` and creating new `Ivis.__getstate__()` and `Ivis.__setstate__()` methods. The solution consisted in the following:\r\n\r\n- In `Ivis.__getstate__()`, the internal dictionary `state` would be obtained. However, for the `encoder_`, `model_`, `neighbour_matrix_`, and `supervised_model_` attributes, the following procedure would be adopted: `.save()` would be called for each of them, generating a `annoy.index` file for `neighbour_matrix_` and `.h5` files for the rest. Then, using the built-in `base64` module, these files would be encoded into a Base64 string, which would be attributed to the respective parameters.\r\n- In `Ivis.__setstate__()`, the same four parameters described above would be checked. If present, `base64` would be used to decode them into the binary files they originally were. Then, they would be used to load the original parameters back into their respective attributes.\r\n\r\nHowever, I stumbled in a problem: when calling `Ivis.neighbour_matrix_.save(<path>)`, or even `Ivis.neighbour_matrix_.index.save(<path>)`, no file was produced, regardless of path type (absolute or relative) or file name. I am currently assuming this is an `annoy`-related issue.\r\n\r\nI am just posting this in case this reasoning is helpful to you.","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/869252815/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"imatheussm","id":4311541,"node_id":"MDQ6VXNlcjQzMTE1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/4311541?v=4","gravatar_id":"","url":"https://api.github.com/users/imatheussm","html_url":"https://github.com/imatheussm","followers_url":"https://api.github.com/users/imatheussm/followers","following_url":"https://api.github.com/users/imatheussm/following{/other_user}","gists_url":"https://api.github.com/users/imatheussm/gists{/gist_id}","starred_url":"https://api.github.com/users/imatheussm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imatheussm/subscriptions","organizations_url":"https://api.github.com/users/imatheussm/orgs","repos_url":"https://api.github.com/users/imatheussm/repos","events_url":"https://api.github.com/users/imatheussm/events{/privacy}","received_events_url":"https://api.github.com/users/imatheussm/received_events","type":"User","site_admin":false}},{"id":5400249778,"node_id":"REFE_lADOCJ2sz843fABfzwAAAAFB4UWy","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/5400249778","actor":{"login":"imatheussm","id":4311541,"node_id":"MDQ6VXNlcjQzMTE1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/4311541?v=4","gravatar_id":"","url":"https://api.github.com/users/imatheussm","html_url":"https://github.com/imatheussm","followers_url":"https://api.github.com/users/imatheussm/followers","following_url":"https://api.github.com/users/imatheussm/following{/other_user}","gists_url":"https://api.github.com/users/imatheussm/gists{/gist_id}","starred_url":"https://api.github.com/users/imatheussm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imatheussm/subscriptions","organizations_url":"https://api.github.com/users/imatheussm/orgs","repos_url":"https://api.github.com/users/imatheussm/repos","events_url":"https://api.github.com/users/imatheussm/events{/privacy}","received_events_url":"https://api.github.com/users/imatheussm/received_events","type":"User","site_admin":false},"event":"referenced","commit_id":"c80bdad10f3afc67eda763d48a630d5489480afd","commit_url":"https://api.github.com/repos/imatheussm/ivis/commits/c80bdad10f3afc67eda763d48a630d5489480afd","created_at":"2021-10-03T19:07:38Z","performed_via_github_app":null},{"actor":{"login":"imatheussm","id":4311541,"node_id":"MDQ6VXNlcjQzMTE1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/4311541?v=4","gravatar_id":"","url":"https://api.github.com/users/imatheussm","html_url":"https://github.com/imatheussm","followers_url":"https://api.github.com/users/imatheussm/followers","following_url":"https://api.github.com/users/imatheussm/following{/other_user}","gists_url":"https://api.github.com/users/imatheussm/gists{/gist_id}","starred_url":"https://api.github.com/users/imatheussm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imatheussm/subscriptions","organizations_url":"https://api.github.com/users/imatheussm/orgs","repos_url":"https://api.github.com/users/imatheussm/repos","events_url":"https://api.github.com/users/imatheussm/events{/privacy}","received_events_url":"https://api.github.com/users/imatheussm/received_events","type":"User","site_admin":false},"created_at":"2021-10-03T20:00:46Z","updated_at":"2021-10-03T20:00:46Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/106","repository_url":"https://api.github.com/repos/beringresearch/ivis","labels_url":"https://api.github.com/repos/beringresearch/ivis/issues/106/labels{/name}","comments_url":"https://api.github.com/repos/beringresearch/ivis/issues/106/comments","events_url":"https://api.github.com/repos/beringresearch/ivis/issues/106/events","html_url":"https://github.com/beringresearch/ivis/pull/106","id":1014523138,"node_id":"PR_kwDOCJ2sz84sm8KA","number":106,"title":"Make `ivis.Ivis` picklable","user":{"login":"imatheussm","id":4311541,"node_id":"MDQ6VXNlcjQzMTE1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/4311541?v=4","gravatar_id":"","url":"https://api.github.com/users/imatheussm","html_url":"https://github.com/imatheussm","followers_url":"https://api.github.com/users/imatheussm/followers","following_url":"https://api.github.com/users/imatheussm/following{/other_user}","gists_url":"https://api.github.com/users/imatheussm/gists{/gist_id}","starred_url":"https://api.github.com/users/imatheussm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imatheussm/subscriptions","organizations_url":"https://api.github.com/users/imatheussm/orgs","repos_url":"https://api.github.com/users/imatheussm/repos","events_url":"https://api.github.com/users/imatheussm/events{/privacy}","received_events_url":"https://api.github.com/users/imatheussm/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-10-03T20:00:46Z","updated_at":"2021-10-06T21:31:24Z","closed_at":"2021-10-06T21:31:23Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"repository":{"id":144551119,"node_id":"MDEwOlJlcG9zaXRvcnkxNDQ1NTExMTk=","name":"ivis","full_name":"beringresearch/ivis","private":false,"owner":{"login":"beringresearch","id":14840322,"node_id":"MDQ6VXNlcjE0ODQwMzIy","avatar_url":"https://avatars.githubusercontent.com/u/14840322?v=4","gravatar_id":"","url":"https://api.github.com/users/beringresearch","html_url":"https://github.com/beringresearch","followers_url":"https://api.github.com/users/beringresearch/followers","following_url":"https://api.github.com/users/beringresearch/following{/other_user}","gists_url":"https://api.github.com/users/beringresearch/gists{/gist_id}","starred_url":"https://api.github.com/users/beringresearch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/beringresearch/subscriptions","organizations_url":"https://api.github.com/users/beringresearch/orgs","repos_url":"https://api.github.com/users/beringresearch/repos","events_url":"https://api.github.com/users/beringresearch/events{/privacy}","received_events_url":"https://api.github.com/users/beringresearch/received_events","type":"User","site_admin":false},"html_url":"https://github.com/beringresearch/ivis","description":"Dimensionality reduction in very large datasets using Siamese Networks","fork":false,"url":"https://api.github.com/repos/beringresearch/ivis","forks_url":"https://api.github.com/repos/beringresearch/ivis/forks","keys_url":"https://api.github.com/repos/beringresearch/ivis/keys{/key_id}","collaborators_url":"https://api.github.com/repos/beringresearch/ivis/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/beringresearch/ivis/teams","hooks_url":"https://api.github.com/repos/beringresearch/ivis/hooks","issue_events_url":"https://api.github.com/repos/beringresearch/ivis/issues/events{/number}","events_url":"https://api.github.com/repos/beringresearch/ivis/events","assignees_url":"https://api.github.com/repos/beringresearch/ivis/assignees{/user}","branches_url":"https://api.github.com/repos/beringresearch/ivis/branches{/branch}","tags_url":"https://api.github.com/repos/beringresearch/ivis/tags","blobs_url":"https://api.github.com/repos/beringresearch/ivis/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/beringresearch/ivis/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/beringresearch/ivis/git/refs{/sha}","trees_url":"https://api.github.com/repos/beringresearch/ivis/git/trees{/sha}","statuses_url":"https://api.github.com/repos/beringresearch/ivis/statuses/{sha}","languages_url":"https://api.github.com/repos/beringresearch/ivis/languages","stargazers_url":"https://api.github.com/repos/beringresearch/ivis/stargazers","contributors_url":"https://api.github.com/repos/beringresearch/ivis/contributors","subscribers_url":"https://api.github.com/repos/beringresearch/ivis/subscribers","subscription_url":"https://api.github.com/repos/beringresearch/ivis/subscription","commits_url":"https://api.github.com/repos/beringresearch/ivis/commits{/sha}","git_commits_url":"https://api.github.com/repos/beringresearch/ivis/git/commits{/sha}","comments_url":"https://api.github.com/repos/beringresearch/ivis/comments{/number}","issue_comment_url":"https://api.github.com/repos/beringresearch/ivis/issues/comments{/number}","contents_url":"https://api.github.com/repos/beringresearch/ivis/contents/{+path}","compare_url":"https://api.github.com/repos/beringresearch/ivis/compare/{base}...{head}","merges_url":"https://api.github.com/repos/beringresearch/ivis/merges","archive_url":"https://api.github.com/repos/beringresearch/ivis/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/beringresearch/ivis/downloads","issues_url":"https://api.github.com/repos/beringresearch/ivis/issues{/number}","pulls_url":"https://api.github.com/repos/beringresearch/ivis/pulls{/number}","milestones_url":"https://api.github.com/repos/beringresearch/ivis/milestones{/number}","notifications_url":"https://api.github.com/repos/beringresearch/ivis/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/beringresearch/ivis/labels{/name}","releases_url":"https://api.github.com/repos/beringresearch/ivis/releases{/id}","deployments_url":"https://api.github.com/repos/beringresearch/ivis/deployments","created_at":"2018-08-13T08:31:01Z","updated_at":"2023-01-17T15:00:20Z","pushed_at":"2023-01-11T12:25:50Z","git_url":"git://github.com/beringresearch/ivis.git","ssh_url":"git@github.com:beringresearch/ivis.git","clone_url":"https://github.com/beringresearch/ivis.git","svn_url":"https://github.com/beringresearch/ivis","homepage":"http://bering-ivis.readthedocs.io","size":36707,"stargazers_count":286,"watchers_count":286,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":37,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["data-visualization","dimensionality-reduction","machine-learning","neural-network","siamese-neural-network"],"visibility":"public","forks":37,"open_issues":2,"watchers":286,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/beringresearch/ivis/pulls/106","html_url":"https://github.com/beringresearch/ivis/pull/106","diff_url":"https://github.com/beringresearch/ivis/pull/106.diff","patch_url":"https://github.com/beringresearch/ivis/pull/106.patch","merged_at":"2021-10-06T21:31:23Z"},"body":"# The issue\r\n\r\nSee #101.\r\n\r\n# The proposed changes\r\n\r\nThis pull request refactors `Ivis.__getstate__()` into `Ivis.__getstate_old__()` and creates new `Ivis.__getstate__()` and `Ivis.__setstate__()` methods. They work similarly to what is seen in `Ivis.save_model()` and `Ivis.load_model()` in terms of the information that is saved; however, they differ in how they do it. The new methods encode the generated files into `base85` strings and save said strings within the objectâ€”in other words, the generated files are effectively saved within the object.\r\n\r\nThis approach comes with the following advantages:\r\n\r\n- It makes `Ivis` picklable, thus enabling the storage of a produced model under a single file written in a well-known format within the Python community.\r\n- It closes #101 and increases compatibility with the `scikit-learn` module, particularly with `sklearn.model_selection.GridSearchCV` and `sklearn.base.clone()`, which is used within `sklearn.model_selection.GridSearchCV` and `sklearn.pipeline.Pipeline`.\r\n\r\nThe only caveat is the same one seen when using the existing `Ivis.save_model()` and `Ivis.load_model()`: whenever a `tensorflow`/`keras` model is saved by using the `.save()` method, the following warning is issued:\r\n\r\n```\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\n```\r\n\r\nThis warning is issued two times per save/load call (when `Ivis.model_.layers[3]` and `Ivis.supervised_model_` are saved/loaded), which means in circumstances wherein these commands are frequently used result this message being spammed throughout the execution, as demonstrated below.\r\n\r\n# Minimal reproducible examples\r\n\r\nThe environment used in these examples is the same described in #101.\r\n\r\n## Example with `sklearn.pipeline.Pipeline`\r\n\r\nThe same code seen in #101 is executed. The execution is successful, but the log is polluted by compilation warnings related with the aforementioned issue.\r\n\r\n```\r\nFitting 10 folds for each of 2 candidates, totalling 20 fits\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\n[CV 1/10] END classify=RandomForestClassifier(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=1.000, test=1.000) total time=   6.2s\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\n[CV 2/10] END classify=RandomForestClassifier(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=1.000, test=1.000) total time=   4.0s\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\n[CV 3/10] END classify=RandomForestClassifier(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=1.000, test=0.933) total time=   8.0s\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\n[CV 4/10] END classify=RandomForestClassifier(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=1.000, test=0.933) total time=   4.8s\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\n[CV 5/10] END classify=RandomForestClassifier(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=1.000, test=0.733) total time=   6.3s\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\n[CV 6/10] END classify=RandomForestClassifier(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=1.000, test=0.867) total time=   3.0s\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\n[CV 7/10] END classify=RandomForestClassifier(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=1.000, test=1.000) total time=   2.8s\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\n[CV 8/10] END classify=RandomForestClassifier(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=1.000, test=0.800) total time=   3.7s\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\n[CV 9/10] END classify=RandomForestClassifier(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=1.000, test=0.733) total time=   3.8s\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\n[CV 10/10] END classify=RandomForestClassifier(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=1.000, test=0.733) total time=   3.0s\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\n[CV 1/10] END classify=SVC(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=0.948, test=1.000) total time=   0.5s\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\n[CV 2/10] END classify=SVC(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=0.933, test=1.000) total time=   0.4s\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\n[CV 3/10] END classify=SVC(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=0.941, test=1.000) total time=   0.4s\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\nWARNING:tensorflow:5 out of the last 15 calls to <function Model.make_predict_function.<locals>.predict_function at 0x000002269499F4C0> triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has experimental_relax_shapes=True option that relaxes argument shapes that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.\r\n[CV 4/10] END classify=SVC(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=0.941, test=0.933) total time=   0.4s\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\nWARNING:tensorflow:5 out of the last 13 calls to <function Model.make_predict_function.<locals>.predict_function at 0x0000022696CB5E50> triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has experimental_relax_shapes=True option that relaxes argument shapes that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.\r\n[CV 5/10] END classify=SVC(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=0.948, test=0.800) total time=   0.3s\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\n[CV 6/10] END classify=SVC(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=0.970, test=0.800) total time=   0.4s\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\n[CV 7/10] END classify=SVC(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=0.933, test=1.000) total time=   0.4s\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\n[CV 8/10] END classify=SVC(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=0.919, test=0.933) total time=   0.4s\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\n[CV 9/10] END classify=SVC(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=0.978, test=0.733) total time=   0.4s\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\n[CV 10/10] END classify=SVC(), classify__random_state=2021, project=Ivis(verbose=0), project__k=15;, score=(train=0.867, test=0.400) total time=   0.3s\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\n```\r\n\r\n## Example without `sklearn.pipeline.Pipeline`\r\n\r\nThis example demonstrates that the proposed solution is working by means of a simpler script while also showing the aforementioned warnings. It is also executed successfully.\r\n\r\n### Script\r\n\r\n```\r\nimport ivis\r\nimport joblib\r\n\r\nfrom sklearn import datasets, model_selection\r\n\r\nprint(f\"Loading and splitting the Iris Flower data set...\")\r\nX, y = datasets.load_iris(return_X_y=True)\r\nX_train, X_test, y_train, y_test = model_selection.train_test_split(X, y, test_size=0.33, random_state=42)\r\n\r\nprint(f\"Projecting Iris Flower in two dimensions in the generated model...\")\r\nprojector = ivis.Ivis(k=90, batch_size=90, verbose=0).fit(X_train, y_train)\r\nX_train_pred = projector.transform(X_train)\r\nX_test_pred = projector.transform(X_test)\r\n\r\nfile_name = \"model.pkl\"\r\n\r\nprint(f\"Saving the generated model into {file_name}...\")\r\njoblib.dump(projector, file_name)\r\n\r\nprint(f\"Loading the saved model in {file_name}...\")\r\nprojector2 = joblib.load(file_name)\r\n\r\nprint(f\"Projecting Iris Flower in two dimensions in the loaded model...\")\r\nX_train_pred2 = projector2.transform(X_train)\r\nX_test_pred2 = projector2.transform(X_test)\r\n\r\nprint(f\"Prediction comparison between generated and loaded models:\")\r\nprint(f\" |_ Are the train transforms of both models equal? {(X_train_pred == X_train_pred2).all()}\")\r\nprint(f\" |_ Are the test transforms of both models equal? {(X_test_pred == X_test_pred2).all()}\")\r\n```\r\n\r\n### Log\r\n\r\n```\r\nLoading and splitting the Iris Flower data set...\r\nProjecting Iris Flower in two dimensions in the generated model...\r\nSaving the generated model into model.pkl...\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nWARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.\r\nLoading the saved model in model.pkl...\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\nWARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.\r\nProjecting Iris Flower in two dimensions in the loaded model...\r\nPrediction comparison between generated and loaded models:\r\n |_ Are the train transforms of both models equal? True\r\n |_ Are the test transforms of both models equal? True\r\n```\r\n\r\n# Additional comments\r\n\r\nThis pull request, if accepted, will make `Ivis` have two means of saving/loading models with two distinct implementations that would need to be maintained. In case there is no attachment to the existing implementation, one possibility worth contemplating is to deprecate the methodology applied in `Ivis.load_model()` and `Ivis.save_model()` and make these methods produce pickle files instead. Another alternative would be to deprecate these methods entirely and merely inform the user that `Ivis` can be pickled. On the other hand, if maintaining both implementations is justified, this paragraph can be disregarded.\r\n\r\nRegarding the warnings: do you know how we could mitigate them? I guess `tensorflow` is instructing the user to use the `.compile()` method; however, since I am not familiar with `tensorflow`, I found it better to leave this up to you. I did try to silence this warning following a couple of different alternatives within `tensorflow`; however, this warning was unaffected.\r\n\r\nSome small observations are worth making as well. The proposed `Ivis.__getstate__()` and `Ivis.__setstate__()` methods have some conditionals imposed to meet the expectations of `sklearn.base.clone()`, which is used in `sklearn.model_selection.GridSearchCV`. Additionally, no structural changes were made in `ivis/data/neighbour_retrieval/knn.py`. This file was just formatted by PyCharm to adhere to some PEP spacing conventions.","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/106/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":2,"eyes":0},"timeline_url":"https://api.github.com/repos/beringresearch/ivis/issues/106/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":5424364282,"node_id":"CE_lADOCJ2sz843fABfzwAAAAFDUTr6","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/5424364282","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-10-06T21:31:23Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"imatheussm","id":4311541,"node_id":"MDQ6VXNlcjQzMTE1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/4311541?v=4","gravatar_id":"","url":"https://api.github.com/users/imatheussm","html_url":"https://github.com/imatheussm","followers_url":"https://api.github.com/users/imatheussm/followers","following_url":"https://api.github.com/users/imatheussm/following{/other_user}","gists_url":"https://api.github.com/users/imatheussm/gists{/gist_id}","starred_url":"https://api.github.com/users/imatheussm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imatheussm/subscriptions","organizations_url":"https://api.github.com/users/imatheussm/orgs","repos_url":"https://api.github.com/users/imatheussm/repos","events_url":"https://api.github.com/users/imatheussm/events{/privacy}","received_events_url":"https://api.github.com/users/imatheussm/received_events","type":"User","site_admin":false},"created_at":"2021-11-04T02:56:39Z","updated_at":"2021-11-04T02:56:39Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/109","repository_url":"https://api.github.com/repos/beringresearch/ivis","labels_url":"https://api.github.com/repos/beringresearch/ivis/issues/109/labels{/name}","comments_url":"https://api.github.com/repos/beringresearch/ivis/issues/109/comments","events_url":"https://api.github.com/repos/beringresearch/ivis/issues/109/events","html_url":"https://github.com/beringresearch/ivis/issues/109","id":1044312374,"node_id":"I_kwDOCJ2sz84-PvE2","number":109,"title":"`KeyError` followed by `joblib.externals.loky.process_executor.BrokenProcessPool` when using `sklearn.model_selection.GridSearchCV` with `n_jobs != 1`","user":{"login":"imatheussm","id":4311541,"node_id":"MDQ6VXNlcjQzMTE1NDE=","avatar_url":"https://avatars.githubusercontent.com/u/4311541?v=4","gravatar_id":"","url":"https://api.github.com/users/imatheussm","html_url":"https://github.com/imatheussm","followers_url":"https://api.github.com/users/imatheussm/followers","following_url":"https://api.github.com/users/imatheussm/following{/other_user}","gists_url":"https://api.github.com/users/imatheussm/gists{/gist_id}","starred_url":"https://api.github.com/users/imatheussm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imatheussm/subscriptions","organizations_url":"https://api.github.com/users/imatheussm/orgs","repos_url":"https://api.github.com/users/imatheussm/repos","events_url":"https://api.github.com/users/imatheussm/events{/privacy}","received_events_url":"https://api.github.com/users/imatheussm/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-11-04T02:56:38Z","updated_at":"2021-11-08T17:09:49Z","closed_at":"2021-11-08T17:09:49Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"repository":{"id":144551119,"node_id":"MDEwOlJlcG9zaXRvcnkxNDQ1NTExMTk=","name":"ivis","full_name":"beringresearch/ivis","private":false,"owner":{"login":"beringresearch","id":14840322,"node_id":"MDQ6VXNlcjE0ODQwMzIy","avatar_url":"https://avatars.githubusercontent.com/u/14840322?v=4","gravatar_id":"","url":"https://api.github.com/users/beringresearch","html_url":"https://github.com/beringresearch","followers_url":"https://api.github.com/users/beringresearch/followers","following_url":"https://api.github.com/users/beringresearch/following{/other_user}","gists_url":"https://api.github.com/users/beringresearch/gists{/gist_id}","starred_url":"https://api.github.com/users/beringresearch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/beringresearch/subscriptions","organizations_url":"https://api.github.com/users/beringresearch/orgs","repos_url":"https://api.github.com/users/beringresearch/repos","events_url":"https://api.github.com/users/beringresearch/events{/privacy}","received_events_url":"https://api.github.com/users/beringresearch/received_events","type":"User","site_admin":false},"html_url":"https://github.com/beringresearch/ivis","description":"Dimensionality reduction in very large datasets using Siamese Networks","fork":false,"url":"https://api.github.com/repos/beringresearch/ivis","forks_url":"https://api.github.com/repos/beringresearch/ivis/forks","keys_url":"https://api.github.com/repos/beringresearch/ivis/keys{/key_id}","collaborators_url":"https://api.github.com/repos/beringresearch/ivis/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/beringresearch/ivis/teams","hooks_url":"https://api.github.com/repos/beringresearch/ivis/hooks","issue_events_url":"https://api.github.com/repos/beringresearch/ivis/issues/events{/number}","events_url":"https://api.github.com/repos/beringresearch/ivis/events","assignees_url":"https://api.github.com/repos/beringresearch/ivis/assignees{/user}","branches_url":"https://api.github.com/repos/beringresearch/ivis/branches{/branch}","tags_url":"https://api.github.com/repos/beringresearch/ivis/tags","blobs_url":"https://api.github.com/repos/beringresearch/ivis/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/beringresearch/ivis/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/beringresearch/ivis/git/refs{/sha}","trees_url":"https://api.github.com/repos/beringresearch/ivis/git/trees{/sha}","statuses_url":"https://api.github.com/repos/beringresearch/ivis/statuses/{sha}","languages_url":"https://api.github.com/repos/beringresearch/ivis/languages","stargazers_url":"https://api.github.com/repos/beringresearch/ivis/stargazers","contributors_url":"https://api.github.com/repos/beringresearch/ivis/contributors","subscribers_url":"https://api.github.com/repos/beringresearch/ivis/subscribers","subscription_url":"https://api.github.com/repos/beringresearch/ivis/subscription","commits_url":"https://api.github.com/repos/beringresearch/ivis/commits{/sha}","git_commits_url":"https://api.github.com/repos/beringresearch/ivis/git/commits{/sha}","comments_url":"https://api.github.com/repos/beringresearch/ivis/comments{/number}","issue_comment_url":"https://api.github.com/repos/beringresearch/ivis/issues/comments{/number}","contents_url":"https://api.github.com/repos/beringresearch/ivis/contents/{+path}","compare_url":"https://api.github.com/repos/beringresearch/ivis/compare/{base}...{head}","merges_url":"https://api.github.com/repos/beringresearch/ivis/merges","archive_url":"https://api.github.com/repos/beringresearch/ivis/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/beringresearch/ivis/downloads","issues_url":"https://api.github.com/repos/beringresearch/ivis/issues{/number}","pulls_url":"https://api.github.com/repos/beringresearch/ivis/pulls{/number}","milestones_url":"https://api.github.com/repos/beringresearch/ivis/milestones{/number}","notifications_url":"https://api.github.com/repos/beringresearch/ivis/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/beringresearch/ivis/labels{/name}","releases_url":"https://api.github.com/repos/beringresearch/ivis/releases{/id}","deployments_url":"https://api.github.com/repos/beringresearch/ivis/deployments","created_at":"2018-08-13T08:31:01Z","updated_at":"2023-01-17T15:00:20Z","pushed_at":"2023-01-11T12:25:50Z","git_url":"git://github.com/beringresearch/ivis.git","ssh_url":"git@github.com:beringresearch/ivis.git","clone_url":"https://github.com/beringresearch/ivis.git","svn_url":"https://github.com/beringresearch/ivis","homepage":"http://bering-ivis.readthedocs.io","size":36707,"stargazers_count":286,"watchers_count":286,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":37,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["data-visualization","dimensionality-reduction","machine-learning","neural-network","siamese-neural-network"],"visibility":"public","forks":37,"open_issues":2,"watchers":286,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"# The issue\r\n\r\nWhenever using `sklearn.model_selection.GridSearch` with a `sklearn.pipeline.Pipeline` containing `ivis.Ivis` and `GridSearch` is set with `n_jobs != -1` (e.g., `n_jobs = 2`), errors happen. When `n_jobs = 1`, no errors occur.\r\n\r\n# Minimal reproducible example\r\n\r\n## Environment\r\n\r\nA virtual environment was created specifically for this project, wherein all modules specified in `requirements.txt` were installed. My setup runs an up-to-date version of Windows 10 (no WSL).  My local repository was based on a50b196735eecc2afc63423fe99b803107048572.\r\n\r\n### Runtime\r\n\r\n```\r\npython=3.9.5\r\n```\r\n\r\n### Relevant modules\r\n\r\n```\r\nivis=2.0.6\r\ntensorflow=2.6.0\r\n```\r\n\r\n## Example with `sklearn.pipeline.Pipeline`\r\n\r\n### Script\r\n\r\n```\r\nimport tempfile\r\nimport ivis\r\n\r\nfrom sklearn import datasets, ensemble, model_selection, pipeline, preprocessing, svm\r\n\r\n\r\nX, y = datasets.load_iris(return_X_y=True)\r\n\r\npipeline_with_ivis = pipeline.Pipeline([\r\n    (\"normalize\", preprocessing.MinMaxScaler()),\r\n    (\"project\", None),\r\n    (\"classify\", None),\r\n], memory=tempfile.mkdtemp())\r\n\r\nparameter_grid = {\r\n    \"project\": (ivis.Ivis(verbose=0),),\r\n    \"project__k\": (15,),\r\n\r\n    \"classify\": (ensemble.RandomForestClassifier(), svm.SVC()),\r\n    \"classify__random_state\": (2021,)\r\n}\r\n\r\ngrid_search = model_selection.GridSearchCV(pipeline_with_ivis, parameter_grid, scoring=\"accuracy\", cv=10, verbose=3,\r\n                                           return_train_score=True, error_score='raise', n_jobs=2).fit(X, y)\r\n```\r\n\r\n### Log with errors\r\n\r\n```\r\nFitting 10 folds for each of 2 candidates, totalling 20 fits\r\nexception calling callback for <Future at 0x29b2a280ca0 state=finished raised BrokenProcessPool>\r\njoblib.externals.loky.process_executor._RemoteTraceback: \r\n\"\"\"\r\nTraceback (most recent call last):\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\externals\\loky\\process_executor.py\", line 404, in _process_worker\r\n    call_item = call_queue.get(block=True, timeout=timeout)\r\n  File \"<USER_FOLDER>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\multiprocessing\\queues.py\", line 122, in get\r\n    return _ForkingPickler.loads(res)\r\n  File \"<REPOSITORY_ROOT>\\ivis\\ivis.py\", line 211, in __setstate__\r\n    if state[key] is not None:\r\nKeyError: 'ivis_params_'\r\n\"\"\"\r\nThe above exception was the direct cause of the following exception:\r\nTraceback (most recent call last):\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\externals\\loky\\_base.py\", line 625, in _invoke_callbacks\r\n    callback(self)\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\parallel.py\", line 359, in __call__\r\n    self.parallel.dispatch_next()\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\parallel.py\", line 792, in dispatch_next\r\n    if not self.dispatch_one_batch(self._original_iterator):\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\parallel.py\", line 859, in dispatch_one_batch\r\n    self._dispatch(tasks)\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\parallel.py\", line 777, in _dispatch\r\n    job = self._backend.apply_async(batch, callback=cb)\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\_parallel_backends.py\", line 531, in apply_async\r\n    future = self._workers.submit(SafeFunction(func))\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\externals\\loky\\reusable_executor.py\", line 177, in submit\r\n    return super(_ReusablePoolExecutor, self).submit(\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\externals\\loky\\process_executor.py\", line 1102, in submit\r\n    raise self._flags.broken\r\njoblib.externals.loky.process_executor.BrokenProcessPool: A task has failed to un-serialize. Please ensure that the arguments of the function are all picklable.\r\nERROR: The process with PID 29140 (child process of PID 27848) could not be terminated.\r\nReason: There is no running instance of the task.\r\njoblib.externals.loky.process_executor._RemoteTraceback: \r\n\"\"\"\r\nTraceback (most recent call last):\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\externals\\loky\\process_executor.py\", line 404, in _process_worker\r\n    call_item = call_queue.get(block=True, timeout=timeout)\r\n  File \"<USER_FOLDER>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\multiprocessing\\queues.py\", line 122, in get\r\n    return _ForkingPickler.loads(res)\r\n  File \"<REPOSITORY_ROOT>\\ivis\\ivis.py\", line 211, in __setstate__\r\n    if state[key] is not None:\r\nKeyError: 'ivis_params_'\r\n\"\"\"\r\nThe above exception was the direct cause of the following exception:\r\nTraceback (most recent call last):\r\n  File \"<input>\", line 1, in <module>\r\n  File \"<USER_FOLDER>\\AppData\\Local\\JetBrains\\Toolbox\\apps\\PyCharm-P\\ch-0\\212.5284.44\\plugins\\python\\helpers\\pydev\\_pydev_bundle\\pydev_umd.py\", line 198, in runfile\r\n    pydev_imports.execfile(filename, global_vars, local_vars)  # execute the script\r\n  File \"<USER_FOLDER>\\AppData\\Local\\JetBrains\\Toolbox\\apps\\PyCharm-P\\ch-0\\212.5284.44\\plugins\\python\\helpers\\pydev\\_pydev_imps\\_pydev_execfile.py\", line 18, in execfile\r\n    exec(compile(contents+\"\\n\", file, 'exec'), glob, loc)\r\n  File \"<REPOSITORY_ROOT>/playground.py\", line 74, in <module>\r\n    grid_search = model_selection.GridSearchCV(pipeline_with_ivis, parameter_grid, scoring=\"accuracy\", cv=10, verbose=3,\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\sklearn\\model_selection\\_search.py\", line 891, in fit\r\n    self._run_search(evaluate_candidates)\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\sklearn\\model_selection\\_search.py\", line 1392, in _run_search\r\n    evaluate_candidates(ParameterGrid(self.param_grid))\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\sklearn\\model_selection\\_search.py\", line 838, in evaluate_candidates\r\n    out = parallel(\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\parallel.py\", line 1054, in __call__\r\n    self.retrieve()\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\parallel.py\", line 933, in retrieve\r\n    self._output.extend(job.get(timeout=self.timeout))\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\_parallel_backends.py\", line 542, in wrap_future_result\r\n    return future.result(timeout=timeout)\r\n  File \"<USER_FOLDER>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\concurrent\\futures\\_base.py\", line 445, in result\r\n    return self.__get_result()\r\n  File \"<USER_FOLDER>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\concurrent\\futures\\_base.py\", line 390, in __get_result\r\n    raise self._exception\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\externals\\loky\\_base.py\", line 625, in _invoke_callbacks\r\n    callback(self)\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\parallel.py\", line 359, in __call__\r\n    self.parallel.dispatch_next()\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\parallel.py\", line 792, in dispatch_next\r\n    if not self.dispatch_one_batch(self._original_iterator):\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\parallel.py\", line 859, in dispatch_one_batch\r\n    self._dispatch(tasks)\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\parallel.py\", line 777, in _dispatch\r\n    job = self._backend.apply_async(batch, callback=cb)\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\_parallel_backends.py\", line 531, in apply_async\r\n    future = self._workers.submit(SafeFunction(func))\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\externals\\loky\\reusable_executor.py\", line 177, in submit\r\n    return super(_ReusablePoolExecutor, self).submit(\r\n  File \"<REPOSITORY_ROOT>\\venv\\lib\\site-packages\\joblib\\externals\\loky\\process_executor.py\", line 1102, in submit\r\n    raise self._flags.broken\r\njoblib.externals.loky.process_executor.BrokenProcessPool: A task has failed to un-serialize. Please ensure that the arguments of the function are all picklable.\r\n```\r\n\r\n# Discussion\r\n\r\nTo the best of my knowledge and local testing, this issue seems to appear after the resolution of #101 with #106. Since the logic for pickling and unpickling `Ivis` instances was improved, my belief is that this particular use case was not covered neither by the new implementation, nor by the newly added test cases. I reserved some time today to investigate this further, but so far, I was out of luck. Do you have any thoughts on this? Perhaps we could also create additional tests covering scenarios wherein `Pipeline` and `GridSearchCV` are used. Does this make sense?\r\n\r\nThank you beforehand for your support.","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/109/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/beringresearch/ivis/issues/109/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"}]