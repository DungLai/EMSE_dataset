[{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/1220648591","html_url":"https://github.com/beringresearch/ivis/issues/117#issuecomment-1220648591","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/117","id":1220648591,"node_id":"IC_kwDOCJ2sz85IwZ6P","user":{"login":"idroz","id":12413294,"node_id":"MDQ6VXNlcjEyNDEzMjk0","avatar_url":"https://avatars.githubusercontent.com/u/12413294?v=4","gravatar_id":"","url":"https://api.github.com/users/idroz","html_url":"https://github.com/idroz","followers_url":"https://api.github.com/users/idroz/followers","following_url":"https://api.github.com/users/idroz/following{/other_user}","gists_url":"https://api.github.com/users/idroz/gists{/gist_id}","starred_url":"https://api.github.com/users/idroz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/idroz/subscriptions","organizations_url":"https://api.github.com/users/idroz/orgs","repos_url":"https://api.github.com/users/idroz/repos","events_url":"https://api.github.com/users/idroz/events{/privacy}","received_events_url":"https://api.github.com/users/idroz/received_events","type":"User","site_admin":false},"created_at":"2022-08-19T12:59:20Z","updated_at":"2022-08-19T12:59:20Z","author_association":"COLLABORATOR","body":"Thanks for raising this - this certainly shouldn't be taking that long - typically takes 2-3 minutes to extract KNNs from similarly-sized datasets on a machine with your specs.\r\n\r\nIt looks like the bottleneck might be reading the h5 file. I'm not sure how Google Colab is set up, but if the SSD is a network drive, I/O might be limited by network speed. Have you tried running this locally?\r\n\r\n@Szubie - do we have anything supporting H5 files with `ivis.data.sequence.IndexableDataset` class?","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/1220648591/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"idroz","id":12413294,"node_id":"MDQ6VXNlcjEyNDEzMjk0","avatar_url":"https://avatars.githubusercontent.com/u/12413294?v=4","gravatar_id":"","url":"https://api.github.com/users/idroz","html_url":"https://github.com/idroz","followers_url":"https://api.github.com/users/idroz/followers","following_url":"https://api.github.com/users/idroz/following{/other_user}","gists_url":"https://api.github.com/users/idroz/gists{/gist_id}","starred_url":"https://api.github.com/users/idroz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/idroz/subscriptions","organizations_url":"https://api.github.com/users/idroz/orgs","repos_url":"https://api.github.com/users/idroz/repos","events_url":"https://api.github.com/users/idroz/events{/privacy}","received_events_url":"https://api.github.com/users/idroz/received_events","type":"User","site_admin":false}},{"id":7222040735,"node_id":"MEE_lADOCJ2sz85QHwSSzwAAAAGud5if","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/7222040735","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-08-19T12:59:20Z","performed_via_github_app":null},{"id":7222040741,"node_id":"SE_lADOCJ2sz85QHwSSzwAAAAGud5il","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/7222040741","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-08-19T12:59:20Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/1220731913","html_url":"https://github.com/beringresearch/ivis/issues/117#issuecomment-1220731913","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/117","id":1220731913,"node_id":"IC_kwDOCJ2sz85IwuQJ","user":{"login":"adavoudi","id":1219898,"node_id":"MDQ6VXNlcjEyMTk4OTg=","avatar_url":"https://avatars.githubusercontent.com/u/1219898?v=4","gravatar_id":"","url":"https://api.github.com/users/adavoudi","html_url":"https://github.com/adavoudi","followers_url":"https://api.github.com/users/adavoudi/followers","following_url":"https://api.github.com/users/adavoudi/following{/other_user}","gists_url":"https://api.github.com/users/adavoudi/gists{/gist_id}","starred_url":"https://api.github.com/users/adavoudi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adavoudi/subscriptions","organizations_url":"https://api.github.com/users/adavoudi/orgs","repos_url":"https://api.github.com/users/adavoudi/repos","events_url":"https://api.github.com/users/adavoudi/events{/privacy}","received_events_url":"https://api.github.com/users/adavoudi/received_events","type":"User","site_admin":false},"created_at":"2022-08-19T14:15:10Z","updated_at":"2022-08-19T14:15:10Z","author_association":"NONE","body":"@idroz Sorry the number of features is 200K, not 20k (I missed a zero in the description)! Does that change your answer?","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/1220731913/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adavoudi","id":1219898,"node_id":"MDQ6VXNlcjEyMTk4OTg=","avatar_url":"https://avatars.githubusercontent.com/u/1219898?v=4","gravatar_id":"","url":"https://api.github.com/users/adavoudi","html_url":"https://github.com/adavoudi","followers_url":"https://api.github.com/users/adavoudi/followers","following_url":"https://api.github.com/users/adavoudi/following{/other_user}","gists_url":"https://api.github.com/users/adavoudi/gists{/gist_id}","starred_url":"https://api.github.com/users/adavoudi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adavoudi/subscriptions","organizations_url":"https://api.github.com/users/adavoudi/orgs","repos_url":"https://api.github.com/users/adavoudi/repos","events_url":"https://api.github.com/users/adavoudi/events{/privacy}","received_events_url":"https://api.github.com/users/adavoudi/received_events","type":"User","site_admin":false}},{"id":7222589747,"node_id":"MEE_lADOCJ2sz85QHwSSzwAAAAGuf_kz","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/7222589747","actor":{"login":"idroz","id":12413294,"node_id":"MDQ6VXNlcjEyNDEzMjk0","avatar_url":"https://avatars.githubusercontent.com/u/12413294?v=4","gravatar_id":"","url":"https://api.github.com/users/idroz","html_url":"https://github.com/idroz","followers_url":"https://api.github.com/users/idroz/followers","following_url":"https://api.github.com/users/idroz/following{/other_user}","gists_url":"https://api.github.com/users/idroz/gists{/gist_id}","starred_url":"https://api.github.com/users/idroz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/idroz/subscriptions","organizations_url":"https://api.github.com/users/idroz/orgs","repos_url":"https://api.github.com/users/idroz/repos","events_url":"https://api.github.com/users/idroz/events{/privacy}","received_events_url":"https://api.github.com/users/idroz/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-08-19T14:15:10Z","performed_via_github_app":null},{"id":7222589753,"node_id":"SE_lADOCJ2sz85QHwSSzwAAAAGuf_k5","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/7222589753","actor":{"login":"idroz","id":12413294,"node_id":"MDQ6VXNlcjEyNDEzMjk0","avatar_url":"https://avatars.githubusercontent.com/u/12413294?v=4","gravatar_id":"","url":"https://api.github.com/users/idroz","html_url":"https://github.com/idroz","followers_url":"https://api.github.com/users/idroz/followers","following_url":"https://api.github.com/users/idroz/following{/other_user}","gists_url":"https://api.github.com/users/idroz/gists{/gist_id}","starred_url":"https://api.github.com/users/idroz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/idroz/subscriptions","organizations_url":"https://api.github.com/users/idroz/orgs","repos_url":"https://api.github.com/users/idroz/repos","events_url":"https://api.github.com/users/idroz/events{/privacy}","received_events_url":"https://api.github.com/users/idroz/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-08-19T14:15:10Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/1220773385","html_url":"https://github.com/beringresearch/ivis/issues/117#issuecomment-1220773385","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/117","id":1220773385,"node_id":"IC_kwDOCJ2sz85Iw4YJ","user":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false},"created_at":"2022-08-19T14:53:03Z","updated_at":"2022-08-19T14:56:13Z","author_association":"COLLABORATOR","body":"The H5 file seems to be working fine - the file was read to create the KNN index. For some reason it seems that using the Annoy index itself is the bottleneck. By default ivis places the annoy index in the /tmp directory, so if that dir is slow that would affect things - but doubt that is happening here.\r\n\r\nIt is possible that the number of features (200k) is too high for Annoy to handle cleanly. It claims to work [up to 1,000 dimensions reasonably well](https://github.com/spotify/annoy#summary-of-features), although we have used it up to 20k without issues. Playing with some of the knn retrieval parameters may help a bit. There are two main things to tune with Annoy - search_k and n_trees. To speed up the retrieval at expense of accuracy, try reducing the search_k and see if it helps at all; search_k defaults to k * n_trees if not specified.\r\n\r\nIf Annoy cannot handle the data and the above tweaking doesn't help, you could try two other things:\r\n1) Preprocessing the data to reduce the number of dimensions before passing it is ivis. E.g. PCA.\r\n2) Use some other method of extracting the KNN and pass in a `neighbour matrix` to Ivis.\r\n\r\nPursuing the second option would let you use any KNN retrieval method to get the neighbour indices. For example you might use [faiss](https://github.com/facebookresearch/faiss) to retrieve the neighbour indices using a method that scales better and then pass in the results to Ivis which would then use them for training the neural network.","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/1220773385/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Szubie","id":13461031,"node_id":"MDQ6VXNlcjEzNDYxMDMx","avatar_url":"https://avatars.githubusercontent.com/u/13461031?v=4","gravatar_id":"","url":"https://api.github.com/users/Szubie","html_url":"https://github.com/Szubie","followers_url":"https://api.github.com/users/Szubie/followers","following_url":"https://api.github.com/users/Szubie/following{/other_user}","gists_url":"https://api.github.com/users/Szubie/gists{/gist_id}","starred_url":"https://api.github.com/users/Szubie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Szubie/subscriptions","organizations_url":"https://api.github.com/users/Szubie/orgs","repos_url":"https://api.github.com/users/Szubie/repos","events_url":"https://api.github.com/users/Szubie/events{/privacy}","received_events_url":"https://api.github.com/users/Szubie/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/1221191795","html_url":"https://github.com/beringresearch/ivis/issues/117#issuecomment-1221191795","issue_url":"https://api.github.com/repos/beringresearch/ivis/issues/117","id":1221191795,"node_id":"IC_kwDOCJ2sz85Iyehz","user":{"login":"adavoudi","id":1219898,"node_id":"MDQ6VXNlcjEyMTk4OTg=","avatar_url":"https://avatars.githubusercontent.com/u/1219898?v=4","gravatar_id":"","url":"https://api.github.com/users/adavoudi","html_url":"https://github.com/adavoudi","followers_url":"https://api.github.com/users/adavoudi/followers","following_url":"https://api.github.com/users/adavoudi/following{/other_user}","gists_url":"https://api.github.com/users/adavoudi/gists{/gist_id}","starred_url":"https://api.github.com/users/adavoudi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adavoudi/subscriptions","organizations_url":"https://api.github.com/users/adavoudi/orgs","repos_url":"https://api.github.com/users/adavoudi/repos","events_url":"https://api.github.com/users/adavoudi/events{/privacy}","received_events_url":"https://api.github.com/users/adavoudi/received_events","type":"User","site_admin":false},"created_at":"2022-08-20T00:48:20Z","updated_at":"2022-08-20T00:48:20Z","author_association":"NONE","body":"Thanks for your thorough answer! The problem was as you said the Annoy library. I reduced the dimension of my data and now it works perfectly. \r\n ","reactions":{"url":"https://api.github.com/repos/beringresearch/ivis/issues/comments/1221191795/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adavoudi","id":1219898,"node_id":"MDQ6VXNlcjEyMTk4OTg=","avatar_url":"https://avatars.githubusercontent.com/u/1219898?v=4","gravatar_id":"","url":"https://api.github.com/users/adavoudi","html_url":"https://github.com/adavoudi","followers_url":"https://api.github.com/users/adavoudi/followers","following_url":"https://api.github.com/users/adavoudi/following{/other_user}","gists_url":"https://api.github.com/users/adavoudi/gists{/gist_id}","starred_url":"https://api.github.com/users/adavoudi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adavoudi/subscriptions","organizations_url":"https://api.github.com/users/adavoudi/orgs","repos_url":"https://api.github.com/users/adavoudi/repos","events_url":"https://api.github.com/users/adavoudi/events{/privacy}","received_events_url":"https://api.github.com/users/adavoudi/received_events","type":"User","site_admin":false}},{"id":7225616157,"node_id":"CE_lADOCJ2sz85QHwSSzwAAAAGuricd","url":"https://api.github.com/repos/beringresearch/ivis/issues/events/7225616157","actor":{"login":"adavoudi","id":1219898,"node_id":"MDQ6VXNlcjEyMTk4OTg=","avatar_url":"https://avatars.githubusercontent.com/u/1219898?v=4","gravatar_id":"","url":"https://api.github.com/users/adavoudi","html_url":"https://github.com/adavoudi","followers_url":"https://api.github.com/users/adavoudi/followers","following_url":"https://api.github.com/users/adavoudi/following{/other_user}","gists_url":"https://api.github.com/users/adavoudi/gists{/gist_id}","starred_url":"https://api.github.com/users/adavoudi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adavoudi/subscriptions","organizations_url":"https://api.github.com/users/adavoudi/orgs","repos_url":"https://api.github.com/users/adavoudi/repos","events_url":"https://api.github.com/users/adavoudi/events{/privacy}","received_events_url":"https://api.github.com/users/adavoudi/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-08-20T00:48:24Z","state_reason":null,"performed_via_github_app":null}]