[{"id":1885416105,"node_id":"MDEyOkxhYmVsZWRFdmVudDE4ODU0MTYxMDU=","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1885416105","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-10-04T18:41:09Z","label":{"name":"P3","color":"efedf5"},"performed_via_github_app":null},{"id":1885416562,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQxODg1NDE2NTYy","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1885416562","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2018-10-04T18:41:21Z","assignee":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/427401422","html_url":"https://github.com/NRCan/geo-deep-learning/issues/17#issuecomment-427401422","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/17","id":427401422,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzQwMTQyMg==","user":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"created_at":"2018-10-05T15:17:39Z","updated_at":"2018-10-05T15:17:39Z","author_association":"COLLABORATOR","body":"When a model is trained using DataParallel, classification must also be done with DataParallel. If not, `conv1.encoding_block.1.weight` is expected but `module.conv1.encoding_block.1.weight` is what is saved in the model. (see image for error message)\r\n![classification_module_bug](https://user-images.githubusercontent.com/43219583/46543747-a772d780-c88f-11e8-8571-3126cc4241e2.PNG)\r\nThe issue was reported [here ](https://github.com/kuangliu/torchcv/issues/28) and the aforementioned solution was proposed.","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/427401422/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/429978700","html_url":"https://github.com/NRCan/geo-deep-learning/issues/17#issuecomment-429978700","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/17","id":429978700,"node_id":"MDEyOklzc3VlQ29tbWVudDQyOTk3ODcwMA==","user":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"created_at":"2018-10-15T19:14:06Z","updated_at":"2018-10-15T19:14:06Z","author_association":"COLLABORATOR","body":"When using DataParallel with a single GPU, the program runs as expected. When trying to use 2 or more, the program hangs during the training of the first batch in the first epoch. This appears to be a [common issue when using Multi-GPU with K80s](https://github.com/pytorch/pytorch/issues/1637#issuecomment-338268158 ). The proposed solutions to fix the peer-to-peer hanging all require admin access. \r\n\r\nThe [p2pBandwidthLatencyTest ](https://www.ibm.com/developerworks/library/l-s822lc-for-hpc/index.html) was run in our environment using 2 GPUs and it shows very low bandwidth and high latency. The performance is worse when p2p is enabled, which is a requirement for DataParallel. \r\n![p2p_test](https://user-images.githubusercontent.com/43219583/46971373-c3ddf380-d089-11e8-8bb7-e602addd0153.PNG)\r\n","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/429978700/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/430293290","html_url":"https://github.com/NRCan/geo-deep-learning/issues/17#issuecomment-430293290","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/17","id":430293290,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMDI5MzI5MA==","user":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"created_at":"2018-10-16T15:55:43Z","updated_at":"2018-10-16T15:55:43Z","author_association":"COLLABORATOR","body":"Using DataParallel in Pytorch is straightforward since task distribution and memory management are handled by PyTorch in the background. After setting the net to run on cuda, `nn.DataParallel` must be used on the model to transform it to use multiple GPUs.\r\n\r\n```\r\n        model = model.cuda()\r\n        model = nn.DataParallel(model)\r\n```\r\nWhen we use DataParallel with a single GPU available, the program executes as expected. However, when using 2 or more GPUs, the program hangs during the first epoch of training indefinitely (assumed since tests left running overnight with 121 training samples (256x256 pixels) never completed the first epoch's forward pass). As mentioned in my previous comment, this appears to be a common issue when using K80 GPUs (see link to GitHub issue)\r\n\r\nA functional version of `DataParallel `exists: `torch.nn.parallel.data_parallel(module, inputs)`. It had the same behavior when tested.\r\n\r\nFor now, I think we should set this task aside since we can't change which GPUs we have access to and we don't have the admin permissions required for the suggested workarounds. Once we deploy on AWS, we should revisit the issue since we will be able to choose what type of GPU is used.","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/430293290/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/430310741","html_url":"https://github.com/NRCan/geo-deep-learning/issues/17#issuecomment-430310741","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/17","id":430310741,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMDMxMDc0MQ==","user":{"login":"mpelchat04","id":38693210,"node_id":"MDQ6VXNlcjM4NjkzMjEw","avatar_url":"https://avatars.githubusercontent.com/u/38693210?v=4","gravatar_id":"","url":"https://api.github.com/users/mpelchat04","html_url":"https://github.com/mpelchat04","followers_url":"https://api.github.com/users/mpelchat04/followers","following_url":"https://api.github.com/users/mpelchat04/following{/other_user}","gists_url":"https://api.github.com/users/mpelchat04/gists{/gist_id}","starred_url":"https://api.github.com/users/mpelchat04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mpelchat04/subscriptions","organizations_url":"https://api.github.com/users/mpelchat04/orgs","repos_url":"https://api.github.com/users/mpelchat04/repos","events_url":"https://api.github.com/users/mpelchat04/events{/privacy}","received_events_url":"https://api.github.com/users/mpelchat04/received_events","type":"User","site_admin":false},"created_at":"2018-10-16T16:45:20Z","updated_at":"2018-10-16T16:45:20Z","author_association":"COLLABORATOR","body":"Thanks for the update @epeterson12. I agree with you, we can set this issue aside and revisit it once we deploy on AWS. ","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/430310741/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mpelchat04","id":38693210,"node_id":"MDQ6VXNlcjM4NjkzMjEw","avatar_url":"https://avatars.githubusercontent.com/u/38693210?v=4","gravatar_id":"","url":"https://api.github.com/users/mpelchat04","html_url":"https://github.com/mpelchat04","followers_url":"https://api.github.com/users/mpelchat04/followers","following_url":"https://api.github.com/users/mpelchat04/following{/other_user}","gists_url":"https://api.github.com/users/mpelchat04/gists{/gist_id}","starred_url":"https://api.github.com/users/mpelchat04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mpelchat04/subscriptions","organizations_url":"https://api.github.com/users/mpelchat04/orgs","repos_url":"https://api.github.com/users/mpelchat04/repos","events_url":"https://api.github.com/users/mpelchat04/events{/privacy}","received_events_url":"https://api.github.com/users/mpelchat04/received_events","type":"User","site_admin":false}},{"id":1907365198,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTkwNzM2NTE5OA==","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1907365198","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-10-16T16:45:20Z","performed_via_github_app":null},{"id":1907365199,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE5MDczNjUxOTk=","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1907365199","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-10-16T16:45:20Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/435485944","html_url":"https://github.com/NRCan/geo-deep-learning/issues/17#issuecomment-435485944","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/17","id":435485944,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNTQ4NTk0NA==","user":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"created_at":"2018-11-02T19:35:08Z","updated_at":"2018-11-02T19:35:08Z","author_association":"COLLABORATOR","body":"I just tested DataParallel on a p2.4xlarge instance on AWS. The process ran extremely slowly and the CPU use was at 100% for one core and close to 0 for the others. I got the following warning multiple times:\r\n![cuda9_error](https://user-images.githubusercontent.com/43219583/47936143-2a00ae00-deb3-11e8-9ada-5bb0de64e7c3.png)\r\n\r\nI set up the environment with pytorch 0.4.0. We will have to update our pytorch version in order to take advantage of DataParallel in v100 GPUs.  \r\n\r\nWith the newest version of pytorch installed, the speed was greatly improved. I will run tests on Monday to see how using multiple GPUs compares to using a single GPU for training models.\r\n","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/435485944/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/436308368","html_url":"https://github.com/NRCan/geo-deep-learning/issues/17#issuecomment-436308368","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/17","id":436308368,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjMwODM2OA==","user":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"created_at":"2018-11-06T16:07:27Z","updated_at":"2018-11-06T16:07:27Z","author_association":"COLLABORATOR","body":"I did some performance tests using DataParallel on an AWS p3.8xlarge instance and compared them to our HPC. I trained over 100 epochs on our unetsmall and kept the same settings for each run other than the batch size. Here are the results: \r\n\r\nInstance Type | GPUs Used | Batch Size | Time for Training\r\n------------ | ------------- | ------------- | -------------\r\np3.8xlarge | 1 x V100 | 30 | 78m 46s\r\np3.8xlarge | 4 x V100 | 120 | 82m 59s\r\nHPC | 1 x K80 | 32 | 201m 29s\r\n\r\nWhen using DataParallel, the 4 GPUs are used, otherwise one GPU is used, confirmed by running nvidia-smi in the instances while training. \r\n1 GPU:\r\n![1xv100_nvidia-smi](https://user-images.githubusercontent.com/43219583/48071323-0fc31a80-e1a8-11e8-9053-25a703b2a902.PNG)\r\n4 GPUs: \r\n![4xv100_nvidia-smi](https://user-images.githubusercontent.com/43219583/48071333-15b8fb80-e1a8-11e8-93eb-70b610b531b7.PNG)\r\n\r\nI will look into why the training time for training on multiple GPUs is longer than on a single one of the same type. \r\n\r\nI also can't explain why the maximum batch size is smaller on the V100s than on the K80s despite them having 16 GB of GPU memory vs. 12 GB on the K80s.\r\n\r\nNote: because of how the checkpointed_unet model works, it can't be used in a multi-GPU context since DataParallel collects the forward and gradient (not saved in the checkpointed model, but recalculated at the end) data at the end of each epoch. When we try to run checkpointed training using multiple GPUs, we get the following error: `RuntimeError: Expected tensor for argument #1 'input' to have the same device as tensor for argument #2 'weight'; but device 1 does not equal 0 (while checking arguments for cudnn_convolution)`\r\n","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/436308368/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/436313778","html_url":"https://github.com/NRCan/geo-deep-learning/issues/17#issuecomment-436313778","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/17","id":436313778,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjMxMzc3OA==","user":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"created_at":"2018-11-06T16:21:41Z","updated_at":"2018-11-06T16:21:41Z","author_association":"CONTRIBUTOR","body":"@epeterson12 : interesting.  Do I understand the reason why you have 120 for batch_size in the 4-GPU case is that you just take the value for 1 GPU and multiply by 4 ?  Would it make sense to keep batch_size at 30 for all cases ?  Seems to me the idea of having more GPUs is to be able to execute the same task, but using more resources.  That would explain why 4 GPUs takes more time than 1 in your case.\r\n\r\nAt any rate, have you seen the [MULTI-GPU EXAMPLES](https://pytorch.org/tutorials/beginner/former_torchies/parallelism_tutorial.html) ?","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/436313778/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false}},{"id":1949419469,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTk0OTQxOTQ2OQ==","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1949419469","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-11-06T16:21:41Z","performed_via_github_app":null},{"id":1949419470,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE5NDk0MTk0NzA=","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1949419470","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-11-06T16:21:41Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/436321806","html_url":"https://github.com/NRCan/geo-deep-learning/issues/17#issuecomment-436321806","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/17","id":436321806,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjMyMTgwNg==","user":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"created_at":"2018-11-06T16:43:01Z","updated_at":"2018-11-06T16:43:01Z","author_association":"COLLABORATOR","body":"The way that DataParallel works is that it divides the data over all available GPUs. So with a batch size of 120 over 4 GPUs, each gpu will process 30 samples at a time and with a batch size of 30 over 4 GPUs, two should process 7 samples and two should process 8 samples each. We wouldn't be using all of the available GPU memory in that case and we would have to run more batches. There is a slowdown because of model synchronization between the GPUs when the back-propagation graph is brought together onto a single GPU to be stored. This occurs after each micro-batch is processed . \r\n\r\nI had looked at the MULTI-GPU EXAMPLES page that you referenced, but I chose to apply it on the whole model like they do in the [60 Minute Blitz tutorial](https://pytorch.org/tutorials/beginner/blitz/data_parallel_tutorial.html). ","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/436321806/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/437134608","html_url":"https://github.com/NRCan/geo-deep-learning/issues/17#issuecomment-437134608","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/17","id":437134608,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzEzNDYwOA==","user":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"created_at":"2018-11-08T19:56:12Z","updated_at":"2018-11-08T19:56:12Z","author_association":"COLLABORATOR","body":"@ymoisan  I may have responded too hastily to your last comment. I had made the assumption that our program was purely memory-bound and I was simply repeating what the pytorch devs answered to questions on GitHub and on PyTorch discussions. When the more complex computations are being done, GPU usage can reach 100% on multiple GPUs with a batch size of 120. I ran a test using DataParallel and the same configurations as my tests above but with a batch size of 30 as you suggested and noted the time required for completion and the GPU utilization.  \r\n\r\nThe available memory per GPU is 16160 MiB.\r\n\r\nBatch size | Training Time | GPU0 Memory Use (MiB) | GPU1 Memory Use (MiB) | GPU2 Memory Use (MiB) | GPU3 Memory Use (MiB) | GPU0 Utilization (%) | GPU1 Utilization (%) | GPU2 Utilization (%) | GPU3 Utilization (%)\r\n------------ | ------------- | ------------- | ------------- | ------------- | ------------- | ------------- | ------------- | ------------- | -------------\r\n30 | 67m 27s | 14465 | 14127 | 14127 | 13389 | 92 | 78 | 82 | 68\r\n\r\nIt took less time to complete the training with a batch size of 30 than 120. I will do some more tests to find the ideal batch size for our use case as well as try to find other causes for the slowdown.","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/437134608/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false}},{"id":1955270672,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTk1NTI3MDY3Mg==","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1955270672","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-11-08T19:56:13Z","performed_via_github_app":null},{"id":1955270673,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE5NTUyNzA2NzM=","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1955270673","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-11-08T19:56:13Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/437144391","html_url":"https://github.com/NRCan/geo-deep-learning/issues/17#issuecomment-437144391","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/17","id":437144391,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzE0NDM5MQ==","user":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"created_at":"2018-11-08T20:28:39Z","updated_at":"2018-11-08T20:28:39Z","author_association":"CONTRIBUTOR","body":"@epeterson12 : so with *batch_size=160* GPU utilization stats must have been much lower right ?","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/437144391/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false}},{"id":1955338862,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTk1NTMzODg2Mg==","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1955338862","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-11-08T20:28:39Z","performed_via_github_app":null},{"id":1955338863,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE5NTUzMzg4NjM=","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1955338863","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-11-08T20:28:39Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/437147846","html_url":"https://github.com/NRCan/geo-deep-learning/issues/17#issuecomment-437147846","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/17","id":437147846,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzE0Nzg0Ng==","user":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"created_at":"2018-11-08T20:40:25Z","updated_at":"2018-11-08T20:40:25Z","author_association":"COLLABORATOR","body":"@ymoisan : I get an *out of memory error* when trying to use a batch size higher than 120. At *batch_size=120* GPU Utilization is at 100% accross multiple GPUs and the Gpu memory use is 16049MiB for GPU0 and 15747MiB for the others. ","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/437147846/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false}},{"id":1955363067,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTk1NTM2MzA2Nw==","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1955363067","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-11-08T20:40:25Z","performed_via_github_app":null},{"id":1955363068,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE5NTUzNjMwNjg=","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1955363068","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-11-08T20:40:25Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/437155773","html_url":"https://github.com/NRCan/geo-deep-learning/issues/17#issuecomment-437155773","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/17","id":437155773,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzE1NTc3Mw==","user":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"created_at":"2018-11-08T21:06:07Z","updated_at":"2018-11-08T21:06:07Z","author_association":"CONTRIBUTOR","body":"@epeterson12 : sorry; I meant 120.  \r\n\r\nBut still, it doesn't make sense to me that the task that drives 4 GPUs at close to 100% utilization and memory (batch_size = 120) takes more time than one where GPU utilization is 92, 78, 82 and 68 % and overall less GPU RAM as shown above ... What are those GPUs doing ?\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/437155773/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false}},{"id":1955415967,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTk1NTQxNTk2Nw==","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1955415967","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-11-08T21:06:07Z","performed_via_github_app":null},{"id":1955415969,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE5NTU0MTU5Njk=","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1955415969","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-11-08T21:06:07Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/437167037","html_url":"https://github.com/NRCan/geo-deep-learning/issues/17#issuecomment-437167037","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/17","id":437167037,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzE2NzAzNw==","user":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"created_at":"2018-11-08T21:44:31Z","updated_at":"2018-11-08T21:44:31Z","author_association":"COLLABORATOR","body":"@ymoisan : I figured you meant 120, but I just wanted to be sure.\r\n\r\nI don't know why the GPU utilisation is so high either. Could it be some delay due to the GPU trying to decide what to do with all of the data that it is receiving? I found [this post](https://discuss.pytorch.org/t/debugging-dataparallel-no-speedup-and-uneven-memory-allocation/1100) from 2017 that really bothered me. In the end, the person gave up on using DataParallel in their convolutional network. I am wondering this type of network is ill suited for multi-gpu use...","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/437167037/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false}},{"id":1955495422,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTk1NTQ5NTQyMg==","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1955495422","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-11-08T21:44:31Z","performed_via_github_app":null},{"id":1955495424,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE5NTU0OTU0MjQ=","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1955495424","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-11-08T21:44:31Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/439101068","html_url":"https://github.com/NRCan/geo-deep-learning/issues/17#issuecomment-439101068","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/17","id":439101068,"node_id":"MDEyOklzc3VlQ29tbWVudDQzOTEwMTA2OA==","user":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"created_at":"2018-11-15T16:27:09Z","updated_at":"2018-11-15T20:33:26Z","author_association":"COLLABORATOR","body":"I ran[ bottleneck](https://pytorch.org/docs/stable/bottleneck.html) on single GPU and on 4 GPUs with DataParallel for train_model.py using a batch size of 30. Note: we have to set num_workers=0 in our DataLoaders in order to run bottleneck. \r\nHere are the outputs:\r\n[bottleneck_output_4gpu.txt](https://github.com/NRCan/geo-deep-learning/files/2585514/bottleneck_output_4gpu.txt)\r\n[bottleneck_output_1gpu.txt](https://github.com/NRCan/geo-deep-learning/files/2585515/bottleneck_output_1gpu.txt)\r\n\r\nComparing the cProfile output, which shows the function calls that take the most time, for cumtime (total time to run the function and all functions that it called) lets us identify where the relative slowdowns are when using 1 GPU and when using 4 GPUs with DataParallel. Here is a summary of my results:\r\n![comparing_bottlenecks](https://user-images.githubusercontent.com/43219583/48576411-72bc5c00-e8e2-11e8-9889-1cba7e1eea43.PNG)\r\n\r\nBased on these results, using 4 GPUs seems like it should be faster than using a single GPU. However, when testing total training time, the time to train is practically the same on 1 and on 4 GPUs and the cost to train on one graphics card is drastically lower than on 4 graphics cards. \r\n\r\n**Summary of test results on AWS with training over 100 epochs**\r\n\r\nGPUs Used | Batch Size | Training Time | Cost per hour for the EC2 Instance | Total Cost for Training\r\n------------ | ------------- | ------------- | ------------- | -------------\r\n1 x V100 | 30 | 78m 46s | $3.366 | $4.419\r\n4 x V100 | 30 | 67m 27s | $13.464 | $15.136\r\n4 x V100 | 120 | 82m 59s | $13.464 | $ 18.621\r\n\r\nThe synchronization delay doesn't seem to be the reason that DataParallel is no faster than using a single GPU in our tests, with the P2P connectivity being quite reasonable on the AWS VMs. \r\n![p2pbandwidthlatencytest](https://user-images.githubusercontent.com/43219583/48557202-1d695600-e8b4-11e8-921e-3994ae8fcf10.PNG)\r\n\r\n I don't think that it will be worth it to use multiple GPUs for training on AWS  because of the great price increase and the minimal acceleration of training with our model. ","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/439101068/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false}}]