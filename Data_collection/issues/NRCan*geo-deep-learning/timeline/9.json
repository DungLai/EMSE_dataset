[{"id":1871179408,"node_id":"MDEyOkxhYmVsZWRFdmVudDE4NzExNzk0MDg=","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1871179408","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-09-27T14:08:42Z","label":{"name":"P2","color":"bcbddc"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/425428026","html_url":"https://github.com/NRCan/geo-deep-learning/issues/9#issuecomment-425428026","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/9","id":425428026,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTQyODAyNg==","user":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"created_at":"2018-09-28T13:00:17Z","updated_at":"2018-09-28T13:40:45Z","author_association":"CONTRIBUTOR","body":"Can some kind of [co-routines/generators](https://stackoverflow.com/questions/1934715/difference-between-a-coroutine-and-a-thread) approach be useful here ?  Are there unnecessary copies of data structures in memory ?  **Check [how to generate your data in parallel with PyTorch](https://stanford.edu/~shervine/blog/pytorch-how-to-generate-data-parallel)**.","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/425428026/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false}},{"id":1876733000,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQxODc2NzMzMDAw","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1876733000","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2018-10-01T13:40:47Z","assignee":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/425988303","html_url":"https://github.com/NRCan/geo-deep-learning/issues/9#issuecomment-425988303","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/9","id":425988303,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTk4ODMwMw==","user":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"created_at":"2018-10-01T17:14:05Z","updated_at":"2018-10-01T19:14:46Z","author_association":"CONTRIBUTOR","body":"See https://github.com/pytorch/pytorch/issues/5210 and https://pytorch.org/docs/stable/bottleneck.html","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/425988303/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/426266598","html_url":"https://github.com/NRCan/geo-deep-learning/issues/9#issuecomment-426266598","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/9","id":426266598,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjI2NjU5OA==","user":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"created_at":"2018-10-02T13:08:06Z","updated_at":"2018-10-02T13:08:06Z","author_association":"COLLABORATOR","body":"Tests were performed using the `unet` network rather than `unetsmall` in order to force a memory error. The error occurred on line 102 of unet_pytorch.py under these conditions. Here is a summary of the observations thus far:\r\n\r\n- Deleting variables as they were no longer needed had no impact on memory usage (ex. `del maxpool1` after line 91 in unet_pytorch.py)\r\n- Adding `torch.cuda.empty_cache()` to the code gives back approximately 10 MB of GPU memory, which is too little to be an applicable solution\r\n- Convolution operations, which are quite heavy operations, are performed using CuDNN by Nvidia (closed source) which is optimized for performance on Nvidia GPUs. It is unlikely that we will be able to reduce memory use without building new modules. There seems to be a way to set a memory limit for the convolution in the [Caffe C++ source code](https://github.com/pytorch/pytorch/blob/master/caffe2/operators/conv_op_cudnn.cc#L750) used by Pytorch, but further investigation is needed to see how to use this in Pytorch.\r\n- Alternative: we could trade memory for computation and execution speed as described [here](https://github.com/prigoyal/pytorch_memonger/blob/master/tutorial/Checkpointing_for_PyTorch_models.ipynb) using gradient checkpointing to limit the size of the stored backpropagation graph. This isn't a good option since we want to keep training time as low as we can.","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/426266598/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/426269776","html_url":"https://github.com/NRCan/geo-deep-learning/issues/9#issuecomment-426269776","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/9","id":426269776,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjI2OTc3Ng==","user":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"created_at":"2018-10-02T13:17:48Z","updated_at":"2018-10-02T13:17:48Z","author_association":"CONTRIBUTOR","body":"@epeterson12 - interesting concept that we might want to look at : [tensor comprehensions](https://pytorch.org/blog/tensor-comprehensions/)\r\n\r\nAlso, this ticket might not be all that important after all.  PyTorch 1.0 will have a [compiler to make it faster](https://pytorch.org/blog/the-road-to-1_0/), which probably also means better on memory.","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/426269776/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false}},{"id":1879279328,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTg3OTI3OTMyOA==","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1879279328","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-10-02T13:17:48Z","performed_via_github_app":null},{"id":1879279329,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE4NzkyNzkzMjk=","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1879279329","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-10-02T13:17:48Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/426388802","html_url":"https://github.com/NRCan/geo-deep-learning/issues/9#issuecomment-426388802","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/9","id":426388802,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjM4ODgwMg==","user":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"created_at":"2018-10-02T18:50:00Z","updated_at":"2018-10-02T18:50:00Z","author_association":"CONTRIBUTOR","body":"@epeterson12 : the figures for checkpointing don't seem to be that bad.  In fact for one of the models checkpointing actually *decreases* gpu time.  I suggest we create some benchmarks to test.  `import torch.utils.checkpoint` works just fine in our environment so we could try the following:\r\n\r\n- confirm that a batch size > 32 with 256 X 256 samples does indeed trigger the error\r\n- try with checkpoint to see if the batch size goes through; increase batch size until memory crashes again\r\n\r\nMemory consumption and processing times could be monitored for all tests.  What do you think ? ","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/426388802/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false}},{"id":1880142452,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTg4MDE0MjQ1Mg==","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1880142452","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-10-02T18:50:00Z","performed_via_github_app":null},{"id":1880142454,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE4ODAxNDI0NTQ=","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1880142454","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-10-02T18:50:00Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/426391291","html_url":"https://github.com/NRCan/geo-deep-learning/issues/9#issuecomment-426391291","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/9","id":426391291,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjM5MTI5MQ==","user":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"created_at":"2018-10-02T18:57:52Z","updated_at":"2018-10-02T18:57:52Z","author_association":"COLLABORATOR","body":"@ymoisan I think that it would be a good idea to test our net using checkpointing. I will confirm that a batch size > 32 with 256 X 256 samples causes the error. I have started modifying our code in order to test checkpointing using[ this methodology](https://github.com/prigoyal/pytorch_memonger/blob/master/tutorial/Checkpointing_for_PyTorch_models.ipynb) I mentioned in my previous comment.","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/426391291/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false}},{"id":1880160330,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTg4MDE2MDMzMA==","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1880160330","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-10-02T18:57:52Z","performed_via_github_app":null},{"id":1880160332,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE4ODAxNjAzMzI=","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1880160332","actor":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-10-02T18:57:52Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/426402331","html_url":"https://github.com/NRCan/geo-deep-learning/issues/9#issuecomment-426402331","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/9","id":426402331,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjQwMjMzMQ==","user":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"created_at":"2018-10-02T19:35:04Z","updated_at":"2018-10-02T19:35:04Z","author_association":"COLLABORATOR","body":"It turns out that the maximum batch size that we can currently handle with a sample size of 256x256 is 33 when using the `unetsmall` net and 15 when using the `unet` net with our current hardware and version of the code. Beyond these quantities, we get the out of memory error.","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/426402331/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/430730328","html_url":"https://github.com/NRCan/geo-deep-learning/issues/9#issuecomment-430730328","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/9","id":430730328,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMDczMDMyOA==","user":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"created_at":"2018-10-17T18:06:41Z","updated_at":"2018-10-17T18:06:41Z","author_association":"COLLABORATOR","body":"Using checkpointing in the unetsmall net increases the speed of training. Tests were performed using the following parameters:\r\n\r\n  \\# Training Samples | \\# Validation Samples | Sample Size | \\# Classes | \\# Epochs \r\n------------ | ------------- | ------------ | ------------- |------------\r\n781 | 495 | 256 | 11 | 200 \r\n\r\n Learning Rate | Weight Decay | Step Size | Gamma | Class Weights | Dropout\r\n------------- |------------ | ------------- |------------ | ------------- | ------------- \r\n0.0001 | 0 | 4 | 0.9 | False | False\r\n\r\n![memory_usage_by_batch_size](https://user-images.githubusercontent.com/43219583/47087092-27326780-d1e9-11e8-8b3e-7e1f9c666225.png)\r\n![processing_time_by_batch_size](https://user-images.githubusercontent.com/43219583/47087096-2a2d5800-d1e9-11e8-8733-734590962318.png)\r\n\r\n**Best results**\r\n\r\n . | Original | Checkpointed\r\n------------ | ------------- | -------------\r\nMax batch size | 32 | 50\r\nTime to complete training over 200 epochs | 350 min | 316 min\r\n\r\nUsing checkpoints in the net design does seem to affect the results of the training. Tests were done on the original and on the checkpointed nets while setting the random seed to 7 and the models outputted gave similar but slightly different results. In the first test, the original algorithm gave results closer to the ground truth. In the second tests, the checkpointed version of the net yielded better results. \r\n","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/430730328/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/433411206","html_url":"https://github.com/NRCan/geo-deep-learning/issues/9#issuecomment-433411206","issue_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/9","id":433411206,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMzQxMTIwNg==","user":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"created_at":"2018-10-26T13:40:42Z","updated_at":"2018-10-26T13:40:42Z","author_association":"COLLABORATOR","body":"# Validation of Checkpointed results\r\nResults when using checkpointing are slightly different from those of the original unetsmall model because CudNN has non-deterministic kernels. I ran tests using suggestions from pytorch discussions https://discuss.pytorch.org/t/non-reproducible-result-with-gpu/1831 and https://discuss.pytorch.org/t/deterministic-non-deterministic-results-with-pytorch/9087. \r\n\r\nUsing the same sample files, I ran train_model.py twice using the unetsmall model (batch_size = 32) and I ran it once using the checkpointed_unet model (batch_size = 50). Then, I classified some images with the resulting models. \r\n\r\nThe settings to try to get reproducible results were set as follows at the beginning of the code:\r\n\r\n```\r\ntorch.backends.cudnn.deterministic = True\r\ntorch.manual_seed(999)\r\ntorch.cuda.manual_seed(999)\r\ntorch.cuda.manual_seed_all(999)\r\nrandom.seed(0)\r\n```\r\nAlso, in the DataLoaders, the parameters used for the instantiation had `num_workers = 0` and `shuffle = False`\r\nRunning the original unetsmall configuration without checkpoints 2 times yielded two slightly different results. Here are some examples of the results obtained when running image_classification.py on one of the training images with each trained model. Sections if the images that weren’t classified were left white.\r\n\r\n\r\nGround Truth | Current Code | Current Code 2| Checkpointed\r\n------------ | ------------- | ------------- | ------------- \r\n![1_rgb_8000_8000_ground_truth](https://user-images.githubusercontent.com/43219583/47567480-aa943d00-d8fc-11e8-8092-85d21576950f.PNG) | ![1_rgb_8000_8000_original](https://user-images.githubusercontent.com/43219583/47567491-b3850e80-d8fc-11e8-825e-188c30900701.PNG) | ![1_rgb_8000_8000_original2](https://user-images.githubusercontent.com/43219583/47567506-baac1c80-d8fc-11e8-9e68-3468a1703d3d.PNG) | ![1_rgb_8000_8000_checkpoint](https://user-images.githubusercontent.com/43219583/47567516-c3045780-d8fc-11e8-9ed4-f75017466593.PNG)\r\n![1_rgb_0_0_ground_truth](https://user-images.githubusercontent.com/43219583/47567554-dfa08f80-d8fc-11e8-8b8c-39dfda02d006.PNG) | ![1_rgb_0_0_original](https://user-images.githubusercontent.com/43219583/47567563-e4fdda00-d8fc-11e8-9f81-9bf022cd36b2.PNG) | ![1_rgb_0_0_original2](https://user-images.githubusercontent.com/43219583/47567581-edeeab80-d8fc-11e8-8dd4-89cdf6da8b0c.PNG) | ![1_rgb_0_0_checkpoint](https://user-images.githubusercontent.com/43219583/47567592-f34bf600-d8fc-11e8-8958-555acdf1ee86.PNG)\r\n![on_5297_1_ground_truth](https://user-images.githubusercontent.com/43219583/47568283-b84ac200-d8fe-11e8-8e09-fdbaac947aa4.PNG) | ![on_5297_1_original](https://user-images.githubusercontent.com/43219583/47568304-c0a2fd00-d8fe-11e8-9f71-5b3d9ed7b675.PNG) | ![on_5297_1_original2](https://user-images.githubusercontent.com/43219583/47568313-c6004780-d8fe-11e8-8649-d80a00ace0b6.PNG) | ![on_5297_1_checkpointed](https://user-images.githubusercontent.com/43219583/47568322-c993ce80-d8fe-11e8-95b0-46925dfc7f10.PNG)\r\n\r\n\r\nPlease note that the configurations and the number of samples weren't set to yield optimal results. Verifying reproducibility was the goal of these tests. The number of training samples was set to the number of samples produced during the samples creation. \r\n\r\n```\r\nglobal:\r\n  samples_size: 256\r\n  num_classes: 5\r\n  data_path: /my/data/path\r\n  number_of_bands: 3\r\n  model_name: unetsmall     # One of unet, unetsmall, checkpointed_unet or ternausnet\r\n\r\nsample:\r\n  prep_csv_file: /my/prep/csv/file\r\n  samples_dist: 200\r\n  remove_background: True\r\n  mask_input_image: False\r\n\r\ntraining:\r\n  output_path: /my/output/path\r\n  num_trn_samples: 3356\r\n  num_val_samples: 1370\r\n  batch_size: 32\r\n  num_epochs: 100\r\n  learning_rate: 0.0001\r\n  weight_decay: 0\r\n  step_size: 4\r\n  gamma: 0.9\r\n  class_weights: False\r\n\r\nmodels:\r\n  unet:   &unet001\r\n    dropout: False\r\n    probability: 0.2    # Set with dropout\r\n    pretrained: False   # optional\r\n  unetsmall:\r\n    <<: *unet001\r\n  ternausnet:\r\n    pretrained: ./models/TernausNet.pt    # Mandatory\r\n  checkpointed_unet: \r\n    <<: *unet001\r\n```\r\nI think that the results of the checkpointed_unet are similar enough to the unetsmall’s results for us to consider that it is a good memory and time optimised version of our unetsmall net architecture. I have added it as a model choice for our program.\r\n\r\nThroughout my tests, I observed that the models produced by training are more accurate when the randoms aren’t seeded. The checkpointed_unet, observationally,  seems to be more affected by this then the unetsmall.\r\n","reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/comments/433411206/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false}},{"id":1937988281,"node_id":"MDExOkNsb3NlZEV2ZW50MTkzNzk4ODI4MQ==","url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/events/1937988281","actor":{"login":"epeterson12","id":43219583,"node_id":"MDQ6VXNlcjQzMjE5NTgz","avatar_url":"https://avatars.githubusercontent.com/u/43219583?v=4","gravatar_id":"","url":"https://api.github.com/users/epeterson12","html_url":"https://github.com/epeterson12","followers_url":"https://api.github.com/users/epeterson12/followers","following_url":"https://api.github.com/users/epeterson12/following{/other_user}","gists_url":"https://api.github.com/users/epeterson12/gists{/gist_id}","starred_url":"https://api.github.com/users/epeterson12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epeterson12/subscriptions","organizations_url":"https://api.github.com/users/epeterson12/orgs","repos_url":"https://api.github.com/users/epeterson12/repos","events_url":"https://api.github.com/users/epeterson12/events{/privacy}","received_events_url":"https://api.github.com/users/epeterson12/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2018-10-31T14:12:36Z","state_reason":null,"performed_via_github_app":null}]