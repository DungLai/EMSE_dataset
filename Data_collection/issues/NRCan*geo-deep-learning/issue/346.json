{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/346","repository_url":"https://api.github.com/repos/NRCan/geo-deep-learning","labels_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/346/labels{/name}","comments_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/346/comments","events_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/346/events","html_url":"https://github.com/NRCan/geo-deep-learning/issues/346","id":1381404602,"node_id":"I_kwDOCNASdM5SVo-6","number":346,"title":"Use NODATA mask to avoid out of bounds extractions","user":{"login":"micpilon","id":46534635,"node_id":"MDQ6VXNlcjQ2NTM0NjM1","avatar_url":"https://avatars.githubusercontent.com/u/46534635?v=4","gravatar_id":"","url":"https://api.github.com/users/micpilon","html_url":"https://github.com/micpilon","followers_url":"https://api.github.com/users/micpilon/followers","following_url":"https://api.github.com/users/micpilon/following{/other_user}","gists_url":"https://api.github.com/users/micpilon/gists{/gist_id}","starred_url":"https://api.github.com/users/micpilon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/micpilon/subscriptions","organizations_url":"https://api.github.com/users/micpilon/orgs","repos_url":"https://api.github.com/users/micpilon/repos","events_url":"https://api.github.com/users/micpilon/events{/privacy}","received_events_url":"https://api.github.com/users/micpilon/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-09-21T19:36:27Z","updated_at":"2022-09-23T15:57:02Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"The extraction of our models is done on the whole extent of the images without considering the NODATA. Frequently we get false positives - especially from water -  in the out of bounds area since the band used for extraction exploits the entire 0-255 value range without dedicating any slot to the NODATA. It would be preferable to mask the extractions outside the valid area of the image.\r\n\r\n![image (3)](https://user-images.githubusercontent.com/46534635/191588581-73f57ed8-094b-4081-a196-2eccae93cc59.png)\r\n\r\nIn the STAC storage structure that is used as input for the extraction, each \"single-band COG\" actually includes 2 bands - one for the actual 8-bit dataset and one for its mask.\r\n\r\nThe mask band is a 8-bit binary array with 0s and 255s\r\n \r\n<img width=\"228\" alt=\"mask_image\" src=\"https://user-images.githubusercontent.com/46534635/191594522-369686a6-3597-4713-b8ea-3645893a12be.PNG\">\r\n\r\n**gdalinfo** \r\n> Band 1 Block=512x512 Type=Byte, ColorInterp=Gray\r\n>   Overviews: 11214x16710, 5607x8355, 2803x4177, 1401x2088, 700x1044, 350x522, 175x261\r\n>   Mask Flags: PER_DATASET\r\n>   Overviews of mask band: 11214x16710, 5607x8355, 2803x4177, 1401x2088, 700x1044, 350x522, 175x261\r\n\r\n**rasterio**\r\n> import rasterio\r\n> src = rasterio.open(\"/path/to/data\")\r\n> msk = src.read_masks(1)\r\n\r\n\r\nMy suggestion would be to append a step by the end of the inference process to apply the mask to the extraction raster to remove any out of bounds features.\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/346/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/346/timeline","performed_via_github_app":null,"state_reason":null}