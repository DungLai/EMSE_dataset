{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/241","repository_url":"https://api.github.com/repos/NRCan/geo-deep-learning","labels_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/241/labels{/name}","comments_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/241/comments","events_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/241/events","html_url":"https://github.com/NRCan/geo-deep-learning/issues/241","id":1113915011,"node_id":"I_kwDOCNASdM5CZP6D","number":241,"title":"Dockerfile should be optimized to generate a smaller runtime image","user":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-01-25T13:51:55Z","updated_at":"2022-02-03T16:21:51Z","closed_at":"2022-02-03T16:21:51Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Hodgepodge of reasons:\r\n\r\n- don't use a single layer image; \"always create your own base image layer for your OS, another layer for the username definition, another layer for the runtime installation, another layer for the configuration, and finally another layer for your application (a.k.a [multi-stage images](https://docs.docker.com/develop/develop-images/multistage-build/))¹\r\n-  what matters is the size of the frequently changing layers. And that’s what should be minimized ... layers that are changed most frequently should be created last ... Having a smaller Docker image is generally desirable ... for a number of reasons like reducing the attack surface ... - When a Docker image is uploaded or downloaded (pushed or pulled), each image layer is transferred separately. The layers that already exist at the destination are not transferred at all ... In plain English: the first transfer takes the hit. In the following runs, only the new (frequently changing) layers need to be transferred. And their size depends on the image structure. A somewhat exceptional situation is a CI/CD service. In such setups, computing resources are temporary, so pulled Docker images don’t persist between runs. Because of that, the entire image has to be pulled again and again on each step of the pipeline²\r\n-  docker containers support the implementation of CI/CD in development. Image size and build efficiency are important factors when overseeing and working with the microservice architecture. This is why you should try to keep your Docker images small³\r\n- bundle commands in `RUN` commands.  Layers are like git commits. Docker layers store the difference between the previous and the current version of the image. When a Git repository becomes bigger, you can choose to squash the history into a single commit and forget about the past.  It turns out you can do something similar in Docker too with a multi-stage build.⁴\r\n- The benefits of using a smaller image for interpreted languages are similar to those for compiled languages: Kubernetes will be able to quickly pull all of the necessary container images onto new nodes to begin doing meaningful work.^^5\r\n\r\n¹ https://developers.redhat.com/blog/2016/02/24/10-things-to-avoid-in-docker-containers\r\n² https://semaphoreci.com/blog/2018/03/14/docker-image-size.html\r\n³ https://phoenixnap.com/kb/docker-image-size\r\n⁴ https://learnk8s.io/blog/smaller-docker-images\r\n^^5 https://www.digitalocean.com/community/tutorials/architecting-applications-for-kubernetes","closed_by":{"login":"ymoisan","id":7468595,"node_id":"MDQ6VXNlcjc0Njg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/7468595?v=4","gravatar_id":"","url":"https://api.github.com/users/ymoisan","html_url":"https://github.com/ymoisan","followers_url":"https://api.github.com/users/ymoisan/followers","following_url":"https://api.github.com/users/ymoisan/following{/other_user}","gists_url":"https://api.github.com/users/ymoisan/gists{/gist_id}","starred_url":"https://api.github.com/users/ymoisan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymoisan/subscriptions","organizations_url":"https://api.github.com/users/ymoisan/orgs","repos_url":"https://api.github.com/users/ymoisan/repos","events_url":"https://api.github.com/users/ymoisan/events{/privacy}","received_events_url":"https://api.github.com/users/ymoisan/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/241/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/241/timeline","performed_via_github_app":null,"state_reason":"completed"}