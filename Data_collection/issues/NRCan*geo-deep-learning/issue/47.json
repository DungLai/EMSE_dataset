{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/47","repository_url":"https://api.github.com/repos/NRCan/geo-deep-learning","labels_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/47/labels{/name}","comments_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/47/comments","events_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/47/events","html_url":"https://github.com/NRCan/geo-deep-learning/issues/47","id":405702166,"node_id":"MDU6SXNzdWU0MDU3MDIxNjY=","number":47,"title":"AWS - Entity too large when calling the PutObject operation","user":{"login":"mpelchat04","id":38693210,"node_id":"MDQ6VXNlcjM4NjkzMjEw","avatar_url":"https://avatars.githubusercontent.com/u/38693210?v=4","gravatar_id":"","url":"https://api.github.com/users/mpelchat04","html_url":"https://github.com/mpelchat04","followers_url":"https://api.github.com/users/mpelchat04/followers","following_url":"https://api.github.com/users/mpelchat04/following{/other_user}","gists_url":"https://api.github.com/users/mpelchat04/gists{/gist_id}","starred_url":"https://api.github.com/users/mpelchat04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mpelchat04/subscriptions","organizations_url":"https://api.github.com/users/mpelchat04/orgs","repos_url":"https://api.github.com/users/mpelchat04/repos","events_url":"https://api.github.com/users/mpelchat04/events{/privacy}","received_events_url":"https://api.github.com/users/mpelchat04/received_events","type":"User","site_admin":false},"labels":[{"id":1049334784,"node_id":"MDU6TGFiZWwxMDQ5MzM0Nzg0","url":"https://api.github.com/repos/NRCan/geo-deep-learning/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2019-02-01T13:29:10Z","updated_at":"2019-02-04T14:48:03Z","closed_at":"2019-02-04T14:48:03Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"During the create samples step, this error occurs, on AWS,:  \r\n\r\n```shell\r\nNumber of samples created:  {'trn': 13005, 'val': 5523}\r\nTransfering Samples to the bucket\r\nTraceback (most recent call last):\r\n  File \"images_to_samples.py\", line 276, in <module>\r\n    params['sample']['mask_reference'])\r\n  File \"images_to_samples.py\", line 245, in main\r\n    bucket.put_object(Key=final_samples_folder + '/trn_samples.hdf5', Body=trn_samples)\r\n  File \"/home/ec2-user/miniconda3/lib/python3.6/site-packages/boto3/resources/factory.py\", line 520, in do_action\r\n    response = action(self, *args, **kwargs)\r\n  File \"/home/ec2-user/miniconda3/lib/python3.6/site-packages/boto3/resources/action.py\", line 83, in __call__\r\n    response = getattr(parent.meta.client, operation_name)(**params)\r\n  File \"/home/ec2-user/miniconda3/lib/python3.6/site-packages/botocore/client.py\", line 320, in _api_call\r\n    return self._make_api_call(operation_name, kwargs)\r\n  File \"/home/ec2-user/miniconda3/lib/python3.6/site-packages/botocore/client.py\", line 623, in _make_api_call\r\n    raise error_class(parsed_response, operation_name)\r\nbotocore.exceptions.ClientError: An error occurred (EntityTooLarge) when calling the PutObject operation: Your proposed upload exceeds the maximum allowed size\r\n\r\n```\r\nThis happens when transferring the hdf5 files `trn_samples.hdf5` and `val_samples.hdf5` to the s3 bucket. In our code, the error is located [here](https://github.com/NRCan/geo-deep-learning/blob/master/images_to_samples.py#L233).  \r\n\r\nThe function `put_object` should be replaced with `upload_file`. \r\nLink to a stack overflow thread explaining the difference between the two functions: https://stackoverflow.com/questions/43739415/what-is-the-difference-between-file-upload-and-put-object-when-uploading-fil  \r\n\r\nLink to boto 3 `upload_file` function: https://boto3.amazonaws.com/v1/documentation/api/latest/guide/s3.html#uploads\r\n","closed_by":{"login":"mpelchat04","id":38693210,"node_id":"MDQ6VXNlcjM4NjkzMjEw","avatar_url":"https://avatars.githubusercontent.com/u/38693210?v=4","gravatar_id":"","url":"https://api.github.com/users/mpelchat04","html_url":"https://github.com/mpelchat04","followers_url":"https://api.github.com/users/mpelchat04/followers","following_url":"https://api.github.com/users/mpelchat04/following{/other_user}","gists_url":"https://api.github.com/users/mpelchat04/gists{/gist_id}","starred_url":"https://api.github.com/users/mpelchat04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mpelchat04/subscriptions","organizations_url":"https://api.github.com/users/mpelchat04/orgs","repos_url":"https://api.github.com/users/mpelchat04/repos","events_url":"https://api.github.com/users/mpelchat04/events{/privacy}","received_events_url":"https://api.github.com/users/mpelchat04/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/47/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/47/timeline","performed_via_github_app":null,"state_reason":"completed"}