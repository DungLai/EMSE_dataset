{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/210","repository_url":"https://api.github.com/repos/NRCan/geo-deep-learning","labels_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/210/labels{/name}","comments_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/210/comments","events_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/210/events","html_url":"https://github.com/NRCan/geo-deep-learning/issues/210","id":1024518194,"node_id":"I_kwDOCNASdM49EOgy","number":210,"title":"train_segmentation.py: string decode error in create_dataset.py","user":{"login":"krishanr","id":16637530,"node_id":"MDQ6VXNlcjE2NjM3NTMw","avatar_url":"https://avatars.githubusercontent.com/u/16637530?v=4","gravatar_id":"","url":"https://api.github.com/users/krishanr","html_url":"https://github.com/krishanr","followers_url":"https://api.github.com/users/krishanr/followers","following_url":"https://api.github.com/users/krishanr/following{/other_user}","gists_url":"https://api.github.com/users/krishanr/gists{/gist_id}","starred_url":"https://api.github.com/users/krishanr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krishanr/subscriptions","organizations_url":"https://api.github.com/users/krishanr/orgs","repos_url":"https://api.github.com/users/krishanr/repos","events_url":"https://api.github.com/users/krishanr/events{/privacy}","received_events_url":"https://api.github.com/users/krishanr/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-10-12T22:27:56Z","updated_at":"2021-11-03T16:43:18Z","closed_at":"2021-11-03T16:43:18Z","author_association":"NONE","active_lock_reason":null,"body":"Hi all,\r\n        I ran the latest version of GDL, commit hash d00c443, and ran into an error with train_segmentation.py. I ran images_to_samples.py with no errors or warnings. Then when running train_segmentation.py, I obtained the following error:\r\n\r\n```\r\nERROR:root:Couldn't load MAnet from segmentation models pytorch package. Check installed version\r\nTraceback (most recent call last):\r\n  File \"geo-deep-learning/models/model_choice.py\", line 62, in <module>\r\n    'fct': smp.MAnet, 'params': {\r\nAttributeError: module 'segmentation_models_pytorch' has no attribute 'MAnet'\r\nStart\r\n\r\n2021-10-12 18:18:16,588 root 611 [INFO][main] Model and log files will be saved to: data/raw/mining4/samples256_overlap5_min-annot0_3bands_gdl-training/model/mining4\r\n\r\n\r\n2021-10-12 18:18:16,588 root 613 [WARNING][main] Debug mode activated. Some debug features may mobilize extra disk space and cause delays in execution.\r\n2021-10-12 18:18:16,700 root 116 [DEBUG][get_device_ids] GPU RAM used: 0.07940514205012733 (9/11019 MiB)\r\nGPU % used: 0\r\n2021-10-12 18:18:16,707 root 116 [DEBUG][get_device_ids] GPU RAM used: 0.07940514205012733 (9/11019 MiB)\r\nGPU % used: 0\r\n2021-10-12 18:18:16,707 root 623 [INFO][main] GPUs devices available: {0: {'used_ram_at_init': 8.75, 'max_ram': 11019.4375}, 1: {'used_ram_at_init': 8.75, 'max_ram': 11019.4375}}\r\n2021-10-12 18:18:16,708 root 627 [INFO][main] Creating dataloaders from data in data/raw/mining4/samples256_overlap5_min-annot0_3bands_gdl-training...\r\n\r\n2021-10-12 18:18:17,702 root 94 [INFO][create_dataloader] Number of samples : {'trn': 393, 'val': 26, 'tst': 401}\r\n\r\n2021-10-12 18:18:17,702 root 107 [WARNING][compose_transforms] No normalization of raster values will be performed.\r\n2021-10-12 18:18:17,760 root 107 [WARNING][compose_transforms] No normalization of raster values will be performed.\r\n2021-10-12 18:18:17,812 root 107 [WARNING][compose_transforms] No normalization of raster values will be performed.\r\n2021-10-12 18:18:17,988 root 116 [DEBUG][get_device_ids] GPU RAM used: 0.07940514205012733 (9/11019 MiB)\r\nGPU % used: 0\r\n2021-10-12 18:18:17,988 root 116 [DEBUG][get_device_ids] GPU RAM used: 0.07940514205012733 (9/11019 MiB)\r\nGPU % used: 0\r\n2021-10-12 18:18:17,989 root 268 [INFO][net] Number of cuda devices requested: 2. Cuda devices available: [0, 1]\r\n\r\n2021-10-12 18:18:17,989 root 273 [INFO][net] Using data parallel on devices: [1]. Main device: 'cuda:0'\r\n2021-10-12 18:18:17,992 root 285 [INFO][net] Setting model, criterion, optimizer and learning rate scheduler...\r\n\r\n2021-10-12 18:18:19,465 root 671 [INFO][main] Instantiated unet model with 6 output channels.\r\n\r\n2021-10-12 18:18:19,485 git.cmd 719 [DEBUG][execute] Popen(['git', 'version'], cwd=geo-deep-learning, universal_newlines=False, shell=None, istream=None)\r\n2021-10-12 18:18:19,546 git.cmd 719 [DEBUG][execute] Popen(['git', 'version'], cwd=geo-deep-learning, universal_newlines=False, shell=None, istream=None)\r\n2021-10-12 18:18:19,612 git.cmd 719 [DEBUG][execute] Popen(['git', 'cat-file', '--batch-check'], cwd=geo-deep-learning, universal_newlines=False, shell=None, istream=<valid stream>)\r\n2021-10-12 18:18:19,678 root 712 [INFO][main] Visualizing initialized model on batch range [0, 200, 10] from val dataset...\r\n\r\n2021-10-12 18:18:19,678 root 228 [INFO][vis_from_dataloader] Visualization figures will be saved to data/raw/mining4/samples256_overlap5_min-annot0_3bands_gdl-training/model/mining4/visualization\r\n\r\n  0%|                                                                                                  | 0/6 [00:00<?, ?it/s]\r\nTraceback (most recent call last):\r\n  File \"train_segmentation.py\", line 847, in <module>\r\n    main(params, config_path)\r\n  File \"train_segmentation.py\", line 722, in main\r\n    vis_batch_range=vis_batch_range)\r\n  File \"train_segmentation.py\", line 233, in vis_from_dataloader\r\n    for batch_index, data in enumerate(_tqdm):\r\n  File \"anaconda3/envs/geo_deep_env/lib/python3.7/site-packages/tqdm/std.py\", line 1104, in __iter__\r\n    for obj in iterable:\r\n  File \"anaconda3/envs/geo_deep_env/lib/python3.7/site-packages/torch/utils/data/dataloader.py\", line 345, in __next__\r\n    data = self._next_data()\r\n  File \"anaconda3/envs/geo_deep_env/lib/python3.7/site-packages/torch/utils/data/dataloader.py\", line 856, in _next_data\r\n    return self._process_data(data)\r\n  File \"anaconda3/envs/geo_deep_env/lib/python3.7/site-packages/torch/utils/data/dataloader.py\", line 881, in _process_data\r\n    data.reraise()\r\n  File \"anaconda3/envs/geo_deep_env/lib/python3.7/site-packages/torch/_utils.py\", line 394, in reraise\r\n    raise self.exc_type(msg)\r\nAttributeError: Caught AttributeError in DataLoader worker process 0.\r\nOriginal Traceback (most recent call last):\r\n  File \"anaconda3/envs/geo_deep_env/lib/python3.7/site-packages/torch/utils/data/_utils/worker.py\", line 178, in _worker_loop\r\n    data = fetcher.fetch(index)\r\n  File \"anaconda3/envs/geo_deep_env/lib/python3.7/site-packages/torch/utils/data/_utils/fetch.py\", line 44, in fetch\r\n    data = [self.dataset[idx] for idx in possibly_batched_index]\r\n  File \"anaconda3/envs/geo_deep_env/lib/python3.7/site-packages/torch/utils/data/_utils/fetch.py\", line 44, in <listcomp>\r\n    data = [self.dataset[idx] for idx in possibly_batched_index]\r\n  File \"geo-deep-learning/utils/create_dataset.py\", line 134, in __getitem__\r\n    sample_metadata = eval(sample_metadata.decode('UTF-8'))\r\nAttributeError: 'str' object has no attribute 'decode'\r\n```\r\n\r\nHowever, I didn't run into any such issues when running GDL with commit hash 97e6046. I'm also using unet, so I don't think the MAnet model load failure is the source of the problem.","closed_by":{"login":"krishanr","id":16637530,"node_id":"MDQ6VXNlcjE2NjM3NTMw","avatar_url":"https://avatars.githubusercontent.com/u/16637530?v=4","gravatar_id":"","url":"https://api.github.com/users/krishanr","html_url":"https://github.com/krishanr","followers_url":"https://api.github.com/users/krishanr/followers","following_url":"https://api.github.com/users/krishanr/following{/other_user}","gists_url":"https://api.github.com/users/krishanr/gists{/gist_id}","starred_url":"https://api.github.com/users/krishanr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krishanr/subscriptions","organizations_url":"https://api.github.com/users/krishanr/orgs","repos_url":"https://api.github.com/users/krishanr/repos","events_url":"https://api.github.com/users/krishanr/events{/privacy}","received_events_url":"https://api.github.com/users/krishanr/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/210/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/NRCan/geo-deep-learning/issues/210/timeline","performed_via_github_app":null,"state_reason":"completed"}