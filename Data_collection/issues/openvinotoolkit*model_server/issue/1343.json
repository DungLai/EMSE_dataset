{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/1343","repository_url":"https://api.github.com/repos/openvinotoolkit/model_server","labels_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/1343/labels{/name}","comments_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/1343/comments","events_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/1343/events","html_url":"https://github.com/openvinotoolkit/model_server/issues/1343","id":1331462815,"node_id":"I_kwDOCPfP385PXIKf","number":1343,"title":"Dynamic Shape models forbidden in  DAG Scheduler?","user":{"login":"luvwinnie","id":13714992,"node_id":"MDQ6VXNlcjEzNzE0OTky","avatar_url":"https://avatars.githubusercontent.com/u/13714992?v=4","gravatar_id":"","url":"https://api.github.com/users/luvwinnie","html_url":"https://github.com/luvwinnie","followers_url":"https://api.github.com/users/luvwinnie/followers","following_url":"https://api.github.com/users/luvwinnie/following{/other_user}","gists_url":"https://api.github.com/users/luvwinnie/gists{/gist_id}","starred_url":"https://api.github.com/users/luvwinnie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/luvwinnie/subscriptions","organizations_url":"https://api.github.com/users/luvwinnie/orgs","repos_url":"https://api.github.com/users/luvwinnie/repos","events_url":"https://api.github.com/users/luvwinnie/events{/privacy}","received_events_url":"https://api.github.com/users/luvwinnie/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-08-08T07:39:28Z","updated_at":"2022-09-02T13:28:49Z","closed_at":"2022-09-02T13:28:49Z","author_association":"NONE","active_lock_reason":null,"body":"I have a feature extractor with input shape (-1,-1,-1,-1)  which refers to (b,c,h,w) and output of (-1,-1,512) refers to (b,num_steps,512). I write a config file with following model_config_list and try to make a simple pipeline. However it seems like the DAG Scheduler not allow to use dynamic parameters? Can anyone help me with this?\r\n\r\nOS: Ubuntu 20.04LTS\r\nDocker Container: openvino/model_server:latest\r\n\r\n```\r\n{\r\n    \"model_config_list\": [\r\n        {\r\n            \"config\": {\r\n                \"name\": \"feature_extractor\",\r\n                \"base_path\": \"/opt/ml/models/feature_extractor\",\r\n                \"shape\": \"auto\"\r\n            },\r\n            \"plugin_config\": {\r\n                \"CPU_THROUGHPUT_STREAMS\": \"CPU_THROUGHPUT_AUTO\"\r\n            }\r\n        }\r\n    ],\r\n    \"pipeline_config_list\": [\r\n        {\r\n            \"name\": \"general_model\",\r\n            \"inputs\": [\r\n                \"inputs\"\r\n            ],\r\n            \"nodes\": [\r\n                {\r\n                    \"name\": \"feature_extractor\",\r\n                    \"model_name\": \"feature_extractor\",\r\n                    \"type\": \"DL model\",\r\n                    \"inputs\": [\r\n                        {\r\n                            \"input\": {\r\n                                \"node_name\": \"request\",\r\n                                \"data_item\": \"inputs\"\r\n                            }\r\n                        }\r\n                    ],\r\n                    \"outputs\": [\r\n                        {\r\n                            \"data_item\": \"cnn_features\",\r\n                            \"alias\": \"cnn_output\"\r\n                        }\r\n                    ]\r\n                }\r\n            ],\r\n            \"outputs\": [\r\n                {\r\n                    \"label\": {\r\n                        \"node_name\": \"feature_extractor\",\r\n                        \"data_item\": \"cnn_output\"\r\n                    }\r\n                }\r\n            ]\r\n        }\r\n    ]\r\n}\r\n\r\n```\r\n\r\n```\r\n[2022-08-08 07:36:31.675][1][modelmanager][info][modelmanager.cpp:110] Available devices for Open VINO: CPU, GNA\r\n[2022-08-08 07:36:31.679][1][serving][info][model.cpp:38] Getting model from /opt/ml/models/feature_extractor\r\n[2022-08-08 07:36:31.679][1][serving][info][model.cpp:45] Model downloaded to /opt/ml/models/feature_extractor\r\n[2022-08-08 07:36:31.679][1][serving][info][model.cpp:145] Will add model: feature_extractor; version: 1 ...\r\n[2022-08-08 07:36:31.679][1][serving][info][modelversionstatus.cpp:109] STATUS CHANGE: Version 1 of model feature_extractor status change. New status: ( \"state\": \"START\", \"error_code\": \"OK\" )\r\n[2022-08-08 07:36:31.679][1][serving][info][modelinstance.cpp:870] Loading model: feature_extractor, version: 1, from path: /opt/ml/models/feature_extractor/1, with target device: CPU ...\r\n[2022-08-08 07:36:31.679][1][serving][info][modelinstance.cpp:875] Some inputs shapes for model feature_extractor are set to auto\r\n[2022-08-08 07:36:31.679][1][serving][info][modelversionstatus.cpp:109] STATUS CHANGE: Version 1 of model feature_extractor status change. New status: ( \"state\": \"START\", \"error_code\": \"OK\" )\r\n[2022-08-08 07:36:31.679][1][serving][info][modelversionstatus.cpp:109] STATUS CHANGE: Version 1 of model feature_extractor status change. New status: ( \"state\": \"LOADING\", \"error_code\": \"OK\" )\r\n[2022-08-08 07:36:31.840][1][modelmanager][info][modelinstance.cpp:414] Input name: inputs; mapping_name: inputs; shape: (-1,-1,-1,-1); precision: FP32; layout: N...\r\n[2022-08-08 07:36:31.840][1][modelmanager][info][modelinstance.cpp:465] Output name: cnn_features; mapping_name: cnn_features; shape: (-1,-1,512); precision: FP32; layout: N...\r\n[2022-08-08 07:36:31.960][1][modelmanager][info][modelinstance.cpp:688] Plugin config for device: CPU\r\n[2022-08-08 07:36:31.960][1][modelmanager][info][modelinstance.cpp:692] OVMS set plugin settings key: CPU_THROUGHPUT_STREAMS; value: CPU_THROUGHPUT_AUTO;\r\n[2022-08-08 07:36:31.961][1][serving][info][modelinstance.cpp:771] Loaded model feature_extractor; version: 1; batch size: -1; No of InferRequests: 5\r\n[2022-08-08 07:36:31.961][1][serving][info][modelversionstatus.cpp:109] STATUS CHANGE: Version 1 of model feature_extractor status change. New status: ( \"state\": \"AVAILABLE\", \"error_code\": \"OK\" )\r\n[2022-08-08 07:36:31.961][1][serving][info][model.cpp:85] Updating default version for model: feature_extractor, from: 0\r\n[2022-08-08 07:36:31.961][1][serving][info][model.cpp:95] Updated default version for model: feature_extractor, to: 1\r\n[2022-08-08 07:36:31.961][1][modelmanager][info][modelmanager.cpp:447] Configuration file doesn't have custom node libraries property.\r\n[2022-08-08 07:36:31.961][1][modelmanager][info][modelmanager.cpp:332] Reading pipeline: general_model configuration\r\n[2022-08-08 07:36:31.961][1][serving][info][modelchangesubscription.cpp:25] Subscription to model: feature_extractor from general_model\r\n[2022-08-08 07:36:31.961][1][modelmanager][error][pipelinedefinition.cpp:414] Validation of pipeline: general_model definition failed. Node name: feature_extractor used model name: feature_extractor with dynamic batch/shape parameter which is forbidden.\r\n[2022-08-08 07:36:31.961][1][modelmanager][info][pipelinedefinitionstatus.hpp:75] Pipeline: general_model state changed to: LOADING_PRECONDITION_FAILED after handling: ValidationFailedEvent:\r\n[2022-08-08 07:36:31.961][1][modelmanager][error][pipeline_factory.cpp:63] Validation of pipeline definition: general_model failed: Value of provided parameter is forbidden\r\n[2022-08-08 07:36:31.961][63][modelmanager][info][modelmanager.cpp:832] Started model manager thread\r\n[2022-08-08 07:36:31.961][64][modelmanager][info][modelmanager.cpp:850] Started cleaner thread```\r\n\r\n```\r\n\r\n\r\nI hope that using DAG Scheduler to inference my input to output. Currently I need to use the following method to inference which slower than directly using Pytorch on CPU.\r\n\r\n\r\n```\r\n        features = client.predict({\"inputs\": input_data}, \"feature_extractor\")\r\n        output = client.predict({\"inputs\":features}, \"encoder\")\r\n        preds = client.predict({\"inputs\":output[\"features\"]}, \"classifier\")\r\n```","closed_by":{"login":"luvwinnie","id":13714992,"node_id":"MDQ6VXNlcjEzNzE0OTky","avatar_url":"https://avatars.githubusercontent.com/u/13714992?v=4","gravatar_id":"","url":"https://api.github.com/users/luvwinnie","html_url":"https://github.com/luvwinnie","followers_url":"https://api.github.com/users/luvwinnie/followers","following_url":"https://api.github.com/users/luvwinnie/following{/other_user}","gists_url":"https://api.github.com/users/luvwinnie/gists{/gist_id}","starred_url":"https://api.github.com/users/luvwinnie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/luvwinnie/subscriptions","organizations_url":"https://api.github.com/users/luvwinnie/orgs","repos_url":"https://api.github.com/users/luvwinnie/repos","events_url":"https://api.github.com/users/luvwinnie/events{/privacy}","received_events_url":"https://api.github.com/users/luvwinnie/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/1343/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/1343/timeline","performed_via_github_app":null,"state_reason":"completed"}