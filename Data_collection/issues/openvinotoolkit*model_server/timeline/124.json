[{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573349304","html_url":"https://github.com/openvinotoolkit/model_server/issues/124#issuecomment-573349304","issue_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/124","id":573349304,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzM0OTMwNA==","user":{"login":"dkurt","id":25801568,"node_id":"MDQ6VXNlcjI1ODAxNTY4","avatar_url":"https://avatars.githubusercontent.com/u/25801568?v=4","gravatar_id":"","url":"https://api.github.com/users/dkurt","html_url":"https://github.com/dkurt","followers_url":"https://api.github.com/users/dkurt/followers","following_url":"https://api.github.com/users/dkurt/following{/other_user}","gists_url":"https://api.github.com/users/dkurt/gists{/gist_id}","starred_url":"https://api.github.com/users/dkurt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkurt/subscriptions","organizations_url":"https://api.github.com/users/dkurt/orgs","repos_url":"https://api.github.com/users/dkurt/repos","events_url":"https://api.github.com/users/dkurt/events{/privacy}","received_events_url":"https://api.github.com/users/dkurt/received_events","type":"User","site_admin":false},"created_at":"2020-01-11T19:57:32Z","updated_at":"2020-01-11T19:57:32Z","author_association":"NONE","body":"/cc @dtrawins ","reactions":{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573349304/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkurt","id":25801568,"node_id":"MDQ6VXNlcjI1ODAxNTY4","avatar_url":"https://avatars.githubusercontent.com/u/25801568?v=4","gravatar_id":"","url":"https://api.github.com/users/dkurt","html_url":"https://github.com/dkurt","followers_url":"https://api.github.com/users/dkurt/followers","following_url":"https://api.github.com/users/dkurt/following{/other_user}","gists_url":"https://api.github.com/users/dkurt/gists{/gist_id}","starred_url":"https://api.github.com/users/dkurt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkurt/subscriptions","organizations_url":"https://api.github.com/users/dkurt/orgs","repos_url":"https://api.github.com/users/dkurt/repos","events_url":"https://api.github.com/users/dkurt/events{/privacy}","received_events_url":"https://api.github.com/users/dkurt/received_events","type":"User","site_admin":false}},{"id":2940810837,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjk0MDgxMDgzNw==","url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/events/2940810837","actor":{"login":"dtrawins","id":20400806,"node_id":"MDQ6VXNlcjIwNDAwODA2","avatar_url":"https://avatars.githubusercontent.com/u/20400806?v=4","gravatar_id":"","url":"https://api.github.com/users/dtrawins","html_url":"https://github.com/dtrawins","followers_url":"https://api.github.com/users/dtrawins/followers","following_url":"https://api.github.com/users/dtrawins/following{/other_user}","gists_url":"https://api.github.com/users/dtrawins/gists{/gist_id}","starred_url":"https://api.github.com/users/dtrawins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dtrawins/subscriptions","organizations_url":"https://api.github.com/users/dtrawins/orgs","repos_url":"https://api.github.com/users/dtrawins/repos","events_url":"https://api.github.com/users/dtrawins/events{/privacy}","received_events_url":"https://api.github.com/users/dtrawins/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-11T19:57:32Z","performed_via_github_app":null},{"id":2940810838,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5NDA4MTA4Mzg=","url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/events/2940810838","actor":{"login":"dtrawins","id":20400806,"node_id":"MDQ6VXNlcjIwNDAwODA2","avatar_url":"https://avatars.githubusercontent.com/u/20400806?v=4","gravatar_id":"","url":"https://api.github.com/users/dtrawins","html_url":"https://github.com/dtrawins","followers_url":"https://api.github.com/users/dtrawins/followers","following_url":"https://api.github.com/users/dtrawins/following{/other_user}","gists_url":"https://api.github.com/users/dtrawins/gists{/gist_id}","starred_url":"https://api.github.com/users/dtrawins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dtrawins/subscriptions","organizations_url":"https://api.github.com/users/dtrawins/orgs","repos_url":"https://api.github.com/users/dtrawins/repos","events_url":"https://api.github.com/users/dtrawins/events{/privacy}","received_events_url":"https://api.github.com/users/dtrawins/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-11T19:57:32Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573554059","html_url":"https://github.com/openvinotoolkit/model_server/issues/124#issuecomment-573554059","issue_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/124","id":573554059,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzU1NDA1OQ==","user":{"login":"dkurt","id":25801568,"node_id":"MDQ6VXNlcjI1ODAxNTY4","avatar_url":"https://avatars.githubusercontent.com/u/25801568?v=4","gravatar_id":"","url":"https://api.github.com/users/dkurt","html_url":"https://github.com/dkurt","followers_url":"https://api.github.com/users/dkurt/followers","following_url":"https://api.github.com/users/dkurt/following{/other_user}","gists_url":"https://api.github.com/users/dkurt/gists{/gist_id}","starred_url":"https://api.github.com/users/dkurt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkurt/subscriptions","organizations_url":"https://api.github.com/users/dkurt/orgs","repos_url":"https://api.github.com/users/dkurt/repos","events_url":"https://api.github.com/users/dkurt/events{/privacy}","received_events_url":"https://api.github.com/users/dkurt/received_events","type":"User","site_admin":false},"created_at":"2020-01-13T08:24:34Z","updated_at":"2020-01-13T08:25:47Z","author_association":"NONE","body":"Update: with `make docker_build_apt_ubuntu` install and `nireq = 32` and\r\n```\r\n--nireq 4 --grpc_workers 8 --plugin_config \"{\\\"CPU_THROUGHPUT_STREAMS\\\": \\\"4\\\"}\"\r\n```\r\n9.29 FPS (x0.75 of target)\r\n\r\n```python\r\nnireq = 32\r\n\r\nfutures = [stub.Predict.future(request, 5.0) for i in range(nireq)]\r\nfor future in futures:\r\n    future.result()\r\n\r\n\r\nstart = time.time()\r\nn = 64\r\nfor i in range(n // nireq):\r\n    futures = [stub.Predict.future(request, 5.0) for i in range(nireq)]\r\n    for future in futures:\r\n        future.result()\r\n\r\nprint((time.time() - start) / n)\r\n```","reactions":{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573554059/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkurt","id":25801568,"node_id":"MDQ6VXNlcjI1ODAxNTY4","avatar_url":"https://avatars.githubusercontent.com/u/25801568?v=4","gravatar_id":"","url":"https://api.github.com/users/dkurt","html_url":"https://github.com/dkurt","followers_url":"https://api.github.com/users/dkurt/followers","following_url":"https://api.github.com/users/dkurt/following{/other_user}","gists_url":"https://api.github.com/users/dkurt/gists{/gist_id}","starred_url":"https://api.github.com/users/dkurt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkurt/subscriptions","organizations_url":"https://api.github.com/users/dkurt/orgs","repos_url":"https://api.github.com/users/dkurt/repos","events_url":"https://api.github.com/users/dkurt/events{/privacy}","received_events_url":"https://api.github.com/users/dkurt/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573559926","html_url":"https://github.com/openvinotoolkit/model_server/issues/124#issuecomment-573559926","issue_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/124","id":573559926,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzU1OTkyNg==","user":{"login":"dkurt","id":25801568,"node_id":"MDQ6VXNlcjI1ODAxNTY4","avatar_url":"https://avatars.githubusercontent.com/u/25801568?v=4","gravatar_id":"","url":"https://api.github.com/users/dkurt","html_url":"https://github.com/dkurt","followers_url":"https://api.github.com/users/dkurt/followers","following_url":"https://api.github.com/users/dkurt/following{/other_user}","gists_url":"https://api.github.com/users/dkurt/gists{/gist_id}","starred_url":"https://api.github.com/users/dkurt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkurt/subscriptions","organizations_url":"https://api.github.com/users/dkurt/orgs","repos_url":"https://api.github.com/users/dkurt/repos","events_url":"https://api.github.com/users/dkurt/events{/privacy}","received_events_url":"https://api.github.com/users/dkurt/received_events","type":"User","site_admin":false},"created_at":"2020-01-13T08:43:03Z","updated_at":"2020-01-13T08:43:03Z","author_association":"NONE","body":"Hmm, even a simple local app without async gives more FPS (11.05 (x0.90 of target))\r\n\r\nI'll check if it's because of usage of `IECore` or not\r\n\r\n```python\r\nimport numpy as np\r\nimport time\r\nfrom openvino.inference_engine import IENetwork, IECore\r\n\r\nnet = IENetwork('graph.xml', 'graph.bin')\r\n\r\nie = IECore()\r\nie.add_extension('libcpu_extension_avx2.so', \"CPU\")\r\nexec_net = ie.load_network(net, 'CPU')\r\n\r\ninput_ids = np.random.randint(0, 255, (1, 128))\r\ninput_mask = np.random.randint(0, 255, (1, 128))\r\ninput_type_ids = np.random.randint(0, 255, (1, 128))\r\n\r\noutputs = exec_net.infer(inputs={'input_ids': input_ids,\r\n                                 'input_mask': input_mask,\r\n                                 'input_type_ids': input_type_ids})\r\nn = 64\r\nstart = time.time()\r\nfor i in range(n):\r\n    exec_net.infer(inputs={'input_ids': input_ids,\r\n                           'input_mask': input_mask,\r\n                           'input_type_ids': input_type_ids})\r\nprint(n / (time.time() - start))\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573559926/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkurt","id":25801568,"node_id":"MDQ6VXNlcjI1ODAxNTY4","avatar_url":"https://avatars.githubusercontent.com/u/25801568?v=4","gravatar_id":"","url":"https://api.github.com/users/dkurt","html_url":"https://github.com/dkurt","followers_url":"https://api.github.com/users/dkurt/followers","following_url":"https://api.github.com/users/dkurt/following{/other_user}","gists_url":"https://api.github.com/users/dkurt/gists{/gist_id}","starred_url":"https://api.github.com/users/dkurt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkurt/subscriptions","organizations_url":"https://api.github.com/users/dkurt/orgs","repos_url":"https://api.github.com/users/dkurt/repos","events_url":"https://api.github.com/users/dkurt/events{/privacy}","received_events_url":"https://api.github.com/users/dkurt/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573693172","html_url":"https://github.com/openvinotoolkit/model_server/issues/124#issuecomment-573693172","issue_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/124","id":573693172,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzY5MzE3Mg==","user":{"login":"dkurt","id":25801568,"node_id":"MDQ6VXNlcjI1ODAxNTY4","avatar_url":"https://avatars.githubusercontent.com/u/25801568?v=4","gravatar_id":"","url":"https://api.github.com/users/dkurt","html_url":"https://github.com/dkurt","followers_url":"https://api.github.com/users/dkurt/followers","following_url":"https://api.github.com/users/dkurt/following{/other_user}","gists_url":"https://api.github.com/users/dkurt/gists{/gist_id}","starred_url":"https://api.github.com/users/dkurt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkurt/subscriptions","organizations_url":"https://api.github.com/users/dkurt/orgs","repos_url":"https://api.github.com/users/dkurt/repos","events_url":"https://api.github.com/users/dkurt/events{/privacy}","received_events_url":"https://api.github.com/users/dkurt/received_events","type":"User","site_admin":false},"created_at":"2020-01-13T14:37:11Z","updated_at":"2020-01-13T14:37:11Z","author_association":"NONE","body":"It seems to me that the problem in `prepare_output_as_list` method:\r\n\r\nreplacing\r\n```python\r\n output_tensor = tensor_pb2.TensorProto(\r\n     dtype=dtype.as_datatype_enum,\r\n     tensor_shape=tensor_shape.as_shape(\r\n         inference_output[value].shape).as_proto())\r\n result = inference_output[value].flatten()\r\n tensor_util._NP_TO_APPEND_FN[dtype.as_numpy_dtype](output_tensor,\r\n                                                    result)\r\n```\r\nto\r\n```\r\noutput_tensor = tf.make_tensor_proto(inference_output[value].flatten())\r\n```\r\ngives about 11.9 FPS with the https://github.com/IntelAI/OpenVINO-model-server/issues/124#issuecomment-573554059\r\n\r\nGoing to check the accuracy","reactions":{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573693172/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkurt","id":25801568,"node_id":"MDQ6VXNlcjI1ODAxNTY4","avatar_url":"https://avatars.githubusercontent.com/u/25801568?v=4","gravatar_id":"","url":"https://api.github.com/users/dkurt","html_url":"https://github.com/dkurt","followers_url":"https://api.github.com/users/dkurt/followers","following_url":"https://api.github.com/users/dkurt/following{/other_user}","gists_url":"https://api.github.com/users/dkurt/gists{/gist_id}","starred_url":"https://api.github.com/users/dkurt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkurt/subscriptions","organizations_url":"https://api.github.com/users/dkurt/orgs","repos_url":"https://api.github.com/users/dkurt/repos","events_url":"https://api.github.com/users/dkurt/events{/privacy}","received_events_url":"https://api.github.com/users/dkurt/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573700990","html_url":"https://github.com/openvinotoolkit/model_server/issues/124#issuecomment-573700990","issue_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/124","id":573700990,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzcwMDk5MA==","user":{"login":"mzegla","id":41325006,"node_id":"MDQ6VXNlcjQxMzI1MDA2","avatar_url":"https://avatars.githubusercontent.com/u/41325006?v=4","gravatar_id":"","url":"https://api.github.com/users/mzegla","html_url":"https://github.com/mzegla","followers_url":"https://api.github.com/users/mzegla/followers","following_url":"https://api.github.com/users/mzegla/following{/other_user}","gists_url":"https://api.github.com/users/mzegla/gists{/gist_id}","starred_url":"https://api.github.com/users/mzegla/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mzegla/subscriptions","organizations_url":"https://api.github.com/users/mzegla/orgs","repos_url":"https://api.github.com/users/mzegla/repos","events_url":"https://api.github.com/users/mzegla/events{/privacy}","received_events_url":"https://api.github.com/users/mzegla/received_events","type":"User","site_admin":false},"created_at":"2020-01-13T14:53:24Z","updated_at":"2020-01-13T14:53:24Z","author_association":"COLLABORATOR","body":"Hi,\r\nIndeed, we were notified that in some cases, for some models, serialization method might be the issue, when it comes to getting performance similar to plain OpenVINO.\r\nI believe @dtrawins has an open pull request regarding that issue:\r\nhttps://github.com/IntelAI/OpenVINO-model-server/pull/119/files\r\ndoing basically what you did with `make_tensor_proto`.\r\n\r\nYou can also run OVMS with LOG_LEVEL=DEBUG env to see how much time it takes to deserialize, infer and serialize each request.","reactions":{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573700990/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mzegla","id":41325006,"node_id":"MDQ6VXNlcjQxMzI1MDA2","avatar_url":"https://avatars.githubusercontent.com/u/41325006?v=4","gravatar_id":"","url":"https://api.github.com/users/mzegla","html_url":"https://github.com/mzegla","followers_url":"https://api.github.com/users/mzegla/followers","following_url":"https://api.github.com/users/mzegla/following{/other_user}","gists_url":"https://api.github.com/users/mzegla/gists{/gist_id}","starred_url":"https://api.github.com/users/mzegla/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mzegla/subscriptions","organizations_url":"https://api.github.com/users/mzegla/orgs","repos_url":"https://api.github.com/users/mzegla/repos","events_url":"https://api.github.com/users/mzegla/events{/privacy}","received_events_url":"https://api.github.com/users/mzegla/received_events","type":"User","site_admin":false}},{"id":2943487957,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjk0MzQ4Nzk1Nw==","url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/events/2943487957","actor":{"login":"dtrawins","id":20400806,"node_id":"MDQ6VXNlcjIwNDAwODA2","avatar_url":"https://avatars.githubusercontent.com/u/20400806?v=4","gravatar_id":"","url":"https://api.github.com/users/dtrawins","html_url":"https://github.com/dtrawins","followers_url":"https://api.github.com/users/dtrawins/followers","following_url":"https://api.github.com/users/dtrawins/following{/other_user}","gists_url":"https://api.github.com/users/dtrawins/gists{/gist_id}","starred_url":"https://api.github.com/users/dtrawins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dtrawins/subscriptions","organizations_url":"https://api.github.com/users/dtrawins/orgs","repos_url":"https://api.github.com/users/dtrawins/repos","events_url":"https://api.github.com/users/dtrawins/events{/privacy}","received_events_url":"https://api.github.com/users/dtrawins/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-13T14:53:24Z","performed_via_github_app":null},{"id":2943487968,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5NDM0ODc5Njg=","url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/events/2943487968","actor":{"login":"dtrawins","id":20400806,"node_id":"MDQ6VXNlcjIwNDAwODA2","avatar_url":"https://avatars.githubusercontent.com/u/20400806?v=4","gravatar_id":"","url":"https://api.github.com/users/dtrawins","html_url":"https://github.com/dtrawins","followers_url":"https://api.github.com/users/dtrawins/followers","following_url":"https://api.github.com/users/dtrawins/following{/other_user}","gists_url":"https://api.github.com/users/dtrawins/gists{/gist_id}","starred_url":"https://api.github.com/users/dtrawins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dtrawins/subscriptions","organizations_url":"https://api.github.com/users/dtrawins/orgs","repos_url":"https://api.github.com/users/dtrawins/repos","events_url":"https://api.github.com/users/dtrawins/events{/privacy}","received_events_url":"https://api.github.com/users/dtrawins/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-13T14:53:24Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573705256","html_url":"https://github.com/openvinotoolkit/model_server/issues/124#issuecomment-573705256","issue_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/124","id":573705256,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzcwNTI1Ng==","user":{"login":"dkurt","id":25801568,"node_id":"MDQ6VXNlcjI1ODAxNTY4","avatar_url":"https://avatars.githubusercontent.com/u/25801568?v=4","gravatar_id":"","url":"https://api.github.com/users/dkurt","html_url":"https://github.com/dkurt","followers_url":"https://api.github.com/users/dkurt/followers","following_url":"https://api.github.com/users/dkurt/following{/other_user}","gists_url":"https://api.github.com/users/dkurt/gists{/gist_id}","starred_url":"https://api.github.com/users/dkurt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkurt/subscriptions","organizations_url":"https://api.github.com/users/dkurt/orgs","repos_url":"https://api.github.com/users/dkurt/repos","events_url":"https://api.github.com/users/dkurt/events{/privacy}","received_events_url":"https://api.github.com/users/dkurt/received_events","type":"User","site_admin":false},"created_at":"2020-01-13T15:01:27Z","updated_at":"2020-01-13T15:01:27Z","author_association":"NONE","body":"@mzegla, You're right, thanks! So it only requires an update corresponding the latest master branch.\r\n\r\nYep, I found that deserialization takes a lot of time thanks to LOG_LEVEL.","reactions":{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573705256/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkurt","id":25801568,"node_id":"MDQ6VXNlcjI1ODAxNTY4","avatar_url":"https://avatars.githubusercontent.com/u/25801568?v=4","gravatar_id":"","url":"https://api.github.com/users/dkurt","html_url":"https://github.com/dkurt","followers_url":"https://api.github.com/users/dkurt/followers","following_url":"https://api.github.com/users/dkurt/following{/other_user}","gists_url":"https://api.github.com/users/dkurt/gists{/gist_id}","starred_url":"https://api.github.com/users/dkurt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkurt/subscriptions","organizations_url":"https://api.github.com/users/dkurt/orgs","repos_url":"https://api.github.com/users/dkurt/repos","events_url":"https://api.github.com/users/dkurt/events{/privacy}","received_events_url":"https://api.github.com/users/dkurt/received_events","type":"User","site_admin":false}},{"id":2943521131,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjk0MzUyMTEzMQ==","url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/events/2943521131","actor":{"login":"mzegla","id":41325006,"node_id":"MDQ6VXNlcjQxMzI1MDA2","avatar_url":"https://avatars.githubusercontent.com/u/41325006?v=4","gravatar_id":"","url":"https://api.github.com/users/mzegla","html_url":"https://github.com/mzegla","followers_url":"https://api.github.com/users/mzegla/followers","following_url":"https://api.github.com/users/mzegla/following{/other_user}","gists_url":"https://api.github.com/users/mzegla/gists{/gist_id}","starred_url":"https://api.github.com/users/mzegla/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mzegla/subscriptions","organizations_url":"https://api.github.com/users/mzegla/orgs","repos_url":"https://api.github.com/users/mzegla/repos","events_url":"https://api.github.com/users/mzegla/events{/privacy}","received_events_url":"https://api.github.com/users/mzegla/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-13T15:01:27Z","performed_via_github_app":null},{"id":2943521132,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5NDM1MjExMzI=","url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/events/2943521132","actor":{"login":"mzegla","id":41325006,"node_id":"MDQ6VXNlcjQxMzI1MDA2","avatar_url":"https://avatars.githubusercontent.com/u/41325006?v=4","gravatar_id":"","url":"https://api.github.com/users/mzegla","html_url":"https://github.com/mzegla","followers_url":"https://api.github.com/users/mzegla/followers","following_url":"https://api.github.com/users/mzegla/following{/other_user}","gists_url":"https://api.github.com/users/mzegla/gists{/gist_id}","starred_url":"https://api.github.com/users/mzegla/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mzegla/subscriptions","organizations_url":"https://api.github.com/users/mzegla/orgs","repos_url":"https://api.github.com/users/mzegla/repos","events_url":"https://api.github.com/users/mzegla/events{/privacy}","received_events_url":"https://api.github.com/users/mzegla/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-13T15:01:27Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573713048","html_url":"https://github.com/openvinotoolkit/model_server/issues/124#issuecomment-573713048","issue_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/124","id":573713048,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzcxMzA0OA==","user":{"login":"mzegla","id":41325006,"node_id":"MDQ6VXNlcjQxMzI1MDA2","avatar_url":"https://avatars.githubusercontent.com/u/41325006?v=4","gravatar_id":"","url":"https://api.github.com/users/mzegla","html_url":"https://github.com/mzegla","followers_url":"https://api.github.com/users/mzegla/followers","following_url":"https://api.github.com/users/mzegla/following{/other_user}","gists_url":"https://api.github.com/users/mzegla/gists{/gist_id}","starred_url":"https://api.github.com/users/mzegla/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mzegla/subscriptions","organizations_url":"https://api.github.com/users/mzegla/orgs","repos_url":"https://api.github.com/users/mzegla/repos","events_url":"https://api.github.com/users/mzegla/events{/privacy}","received_events_url":"https://api.github.com/users/mzegla/received_events","type":"User","site_admin":false},"created_at":"2020-01-13T15:16:51Z","updated_at":"2020-01-13T15:16:51Z","author_association":"COLLABORATOR","body":"@dkurt You're welcome 😄 \r\nWe still need to investigate how this change impacts compatibility since from what I know the output of that faster method is slightly different from current one. We might keep both and make it configurable as well. Either way I think we could introduce this improvement to master branch for our next release.\r\nSo yeah, for now you can use changes from `fast-serialize` branch. \r\nThanks for using OVMS and reporting that issue 😃 \r\n","reactions":{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573713048/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mzegla","id":41325006,"node_id":"MDQ6VXNlcjQxMzI1MDA2","avatar_url":"https://avatars.githubusercontent.com/u/41325006?v=4","gravatar_id":"","url":"https://api.github.com/users/mzegla","html_url":"https://github.com/mzegla","followers_url":"https://api.github.com/users/mzegla/followers","following_url":"https://api.github.com/users/mzegla/following{/other_user}","gists_url":"https://api.github.com/users/mzegla/gists{/gist_id}","starred_url":"https://api.github.com/users/mzegla/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mzegla/subscriptions","organizations_url":"https://api.github.com/users/mzegla/orgs","repos_url":"https://api.github.com/users/mzegla/repos","events_url":"https://api.github.com/users/mzegla/events{/privacy}","received_events_url":"https://api.github.com/users/mzegla/received_events","type":"User","site_admin":false}},{"id":2943583636,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjk0MzU4MzYzNg==","url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/events/2943583636","actor":{"login":"dkurt","id":25801568,"node_id":"MDQ6VXNlcjI1ODAxNTY4","avatar_url":"https://avatars.githubusercontent.com/u/25801568?v=4","gravatar_id":"","url":"https://api.github.com/users/dkurt","html_url":"https://github.com/dkurt","followers_url":"https://api.github.com/users/dkurt/followers","following_url":"https://api.github.com/users/dkurt/following{/other_user}","gists_url":"https://api.github.com/users/dkurt/gists{/gist_id}","starred_url":"https://api.github.com/users/dkurt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkurt/subscriptions","organizations_url":"https://api.github.com/users/dkurt/orgs","repos_url":"https://api.github.com/users/dkurt/repos","events_url":"https://api.github.com/users/dkurt/events{/privacy}","received_events_url":"https://api.github.com/users/dkurt/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-13T15:16:51Z","performed_via_github_app":null},{"id":2943583638,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5NDM1ODM2Mzg=","url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/events/2943583638","actor":{"login":"dkurt","id":25801568,"node_id":"MDQ6VXNlcjI1ODAxNTY4","avatar_url":"https://avatars.githubusercontent.com/u/25801568?v=4","gravatar_id":"","url":"https://api.github.com/users/dkurt","html_url":"https://github.com/dkurt","followers_url":"https://api.github.com/users/dkurt/followers","following_url":"https://api.github.com/users/dkurt/following{/other_user}","gists_url":"https://api.github.com/users/dkurt/gists{/gist_id}","starred_url":"https://api.github.com/users/dkurt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkurt/subscriptions","organizations_url":"https://api.github.com/users/dkurt/orgs","repos_url":"https://api.github.com/users/dkurt/repos","events_url":"https://api.github.com/users/dkurt/events{/privacy}","received_events_url":"https://api.github.com/users/dkurt/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-13T15:16:51Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573716380","html_url":"https://github.com/openvinotoolkit/model_server/issues/124#issuecomment-573716380","issue_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/124","id":573716380,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzcxNjM4MA==","user":{"login":"dkurt","id":25801568,"node_id":"MDQ6VXNlcjI1ODAxNTY4","avatar_url":"https://avatars.githubusercontent.com/u/25801568?v=4","gravatar_id":"","url":"https://api.github.com/users/dkurt","html_url":"https://github.com/dkurt","followers_url":"https://api.github.com/users/dkurt/followers","following_url":"https://api.github.com/users/dkurt/following{/other_user}","gists_url":"https://api.github.com/users/dkurt/gists{/gist_id}","starred_url":"https://api.github.com/users/dkurt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkurt/subscriptions","organizations_url":"https://api.github.com/users/dkurt/orgs","repos_url":"https://api.github.com/users/dkurt/repos","events_url":"https://api.github.com/users/dkurt/events{/privacy}","received_events_url":"https://api.github.com/users/dkurt/received_events","type":"User","site_admin":false},"created_at":"2020-01-13T15:23:11Z","updated_at":"2020-01-13T15:23:11Z","author_association":"NONE","body":"@mzegla, I just checked that for my model the following patch gives 0.0 maximal absolute difference between 4 output tensors:\r\n\r\n```patch\r\ndiff --git a/ie_serving/server/predict_utils.py b/ie_serving/server/predict_utils.py\r\nindex 3e75848..a6adf68 100644\r\n--- a/ie_serving/server/predict_utils.py\r\n+++ b/ie_serving/server/predict_utils.py\r\n@@ -17,6 +17,7 @@\r\n import falcon\r\n import numpy as np\r\n from grpc import StatusCode\r\n+import tensorflow as tf\r\n from tensorflow.core.framework import tensor_pb2\r\n from tensorflow.python.framework import tensor_shape\r\n from tensorflow_serving.apis import predict_pb2\r\n@@ -105,13 +106,7 @@ def prepare_output_as_list(inference_output, model_available_outputs):\r\n     for key, value in model_available_outputs.items():\r\n         if value in inference_output:\r\n             dtype = dtypes.as_dtype(inference_output[value].dtype)\r\n-            output_tensor = tensor_pb2.TensorProto(\r\n-                dtype=dtype.as_datatype_enum,\r\n-                tensor_shape=tensor_shape.as_shape(\r\n-                    inference_output[value].shape).as_proto())\r\n-            result = inference_output[value].flatten()\r\n-            tensor_util._NP_TO_APPEND_FN[dtype.as_numpy_dtype](output_tensor,\r\n-                                                               result)\r\n+            output_tensor = tf.make_tensor_proto(inference_output[value])\r\n             response.outputs[key].CopyFrom(output_tensor)\r\n     return response\r\n```\r\n\r\nsave with the patch:\r\n```python\r\n for i in range(4):\r\n     tensor = future.result().outputs[\"bert/encoder/Reshape_%d\" % (10 + i)]\r\n     shape = [dim.size for dim in tensor.tensor_shape.dim]\r\n     values = struct.unpack('f' * np.prod(shape), tensor.tensor_content)\r\n     np.save('out_%d' % i, np.array(values))\r\n```\r\n\r\nget the master prediction and compare:\r\n```python\r\nfor i in range(4):\r\n    tensor = future.result().outputs[\"bert/encoder/Reshape_%d\" % (10 + i)]\r\n    out = np.array(tensor.float_val)\r\n    ref = np.load('out_%d.npy' % i)\r\n\r\n    print(np.max(np.abs(out - ref)))\r\n```\r\n\r\noutput:\r\n```\r\n0.0\r\n0.0\r\n0.0\r\n0.0\r\n```","reactions":{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573716380/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkurt","id":25801568,"node_id":"MDQ6VXNlcjI1ODAxNTY4","avatar_url":"https://avatars.githubusercontent.com/u/25801568?v=4","gravatar_id":"","url":"https://api.github.com/users/dkurt","html_url":"https://github.com/dkurt","followers_url":"https://api.github.com/users/dkurt/followers","following_url":"https://api.github.com/users/dkurt/following{/other_user}","gists_url":"https://api.github.com/users/dkurt/gists{/gist_id}","starred_url":"https://api.github.com/users/dkurt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkurt/subscriptions","organizations_url":"https://api.github.com/users/dkurt/orgs","repos_url":"https://api.github.com/users/dkurt/repos","events_url":"https://api.github.com/users/dkurt/events{/privacy}","received_events_url":"https://api.github.com/users/dkurt/received_events","type":"User","site_admin":false}},{"id":2943609593,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjk0MzYwOTU5Mw==","url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/events/2943609593","actor":{"login":"mzegla","id":41325006,"node_id":"MDQ6VXNlcjQxMzI1MDA2","avatar_url":"https://avatars.githubusercontent.com/u/41325006?v=4","gravatar_id":"","url":"https://api.github.com/users/mzegla","html_url":"https://github.com/mzegla","followers_url":"https://api.github.com/users/mzegla/followers","following_url":"https://api.github.com/users/mzegla/following{/other_user}","gists_url":"https://api.github.com/users/mzegla/gists{/gist_id}","starred_url":"https://api.github.com/users/mzegla/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mzegla/subscriptions","organizations_url":"https://api.github.com/users/mzegla/orgs","repos_url":"https://api.github.com/users/mzegla/repos","events_url":"https://api.github.com/users/mzegla/events{/privacy}","received_events_url":"https://api.github.com/users/mzegla/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-13T15:23:11Z","performed_via_github_app":null},{"id":2943609599,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5NDM2MDk1OTk=","url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/events/2943609599","actor":{"login":"mzegla","id":41325006,"node_id":"MDQ6VXNlcjQxMzI1MDA2","avatar_url":"https://avatars.githubusercontent.com/u/41325006?v=4","gravatar_id":"","url":"https://api.github.com/users/mzegla","html_url":"https://github.com/mzegla","followers_url":"https://api.github.com/users/mzegla/followers","following_url":"https://api.github.com/users/mzegla/following{/other_user}","gists_url":"https://api.github.com/users/mzegla/gists{/gist_id}","starred_url":"https://api.github.com/users/mzegla/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mzegla/subscriptions","organizations_url":"https://api.github.com/users/mzegla/orgs","repos_url":"https://api.github.com/users/mzegla/repos","events_url":"https://api.github.com/users/mzegla/events{/privacy}","received_events_url":"https://api.github.com/users/mzegla/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-13T15:23:11Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573741173","html_url":"https://github.com/openvinotoolkit/model_server/issues/124#issuecomment-573741173","issue_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/124","id":573741173,"node_id":"MDEyOklzc3VlQ29tbWVudDU3Mzc0MTE3Mw==","user":{"login":"mzegla","id":41325006,"node_id":"MDQ6VXNlcjQxMzI1MDA2","avatar_url":"https://avatars.githubusercontent.com/u/41325006?v=4","gravatar_id":"","url":"https://api.github.com/users/mzegla","html_url":"https://github.com/mzegla","followers_url":"https://api.github.com/users/mzegla/followers","following_url":"https://api.github.com/users/mzegla/following{/other_user}","gists_url":"https://api.github.com/users/mzegla/gists{/gist_id}","starred_url":"https://api.github.com/users/mzegla/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mzegla/subscriptions","organizations_url":"https://api.github.com/users/mzegla/orgs","repos_url":"https://api.github.com/users/mzegla/repos","events_url":"https://api.github.com/users/mzegla/events{/privacy}","received_events_url":"https://api.github.com/users/mzegla/received_events","type":"User","site_admin":false},"created_at":"2020-01-13T16:11:58Z","updated_at":"2020-01-13T16:11:58Z","author_association":"COLLABORATOR","body":"Cool, so you got the same output with both master and patch. It seems that different serialization method doesn't mess up the inference results. Thanks for checking it on BERT model.","reactions":{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/573741173/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mzegla","id":41325006,"node_id":"MDQ6VXNlcjQxMzI1MDA2","avatar_url":"https://avatars.githubusercontent.com/u/41325006?v=4","gravatar_id":"","url":"https://api.github.com/users/mzegla","html_url":"https://github.com/mzegla","followers_url":"https://api.github.com/users/mzegla/followers","following_url":"https://api.github.com/users/mzegla/following{/other_user}","gists_url":"https://api.github.com/users/mzegla/gists{/gist_id}","starred_url":"https://api.github.com/users/mzegla/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mzegla/subscriptions","organizations_url":"https://api.github.com/users/mzegla/orgs","repos_url":"https://api.github.com/users/mzegla/repos","events_url":"https://api.github.com/users/mzegla/events{/privacy}","received_events_url":"https://api.github.com/users/mzegla/received_events","type":"User","site_admin":false}},{"id":3022852087,"node_id":"MDExOkNsb3NlZEV2ZW50MzAyMjg1MjA4Nw==","url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/events/3022852087","actor":{"login":"dkurt","id":25801568,"node_id":"MDQ6VXNlcjI1ODAxNTY4","avatar_url":"https://avatars.githubusercontent.com/u/25801568?v=4","gravatar_id":"","url":"https://api.github.com/users/dkurt","html_url":"https://github.com/dkurt","followers_url":"https://api.github.com/users/dkurt/followers","following_url":"https://api.github.com/users/dkurt/following{/other_user}","gists_url":"https://api.github.com/users/dkurt/gists{/gist_id}","starred_url":"https://api.github.com/users/dkurt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkurt/subscriptions","organizations_url":"https://api.github.com/users/dkurt/orgs","repos_url":"https://api.github.com/users/dkurt/repos","events_url":"https://api.github.com/users/dkurt/events{/privacy}","received_events_url":"https://api.github.com/users/dkurt/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-02-10T14:09:19Z","state_reason":null,"performed_via_github_app":null}]