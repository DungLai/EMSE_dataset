[{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/829106026","html_url":"https://github.com/openvinotoolkit/model_server/issues/640#issuecomment-829106026","issue_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/640","id":829106026,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTEwNjAyNg==","user":{"login":"atobiszei","id":36039266,"node_id":"MDQ6VXNlcjM2MDM5MjY2","avatar_url":"https://avatars.githubusercontent.com/u/36039266?v=4","gravatar_id":"","url":"https://api.github.com/users/atobiszei","html_url":"https://github.com/atobiszei","followers_url":"https://api.github.com/users/atobiszei/followers","following_url":"https://api.github.com/users/atobiszei/following{/other_user}","gists_url":"https://api.github.com/users/atobiszei/gists{/gist_id}","starred_url":"https://api.github.com/users/atobiszei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atobiszei/subscriptions","organizations_url":"https://api.github.com/users/atobiszei/orgs","repos_url":"https://api.github.com/users/atobiszei/repos","events_url":"https://api.github.com/users/atobiszei/events{/privacy}","received_events_url":"https://api.github.com/users/atobiszei/received_events","type":"User","site_admin":false},"created_at":"2021-04-29T10:07:32Z","updated_at":"2021-04-29T10:07:32Z","author_association":"COLLABORATOR","body":"Hi,\r\n\r\nWe are happy with your positive feedback :).\r\n\r\n> I would want to send 4 images into the pipeline, where the custom node would use the face detection results for each image to then output all of the faces detected across all of the images into the emotion detection model. I have not managed to get this working using a fixed nor dynamic batch size.\r\n> \r\n> My first question is, is the above example possible?\r\n\r\nThere is no possibility to change batch size to 2 if you use demultiplexer. Sending batch size > 1 could be impractical since you could have different number of faces detected on each image. Then the DAG would have to pack those which creates ambiguity how the output shape would look like since you should still be able to know from which image your detection was.\r\n\r\n> If so, how can I adjust the batch size or shape of the face detection model if the DAG pipeline limits batch size when using demultiplexer nodes?\r\nYou can edit the shape (just keep batch size equal 1).\r\n`\"shape\": \"(1, 3, 300, 300)\"`\r\n\r\nIf you are working on improving performance you could try:\r\n- sending multiple requests with batch 1 simultaneously\r\n- changing `CPU_THROUGHPUT_STREAMS` or/and `nireq` configuration per model (it may be called DEVICE_TYPE_THROUGHPUT_STREAMS - depends on hardware on which you run inference).\r\n\r\nSo for example for face-detection model you would change config to something like this:\r\n```\r\n         \"config\":{\r\n            \"name\":\"face-detection-retail-0004\",\r\n            \"base_path\":\"/opt/test/face-detection-retail-0004\"\r\n            \"plugin_config\": {\r\n                  \"CPU_THROUGHPUT_STREAMS\":  \"4\"\r\n             }\r\n            \"nireq\": 16\r\n         }\r\n```\r\nWhat the values should be is dependent on hardware used. I gave 4/16 as an example here.\r\n\r\nIf we would have more details about the use case then we could advise more. With current information we think that sending multiple requests simultaneously is the best path here.\r\n\r\nAdrian\r\n\r\n\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/829106026/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"atobiszei","id":36039266,"node_id":"MDQ6VXNlcjM2MDM5MjY2","avatar_url":"https://avatars.githubusercontent.com/u/36039266?v=4","gravatar_id":"","url":"https://api.github.com/users/atobiszei","html_url":"https://github.com/atobiszei","followers_url":"https://api.github.com/users/atobiszei/followers","following_url":"https://api.github.com/users/atobiszei/following{/other_user}","gists_url":"https://api.github.com/users/atobiszei/gists{/gist_id}","starred_url":"https://api.github.com/users/atobiszei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atobiszei/subscriptions","organizations_url":"https://api.github.com/users/atobiszei/orgs","repos_url":"https://api.github.com/users/atobiszei/repos","events_url":"https://api.github.com/users/atobiszei/events{/privacy}","received_events_url":"https://api.github.com/users/atobiszei/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/831813504","html_url":"https://github.com/openvinotoolkit/model_server/issues/640#issuecomment-831813504","issue_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/640","id":831813504,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMTgxMzUwNA==","user":{"login":"Steedance","id":45638338,"node_id":"MDQ6VXNlcjQ1NjM4MzM4","avatar_url":"https://avatars.githubusercontent.com/u/45638338?v=4","gravatar_id":"","url":"https://api.github.com/users/Steedance","html_url":"https://github.com/Steedance","followers_url":"https://api.github.com/users/Steedance/followers","following_url":"https://api.github.com/users/Steedance/following{/other_user}","gists_url":"https://api.github.com/users/Steedance/gists{/gist_id}","starred_url":"https://api.github.com/users/Steedance/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Steedance/subscriptions","organizations_url":"https://api.github.com/users/Steedance/orgs","repos_url":"https://api.github.com/users/Steedance/repos","events_url":"https://api.github.com/users/Steedance/events{/privacy}","received_events_url":"https://api.github.com/users/Steedance/received_events","type":"User","site_admin":false},"created_at":"2021-05-04T09:40:52Z","updated_at":"2021-05-04T09:40:52Z","author_association":"NONE","body":"Hi,\r\n\r\nThanks for the response.\r\n\r\nI have a couple of questions regarding using asynchronous call with the model server. I have used the \"CPU_THROUGHPUT_STREAMS\" and \"nireq\" properties before so I recognise the example config you posted. Does this mean that setting the model to handle async requests will allow the pipeline to handle async requests? Meaning I don't need to add anything to the \"pipeline_config_list\" property? Also would I need to set these two properties for each model in the pipeline or just the entry node for the pipeline?\r\n\r\nAndy","reactions":{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/831813504/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Steedance","id":45638338,"node_id":"MDQ6VXNlcjQ1NjM4MzM4","avatar_url":"https://avatars.githubusercontent.com/u/45638338?v=4","gravatar_id":"","url":"https://api.github.com/users/Steedance","html_url":"https://github.com/Steedance","followers_url":"https://api.github.com/users/Steedance/followers","following_url":"https://api.github.com/users/Steedance/following{/other_user}","gists_url":"https://api.github.com/users/Steedance/gists{/gist_id}","starred_url":"https://api.github.com/users/Steedance/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Steedance/subscriptions","organizations_url":"https://api.github.com/users/Steedance/orgs","repos_url":"https://api.github.com/users/Steedance/repos","events_url":"https://api.github.com/users/Steedance/events{/privacy}","received_events_url":"https://api.github.com/users/Steedance/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/833559836","html_url":"https://github.com/openvinotoolkit/model_server/issues/640#issuecomment-833559836","issue_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/640","id":833559836,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzU1OTgzNg==","user":{"login":"atobiszei","id":36039266,"node_id":"MDQ6VXNlcjM2MDM5MjY2","avatar_url":"https://avatars.githubusercontent.com/u/36039266?v=4","gravatar_id":"","url":"https://api.github.com/users/atobiszei","html_url":"https://github.com/atobiszei","followers_url":"https://api.github.com/users/atobiszei/followers","following_url":"https://api.github.com/users/atobiszei/following{/other_user}","gists_url":"https://api.github.com/users/atobiszei/gists{/gist_id}","starred_url":"https://api.github.com/users/atobiszei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atobiszei/subscriptions","organizations_url":"https://api.github.com/users/atobiszei/orgs","repos_url":"https://api.github.com/users/atobiszei/repos","events_url":"https://api.github.com/users/atobiszei/events{/privacy}","received_events_url":"https://api.github.com/users/atobiszei/received_events","type":"User","site_admin":false},"created_at":"2021-05-06T14:17:10Z","updated_at":"2021-05-06T14:17:33Z","author_association":"COLLABORATOR","body":"Hi,\r\n\r\n> Does this mean that setting the model to handle async requests will allow the pipeline to handle async requests?\r\n\r\nAll predict requests calls to OVMS are blocking (client need to wait for response), but the predictions themselves are running in parallel. `CPU_THROUGHPUT_STREAMS` is defining how many parallel inferences is happening, `nireq` is defining how many parallel predictions can be \"prepared\" for execution.\r\n\r\nPipelines use the same `CPU_THROUGHPUT_STREAMS`/`nireq` pool to execute inferences, but each inference in pipeline can occur simultaneously if it has required inputs ready.\r\n\r\n> Meaning I don't need to add anything to the \"pipeline_config_list\" property\r\n\r\nYou don't have to add anything to pipeline_config_list. Both parameters are for model configuration.\r\n\r\n> Also would I need to set these two properties for each model in the pipeline or just the entry node for the pipeline?\r\n\r\nYou need to define those parameters for all models used in pipeline.\r\n\r\nUp to some point higher throughput streams means that you can process more inferences at a time so it increases throughput at the cost of latency. Default values for those parameters are compromise, but you can optimize towards one or the other.\r\n\r\nAdrian","reactions":{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/833559836/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"atobiszei","id":36039266,"node_id":"MDQ6VXNlcjM2MDM5MjY2","avatar_url":"https://avatars.githubusercontent.com/u/36039266?v=4","gravatar_id":"","url":"https://api.github.com/users/atobiszei","html_url":"https://github.com/atobiszei","followers_url":"https://api.github.com/users/atobiszei/followers","following_url":"https://api.github.com/users/atobiszei/following{/other_user}","gists_url":"https://api.github.com/users/atobiszei/gists{/gist_id}","starred_url":"https://api.github.com/users/atobiszei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atobiszei/subscriptions","organizations_url":"https://api.github.com/users/atobiszei/orgs","repos_url":"https://api.github.com/users/atobiszei/repos","events_url":"https://api.github.com/users/atobiszei/events{/privacy}","received_events_url":"https://api.github.com/users/atobiszei/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/847112472","html_url":"https://github.com/openvinotoolkit/model_server/issues/640#issuecomment-847112472","issue_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/640","id":847112472,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NzExMjQ3Mg==","user":{"login":"Steedance","id":45638338,"node_id":"MDQ6VXNlcjQ1NjM4MzM4","avatar_url":"https://avatars.githubusercontent.com/u/45638338?v=4","gravatar_id":"","url":"https://api.github.com/users/Steedance","html_url":"https://github.com/Steedance","followers_url":"https://api.github.com/users/Steedance/followers","following_url":"https://api.github.com/users/Steedance/following{/other_user}","gists_url":"https://api.github.com/users/Steedance/gists{/gist_id}","starred_url":"https://api.github.com/users/Steedance/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Steedance/subscriptions","organizations_url":"https://api.github.com/users/Steedance/orgs","repos_url":"https://api.github.com/users/Steedance/repos","events_url":"https://api.github.com/users/Steedance/events{/privacy}","received_events_url":"https://api.github.com/users/Steedance/received_events","type":"User","site_admin":false},"created_at":"2021-05-24T15:14:05Z","updated_at":"2021-05-24T15:14:05Z","author_association":"NONE","body":"Hi,\r\n\r\nThanks for clarifying that, it was very helpful.\r\n\r\nAndy","reactions":{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/847112472/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Steedance","id":45638338,"node_id":"MDQ6VXNlcjQ1NjM4MzM4","avatar_url":"https://avatars.githubusercontent.com/u/45638338?v=4","gravatar_id":"","url":"https://api.github.com/users/Steedance","html_url":"https://github.com/Steedance","followers_url":"https://api.github.com/users/Steedance/followers","following_url":"https://api.github.com/users/Steedance/following{/other_user}","gists_url":"https://api.github.com/users/Steedance/gists{/gist_id}","starred_url":"https://api.github.com/users/Steedance/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Steedance/subscriptions","organizations_url":"https://api.github.com/users/Steedance/orgs","repos_url":"https://api.github.com/users/Steedance/repos","events_url":"https://api.github.com/users/Steedance/events{/privacy}","received_events_url":"https://api.github.com/users/Steedance/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/854757117","html_url":"https://github.com/openvinotoolkit/model_server/issues/640#issuecomment-854757117","issue_url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/640","id":854757117,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NDc1NzExNw==","user":{"login":"rasapala","id":58549742,"node_id":"MDQ6VXNlcjU4NTQ5NzQy","avatar_url":"https://avatars.githubusercontent.com/u/58549742?v=4","gravatar_id":"","url":"https://api.github.com/users/rasapala","html_url":"https://github.com/rasapala","followers_url":"https://api.github.com/users/rasapala/followers","following_url":"https://api.github.com/users/rasapala/following{/other_user}","gists_url":"https://api.github.com/users/rasapala/gists{/gist_id}","starred_url":"https://api.github.com/users/rasapala/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rasapala/subscriptions","organizations_url":"https://api.github.com/users/rasapala/orgs","repos_url":"https://api.github.com/users/rasapala/repos","events_url":"https://api.github.com/users/rasapala/events{/privacy}","received_events_url":"https://api.github.com/users/rasapala/received_events","type":"User","site_admin":false},"created_at":"2021-06-04T14:09:53Z","updated_at":"2021-06-04T14:09:53Z","author_association":"COLLABORATOR","body":"@Steedance Let us know if you need more information or we can close this issue.","reactions":{"url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/comments/854757117/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rasapala","id":58549742,"node_id":"MDQ6VXNlcjU4NTQ5NzQy","avatar_url":"https://avatars.githubusercontent.com/u/58549742?v=4","gravatar_id":"","url":"https://api.github.com/users/rasapala","html_url":"https://github.com/rasapala","followers_url":"https://api.github.com/users/rasapala/followers","following_url":"https://api.github.com/users/rasapala/following{/other_user}","gists_url":"https://api.github.com/users/rasapala/gists{/gist_id}","starred_url":"https://api.github.com/users/rasapala/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rasapala/subscriptions","organizations_url":"https://api.github.com/users/rasapala/orgs","repos_url":"https://api.github.com/users/rasapala/repos","events_url":"https://api.github.com/users/rasapala/events{/privacy}","received_events_url":"https://api.github.com/users/rasapala/received_events","type":"User","site_admin":false}},{"id":4843416501,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDg0MzQxNjUwMQ==","url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/events/4843416501","actor":{"login":"Steedance","id":45638338,"node_id":"MDQ6VXNlcjQ1NjM4MzM4","avatar_url":"https://avatars.githubusercontent.com/u/45638338?v=4","gravatar_id":"","url":"https://api.github.com/users/Steedance","html_url":"https://github.com/Steedance","followers_url":"https://api.github.com/users/Steedance/followers","following_url":"https://api.github.com/users/Steedance/following{/other_user}","gists_url":"https://api.github.com/users/Steedance/gists{/gist_id}","starred_url":"https://api.github.com/users/Steedance/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Steedance/subscriptions","organizations_url":"https://api.github.com/users/Steedance/orgs","repos_url":"https://api.github.com/users/Steedance/repos","events_url":"https://api.github.com/users/Steedance/events{/privacy}","received_events_url":"https://api.github.com/users/Steedance/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-06-04T14:09:53Z","performed_via_github_app":null},{"id":4843416505,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ4NDM0MTY1MDU=","url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/events/4843416505","actor":{"login":"Steedance","id":45638338,"node_id":"MDQ6VXNlcjQ1NjM4MzM4","avatar_url":"https://avatars.githubusercontent.com/u/45638338?v=4","gravatar_id":"","url":"https://api.github.com/users/Steedance","html_url":"https://github.com/Steedance","followers_url":"https://api.github.com/users/Steedance/followers","following_url":"https://api.github.com/users/Steedance/following{/other_user}","gists_url":"https://api.github.com/users/Steedance/gists{/gist_id}","starred_url":"https://api.github.com/users/Steedance/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Steedance/subscriptions","organizations_url":"https://api.github.com/users/Steedance/orgs","repos_url":"https://api.github.com/users/Steedance/repos","events_url":"https://api.github.com/users/Steedance/events{/privacy}","received_events_url":"https://api.github.com/users/Steedance/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-06-04T14:09:53Z","performed_via_github_app":null},{"id":4843417787,"node_id":"MDEyOkxhYmVsZWRFdmVudDQ4NDM0MTc3ODc=","url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/events/4843417787","actor":{"login":"rasapala","id":58549742,"node_id":"MDQ6VXNlcjU4NTQ5NzQy","avatar_url":"https://avatars.githubusercontent.com/u/58549742?v=4","gravatar_id":"","url":"https://api.github.com/users/rasapala","html_url":"https://github.com/rasapala","followers_url":"https://api.github.com/users/rasapala/followers","following_url":"https://api.github.com/users/rasapala/following{/other_user}","gists_url":"https://api.github.com/users/rasapala/gists{/gist_id}","starred_url":"https://api.github.com/users/rasapala/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rasapala/subscriptions","organizations_url":"https://api.github.com/users/rasapala/orgs","repos_url":"https://api.github.com/users/rasapala/repos","events_url":"https://api.github.com/users/rasapala/events{/privacy}","received_events_url":"https://api.github.com/users/rasapala/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-06-04T14:10:08Z","label":{"name":"question","color":"d876e3"},"performed_via_github_app":null},{"id":4951557271,"node_id":"MDExOkNsb3NlZEV2ZW50NDk1MTU1NzI3MQ==","url":"https://api.github.com/repos/openvinotoolkit/model_server/issues/events/4951557271","actor":{"login":"rasapala","id":58549742,"node_id":"MDQ6VXNlcjU4NTQ5NzQy","avatar_url":"https://avatars.githubusercontent.com/u/58549742?v=4","gravatar_id":"","url":"https://api.github.com/users/rasapala","html_url":"https://github.com/rasapala","followers_url":"https://api.github.com/users/rasapala/followers","following_url":"https://api.github.com/users/rasapala/following{/other_user}","gists_url":"https://api.github.com/users/rasapala/gists{/gist_id}","starred_url":"https://api.github.com/users/rasapala/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rasapala/subscriptions","organizations_url":"https://api.github.com/users/rasapala/orgs","repos_url":"https://api.github.com/users/rasapala/repos","events_url":"https://api.github.com/users/rasapala/events{/privacy}","received_events_url":"https://api.github.com/users/rasapala/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-06-29T07:12:43Z","state_reason":null,"performed_via_github_app":null}]