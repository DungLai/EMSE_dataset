[{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/513456955","html_url":"https://github.com/pavlin-policar/openTSNE/issues/81#issuecomment-513456955","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/81","id":513456955,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMzQ1Njk1NQ==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2019-07-20T10:42:26Z","updated_at":"2019-07-20T10:42:26Z","author_association":"OWNER","body":"Yes, there are ways this can happen. If you're installing openTSNE using conda, you're using prebuilt packages, which have been compiled ahead of time. Unfortunately, the conda servers use a clang compiler which doesn't support openMP, which is the library needed for multithreading in cython. Similarly, if you've installed openTSNE with pip and your clang compiler doesn't support openMP, there will have been a message during installation saying something along the lines of \"openmp not found, things will run single core\".\r\n\r\nIf you're using linux this shouldn't happen, and I'm unsure about windows, but I don't think this is a problem on windows either.\r\n\r\nI know it's not ideal that this happens silently, but IMO it's better than not having packages at all.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/513456955/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/513479551","html_url":"https://github.com/pavlin-policar/openTSNE/issues/81#issuecomment-513479551","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/81","id":513479551,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMzQ3OTU1MQ==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2019-07-20T16:07:41Z","updated_at":"2019-07-20T16:07:41Z","author_association":"CONTRIBUTOR","body":"Hmm. I think I am confused. I am using Ubuntu and I think I used conda install. Your readme says\r\n\r\n> In order for openTSNE to utilize multiple threads, the C/C++ compiler must also implement OpenMP. In practice, almost all compilers implement this with the exception of older version of clang on OSX systems.\r\n\r\nso I thought that multithreading will work out of the box. But if I understood your comment correctly:\r\n\r\n> If you're installing openTSNE using conda, you're using prebuilt packages, which have been compiled ahead of time. Unfortunately, the conda servers use a clang compiler which doesn't support openMP, which is the library needed for multithreading in cython.\r\n\r\nit means that with multithreading will NOT work using conda install. Did I understand correctly? Should I re-install using pip?","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/513479551/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/513531413","html_url":"https://github.com/pavlin-policar/openTSNE/issues/81#issuecomment-513531413","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/81","id":513531413,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMzUzMTQxMw==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2019-07-21T07:41:26Z","updated_at":"2019-07-21T07:41:26Z","author_association":"OWNER","body":"> I am using Ubuntu and I think I used conda install.\r\n\r\nThe linux conda package should work properly out of the box. And since you're using a unix system you can easily check if all the right amount of cores is being used with `htop`.\r\n\r\nAs far as the conda packages and the entire build system, it's a bit messy and I haven't yet figured out how to get all the packages to compile with multithreading. But basically the issue is that the clang compiler, the C compiler used on macs, doesn't support openmp out of the box and some trickery is apparently required to make it work and it's a huge pain to get this working on conda and it's very tedious to debug. Apparently, newer versions of clang have openmp support, but the versions on the mac vms that conda uses have older versions. So openTSNE is compiled without multithreading support. So, when using a mac, it's better to install openTSNE from source 1) because people likely have newer versions of clang on their pcs and 2) because it's possible to debug things. Unfortunately, I don't have access to a mac so this is very difficult for me.\r\n\r\nLinux uses gcc and windows uses the visual studio compiler, both of which support openmp out of the box, so multithreading should work straight away. When installing with `pip`, the install script will dynamically check for openmp and add the appropriate compiler flags as needed. And if openmp is not found, it prints out a message. Granted, you have to know to look for the message, but it's there.\r\n\r\nI'd suggest you look at how many cores are being used using `htop` and if you find only a single core is being used, reinstall using pip and look for a line saying either\r\n\r\n> Found openmp. Compiling with openmp flags...\r\n\r\nor \r\n\r\n> You appear to be using a compiler which does not support openMP...\r\n\r\nand if you see the latter message, check what the output of `cc -v` is to see which compiler is being used. On ubuntu, it should be gcc. ","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/513531413/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/513562425","html_url":"https://github.com/pavlin-policar/openTSNE/issues/81#issuecomment-513562425","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/81","id":513562425,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMzU2MjQyNQ==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2019-07-21T15:09:00Z","updated_at":"2019-07-21T15:09:00Z","author_association":"CONTRIBUTOR","body":"Thanks. I won't be in the lab for the next two days, but will check afterwards and report back.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/513562425/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/514600087","html_url":"https://github.com/pavlin-policar/openTSNE/issues/81#issuecomment-514600087","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/81","id":514600087,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNDYwMDA4Nw==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2019-07-24T11:51:55Z","updated_at":"2019-07-24T11:51:55Z","author_association":"CONTRIBUTOR","body":"So I wanted to investigate it and update my conda packages just in case, and now I am getting an error if I set `n_jobs` to any value apart from `n_jobs=1`. The error is in `nn_descent`:\r\n\r\n```\r\n~/anaconda3/lib/python3.6/site-packages/pynndescent/threaded.py in nn_descent(data, n_neighbors, rng_state, max_candidates, dist, dist_args, n_iters, delta, rho, rp_tree_init, leaf_array, verbose, n_jobs, seed_per_row)\r\n    569         rng_state = new_rng_state()\r\n    570 \r\n--> 571     with joblib.Parallel(prefer=\"threads\", n_jobs=n_jobs) as parallel:\r\n    572 \r\n    573         n_vertices = data.shape[0]\r\n\r\nTypeError: __init__() got an unexpected keyword argument 'prefer'\r\n```\r\n\r\nApologies if it's something on my side, because my conda now complains about some package inconsistencies and I didn't manage to solve it yet :-( I will try to fix it, but in the meanwhile am still reporting this just in case.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/514600087/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/515662914","html_url":"https://github.com/pavlin-policar/openTSNE/issues/81#issuecomment-515662914","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/81","id":515662914,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNTY2MjkxNA==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2019-07-27T07:49:39Z","updated_at":"2019-07-27T07:49:39Z","author_association":"OWNER","body":"This is very strange indeed. My first thought was that the pynndescent API must have introduced a breaking change and no longer accepts a `n_jobs` parameter, but since they're still on v0.3.0, this can't be the case. It seems more likely that you're using an outdated version of `joblib` and that the `prefer` parameter was added in a later version. This would also indicate a versioning issue in `pynndescent`, where it doesn't rely on a late enough version of `joblib`. If this is indeed the case, you should report this to them.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/515662914/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/565599911","html_url":"https://github.com/pavlin-policar/openTSNE/issues/81#issuecomment-565599911","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/81","id":565599911,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NTU5OTkxMQ==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2019-12-13T20:36:47Z","updated_at":"2019-12-13T20:36:47Z","author_association":"CONTRIBUTOR","body":"I will wait until today's 0.3.12 appears on conda, install the latest version on a new computer with fresh conda install and check if I still get this effect. Most likely it can be closed then.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/565599911/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/565823681","html_url":"https://github.com/pavlin-policar/openTSNE/issues/81#issuecomment-565823681","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/81","id":565823681,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NTgyMzY4MQ==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2019-12-15T16:18:19Z","updated_at":"2019-12-15T16:18:19Z","author_association":"CONTRIBUTOR","body":"Hi Pavlin. So I installed 0.3.12 using conda on Linux with pynndescent 0.4, and tried it on full MNIST (70000x50 input data matrix after PCA). My laptop has 4 cores with 2 threads each, so 8 threads.\r\n\r\n```\r\n%time Z = TSNE(callbacks=ErrorLogger()).fit(X50)\r\n```\r\nruns around 3 min with every 50 iterations taking 7-8 seconds. In the system monitor I see 4 threads clocking at 100%.\r\n\r\n```\r\n%time Z = TSNE(callbacks=ErrorLogger(), n_jobs=1).fit(X50)\r\n```\r\nruns exactly the same time, again with 4 threads being active.\r\n\r\n```\r\n%time Z = TSNE(callbacks=ErrorLogger(), n_jobs=-1).fit(X50)\r\n```\r\nruns 1 min 45 sec with every 50 iterations taking 3-4 seconds, and all 8 threads running at 100%.\r\n\r\nFor comparison, FIt-SNE with default parameters took 1 min 2 sec, with every 50 iterations taking ~2 sec, and all 8 threads running at ~50%.\r\n\r\nQ1) Are you sure that the default `n_jobs` value is -1? I get different results using -1 compared to the default.\r\nQ2) Not sure why I have four threads at 100% with `n_jobs=1` (and not only one).\r\nQ3) Not sure if the slowdown with `n_jobs=-1` compared to FIt-SNE is what should be expected due to the C++/Python difference (on the dataset of this size). Given that you have everything in numba, I expected the difference to be smaller...","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/565823681/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/566040319","html_url":"https://github.com/pavlin-policar/openTSNE/issues/81#issuecomment-566040319","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/81","id":566040319,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NjA0MDMxOQ==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2019-12-16T12:27:30Z","updated_at":"2019-12-16T12:27:30Z","author_association":"CONTRIBUTOR","body":"Oh I just realized that according to the docs the default value is `n_jobs=1`. This resolves my Q1, but why wouldn't you set `-1` as the default?","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/566040319/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/566580399","html_url":"https://github.com/pavlin-policar/openTSNE/issues/81#issuecomment-566580399","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/81","id":566580399,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NjU4MDM5OQ==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2019-12-17T15:04:53Z","updated_at":"2019-12-17T15:04:53Z","author_association":"OWNER","body":"Hey Dmitry!\r\n\r\nSo the default number of threads is set to one to keep consistency with scikit-learn. I quite like that actually, so it doesn't automatically hogg all the threads unless I explicitly want it too. Since this is the default behavior in scikit-learn I think this is totally reasonable.\r\n\r\n> In the system monitor I see 4 threads clocking at 100%.\r\n\r\nSo I suspect the reason for this is that you probably have a numpy binary that uses Intel MKL. I believe MKL will use multiple threads by default, and for if I run the following to just do a series of matrix multiplications, a very parallelizable operation,\r\n\r\n```\r\nCMD=\"import numpy as np\r\nx = np.random.normal(0, 1, size=(5000, 5000))\r\nprint('Starting');\r\nx @ x @ x @ x @ x @ x\"\r\ntime python -c \"$CMD\"\r\n```\r\n\r\nI can see that 4 threads are at full utilization, but if I limit the number of threads MKL is allowed to use like this:\r\n\r\n```\r\ntime MKL_NUM_THREADS=1 python -c \"$CMD\"\r\n```\r\n\r\nthen it takes around 3x slower on my machine and only one thread is fully utilized.\r\n\r\nThis almost certainly comes into play in t-SNE. I also don't know how numba interacts with MKL, if at all, but it probably does make use of some of the MKL accelerations.\r\n","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/566580399/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/566603790","html_url":"https://github.com/pavlin-policar/openTSNE/issues/81#issuecomment-566603790","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/81","id":566603790,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NjYwMzc5MA==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2019-12-17T15:56:22Z","updated_at":"2019-12-17T15:56:22Z","author_association":"CONTRIBUTOR","body":"Cool! Thanks a lot. I tried your code snippet and it does indeed utilize 4 threads by default.\r\n\r\nSo this answers my Q1 and Q2 and this issue can be closed which I am doing now. But I'm still curious what you think about Q3.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/566603790/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"id":2890381122,"node_id":"MDExOkNsb3NlZEV2ZW50Mjg5MDM4MTEyMg==","url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/events/2890381122","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-12-17T15:56:22Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/566984836","html_url":"https://github.com/pavlin-policar/openTSNE/issues/81#issuecomment-566984836","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/81","id":566984836,"node_id":"MDEyOklzc3VlQ29tbWVudDU2Njk4NDgzNg==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2019-12-18T11:02:29Z","updated_at":"2019-12-18T11:02:29Z","author_association":"OWNER","body":"Yes, that big of a slowdown is a bit concerning and I'll have to look into it. The difference shouldn't be that large.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/566984836/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/568219505","html_url":"https://github.com/pavlin-policar/openTSNE/issues/81#issuecomment-568219505","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/81","id":568219505,"node_id":"MDEyOklzc3VlQ29tbWVudDU2ODIxOTUwNQ==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2019-12-21T23:26:03Z","updated_at":"2019-12-21T23:26:03Z","author_association":"CONTRIBUTOR","body":"Would definitely be good to look into what makes it slower. Is there any extra verbose ErrorLogger that can report how much time is spent on attactive/repulsive computations etc.?","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/568219505/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/571106121","html_url":"https://github.com/pavlin-policar/openTSNE/issues/81#issuecomment-571106121","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/81","id":571106121,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MTEwNjEyMQ==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2020-01-06T11:30:45Z","updated_at":"2020-01-06T11:30:45Z","author_association":"OWNER","body":"No, unfortunately, the logging isn't the greatest. I had done the whole callback thing, which is useful in some contexts, but not the most appropriate for verbose messages. This is definitely I'd like to fix.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/571106121/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}}]