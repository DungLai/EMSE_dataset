[{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1119992324","html_url":"https://github.com/pavlin-policar/openTSNE/issues/210#issuecomment-1119992324","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/210","id":1119992324,"node_id":"IC_kwDOCCUuTM5CwboE","user":{"login":"gaardhus","id":46934916,"node_id":"MDQ6VXNlcjQ2OTM0OTE2","avatar_url":"https://avatars.githubusercontent.com/u/46934916?v=4","gravatar_id":"","url":"https://api.github.com/users/gaardhus","html_url":"https://github.com/gaardhus","followers_url":"https://api.github.com/users/gaardhus/followers","following_url":"https://api.github.com/users/gaardhus/following{/other_user}","gists_url":"https://api.github.com/users/gaardhus/gists{/gist_id}","starred_url":"https://api.github.com/users/gaardhus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaardhus/subscriptions","organizations_url":"https://api.github.com/users/gaardhus/orgs","repos_url":"https://api.github.com/users/gaardhus/repos","events_url":"https://api.github.com/users/gaardhus/events{/privacy}","received_events_url":"https://api.github.com/users/gaardhus/received_events","type":"User","site_admin":false},"created_at":"2022-05-06T20:39:09Z","updated_at":"2022-05-06T20:43:39Z","author_association":"NONE","body":"I've been having the same issue. After downgrading to `openTSNE==0.6.0` I was able to both save and load the fitted model.\r\n\r\nThe example data from the README however works for both `0.6.0`, `0.6.1` and `0.6.2` for me. This could possibly have something to do with number of observations and/or the resulting model size?\r\n\r\nThis is the error message I get, I tried deleting the temp folder before re-running and also tried restarting my computer without any success.\r\n\r\n```python\r\nTraceback (most recent call last):\r\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.9_3.9.3312.0_x64__qbz5n2kfra8p0\\lib\\shutil.py\", line 625, in _rmtree_unsafe\r\n    os.unlink(fullname)\r\nPermissionError: [WinError 32] The process cannot access the file because it is being used by another process: 'C:\\\\Users\\\\tobia\\\\AppData\\\\Local\\\\Temp\\\\tmpvvo0p0t8\\\\tmp.ann'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.9_3.9.3312.0_x64__qbz5n2kfra8p0\\lib\\tempfile.py\", line 805, in onerror\r\n    _os.unlink(path)\r\nPermissionError: [WinError 32] The process cannot access the file because it is being used by another process: 'C:\\\\Users\\\\tobia\\\\AppData\\\\Local\\\\Temp\\\\tmpvvo0p0t8\\\\tmp.ann'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\tobia\\Programming\\generate_example_data.py\", line 126, in <module>\r\n    pickle.dump(dv_model, f)\r\n  File \"C:\\Users\\tobia\\Programming\\venv\\lib\\site-packages\\openTSNE\\nearest_neighbors.py\", line 353, in __getstate__\r\n    b64_index = base64.b64encode(f.read())\r\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.9_3.9.3312.0_x64__qbz5n2kfra8p0\\lib\\tempfile.py\", line 830, in __exit__\r\n    self.cleanup()\r\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.9_3.9.3312.0_x64__qbz5n2kfra8p0\\lib\\tempfile.py\", line 834, in cleanup\r\n    self._rmtree(self.name)\r\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.9_3.9.3312.0_x64__qbz5n2kfra8p0\\lib\\tempfile.py\", line 816, in _rmtree\r\n    _shutil.rmtree(name, onerror=onerror)\r\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.9_3.9.3312.0_x64__qbz5n2kfra8p0\\lib\\shutil.py\", line 757, in rmtree\r\n    return _rmtree_unsafe(path, onerror)\r\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.9_3.9.3312.0_x64__qbz5n2kfra8p0\\lib\\shutil.py\", line 627, in _rmtree_unsafe\r\n    onerror(os.unlink, fullname, sys.exc_info())\r\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.9_3.9.3312.0_x64__qbz5n2kfra8p0\\lib\\tempfile.py\", line 808, in onerror\r\n    cls._rmtree(path)\r\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.9_3.9.3312.0_x64__qbz5n2kfra8p0\\lib\\tempfile.py\", line 816, in _rmtree\r\n    _shutil.rmtree(name, onerror=onerror)\r\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.9_3.9.3312.0_x64__qbz5n2kfra8p0\\lib\\shutil.py\", line 757, in rmtree\r\n    return _rmtree_unsafe(path, onerror)\r\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.9_3.9.3312.0_x64__qbz5n2kfra8p0\\lib\\shutil.py\", line 608, in _rmtree_unsafe\r\n    onerror(os.scandir, path, sys.exc_info())\r\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.9_3.9.3312.0_x64__qbz5n2kfra8p0\\lib\\shutil.py\", line 605, in _rmtree_unsafe\r\n    with os.scandir(path) as scandir_it:\r\nNotADirectoryError: [WinError 267] The directory name is invalid: 'C:\\\\Users\\\\tobia\\\\AppData\\\\Local\\\\Temp\\\\tmpvvo0p0t8\\\\tmp.ann'\r\n```\r\n\r\nFrom the example which runs without any errors:\r\n\r\n```python\r\nimport pickle\r\nimport openTSNE\r\nfrom openTSNE import TSNE\r\nfrom sklearn import datasets\r\nprint(openTSNE.__version__)\r\n\r\niris = datasets.load_iris()\r\nx, y = iris[\"data\"], iris[\"target\"]\r\n\r\nembedding = TSNE().fit(x)\r\n\r\nwith open('iris.pkl', 'wb') as f:\r\n    pickle.dump(embedding, f)\r\n\r\nwith open('iris.pkl', 'rb') as f:\r\n    embedding = pickle.load(f)\r\n\r\nembedding.transform(x)\r\n```","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1119992324/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"gaardhus","id":46934916,"node_id":"MDQ6VXNlcjQ2OTM0OTE2","avatar_url":"https://avatars.githubusercontent.com/u/46934916?v=4","gravatar_id":"","url":"https://api.github.com/users/gaardhus","html_url":"https://github.com/gaardhus","followers_url":"https://api.github.com/users/gaardhus/followers","following_url":"https://api.github.com/users/gaardhus/following{/other_user}","gists_url":"https://api.github.com/users/gaardhus/gists{/gist_id}","starred_url":"https://api.github.com/users/gaardhus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaardhus/subscriptions","organizations_url":"https://api.github.com/users/gaardhus/orgs","repos_url":"https://api.github.com/users/gaardhus/repos","events_url":"https://api.github.com/users/gaardhus/events{/privacy}","received_events_url":"https://api.github.com/users/gaardhus/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1263321001","html_url":"https://github.com/pavlin-policar/openTSNE/issues/210#issuecomment-1263321001","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/210","id":1263321001,"node_id":"IC_kwDOCCUuTM5LTL-p","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2022-09-30T09:14:38Z","updated_at":"2022-09-30T09:14:38Z","author_association":"OWNER","body":"In v0.6.2, I fixed the pickling behaviour so it works as one would expect. Annoy, which is used to find nearest neighbors, is not picklable, but uses its own internal file structure. So in previous versions, the annoy nearest neighbor index was saved to a separate file. So, pickling a TSNEEmbedding object actually produced two files, an annoy file and a pickle file. This was very fragile and there were just a ton of problems if you wanted to move files around.\r\n\r\nIn v0.6.2, I got rid of this and just included everything in the one pickle file. What happens now is that the annoy file is still saved to disk, but in a temporary directory (this is the reason for the `C:\\\\Users\\\\tobia\\\\AppData\\\\Local\\\\Temp\\\\tmpvvo0p0t8\\\\tmp.ann` directory). This file is then serialized into a binary string and saved to the pickle. When unpickling, we then write this binary string into another temporary file, which annoy can then read.\r\n\r\nAs to your problem: Would it be possible that you don't have permission to write to the Windows tmp directory? I don't have a windows machine, so I can't really test this out. There doesn't seem to be anything wrong with the actual path to the temporary file.\r\n\r\nI'll close this for now, but if this problem persists, please reopen this issue.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1263321001/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"id":7493748782,"node_id":"CE_lADOCCUuTM5IYm8nzwAAAAG-qYgu","url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/events/7493748782","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-09-30T09:14:38Z","state_reason":null,"performed_via_github_app":null}]