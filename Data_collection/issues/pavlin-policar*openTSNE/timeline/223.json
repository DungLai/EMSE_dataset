[{"id":8056374114,"node_id":"MEE_lADOCCUuTM5ZaoIKzwAAAAHgMoNi","url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/events/8056374114","actor":{"login":"jlmelville","id":1936393,"node_id":"MDQ6VXNlcjE5MzYzOTM=","avatar_url":"https://avatars.githubusercontent.com/u/1936393?v=4","gravatar_id":"","url":"https://api.github.com/users/jlmelville","html_url":"https://github.com/jlmelville","followers_url":"https://api.github.com/users/jlmelville/followers","following_url":"https://api.github.com/users/jlmelville/following{/other_user}","gists_url":"https://api.github.com/users/jlmelville/gists{/gist_id}","starred_url":"https://api.github.com/users/jlmelville/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlmelville/subscriptions","organizations_url":"https://api.github.com/users/jlmelville/orgs","repos_url":"https://api.github.com/users/jlmelville/repos","events_url":"https://api.github.com/users/jlmelville/events{/privacy}","received_events_url":"https://api.github.com/users/jlmelville/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-12-16T12:47:10Z","performed_via_github_app":null},{"id":8056374120,"node_id":"SE_lADOCCUuTM5ZaoIKzwAAAAHgMoNo","url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/events/8056374120","actor":{"login":"jlmelville","id":1936393,"node_id":"MDQ6VXNlcjE5MzYzOTM=","avatar_url":"https://avatars.githubusercontent.com/u/1936393?v=4","gravatar_id":"","url":"https://api.github.com/users/jlmelville","html_url":"https://github.com/jlmelville","followers_url":"https://api.github.com/users/jlmelville/followers","following_url":"https://api.github.com/users/jlmelville/following{/other_user}","gists_url":"https://api.github.com/users/jlmelville/gists{/gist_id}","starred_url":"https://api.github.com/users/jlmelville/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlmelville/subscriptions","organizations_url":"https://api.github.com/users/jlmelville/orgs","repos_url":"https://api.github.com/users/jlmelville/repos","events_url":"https://api.github.com/users/jlmelville/events{/privacy}","received_events_url":"https://api.github.com/users/jlmelville/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-12-16T12:47:10Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356057402","html_url":"https://github.com/pavlin-policar/openTSNE/issues/223#issuecomment-1356057402","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/223","id":1356057402,"node_id":"IC_kwDOCCUuTM5Q08s6","user":{"login":"jlmelville","id":1936393,"node_id":"MDQ6VXNlcjE5MzYzOTM=","avatar_url":"https://avatars.githubusercontent.com/u/1936393?v=4","gravatar_id":"","url":"https://api.github.com/users/jlmelville","html_url":"https://github.com/jlmelville","followers_url":"https://api.github.com/users/jlmelville/followers","following_url":"https://api.github.com/users/jlmelville/following{/other_user}","gists_url":"https://api.github.com/users/jlmelville/gists{/gist_id}","starred_url":"https://api.github.com/users/jlmelville/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlmelville/subscriptions","organizations_url":"https://api.github.com/users/jlmelville/orgs","repos_url":"https://api.github.com/users/jlmelville/repos","events_url":"https://api.github.com/users/jlmelville/events{/privacy}","received_events_url":"https://api.github.com/users/jlmelville/received_events","type":"User","site_admin":false},"created_at":"2022-12-17T05:42:57Z","updated_at":"2022-12-17T05:42:57Z","author_association":"NONE","body":"@dkobak don't want to hijack this issue so feel free to contact me directly, but I am curious:\r\n\r\n* is the example a simulation dataset or have any other unusually regular structure?\r\n* do you know what codepath and solver the [spectral embedding](https://github.com/scikit-learn/scikit-learn/blob/dc580a8ef5ee2a8aea80498388690e2213118efd/sklearn/manifold/_spectral_embedding.py) ends up using?\r\n* have you been able to look at the eigenvalues that come out? No chance that the solver has accidentally skipped an eigenvalue which just happens to give a nicer looking embedding? The discussion at https://github.com/yixuan/spectra/issues/126 suggests that for theoretical reasons with shift-and-invert (which spectral embedding uses with the codepath that ends up calling `eigsh`), if the shift value matches the eigenvalue then it will be skipped. I can't say that arpack's version suffers from that but might be worth checking.\r\n* any noticeable differences in run time?\r\n* assuming you are using the uniform affinity input, does adding a small number of random values (while maintaining symmetry) with small values (e.g. 1e-3) to the affinity matrix before creating the Laplacian have any affect on the result? In my experience, this can stabilize the convergence of a numerically problematic Laplacian without hugely affecting the initial embedding, although this seems to be an issue with UMAP graphs more than t-SNE, presumably due to the former being a lot sparser (also the UMAP tolerance is much looser). Might be worth a try though.\r\n","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356057402/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jlmelville","id":1936393,"node_id":"MDQ6VXNlcjE5MzYzOTM=","avatar_url":"https://avatars.githubusercontent.com/u/1936393?v=4","gravatar_id":"","url":"https://api.github.com/users/jlmelville","html_url":"https://github.com/jlmelville","followers_url":"https://api.github.com/users/jlmelville/followers","following_url":"https://api.github.com/users/jlmelville/following{/other_user}","gists_url":"https://api.github.com/users/jlmelville/gists{/gist_id}","starred_url":"https://api.github.com/users/jlmelville/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlmelville/subscriptions","organizations_url":"https://api.github.com/users/jlmelville/orgs","repos_url":"https://api.github.com/users/jlmelville/repos","events_url":"https://api.github.com/users/jlmelville/events{/privacy}","received_events_url":"https://api.github.com/users/jlmelville/received_events","type":"User","site_admin":false}},{"id":8061195181,"node_id":"MEE_lADOCCUuTM5ZaoIKzwAAAAHgfBOt","url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/events/8061195181","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-12-17T05:42:57Z","performed_via_github_app":null},{"id":8061195182,"node_id":"SE_lADOCCUuTM5ZaoIKzwAAAAHgfBOu","url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/events/8061195182","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-12-17T05:42:57Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356306162","html_url":"https://github.com/pavlin-policar/openTSNE/issues/223#issuecomment-1356306162","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/223","id":1356306162,"node_id":"IC_kwDOCCUuTM5Q15by","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2022-12-17T15:22:25Z","updated_at":"2022-12-17T16:12:59Z","author_association":"CONTRIBUTOR","body":"Hi James, thanks for the interest. This is a tiny graph with very pronounced geometric structure: https://sparse.tamu.edu/HB/can_96. The structure is a ring: https://sparse-files-images.engr.tamu.edu/HB/can_96_graph.gif\r\n\r\nHere is the entire code to reproduce the issue (download and unpack the Matrix Market data from the link above):\r\n\r\n```Python\r\n%matplotlib notebook\r\n\r\nimport numpy as np\r\nimport pylab as plt\r\n\r\nfrom scipy.io import mmread\r\nadjacency = mmread('/home/dmitry/Downloads/can_96.mtx').toarray()\r\n\r\naffinity = adjacency / np.sum(adjacency, axis=1, keepdims=True)\r\naffinity = (affinity + affinity.T) / 2\r\naffinity /= np.sum(affinity)\r\n\r\nfrom openTSNE.initialization import spectral\r\nZ1 = spectral(affinity, tol=0)\r\n\r\nfrom sklearn.manifold import SpectralEmbedding\r\nZ2 = SpectralEmbedding(affinity='precomputed').fit_transform(affinity)\r\n\r\nplt.figure(figsize=(8, 4), layout='constrained')\r\nplt.subplot(121)\r\nplt.title('openTSNE')\r\nplt.scatter(Z1[:,0], Z1[:,1])\r\nplt.subplot(122)\r\nplt.title('sklearn')\r\nplt.scatter(Z2[:,0], Z2[:,1])\r\nplt.savefig('spectral.png', dpi=200)\r\n```\r\n\r\n![spectral](https://user-images.githubusercontent.com/8970231/208248933-a254d685-6f7e-45a2-9df9-94a50f406fa9.png)\r\n\r\nSpectralEmbedding is run with default parameters so I assume it's using `arpack` solver via `eigsh`. I have not checked the eigenvalues or anything else yet.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356306162/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356312069","html_url":"https://github.com/pavlin-policar/openTSNE/issues/223#issuecomment-1356312069","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/223","id":1356312069,"node_id":"IC_kwDOCCUuTM5Q164F","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2022-12-17T15:33:15Z","updated_at":"2022-12-17T15:33:15Z","author_association":"CONTRIBUTOR","body":"Wow, right after posting the above comment, I found out that the openTSNE's result only arises due to particular `v0`:\r\n\r\n```Python\r\n    v0 = np.ones(A.shape[0]) / np.sqrt(A.shape[0])\r\n    eigvals, eigvecs = sp.linalg.eigsh(\r\n        A, M=D, k=k, tol=tol, maxiter=max_iter, which=\"LM\", v0=v0\r\n    )\r\n```\r\n\r\nIf I simply remove this `v0`, then the result looks identical to the sklearn! So it seems that this `v0` choice not only leads to non-reproducible results, but also screws up the eigenvector calculation!! \r\n\r\nSklearn uses this: https://github.com/scikit-learn/scikit-learn/blob/dc580a8ef5ee2a8aea80498388690e2213118efd/sklearn/utils/_arpack.py#L4\r\n```Python\r\n    v0 = random_state.uniform(-1, 1, size)\r\n```\r\nso openTSNE should probably do the same.\r\n\r\nOr we simply call `SpectralEmbedding(affinity='precomputed', eigen_tol=tol).fit_transform(A)`.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356312069/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356312613","html_url":"https://github.com/pavlin-policar/openTSNE/issues/223#issuecomment-1356312613","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/223","id":1356312613,"node_id":"IC_kwDOCCUuTM5Q17Al","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2022-12-17T15:35:12Z","updated_at":"2022-12-17T15:35:12Z","author_association":"CONTRIBUTOR","body":"More details on this:\r\n```Python\r\nD = np.diag(np.ravel(np.sum(affinity, axis=1)))\r\nfrom scipy.sparse.linalg import eigsh\r\nv0 = np.ones(affinity.shape[0]) / np.sqrt(affinity.shape[0])\r\n\r\neigvals, _ = eigsh(affinity, M=D, k=3, tol=0, which=\"LM\", v0=v0)\r\nprint(eigvals)\r\n\r\neigvals, _ = eigsh(affinity, M=D, k=3, tol=0, which=\"LM\")\r\nprint(eigvals)\r\n```\r\n\r\nresults in \r\n```\r\n[0.90591439 0.94925302 1.        ]\r\n[0.94925302 0.94925302 1.        ]\r\n```","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356312613/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356318982","html_url":"https://github.com/pavlin-policar/openTSNE/issues/223#issuecomment-1356318982","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/223","id":1356318982,"node_id":"IC_kwDOCCUuTM5Q18kG","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2022-12-17T16:10:04Z","updated_at":"2022-12-17T16:10:22Z","author_association":"CONTRIBUTOR","body":"Last comment, promise: using `sigma=1.0` in the `eigsh` call (following sklearn) speeds up the calculation by 3x (for this particular graph):\r\n\r\n```Python\r\n%time eigvals, _ = eigsh(affinity, M=D, k=3, tol=0, which=\"LM\")\r\n%time eigvals, _ = eigsh(affinity, M=D, k=3, tol=0, which=\"LM\", sigma=1.0)\r\n```\r\nSo if we keep our own implementation, then using `sigma=1.0` may be a good idea.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356318982/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356458727","html_url":"https://github.com/pavlin-policar/openTSNE/issues/223#issuecomment-1356458727","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/223","id":1356458727,"node_id":"IC_kwDOCCUuTM5Q2ern","user":{"login":"jlmelville","id":1936393,"node_id":"MDQ6VXNlcjE5MzYzOTM=","avatar_url":"https://avatars.githubusercontent.com/u/1936393?v=4","gravatar_id":"","url":"https://api.github.com/users/jlmelville","html_url":"https://github.com/jlmelville","followers_url":"https://api.github.com/users/jlmelville/followers","following_url":"https://api.github.com/users/jlmelville/following{/other_user}","gists_url":"https://api.github.com/users/jlmelville/gists{/gist_id}","starred_url":"https://api.github.com/users/jlmelville/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlmelville/subscriptions","organizations_url":"https://api.github.com/users/jlmelville/orgs","repos_url":"https://api.github.com/users/jlmelville/repos","events_url":"https://api.github.com/users/jlmelville/events{/privacy}","received_events_url":"https://api.github.com/users/jlmelville/received_events","type":"User","site_admin":false},"created_at":"2022-12-17T20:24:26Z","updated_at":"2022-12-17T20:24:26Z","author_association":"NONE","body":"Thanks for all those details Dmitry. I had a feeling it would be something weird with a very structured graph. It is indeed skipping an eigenvector for some choices of `v0`, presumably because the eigenvalues are degenerate?\r\n\r\nIn this case, the result seems to be exceptionally sensitive to `v0` in a way I don't understand. The `init.spectral` `v0` *should* be a good guess because the vector of 1s is a (generalized) eigenvector (the one that gets discarded). Using `np.ones` directly rather than scaling that vector to length 1 gives the correct result -- I'd be curious to know if that also works for you Dmitry. I am seeing similarly odd behavior when using `eigsh` with the symmetrized graph Laplacian directly also.\r\n\r\nI have never had good luck with setting `sigma`. In my experience with it, in combination with sparse data, it seems to cause the routine to hang forever. Have you tried it with something like MNIST?","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356458727/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jlmelville","id":1936393,"node_id":"MDQ6VXNlcjE5MzYzOTM=","avatar_url":"https://avatars.githubusercontent.com/u/1936393?v=4","gravatar_id":"","url":"https://api.github.com/users/jlmelville","html_url":"https://github.com/jlmelville","followers_url":"https://api.github.com/users/jlmelville/followers","following_url":"https://api.github.com/users/jlmelville/following{/other_user}","gists_url":"https://api.github.com/users/jlmelville/gists{/gist_id}","starred_url":"https://api.github.com/users/jlmelville/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlmelville/subscriptions","organizations_url":"https://api.github.com/users/jlmelville/orgs","repos_url":"https://api.github.com/users/jlmelville/repos","events_url":"https://api.github.com/users/jlmelville/events{/privacy}","received_events_url":"https://api.github.com/users/jlmelville/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356474797","html_url":"https://github.com/pavlin-policar/openTSNE/issues/223#issuecomment-1356474797","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/223","id":1356474797,"node_id":"IC_kwDOCCUuTM5Q2imt","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2022-12-17T21:21:48Z","updated_at":"2022-12-17T21:22:48Z","author_association":"CONTRIBUTOR","body":"> Using np.ones directly rather than scaling that vector to length 1 gives the correct result -- I'd be curious to know if that also works for you Dmitry.\r\n\r\nYes it does! Weird. Sklearn does mention here https://github.com/scikit-learn/scikit-learn/blob/dc580a8ef5ee2a8aea80498388690e2213118efd/sklearn/utils/_arpack.py#L7 that the scale of initialization may be important... However, at this point I do not trust this approach and would rather have `v0` initialized randomly.\r\n\r\n> I have never had good luck with setting sigma. In my experience with it, in combination with sparse data, it seems to cause the routine to hang forever. Have you tried it with something like MNIST?\r\n\r\nJust tried now, by generating the standard t-SNE affinity matrix for MNIST (so 90 neighbors for each point).\r\n\r\n```Python\r\neigsh(affinity, M=D, k=3, tol=0, which=\"LM\")\r\neigsh(affinity, M=D, k=3, tol=0, which=\"LM\", sigma=1.0)\r\nSpectralEmbedding(affinity='precomputed').fit_transform(affinity)\r\n```\r\n\r\nThe first call took 11 s. The other two did indeed hang forever and I stopped both of them after a few minutes.\r\n\r\nHowever, using Pyamg solver\r\n```Python\r\nSpectralEmbedding(affinity='precomputed', eigen_solver='amg').fit_transform(affinity)\r\n```\r\nalso took 11 s. This may be due to looser tolerance though, as the docs mention that `amg` solver sets its own tolerance which is above 0: https://scikit-learn.org/stable/modules/generated/sklearn.manifold.SpectralEmbedding.html.\r\n\r\nJust noticed that setting the tolerance for the ARPACK solver in SpectralEmbedding is only possible in version 1.2.\r\n\r\nOkay, so if we don't want to depend on sklearn 1.2, then it seems that maybe the best course of action is simply to kick out `v0` and keep everything else as is, including NOT using `sigma=1.0`. Thoughts?","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356474797/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356483761","html_url":"https://github.com/pavlin-policar/openTSNE/issues/223#issuecomment-1356483761","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/223","id":1356483761,"node_id":"IC_kwDOCCUuTM5Q2kyx","user":{"login":"jlmelville","id":1936393,"node_id":"MDQ6VXNlcjE5MzYzOTM=","avatar_url":"https://avatars.githubusercontent.com/u/1936393?v=4","gravatar_id":"","url":"https://api.github.com/users/jlmelville","html_url":"https://github.com/jlmelville","followers_url":"https://api.github.com/users/jlmelville/followers","following_url":"https://api.github.com/users/jlmelville/following{/other_user}","gists_url":"https://api.github.com/users/jlmelville/gists{/gist_id}","starred_url":"https://api.github.com/users/jlmelville/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlmelville/subscriptions","organizations_url":"https://api.github.com/users/jlmelville/orgs","repos_url":"https://api.github.com/users/jlmelville/repos","events_url":"https://api.github.com/users/jlmelville/events{/privacy}","received_events_url":"https://api.github.com/users/jlmelville/received_events","type":"User","site_admin":false},"created_at":"2022-12-17T22:03:54Z","updated_at":"2022-12-17T22:03:54Z","author_association":"NONE","body":"On a technical basis, I suspect in most real-world cases, the current choice of `v0` is good and it will probably be a small performance pessimization to use a random `v0`. I am not sure if many people are going to hit this problem. If they do, they are probably researchers like yourself, so the current workaround (initialize manually and hence have control of the spectral settings) might be ok?","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356483761/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jlmelville","id":1936393,"node_id":"MDQ6VXNlcjE5MzYzOTM=","avatar_url":"https://avatars.githubusercontent.com/u/1936393?v=4","gravatar_id":"","url":"https://api.github.com/users/jlmelville","html_url":"https://github.com/jlmelville","followers_url":"https://api.github.com/users/jlmelville/followers","following_url":"https://api.github.com/users/jlmelville/following{/other_user}","gists_url":"https://api.github.com/users/jlmelville/gists{/gist_id}","starred_url":"https://api.github.com/users/jlmelville/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlmelville/subscriptions","organizations_url":"https://api.github.com/users/jlmelville/orgs","repos_url":"https://api.github.com/users/jlmelville/repos","events_url":"https://api.github.com/users/jlmelville/events{/privacy}","received_events_url":"https://api.github.com/users/jlmelville/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356486306","html_url":"https://github.com/pavlin-policar/openTSNE/issues/223#issuecomment-1356486306","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/223","id":1356486306,"node_id":"IC_kwDOCCUuTM5Q2lai","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2022-12-17T22:11:58Z","updated_at":"2022-12-17T22:11:58Z","author_association":"CONTRIBUTOR","body":"Do you have any evidence that the current choice of `v0` is helpful and that a random `v0` would lead to slower convergence? I don't see any difference on MNIST affinities.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356486306/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356487461","html_url":"https://github.com/pavlin-policar/openTSNE/issues/223#issuecomment-1356487461","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/223","id":1356487461,"node_id":"IC_kwDOCCUuTM5Q2lsl","user":{"login":"jlmelville","id":1936393,"node_id":"MDQ6VXNlcjE5MzYzOTM=","avatar_url":"https://avatars.githubusercontent.com/u/1936393?v=4","gravatar_id":"","url":"https://api.github.com/users/jlmelville","html_url":"https://github.com/jlmelville","followers_url":"https://api.github.com/users/jlmelville/followers","following_url":"https://api.github.com/users/jlmelville/following{/other_user}","gists_url":"https://api.github.com/users/jlmelville/gists{/gist_id}","starred_url":"https://api.github.com/users/jlmelville/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlmelville/subscriptions","organizations_url":"https://api.github.com/users/jlmelville/orgs","repos_url":"https://api.github.com/users/jlmelville/repos","events_url":"https://api.github.com/users/jlmelville/events{/privacy}","received_events_url":"https://api.github.com/users/jlmelville/received_events","type":"User","site_admin":false},"created_at":"2022-12-17T22:19:18Z","updated_at":"2022-12-17T22:19:18Z","author_association":"NONE","body":"With `initialization.spectral` specifically, no. But with `eigsh` on the shifted symmetric graph Laplacian, in general I have found that guessing the lowest eigenvalue *usually* helps. However, it's not consistent.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/1356487461/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jlmelville","id":1936393,"node_id":"MDQ6VXNlcjE5MzYzOTM=","avatar_url":"https://avatars.githubusercontent.com/u/1936393?v=4","gravatar_id":"","url":"https://api.github.com/users/jlmelville","html_url":"https://github.com/jlmelville","followers_url":"https://api.github.com/users/jlmelville/followers","following_url":"https://api.github.com/users/jlmelville/following{/other_user}","gists_url":"https://api.github.com/users/jlmelville/gists{/gist_id}","starred_url":"https://api.github.com/users/jlmelville/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlmelville/subscriptions","organizations_url":"https://api.github.com/users/jlmelville/orgs","repos_url":"https://api.github.com/users/jlmelville/repos","events_url":"https://api.github.com/users/jlmelville/events{/privacy}","received_events_url":"https://api.github.com/users/jlmelville/received_events","type":"User","site_admin":false}}]