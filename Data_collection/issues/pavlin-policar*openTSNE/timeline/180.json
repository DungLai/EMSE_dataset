[{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822025493","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-822025493","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":822025493,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMjAyNTQ5Mw==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2021-04-18T17:10:36Z","updated_at":"2021-04-18T17:10:36Z","author_association":"OWNER","body":"Please provide a minimal code example where this fails so we can reproduce and debug this. There really isn't anything obvious that would cause the memory to balloon.\r\n\r\nDoes the same thing happen when using `negative_gradient_method=\"fft\"`?","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822025493/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822032930","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-822032930","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":822032930,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMjAzMjkzMA==","user":{"login":"fsvbach","id":64090304,"node_id":"MDQ6VXNlcjY0MDkwMzA0","avatar_url":"https://avatars.githubusercontent.com/u/64090304?v=4","gravatar_id":"","url":"https://api.github.com/users/fsvbach","html_url":"https://github.com/fsvbach","followers_url":"https://api.github.com/users/fsvbach/followers","following_url":"https://api.github.com/users/fsvbach/following{/other_user}","gists_url":"https://api.github.com/users/fsvbach/gists{/gist_id}","starred_url":"https://api.github.com/users/fsvbach/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fsvbach/subscriptions","organizations_url":"https://api.github.com/users/fsvbach/orgs","repos_url":"https://api.github.com/users/fsvbach/repos","events_url":"https://api.github.com/users/fsvbach/events{/privacy}","received_events_url":"https://api.github.com/users/fsvbach/received_events","type":"User","site_admin":false},"created_at":"2021-04-18T17:59:45Z","updated_at":"2021-04-18T18:01:24Z","author_association":"NONE","body":"Okay, with negative_gradient_method=\"fft\" it works, but I sometimes get the RuntimeWarning: invalid value encountered in log\r\n  kl_divergence_ += sum_P * np.log(sum_Q + EPSILON)\r\n\r\nA minimal example would be:\r\n```\r\nfrom openTSNE import TSNE\r\nimport numpy as np\r\nmatrix = np.genfromtxt('matrix.csv', delimiter=',')\r\ntsne = TSNE(metric='precomputed', initialization='spectral', negative_gradient_method='bh')\r\nembedding = tsne.fit(matrix)\r\n```\r\nwith the matrix in matrix.csv \r\n[matrix.csv](https://github.com/pavlin-policar/openTSNE/files/6331881/matrix.csv)\r\n\r\nNote: It doesn't crash always, but every third or fourth time, so I think its due to some initialization?\r\n","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822032930/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fsvbach","id":64090304,"node_id":"MDQ6VXNlcjY0MDkwMzA0","avatar_url":"https://avatars.githubusercontent.com/u/64090304?v=4","gravatar_id":"","url":"https://api.github.com/users/fsvbach","html_url":"https://github.com/fsvbach","followers_url":"https://api.github.com/users/fsvbach/followers","following_url":"https://api.github.com/users/fsvbach/following{/other_user}","gists_url":"https://api.github.com/users/fsvbach/gists{/gist_id}","starred_url":"https://api.github.com/users/fsvbach/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fsvbach/subscriptions","organizations_url":"https://api.github.com/users/fsvbach/orgs","repos_url":"https://api.github.com/users/fsvbach/repos","events_url":"https://api.github.com/users/fsvbach/events{/privacy}","received_events_url":"https://api.github.com/users/fsvbach/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822034924","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-822034924","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":822034924,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMjAzNDkyNA==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2021-04-18T18:11:13Z","updated_at":"2021-04-18T18:11:13Z","author_association":"OWNER","body":"What I suspect may be happening is that if the points are too close together in the embedding, the BH tree balloons. However, I should have some safeguards in place so that this doesn't happen. Maybe those safeguards aren't enough. This might be plausible since you're trying to force all the points super close together. But I'd need to investigate it further. I suggest you use `fft` for the time being.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822034924/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822045937","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-822045937","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":822045937,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMjA0NTkzNw==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-04-18T19:21:15Z","updated_at":"2021-04-18T19:21:15Z","author_association":"CONTRIBUTOR","body":"> I expect TSNE to return 4 distinct clusters (actually 4 points only). Sklearn yields this.\r\n\r\nActually the points should not be on top of each other in the embedding. When some points have zero distance in the original embedding, they should get finite affinities and should end up close but not overlapping in the embedding.\r\n\r\nIf you get overlapping points in sklearn, that would be weird.\r\n\r\nCan you post a picture of sklearn embedding, and also of what you get from openTSNE when it does not crash?","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822045937/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822269449","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-822269449","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":822269449,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMjI2OTQ0OQ==","user":{"login":"fsvbach","id":64090304,"node_id":"MDQ6VXNlcjY0MDkwMzA0","avatar_url":"https://avatars.githubusercontent.com/u/64090304?v=4","gravatar_id":"","url":"https://api.github.com/users/fsvbach","html_url":"https://github.com/fsvbach","followers_url":"https://api.github.com/users/fsvbach/followers","following_url":"https://api.github.com/users/fsvbach/following{/other_user}","gists_url":"https://api.github.com/users/fsvbach/gists{/gist_id}","starred_url":"https://api.github.com/users/fsvbach/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fsvbach/subscriptions","organizations_url":"https://api.github.com/users/fsvbach/orgs","repos_url":"https://api.github.com/users/fsvbach/repos","events_url":"https://api.github.com/users/fsvbach/events{/privacy}","received_events_url":"https://api.github.com/users/fsvbach/received_events","type":"User","site_admin":false},"created_at":"2021-04-19T08:13:49Z","updated_at":"2021-04-19T08:13:49Z","author_association":"NONE","body":"Yes.\r\n![openTSNE_bh](https://user-images.githubusercontent.com/64090304/115203384-ade89800-a0f7-11eb-9149-cbb43a481dd9.png)\r\nThis is the result of openTSNE with bh setting when it doesn't crash.\r\n\r\n![openTSNE_fft](https://user-images.githubusercontent.com/64090304/115203387-ae812e80-a0f7-11eb-91f3-d4a0b1145f17.png)\r\nThis is the result of openTSNE with fft settings (where I get the above warning). \r\n\r\n![sklearn](https://user-images.githubusercontent.com/64090304/115203390-af19c500-a0f7-11eb-92bb-3a09f7c706dc.png)\r\nAnd this (similar) plot I get with sklearn all of the time without warning.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822269449/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fsvbach","id":64090304,"node_id":"MDQ6VXNlcjY0MDkwMzA0","avatar_url":"https://avatars.githubusercontent.com/u/64090304?v=4","gravatar_id":"","url":"https://api.github.com/users/fsvbach","html_url":"https://github.com/fsvbach","followers_url":"https://api.github.com/users/fsvbach/followers","following_url":"https://api.github.com/users/fsvbach/following{/other_user}","gists_url":"https://api.github.com/users/fsvbach/gists{/gist_id}","starred_url":"https://api.github.com/users/fsvbach/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fsvbach/subscriptions","organizations_url":"https://api.github.com/users/fsvbach/orgs","repos_url":"https://api.github.com/users/fsvbach/repos","events_url":"https://api.github.com/users/fsvbach/events{/privacy}","received_events_url":"https://api.github.com/users/fsvbach/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822274030","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-822274030","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":822274030,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMjI3NDAzMA==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-04-19T08:20:52Z","updated_at":"2021-04-19T08:20:52Z","author_association":"CONTRIBUTOR","body":"Wow. None of that makes any sense to me! Unless I am missing something, the points should not overlap at all, so we should see 200 points separately. BH-openTSNE makes most sense, but even there there are many fewer than 200 points visible. In FFT-openTSNE there is `1e11` on the y-axis?! And sklearn simply shows 4 points... Very odd.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822274030/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822278944","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-822278944","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":822278944,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMjI3ODk0NA==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2021-04-19T08:28:15Z","updated_at":"2021-04-19T08:28:15Z","author_association":"OWNER","body":"I agree, none of these plots seem correct. The repulsive forces should push the points apart at least a little bit. However, the spans of the embeddings are quite big, so maybe it could be a visual plotting thing that they look like a single point. Are the final coordinates really just a single point, or are they just really close to one another and the large point sizes and large spans just make it look that way?","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822278944/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822283595","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-822283595","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":822283595,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMjI4MzU5NQ==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-04-19T08:35:30Z","updated_at":"2021-04-20T09:22:19Z","author_association":"CONTRIBUTOR","body":"It seems that has nothing to do with `precomputed` specifically, but with how we treat identical points.\r\n\r\n```\r\nnp.random.seed(42)\r\n\r\nX = np.concatenate((\r\n        np.array(list(np.random.randn(1,10))*50),\r\n        np.array(list(np.random.randn(1,10))*50),\r\n        np.array(list(np.random.randn(1,10))*50),\r\n        np.array(list(np.random.randn(1,10))*50)\r\n    ))\r\n\r\nZ = TSNE(negative_gradient_method='bh').fit(X)\r\n\r\nprint(np.unique(np.sum(Z,axis=1)).size)\r\n```\r\nThis prints 6 :exploding_head: \r\n\r\nUpdate: with sklearn I get points that are almost overlapping but are not identical. However, this result seems fishy to me too.\r\n\r\nUpdate2: with FFT I get 7 distinct points. So points are exactly overlapping.\r\n\r\nUpdate3: I checked and the same thing happens with `Uniform` affinities, so it's not a perplexity calibration problem.\r\n\r\nAlso note that adding a minuscule amount of noise like `X += np.random.randn(200,50) / 10000` makes the problem go away.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822283595/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822284026","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-822284026","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":822284026,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMjI4NDAyNg==","user":{"login":"fsvbach","id":64090304,"node_id":"MDQ6VXNlcjY0MDkwMzA0","avatar_url":"https://avatars.githubusercontent.com/u/64090304?v=4","gravatar_id":"","url":"https://api.github.com/users/fsvbach","html_url":"https://github.com/fsvbach","followers_url":"https://api.github.com/users/fsvbach/followers","following_url":"https://api.github.com/users/fsvbach/following{/other_user}","gists_url":"https://api.github.com/users/fsvbach/gists{/gist_id}","starred_url":"https://api.github.com/users/fsvbach/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fsvbach/subscriptions","organizations_url":"https://api.github.com/users/fsvbach/orgs","repos_url":"https://api.github.com/users/fsvbach/repos","events_url":"https://api.github.com/users/fsvbach/events{/privacy}","received_events_url":"https://api.github.com/users/fsvbach/received_events","type":"User","site_admin":false},"created_at":"2021-04-19T08:36:07Z","updated_at":"2021-04-19T08:45:17Z","author_association":"NONE","body":"The points in FFT-openTSNE for example are something like\r\n```\r\n      ...      [  1.76457933,  13.81758939],\r\n               [  2.02415051,  13.85560307],\r\n               [  1.94253379,  13.86327763],\r\n               [  2.01328632,  13.71940575],\r\n               [  2.04201515,  13.7215927 ],\r\n               [  2.17067327,  13.8131649], ...\r\n```\r\nIt makes sense to me, that they are very close so that matplotlib overlaps even with points size 1. What doesn't make sense to me: Why doesn't BH-openTSNE show this behaviour, i.e. why are some points very close and some others fairly far apart (and why does it crash, of course)? \r\n\r\nNote: In this run I didn't get the RuntimeWarning and the plot (with smaller size) looks like\r\n![openTSNE_fft](https://user-images.githubusercontent.com/64090304/115207883-4c76f800-a0fc-11eb-830f-4d41cbc23ee8.png)\r\nNow the y-axis is fine, too.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/822284026/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fsvbach","id":64090304,"node_id":"MDQ6VXNlcjY0MDkwMzA0","avatar_url":"https://avatars.githubusercontent.com/u/64090304?v=4","gravatar_id":"","url":"https://api.github.com/users/fsvbach","html_url":"https://github.com/fsvbach","followers_url":"https://api.github.com/users/fsvbach/followers","following_url":"https://api.github.com/users/fsvbach/following{/other_user}","gists_url":"https://api.github.com/users/fsvbach/gists{/gist_id}","starred_url":"https://api.github.com/users/fsvbach/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fsvbach/subscriptions","organizations_url":"https://api.github.com/users/fsvbach/orgs","repos_url":"https://api.github.com/users/fsvbach/repos","events_url":"https://api.github.com/users/fsvbach/events{/privacy}","received_events_url":"https://api.github.com/users/fsvbach/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/823198989","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-823198989","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":823198989,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMzE5ODk4OQ==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-04-20T11:29:26Z","updated_at":"2021-04-20T11:29:26Z","author_association":"CONTRIBUTOR","body":"I realized that I was wrong when I said that the optimal embedding should not have overlapping points. On reflection, it should be possible to reduce KL to zero by making all points from each class overlap exactly. All pairs of points overlapping in high dimensions have identical affinities, and if they overlap in 2D they will have identical low-dimensional similarities too.\r\n\r\nIf so, this means that sklearnTSNE returns the correct result.\r\n\r\nBut I see a lot of thing going weird when optimizing it with openTSNE...\r\n\r\nUsing the same data as above\r\n```\r\nnp.random.seed(42)\r\nX = np.concatenate((\r\n        np.array(list(np.random.randn(1,10))*50),\r\n        np.array(list(np.random.randn(1,10))*50),\r\n        np.array(list(np.random.randn(1,10))*50),\r\n        np.array(list(np.random.randn(1,10))*50)\r\n    ))\r\n```\r\n\r\nIt works fine with starting from random initialization:\r\n```\r\nTSNE(negative_gradient_method='bh', initialization='random', verbose=1).fit(X)\r\nTSNE(negative_gradient_method='fft', initialization='random', verbose=1).fit(X)\r\n```\r\nboth reduce KL to near-zero and make the points roughly (but not exactly) overlap.\r\n\r\nBut using PCA initializatoin (where points in the initialization overlap exactly) the optimization goes wild.\r\n```\r\nTSNE(negative_gradient_method='bh', initialization='pca', verbose=1).fit(X)\r\n```\r\nBH yield negatative KL values which is mathematically impossible!\r\n```\r\n===> Running optimization with exaggeration=12.00, lr=200.00 for 250 iterations...\r\nIteration   50, KL divergence -5.1860, 50 iterations in 0.0159 sec\r\nIteration  100, KL divergence -6.2852, 50 iterations in 0.0147 sec\r\nIteration  150, KL divergence -7.0769, 50 iterations in 0.0148 sec\r\nIteration  200, KL divergence -7.6468, 50 iterations in 0.0149 sec\r\nIteration  250, KL divergence -8.0897, 50 iterations in 0.0147 sec\r\n   --> Time elapsed: 0.08 seconds\r\n===> Running optimization with exaggeration=1.00, lr=200.00 for 500 iterations...\r\nIteration   50, KL divergence -9.2070, 50 iterations in 0.0163 sec\r\nIteration  100, KL divergence -9.7631, 50 iterations in 0.0144 sec\r\nIteration  150, KL divergence -10.1641, 50 iterations in 0.0152 sec\r\nIteration  200, KL divergence -10.4828, 50 iterations in 0.0149 sec\r\nIteration  250, KL divergence -10.7496, 50 iterations in 0.0162 sec\r\nIteration  300, KL divergence -10.9802, 50 iterations in 0.0150 sec\r\nIteration  350, KL divergence -11.1838, 50 iterations in 0.0162 sec\r\nIteration  400, KL divergence -11.3666, 50 iterations in 0.0149 sec\r\nIteration  450, KL divergence -11.5325, 50 iterations in 0.0143 sec\r\nIteration  500, KL divergence -11.6847, 50 iterations in 0.0151 sec\r\n```\r\n\r\nWhile FFT...\r\n```\r\nTSNE(negative_gradient_method='fft', initialization='pca', verbose=1).fit(X)\r\n```\r\n...diverges!\r\n```\r\n===> Running optimization with exaggeration=12.00, lr=200.00 for 250 iterations...\r\nIteration   50, KL divergence 0.0446, 50 iterations in 0.6821 sec\r\nIteration  100, KL divergence 0.0292, 50 iterations in 0.7156 sec\r\nIteration  150, KL divergence 0.0227, 50 iterations in 0.7206 sec\r\nIteration  200, KL divergence 0.0240, 50 iterations in 0.7323 sec\r\nIteration  250, KL divergence 0.0195, 50 iterations in 0.6954 sec\r\n   --> Time elapsed: 3.55 seconds\r\n===> Running optimization with exaggeration=1.00, lr=200.00 for 500 iterations...\r\nIteration   50, KL divergence 0.0321, 50 iterations in 0.6926 sec\r\nIteration  100, KL divergence 0.0815, 50 iterations in 0.6904 sec\r\nIteration  150, KL divergence 0.1199, 50 iterations in 0.6936 sec\r\nIteration  200, KL divergence 0.1419, 50 iterations in 0.6955 sec\r\nIteration  250, KL divergence 8.1304, 50 iterations in 0.8760 sec\r\nIteration  300, KL divergence 13.9849, 50 iterations in 0.6924 sec\r\nIteration  350, KL divergence 14.7327, 50 iterations in 0.6963 sec\r\nIteration  400, KL divergence 15.2104, 50 iterations in 0.6898 sec\r\nIteration  450, KL divergence 15.4548, 50 iterations in 0.6824 sec\r\nIteration  500, KL divergence 15.5808, 50 iterations in 0.7088 sec\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/823198989/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/823604640","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-823604640","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":823604640,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMzYwNDY0MA==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-04-20T21:15:01Z","updated_at":"2021-04-20T21:15:01Z","author_association":"CONTRIBUTOR","body":"Update: sklearn also shows negative KL values when using PCA initialization (but not with random initialization)!\r\n```\r\nZ = SklearnTSNE(verbose=2, init='pca').fit_transform(X)\r\n```\r\nresults in\r\n```\r\n[t-SNE] Computing 91 nearest neighbors...\r\n[t-SNE] Indexed 200 samples in 0.001s...\r\n[t-SNE] Computed neighbors for 200 samples in 0.006s...\r\n[t-SNE] Computed conditional probabilities for sample 200 / 200\r\n[t-SNE] Mean sigma: 0.000000\r\n[t-SNE] Computed conditional probabilities in 0.034s\r\n[t-SNE] Iteration 50: error = -59.8060608, gradient norm = 0.0029903 (50 iterations in 0.040s)\r\n[t-SNE] Iteration 100: error = -75.7929688, gradient norm = 0.0015364 (50 iterations in 0.018s)\r\n[t-SNE] Iteration 150: error = -85.3008423, gradient norm = 0.0010339 (50 iterations in 0.017s)\r\n[t-SNE] Iteration 200: error = -92.0923309, gradient norm = 0.0007792 (50 iterations in 0.018s)\r\n[t-SNE] Iteration 250: error = -97.3766937, gradient norm = 0.0006251 (50 iterations in 0.017s)\r\n[t-SNE] KL divergence after 250 iterations with early exaggeration: -97.376694\r\n[t-SNE] Iteration 300: error = -10.6954212, gradient norm = 0.0005959 (50 iterations in 0.032s)\r\n[t-SNE] Iteration 350: error = -10.9293900, gradient norm = 0.0005301 (50 iterations in 0.018s)\r\n[t-SNE] Iteration 400: error = -11.2307148, gradient norm = 0.0004560 (50 iterations in 0.020s)\r\n[t-SNE] Iteration 450: error = -11.5423441, gradient norm = 0.0003902 (50 iterations in 0.018s)\r\n[t-SNE] Iteration 500: error = -11.8387394, gradient norm = 0.0003365 (50 iterations in 0.017s)\r\n[t-SNE] Iteration 550: error = -12.1112652, gradient norm = 0.0002936 (50 iterations in 0.017s)\r\n[t-SNE] Iteration 600: error = -12.3597937, gradient norm = 0.0002593 (50 iterations in 0.017s)\r\n[t-SNE] Iteration 650: error = -12.5856562, gradient norm = 0.0002316 (50 iterations in 0.017s)\r\n[t-SNE] Iteration 700: error = -12.7922802, gradient norm = 0.0002089 (50 iterations in 0.016s)\r\n[t-SNE] Iteration 750: error = -12.9815378, gradient norm = 0.0001900 (50 iterations in 0.017s)\r\n[t-SNE] Iteration 800: error = -13.1556988, gradient norm = 0.0001741 (50 iterations in 0.016s)\r\n[t-SNE] Iteration 850: error = -13.3171625, gradient norm = 0.0001606 (50 iterations in 0.023s)\r\n[t-SNE] Iteration 900: error = -13.4675283, gradient norm = 0.0001490 (50 iterations in 0.024s)\r\n[t-SNE] Iteration 950: error = -13.6077213, gradient norm = 0.0001389 (50 iterations in 0.017s)\r\n[t-SNE] Iteration 1000: error = -13.7389517, gradient norm = 0.0001301 (50 iterations in 0.027s)\r\n[t-SNE] KL divergence after 1000 iterations: -13.738952\r\n```\r\nso it seems that sklearnTSNE and openTSNE have the same problem here.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/823604640/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/825629550","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-825629550","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":825629550,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTYyOTU1MA==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2021-04-23T12:38:56Z","updated_at":"2021-04-23T12:38:56Z","author_association":"OWNER","body":"Hmm, this is all very strange, and I'll need to look into it some more. But I think that in my implementation of BH, one of the assumptions I made was that the embedding points would never actually overlap like that. So the BH one doesn't surprise me that much. And also, such things are pretty difficult to solve with BH, if memory serves. I am a bit surprised about FIt-SNE not working, since it doesn't make any assumptions about how the points are spaced out.\r\n\r\nPerhaps the negative KL values are the most puzzling of all.\r\n\r\nI definitely consider this an edge case, and a very unusual usage. Adding just a little bit of noise to the distance matrix makes everything run smoothly.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/825629550/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/825632964","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-825632964","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":825632964,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTYzMjk2NA==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-04-23T12:45:01Z","updated_at":"2021-04-23T12:45:01Z","author_association":"CONTRIBUTOR","body":"> Perhaps the negative KL values are the most puzzling of all.\r\n\r\nAren't KL values during BH optimization computed using some expressions computed via BH? If so, then it's not surprising that KL values end up being very wrong.\r\n\r\n> And also, such things are pretty difficult to solve with BH, if memory serves.\r\n\r\nI have no idea about this. But if this is really true, then a dirty workaround would be to add some tiny noise to the initialization (with a warning) if the repulsion method is BH and if there are overlapping points... I'm just not sure what's the best way to detect that there are overlapping points in the initialization.\r\n\r\n> I am a bit surprised about FIt-SNE not working, since it doesn't make any assumptions about how the points are spaced out.\r\n\r\nIn fact, we may do the same for FFT as well if we cannot otherwise find out what's going on there.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/825632964/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/827124057","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-827124057","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":827124057,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNzEyNDA1Nw==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-04-26T20:25:03Z","updated_at":"2021-04-26T20:25:03Z","author_association":"CONTRIBUTOR","body":"> I'm just not sure what's the best way to detect that there are overlapping points in the initialization.\r\n\r\nMaybe something like\r\n```\r\nif initialization.shape[0] == np.unique(initialization.round(decimals=6), axis=0).shape[0]\r\n```\r\ncan work to detect if there are duplicates in the initialization array...","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/827124057/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/832628918","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-832628918","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":832628918,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMjYyODkxOA==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-05-05T11:56:35Z","updated_at":"2021-05-05T18:28:12Z","author_association":"CONTRIBUTOR","body":"Somewhat fleshing out this workaround:\r\n\r\n```\r\nimport numpy as np\r\n\r\nX = np.random.randn(1_000_000,2)\r\nX[1000] = X[2000]\r\n\r\ndef jitter(X, precision=6):\r\n    _, ind_unique = np.unique(X.round(decimals=precision), axis=0, return_index=True)\r\n    ind_duplicates = np.setdiff1d(np.arange(X.shape[0]), ind_unique)\r\n    if ind_duplicates.size > 0:\r\n        print(f'Found {ind_duplicates.size} near-duplicate(s). Adding some jitter to them.')\r\n        X[ind_duplicates] += np.random.randn(ind_duplicates.size, X.shape[1]) * 10**-precision\r\n    return X\r\n\r\n%time X = jitter(X)\r\n```\r\n\r\nworks in <1 second for n=1mln:\r\n```\r\nFound 1 near-duplicate(s). Adding some jitter to them.\r\nCPU times: user 872 ms, sys: 12 ms, total: 884 ms\r\nWall time: 884 ms\r\n```\r\n\r\nSo my suggestion would be to run this on any initialization (explicitly provided by the user or computed using PCA) and print a warning when adding jitter.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/832628918/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/835831296","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-835831296","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":835831296,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNTgzMTI5Ng==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2021-05-09T15:43:41Z","updated_at":"2021-05-09T15:43:41Z","author_association":"OWNER","body":"Thanks for this solution, I'm actually amazed it works this fast!\r\n\r\nAt first I was kind of on the fence about this, thinking: \"How often would this actually happen?\" I think a block distance matrix is something you're really rarely ever see in practice. However, duplicate entries aren't that rare at all, e.g. even in the iris data set, there are two identical rows. However, for iris, this isn't a problem, and the two identical data points get embedded into the exact same position. So that seems to work okay. Then the question becomes \"why doesn't it work when there are a lot of duplicate entries?\"\r\n\r\nFor iris, I tried setting a bunch of points to being duplicate entries, and seeing where it failed. Interestingly enough, it failed when I put 30 duplicate points. This doesn't correlate with the perplexity, as increasing it to e.g. 70 still results in negative KL values. So this is definitely very strange. However, setting using 30 duplicate rows and setting perplexity to 70 still results in negative KL values. So it seems like the problem has always been there, but the KL values sometimes don't reach negative values. It also seems like it works if the number of duplicate entries isn't too big.\r\n\r\nI'm fine with using your fix as a temporary solution. Clearly, there is a bug somewhere, and it needs to be found. However, this isn't something that would happen very often though I think. If you want to open a PR with this temporary fix, I'll be happy to merge it.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/835831296/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"id":4711179662,"node_id":"MDEyOkxhYmVsZWRFdmVudDQ3MTExNzk2NjI=","url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/events/4711179662","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-05-09T15:45:45Z","label":{"name":"bug","color":"d73a4a"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/882329794","html_url":"https://github.com/pavlin-policar/openTSNE/issues/180#issuecomment-882329794","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/180","id":882329794,"node_id":"IC_kwDOCCUuTM40l0jC","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-07-19T07:57:16Z","updated_at":"2021-07-19T07:57:16Z","author_association":"CONTRIBUTOR","body":"> I'm fine with using your fix as a temporary solution. Clearly, there is a bug somewhere, and it needs to be found. However, this isn't something that would happen very often though I think. If you want to open a PR with this temporary fix, I'll be happy to merge it.\r\n\r\nJust want to comment here briefly that I implemented this in a branch but then observed some odd behaviour (I was getting some \"near-duplicates\" detected in the initialization when there should not have been any) and did not get to investigating it further since then...","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/882329794/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}}]