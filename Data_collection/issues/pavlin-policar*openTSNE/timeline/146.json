[{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/712116074","html_url":"https://github.com/pavlin-policar/openTSNE/issues/146#issuecomment-712116074","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/146","id":712116074,"node_id":"MDEyOklzc3VlQ29tbWVudDcxMjExNjA3NA==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2020-10-19T12:15:20Z","updated_at":"2020-10-19T12:15:20Z","author_association":"OWNER","body":"I see the function calls differ slightly, but it's not obvious from the code. UMAP calls pynndescent with `low_memory=False`, while we here don't set it at all, so we use the default, which is `low_memory=True`. Could this be the culprit?","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/712116074/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/712125617","html_url":"https://github.com/pavlin-policar/openTSNE/issues/146#issuecomment-712125617","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/146","id":712125617,"node_id":"MDEyOklzc3VlQ29tbWVudDcxMjEyNTYxNw==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2020-10-19T12:34:02Z","updated_at":"2020-10-19T12:34:02Z","author_association":"CONTRIBUTOR","body":"Good catch, but it does not look like it's the culprit.\r\n\r\n```\r\nn_trees = 5 + int(round((data.shape[0]) ** 0.5 / 20))\r\nn_iters = max(5, int(round(np.log2(data.shape[0]))))\r\n\r\n%time pynndescent.NNDescent(data, n_neighbors=16, metric='cosine', verbose=1, max_candidates=60, n_trees=n_trees, n_iters=n_iters, low_memory=False)\r\n\r\n%time pynndescent.NNDescent(data, n_neighbors=16, metric='cosine', verbose=1, max_candidates=60, n_trees=n_trees, n_iters=n_iters, low_memory=True)\r\n\r\n%time affinity.Uniform(data, k_neighbors=15, metric='cosine', verbose=1)\r\n```\r\n\r\nI get ~35 sec with both `pynndescent` calls but 60 sec with `affinity.Uniform` call, even though all time is spent on `pynndescent.NNDescent` call from within.\r\n\r\nHmm it's weird. Maybe it's something strange with my machine here.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/712125617/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/712243685","html_url":"https://github.com/pavlin-policar/openTSNE/issues/146#issuecomment-712243685","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/146","id":712243685,"node_id":"MDEyOklzc3VlQ29tbWVudDcxMjI0MzY4NQ==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2020-10-19T15:25:32Z","updated_at":"2020-10-19T15:25:32Z","author_association":"CONTRIBUTOR","body":"The plot thickens!\r\n\r\nI looked at the system monitor and noticed that when I run `pynndescent.NNDescent` as written above, I have all cores active, but from within openTSNE only 1 core is active. Not a surprise because we call `pynndescent` with `n_jobs=1` when the input is sparse (because it did not use to work otherwise).\r\n\r\nThe default is `n_jobs=None` which I thought is the same as `n_jobs=1` but apparently it is actually the same as `n_jobs=-1`.\r\n\r\nAnyway - the solution for this is to remove the ugly workaround at https://github.com/pavlin-policar/openTSNE/blob/master/openTSNE/nearest_neighbors.py#L384 and use `self.n_jobs`. I tried, and it works beautifully!","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/712243685/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/712684257","html_url":"https://github.com/pavlin-policar/openTSNE/issues/146#issuecomment-712684257","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/146","id":712684257,"node_id":"MDEyOklzc3VlQ29tbWVudDcxMjY4NDI1Nw==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2020-10-20T08:26:05Z","updated_at":"2020-10-20T08:26:05Z","author_association":"OWNER","body":"Oh, that's great! Thanks for tracking this down! I guess this is another thing to remove before the next release.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/712684257/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"id":3900859276,"node_id":"MDExOkNsb3NlZEV2ZW50MzkwMDg1OTI3Ng==","url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/events/3900859276","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-10-20T21:23:58Z","state_reason":null,"performed_via_github_app":null}]