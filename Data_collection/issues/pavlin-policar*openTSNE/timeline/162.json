[{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/793987574","html_url":"https://github.com/pavlin-policar/openTSNE/issues/162#issuecomment-793987574","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/162","id":793987574,"node_id":"MDEyOklzc3VlQ29tbWVudDc5Mzk4NzU3NA==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-03-09T14:42:55Z","updated_at":"2021-03-09T15:51:40Z","author_association":"CONTRIBUTOR","body":"Hmm, tried it out briefly and am not sure that their heuristic makes sense :-(\r\n\r\n```\r\nfrom sklearn.neighbors import NearestNeighbors\r\n\r\nneigh = NearestNeighbors(n_neighbors=90, algorithm='ball_tree', n_jobs=-1)\r\n%time neigh.fit(X[:10000, :784])\r\n%time neigh.kneighbors_graph(mode='distance')\r\n\r\nneigh = NearestNeighbors(n_neighbors=90, algorithm='auto', n_jobs=-1)\r\n%time neigh.fit(X[:10000, :784])\r\n%time neigh.kneighbors_graph(mode='distance')\r\n```\r\n\r\nTimes:\r\n```\r\nWall time: 695 ms\r\nWall time: 21 s\r\nWall time: 774 ms\r\nWall time: 47.2 s\r\n```\r\n\r\nThe same for 20k:\r\n\r\n```\r\nWall time: 1.65 s\r\nWall time: 1min 38s\r\nWall time: 2.24 s\r\nWall time: 2min 58s\r\n```\r\n\r\nThe same for full 70k:\r\n```\r\nWall time: 25.8 s\r\nWall time: 23min 46s\r\nWall time: 23 s\r\nWall time: 37min 2s\r\n```\r\n\r\nNow I am very confused. They changed it relatively recently based on the benchmarks that showed that brute-force works faster...","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/793987574/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794219767","html_url":"https://github.com/pavlin-policar/openTSNE/issues/162#issuecomment-794219767","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/162","id":794219767,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDIxOTc2Nw==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-03-09T17:44:11Z","updated_at":"2021-03-09T17:44:11Z","author_association":"CONTRIBUTOR","body":"I am going to close this issue... But if you have any thoughts, let me know please!","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794219767/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"id":4430176223,"node_id":"MDExOkNsb3NlZEV2ZW50NDQzMDE3NjIyMw==","url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/events/4430176223","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-03-09T17:44:11Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794409904","html_url":"https://github.com/pavlin-policar/openTSNE/issues/162#issuecomment-794409904","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/162","id":794409904,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDQwOTkwNA==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-03-09T20:25:56Z","updated_at":"2021-03-09T20:25:56Z","author_association":"CONTRIBUTOR","body":"Update: turns out my sklearn was 0.23 and not 0.24, and after installing the latest version brute-force became MUCH MUCH faster! https://github.com/scikit-learn/scikit-learn/issues/10044#issuecomment-794407653\r\n\r\nHere are updated times for full MNIST:\r\n\r\n```\r\nCPU times: user 23.3 s, sys: 83.6 ms, total: 23.4 s\r\nWall time: 23.3 s\r\nCPU times: user 3h 9min 11s, sys: 11 s, total: 3h 9min 22s\r\nWall time: 25min 18s\r\nCPU times: user 26.2 ms, sys: 0 ns, total: 26.2 ms\r\nWall time: 25.9 ms\r\nCPU times: user 14min 21s, sys: 1min 40s, total: 16min 1s\r\nWall time: 3min 48s\r\n```\r\n\r\nI guess we should change it in openTSNE. Re-opening.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794409904/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"id":4431160909,"node_id":"MDEzOlJlb3BlbmVkRXZlbnQ0NDMxMTYwOTA5","url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/events/4431160909","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"event":"reopened","commit_id":null,"commit_url":null,"created_at":"2021-03-09T20:25:56Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794459441","html_url":"https://github.com/pavlin-policar/openTSNE/issues/162#issuecomment-794459441","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/162","id":794459441,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDQ1OTQ0MQ==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2021-03-09T21:11:08Z","updated_at":"2021-03-09T21:11:08Z","author_association":"OWNER","body":"> I realized that sklearn uses brute-force kNN always whenever dimensionality d>15\r\n\r\nThat's seems really strange to me. I wanted to avoid brute-forcing kNN at all costs, because this involves forming the entire distance matrix, and this leads to out-of-memory errors all over the place once you start working with moderately-sized data. Assuming we have users running this on laptops, this seems like a huge no-no to me. I would very much like to know their reasoning behind this.\r\n\r\nThe other algorithms scikit-learns offers are KD-trees and Ball trees. From what I remember, KD-trees become really inefficient with dimensionalities > ~10, which is really low. Ball trees supposedly work better with higher dimensionalities, and has the same time-complexity as KD-trees. So I chose Ball trees as the default.\r\n\r\nMaybe ball trees aren't optimal in all cases, and maybe brute force is faster in some scenarios, but I would assume those cases happen with really small data sets where the computation happens almost instantaneously. So in that case, I won't mind if the computation takes 2 seconds instead of 1 second, for instance. From the benchmarks you posted, it seems like ball trees are faster anyways for anything moderately sized.\r\n\r\nIn any case, I would probably prefer using annoy for anything above 10k samples, since it's probably going to be much faster. I really wouldn't worry about it too much. Even if we were to optimize the algorithm selection for finding the exact nearest neighbors, we're probably talking about shaving off a few seconds here and there, which really doesn't make a difference IMO.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794459441/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794462118","html_url":"https://github.com/pavlin-policar/openTSNE/issues/162#issuecomment-794462118","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/162","id":794462118,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDQ2MjExOA==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2021-03-09T21:13:41Z","updated_at":"2021-03-09T21:13:41Z","author_association":"OWNER","body":"It's only now loaded your newer comment.\r\n\r\nIn that case, yes, it would definitely make sense to change change the algorithm to \"auto\" and let scikit-learn do its thing. Do you have any idea what they did to make it so much faster? The only thing that would still make me somewhat hesitant if if they form the entire N x N distance matrix. That would still lead to memory problems.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794462118/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794473183","html_url":"https://github.com/pavlin-policar/openTSNE/issues/162#issuecomment-794473183","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/162","id":794473183,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDQ3MzE4Mw==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-03-09T21:23:48Z","updated_at":"2021-03-09T21:23:48Z","author_association":"CONTRIBUTOR","body":"I don't think it makes up the NxN matrix, that wouldn't fit in my laptop RAM for N=70000. Also, it's not needed as one can process it in batches.\r\n\r\nI have no idea what changed between 0.23 and 0.24 for brute-force but the speed increase is astonishing. Now SklearnTSNE is faster than MulticoreTSNE.\r\n\r\nLooks like openTSNE with Barnes-Hut will be faster still, if we switch to \"auto\" ;)","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794473183/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794475937","html_url":"https://github.com/pavlin-policar/openTSNE/issues/162#issuecomment-794475937","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/162","id":794475937,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDQ3NTkzNw==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-03-09T21:26:15Z","updated_at":"2021-03-09T21:26:15Z","author_association":"CONTRIBUTOR","body":"Update: apparently what changed is that in 0.23 \"auto\" was not running brute-force but one of the trees, likely KD.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794475937/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794486026","html_url":"https://github.com/pavlin-policar/openTSNE/issues/162#issuecomment-794486026","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/162","id":794486026,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDQ4NjAyNg==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2021-03-09T21:34:01Z","updated_at":"2021-03-09T21:34:01Z","author_association":"OWNER","body":"I've found the PR: https://github.com/scikit-learn/scikit-learn/pull/17038. It seems that cython is confused when we conditionally acquire the GIL. I wasn't aware of that. I do still suspect that the entire distance matrix is formed, since they do just call scipy's `cdist` function, but we'll leave it up to them to handle batching if they so choose :)\r\n\r\nIn openTSNE, I suppose we've got to keep the BallTree class as it is, for backwards compatibility, then remove it in the next version. It would be confusing to have the class named `BallTree` and have it sometime use the brute force algorithm as well. So we should make a new class, maybe named `Exact` or `Sklearn`. We can just copy over the code from `BallTree` and remove the bits that handle cosine distance. The brute force implementation should have no issues with cosine distance. Annoy should remain the default, as it's still probably going to be faster for most use-cases. What do you think?","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794486026/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794497822","html_url":"https://github.com/pavlin-policar/openTSNE/issues/162#issuecomment-794497822","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/162","id":794497822,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDQ5NzgyMg==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-03-09T21:45:06Z","updated_at":"2021-03-09T23:58:36Z","author_association":"CONTRIBUTOR","body":"Hmm but this PR seems to be about BallTrees... And I don't know what GIL is... Whatever :-)\r\n\r\n> I do still suspect that the entire distance matrix is formed, since they do just call scipy's cdist function, \r\n\r\nHmm but for MNIST, 70000 * 70000 * 8/1024/1024/1024 ~ 36 so it would need 36 Gb or maybe half of that, but I only have 16 Gb on my laptop and less than half was used when running sklearn.\r\n\r\n> It would be confusing to have the class named BallTree and have it sometime use the brute force algorithm as well.\r\n\r\nHaha, actually this would be my preferred option for simplicity and backwards compatibility :-) Just requires one line change \r\nin https://github.com/pavlin-policar/openTSNE/blob/master/openTSNE/nearest_neighbors.py#L107. Is there a way to add an `ExactNN` class which is simply equal to `BallTree`? Then it'd be less confusing.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794497822/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794510312","html_url":"https://github.com/pavlin-policar/openTSNE/issues/162#issuecomment-794510312","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/162","id":794510312,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDUxMDMxMg==","user":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"created_at":"2021-03-09T21:56:39Z","updated_at":"2021-03-09T21:57:47Z","author_association":"OWNER","body":"> Is there a way to add an ExactNN class which is simply equal to BallTree? Then it'd be less confusing.\r\n\r\nYeah, we could definitely do `ExactNN = BallTree`, but then we'd inherit that cosine metric workaround, which might even interfere. And we'd still have a class name BallTree that sometimes runs brute force, sometimes KD trees, and only sometimes ball trees. Oh, and we'd have to update the valid distance metrics [here](https://github.com/pavlin-policar/openTSNE/blob/master/openTSNE/nearest_neighbors.py#L77). The more I think about it, the more I'm convinced making a new class is the way to go. The new class will also be much simpler than the current one, because of all the cosine logic.","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794510312/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794632576","html_url":"https://github.com/pavlin-policar/openTSNE/issues/162#issuecomment-794632576","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/162","id":794632576,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDYzMjU3Ng==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-03-10T00:03:59Z","updated_at":"2021-03-10T00:03:59Z","author_association":"CONTRIBUTOR","body":"Fine.\r\n\r\nRegarding NxN matrix, I think maybe batching happens here: https://github.com/scikit-learn/scikit-learn/blob/95119c13af77c76e150b753485c662b7c52a41a2/sklearn/neighbors/_base.py#L705","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/794632576/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}},{"id":4434381069,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQ0MzQzODEwNjk=","url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/events/4434381069","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"event":"referenced","commit_id":"e8325a2fc543f764e88da4216ef856a6ba407035","commit_url":"https://api.github.com/repos/pavlin-policar/openTSNE/commits/e8325a2fc543f764e88da4216ef856a6ba407035","created_at":"2021-03-10T08:18:43Z","performed_via_github_app":null},{"id":4435798666,"node_id":"MDExOkNsb3NlZEV2ZW50NDQzNTc5ODY2Ng==","url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/events/4435798666","actor":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"event":"closed","commit_id":"e8325a2fc543f764e88da4216ef856a6ba407035","commit_url":"https://api.github.com/repos/pavlin-policar/openTSNE/commits/e8325a2fc543f764e88da4216ef856a6ba407035","created_at":"2021-03-10T12:01:20Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/795354533","html_url":"https://github.com/pavlin-policar/openTSNE/issues/162#issuecomment-795354533","issue_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/162","id":795354533,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NTM1NDUzMw==","user":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false},"created_at":"2021-03-10T12:37:07Z","updated_at":"2021-03-10T12:37:07Z","author_association":"CONTRIBUTOR","body":"Embedding full MNIST without PCA pre-processing (n=70000, d=784) on my laptop:\r\n\r\n*    openTSNE(n_jobs=-1): 3min 6s\r\n*    openTSNE(n_jobs=-1, neighbors='exact', negative_gradient_method='bh'): 7min 58s\r\n*    SklearnTSNE(n_jobs=-1): 10min 54s\r\n*    MulticoreTSNE(n_jobs=-1): 13min 56s\r\n\r\nNice!!","reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/comments/795354533/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dkobak","id":8970231,"node_id":"MDQ6VXNlcjg5NzAyMzE=","avatar_url":"https://avatars.githubusercontent.com/u/8970231?v=4","gravatar_id":"","url":"https://api.github.com/users/dkobak","html_url":"https://github.com/dkobak","followers_url":"https://api.github.com/users/dkobak/followers","following_url":"https://api.github.com/users/dkobak/following{/other_user}","gists_url":"https://api.github.com/users/dkobak/gists{/gist_id}","starred_url":"https://api.github.com/users/dkobak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dkobak/subscriptions","organizations_url":"https://api.github.com/users/dkobak/orgs","repos_url":"https://api.github.com/users/dkobak/repos","events_url":"https://api.github.com/users/dkobak/events{/privacy}","received_events_url":"https://api.github.com/users/dkobak/received_events","type":"User","site_admin":false}}]