{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/108","repository_url":"https://api.github.com/repos/pavlin-policar/openTSNE","labels_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/108/labels{/name}","comments_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/108/comments","events_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/108/events","html_url":"https://github.com/pavlin-policar/openTSNE/issues/108","id":569324550,"node_id":"MDU6SXNzdWU1NjkzMjQ1NTA=","number":108,"title":"Non-consistent nan value for KL divergence","user":{"login":"vb690","id":39380732,"node_id":"MDQ6VXNlcjM5MzgwNzMy","avatar_url":"https://avatars.githubusercontent.com/u/39380732?v=4","gravatar_id":"","url":"https://api.github.com/users/vb690","html_url":"https://github.com/vb690","followers_url":"https://api.github.com/users/vb690/followers","following_url":"https://api.github.com/users/vb690/following{/other_user}","gists_url":"https://api.github.com/users/vb690/gists{/gist_id}","starred_url":"https://api.github.com/users/vb690/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vb690/subscriptions","organizations_url":"https://api.github.com/users/vb690/orgs","repos_url":"https://api.github.com/users/vb690/repos","events_url":"https://api.github.com/users/vb690/events{/privacy}","received_events_url":"https://api.github.com/users/vb690/received_events","type":"User","site_admin":false},"labels":[{"id":959087247,"node_id":"MDU6TGFiZWw5NTkwODcyNDc=","url":"https://api.github.com/repos/pavlin-policar/openTSNE/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-02-22T11:56:06Z","updated_at":"2020-03-12T18:18:17Z","closed_at":"2020-03-12T18:18:17Z","author_association":"NONE","active_lock_reason":null,"body":"##### Expected behaviour\r\n\r\nWhen calling `TSNE.fit()` on the same numpy array I expect:\r\n\r\n1. The KL divergence to not be a `nan`\r\n2. The appearence of `nan`in the KL divergence to not depend on ~~the specific  array slice considered~~ the chosen value of perplexity.\r\n\r\n##### Actual behaviour\r\n\r\nParameters Tested (what is not mentioned is kept at the default value):\r\n```python\r\nperplexity = [100, 200, 300, 500]\r\ndistance = [\"euclidean\", \"cosine\"]\r\nn_iter=2000\r\nlearning_rate=[200, X.shape[0] // 12]\r\nn_jobs=4\r\n```\r\n\r\nData Source:\r\n```python\r\nX = np.random.randint(-1, 1, shape=(600000, 100))\r\nX_test_1 = X[:300000, :]\r\nX_test_2 = X[:6000, :]\r\n```\r\n`X` is an embedding extracted using `tensorflow.keras.LSTM`.\r\n`X` does not contain any \"weird\" value (e.g. `nan` or `inf`)\r\n\r\n~~`X_test_1` leads to `nan` KL Divergence since the first 50 iterations~~\r\n~~`X_test_2` shows normal behaviour~~\r\n~~Random and bigger slices of  `X` also show normal behaviour~~\r\n\r\nValues of perplexity above 100 leads to `nan` KL Divergence since the first 50 iterations\r\n\r\n##### Steps to reproduce the behavior\r\n\r\nIt is hard to outline the steps for reproducing this behaviour since it appears to be data dependent. \r\nI have different behaviours on different slices of the input array while a colleague of mine reported a silent exit on one data source (of shape ~(10000, 250)) while normal behaviour on another.\r\n\r\n**UPDATE**\r\nThe problem apparently lies in the parameter `perplexity`: values above 100 will lead to `nan` KL Divergence, is this behaviour expected?","closed_by":{"login":"pavlin-policar","id":5758119,"node_id":"MDQ6VXNlcjU3NTgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/5758119?v=4","gravatar_id":"","url":"https://api.github.com/users/pavlin-policar","html_url":"https://github.com/pavlin-policar","followers_url":"https://api.github.com/users/pavlin-policar/followers","following_url":"https://api.github.com/users/pavlin-policar/following{/other_user}","gists_url":"https://api.github.com/users/pavlin-policar/gists{/gist_id}","starred_url":"https://api.github.com/users/pavlin-policar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavlin-policar/subscriptions","organizations_url":"https://api.github.com/users/pavlin-policar/orgs","repos_url":"https://api.github.com/users/pavlin-policar/repos","events_url":"https://api.github.com/users/pavlin-policar/events{/privacy}","received_events_url":"https://api.github.com/users/pavlin-policar/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/108/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/108/timeline","performed_via_github_app":null,"state_reason":"completed"}