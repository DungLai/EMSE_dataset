{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/153","repository_url":"https://api.github.com/repos/pavlin-policar/openTSNE","labels_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/153/labels{/name}","comments_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/153/comments","events_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/153/events","html_url":"https://github.com/pavlin-policar/openTSNE/issues/153","id":757533136,"node_id":"MDU6SXNzdWU3NTc1MzMxMzY=","number":153,"title":"Issue using custom metric","user":{"login":"jdtuck","id":2325587,"node_id":"MDQ6VXNlcjIzMjU1ODc=","avatar_url":"https://avatars.githubusercontent.com/u/2325587?v=4","gravatar_id":"","url":"https://api.github.com/users/jdtuck","html_url":"https://github.com/jdtuck","followers_url":"https://api.github.com/users/jdtuck/followers","following_url":"https://api.github.com/users/jdtuck/following{/other_user}","gists_url":"https://api.github.com/users/jdtuck/gists{/gist_id}","starred_url":"https://api.github.com/users/jdtuck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdtuck/subscriptions","organizations_url":"https://api.github.com/users/jdtuck/orgs","repos_url":"https://api.github.com/users/jdtuck/repos","events_url":"https://api.github.com/users/jdtuck/events{/privacy}","received_events_url":"https://api.github.com/users/jdtuck/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-12-05T04:00:15Z","updated_at":"2020-12-05T04:21:39Z","closed_at":"2020-12-05T04:21:39Z","author_association":"NONE","active_lock_reason":null,"body":"I just installed on a new machine and have installed pynndescent 0.5.1 and I am getting this error. I am using the latest version off of github.\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nTypingError                               Traceback (most recent call last)\r\n<ipython-input-16-8d7d25ecf5ce> in <module>\r\n----> 1 metrics_fr = train_classifier_fr(z1, y, 5, idx)\r\n\r\n/home/jdtuck/Documents/Research/elastic_umap/Code/tsne_classify_part.py in train_classifier_fr(x, y, n_splits, split, n_components, seed)\r\n    136                         RandomForestClassifier(random_state=np.random.RandomState(seed),n_jobs=-1))\r\n    137\r\n--> 138     metrics = train_cv(clf, x, y, skf, split)\r\n    139\r\n    140     return metrics\r\n\r\n/home/jdtuck/Documents/Research/elastic_umap/Code/tsne_classify_part.py in train_cv(clf, x, y, cv, split)\r\n    102         x_val, y_val = get_split(i_val, x, y)\r\n    103\r\n--> 104         clf.fit(x_train, y_train)\r\n    105\r\n    106         y_hat_train = clf.predict(x_train)\r\n\r\n~/.conda/envs/umap/lib/python3.8/site-packages/sklearn/pipeline.py in fit(self, X, y, **fit_params)\r\n    328         \"\"\"\r\n    329         fit_params_steps = self._check_fit_params(**fit_params)\r\n--> 330         Xt = self._fit(X, y, **fit_params_steps)\r\n    331         with _print_elapsed_time('Pipeline',\r\n    332                                  self._log_message(len(self.steps) - 1)):\r\n\r\n~/.conda/envs/umap/lib/python3.8/site-packages/sklearn/pipeline.py in _fit(self, X, y, **fit_params_steps)\r\n    290                 cloned_transformer = clone(transformer)\r\n    291             # Fit or load from cache the current transformer\r\n--> 292             X, fitted_transformer = fit_transform_one_cached(\r\n    293                 cloned_transformer, X, y, None,\r\n    294                 message_clsname='Pipeline',\r\n\r\n~/.conda/envs/umap/lib/python3.8/site-packages/joblib/memory.py in __call__(self, *args, **kwargs)\r\n    350\r\n    351     def __call__(self, *args, **kwargs):\r\n--> 352         return self.func(*args, **kwargs)\r\n    353\r\n    354     def call_and_shelve(self, *args, **kwargs):\r\n\r\n~/.conda/envs/umap/lib/python3.8/site-packages/sklearn/pipeline.py in _fit_transform_one(transformer, X, y, weight, message_clsname, message, **fit_params)\r\n    738     with _print_elapsed_time(message_clsname, message):\r\n    739         if hasattr(transformer, 'fit_transform'):\r\n--> 740             res = transformer.fit_transform(X, y, **fit_params)\r\n    741         else:\r\n    742             res = transformer.fit(X, y, **fit_params).transform(X)\r\n\r\n~/.conda/envs/umap/lib/python3.8/site-packages/openTSNE-0.4.4-py3.8-linux-x86_64.egg/openTSNE/sklearn.py in fit_transform(self, X, y)\r\n     34\r\n     35         \"\"\"\r\n---> 36         embedding = super().fit(X)\r\n     37         self.embedding_ = embedding\r\n     38         return self.embedding_.view(np.ndarray)\r\n\r\n~/.conda/envs/umap/lib/python3.8/site-packages/openTSNE-0.4.4-py3.8-linux-x86_64.egg/openTSNE/tsne.py in fit(self, X)\r\n   1199             print(\"-\" * 80, repr(self), \"-\" * 80, sep=\"\\n\")\r\n   1200\r\n-> 1201         embedding = self.prepare_initial(X)\r\n   1202\r\n   1203         try:\r\n\r\n~/.conda/envs/umap/lib/python3.8/site-packages/openTSNE-0.4.4-py3.8-linux-x86_64.egg/openTSNE/tsne.py in prepare_initial(self, X)\r\n   1245\r\n   1246         if self.affinities is None:\r\n-> 1247             affinities = PerplexityBasedNN(\r\n   1248                 X,\r\n   1249                 self.perplexity,\r\n\r\n~/.conda/envs/umap/lib/python3.8/site-packages/openTSNE-0.4.4-py3.8-linux-x86_64.egg/openTSNE/affinity.py in __init__(self, data, perplexity, method, metric, metric_params, symmetrize, n_jobs, random_state, verbose)\r\n    135\r\n    136         k_neighbors = min(self.n_samples - 1, int(3 * self.perplexity))\r\n--> 137         self.knn_index, self.__neighbors, self.__distances = build_knn_index(\r\n    138             data, method, k_neighbors, metric, metric_params, n_jobs, random_state, verbose\r\n    139         )\r\n\r\n~/.conda/envs/umap/lib/python3.8/site-packages/openTSNE-0.4.4-py3.8-linux-x86_64.egg/openTSNE/affinity.py in build_knn_index(data, method, k, metric, metric_params, n_jobs, random_state, verbose)\r\n    317         )\r\n    318\r\n--> 319     neighbors, distances = knn_index.build(data, k=k)\r\n    320\r\n    321     return knn_index, neighbors, distances\r\n\r\n~/.conda/envs/umap/lib/python3.8/site-packages/openTSNE-0.4.4-py3.8-linux-x86_64.egg/openTSNE/nearest_neighbors.py in build(self, data, k)\r\n    381             n_neighbors_build = 15\r\n    382\r\n--> 383         self.index = pynndescent.NNDescent(\r\n    384             data,\r\n    385             n_neighbors=n_neighbors_build,\r\n\r\n~/.conda/envs/umap/lib/python3.8/site-packages/pynndescent/pynndescent_.py in __init__(self, data, metric, metric_kwds, n_neighbors, n_trees, leaf_size, pruning_degree_multiplier, diversify_prob, n_search_trees, tree_init, init_graph, random_state, low_memory, max_candidates, n_iters, delta, n_jobs, compressed, verbose)\r\n    901                 print(ts(), \"NN descent for\", str(n_iters), \"iterations\")\r\n    902\r\n--> 903             self._neighbor_graph = nn_descent(\r\n    904                 self._raw_data,\r\n    905                 self.n_neighbors,\r\n\r\n~/.conda/envs/umap/lib/python3.8/site-packages/numba/core/dispatcher.py in _compile_for_args(self, *args, **kws)\r\n    413                 e.patch_message(msg)\r\n    414\r\n--> 415             error_rewrite(e, 'typing')\r\n    416         except errors.UnsupportedError as e:\r\n    417             # Something unsupported is present in the user code, add help info\r\n\r\n~/.conda/envs/umap/lib/python3.8/site-packages/numba/core/dispatcher.py in error_rewrite(e, issue_type)\r\n    356                 raise e\r\n    357             else:\r\n--> 358                 reraise(type(e), e, None)\r\n    359\r\n    360         argtypes = []\r\n\r\n~/.conda/envs/umap/lib/python3.8/site-packages/numba/core/utils.py in reraise(tp, value, tb)\r\n     78         value = tp()\r\n     79     if value.__traceback__ is not tb:\r\n---> 80         raise value.with_traceback(tb)\r\n     81     raise value\r\n     82\r\n\r\nTypingError: Failed in nopython mode pipeline (step: nopython frontend)\r\nFailed in nopython mode pipeline (step: nopython frontend)\r\nFailed in nopython mode pipeline (step: nopython frontend)\r\nFailed in nopython mode pipeline (step: nopython frontend)\r\nInternal error at <numba.core.typeinfer.CallConstraint object at 0x7fc760a35f10>.\r\ntoo many positional arguments\r\nDuring: resolving callee type: type(CPUDispatcher(<function efda_distance at 0x7fc7b16ce790>))\r\nDuring: typing of call at /ascldap/users/jdtuck/.conda/envs/umap/lib/python3.8/site-packages/pynndescent/pynndescent_.py (748)\r\n\r\nEnable logging at debug level for details.\r\n\r\nFile \"../../../../../../ascldap/users/jdtuck/.conda/envs/umap/lib/python3.8/site-packages/pynndescent/pynndescent_.py\", line 748:\r\n            def _partial_dist_func(x, y):\r\n                return _distance_func(x, y, *dist_args)\r\n                ^\r\n\r\nDuring: resolving callee type: type(CPUDispatcher(<function NNDescent.__init__.<locals>._partial_dist_func at 0x7fc7b0761160>))\r\nDuring: typing of call at /ascldap/users/jdtuck/.conda/envs/umap/lib/python3.8/site-packages/pynndescent/pynndescent_.py (83)\r\n\r\nDuring: resolving callee type: type(CPUDispatcher(<function NNDescent.__init__.<locals>._partial_dist_func at 0x7fc7b0761160>))\r\nDuring: typing of call at /ascldap/users/jdtuck/.conda/envs/umap/lib/python3.8/site-packages/pynndescent/pynndescent_.py (83)\r\n\r\nDuring: resolving callee type: type(CPUDispatcher(<function NNDescent.__init__.<locals>._partial_dist_func at 0x7fc7b0761160>))\r\nDuring: typing of call at /ascldap/users/jdtuck/.conda/envs/umap/lib/python3.8/site-packages/pynndescent/pynndescent_.py (83)\r\n\r\n\r\nFile \"../../../../../../ascldap/users/jdtuck/.conda/envs/umap/lib/python3.8/site-packages/pynndescent/pynndescent_.py\", line 83:\r\ndef generate_leaf_updates(leaf_block, dist_thresholds, data, dist):\r\n    <source elided>\r\n\r\n                d = dist(data[p], data[q])\r\n                ^\r\n\r\nDuring: resolving callee type: type(CPUDispatcher(<function generate_leaf_updates at 0x7fc7609e91f0>))\r\nDuring: typing of call at /ascldap/users/jdtuck/.conda/envs/umap/lib/python3.8/site-packages/pynndescent/pynndescent_.py (110)\r\n\r\nDuring: resolving callee type: type(CPUDispatcher(<function generate_leaf_updates at 0x7fc7609e91f0>))\r\nDuring: typing of call at /ascldap/users/jdtuck/.conda/envs/umap/lib/python3.8/site-packages/pynndescent/pynndescent_.py (110)\r\n\r\n\r\nFile \"../../../../../../ascldap/users/jdtuck/.conda/envs/umap/lib/python3.8/site-packages/pynndescent/pynndescent_.py\", line 110:\r\ndef init_rp_tree(data, dist, current_graph, leaf_array):\r\n    <source elided>\r\n\r\n        updates = generate_leaf_updates(\r\n        ^\r\n\r\nDuring: resolving callee type: type(CPUDispatcher(<function init_rp_tree at 0x7fc760b0cb80>))\r\nDuring: typing of call at /ascldap/users/jdtuck/.conda/envs/umap/lib/python3.8/site-packages/pynndescent/pynndescent_.py (365)\r\n\r\nDuring: resolving callee type: type(CPUDispatcher(<function init_rp_tree at 0x7fc760b0cb80>))\r\nDuring: typing of call at /ascldap/users/jdtuck/.conda/envs/umap/lib/python3.8/site-packages/pynndescent/pynndescent_.py (365)\r\n\r\n\r\nFile \"../../../../../../ascldap/users/jdtuck/.conda/envs/umap/lib/python3.8/site-packages/pynndescent/pynndescent_.py\", line 365:\r\ndef nn_descent(\r\n    <source elided>\r\n        if rp_tree_init:\r\n            init_rp_tree(data, dist, current_graph, leaf_array)\r\n```","closed_by":{"login":"jdtuck","id":2325587,"node_id":"MDQ6VXNlcjIzMjU1ODc=","avatar_url":"https://avatars.githubusercontent.com/u/2325587?v=4","gravatar_id":"","url":"https://api.github.com/users/jdtuck","html_url":"https://github.com/jdtuck","followers_url":"https://api.github.com/users/jdtuck/followers","following_url":"https://api.github.com/users/jdtuck/following{/other_user}","gists_url":"https://api.github.com/users/jdtuck/gists{/gist_id}","starred_url":"https://api.github.com/users/jdtuck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdtuck/subscriptions","organizations_url":"https://api.github.com/users/jdtuck/orgs","repos_url":"https://api.github.com/users/jdtuck/repos","events_url":"https://api.github.com/users/jdtuck/events{/privacy}","received_events_url":"https://api.github.com/users/jdtuck/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/153/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pavlin-policar/openTSNE/issues/153/timeline","performed_via_github_app":null,"state_reason":"completed"}