[{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/1241498495","html_url":"https://github.com/allenai/scispacy/issues/450#issuecomment-1241498495","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/450","id":1241498495,"node_id":"IC_kwDOCPNzOc5J_8N_","user":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false},"created_at":"2022-09-09T04:55:36Z","updated_at":"2022-09-09T04:55:36Z","author_association":"COLLABORATOR","body":"Hi, so this is an issue with something I have done wrong with including the vocab file that I haven't had time to figure out properly. That being said, we should be able to work around it.\n\nYou'll need to create that file, and put it in the location it says (project_data folder). The command to create the file is here https://github.com/allenai/scispacy/blob/e30b8f4ce44460ee65c97250f4c368a15f8c8542/project.yml#L240. To run that command you will also need to download the frequency file. The command for that is here https://github.com/allenai/scispacy/blob/e30b8f4ce44460ee65c97250f4c368a15f8c8542/project.yml#L164. After doing those two things you should have the missing file, and be able to continue. Hopefully I'll figure out the \"correct\" solution at some point, but please do let me know if this works for you or not.\n\nSide note: I notice a warning about using different versions of spacy. You should make sure the version of spacy you are using is the right version for the version of scispacy you are using. So, either upgrade scispacy or downgrade spacy. ","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/1241498495/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/1242104759","html_url":"https://github.com/allenai/scispacy/issues/450#issuecomment-1242104759","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/450","id":1242104759,"node_id":"IC_kwDOCPNzOc5KCQO3","user":{"login":"Jason-B-Jiang","id":79412167,"node_id":"MDQ6VXNlcjc5NDEyMTY3","avatar_url":"https://avatars.githubusercontent.com/u/79412167?v=4","gravatar_id":"","url":"https://api.github.com/users/Jason-B-Jiang","html_url":"https://github.com/Jason-B-Jiang","followers_url":"https://api.github.com/users/Jason-B-Jiang/followers","following_url":"https://api.github.com/users/Jason-B-Jiang/following{/other_user}","gists_url":"https://api.github.com/users/Jason-B-Jiang/gists{/gist_id}","starred_url":"https://api.github.com/users/Jason-B-Jiang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jason-B-Jiang/subscriptions","organizations_url":"https://api.github.com/users/Jason-B-Jiang/orgs","repos_url":"https://api.github.com/users/Jason-B-Jiang/repos","events_url":"https://api.github.com/users/Jason-B-Jiang/events{/privacy}","received_events_url":"https://api.github.com/users/Jason-B-Jiang/received_events","type":"User","site_admin":false},"created_at":"2022-09-09T15:11:53Z","updated_at":"2022-09-09T15:11:53Z","author_association":"NONE","body":"Hi Daniel, thanks for the response! I tried your suggestions and the training config runs fine now (i.e: I can train without error using the generated config).\r\n\r\nIn case anyone runs into a similar problem in the future, here are instructions on how to reproduce the solution with my data.\r\n\r\n1) Run all the instructions I've given in my post, setting up the conda environment and downloading my data/code files\r\n\r\n2) Create a new folder called \"project_data\" in the microsp_host_relation_extraction folder\r\n\r\n3) Install the AWS command line interface w/ instructions from here: https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html\r\n\r\n4) Download the frequency file with AWS (you can find the variable values in project.yml):\r\naws s3 cp s3://ai2-s2-scispacy/data/gorc_subset.freqs assets/gorc_subset.freqs â€“no-sign-request\r\n\r\n5) Download convert_freqs.py with https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/allenai/scispacy/blob/e30b8f4ce44460ee65c97250f4c368a15f8c8542/scripts/convert_freqs.py, and copy it to the microsp_host_relation_extraction folder\r\n\r\n6) Create the missing vocab_lg.jsonl file:\r\npython convert_freqs.py --input_path assets/gorc_subset.freqs --output_path project_data/vocab_lg.jsonl --min_word_frequency 50\r\n\r\nHopefully you can generalize this fix to your problem too.\r\n\r\nCheers!","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/1242104759/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Jason-B-Jiang","id":79412167,"node_id":"MDQ6VXNlcjc5NDEyMTY3","avatar_url":"https://avatars.githubusercontent.com/u/79412167?v=4","gravatar_id":"","url":"https://api.github.com/users/Jason-B-Jiang","html_url":"https://github.com/Jason-B-Jiang","followers_url":"https://api.github.com/users/Jason-B-Jiang/followers","following_url":"https://api.github.com/users/Jason-B-Jiang/following{/other_user}","gists_url":"https://api.github.com/users/Jason-B-Jiang/gists{/gist_id}","starred_url":"https://api.github.com/users/Jason-B-Jiang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jason-B-Jiang/subscriptions","organizations_url":"https://api.github.com/users/Jason-B-Jiang/orgs","repos_url":"https://api.github.com/users/Jason-B-Jiang/repos","events_url":"https://api.github.com/users/Jason-B-Jiang/events{/privacy}","received_events_url":"https://api.github.com/users/Jason-B-Jiang/received_events","type":"User","site_admin":false}},{"id":7357357040,"node_id":"CE_lADOCPNzOc5RdApOzwAAAAG2iFvw","url":"https://api.github.com/repos/allenai/scispacy/issues/events/7357357040","actor":{"login":"Jason-B-Jiang","id":79412167,"node_id":"MDQ6VXNlcjc5NDEyMTY3","avatar_url":"https://avatars.githubusercontent.com/u/79412167?v=4","gravatar_id":"","url":"https://api.github.com/users/Jason-B-Jiang","html_url":"https://github.com/Jason-B-Jiang","followers_url":"https://api.github.com/users/Jason-B-Jiang/followers","following_url":"https://api.github.com/users/Jason-B-Jiang/following{/other_user}","gists_url":"https://api.github.com/users/Jason-B-Jiang/gists{/gist_id}","starred_url":"https://api.github.com/users/Jason-B-Jiang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jason-B-Jiang/subscriptions","organizations_url":"https://api.github.com/users/Jason-B-Jiang/orgs","repos_url":"https://api.github.com/users/Jason-B-Jiang/repos","events_url":"https://api.github.com/users/Jason-B-Jiang/events{/privacy}","received_events_url":"https://api.github.com/users/Jason-B-Jiang/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-09-09T15:22:35Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/1242416003","html_url":"https://github.com/allenai/scispacy/issues/450#issuecomment-1242416003","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/450","id":1242416003,"node_id":"IC_kwDOCPNzOc5KDcOD","user":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false},"created_at":"2022-09-09T20:12:04Z","updated_at":"2022-09-09T20:12:04Z","author_association":"COLLABORATOR","body":"Thanks for the detailed report!","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/1242416003/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false}},{"actor":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false},"created_at":"2022-09-16T05:49:14Z","updated_at":"2022-09-16T05:49:14Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/allenai/scispacy/issues/440","repository_url":"https://api.github.com/repos/allenai/scispacy","labels_url":"https://api.github.com/repos/allenai/scispacy/issues/440/labels{/name}","comments_url":"https://api.github.com/repos/allenai/scispacy/issues/440/comments","events_url":"https://api.github.com/repos/allenai/scispacy/issues/440/events","html_url":"https://github.com/allenai/scispacy/issues/440","id":1305354697,"node_id":"I_kwDOCPNzOc5NziHJ","number":440,"title":"Training scispacy pipelines require recreating the vocab file","user":{"login":"Hammad-NobleAI","id":108357284,"node_id":"U_kgDOBnVmpA","avatar_url":"https://avatars.githubusercontent.com/u/108357284?v=4","gravatar_id":"","url":"https://api.github.com/users/Hammad-NobleAI","html_url":"https://github.com/Hammad-NobleAI","followers_url":"https://api.github.com/users/Hammad-NobleAI/followers","following_url":"https://api.github.com/users/Hammad-NobleAI/following{/other_user}","gists_url":"https://api.github.com/users/Hammad-NobleAI/gists{/gist_id}","starred_url":"https://api.github.com/users/Hammad-NobleAI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hammad-NobleAI/subscriptions","organizations_url":"https://api.github.com/users/Hammad-NobleAI/orgs","repos_url":"https://api.github.com/users/Hammad-NobleAI/repos","events_url":"https://api.github.com/users/Hammad-NobleAI/events{/privacy}","received_events_url":"https://api.github.com/users/Hammad-NobleAI/received_events","type":"User","site_admin":false},"labels":[{"id":1068015159,"node_id":"MDU6TGFiZWwxMDY4MDE1MTU5","url":"https://api.github.com/repos/allenai/scispacy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2022-07-14T22:36:42Z","updated_at":"2022-09-16T05:49:47Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"repository":{"id":150172473,"node_id":"MDEwOlJlcG9zaXRvcnkxNTAxNzI0NzM=","name":"scispacy","full_name":"allenai/scispacy","private":false,"owner":{"login":"allenai","id":5667695,"node_id":"MDEyOk9yZ2FuaXphdGlvbjU2Njc2OTU=","avatar_url":"https://avatars.githubusercontent.com/u/5667695?v=4","gravatar_id":"","url":"https://api.github.com/users/allenai","html_url":"https://github.com/allenai","followers_url":"https://api.github.com/users/allenai/followers","following_url":"https://api.github.com/users/allenai/following{/other_user}","gists_url":"https://api.github.com/users/allenai/gists{/gist_id}","starred_url":"https://api.github.com/users/allenai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/allenai/subscriptions","organizations_url":"https://api.github.com/users/allenai/orgs","repos_url":"https://api.github.com/users/allenai/repos","events_url":"https://api.github.com/users/allenai/events{/privacy}","received_events_url":"https://api.github.com/users/allenai/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/allenai/scispacy","description":"A full spaCy pipeline and models for scientific/biomedical documents.","fork":false,"url":"https://api.github.com/repos/allenai/scispacy","forks_url":"https://api.github.com/repos/allenai/scispacy/forks","keys_url":"https://api.github.com/repos/allenai/scispacy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/allenai/scispacy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/allenai/scispacy/teams","hooks_url":"https://api.github.com/repos/allenai/scispacy/hooks","issue_events_url":"https://api.github.com/repos/allenai/scispacy/issues/events{/number}","events_url":"https://api.github.com/repos/allenai/scispacy/events","assignees_url":"https://api.github.com/repos/allenai/scispacy/assignees{/user}","branches_url":"https://api.github.com/repos/allenai/scispacy/branches{/branch}","tags_url":"https://api.github.com/repos/allenai/scispacy/tags","blobs_url":"https://api.github.com/repos/allenai/scispacy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/allenai/scispacy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/allenai/scispacy/git/refs{/sha}","trees_url":"https://api.github.com/repos/allenai/scispacy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/allenai/scispacy/statuses/{sha}","languages_url":"https://api.github.com/repos/allenai/scispacy/languages","stargazers_url":"https://api.github.com/repos/allenai/scispacy/stargazers","contributors_url":"https://api.github.com/repos/allenai/scispacy/contributors","subscribers_url":"https://api.github.com/repos/allenai/scispacy/subscribers","subscription_url":"https://api.github.com/repos/allenai/scispacy/subscription","commits_url":"https://api.github.com/repos/allenai/scispacy/commits{/sha}","git_commits_url":"https://api.github.com/repos/allenai/scispacy/git/commits{/sha}","comments_url":"https://api.github.com/repos/allenai/scispacy/comments{/number}","issue_comment_url":"https://api.github.com/repos/allenai/scispacy/issues/comments{/number}","contents_url":"https://api.github.com/repos/allenai/scispacy/contents/{+path}","compare_url":"https://api.github.com/repos/allenai/scispacy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/allenai/scispacy/merges","archive_url":"https://api.github.com/repos/allenai/scispacy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/allenai/scispacy/downloads","issues_url":"https://api.github.com/repos/allenai/scispacy/issues{/number}","pulls_url":"https://api.github.com/repos/allenai/scispacy/pulls{/number}","milestones_url":"https://api.github.com/repos/allenai/scispacy/milestones{/number}","notifications_url":"https://api.github.com/repos/allenai/scispacy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/allenai/scispacy/labels{/name}","releases_url":"https://api.github.com/repos/allenai/scispacy/releases{/id}","deployments_url":"https://api.github.com/repos/allenai/scispacy/deployments","created_at":"2018-09-24T21:45:52Z","updated_at":"2023-01-18T20:18:10Z","pushed_at":"2022-12-10T17:26:57Z","git_url":"git://github.com/allenai/scispacy.git","ssh_url":"git@github.com:allenai/scispacy.git","clone_url":"https://github.com/allenai/scispacy.git","svn_url":"https://github.com/allenai/scispacy","homepage":"https://allenai.github.io/scispacy/","size":248852,"stargazers_count":1306,"watchers_count":1306,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":false,"forks_count":180,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":31,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["bioinformatics","biomedical","custom-pipes","nlp","scientific-documents","spacy"],"visibility":"public","forks":180,"open_issues":31,"watchers":1306,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"I'm attempting to use your \"en_core_sci_lg\" pipeline to extract chemical entities from documents, and then using those entities as a basis to train Spacy's Entity Linker (as shown in this [document](https://github.com/explosion/projects/blob/master/nel-emerson/scripts/notebook_video.ipynb)). Here are the relevant portions of my code:\r\n\r\n```\r\nimport spacy\r\nimport scispacy\r\nnlp = spacy.load(\"en_core_sci_lg\")\r\n\r\n... prepare training documentation as Spacy specified in the form [tuples of form (text, {\"links\": (span.start, span.end), {qID: probability})]...\r\n\r\nentity_linker = nlp.create_pipe(\"entity_linker\", config={\"incl_prior\": False})\r\n\r\ndef create_kb(vocab):\r\n    kb = KnowledgeBase(vocab=nlp.vocab, entity_vector_length=200)\r\n\r\n    for qid, desc in desc_dict.items():\r\n        desc_doc = nlp(desc)\r\n        desc_enc = desc_doc.vector\r\n        kb.add_entity(entity=qid, entity_vector=desc_enc, freq=342)\r\n    return kb\r\n\r\nentity_linker.set_kb(create_kb)\r\nnlp.add_pipe(\"entity_linker\", last=True)\r\n\r\nfrom random import random\r\nfrom spacy.util import minibatch, compounding\r\nother_pipes = [pipe for pipe in nlp.pipe_names if pipe != \"entity_linker\"]\r\nwith nlp.disable_pipes(*other_pipes):   # train only the entity_linker\r\n        optimizer = nlp.begin_training() ## ERROR HERE\r\n        for itn in range(500):   # 500 iterations takes about a minute to train on this small dataset\r\n            random.shuffle(TRAIN_DOCS)\r\n            batches = minibatch(TRAIN_DOCS, size=compounding(4.0, 32.0, 1.001))   # increasing batch size\r\n            losses = {}\r\n            for batch in batches:\r\n                texts, annotations = zip(*batch)\r\n                nlp.update(\r\n                    texts,\r\n                    annotations,\r\n                    drop=0.2,   # prevent overfitting\r\n                    losses=losses,\r\n                    sgd=optimizer,\r\n                )\r\n            if itn % 50 == 0:\r\n                print(itn, \"Losses\", losses)   # print the training loss\r\nprint(itn, \"Losses\", losses)\r\n```\r\nWhen I get to the error line (commented towards the end of the code block), I get the following error:\r\n```\r\nRegistryError: [E893] Could not find function 'replace_tokenizer' in function registry 'callbacks'. If you're using a custom function, make sure the code is available. If the function is provided by a third-party package, e.g. spacy-transformers, make sure the package is installed in your environment.\r\n\r\nAvailable names: spacy.copy_from_base_model.v1, spacy.models_and_pipes_with_nvtx_range.v1, spacy.models_with_nvtx_range.v1\r\n```\r\n\r\nI'm running on Mac OS 12.4, M1 Pro, 16 GB unified memory. Scispacy==0.5.0, spacy==3.2.4. Are Scispacy models compatible with this workflow, or is that something that hasn't/won't be implemented? Thanks in advance!","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/440/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/allenai/scispacy/issues/440/timeline","performed_via_github_app":null,"state_reason":"reopened"}},"event":"cross-referenced"}]