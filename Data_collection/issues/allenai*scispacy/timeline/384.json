[{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/890260559","html_url":"https://github.com/allenai/scispacy/issues/384#issuecomment-890260559","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/384","id":890260559,"node_id":"IC_kwDOCPNzOc41EExP","user":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false},"created_at":"2021-07-31T00:08:03Z","updated_at":"2021-07-31T00:08:03Z","author_association":"COLLABORATOR","body":"I'd have to dig into this a bit more to debug, but you might want to open your tfidf vectors file and make sure that m/s is actually present. i suspect it might not be because its a character trigram vectorizer, and probably normalize out the `/`. I'm not 100% sure of this, but the things to check are 1) `m/s` is recognized as an entity (which you did) 2) `m/s` is present in your kb (you did) 3) check the representation that the vectorizer produces if you just pass it that text (just load the vectorizer object separately and poke around)","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/890260559/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892162042","html_url":"https://github.com/allenai/scispacy/issues/384#issuecomment-892162042","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/384","id":892162042,"node_id":"IC_kwDOCPNzOc41LU_6","user":{"login":"farrandi","id":54917098,"node_id":"MDQ6VXNlcjU0OTE3MDk4","avatar_url":"https://avatars.githubusercontent.com/u/54917098?v=4","gravatar_id":"","url":"https://api.github.com/users/farrandi","html_url":"https://github.com/farrandi","followers_url":"https://api.github.com/users/farrandi/followers","following_url":"https://api.github.com/users/farrandi/following{/other_user}","gists_url":"https://api.github.com/users/farrandi/gists{/gist_id}","starred_url":"https://api.github.com/users/farrandi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farrandi/subscriptions","organizations_url":"https://api.github.com/users/farrandi/orgs","repos_url":"https://api.github.com/users/farrandi/repos","events_url":"https://api.github.com/users/farrandi/events{/privacy}","received_events_url":"https://api.github.com/users/farrandi/received_events","type":"User","site_admin":false},"created_at":"2021-08-03T20:59:37Z","updated_at":"2021-08-03T20:59:37Z","author_association":"NONE","body":"Hello Daniel, thanks for the reply. However, I am not sure how to load the vectorizer separately.\r\nI tried doing this:\r\n```\r\nCustomLinkerPaths_mycustom = LinkerPaths(\r\n    ann_index=\"\",\r\n    tfidf_vectorizer=\"output/tfidf_vectorizer.joblib\",\r\n    tfidf_vectors=\"\",\r\n    concept_aliases_list=\"\",\r\n)\r\nclass myKnowledgeBase(KnowledgeBase):\r\n    def __init__(\r\n        self,\r\n        file_path: str = \"custom_kb.jsonl\",\r\n    ):\r\n        super().__init__(file_path)\r\n\r\nDEFAULT_PATHS[\"myCustom\"] = CustomLinkerPaths_mycustom\r\nDEFAULT_KNOWLEDGE_BASES[\"myCustom\"] = myKnowledgeBase\r\n\r\nnlp.add_pipe(\"scispacy_linker\", config={\"resolve_abbreviations\": True, \"linker_name\": \"myCustom\"})\r\nlinker = CandidateGenerator(name=\"myCustom\")\r\n```\r\nbut it gave me a `FileNotFoundError: file  not found` \r\n\r\nI also tried loading the joblib file but I am not sure where to go from here:\r\n```\r\nimport joblib\r\njoblib.load('output/tfidf_vectorizer.joblib')\r\n#TfidfVectorizer(analyzer='char_wb', dtype=<class 'numpy.float32'>, min_df=10, ngram_range=(3, 3))\r\n```","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892162042/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"farrandi","id":54917098,"node_id":"MDQ6VXNlcjU0OTE3MDk4","avatar_url":"https://avatars.githubusercontent.com/u/54917098?v=4","gravatar_id":"","url":"https://api.github.com/users/farrandi","html_url":"https://github.com/farrandi","followers_url":"https://api.github.com/users/farrandi/followers","following_url":"https://api.github.com/users/farrandi/following{/other_user}","gists_url":"https://api.github.com/users/farrandi/gists{/gist_id}","starred_url":"https://api.github.com/users/farrandi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farrandi/subscriptions","organizations_url":"https://api.github.com/users/farrandi/orgs","repos_url":"https://api.github.com/users/farrandi/repos","events_url":"https://api.github.com/users/farrandi/events{/privacy}","received_events_url":"https://api.github.com/users/farrandi/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892227436","html_url":"https://github.com/allenai/scispacy/issues/384#issuecomment-892227436","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/384","id":892227436,"node_id":"IC_kwDOCPNzOc41Lk9s","user":{"login":"farrandi","id":54917098,"node_id":"MDQ6VXNlcjU0OTE3MDk4","avatar_url":"https://avatars.githubusercontent.com/u/54917098?v=4","gravatar_id":"","url":"https://api.github.com/users/farrandi","html_url":"https://github.com/farrandi","followers_url":"https://api.github.com/users/farrandi/followers","following_url":"https://api.github.com/users/farrandi/following{/other_user}","gists_url":"https://api.github.com/users/farrandi/gists{/gist_id}","starred_url":"https://api.github.com/users/farrandi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farrandi/subscriptions","organizations_url":"https://api.github.com/users/farrandi/orgs","repos_url":"https://api.github.com/users/farrandi/repos","events_url":"https://api.github.com/users/farrandi/events{/privacy}","received_events_url":"https://api.github.com/users/farrandi/received_events","type":"User","site_admin":false},"created_at":"2021-08-03T23:15:48Z","updated_at":"2021-08-03T23:15:48Z","author_association":"NONE","body":"I also tried the same script but with different units (without the \"/\") like: `kg`, `bpm`, `ml` and all of them gave the same results.\r\n```\r\ntext = \"TR Max Velocity: 2.3 kg\"\r\ndoc = nlp(text)\r\nspacy.displacy.render(doc, style = \"ent\", jupyter = True)\r\n\r\nentity = doc.ents[2]\r\nprint(\"Name: \", entity)\r\n\r\nfor umls_ent in entity._.kb_ents:\r\n    print(\"xx\")\r\n    print(umls_ent)\r\n    print(linker.kb.cui_to_entity[umls_ent[0]])\r\n    print(\"----------------------\")\r\n```\r\nwould give:\r\n```\r\nName:  kg\r\n```\r\nso I am not sure if \"/\" is the problem.","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892227436/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"farrandi","id":54917098,"node_id":"MDQ6VXNlcjU0OTE3MDk4","avatar_url":"https://avatars.githubusercontent.com/u/54917098?v=4","gravatar_id":"","url":"https://api.github.com/users/farrandi","html_url":"https://github.com/farrandi","followers_url":"https://api.github.com/users/farrandi/followers","following_url":"https://api.github.com/users/farrandi/following{/other_user}","gists_url":"https://api.github.com/users/farrandi/gists{/gist_id}","starred_url":"https://api.github.com/users/farrandi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farrandi/subscriptions","organizations_url":"https://api.github.com/users/farrandi/orgs","repos_url":"https://api.github.com/users/farrandi/repos","events_url":"https://api.github.com/users/farrandi/events{/privacy}","received_events_url":"https://api.github.com/users/farrandi/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892234989","html_url":"https://github.com/allenai/scispacy/issues/384#issuecomment-892234989","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/384","id":892234989,"node_id":"IC_kwDOCPNzOc41Lmzt","user":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false},"created_at":"2021-08-03T23:34:05Z","updated_at":"2021-08-03T23:34:05Z","author_association":"COLLABORATOR","body":"Can you 1) make sure that the linker is actually in your pipeline (`nlp.pipeline`) and 2) try changing the filtering, so set `filter_for_definitions=False` and `threshold=0.1`","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892234989/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892242861","html_url":"https://github.com/allenai/scispacy/issues/384#issuecomment-892242861","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/384","id":892242861,"node_id":"IC_kwDOCPNzOc41Lout","user":{"login":"farrandi","id":54917098,"node_id":"MDQ6VXNlcjU0OTE3MDk4","avatar_url":"https://avatars.githubusercontent.com/u/54917098?v=4","gravatar_id":"","url":"https://api.github.com/users/farrandi","html_url":"https://github.com/farrandi","followers_url":"https://api.github.com/users/farrandi/followers","following_url":"https://api.github.com/users/farrandi/following{/other_user}","gists_url":"https://api.github.com/users/farrandi/gists{/gist_id}","starred_url":"https://api.github.com/users/farrandi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farrandi/subscriptions","organizations_url":"https://api.github.com/users/farrandi/orgs","repos_url":"https://api.github.com/users/farrandi/repos","events_url":"https://api.github.com/users/farrandi/events{/privacy}","received_events_url":"https://api.github.com/users/farrandi/received_events","type":"User","site_admin":false},"created_at":"2021-08-03T23:53:35Z","updated_at":"2021-08-03T23:53:35Z","author_association":"NONE","body":"I did what you told me to:\r\n```\r\nnlp = spacy.load(\"new_model\")\r\nnlp.add_pipe(\"scispacy_linker\", config={\"resolve_abbreviations\": True, \"linker_name\": \"myCustom\",\r\n                                        \"filter_for_definitions\": False, \"threshold\": \"0.1\"})\r\nlinker = CandidateGenerator(name=\"myCustom\")\r\nprint(nlp.pipe_names)\r\nprint(nlp.pipeline)\r\n```\r\nwhich returned:\r\n```\r\n['tok2vec', 'tagger', 'parser', 'attribute_ruler', 'entity_ruler', 'ner', 'value_entity', 'scispacy_linker']\r\n[('tok2vec', <spacy.pipeline.tok2vec.Tok2Vec object at 0x7f3fad155ef0>), ('tagger', <spacy.pipeline.tagger.Tagger object at 0x7f3fb0732220>), ('parser', <spacy.pipeline.dep_parser.DependencyParser object at 0x7f3fabf96d00>), ('attribute_ruler', <spacy.pipeline.attributeruler.AttributeRuler object at 0x7f3fb0fbb980>), ('entity_ruler', <spacy.pipeline.entityruler.EntityRuler object at 0x7f3fb46b9840>), ('ner', <spacy.pipeline.ner.EntityRecognizer object at 0x7f3fabf96520>), ('value_entity', <function value_entity at 0x7f3fb1121b80>), ('scispacy_linker', <scispacy.linking.EntityLinker object at 0x7f3fabefc430>)]\r\n```\r\nShowing that the linker is in my pipeline, then I ran the same sentence as above but I still got the same result. ","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892242861/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"farrandi","id":54917098,"node_id":"MDQ6VXNlcjU0OTE3MDk4","avatar_url":"https://avatars.githubusercontent.com/u/54917098?v=4","gravatar_id":"","url":"https://api.github.com/users/farrandi","html_url":"https://github.com/farrandi","followers_url":"https://api.github.com/users/farrandi/followers","following_url":"https://api.github.com/users/farrandi/following{/other_user}","gists_url":"https://api.github.com/users/farrandi/gists{/gist_id}","starred_url":"https://api.github.com/users/farrandi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farrandi/subscriptions","organizations_url":"https://api.github.com/users/farrandi/orgs","repos_url":"https://api.github.com/users/farrandi/repos","events_url":"https://api.github.com/users/farrandi/events{/privacy}","received_events_url":"https://api.github.com/users/farrandi/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892246244","html_url":"https://github.com/allenai/scispacy/issues/384#issuecomment-892246244","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/384","id":892246244,"node_id":"IC_kwDOCPNzOc41Lpjk","user":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false},"created_at":"2021-08-04T00:01:23Z","updated_at":"2021-08-04T00:01:23Z","author_association":"COLLABORATOR","body":"Ok, at this point I would suggest setting a breakpoint inside the entity linker and stepping through one line at a time until you can see why there are no entities returned. I'm not sure if it is because there is something wrong with your nmslib index, or some other issue","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892246244/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892878141","html_url":"https://github.com/allenai/scispacy/issues/384#issuecomment-892878141","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/384","id":892878141,"node_id":"IC_kwDOCPNzOc41OD09","user":{"login":"farrandi","id":54917098,"node_id":"MDQ6VXNlcjU0OTE3MDk4","avatar_url":"https://avatars.githubusercontent.com/u/54917098?v=4","gravatar_id":"","url":"https://api.github.com/users/farrandi","html_url":"https://github.com/farrandi","followers_url":"https://api.github.com/users/farrandi/followers","following_url":"https://api.github.com/users/farrandi/following{/other_user}","gists_url":"https://api.github.com/users/farrandi/gists{/gist_id}","starred_url":"https://api.github.com/users/farrandi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farrandi/subscriptions","organizations_url":"https://api.github.com/users/farrandi/orgs","repos_url":"https://api.github.com/users/farrandi/repos","events_url":"https://api.github.com/users/farrandi/events{/privacy}","received_events_url":"https://api.github.com/users/farrandi/received_events","type":"User","site_admin":false},"created_at":"2021-08-04T18:28:57Z","updated_at":"2021-08-04T18:29:23Z","author_association":"NONE","body":"From debugging I noticed that the difference with my knowledge base compared to the UMLS one from scispacy is that there are no `batch_neighbors` and `batch_distances` when it calls `candidate_generation.py` from `linking.py` at line 116:\r\n```\r\n batch_candidates = self.candidate_generator(mention_strings, self.k)\r\n```\r\nDo you know why this is the case? \r\nis a possibility because my KB only has 25 entries (as I was just experimenting on how to use a custom KB in scispacy)?\r\nWould this problem disappear with more entries in the KB. Another thing to note was it only took around 1s for me to run the script to make the ann_index and in the discussions it normally takes hours.","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892878141/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"farrandi","id":54917098,"node_id":"MDQ6VXNlcjU0OTE3MDk4","avatar_url":"https://avatars.githubusercontent.com/u/54917098?v=4","gravatar_id":"","url":"https://api.github.com/users/farrandi","html_url":"https://github.com/farrandi","followers_url":"https://api.github.com/users/farrandi/followers","following_url":"https://api.github.com/users/farrandi/following{/other_user}","gists_url":"https://api.github.com/users/farrandi/gists{/gist_id}","starred_url":"https://api.github.com/users/farrandi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farrandi/subscriptions","organizations_url":"https://api.github.com/users/farrandi/orgs","repos_url":"https://api.github.com/users/farrandi/repos","events_url":"https://api.github.com/users/farrandi/events{/privacy}","received_events_url":"https://api.github.com/users/farrandi/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892893471","html_url":"https://github.com/allenai/scispacy/issues/384#issuecomment-892893471","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/384","id":892893471,"node_id":"IC_kwDOCPNzOc41OHkf","user":{"login":"MichalMalyska","id":12971408,"node_id":"MDQ6VXNlcjEyOTcxNDA4","avatar_url":"https://avatars.githubusercontent.com/u/12971408?v=4","gravatar_id":"","url":"https://api.github.com/users/MichalMalyska","html_url":"https://github.com/MichalMalyska","followers_url":"https://api.github.com/users/MichalMalyska/followers","following_url":"https://api.github.com/users/MichalMalyska/following{/other_user}","gists_url":"https://api.github.com/users/MichalMalyska/gists{/gist_id}","starred_url":"https://api.github.com/users/MichalMalyska/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MichalMalyska/subscriptions","organizations_url":"https://api.github.com/users/MichalMalyska/orgs","repos_url":"https://api.github.com/users/MichalMalyska/repos","events_url":"https://api.github.com/users/MichalMalyska/events{/privacy}","received_events_url":"https://api.github.com/users/MichalMalyska/received_events","type":"User","site_admin":false},"created_at":"2021-08-04T18:53:55Z","updated_at":"2021-08-04T18:53:55Z","author_association":"CONTRIBUTOR","body":"25 entries is very few entries, UMLS has ~4 Million as far as I remember ","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892893471/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"MichalMalyska","id":12971408,"node_id":"MDQ6VXNlcjEyOTcxNDA4","avatar_url":"https://avatars.githubusercontent.com/u/12971408?v=4","gravatar_id":"","url":"https://api.github.com/users/MichalMalyska","html_url":"https://github.com/MichalMalyska","followers_url":"https://api.github.com/users/MichalMalyska/followers","following_url":"https://api.github.com/users/MichalMalyska/following{/other_user}","gists_url":"https://api.github.com/users/MichalMalyska/gists{/gist_id}","starred_url":"https://api.github.com/users/MichalMalyska/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MichalMalyska/subscriptions","organizations_url":"https://api.github.com/users/MichalMalyska/orgs","repos_url":"https://api.github.com/users/MichalMalyska/repos","events_url":"https://api.github.com/users/MichalMalyska/events{/privacy}","received_events_url":"https://api.github.com/users/MichalMalyska/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892896906","html_url":"https://github.com/allenai/scispacy/issues/384#issuecomment-892896906","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/384","id":892896906,"node_id":"IC_kwDOCPNzOc41OIaK","user":{"login":"farrandi","id":54917098,"node_id":"MDQ6VXNlcjU0OTE3MDk4","avatar_url":"https://avatars.githubusercontent.com/u/54917098?v=4","gravatar_id":"","url":"https://api.github.com/users/farrandi","html_url":"https://github.com/farrandi","followers_url":"https://api.github.com/users/farrandi/followers","following_url":"https://api.github.com/users/farrandi/following{/other_user}","gists_url":"https://api.github.com/users/farrandi/gists{/gist_id}","starred_url":"https://api.github.com/users/farrandi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farrandi/subscriptions","organizations_url":"https://api.github.com/users/farrandi/orgs","repos_url":"https://api.github.com/users/farrandi/repos","events_url":"https://api.github.com/users/farrandi/events{/privacy}","received_events_url":"https://api.github.com/users/farrandi/received_events","type":"User","site_admin":false},"created_at":"2021-08-04T18:59:40Z","updated_at":"2021-08-04T18:59:40Z","author_association":"NONE","body":"Ah so most likely the problem lies there, alright then I'll try with a larger KB and update. \r\nBut as far as the process to add the custom KB, is what I am doing correct?\r\n","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892896906/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"farrandi","id":54917098,"node_id":"MDQ6VXNlcjU0OTE3MDk4","avatar_url":"https://avatars.githubusercontent.com/u/54917098?v=4","gravatar_id":"","url":"https://api.github.com/users/farrandi","html_url":"https://github.com/farrandi","followers_url":"https://api.github.com/users/farrandi/followers","following_url":"https://api.github.com/users/farrandi/following{/other_user}","gists_url":"https://api.github.com/users/farrandi/gists{/gist_id}","starred_url":"https://api.github.com/users/farrandi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farrandi/subscriptions","organizations_url":"https://api.github.com/users/farrandi/orgs","repos_url":"https://api.github.com/users/farrandi/repos","events_url":"https://api.github.com/users/farrandi/events{/privacy}","received_events_url":"https://api.github.com/users/farrandi/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892990933","html_url":"https://github.com/allenai/scispacy/issues/384#issuecomment-892990933","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/384","id":892990933,"node_id":"IC_kwDOCPNzOc41OfXV","user":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false},"created_at":"2021-08-04T21:35:37Z","updated_at":"2021-08-04T21:35:37Z","author_association":"COLLABORATOR","body":"I'd be a bit surprised if the small number of entries was the problem, but I am not intimately familiar with nmslib. One thing to try is to load your nmslib index separately (https://github.com/allenai/scispacy/blob/3d153ddad1f11f000f961f7a92c0d862b93c0973/scispacy/candidate_generation.py#L116), and then see if you can play around with it following their docs (starting point here, https://nmslib.github.io/nmslib/api.html#nmslib-floatindex), and just make sure it ended up with the entries you expected and everything looks reasonable.","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/892990933/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/893045780","html_url":"https://github.com/allenai/scispacy/issues/384#issuecomment-893045780","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/384","id":893045780,"node_id":"IC_kwDOCPNzOc41OswU","user":{"login":"farrandi","id":54917098,"node_id":"MDQ6VXNlcjU0OTE3MDk4","avatar_url":"https://avatars.githubusercontent.com/u/54917098?v=4","gravatar_id":"","url":"https://api.github.com/users/farrandi","html_url":"https://github.com/farrandi","followers_url":"https://api.github.com/users/farrandi/followers","following_url":"https://api.github.com/users/farrandi/following{/other_user}","gists_url":"https://api.github.com/users/farrandi/gists{/gist_id}","starred_url":"https://api.github.com/users/farrandi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farrandi/subscriptions","organizations_url":"https://api.github.com/users/farrandi/orgs","repos_url":"https://api.github.com/users/farrandi/repos","events_url":"https://api.github.com/users/farrandi/events{/privacy}","received_events_url":"https://api.github.com/users/farrandi/received_events","type":"User","site_admin":false},"created_at":"2021-08-04T23:38:09Z","updated_at":"2021-08-05T16:50:52Z","author_association":"NONE","body":"I did some more digging and I am not sure if the problem is the ann_index from the function above.\r\nI found out that the tfidf values from\r\nhttps://github.com/allenai/scispacy/blob/3d153ddad1f11f000f961f7a92c0d862b93c0973/scispacy/candidate_generation.py#L324\r\ngive different results.\r\n\r\nSo here is the result from the normal UMLS KB:\r\n![umls kb](https://user-images.githubusercontent.com/54917098/128267665-b054a198-9192-4b58-aef9-03562076b83a.png)\r\nand here is the result of the custom KB:\r\n![custom kb](https://user-images.githubusercontent.com/54917098/128267691-6f4b1eac-c96a-491b-8fdb-57b4928466e8.png)\r\n\r\nThis value affected the `batch_neighbors` and `batch_distances` when it was called in line 329:\r\n```\r\nbatch_neighbors, batch_distances = self.nmslib_knn_with_zero_vectors(tfidfs, k)\r\n```\r\nUsing the custom KB, https://github.com/allenai/scispacy/blob/3d153ddad1f11f000f961f7a92c0d862b93c0973/scispacy/candidate_generation.py#L251\r\nwould give the value of 1, so that made the if statement below True since `vectors` was `tfidf` that was passed to the function: ` self.nmslib_knn_with_zero_vectors(tfidfs, k)`\r\nhttps://github.com/allenai/scispacy/blob/3d153ddad1f11f000f961f7a92c0d862b93c0973/scispacy/candidate_generation.py#L263-L264\r\nand made them return empty arrays of neighbors and distance.\r\n\r\nIs the vectorizer the problem then? or am I missing something?\r\n\r\nUPDATE:\r\nI played around with the vectorizer and I found out that the stop_words_ in the vectorizer contains some of the entities in my KB.\r\n```\r\nimport joblib\r\nvectorizer = joblib.load(\"output/tfidf_vectorizer.joblib\")\r\nprint(vectorizer.stop_words_)\r\n```\r\nand this gave me:\r\n```\r\n{'g/m', 'ml/', ' g ', 'pm ', 'ds ', ' mi', 'm/s', '*m ', 'min', 'inc', ' 2/', '/m ', ' m/', '/m2', ' m²', 'ams', 'in ', 'ms/', 'gra', ' mm', '/s ', ' gr', 'l/m', 'mse', 's/m', ' m ', 'ec ', 'm2/', 'hes', 'pou', ' g/', ' ml', ' in', 'nds', ' cm', ' bp', 'mmh', 'ram', 'che', ' ms', '/mi', 'nch', ' hg', 'kg ', 'cm/', 'ml ', 'kg/', 'm2 ', 'm/m', ' po', '2/m', 'mhg', 'mm ', '/m*', 'cm ', ' l ', 'und', 'cm²', 'sec', 'm² ', 'hg ', 'bpm', 'es ', ' l/', 'oun', ' kg', ' % ', 'm*m', ' m2', ' / ', 'cm2', '/se', ' lb', 'lbs', 'bs '}\r\n```\r\nand the entities I tried with are `m/s` and `kg` which are both in the `stop_words_` list. Is this why the vectorizer shows none and if so how do I fix this?","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/893045780/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"farrandi","id":54917098,"node_id":"MDQ6VXNlcjU0OTE3MDk4","avatar_url":"https://avatars.githubusercontent.com/u/54917098?v=4","gravatar_id":"","url":"https://api.github.com/users/farrandi","html_url":"https://github.com/farrandi","followers_url":"https://api.github.com/users/farrandi/followers","following_url":"https://api.github.com/users/farrandi/following{/other_user}","gists_url":"https://api.github.com/users/farrandi/gists{/gist_id}","starred_url":"https://api.github.com/users/farrandi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farrandi/subscriptions","organizations_url":"https://api.github.com/users/farrandi/orgs","repos_url":"https://api.github.com/users/farrandi/repos","events_url":"https://api.github.com/users/farrandi/events{/privacy}","received_events_url":"https://api.github.com/users/farrandi/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/893633941","html_url":"https://github.com/allenai/scispacy/issues/384#issuecomment-893633941","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/384","id":893633941,"node_id":"IC_kwDOCPNzOc41Q8WV","user":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false},"created_at":"2021-08-05T17:16:39Z","updated_at":"2021-08-05T17:16:39Z","author_association":"COLLABORATOR","body":"the vectorizer construction (https://github.com/allenai/scispacy/blob/3d153ddad1f11f000f961f7a92c0d862b93c0973/scispacy/candidate_generation.py#L415) has a `min_df` of 10, meaning that any ngram has to be in at least 10 docs to be included in the vectorizer. you can change this if you want to test on smaller data.","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/893633941/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/893651819","html_url":"https://github.com/allenai/scispacy/issues/384#issuecomment-893651819","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/384","id":893651819,"node_id":"IC_kwDOCPNzOc41RAtr","user":{"login":"farrandi","id":54917098,"node_id":"MDQ6VXNlcjU0OTE3MDk4","avatar_url":"https://avatars.githubusercontent.com/u/54917098?v=4","gravatar_id":"","url":"https://api.github.com/users/farrandi","html_url":"https://github.com/farrandi","followers_url":"https://api.github.com/users/farrandi/followers","following_url":"https://api.github.com/users/farrandi/following{/other_user}","gists_url":"https://api.github.com/users/farrandi/gists{/gist_id}","starred_url":"https://api.github.com/users/farrandi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farrandi/subscriptions","organizations_url":"https://api.github.com/users/farrandi/orgs","repos_url":"https://api.github.com/users/farrandi/repos","events_url":"https://api.github.com/users/farrandi/events{/privacy}","received_events_url":"https://api.github.com/users/farrandi/received_events","type":"User","site_admin":false},"created_at":"2021-08-05T17:32:22Z","updated_at":"2021-08-05T17:32:22Z","author_association":"NONE","body":"Yep, that was the problem. What do you mean it has to be in at least 10 docs? when we run the script `create_liner.py`  we don't pass any text to it right?","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/893651819/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"farrandi","id":54917098,"node_id":"MDQ6VXNlcjU0OTE3MDk4","avatar_url":"https://avatars.githubusercontent.com/u/54917098?v=4","gravatar_id":"","url":"https://api.github.com/users/farrandi","html_url":"https://github.com/farrandi","followers_url":"https://api.github.com/users/farrandi/followers","following_url":"https://api.github.com/users/farrandi/following{/other_user}","gists_url":"https://api.github.com/users/farrandi/gists{/gist_id}","starred_url":"https://api.github.com/users/farrandi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farrandi/subscriptions","organizations_url":"https://api.github.com/users/farrandi/orgs","repos_url":"https://api.github.com/users/farrandi/repos","events_url":"https://api.github.com/users/farrandi/events{/privacy}","received_events_url":"https://api.github.com/users/farrandi/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/893654736","html_url":"https://github.com/allenai/scispacy/issues/384#issuecomment-893654736","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/384","id":893654736,"node_id":"IC_kwDOCPNzOc41RBbQ","user":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false},"created_at":"2021-08-05T17:37:07Z","updated_at":"2021-08-05T17:37:07Z","author_association":"COLLABORATOR","body":"a \"doc\" here is a concept name. the tfidf vectorizer is fit on all the concept names in the kb using character trigrams. so any character trigrams that do not occur in at least 10 docs will not be included in the vectorizer. you can of course change this 10 to something lower if you want.","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/893654736/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false}},{"id":5118938805,"node_id":"MDExOkNsb3NlZEV2ZW50NTExODkzODgwNQ==","url":"https://api.github.com/repos/allenai/scispacy/issues/events/5118938805","actor":{"login":"farrandi","id":54917098,"node_id":"MDQ6VXNlcjU0OTE3MDk4","avatar_url":"https://avatars.githubusercontent.com/u/54917098?v=4","gravatar_id":"","url":"https://api.github.com/users/farrandi","html_url":"https://github.com/farrandi","followers_url":"https://api.github.com/users/farrandi/followers","following_url":"https://api.github.com/users/farrandi/following{/other_user}","gists_url":"https://api.github.com/users/farrandi/gists{/gist_id}","starred_url":"https://api.github.com/users/farrandi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farrandi/subscriptions","organizations_url":"https://api.github.com/users/farrandi/orgs","repos_url":"https://api.github.com/users/farrandi/repos","events_url":"https://api.github.com/users/farrandi/events{/privacy}","received_events_url":"https://api.github.com/users/farrandi/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-08-05T17:48:21Z","state_reason":null,"performed_via_github_app":null}]