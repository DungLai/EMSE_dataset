[{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/779460772","html_url":"https://github.com/allenai/scispacy/issues/319#issuecomment-779460772","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/319","id":779460772,"node_id":"MDEyOklzc3VlQ29tbWVudDc3OTQ2MDc3Mg==","user":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false},"created_at":"2021-02-15T21:42:35Z","updated_at":"2021-02-15T21:42:35Z","author_association":"COLLABORATOR","body":"I suspect this is the bug fixed by #298. Are you able to upgrade to the latest scispacy version (and spacy version)?","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/779460772/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/779744218","html_url":"https://github.com/allenai/scispacy/issues/319#issuecomment-779744218","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/319","id":779744218,"node_id":"MDEyOklzc3VlQ29tbWVudDc3OTc0NDIxOA==","user":{"login":"mnhcorp","id":2000186,"node_id":"MDQ6VXNlcjIwMDAxODY=","avatar_url":"https://avatars.githubusercontent.com/u/2000186?v=4","gravatar_id":"","url":"https://api.github.com/users/mnhcorp","html_url":"https://github.com/mnhcorp","followers_url":"https://api.github.com/users/mnhcorp/followers","following_url":"https://api.github.com/users/mnhcorp/following{/other_user}","gists_url":"https://api.github.com/users/mnhcorp/gists{/gist_id}","starred_url":"https://api.github.com/users/mnhcorp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mnhcorp/subscriptions","organizations_url":"https://api.github.com/users/mnhcorp/orgs","repos_url":"https://api.github.com/users/mnhcorp/repos","events_url":"https://api.github.com/users/mnhcorp/events{/privacy}","received_events_url":"https://api.github.com/users/mnhcorp/received_events","type":"User","site_admin":false},"created_at":"2021-02-16T10:31:26Z","updated_at":"2021-02-16T10:31:26Z","author_association":"NONE","body":"Indeed, upgrading to the latest scispacy (and spacy) fixed it - thanks a lot! :)\r\n\r\nQuick sidenote - the new version seems to be eating up WAY too much memory, is this expected? (I'm loading all three - core_sci_sm, ner_bc5cdr & ner_bionlp):\r\n\r\n![image](https://user-images.githubusercontent.com/2000186/108050698-fb9d4180-706f-11eb-83fc-898145a66c8b.png)\r\n\r\nThanks again!","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/779744218/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mnhcorp","id":2000186,"node_id":"MDQ6VXNlcjIwMDAxODY=","avatar_url":"https://avatars.githubusercontent.com/u/2000186?v=4","gravatar_id":"","url":"https://api.github.com/users/mnhcorp","html_url":"https://github.com/mnhcorp","followers_url":"https://api.github.com/users/mnhcorp/followers","following_url":"https://api.github.com/users/mnhcorp/following{/other_user}","gists_url":"https://api.github.com/users/mnhcorp/gists{/gist_id}","starred_url":"https://api.github.com/users/mnhcorp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mnhcorp/subscriptions","organizations_url":"https://api.github.com/users/mnhcorp/orgs","repos_url":"https://api.github.com/users/mnhcorp/repos","events_url":"https://api.github.com/users/mnhcorp/events{/privacy}","received_events_url":"https://api.github.com/users/mnhcorp/received_events","type":"User","site_admin":false}},{"id":4335633902,"node_id":"MDExOkNsb3NlZEV2ZW50NDMzNTYzMzkwMg==","url":"https://api.github.com/repos/allenai/scispacy/issues/events/4335633902","actor":{"login":"mnhcorp","id":2000186,"node_id":"MDQ6VXNlcjIwMDAxODY=","avatar_url":"https://avatars.githubusercontent.com/u/2000186?v=4","gravatar_id":"","url":"https://api.github.com/users/mnhcorp","html_url":"https://github.com/mnhcorp","followers_url":"https://api.github.com/users/mnhcorp/followers","following_url":"https://api.github.com/users/mnhcorp/following{/other_user}","gists_url":"https://api.github.com/users/mnhcorp/gists{/gist_id}","starred_url":"https://api.github.com/users/mnhcorp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mnhcorp/subscriptions","organizations_url":"https://api.github.com/users/mnhcorp/orgs","repos_url":"https://api.github.com/users/mnhcorp/repos","events_url":"https://api.github.com/users/mnhcorp/events{/privacy}","received_events_url":"https://api.github.com/users/mnhcorp/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-02-16T11:08:11Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/780011375","html_url":"https://github.com/allenai/scispacy/issues/319#issuecomment-780011375","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/319","id":780011375,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MDAxMTM3NQ==","user":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false},"created_at":"2021-02-16T17:53:46Z","updated_at":"2021-02-16T17:53:46Z","author_association":"COLLABORATOR","body":"What are you loading/running exactly? I loaded those three models, and it used ~3G of ram.","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/780011375/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/780451688","html_url":"https://github.com/allenai/scispacy/issues/319#issuecomment-780451688","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/319","id":780451688,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MDQ1MTY4OA==","user":{"login":"mnhcorp","id":2000186,"node_id":"MDQ6VXNlcjIwMDAxODY=","avatar_url":"https://avatars.githubusercontent.com/u/2000186?v=4","gravatar_id":"","url":"https://api.github.com/users/mnhcorp","html_url":"https://github.com/mnhcorp","followers_url":"https://api.github.com/users/mnhcorp/followers","following_url":"https://api.github.com/users/mnhcorp/following{/other_user}","gists_url":"https://api.github.com/users/mnhcorp/gists{/gist_id}","starred_url":"https://api.github.com/users/mnhcorp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mnhcorp/subscriptions","organizations_url":"https://api.github.com/users/mnhcorp/orgs","repos_url":"https://api.github.com/users/mnhcorp/repos","events_url":"https://api.github.com/users/mnhcorp/events{/privacy}","received_events_url":"https://api.github.com/users/mnhcorp/received_events","type":"User","site_admin":false},"created_at":"2021-02-17T10:15:33Z","updated_at":"2021-02-17T10:15:33Z","author_association":"NONE","body":"That's correct: loading the three models take up ~3GB of RAM. It's the EntityLinker that takes up the remaining space. Here's what I'm doing:\r\n\r\n```\r\nmodel = {}\r\nlinker_config={\"resolve_abbreviations\": True, \"name\": \"umls\", \"max_entities_per_mention\": 1}\r\n\r\nmodel['core'] = spacy.load(\"en_core_sci_sm\")\r\nmodel['bc5cdr']= spacy.load(\"en_ner_bc5cdr_md\")\r\nmodel['bionlp'] = spacy.load(\"en_ner_bionlp13cg_md\")\r\n\r\nmodel['core'].add_pipe(\"scispacy_linker\", config=linker_config)\r\nmodel['bc5cdr'].add_pipe(\"scispacy_linker\", config=linker_config)\r\nmodel['bionlp'].add_pipe(\"scispacy_linker\", config=linker_config)\r\n```\r\n\r\nIn spacy 2.x we could instantiate the EntityLinker and use it for all pipelines. With spacy 3.x add_pipe doesn't take callables anymore and needs a string (the name of the component factory). This duplicates the EntityLinker instantiation, I think, causing memory use to balloon up.\r\n\r\nThoughts on working around it and using a single EntityLinker instantiation across pipelines?\r\n\r\nThanks!\r\n\r\n","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/780451688/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mnhcorp","id":2000186,"node_id":"MDQ6VXNlcjIwMDAxODY=","avatar_url":"https://avatars.githubusercontent.com/u/2000186?v=4","gravatar_id":"","url":"https://api.github.com/users/mnhcorp","html_url":"https://github.com/mnhcorp","followers_url":"https://api.github.com/users/mnhcorp/followers","following_url":"https://api.github.com/users/mnhcorp/following{/other_user}","gists_url":"https://api.github.com/users/mnhcorp/gists{/gist_id}","starred_url":"https://api.github.com/users/mnhcorp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mnhcorp/subscriptions","organizations_url":"https://api.github.com/users/mnhcorp/orgs","repos_url":"https://api.github.com/users/mnhcorp/repos","events_url":"https://api.github.com/users/mnhcorp/events{/privacy}","received_events_url":"https://api.github.com/users/mnhcorp/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/780723704","html_url":"https://github.com/allenai/scispacy/issues/319#issuecomment-780723704","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/319","id":780723704,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MDcyMzcwNA==","user":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false},"created_at":"2021-02-17T17:33:58Z","updated_at":"2021-02-17T17:33:58Z","author_association":"COLLABORATOR","body":"ahh, i see. As a work around, i think you can do something like this, after loading the entity linker on just the core model\r\n\r\n```\r\nlinker = model['core'].get_pipe('scispacy_linker')\r\ndoc = linker(model['bc5cdr'](text))\r\n```\r\n\r\nI'm not sure if there is a way to add a pipe without creating a copy of it in spacy3, will have to look into it.","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/780723704/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/784103303","html_url":"https://github.com/allenai/scispacy/issues/319#issuecomment-784103303","issue_url":"https://api.github.com/repos/allenai/scispacy/issues/319","id":784103303,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDEwMzMwMw==","user":{"login":"mnhcorp","id":2000186,"node_id":"MDQ6VXNlcjIwMDAxODY=","avatar_url":"https://avatars.githubusercontent.com/u/2000186?v=4","gravatar_id":"","url":"https://api.github.com/users/mnhcorp","html_url":"https://github.com/mnhcorp","followers_url":"https://api.github.com/users/mnhcorp/followers","following_url":"https://api.github.com/users/mnhcorp/following{/other_user}","gists_url":"https://api.github.com/users/mnhcorp/gists{/gist_id}","starred_url":"https://api.github.com/users/mnhcorp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mnhcorp/subscriptions","organizations_url":"https://api.github.com/users/mnhcorp/orgs","repos_url":"https://api.github.com/users/mnhcorp/repos","events_url":"https://api.github.com/users/mnhcorp/events{/privacy}","received_events_url":"https://api.github.com/users/mnhcorp/received_events","type":"User","site_admin":false},"created_at":"2021-02-23T10:36:27Z","updated_at":"2021-02-23T10:36:27Z","author_association":"NONE","body":"Yup, that works - thanks again!\r\n","reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/comments/784103303/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mnhcorp","id":2000186,"node_id":"MDQ6VXNlcjIwMDAxODY=","avatar_url":"https://avatars.githubusercontent.com/u/2000186?v=4","gravatar_id":"","url":"https://api.github.com/users/mnhcorp","html_url":"https://github.com/mnhcorp","followers_url":"https://api.github.com/users/mnhcorp/followers","following_url":"https://api.github.com/users/mnhcorp/following{/other_user}","gists_url":"https://api.github.com/users/mnhcorp/gists{/gist_id}","starred_url":"https://api.github.com/users/mnhcorp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mnhcorp/subscriptions","organizations_url":"https://api.github.com/users/mnhcorp/orgs","repos_url":"https://api.github.com/users/mnhcorp/repos","events_url":"https://api.github.com/users/mnhcorp/events{/privacy}","received_events_url":"https://api.github.com/users/mnhcorp/received_events","type":"User","site_admin":false}}]