{"url":"https://api.github.com/repos/allenai/scispacy/issues/357","repository_url":"https://api.github.com/repos/allenai/scispacy","labels_url":"https://api.github.com/repos/allenai/scispacy/issues/357/labels{/name}","comments_url":"https://api.github.com/repos/allenai/scispacy/issues/357/comments","events_url":"https://api.github.com/repos/allenai/scispacy/issues/357/events","html_url":"https://github.com/allenai/scispacy/issues/357","id":894541804,"node_id":"MDU6SXNzdWU4OTQ1NDE4MDQ=","number":357,"title":"UmlsEntityLinker issue with proxy?","user":{"login":"starz10de","id":43435531,"node_id":"MDQ6VXNlcjQzNDM1NTMx","avatar_url":"https://avatars.githubusercontent.com/u/43435531?v=4","gravatar_id":"","url":"https://api.github.com/users/starz10de","html_url":"https://github.com/starz10de","followers_url":"https://api.github.com/users/starz10de/followers","following_url":"https://api.github.com/users/starz10de/following{/other_user}","gists_url":"https://api.github.com/users/starz10de/gists{/gist_id}","starred_url":"https://api.github.com/users/starz10de/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/starz10de/subscriptions","organizations_url":"https://api.github.com/users/starz10de/orgs","repos_url":"https://api.github.com/users/starz10de/repos","events_url":"https://api.github.com/users/starz10de/events{/privacy}","received_events_url":"https://api.github.com/users/starz10de/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2021-05-18T16:00:31Z","updated_at":"2022-03-11T18:29:12Z","closed_at":"2022-03-11T18:29:12Z","author_association":"NONE","active_lock_reason":null,"body":"I am using this code for UmlsEntityLinker:\r\n```\r\nimport scispacy\r\nimport spacy\r\n#import displacy\r\nfrom scispacy.abbreviation import AbbreviationDetector\r\nfrom scispacy.umls_linking import UmlsEntityLinker\r\nimport os\r\nos.environ['http_proxy'] = \"http://proxy.xxx:5555\" \r\nos.environ['https_proxy'] = \"https://proxy.xxx:5555\" \r\n\r\n#\r\nnlp = spacy.load('en_core_sci_sm')\r\nlinker = UmlsEntityLinker(resolve_abbreviations=True)\r\n\r\nnlp.add_pipe(linker)\r\n```\r\n\r\nHowever, it seems there is an issue with Proxy even though I am using the same Proxy commands for other tasks without any problem:\r\n\r\n```\r\nYour CPU supports instructions that this binary was not compiled to use: SSE3 SSE4.1 SSE4.2 AVX AVX2\r\nFor maximum performance, you can install NMSLIB from sources\r\npip install --no-binary :all: nmslib\r\nTraceback (most recent call last):\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/urllib3/connectionpool.py\", line 696, in urlopen\r\n    self._prepare_proxy(conn)\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/urllib3/connectionpool.py\", line 964, in _prepare_proxy\r\n    conn.connect()\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/urllib3/connection.py\", line 359, in connect\r\n    conn = self._connect_tls_proxy(hostname, conn)\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/urllib3/connection.py\", line 506, in _connect_tls_proxy\r\n    ssl_context=ssl_context,\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/urllib3/util/ssl_.py\", line 429, in ssl_wrap_socket\r\n    sock, context, tls_in_tls, server_hostname=server_hostname\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/urllib3/util/ssl_.py\", line 472, in _ssl_wrap_socket_impl\r\n    return ssl_context.wrap_socket(sock, server_hostname=server_hostname)\r\n  File \"/home/xx/anaconda3/lib/python3.7/ssl.py\", line 412, in wrap_socket\r\n    session=session\r\n  File \"/home/xx/anaconda3/lib/python3.7/ssl.py\", line 850, in _create\r\n    self.do_handshake()\r\n  File \"/home/xx/anaconda3/lib/python3.7/ssl.py\", line 1108, in do_handshake\r\n    self._sslobj.do_handshake()\r\nssl.SSLEOFError: EOF occurred in violation of protocol (_ssl.c:1045)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/requests/adapters.py\", line 449, in send\r\n    timeout=timeout\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/urllib3/connectionpool.py\", line 756, in urlopen\r\n    method, url, error=e, _pool=self, _stacktrace=sys.exc_info()[2]\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/urllib3/util/retry.py\", line 574, in increment\r\n    raise MaxRetryError(_pool, url, error or ResponseError(cause))\r\nurllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='s3-us-west-2.amazonaws.com', port=443): Max retries exceeded with url: /ai2-s2-scispacy/data/linkers/2020-10-09/umls/tfidf_vectors_sparse.npz (Caused by SSLError(SSLEOFError(8, 'EOF occurred in violation of protocol (_ssl.c:1045)')))\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"linker.py\", line 12, in <module>\r\n    linker = UmlsEntityLinker(resolve_abbreviations=True)\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/scispacy/linking.py\", line 85, in __init__\r\n    name=linker_name\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/scispacy/candidate_generation.py\", line 223, in __init__\r\n    linker_paths=linker_paths, ef_search=ef_search\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/scispacy/candidate_generation.py\", line 133, in load_approximate_nearest_neighbours_index\r\n    cached_path(linker_paths.tfidf_vectors)\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/scispacy/file_cache.py\", line 36, in cached_path\r\n    return get_from_cache(url_or_filename, cache_dir)\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/scispacy/file_cache.py\", line 112, in get_from_cache\r\n    response = requests.head(url, allow_redirects=True)\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/requests/api.py\", line 104, in head\r\n    return request('head', url, **kwargs)\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/requests/api.py\", line 61, in request\r\n    return session.request(method=method, url=url, **kwargs)\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/requests/sessions.py\", line 542, in request\r\n    resp = self.send(prep, **send_kwargs)\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/requests/sessions.py\", line 655, in send\r\n    r = adapter.send(request, **kwargs)\r\n  File \"/data/home/xx/scispacy/sci-env/lib/python3.7/site-packages/requests/adapters.py\", line 514, in send\r\n    raise SSLError(e, request=request)\r\nrequests.exceptions.SSLError: HTTPSConnectionPool(host='s3-us-west-2.amazonaws.com', port=443): Max retries exceeded with url: /ai2-s2-scispacy/data/linkers/2020-10-09/umls/tfidf_vectors_sparse.npz (Caused by SSLError(SSLEOFError(8, 'EOF occurred in violation of protocol (_ssl.c:1045)')))\r\n```\r\n\r\ndownloading the  \"/ai2-s2-scispacy/data/linkers/2020-10-09/umls/tfidf_vectors_sparse.npz\" using pip and the defined Proxy is done without any issue.","closed_by":{"login":"DeNeutoy","id":16001974,"node_id":"MDQ6VXNlcjE2MDAxOTc0","avatar_url":"https://avatars.githubusercontent.com/u/16001974?v=4","gravatar_id":"","url":"https://api.github.com/users/DeNeutoy","html_url":"https://github.com/DeNeutoy","followers_url":"https://api.github.com/users/DeNeutoy/followers","following_url":"https://api.github.com/users/DeNeutoy/following{/other_user}","gists_url":"https://api.github.com/users/DeNeutoy/gists{/gist_id}","starred_url":"https://api.github.com/users/DeNeutoy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DeNeutoy/subscriptions","organizations_url":"https://api.github.com/users/DeNeutoy/orgs","repos_url":"https://api.github.com/users/DeNeutoy/repos","events_url":"https://api.github.com/users/DeNeutoy/events{/privacy}","received_events_url":"https://api.github.com/users/DeNeutoy/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/357/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/allenai/scispacy/issues/357/timeline","performed_via_github_app":null,"state_reason":"completed"}