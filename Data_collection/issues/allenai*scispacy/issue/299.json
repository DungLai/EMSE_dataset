{"url":"https://api.github.com/repos/allenai/scispacy/issues/299","repository_url":"https://api.github.com/repos/allenai/scispacy","labels_url":"https://api.github.com/repos/allenai/scispacy/issues/299/labels{/name}","comments_url":"https://api.github.com/repos/allenai/scispacy/issues/299/comments","events_url":"https://api.github.com/repos/allenai/scispacy/issues/299/events","html_url":"https://github.com/allenai/scispacy/issues/299","id":791408579,"node_id":"MDU6SXNzdWU3OTE0MDg1Nzk=","number":299,"title":"EntityLinker instantiation stops execution with no errors","user":{"login":"arthurthlee","id":2807789,"node_id":"MDQ6VXNlcjI4MDc3ODk=","avatar_url":"https://avatars.githubusercontent.com/u/2807789?v=4","gravatar_id":"","url":"https://api.github.com/users/arthurthlee","html_url":"https://github.com/arthurthlee","followers_url":"https://api.github.com/users/arthurthlee/followers","following_url":"https://api.github.com/users/arthurthlee/following{/other_user}","gists_url":"https://api.github.com/users/arthurthlee/gists{/gist_id}","starred_url":"https://api.github.com/users/arthurthlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arthurthlee/subscriptions","organizations_url":"https://api.github.com/users/arthurthlee/orgs","repos_url":"https://api.github.com/users/arthurthlee/repos","events_url":"https://api.github.com/users/arthurthlee/events{/privacy}","received_events_url":"https://api.github.com/users/arthurthlee/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-01-21T18:51:14Z","updated_at":"2021-02-16T21:55:57Z","closed_at":"2021-02-16T21:55:57Z","author_association":"NONE","active_lock_reason":null,"body":"Hello, I am getting some strange behaviour with SciSpacy. I retrained the en_core_sci_lg NER model (which contains a tagger, parser, ner and ent_linker pipeline) and was able to run the script that I made that classifies text (running each epoch in order to calculate the F1 for each epoch) on Sagemaker. I downloaded the outputted model and I am now trying to load the model and run predictions, but when I try to initialize the model (which also initializes SciSpacy's EntityLinker), execution of the program silently stops at self.linker = EntityLinker(**linker_kwargs), and none of the print statements afterwards are executed. A snippet of the code is below; the last print statement that I see is \"Loaded model\"\r\n\r\nWhat am I doing wrong? Initially when loading the model, I got an error saying \"Can't find factory for 'ent_linker'\", so I added a factory before I load the model:\r\n```\r\nlinker_kwargs = {\r\n            \"resolve_abbreviations\": True,\r\n            \"name\": \"umls\",\r\n            \"filter_for_definitions\": False,\r\n            \"threshold\": 0.7,\r\n        }\r\nLanguage.factories[\"ent_linker\"] = lambda _, **kwargs: EntityLinker(**kwargs or linker_kwargs)\r\n        self.base_model = load_model_from_path(config[\"base_model_path\"])\r\n```\r\n\r\nThe code below works and predicts things properly during my training loop, when I manually add the ent_linker pipe, but doesn't work when I try to load the trained model from disk.\r\n\r\n```\r\n    def __init__(\r\n        self,\r\n        base_model,\r\n        allowed_ent_types=[\"Chemicals & Drugs\", \"Devices\", \"Objects\"],\r\n        linker_kwargs=None,\r\n        unknown_entity_label=\"UNKNOWN_ENTITY\",\r\n        include_unknown=True,\r\n        remove_stopwords=None,\r\n        ont_loc=str((ASSETS_FOLDER/'onts'/'tui.psv').absolute()),\r\n    ):\r\n        print(\"Initializing scispacy_ner\")\r\n        if isinstance(base_model, spacy.lang.en.English):\r\n            self.nlp = base_model\r\n            if \"ner\" not in self.nlp.pipe_names:\r\n                raise Exception(\"this model doesn't have NER\")\r\n        elif isinstance(base_model, str):\r\n            if os.path.isdir(base_model):\r\n                # this is a local model to load\r\n                self.nlp = load_model_from_path(base_model)\r\n            else:\r\n                self.nlp = spacy.load(model_name)\r\n        print(\"Loaded model\")\r\n        if not linker_kwargs:\r\n            linker_kwargs = {\r\n                \"resolve_abbreviations\": True,\r\n                \"name\": \"umls\",\r\n                \"filter_for_definitions\": False,\r\n                \"threshold\": 0.7,\r\n            }\r\n        self.linker = EntityLinker(**linker_kwargs)\r\n        print(\"Loaded entity linker\")\r\n        if \"ent_linker\" not in self.nlp.pipe_names:\r\n            print(\"Adding entity linker pipe\")\r\n            self.nlp.add_pipe(self.linker, name=\"ent_linker\")\r\n            print(\"Added pipe\")\r\n```\r\n\r\n## Your Environment\r\n\r\n- Operating System: Mac OS Catalina 10.15.3\r\n- Python Version Used: 3.7.4\r\n- spaCy Version Used: 2.3.2\r\n- Environment Information: Darwin-19.3.0-x86_64-i386-64bit","closed_by":{"login":"DeNeutoy","id":16001974,"node_id":"MDQ6VXNlcjE2MDAxOTc0","avatar_url":"https://avatars.githubusercontent.com/u/16001974?v=4","gravatar_id":"","url":"https://api.github.com/users/DeNeutoy","html_url":"https://github.com/DeNeutoy","followers_url":"https://api.github.com/users/DeNeutoy/followers","following_url":"https://api.github.com/users/DeNeutoy/following{/other_user}","gists_url":"https://api.github.com/users/DeNeutoy/gists{/gist_id}","starred_url":"https://api.github.com/users/DeNeutoy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DeNeutoy/subscriptions","organizations_url":"https://api.github.com/users/DeNeutoy/orgs","repos_url":"https://api.github.com/users/DeNeutoy/repos","events_url":"https://api.github.com/users/DeNeutoy/events{/privacy}","received_events_url":"https://api.github.com/users/DeNeutoy/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/299/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/allenai/scispacy/issues/299/timeline","performed_via_github_app":null,"state_reason":"completed"}