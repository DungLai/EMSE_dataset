{"url":"https://api.github.com/repos/allenai/scispacy/issues/450","repository_url":"https://api.github.com/repos/allenai/scispacy","labels_url":"https://api.github.com/repos/allenai/scispacy/issues/450/labels{/name}","comments_url":"https://api.github.com/repos/allenai/scispacy/issues/450/comments","events_url":"https://api.github.com/repos/allenai/scispacy/issues/450/events","html_url":"https://github.com/allenai/scispacy/issues/450","id":1366559310,"node_id":"I_kwDOCPNzOc5RdApO","number":450,"title":"Trouble training custom NER model for en_core_sci_lg - \"ValueError: Can't read file: project_data/vocab_lg.jsonl\"","user":{"login":"Jason-B-Jiang","id":79412167,"node_id":"MDQ6VXNlcjc5NDEyMTY3","avatar_url":"https://avatars.githubusercontent.com/u/79412167?v=4","gravatar_id":"","url":"https://api.github.com/users/Jason-B-Jiang","html_url":"https://github.com/Jason-B-Jiang","followers_url":"https://api.github.com/users/Jason-B-Jiang/followers","following_url":"https://api.github.com/users/Jason-B-Jiang/following{/other_user}","gists_url":"https://api.github.com/users/Jason-B-Jiang/gists{/gist_id}","starred_url":"https://api.github.com/users/Jason-B-Jiang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jason-B-Jiang/subscriptions","organizations_url":"https://api.github.com/users/Jason-B-Jiang/orgs","repos_url":"https://api.github.com/users/Jason-B-Jiang/repos","events_url":"https://api.github.com/users/Jason-B-Jiang/events{/privacy}","received_events_url":"https://api.github.com/users/Jason-B-Jiang/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-09-08T15:22:59Z","updated_at":"2022-09-09T20:12:04Z","closed_at":"2022-09-09T15:22:35Z","author_association":"NONE","active_lock_reason":null,"body":"Hello,\r\n\r\nI have been trying to train a new NER model for the en_core_sci_lg pipeline, freezing all the other pipeline components during training.\r\nI adapted a script from Explosion (https://github.com/explosion/projects/blob/v3/pipelines/ner_demo_replace/scripts/create_config.py) to generate a config file that only enables NER for training while freezing everything else.\r\n\r\nI could train a NER model for spacy's en_core_web_lg pipeline using the generated config file, but I ran into this error when I used the config file for en_core_sci_lg:\r\n\r\n✔ Created output directory: en_core_sci_lg_model\r\nℹ Saving to output directory: en_core_sci_lg_model\r\nℹ Using CPU\r\n\r\n=========================== Initializing pipeline ===========================\r\n/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/spacy/util.py:865: UserWarning: [W095] Model 'en_core_sci_lg' (0.5.0) was trained with spaCy v3.2 and may not be 100% compatible with the current version (3.4.1). If you see errors or degraded performance, download a newer compatible model or retrain your custom model with the current spaCy version. For more details and available updates, run: python -m spacy validate\r\n  warnings.warn(warn_msg)\r\n[2022-09-08 09:23:31,601] [INFO] Set up nlp object from config\r\n[2022-09-08 09:23:31,627] [INFO] Pipeline: ['tok2vec', 'tagger', 'attribute_ruler', 'lemmatizer', 'parser', 'ner']\r\n[2022-09-08 09:23:31,627] [INFO] Resuming training for: ['ner']\r\n[2022-09-08 09:23:31,654] [INFO] Copying tokenizer from: en_core_sci_lg\r\n/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/spacy/util.py:865: UserWarning: [W095] Model 'en_core_sci_lg' (0.5.0) was trained with spaCy v3.2 and may not be 100% compatible with the current version (3.4.1). If you see errors or degraded performance, download a newer compatible model or retrain your custom model with the current spaCy version. For more details and available updates, run: python -m spacy validate\r\n  warnings.warn(warn_msg)\r\n[2022-09-08 09:23:47,825] [INFO] Copying vocab from: en_core_sci_lg\r\nTraceback (most recent call last):\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\r\n    return _run_code(code, main_globals, None,\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/runpy.py\", line 87, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/spacy/__main__.py\", line 4, in <module>\r\n    setup_cli()\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/spacy/cli/_util.py\", line 71, in setup_cli\r\n    command(prog_name=COMMAND)\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/click/core.py\", line 829, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/click/core.py\", line 782, in main\r\n    rv = self.invoke(ctx)\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/click/core.py\", line 1259, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/click/core.py\", line 1066, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/click/core.py\", line 610, in invoke\r\n    return callback(*args, **kwargs)\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/typer/main.py\", line 497, in wrapper\r\n    return callback(**use_params)  # type: ignore\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/spacy/cli/train.py\", line 45, in train_cli\r\n    train(config_path, output_path, use_gpu=use_gpu, overrides=overrides)\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/spacy/cli/train.py\", line 72, in train\r\n    nlp = init_nlp(config, use_gpu=use_gpu)\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/spacy/training/initialize.py\", line 84, in init_nlp\r\n    nlp.initialize(lambda: train_corpus(nlp), sgd=optimizer)\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/spacy/language.py\", line 1295, in initialize\r\n    init_vocab(\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/spacy/training/initialize.py\", line 118, in init_vocab\r\n    for attrs in lex_attrs:\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/srsly/_json_api.py\", line 109, in read_jsonl\r\n    file_path = force_path(path)\r\n  File \"/home/boognish/mambaforge/envs/microsporidia_nlp/lib/python3.9/site-packages/srsly/util.py\", line 24, in force_path\r\n    raise ValueError(f\"Can't read file: {location}\")\r\nValueError: Can't read file: project_data/vocab_lg.jsonl\r\n\r\nHere are the steps to recreate this error:\r\n1) Download the code + data files from my github repo with this link: https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/Jason-B-Jiang/microsporidia_text_mining/tree/main/src/3_train_pipelines/microsp_host_relation_extraction\r\n\r\n2) Extract the compressed archive and change directory into the folder (should be named 'microsp_host_relation_extraction')\r\n\r\n3) Run the following commands in the command line\r\n# create new conda environment to install spacy, scispacy and en_core_sci_lg\r\nconda create --name scispacy_test\r\nconda activate scispacy_test\r\npip install spacy\r\npip install scispacy\r\npip install https://s3-us-west-2.amazonaws.com/ai2-s2-scispacy/releases/v0.5.1/en_core_sci_lg-0.5.1.tar.gz\r\n\r\n# create training config file for en_core_sci_lg\r\npython3 ./generate_training_config.py en_core_sci_lg ner config_en_core_sci_lg.cfg\r\n\r\n# train en_core_sci_lg NER model using the given training and validation data\r\npython3 -m spacy train ./config_en_core_sci_lg.cfg –output en_core_sci_lg_model –paths.train ./train.spacy –paths.dev ./valid.spacy\r\n\r\nThank you so much for reading this! I feel like I don't know enough about spaCy to troubleshoot this. I have tried googling and reading through spaCy's docs, but still can't figure out a solution.\r\n\r\nCheers,\r\nJason","closed_by":{"login":"Jason-B-Jiang","id":79412167,"node_id":"MDQ6VXNlcjc5NDEyMTY3","avatar_url":"https://avatars.githubusercontent.com/u/79412167?v=4","gravatar_id":"","url":"https://api.github.com/users/Jason-B-Jiang","html_url":"https://github.com/Jason-B-Jiang","followers_url":"https://api.github.com/users/Jason-B-Jiang/followers","following_url":"https://api.github.com/users/Jason-B-Jiang/following{/other_user}","gists_url":"https://api.github.com/users/Jason-B-Jiang/gists{/gist_id}","starred_url":"https://api.github.com/users/Jason-B-Jiang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jason-B-Jiang/subscriptions","organizations_url":"https://api.github.com/users/Jason-B-Jiang/orgs","repos_url":"https://api.github.com/users/Jason-B-Jiang/repos","events_url":"https://api.github.com/users/Jason-B-Jiang/events{/privacy}","received_events_url":"https://api.github.com/users/Jason-B-Jiang/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/450/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/allenai/scispacy/issues/450/timeline","performed_via_github_app":null,"state_reason":"completed"}