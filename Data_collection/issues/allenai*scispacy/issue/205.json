{"url":"https://api.github.com/repos/allenai/scispacy/issues/205","repository_url":"https://api.github.com/repos/allenai/scispacy","labels_url":"https://api.github.com/repos/allenai/scispacy/issues/205/labels{/name}","comments_url":"https://api.github.com/repos/allenai/scispacy/issues/205/comments","events_url":"https://api.github.com/repos/allenai/scispacy/issues/205/events","html_url":"https://github.com/allenai/scispacy/issues/205","id":578620400,"node_id":"MDU6SXNzdWU1Nzg2MjA0MDA=","number":205,"title":"Saving and Loading","user":{"login":"ChantalvanSon","id":6689853,"node_id":"MDQ6VXNlcjY2ODk4NTM=","avatar_url":"https://avatars.githubusercontent.com/u/6689853?v=4","gravatar_id":"","url":"https://api.github.com/users/ChantalvanSon","html_url":"https://github.com/ChantalvanSon","followers_url":"https://api.github.com/users/ChantalvanSon/followers","following_url":"https://api.github.com/users/ChantalvanSon/following{/other_user}","gists_url":"https://api.github.com/users/ChantalvanSon/gists{/gist_id}","starred_url":"https://api.github.com/users/ChantalvanSon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ChantalvanSon/subscriptions","organizations_url":"https://api.github.com/users/ChantalvanSon/orgs","repos_url":"https://api.github.com/users/ChantalvanSon/repos","events_url":"https://api.github.com/users/ChantalvanSon/events{/privacy}","received_events_url":"https://api.github.com/users/ChantalvanSon/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-03-10T14:27:44Z","updated_at":"2021-03-24T04:47:54Z","closed_at":"2021-03-24T04:47:54Z","author_association":"NONE","active_lock_reason":null,"body":"First of all, thanks for creating scispacy, I think it's an amazing tool and very useful!!\r\n\r\nI was running into an issue when saving the output of scispacy.  I tried to pickle a `Doc` object, as explained on the [website of spaCy](https://spacy.io/usage/saving-loading), as follows:\r\n\r\n```\r\nimport spacy\r\nimport pickle\r\n\r\nnlp = spacy.load(\"en_core_sci_sm\")\r\n\r\n# add the Abbreviation Detector\r\nabbreviation_pipe = AbbreviationDetector(nlp)\r\nnlp.add_pipe(abbreviation_pipe)\r\n\r\n# add the UMLS Entity Linker \r\nlinker = UmlsEntityLinker(resolve_abbreviations=True)\r\nnlp.add_pipe(linker)\r\n\r\n# parse and pickle\r\ndoc = nlp(\"Spinal and bulbar muscular atrophy (SBMA) is an \\\r\n           inherited motor neuron disease caused by the expansion \\\r\n           of a polyglutamine tract within the androgen receptor (AR). \\\r\n           SBMA can be caused by this easily.\")\r\nwith open(\"out.pickle\", \"wb\") as outfile:\r\n    pickle.dump(doc, outfile)\r\n```\r\n\r\nHowever, I'm getting the following error:\r\n\r\n```\r\nNotImplementedError: [E112] Pickling a span is not supported, because spans are only views of the parent Doc and can't exist on their own. A pickled span would always have to include its Doc and Vocab, which has practically no advantage over pickling the parent Doc directly. So instead of pickling the span, pickle the Doc it belongs to or use Span.as_doc to convert the span to a standalone Doc object.\r\n```\r\n\r\nThis error does not occur when there's no abbreviations detected in the text. For instance, this does work:\r\n\r\n```\r\n# parse and pickle\r\ndoc = nlp(\"Spinal and bulbar muscular atrophy is an \\\r\n           inherited motor neuron disease caused by the expansion \\\r\n           of a polyglutamine tract within the androgen receptor. \\\r\n           SBMA can be caused by this easily.\")\r\nwith open(\"out.pickle\", \"wb\") as outfile:\r\n    pickle.dump(doc, outfile)\r\n```\r\n\r\nI think it's because the abbreviations are stored as `Span` objects, which cannot be pickled. I understand this implementation, but I'm wondering if there's a way around this. It would be really useful to pickle the output!\r\n\r\n*Edit:*\r\nI also tried to set  `doc._.abbreviations` to `None` before pickling `doc` as an intermediate solution (as below), but that didn't solve it.\r\n```\r\ndoc._.abbreviations = None\r\n```","closed_by":{"login":"dakinggg","id":43149077,"node_id":"MDQ6VXNlcjQzMTQ5MDc3","avatar_url":"https://avatars.githubusercontent.com/u/43149077?v=4","gravatar_id":"","url":"https://api.github.com/users/dakinggg","html_url":"https://github.com/dakinggg","followers_url":"https://api.github.com/users/dakinggg/followers","following_url":"https://api.github.com/users/dakinggg/following{/other_user}","gists_url":"https://api.github.com/users/dakinggg/gists{/gist_id}","starred_url":"https://api.github.com/users/dakinggg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakinggg/subscriptions","organizations_url":"https://api.github.com/users/dakinggg/orgs","repos_url":"https://api.github.com/users/dakinggg/repos","events_url":"https://api.github.com/users/dakinggg/events{/privacy}","received_events_url":"https://api.github.com/users/dakinggg/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/allenai/scispacy/issues/205/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/allenai/scispacy/issues/205/timeline","performed_via_github_app":null,"state_reason":"completed"}