[{"id":3310451091,"node_id":"MDEyOkxhYmVsZWRFdmVudDMzMTA0NTEwOTE=","url":"https://api.github.com/repos/HazyResearch/fonduer/issues/events/3310451091","actor":{"login":"lukehsiao","id":7573542,"node_id":"MDQ6VXNlcjc1NzM1NDI=","avatar_url":"https://avatars.githubusercontent.com/u/7573542?v=4","gravatar_id":"","url":"https://api.github.com/users/lukehsiao","html_url":"https://github.com/lukehsiao","followers_url":"https://api.github.com/users/lukehsiao/followers","following_url":"https://api.github.com/users/lukehsiao/following{/other_user}","gists_url":"https://api.github.com/users/lukehsiao/gists{/gist_id}","starred_url":"https://api.github.com/users/lukehsiao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukehsiao/subscriptions","organizations_url":"https://api.github.com/users/lukehsiao/orgs","repos_url":"https://api.github.com/users/lukehsiao/repos","events_url":"https://api.github.com/users/lukehsiao/events{/privacy}","received_events_url":"https://api.github.com/users/lukehsiao/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-05-06T21:59:53Z","label":{"name":"bug","color":"d73a4a"},"performed_via_github_app":null},{"id":3310451097,"node_id":"MDE1Ok1pbGVzdG9uZWRFdmVudDMzMTA0NTEwOTc=","url":"https://api.github.com/repos/HazyResearch/fonduer/issues/events/3310451097","actor":{"login":"lukehsiao","id":7573542,"node_id":"MDQ6VXNlcjc1NzM1NDI=","avatar_url":"https://avatars.githubusercontent.com/u/7573542?v=4","gravatar_id":"","url":"https://api.github.com/users/lukehsiao","html_url":"https://github.com/lukehsiao","followers_url":"https://api.github.com/users/lukehsiao/followers","following_url":"https://api.github.com/users/lukehsiao/following{/other_user}","gists_url":"https://api.github.com/users/lukehsiao/gists{/gist_id}","starred_url":"https://api.github.com/users/lukehsiao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukehsiao/subscriptions","organizations_url":"https://api.github.com/users/lukehsiao/orgs","repos_url":"https://api.github.com/users/lukehsiao/repos","events_url":"https://api.github.com/users/lukehsiao/events{/privacy}","received_events_url":"https://api.github.com/users/lukehsiao/received_events","type":"User","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2020-05-06T21:59:53Z","milestone":{"title":"v0.8.3"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/642789751","html_url":"https://github.com/HazyResearch/fonduer/issues/412#issuecomment-642789751","issue_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/412","id":642789751,"node_id":"MDEyOklzc3VlQ29tbWVudDY0Mjc4OTc1MQ==","user":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false},"created_at":"2020-06-11T16:27:20Z","updated_at":"2020-06-11T17:35:59Z","author_association":"CONTRIBUTOR","body":"I'm working on #439 and currently the tests fail https://github.com/HazyResearch/fonduer/pull/439/checks?check_run_id=759815347 at assertions on the number of feature keys like below.\r\nMysteriously, the tests fail only at the number of feature keys while other assertions pass.\r\n\r\n```\r\n# I refer to this error as 1B\r\n...\r\n        assert num_features == len(train_cands[0]) + len(train_cands[1])\r\n        num_feature_keys = session.query(FeatureKey).count()\r\n>       assert num_feature_keys == 4577\r\nE       assert 4621 == 4577\r\n\r\ntests/e2e/test_e2e.py:235: AssertionError\r\n\r\n...\r\n# I refer to this error as 2\r\n        # Update features\r\n        featurizer.update(new_docs, parallelism=PARALLEL)\r\n        assert session.query(Feature).count() == len(train_cands[0])\r\n        num_feature_keys = session.query(FeatureKey).count()\r\n>       assert num_feature_keys == 2526\r\nE       assert 2544 == 2526\r\n\r\ntests/e2e/test_incremental.py:192: AssertionError\r\n```\r\n\r\nIt seems to be reproducible as the same commit fails on my forked repo too (https://github.com/HiromuHota/fonduer/runs/759811429?check_suite_focus=true).","reactions":{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/642789751/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/642802686","html_url":"https://github.com/HazyResearch/fonduer/issues/412#issuecomment-642802686","issue_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/412","id":642802686,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MjgwMjY4Ng==","user":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false},"created_at":"2020-06-11T16:46:38Z","updated_at":"2020-06-11T17:36:06Z","author_association":"CONTRIBUTOR","body":"One more thing: the same GitHub Actions run (https://github.com/HazyResearch/fonduer/pull/439/checks?check_run_id=759815303), but a different error on mac (3.6)\r\n\r\n```\r\n# I refer to this error as 1A\r\n        # Test that FeatureKey is properly reset\r\n        featurizer.apply(split=1, train=True, parallelism=PARALLEL)\r\n>       assert session.query(Feature).count() == 214\r\nE       assert 213 == 214\r\nE        +  where 213 = <bound method Query.count of <sqlalchemy.orm.query.Query object at 0x138f72c50>>()\r\nE        +    where <bound method Query.count of <sqlalchemy.orm.query.Query object at 0x138f72c50>> = <sqlalchemy.orm.query.Query object at 0x138f72c50>.count\r\nE        +      where <sqlalchemy.orm.query.Query object at 0x138f72c50> = <bound method Session.query of <sqlalchemy.orm.session.Session object at 0x1355437b8>>(Feature)\r\nE        +        where <bound method Session.query of <sqlalchemy.orm.session.Session object at 0x1355437b8>> = <sqlalchemy.orm.session.Session object at 0x1355437b8>.query\r\n\r\ntests/e2e/test_e2e.py:188: AssertionError\r\n```\r\n\r\nTwo differences:\r\n- test_e2e.py failed both Mac (3.6) and Linux (3.7), but it failed on the number of features on Mac.\r\n- test_incremental.py passed on Mac.","reactions":{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/642802686/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/642830883","html_url":"https://github.com/HazyResearch/fonduer/issues/412#issuecomment-642830883","issue_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/412","id":642830883,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MjgzMDg4Mw==","user":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false},"created_at":"2020-06-11T17:39:22Z","updated_at":"2020-06-11T17:39:22Z","author_association":"CONTRIBUTOR","body":"By looking at two runs (https://github.com/HazyResearch/fonduer/actions/runs/131557275 and https://github.com/HiromuHota/fonduer/actions/runs/131556294), the three types of errors happened as below:\r\n|       | 3.6   | 3.7   |\r\n|-------|-------|-------|\r\n| Mac   | 1A    | 1B    |\r\n| Linux | 1A, 2 | 1B, 2 |","reactions":{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/642830883/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/642916724","html_url":"https://github.com/HazyResearch/fonduer/issues/412#issuecomment-642916724","issue_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/412","id":642916724,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MjkxNjcyNA==","user":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false},"created_at":"2020-06-11T20:38:55Z","updated_at":"2020-06-11T20:38:55Z","author_association":"CONTRIBUTOR","body":"Regarding the 1A type of error, `session.query(Feature).count()` actually equals to the total number of candidates for split=1, ie `session.query(Feature).count() == len(dev_cands[0]) + len(dev_cands[1])`.\r\nOn my local Mac, they were 214 == 61 + 153.\r\nBut on Github Actions, they were 213 == 60 + 153.\r\nThus, the difference occurs on `PartTemp` and not on `PartVolt`.","reactions":{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/642916724/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/642926040","html_url":"https://github.com/HazyResearch/fonduer/issues/412#issuecomment-642926040","issue_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/412","id":642926040,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MjkyNjA0MA==","user":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false},"created_at":"2020-06-11T21:01:21Z","updated_at":"2020-06-11T21:01:21Z","author_association":"CONTRIBUTOR","body":"The number of contituent mentions of `PartTemp`: `Part` and `Temp` were the same on local Mac and GitHub Actions.\r\nThis means `temp_throttler` drops one extra candidate on GitHub Actions.\r\n```python\r\ndef temp_throttler(c):\r\n    (part, attr) = c\r\n    if same_table((part, attr)):\r\n        return is_horz_aligned((part, attr)) or is_vert_aligned((part, attr))\r\n    return True\r\n```\r\nThe difference comes either from `same_table`, or from `is_horz_aligned/is_vert_aligned`.\r\nI suspect the non-deterministic behaviour comes from the visual_linker.","reactions":{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/642926040/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null,"event":"commented","actor":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/643539509","html_url":"https://github.com/HazyResearch/fonduer/issues/412#issuecomment-643539509","issue_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/412","id":643539509,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MzUzOTUwOQ==","user":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false},"created_at":"2020-06-13T00:46:10Z","updated_at":"2020-06-13T00:46:10Z","author_association":"CONTRIBUTOR","body":"A few updates:\r\n1. Found that the different number of candidates in https://github.com/HazyResearch/fonduer/issues/412#issuecomment-642916724 comes from `tests/data/html/2N6427.html`.\r\n2. `VisualLinker` behaves non-deterministically.\r\n\r\nCase 1 (the test assertion assumes the following result from VisualLinker)\r\n```\r\n[INFO] Extracted 2622 pdf words\r\n[INFO] Extracted 2746 html words\r\n[DEBUG] Global exact matching:\r\n[INFO] (1730/2746) = 0.63\r\n[DEBUG] Local exact matching:\r\n[INFO] (2077/2746) = 0.76\r\n[DEBUG] Local approximate matching:\r\n[INFO] (2205/2746) = 0.80\r\n[DEBUG] Linked 2205/2746 (0.80) html words exactly\r\n```\r\n\r\nCase 2 (this happens sometimes, not sure what make this happen)\r\n```\r\n[INFO] Extracted 2622 pdf words\r\n[INFO] Extracted 2746 html words\r\n[DEBUG] Global exact matching:\r\n[INFO] (1730/2746) = 0.63\r\n[DEBUG] Local exact matching:\r\n[INFO] (1994/2746) = 0.73\r\n[DEBUG] Local approximate matching:\r\n[INFO] (2200/2746) = 0.80\r\n[DEBUG] Linked 2200/2746 (0.80) html words exactly\r\n```","reactions":{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/643539509/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/644450989","html_url":"https://github.com/HazyResearch/fonduer/issues/412#issuecomment-644450989","issue_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/412","id":644450989,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NDQ1MDk4OQ==","user":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false},"created_at":"2020-06-15T23:58:27Z","updated_at":"2020-06-15T23:58:27Z","author_association":"CONTRIBUTOR","body":"One update: the non-deterministic behaviour of `VisualLinker` comes from the fact that `doc.sentences` is not sorted.\r\n\r\nI think the following relationship should have `order_by=True` to the `backref` argument.\r\nhttps://github.com/HazyResearch/fonduer/blob/246a92dd05884e3a706ba216e6177456d537de13/src/fonduer/parser/models/sentence.py#L248-L252\r\n\r\nFindings that lead me to the above statement:\r\n- \"The local search for exact matches\" by `link_exact` depends on how `html_word_list` and `pdf_word_list` are sorted.\r\n- The order of words in `pdf_word_list` depends on how block/line/word (in the output of `pdftotext -bbox-layout`) is sorted, which looks stable.\r\n- That in `html_word_list` depends on how `doc.sentences` is sorted.\r\n- According to SQLAlchemy doc, `order_by=False` by default at relationship (or backref) (https://docs.sqlalchemy.org/en/13/orm/relationship_api.html#sqlalchemy.orm.relationship)\r\n","reactions":{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/644450989/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/644477332","html_url":"https://github.com/HazyResearch/fonduer/issues/412#issuecomment-644477332","issue_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/412","id":644477332,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NDQ3NzMzMg==","user":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false},"created_at":"2020-06-16T01:33:28Z","updated_at":"2020-06-16T01:49:37Z","author_association":"CONTRIBUTOR","body":"A few more updates:\r\n- In order to reproduce this, I had to delete and re-create a database (`dropdb e2e_test` and `createdb e2e_test`). (This is why I could not reproduce it on my local mac until I deleted and recreated the database). This would mean that the order of `doc.sentences` depends on some internal state of the postgres database.\r\n- Another observation that supports the above is that I have not observed this non-deterministic behaviour if a database is not used (ie just using UDFs).","reactions":{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments/644477332/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false}},{"actor":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false},"created_at":"2020-06-16T02:12:32Z","updated_at":"2020-06-16T02:12:32Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/458","repository_url":"https://api.github.com/repos/HazyResearch/fonduer","labels_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/458/labels{/name}","comments_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/458/comments","events_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/458/events","html_url":"https://github.com/HazyResearch/fonduer/pull/458","id":639316158,"node_id":"MDExOlB1bGxSZXF1ZXN0NDM0OTMwMzQ4","number":458,"title":"Fix the non-deterministic behavior in VisualLinker","user":{"login":"HiromuHota","id":20668349,"node_id":"MDQ6VXNlcjIwNjY4MzQ5","avatar_url":"https://avatars.githubusercontent.com/u/20668349?v=4","gravatar_id":"","url":"https://api.github.com/users/HiromuHota","html_url":"https://github.com/HiromuHota","followers_url":"https://api.github.com/users/HiromuHota/followers","following_url":"https://api.github.com/users/HiromuHota/following{/other_user}","gists_url":"https://api.github.com/users/HiromuHota/gists{/gist_id}","starred_url":"https://api.github.com/users/HiromuHota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HiromuHota/subscriptions","organizations_url":"https://api.github.com/users/HiromuHota/orgs","repos_url":"https://api.github.com/users/HiromuHota/repos","events_url":"https://api.github.com/users/HiromuHota/events{/privacy}","received_events_url":"https://api.github.com/users/HiromuHota/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-06-16T02:12:32Z","updated_at":"2020-06-17T00:18:39Z","closed_at":"2020-06-17T00:14:23Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"repository":{"id":120036188,"node_id":"MDEwOlJlcG9zaXRvcnkxMjAwMzYxODg=","name":"fonduer","full_name":"HazyResearch/fonduer","private":false,"owner":{"login":"HazyResearch","id":2165246,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIxNjUyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/2165246?v=4","gravatar_id":"","url":"https://api.github.com/users/HazyResearch","html_url":"https://github.com/HazyResearch","followers_url":"https://api.github.com/users/HazyResearch/followers","following_url":"https://api.github.com/users/HazyResearch/following{/other_user}","gists_url":"https://api.github.com/users/HazyResearch/gists{/gist_id}","starred_url":"https://api.github.com/users/HazyResearch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HazyResearch/subscriptions","organizations_url":"https://api.github.com/users/HazyResearch/orgs","repos_url":"https://api.github.com/users/HazyResearch/repos","events_url":"https://api.github.com/users/HazyResearch/events{/privacy}","received_events_url":"https://api.github.com/users/HazyResearch/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/HazyResearch/fonduer","description":"A knowledge base construction engine for richly formatted data","fork":false,"url":"https://api.github.com/repos/HazyResearch/fonduer","forks_url":"https://api.github.com/repos/HazyResearch/fonduer/forks","keys_url":"https://api.github.com/repos/HazyResearch/fonduer/keys{/key_id}","collaborators_url":"https://api.github.com/repos/HazyResearch/fonduer/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/HazyResearch/fonduer/teams","hooks_url":"https://api.github.com/repos/HazyResearch/fonduer/hooks","issue_events_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/events{/number}","events_url":"https://api.github.com/repos/HazyResearch/fonduer/events","assignees_url":"https://api.github.com/repos/HazyResearch/fonduer/assignees{/user}","branches_url":"https://api.github.com/repos/HazyResearch/fonduer/branches{/branch}","tags_url":"https://api.github.com/repos/HazyResearch/fonduer/tags","blobs_url":"https://api.github.com/repos/HazyResearch/fonduer/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/HazyResearch/fonduer/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/HazyResearch/fonduer/git/refs{/sha}","trees_url":"https://api.github.com/repos/HazyResearch/fonduer/git/trees{/sha}","statuses_url":"https://api.github.com/repos/HazyResearch/fonduer/statuses/{sha}","languages_url":"https://api.github.com/repos/HazyResearch/fonduer/languages","stargazers_url":"https://api.github.com/repos/HazyResearch/fonduer/stargazers","contributors_url":"https://api.github.com/repos/HazyResearch/fonduer/contributors","subscribers_url":"https://api.github.com/repos/HazyResearch/fonduer/subscribers","subscription_url":"https://api.github.com/repos/HazyResearch/fonduer/subscription","commits_url":"https://api.github.com/repos/HazyResearch/fonduer/commits{/sha}","git_commits_url":"https://api.github.com/repos/HazyResearch/fonduer/git/commits{/sha}","comments_url":"https://api.github.com/repos/HazyResearch/fonduer/comments{/number}","issue_comment_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/comments{/number}","contents_url":"https://api.github.com/repos/HazyResearch/fonduer/contents/{+path}","compare_url":"https://api.github.com/repos/HazyResearch/fonduer/compare/{base}...{head}","merges_url":"https://api.github.com/repos/HazyResearch/fonduer/merges","archive_url":"https://api.github.com/repos/HazyResearch/fonduer/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/HazyResearch/fonduer/downloads","issues_url":"https://api.github.com/repos/HazyResearch/fonduer/issues{/number}","pulls_url":"https://api.github.com/repos/HazyResearch/fonduer/pulls{/number}","milestones_url":"https://api.github.com/repos/HazyResearch/fonduer/milestones{/number}","notifications_url":"https://api.github.com/repos/HazyResearch/fonduer/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/HazyResearch/fonduer/labels{/name}","releases_url":"https://api.github.com/repos/HazyResearch/fonduer/releases{/id}","deployments_url":"https://api.github.com/repos/HazyResearch/fonduer/deployments","created_at":"2018-02-02T22:03:13Z","updated_at":"2023-01-10T09:58:45Z","pushed_at":"2021-06-23T01:24:52Z","git_url":"git://github.com/HazyResearch/fonduer.git","ssh_url":"git@github.com:HazyResearch/fonduer.git","clone_url":"https://github.com/HazyResearch/fonduer.git","svn_url":"https://github.com/HazyResearch/fonduer","homepage":"https://fonduer.readthedocs.io/","size":12036,"stargazers_count":387,"watchers_count":387,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":79,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":16,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["knowledge-base-construction","machine-learning","multimodality"],"visibility":"public","forks":79,"open_issues":16,"watchers":387,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/HazyResearch/fonduer/pulls/458","html_url":"https://github.com/HazyResearch/fonduer/pull/458","diff_url":"https://github.com/HazyResearch/fonduer/pull/458.diff","patch_url":"https://github.com/HazyResearch/fonduer/pull/458.patch","merged_at":"2020-06-17T00:14:23Z"},"body":"## Description of the problems or issues\r\n\r\n**Is your pull request related to a problem? Please describe.**\r\n\r\nSee #412.\r\n\r\n**Does your pull request fix any issue.**\r\n\r\nFix #412.\r\n\r\n## Description of the proposed changes\r\nA clear and concise description of what you propose.\r\n\r\nBased on my findings reported at #412, the non-deterministic behaviour in `Featurization` boils down to a non-deterministic behaviour in `VisualLinker`, which is caused by the fact that the order of `doc.sentences` is not deterministic unless `order_by=True` in the `backref` argument below.\r\nhttps://github.com/HazyResearch/fonduer/blob/246a92dd05884e3a706ba216e6177456d537de13/src/fonduer/parser/models/sentence.py#L248-L252\r\nOne trivial way to fix this issue is to add `order_by=True` to the `backref`, however, I just sort `sentences` (by position) at the beginning of `VisualLinker.link` and I think this is good enough to fix #412.\r\n\r\n## Test plan\r\nA clear and concise description of how you test the new changes.\r\n\r\nIdeally, I'd like to test if my change prevents #412 from happening.\r\nHowever, this is not feasible as the issue is **non-deterministic** and does not happen every test run.\r\nInstead, I'd test if the result of visual linker is affected by the order of sentences.\r\n\r\n## Checklist\r\n\r\n* [x] I have updated the documentation accordingly.\r\n* [x] I have added tests to cover my changes.\r\n* [x] All new and existing tests passed.\r\n* [x] I have updated the CHANGELOG.rst accordingly.\r\n","reactions":{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/458/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/458/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":3451306434,"node_id":"MDExOkNsb3NlZEV2ZW50MzQ1MTMwNjQzNA==","url":"https://api.github.com/repos/HazyResearch/fonduer/issues/events/3451306434","actor":{"login":"senwu","id":5580008,"node_id":"MDQ6VXNlcjU1ODAwMDg=","avatar_url":"https://avatars.githubusercontent.com/u/5580008?v=4","gravatar_id":"","url":"https://api.github.com/users/senwu","html_url":"https://github.com/senwu","followers_url":"https://api.github.com/users/senwu/followers","following_url":"https://api.github.com/users/senwu/following{/other_user}","gists_url":"https://api.github.com/users/senwu/gists{/gist_id}","starred_url":"https://api.github.com/users/senwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/senwu/subscriptions","organizations_url":"https://api.github.com/users/senwu/orgs","repos_url":"https://api.github.com/users/senwu/repos","events_url":"https://api.github.com/users/senwu/events{/privacy}","received_events_url":"https://api.github.com/users/senwu/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-06-17T00:14:23Z","state_reason":null,"performed_via_github_app":null}]