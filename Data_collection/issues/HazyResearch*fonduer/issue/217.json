{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/217","repository_url":"https://api.github.com/repos/HazyResearch/fonduer","labels_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/217/labels{/name}","comments_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/217/comments","events_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/217/events","html_url":"https://github.com/HazyResearch/fonduer/issues/217","id":409483139,"node_id":"MDU6SXNzdWU0MDk0ODMxMzk=","number":217,"title":"perf: do not store redundant feature strings for each candidate","user":{"login":"lukehsiao","id":7573542,"node_id":"MDQ6VXNlcjc1NzM1NDI=","avatar_url":"https://avatars.githubusercontent.com/u/7573542?v=4","gravatar_id":"","url":"https://api.github.com/users/lukehsiao","html_url":"https://github.com/lukehsiao","followers_url":"https://api.github.com/users/lukehsiao/followers","following_url":"https://api.github.com/users/lukehsiao/following{/other_user}","gists_url":"https://api.github.com/users/lukehsiao/gists{/gist_id}","starred_url":"https://api.github.com/users/lukehsiao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukehsiao/subscriptions","organizations_url":"https://api.github.com/users/lukehsiao/orgs","repos_url":"https://api.github.com/users/lukehsiao/repos","events_url":"https://api.github.com/users/lukehsiao/events{/privacy}","received_events_url":"https://api.github.com/users/lukehsiao/received_events","type":"User","site_admin":false},"labels":[{"id":825323861,"node_id":"MDU6TGFiZWw4MjUzMjM4NjE=","url":"https://api.github.com/repos/HazyResearch/fonduer/labels/help%20wanted","name":"help wanted","color":"008672","default":true,"description":"Extra attention is required"},{"id":825323864,"node_id":"MDU6TGFiZWw4MjUzMjM4NjQ=","url":"https://api.github.com/repos/HazyResearch/fonduer/labels/discussion","name":"discussion","color":"d876e3","default":false,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-02-12T20:21:15Z","updated_at":"2020-09-09T23:55:55Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"\r\nThe size of the feature table is very, very large because we store the strings of each feature for each candidate, even though many of these strings are shared between candidates. This also slows down queries. We should have some additional table which maps to those strings, so that those strings do not all need to be stored.\r\n\r\nThis will take some consideration, though. As it is right now, it makes it very easy to inspect a particular candidate's features or labels simply though `cand.features`, and we would lose that if we were to refactor the code in this way.\r\n\r\nAs a rough analysis, with a dataset of 253,524 candidates, we see the following.\r\n\r\nTotal number of unique feature keys:\r\n```\r\n# select count(*) from feature_key;\r\n count \r\n-------\r\n 17705\r\n```\r\n\r\nTotal number of features:\r\n```\r\n# select count(*) from (select unnest(keys) from feature) as temp;\r\n  count   \r\n----------\r\n 43317015\r\n```\r\n\r\nThe feature table is by far the largest table.\r\n```\r\n# \\d+\r\n                               List of relations\r\n Schema |         Name          |   Type   |  Owner  |    Size    | Description\r\n--------+-----------------------+----------+---------+------------+-------------\r\n public | candidate             | table    | user    | 14 MB      |\r\n public | candidate_id_seq      | sequence | user    | 8192 bytes |\r\n public | caption               | table    | user    | 8192 bytes |\r\n public | caption_mention       | table    | user    | 0 bytes    |\r\n public | ce_v_max              | table    | user    | 48 kB      |\r\n public | cell                  | table    | user    | 8128 kB    |\r\n public | cell_mention          | table    | user    | 0 bytes    |\r\n public | context               | table    | user    | 30 MB      |\r\n public | context_id_seq        | sequence | user    | 8192 bytes |\r\n public | document              | table    | user    | 3208 kB    |\r\n public | document_mention      | table    | user    | 0 bytes    |\r\n public | feature               | table    | user    | 598 MB     |\r\n public | feature_key           | table    | user    | 3256 kB    |\r\n public | figure                | table    | user    | 600 kB     |\r\n public | figure_mention        | table    | user    | 0 bytes    |\r\n public | gold_label            | table    | user    | 23 MB      |\r\n public | gold_label_key        | table    | user    | 16 kB      |\r\n public | implicit_span_mention | table    | user    | 1272 kB    |\r\n public | label                 | table    | user    | 40 MB      |\r\n public | label_key             | table    | user    | 24 kB      |\r\n public | marginal              | table    | user    | 0 bytes    |\r\n public | marginal_id_seq       | sequence | user    | 8192 bytes |\r\n public | mention               | table    | user    | 560 kB     |\r\n public | mention_id_seq        | sequence | user    | 8192 bytes |\r\n public | paragraph             | table    | user    | 4936 kB    |\r\n public | paragraph_mention     | table    | user    | 0 bytes    |\r\n public | part                  | table    | user    | 216 kB     |\r\n public | part_ce_v_max         | table    | user    | 272 kB     |\r\n public | part_polarity         | table    | user    | 2440 kB    |\r\n public | part_stg_temp_max     | table    | user    | 4216 kB    |\r\n public | part_stg_temp_min     | table    | user    | 4224 kB    |\r\n public | polarity              | table    | user    | 88 kB      |\r\n public | prediction            | table    | user    | 8192 bytes |\r\n public | prediction_key        | table    | user    | 8192 bytes |\r\n public | section               | table    | user    | 48 kB      |\r\n public | section_mention       | table    | user    | 0 bytes    |\r\n public | sentence              | table    | user    | 87 MB      |\r\n public | span_mention          | table    | user    | 264 kB     |\r\n public | stable_label          | table    | user    | 8192 bytes |\r\n public | stg_temp_max          | table    | user    | 152 kB     |\r\n public | stg_temp_min          | table    | user    | 152 kB     |\r\n public | table                 | table    | user    | 112 kB     |\r\n public | table_mention         | table    | user    | 0 bytes    |\r\n public | webpage               | table    | user    | 8192 bytes |\r\n(44 rows)\r\n```\r\n\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/217/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/217/timeline","performed_via_github_app":null,"state_reason":null}