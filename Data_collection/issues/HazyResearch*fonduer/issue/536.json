{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/536","repository_url":"https://api.github.com/repos/HazyResearch/fonduer","labels_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/536/labels{/name}","comments_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/536/comments","events_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/536/events","html_url":"https://github.com/HazyResearch/fonduer/issues/536","id":826806561,"node_id":"MDU6SXNzdWU4MjY4MDY1NjE=","number":536,"title":"Tables aren't redefined for re-runs of UDF apply","user":{"login":"robbieculkin","id":20375994,"node_id":"MDQ6VXNlcjIwMzc1OTk0","avatar_url":"https://avatars.githubusercontent.com/u/20375994?v=4","gravatar_id":"","url":"https://api.github.com/users/robbieculkin","html_url":"https://github.com/robbieculkin","followers_url":"https://api.github.com/users/robbieculkin/followers","following_url":"https://api.github.com/users/robbieculkin/following{/other_user}","gists_url":"https://api.github.com/users/robbieculkin/gists{/gist_id}","starred_url":"https://api.github.com/users/robbieculkin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robbieculkin/subscriptions","organizations_url":"https://api.github.com/users/robbieculkin/orgs","repos_url":"https://api.github.com/users/robbieculkin/repos","events_url":"https://api.github.com/users/robbieculkin/events{/privacy}","received_events_url":"https://api.github.com/users/robbieculkin/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2021-03-09T23:40:28Z","updated_at":"2021-03-30T20:48:10Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"## Description of the bug\r\nAs part of iterative development in a Jupyter environment, `apply` may be re-run several times. The developer might need to update candidates or create a new labeling function, for example. \r\nWhen this happens, the corresponding Postgres table is cleared but not dropped. This means that the definition of the table cannot change to accommodate the updated parameters for `apply`.\r\n\r\n## To Reproduce\r\nSteps to reproduce the behavior:\r\n1. Run the max_storage_temp_tutorial notebook in fonduer-tutorials, up to and including the Labeling Functions section.\r\n2. Add a new LF, doesn't need to do anything in particular (could return ABSTAIN every time). Add this to the `stg_temp_lfs` list.\r\n3. Re-run the remainder of cells in the section.\r\n\r\nUpon calling `LFAnalysis`, the following exception is thrown:\r\n```\r\nValueError: Number of LFs (7) and number of LF matrix columns (6) are different\r\n```\r\n\r\n## Expected behavior\r\nUnderlying tables for a re-run of a UDF `apply` method should not only be cleared, but dropped.\r\n\r\n## Error Logs/Screenshots\r\nFull stack trace:\r\n```\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-62-e005feee6300> in <module>\r\n      5 sorted_lfs = sorted(lfs, key=lambda lf: lf.name)\r\n      6 \r\n----> 7 LFAnalysis(L=L_train[0], lfs=sorted_lfs).lf_summary(Y=L_gold_train[0].reshape(-1))\r\n\r\n~/.venv/lib/python3.7/site-packages/snorkel/labeling/analysis.py in __init__(self, L, lfs)\r\n     44             if len(lfs) != self._L_sparse.shape[1]:\r\n     45                 raise ValueError(\r\n---> 46                     f\"Number of LFs ({len(lfs)}) and number of \"\r\n     47                     f\"LF matrix columns ({self._L_sparse.shape[1]}) are different\"\r\n     48                 )\r\n\r\nValueError: Number of LFs (7) and number of LF matrix columns (6) are different\r\n```\r\n\r\n## Environment (please complete the following information)\r\n - OS:  Ubuntu 18.04\r\n - PostgreSQL Version: 12.1\r\n - Poppler Utils Version: 0.71.0-5\r\n - Fonduer Version: 0.8.3\r\n\r\n## Additional context\r\nhttps://github.com/HazyResearch/fonduer/issues/263#issuecomment-527588765 advises restarting Python, but this does not appear to solve the problem. \r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/536/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/536/timeline","performed_via_github_app":null,"state_reason":null}