{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/538","repository_url":"https://api.github.com/repos/HazyResearch/fonduer","labels_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/538/labels{/name}","comments_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/538/comments","events_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/538/events","html_url":"https://github.com/HazyResearch/fonduer/issues/538","id":867373502,"node_id":"MDU6SXNzdWU4NjczNzM1MDI=","number":538,"title":"Test code \"test_postgres.py\" failes with sqlalchemy delete method","user":{"login":"YasushiMiyata","id":67612201,"node_id":"MDQ6VXNlcjY3NjEyMjAx","avatar_url":"https://avatars.githubusercontent.com/u/67612201?v=4","gravatar_id":"","url":"https://api.github.com/users/YasushiMiyata","html_url":"https://github.com/YasushiMiyata","followers_url":"https://api.github.com/users/YasushiMiyata/followers","following_url":"https://api.github.com/users/YasushiMiyata/following{/other_user}","gists_url":"https://api.github.com/users/YasushiMiyata/gists{/gist_id}","starred_url":"https://api.github.com/users/YasushiMiyata/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YasushiMiyata/subscriptions","organizations_url":"https://api.github.com/users/YasushiMiyata/orgs","repos_url":"https://api.github.com/users/YasushiMiyata/repos","events_url":"https://api.github.com/users/YasushiMiyata/events{/privacy}","received_events_url":"https://api.github.com/users/YasushiMiyata/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-04-26T07:39:25Z","updated_at":"2021-05-03T17:15:40Z","closed_at":"2021-05-03T17:15:40Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"## Description of the bug\r\nIn running the test code \"test_postgres.py::test_cand_gen_cascading_delete\", program fails by \"sqlalchemy.exc.ProgrammingError\". Error message is;\r\n```\r\nE       sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) missing FROM-clause entry for table \"candidate\"\r\nE       LINE 1: ...E FROM part_temp WHERE part_temp.id = 2 RETURNING candidate....\r\nE                                                                    ^\r\nE       \r\nE       [SQL: DELETE FROM part_temp WHERE part_temp.id = %(id_1)s RETURNING candidate.id]\r\nE       [parameters: {'id_1': 2}]\r\nE       (Background on this error at: http://sqlalche.me/e/14/f405)\r\n```\r\n\r\n## To Reproduce\r\nSteps to reproduce the behavior:\r\n1. Execute `pytest test_postgres.py::test_cand_gen_cascading_delete` or ci after pull request.\r\n\r\n## Expected behavior\r\nTest completes with no error.\r\n\r\n## Error Logs/Screenshots\r\n```\r\n        # Test that deletion of a Candidate does not delete the Mention\r\n        x = session.query(PartTemp).first()\r\n>       session.query(PartTemp).filter_by(id=x.id).delete(synchronize_session=\"fetch\")\r\n\r\ntests/test_postgres.py:119: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n../../test0426/py38fonduer/lib/python3.8/site-packages/sqlalchemy/orm/query.py:3124: in delete\r\n    result = self.session.execute(\r\n../../test0426/py38fonduer/lib/python3.8/site-packages/sqlalchemy/orm/session.py:1670: in execute\r\n    result = conn._execute_20(statement, params or {}, execution_options)\r\n../../test0426/py38fonduer/lib/python3.8/site-packages/sqlalchemy/engine/base.py:1521: in _execute_20\r\n    return meth(self, args_10style, kwargs_10style, execution_options)\r\n../../test0426/py38fonduer/lib/python3.8/site-packages/sqlalchemy/sql/elements.py:313: in _execute_on_connection\r\n    return connection._execute_clauseelement(\r\n../../test0426/py38fonduer/lib/python3.8/site-packages/sqlalchemy/engine/base.py:1390: in _execute_clauseelement\r\n    ret = self._execute_context(\r\n../../test0426/py38fonduer/lib/python3.8/site-packages/sqlalchemy/engine/base.py:1749: in _execute_context\r\n    self._handle_dbapi_exception(\r\n../../test0426/py38fonduer/lib/python3.8/site-packages/sqlalchemy/engine/base.py:1930: in _handle_dbapi_exception\r\n    util.raise_(\r\n../../test0426/py38fonduer/lib/python3.8/site-packages/sqlalchemy/util/compat.py:211: in raise_\r\n    raise exception\r\n../../test0426/py38fonduer/lib/python3.8/site-packages/sqlalchemy/engine/base.py:1706: in _execute_context\r\n    self.dialect.do_execute(\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\nself = <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f39353b8400>\r\ncursor = <cursor object at 0x7f392ba5a7c0; closed: -1>\r\nstatement = 'DELETE FROM part_temp WHERE part_temp.id = %(id_1)s RETURNING candidate.id', parameters = {'id_1': 2}\r\ncontext = <sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f392b3380a0>\r\n\r\n    def do_execute(self, cursor, statement, parameters, context=None):\r\n>       cursor.execute(statement, parameters)\r\nE       sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) missing FROM-clause entry for table \"candidate\"\r\nE       LINE 1: ...E FROM part_temp WHERE part_temp.id = 2 RETURNING candidate....\r\nE                                                                    ^\r\nE       \r\nE       [SQL: DELETE FROM part_temp WHERE part_temp.id = %(id_1)s RETURNING candidate.id]\r\nE       [parameters: {'id_1': 2}]\r\nE       (Background on this error at: http://sqlalche.me/e/14/f405)\r\n\r\n../../test0426/py38fonduer/lib/python3.8/site-packages/sqlalchemy/engine/default.py:716: ProgrammingError\r\n```\r\n\r\n## Environment (please complete the following information)\r\n - OS: Ubuntu 18.04\r\n - PostgreSQL Version: 10.15\r\n - Poppler Utils Version: 0.62.0\r\n - Fonduer Version: 0.8.4+dev\r\n - Python Version: 3.8.6\r\n\r\n## Additional context\r\nNo error occurs with python 3.6.9\r\n","closed_by":{"login":"lukehsiao","id":7573542,"node_id":"MDQ6VXNlcjc1NzM1NDI=","avatar_url":"https://avatars.githubusercontent.com/u/7573542?v=4","gravatar_id":"","url":"https://api.github.com/users/lukehsiao","html_url":"https://github.com/lukehsiao","followers_url":"https://api.github.com/users/lukehsiao/followers","following_url":"https://api.github.com/users/lukehsiao/following{/other_user}","gists_url":"https://api.github.com/users/lukehsiao/gists{/gist_id}","starred_url":"https://api.github.com/users/lukehsiao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukehsiao/subscriptions","organizations_url":"https://api.github.com/users/lukehsiao/orgs","repos_url":"https://api.github.com/users/lukehsiao/repos","events_url":"https://api.github.com/users/lukehsiao/events{/privacy}","received_events_url":"https://api.github.com/users/lukehsiao/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/HazyResearch/fonduer/issues/538/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/HazyResearch/fonduer/issues/538/timeline","performed_via_github_app":null,"state_reason":"completed"}