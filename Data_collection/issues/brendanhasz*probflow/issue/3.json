{"url":"https://api.github.com/repos/brendanhasz/probflow/issues/3","repository_url":"https://api.github.com/repos/brendanhasz/probflow","labels_url":"https://api.github.com/repos/brendanhasz/probflow/issues/3/labels{/name}","comments_url":"https://api.github.com/repos/brendanhasz/probflow/issues/3/comments","events_url":"https://api.github.com/repos/brendanhasz/probflow/issues/3/events","html_url":"https://github.com/brendanhasz/probflow/issues/3","id":503469195,"node_id":"MDU6SXNzdWU1MDM0NjkxOTU=","number":3,"title":"Dimension Error when running GAN tutorial with TF 2.0 CPU","user":{"login":"arainboldt","id":54881218,"node_id":"MDQ6VXNlcjU0ODgxMjE4","avatar_url":"https://avatars.githubusercontent.com/u/54881218?v=4","gravatar_id":"","url":"https://api.github.com/users/arainboldt","html_url":"https://github.com/arainboldt","followers_url":"https://api.github.com/users/arainboldt/followers","following_url":"https://api.github.com/users/arainboldt/following{/other_user}","gists_url":"https://api.github.com/users/arainboldt/gists{/gist_id}","starred_url":"https://api.github.com/users/arainboldt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arainboldt/subscriptions","organizations_url":"https://api.github.com/users/arainboldt/orgs","repos_url":"https://api.github.com/users/arainboldt/repos","events_url":"https://api.github.com/users/arainboldt/events{/privacy}","received_events_url":"https://api.github.com/users/arainboldt/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-10-07T13:55:57Z","updated_at":"2019-10-12T17:00:54Z","closed_at":"2019-10-12T17:00:54Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, \r\n\r\nGreat package! Really enjoy the simple API that you've designed. I started playing around with the GAN model and am receiving the following error when calling fit.\r\n`\r\nInvalidArgumentError: Matrix size-incompatible: In[0]: [128,3], In[1]: [7,128] [Op:MatMul] name: matmul/`\r\n\r\nFull traceback:\r\n```\r\n\r\n---------------------------------------------------------------------------\r\nInvalidArgumentError                      Traceback (most recent call last)\r\n<ipython-input-19-e11e146e9aeb> in <module>\r\n      1 # Fit both models by fitting the discriminator w/ the callback\r\n----> 2 D.fit(x_meta.values[:,:3], epochs=10, callbacks=[train_g])\r\n\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/probflow/models.py in fit(self, x, y, batch_size, epochs, shuffle, optimizer, optimizer_kwargs, learning_rate, flipout, callbacks)\r\n    256             # Update gradients for each batch\r\n    257             for x_data, y_data in self._data:\r\n--> 258                 self.train_step(x_data, y_data)\r\n    259 \r\n    260             # Run callbacks at end of epoch\r\n\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/probflow/models.py in train_step(self, x_data, y_data)\r\n    161     def train_step(self, x_data, y_data):\r\n    162         \"\"\"Perform one training step\"\"\"\r\n--> 163         self._train_fn(x_data, y_data)\r\n    164 \r\n    165 \r\n\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/probflow/models.py in train_step(x_data, y_data)\r\n    142             with Sampling(n=1, flipout=flipout):\r\n    143                 with tf.GradientTape() as tape:\r\n--> 144                     log_loss = self.log_likelihood(x_data, y_data)/nb\r\n    145                     kl_loss = self.kl_loss()/n + self.kl_loss_batch()/nb\r\n    146                     elbo_loss = kl_loss - log_loss\r\n\r\n<ipython-input-7-d9d7a30c87d5> in log_likelihood(self, _, x)\r\n     29     def log_likelihood(self, _, x):\r\n     30         labels = tf.ones([x.shape[0], 1])\r\n---> 31         true_ll = self(x).log_prob(labels)\r\n     32         fake_ll = self(self.G(x)).log_prob(0*labels)\r\n     33         return tf.reduce_sum(true_ll + fake_ll)\r\n\r\n<ipython-input-7-d9d7a30c87d5> in __call__(self, x)\r\n     25 \r\n     26     def __call__(self, x):\r\n---> 27         return pf.Bernoulli(self.D(x))\r\n     28 \r\n     29     def log_likelihood(self, _, x):\r\n\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/probflow/applications.py in __call__(self, x)\r\n    189     def __call__(self, x):\r\n    190         for i in range(len(self.layers)):\r\n--> 191             x = self.layers[i](x)\r\n    192             x = self.activations[i](x)\r\n    193         return x\r\n\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/probflow/modules.py in __call__(self, x)\r\n    174                 norm_samples = tf.random.normal([self.d_in, self.d_out])\r\n    175                 w_samples = self.weights.variables['scale'] * norm_samples\r\n--> 176                 w_noise = r*((x*s) @ w_samples)\r\n    177                 w_outputs = x @ self.weights.variables['loc'] + w_noise\r\n    178 \r\n\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/tensorflow_core/python/ops/math_ops.py in binary_op_wrapper(x, y)\r\n    897     with ops.name_scope(None, op_name, [x, y]) as name:\r\n    898       if isinstance(x, ops.Tensor) and isinstance(y, ops.Tensor):\r\n--> 899         return func(x, y, name=name)\r\n    900       elif not isinstance(y, sparse_tensor.SparseTensor):\r\n    901         try:\r\n\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/tensorflow_core/python/util/dispatch.py in wrapper(*args, **kwargs)\r\n    178     \"\"\"Call target, and fall back on dispatchers if there is a TypeError.\"\"\"\r\n    179     try:\r\n--> 180       return target(*args, **kwargs)\r\n    181     except (TypeError, ValueError):\r\n    182       # Note: convert_to_eager_tensor currently raises a ValueError, not a\r\n\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/tensorflow_core/python/ops/math_ops.py in matmul(a, b, transpose_a, transpose_b, adjoint_a, adjoint_b, a_is_sparse, b_is_sparse, name)\r\n   2763     else:\r\n   2764       return gen_math_ops.mat_mul(\r\n-> 2765           a, b, transpose_a=transpose_a, transpose_b=transpose_b, name=name)\r\n   2766 \r\n   2767 \r\n\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/tensorflow_core/python/ops/gen_math_ops.py in mat_mul(a, b, transpose_a, transpose_b, name)\r\n   6124       else:\r\n   6125         message = e.message\r\n-> 6126       _six.raise_from(_core._status_to_exception(e.code, message), None)\r\n   6127   # Add nodes to the TensorFlow graph.\r\n   6128   if transpose_a is None:\r\n\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/six.py in raise_from(value, from_value)\r\n\r\nInvalidArgumentError: Matrix size-incompatible: In[0]: [128,3], In[1]: [7,128] [Op:MatMul] name: matmul/\r\n```\r\n\r\nThe dataset I'm testing on has shape (8500,100), but I've played around a bit and nothing seems to help. I also tried changing get_flipout() to False, thinking that perhaps somethign in the flipout section was  causing the error, but even so, the same error results.\r\n\r\n```\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/probflow/modules.py in __call__(self, x)\r\n    187         # Without Flipout\r\n    188         else:\r\n--> 189             return x @ self.weights() + self.bias()\r\n    190 \r\n    191 \r\n\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/tensorflow_core/python/ops/math_ops.py in r_binary_op_wrapper(y, x)\r\n    923     with ops.name_scope(None, op_name, [x, y]) as name:\r\n    924       x = ops.convert_to_tensor(x, dtype=y.dtype.base_dtype, name=\"x\")\r\n--> 925       return func(x, y, name=name)\r\n    926 \r\n    927   # Propagate func.__doc__ to the wrappers\r\n\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/tensorflow_core/python/util/dispatch.py in wrapper(*args, **kwargs)\r\n    178     \"\"\"Call target, and fall back on dispatchers if there is a TypeError.\"\"\"\r\n    179     try:\r\n--> 180       return target(*args, **kwargs)\r\n    181     except (TypeError, ValueError):\r\n    182       # Note: convert_to_eager_tensor currently raises a ValueError, not a\r\n\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/tensorflow_core/python/ops/math_ops.py in matmul(a, b, transpose_a, transpose_b, adjoint_a, adjoint_b, a_is_sparse, b_is_sparse, name)\r\n   2763     else:\r\n   2764       return gen_math_ops.mat_mul(\r\n-> 2765           a, b, transpose_a=transpose_a, transpose_b=transpose_b, name=name)\r\n   2766 \r\n   2767 \r\n\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/tensorflow_core/python/ops/gen_math_ops.py in mat_mul(a, b, transpose_a, transpose_b, name)\r\n   6124       else:\r\n   6125         message = e.message\r\n-> 6126       _six.raise_from(_core._status_to_exception(e.code, message), None)\r\n   6127   # Add nodes to the TensorFlow graph.\r\n   6128   if transpose_a is None:\r\n\r\n~/virtualenvs/tf2/lib/python3.7/site-packages/six.py in raise_from(value, from_value)\r\n\r\nInvalidArgumentError: Matrix size-incompatible: In[0]: [128,3], In[1]: [7,128] [Op:MatMul] name: matmul/\r\n```\r\n\r\nAny suggestions?","closed_by":{"login":"brendanhasz","id":3465846,"node_id":"MDQ6VXNlcjM0NjU4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/3465846?v=4","gravatar_id":"","url":"https://api.github.com/users/brendanhasz","html_url":"https://github.com/brendanhasz","followers_url":"https://api.github.com/users/brendanhasz/followers","following_url":"https://api.github.com/users/brendanhasz/following{/other_user}","gists_url":"https://api.github.com/users/brendanhasz/gists{/gist_id}","starred_url":"https://api.github.com/users/brendanhasz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brendanhasz/subscriptions","organizations_url":"https://api.github.com/users/brendanhasz/orgs","repos_url":"https://api.github.com/users/brendanhasz/repos","events_url":"https://api.github.com/users/brendanhasz/events{/privacy}","received_events_url":"https://api.github.com/users/brendanhasz/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/brendanhasz/probflow/issues/3/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/brendanhasz/probflow/issues/3/timeline","performed_via_github_app":null,"state_reason":"completed"}