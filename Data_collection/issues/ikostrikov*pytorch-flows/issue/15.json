{"url":"https://api.github.com/repos/ikostrikov/pytorch-flows/issues/15","repository_url":"https://api.github.com/repos/ikostrikov/pytorch-flows","labels_url":"https://api.github.com/repos/ikostrikov/pytorch-flows/issues/15/labels{/name}","comments_url":"https://api.github.com/repos/ikostrikov/pytorch-flows/issues/15/comments","events_url":"https://api.github.com/repos/ikostrikov/pytorch-flows/issues/15/events","html_url":"https://github.com/ikostrikov/pytorch-flows/issues/15","id":546614086,"node_id":"MDU6SXNzdWU1NDY2MTQwODY=","number":15,"title":"Add option to provide your own PDF for the latent variables in FlowSequential (not necessarily Gaussian)","user":{"login":"joaompereira","id":48690911,"node_id":"MDQ6VXNlcjQ4NjkwOTEx","avatar_url":"https://avatars.githubusercontent.com/u/48690911?v=4","gravatar_id":"","url":"https://api.github.com/users/joaompereira","html_url":"https://github.com/joaompereira","followers_url":"https://api.github.com/users/joaompereira/followers","following_url":"https://api.github.com/users/joaompereira/following{/other_user}","gists_url":"https://api.github.com/users/joaompereira/gists{/gist_id}","starred_url":"https://api.github.com/users/joaompereira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joaompereira/subscriptions","organizations_url":"https://api.github.com/users/joaompereira/orgs","repos_url":"https://api.github.com/users/joaompereira/repos","events_url":"https://api.github.com/users/joaompereira/events{/privacy}","received_events_url":"https://api.github.com/users/joaompereira/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-01-08T02:47:03Z","updated_at":"2020-01-08T02:47:03Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"In our application, we've found the need to provide the PDF for the latent variables (in our case, it is useful that the PDF depends on the conditional inputs). We've found a small fix to your code that let's you have this option, by just adding an __init__ method to FlowSequential and changing log_probs accordingly. I'll share the different code here. Here is the added __init__ method\r\n\r\n```\r\n    def __init__(self, *args, log_probs = 'gaussian'):\r\n        super(FlowSequential,self).__init__(*args)\r\n        if log_probs = 'gaussian'\r\n            def __log_probs(x, *_):\r\n                return torch.sum(-0.5 * x ** 2 - 0.5 * math.log(2 * math.pi),\r\n                                                            -1, keepdim=True)\r\n            self.log_probs = __log_probs\r\n        else:\r\n            self.log_probs = log_probs\r\n```\r\nand here is the modified log_probs.\r\n```\r\n    def log_probs(self, inputs, cond_inputs = None):\r\n        u, log_jacob = self(inputs, cond_inputs)\r\n        log_probs = self.log_probs(u, cond_inputs)\r\n        return (log_probs + log_jacob).sum(-1, keepdim=True)\r\n```\r\nThen, to provide your own PDF, just do\r\n`model = FlowSequential(*modules,logprobs=your_own_PDF)`","closed_by":null,"reactions":{"url":"https://api.github.com/repos/ikostrikov/pytorch-flows/issues/15/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ikostrikov/pytorch-flows/issues/15/timeline","performed_via_github_app":null,"state_reason":null}