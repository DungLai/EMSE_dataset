{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/2050","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/2050/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/2050/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/2050/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/2050","id":1451572137,"node_id":"I_kwDOB5BM6c5WhTup","number":2050,"title":"napari can't open data in labeled-data","user":{"login":"guiwitz","id":4622767,"node_id":"MDQ6VXNlcjQ2MjI3Njc=","avatar_url":"https://avatars.githubusercontent.com/u/4622767?v=4","gravatar_id":"","url":"https://api.github.com/users/guiwitz","html_url":"https://github.com/guiwitz","followers_url":"https://api.github.com/users/guiwitz/followers","following_url":"https://api.github.com/users/guiwitz/following{/other_user}","gists_url":"https://api.github.com/users/guiwitz/gists{/gist_id}","starred_url":"https://api.github.com/users/guiwitz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guiwitz/subscriptions","organizations_url":"https://api.github.com/users/guiwitz/orgs","repos_url":"https://api.github.com/users/guiwitz/repos","events_url":"https://api.github.com/users/guiwitz/events{/privacy}","received_events_url":"https://api.github.com/users/guiwitz/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false},"assignees":[{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2022-11-16T13:06:51Z","updated_at":"2022-11-16T16:50:53Z","closed_at":"2022-11-16T16:50:53Z","author_association":"NONE","active_lock_reason":null,"body":"### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Bug description\n\nI have a fresh install of DLC on M1 and I'm trying to go through a basic workflow. I managed to extract frames from the ```m3v1mp4.mp4``` video which creates a series of png in the ```labeled-folder``` in a sub-folder called ```m3v1mp4```. Now I go to the ```Label frames``` tab, click on the ```Label frames``` button and select the ```labeled-folder/m3v1mp4``` as indicated in the docs. Nothing happens and I get an error message ending with \r\n```\r\nValueError: Video path \"/Users/gw18g940/Desktop/testdlc2-GW-2022-11-16/labeled-data/m3v1mp4\" does not point to a file.\r\n```\r\nas it is only possible to select a folder at this step, the error is a bit puzzling.\r\n\r\nnapari still opens with the plugin on the right side. Now I can drag and drop a folder on napari and there are two cases:\r\n- if I use the napari Deeplabcut reader, I get the same error as above\r\n- if I use the napari builtins reader, I get a long error: \r\n```\r\nTraceback (most recent call last):\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/_qt/qt_viewer.py\", line 830, in _qt_open\r\n    self.viewer.open(\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/components/viewer_model.py\", line 1024, in open\r\n    layers = self._open_or_raise_error(\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/components/viewer_model.py\", line 1146, in _open_or_raise_error\r\n    raise MultipleReaderError(\r\nnapari.errors.reader_errors.MultipleReaderError: Multiple plugins found capable of reading /Users/gw18g940/Desktop/testdlc2-GW-2022-11-16/labeled-data/m3v1mp4. Select plugin from {'napari': 'napari builtins', 'napari-deeplabcut': 'napari DeepLabCut'} and pass to reading function e.g. `viewer.open(..., plugin=...)`.\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/_qt/qt_viewer.py\", line 1191, in dropEvent\r\n    self._qt_open(\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/_qt/qt_viewer.py\", line 848, in _qt_open\r\n    handle_gui_reading(filenames, self, stack, **kwargs)\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/_qt/dialogs/qt_reader_dialog.py\", line 199, in handle_gui_reading\r\n    open_with_dialog_choices(\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/_qt/dialogs/qt_reader_dialog.py\", line 292, in open_with_dialog_choices\r\n    qt_viewer.viewer.open(paths, stack=stack, plugin=plugin_name, **kwargs)\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/components/viewer_model.py\", line 1014, in open\r\n    self._add_layers_with_plugins(\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/components/viewer_model.py\", line 1242, in _add_layers_with_plugins\r\n    added.extend(self._add_layer_from_data(*_data))\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/components/viewer_model.py\", line 1316, in _add_layer_from_data\r\n    layer = add_method(data, **(meta or {}))\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/utils/migrations.py\", line 44, in _update_from_dict\r\n    return func(*args, **kwargs)\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/components/viewer_model.py\", line 819, in add_image\r\n    self.layers.append(layer)\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/_collections_abc.py\", line 1073, in append\r\n    self.insert(len(self), value)\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/components/layerlist.py\", line 166, in insert\r\n    super().insert(index, new_layer)\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/utils/events/containers/_selectable_list.py\", line 66, in insert\r\n    super().insert(index, value)\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/utils/events/containers/_evented_list.py\", line 188, in insert\r\n    self.events.inserted(index=index, value=value)\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/utils/events/event.py\", line 757, in __call__\r\n    self._invoke_callback(cb, event if pass_event else None)\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/utils/events/event.py\", line 794, in _invoke_callback\r\n    _handle_exception(\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/utils/events/event.py\", line 781, in _invoke_callback\r\n    cb(event)\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari_deeplabcut/_widgets.py\", line 397, in on_insert\r\n    \"root\": layer.metadata[\"root\"],\r\nKeyError: 'root'\r\n```\r\n\r\nThe images in the folder still get opened, I can also drag and drop the config.yml file and I can annotate the images. The problem is that the annotations can't be saved as no h5 file is saved.\r\n\r\nAlternatively, once napari is open, I can also open the movie file directly (here it doesn't ask which plugin I want to use) and I can also add the config.yml file. No error is generated but when I try to save the annotations I get:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari_deeplabcut/_widgets.py\", line 207, in <lambda>\r\n    lambda: _save_layers_dialog(\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari_deeplabcut/_widgets.py\", line 94, in _save_layers_dialog\r\n    self.viewer.layers.save(\"\", selected=True, plugin=\"napari-deeplabcut\")\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/components/layerlist.py\", line 476, in save\r\n    return save_layers(path, layers, plugin=plugin, _writer=_writer)\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/plugins/io.py\", line 229, in save_layers\r\n    _written, writer_name = _write_single_layer_with_plugins(\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/plugins/io.py\", line 442, in _write_single_layer_with_plugins\r\n    written_paths, writer_name = _npe2.write_layers(\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari/plugins/_npe2.py\", line 101, in write_layers\r\n    paths, writer = io_utils.write_get_writer(\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/npe2/io_utils.py\", line 115, in write_get_writer\r\n    return _write(path, layer_data, plugin_name=plugin_name, return_writer=True)\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/npe2/io_utils.py\", line 224, in _write\r\n    res = writer.exec(args=args)\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/npe2/manifest/utils.py\", line 65, in exec\r\n    return self.get_callable(_registry)(*args, **kwargs)\r\n  File \"/Users/gw18g940/mambaforge/envs/DLC2_3_M1/lib/python3.9/site-packages/napari_deeplabcut/_writer.py\", line 45, in write_hdf\r\n    root = meta[\"root\"]\r\nKeyError: 'root'\r\n```\n\n### Operating System\n\nMac M1 installed with https://github.com/DeepLabCut/DeepLabCut/blob/master/conda-environments/DLC2_3_M1.yaml\n\n### DeepLabCut version\n\n2.3rc2 \n\n### DeepLabCut mode\n\nsingle animal\n\n### Device type\n\nM1 GPU\n\n### Steps To Reproduce\n\n1. Install the environment with https://github.com/DeepLabCut/DeepLabCut/blob/master/conda-environments/DLC2_3_M1.yaml\r\n2. Start DLC, create a standard project for ```m3v1mp4.mp4```\r\n3. Extract frames\r\n4. Click and ```Label Frames```\n\n### Relevant log output\n\n_No response_\n\n### Anything else?\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/DeepLabCut/DeepLabCut/blob/master/CODE_OF_CONDUCT.md)","closed_by":{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/2050/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/2050/timeline","performed_via_github_app":null,"state_reason":"completed"}