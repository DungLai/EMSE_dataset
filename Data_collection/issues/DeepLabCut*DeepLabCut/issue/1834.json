{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1834","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1834/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1834/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1834/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/1834","id":1236325068,"node_id":"I_kwDOB5BM6c5JsNLM","number":1834,"title":"Add option for swapping RGB with BGR when training model","user":{"login":"glopesdev","id":5315880,"node_id":"MDQ6VXNlcjUzMTU4ODA=","avatar_url":"https://avatars.githubusercontent.com/u/5315880?v=4","gravatar_id":"","url":"https://api.github.com/users/glopesdev","html_url":"https://github.com/glopesdev","followers_url":"https://api.github.com/users/glopesdev/followers","following_url":"https://api.github.com/users/glopesdev/following{/other_user}","gists_url":"https://api.github.com/users/glopesdev/gists{/gist_id}","starred_url":"https://api.github.com/users/glopesdev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glopesdev/subscriptions","organizations_url":"https://api.github.com/users/glopesdev/orgs","repos_url":"https://api.github.com/users/glopesdev/repos","events_url":"https://api.github.com/users/glopesdev/events{/privacy}","received_events_url":"https://api.github.com/users/glopesdev/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"AlexEMG","id":20850270,"node_id":"MDQ6VXNlcjIwODUwMjcw","avatar_url":"https://avatars.githubusercontent.com/u/20850270?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexEMG","html_url":"https://github.com/AlexEMG","followers_url":"https://api.github.com/users/AlexEMG/followers","following_url":"https://api.github.com/users/AlexEMG/following{/other_user}","gists_url":"https://api.github.com/users/AlexEMG/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexEMG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexEMG/subscriptions","organizations_url":"https://api.github.com/users/AlexEMG/orgs","repos_url":"https://api.github.com/users/AlexEMG/repos","events_url":"https://api.github.com/users/AlexEMG/events{/privacy}","received_events_url":"https://api.github.com/users/AlexEMG/received_events","type":"User","site_admin":false},"assignees":[{"login":"AlexEMG","id":20850270,"node_id":"MDQ6VXNlcjIwODUwMjcw","avatar_url":"https://avatars.githubusercontent.com/u/20850270?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexEMG","html_url":"https://github.com/AlexEMG","followers_url":"https://api.github.com/users/AlexEMG/followers","following_url":"https://api.github.com/users/AlexEMG/following{/other_user}","gists_url":"https://api.github.com/users/AlexEMG/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexEMG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexEMG/subscriptions","organizations_url":"https://api.github.com/users/AlexEMG/orgs","repos_url":"https://api.github.com/users/AlexEMG/repos","events_url":"https://api.github.com/users/AlexEMG/events{/privacy}","received_events_url":"https://api.github.com/users/AlexEMG/received_events","type":"User","site_admin":false},{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2022-05-15T15:52:06Z","updated_at":"2022-07-19T14:25:03Z","closed_at":"2022-07-19T14:25:02Z","author_association":"NONE","active_lock_reason":null,"body":"DLC models seem to assume images are encoded in the RGB color space. However, a common source of video frames for inference is OpenCV capture, which unfortunately encodes frames in the BGR color space. A network trained in RGB which is then used for live inference using BGR will suffer from significant pose estimation errors when the dataset of interest contains highly saturated color patches.\r\n\r\nDLC itself uses OpenCV to analyze videos, and the current workaround is to swap BGR back to RGB for each frame before running model inference. This is unfortunate, since the computational cost of swapping color channels can be significant, especially when working with high-resolution images or live inference.\r\n\r\nIt would be interesting to have an option for training DLC models directly in the BGR color space, which would hopefully eliminate the need for the color swap step during inference.\r\n\r\nThe main concern of doing this would be compatibility with models which currently assume RGB. This could be solved by creating a new option in the `config.yaml` file (and `pose_cfg.yaml`) to indicate the color space used for inference, with RGB as default.\r\n\r\nOther considerations:\r\n  * RGB might be the assumed color space for resnet, mobilenet, etc, and swapping color space in the DLC training set might have unforeseen impacts when relying on natural features. If this is the case, would there be performance advantages of moving the color conversion step to the GPU?\r\n\r\nCurrent workarounds:\r\n  * Manually flip color space of labeled images before training.\r\n\r\nSee also:\r\nhttps://github.com/bonsai-rx/deeplabcut/issues/6\r\n","closed_by":{"login":"AlexEMG","id":20850270,"node_id":"MDQ6VXNlcjIwODUwMjcw","avatar_url":"https://avatars.githubusercontent.com/u/20850270?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexEMG","html_url":"https://github.com/AlexEMG","followers_url":"https://api.github.com/users/AlexEMG/followers","following_url":"https://api.github.com/users/AlexEMG/following{/other_user}","gists_url":"https://api.github.com/users/AlexEMG/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexEMG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexEMG/subscriptions","organizations_url":"https://api.github.com/users/AlexEMG/orgs","repos_url":"https://api.github.com/users/AlexEMG/repos","events_url":"https://api.github.com/users/AlexEMG/events{/privacy}","received_events_url":"https://api.github.com/users/AlexEMG/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1834/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1834/timeline","performed_via_github_app":null,"state_reason":"completed"}