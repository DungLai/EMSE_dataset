{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1646","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1646/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1646/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1646/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/1646","id":1109566822,"node_id":"I_kwDOB5BM6c5CIqVm","number":1646,"title":"Restarting a training is not following the lr pattern laid out in multiple-step","user":{"login":"stickzh","id":11254769,"node_id":"MDQ6VXNlcjExMjU0NzY5","avatar_url":"https://avatars.githubusercontent.com/u/11254769?v=4","gravatar_id":"","url":"https://api.github.com/users/stickzh","html_url":"https://github.com/stickzh","followers_url":"https://api.github.com/users/stickzh/followers","following_url":"https://api.github.com/users/stickzh/following{/other_user}","gists_url":"https://api.github.com/users/stickzh/gists{/gist_id}","starred_url":"https://api.github.com/users/stickzh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stickzh/subscriptions","organizations_url":"https://api.github.com/users/stickzh/orgs","repos_url":"https://api.github.com/users/stickzh/repos","events_url":"https://api.github.com/users/stickzh/events{/privacy}","received_events_url":"https://api.github.com/users/stickzh/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"AlexEMG","id":20850270,"node_id":"MDQ6VXNlcjIwODUwMjcw","avatar_url":"https://avatars.githubusercontent.com/u/20850270?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexEMG","html_url":"https://github.com/AlexEMG","followers_url":"https://api.github.com/users/AlexEMG/followers","following_url":"https://api.github.com/users/AlexEMG/following{/other_user}","gists_url":"https://api.github.com/users/AlexEMG/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexEMG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexEMG/subscriptions","organizations_url":"https://api.github.com/users/AlexEMG/orgs","repos_url":"https://api.github.com/users/AlexEMG/repos","events_url":"https://api.github.com/users/AlexEMG/events{/privacy}","received_events_url":"https://api.github.com/users/AlexEMG/received_events","type":"User","site_admin":false},"assignees":[{"login":"AlexEMG","id":20850270,"node_id":"MDQ6VXNlcjIwODUwMjcw","avatar_url":"https://avatars.githubusercontent.com/u/20850270?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexEMG","html_url":"https://github.com/AlexEMG","followers_url":"https://api.github.com/users/AlexEMG/followers","following_url":"https://api.github.com/users/AlexEMG/following{/other_user}","gists_url":"https://api.github.com/users/AlexEMG/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexEMG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexEMG/subscriptions","organizations_url":"https://api.github.com/users/AlexEMG/orgs","repos_url":"https://api.github.com/users/AlexEMG/repos","events_url":"https://api.github.com/users/AlexEMG/events{/privacy}","received_events_url":"https://api.github.com/users/AlexEMG/received_events","type":"User","site_admin":false},{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2022-01-20T17:19:10Z","updated_at":"2022-01-27T20:04:54Z","closed_at":"2022-01-27T19:28:06Z","author_association":"NONE","active_lock_reason":null,"body":"### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Bug description\n\nWhen stopping and restarting a training from a snapshot the match-step starts from the first step definition. However because it requires an exact match between the iteration number and the parameter in match-step it can be stuck in the fist definition for a surprising time!\r\nFor example:\r\n'multi_step': [[0.005, 10000], [0.02, 430000], [0.002, 730000], [0.001, 1030000]],\r\nif run  continuously, lr would be .05 till 10000, then .02 till 430000, then etc etc.\r\nIf however you stop at iteration 50000, and restart from that snapshot:\r\nlr will start at .005, but since iterations will never be at 10000 again, lr will stay at .005 until iteration 430000 when it will jump to .002.\r\nBy changing the multi-step between restarts then one can overcome this, bit it took a while before I understood what was happening\r\n\r\nI think the \"problem\" is in the code below which requires an exit match of iteration number to move to the next lr value:\r\n\r\n> class LearningRate(object):\r\n>     def __init__(self, cfg):\r\n>         self.steps = cfg[\"multi_step\"]\r\n>         self.current_step = 0\r\n> \r\n>     def get_lr(self, iteration):\r\n>         lr = self.steps[self.current_step][0]\r\n>         if iteration == self.steps[self.current_step][1]:\r\n>             self.current_step += 1\r\n> \r\n>         return lr\n\n### Operating System\n\nMac-m1\n\n### DeepLabCut version\n\n2.2.0.3\n\n### DeepLabCut mode\n\nsingle animal\n\n### Device type\n\ngpu\r\nMac M1\n\n### Steps To Reproduce\n\n_No response_\n\n### Relevant log output\n\n_No response_\n\n### Anything else?\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/DeepLabCut/DeepLabCut/blob/master/CODE_OF_CONDUCT.md)","closed_by":{"login":"AlexEMG","id":20850270,"node_id":"MDQ6VXNlcjIwODUwMjcw","avatar_url":"https://avatars.githubusercontent.com/u/20850270?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexEMG","html_url":"https://github.com/AlexEMG","followers_url":"https://api.github.com/users/AlexEMG/followers","following_url":"https://api.github.com/users/AlexEMG/following{/other_user}","gists_url":"https://api.github.com/users/AlexEMG/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexEMG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexEMG/subscriptions","organizations_url":"https://api.github.com/users/AlexEMG/orgs","repos_url":"https://api.github.com/users/AlexEMG/repos","events_url":"https://api.github.com/users/AlexEMG/events{/privacy}","received_events_url":"https://api.github.com/users/AlexEMG/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1646/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1646/timeline","performed_via_github_app":null,"state_reason":"completed"}