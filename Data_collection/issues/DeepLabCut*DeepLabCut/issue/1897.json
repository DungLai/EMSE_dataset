{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1897","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1897/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1897/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1897/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/1897","id":1296039356,"node_id":"I_kwDOB5BM6c5NP_28","number":1897,"title":"Possible Bug: Multiprocessing with DLC.analyze_videos() returning video \"videos are analyzed\" before completion.","user":{"login":"LucaH285","id":57685695,"node_id":"MDQ6VXNlcjU3Njg1Njk1","avatar_url":"https://avatars.githubusercontent.com/u/57685695?v=4","gravatar_id":"","url":"https://api.github.com/users/LucaH285","html_url":"https://github.com/LucaH285","followers_url":"https://api.github.com/users/LucaH285/followers","following_url":"https://api.github.com/users/LucaH285/following{/other_user}","gists_url":"https://api.github.com/users/LucaH285/gists{/gist_id}","starred_url":"https://api.github.com/users/LucaH285/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LucaH285/subscriptions","organizations_url":"https://api.github.com/users/LucaH285/orgs","repos_url":"https://api.github.com/users/LucaH285/repos","events_url":"https://api.github.com/users/LucaH285/events{/privacy}","received_events_url":"https://api.github.com/users/LucaH285/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false},"assignees":[{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2022-07-06T15:51:44Z","updated_at":"2022-07-25T22:56:41Z","closed_at":"2022-07-25T22:56:41Z","author_association":"NONE","active_lock_reason":null,"body":"### Is there an existing issue for this?\r\n\r\n- [X] I have searched the existing issues\r\n\r\n### Bug description\r\n\r\nI have a ton of videos to analyze, so I decided to multiprocess the analyze_videos() class on google colab to make things faster. I notice that its very hit or miss, sometimes it works phenomenally well and sometimes it \"crashes\". The crash reports no error, but simply returns the end statement after analysis is completed, namely: \"The videos are analyzed. Now your research can truly start! \r\n You can create labeled videos with 'create_labeled_video' ...\". This always happens at the 10s mark. My multiprocess class is shown below: \r\n\r\n```\r\nclass setDaemonFalse(multiprocessing.Process):\r\n  def _get_daemon(self):\r\n    return(False)\r\n\r\n  def _set_daemon(self, value):\r\n    pass\r\n  daemon = property(_get_daemon, _set_daemon)\r\n\r\nclass useMyPool(multiprocessing.pool.Pool):\r\n  Process = setDaemonFalse\r\n\r\ndef AnalyzeVids(Vids):\r\n  result = DLC.analyze_videos(config_paths[0], Vids, save_as_csv=True)\r\n  return(result)\r\n\r\ndef callPool(ProcessNodes):\r\n  pool = useMyPool(ProcessNodes)\r\n\r\n  result = pool.map(AnalyzeVids, ExternalVideos)\r\n\r\n  pool.close()\r\n  pool.join()\r\n  return(result)\r\n\r\nif __name__ == \"__main__\":\r\n  callPool(4)\r\n```\r\n\r\nI typically only send 3-4 videos to be analyzed in parallel on colab (Pro+) since I know how intensive these runs are. I wonder if there is an internal lock when using multiprocessing with DLC? It only ever happens with analyze_videos() though, I use this without any issue with the network trains and the label class.  \r\n\r\nAnd PS, love the software, I've been using it for a few years now and its fantastic!!\r\n\r\n### Operating System\r\n\r\nWindows 10, but running in Colab so some unix/linux OS. \r\n\r\n### DeepLabCut version\r\n\r\ndlc version 2.2.1\r\n\r\n### DeepLabCut mode\r\n\r\nsingle animal\r\n\r\n### Device type\r\n\r\ngpu google colab\r\n\r\n### Steps To Reproduce\r\n\r\n_No response_\r\n\r\n### Relevant log output\r\n\r\n_No response_\r\n\r\n### Anything else?\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/DeepLabCut/DeepLabCut/blob/master/CODE_OF_CONDUCT.md)","closed_by":{"login":"LucaH285","id":57685695,"node_id":"MDQ6VXNlcjU3Njg1Njk1","avatar_url":"https://avatars.githubusercontent.com/u/57685695?v=4","gravatar_id":"","url":"https://api.github.com/users/LucaH285","html_url":"https://github.com/LucaH285","followers_url":"https://api.github.com/users/LucaH285/followers","following_url":"https://api.github.com/users/LucaH285/following{/other_user}","gists_url":"https://api.github.com/users/LucaH285/gists{/gist_id}","starred_url":"https://api.github.com/users/LucaH285/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LucaH285/subscriptions","organizations_url":"https://api.github.com/users/LucaH285/orgs","repos_url":"https://api.github.com/users/LucaH285/repos","events_url":"https://api.github.com/users/LucaH285/events{/privacy}","received_events_url":"https://api.github.com/users/LucaH285/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1897/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1897/timeline","performed_via_github_app":null,"state_reason":"completed"}