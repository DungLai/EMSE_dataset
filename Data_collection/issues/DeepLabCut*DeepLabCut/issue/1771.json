{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1771","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1771/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1771/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1771/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/1771","id":1199319557,"node_id":"I_kwDOB5BM6c5HfCoF","number":1771,"title":"Error in undistortion during triangulation when filterprediction=False","user":{"login":"guatomallin","id":61807146,"node_id":"MDQ6VXNlcjYxODA3MTQ2","avatar_url":"https://avatars.githubusercontent.com/u/61807146?v=4","gravatar_id":"","url":"https://api.github.com/users/guatomallin","html_url":"https://github.com/guatomallin","followers_url":"https://api.github.com/users/guatomallin/followers","following_url":"https://api.github.com/users/guatomallin/following{/other_user}","gists_url":"https://api.github.com/users/guatomallin/gists{/gist_id}","starred_url":"https://api.github.com/users/guatomallin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guatomallin/subscriptions","organizations_url":"https://api.github.com/users/guatomallin/orgs","repos_url":"https://api.github.com/users/guatomallin/repos","events_url":"https://api.github.com/users/guatomallin/events{/privacy}","received_events_url":"https://api.github.com/users/guatomallin/received_events","type":"User","site_admin":false},"labels":[{"id":1932265427,"node_id":"MDU6TGFiZWwxOTMyMjY1NDI3","url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/labels/3D","name":"3D","color":"ddf952","default":false,"description":"questions/code issues regarding 3D DLC"}],"state":"closed","locked":false,"assignee":{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false},"assignees":[{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2022-04-11T03:00:39Z","updated_at":"2022-05-10T12:49:54Z","closed_at":"2022-05-10T12:49:54Z","author_association":"NONE","active_lock_reason":null,"body":"### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Bug description\n\nHi All, \r\n\r\nI encounter a \"list index our of range\" when calling: \r\n\r\ndeeplabcut.triangulate(r'D:\\project_deeplabcut\\RD_2CAM-CP-2022-03-31-3d\\config.yaml',r'D:\\project_deeplabcut\\3DVideo', filterpredictions=False)\r\n\r\nThis does not happen when I use \"filterpredictions=True, though my 3D.H5 files are filled with NaNs. I should mention that all videos are analyzed by the 2D models successfully. I tested \"pcutoff: 0.01\" within my 3D config.yaml to see if the likelihoods of the predictions were too low, but this did not fix the issue.  \r\n\r\nI can't find where the issue with the undistortion is... I'm hoping ya'll can help me out with this.\r\n\r\nHere is my config file structure for reference. \r\n# Project definitions (do not edit)\r\nTask: RD_2CAM\r\nscorer: CP\r\ndate: Mar31\r\n\r\n    # Project path (change when moving around)\r\nproject_path: D:\\project_deeplabcut\\RD_2CAM-CP-2022-03-31-3d\r\n\r\n# Plotting configuration\r\nskeleton:       # Note that the pairs must be defined, as you want them linked!\r\n- - WristR\r\n  - ElbowR\r\n- - WristL\r\n  - ElbowL\r\n- - ElbowR\r\n  - ShoulderR\r\n- - ElbowL\r\n  - ShoulderL\r\n- - ShoulderR\r\n  - EarR\r\n- - ShoulderL\r\n  - EarL\r\n- - EarL\r\n  - Snout\r\n- - EarR\r\n  - Snout\r\n- - HindpawR\r\n  - TailBase\r\n- - HindpawL\r\n  - TailBase\r\n- - TailBase\r\n- - TailTip\r\n  - TailBase\r\n- - Platform\r\n- - Slit\r\n  - Platform\r\n- - Reward\r\nskeleton_color: red\r\npcutoff: 0.01\r\ncolormap: jet\r\ndotsize: 20\r\nalphavalue: 1\r\nmarkerType: '*'\r\nmarkerColor: r\r\n\r\n# Number of cameras, camera names, path of the config files, shuffle index and trainingsetindex used to analyze videos:\r\nnum_cameras: 2\r\ncamera_names:\r\n- cam2\r\n- cam3\r\nscorername_3d: CP3D #Enter the scorer name for the 3D output\r\nconfig_file_cam2: D:\\project_deeplabcut\\r&d_cam2_2D-CP-2021-09-14\\config.yaml\r\nconfig_file_cam3: D:\\project_deeplabcut\\r&d_cam3_2D-CP-2021-07-19\\config.yaml\r\nshuffle_cam2: 1\r\ntrainingsetindex_cam2: 0\r\nshuffle_cam3: 1\r\ntrainingsetindex_cam3: 0\n\n### Operating System\n\nWindows 10 Pro 64x\n\n### DeepLabCut version\n\ndeeplabcut==2.2.0.6\n\n### DeepLabCut mode\n\n3d\n\n### Device type\n\nGeForce RTX 3070 Ti\n\n### Steps To Reproduce\n\n1. Open Ipython and import deeplabcut \r\n2. run deeplabcut.triangulate(r'D:\\project_deeplabcut\\RD_2CAM-CP-2022-03-31-3d\\config.yaml',r'D:\\project_deeplabcut\\3DVideo', filterpredictions=False)\r\n \r\n\n\n### Relevant log output\n\n```shell\nIn [6]: deeplabcut.triangulate(r'D:\\project_deeplabcut\\RD_2CAM-CP-2022-03-31-3d\\config.yaml',r'D:\\project_deeplabcut\\3D\r\n   ...: Video', filterpredictions=False)\r\nList of pairs: [['D:\\\\project_deeplabcut\\\\3DVideo\\\\undistorted_singleedit_13_behavior_shape4_cam2_21066.avi', 'D:\\\\project_deeplabcut\\\\3DVideo\\\\undistorted_singleedit_13_behavior_shape4_cam3_21066.avi'], ['D:\\\\project_deeplabcut\\\\3DVideo\\\\undistorted_singleedit_14_behavior_shape4_cam2_21064_blind_light_122221.mp4.avi', 'D:\\\\project_deeplabcut\\\\3DVideo\\\\undistorted_singleedit_14_behavior_shape4_cam3_21064_blind_light_122221.mp4.avi'], ['D:\\\\project_deeplabcut\\\\3DVideo\\\\undistorted_singleedit_2_behavior_shape4_cam2_11090_blind_left_success_122421.mp4.avi', 'D:\\\\project_deeplabcut\\\\3DVideo\\\\undistorted_singleedit_2_behavior_shape4_cam3_11090_blind_left_success_122421.mp4.avi'], ['D:\\\\project_deeplabcut\\\\3DVideo\\\\undistorted_singleedit_5_behavior_shape4_cam2_11093_blind_121621.mp4.avi', 'D:\\\\project_deeplabcut\\\\3DVideo\\\\undistorted_singleedit_5_behavior_shape4_cam3_11093_blind_121621.mp4.avi']]\r\nAnalyzing video D:\\project_deeplabcut\\3DVideo\\undistorted_singleedit_13_behavior_shape4_cam2_21066.avi using config_file_cam2\r\nUsing snapshot-400000 for model D:\\project_deeplabcut\\r&d_cam2_2D-CP-2021-09-14\\dlc-models\\iteration-7\\r&d_cam2_2DSep14-trainset95shuffle1\r\nC:\\Users\\Carlos\\anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\tensorflow\\python\\keras\\engine\\base_layer_v1.py:1694: UserWarning: `layer.apply` is deprecated and will be removed in a future version. Please use `layer.__call__` method instead.\r\n  warnings.warn('`layer.apply` is deprecated and '\r\nC:\\Users\\Carlos\\anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\tf_slim\\layers\\layers.py:684: UserWarning: `layer.apply` is deprecated and will be removed in a future version. Please use `layer.__call__` method instead.\r\n  outputs = layer.apply(inputs, training=is_training)\r\n2022-04-10 19:32:51.665772: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1525] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 5465 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 3070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.6\r\nStarting to analyze %  D:\\project_deeplabcut\\3DVideo\\undistorted_singleedit_13_behavior_shape4_cam2_21066.avi\r\nThe videos are analyzed. Now your research can truly start!\r\n You can create labeled videos with 'create_labeled_video'\r\nIf the tracking is not satisfactory for some videos, consider expanding the training set. You can use the function 'extract_outlier_frames' to extract a few representative outlier frames.\r\nD:\\project_deeplabcut\\3DVideo undistorted_singleedit_13_behavior_shape4_cam2_21066 DLC_resnet50_r&d_cam2_2DSep14shuffle1_400000\r\nAnalyzing video D:\\project_deeplabcut\\3DVideo\\undistorted_singleedit_13_behavior_shape4_cam3_21066.avi using config_file_cam3\r\nUsing snapshot-400000 for model D:\\project_deeplabcut\\r&d_cam3_2D-CP-2021-07-19\\dlc-models\\iteration-8\\r&d_cam3_2DJul19-trainset95shuffle1\r\nC:\\Users\\Carlos\\anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\tensorflow\\python\\keras\\engine\\base_layer_v1.py:1694: UserWarning: `layer.apply` is deprecated and will be removed in a future version. Please use `layer.__call__` method instead.\r\n  warnings.warn('`layer.apply` is deprecated and '\r\nC:\\Users\\Carlos\\anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\tf_slim\\layers\\layers.py:684: UserWarning: `layer.apply` is deprecated and will be removed in a future version. Please use `layer.__call__` method instead.\r\n  outputs = layer.apply(inputs, training=is_training)\r\n2022-04-10 19:32:53.359705: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1525] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 5465 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 3070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.6\r\nStarting to analyze %  D:\\project_deeplabcut\\3DVideo\\undistorted_singleedit_13_behavior_shape4_cam3_21066.avi\r\nThe videos are analyzed. Now your research can truly start!\r\n You can create labeled videos with 'create_labeled_video'\r\nIf the tracking is not satisfactory for some videos, consider expanding the training set. You can use the function 'extract_outlier_frames' to extract a few representative outlier frames.\r\nD:\\project_deeplabcut\\3DVideo undistorted_singleedit_13_behavior_shape4_cam3_21066 DLC_resnet50_r&d_cam3_2DJul19shuffle1_400000\r\nUndistorting...\r\n---------------------------------------------------------------------------\r\nIndexError                                Traceback (most recent call last)\r\nInput In [6], in <cell line: 1>()\r\n----> 1 deeplabcut.triangulate(r'D:\\project_deeplabcut\\RD_2CAM-CP-2022-03-31-3d\\config.yaml',r'D:\\project_deeplabcut\\3DVideo', filterpredictions=False)\r\n\r\nFile ~\\anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\deeplabcut\\pose_estimation_3d\\triangulation.py:302, in triangulate(config, video_path, videotype, filterpredictions, filtertype, gputouse, destfolder, save_as_csv)\r\n    293 if run_triangulate:\r\n    294     #        if len(dataname)>0:\r\n    295     # undistort points for this pair\r\n    296     print(\"Undistorting...\")\r\n    297     (\r\n    298         dataFrame_camera1_undistort,\r\n    299         dataFrame_camera2_undistort,\r\n    300         stereomatrix,\r\n    301         path_stereo_file,\r\n--> 302     ) = undistort_points(\r\n    303         config, dataname, str(cam_names[0] + \"-\" + cam_names[1])\r\n    304     )\r\n    305     if len(dataFrame_camera1_undistort) != len(dataFrame_camera2_undistort):\r\n    306         import warnings\r\n\r\nFile ~\\anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\deeplabcut\\pose_estimation_3d\\triangulation.py:453, in undistort_points(config, dataframe, camera_pair)\r\n    438 \"\"\"\r\n    439 path_undistort = destfolder\r\n    440 filename_cam1 = Path(dataframe[0]).stem\r\n   (...)\r\n    449 else:\r\n    450 \"\"\"\r\n    451 if True:\r\n    452     # Create an empty dataFrame to store the undistorted 2d coordinates and likelihood\r\n--> 453     dataframe_cam1 = pd.read_hdf(dataframe[0])\r\n    454     dataframe_cam2 = pd.read_hdf(dataframe[1])\r\n    455     scorer_cam1 = dataframe_cam1.columns.get_level_values(0)[0]\r\n\r\nIndexError: list index out of range\n```\n\n\n### Anything else?\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/DeepLabCut/DeepLabCut/blob/master/CODE_OF_CONDUCT.md)","closed_by":{"login":"MMathisLab","id":28102185,"node_id":"MDQ6VXNlcjI4MTAyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/28102185?v=4","gravatar_id":"","url":"https://api.github.com/users/MMathisLab","html_url":"https://github.com/MMathisLab","followers_url":"https://api.github.com/users/MMathisLab/followers","following_url":"https://api.github.com/users/MMathisLab/following{/other_user}","gists_url":"https://api.github.com/users/MMathisLab/gists{/gist_id}","starred_url":"https://api.github.com/users/MMathisLab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MMathisLab/subscriptions","organizations_url":"https://api.github.com/users/MMathisLab/orgs","repos_url":"https://api.github.com/users/MMathisLab/repos","events_url":"https://api.github.com/users/MMathisLab/events{/privacy}","received_events_url":"https://api.github.com/users/MMathisLab/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1771/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1771/timeline","performed_via_github_app":null,"state_reason":"completed"}