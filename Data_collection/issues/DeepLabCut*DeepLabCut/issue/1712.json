{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1712","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1712/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1712/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1712/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/1712","id":1158146706,"node_id":"I_kwDOB5BM6c5FB-qS","number":1712,"title":"KeyError on post processing with loadandanalyzeDLCdata notebook","user":{"login":"jonpedros","id":85462635,"node_id":"MDQ6VXNlcjg1NDYyNjM1","avatar_url":"https://avatars.githubusercontent.com/u/85462635?v=4","gravatar_id":"","url":"https://api.github.com/users/jonpedros","html_url":"https://github.com/jonpedros","followers_url":"https://api.github.com/users/jonpedros/followers","following_url":"https://api.github.com/users/jonpedros/following{/other_user}","gists_url":"https://api.github.com/users/jonpedros/gists{/gist_id}","starred_url":"https://api.github.com/users/jonpedros/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jonpedros/subscriptions","organizations_url":"https://api.github.com/users/jonpedros/orgs","repos_url":"https://api.github.com/users/jonpedros/repos","events_url":"https://api.github.com/users/jonpedros/events{/privacy}","received_events_url":"https://api.github.com/users/jonpedros/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false},"assignees":[{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2022-03-03T09:04:22Z","updated_at":"2022-03-04T04:32:00Z","closed_at":"2022-03-04T04:32:00Z","author_association":"NONE","active_lock_reason":null,"body":"### Is there an existing issue for this?\r\n\r\n- [X] I have searched the existing issues\r\n\r\n### Bug description\r\n\r\nHello!\r\n\r\nI tried using the provided [post processing notebook](https://github.com/DeepLabCut/DLCutils/blob/master/Demo_loadandanalyzeDLCdata.ipynb) but, when trying to use the 'time_in_each_roi' cell for making the velocity per frame graph I get a key error.\r\n\r\nI need to mention that all other cells before it work perfectly, so I don't think it's an issue with how I defined the Dataframe, DLCscorer, etc variables.\r\n\r\nThis is the relevant cell:\r\n\r\n```\r\nimport time_in_each_roi #the function needs to be in the same folder as the notebook\r\n\r\n#let's calculate velocity of the snout\r\nbpt='snout'\r\nvel = time_in_each_roi.calc_distance_between_points_in_a_vector_2d(np.vstack([Dataframe[DLCscorer][bpt]['x'].values.flatten(), Dataframe[DLCscorer][bpt]['y'].values.flatten()]).T)\r\n\r\nfps=30 # frame rate of camera in those experiments\r\ntime=np.arange(len(vel))*1./fps\r\nvel=vel #notice the units of vel are relative pixel distance [per time step]\r\n\r\n# store in other variables:\r\nxsnout=Dataframe[DLCscorer][bpt]['x'].values\r\nysnout=Dataframe[DLCscorer][bpt]['y'].values\r\nvsnout=vel\r\n```\r\n\r\n### Operating System\r\n\r\nWindows 10\r\n\r\n### DeepLabCut version\r\n\r\n2.2.0.6\r\n\r\n### DeepLabCut mode\r\n\r\nsingle animal\r\n\r\n### Device type\r\n\r\nGPU; Nvidia Geforce RTX 2060 Super\r\n\r\n### Steps To Reproduce\r\n\r\n_No response_\r\n\r\n### Relevant log output\r\n\r\n```shell\r\n---------------------------------------------------------------------------\r\nKeyError                                  Traceback (most recent call last)\r\nFile ~\\anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\pandas\\core\\indexes\\base.py:3621, in Index.get_loc(self, key, method, tolerance)\r\n   3620 try:\r\n-> 3621     return self._engine.get_loc(casted_key)\r\n   3622 except KeyError as err:\r\n\r\nFile ~\\anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\pandas\\_libs\\index.pyx:136, in pandas._libs.index.IndexEngine.get_loc()\r\n\r\nFile ~\\anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\pandas\\_libs\\index.pyx:163, in pandas._libs.index.IndexEngine.get_loc()\r\n\r\nFile pandas\\_libs\\hashtable_class_helper.pxi:5198, in pandas._libs.hashtable.PyObjectHashTable.get_item()\r\n\r\nFile pandas\\_libs\\hashtable_class_helper.pxi:5206, in pandas._libs.hashtable.PyObjectHashTable.get_item()\r\n\r\nKeyError: 'DLC_resnet50_S1-pain-projectFeb22shuffle1_303500_filtered'\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nKeyError                                  Traceback (most recent call last)\r\nInput In [7], in <module>\r\n      3 #let's calculate velocity of the snout\r\n      4 bpt='snout'\r\n----> 5 vel = time_in_each_roi.calc_distance_between_points_in_a_vector_2d(np.vstack([Dataframe[DLCscorer][bpt]['x'].values.flatten(), Dataframe[DLCscorer][bpt]['y'].values.flatten()]).T)\r\n      7 fps=30 # frame rate of camera in those experiments\r\n      8 time=np.arange(len(vel))*1./fps\r\n\r\nFile ~\\anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\pandas\\core\\frame.py:3504, in DataFrame.__getitem__(self, key)\r\n   3502 if is_single_key:\r\n   3503     if self.columns.nlevels > 1:\r\n-> 3504         return self._getitem_multilevel(key)\r\n   3505     indexer = self.columns.get_loc(key)\r\n   3506     if is_integer(indexer):\r\n\r\nFile ~\\anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\pandas\\core\\frame.py:3555, in DataFrame._getitem_multilevel(self, key)\r\n   3553 def _getitem_multilevel(self, key):\r\n   3554     # self.columns is a MultiIndex\r\n-> 3555     loc = self.columns.get_loc(key)\r\n   3556     if isinstance(loc, (slice, np.ndarray)):\r\n   3557         new_columns = self.columns[loc]\r\n\r\nFile ~\\anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\pandas\\core\\indexes\\multi.py:2871, in MultiIndex.get_loc(self, key, method)\r\n   2868     return mask\r\n   2870 if not isinstance(key, tuple):\r\n-> 2871     loc = self._get_level_indexer(key, level=0)\r\n   2872     return _maybe_to_slice(loc)\r\n   2874 keylen = len(key)\r\n\r\nFile ~\\anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\pandas\\core\\indexes\\multi.py:3224, in MultiIndex._get_level_indexer(self, key, level, indexer)\r\n   3220         return slice(i, j, step)\r\n   3222 else:\r\n-> 3224     idx = self._get_loc_single_level_index(level_index, key)\r\n   3226     if level > 0 or self._lexsort_depth == 0:\r\n   3227         # Desired level is not sorted\r\n   3228         if isinstance(idx, slice):\r\n   3229             # test_get_loc_partial_timestamp_multiindex\r\n\r\nFile ~\\anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\pandas\\core\\indexes\\multi.py:2804, in MultiIndex._get_loc_single_level_index(self, level_index, key)\r\n   2802     return -1\r\n   2803 else:\r\n-> 2804     return level_index.get_loc(key)\r\n\r\nFile ~\\anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\pandas\\core\\indexes\\base.py:3623, in Index.get_loc(self, key, method, tolerance)\r\n   3621     return self._engine.get_loc(casted_key)\r\n   3622 except KeyError as err:\r\n-> 3623     raise KeyError(key) from err\r\n   3624 except TypeError:\r\n   3625     # If we have a listlike key, _check_indexing_error will raise\r\n   3626     #  InvalidIndexError. Otherwise we fall through and re-raise\r\n   3627     #  the TypeError.\r\n   3628     self._check_indexing_error(key)\r\n\r\nKeyError: 'DLC_resnet50_S1-pain-projectFeb22shuffle1_303500_filtered'\r\n```\r\n\r\n\r\n### Anything else?\r\n\r\nThis is the code where variables are defined:\r\n\r\n```\r\n# this is example data from the public project: https://github.com/AlexEMG/DeepLabCut/tree/master/examples/openfield-Pranav-2018-10-30\r\nvideo='S1Pain-S37-video001.avi'\r\nDLCscorer='DLC_resnet50_S1-pain-projectFeb22shuffle1_303500_filtered'\r\n\r\ndataname = str(Path(video).stem) + DLCscorer + '.h5'\r\n\r\n#loading output of DLC\r\nDataframe = pd.read_hdf(os.path.join(dataname))\r\n\r\n```\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/DeepLabCut/DeepLabCut/blob/master/CODE_OF_CONDUCT.md)","closed_by":{"login":"jonpedros","id":85462635,"node_id":"MDQ6VXNlcjg1NDYyNjM1","avatar_url":"https://avatars.githubusercontent.com/u/85462635?v=4","gravatar_id":"","url":"https://api.github.com/users/jonpedros","html_url":"https://github.com/jonpedros","followers_url":"https://api.github.com/users/jonpedros/followers","following_url":"https://api.github.com/users/jonpedros/following{/other_user}","gists_url":"https://api.github.com/users/jonpedros/gists{/gist_id}","starred_url":"https://api.github.com/users/jonpedros/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jonpedros/subscriptions","organizations_url":"https://api.github.com/users/jonpedros/orgs","repos_url":"https://api.github.com/users/jonpedros/repos","events_url":"https://api.github.com/users/jonpedros/events{/privacy}","received_events_url":"https://api.github.com/users/jonpedros/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1712/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1712/timeline","performed_via_github_app":null,"state_reason":"completed"}