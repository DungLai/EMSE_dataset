{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1439","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1439/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1439/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1439/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/1439","id":954253060,"node_id":"MDU6SXNzdWU5NTQyNTMwNjA=","number":1439,"title":"`plot_trajectories` is not name agnostic if n_tracks differs from config.yaml","user":{"login":"neurologic","id":4777333,"node_id":"MDQ6VXNlcjQ3NzczMzM=","avatar_url":"https://avatars.githubusercontent.com/u/4777333?v=4","gravatar_id":"","url":"https://api.github.com/users/neurologic","html_url":"https://github.com/neurologic","followers_url":"https://api.github.com/users/neurologic/followers","following_url":"https://api.github.com/users/neurologic/following{/other_user}","gists_url":"https://api.github.com/users/neurologic/gists{/gist_id}","starred_url":"https://api.github.com/users/neurologic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/neurologic/subscriptions","organizations_url":"https://api.github.com/users/neurologic/orgs","repos_url":"https://api.github.com/users/neurologic/repos","events_url":"https://api.github.com/users/neurologic/events{/privacy}","received_events_url":"https://api.github.com/users/neurologic/received_events","type":"User","site_admin":false},"labels":[{"id":880550034,"node_id":"MDU6TGFiZWw4ODA1NTAwMzQ=","url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false},"assignees":[{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2021-07-27T20:45:29Z","updated_at":"2021-07-28T20:39:10Z","closed_at":"2021-07-28T20:38:37Z","author_association":"NONE","active_lock_reason":null,"body":"### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Bug description\n\nWhen calling plot_trajectories(), obtain plot of trajectories.\r\n\r\nAfter calling: \r\n1) analyze_videos() \r\n2) convert_detections2tracklets()\r\n3) stitch_tracklets()\r\n(I did not refine_tracklets() for this test)\r\n\n\n### Operating System\n\nMacOS Catalina\n\n### DeepLabCut version\n\n2.2rc3\n\n### DeepLabCut mode\n\nmulti animal\n\n### Device type\n\nCPU\n\n### Steps To Reproduce\n\nIn the DEEPLABCUT_M1 environment\r\n\r\n[with a _el.h5 and _el.pickle files in the folder that contains the analyzed video)\r\n\r\n1) pythonw\r\n2) import deeplabcut\r\n3) deeplabcut.plot_trajectories(configpath,[videopath],filtered=False,track_method='ellipse')\r\n     videopath is path to the analyzed video\r\n4) KeyError(key)\r\n\r\n\n\n### Relevant log output\n\n```shell\n>>> deeplabcut.plot_trajectories(configpath,[videopath],filtered=False,track_method='ellipse')\r\nLoading  /Users/kperks/mnt/PerksLab_rstore/KP/DLC/videos/fish_divider.avi and data.\r\nTraceback (most recent call last):\r\n  File \"/Users/kperks/opt/anaconda3/envs/DEEPLABCUT_M1/lib/python3.7/site-packages/pandas/core/indexes/base.py\", line 3361, in get_loc\r\n    return self._engine.get_loc(casted_key)\r\n  File \"pandas/_libs/index.pyx\", line 76, in pandas._libs.index.IndexEngine.get_loc\r\n  File \"pandas/_libs/index.pyx\", line 108, in pandas._libs.index.IndexEngine.get_loc\r\n  File \"pandas/_libs/hashtable_class_helper.pxi\", line 5198, in pandas._libs.hashtable.PyObjectHashTable.get_item\r\n  File \"pandas/_libs/hashtable_class_helper.pxi\", line 5206, in pandas._libs.hashtable.PyObjectHashTable.get_item\r\nKeyError: 'F1'\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/Users/kperks/opt/anaconda3/envs/DEEPLABCUT_M1/lib/python3.7/site-packages/deeplabcut/utils/plotting.py\", line 279, in plot_trajectories\r\n    linewidth=linewidth,\r\n  File \"/Users/kperks/opt/anaconda3/envs/DEEPLABCUT_M1/lib/python3.7/site-packages/deeplabcut/utils/plotting.py\", line 51, in PlottingResults\r\n    Dataframe = Dataframe.loc(axis=1)[:, individuals2plot]\r\n  File \"/Users/kperks/opt/anaconda3/envs/DEEPLABCUT_M1/lib/python3.7/site-packages/pandas/core/indexing.py\", line 925, in __getitem__\r\n    return self._getitem_tuple(key)\r\n  File \"/Users/kperks/opt/anaconda3/envs/DEEPLABCUT_M1/lib/python3.7/site-packages/pandas/core/indexing.py\", line 1100, in _getitem_tuple\r\n    return self._getitem_lowerdim(tup)\r\n  File \"/Users/kperks/opt/anaconda3/envs/DEEPLABCUT_M1/lib/python3.7/site-packages/pandas/core/indexing.py\", line 818, in _getitem_lowerdim\r\n    return self._getitem_axis(tup, axis=axis)\r\n  File \"/Users/kperks/opt/anaconda3/envs/DEEPLABCUT_M1/lib/python3.7/site-packages/pandas/core/indexing.py\", line 1157, in _getitem_axis\r\n    locs = labels.get_locs(key)\r\n  File \"/Users/kperks/opt/anaconda3/envs/DEEPLABCUT_M1/lib/python3.7/site-packages/pandas/core/indexes/multi.py\", line 3349, in get_locs\r\n    self.get_loc_level(k, level=i, drop_level=False)[0]\r\n  File \"/Users/kperks/opt/anaconda3/envs/DEEPLABCUT_M1/lib/python3.7/site-packages/pandas/core/indexes/multi.py\", line 3011, in get_loc_level\r\n    return self._get_loc_level(key, level=level, drop_level=drop_level)\r\n  File \"/Users/kperks/opt/anaconda3/envs/DEEPLABCUT_M1/lib/python3.7/site-packages/pandas/core/indexes/multi.py\", line 3112, in _get_loc_level\r\n    indexer = self._get_level_indexer(key, level=level)\r\n  File \"/Users/kperks/opt/anaconda3/envs/DEEPLABCUT_M1/lib/python3.7/site-packages/pandas/core/indexes/multi.py\", line 3204, in _get_level_indexer\r\n    idx = self._get_loc_single_level_index(level_index, key)\r\n  File \"/Users/kperks/opt/anaconda3/envs/DEEPLABCUT_M1/lib/python3.7/site-packages/pandas/core/indexes/multi.py\", line 2855, in _get_loc_single_level_index\r\n    return level_index.get_loc(key)\r\n  File \"/Users/kperks/opt/anaconda3/envs/DEEPLABCUT_M1/lib/python3.7/site-packages/pandas/core/indexes/base.py\", line 3363, in get_loc\r\n    raise KeyError(key) from err\r\nKeyError: 'F1'\n```\n\n\n### Anything else?\n\nTroubleshooting Steps Taken:\r\n1) opened the .h5 in a jupyter notebook to look at the contents\r\n2) see that the column names are 'ind1', ...'ind8' (I had set n_tracks=8 during stitch_tracklets; config file has 10 individuals)\r\n     ***in the config file, the individuals' names are ['F1', 'F2', 'F3', 'F4', 'F5', 'F6', 'F7', 'F8', 'F9', 'F10'] so I assumed this is what the key error was (the function/method is looking for 'F1' in the h5 but the h5 file has 'ind1')\r\n3) performed the operations of the function line by line from plotting.py to confirm suspicion that the keys expected were being pulled from the config file. \r\n4) individuals = deeplabcut.utils.auxfun_multianimal.IntersectionofIndividualsandOnesGivenbyUser(cfg,displayedindividuals) returns individuals = ['F1', 'F2', 'F3', 'F4', 'F5', 'F6', 'F7', 'F8', 'F9', 'F10']\r\n5) I stopped here because it seems that if the function is using this list of individuals to sort through the .h5 file containing the bodypart positions of the tracked indivuduals, then it will fail due to KeyError.\r\n![Screen Shot 2021-07-27 at 4 41 31 PM](https://user-images.githubusercontent.com/4777333/127224490-bcfb1c19-cf5a-46d7-9c48-aef9bc09ca00.png)\r\n\r\nAm I doing any of these steps incorrectly? Or is there an error in how the column headers are getting created/named for the .h5 (and/or pickle)? Since I can't find anyone else posting this issue I feel like it must be the former, but I can't figure it out yet. \r\nFor these steps of the process, I am following the documentation at: https://deeplabcut.github.io/DeepLabCut/docs/maDLC_UserGuide.html (PS this documentation has evolved beautifully. So inspiring)\r\n\r\nThank you!\n\n### Code of Conduct\n\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/DeepLabCut/DeepLabCut/blob/master/CODE_OF_CONDUCT.md)","closed_by":{"login":"MMathisLab","id":28102185,"node_id":"MDQ6VXNlcjI4MTAyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/28102185?v=4","gravatar_id":"","url":"https://api.github.com/users/MMathisLab","html_url":"https://github.com/MMathisLab","followers_url":"https://api.github.com/users/MMathisLab/followers","following_url":"https://api.github.com/users/MMathisLab/following{/other_user}","gists_url":"https://api.github.com/users/MMathisLab/gists{/gist_id}","starred_url":"https://api.github.com/users/MMathisLab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MMathisLab/subscriptions","organizations_url":"https://api.github.com/users/MMathisLab/orgs","repos_url":"https://api.github.com/users/MMathisLab/repos","events_url":"https://api.github.com/users/MMathisLab/events{/privacy}","received_events_url":"https://api.github.com/users/MMathisLab/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1439/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1439/timeline","performed_via_github_app":null,"state_reason":"completed"}