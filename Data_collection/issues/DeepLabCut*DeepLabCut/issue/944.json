{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/944","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/944/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/944/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/944/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/944","id":714964853,"node_id":"MDU6SXNzdWU3MTQ5NjQ4NTM=","number":944,"title":"Cannot get RTX 3090 card to start training","user":{"login":"cfernandezpa","id":70653006,"node_id":"MDQ6VXNlcjcwNjUzMDA2","avatar_url":"https://avatars.githubusercontent.com/u/70653006?v=4","gravatar_id":"","url":"https://api.github.com/users/cfernandezpa","html_url":"https://github.com/cfernandezpa","followers_url":"https://api.github.com/users/cfernandezpa/followers","following_url":"https://api.github.com/users/cfernandezpa/following{/other_user}","gists_url":"https://api.github.com/users/cfernandezpa/gists{/gist_id}","starred_url":"https://api.github.com/users/cfernandezpa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfernandezpa/subscriptions","organizations_url":"https://api.github.com/users/cfernandezpa/orgs","repos_url":"https://api.github.com/users/cfernandezpa/repos","events_url":"https://api.github.com/users/cfernandezpa/events{/privacy}","received_events_url":"https://api.github.com/users/cfernandezpa/received_events","type":"User","site_admin":false},"labels":[{"id":1487356103,"node_id":"MDU6TGFiZWwxNDg3MzU2MTAz","url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/labels/backwards%20compatibility","name":"backwards compatibility","color":"5319e7","default":false,"description":"issues concerning prior to current versions"},{"id":1816193536,"node_id":"MDU6TGFiZWwxODE2MTkzNTM2","url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/labels/tensorflow/training","name":"tensorflow/training","color":"0052cc","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"MMathisLab","id":28102185,"node_id":"MDQ6VXNlcjI4MTAyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/28102185?v=4","gravatar_id":"","url":"https://api.github.com/users/MMathisLab","html_url":"https://github.com/MMathisLab","followers_url":"https://api.github.com/users/MMathisLab/followers","following_url":"https://api.github.com/users/MMathisLab/following{/other_user}","gists_url":"https://api.github.com/users/MMathisLab/gists{/gist_id}","starred_url":"https://api.github.com/users/MMathisLab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MMathisLab/subscriptions","organizations_url":"https://api.github.com/users/MMathisLab/orgs","repos_url":"https://api.github.com/users/MMathisLab/repos","events_url":"https://api.github.com/users/MMathisLab/events{/privacy}","received_events_url":"https://api.github.com/users/MMathisLab/received_events","type":"User","site_admin":false},"assignees":[{"login":"MMathisLab","id":28102185,"node_id":"MDQ6VXNlcjI4MTAyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/28102185?v=4","gravatar_id":"","url":"https://api.github.com/users/MMathisLab","html_url":"https://github.com/MMathisLab","followers_url":"https://api.github.com/users/MMathisLab/followers","following_url":"https://api.github.com/users/MMathisLab/following{/other_user}","gists_url":"https://api.github.com/users/MMathisLab/gists{/gist_id}","starred_url":"https://api.github.com/users/MMathisLab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MMathisLab/subscriptions","organizations_url":"https://api.github.com/users/MMathisLab/orgs","repos_url":"https://api.github.com/users/MMathisLab/repos","events_url":"https://api.github.com/users/MMathisLab/events{/privacy}","received_events_url":"https://api.github.com/users/MMathisLab/received_events","type":"User","site_admin":false}],"milestone":null,"comments":44,"created_at":"2020-10-05T15:57:49Z","updated_at":"2022-01-04T06:00:52Z","closed_at":"2021-03-16T12:42:10Z","author_association":"NONE","active_lock_reason":null,"body":"OS: Win 10\r\nDeepLabCut Version: 2.2b8\r\nAnaconda env used: DLC-GPU (cloned from Alex's github)\r\nWxPython version: 4.0.7.post2\r\nTensorflow version: many, installed with pip (see below)\r\nCuda version: 10 and 11\r\n\r\n\r\n\r\nHi everyone,\r\n\r\nFirst of all, I wanted to thank all the authors for this amazing software!\r\n\r\n I'm starting to work with DeepLabCut and after a few promising preliminary results with an \"old\" GPU (Turing architecture), we decided to upgrade to the recent Ampere architecture. Since it is also backwards compatible with old CUDA versions, we thought that it would be fine. However, after trying many combinations of Tensorflow and CUDA, I cannot make it to work. Here are the combinations I have tried so far:\r\n\r\n\r\nCuda | Tensorflow | Cudnn | Works?\r\n\r\n10 | 1.15.2 | 7.6.5 | Recognizes GPU and run some tf test, but takes to long and ended up   failing\r\n10 | 1.15.0 | 7.6.5 | Same as with tf 1.15.2\r\n10 | 1.14.0 | 7.6.5 | Does not detect GPU\r\n11 | 1.15.0 | 7.6.5 | Recognizes GPU and run some tf test, but takes to long and ended up   failing\r\n11 | 1.13.1 | 7.6.5 | Recognizes GPU and run some tf test, but takes to long and ended up   failing\r\n11 | 1.14.0 | 7.6.5 | Recognizes GPU and run some tf test, but takes to long and ended up   failing\r\n11 | 1.15.4 | 7.6.5 | Does not detect GPU\r\n11 | 1.15.2 | 7.6.5 | Recognizes GPU and run some tf test, but takes to long and ended up   failing\r\n*Tensorflow 1.13.1 does not detect the GPU either.\r\n\r\nUsing the combinations mentioned above that recognizes the GPU, and can print \"Hello, Tensorflow\", I ended up stuck at this screen (see code below).\r\n\r\nI know that in the documentation says that CUDA 10.+ is not supported, but with the old card we had, it was running fine with CUDA 11. I have very limited knowledge about this, so not sure why/how it worked.\r\n\r\nReading in CUDA documentation it says that Ampere architecture is compatible with CUDA 10.2 or earlier. Also, according to Tensorflow documentation, Tensorflow 1.15 should be compatible with ampere. The only caveat is that it takes too long to start (up to 30 min) but that can be fixed by increasing the cuda cache size.\r\n\r\nSo, to me, the only thing left that could be giving issues is Cudnn. According to Nvidia, support for Ampere only appeared in Cudnn 8. However, as far as I know, Anaconda only supports up to Cudnn 7.6.5 on Windows. Apparently it has reached Cudnn 8 on Linux.\r\n\r\n\r\n<details><summary>Code output</summary><p>\r\n\r\n[Selecting multi-animal trainer\r\nConfig:\r\n{'all_joints': [[0],\r\n                [1],\r\n                [2],\r\n                [3],\r\n                [4],\r\n                [5],\r\n                [6],\r\n                [7],\r\n                [8],\r\n                [9],\r\n                [10],\r\n                [11],\r\n                [12]],\r\n 'all_joints_names': ['snout',\r\n                      'cap',\r\n                      'leftear',\r\n                      'rightear',\r\n                      'spine',\r\n                      'lforepaw',\r\n                      'rforepaw',\r\n                      'lhindpaw',\r\n                      'rhindpaw',\r\n                      'tailbase',\r\n                      'tailend',\r\n                      'cornerofbox1',\r\n                      'cornerofbox2'],\r\n 'batch_size': 8,\r\n 'crop_pad': 0,\r\n 'cropratio': 0.4,\r\n 'dataset': 'training-datasets\\\\iteration-0\\\\UnaugmentedDataSet_2CamTest9Oct4\\\\2CamTest9_CF95shuffle3.pickle',\r\n 'dataset_type': 'multi-animal-imgaug',\r\n 'deterministic': False,\r\n 'display_iters': 500,\r\n 'fg_fraction': 0.25,\r\n 'global_scale': 0.8,\r\n 'init_weights': 'C:\\\\Users\\\\RyC\\\\anaconda3\\\\envs\\\\dlc-gpu\\\\lib\\\\site-packages\\\\deeplabcut\\\\pose_estimation_tensorflow\\\\models\\\\pretrained\\\\resnet_v1_50.ckpt',\r\n 'intermediate_supervision': False,\r\n 'intermediate_supervision_layer': 12,\r\n 'location_refinement': True,\r\n 'locref_huber_loss': True,\r\n 'locref_loss_weight': 0.05,\r\n 'locref_stdev': 7.2801,\r\n 'log_dir': 'log',\r\n 'max_input_size': 1500,\r\n 'mean_pixel': [123.68, 116.779, 103.939],\r\n 'metadataset': 'training-datasets\\\\iteration-0\\\\UnaugmentedDataSet_2CamTest9Oct4\\\\Documentation_data-2CamTest9_95shuffle3.pickle',\r\n 'min_input_size': 64,\r\n 'mirror': False,\r\n 'multi_step': [[0.0001, 7500], [5e-05, 12000], [1e-05, 200000]],\r\n 'net_type': 'resnet_50',\r\n 'num_joints': 13,\r\n 'num_limbs': 55,\r\n 'optimizer': 'adam',\r\n 'pafwidth': 20,\r\n 'pairwise_huber_loss': False,\r\n 'pairwise_loss_weight': 0.1,\r\n 'pairwise_predict': False,\r\n 'partaffinityfield_graph': [[5, 9],\r\n                             [4, 7],\r\n                             [1, 3],\r\n                             [6, 9],\r\n                             [4, 8],\r\n                             [5, 6],\r\n                             [2, 8],\r\n                             [0, 7],\r\n                             [8, 9],\r\n                             [1, 6],\r\n                             [0, 10],\r\n                             [3, 7],\r\n                             [0, 3],\r\n                             [2, 5],\r\n                             [2, 4],\r\n                             [5, 8],\r\n                             [1, 2],\r\n                             [4, 9],\r\n                             [6, 7],\r\n                             [2, 9],\r\n                             [3, 10],\r\n                             [6, 10],\r\n                             [8, 10],\r\n                             [1, 5],\r\n                             [3, 6],\r\n                             [0, 4],\r\n                             [1, 10],\r\n                             [7, 10],\r\n                             [4, 10],\r\n                             [2, 6],\r\n                             [4, 5],\r\n                             [1, 4],\r\n                             [2, 10],\r\n                             [9, 10],\r\n                             [3, 9],\r\n                             [0, 5],\r\n                             [1, 9],\r\n                             [2, 3],\r\n                             [0, 8],\r\n                             [3, 5],\r\n                             [0, 1],\r\n                             [2, 7],\r\n                             [7, 9],\r\n                             [7, 8],\r\n                             [5, 10],\r\n                             [4, 6],\r\n                             [6, 8],\r\n                             [5, 7],\r\n                             [3, 8],\r\n                             [0, 6],\r\n                             [1, 8],\r\n                             [1, 7],\r\n                             [0, 9],\r\n                             [3, 4],\r\n                             [0, 2]],\r\n 'partaffinityfield_predict': True,\r\n 'pos_dist_thresh': 17,\r\n 'project_path': 'C:\\\\Users\\\\RyC\\\\2CamTest9-CF-2020-10-04',\r\n 'regularize': False,\r\n 'rotation': 25,\r\n 'rotratio': 0.4,\r\n 'save_iters': 10000,\r\n 'scale_jitter_lo': 0.5,\r\n 'scale_jitter_up': 1.25,\r\n 'scoremap_dir': 'test',\r\n 'shuffle': True,\r\n 'snapshot_prefix': 'C:\\\\Users\\\\RyC\\\\2CamTest9-CF-2020-10-04\\\\dlc-models\\\\iteration-0\\\\2CamTest9Oct4-trainset95shuffle3\\\\train\\\\snapshot',\r\n 'stride': 8.0,\r\n 'weigh_negatives': False,\r\n 'weigh_only_present_joints': False,\r\n 'weigh_part_predictions': False,\r\n 'weight_decay': 0.0001}\r\nActivating limb prediction...\r\nStarting with multi-animal imaug + adam pose-dataset loader.\r\nBatch Size is 8\r\nGetting specs multi-animal-imgaug 55 13\r\nInitializing ResNet\r\nLoading ImageNet-pretrained resnet_50\r\n2020-10-05 10:40:16.943131: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2\r\n2020-10-05 10:40:16.946595: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1639] Found device 0 with properties:\r\nname: GeForce RTX 3090 major: 8 minor: 6 memoryClockRate(GHz): 1.695\r\npciBusID: 0000:08:00.0\r\n2020-10-05 10:40:16.946675: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cudart64_100.dll\r\n2020-10-05 10:40:16.948226: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cublas64_100.dll\r\n2020-10-05 10:40:16.948570: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cufft64_100.dll\r\n2020-10-05 10:40:16.948928: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library curand64_100.dll\r\n2020-10-05 10:40:16.949263: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cusolver64_100.dll\r\n2020-10-05 10:40:16.949302: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cusparse64_100.dll\r\n2020-10-05 10:40:16.949559: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cudnn64_7.dll\r\n2020-10-05 10:40:16.949840: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1767] Adding visible gpu devices: 0\r\n2020-10-05 10:40:17.963045: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1180] Device interconnect StreamExecutor with strength 1 edge matrix:\r\n2020-10-05 10:40:17.963140: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1186]      0\r\n2020-10-05 10:40:17.964083: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1199] 0:   N\r\n2020-10-05 10:40:17.964440: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1325] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 22071 MB memory) -> physical GPU (device: 0, name: GeForce RTX 3090, pci bus id: 0000:08:00.0, compute capability: 8.6)\r\nMax_iters overwritten as 3000\r\nDisplay_iters overwritten as 10\r\nSave_iters overwritten as 50\r\nTraining parameters:\r\n{'stride': 8.0, 'weigh_part_predictions': False, 'weigh_negatives': False, 'fg_fraction': 0.25, 'mean_pixel': [123.68, 116.779, 103.939], 'shuffle': True, 'snapshot_prefix': 'C:\\\\Users\\\\RyC\\\\2CamTest9-CF-2020-10-04\\\\dlc-models\\\\iteration-0\\\\2CamTest9Oct4-trainset95shuffle3\\\\train\\\\snapshot', 'log_dir': 'log', 'global_scale': 0.8, 'location_refinement': True, 'locref_stdev': 7.2801, 'locref_loss_weight': 0.05, 'locref_huber_loss': True, 'optimizer': 'adam', 'intermediate_supervision': False, 'intermediate_supervision_layer': 12, 'regularize': False, 'weight_decay': 0.0001, 'crop_pad': 0, 'scoremap_dir': 'test', 'batch_size': 8, 'dataset_type': 'multi-animal-imgaug', 'deterministic': False, 'mirror': False, 'pairwise_huber_loss': False, 'weigh_only_present_joints': False, 'partaffinityfield_predict': True, 'pairwise_predict': True, 'all_joints': [[0], [1], [2], [3], [4], [5], [6], [7], [8], [9], [10], [11], [12]], 'all_joints_names': ['snout', 'cap', 'leftear', 'rightear', 'spine', 'lforepaw', 'rforepaw', 'lhindpaw', 'rhindpaw', 'tailbase', 'tailend', 'cornerofbox1', 'cornerofbox2'], 'cropratio': 0.4, 'dataset': 'training-datasets\\\\iteration-0\\\\UnaugmentedDataSet_2CamTest9Oct4\\\\2CamTest9_CF95shuffle3.pickle', 'display_iters': 500, 'init_weights': 'C:\\\\Users\\\\RyC\\\\anaconda3\\\\envs\\\\dlc-gpu\\\\lib\\\\site-packages\\\\deeplabcut\\\\pose_estimation_tensorflow\\\\models\\\\pretrained\\\\resnet_v1_50.ckpt', 'max_input_size': 1500, 'metadataset': 'training-datasets\\\\iteration-0\\\\UnaugmentedDataSet_2CamTest9Oct4\\\\Documentation_data-2CamTest9_95shuffle3.pickle', 'min_input_size': 64, 'multi_step': [[0.0001, 7500], [5e-05, 12000], [1e-05, 200000]], 'net_type': 'resnet_50', 'num_joints': 13, 'num_limbs': 55, 'pafwidth': 20, 'pairwise_loss_weight': 0.1, 'partaffinityfield_graph': [[5, 9], [4, 7], [1, 3], [6, 9], [4, 8], [5, 6], [2, 8], [0, 7], [8, 9], [1, 6], [0, 10], [3, 7], [0, 3], [2, 5], [2, 4], [5, 8], [1, 2], [4, 9], [6, 7], [2, 9], [3, 10], [6, 10], [8, 10], [1, 5], [3, 6], [0, 4], [1, 10], [7, 10], [4, 10], [2, 6], [4, 5], [1, 4], [2, 10], [9, 10], [3, 9], [0, 5], [1, 9], [2, 3], [0, 8], [3, 5], [0, 1], [2, 7], [7, 9], [7, 8], [5, 10], [4, 6], [6, 8], [5, 7], [3, 8], [0, 6], [1, 8], [1, 7], [0, 9], [3, 4], [0, 2]], 'pos_dist_thresh': 17, 'project_path': 'C:\\\\Users\\\\RyC\\\\2CamTest9-CF-2020-10-04', 'rotation': 25, 'rotratio': 0.4, 'save_iters': 10000, 'scale_jitter_lo': 0.5, 'scale_jitter_up': 1.25}\r\nStarting multi-animal training....\r\n2020-10-05 10:40:27.731872: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cudnn64_7.dll]\r\n\r\n</p></details>\r\n\r\nUpon reading in some forums, some people have been succesful using Symlink in other applications, so I tried that with Cudnn64_7.dll and hardlinked to Cudnn64_8.dll inside DLC-GPU enviroment, but I have not been able to make it work. It shows an error saying that compute capabilities does not match.\r\n\r\nDo you have any suggestion that I might try?\r\n\r\nMany thanks in advance.\r\n","closed_by":{"login":"MMathisLab","id":28102185,"node_id":"MDQ6VXNlcjI4MTAyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/28102185?v=4","gravatar_id":"","url":"https://api.github.com/users/MMathisLab","html_url":"https://github.com/MMathisLab","followers_url":"https://api.github.com/users/MMathisLab/followers","following_url":"https://api.github.com/users/MMathisLab/following{/other_user}","gists_url":"https://api.github.com/users/MMathisLab/gists{/gist_id}","starred_url":"https://api.github.com/users/MMathisLab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MMathisLab/subscriptions","organizations_url":"https://api.github.com/users/MMathisLab/orgs","repos_url":"https://api.github.com/users/MMathisLab/repos","events_url":"https://api.github.com/users/MMathisLab/events{/privacy}","received_events_url":"https://api.github.com/users/MMathisLab/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/944/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/944/timeline","performed_via_github_app":null,"state_reason":"completed"}