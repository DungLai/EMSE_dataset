{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1601","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1601/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1601/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1601/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/1601","id":1074288325,"node_id":"I_kwDOB5BM6c5ACFbF","number":1601,"title":"running on GPU","user":{"login":"shanikornha","id":95242660,"node_id":"U_kgDOBa1JpA","avatar_url":"https://avatars.githubusercontent.com/u/95242660?v=4","gravatar_id":"","url":"https://api.github.com/users/shanikornha","html_url":"https://github.com/shanikornha","followers_url":"https://api.github.com/users/shanikornha/followers","following_url":"https://api.github.com/users/shanikornha/following{/other_user}","gists_url":"https://api.github.com/users/shanikornha/gists{/gist_id}","starred_url":"https://api.github.com/users/shanikornha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shanikornha/subscriptions","organizations_url":"https://api.github.com/users/shanikornha/orgs","repos_url":"https://api.github.com/users/shanikornha/repos","events_url":"https://api.github.com/users/shanikornha/events{/privacy}","received_events_url":"https://api.github.com/users/shanikornha/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false},"assignees":[{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false}],"milestone":null,"comments":10,"created_at":"2021-12-08T11:07:40Z","updated_at":"2021-12-10T10:58:11Z","closed_at":"2021-12-10T10:58:11Z","author_association":"NONE","active_lock_reason":null,"body":"### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Bug description\n\nWhen trying to run the training, I see that no GPU is activated. In addition, the training something stop after 20 iterations and is not proceedings. \n\n### Operating System\n\noperating system: Windows 10\r\nCUDA: v11.2\r\ncuDNN: 8.1\r\nTensorflow: 2.7\n\n### DeepLabCut version\n\ndlc version: I couldn't run the code; I assume it is the newest\n\n### DeepLabCut mode\n\nsingle animal\n\n### Device type\n\ngpu \r\n+-----------------------------------------------------------------------------+\r\n| NVIDIA-SMI 497.09       Driver Version: 497.09       CUDA Version: 11.5     |\r\n|-------------------------------+----------------------+----------------------+\r\n| GPU  Name            TCC/WDDM | Bus-Id        Disp.A | Volatile Uncorr. ECC |\r\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\r\n|                               |                      |               MIG M. |\r\n|===============================+======================+======================|\r\n|   0  NVIDIA GeForce ... WDDM  | 00000000:03:00.0  On |                  N/A |\r\n|  0%   50C    P8    17W / 170W |    754MiB / 12288MiB |      0%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n\r\n+-----------------------------------------------------------------------------+\r\n| Processes:                                                                  |\r\n|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\r\n|        ID   ID                                                   Usage      |\r\n|=============================================================================|\r\n|    0   N/A  N/A      1300    C+G   Insufficient Permissions        N/A      |\r\n|    0   N/A  N/A      1328    C+G   ...y\\ShellExperienceHost.exe    N/A      |\r\n|    0   N/A  N/A      6560    C+G   ...ge\\Application\\msedge.exe    N/A      |\r\n|    0   N/A  N/A      9332    C+G   C:\\Windows\\explorer.exe         N/A      |\r\n|    0   N/A  N/A      9844    C+G   ...artMenuExperienceHost.exe    N/A      |\r\n|    0   N/A  N/A     10780    C+G   ...5n1h2txyewy\\SearchApp.exe    N/A      |\r\n|    0   N/A  N/A     11380    C+G   ...me\\Application\\chrome.exe    N/A      |\r\n|    0   N/A  N/A     12180    C+G   ...nputApp\\TextInputHost.exe    N/A      |\r\n+-----------------------------------------------------------------------------+\r\n\n\n### Steps To Reproduce\n\n1. Label and extract frames.\r\n2. Create training dataset:\r\ndeeplabcut.create_training_dataset(config)\r\n4. Change in the pose.cfg file the displayitters to 10 instead of 1000\r\n4. Run and try to train the network\r\ndeeplabcut.train_network(config, gputouse=0)\r\nor deeplabcut.train_network(config)\r\n5. Observe the following on the screen.\n\n### Relevant log output\n\n```shell\nMicrosoft Windows [Version 10.0.19042.1348]\r\n(c) Microsoft Corporation. All rights reserved.\r\n\r\nC:\\Users\\kornha0000-adm>nvidia-smi\r\nWed Dec  8 11:26:22 2021\r\n+-----------------------------------------------------------------------------+\r\n| NVIDIA-SMI 497.09       Driver Version: 497.09       CUDA Version: 11.5     |\r\n|-------------------------------+----------------------+----------------------+\r\n| GPU  Name            TCC/WDDM | Bus-Id        Disp.A | Volatile Uncorr. ECC |\r\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\r\n|                               |                      |               MIG M. |\r\n|===============================+======================+======================|\r\n|   0  NVIDIA GeForce ... WDDM  | 00000000:03:00.0  On |                  N/A |\r\n|  0%   54C    P8    19W / 170W |    602MiB / 12288MiB |      3%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n\r\n+-----------------------------------------------------------------------------+\r\n| Processes:                                                                  |\r\n|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\r\n|        ID   ID                                                   Usage      |\r\n|=============================================================================|\r\n|    0   N/A  N/A      1300    C+G   Insufficient Permissions        N/A      |\r\n|    0   N/A  N/A      1328    C+G   ...y\\ShellExperienceHost.exe    N/A      |\r\n|    0   N/A  N/A      6560    C+G   ...ge\\Application\\msedge.exe    N/A      |\r\n|    0   N/A  N/A      9332    C+G   C:\\Windows\\explorer.exe         N/A      |\r\n|    0   N/A  N/A      9844    C+G   ...artMenuExperienceHost.exe    N/A      |\r\n|    0   N/A  N/A     10780    C+G   ...5n1h2txyewy\\SearchApp.exe    N/A      |\r\n|    0   N/A  N/A     11380    C+G   ...me\\Application\\chrome.exe    N/A      |\r\n|    0   N/A  N/A     12180    C+G   ...nputApp\\TextInputHost.exe    N/A      |\r\n+-----------------------------------------------------------------------------+\r\n\r\nC:\\Users\\kornha0000-adm>conda activate DEEPLABCUT\r\n\r\n(DEEPLABCUT) C:\\Users\\kornha0000-adm>python\r\nPython 3.8.12 | packaged by conda-forge | (default, Oct 12 2021, 21:22:46) [MSC v.1916 64 bit (AMD64)] on win32\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import deeplabcut\r\n>>> config = 'C:\\Users\\kornha0000-adm\\Desktop\\T1_Videos\\Test_number_1-SL-2021-12-07\\config.yaml'\r\n  File \"<stdin>\", line 1\r\nSyntaxError: (unicode error) 'unicodeescape' codec can't decode bytes in position 2-3: truncated \\UXXXXXXXX escape\r\n>>> config = r'C:\\Users\\kornha0000-adm\\Desktop\\T1_Videos\\Test_number_1-SL-2021-12-07\\config.yaml'\r\n>>> deeplabcut.create_training_dataset(config)\r\nThe training dataset is successfully created. Use the function 'train_network' to start training. Happy training!\r\n[(0.95, 1, (array([17, 35,  8,  3, 25, 24, 11, 13,  1, 22,  2, 28, 19, 36, 33, 18, 29,\r\n       10,  5, 38, 14, 21,  0, 16,  7, 37, 34, 26,  4, 12, 32, 27,  9, 15,\r\n       23,  6, 20]), array([31, 30])))]\r\n>>> deeplabcut.train_network(config, gputouse=0)\r\nSelecting single-animal trainer\r\nConfig:\r\n{'all_joints': [[0], [1], [2], [3]],\r\n 'all_joints_names': ['head', 'FLeft', 'FRight', 'bottom'],\r\n 'alpha_r': 0.02,\r\n 'apply_prob': 0.5,\r\n 'batch_size': 1,\r\n 'clahe': True,\r\n 'claheratio': 0.1,\r\n 'crop_pad': 0,\r\n 'crop_sampling': 'hybrid',\r\n 'crop_size': [400, 400],\r\n 'cropratio': 0.4,\r\n 'dataset': 'training-datasets\\\\iteration-0\\\\UnaugmentedDataSet_Test_number_1Dec7\\\\Test_number_1_SL95shuffle1.mat',\r\n 'dataset_type': 'default',\r\n 'decay_steps': 30000,\r\n 'deterministic': False,\r\n 'display_iters': 10,\r\n 'edge': False,\r\n 'emboss': {'alpha': [0.0, 1.0], 'embossratio': 0.1, 'strength': [0.5, 1.5]},\r\n 'fg_fraction': 0.25,\r\n 'global_scale': 0.8,\r\n 'histeq': True,\r\n 'histeqratio': 0.1,\r\n 'init_weights': 'C:\\\\Users\\\\kornha0000-adm\\\\Anaconda3\\\\envs\\\\DEEPLABCUT\\\\lib\\\\site-packages\\\\deeplabcut\\\\pose_estimation_tensorflow\\\\models\\\\pretrained\\\\resnet_v1_50.ckpt',\r\n 'intermediate_supervision': False,\r\n 'intermediate_supervision_layer': 12,\r\n 'location_refinement': True,\r\n 'locref_huber_loss': True,\r\n 'locref_loss_weight': 0.05,\r\n 'locref_stdev': 7.2801,\r\n 'log_dir': 'log',\r\n 'lr_init': 0.0005,\r\n 'max_input_size': 1500,\r\n 'max_shift': 0.4,\r\n 'mean_pixel': [123.68, 116.779, 103.939],\r\n 'metadataset': 'training-datasets\\\\iteration-0\\\\UnaugmentedDataSet_Test_number_1Dec7\\\\Documentation_data-Test_number_1_95shuffle1.pickle',\r\n 'min_input_size': 64,\r\n 'mirror': False,\r\n 'multi_stage': False,\r\n 'multi_step': [[0.005, 10000],\r\n                [0.02, 430000],\r\n                [0.002, 730000],\r\n                [0.001, 1030000]],\r\n 'net_type': 'resnet_50',\r\n 'num_joints': 4,\r\n 'optimizer': 'sgd',\r\n 'pairwise_huber_loss': False,\r\n 'pairwise_predict': False,\r\n 'partaffinityfield_predict': False,\r\n 'pos_dist_thresh': 17,\r\n 'pre_resize': [],\r\n 'project_path': 'C:\\\\Users\\\\kornha0000-adm\\\\Desktop\\\\T1_Videos\\\\Test_number_1-SL-2021-12-07',\r\n 'regularize': False,\r\n 'rotation': 25,\r\n 'rotratio': 0.4,\r\n 'save_iters': 50000,\r\n 'scale_jitter_lo': 0.5,\r\n 'scale_jitter_up': 1.25,\r\n 'scoremap_dir': 'test',\r\n 'sharpen': False,\r\n 'sharpenratio': 0.3,\r\n 'shuffle': True,\r\n 'snapshot_prefix': 'C:\\\\Users\\\\kornha0000-adm\\\\Desktop\\\\T1_Videos\\\\Test_number_1-SL-2021-12-07\\\\dlc-models\\\\iteration-0\\\\Test_number_1Dec7-trainset95shuffle1\\\\train\\\\snapshot',\r\n 'stride': 8.0,\r\n 'weigh_negatives': False,\r\n 'weigh_only_present_joints': False,\r\n 'weigh_part_predictions': False,\r\n 'weight_decay': 0.0001}\r\nBatch Size is 1\r\nC:\\Users\\kornha0000-adm\\Anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\tensorflow\\python\\keras\\engine\\base_layer_v1.py:1694: UserWarning: `layer.apply` is deprecated and will be removed in a future version. Please use `layer.__call__` method instead.\r\n  warnings.warn('`layer.apply` is deprecated and '\r\n2021-12-08 11:42:54.946297: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX AVX2\r\nTo enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\r\n2021-12-08 11:42:56.174711: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1525] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9613 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 3060, pci bus id: 0000:03:00.0, compute capability: 8.6\r\nLoading ImageNet-pretrained resnet_50\r\n2021-12-08 11:42:56.705312: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1525] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9613 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 3060, pci bus id: 0000:03:00.0, compute capability: 8.6\r\nTraining parameter:\r\n{'stride': 8.0, 'weigh_part_predictions': False, 'weigh_negatives': False, 'fg_fraction': 0.25, 'mean_pixel': [123.68, 116.779, 103.939], 'shuffle': True, 'snapshot_prefix': 'C:\\\\Users\\\\kornha0000-adm\\\\Desktop\\\\T1_Videos\\\\Test_number_1-SL-2021-12-07\\\\dlc-models\\\\iteration-0\\\\Test_number_1Dec7-trainset95shuffle1\\\\train\\\\snapshot', 'log_dir': 'log', 'global_scale': 0.8, 'location_refinement': True, 'locref_stdev': 7.2801, 'locref_loss_weight': 0.05, 'locref_huber_loss': True, 'optimizer': 'sgd', 'intermediate_supervision': False, 'intermediate_supervision_layer': 12, 'regularize': False, 'weight_decay': 0.0001, 'crop_pad': 0, 'scoremap_dir': 'test', 'batch_size': 1, 'dataset_type': 'default', 'deterministic': False, 'mirror': False, 'pairwise_huber_loss': False, 'weigh_only_present_joints': False, 'partaffinityfield_predict': False, 'pairwise_predict': False, 'all_joints': [[0], [1], [2], [3]], 'all_joints_names': ['head', 'FLeft', 'FRight', 'bottom'], 'alpha_r': 0.02, 'apply_prob': 0.5, 'clahe': True, 'claheratio': 0.1, 'crop_sampling': 'hybrid', 'crop_size': [400, 400], 'cropratio': 0.4, 'dataset': 'training-datasets\\\\iteration-0\\\\UnaugmentedDataSet_Test_number_1Dec7\\\\Test_number_1_SL95shuffle1.mat', 'decay_steps': 30000, 'display_iters': 10, 'edge': False, 'emboss': {'alpha': [0.0, 1.0], 'embossratio': 0.1, 'strength': [0.5, 1.5]}, 'histeq': True, 'histeqratio': 0.1, 'init_weights': 'C:\\\\Users\\\\kornha0000-adm\\\\Anaconda3\\\\envs\\\\DEEPLABCUT\\\\lib\\\\site-packages\\\\deeplabcut\\\\pose_estimation_tensorflow\\\\models\\\\pretrained\\\\resnet_v1_50.ckpt', 'lr_init': 0.0005, 'max_input_size': 1500, 'max_shift': 0.4, 'metadataset': 'training-datasets\\\\iteration-0\\\\UnaugmentedDataSet_Test_number_1Dec7\\\\Documentation_data-Test_number_1_95shuffle1.pickle', 'min_input_size': 64, 'multi_stage': False, 'multi_step': [[0.005, 10000], [0.02, 430000], [0.002, 730000], [0.001, 1030000]], 'net_type': 'resnet_50', 'num_joints': 4, 'pos_dist_thresh': 17, 'pre_resize': [], 'project_path': 'C:\\\\Users\\\\kornha0000-adm\\\\Desktop\\\\T1_Videos\\\\Test_number_1-SL-2021-12-07', 'rotation': 25, 'rotratio': 0.4, 'save_iters': 50000, 'scale_jitter_lo': 0.5, 'scale_jitter_up': 1.25, 'sharpen': False, 'sharpenratio': 0.3, 'covering': True, 'elastic_transform': True, 'motion_blur': True, 'motion_blur_params': {'k': 7, 'angle': (-90, 90)}}\r\nStarting training....\r\n2021-12-08 11:43:04.552558: I tensorflow/stream_executor/cuda/cuda_dnn.cc:366] Loaded cuDNN version 8100\n```\n\n\n### Anything else?\n\nI am struggling with this error for over a month. \r\nI have checked that CUDA 11.2 is compatible with cuDNN 8.1, and that the latest tensorflow (2.7) also matches all the above. \r\nI installed python 3.9.9 and visual studio 2019. \r\nAny help will be highly appreciated!!\r\n\r\nThanks a lot\r\nBest,\r\nShani \n\n### Code of Conduct\n\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/DeepLabCut/DeepLabCut/blob/master/CODE_OF_CONDUCT.md)","closed_by":{"login":"MMathisLab","id":28102185,"node_id":"MDQ6VXNlcjI4MTAyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/28102185?v=4","gravatar_id":"","url":"https://api.github.com/users/MMathisLab","html_url":"https://github.com/MMathisLab","followers_url":"https://api.github.com/users/MMathisLab/followers","following_url":"https://api.github.com/users/MMathisLab/following{/other_user}","gists_url":"https://api.github.com/users/MMathisLab/gists{/gist_id}","starred_url":"https://api.github.com/users/MMathisLab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MMathisLab/subscriptions","organizations_url":"https://api.github.com/users/MMathisLab/orgs","repos_url":"https://api.github.com/users/MMathisLab/repos","events_url":"https://api.github.com/users/MMathisLab/events{/privacy}","received_events_url":"https://api.github.com/users/MMathisLab/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1601/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1601/timeline","performed_via_github_app":null,"state_reason":"completed"}