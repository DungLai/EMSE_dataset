{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1925","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1925/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1925/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1925/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/1925","id":1324585328,"node_id":"I_kwDOB5BM6c5O85Fw","number":1925,"title":"OSError: Tracklets are empty. (batch processing)","user":{"login":"QueenKrokuz","id":51208433,"node_id":"MDQ6VXNlcjUxMjA4NDMz","avatar_url":"https://avatars.githubusercontent.com/u/51208433?v=4","gravatar_id":"","url":"https://api.github.com/users/QueenKrokuz","html_url":"https://github.com/QueenKrokuz","followers_url":"https://api.github.com/users/QueenKrokuz/followers","following_url":"https://api.github.com/users/QueenKrokuz/following{/other_user}","gists_url":"https://api.github.com/users/QueenKrokuz/gists{/gist_id}","starred_url":"https://api.github.com/users/QueenKrokuz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/QueenKrokuz/subscriptions","organizations_url":"https://api.github.com/users/QueenKrokuz/orgs","repos_url":"https://api.github.com/users/QueenKrokuz/repos","events_url":"https://api.github.com/users/QueenKrokuz/events{/privacy}","received_events_url":"https://api.github.com/users/QueenKrokuz/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"AlexEMG","id":20850270,"node_id":"MDQ6VXNlcjIwODUwMjcw","avatar_url":"https://avatars.githubusercontent.com/u/20850270?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexEMG","html_url":"https://github.com/AlexEMG","followers_url":"https://api.github.com/users/AlexEMG/followers","following_url":"https://api.github.com/users/AlexEMG/following{/other_user}","gists_url":"https://api.github.com/users/AlexEMG/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexEMG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexEMG/subscriptions","organizations_url":"https://api.github.com/users/AlexEMG/orgs","repos_url":"https://api.github.com/users/AlexEMG/repos","events_url":"https://api.github.com/users/AlexEMG/events{/privacy}","received_events_url":"https://api.github.com/users/AlexEMG/received_events","type":"User","site_admin":false},"assignees":[{"login":"AlexEMG","id":20850270,"node_id":"MDQ6VXNlcjIwODUwMjcw","avatar_url":"https://avatars.githubusercontent.com/u/20850270?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexEMG","html_url":"https://github.com/AlexEMG","followers_url":"https://api.github.com/users/AlexEMG/followers","following_url":"https://api.github.com/users/AlexEMG/following{/other_user}","gists_url":"https://api.github.com/users/AlexEMG/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexEMG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexEMG/subscriptions","organizations_url":"https://api.github.com/users/AlexEMG/orgs","repos_url":"https://api.github.com/users/AlexEMG/repos","events_url":"https://api.github.com/users/AlexEMG/events{/privacy}","received_events_url":"https://api.github.com/users/AlexEMG/received_events","type":"User","site_admin":false},{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2022-08-01T15:16:54Z","updated_at":"2022-10-09T14:36:28Z","closed_at":"2022-10-09T14:36:28Z","author_association":"NONE","active_lock_reason":null,"body":"### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Bug description\n\nWhen running `deeplabcut.analyze_videos`,  process terminates with `OSError: Tracklets are empty.` Further investigation indicates that the error arises when running `deeplabcut.stitch_tracklets` Despite this, `deeplabcut.create_video_with_all_detections` runs successfully. Despite not training with animal identity, selecting “Assemble using animal identity” in the gui before analyzing videos would allow DLC to progress past the error, and analyzing the resulting csv graphs indicated that the animals were not being tracked properly. Retraining with both animal identity and an expanded label set seemed to confirm this. However, when running 'deeplabcut.analyze_videos' in the command line again with a newly trained net still produced the same errors.\r\n\r\nWhen working with a folder of videos rather than an individual video, only a single item in the folder was analyzed before this error was given.\r\n\r\nSome filenames and paths have been removed for privacy.\n\n### Operating System\n\nDebian 11.4\n\n### DeepLabCut version\n\n2.2.1.1\n\n### DeepLabCut mode\n\nmulti animal\n\n### Device type\n\nNVIDIA GeForce RTX 3060\n\n### Steps To Reproduce\n\nSteps to Reproduce:\r\n\r\n1. Custom conda environment with ipython and TensorFlow set up (does not matter whether the environment variable `TF_ENABLE_ONEDNN_OPTS=0` is set or not)\r\n2. inference_cfg.yaml: `boundingboxslack: 0\r\niou_threshold: 0.6\r\nmax_age: 1\r\nmethod: m1\r\nmin_hits: 1\r\nminimalnumberofconnections: 0\r\npafthreshold: 0.1\r\npcutoff: 0.1\r\ntopktoretain: 4\r\nvariant: 0\r\nwithid: false`\r\n\n\n### Relevant log output\n\n```shell\nIn [1]: import deeplabcut\r\n2022-07-19 09:09:03.608372: I tensorflow/core/util/util.cc:169] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.\r\nLoading DLC 2.2.1.1...\r\n/home/dlc/anaconda3/envs/DLC_bash/lib/python3.8/site-packages/statsmodels/compat/pandas.py:65: FutureWarning: pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.\r\n  from pandas import Int64Index as NumericIndex\r\nDLC loaded in light mode; you cannot use any GUI (labeling, relabeling and standalone GUI)\r\n\r\nIn [2]: deeplabcut.analyze_videos('[config_path.yaml]',['[video_file]\r\n   ...: .mp4'], videotype='.mp4', auto_track=False)\r\nUsing snapshot-170000 for model [model_file]\r\n/home/dlc/anaconda3/envs/DLC_bash/lib/python3.8/site-packages/tensorflow/python/keras/engine/base_layer_v1.py:1694: UserWarning: `layer.apply` is deprecated and will be removed in a future version. Please use `layer.__call__` method instead.\r\n  warnings.warn('`layer.apply` is deprecated and '\r\n2022-07-19 09:09:51.387403: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2022-07-19 09:09:51.391435: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2022-07-19 09:09:51.391867: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2022-07-19 09:09:51.392332: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX_VNNI FMA\r\nTo enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\r\n2022-07-19 09:09:51.393858: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2022-07-19 09:09:51.394281: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2022-07-19 09:09:51.394657: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2022-07-19 09:09:54.486687: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2022-07-19 09:09:54.487144: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2022-07-19 09:09:54.487468: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2022-07-19 09:09:54.487829: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1532] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9825 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 3060, pci bus id: 0000:01:00.0, compute capability: 8.6\r\n2022-07-19 09:09:54.511428: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:354] MLIR V1 optimization pass is not enabled\r\nStarting to analyze %  /home/dlc/Documents/Fishvids/Test1-Sylvie-2022-07-07/videos/Cichlid_cut_2.mp4\r\nLoading  /home/dlc/Documents/Fishvids/Test1-Sylvie-2022-07-07/videos/Cichlid_cut_2.mp4\r\nDuration of video [s]:  300.33 , recorded with  15.0 fps!\r\nOverall # of frames:  4505  found with (before cropping) frame dimensions:  320 240\r\nStarting to extract posture from the video(s) with batchsize: 8\r\n  0%|                                                                                                                                                  | 0/4505 [00:00<?, ?it/s]2022-07-19 09:09:55.503831: I tensorflow/stream_executor/cuda/cuda_dnn.cc:384] Loaded cuDNN version 8100\r\n100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4505/4505 [00:27<00:00, 164.28it/s]\r\nVideo Analyzed. Saving results in [video_folder]...\r\nThe videos are analyzed. Time to assemble animals and track 'em... \r\n Call 'create_video_with_all_detections' to check multi-animal detection quality before tracking.\r\nIf the tracking is not satisfactory for some videos, consider expanding the training set. You can use the function 'extract_outlier_frames' to extract a few representative outlier frames.\r\nOut[2]: 'DLC_resnet50_Test1Jul7shuffle1_170000'\r\n\r\nIn [3]: deeplabcut.convert_detections2tracklets('[config_file.yaml]',['video_file.mp4'], videotype='.mp4', track_method='box', overwrite='True')\r\nUsing snapshot-170000 for model [model]\r\nProcessing...  [video_file]\r\nAnalyzing [h5_file]\r\n100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4505/4505 [00:00<00:00, 10923.06it/s]\r\n0it [00:00, ?it/s]/home/dlc/anaconda3/envs/DLC_bash/lib/python3.8/site-packages/deeplabcut/pose_estimation_tensorflow/lib/trackingutils.py:402: RuntimeWarning: invalid value encountered in double_scalars\r\n  r = w / float(h)\r\n4505it [00:01, 3890.27it/s]\r\nThe tracklets were created (i.e., under the hood deeplabcut.convert_detections2tracklets was run). Now you can 'refine_tracklets' in the GUI, or run 'deeplabcut.stitch_tracklets'.\r\n\r\nIn [4]: deeplabcut.create_video_with_all_detections('[config_file.yaml]', '[video_file.mp4]')\r\nCreating labeled video for  Cichlid_cut_2\r\n100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4505/4505 [00:01<00:00, 2426.41it/s]\r\n\r\nIn [5]: deeplabcut.stitch_tracklets('[config_file.yaml]',['[video_file.mp4]'], videotype='.mp4', n\r\n   ...: _tracks=4)\r\nProcessing...  [video_file]\r\n[Errno 2] No such file or directory: '/[video_file]_resnet50_Test1Jul7shuffle1_170000_bx.pickle' \r\nSkipping...\r\n\r\nIn [6]: deeplabcut.stitch_tracklets('[config_file.yaml]','[video_file]', videotype='.mp4', n_tracks=4)\r\nProcessing...  [video_file]\r\n[Errno 2] No such file or directory: '[video_file]_resnet50_Test1Jul7shuffle1_170000_bx.pickle' \r\nSkipping...\r\n\r\nIn [7]: deeplabcut.stitch_tracklets('[config_file].yaml','/[video_file].mp4', videotype='.mp4', n_tracks=4)\r\nProcessing...  [video_file].mp4\r\n---------------------------------------------------------------------------\r\nOSError                                   Traceback (most recent call last)\r\nInput In [7], in <cell line: 1>()\r\n----> 1 deeplabcut.stitch_tracklets('[config_file].yaml','/[video_file].mp4', videotype='.mp4', n_tracks=4)\r\n\r\nFile ~/anaconda3/envs/DLC_bash/lib/python3.8/site-packages/deeplabcut/refine_training_dataset/stitch.py:1161, in stitch_tracklets(config_path, videos, videotype, shuffle, trainingsetindex, n_tracks, min_length, split_tracklets, prestitch_residuals, max_gap, weight_func, destfolder, modelprefix, track_method, output_name, transformer_checkpoint, save_as_csv)\r\n   1159 pickle_file = dataname.split(\".h5\")[0] + f\"{method}.pickle\"\r\n   1160 try:\r\n-> 1161     stitcher = TrackletStitcher.from_pickle(\r\n   1162         pickle_file, n_tracks, min_length, split_tracklets, prestitch_residuals\r\n   1163     )\r\n   1164     with_id = any(tracklet.identity != -1 for tracklet in stitcher)\r\n   1165     if with_id and weight_func is None:\r\n   1166         # Add in identity weighing before building the graph\r\n\r\nFile ~/anaconda3/envs/DLC_bash/lib/python3.8/site-packages/deeplabcut/refine_training_dataset/stitch.py:511, in TrackletStitcher.from_pickle(cls, pickle_file, n_tracks, min_length, split_tracklets, prestitch_residuals)\r\n    509 with open(pickle_file, \"rb\") as file:\r\n    510     tracklets = pickle.load(file)\r\n--> 511 class_ = cls.from_dict_of_dict(\r\n    512     tracklets, n_tracks, min_length, split_tracklets, prestitch_residuals\r\n    513 )\r\n    514 class_.filename = pickle_file\r\n    515 return class_\r\n\r\nFile ~/anaconda3/envs/DLC_bash/lib/python3.8/site-packages/deeplabcut/refine_training_dataset/stitch.py:543, in TrackletStitcher.from_dict_of_dict(cls, dict_of_dict, n_tracks, min_length, split_tracklets, prestitch_residuals)\r\n    541     else:\r\n    542         tracklets.append(Tracklet(data, inds))\r\n--> 543 class_ = cls(\r\n    544     tracklets, n_tracks, min_length, split_tracklets, prestitch_residuals\r\n    545 )\r\n    546 class_.header = header\r\n    547 class_.single = single\r\n\r\nFile ~/anaconda3/envs/DLC_bash/lib/python3.8/site-packages/deeplabcut/refine_training_dataset/stitch.py:464, in TrackletStitcher.__init__(self, tracklets, n_tracks, min_length, split_tracklets, prestitch_residuals)\r\n    461             self.residuals.append(t)\r\n    463 if not len(self.tracklets):\r\n--> 464     raise IOError(\"Tracklets are empty.\")\r\n    466 if prestitch_residuals:\r\n    467     self._prestitch_residuals(5)  # Hard-coded but found to work very well\r\n\r\nOSError: Tracklets are empty.\n```\n\n\n### Anything else?\n\nNote that although the progress bar following `Starting to extract posture from the video(s) with batchsize:8` is empty in this particular run, the same error would occur in previous attempts even if that progress bar was filled.\r\n\r\nThis same error occurred on Windows 10 aas well, in both the gui and the command line versions of the program for both operating systems.\n\n### Code of Conduct\n\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/DeepLabCut/DeepLabCut/blob/master/CODE_OF_CONDUCT.md)","closed_by":{"login":"MMathisLab","id":28102185,"node_id":"MDQ6VXNlcjI4MTAyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/28102185?v=4","gravatar_id":"","url":"https://api.github.com/users/MMathisLab","html_url":"https://github.com/MMathisLab","followers_url":"https://api.github.com/users/MMathisLab/followers","following_url":"https://api.github.com/users/MMathisLab/following{/other_user}","gists_url":"https://api.github.com/users/MMathisLab/gists{/gist_id}","starred_url":"https://api.github.com/users/MMathisLab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MMathisLab/subscriptions","organizations_url":"https://api.github.com/users/MMathisLab/orgs","repos_url":"https://api.github.com/users/MMathisLab/repos","events_url":"https://api.github.com/users/MMathisLab/events{/privacy}","received_events_url":"https://api.github.com/users/MMathisLab/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1925/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1925/timeline","performed_via_github_app":null,"state_reason":"completed"}