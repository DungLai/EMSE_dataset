{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/771","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/771/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/771/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/771/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/771","id":644859990,"node_id":"MDU6SXNzdWU2NDQ4NTk5OTA=","number":771,"title":"Deeplabcut-GPU-cluster not use?","user":{"login":"xiuxian620","id":40397232,"node_id":"MDQ6VXNlcjQwMzk3MjMy","avatar_url":"https://avatars.githubusercontent.com/u/40397232?v=4","gravatar_id":"","url":"https://api.github.com/users/xiuxian620","html_url":"https://github.com/xiuxian620","followers_url":"https://api.github.com/users/xiuxian620/followers","following_url":"https://api.github.com/users/xiuxian620/following{/other_user}","gists_url":"https://api.github.com/users/xiuxian620/gists{/gist_id}","starred_url":"https://api.github.com/users/xiuxian620/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiuxian620/subscriptions","organizations_url":"https://api.github.com/users/xiuxian620/orgs","repos_url":"https://api.github.com/users/xiuxian620/repos","events_url":"https://api.github.com/users/xiuxian620/events{/privacy}","received_events_url":"https://api.github.com/users/xiuxian620/received_events","type":"User","site_admin":false},"labels":[{"id":880550040,"node_id":"MDU6TGFiZWw4ODA1NTAwNDA=","url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/labels/question","name":"question","color":"d876e3","default":true,"description":"user question (not great for github ;)"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-06-24T19:15:39Z","updated_at":"2020-06-30T14:41:41Z","closed_at":"2020-06-30T14:41:41Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, Dear all, \r\ni am using the HPC in the university to do my training by using the gpu. i use the 'srun' to go the the 'dash$' and then activate my enviroment, \r\n[shauyin@curta ~]$ srun --ntasks=4 --time=14:00:00 --mem-per-cpu=4000 --qos=standard --partition=gpu --gres=gpu:2 --pty bash\r\nbash-4.2$ module load Anaconda3/2018.12\r\nbash-4.2$ source activate dlc\r\n(dlc) bash-4.2$ export DLClight=True\r\n(dlc) bash-4.2$  python /home/shauyin/script/dlc-gpu.py 0 ${SLURM_NTASKS}\r\n\r\nand then the training start....\r\ni check 'squeue -u shauyin'  to see my occupy with gpu, \r\n\r\n[shauyin@curta ~]$ squeue -u shauyin\r\n             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)\r\n           4309692       gpu     bash  shauyin  R      29:59      1 g011\r\nit does allocate to gpu.\r\nbut i do not know why the training is super slower than using the cpu in the cluster.Can any one figure out what the problem would be. \r\nand here i also attach my 'dlc-gpu.py' script:\r\nimport sys\r\nfrom os import listdir\r\nimport tensorflow as tf \r\nimport deeplabcut \r\njobid=int(sys.argv[1])\r\nn_cpus=int(sys.argv[2])\r\nconfig = tf.ConfigProto(device_count = {'CPU': n_cpus}, inter_op_parallelism_threads=n_cpus, intra_op_parallelism_threads=4)\r\nsess = tf.Session(config=config)\r\nproject_path='/home/shauyin/test-shauyin-2020-06-21/'\r\nconfig_path=project_path + 'config.yaml'\r\nvideo_path='/scratch/shauyin/originvideo/'\r\nvids=[v for v in listdir(video_path) if '.mp4' in v]\r\nvideo=vids[jobid]\r\ndeeplabcut.train_network(config_path,shuffle=1,trainingsetindex=0,gputouse=1,max_snapshots_to_keep=100,displayiters=100,saveiters=300,maxiters=500000)\r\ndeeplabcut.evaluate_network(config_path, plotting=True)\r\ndeeplabcut.analyse_videos(config_path, [video_path + video],shuffle=1,gputouse=2,batch_size=8,save_as_csv = True,videotype='.mp4')\r\ndeeplabcut.plot_trajectories(config_path,[video_path + video])\r\ndeeplabcut.create_labeled_video(config_path,[video_path + video])\r\ndeeplabcut.extract_outlier_frames(config_path,[video_path + video])\r\ndeeplabcut.refine_labels(config_path)\r\ndeeplabcut.merge_datasets(config_path)\r\nprint('succeded')\r\n\r\n\r\ndoes something wrong inside this script for setting gpu use?\r\n\r\nand another questions: i have applied two gpu for use, and how can i use the two gpus in one training? \r\nand in the command' deeplabcut.train_network(config_path,shuffle=1,trainingsetindex=0,gputouse=1,max_snapshots_to_keep=100,displayiters=100,saveiters=300,maxiters=500000)', 'gputouse=1' , the number '1' here only represent the seqeuence of gpus, or the numeric number? \r\n\r\nthank you for help~\r\ngreetings, \r\nshauyin","closed_by":{"login":"MMathisLab","id":28102185,"node_id":"MDQ6VXNlcjI4MTAyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/28102185?v=4","gravatar_id":"","url":"https://api.github.com/users/MMathisLab","html_url":"https://github.com/MMathisLab","followers_url":"https://api.github.com/users/MMathisLab/followers","following_url":"https://api.github.com/users/MMathisLab/following{/other_user}","gists_url":"https://api.github.com/users/MMathisLab/gists{/gist_id}","starred_url":"https://api.github.com/users/MMathisLab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MMathisLab/subscriptions","organizations_url":"https://api.github.com/users/MMathisLab/orgs","repos_url":"https://api.github.com/users/MMathisLab/repos","events_url":"https://api.github.com/users/MMathisLab/events{/privacy}","received_events_url":"https://api.github.com/users/MMathisLab/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/771/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/771/timeline","performed_via_github_app":null,"state_reason":"completed"}