{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/352","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/352/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/352/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/352/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/352","id":465069934,"node_id":"MDU6SXNzdWU0NjUwNjk5MzQ=","number":352,"title":"Evaluation Results not reported (empty files created and no plotting)","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2019-07-08T06:04:57Z","updated_at":"2019-07-08T16:14:14Z","closed_at":"2019-07-08T16:14:09Z","author_association":"NONE","active_lock_reason":null,"body":"**Your Operating system and DeepLabCut version**\r\n\r\nPlease state your operating system, env, and which version of DeepLabCut you are using.\r\n\r\n Anaconda Env. for GUI stuff\r\n\r\nPlease complete the following information about your system:\r\n\r\nOS: iOS 10.13.6.\r\nDeepLabCut Version: DeepLabCut 2.0.7.1.\r\nBrowser: Google Chrome (Google Collab)\r\n\r\n\r\n**Describe the problem**\r\n\r\nI've trained a network to 230,000 iterations on Google Collab. And when I run the evaluate_network, two things happen. The first time around, it appears to start to evaluate and eventually, among other things,  throws an error about the .h5 file not being found (see below). When this happens, I re launch my google drive and see the evaluations-results>iteration0>headOrientation-moving_arudinoJun27-trainset95shuffle1>DeepCut_resnet50_headOrientation-moâ€¦ing_arudinoJun27shuffle1_230000-snapshot-230000.h5 (215kb).  \r\n\r\nIf I run the cell again, without changing anything, I then get no error, and a report that everything went well (the evaluations folder has already been created, the shuffle folder already exists, And that the net has already been evaluated ,etc (see below). Here there is no report though of the network evaluation, and then the csv file (as well I assume as the .h5 file) have no reports. They are empty. There's also no folder for plotting.\r\n\r\n\r\n**How to Reproduce the problem**\r\nSteps to reproduce the behavior:\r\n1.\r\n install deeplabcut 2.0 (with all the Collab specific workarounds, suppress GUI, etc)\r\n2. \r\nfrom pathlib import Path\r\npath_config_file='/content/drive/Shared drives/DeepLabCut2.0/DLC_Project/headOrientation-moving_arudino-JG-2019-06-27\r\n3. (training dataset was created, and the network was trained to iteration-232,000 ) \r\n4.\r\n%matplotlib notebook\r\ndeeplabcut.evaluate_network(path_config_file,plotting=True)\r\n\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n**Run deeplabcut.evaluate_network(path_config_file,plotting=True) first time around:**\r\n\r\n```\r\nRunning  DeepCut_resnet50_headOrientation-moving_arudinoJun27shuffle1_230000  with # of trainingiterations: 230000\r\n0it [00:00, ?it/s]Analyzing data...\r\n220it [00:09, 22.63it/s]\r\nDone and results stored for snapshot:  snapshot-230000\r\n---------------------------------------------------------------------------\r\nFileNotFoundError                         Traceback (most recent call last)\r\n/usr/lib/python3.6/contextlib.py in __exit__(self, type, value, traceback)\r\n     98             try:\r\n---> 99                 self.gen.throw(type, value, traceback)\r\n    100             except StopIteration as exc:\r\n\r\n5 frames\r\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/framework/ops.py in get_controller(self, default)\r\n   5651                  self).get_controller(default) as g, context.graph_mode():\r\n-> 5652         yield g\r\n   5653     finally:\r\n\r\n/usr/local/lib/python3.6/dist-packages/deeplabcut/pose_estimation_tensorflow/evaluate.py in evaluate_network(config, Shuffles, plotting, show_errors, comparisonbodyparts, gputouse)\r\n    154                 try:\r\n--> 155                     DataMachine = pd.read_hdf(resultsfilename,'df_with_missing')\r\n    156                     print(\"This net has already been evaluated!\")\r\n\r\n/usr/local/lib/python3.6/dist-packages/pandas/io/pytables.py in read_hdf(path_or_buf, key, mode, **kwargs)\r\n    370             raise compat.FileNotFoundError(\r\n--> 371                 'File %s does not exist' % path_or_buf)\r\n    372 \r\n\r\nFileNotFoundError: File /content/drive/Shared drives/DeepLabCut2.0/DLC_Projects/headOrientation-moving_arudino-JG-2019-06-27/evaluation-results/iteration-0/headOrientation-moving_arudinoJun27-trainset95shuffle1/DeepCut_resnet50_headOrientation-moving_arudinoJun27shuffle1_230000-snapshot-230000.h5 does not exist\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nKeyError                                  Traceback (most recent call last)\r\n<ipython-input-20-d8366108eec8> in <module>()\r\n      1 get_ipython().magic('matplotlib notebook')\r\n----> 2 deeplabcut.evaluate_network(path_config_file,plotting=True)\r\n      3 \r\n      4 # Here you want to see a low pixel error! Of course, it can only be as good as the labeler, so be sure your labels are good!\r\n\r\n/usr/local/lib/python3.6/dist-packages/deeplabcut/pose_estimation_tensorflow/evaluate.py in evaluate_network(config, Shuffles, plotting, show_errors, comparisonbodyparts, gputouse)\r\n    187                     print(\"Done and results stored for snapshot: \", Snapshots[snapindex])\r\n    188                     DataCombined = pd.concat([Data.T, DataMachine.T], axis=0).T\r\n--> 189                     RMSE,RMSEpcutoff = pairwisedistances(DataCombined, cfg[\"scorer\"], DLCscorer,cfg[\"pcutoff\"],comparisonbodyparts)\r\n    190                     testerror = np.nanmean(RMSE.iloc[testIndices].values.flatten())\r\n    191                     trainerror = np.nanmean(RMSE.iloc[trainIndices].values.flatten())\r\n\r\n/usr/local/lib/python3.6/dist-packages/ruamel/yaml/comments.py in __getitem__(self, key)\r\n    689         # type: (Any) -> Any\r\n    690         try:\r\n--> 691             return ordereddict.__getitem__(self, key)\r\n    692         except KeyError:\r\n    693             for merged in getattr(self, merge_attrib, []):\r\n\r\nKeyError: 'pcutoff'`\r\n```\r\n\r\n**When I run this cell again without changing anything (deeplabcut.evaluate_network(path_config_file,plotting=True).**\r\n\r\n```\r\n\r\nConfig:\r\n{'all_joints': [[0],\r\n                [1],\r\n                [2],\r\n                [3],\r\n                [4],\r\n                [5],\r\n                [6],\r\n                [7],\r\n                [8],\r\n                [9],\r\n                [10],\r\n                [11],\r\n                [12],\r\n                [13],\r\n                [14],\r\n                [15],\r\n                [16],\r\n                [17],\r\n                [18],\r\n                [19],\r\n                [20],\r\n                [21],\r\n                [22],\r\n                [23],\r\n                [24],\r\n                [25],\r\n                [26],\r\n                [27]],\r\n 'all_joints_names': ['FiberTipLower',\r\n                      'FiberTipUpper',\r\n                      'fiberBase_R',\r\n                      'fiberBase_L',\r\n                      'fiberBase_C',\r\n                      'earU_R',\r\n                      'earL_R',\r\n                      'earU_L',\r\n                      'earL_L',\r\n                      'eyeU_L',\r\n                      'eyeL_L',\r\n                      'eyeU_R',\r\n                      'eyeL_R',\r\n                      'snout_R',\r\n                      'snout_L',\r\n                      'snout_C',\r\n                      'frontPaw_right',\r\n                      'frontPaw_left',\r\n                      'backPaw_right',\r\n                      'backPaw_left',\r\n                      'light_On',\r\n                      'Top_R',\r\n                      'Top_L',\r\n                      'Bottom_R',\r\n                      'Bottom_L',\r\n                      'Tail_U',\r\n                      'Tail_M',\r\n                      'Tail_L'],\r\n 'batch_size': 1,\r\n 'bottomheight': 400,\r\n 'crop': True,\r\n 'crop_pad': 0,\r\n 'cropratio': 0.4,\r\n 'dataset': 'training-datasets/iteration-0/UnaugmentedDataSet_headOrientation-moving_arudinoJun27/headOrientation-moving_arudino_JG95shuffle1.mat',\r\n 'dataset_type': 'default',\r\n 'deterministic': False,\r\n 'display_iters': 1000,\r\n 'fg_fraction': 0.25,\r\n 'global_scale': 0.8,\r\n 'init_weights': '/usr/local/lib/python3.6/dist-packages/deeplabcut/pose_estimation_tensorflow/models/pretrained/resnet_v1_50.ckpt',\r\n 'intermediate_supervision': False,\r\n 'intermediate_supervision_layer': 12,\r\n 'leftwidth': 400,\r\n 'location_refinement': True,\r\n 'locref_huber_loss': True,\r\n 'locref_loss_weight': 0.05,\r\n 'locref_stdev': 7.2801,\r\n 'log_dir': 'log',\r\n 'max_input_size': 1500,\r\n 'mean_pixel': [123.68, 116.779, 103.939],\r\n 'metadataset': 'training-datasets/iteration-0/UnaugmentedDataSet_headOrientation-moving_arudinoJun27/Documentation_data-headOrientation-moving_arudino_95shuffle1.pickle',\r\n 'min_input_size': 64,\r\n 'minsize': 100,\r\n 'mirror': False,\r\n 'multi_step': [[0.005, 10000],\r\n                [0.02, 430000],\r\n                [0.002, 730000],\r\n                [0.001, 1030000]],\r\n 'net_type': 'resnet_50',\r\n 'num_joints': 28,\r\n 'optimizer': 'sgd',\r\n 'pos_dist_thresh': 17,\r\n 'project_path': '/content/drive/Shared '\r\n                 'drives/DeepLabCut2.0/DLC_Projects/headOrientation-moving_arudino-JG-2019-06-27',\r\n 'regularize': False,\r\n 'rightwidth': 400,\r\n 'save_iters': 5000,\r\n 'scale_jitter_lo': 0.5,\r\n 'scale_jitter_up': 1.25,\r\n 'scoremap_dir': 'test',\r\n 'shuffle': True,\r\n 'snapshot_prefix': '/content/drive/Shared '\r\n                    'drives/DeepLabCut2.0/DLC_Projects/headOrientation-moving_arudino-JG-2019-06-27/dlc-models/iteration-0/headOrientation-moving_arudinoJun27-trainset95shuffle1/test/snapshot',\r\n 'stride': 8.0,\r\n 'topheight': 400,\r\n 'use_gt_segm': False,\r\n 'video': False,\r\n 'video_batch': False,\r\n 'weigh_negatives': False,\r\n 'weigh_only_present_joints': False,\r\n 'weigh_part_predictions': False,\r\n 'weight_decay': 0.0001}\r\n/content/drive/Shared drives/DeepLabCut2.0/DLC_Projects/Orientation-moving_arudino-JG-2019-06-27/evaluation-results/  already exists!\r\n/content/drive/Shared drives/DeepLabCut2.0/DLC_Projects/Orientation-moving_arudino-JG-2019-06-27/evaluation-results/iteration-0/headOrientation-moving_arudinoJun27-trainset95shuffle1  already exists!\r\nRunning  DeepCut_resnet50_headOrientation-moving_arudinoJun27shuffle1_230000  with # of trainingiterations: 230000\r\nThis net has already been evaluated!\r\nThe network is evaluated and the results are stored in the subdirectory 'evaluation_results'.\r\nIf it generalizes well, choose the best model for prediction and update the config file with the appropriate index for the 'snapshotindex'.\r\nUse the function 'analyze_video' to make predictions on new videos.\r\nOtherwise consider retraining the network (see DeepLabCut workflow Fig 2)\r\n/content/drive/Shared drives/headOrientation-moving_arudino-JG-2019-06-27/evaluation-results/  already exists!\r\n/content/drive/Shared drives/headOrientation-moving_arudino-JG-2019-06-27/evaluation-results/iteration-0/headOrientation-moving_arudinoJun27-trainset95shuffle1  already exists!\r\nRunning  DeepCut_resnet50_headOrientation-moving_arudinoJun27shuffle1_230000  with # of trainingiterations: 230000\r\nThis net has already been evaluated!\r\nThe network is evaluated and the results are stored in the subdirectory 'evaluation_results'.\r\nIf it generalizes well, choose the best model for prediction and update the config file with the appropriate index for the 'snapshotindex'.\r\nUse the function 'analyze_video' to make predictions on new videos.\r\nOtherwise consider retraining the network (see DeepLabCut workflow Fig 2)\r\n\r\n```\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n\r\nAt some point when I was training the network it stopped, and I went back to continue training it on iteration 205,000. So when it restarted training, it re-started the iteration number back to 0 (even though it was trained on the 205,000 shuffle). So the new iteration number of 230,000 is from the second time around. I don't know if this would affect it at all? ","closed_by":{"login":"MMathisLab","id":28102185,"node_id":"MDQ6VXNlcjI4MTAyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/28102185?v=4","gravatar_id":"","url":"https://api.github.com/users/MMathisLab","html_url":"https://github.com/MMathisLab","followers_url":"https://api.github.com/users/MMathisLab/followers","following_url":"https://api.github.com/users/MMathisLab/following{/other_user}","gists_url":"https://api.github.com/users/MMathisLab/gists{/gist_id}","starred_url":"https://api.github.com/users/MMathisLab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MMathisLab/subscriptions","organizations_url":"https://api.github.com/users/MMathisLab/orgs","repos_url":"https://api.github.com/users/MMathisLab/repos","events_url":"https://api.github.com/users/MMathisLab/events{/privacy}","received_events_url":"https://api.github.com/users/MMathisLab/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/352/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/352/timeline","performed_via_github_app":null,"state_reason":"completed"}