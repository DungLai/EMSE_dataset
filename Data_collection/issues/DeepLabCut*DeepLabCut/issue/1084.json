{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1084","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1084/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1084/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1084/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/1084","id":787745420,"node_id":"MDU6SXNzdWU3ODc3NDU0MjA=","number":1084,"title":"evaluation problems with cropped trainingset when individual1 is empty","user":{"login":"backyardbiomech","id":9662673,"node_id":"MDQ6VXNlcjk2NjI2NzM=","avatar_url":"https://avatars.githubusercontent.com/u/9662673?v=4","gravatar_id":"","url":"https://api.github.com/users/backyardbiomech","html_url":"https://github.com/backyardbiomech","followers_url":"https://api.github.com/users/backyardbiomech/followers","following_url":"https://api.github.com/users/backyardbiomech/following{/other_user}","gists_url":"https://api.github.com/users/backyardbiomech/gists{/gist_id}","starred_url":"https://api.github.com/users/backyardbiomech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/backyardbiomech/subscriptions","organizations_url":"https://api.github.com/users/backyardbiomech/orgs","repos_url":"https://api.github.com/users/backyardbiomech/repos","events_url":"https://api.github.com/users/backyardbiomech/events{/privacy}","received_events_url":"https://api.github.com/users/backyardbiomech/received_events","type":"User","site_admin":false},"labels":[{"id":880550034,"node_id":"MDU6TGFiZWw4ODA1NTAwMzQ=","url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2379991078,"node_id":"MDU6TGFiZWwyMzc5OTkxMDc4","url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/labels/maDLC","name":"maDLC","color":"96001b","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"AlexEMG","id":20850270,"node_id":"MDQ6VXNlcjIwODUwMjcw","avatar_url":"https://avatars.githubusercontent.com/u/20850270?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexEMG","html_url":"https://github.com/AlexEMG","followers_url":"https://api.github.com/users/AlexEMG/followers","following_url":"https://api.github.com/users/AlexEMG/following{/other_user}","gists_url":"https://api.github.com/users/AlexEMG/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexEMG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexEMG/subscriptions","organizations_url":"https://api.github.com/users/AlexEMG/orgs","repos_url":"https://api.github.com/users/AlexEMG/repos","events_url":"https://api.github.com/users/AlexEMG/events{/privacy}","received_events_url":"https://api.github.com/users/AlexEMG/received_events","type":"User","site_admin":false},"assignees":[{"login":"AlexEMG","id":20850270,"node_id":"MDQ6VXNlcjIwODUwMjcw","avatar_url":"https://avatars.githubusercontent.com/u/20850270?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexEMG","html_url":"https://github.com/AlexEMG","followers_url":"https://api.github.com/users/AlexEMG/followers","following_url":"https://api.github.com/users/AlexEMG/following{/other_user}","gists_url":"https://api.github.com/users/AlexEMG/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexEMG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexEMG/subscriptions","organizations_url":"https://api.github.com/users/AlexEMG/orgs","repos_url":"https://api.github.com/users/AlexEMG/repos","events_url":"https://api.github.com/users/AlexEMG/events{/privacy}","received_events_url":"https://api.github.com/users/AlexEMG/received_events","type":"User","site_admin":false},{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2021-01-17T16:46:23Z","updated_at":"2021-04-21T21:22:18Z","closed_at":"2021-04-21T20:35:35Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"This could be a bug if the behavior can be confirmed. \r\n\r\nOS: Windows 10\r\nDeepLabCut Version: 2.1.9\r\nAnaconda env used: DLC-GPU, running in a custom jupyter notebook.\r\n\r\n**Describe the problem**\r\n\r\nI'm working on a difficult multianimal data set and am in an analyze-refine-train loop. I have 1-3 individuals present in the training videos. I'm cropping my labeled images to 10 600x600 when I create the trainingset. On one loop after training, evaluation results and analysis were worse than the previous iteration, so I looked through the evaluation images (I can make them now thanks to the more efficient plotting!).\r\n\r\nSomething fails without clear error reporting if the first individual is cropped out of a specific cropped image, and only labels for individual2 are present. I imagine the same problem could occur if the first individual is deliberately left blank.\r\n\r\nThe problems I'm having are in the test images, but I'm also concerned about how training may be affected. \r\n\r\n**Details**\r\nThe image below from the test set shows detected points all \"roughly\" where they are supposed to be. However, there are no \"+\" markers to indicate where the manual labels should be. Specifically, the orange marker in the lower right is clearly too low and to the right of the manual marker (second screenshot), and the blue marker is above and left of the manual marker (second screenshot). This pattern is not consistent, however; **most** images have all expected markers (\"dots\", \"+\", and \"X\"), but if a \"+\" is missing, they are all missing.\r\n\r\n![image](https://user-images.githubusercontent.com/9662673/104848019-103fbb80-58b1-11eb-8a8e-51cb59fe4e69.png)\r\n\r\n![image](https://user-images.githubusercontent.com/9662673/104848158-b1c70d00-58b1-11eb-90bd-212b9be64808.png)\r\n\r\n\r\nThis image was luckily included in the test images from the previous iteration (screenshot below), and it had the same problem, so it's clearly some problem with the data.\r\n\r\n![image](https://user-images.githubusercontent.com/9662673/104848628-f81d6b80-58b3-11eb-929a-5c28dc9d5ce9.png)\r\n\r\nWith the last iteration, the multianimal crossvalidate returned NaN for all of the test parameters:\r\n\r\n```\r\nSaving optimal inference parameters...\r\n   train_iter  train_frac  shuffle  rmse_train  hits_train  misses_train  falsepos_train  ndetects_train  pck_train  rpck_train  rmse_test  hits_test  misses_test  falsepos_test  ndetects_test  pck_test  rpck_test\r\n0     50000.0        90.0      1.0    2.738722         7.0           0.0             0.0             1.0   0.928571     0.87303        NaN        NaN          NaN            NaN            NaN       NaN        NaN\r\n```\r\n\r\nMy best guess as to the cause is that this animal is marked as individual2, and individual1 is completely empty in this crop. I can confirm that in an earlier frame from this movie, when individual1 bodyparts are marked,  all markers are present.\r\n\r\nI'm wondering if this \"marker\" issue is also causing havoc during cross-validation, and even during training. However, in the previous iteration, when the above frame was also in the test group, I got actual values for test during crossvalidate (but pafthreshold was still validating an order of magnitude too high to get good tracklets for these data). \r\n\r\nThe only errors I get that may or may not be a signal of a problem is a bunch of all-NaN slice runtime warnings, (e.g below), but I had assumed most of those are for crops where no animal is visible:\r\n\r\n```\r\n128it [00:26,  4.99it/s]C:\\Users\\jacksonbe3\\Miniconda3\\envs\\DLC\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\evaluate_multianimal.py:275: RuntimeWarning: All-NaN slice encountered\r\n```\r\n\r\nIn this data set, with that size crop, it's possible that up to ~5% of the cropped images have **only** \"individual2\", so I imagine that whether those images get shuffled into test or train could have a big impact on things.","closed_by":{"login":"AlexEMG","id":20850270,"node_id":"MDQ6VXNlcjIwODUwMjcw","avatar_url":"https://avatars.githubusercontent.com/u/20850270?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexEMG","html_url":"https://github.com/AlexEMG","followers_url":"https://api.github.com/users/AlexEMG/followers","following_url":"https://api.github.com/users/AlexEMG/following{/other_user}","gists_url":"https://api.github.com/users/AlexEMG/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexEMG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexEMG/subscriptions","organizations_url":"https://api.github.com/users/AlexEMG/orgs","repos_url":"https://api.github.com/users/AlexEMG/repos","events_url":"https://api.github.com/users/AlexEMG/events{/privacy}","received_events_url":"https://api.github.com/users/AlexEMG/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1084/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1084/timeline","performed_via_github_app":null,"state_reason":"completed"}