{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1558","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1558/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1558/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1558/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/1558","id":1036017496,"node_id":"I_kwDOB5BM6c49wF9Y","number":1558,"title":"Multi-animal prediction using deeplabcut model_export","user":{"login":"ArdeleanRichard","id":37302327,"node_id":"MDQ6VXNlcjM3MzAyMzI3","avatar_url":"https://avatars.githubusercontent.com/u/37302327?v=4","gravatar_id":"","url":"https://api.github.com/users/ArdeleanRichard","html_url":"https://github.com/ArdeleanRichard","followers_url":"https://api.github.com/users/ArdeleanRichard/followers","following_url":"https://api.github.com/users/ArdeleanRichard/following{/other_user}","gists_url":"https://api.github.com/users/ArdeleanRichard/gists{/gist_id}","starred_url":"https://api.github.com/users/ArdeleanRichard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ArdeleanRichard/subscriptions","organizations_url":"https://api.github.com/users/ArdeleanRichard/orgs","repos_url":"https://api.github.com/users/ArdeleanRichard/repos","events_url":"https://api.github.com/users/ArdeleanRichard/events{/privacy}","received_events_url":"https://api.github.com/users/ArdeleanRichard/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"MMathisLab","id":28102185,"node_id":"MDQ6VXNlcjI4MTAyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/28102185?v=4","gravatar_id":"","url":"https://api.github.com/users/MMathisLab","html_url":"https://github.com/MMathisLab","followers_url":"https://api.github.com/users/MMathisLab/followers","following_url":"https://api.github.com/users/MMathisLab/following{/other_user}","gists_url":"https://api.github.com/users/MMathisLab/gists{/gist_id}","starred_url":"https://api.github.com/users/MMathisLab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MMathisLab/subscriptions","organizations_url":"https://api.github.com/users/MMathisLab/orgs","repos_url":"https://api.github.com/users/MMathisLab/repos","events_url":"https://api.github.com/users/MMathisLab/events{/privacy}","received_events_url":"https://api.github.com/users/MMathisLab/received_events","type":"User","site_admin":false},"assignees":[{"login":"MMathisLab","id":28102185,"node_id":"MDQ6VXNlcjI4MTAyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/28102185?v=4","gravatar_id":"","url":"https://api.github.com/users/MMathisLab","html_url":"https://github.com/MMathisLab","followers_url":"https://api.github.com/users/MMathisLab/followers","following_url":"https://api.github.com/users/MMathisLab/following{/other_user}","gists_url":"https://api.github.com/users/MMathisLab/gists{/gist_id}","starred_url":"https://api.github.com/users/MMathisLab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MMathisLab/subscriptions","organizations_url":"https://api.github.com/users/MMathisLab/orgs","repos_url":"https://api.github.com/users/MMathisLab/repos","events_url":"https://api.github.com/users/MMathisLab/events{/privacy}","received_events_url":"https://api.github.com/users/MMathisLab/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2021-10-26T08:48:52Z","updated_at":"2021-10-27T16:38:03Z","closed_at":"2021-10-27T12:27:47Z","author_association":"NONE","active_lock_reason":null,"body":"### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Bug description\n\nExporting the model created and using it to predict seems to leave out coordinates.\n\n### Operating System\n\nMicrosoft Windows 10 Home\r\nVersion: 10.0.19042 Build 19042\r\n\n\n### DeepLabCut version\n\nDLC version: 2.2.0.2\n\n### DeepLabCut mode\n\nmulti animal\n\n### Device type\n\nCPU: AMD Ryzen 9 5900HX with Radeon Graphics, 3301 Mhz, 8 Core(s), 16 Logical Processor(s)\r\nGPU: NVIDIA GeForce RTX 3080 Laptop\r\n\r\n\n\n### Steps To Reproduce\n\n1. Used the DLC-GUI to label the keypoints of 3 individuals, each with 3 body parts. \r\n2. Trained multiple models: dlcrnet_ms5, restnet50, efficientnet-b0 with the same results. \r\n3. Video analysis returns the expected and intended result. With markers showing 3 different individuals and 3 different body parts.\r\n\r\n3b. Using the deeplabcut.export_model() to create a .pb model to be used for separate predictions.\r\n   4. Running on a selected image will return an array of 3 arrays each with 3 elements.\r\nExample: \r\n[414.4364  412.214     1.     ]\r\n[411.30463 455.03662   1.     ]\r\n[401.72665 456.98535   1.     ]\r\nAs far as I understand, 3 individuals, 3 body parts, 3 values (2 coordinates + 1 likelihood)  should return 3*3*3 = 27 values. But in these cases it returns only 9. These values are not the coordinates of the 3 body parts of 1 individual, nor are they the coordinates of 1 body part from 3 individuals. \r\nThis can be seen in the following image:\r\n![image](https://user-images.githubusercontent.com/37302327/138836870-0ac56f19-da83-402f-b84f-806fb613bc1a.png)\r\n\r\nIn the video created, all the coordinates (of 3 individuals and 3 body parts for each can be viewed):\r\n![image](https://user-images.githubusercontent.com/37302327/138837618-b28f788c-9161-4e52-92a7-51f300939c93.png)\n\n### Relevant log output\n\n_No response_\n\n### Anything else?\n\nCode for loading .pb model:\r\n\r\nimport tensorflow as tf\r\nimport cv2\r\n\r\ndef load_pb(path_to_pb):\r\n    with tf.compat.v1.gfile.GFile(path_to_pb, \"rb\") as f:\r\n        graph_def = tf.compat.v1.GraphDef()\r\n        graph_def.ParseFromString(f.read())\r\n    with tf.Graph().as_default() as graph:\r\n        tf.import_graph_def(graph_def, name='')\r\n        return graph\r\n\r\ngraph = load_pb(PATH_TO_PB_MODEL)\r\n\r\nwith tf.compat.v1.Session(graph=graph) as sess:\r\n    input = graph.get_tensor_by_name('Placeholder:0')\r\n    output = graph.get_tensor_by_name('concat_1:0')\r\n\r\n    image = cv2.imread(IMAGE_PATH)\r\n    test = sess.run(output, feed_dict={input: [image]})\r\n\r\nThe arrays shown in the reproduction steps are the 'output'.\n\n### Code of Conduct\n\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/DeepLabCut/DeepLabCut/blob/master/CODE_OF_CONDUCT.md)","closed_by":{"login":"MMathisLab","id":28102185,"node_id":"MDQ6VXNlcjI4MTAyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/28102185?v=4","gravatar_id":"","url":"https://api.github.com/users/MMathisLab","html_url":"https://github.com/MMathisLab","followers_url":"https://api.github.com/users/MMathisLab/followers","following_url":"https://api.github.com/users/MMathisLab/following{/other_user}","gists_url":"https://api.github.com/users/MMathisLab/gists{/gist_id}","starred_url":"https://api.github.com/users/MMathisLab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MMathisLab/subscriptions","organizations_url":"https://api.github.com/users/MMathisLab/orgs","repos_url":"https://api.github.com/users/MMathisLab/repos","events_url":"https://api.github.com/users/MMathisLab/events{/privacy}","received_events_url":"https://api.github.com/users/MMathisLab/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1558/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1558/timeline","performed_via_github_app":null,"state_reason":"completed"}