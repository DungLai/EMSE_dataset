{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1821","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1821/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1821/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1821/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/1821","id":1226745630,"node_id":"I_kwDOB5BM6c5JHqce","number":1821,"title":"issue running transformer_reID","user":{"login":"rs3966","id":88156138,"node_id":"MDQ6VXNlcjg4MTU2MTM4","avatar_url":"https://avatars.githubusercontent.com/u/88156138?v=4","gravatar_id":"","url":"https://api.github.com/users/rs3966","html_url":"https://github.com/rs3966","followers_url":"https://api.github.com/users/rs3966/followers","following_url":"https://api.github.com/users/rs3966/following{/other_user}","gists_url":"https://api.github.com/users/rs3966/gists{/gist_id}","starred_url":"https://api.github.com/users/rs3966/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rs3966/subscriptions","organizations_url":"https://api.github.com/users/rs3966/orgs","repos_url":"https://api.github.com/users/rs3966/repos","events_url":"https://api.github.com/users/rs3966/events{/privacy}","received_events_url":"https://api.github.com/users/rs3966/received_events","type":"User","site_admin":false},"labels":[{"id":4104374564,"node_id":"LA_kwDOB5BM6c70o8kk","url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/labels/reID","name":"reID","color":"EFBCB8","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false},"assignees":[{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false}],"milestone":null,"comments":38,"created_at":"2022-05-05T14:24:01Z","updated_at":"2022-08-15T21:42:39Z","closed_at":"2022-05-10T10:52:27Z","author_association":"NONE","active_lock_reason":null,"body":"### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Bug description\n\ndeeplabcut.transformer_reID(config, videos_to_analyze, n_tracks=None, videotype=\"mp4\") throws a ValueError\r\n\r\n(ValueError: not enough values to unpack (expected 2, got 0))\n\n### Operating System\n\nWindows 10\n\n### DeepLabCut version\n\ndlc version = 2.2.1\n\n### DeepLabCut mode\n\nmulti animal\n\n### Device type\n\nGPU: NVIDIA Quadro P5000\n\n### Steps To Reproduce\n\nconfig = 'Z:\\\\Deeplabcut\\\\tubeTest7-Rai-2022-05-04\\\\config.yaml'\r\nvideo = [\"Z:\\\\Deeplabcut\\\\Videos\\\\20220330-AvD_cropped.avi\"]\r\ndeeplabcut.analyze_videos(config, video, videotype='avi', auto_track = True) \r\n\r\n(This generated the following files:\r\n![image](https://user-images.githubusercontent.com/88156138/166943290-1fa8a5b5-e82d-4c41-a77c-49606fcc1176.png))\r\n\r\ndeeplabcut.transformer_reID(config, video, n_tracks=None, videotype='avi')\n\n### Relevant log output\n\n```shell\nIn [28]: deeplabcut.transformer_reID(config, video, n_tracks=None, videotype='avi')\r\nUsing snapshot-140000 for model Z:\\Deeplabcut\\tubeTest7-Rai-2022-05-04\\dlc-models\\iteration-1\\tubeTest7May4-trainset95shuffle1\r\nC:\\Users\\rajya\\Anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\tensorflow\\python\\keras\\engine\\base_layer_v1.py:1694: UserWarning: `layer.apply` is deprecated and will be removed in a future version. Please use `layer.__call__` method instead.\r\n  warnings.warn('`layer.apply` is deprecated and '\r\nActivating extracting of PAFs\r\n2022-05-05 10:18:27.185657: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 14789 MB memory:  -> device: 0, name: Quadro P5000, pci bus id: 0000:73:00.0, compute capability: 6.1\r\nStarting to analyze %  Z:\\Deeplabcut\\Videos\\20220330-AvD_cropped.avi\r\nLoading  Z:\\Deeplabcut\\Videos\\20220330-AvD_cropped.avi\r\nDuration of video [s]:  92.9 , recorded with  30.0 fps!\r\nOverall # of frames:  2787  found with (before cropping) frame dimensions:  1092 253\r\nStarting to extract posture\r\n  0%|                                                                                                                                                                   | 0/2787 [00:00<?, ?it/s]---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\nInput In [28], in <cell line: 1>()\r\n----> 1 deeplabcut.transformer_reID(config, video, n_tracks=None, videotype='avi')\r\n\r\nFile ~\\Anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\deeplabcut\\pose_tracking_pytorch\\apis.py:96, in transformer_reID(config, videos, videotype, shuffle, trainingsetindex, track_method, n_tracks, n_triplets, train_epochs, train_frac, modelprefix)\r\n     87 cfg = auxiliaryfunctions.read_config(config)\r\n     89 DLCscorer, _ = deeplabcut.utils.auxiliaryfunctions.GetScorerName(\r\n     90     cfg,\r\n     91     shuffle=shuffle,\r\n     92     trainFraction=cfg[\"TrainingFraction\"][trainingsetindex],\r\n     93     modelprefix=modelprefix,\r\n     94 )\r\n---> 96 deeplabcut.pose_estimation_tensorflow.create_tracking_dataset(\r\n     97     config,\r\n     98     videos,\r\n     99     track_method,\r\n    100     videotype=videotype,\r\n    101     shuffle=shuffle,\r\n    102     trainingsetindex=trainingsetindex,\r\n    103     modelprefix=modelprefix,\r\n    104     n_triplets=n_triplets,\r\n    105 )\r\n    107 (\r\n    108     trainposeconfigfile,\r\n    109     testposeconfigfile,\r\n   (...)\r\n    115     trainingsetindex=trainingsetindex,\r\n    116 )\r\n    118 deeplabcut.pose_tracking_pytorch.train_tracking_transformer(\r\n    119     config,\r\n    120     DLCscorer,\r\n   (...)\r\n    126     ckpt_folder=snapshotfolder,\r\n    127 )\r\n\r\nFile ~\\Anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\predict_videos.py:220, in create_tracking_dataset(config, videos, track_method, videotype, shuffle, trainingsetindex, gputouse, save_as_csv, destfolder, batchsize, cropping, TFGPUinference, dynamic, modelprefix, robust_nframes, n_triplets)\r\n    218 if \"multi-animal\" in dlc_cfg[\"dataset_type\"]:\r\n    219     for video in Videos:\r\n--> 220         extract_bpt_feature_from_video(\r\n    221             video,\r\n    222             DLCscorer,\r\n    223             trainFraction,\r\n    224             cfg,\r\n    225             dlc_cfg,\r\n    226             sess,\r\n    227             inputs,\r\n    228             outputs,\r\n    229             extra_dict,\r\n    230             destfolder=destfolder,\r\n    231             robust_nframes=robust_nframes,\r\n    232         )\r\n    234     # should close tensorflow session here in order to free gpu\r\n    235     sess.close()\r\n\r\nFile ~\\Anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\predict_multianimal.py:88, in extract_bpt_feature_from_video(video, DLCscorer, trainFraction, cfg, dlc_cfg, sess, inputs, outputs, extra_dict, destfolder, robust_nframes)\r\n     85 print(\"Starting to extract posture\")\r\n     86 if int(dlc_cfg[\"batch_size\"]) > 1:\r\n     87     # for multi animal, seems only this is used\r\n---> 88     PredicteData, nframes = GetPoseandCostsF_from_assemblies(\r\n     89         cfg,\r\n     90         dlc_cfg,\r\n     91         sess,\r\n     92         inputs,\r\n     93         outputs,\r\n     94         vid,\r\n     95         nframes,\r\n     96         int(dlc_cfg[\"batch_size\"]),\r\n     97         assemblies,\r\n     98         feature_dict,\r\n     99         extra_dict,\r\n    100     )\r\n    101 else:\r\n    102     raise NotImplementedError(\"Not implemented yet, please raise an GitHub issue if you need this.\")\r\n\r\nFile ~\\Anaconda3\\envs\\DEEPLABCUT\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\predict_multianimal.py:286, in GetPoseandCostsF_from_assemblies(cfg, dlc_cfg, sess, inputs, outputs, cap, nframes, batchsize, assemblies, feature_dict, extra_dict)\r\n    282 inds.append(counter)\r\n    284 if batch_ind == batchsize - 1:\r\n--> 286     (D, features) = predict.predict_batched_peaks_and_costs(\r\n    287         dlc_cfg, frames, sess, inputs, outputs, extra_dict=extra_dict\r\n    288     )\r\n    290     for i, (ind, data) in enumerate(zip(inds, D)):\r\n    291         PredicteData[\"frame\" + str(ind).zfill(strwidth)] = data\r\n\r\nValueError: not enough values to unpack (expected 2, got 0)\n```\n\n\n### Anything else?\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/DeepLabCut/DeepLabCut/blob/master/CODE_OF_CONDUCT.md)","closed_by":{"login":"MMathisLab","id":28102185,"node_id":"MDQ6VXNlcjI4MTAyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/28102185?v=4","gravatar_id":"","url":"https://api.github.com/users/MMathisLab","html_url":"https://github.com/MMathisLab","followers_url":"https://api.github.com/users/MMathisLab/followers","following_url":"https://api.github.com/users/MMathisLab/following{/other_user}","gists_url":"https://api.github.com/users/MMathisLab/gists{/gist_id}","starred_url":"https://api.github.com/users/MMathisLab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MMathisLab/subscriptions","organizations_url":"https://api.github.com/users/MMathisLab/orgs","repos_url":"https://api.github.com/users/MMathisLab/repos","events_url":"https://api.github.com/users/MMathisLab/events{/privacy}","received_events_url":"https://api.github.com/users/MMathisLab/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1821/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1821/timeline","performed_via_github_app":null,"state_reason":"completed"}