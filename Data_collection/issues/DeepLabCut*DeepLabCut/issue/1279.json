{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1279","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1279/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1279/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1279/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/1279","id":903878653,"node_id":"MDU6SXNzdWU5MDM4Nzg2NTM=","number":1279,"title":"Corruption of Month in config.yaml in Japanese Windows environment","user":{"login":"bobfromjapan","id":65654614,"node_id":"MDQ6VXNlcjY1NjU0NjE0","avatar_url":"https://avatars.githubusercontent.com/u/65654614?v=4","gravatar_id":"","url":"https://api.github.com/users/bobfromjapan","html_url":"https://github.com/bobfromjapan","followers_url":"https://api.github.com/users/bobfromjapan/followers","following_url":"https://api.github.com/users/bobfromjapan/following{/other_user}","gists_url":"https://api.github.com/users/bobfromjapan/gists{/gist_id}","starred_url":"https://api.github.com/users/bobfromjapan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bobfromjapan/subscriptions","organizations_url":"https://api.github.com/users/bobfromjapan/orgs","repos_url":"https://api.github.com/users/bobfromjapan/repos","events_url":"https://api.github.com/users/bobfromjapan/events{/privacy}","received_events_url":"https://api.github.com/users/bobfromjapan/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"AlexEMG","id":20850270,"node_id":"MDQ6VXNlcjIwODUwMjcw","avatar_url":"https://avatars.githubusercontent.com/u/20850270?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexEMG","html_url":"https://github.com/AlexEMG","followers_url":"https://api.github.com/users/AlexEMG/followers","following_url":"https://api.github.com/users/AlexEMG/following{/other_user}","gists_url":"https://api.github.com/users/AlexEMG/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexEMG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexEMG/subscriptions","organizations_url":"https://api.github.com/users/AlexEMG/orgs","repos_url":"https://api.github.com/users/AlexEMG/repos","events_url":"https://api.github.com/users/AlexEMG/events{/privacy}","received_events_url":"https://api.github.com/users/AlexEMG/received_events","type":"User","site_admin":false},"assignees":[{"login":"AlexEMG","id":20850270,"node_id":"MDQ6VXNlcjIwODUwMjcw","avatar_url":"https://avatars.githubusercontent.com/u/20850270?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexEMG","html_url":"https://github.com/AlexEMG","followers_url":"https://api.github.com/users/AlexEMG/followers","following_url":"https://api.github.com/users/AlexEMG/following{/other_user}","gists_url":"https://api.github.com/users/AlexEMG/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexEMG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexEMG/subscriptions","organizations_url":"https://api.github.com/users/AlexEMG/orgs","repos_url":"https://api.github.com/users/AlexEMG/repos","events_url":"https://api.github.com/users/AlexEMG/events{/privacy}","received_events_url":"https://api.github.com/users/AlexEMG/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2021-05-27T14:54:55Z","updated_at":"2021-06-01T15:49:43Z","closed_at":"2021-06-01T15:49:43Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Is your feature request related to a problem? Please describe.**\r\n\r\nIn Japanese windows system, when I create a new project, the month in `config.yaml` is garbled.\r\n\r\n```config.yaml\r\nTask: aa\r\nscorer: aa\r\ndate: 5��27     # this is corrupted `5月`, May in japanese \r\nmultianimalproject: false\r\nidentity:\r\n```\r\n\r\nThis corruption often causes problems in other parts of the workflow. (For example, an error occurs when running `create_training_dataset`)\r\n\r\n<details><summary>TRACEBACK</summary><p>\r\n\r\n```python\r\n\r\nYou can now check the labels, using 'check_labels' before proceeding. Then, you can use the function 'create_training_dataset' to create the training dataset.\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\XXX\\miniconda3\\envs\\DLC-CPU\\lib\\site-packages\\deeplabcut\\gui\\create_training_dataset.py\", line 394, in create_training_dataset\r\n    augmenter_type=self.aug_choice.GetValue(),\r\n  File \"C:\\Users\\XXX\\miniconda3\\envs\\DLC-CPU\\lib\\site-packages\\deeplabcut\\generate_training_dataset\\trainingsetmanipulation.py\", line 894, in create_training_dataset\r\n    cfg, Path(os.path.join(project_path, trainingsetfolder)), windows2linux\r\n  File \"C:\\Users\\XXX\\miniconda3\\envs\\DLC-CPU\\lib\\site-packages\\deeplabcut\\generate_training_dataset\\trainingsetmanipulation.py\", line 646, in merge_annotateddatasets\r\n    AnnotationData.to_hdf(filename + \".h5\", key=\"df_with_missing\", mode=\"w\")\r\n  File \"C:\\Users\\XXX\\miniconda3\\envs\\DLC-CPU\\lib\\site-packages\\pandas\\core\\generic.py\", line 2621, in to_hdf\r\n    encoding=encoding,\r\n  File \"C:\\Users\\XXX\\miniconda3\\envs\\DLC-CPU\\lib\\site-packages\\pandas\\io\\pytables.py\", line 278, in to_hdf\r\n    path_or_buf, mode=mode, complevel=complevel, complib=complib\r\n  File \"C:\\Users\\XXX\\miniconda3\\envs\\DLC-CPU\\lib\\site-packages\\pandas\\io\\pytables.py\", line 561, in __init__\r\n    self.open(mode=mode, **kwargs)\r\n  File \"C:\\Users\\XXX\\miniconda3\\envs\\DLC-CPU\\lib\\site-packages\\pandas\\io\\pytables.py\", line 710, in open\r\n    self._handle = tables.open_file(self._path, self._mode, **kwargs)\r\n  File \"C:\\Users\\XXX\\miniconda3\\envs\\DLC-CPU\\lib\\site-packages\\tables\\file.py\", line 315, in open_file\r\n    return File(filename, mode, title, root_uep, filters, **kwargs)\r\n  File \"C:\\Users\\XXX\\miniconda3\\envs\\DLC-CPU\\lib\\site-packages\\tables\\file.py\", line 778, in __init__\r\n    self._g_new(filename, mode, **params)\r\n  File \"tables\\hdf5extension.pyx\", line 492, in tables.hdf5extension.File._g_new\r\ntables.exceptions.HDF5ExtError: HDF5 error back trace\r\n\r\n  File \"D:\\pytables_hdf5\\CMake-hdf5-1.10.5\\hdf5-1.10.5\\src\\H5F.c\", line 444, in H5Fcreate\r\n    unable to create file\r\n  File \"D:\\pytables_hdf5\\CMake-hdf5-1.10.5\\hdf5-1.10.5\\src\\H5Fint.c\", line 1509, in H5F_open\r\n    unable to open file: time = Thu May 27 22:26:18 2021\r\n, name = 'C:\\Users\\XXX\\aa-aa-2021-05-27\\training-datasets\\iteration-0\\UnaugmentedDataSet_aa5月27\\CollectedData_aa.h5', tent_flags = 13\r\n  File \"D:\\pytables_hdf5\\CMake-hdf5-1.10.5\\hdf5-1.10.5\\src\\H5FD.c\", line 734, in H5FD_open\r\n    open failed\r\n  File \"D:\\pytables_hdf5\\CMake-hdf5-1.10.5\\hdf5-1.10.5\\src\\H5FDsec2.c\", line 346, in H5FD_sec2_open\r\n    unable to open file: name = 'C:\\Users\\XXX\\aa-aa-2021-05-27\\training-datasets\\iteration-0\\UnaugmentedDataSet_aa5月27\\CollectedData_aa.h5', errno = -1, error message = 'Unknown error', flags = 13, o_flags = 302\r\n\r\nEnd of HDF5 error back trace\r\n\r\nUnable to open/create file 'C:\\Users\\XXX\\aa-aa-2021-05-27\\training-datasets\\iteration-0\\UnaugmentedDataSet_aa5月27\\CollectedData_aa.h5'\r\n\r\n```\r\n</p></details>\r\n\r\n**Describe the solution you'd like**\r\n\r\nIt is preferable to write in English (like `May27`), regardless of the language setting of the OS.\r\n\r\n**Describe alternatives you've considered**\r\n\r\nThe problem is not that serious and can be solved by manually modifying `config.yaml`. This is probably what most non-ASCII Windows users are doing.\r\n\r\nIt is not difficult to fix the problem manually, but it is a bit tedious. \r\nI have found that it can be fixed by setting the `locale` to 'en_US.UTF-8' before setting the date in `new.py`/`new_3d.py` .\r\n\r\n```python\r\n  from datetime import datetime as dt\r\n  from deeplabcut.utils import auxiliaryfunctions\r\n  \r\n  # added code\r\n  import locale\r\n  locale.setlocale(locale.LC_TIME, 'en_US.UTF-8')\r\n  # end\r\n\r\n  date = dt.today()\r\n  month = date.strftime(\"%B\")\r\n  day = date.day\r\n  d = str(month[0:3] + str(day))\r\n  date = dt.today().strftime(\"%Y-%m-%d\")\r\n```\r\n\r\n**Additional context**\r\n\r\nIn detail, it seems that this is caused by `InitLocale` being done when the `wx.App()` is executed in `gui/launch_script.py`.\r\n\r\nhttps://wxpython.org/Phoenix/docs/html/wx.App.html\r\n\r\n>InitLocale(self)\r\n>Starting with version 3.8 on Windows, Python is now setting the locale to what is defined by the system as the default locale. This causes problems with wxWidgets which expects to be able to manage the locale via the wx.Locale class, so the locale will be reset here to be the default “C” locale settings.\r\n>If you have troubles from the default behavior of this method you can override it in a derived class to behave differently. Please report the problem you encountered.\r\n\r\n<details><summary>demo: locale change by wx.App()</summary><p>\r\n\r\n```python\r\n(DLC-CPU) C:\\Users\\XXX>python\r\nPython 3.7.10 | packaged by conda-forge | (default, Feb 19 2021, 15:37:01) [MSC v.1916 64 bit (AMD64)] on win32\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import wx\r\n>>> import locale\r\n>>> import datetime\r\n>>> locale.getlocale(locale.LC_TIME)\r\n(None, None)\r\n>>> datetime.datetime.today().strftime(\"%B\")\r\n'May'\r\n>>> wx.App()\r\n<wx.core.App object at 0x0000021391058048>\r\n>>> locale.getlocale(locale.LC_TIME)\r\n('Japanese_Japan', '932')                                      # THIS IS CAUSE OF PROBLEM!!!\r\n>>> datetime.datetime.today().strftime(\"%B\")\r\n'5月'\r\n>>> locale.setlocale(locale.LC_TIME, 'en_US.UTF-8')\r\n'en_US.UTF-8'\r\n>>> locale.getlocale(locale.LC_TIME)\r\n('en_US', 'UTF-8')\r\n>>> datetime.datetime.today().strftime(\"%B\")\r\n'May'                                                             # Fixed!\r\n```\r\n\r\n</p></details>\r\n\r\nSince this is a very environment-dependent issue and the scope of the impact of this change is unclear, I think that if there is any problem, the above fix should not be done. \r\nAgain, it's not that hard to fix `config.yaml` manually :)\r\n\r\nI'd appreciate it if you could give me your opinion. Thanks!","closed_by":{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1279/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1279/timeline","performed_via_github_app":null,"state_reason":"completed"}