{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1624","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1624/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1624/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1624/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/1624","id":1089139490,"node_id":"I_kwDOB5BM6c5A6vMi","number":1624,"title":"Undistortion error during triangulation","user":{"login":"guatomallin","id":61807146,"node_id":"MDQ6VXNlcjYxODA3MTQ2","avatar_url":"https://avatars.githubusercontent.com/u/61807146?v=4","gravatar_id":"","url":"https://api.github.com/users/guatomallin","html_url":"https://github.com/guatomallin","followers_url":"https://api.github.com/users/guatomallin/followers","following_url":"https://api.github.com/users/guatomallin/following{/other_user}","gists_url":"https://api.github.com/users/guatomallin/gists{/gist_id}","starred_url":"https://api.github.com/users/guatomallin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guatomallin/subscriptions","organizations_url":"https://api.github.com/users/guatomallin/orgs","repos_url":"https://api.github.com/users/guatomallin/repos","events_url":"https://api.github.com/users/guatomallin/events{/privacy}","received_events_url":"https://api.github.com/users/guatomallin/received_events","type":"User","site_admin":false},"labels":[{"id":1313079487,"node_id":"MDU6TGFiZWwxMzEzMDc5NDg3","url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/labels/howtousedlc","name":"howtousedlc","color":"a1b3f4","default":false,"description":"issue regarding the use of DeepLabCut"}],"state":"closed","locked":false,"assignee":{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false},"assignees":[{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false}],"milestone":null,"comments":9,"created_at":"2021-12-27T10:26:11Z","updated_at":"2022-04-08T13:49:35Z","closed_at":"2022-04-08T13:49:35Z","author_association":"NONE","active_lock_reason":null,"body":"### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Bug description\n\nUndistortion fails after 2D analysis of videos during triangulation steps. \n\n### Operating System\n\nWindows 10 \n\n### DeepLabCut version\n\n2.0.7\n\n### DeepLabCut mode\n\n3d\n\n### Device type\n\ngpu\n\n### Steps To Reproduce\n\n_No response_\n\n### Relevant log output\n\n```shell\nUndistorting...\r\n0it [00:00, ?it/s]\r\n---------------------------------------------------------------------------\r\nKeyError                                  Traceback (most recent call last)\r\nc:\\users\\lab\\.conda\\envs\\dlc-windowsgpu\\lib\\site-packages\\pandas\\core\\indexes\\base.py in get_loc(self, key, method, tolerance)\r\n   2521             try:\r\n-> 2522                 return self._engine.get_loc(key)\r\n   2523             except KeyError:\r\n\r\npandas\\_libs\\index.pyx in pandas._libs.index.IndexEngine.get_loc()\r\n\r\npandas\\_libs\\index.pyx in pandas._libs.index.IndexEngine.get_loc()\r\n\r\npandas\\_libs\\hashtable_class_helper.pxi in pandas._libs.hashtable.PyObjectHashTable.get_item()\r\n\r\npandas\\_libs\\hashtable_class_helper.pxi in pandas._libs.hashtable.PyObjectHashTable.get_item()\r\n\r\nKeyError: 'DeepCut_resnet50_r&d_cam3_2DJul19shuffle1_200000'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nKeyError                                  Traceback (most recent call last)\r\n<ipython-input-4-37f1dc5997b0> in <module>()\r\n----> 1 deeplabcut.triangulate(r'C:\\Users\\lab\\CP_DLC_working_directory\\RD_2CAM-CP-2021-12-26-3d\\config.yaml',r\"C:\\Users\\lab\\Desktop\\Video Processing\\new videos\",videotype=\".mp4\", filterpredictions=True)\r\n\r\nc:\\users\\lab\\.conda\\envs\\dlc-windowsgpu\\lib\\site-packages\\deeplabcut\\pose_estimation_3d\\triangulation.py in triangulate(config, video_path, videotype, filterpredictions, filtertype, gputouse, destfolder, save_as_csv)\r\n    136             #undistort points for this pair\r\n    137             print(\"Undistorting...\")\r\n--> 138             dataFrame_camera1_undistort,dataFrame_camera2_undistort,stereomatrix,path_stereo_file = undistort_points(config,dataname,str(cam_names[0]+'-'+cam_names[1]),destfolder)\r\n    139             if len(dataFrame_camera1_undistort) != len(dataFrame_camera2_undistort):\r\n    140                 raise Exception(\"The number of frames do not match in the two videos. Please make sure that your videos have same number of frames and then retry!\")\r\n\r\nc:\\users\\lab\\.conda\\envs\\dlc-windowsgpu\\lib\\site-packages\\deeplabcut\\pose_estimation_3d\\triangulation.py in undistort_points(config, dataframe, camera_pair, destfolder)\r\n    268\r\n    269             # Undistorting the points from cam2 camera\r\n--> 270             points_cam2 = np.array([dataframe_cam2[scorer_cam2][bp]['x'].values[:],dataframe_cam2[scorer_cam2][bp]['y'].values[:]])\r\n    271             points_cam2 = points_cam2.T\r\n    272             points_cam2 = np.expand_dims(points_cam2, axis=1)\r\n\r\nc:\\users\\lab\\.conda\\envs\\dlc-windowsgpu\\lib\\site-packages\\pandas\\core\\frame.py in __getitem__(self, key)\r\n   2135             return self._getitem_frame(key)\r\n   2136         elif is_mi_columns:\r\n-> 2137             return self._getitem_multilevel(key)\r\n   2138         else:\r\n   2139             return self._getitem_column(key)\r\n\r\nc:\\users\\lab\\.conda\\envs\\dlc-windowsgpu\\lib\\site-packages\\pandas\\core\\frame.py in _getitem_multilevel(self, key)\r\n   2179\r\n   2180     def _getitem_multilevel(self, key):\r\n-> 2181         loc = self.columns.get_loc(key)\r\n   2182         if isinstance(loc, (slice, Series, np.ndarray, Index)):\r\n   2183             new_columns = self.columns[loc]\r\n\r\nc:\\users\\lab\\.conda\\envs\\dlc-windowsgpu\\lib\\site-packages\\pandas\\core\\indexes\\multi.py in get_loc(self, key, method)\r\n   2069\r\n   2070         if not isinstance(key, tuple):\r\n-> 2071             loc = self._get_level_indexer(key, level=0)\r\n   2072             return _maybe_to_slice(loc)\r\n   2073\r\n\r\nc:\\users\\lab\\.conda\\envs\\dlc-windowsgpu\\lib\\site-packages\\pandas\\core\\indexes\\multi.py in _get_level_indexer(self, key, level, indexer)\r\n   2359         else:\r\n   2360\r\n-> 2361             loc = level_index.get_loc(key)\r\n   2362             if isinstance(loc, slice):\r\n   2363                 return loc\r\n\r\nc:\\users\\lab\\.conda\\envs\\dlc-windowsgpu\\lib\\site-packages\\pandas\\core\\indexes\\base.py in get_loc(self, key, method, tolerance)\r\n   2522                 return self._engine.get_loc(key)\r\n   2523             except KeyError:\r\n-> 2524                 return self._engine.get_loc(self._maybe_cast_indexer(key))\r\n   2525\r\n   2526         indexer = self.get_indexer([key], method=method, tolerance=tolerance)\r\n\r\npandas\\_libs\\index.pyx in pandas._libs.index.IndexEngine.get_loc()\r\n\r\npandas\\_libs\\index.pyx in pandas._libs.index.IndexEngine.get_loc()\r\n\r\npandas\\_libs\\hashtable_class_helper.pxi in pandas._libs.hashtable.PyObjectHashTable.get_item()\r\n\r\npandas\\_libs\\hashtable_class_helper.pxi in pandas._libs.hashtable.PyObjectHashTable.get_item()\r\n\r\nKeyError: 'DeepCut_resnet50_r&d_cam3_2DJul19shuffle1_200000'\n```\n\n\n### Anything else?\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/DeepLabCut/DeepLabCut/blob/master/CODE_OF_CONDUCT.md)","closed_by":{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1624/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1624/timeline","performed_via_github_app":null,"state_reason":"completed"}