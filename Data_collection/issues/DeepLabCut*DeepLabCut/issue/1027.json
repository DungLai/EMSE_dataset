{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1027","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1027/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1027/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1027/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/1027","id":759815064,"node_id":"MDU6SXNzdWU3NTk4MTUwNjQ=","number":1027,"title":"analyze_videos() failing for all but one job when run in parallel","user":{"login":"brettellebi","id":42971601,"node_id":"MDQ6VXNlcjQyOTcxNjAx","avatar_url":"https://avatars.githubusercontent.com/u/42971601?v=4","gravatar_id":"","url":"https://api.github.com/users/brettellebi","html_url":"https://github.com/brettellebi","followers_url":"https://api.github.com/users/brettellebi/followers","following_url":"https://api.github.com/users/brettellebi/following{/other_user}","gists_url":"https://api.github.com/users/brettellebi/gists{/gist_id}","starred_url":"https://api.github.com/users/brettellebi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brettellebi/subscriptions","organizations_url":"https://api.github.com/users/brettellebi/orgs","repos_url":"https://api.github.com/users/brettellebi/repos","events_url":"https://api.github.com/users/brettellebi/events{/privacy}","received_events_url":"https://api.github.com/users/brettellebi/received_events","type":"User","site_admin":false},"labels":[{"id":2225445655,"node_id":"MDU6TGFiZWwyMjI1NDQ1NjU1","url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/labels/issue%20with%20non-DLC%20code","name":"issue with non-DLC code","color":"aa25db","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-12-08T22:00:47Z","updated_at":"2020-12-09T17:14:24Z","closed_at":"2020-12-09T17:11:42Z","author_association":"NONE","active_lock_reason":null,"body":"**Operating system and DeepLabCut version**\r\n\r\n- OS: Red Hat Enterprise Linux Server release 7.4 (Maipo)\r\n- DeepLabCut Version: 2.2b8\r\n- Anaconda env used: DLC-CPU\r\n\r\n**Describe the problem**\r\n\r\nI'm trying to run `analyze_videos()` with a trained `maDLC` model on ~600 videos in parallel, using our institute's cluster with regular CPU nodes (which, although slow, is fine if I can run them all simulatenously).\r\n\r\nI'm using [Snakemake](https://snakemake.readthedocs.io/en/stable/index.html) to manage the pipeline with a simple python script for this step. Snakemake submits a separate job for each video, all to be run in parallel. \r\n\r\nHowever, only one video completes successfully. \r\n\r\nCode:\r\n\r\n<details><summary>Code output</summary><p>\r\n\r\n```python\r\n############# Snakemake rule\r\n\r\nrule analyse_videos:\r\n    input:\r\n        join(config[\"dlc_project_path\"], \"videos/{sample}_{quadrant}_{assay}.mp4\")\r\n    params:\r\n        dlc_project_path = config[\"dlc_project_path\"] # DLC config.yml path to feed into script\r\n    output:\r\n        join(config[\"dlc_project_path\"], \"videos/{sample}_{quadrant}_{assay}\") + config[\"dlc_scorer_name\"] + \"_full.pickle\"\r\n    conda:\r\n        config[\"dlc-cpu_env\"] # this is the DLC-CPU conda env\r\n    script:\r\n        config[\"dlc_analyze_script\"]\r\n\r\n############# Python script (config[\"dlc_analyze_script\"])\r\n\r\n#!/usr/bin/env python3\r\n\r\n# Import libaries\r\n\r\nimport os\r\nos.environ[\"DLClight\"]=\"True\" # suppress GUI\r\n\r\nimport deeplabcut\r\n\r\n# Setup project variables\r\n\r\nconfig_path = os.path.join(snakemake.params.dlc_project_path, 'config.yaml')\r\n\r\ntarget_video = snakemake.input[0]\r\n\r\n# Analyse video\r\n\r\ndeeplabcut.analyze_videos(config_path, target_video, videotype='mp4', save_as_csv=True)\r\n```\r\n</p></details>\r\n\r\n**How to Reproduce the problem**\r\nSteps to reproduce the behavior:\r\n1. Submit two or more separate jobs to a cluster to run the above python script simultaneously on different videos.\r\n2. One will complete successfully, the others will proceed normally but then fail (perhaps when the successful one completes?)\r\n\r\n**Screenshots**\r\nThis is the error log for one of the failed jobs. They were all neary complete when they failed:\r\n<img width=\"1045\" alt=\"Screenshot 2020-12-09 at 08 47 29\" src=\"https://user-images.githubusercontent.com/42971601/101546011-3b0a3a80-39fc-11eb-96a2-8443634be509.png\">\r\n\r\n","closed_by":{"login":"MMathisLab","id":28102185,"node_id":"MDQ6VXNlcjI4MTAyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/28102185?v=4","gravatar_id":"","url":"https://api.github.com/users/MMathisLab","html_url":"https://github.com/MMathisLab","followers_url":"https://api.github.com/users/MMathisLab/followers","following_url":"https://api.github.com/users/MMathisLab/following{/other_user}","gists_url":"https://api.github.com/users/MMathisLab/gists{/gist_id}","starred_url":"https://api.github.com/users/MMathisLab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MMathisLab/subscriptions","organizations_url":"https://api.github.com/users/MMathisLab/orgs","repos_url":"https://api.github.com/users/MMathisLab/repos","events_url":"https://api.github.com/users/MMathisLab/events{/privacy}","received_events_url":"https://api.github.com/users/MMathisLab/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1027/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1027/timeline","performed_via_github_app":null,"state_reason":"completed"}