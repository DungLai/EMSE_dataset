{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1244","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1244/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1244/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1244/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/1244","id":891786906,"node_id":"MDU6SXNzdWU4OTE3ODY5MDY=","number":1244,"title":"Problem when trying to analyze video after I re-trained the network","user":{"login":"pamelaosuna","id":33221741,"node_id":"MDQ6VXNlcjMzMjIxNzQx","avatar_url":"https://avatars.githubusercontent.com/u/33221741?v=4","gravatar_id":"","url":"https://api.github.com/users/pamelaosuna","html_url":"https://github.com/pamelaosuna","followers_url":"https://api.github.com/users/pamelaosuna/followers","following_url":"https://api.github.com/users/pamelaosuna/following{/other_user}","gists_url":"https://api.github.com/users/pamelaosuna/gists{/gist_id}","starred_url":"https://api.github.com/users/pamelaosuna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pamelaosuna/subscriptions","organizations_url":"https://api.github.com/users/pamelaosuna/orgs","repos_url":"https://api.github.com/users/pamelaosuna/repos","events_url":"https://api.github.com/users/pamelaosuna/events{/privacy}","received_events_url":"https://api.github.com/users/pamelaosuna/received_events","type":"User","site_admin":false},"labels":[{"id":1013047008,"node_id":"MDU6TGFiZWwxMDEzMDQ3MDA4","url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/labels/Feature-request","name":"Feature-request","color":"3cc9b1","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false},"assignees":[{"login":"jeylau","id":30733203,"node_id":"MDQ6VXNlcjMwNzMzMjAz","avatar_url":"https://avatars.githubusercontent.com/u/30733203?v=4","gravatar_id":"","url":"https://api.github.com/users/jeylau","html_url":"https://github.com/jeylau","followers_url":"https://api.github.com/users/jeylau/followers","following_url":"https://api.github.com/users/jeylau/following{/other_user}","gists_url":"https://api.github.com/users/jeylau/gists{/gist_id}","starred_url":"https://api.github.com/users/jeylau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeylau/subscriptions","organizations_url":"https://api.github.com/users/jeylau/orgs","repos_url":"https://api.github.com/users/jeylau/repos","events_url":"https://api.github.com/users/jeylau/events{/privacy}","received_events_url":"https://api.github.com/users/jeylau/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2021-05-14T09:56:04Z","updated_at":"2021-05-19T20:30:46Z","closed_at":"2021-05-19T20:30:46Z","author_association":"NONE","active_lock_reason":null,"body":"Operating System: Windows10\r\nAnconda environment:  DLC-GPU\r\nDLC version: 2.2rc1\r\nDLC project type: multi-animal\r\n\r\nI am trying to analyze a video with a network that I have just finished training. The initial weights that I set for the training (iteration-1) belong to a previous training (iteration-0). The first training was done for 200 000 its and the second for 300 000. I did this after adding new videos and extracting outlier frames, so I could improve the training dataset. The body parts and skeleton I used are the same that for the previous training. However, I get the following error:\r\n\r\n<details><summary>Code output</summary><p>\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1334, in _do_call\r\n    return fn(*args)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1319, in _run_fn\r\n    options, feed_dict, fetch_list, target_list, run_metadata)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1407, in _call_tf_sessionrun\r\n    run_metadata)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Assign requires shapes of both tensors to match. lhs shape= [3,3,90,2048] rhs shape= [3,3,52,2048]\r\n         [[{{node save/Assign_3}}]]\r\n         [[{{node save/RestoreV2}}]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 1276, in restore\r\n    {self.saver_def.filename_tensor_name: save_path})\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 929, in run\r\n    run_metadata_ptr)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1152, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1328, in _do_run\r\n    run_metadata)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1348, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Assign requires shapes of both tensors to match. lhs shape= [3,3,90,2048] rhs shape= [3,3,52,2048]\r\n         [[node save/Assign_3 (defined at C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\nnet\\predict.py:48) ]]\r\n         [[node save/RestoreV2 (defined at C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\nnet\\predict.py:48) ]]\r\n\r\nCaused by op 'save/Assign_3', defined at:\r\n  File \"run_video_analysis.py\", line 38, in <module>\r\n    scorername = dlc.analyze_videos(config_path, [video_path], save_as_csv=True, gputouse=gputouse)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\predict_videos.py\", line 273, in analyze_videos\r\n    sess, inputs, outputs = predict.setup_pose_prediction(dlc_cfg)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\nnet\\predict.py\", line 48, in setup_pose_prediction\r\n    restorer = TF.train.Saver()\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 832, in __init__\r\n    self.build()\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 844, in build\r\n    self._build(self._filename, build_save=True, build_restore=True)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 881, in _build\r\n    build_save=build_save, build_restore=build_restore)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 513, in _build_internal\r\n    restore_sequentially, reshape)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 354, in _AddRestoreOps\r\n    assign_ops.append(saveable.restore(saveable_tensors, shapes))\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\training\\saving\\saveable_object_util.py\", line 73, in restore\r\n    self.op.get_shape().is_fully_defined())\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\ops\\state_ops.py\", line 223, in assign\r\n    validate_shape=validate_shape)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\ops\\gen_state_ops.py\", line 64, in assign\r\n    use_locking=use_locking, name=name)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 788, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3300, in create_op\r\n    op_def=op_def)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1801, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\nInvalidArgumentError (see above for traceback): Assign requires shapes of both tensors to match. lhs shape= [3,3,90,2048] rhs shape= [3,3,52,2048]\r\n         [[node save/Assign_3 (defined at C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\nnet\\predict.py:48) ]]\r\n         [[node save/RestoreV2 (defined at C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\nnet\\predict.py:48) ]]\r\n\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"run_video_analysis.py\", line 38, in <module>\r\n    scorername = dlc.analyze_videos(config_path, [video_path], save_as_csv=True, gputouse=gputouse)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\predict_videos.py\", line 273, in analyze_videos\r\n    sess, inputs, outputs = predict.setup_pose_prediction(dlc_cfg)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\nnet\\predict.py\", line 54, in setup_pose_prediction\r\n    restorer.restore(sess, cfg[\"init_weights\"])\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 1312, in restore\r\n    err, \"a mismatch between the current graph and the graph\")\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Restoring from checkpoint failed. This is most likely due to a mismatch between the current graph and the graph from the checkpoint. Please ensure that you have not altered the graph expected based on the checkpoint. Original error:\r\n\r\nAssign requires shapes of both tensors to match. lhs shape= [3,3,90,2048] rhs shape= [3,3,52,2048]\r\n         [[node save/Assign_3 (defined at C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\nnet\\predict.py:48) ]]\r\n         [[node save/RestoreV2 (defined at C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\nnet\\predict.py:48) ]]\r\n\r\nCaused by op 'save/Assign_3', defined at:\r\n  File \"run_video_analysis.py\", line 38, in <module>\r\n    scorername = dlc.analyze_videos(config_path, [video_path], save_as_csv=True, gputouse=gputouse)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\predict_videos.py\", line 273, in analyze_videos\r\n    sess, inputs, outputs = predict.setup_pose_prediction(dlc_cfg)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\nnet\\predict.py\", line 48, in setup_pose_prediction\r\n    restorer = TF.train.Saver()\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 832, in __init__\r\n    self.build()\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 844, in build\r\n    self._build(self._filename, build_save=True, build_restore=True)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 881, in _build\r\n    build_save=build_save, build_restore=build_restore)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 513, in _build_internal\r\n    restore_sequentially, reshape)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 354, in _AddRestoreOps\r\n    assign_ops.append(saveable.restore(saveable_tensors, shapes))\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\training\\saving\\saveable_object_util.py\", line 73, in restore\r\n    self.op.get_shape().is_fully_defined())\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\ops\\state_ops.py\", line 223, in assign\r\n    validate_shape=validate_shape)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\ops\\gen_state_ops.py\", line 64, in assign\r\n    use_locking=use_locking, name=name)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 788, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3300, in create_op\r\n    op_def=op_def)\r\n  File \"C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1801, in __init__\r\n    self._traceback = tf_stack.extract_stack()\r\n\r\nInvalidArgumentError (see above for traceback): Restoring from checkpoint failed. This is most likely due to a mismatch between the current graph and the graph from the checkpoint. Please ensure that you have not altered the graph expected based on the checkpoint. Original error:\r\n\r\nAssign requires shapes of both tensors to match. lhs shape= [3,3,90,2048] rhs shape= [3,3,52,2048]\r\n         [[node save/Assign_3 (defined at C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\nnet\\predict.py:48) ]]\r\n         [[node save/RestoreV2 (defined at C:\\Users\\ana.osuna\\Anaconda3\\envs\\DLC-GPU\\lib\\site-packages\\deeplabcut\\pose_estimation_tensorflow\\nnet\\predict.py:48) ]]\r\n\r\n</p></details>\r\n\r\nSteps to reproduce the behavior:\r\ndeeplabcut.analyze_videos(config_path, [video_path], gputouse=gpu_num)\r\n\r\nI remember having a similar message before successfully started the second training. I thought that this was related to the parameter *partaffinityfield_graph* inside the pose_cfg.yaml file (from iteration-1), so what I did was a copy-paste only of this parameter from the pose_cfg.yaml old file (from iteration-0). Also, I changed the *num_libs* parameter as set for the older file. After that, I retried to do the training and it was done without a problem.\r\n\r\nWhat would you recommend?\r\n\r\nThank you in advance!","closed_by":{"login":"AlexEMG","id":20850270,"node_id":"MDQ6VXNlcjIwODUwMjcw","avatar_url":"https://avatars.githubusercontent.com/u/20850270?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexEMG","html_url":"https://github.com/AlexEMG","followers_url":"https://api.github.com/users/AlexEMG/followers","following_url":"https://api.github.com/users/AlexEMG/following{/other_user}","gists_url":"https://api.github.com/users/AlexEMG/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexEMG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexEMG/subscriptions","organizations_url":"https://api.github.com/users/AlexEMG/orgs","repos_url":"https://api.github.com/users/AlexEMG/repos","events_url":"https://api.github.com/users/AlexEMG/events{/privacy}","received_events_url":"https://api.github.com/users/AlexEMG/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1244/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/1244/timeline","performed_via_github_app":null,"state_reason":"completed"}