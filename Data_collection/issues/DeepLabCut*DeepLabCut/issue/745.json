{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/745","repository_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut","labels_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/745/labels{/name}","comments_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/745/comments","events_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/745/events","html_url":"https://github.com/DeepLabCut/DeepLabCut/issues/745","id":637949929,"node_id":"MDU6SXNzdWU2Mzc5NDk5Mjk=","number":745,"title":"GPU runs out of memory for 1024x1280 training","user":{"login":"catubc","id":4267452,"node_id":"MDQ6VXNlcjQyNjc0NTI=","avatar_url":"https://avatars.githubusercontent.com/u/4267452?v=4","gravatar_id":"","url":"https://api.github.com/users/catubc","html_url":"https://github.com/catubc","followers_url":"https://api.github.com/users/catubc/followers","following_url":"https://api.github.com/users/catubc/following{/other_user}","gists_url":"https://api.github.com/users/catubc/gists{/gist_id}","starred_url":"https://api.github.com/users/catubc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/catubc/subscriptions","organizations_url":"https://api.github.com/users/catubc/orgs","repos_url":"https://api.github.com/users/catubc/repos","events_url":"https://api.github.com/users/catubc/events{/privacy}","received_events_url":"https://api.github.com/users/catubc/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2020-06-12T19:05:27Z","updated_at":"2020-06-12T23:10:43Z","closed_at":"2020-06-12T19:13:16Z","author_association":"NONE","active_lock_reason":null,"body":"Hi\r\nSo I reported this already, but it seems that maDLC is running out of memory for my datasets.  \r\nOS: Ubuntu 18.04\r\nDLC Version: 2.2.6b (pulled today)\r\nGPU: Titan XP 12GB VRAM\r\nData: 25FPS .avi data\r\nImage sizes: 1024 x 1280\r\nNo. labeled frames: 5 or 50 labeled frames.  \r\nNo. animals: 4\r\nNo. features/animal:  16\r\n\r\nRunning DLC with 5 labeled frames seems to work.  But switching to 50 labeled frames causes a memory crash right at start up. \r\n\r\nWe'd prefer to train using a few hundred training frames, is this not possible?  Is there an option to limit batch sizes or otherwise train on smaller chunks of data?\r\n\r\nThanks for the help.\r\n\r\n\r\n```\r\n\r\n\r\nIn [2]: deeplabcut.launch_dlc()                                                                                                                                                                                                        \r\nnote to user: currently only ResNet50-v1 is available for maDLC\r\nnote to user: currently model comparison is not available in maDLC\r\nSelecting multi-animal trainer\r\nConfig:\r\n{'Task': None,\r\n 'TrainingFraction': None,\r\n 'all_joints': [[0],\r\n                [1],\r\n                [2],\r\n                [3],\r\n                [4],\r\n                [5],\r\n                [6],\r\n                [7],\r\n                [8],\r\n                [9],\r\n                [10],\r\n                [11],\r\n                [12],\r\n                [13]],\r\n 'all_joints_names': ['nose',\r\n                      'lefteye',\r\n                      'righteye',\r\n                      'leftear',\r\n                      'rightear',\r\n                      'spine1',\r\n                      'spine2',\r\n                      'spine3',\r\n                      'spine4',\r\n                      'spine5',\r\n                      'tail1',\r\n                      'tail2',\r\n                      'tail3',\r\n                      'tail4'],\r\n 'alphavalue': None,\r\n 'batch_size': 8,\r\n 'bodyparts': None,\r\n 'bottomheight': 400,\r\n 'colormap': None,\r\n 'corner2move2': None,\r\n 'crop': True,\r\n 'crop_pad': 0,\r\n 'croppedtraining': None,\r\n 'cropping': None,\r\n 'cropratio': 0.4,\r\n 'dataset': 'training-datasets/iteration-0/UnaugmentedDataSet_cat3Jun12/cat3_cat95shuffle1.pickle',\r\n 'dataset_type': 'multi-animal-imgaug',\r\n 'date': None,\r\n 'default_augmenter': None,\r\n 'default_net_type': None,\r\n 'deterministic': False,\r\n 'display_iters': 500,\r\n 'dotsize': None,\r\n 'fg_fraction': 0.25,\r\n 'global_scale': 0.8,\r\n 'init_weights': '/home/cat/Downloads/DeepLabCut/deeplabcut/pose_estimation_tensorflow/models/pretrained/resnet_v1_50.ckpt',\r\n 'intermediate_supervision': False,\r\n 'intermediate_supervision_layer': 12,\r\n 'iteration': None,\r\n 'leftwidth': 400,\r\n 'location_refinement': True,\r\n 'locref_huber_loss': True,\r\n 'locref_loss_weight': 0.05,\r\n 'locref_stdev': 7.2801,\r\n 'log_dir': 'log',\r\n 'max_input_size': 1500,\r\n 'mean_pixel': [123.68, 116.779, 103.939],\r\n 'metadataset': 'training-datasets/iteration-0/UnaugmentedDataSet_cat3Jun12/Documentation_data-cat3_95shuffle1.pickle',\r\n 'min_input_size': 64,\r\n 'minsize': 100,\r\n 'mirror': False,\r\n 'move2corner': None,\r\n 'multi_step': [[0.0001, 7500], [5e-05, 12000], [1e-05, 200000]],\r\n 'multianimalproject': None,\r\n 'net_type': 'resnet_50',\r\n 'num_joints': 14,\r\n 'num_limbs': 41,\r\n 'numframes2pick': None,\r\n 'optimizer': 'adam',\r\n 'pafwidth': 20,\r\n 'pairwise_huber_loss': False,\r\n 'pairwise_loss_weight': 0.1,\r\n 'pairwise_predict': False,\r\n 'partaffinityfield_graph': [[4, 7],\r\n                             [1, 3],\r\n                             [10, 11],\r\n                             [4, 8],\r\n                             [5, 6],\r\n                             [0, 2],\r\n                             [0, 7],\r\n                             [8, 9],\r\n                             [1, 6],\r\n                             [7, 11],\r\n                             [3, 7],\r\n                             [0, 3],\r\n                             [1, 2],\r\n                             [6, 7],\r\n                             [4, 9],\r\n                             [2, 9],\r\n                             [12, 13],\r\n                             [8, 10],\r\n                             [10, 12],\r\n                             [1, 5],\r\n                             [3, 6],\r\n                             [0, 4],\r\n                             [4, 10],\r\n                             [2, 6],\r\n                             [4, 5],\r\n                             [8, 11],\r\n                             [1, 4],\r\n                             [9, 10],\r\n                             [0, 5],\r\n                             [2, 3],\r\n                             [11, 12],\r\n                             [3, 5],\r\n                             [0, 1],\r\n                             [7, 8],\r\n                             [4, 6],\r\n                             [8, 12],\r\n                             [3, 8],\r\n                             [1, 8],\r\n                             [1, 7],\r\n                             [3, 4],\r\n                             [2, 4]],\r\n 'partaffinityfield_predict': True,\r\n 'pcutoff': None,\r\n 'pos_dist_thresh': 17,\r\n 'project_path': '/media/cat/14TB/insync_cm5636/march_2/video/dlc_2.26b_results/cat3-cat-2020-06-12',\r\n 'regularize': False,\r\n 'rightwidth': 400,\r\n 'save_iters': 10000,\r\n 'scale_jitter_lo': 0.5,\r\n 'scale_jitter_up': 1.25,\r\n 'scoremap_dir': 'test',\r\n 'scorer': None,\r\n 'shuffle': True,\r\n 'skeleton': [],\r\n 'skeleton_color': 'black',\r\n 'snapshot_prefix': '/media/cat/14TB/insync_cm5636/march_2/video/dlc_2.26b_results/cat3-cat-2020-06-12/dlc-models/iteration-0/cat3Jun12-trainset95shuffle1/train/snapshot',\r\n 'snapshotindex': None,\r\n 'start': None,\r\n 'stop': None,\r\n 'stride': 8.0,\r\n 'topheight': 400,\r\n 'video_sets': None,\r\n 'weigh_negatives': False,\r\n 'weigh_only_present_joints': False,\r\n 'weigh_part_predictions': False,\r\n 'weight_decay': 0.0001,\r\n 'x1': None,\r\n 'x2': None,\r\n 'y1': None,\r\n 'y2': None}\r\nActivating limb prediction...\r\nStarting with multi-animal imaug + adam pose-dataset loader.\r\nBatch Size is 8\r\nGetting specs multi-animal-imgaug 41 14\r\nInitializing ResNet\r\nLoading ImageNet-pretrained resnet_50\r\n2020-06-12 14:57:09.150142: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX\r\n2020-06-12 14:57:09.176095: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 3391715000 Hz\r\n2020-06-12 14:57:09.178592: I tensorflow/compiler/xla/service/service.cc:150] XLA service 0x559acaf725d0 executing computations on platform Host. Devices:\r\n2020-06-12 14:57:09.178633: I tensorflow/compiler/xla/service/service.cc:158]   StreamExecutor device (0): <undefined>, <undefined>\r\n2020-06-12 14:57:09.400334: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1433] Found device 0 with properties: \r\nname: TITAN Xp major: 6 minor: 1 memoryClockRate(GHz): 1.582\r\npciBusID: 0000:03:00.0\r\ntotalMemory: 11.91GiB freeMemory: 11.16GiB\r\n2020-06-12 14:57:09.400377: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1512] Adding visible gpu devices: 0\r\n2020-06-12 14:57:09.401094: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] Device interconnect StreamExecutor with strength 1 edge matrix:\r\n2020-06-12 14:57:09.401111: I tensorflow/core/common_runtime/gpu/gpu_device.cc:990]      0 \r\n2020-06-12 14:57:09.401120: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1003] 0:   N \r\n2020-06-12 14:57:09.401382: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 10855 MB memory) -> physical GPU (device: 0, name: TITAN Xp, pci bus id: 0000:03:00.0, compute capability: 6.1)\r\n2020-06-12 14:57:09.403175: I tensorflow/compiler/xla/service/service.cc:150] XLA service 0x559aca560e40 executing computations on platform CUDA. Devices:\r\n2020-06-12 14:57:09.403195: I tensorflow/compiler/xla/service/service.cc:158]   StreamExecutor device (0): TITAN Xp, Compute Capability 6.1\r\nMax_iters overwritten as 2500\r\nDisplay_iters overwritten as 10\r\nSave_iters overwritten as 50\r\nTraining parameters:\r\n{'stride': 8.0, 'weigh_part_predictions': False, 'weigh_negatives': False, 'fg_fraction': 0.25, 'mean_pixel': [123.68, 116.779, 103.939], 'shuffle': True, 'snapshot_prefix': '/media/cat/14TB/insync_cm5636/march_2/video/dlc_2.26b_results/cat3-cat-2020-06-12/dlc-models/iteration-0/cat3Jun12-trainset95shuffle1/train/snapshot', 'log_dir': 'log', 'global_scale': 0.8, 'location_refinement': True, 'locref_stdev': 7.2801, 'locref_loss_weight': 0.05, 'locref_huber_loss': True, 'optimizer': 'adam', 'intermediate_supervision': False, 'intermediate_supervision_layer': 12, 'regularize': False, 'weight_decay': 0.0001, 'mirror': False, 'crop_pad': 0, 'scoremap_dir': 'test', 'batch_size': 8, 'dataset_type': 'multi-animal-imgaug', 'deterministic': False, 'weigh_only_present_joints': False, 'pairwise_huber_loss': False, 'partaffinityfield_predict': True, 'pairwise_predict': True, 'crop': True, 'cropratio': 0.4, 'minsize': 100, 'leftwidth': 400, 'rightwidth': 400, 'topheight': 400, 'bottomheight': 400, 'Task': None, 'TrainingFraction': None, 'all_joints': [[0], [1], [2], [3], [4], [5], [6], [7], [8], [9], [10], [11], [12], [13]], 'all_joints_names': ['nose', 'lefteye', 'righteye', 'leftear', 'rightear', 'spine1', 'spine2', 'spine3', 'spine4', 'spine5', 'tail1', 'tail2', 'tail3', 'tail4'], 'alphavalue': None, 'bodyparts': None, 'colormap': None, 'corner2move2': None, 'croppedtraining': None, 'cropping': None, 'dataset': 'training-datasets/iteration-0/UnaugmentedDataSet_cat3Jun12/cat3_cat95shuffle1.pickle', 'date': None, 'default_augmenter': None, 'default_net_type': None, 'display_iters': 500, 'dotsize': None, 'init_weights': '/home/cat/Downloads/DeepLabCut/deeplabcut/pose_estimation_tensorflow/models/pretrained/resnet_v1_50.ckpt', 'iteration': None, 'max_input_size': 1500, 'metadataset': 'training-datasets/iteration-0/UnaugmentedDataSet_cat3Jun12/Documentation_data-cat3_95shuffle1.pickle', 'min_input_size': 64, 'move2corner': None, 'multi_step': [[0.0001, 7500], [5e-05, 12000], [1e-05, 200000]], 'multianimalproject': None, 'net_type': 'resnet_50', 'num_joints': 14, 'num_limbs': 41, 'numframes2pick': None, 'pafwidth': 20, 'pairwise_loss_weight': 0.1, 'partaffinityfield_graph': [[4, 7], [1, 3], [10, 11], [4, 8], [5, 6], [0, 2], [0, 7], [8, 9], [1, 6], [7, 11], [3, 7], [0, 3], [1, 2], [6, 7], [4, 9], [2, 9], [12, 13], [8, 10], [10, 12], [1, 5], [3, 6], [0, 4], [4, 10], [2, 6], [4, 5], [8, 11], [1, 4], [9, 10], [0, 5], [2, 3], [11, 12], [3, 5], [0, 1], [7, 8], [4, 6], [8, 12], [3, 8], [1, 8], [1, 7], [3, 4], [2, 4]], 'pcutoff': None, 'pos_dist_thresh': 17, 'project_path': '/media/cat/14TB/insync_cm5636/march_2/video/dlc_2.26b_results/cat3-cat-2020-06-12', 'save_iters': 10000, 'scale_jitter_lo': 0.5, 'scale_jitter_up': 1.25, 'scorer': None, 'skeleton': [], 'skeleton_color': 'black', 'snapshotindex': None, 'start': None, 'stop': None, 'video_sets': None, 'x1': None, 'x2': None, 'y1': None, 'y2': None}\r\nStarting multi-animal training....\r\n2020-06-12 14:57:29.787683: W tensorflow/core/common_runtime/bfc_allocator.cc:267] Allocator (GPU_0_bfc) ran out of memory trying to allocate 1.0KiB.  Current allocation summary follows.\r\n2020-06-12 14:57:29.787835: I tensorflow/core/common_runtime/bfc_allocator.cc:597] Bin (256): \tTotal Chunks: 199, Chunks in use: 199. 49.8KiB allocated for chunks. 49.8KiB in use in bin. 23.8KiB client-requested in use in bin.\r\n\r\n```","closed_by":{"login":"MMathisLab","id":28102185,"node_id":"MDQ6VXNlcjI4MTAyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/28102185?v=4","gravatar_id":"","url":"https://api.github.com/users/MMathisLab","html_url":"https://github.com/MMathisLab","followers_url":"https://api.github.com/users/MMathisLab/followers","following_url":"https://api.github.com/users/MMathisLab/following{/other_user}","gists_url":"https://api.github.com/users/MMathisLab/gists{/gist_id}","starred_url":"https://api.github.com/users/MMathisLab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MMathisLab/subscriptions","organizations_url":"https://api.github.com/users/MMathisLab/orgs","repos_url":"https://api.github.com/users/MMathisLab/repos","events_url":"https://api.github.com/users/MMathisLab/events{/privacy}","received_events_url":"https://api.github.com/users/MMathisLab/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/745/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/DeepLabCut/DeepLabCut/issues/745/timeline","performed_via_github_app":null,"state_reason":"completed"}