{"url":"https://api.github.com/repos/msamogh/nonechucks/issues/4","repository_url":"https://api.github.com/repos/msamogh/nonechucks","labels_url":"https://api.github.com/repos/msamogh/nonechucks/issues/4/labels{/name}","comments_url":"https://api.github.com/repos/msamogh/nonechucks/issues/4/comments","events_url":"https://api.github.com/repos/msamogh/nonechucks/issues/4/events","html_url":"https://github.com/msamogh/nonechucks/issues/4","id":402103480,"node_id":"MDU6SXNzdWU0MDIxMDM0ODA=","number":4,"title":"SafeDataset cann't wrapper different dataset","user":{"login":"eejackliu","id":5990565,"node_id":"MDQ6VXNlcjU5OTA1NjU=","avatar_url":"https://avatars.githubusercontent.com/u/5990565?v=4","gravatar_id":"","url":"https://api.github.com/users/eejackliu","html_url":"https://github.com/eejackliu","followers_url":"https://api.github.com/users/eejackliu/followers","following_url":"https://api.github.com/users/eejackliu/following{/other_user}","gists_url":"https://api.github.com/users/eejackliu/gists{/gist_id}","starred_url":"https://api.github.com/users/eejackliu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eejackliu/subscriptions","organizations_url":"https://api.github.com/users/eejackliu/orgs","repos_url":"https://api.github.com/users/eejackliu/repos","events_url":"https://api.github.com/users/eejackliu/events{/privacy}","received_events_url":"https://api.github.com/users/eejackliu/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2019-01-23T07:21:34Z","updated_at":"2019-02-06T02:57:14Z","closed_at":"2019-02-06T02:57:13Z","author_association":"NONE","active_lock_reason":null,"body":"```python\r\ntrainset_ = my_data((140,224),transform=image_transform)\r\ntestset_ = my_data((140,224),image_set='val',transform=image_transform)\r\n\r\ntrainset = nc.SafeDataset(trainset_)\r\ntestset = nc.SafeDataset(testset_)\r\n```\r\n\r\nBefore executing `trainset=nc.SafeDataset(trainset_)`, I try to plot the first image in test by `(plt.imshow(testset_[0][0].permute(1,2,0))`, so I got the first image in valset which is right. After execute `trainset=nc.SafeDataset(trainset_)` , the `(plt.imshow(testset_[0][0].permute(1,2,0))` shows me the first image in trainset which is wrong. I tried to check the image path in testset object, it'  still the the path of first image in valset. Could you give me some suggestion to solve this problem? \r\n\r\n\r\n```python\r\nfrom PIL import Image as image\r\nimport torch\r\nimport numpy as np\r\nimport torchvision.transforms.functional as TF\r\nimport torchvision.transforms as transforms\r\nimport os\r\nimport torchvision.datasets as dset\r\nvoc_colormap = [[0, 0, 0], [128, 0, 0], [0, 128, 0], [128, 128, 0],\r\n                [0, 0, 128], [128, 0, 128], [0, 128, 128], [128, 128, 128],\r\n                [64, 0, 0], [192, 0, 0], [64, 128, 0], [192, 128, 0],\r\n                [64, 0, 128], [192, 0, 128], [64, 128, 128], [192, 128, 128],\r\n                [0, 64, 0], [128, 64, 0], [0, 192, 0], [128, 192, 0],\r\n                [0, 64, 128]]\r\nclass my_data(torch.utils.data.Dataset):\r\n    #if target_transform=mask_transform is\r\n    def __init__(self,data_size,root='data',image_set='train',transform=None,target_transform=None):\r\n        self.shape=data_size\r\n        self.root=os.path.expanduser(root)\r\n        self.transform=transform\r\n        self.target_transform=target_transform\r\n        self.image_set=image_set\r\n        voc_dir=os.path.join(self.root,'VOCdevkit/VOC2012')\r\n        image_dir=os.path.join(voc_dir,'JPEGImages')\r\n        mask_dir=os.path.join(voc_dir,'SegmentationClass')\r\n        splits_dir=os.path.join(voc_dir,'ImageSets/Segmentation')\r\n        splits_f=os.path.join(splits_dir, self.image_set + '.txt')\r\n        with open(os.path.join(splits_f),'r') as f:\r\n            file_name=[x.strip() for x in f.readlines()]\r\n        self.image=[os.path.join(image_dir,x+'.jpg') for x in file_name]\r\n        self.mask=[os.path.join(mask_dir,x+'.png') for x in file_name]\r\n        assert (len(self.image)==len(self.mask))\r\n\r\n        self.class_index=np.zeros(256**3)\r\n        for i,j in enumerate(voc_colormap):\r\n            tmp=(j[0]*256+j[1])*256+j[2]\r\n            self.class_index[tmp]=i\r\n    def __getitem__(self, index):\r\n        img=image.open(self.image[index]).convert('RGB')\r\n        target=image.open(self.mask[index]).convert('RGB')\r\n        i,j,h,w=transforms.RandomCrop.get_params(img,self.shape)\r\n        # if i<0 or j<0 or h <0 or w<0:\r\n        #     return None,None\r\n        img=TF.crop(img,i,j,h,w)\r\n        target=TF.crop(target,i,j,h,w)\r\n        if  self.target_transform is not None:\r\n            return self.transform(img),self.target_transform(target)\r\n        target=np.array(target).transpose(2,0,1).astype(np.int32)\r\n        target=(target[0]*256+target[1])*256+target[2]\r\n        target=self.class_index[target]\r\n        return self.transform(img),target\r\n\r\n    def __len__(self):\r\n        return len(self.image)\r\n```","closed_by":{"login":"msamogh","id":1230386,"node_id":"MDQ6VXNlcjEyMzAzODY=","avatar_url":"https://avatars.githubusercontent.com/u/1230386?v=4","gravatar_id":"","url":"https://api.github.com/users/msamogh","html_url":"https://github.com/msamogh","followers_url":"https://api.github.com/users/msamogh/followers","following_url":"https://api.github.com/users/msamogh/following{/other_user}","gists_url":"https://api.github.com/users/msamogh/gists{/gist_id}","starred_url":"https://api.github.com/users/msamogh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/msamogh/subscriptions","organizations_url":"https://api.github.com/users/msamogh/orgs","repos_url":"https://api.github.com/users/msamogh/repos","events_url":"https://api.github.com/users/msamogh/events{/privacy}","received_events_url":"https://api.github.com/users/msamogh/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/msamogh/nonechucks/issues/4/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/msamogh/nonechucks/issues/4/timeline","performed_via_github_app":null,"state_reason":"completed"}