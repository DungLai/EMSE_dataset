[{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/965107896","html_url":"https://github.com/WLM1ke/poptimizer/issues/67#issuecomment-965107896","issue_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/67","id":965107896,"node_id":"IC_kwDOCYyMws45hmC4","user":{"login":"WLM1ke","id":35304528,"node_id":"MDQ6VXNlcjM1MzA0NTI4","avatar_url":"https://avatars.githubusercontent.com/u/35304528?v=4","gravatar_id":"","url":"https://api.github.com/users/WLM1ke","html_url":"https://github.com/WLM1ke","followers_url":"https://api.github.com/users/WLM1ke/followers","following_url":"https://api.github.com/users/WLM1ke/following{/other_user}","gists_url":"https://api.github.com/users/WLM1ke/gists{/gist_id}","starred_url":"https://api.github.com/users/WLM1ke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WLM1ke/subscriptions","organizations_url":"https://api.github.com/users/WLM1ke/orgs","repos_url":"https://api.github.com/users/WLM1ke/repos","events_url":"https://api.github.com/users/WLM1ke/events{/privacy}","received_events_url":"https://api.github.com/users/WLM1ke/received_events","type":"User","site_admin":false},"created_at":"2021-11-10T12:59:14Z","updated_at":"2021-11-10T12:59:14Z","author_association":"OWNER","body":"Достаточно в misc удалить документ trading_dates - тогда он обновит все котировки.","reactions":{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/965107896/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"WLM1ke","id":35304528,"node_id":"MDQ6VXNlcjM1MzA0NTI4","avatar_url":"https://avatars.githubusercontent.com/u/35304528?v=4","gravatar_id":"","url":"https://api.github.com/users/WLM1ke","html_url":"https://github.com/WLM1ke","followers_url":"https://api.github.com/users/WLM1ke/followers","following_url":"https://api.github.com/users/WLM1ke/following{/other_user}","gists_url":"https://api.github.com/users/WLM1ke/gists{/gist_id}","starred_url":"https://api.github.com/users/WLM1ke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WLM1ke/subscriptions","organizations_url":"https://api.github.com/users/WLM1ke/orgs","repos_url":"https://api.github.com/users/WLM1ke/repos","events_url":"https://api.github.com/users/WLM1ke/events{/privacy}","received_events_url":"https://api.github.com/users/WLM1ke/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/965630607","html_url":"https://github.com/WLM1ke/poptimizer/issues/67#issuecomment-965630607","issue_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/67","id":965630607,"node_id":"IC_kwDOCYyMws45jlqP","user":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false},"created_at":"2021-11-10T18:38:37Z","updated_at":"2021-11-10T18:38:37Z","author_association":"CONTRIBUTOR","body":"Понял, спасибо! А причину её возникновения не знаете? Если нет, то может быть обернуть \r\n`value = self.price * self.shares`\r\nв try catch и в нём удалить trading_dates и запустить загрузку котировок?","reactions":{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/965630607/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false}},{"id":5599201196,"node_id":"CE_lADOCYyMws4-kdldzwAAAAFNvQes","url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/events/5599201196","actor":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-11-10T18:38:37Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/965973957","html_url":"https://github.com/WLM1ke/poptimizer/issues/67#issuecomment-965973957","issue_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/67","id":965973957,"node_id":"IC_kwDOCYyMws45k5fF","user":{"login":"WLM1ke","id":35304528,"node_id":"MDQ6VXNlcjM1MzA0NTI4","avatar_url":"https://avatars.githubusercontent.com/u/35304528?v=4","gravatar_id":"","url":"https://api.github.com/users/WLM1ke","html_url":"https://github.com/WLM1ke","followers_url":"https://api.github.com/users/WLM1ke/followers","following_url":"https://api.github.com/users/WLM1ke/following{/other_user}","gists_url":"https://api.github.com/users/WLM1ke/gists{/gist_id}","starred_url":"https://api.github.com/users/WLM1ke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WLM1ke/subscriptions","organizations_url":"https://api.github.com/users/WLM1ke/orgs","repos_url":"https://api.github.com/users/WLM1ke/repos","events_url":"https://api.github.com/users/WLM1ke/events{/privacy}","received_events_url":"https://api.github.com/users/WLM1ke/received_events","type":"User","site_admin":false},"created_at":"2021-11-11T04:17:40Z","updated_at":"2021-11-11T04:17:40Z","author_association":"OWNER","body":"Причина - по каким-то причинам была прервана загрузка данных. Вариантов основных два - в ручную грохнули программу во ремня загрузки или произошла какая-то ошибка во время загрузки. Оборачивать плохо, так если произошла ошибка при загрузке, то обычно надо что-то подшаманить с загрузчиками данных. ","reactions":{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/965973957/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"WLM1ke","id":35304528,"node_id":"MDQ6VXNlcjM1MzA0NTI4","avatar_url":"https://avatars.githubusercontent.com/u/35304528?v=4","gravatar_id":"","url":"https://api.github.com/users/WLM1ke","html_url":"https://github.com/WLM1ke","followers_url":"https://api.github.com/users/WLM1ke/followers","following_url":"https://api.github.com/users/WLM1ke/following{/other_user}","gists_url":"https://api.github.com/users/WLM1ke/gists{/gist_id}","starred_url":"https://api.github.com/users/WLM1ke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WLM1ke/subscriptions","organizations_url":"https://api.github.com/users/WLM1ke/orgs","repos_url":"https://api.github.com/users/WLM1ke/repos","events_url":"https://api.github.com/users/WLM1ke/events{/privacy}","received_events_url":"https://api.github.com/users/WLM1ke/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/966829403","html_url":"https://github.com/WLM1ke/poptimizer/issues/67#issuecomment-966829403","issue_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/67","id":966829403,"node_id":"IC_kwDOCYyMws45oKVb","user":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false},"created_at":"2021-11-12T05:21:41Z","updated_at":"2021-11-12T05:21:41Z","author_association":"CONTRIBUTOR","body":"Теперь, кажется, именно при загрузке произошла:\r\n````\r\nINFO:EventBus:DateCheckRequired(timestamp=datetime.datetime(2021, 11, 12, 5, 16, 47, 965688))\r\nINFO:TradingDatesGateway:Загрузка данных по торговым дням\r\nINFO:Mapper:Сохранение ID(package='data', group='trading_dates', name='trading_dates')\r\nINFO:EventBus:TradingDayEnded(date=datetime.date(2021, 11, 11))\r\nINFO:CPIGateway:Загрузка инфляции\r\nINFO:SmartLabGateway:Загрузка данных\r\nINFO:RFGateway:Загрузка данных\r\nINFO:USDGateway:(2021-11-11, 2021-11-11)\r\nINFO:MOEXStatusGateway:Загрузка данных\r\nINFO:Mapper:Сохранение ID(package='data', group='risk_free', name='risk_free')\r\nINFO:Mapper:Сохранение ID(package='data', group='usd', name='usd')\r\nTraceback (most recent call last):\r\n  File \"PATH_TO\\poptimizer\\loop.py\", line 5, in <module>\r\n    from poptimizer.__main__ import evolve\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\__main__.py\", line 4, in <module>\r\n    from poptimizer.data.views import div_status\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\views\\div_status.py\", line 9, in <module>\r\n    from poptimizer.data.app import bootstrap, viewers\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\app\\bootstrap.py\", line 47, in <module>\r\n    BUS, VIEWER = start_app()\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\app\\bootstrap.py\", line 42, in start_app\r\n    bus.handle_event(event)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\shared\\app.py\", line 74, in handle_event\r\n    loop.run_until_complete(self._handle_event(event))\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\asyncio\\base_events.py\", line 642, in run_until_complete\r\n    return future.result()\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\shared\\app.py\", line 89, in _handle_event\r\n    pending |= self._create_tasks(task.result())\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\shared\\app.py\", line 100, in _handle_one_command\r\n    return await self._event_handler.handle_event(event, repo)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\domain\\handlers.py\", line 69, in trading_day_ended\r\n    *itertools.chain.from_iterable(await asyncio.gather(*aws)),\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\domain\\handlers.py\", line 29, in _load_by_id_and_handle_event\r\n    return await table.handle_event(event)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\domain\\tables\\base.py\", line 71, in handle_event\r\n    df_new = await self._prepare_df(event)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\domain\\tables\\cpi.py\", line 32, in _prepare_df\r\n    return await self._gateway()\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\adapters\\gateways\\cpi.py\", line 80, in __call__\r\n    df = await _load_xlsx(self._session)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\adapters\\gateways\\cpi.py\", line 38, in _load_xlsx\r\n    return pd.read_excel(\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\pandas\\util\\_decorators.py\", line 311, in wrapper\r\n    return func(*args, **kwargs)\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\pandas\\io\\excel\\_base.py\", line 364, in read_excel\r\n    io = ExcelFile(io, storage_options=storage_options, engine=engine)\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\pandas\\io\\excel\\_base.py\", line 1233, in __init__\r\n    self._reader = self._engines[engine](self._io, storage_options=storage_options)\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\pandas\\io\\excel\\_openpyxl.py\", line 522, in __init__\r\n    super().__init__(filepath_or_buffer, storage_options=storage_options)\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\pandas\\io\\excel\\_base.py\", line 425, in __init__\r\n    self.book = self.load_workbook(BytesIO(self.handles.handle))\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\pandas\\io\\excel\\_openpyxl.py\", line 533, in load_workbook\r\n    return load_workbook(\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\openpyxl\\reader\\excel.py\", line 315, in load_workbook\r\n    reader = ExcelReader(filename, read_only, keep_vba,\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\openpyxl\\reader\\excel.py\", line 124, in __init__\r\n    self.archive = _validate_archive(fn)\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\openpyxl\\reader\\excel.py\", line 96, in _validate_archive\r\n    archive = ZipFile(filename, 'r')\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\zipfile.py\", line 1257, in __init__\r\n    self._RealGetContents()\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\zipfile.py\", line 1324, in _RealGetContents\r\n    raise BadZipFile(\"File is not a zip file\")\r\nzipfile.BadZipFile: File is not a zip file\r\n````","reactions":{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/966829403/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false}},{"id":5607525644,"node_id":"REE_lADOCYyMws4-kdldzwAAAAFOPA0M","url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/events/5607525644","actor":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false},"event":"reopened","commit_id":null,"commit_url":null,"created_at":"2021-11-12T05:21:41Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/966830529","html_url":"https://github.com/WLM1ke/poptimizer/issues/67#issuecomment-966830529","issue_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/67","id":966830529,"node_id":"IC_kwDOCYyMws45oKnB","user":{"login":"WLM1ke","id":35304528,"node_id":"MDQ6VXNlcjM1MzA0NTI4","avatar_url":"https://avatars.githubusercontent.com/u/35304528?v=4","gravatar_id":"","url":"https://api.github.com/users/WLM1ke","html_url":"https://github.com/WLM1ke","followers_url":"https://api.github.com/users/WLM1ke/followers","following_url":"https://api.github.com/users/WLM1ke/following{/other_user}","gists_url":"https://api.github.com/users/WLM1ke/gists{/gist_id}","starred_url":"https://api.github.com/users/WLM1ke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WLM1ke/subscriptions","organizations_url":"https://api.github.com/users/WLM1ke/orgs","repos_url":"https://api.github.com/users/WLM1ke/repos","events_url":"https://api.github.com/users/WLM1ke/events{/privacy}","received_events_url":"https://api.github.com/users/WLM1ke/received_events","type":"User","site_admin":false},"created_at":"2021-11-12T05:24:56Z","updated_at":"2021-11-12T05:24:56Z","author_association":"OWNER","body":"Я вчера вернулся наконец к компьютеру и у меня такая же штука произошла. Похоже в очередной раз парсер по инфляции поломался. Временное решение в этой строчке удалить ports.CPI. В ближайшее время починю:\r\nhttps://github.com/WLM1ke/poptimizer/blob/084ac14ca6212a5b14bea5bbc9bb575da077ffb0/poptimizer/data/domain/handlers.py#L61\r\n","reactions":{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/966830529/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"WLM1ke","id":35304528,"node_id":"MDQ6VXNlcjM1MzA0NTI4","avatar_url":"https://avatars.githubusercontent.com/u/35304528?v=4","gravatar_id":"","url":"https://api.github.com/users/WLM1ke","html_url":"https://github.com/WLM1ke","followers_url":"https://api.github.com/users/WLM1ke/followers","following_url":"https://api.github.com/users/WLM1ke/following{/other_user}","gists_url":"https://api.github.com/users/WLM1ke/gists{/gist_id}","starred_url":"https://api.github.com/users/WLM1ke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WLM1ke/subscriptions","organizations_url":"https://api.github.com/users/WLM1ke/orgs","repos_url":"https://api.github.com/users/WLM1ke/repos","events_url":"https://api.github.com/users/WLM1ke/events{/privacy}","received_events_url":"https://api.github.com/users/WLM1ke/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/966832401","html_url":"https://github.com/WLM1ke/poptimizer/issues/67#issuecomment-966832401","issue_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/67","id":966832401,"node_id":"IC_kwDOCYyMws45oLER","user":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false},"created_at":"2021-11-12T05:30:53Z","updated_at":"2021-11-12T05:30:53Z","author_association":"CONTRIBUTOR","body":"Понял, спасибо! Кстати, если ошибка происходит при загрузке, то будучи в обработчике [try catch](https://github.com/WLM1ke/poptimizer/issues/67#issuecomment-965630607) - она снова произойдёт. То есть её будет видно.","reactions":{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/966832401/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/967054845","html_url":"https://github.com/WLM1ke/poptimizer/issues/67#issuecomment-967054845","issue_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/67","id":967054845,"node_id":"IC_kwDOCYyMws45pBX9","user":{"login":"YoukaiCat","id":1074478,"node_id":"MDQ6VXNlcjEwNzQ0Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/1074478?v=4","gravatar_id":"","url":"https://api.github.com/users/YoukaiCat","html_url":"https://github.com/YoukaiCat","followers_url":"https://api.github.com/users/YoukaiCat/followers","following_url":"https://api.github.com/users/YoukaiCat/following{/other_user}","gists_url":"https://api.github.com/users/YoukaiCat/gists{/gist_id}","starred_url":"https://api.github.com/users/YoukaiCat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YoukaiCat/subscriptions","organizations_url":"https://api.github.com/users/YoukaiCat/orgs","repos_url":"https://api.github.com/users/YoukaiCat/repos","events_url":"https://api.github.com/users/YoukaiCat/events{/privacy}","received_events_url":"https://api.github.com/users/YoukaiCat/received_events","type":"User","site_admin":false},"created_at":"2021-11-12T12:03:17Z","updated_at":"2021-11-12T12:04:53Z","author_association":"NONE","body":"Ошибка в парсере инфляции, вроде как, связана с тем, что просто имя файла изменилось на сайте rosstat.gov.ru\r\n\r\n```\r\n--- a/poptimizer/data/adapters/gateways/cpi.py\r\n+++ b/poptimizer/data/adapters/gateways/cpi.py\r\n@@ -10,7 +10,7 @@ from poptimizer.shared import adapters, col\r\n\r\n # Параметры загрузки валидации данных\r\n # Был адрес URL = \"https://rosstat.gov.ru/storage/mediabank/i_ipc_1991-2021(1).xlsx\"\r\n-URL = \"https://rosstat.gov.ru/storage/mediabank/i_ipc-1991-2021.xlsx\"\r\n+URL = \"https://rosstat.gov.ru/storage/mediabank/i_ipc_1991-2021.xlsx\"\r\n END_OF_JAN = 31\r\n PARSING_PARAMETERS = types.MappingProxyType(\r\n     {\r\n```\r\n\r\nОднако, эволюция у меня всё равно не работает.\r\n```\r\nINFO:EventBus:DateCheckRequired(timestamp=datetime.datetime(2021, 11, 12, 12, 3, 2, 560188))\r\nTraceback (most recent call last):\r\n  File \"/home/parsee/poptimizer/./poptimizer/__main__.py\", line 37, in <module>\r\n    app(prog_name=\"poptimizer\")\r\n  File \"/home/parsee/miniconda3/lib/python3.9/site-packages/typer/main.py\", line 214, in __call__\r\n    return get_command(self)(*args, **kwargs)\r\n  File \"/home/parsee/miniconda3/lib/python3.9/site-packages/click/core.py\", line 829, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/home/parsee/miniconda3/lib/python3.9/site-packages/click/core.py\", line 782, in main\r\n    rv = self.invoke(ctx)\r\n  File \"/home/parsee/miniconda3/lib/python3.9/site-packages/click/core.py\", line 1259, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/home/parsee/miniconda3/lib/python3.9/site-packages/click/core.py\", line 1066, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"/home/parsee/miniconda3/lib/python3.9/site-packages/click/core.py\", line 610, in invoke\r\n    return callback(*args, **kwargs)\r\n  File \"/home/parsee/miniconda3/lib/python3.9/site-packages/typer/main.py\", line 497, in wrapper\r\n    return callback(**use_params)  # type: ignore\r\n  File \"/home/parsee/poptimizer/./poptimizer/__main__.py\", line 12, in evolve\r\n    ev.evolve()\r\n  File \"/home/parsee/poptimizer/poptimizer/evolve/evolve.py\", line 51, in evolve\r\n    step, current = self._step_setup(step, current)\r\n  File \"/home/parsee/poptimizer/poptimizer/evolve/evolve.py\", line 84, in _step_setup\r\n    dates = indexes.mcftrr(listing.last_history_date()).loc[self._end :].index\r\n  File \"/home/parsee/poptimizer/poptimizer/data/views/indexes.py\", line 34, in mcftrr\r\n    df = not_div.index()\r\n  File \"/home/parsee/poptimizer/poptimizer/data/views/crop/not_div.py\", line 20, in index\r\n    df = viewer.get_df(ports.INDEX, ticker)\r\n  File \"/home/parsee/poptimizer/poptimizer/data/app/viewers.py\", line 30, in get_df\r\n    return self._loop.run_until_complete(self._query(group, name))\r\n  File \"/home/parsee/miniconda3/lib/python3.9/asyncio/base_events.py\", line 642, in run_until_complete\r\n    return future.result()\r\n  File \"/home/parsee/poptimizer/poptimizer/data/app/viewers.py\", line 51, in _query\r\n    raise NoDFError(group, name)\r\npoptimizer.data.app.viewers.NoDFError: ('indexes', 'MCFTRR')\r\n```","reactions":{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/967054845/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"YoukaiCat","id":1074478,"node_id":"MDQ6VXNlcjEwNzQ0Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/1074478?v=4","gravatar_id":"","url":"https://api.github.com/users/YoukaiCat","html_url":"https://github.com/YoukaiCat","followers_url":"https://api.github.com/users/YoukaiCat/followers","following_url":"https://api.github.com/users/YoukaiCat/following{/other_user}","gists_url":"https://api.github.com/users/YoukaiCat/gists{/gist_id}","starred_url":"https://api.github.com/users/YoukaiCat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YoukaiCat/subscriptions","organizations_url":"https://api.github.com/users/YoukaiCat/orgs","repos_url":"https://api.github.com/users/YoukaiCat/repos","events_url":"https://api.github.com/users/YoukaiCat/events{/privacy}","received_events_url":"https://api.github.com/users/YoukaiCat/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/967153823","html_url":"https://github.com/WLM1ke/poptimizer/issues/67#issuecomment-967153823","issue_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/67","id":967153823,"node_id":"IC_kwDOCYyMws45pZif","user":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false},"created_at":"2021-11-12T14:20:55Z","updated_at":"2021-11-12T14:20:55Z","author_association":"CONTRIBUTOR","body":"После того как удалил ports.CPI\r\nhttps://github.com/WLM1ke/poptimizer/blob/084ac14ca6212a5b14bea5bbc9bb575da077ffb0/poptimizer/data/domain/handlers.py#L61\r\nполучил следующую: \r\n````\r\n***2021-11-10: Шаг эволюции — 1***\r\nLLH - (2.0009, 2.6294, 2.6760)\r\nRET - (-0.1670, 0.6095, 1.2661)\r\nОрганизмов - 115 / Максимум оценок - 9\r\nДоля принятых - 0.62%\r\n\r\nРодитель:\r\nLLH — 2.6334: 2.6798, 2.7248, 2.6568, 2.6172, 2.5751, 2.5463\r\nRET — -0.1670: -0.0977, -0.0976, -0.1017, -0.1636, -0.3698, -0.1718\r\nTimer — 0:07:13\r\nData: {'batch_size': 364.8003048901118, 'history_days': 145.85918648135237, 'ticker_on': 0.7621998239512555, 'day_of_year_on': -0.6076649500389857, 'day_of_period_on': -0.9382465750427933, 'prices_on': 0.8491138898258743, 'dividends_on': 0.7146590707124107, 'turnover_on': 0.2953568169659728, 'average_turnover_on': 0.028678163693356407, 'rvi_on': 0.7548905460393909, 'mcftrr_on': 0.7608859812766444, 'imoex_on': 0.39748660334304553, 'ticker_type_on': -0.39312774183048216, 'usd_on': -0.9319371005496981, 'open_on': -0.36963087425202734, 'high_on': 0.6478021355386165, 'low_on': 0.4755619792138399, 'meogtrr_on': -0.4008841426005453}\r\nModel: {'start_bn': 0.9082809633855027, 'kernels': 5.519242387261828, 'sub_blocks': 1.913408674153375, 'gate_channels': 5.421702136236713, 'residual_channels': 5.742088152681651, 'skip_channels': 5.79683837655868, 'end_channels': 6.778114491569525, 'mixture_size': 2.2639913135882805}\r\nOptimizer: {'betas': 0.9989975363765912, 'eps': 1.2740984374675402e-08, 'weight_decay': 0.041211610525038085}\r\nScheduler: {'max_lr': 0.002815209322266842, 'epochs': 2.1402683112932857, 'pct_start': 0.300740168046454, 'anneal_strategy': -0.6889762348128361, 'base_momentum': 0.8504079029678564, 'max_momentum': 0.9507583612702956, 'div_factor': 290.3625415175893, 'final_div_factor': 46623.3084230237} \r\n\r\n~~> Test: 100%|██████████| 1/1 [00:05<00:00,  5.67s/it, 2.56480]\r\nRET = -19.71% / MEAN = 41.65% / PLAN = 58.23% / STD = 18.34% / DD = 5.78% / POS = 3 / MAX = 76.26%\r\nTraceback (most recent call last):\r\n  File \"PATH_TO\\poptimizer\\loop.py\", line 10, in <module>\r\n    evolve()\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\__main__.py\", line 12, in evolve\r\n    ev.evolve()\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\evolve\\evolve.py\", line 58, in evolve\r\n    next_, new = self._step(current)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\evolve\\evolve.py\", line 122, in _step\r\n    if self._eval_organism(hunter) is None:\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\evolve\\evolve.py\", line 186, in _eval_organism\r\n    if self._is_dead(organism):\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\evolve\\evolve.py\", line 197, in _is_dead\r\n    lower, _ = seq.median_conf_bound(ir, config.P_VALUE * 2)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\evolve\\seq.py\", line 116, in median_conf_bound\r\n    raise SmallSampleError(f\"Размер выборки {t} - должен быть не меньше {n}\")\r\npoptimizer.evolve.seq.SmallSampleError: Размер выборки 7 - должен быть не меньше 9\r\nРазмер выборки 7 - должен быть не меньше 9\r\n\r\n````\r\nНе уверен, что это следствие, но что делать с этой?)","reactions":{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/967153823/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/967179717","html_url":"https://github.com/WLM1ke/poptimizer/issues/67#issuecomment-967179717","issue_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/67","id":967179717,"node_id":"IC_kwDOCYyMws45pf3F","user":{"login":"WLM1ke","id":35304528,"node_id":"MDQ6VXNlcjM1MzA0NTI4","avatar_url":"https://avatars.githubusercontent.com/u/35304528?v=4","gravatar_id":"","url":"https://api.github.com/users/WLM1ke","html_url":"https://github.com/WLM1ke","followers_url":"https://api.github.com/users/WLM1ke/followers","following_url":"https://api.github.com/users/WLM1ke/following{/other_user}","gists_url":"https://api.github.com/users/WLM1ke/gists{/gist_id}","starred_url":"https://api.github.com/users/WLM1ke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WLM1ke/subscriptions","organizations_url":"https://api.github.com/users/WLM1ke/orgs","repos_url":"https://api.github.com/users/WLM1ke/repos","events_url":"https://api.github.com/users/WLM1ke/events{/privacy}","received_events_url":"https://api.github.com/users/WLM1ke/received_events","type":"User","site_admin":false},"created_at":"2021-11-12T14:57:19Z","updated_at":"2021-11-12T14:57:19Z","author_association":"OWNER","body":"Это проблема перехода между версиями - нужно заменить строчку, где возникла ошибка на:\r\n`return -np.inf, np.inf`","reactions":{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/comments/967179717/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"WLM1ke","id":35304528,"node_id":"MDQ6VXNlcjM1MzA0NTI4","avatar_url":"https://avatars.githubusercontent.com/u/35304528?v=4","gravatar_id":"","url":"https://api.github.com/users/WLM1ke","html_url":"https://github.com/WLM1ke","followers_url":"https://api.github.com/users/WLM1ke/followers","following_url":"https://api.github.com/users/WLM1ke/following{/other_user}","gists_url":"https://api.github.com/users/WLM1ke/gists{/gist_id}","starred_url":"https://api.github.com/users/WLM1ke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WLM1ke/subscriptions","organizations_url":"https://api.github.com/users/WLM1ke/orgs","repos_url":"https://api.github.com/users/WLM1ke/repos","events_url":"https://api.github.com/users/WLM1ke/events{/privacy}","received_events_url":"https://api.github.com/users/WLM1ke/received_events","type":"User","site_admin":false}},{"id":5612951100,"node_id":"CE_lADOCYyMws4-kdldzwAAAAFOjtY8","url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/events/5612951100","actor":{"login":"WLM1ke","id":35304528,"node_id":"MDQ6VXNlcjM1MzA0NTI4","avatar_url":"https://avatars.githubusercontent.com/u/35304528?v=4","gravatar_id":"","url":"https://api.github.com/users/WLM1ke","html_url":"https://github.com/WLM1ke","followers_url":"https://api.github.com/users/WLM1ke/followers","following_url":"https://api.github.com/users/WLM1ke/following{/other_user}","gists_url":"https://api.github.com/users/WLM1ke/gists{/gist_id}","starred_url":"https://api.github.com/users/WLM1ke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WLM1ke/subscriptions","organizations_url":"https://api.github.com/users/WLM1ke/orgs","repos_url":"https://api.github.com/users/WLM1ke/repos","events_url":"https://api.github.com/users/WLM1ke/events{/privacy}","received_events_url":"https://api.github.com/users/WLM1ke/received_events","type":"User","site_admin":false},"event":"closed","commit_id":"86cb9878ab7f1ac84afe359afcd4c40f1959227a","commit_url":"https://api.github.com/repos/WLM1ke/poptimizer/commits/86cb9878ab7f1ac84afe359afcd4c40f1959227a","created_at":"2021-11-13T09:32:14Z","state_reason":null,"performed_via_github_app":null},{"id":5612951102,"node_id":"REFE_lADOCYyMws4-kdldzwAAAAFOjtY-","url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/events/5612951102","actor":{"login":"WLM1ke","id":35304528,"node_id":"MDQ6VXNlcjM1MzA0NTI4","avatar_url":"https://avatars.githubusercontent.com/u/35304528?v=4","gravatar_id":"","url":"https://api.github.com/users/WLM1ke","html_url":"https://github.com/WLM1ke","followers_url":"https://api.github.com/users/WLM1ke/followers","following_url":"https://api.github.com/users/WLM1ke/following{/other_user}","gists_url":"https://api.github.com/users/WLM1ke/gists{/gist_id}","starred_url":"https://api.github.com/users/WLM1ke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WLM1ke/subscriptions","organizations_url":"https://api.github.com/users/WLM1ke/orgs","repos_url":"https://api.github.com/users/WLM1ke/repos","events_url":"https://api.github.com/users/WLM1ke/events{/privacy}","received_events_url":"https://api.github.com/users/WLM1ke/received_events","type":"User","site_admin":false},"event":"referenced","commit_id":"1202e2b73fedcc14baa04e770531e80edc327ea8","commit_url":"https://api.github.com/repos/WLM1ke/poptimizer/commits/1202e2b73fedcc14baa04e770531e80edc327ea8","created_at":"2021-11-13T09:32:14Z","performed_via_github_app":null}]