{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/57","repository_url":"https://api.github.com/repos/WLM1ke/poptimizer","labels_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/57/labels{/name}","comments_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/57/comments","events_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/57/events","html_url":"https://github.com/WLM1ke/poptimizer/issues/57","id":889767361,"node_id":"MDU6SXNzdWU4ODk3NjczNjE=","number":57,"title":"mongo DocumentTooLarge. pickled forecasts ~55MB","user":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":36,"created_at":"2021-05-12T07:27:31Z","updated_at":"2021-11-10T18:39:22Z","closed_at":"2021-11-10T18:39:22Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"```\r\nINFO:EventBus:AppStarted(timestamp=datetime.datetime(2021, 5, 12, 5, 35, 25, 243556))\r\nForecasts: 90it [03:55,  2.62s/it]\r\nTraceback (most recent call last):\r\n  File \"path_to\\poptimizer\\poptimizer\\store\\database.py\", line 48, in __setitem__\r\n    self._collection.replace_one({\"_id\": key}, value, upsert=True)\r\n  File \"path_to\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\collection.py\", line 939, in replace_one\r\n    common.validate_ok_for_replace(replacement)\r\n  File \"path_to\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\common.py\", line 539, in validate_ok_for_replace\r\n    validate_is_mapping(\"replacement\", replacement)\r\n  File \"path_to\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\common.py\", line 494, in validate_is_mapping\r\n    raise TypeError(\"%s must be an instance of dict, bson.son.SON, or \"\r\nTypeError: replacement must be an instance of dict, bson.son.SON, or any other type that inherits from collections.Mapping\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"path_to\\poptimizer\\loop.py\", line 13, in opt\r\n    optimize(date)\r\n  File \"path_to\\poptimizer\\poptimizer\\__main__.py\", line 30, in optimize\r\n    opt = Optimizer(port)\r\n  File \"path_to\\poptimizer\\poptimizer\\portfolio\\optimizer.py\", line 53, in __init__\r\n    self._metrics = metrics.MetricsResample(portfolio)\r\n  File \"path_to\\poptimizer\\poptimizer\\portfolio\\metrics.py\", line 138, in __init__\r\n    for forecast in evolve.get_forecasts(tickers, date):\r\n  File \"path_to\\poptimizer\\poptimizer\\evolve\\forecaster.py\", line 70, in get_forecasts\r\n    mongodb[FORECAST] = forecasts\r\n  File \"path_to\\poptimizer\\poptimizer\\store\\database.py\", line 51, in __setitem__\r\n    self._collection.replace_one({\"_id\": key}, value, upsert=True)\r\n  File \"path_to\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\collection.py\", line 943, in replace_one\r\n    self._update_retryable(\r\n  File \"path_to\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\collection.py\", line 868, in _update_retryable\r\n    return self.__database.client._retryable_write(\r\n  File \"path_to\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\mongo_client.py\", line 1498, in _retryable_write\r\n    return self._retry_with_session(retryable, func, s, None)\r\n  File \"path_to\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\mongo_client.py\", line 1384, in _retry_with_session\r\n    return self._retry_internal(retryable, func, session, bulk)\r\n  File \"path_to\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\mongo_client.py\", line 1416, in _retry_internal\r\n    return func(session, sock_info, retryable)\r\n  File \"path_to\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\collection.py\", line 860, in _update\r\n    return self._update(\r\n  File \"path_to\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\collection.py\", line 829, in _update\r\n    result = sock_info.command(\r\n  File \"path_to\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\pool.py\", line 699, in command\r\n    self._raise_connection_failure(error)\r\n  File \"path_to\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\pool.py\", line 683, in command\r\n    return command(self, dbname, spec, slave_ok,\r\n  File \"path_to\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\network.py\", line 135, in command\r\n    message._raise_document_too_large(\r\n  File \"path_to\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\message.py\", line 1092, in _raise_document_too_large\r\n    raise DocumentTooLarge(\"%r command document too large\" % (operation,))\r\npymongo.errors.DocumentTooLarge: 'update' command document too large\r\n```\r\nвот что он\r\nhttps://github.com/WLM1ke/poptimizer/blob/09150f017a57f65dbc2a8b944229d60ef151176a/poptimizer/store/database.py#L50\r\nсодержит: https://yadi.sk/d/XMyiA7TrG0XqrQ\r\n","closed_by":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/57/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/57/timeline","performed_via_github_app":null,"state_reason":"completed"}