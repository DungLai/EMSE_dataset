{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/54","repository_url":"https://api.github.com/repos/WLM1ke/poptimizer","labels_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/54/labels{/name}","comments_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/54/comments","events_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/54/events","html_url":"https://github.com/WLM1ke/poptimizer/issues/54","id":854566283,"node_id":"MDU6SXNzdWU4NTQ1NjYyODM=","number":54,"title":"CPIGatewayError: На странице отсутствует ссылка на страницу с потребительской инфляцией","user":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-04-09T14:15:24Z","updated_at":"2021-04-09T14:20:20Z","closed_at":"2021-04-09T14:20:20Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Получил такую ошибку. Стал смотреть, пришел к этой строчке:\r\nhttps://github.com/WLM1ke/poptimizer/blob/50ef83c40e85ee4440d67e23aca30786cbbf6317/poptimizer/data/adapters/gateways/cpi.py#L15\r\nВ ней все правильно? Я зашел на страницу https://rosstat.gov.ru/price , по которой идёт поиск, и в коде страницы была ссылка:\r\n/storage/mediabank/Rm1nIXsH/Индексы потребительских цен.htm\r\nно она не походит под регулярку в указанной строке.\r\nЛог:\r\n{\"t\":{\"$date\":\"2021-04-09T14:41:37.316+03:00\"},\"s\":\"I\",  \"c\":\"CONTROL\",  \"id\":23285,   \"ctx\":\"main\",\"msg\":\"Automatically disabling TLS 1.0, to force-enable TLS 1.0 specify --sslDisabledProtocols 'none'\"}\r\n{\"t\":{\"$date\":\"2021-04-09T14:41:37.588+03:00\"},\"s\":\"W\",  \"c\":\"ASIO\",     \"id\":22601,   \"ctx\":\"main\",\"msg\":\"No TransportLayer configured during NetworkInterface startup\"}\r\n{\"t\":{\"$date\":\"2021-04-09T14:41:37.588+03:00\"},\"s\":\"I\",  \"c\":\"NETWORK\",  \"id\":4648602, \"ctx\":\"main\",\"msg\":\"Implicit TCP FastOpen in use.\"}\r\n{\"t\":{\"$date\":\"2021-04-09T14:41:37.589+03:00\"},\"s\":\"I\",  \"c\":\"STORAGE\",  \"id\":4615611, \"ctx\":\"initandlisten\",\"msg\":\"MongoDB starting\",\"attr\":{\"pid\":18084,\"port\":27017,\"dbPath\":\"PATH_TO/poptimizer/db\",\"architecture\":\"64-bit\",\"host\":\"iRU\"}}\r\n{\"t\":{\"$date\":\"2021-04-09T14:41:37.589+03:00\"},\"s\":\"I\",  \"c\":\"CONTROL\",  \"id\":23398,   \"ctx\":\"initandlisten\",\"msg\":\"Target operating system minimum version\",\"attr\":{\"targetMinOS\":\"Windows 7/Windows Server 2008 R2\"}}\r\n{\"t\":{\"$date\":\"2021-04-09T14:41:37.589+03:00\"},\"s\":\"I\",  \"c\":\"CONTROL\",  \"id\":23403,   \"ctx\":\"initandlisten\",\"msg\":\"Build Info\",\"attr\":{\"buildInfo\":{\"version\":\"4.4.0\",\"gitVersion\":\"563487e100c4215e2dce98d0af2a6a5a2d67c5cf\",\"modules\":[],\"allocator\":\"tcmalloc\",\"environment\":{\"distmod\":\"windows\",\"distarch\":\"x86_64\",\"target_arch\":\"x86_64\"}}}}\r\n{\"t\":{\"$date\":\"2021-04-09T14:41:37.589+03:00\"},\"s\":\"I\",  \"c\":\"CONTROL\",  \"id\":51765,   \"ctx\":\"initandlisten\",\"msg\":\"Operating System\",\"attr\":{\"os\":{\"name\":\"Microsoft Windows 10\",\"version\":\"10.0 (build 19042)\"}}}\r\n{\"t\":{\"$date\":\"2021-04-09T14:41:37.589+03:00\"},\"s\":\"I\",  \"c\":\"CONTROL\",  \"id\":21951,   \"ctx\":\"initandlisten\",\"msg\":\"Options set by command line\",\"attr\":{\"options\":{\"net\":{\"bindIp\":\"localhost\"},\"storage\":{\"dbPath\":\"PATH_TO\\\\poptimizer\\\\db\",\"directoryPerDB\":true}}}}\r\n{\"t\":{\"$date\":\"2021-04-09T14:41:37.591+03:00\"},\"s\":\"E\",  \"c\":\"STORAGE\",  \"id\":20557,   \"ctx\":\"initandlisten\",\"msg\":\"DBException in initAndListen, terminating\",\"attr\":{\"error\":\"DBPathInUse: Unable to create/open the lock file: PATH_TO\\\\poptimizer\\\\db\\\\mongod.lock (Процесс не может получить доступ к файлу, так как этот файл занят другим процессом.). Ensure the user executing mongod is the owner of the lock file and has the appropriate permissions. Also make sure that another mongod instance is not already running on the PATH_TO\\\\poptimizer\\\\db directory\"}}\r\n{\"t\":{\"$date\":\"2021-04-09T14:41:37.591+03:00\"},\"s\":\"I\",  \"c\":\"NETWORK\",  \"id\":20562,   \"ctx\":\"initandlisten\",\"msg\":\"Shutdown: going to close listening sockets\"}\r\n{\"t\":{\"$date\":\"2021-04-09T14:41:37.591+03:00\"},\"s\":\"I\",  \"c\":\"-\",        \"id\":20520,   \"ctx\":\"initandlisten\",\"msg\":\"Stopping further Flow Control ticket acquisitions.\"}\r\n{\"t\":{\"$date\":\"2021-04-09T14:41:37.591+03:00\"},\"s\":\"I\",  \"c\":\"CONTROL\",  \"id\":20565,   \"ctx\":\"initandlisten\",\"msg\":\"Now exiting\"}\r\n{\"t\":{\"$date\":\"2021-04-09T14:41:37.591+03:00\"},\"s\":\"I\",  \"c\":\"CONTROL\",  \"id\":23138,   \"ctx\":\"initandlisten\",\"msg\":\"Shutting down\",\"attr\":{\"exitCode\":100}}\r\n2021-04-09T14:41:38.252+0300\tpreparing collections to restore from\r\n2021-04-09T14:41:38.277+0300\treading metadata for source.dividends from PATH_TO\\poptimizer\\dump\\source\\dividends.metadata.json\r\n2021-04-09T14:41:38.484+0300\trestoring source.dividends from PATH_TO\\poptimizer\\dump\\source\\dividends.bson\r\n2021-04-09T14:41:38.494+0300\trestoring indexes for collection source.dividends from metadata\r\n2021-04-09T14:41:38.812+0300\tfinished restoring source.dividends (841 documents, 0 failures)\r\n2021-04-09T14:41:38.812+0300\t841 document(s) restored successfully. 0 document(s) failed to restore.\r\n2021-04-09T14:41:39.770+0300\twriting source.dividends to PATH_TO\\poptimizer\\dump\\source\\dividends.bson\r\n2021-04-09T14:41:39.790+0300\tdone dumping source.dividends (841 documents)\r\nTraceback (most recent call last):\r\n  File \"PATH_TO\\poptimizer\\loop.py\", line 6, in <module>\r\n    from poptimizer.__main__ import evolve, optimize\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\__main__.py\", line 9, in <module>\r\n    from poptimizer.data.views import div_status, listing\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\views\\div_status.py\", line 9, in <module>\r\n    from poptimizer.data.app import bootstrap, viewers\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\app\\bootstrap.py\", line 47, in <module>\r\n    BUS, VIEWER = start_app()\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\app\\bootstrap.py\", line 42, in start_app\r\n    bus.handle_event(event)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\shared\\app.py\", line 69, in handle_event\r\n    loop.run_until_complete(self._handle_event(event))\r\n  File \"C:\\Users\\tokar\\anaconda3\\envs\\finan\\lib\\asyncio\\base_events.py\", line 642, in run_until_complete\r\n    return future.result()\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\shared\\app.py\", line 81, in _handle_event\r\n    pending |= self._create_tasks(task.result())\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\shared\\app.py\", line 92, in _handle_one_command\r\n    return await self._event_handler.handle_event(event, repo)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\domain\\handlers.py\", line 68, in trading_day_ended\r\n    *itertools.chain.from_iterable(await asyncio.gather(*aws)),\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\domain\\handlers.py\", line 29, in _load_by_id_and_handle_event\r\n    return await table.handle_event(event)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\domain\\tables\\base.py\", line 71, in handle_event\r\n    df_new = await self._prepare_df(event)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\domain\\tables\\cpi.py\", line 32, in _prepare_df\r\n    return await self._gateway()\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\adapters\\gateways\\cpi.py\", line 104, in __call__\r\n    df = await _load_xlsx(self._session)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\adapters\\gateways\\cpi.py\", line 59, in _load_xlsx\r\n    file_url = await _get_xlsx_url(session)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\adapters\\gateways\\cpi.py\", line 49, in _get_xlsx_url\r\n    cpi_url = await _get_cpi_url(session)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\data\\adapters\\gateways\\cpi.py\", line 44, in _get_cpi_url\r\n    raise CPIGatewayError(\"На странице отсутствует ссылка на страницу с потребительской инфляцией\")\r\npoptimizer.data.adapters.gateways.cpi.CPIGatewayError: На странице отсутствует ссылка на страницу с потребительской инфляцией","closed_by":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/54/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/54/timeline","performed_via_github_app":null,"state_reason":"completed"}