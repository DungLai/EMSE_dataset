{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/83","repository_url":"https://api.github.com/repos/WLM1ke/poptimizer","labels_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/83/labels{/name}","comments_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/83/comments","events_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/83/events","html_url":"https://github.com/WLM1ke/poptimizer/issues/83","id":1069652420,"node_id":"I_kwDOCYyMws4_wZnE","number":83,"title":"Оптимизация выдает ошибку","user":{"login":"swpman","id":22314161,"node_id":"MDQ6VXNlcjIyMzE0MTYx","avatar_url":"https://avatars.githubusercontent.com/u/22314161?v=4","gravatar_id":"","url":"https://api.github.com/users/swpman","html_url":"https://github.com/swpman","followers_url":"https://api.github.com/users/swpman/followers","following_url":"https://api.github.com/users/swpman/following{/other_user}","gists_url":"https://api.github.com/users/swpman/gists{/gist_id}","starred_url":"https://api.github.com/users/swpman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/swpman/subscriptions","organizations_url":"https://api.github.com/users/swpman/orgs","repos_url":"https://api.github.com/users/swpman/repos","events_url":"https://api.github.com/users/swpman/events{/privacy}","received_events_url":"https://api.github.com/users/swpman/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2021-12-02T15:03:33Z","updated_at":"2021-12-02T16:41:40Z","closed_at":"2021-12-02T16:15:07Z","author_association":"NONE","active_lock_reason":null,"body":"INFO:Config:{'P_VALUE': 0.05, 'FORECAST_DAYS': 21, 'HISTORY_DAYS_MIN': 63, 'TARGET_POPULATION': 100, 'START_EVOLVE_HOUR': 1, 'STOP_EVOLVE_HOUR': 1, 'COSTS': 0.025, 'MARKET_IMPACT_FACTOR': 1, 'OPTIMIZER': 'resample'}\r\n\r\nINFO:EventBus:DateCheckRequired(timestamp=datetime.datetime(2021, 12, 2, 14, 18, 51, 211020))\r\n\r\nForecasts: 99it [19:11, 11.64s/it]\r\n\r\nПОРТФЕЛЬ [base, test] - 2021-12-01\r\n\r\n\r\n\r\nКоличество бумаг - 199\r\n\r\nОткрытых позиций - 8\r\n\r\nЭффективных позиций - 4\r\n\r\n\r\n\r\n           LOT_SIZE    SHARES        PRICE      VALUE    WEIGHT      TURNOVER\r\n\r\n.\r\n.\r\n.\r\n\r\nPORTFOLIO         ...........\r\n\r\nPATH_TO/poptimizer/portfolio/metrics.py:78: RuntimeWarning: invalid value encountered in matmul\r\n\r\n  portfolio_var = weight.reshape(1, -1) @ cov @ weight.reshape(-1, 1)  # noqa: WPS221\r\n\r\nPATH_TO/poptimizer/portfolio/metrics.py:90: RuntimeWarning: invalid value encountered in matmul\r\n\r\n  beta = cov @ weight.reshape(-1, 1)\r\n\r\n\r\n\r\nКЛЮЧЕВЫЕ МЕТРИКИ ПОРТФЕЛЯ\r\n\r\n\r\n\r\nДней в истории - (89 <-> 146 <-> 196)\r\n\r\nКорреляция - (7.16% <-> 8.09% <-> 8.82%)\r\n\r\nСжатие - (40.07% <-> 46.09% <-> 52.70%)\r\n\r\n\r\n\r\n               MEAN       STD      BETA    R_GEOM      GRAD\r\n\r\nAAL-RM    ...\r\n\r\n.\r\n.\r\n.\r\n\r\nCASH       ...\r\n\r\nPORTFOLIO  ...\r\n\r\n\r\nКонсервативная доходность:  25.69%\r\n\r\nКонсервативный риск:        51.69%\r\n\r\nКонсервативная метрика:     16.23%\r\n\r\nОценка просадки:            36.07%\r\n\r\nTraceback (most recent call last):\r\n\r\n  File \"PATH_TO/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\r\n\r\n    return _run_code(code, main_globals, None,\r\n\r\n  File \"PATH_TO/lib/python3.9/runpy.py\", line 87, in _run_code\r\n\r\n    exec(code, run_globals)\r\n\r\n  File \"PATH_TO/poptimizer/__main__.py\", line 42, in <module>\r\n\r\n    app(prog_name=\"poptimizer\")\r\n\r\n  File \"PATH_TO/lib/python3.9/site-packages/typer/main.py\", line 214, in __call__\r\n\r\n    return get_command(self)(*args, **kwargs)\r\n\r\n  File \"PATH_TO/lib/python3.9/site-packages/click/core.py\", line 1128, in __call__\r\n\r\n    return self.main(*args, **kwargs)\r\n\r\n  File \"PATH_TO/lib/python3.9/site-packages/click/core.py\", line 1053, in main\r\n\r\n    rv = self.invoke(ctx)\r\n\r\n  File \"PATH_TO/lib/python3.9/site-packages/click/core.py\", line 1659, in invoke\r\n\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n\r\n  File \"PATH_TO/lib/python3.9/site-packages/click/core.py\", line 1395, in invoke\r\n\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n\r\n  File \"PATH_TO/lib/python3.9/site-packages/click/core.py\", line 754, in invoke\r\n\r\n    return __callback(*args, **kwargs)\r\n\r\n  File \"PATH_TO/lib/python3.9/site-packages/typer/main.py\", line 500, in wrapper\r\n\r\n    return callback(**use_params)  # type: ignore\r\n\r\n  File \"PATH_TO/poptimizer/__main__.py\", line 31, in optimize\r\n\r\n    print(opt)\r\n\r\n  File \"PATH_TO/poptimizer/portfolio/optimizer_resample.py\", line 45, in __str__\r\n\r\n    df = self._for_trade()\r\n\r\n  File \"PATH_TO/poptimizer/portfolio/optimizer_resample.py\", line 68, in _for_trade\r\n\r\n    conf_int = self._prepare_bounds()\r\n\r\n  File \"PATH_TO/poptimizer/portfolio/optimizer_resample.py\", line 111, in _prepare_bounds\r\n\r\n    conf_int = conf_int.apply(\r\n\r\n  File \"PATH_TO/lib/python3.9/site-packages/pandas/core/frame.py\", line 8740, in apply\r\n\r\n    return op.apply()\r\n\r\n  File \"PATH_TO/lib/python3.9/site-packages/pandas/core/apply.py\", line 688, in apply\r\n\r\n    return self.apply_standard()\r\n\r\n  File \"PATH_TO/lib/python3.9/site-packages/pandas/core/apply.py\", line 812, in apply_standard\r\n\r\n    results, res_index = self.apply_series_generator()\r\n\r\n  File \"PATH_TO/lib/python3.9/site-packages/pandas/core/apply.py\", line 828, in apply_series_generator\r\n\r\n    results[i] = self.f(v)\r\n\r\n  File \"PATH_TO/poptimizer/portfolio/optimizer_resample.py\", line 112, in <lambda>\r\n\r\n    lambda grad: _grad_conf_int(grad, p_value),\r\n\r\n  File \"PATH_TO/poptimizer/portfolio/optimizer_resample.py\", line 179, in _grad_conf_int\r\n\r\n    interval = stats.bootstrap(\r\n\r\n  File \"PATH_TO/lib/python3.9/site-packages/scipy/stats/_bootstrap.py\", line 454, in bootstrap\r\n\r\n    ci_l = percentile_fun(theta_hat_b, interval[0]*100)\r\n\r\n  File \"PATH_TO/lib/python3.9/site-packages/scipy/stats/_bootstrap.py\", line 78, in _percentile_along_axis\r\n\r\n    percentiles[indices] = np.percentile(theta_hat_b_i, alpha_i)\r\n\r\n  File \"<__array_function__ internals>\", line 5, in percentile\r\n\r\n  File \"PATH_TO/lib/python3.9/site-packages/numpy/lib/function_base.py\", line 3866, in percentile\r\n\r\n    raise ValueError(\"Percentiles must be in the range [0, 100]\")\r\n\r\nValueError: Percentiles must be in the range [0, 100]\r\n","closed_by":{"login":"swpman","id":22314161,"node_id":"MDQ6VXNlcjIyMzE0MTYx","avatar_url":"https://avatars.githubusercontent.com/u/22314161?v=4","gravatar_id":"","url":"https://api.github.com/users/swpman","html_url":"https://github.com/swpman","followers_url":"https://api.github.com/users/swpman/followers","following_url":"https://api.github.com/users/swpman/following{/other_user}","gists_url":"https://api.github.com/users/swpman/gists{/gist_id}","starred_url":"https://api.github.com/users/swpman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/swpman/subscriptions","organizations_url":"https://api.github.com/users/swpman/orgs","repos_url":"https://api.github.com/users/swpman/repos","events_url":"https://api.github.com/users/swpman/events{/privacy}","received_events_url":"https://api.github.com/users/swpman/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/83/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/83/timeline","performed_via_github_app":null,"state_reason":"completed"}