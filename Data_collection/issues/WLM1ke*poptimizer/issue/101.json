{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/101","repository_url":"https://api.github.com/repos/WLM1ke/poptimizer","labels_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/101/labels{/name}","comments_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/101/comments","events_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/101/events","html_url":"https://github.com/WLM1ke/poptimizer/issues/101","id":1124683929,"node_id":"I_kwDOCYyMws5DCVCZ","number":101,"title":"Cannot connect to host iss.moex.com:443 ssl:default ","user":{"login":"ArjaraGit","id":57317188,"node_id":"MDQ6VXNlcjU3MzE3MTg4","avatar_url":"https://avatars.githubusercontent.com/u/57317188?v=4","gravatar_id":"","url":"https://api.github.com/users/ArjaraGit","html_url":"https://github.com/ArjaraGit","followers_url":"https://api.github.com/users/ArjaraGit/followers","following_url":"https://api.github.com/users/ArjaraGit/following{/other_user}","gists_url":"https://api.github.com/users/ArjaraGit/gists{/gist_id}","starred_url":"https://api.github.com/users/ArjaraGit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ArjaraGit/subscriptions","organizations_url":"https://api.github.com/users/ArjaraGit/orgs","repos_url":"https://api.github.com/users/ArjaraGit/repos","events_url":"https://api.github.com/users/ArjaraGit/events{/privacy}","received_events_url":"https://api.github.com/users/ArjaraGit/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2022-02-04T22:45:20Z","updated_at":"2022-02-06T15:15:26Z","closed_at":"2022-02-05T10:45:42Z","author_association":"NONE","active_lock_reason":null,"body":"Добрый вечер \r\nПодскажите пожалуйста с чем может быть связана ошибка? \r\nПоявилась пару дней назад, с тех пор не может выкачать котировки за предыдущий день (падает при выгрузке каждый день)\r\n\r\n[full_stacktrace.txt](https://github.com/WLM1ke/poptimizer/files/8006657/full_stacktrace.txt)\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/site-packages/aiohttp/connector.py\", line 985, in _wrap_create_connection\r\n    return await self._loop.create_connection(*args, **kwargs)  # type: ignore[return-value]  # noqa\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/asyncio/base_events.py\", line 1081, in create_connection\r\n    transport, protocol = await self._create_connection_transport(\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/asyncio/base_events.py\", line 1103, in _create_connection_transport\r\n    transport = self._make_ssl_transport(\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/asyncio/selector_events.py\", line 78, in _make_ssl_transport\r\n    _SelectorSocketTransport(self, rawsock, ssl_protocol,\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/asyncio/selector_events.py\", line 774, in __init__\r\n    base_events._set_nodelay(self._sock)\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/asyncio/base_events.py\", line 199, in _set_nodelay\r\n    sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_NODELAY, 1)\r\nOSError: [Errno 22] Invalid argument\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/Documents/PythonProjects/poptimizer/poptimizer/startEvolution.py\", line 9, in <module>\r\n    ev.evolve()\r\n  File \"/Users/Documents/PythonProjects/poptimizer/poptimizer/poptimizer/evolve/evolve.py\", line 56, in evolve\r\n    step, current = self._step_setup(step, current)\r\n  File \"/Users/Documents/PythonProjects/poptimizer/poptimizer/poptimizer/evolve/evolve.py\", line 90, in _step_setup\r\n    dates = listing.all_history_date(self._tickers, start=self._end)\r\n  File \"/Users/Documents/PythonProjects/poptimizer/poptimizer/poptimizer/data/views/listing.py\", line 26, in all_history_date\r\n    bus.handle_event(event)\r\n  File \"/Users/Documents/PythonProjects/poptimizer/poptimizer/poptimizer/shared/app.py\", line 74, in handle_event\r\n    loop.run_until_complete(self._handle_event(event))\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/asyncio/base_events.py\", line 642, in run_until_complete\r\n    return future.result()\r\n  File \"/Users/Documents/PythonProjects/poptimizer/poptimizer/poptimizer/shared/app.py\", line 89, in _handle_event\r\n    pending |= self._create_tasks(task.result())\r\n  File \"/Users/Documents/PythonProjects/poptimizer/poptimizer/poptimizer/shared/app.py\", line 100, in _handle_one_command\r\n    return await self._event_handler.handle_event(event, repo)\r\n  File \"/Users/Documents/PythonProjects/poptimizer/poptimizer/poptimizer/data/domain/handlers.py\", line 92, in ticker_traded\r\n    return list(itertools.chain.from_iterable(await asyncio.gather(*aws)))\r\n  File \"/Users/Documents/PythonProjects/poptimizer/poptimizer/poptimizer/data/domain/handlers.py\", line 29, in _load_by_id_and_handle_event\r\n    return await table.handle_event(event)\r\n  File \"/Users/Documents/PythonProjects/poptimizer/poptimizer/poptimizer/data/domain/tables/base.py\", line 71, in handle_event\r\n    df_new = await self._prepare_df(event)\r\n  File \"/Users/Documents/PythonProjects/poptimizer/poptimizer/poptimizer/data/domain/tables/quotes.py\", line 39, in _prepare_df\r\n    df_new = await self._load_df(event)\r\n  File \"/Users/Documents/PythonProjects/poptimizer/poptimizer/poptimizer/data/domain/tables/quotes.py\", line 70, in _load_df\r\n    await asyncio.gather(*aws),\r\n  File \"/Users/Documents/PythonProjects/poptimizer/poptimizer/poptimizer/data/adapters/gateways/moex.py\", line 141, in __call__\r\n    json = await aiomoex.get_market_candles(\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/site-packages/aiomoex/candles.py\", line 116, in get_market_candles\r\n    return await request_helpers.get_long_data(session, url, table, query)\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/site-packages/aiomoex/request_helpers.py\", line 137, in get_long_data\r\n    table_dict = await iss.get_all()\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/site-packages/aiomoex/client.py\", line 112, in get_all\r\n    async for block in self:\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/site-packages/aiomoex/client.py\", line 131, in _iterator_maker\r\n    respond = await self.get(start)\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/site-packages/aiomoex/client.py\", line 94, in get\r\n    async with self._session.get(url, params=query) as respond:\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/site-packages/aiohttp/client.py\", line 1140, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/site-packages/aiohttp/client.py\", line 535, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/site-packages/aiohttp/connector.py\", line 543, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/site-packages/aiohttp/connector.py\", line 906, in _create_connection\r\n    _, proto = await self._create_direct_connection(req, traces, timeout)\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/site-packages/aiohttp/connector.py\", line 1205, in _create_direct_connection\r\n    raise last_exc\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/site-packages/aiohttp/connector.py\", line 1174, in _create_direct_connection\r\n    transp, proto = await self._wrap_create_connection(\r\n  File \"/Users/opt/miniconda3/envs/torch39/lib/python3.9/site-packages/aiohttp/connector.py\", line 991, in _wrap_create_connection\r\n    raise client_error(req.connection_key, exc) from exc\r\naiohttp.client_exceptions.ClientConnectorError: Cannot connect to host iss.moex.com:443 ssl:default [Invalid argument]\r\n","closed_by":{"login":"ArjaraGit","id":57317188,"node_id":"MDQ6VXNlcjU3MzE3MTg4","avatar_url":"https://avatars.githubusercontent.com/u/57317188?v=4","gravatar_id":"","url":"https://api.github.com/users/ArjaraGit","html_url":"https://github.com/ArjaraGit","followers_url":"https://api.github.com/users/ArjaraGit/followers","following_url":"https://api.github.com/users/ArjaraGit/following{/other_user}","gists_url":"https://api.github.com/users/ArjaraGit/gists{/gist_id}","starred_url":"https://api.github.com/users/ArjaraGit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ArjaraGit/subscriptions","organizations_url":"https://api.github.com/users/ArjaraGit/orgs","repos_url":"https://api.github.com/users/ArjaraGit/repos","events_url":"https://api.github.com/users/ArjaraGit/events{/privacy}","received_events_url":"https://api.github.com/users/ArjaraGit/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/101/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/101/timeline","performed_via_github_app":null,"state_reason":"completed"}