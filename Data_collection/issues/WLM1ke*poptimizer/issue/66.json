{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/66","repository_url":"https://api.github.com/repos/WLM1ke/poptimizer","labels_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/66/labels{/name}","comments_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/66/comments","events_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/66/events","html_url":"https://github.com/WLM1ke/poptimizer/issues/66","id":1040300464,"node_id":"I_kwDOCYyMws4-Abmw","number":66,"title":"CursorNotFound","user":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-10-30T21:00:28Z","updated_at":"2021-11-10T18:39:00Z","closed_at":"2021-11-10T18:39:00Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Подскажите пожалуйста с чем эта может быть связана, и как её лечить/избегать:\r\n```\r\nForecasts: 101it [23:21, 13.88s/it]\r\nTraceback (most recent call last):\r\n  File \"PATH_TO\\poptimizer\\optimize.py\", line 12, in opt\r\n    optimize(date, ports=ports)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\__main__.py\", line 23, in optimize\r\n    opt = Optimizer(port)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\portfolio\\optimizer.py\", line 38, in __init__\r\n    self._metrics = metrics.MetricsResample(portfolio)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\portfolio\\metrics.py\", line 158, in __init__\r\n    for forecast in evolve.get_forecasts(tickers, date):\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\evolve\\forecaster.py\", line 142, in get_forecasts\r\n    return cache()\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\evolve\\forecaster.py\", line 98, in __call__\r\n    return self._create_cache()\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\evolve\\forecaster.py\", line 116, in _create_cache\r\n    forecasts = Forecasts(self._tickers, self._date)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\evolve\\forecaster.py\", line 31, in __init__\r\n    self._forecasts = forecasts or _prepare_forecasts(tickers, date)\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\evolve\\forecaster.py\", line 61, in _prepare_forecasts\r\n    for organism in tqdm.tqdm(population.get_oldest(), desc=\"Forecasts\"):\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\tqdm\\std.py\", line 1185, in __iter__\r\n    for obj in iterable:\r\n  File \"PATH_TO\\poptimizer\\poptimizer\\evolve\\population.py\", line 249, in get_oldest\r\n    for id_dict in collection.aggregate(pipeline):\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\command_cursor.py\", line 259, in next\r\n    doc = self._try_next(True)\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\command_cursor.py\", line 270, in _try_next\r\n    self._refresh()\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\command_cursor.py\", line 196, in _refresh\r\n    self.__send_message(\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\command_cursor.py\", line 139, in __send_message\r\n    response = client._run_operation_with_response(\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\mongo_client.py\", line 1368, in _run_operation_with_response\r\n    return self._retryable_read(\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\mongo_client.py\", line 1471, in _retryable_read\r\n    return func(session, server, sock_info, slave_ok)\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\mongo_client.py\", line 1360, in _cmd\r\n    return server.run_operation_with_response(\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\server.py\", line 135, in run_operation_with_response\r\n    _check_command_response(first, sock_info.max_wire_version)\r\n  File \"PATH_TO\\anaconda3\\envs\\finan\\lib\\site-packages\\pymongo\\helpers.py\", line 162, in _check_command_response\r\n    raise CursorNotFound(errmsg, code, response, max_wire_version)\r\npymongo.errors.CursorNotFound: cursor id 9024041513465701594 not found, full error: {'ok': 0.0, 'errmsg': 'cursor id 9024041513465701594 not found', 'code': 43, 'codeName': 'CursorNotFound'}\r\n```\r\nЕсли _дать_ больше вычислительных ресурсов, то отрабатывает нормально:\r\n```\r\nForecasts: 116it [10:30,  5.43s/it]\r\nПОРТФЕЛЬ - 2021-10-29\r\n```\r\n\r\nПервая [ссылка ](https://stackoverflow.com/questions/24199729/pymongo-errors-cursornotfound-cursor-id-not-valid-at-server) по поводу говорит, что сюда \r\nhttps://github.com/WLM1ke/poptimizer/blob/084ac14ca6212a5b14bea5bbc9bb575da077ffb0/poptimizer/evolve/population.py#L239\r\nможно добавить параметр \r\n`no_cursor_timeout=True`\r\n\r\n\r\n\r\nв ту сторону смотрю? там правда есть уточнение **not valid at server**, а здесь такого нет...\r\n\r\n","closed_by":{"login":"RomaKoks","id":8873242,"node_id":"MDQ6VXNlcjg4NzMyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/8873242?v=4","gravatar_id":"","url":"https://api.github.com/users/RomaKoks","html_url":"https://github.com/RomaKoks","followers_url":"https://api.github.com/users/RomaKoks/followers","following_url":"https://api.github.com/users/RomaKoks/following{/other_user}","gists_url":"https://api.github.com/users/RomaKoks/gists{/gist_id}","starred_url":"https://api.github.com/users/RomaKoks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RomaKoks/subscriptions","organizations_url":"https://api.github.com/users/RomaKoks/orgs","repos_url":"https://api.github.com/users/RomaKoks/repos","events_url":"https://api.github.com/users/RomaKoks/events{/privacy}","received_events_url":"https://api.github.com/users/RomaKoks/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/66/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/66/timeline","performed_via_github_app":null,"state_reason":"completed"}