{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/91","repository_url":"https://api.github.com/repos/WLM1ke/poptimizer","labels_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/91/labels{/name}","comments_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/91/comments","events_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/91/events","html_url":"https://github.com/WLM1ke/poptimizer/issues/91","id":1096874810,"node_id":"I_kwDOCYyMws5BYPs6","number":91,"title":"Дамп Percentiles must be in the range [0, 100]","user":{"login":"Snest1","id":26552339,"node_id":"MDQ6VXNlcjI2NTUyMzM5","avatar_url":"https://avatars.githubusercontent.com/u/26552339?v=4","gravatar_id":"","url":"https://api.github.com/users/Snest1","html_url":"https://github.com/Snest1","followers_url":"https://api.github.com/users/Snest1/followers","following_url":"https://api.github.com/users/Snest1/following{/other_user}","gists_url":"https://api.github.com/users/Snest1/gists{/gist_id}","starred_url":"https://api.github.com/users/Snest1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Snest1/subscriptions","organizations_url":"https://api.github.com/users/Snest1/orgs","repos_url":"https://api.github.com/users/Snest1/repos","events_url":"https://api.github.com/users/Snest1/events{/privacy}","received_events_url":"https://api.github.com/users/Snest1/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2022-01-08T09:05:15Z","updated_at":"2022-05-18T13:41:02Z","closed_at":"2022-05-18T13:41:02Z","author_association":"NONE","active_lock_reason":null,"body":"Добрый день, Михаил.\r\n\r\nНа тестовом портфеле стал возникать дамп.  Подскажите пож, как с ним бороться.\r\n\r\nRUR: 100000\r\nUSD: 0\r\npositions:\r\n  QIWI: 5\r\n  FXMM: 10\r\n  FXRU: 35\r\n  GAZP: 104\r\n  SBER: 145\r\n\r\n-- lgr.lgr:\r\n2022-01-08 08:58:22.698136 | INFO | Config | config.py | line#46 | pid#2548 | {}\r\n2022-01-08 08:58:23.708614 | INFO | EventBus | thread.py | line#52 | pid#2548 | DateCheckRequired(timestamp=datetime.datetime(2022, 1, 8, 8, 58, 23, 706201))\r\n2022-01-08 08:58:27.317486 | INFO | root | __main__.py | line#33 | pid#2548 | ПОРТФЕЛЬ [base] - 2022-01-04\r\n\r\nКоличество бумаг - 5\r\nОткрытых позиций - 5\r\nЭффективных позиций - 3\r\n\r\n           LOT_SIZE    SHARES      PRICE     VALUE    WEIGHT       TURNOVER\r\nSBER             10     145.0     304.24   44114.8  0.188128   60465.750212\r\nGAZP             10     104.0     352.55   36665.2  0.156359   83952.855062\r\nFXRU              1      35.0     953.00   33355.0  0.142242      69.284629\r\nFXMM              1      10.0    1728.40   17284.0  0.073708     124.557150\r\nQIWI              1       5.0     615.00    3075.0  0.013113     232.440619\r\nCASH              1  100000.0       1.00  100000.0  0.426450  144844.887673\r\nPORTFOLIO         1       1.0  234494.00  234494.0  1.000000  144844.887673\r\n2022-01-08 08:58:27.492025 | INFO | root | __main__.py | line#34 | pid#2548 | \r\nКЛЮЧЕВЫЕ МЕТРИКИ ПОРТФЕЛЯ\r\n\r\nHistory days - (63 <-> 104 <-> 191)\r\nCorrelation - (0.47% <-> 1.49% <-> 2.49%)\r\nShrinkage - (8.67% <-> 10.61% <-> 14.96%)\r\nRisk aversion - (1.00 <-> 1.00 <-> 1.00)\r\nError tolerance - (0.00 <-> 0.00 <-> 0.01)\r\n\r\n               MEAN       STD      BETA     R_ADJ      GRAD\r\nFXMM       0.922696  2.211875  0.297528  1.074571  0.689361\r\nFXRU       0.934053  2.207661  0.341905  1.057338  0.718068\r\nGAZP       0.965154  2.218428  2.478487  0.204596  0.016911\r\nQIWI       0.955321  2.226396  1.248873  0.453727  0.209521\r\nSBER       0.938340  2.218428  2.758477  0.172311 -0.027261\r\nCASH       0.000000  0.000000  0.000000  0.217704 -0.129250\r\nPORTFOLIO  0.543051  0.659848  1.000000  0.235044  0.000000\r\n\r\nКонсервативная доходность: -43.72%\r\nКонсервативный риск:        299.60%\r\nКонсервативная метрика:    -127.74%\r\nОценка просадки:            80.18%\r\n\r\n--\r\n\r\nC:\\Python\\poptimizer-master_2022_01\\poptimizer\\portfolio\\metrics.py:88: RuntimeWarning: invalid value encountered in matmul\r\n  portfolio_var = weight.reshape(1, -1) @ cov @ weight.reshape(-1, 1)  # noqa: WPS221\r\nC:\\Python\\poptimizer-master_2022_01\\poptimizer\\portfolio\\metrics.py:100: RuntimeWarning: invalid value encountered in matmul\r\n  beta = cov @ weight.reshape(-1, 1)\r\n--- Logging error ---\r\nTraceback (most recent call last):\r\n  File \"C:\\Python\\Anaconda3\\lib\\logging\\handlers.py\", line 73, in emit\r\n    if self.shouldRollover(record):\r\n  File \"C:\\Python\\Anaconda3\\lib\\logging\\handlers.py\", line 191, in shouldRollover\r\n    msg = \"%s\\n\" % self.format(record)\r\n  File \"C:\\Python\\Anaconda3\\lib\\logging\\__init__.py\", line 927, in format\r\n    return fmt.format(record)\r\n  File \"C:\\Python\\Anaconda3\\lib\\logging\\__init__.py\", line 663, in format\r\n    record.message = record.getMessage()\r\n  File \"C:\\Python\\Anaconda3\\lib\\logging\\__init__.py\", line 365, in getMessage\r\n    msg = str(self.msg)\r\n  File \"C:\\Python\\poptimizer-master_2022_01\\poptimizer\\portfolio\\optimizer_resample.py\", line 45, in __str__\r\n    df = self._for_trade()\r\n  File \"C:\\Python\\poptimizer-master_2022_01\\poptimizer\\portfolio\\optimizer_resample.py\", line 68, in _for_trade\r\n    conf_int = self._prepare_bounds()\r\n  File \"C:\\Python\\poptimizer-master_2022_01\\poptimizer\\portfolio\\optimizer_resample.py\", line 114, in _prepare_bounds\r\n    conf_int = conf_int.apply(\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\pandas\\core\\frame.py\", line 8740, in apply\r\n    return op.apply()\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\pandas\\core\\apply.py\", line 688, in apply\r\n    return self.apply_standard()\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\pandas\\core\\apply.py\", line 812, in apply_standard\r\n    results, res_index = self.apply_series_generator()\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\pandas\\core\\apply.py\", line 828, in apply_series_generator\r\n    results[i] = self.f(v)\r\n  File \"C:\\Python\\poptimizer-master_2022_01\\poptimizer\\portfolio\\optimizer_resample.py\", line 115, in <lambda>\r\n    lambda grad: _grad_conf_int(grad, p_value),\r\n  File \"C:\\Python\\poptimizer-master_2022_01\\poptimizer\\portfolio\\optimizer_resample.py\", line 184, in _grad_conf_int\r\n    interval = stats.bootstrap(\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\scipy\\stats\\_bootstrap.py\", line 454, in bootstrap\r\n    ci_l = percentile_fun(theta_hat_b, interval[0]*100)\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\scipy\\stats\\_bootstrap.py\", line 78, in _percentile_along_axis\r\n    percentiles[indices] = np.percentile(theta_hat_b_i, alpha_i)\r\n  File \"<__array_function__ internals>\", line 180, in percentile\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\numpy\\lib\\function_base.py\", line 4133, in percentile\r\n    raise ValueError(\"Percentiles must be in the range [0, 100]\")\r\nValueError: Percentiles must be in the range [0, 100]\r\nCall stack:\r\n  File \"C:\\Python\\Anaconda3\\lib\\runpy.py\", line 197, in _run_module_as_main\r\n    return _run_code(code, main_globals, None,\r\n  File \"C:\\Python\\Anaconda3\\lib\\runpy.py\", line 87, in _run_code\r\n    exec(code, run_globals)\r\n  File \"C:\\Python\\poptimizer-master_2022_01\\poptimizer\\__main__.py\", line 46, in <module>\r\n    app(prog_name=\"poptimizer\")\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\typer\\main.py\", line 214, in __call__\r\n    return get_command(self)(*args, **kwargs)\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\click\\core.py\", line 1128, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\click\\core.py\", line 1053, in main\r\n    rv = self.invoke(ctx)\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\click\\core.py\", line 1659, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\click\\core.py\", line 1395, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\click\\core.py\", line 754, in invoke\r\n    return __callback(*args, **kwargs)\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\typer\\main.py\", line 500, in wrapper\r\n    return callback(**use_params)  # type: ignore\r\n  File \"C:\\Python\\poptimizer-master_2022_01\\poptimizer\\__main__.py\", line 35, in optimize\r\n    LOGGER.info(opt)\r\nMessage: <poptimizer.portfolio.optimizer_resample.Optimizer object at 0x000000062D81AA60>\r\nArguments: ()\r\n--- Logging error ---\r\nTraceback (most recent call last):\r\n  File \"C:\\Python\\Anaconda3\\lib\\logging\\__init__.py\", line 1083, in emit\r\n    msg = self.format(record)\r\n  File \"C:\\Python\\Anaconda3\\lib\\logging\\__init__.py\", line 927, in format\r\n    return fmt.format(record)\r\n  File \"C:\\Python\\Anaconda3\\lib\\logging\\__init__.py\", line 663, in format\r\n    record.message = record.getMessage()\r\n  File \"C:\\Python\\Anaconda3\\lib\\logging\\__init__.py\", line 365, in getMessage\r\n    msg = str(self.msg)\r\n  File \"C:\\Python\\poptimizer-master_2022_01\\poptimizer\\portfolio\\optimizer_resample.py\", line 45, in __str__\r\n    df = self._for_trade()\r\n  File \"C:\\Python\\poptimizer-master_2022_01\\poptimizer\\portfolio\\optimizer_resample.py\", line 68, in _for_trade\r\n    conf_int = self._prepare_bounds()\r\n  File \"C:\\Python\\poptimizer-master_2022_01\\poptimizer\\portfolio\\optimizer_resample.py\", line 114, in _prepare_bounds\r\n    conf_int = conf_int.apply(\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\pandas\\core\\frame.py\", line 8740, in apply\r\n    return op.apply()\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\pandas\\core\\apply.py\", line 688, in apply\r\n    return self.apply_standard()\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\pandas\\core\\apply.py\", line 812, in apply_standard\r\n    results, res_index = self.apply_series_generator()\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\pandas\\core\\apply.py\", line 828, in apply_series_generator\r\n    results[i] = self.f(v)\r\n  File \"C:\\Python\\poptimizer-master_2022_01\\poptimizer\\portfolio\\optimizer_resample.py\", line 115, in <lambda>\r\n    lambda grad: _grad_conf_int(grad, p_value),\r\n  File \"C:\\Python\\poptimizer-master_2022_01\\poptimizer\\portfolio\\optimizer_resample.py\", line 184, in _grad_conf_int\r\n    interval = stats.bootstrap(\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\scipy\\stats\\_bootstrap.py\", line 454, in bootstrap\r\n    ci_l = percentile_fun(theta_hat_b, interval[0]*100)\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\scipy\\stats\\_bootstrap.py\", line 78, in _percentile_along_axis\r\n    percentiles[indices] = np.percentile(theta_hat_b_i, alpha_i)\r\n  File \"<__array_function__ internals>\", line 180, in percentile\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\numpy\\lib\\function_base.py\", line 4133, in percentile\r\n    raise ValueError(\"Percentiles must be in the range [0, 100]\")\r\nValueError: Percentiles must be in the range [0, 100]\r\nCall stack:\r\n  File \"C:\\Python\\Anaconda3\\lib\\runpy.py\", line 197, in _run_module_as_main\r\n    return _run_code(code, main_globals, None,\r\n  File \"C:\\Python\\Anaconda3\\lib\\runpy.py\", line 87, in _run_code\r\n    exec(code, run_globals)\r\n  File \"C:\\Python\\poptimizer-master_2022_01\\poptimizer\\__main__.py\", line 46, in <module>\r\n    app(prog_name=\"poptimizer\")\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\typer\\main.py\", line 214, in __call__\r\n    return get_command(self)(*args, **kwargs)\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\click\\core.py\", line 1128, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\click\\core.py\", line 1053, in main\r\n    rv = self.invoke(ctx)\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\click\\core.py\", line 1659, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\click\\core.py\", line 1395, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\click\\core.py\", line 754, in invoke\r\n    return __callback(*args, **kwargs)\r\n  File \"C:\\Users\\sn\\AppData\\Roaming\\Python\\Python39\\site-packages\\typer\\main.py\", line 500, in wrapper\r\n    return callback(**use_params)  # type: ignore\r\n  File \"C:\\Python\\poptimizer-master_2022_01\\poptimizer\\__main__.py\", line 35, in optimize\r\n    LOGGER.info(opt)\r\nMessage: <poptimizer.portfolio.optimizer_resample.Optimizer object at 0x000000062D81AA60>\r\nArguments: ()\r\n","closed_by":{"login":"WLM1ke","id":35304528,"node_id":"MDQ6VXNlcjM1MzA0NTI4","avatar_url":"https://avatars.githubusercontent.com/u/35304528?v=4","gravatar_id":"","url":"https://api.github.com/users/WLM1ke","html_url":"https://github.com/WLM1ke","followers_url":"https://api.github.com/users/WLM1ke/followers","following_url":"https://api.github.com/users/WLM1ke/following{/other_user}","gists_url":"https://api.github.com/users/WLM1ke/gists{/gist_id}","starred_url":"https://api.github.com/users/WLM1ke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WLM1ke/subscriptions","organizations_url":"https://api.github.com/users/WLM1ke/orgs","repos_url":"https://api.github.com/users/WLM1ke/repos","events_url":"https://api.github.com/users/WLM1ke/events{/privacy}","received_events_url":"https://api.github.com/users/WLM1ke/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/91/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/WLM1ke/poptimizer/issues/91/timeline","performed_via_github_app":null,"state_reason":"completed"}