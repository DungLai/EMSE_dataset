{"url":"https://api.github.com/repos/sksq96/pytorch-summary/issues/159","repository_url":"https://api.github.com/repos/sksq96/pytorch-summary","labels_url":"https://api.github.com/repos/sksq96/pytorch-summary/issues/159/labels{/name}","comments_url":"https://api.github.com/repos/sksq96/pytorch-summary/issues/159/comments","events_url":"https://api.github.com/repos/sksq96/pytorch-summary/issues/159/events","html_url":"https://github.com/sksq96/pytorch-summary/issues/159","id":774085017,"node_id":"MDU6SXNzdWU3NzQwODUwMTc=","number":159,"title":"Order of torchsummary and model.eval() change model behaviour","user":{"login":"maikefer","id":11552157,"node_id":"MDQ6VXNlcjExNTUyMTU3","avatar_url":"https://avatars.githubusercontent.com/u/11552157?v=4","gravatar_id":"","url":"https://api.github.com/users/maikefer","html_url":"https://github.com/maikefer","followers_url":"https://api.github.com/users/maikefer/followers","following_url":"https://api.github.com/users/maikefer/following{/other_user}","gists_url":"https://api.github.com/users/maikefer/gists{/gist_id}","starred_url":"https://api.github.com/users/maikefer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maikefer/subscriptions","organizations_url":"https://api.github.com/users/maikefer/orgs","repos_url":"https://api.github.com/users/maikefer/repos","events_url":"https://api.github.com/users/maikefer/events{/privacy}","received_events_url":"https://api.github.com/users/maikefer/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-12-23T23:03:38Z","updated_at":"2021-02-22T09:59:23Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Dear torchsummary developer(s),\r\n\r\nI really appreciate the function of your model but I found a kinda big thing/bug/feature today that fucked up a lot of my development (and computation time). \r\n\r\nApparently, the order in which you use summary(model, ()) and model.eval() matters a lot. Here is an easy example:\r\n\r\nwithout the help of torchsummary:\r\n```\r\nmodel0 = models.resnet18(pretrained=True)\r\nmodel0.eval()\r\ndummy_input0 = torch.from_numpy(np.ones(shape=(1, 3, 224, 224))).float()\r\nwith torch.no_grad():\r\n    output0 = model0(dummy_input0)\r\nprint(output0[0, :10])\r\n```\r\nthis results in\r\n\r\n```\r\n[-0.0391,  0.1145, -1.7968, -1.2343, -0.8190,  0.3240, -2.1866, -1.2877, -1.9019, -0.7315]\r\n```\r\n\r\nAwesome - now we know what we can expect as output.\r\n\r\nLet's try with torchsummary after the .eval():\r\n```\r\nmodel1 = models.resnet18(pretrained=True)\r\nmodel1.eval()\r\ntorchsummary.summary(model1, (3, 224, 224))\r\ndummy_input1 = torch.from_numpy(np.ones(shape=(1, 3, 224, 224))).float()\r\nwith torch.no_grad():\r\n    output1 = model1(dummy_input1)\r\nprint(output1[0, :10])\r\n```\r\nresults in\r\n```\r\n[-0.0391,  0.1145, -1.7968, -1.2343, -0.8190,  0.3240, -2.1866, -1.2877, -1.9019, -0.7315]`\r\n```\r\nStill working - cool.\r\n\r\nLet's now mix some things up a bit: Let's try calling torchsummary before .eval():\r\n```\r\nmodel2 = models.resnet18(pretrained=True)\r\ntorchsummary.summary(model2, (3, 224, 224))\r\nmodel2.eval()\r\n\r\ndummy_input2 = torch.from_numpy(np.ones(shape=(1, 3, 224, 224))).float()\r\nwith torch.no_grad():\r\n    output2 = model2(dummy_input2)\r\nprint(output2[0, :10])\r\n```\r\nresults in \r\n```\r\n[-0.7597, -0.2707, -1.3314, -1.1444, -0.6266, -0.0564, -1.3227, -0.8387, -1.7826, -0.7907]\r\n```\r\nwell now something weird happened.\r\n\r\nThis happens on cpu, gpu and 2 gpus. I'm using torchsummary 1.5.1, Python 3.7, PyTorch 1.7.0, CUDA 10.1. and Cudnn 7.6\r\n\r\nCan you explain why this happens and if this is intended or a bug? It would be great if you added this behaviour to your documentation (or did I miss something?).\r\nThanks!\r\n\r\nUgh, and happy christmas! ðŸŽ„ ðŸŽ… \r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/sksq96/pytorch-summary/issues/159/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sksq96/pytorch-summary/issues/159/timeline","performed_via_github_app":null,"state_reason":null}