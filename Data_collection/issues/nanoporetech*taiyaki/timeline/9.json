[{"url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/comments/486597851","html_url":"https://github.com/nanoporetech/taiyaki/issues/9#issuecomment-486597851","issue_url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/9","id":486597851,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NjU5Nzg1MQ==","user":{"login":"tmassingham-ont","id":19410440,"node_id":"MDQ6VXNlcjE5NDEwNDQw","avatar_url":"https://avatars.githubusercontent.com/u/19410440?v=4","gravatar_id":"","url":"https://api.github.com/users/tmassingham-ont","html_url":"https://github.com/tmassingham-ont","followers_url":"https://api.github.com/users/tmassingham-ont/followers","following_url":"https://api.github.com/users/tmassingham-ont/following{/other_user}","gists_url":"https://api.github.com/users/tmassingham-ont/gists{/gist_id}","starred_url":"https://api.github.com/users/tmassingham-ont/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tmassingham-ont/subscriptions","organizations_url":"https://api.github.com/users/tmassingham-ont/orgs","repos_url":"https://api.github.com/users/tmassingham-ont/repos","events_url":"https://api.github.com/users/tmassingham-ont/events{/privacy}","received_events_url":"https://api.github.com/users/tmassingham-ont/received_events","type":"User","site_admin":false},"created_at":"2019-04-25T09:28:14Z","updated_at":"2019-04-25T09:28:14Z","author_association":"CONTRIBUTOR","body":"Hi.  Pytorch allocates memory on GPU dynamically, so `nvidia-smi` may not show the instantaneous amount in use.  The error message suggests that almost all of the memory has been allocated.\r\n\r\nTwo possible solutions, depending on your goals, are:\r\n- add `--size 96` to train a smaller model (size=96 is a fast model, size=256 is high accuracy)\r\n- add `--min_batch_size 48` to reduce the batch size (default is set for GPUs with 8G)\r\n\r\nGood luck training.","reactions":{"url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/comments/486597851/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tmassingham-ont","id":19410440,"node_id":"MDQ6VXNlcjE5NDEwNDQw","avatar_url":"https://avatars.githubusercontent.com/u/19410440?v=4","gravatar_id":"","url":"https://api.github.com/users/tmassingham-ont","html_url":"https://github.com/tmassingham-ont","followers_url":"https://api.github.com/users/tmassingham-ont/followers","following_url":"https://api.github.com/users/tmassingham-ont/following{/other_user}","gists_url":"https://api.github.com/users/tmassingham-ont/gists{/gist_id}","starred_url":"https://api.github.com/users/tmassingham-ont/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tmassingham-ont/subscriptions","organizations_url":"https://api.github.com/users/tmassingham-ont/orgs","repos_url":"https://api.github.com/users/tmassingham-ont/repos","events_url":"https://api.github.com/users/tmassingham-ont/events{/privacy}","received_events_url":"https://api.github.com/users/tmassingham-ont/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/comments/496222517","html_url":"https://github.com/nanoporetech/taiyaki/issues/9#issuecomment-496222517","issue_url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/9","id":496222517,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NjIyMjUxNw==","user":{"login":"lpryszcz","id":988152,"node_id":"MDQ6VXNlcjk4ODE1Mg==","avatar_url":"https://avatars.githubusercontent.com/u/988152?v=4","gravatar_id":"","url":"https://api.github.com/users/lpryszcz","html_url":"https://github.com/lpryszcz","followers_url":"https://api.github.com/users/lpryszcz/followers","following_url":"https://api.github.com/users/lpryszcz/following{/other_user}","gists_url":"https://api.github.com/users/lpryszcz/gists{/gist_id}","starred_url":"https://api.github.com/users/lpryszcz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lpryszcz/subscriptions","organizations_url":"https://api.github.com/users/lpryszcz/orgs","repos_url":"https://api.github.com/users/lpryszcz/repos","events_url":"https://api.github.com/users/lpryszcz/events{/privacy}","received_events_url":"https://api.github.com/users/lpryszcz/received_events","type":"User","site_admin":false},"created_at":"2019-05-27T14:00:08Z","updated_at":"2019-05-27T14:02:14Z","author_association":"CONTRIBUTOR","body":"Hi I have similar issue. It's weird, as I only 4.36 GB out of 10.92 is allocated, still `train_abinitio.py` claims only 1.22 GiB is free. Setting `--batch_size 48` reduced memory usage to ~5GiB. \r\n\r\n```\r\ntime train_abinitio.py --device cuda:0 $HOME/src/taiyaki/models/mGru_flipflop.py chunks.hdf5 chunks.fa\r\n* Taiyaki version 4.1.0\r\n* Command line\r\n/home/lpryszcz/src/taiyaki/venv/bin/train_abinitio.py --device cuda:0 /home/lpryszcz/src/taiyaki/models/mGru_flipflop.py chunks.hdf5 chunks.fa\r\n* Loading data from chunks.hdf5\r\n* Per read file MD5 ce162d56e27817a1f8c60e02e7a0ea28\r\n* Loaded 44735 reads from chunks.hdf5.\r\n* Loaded references from chunks.fa.\r\n* Written pickle of processed references to chunks.pkl for future use.\r\n* Reading network from /home/lpryszcz/src/taiyaki/models/mGru_flipflop.py\r\n* Network has 285160 parameters.\r\n* Dumping initial model\r\n* Training\r\nTraceback (most recent call last):\r\n  File \"/home/lpryszcz/src/taiyaki/venv/bin/train_abinitio.py\", line 7, in <module>\r\n    exec(compile(f.read(), __file__, 'exec'))\r\n  File \"/home/lpryszcz/src/taiyaki/bin/train_abinitio.py\", line 168, in <module>\r\n    outputs = network(indata)\r\n  File \"/home/lpryszcz/src/taiyaki/venv/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 489, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/home/lpryszcz/src/taiyaki/taiyaki/layers.py\", line 487, in forward\r\n    x = layer(x)\r\n  File \"/home/lpryszcz/src/taiyaki/venv/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 489, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/home/lpryszcz/src/taiyaki/taiyaki/layers.py\", line 80, in forward\r\n    return reverse(self.layer(reverse(x)))\r\n  File \"/home/lpryszcz/src/taiyaki/venv/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 489, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/home/lpryszcz/src/taiyaki/taiyaki/layers.py\", line 362, in forward\r\n    y, hy = self.cudnn_gru.forward(x)\r\n  File \"/home/lpryszcz/src/taiyaki/venv/lib/python3.7/site-packages/torch/nn/modules/rnn.py\", line 179, in forward\r\n    self.dropout, self.training, self.bidirectional, self.batch_first)\r\nRuntimeError: CUDA out of memory. Tried to allocate 1.37 GiB (GPU 0; 10.92 GiB total capacity; 4.36 GiB already allocated; 1.23 GiB free; 386.00 KiB cached)\r\n```","reactions":{"url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/comments/496222517/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lpryszcz","id":988152,"node_id":"MDQ6VXNlcjk4ODE1Mg==","avatar_url":"https://avatars.githubusercontent.com/u/988152?v=4","gravatar_id":"","url":"https://api.github.com/users/lpryszcz","html_url":"https://github.com/lpryszcz","followers_url":"https://api.github.com/users/lpryszcz/followers","following_url":"https://api.github.com/users/lpryszcz/following{/other_user}","gists_url":"https://api.github.com/users/lpryszcz/gists{/gist_id}","starred_url":"https://api.github.com/users/lpryszcz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lpryszcz/subscriptions","organizations_url":"https://api.github.com/users/lpryszcz/orgs","repos_url":"https://api.github.com/users/lpryszcz/repos","events_url":"https://api.github.com/users/lpryszcz/events{/privacy}","received_events_url":"https://api.github.com/users/lpryszcz/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/comments/496290174","html_url":"https://github.com/nanoporetech/taiyaki/issues/9#issuecomment-496290174","issue_url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/9","id":496290174,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NjI5MDE3NA==","user":{"login":"tmassingham-ont","id":19410440,"node_id":"MDQ6VXNlcjE5NDEwNDQw","avatar_url":"https://avatars.githubusercontent.com/u/19410440?v=4","gravatar_id":"","url":"https://api.github.com/users/tmassingham-ont","html_url":"https://github.com/tmassingham-ont","followers_url":"https://api.github.com/users/tmassingham-ont/followers","following_url":"https://api.github.com/users/tmassingham-ont/following{/other_user}","gists_url":"https://api.github.com/users/tmassingham-ont/gists{/gist_id}","starred_url":"https://api.github.com/users/tmassingham-ont/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tmassingham-ont/subscriptions","organizations_url":"https://api.github.com/users/tmassingham-ont/orgs","repos_url":"https://api.github.com/users/tmassingham-ont/repos","events_url":"https://api.github.com/users/tmassingham-ont/events{/privacy}","received_events_url":"https://api.github.com/users/tmassingham-ont/received_events","type":"User","site_admin":false},"created_at":"2019-05-27T19:23:31Z","updated_at":"2019-05-27T19:23:31Z","author_association":"CONTRIBUTOR","body":"Yes, this looks suspicious.  There is a large gap between the sum of the amount allocated and amount free, and the total capacity: is there any chance that another process is running on the GPU at the same time?\r\nTo help replicate, which version of pytorch & CUDA are you using please?","reactions":{"url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/comments/496290174/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tmassingham-ont","id":19410440,"node_id":"MDQ6VXNlcjE5NDEwNDQw","avatar_url":"https://avatars.githubusercontent.com/u/19410440?v=4","gravatar_id":"","url":"https://api.github.com/users/tmassingham-ont","html_url":"https://github.com/tmassingham-ont","followers_url":"https://api.github.com/users/tmassingham-ont/followers","following_url":"https://api.github.com/users/tmassingham-ont/following{/other_user}","gists_url":"https://api.github.com/users/tmassingham-ont/gists{/gist_id}","starred_url":"https://api.github.com/users/tmassingham-ont/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tmassingham-ont/subscriptions","organizations_url":"https://api.github.com/users/tmassingham-ont/orgs","repos_url":"https://api.github.com/users/tmassingham-ont/repos","events_url":"https://api.github.com/users/tmassingham-ont/events{/privacy}","received_events_url":"https://api.github.com/users/tmassingham-ont/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/comments/497329823","html_url":"https://github.com/nanoporetech/taiyaki/issues/9#issuecomment-497329823","issue_url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/9","id":497329823,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzMyOTgyMw==","user":{"login":"lpryszcz","id":988152,"node_id":"MDQ6VXNlcjk4ODE1Mg==","avatar_url":"https://avatars.githubusercontent.com/u/988152?v=4","gravatar_id":"","url":"https://api.github.com/users/lpryszcz","html_url":"https://github.com/lpryszcz","followers_url":"https://api.github.com/users/lpryszcz/followers","following_url":"https://api.github.com/users/lpryszcz/following{/other_user}","gists_url":"https://api.github.com/users/lpryszcz/gists{/gist_id}","starred_url":"https://api.github.com/users/lpryszcz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lpryszcz/subscriptions","organizations_url":"https://api.github.com/users/lpryszcz/orgs","repos_url":"https://api.github.com/users/lpryszcz/repos","events_url":"https://api.github.com/users/lpryszcz/events{/privacy}","received_events_url":"https://api.github.com/users/lpryszcz/received_events","type":"User","site_admin":false},"created_at":"2019-05-30T13:30:40Z","updated_at":"2019-05-30T13:31:53Z","author_association":"CONTRIBUTOR","body":"| NVIDIA-SMI 418.67       Driver Version: 418.67       CUDA Version: 10.1     | on GTX1080 Ti\r\n\r\n(taiyaki) (base) $ python3 -c 'import torch; print(torch.__version__)'\r\n1.0.0\r\n","reactions":{"url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/comments/497329823/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lpryszcz","id":988152,"node_id":"MDQ6VXNlcjk4ODE1Mg==","avatar_url":"https://avatars.githubusercontent.com/u/988152?v=4","gravatar_id":"","url":"https://api.github.com/users/lpryszcz","html_url":"https://github.com/lpryszcz","followers_url":"https://api.github.com/users/lpryszcz/followers","following_url":"https://api.github.com/users/lpryszcz/following{/other_user}","gists_url":"https://api.github.com/users/lpryszcz/gists{/gist_id}","starred_url":"https://api.github.com/users/lpryszcz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lpryszcz/subscriptions","organizations_url":"https://api.github.com/users/lpryszcz/orgs","repos_url":"https://api.github.com/users/lpryszcz/repos","events_url":"https://api.github.com/users/lpryszcz/events{/privacy}","received_events_url":"https://api.github.com/users/lpryszcz/received_events","type":"User","site_admin":false}},{"id":2521647549,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDI1MjE2NDc1NDk=","url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/events/2521647549","actor":{"login":"rrwick","id":7053555,"node_id":"MDQ6VXNlcjcwNTM1NTU=","avatar_url":"https://avatars.githubusercontent.com/u/7053555?v=4","gravatar_id":"","url":"https://api.github.com/users/rrwick","html_url":"https://github.com/rrwick","followers_url":"https://api.github.com/users/rrwick/followers","following_url":"https://api.github.com/users/rrwick/following{/other_user}","gists_url":"https://api.github.com/users/rrwick/gists{/gist_id}","starred_url":"https://api.github.com/users/rrwick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rrwick/subscriptions","organizations_url":"https://api.github.com/users/rrwick/orgs","repos_url":"https://api.github.com/users/rrwick/repos","events_url":"https://api.github.com/users/rrwick/events{/privacy}","received_events_url":"https://api.github.com/users/rrwick/received_events","type":"User","site_admin":false},"event":"referenced","commit_id":"8da2b11e381efe6df6e3ae797cdf1f06b0d5603f","commit_url":"https://api.github.com/repos/rrwick/taiyaki/commits/8da2b11e381efe6df6e3ae797cdf1f06b0d5603f","created_at":"2019-07-31T00:46:26Z","performed_via_github_app":null},{"id":2560039368,"node_id":"MDExOkNsb3NlZEV2ZW50MjU2MDAzOTM2OA==","url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/events/2560039368","actor":{"login":"callumparr","id":41637575,"node_id":"MDQ6VXNlcjQxNjM3NTc1","avatar_url":"https://avatars.githubusercontent.com/u/41637575?v=4","gravatar_id":"","url":"https://api.github.com/users/callumparr","html_url":"https://github.com/callumparr","followers_url":"https://api.github.com/users/callumparr/followers","following_url":"https://api.github.com/users/callumparr/following{/other_user}","gists_url":"https://api.github.com/users/callumparr/gists{/gist_id}","starred_url":"https://api.github.com/users/callumparr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/callumparr/subscriptions","organizations_url":"https://api.github.com/users/callumparr/orgs","repos_url":"https://api.github.com/users/callumparr/repos","events_url":"https://api.github.com/users/callumparr/events{/privacy}","received_events_url":"https://api.github.com/users/callumparr/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-08-15T16:39:10Z","state_reason":null,"performed_via_github_app":null}]