{"url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/49","repository_url":"https://api.github.com/repos/nanoporetech/taiyaki","labels_url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/49/labels{/name}","comments_url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/49/comments","events_url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/49/events","html_url":"https://github.com/nanoporetech/taiyaki/issues/49","id":484333515,"node_id":"MDU6SXNzdWU0ODQzMzM1MTU=","number":49,"title":"train_mod: RuntimeError: cuDNN error: CUDNN_STATUS_EXECUTION_FAILED","user":{"login":"callumparr","id":41637575,"node_id":"MDQ6VXNlcjQxNjM3NTc1","avatar_url":"https://avatars.githubusercontent.com/u/41637575?v=4","gravatar_id":"","url":"https://api.github.com/users/callumparr","html_url":"https://github.com/callumparr","followers_url":"https://api.github.com/users/callumparr/followers","following_url":"https://api.github.com/users/callumparr/following{/other_user}","gists_url":"https://api.github.com/users/callumparr/gists{/gist_id}","starred_url":"https://api.github.com/users/callumparr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/callumparr/subscriptions","organizations_url":"https://api.github.com/users/callumparr/orgs","repos_url":"https://api.github.com/users/callumparr/repos","events_url":"https://api.github.com/users/callumparr/events{/privacy}","received_events_url":"https://api.github.com/users/callumparr/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-08-23T05:10:17Z","updated_at":"2019-09-27T03:57:22Z","closed_at":"2019-09-27T03:57:22Z","author_association":"NONE","active_lock_reason":null,"body":"Trying to run train_mod on a HPC with GPU installed but get error similar to #37 \r\n\r\nenvironment\r\n\r\n`Ubuntu 16.04.6 LTS (GNU/Linux 4.4.0-75-generic x86_64)`\r\n\r\nsyst.admin install Taiyaki system wide with the setup.py file and creating a virtual environment. \r\n\r\n```\r\n(python3) (base) callum@dgt-gpu1:~$ source taiyaki/venv/bin/activate\r\n-bash: taiyaki/venv/bin/activate: No such file or directory\r\n(python3) (base) callum@dgt-gpu1:~$ python -c 'import taiyaki; print(taiyaki.__version__)'\r\n4.1.0\r\n(python3) (base) callum@dgt-gpu1:~$ python -c 'import torch; print(torch.__version__)'\r\n1.0.0\r\n(python3) (base) callum@dgt-gpu1:~$ python -c 'import torch; print(torch.version.cuda)'\r\n9.0.176\r\n(python3) (base) callum@dgt-gpu1:~$ python -c 'import torch; print(torch.backends.cudnn.version())'\r\n7401\r\n(python3) (base) callum@dgt-gpu1:~$ python -c 'import torch; print(torch.backends.cudnn.enabled)'\r\nTrue\r\n```\r\n\r\nRun \r\n\r\nAfter activating environment \r\n\r\n`(python3) (base) callum@dgt-gpu1:~$ train_mod_flipflop.py --device cuda:0 --mod_factor 0.01 --outdir taiyaki/taiyaki_modbase/training_1 taiyaki/models/mGru_cat_mod_flipflop.py taiyaki/taiyaki_modbase/intermediate_files/modbase.hdf5 --overwrite`\r\n\r\nerror traceback \r\n\r\n```\r\n* Taiyaki version 4.1.0\r\n* Command line\r\n/usr/local/python3/bin/train_mod_flipflop.py --device cuda:0 --mod_factor 0.01 --outdir taiyaki/taiyaki_modbase/training_1 taiyaki/models/mGru_cat_mod_flipflop.py taiyaki/taiyaki_modbase/intermediate_files/modbase.hdf5 --overwrite\r\n* Loading data from taiyaki/taiyaki_modbase/intermediate_files/modbase.hdf5\r\n* Per read file MD5 ffd4296fb9fce0b45ad0230c2f8936cb\r\n* Will train from all strands\r\n* Loaded 5891 reads.\r\n* Using alphabet definition: canonical alphabet ACGT with modified base(s) Y=6mA (alt to A), Z=5mC (alt to C)\r\n* Sampled 1000 chunks: median(mean_dwell)=9.90, mad(mean_dwell)=0.87\r\n* Reading network from taiyaki/models/mGru_cat_mod_flipflop.py\r\nTraceback (most recent call last):\r\n  File \"/usr/local/python3/bin/train_mod_flipflop.py\", line 4, in <module>\r\n    __import__('pkg_resources').run_script('taiyaki==4.1.0', 'train_mod_flipflop.py')\r\n  File \"/usr/local/python3/lib/python3.5/site-packages/pkg_resources/__init__.py\", line 719, in run_script\r\n    self.require(requires)[0].run_script(script_name, ns)\r\n  File \"/usr/local/python3/lib/python3.5/site-packages/pkg_resources/__init__.py\", line 1504, in run_script\r\n    exec(code, namespace, namespace)\r\n  File \"/usr/local/python3/lib/python3.5/site-packages/taiyaki-4.1.0-py3.5-linux-x86_64.egg/EGG-INFO/scripts/train_mod_flipflop.py\", line 358, in <module>\r\n    main()\r\n  File \"/usr/local/python3/lib/python3.5/site-packages/taiyaki-4.1.0-py3.5-linux-x86_64.egg/EGG-INFO/scripts/train_mod_flipflop.py\", line 202, in main\r\n    network = helpers.load_model(args.model, **model_kwargs).to(device)\r\n  File \"/usr/local/python3/lib/python3.5/site-packages/torch/nn/modules/module.py\", line 381, in to\r\n    return self._apply(convert)\r\n  File \"/usr/local/python3/lib/python3.5/site-packages/torch/nn/modules/module.py\", line 187, in _apply\r\n    module._apply(fn)\r\n  File \"/usr/local/python3/lib/python3.5/site-packages/torch/nn/modules/module.py\", line 187, in _apply\r\n    module._apply(fn)\r\n  File \"/usr/local/python3/lib/python3.5/site-packages/torch/nn/modules/module.py\", line 187, in _apply\r\n    module._apply(fn)\r\n  File \"/usr/local/python3/lib/python3.5/site-packages/torch/nn/modules/module.py\", line 187, in _apply\r\n    module._apply(fn)\r\n  File \"/usr/local/python3/lib/python3.5/site-packages/torch/nn/modules/rnn.py\", line 117, in _apply\r\n    self.flatten_parameters()\r\n  File \"/usr/local/python3/lib/python3.5/site-packages/torch/nn/modules/rnn.py\", line 113, in flatten_parameters\r\n    self.batch_first, bool(self.bidirectional))\r\nRuntimeError: cuDNN error: CUDNN_STATUS_EXECUTION_FAILED\r\n```\r\n\r\nsys.admin tried upgrade and downgrading torch package and CUDA to 10.0.130 but still provides same error: \r\n\r\n`make tests` `make acctest` and `make unittest` do pass but 2 were skipped \r\n\r\n`../../test/unit/test_layers.py::ANNTest::test_017_decode_simple SKIPPED`\r\n`../../test/unit/test_layers.py::GlobalNormFlipFlopTest::test_cupy_and_non_cupy_same SKIPPED`\r\n\r\nI am unsure if this relates.\r\n\r\nI managed to install and run train_mod on another local station installed within a docker container running ubuntu 16.04 and also with same dependency versions. How I installed with `git clone`, and then `make install` not using setup.py \r\n\r\nsys.admin advised me there may be some bug in setup.py file:\r\n\r\n> taiyaki/setup.py ( by git clone) has a bug. ( package_data line)\r\n>  diff is\r\n\r\n```\r\n(taiyaki) anon@dgt-gpu1:~/src/taiyaki$ diff -u setup.py.orig setup.py\r\n--- setup.py.orig\t2019-08-23 11:04:56.570220292 +0900\r\n+++ setup.py\t2019-08-23 11:07:25.946714589 +0900\r\n@@ -73,7 +73,7 @@\r\n     ],\r\n \r\n     packages=find_packages(exclude=[\"*.test\", \"*.test.*\", \"test.*\", \"test\", \"bin\"]),\r\n-    package_data={'configs': 'data/configs/*'},\r\n+    package_data={'configs': ['data/configs/*']},\r\n     exclude_package_data={'': ['*.hdf', '*.c', '*.h']},\r\n     ext_modules=extensions,\r\n     setup_requires=[\"pytest-runner\", \"pytest-xdist\"],\r\n```\r\n\r\n\r\n","closed_by":{"login":"callumparr","id":41637575,"node_id":"MDQ6VXNlcjQxNjM3NTc1","avatar_url":"https://avatars.githubusercontent.com/u/41637575?v=4","gravatar_id":"","url":"https://api.github.com/users/callumparr","html_url":"https://github.com/callumparr","followers_url":"https://api.github.com/users/callumparr/followers","following_url":"https://api.github.com/users/callumparr/following{/other_user}","gists_url":"https://api.github.com/users/callumparr/gists{/gist_id}","starred_url":"https://api.github.com/users/callumparr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/callumparr/subscriptions","organizations_url":"https://api.github.com/users/callumparr/orgs","repos_url":"https://api.github.com/users/callumparr/repos","events_url":"https://api.github.com/users/callumparr/events{/privacy}","received_events_url":"https://api.github.com/users/callumparr/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/49/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/49/timeline","performed_via_github_app":null,"state_reason":"completed"}