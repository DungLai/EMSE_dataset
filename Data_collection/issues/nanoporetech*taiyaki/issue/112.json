{"url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/112","repository_url":"https://api.github.com/repos/nanoporetech/taiyaki","labels_url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/112/labels{/name}","comments_url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/112/comments","events_url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/112/events","html_url":"https://github.com/nanoporetech/taiyaki/issues/112","id":862755660,"node_id":"MDU6SXNzdWU4NjI3NTU2NjA=","number":112,"title":"Distributed multiple GPUs launch failed","user":{"login":"weir12","id":37523816,"node_id":"MDQ6VXNlcjM3NTIzODE2","avatar_url":"https://avatars.githubusercontent.com/u/37523816?v=4","gravatar_id":"","url":"https://api.github.com/users/weir12","html_url":"https://github.com/weir12","followers_url":"https://api.github.com/users/weir12/followers","following_url":"https://api.github.com/users/weir12/following{/other_user}","gists_url":"https://api.github.com/users/weir12/gists{/gist_id}","starred_url":"https://api.github.com/users/weir12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weir12/subscriptions","organizations_url":"https://api.github.com/users/weir12/orgs","repos_url":"https://api.github.com/users/weir12/repos","events_url":"https://api.github.com/users/weir12/events{/privacy}","received_events_url":"https://api.github.com/users/weir12/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-04-20T12:16:48Z","updated_at":"2021-04-20T12:22:49Z","closed_at":"2021-04-20T12:22:49Z","author_association":"NONE","active_lock_reason":null,"body":"Hi:\r\nThe following error occurred when I used the script to test the multi-GPU training capability.\r\nI have  2080ti*4 graphics cards on the same machine\r\nworkflow/test_multiGPU.sh\r\n```\r\n+ set -o pipefail\r\n+ TAIYAKI=.\r\n+ echo ''\r\n\r\n+ echo 'Test of multi-GPU training with train_flipflop.py'\r\nTest of multi-GPU training with train_flipflop.py\r\n+ echo ''\r\n\r\n+ OPENBLAS_NUM_THREADS=1\r\n+ export OPENBLAS_NUM_THREADS\r\n+ OMP_NUM_THREADS=4\r\n+ export OMP_NUM_THREADS\r\n+ NGPU=2\r\n+ MAPPEDREADFILE=./test/data/mapped_signal_file/mapped_reads_1.hdf5\r\n+ MODEL=./models/mGru_flipflop.py\r\n+ RESULT_DIR=./workflow/multiGPU_test_results\r\n+ LR_MAX=0.003\r\n+ LR_MIN=0.00015\r\n+ ITERATIONS=100\r\n+ WARMUP=10\r\n+ python -m torch.distributed.launch --nproc_per_node 2 --master_addr 127.0.0.2 --master_port 29501 ./bin/train_flipflop.py --overwrite --min_sub_batch_size 32 --warmup_batches 10 --niteration 100 --lr_max 0.003 --lr_min 0.00015 --outdir ./workflow/multiGPU_test_results ./models/mGru_flipflop.py ./test/data/mapped_signal_file/mapped_reads_1.hdf5\r\nTraceback (most recent call last):\r\n  File \"./bin/train_flipflop.py\", line 703, in <module>\r\n    main(get_train_flipflop_parser().parse_args())\r\n  File \"./bin/train_flipflop.py\", line 688, in main\r\n    res_info, logs = parse_init_args(args)\r\n  File \"./bin/train_flipflop.py\", line 253, in parse_init_args\r\n    logs = LOGS(main=helpers.Logger(main_log_fn, args.quiet))\r\n  File \"/home/weir/m6a_model/software/taiyaki-master/taiyaki/helpers.py\", line 280, in __init__\r\n* Using random seed: 2218333279\r\n    self.fh = open(log_file_name, 'wb', 0)\r\nFileNotFoundError: [Errno 2] No such file or directory: './workflow/multiGPU_test_results/model.log'\r\nKilling subprocess 72870\r\nKilling subprocess 72871\r\nTraceback (most recent call last):\r\n  File \"/home/weir/anaconda3/envs/dp/lib/python3.8/runpy.py\", line 194, in _run_module_as_main\r\n    return _run_code(code, main_globals, None,\r\n  File \"/home/weir/anaconda3/envs/dp/lib/python3.8/runpy.py\", line 87, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/home/weir/anaconda3/envs/dp/lib/python3.8/site-packages/torch/distributed/launch.py\", line 340, in <module>\r\n    main()\r\n  File \"/home/weir/anaconda3/envs/dp/lib/python3.8/site-packages/torch/distributed/launch.py\", line 326, in main\r\n    sigkill_handler(signal.SIGTERM, None)  # not coming back\r\n  File \"/home/weir/anaconda3/envs/dp/lib/python3.8/site-packages/torch/distributed/launch.py\", line 301, in sigkill_handler\r\n    raise subprocess.CalledProcessError(returncode=last_return_code, cmd=cmd)\r\nsubprocess.CalledProcessError: Command '['/home/weir/anaconda3/envs/dp/bin/python', '-u', './bin/train_flipflop.py', '--local_rank=1', '--overwrite', '--min_sub_batch_size', '32', '--warmup_batches', '10', '--niteration', '100', '--lr_max', '0.003', '--lr_min', '0.00015', '--outdir', './workflow/multiGPU_test_results', './models/mGru_flipflop.py', './test/data/mapped_signal_file/mapped_reads_1.hdf5']' returned non-zero exit status 1.\r\n```","closed_by":{"login":"weir12","id":37523816,"node_id":"MDQ6VXNlcjM3NTIzODE2","avatar_url":"https://avatars.githubusercontent.com/u/37523816?v=4","gravatar_id":"","url":"https://api.github.com/users/weir12","html_url":"https://github.com/weir12","followers_url":"https://api.github.com/users/weir12/followers","following_url":"https://api.github.com/users/weir12/following{/other_user}","gists_url":"https://api.github.com/users/weir12/gists{/gist_id}","starred_url":"https://api.github.com/users/weir12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weir12/subscriptions","organizations_url":"https://api.github.com/users/weir12/orgs","repos_url":"https://api.github.com/users/weir12/repos","events_url":"https://api.github.com/users/weir12/events{/privacy}","received_events_url":"https://api.github.com/users/weir12/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/112/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nanoporetech/taiyaki/issues/112/timeline","performed_via_github_app":null,"state_reason":"completed"}