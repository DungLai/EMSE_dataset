{"url":"https://api.github.com/repos/thushv89/attention_keras/issues/18","repository_url":"https://api.github.com/repos/thushv89/attention_keras","labels_url":"https://api.github.com/repos/thushv89/attention_keras/issues/18/labels{/name}","comments_url":"https://api.github.com/repos/thushv89/attention_keras/issues/18/comments","events_url":"https://api.github.com/repos/thushv89/attention_keras/issues/18/events","html_url":"https://github.com/thushv89/attention_keras/issues/18","id":482046161,"node_id":"MDU6SXNzdWU0ODIwNDYxNjE=","number":18,"title":"AttributeError: 'tuple' object has no attribute '_keras_mask'","user":{"login":"AlanGanem","id":47705293,"node_id":"MDQ6VXNlcjQ3NzA1Mjkz","avatar_url":"https://avatars.githubusercontent.com/u/47705293?v=4","gravatar_id":"","url":"https://api.github.com/users/AlanGanem","html_url":"https://github.com/AlanGanem","followers_url":"https://api.github.com/users/AlanGanem/followers","following_url":"https://api.github.com/users/AlanGanem/following{/other_user}","gists_url":"https://api.github.com/users/AlanGanem/gists{/gist_id}","starred_url":"https://api.github.com/users/AlanGanem/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlanGanem/subscriptions","organizations_url":"https://api.github.com/users/AlanGanem/orgs","repos_url":"https://api.github.com/users/AlanGanem/repos","events_url":"https://api.github.com/users/AlanGanem/events{/privacy}","received_events_url":"https://api.github.com/users/AlanGanem/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-08-18T22:39:48Z","updated_at":"2019-12-11T23:48:59Z","closed_at":"2019-12-11T23:48:59Z","author_association":"NONE","active_lock_reason":null,"body":"I'm having this problem after reshaping the tensors 'encoder_out' and 'decoder_out', in order for its shapes to be explicit and avoid the error adressed in [https://github.com/thushv89/attention_keras/issues/9](url). \r\nBut then i get the following error:\r\n\r\nFile \"C:\\Users\\ganem\\AppData\\Local\\Programs\\Python\\Python36\\Lib\\site-packages\\tensorflow\\python\\layers\\base.py\", line 738, in __call__\r\n    outputs._keras_mask = output_mask  # pylint: disable=protected-access\r\n\r\nAttributeError: 'tuple' object has no attribute '_keras_mask'\r\n\r\n\r\nHeres the full code:\r\n\r\n`\r\n#import modules\r\n\r\nimport tensorflow as tf\r\nfrom attention import AttentionLayer\r\nfrom tensorflow.python.keras.layers import Input, GRU, Dense, Concatenate, TimeDistributed\r\nfrom tensorflow.python.keras.models import Model\r\nfrom tensorflow.python.keras.callbacks import EarlyStopping\r\nfrom tensorflow.python.keras.layers import Dropout, Concatenate ,Dense ,LSTM,MaxPooling1D ,Conv1D, MaxPooling1D,Input, TimeDistributed, Flatten, Conv2D,Reshape,Permute, Flatten\r\nfrom tensorflow.python.keras.models import Model, Sequential\r\nfrom tensorflow.python.keras.utils import plot_model\r\nimport TimeSeriesUtils as TSU\r\nfrom sklearn.preprocessing import MinMaxScaler\r\nfrom sklearn.model_selection import KFold\r\nfrom sklearn.model_selection import GridSearchCV\r\nimport pandas as pd\r\nimport numpy as np\r\n\r\n# set model params\r\n\r\nlatent_dim = 10\r\nlook_back_period = 12\r\npred_period = 8\r\ndropout_rate = 0.5\r\nbatch_size = 128\r\n\r\n#read data and convert to np array\r\n\r\ndata = pd.read_table(r'~\\gas_prices_brazil\\2004-2019.tsv',delim_whitespace=False,header=0)\r\ndata['DATA INICIAL'] = pd.to_datetime(data['DATA INICIAL'])\r\ndata['DATA FINAL'] = pd.to_datetime(data['DATA FINAL'])\r\ndata.set_index('DATA FINAL',inplace = True)\r\ndata.replace('-',np.nan, inplace = True)\r\nnumber_columns = []\r\nfor column in data.columns:\r\n        try:\r\n            data[column] = data[column].astype(float)     \r\n            number_columns.append(column)\r\n            print(column)\r\n        except:    \r\n            pass    \r\n\r\nfeatures = ['PREÇO MÉDIO REVENDA', 'DESVIO PADRÃO REVENDA', 'PREÇO MÍNIMO REVENDA', 'PREÇO MÁXIMO REVENDA', 'MARGEM MÉDIA REVENDA', 'COEF DE VARIAÇÃO REVENDA', 'PREÇO MÉDIO DISTRIBUIÇÃO', 'DESVIO PADRÃO DISTRIBUIÇÃO', 'PREÇO MÍNIMO DISTRIBUIÇÃO', 'PREÇO MÁXIMO DISTRIBUIÇÃO', 'COEF DE VARIAÇÃO DISTRIBUIÇÃO']\r\ntrain_data = data[(data['ESTADO'] == 'SAO PAULO') & (data['PRODUTO'] == 'GASOLINA COMUM')].resample('W').mean()\r\ntrain_data = train_data[features]\r\n\r\nscaled_featues = []\r\ndependent_variable = ['PREÇO MÉDIO REVENDA']\r\ntrain_data = train_data[features+dependent_variable]\r\ntrain_data = train_data.fillna(method = 'ffill', limit = 300)\r\ntrain_data = train_data.astype('float')\r\nassert not any(any(train_data.isna()))\r\n\r\n\r\nX = TSU.chunk_data_by_date(train_data.values,pred_period,look_back_period)\r\nX_train, y_train, X_val, y_val = X\r\nX_train_teacher_forcing,X_val_teacher_forcing,X_train_no_teacher_forcing,X_val_no_teacher_forcing = TSU.teacher_forcing_generator(y_train,y_val)\r\n\r\n\r\n# defining layers\r\n\r\nencoder_input = Input(shape = (X_train.shape[1],X_train.shape[2]),batch_size = 128,name = 'encoder_input')\r\ndecoder_input = Input(shape = (look_back_period,1),batch_size = 128,name = 'decoder_input')\r\n\r\nencoderLSTM = LSTM(units = latent_dim,return_state = True,return_sequences = True,name = 'enc_LSTM',dropout = dropout_rate)\r\nattention1 = AttentionLayer()\r\ndecoderLSTM = LSTM(units = latent_dim,return_state = True,return_sequences = True,name = 'dec_LSTM',dropout = dropout_rate)\r\ndense_output = TimeDistributed(Dense(1, activation = 'relu'),name = 'time_distirbuted_dense_output')\r\n\r\n# building model\r\n\r\nencoder_out, encoder_states = encoderLSTM(encoder_input)[0], encoderLSTM(encoder_input)[1:]\r\n\r\ndecoder_out, decoder_states = decoderLSTM(decoder_input,initial_state = encoder_states)[0],decoderLSTM(decoder_input,initial_state = encoder_states)[1:]\r\n\r\noutput = dense_output(decoder_out)\r\n\r\n# explicitly define tensor shapes as TensorShape([Dimension(128), Dimension(12), Dimension(10)]) and TensorShape([Dimension(128), Dimension(8), Dimension(10)])\r\ndecoder_out.set_shape((tf.Dimension(batch_size),tf.Dimension(8),tf.Dimension(10)))\r\nencoder_out.set_shape((tf.Dimension(batch_size),tf.Dimension(12),tf.Dimension(10)))\r\n\r\nattention1_out, attention1_states = attention1([encoder_out, decoder_out])\r\n`\r\n\r\ni get the error in the last line\r\n\r\nany heads up on this issue?\r\n","closed_by":{"login":"thushv89","id":1381369,"node_id":"MDQ6VXNlcjEzODEzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1381369?v=4","gravatar_id":"","url":"https://api.github.com/users/thushv89","html_url":"https://github.com/thushv89","followers_url":"https://api.github.com/users/thushv89/followers","following_url":"https://api.github.com/users/thushv89/following{/other_user}","gists_url":"https://api.github.com/users/thushv89/gists{/gist_id}","starred_url":"https://api.github.com/users/thushv89/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thushv89/subscriptions","organizations_url":"https://api.github.com/users/thushv89/orgs","repos_url":"https://api.github.com/users/thushv89/repos","events_url":"https://api.github.com/users/thushv89/events{/privacy}","received_events_url":"https://api.github.com/users/thushv89/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/thushv89/attention_keras/issues/18/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/thushv89/attention_keras/issues/18/timeline","performed_via_github_app":null,"state_reason":"completed"}