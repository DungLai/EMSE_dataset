{"url":"https://api.github.com/repos/thushv89/attention_keras/issues/24","repository_url":"https://api.github.com/repos/thushv89/attention_keras","labels_url":"https://api.github.com/repos/thushv89/attention_keras/issues/24/labels{/name}","comments_url":"https://api.github.com/repos/thushv89/attention_keras/issues/24/comments","events_url":"https://api.github.com/repos/thushv89/attention_keras/issues/24/events","html_url":"https://github.com/thushv89/attention_keras/issues/24","id":501766617,"node_id":"MDU6SXNzdWU1MDE3NjY2MTc=","number":24,"title":"Minor issues - but nothing's broken","user":{"login":"ziadloo","id":3235521,"node_id":"MDQ6VXNlcjMyMzU1MjE=","avatar_url":"https://avatars.githubusercontent.com/u/3235521?v=4","gravatar_id":"","url":"https://api.github.com/users/ziadloo","html_url":"https://github.com/ziadloo","followers_url":"https://api.github.com/users/ziadloo/followers","following_url":"https://api.github.com/users/ziadloo/following{/other_user}","gists_url":"https://api.github.com/users/ziadloo/gists{/gist_id}","starred_url":"https://api.github.com/users/ziadloo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ziadloo/subscriptions","organizations_url":"https://api.github.com/users/ziadloo/orgs","repos_url":"https://api.github.com/users/ziadloo/repos","events_url":"https://api.github.com/users/ziadloo/events{/privacy}","received_events_url":"https://api.github.com/users/ziadloo/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2019-10-02T22:56:32Z","updated_at":"2020-07-23T11:57:38Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Thanks for this amazing code. I was working on your implementation when I came across a bunch of issues in it. Since my changes might not be to your liking, I'm not going to make a PR (my implementation is a little bit different). But I thought I should report the issues I've faced.\r\n\r\nBefore I list the issues, you need to know that none of them are breaking the implementation, meaning that your code works perfectly just the way it is. But it's just that if someone wants to make a change to it (like me), they'll have a headache. And also, some of the issues are just wrong.\r\n\r\n**1.** The way the fake states are initialized is unnecessary:\r\n\r\n```\r\ndef create_inital_state(inputs, hidden_size):\r\n    # We are not using initial states, but need to pass something to K.rnn funciton\r\n    fake_state = K.zeros_like(inputs)  # <= (batch_size, enc_seq_len, latent_dim\r\n    fake_state = K.sum(fake_state, axis=[1, 2])  # <= (batch_size)\r\n    fake_state = K.expand_dims(fake_state)  # <= (batch_size, 1)\r\n    fake_state = K.tile(fake_state, [1, hidden_size])  # <= (batch_size, latent_dim\r\n    return fake_state\r\n\r\nfake_state_c = create_inital_state(encoder_out_seq, encoder_out_seq.shape[-1])\r\nfake_state_e = create_inital_state(encoder_out_seq, encoder_out_seq.shape[1])  # <= (batch_size, enc_seq_len, latent_dim\r\n```\r\n\r\nJust simply initialize the tensors with zeros:\r\n\r\n```\r\nfake_state_e = K.zeros_like(K.placeholder(shape=(decoder_out_seq.shape[0], 1)))\r\nfake_state_c = K.zeros_like(K.placeholder(shape=(decoder_out_seq.shape[0], 1)))\r\n```\r\n\r\n**2.** In both your step functions you return the `state` like this:\r\n\r\n```\r\ndef energy_step(inputs, states):\r\n    ...\r\n    return e_i, [e_i]\r\n\r\ndef context_step(inputs, states):\r\n    ...\r\n    return c_i, [c_i]\r\n```\r\n\r\nWhile this does not throw any errors (because the states are discarded), but this is actually wrong. You just have to return the `states`, like this:\r\n\r\n```\r\ndef energy_step(inputs, states):\r\n    ...\r\n    return e_i, states\r\n\r\ndef context_step(inputs, states):\r\n    ...\r\n    return c_i, states\r\n```\r\n\r\n**3.** You already have a [PR](https://github.com/thushv89/attention_keras/pull/1) on this. I'm just going to mention it for the sake of completeness. Your output shape is this:\r\n\r\n```\r\ndef compute_output_shape(self, input_shape):\r\n    \"\"\" Outputs produced by the layer \"\"\"\r\n    return [\r\n        tf.TensorShape((input_shape[1][0], input_shape[1][1], input_shape[1][2])),\r\n        tf.TensorShape((input_shape[1][0], input_shape[1][1], input_shape[0][1]))\r\n    ]\r\n```\r\n\r\nBut it should be this:\r\n\r\n```\r\ndef compute_output_shape(self, input_shape):\r\n    \"\"\" Outputs produced by the layer \"\"\"\r\n    return [\r\n        tf.TensorShape((input_shape[1][0], input_shape[1][1], input_shape[0][2])),\r\n        tf.TensorShape((input_shape[1][0], input_shape[1][1], input_shape[0][1]))\r\n    ]\r\n```\r\n\r\nThanks again. I learned a lot from your code.","closed_by":{"login":"thushv89","id":1381369,"node_id":"MDQ6VXNlcjEzODEzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1381369?v=4","gravatar_id":"","url":"https://api.github.com/users/thushv89","html_url":"https://github.com/thushv89","followers_url":"https://api.github.com/users/thushv89/followers","following_url":"https://api.github.com/users/thushv89/following{/other_user}","gists_url":"https://api.github.com/users/thushv89/gists{/gist_id}","starred_url":"https://api.github.com/users/thushv89/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thushv89/subscriptions","organizations_url":"https://api.github.com/users/thushv89/orgs","repos_url":"https://api.github.com/users/thushv89/repos","events_url":"https://api.github.com/users/thushv89/events{/privacy}","received_events_url":"https://api.github.com/users/thushv89/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/thushv89/attention_keras/issues/24/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/thushv89/attention_keras/issues/24/timeline","performed_via_github_app":null,"state_reason":null}