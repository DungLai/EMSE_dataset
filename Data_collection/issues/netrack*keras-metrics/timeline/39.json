[{"id":2314285808,"node_id":"MDEyOkxhYmVsZWRFdmVudDIzMTQyODU4MDg=","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/2314285808","actor":{"login":"ybubnov","id":1778407,"node_id":"MDQ6VXNlcjE3Nzg0MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1778407?v=4","gravatar_id":"","url":"https://api.github.com/users/ybubnov","html_url":"https://github.com/ybubnov","followers_url":"https://api.github.com/users/ybubnov/followers","following_url":"https://api.github.com/users/ybubnov/following{/other_user}","gists_url":"https://api.github.com/users/ybubnov/gists{/gist_id}","starred_url":"https://api.github.com/users/ybubnov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ybubnov/subscriptions","organizations_url":"https://api.github.com/users/ybubnov/orgs","repos_url":"https://api.github.com/users/ybubnov/repos","events_url":"https://api.github.com/users/ybubnov/events{/privacy}","received_events_url":"https://api.github.com/users/ybubnov/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-05-02T12:02:03Z","label":{"name":"area/metrics","color":"fbca04"},"performed_via_github_app":null},{"id":2314285809,"node_id":"MDEyOkxhYmVsZWRFdmVudDIzMTQyODU4MDk=","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/2314285809","actor":{"login":"ybubnov","id":1778407,"node_id":"MDQ6VXNlcjE3Nzg0MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1778407?v=4","gravatar_id":"","url":"https://api.github.com/users/ybubnov","html_url":"https://github.com/ybubnov","followers_url":"https://api.github.com/users/ybubnov/followers","following_url":"https://api.github.com/users/ybubnov/following{/other_user}","gists_url":"https://api.github.com/users/ybubnov/gists{/gist_id}","starred_url":"https://api.github.com/users/ybubnov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ybubnov/subscriptions","organizations_url":"https://api.github.com/users/ybubnov/orgs","repos_url":"https://api.github.com/users/ybubnov/repos","events_url":"https://api.github.com/users/ybubnov/events{/privacy}","received_events_url":"https://api.github.com/users/ybubnov/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-05-02T12:02:03Z","label":{"name":"kind/bug","color":"FF5252"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/500460669","html_url":"https://github.com/netrack/keras-metrics/issues/39#issuecomment-500460669","issue_url":"https://api.github.com/repos/netrack/keras-metrics/issues/39","id":500460669,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDQ2MDY2OQ==","user":{"login":"NKUCodingCat","id":8611032,"node_id":"MDQ6VXNlcjg2MTEwMzI=","avatar_url":"https://avatars.githubusercontent.com/u/8611032?v=4","gravatar_id":"","url":"https://api.github.com/users/NKUCodingCat","html_url":"https://github.com/NKUCodingCat","followers_url":"https://api.github.com/users/NKUCodingCat/followers","following_url":"https://api.github.com/users/NKUCodingCat/following{/other_user}","gists_url":"https://api.github.com/users/NKUCodingCat/gists{/gist_id}","starred_url":"https://api.github.com/users/NKUCodingCat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NKUCodingCat/subscriptions","organizations_url":"https://api.github.com/users/NKUCodingCat/orgs","repos_url":"https://api.github.com/users/NKUCodingCat/repos","events_url":"https://api.github.com/users/NKUCodingCat/events{/privacy}","received_events_url":"https://api.github.com/users/NKUCodingCat/received_events","type":"User","site_admin":false},"created_at":"2019-06-10T15:31:15Z","updated_at":"2019-06-10T15:32:49Z","author_association":"NONE","body":"I think I found the reason but I have no idea about how to fix it\r\n\r\nestimator.model_to_estimator will replace the graph built by keras with the graph they make, and the class is stateful, so an object, for example, built by true_positive, keeps an variant as self.tp, which is built by keras when I call it, but the graph of variant y_true/y_pred is replaced\r\n\r\nI am not sure why there is a stateful layer because I check all loss/metrics of keras, I haven't found any loss is relies on the state of object(i.e. they are stateless), but I am not sure how keras_metrics work... Could you please provide some advices @ybubnov ?","reactions":{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/500460669/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"NKUCodingCat","id":8611032,"node_id":"MDQ6VXNlcjg2MTEwMzI=","avatar_url":"https://avatars.githubusercontent.com/u/8611032?v=4","gravatar_id":"","url":"https://api.github.com/users/NKUCodingCat","html_url":"https://github.com/NKUCodingCat","followers_url":"https://api.github.com/users/NKUCodingCat/followers","following_url":"https://api.github.com/users/NKUCodingCat/following{/other_user}","gists_url":"https://api.github.com/users/NKUCodingCat/gists{/gist_id}","starred_url":"https://api.github.com/users/NKUCodingCat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NKUCodingCat/subscriptions","organizations_url":"https://api.github.com/users/NKUCodingCat/orgs","repos_url":"https://api.github.com/users/NKUCodingCat/repos","events_url":"https://api.github.com/users/NKUCodingCat/events{/privacy}","received_events_url":"https://api.github.com/users/NKUCodingCat/received_events","type":"User","site_admin":false}},{"id":2401330086,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjQwMTMzMDA4Ng==","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/2401330086","actor":{"login":"ybubnov","id":1778407,"node_id":"MDQ6VXNlcjE3Nzg0MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1778407?v=4","gravatar_id":"","url":"https://api.github.com/users/ybubnov","html_url":"https://github.com/ybubnov","followers_url":"https://api.github.com/users/ybubnov/followers","following_url":"https://api.github.com/users/ybubnov/following{/other_user}","gists_url":"https://api.github.com/users/ybubnov/gists{/gist_id}","starred_url":"https://api.github.com/users/ybubnov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ybubnov/subscriptions","organizations_url":"https://api.github.com/users/ybubnov/orgs","repos_url":"https://api.github.com/users/ybubnov/repos","events_url":"https://api.github.com/users/ybubnov/events{/privacy}","received_events_url":"https://api.github.com/users/ybubnov/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-06-10T15:31:15Z","performed_via_github_app":null},{"id":2401330089,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI0MDEzMzAwODk=","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/2401330089","actor":{"login":"ybubnov","id":1778407,"node_id":"MDQ6VXNlcjE3Nzg0MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1778407?v=4","gravatar_id":"","url":"https://api.github.com/users/ybubnov","html_url":"https://github.com/ybubnov","followers_url":"https://api.github.com/users/ybubnov/followers","following_url":"https://api.github.com/users/ybubnov/following{/other_user}","gists_url":"https://api.github.com/users/ybubnov/gists{/gist_id}","starred_url":"https://api.github.com/users/ybubnov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ybubnov/subscriptions","organizations_url":"https://api.github.com/users/ybubnov/orgs","repos_url":"https://api.github.com/users/ybubnov/repos","events_url":"https://api.github.com/users/ybubnov/events{/privacy}","received_events_url":"https://api.github.com/users/ybubnov/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-06-10T15:31:15Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/500466931","html_url":"https://github.com/netrack/keras-metrics/issues/39#issuecomment-500466931","issue_url":"https://api.github.com/repos/netrack/keras-metrics/issues/39","id":500466931,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDQ2NjkzMQ==","user":{"login":"NKUCodingCat","id":8611032,"node_id":"MDQ6VXNlcjg2MTEwMzI=","avatar_url":"https://avatars.githubusercontent.com/u/8611032?v=4","gravatar_id":"","url":"https://api.github.com/users/NKUCodingCat","html_url":"https://github.com/NKUCodingCat","followers_url":"https://api.github.com/users/NKUCodingCat/followers","following_url":"https://api.github.com/users/NKUCodingCat/following{/other_user}","gists_url":"https://api.github.com/users/NKUCodingCat/gists{/gist_id}","starred_url":"https://api.github.com/users/NKUCodingCat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NKUCodingCat/subscriptions","organizations_url":"https://api.github.com/users/NKUCodingCat/orgs","repos_url":"https://api.github.com/users/NKUCodingCat/repos","events_url":"https://api.github.com/users/NKUCodingCat/events{/privacy}","received_events_url":"https://api.github.com/users/NKUCodingCat/received_events","type":"User","site_admin":false},"created_at":"2019-06-10T15:45:59Z","updated_at":"2019-06-10T15:45:59Z","author_association":"NONE","body":"Seems it is caused by the behaviour of when model_to_estimator process layer and metrics, it might replace the graph of any layer(I guess) but it will not replace the graph in metrics since they assumed that the metrics is STATLESS.\r\n\r\nAs far as I concerned, true_positive is implemented as a layer will reduce the cost of calculation when user require multiple metrics provide by keras_metrics(? I am not sure, I had been confused by the calling chain). IF what I think is right, I think it is a meaningless optimization because it makes potential incompatibles.\r\n\r\nSorry for my broken english and hope it helps","reactions":{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/500466931/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"NKUCodingCat","id":8611032,"node_id":"MDQ6VXNlcjg2MTEwMzI=","avatar_url":"https://avatars.githubusercontent.com/u/8611032?v=4","gravatar_id":"","url":"https://api.github.com/users/NKUCodingCat","html_url":"https://github.com/NKUCodingCat","followers_url":"https://api.github.com/users/NKUCodingCat/followers","following_url":"https://api.github.com/users/NKUCodingCat/following{/other_user}","gists_url":"https://api.github.com/users/NKUCodingCat/gists{/gist_id}","starred_url":"https://api.github.com/users/NKUCodingCat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NKUCodingCat/subscriptions","organizations_url":"https://api.github.com/users/NKUCodingCat/orgs","repos_url":"https://api.github.com/users/NKUCodingCat/repos","events_url":"https://api.github.com/users/NKUCodingCat/events{/privacy}","received_events_url":"https://api.github.com/users/NKUCodingCat/received_events","type":"User","site_admin":false}},{"actor":{"login":"JosPolfliet","id":12380065,"node_id":"MDQ6VXNlcjEyMzgwMDY1","avatar_url":"https://avatars.githubusercontent.com/u/12380065?v=4","gravatar_id":"","url":"https://api.github.com/users/JosPolfliet","html_url":"https://github.com/JosPolfliet","followers_url":"https://api.github.com/users/JosPolfliet/followers","following_url":"https://api.github.com/users/JosPolfliet/following{/other_user}","gists_url":"https://api.github.com/users/JosPolfliet/gists{/gist_id}","starred_url":"https://api.github.com/users/JosPolfliet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JosPolfliet/subscriptions","organizations_url":"https://api.github.com/users/JosPolfliet/orgs","repos_url":"https://api.github.com/users/JosPolfliet/repos","events_url":"https://api.github.com/users/JosPolfliet/events{/privacy}","received_events_url":"https://api.github.com/users/JosPolfliet/received_events","type":"User","site_admin":false},"created_at":"2019-11-06T11:49:17Z","updated_at":"2019-11-06T11:49:17Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/tensorflow/tensorflow/issues/34040","repository_url":"https://api.github.com/repos/tensorflow/tensorflow","labels_url":"https://api.github.com/repos/tensorflow/tensorflow/issues/34040/labels{/name}","comments_url":"https://api.github.com/repos/tensorflow/tensorflow/issues/34040/comments","events_url":"https://api.github.com/repos/tensorflow/tensorflow/issues/34040/events","html_url":"https://github.com/tensorflow/tensorflow/issues/34040","id":518421749,"node_id":"MDU6SXNzdWU1MTg0MjE3NDk=","number":34040,"title":"tf.keras.model_to_estimator() fails with custom loss/custom metrics","user":{"login":"JosPolfliet","id":12380065,"node_id":"MDQ6VXNlcjEyMzgwMDY1","avatar_url":"https://avatars.githubusercontent.com/u/12380065?v=4","gravatar_id":"","url":"https://api.github.com/users/JosPolfliet","html_url":"https://github.com/JosPolfliet","followers_url":"https://api.github.com/users/JosPolfliet/followers","following_url":"https://api.github.com/users/JosPolfliet/following{/other_user}","gists_url":"https://api.github.com/users/JosPolfliet/gists{/gist_id}","starred_url":"https://api.github.com/users/JosPolfliet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JosPolfliet/subscriptions","organizations_url":"https://api.github.com/users/JosPolfliet/orgs","repos_url":"https://api.github.com/users/JosPolfliet/repos","events_url":"https://api.github.com/users/JosPolfliet/events{/privacy}","received_events_url":"https://api.github.com/users/JosPolfliet/received_events","type":"User","site_admin":false},"labels":[{"id":386191887,"node_id":"MDU6TGFiZWwzODYxOTE4ODc=","url":"https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response","name":"stat:awaiting response","color":"f4b400","default":false,"description":"Status  - Awaiting response from author"},{"id":473172988,"node_id":"MDU6TGFiZWw0NzMxNzI5ODg=","url":"https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug","name":"type:bug","color":"159b2e","default":false,"description":"Bug"},{"id":474725938,"node_id":"MDU6TGFiZWw0NzQ3MjU5Mzg=","url":"https://api.github.com/repos/tensorflow/tensorflow/labels/stalled","name":"stalled","color":"d4c5f9","default":false,"description":"stalled"},{"id":1097546578,"node_id":"MDU6TGFiZWwxMDk3NTQ2NTc4","url":"https://api.github.com/repos/tensorflow/tensorflow/labels/comp:keras","name":"comp:keras","color":"0052cc","default":false,"description":"Keras related issues"},{"id":1160540362,"node_id":"MDU6TGFiZWwxMTYwNTQwMzYy","url":"https://api.github.com/repos/tensorflow/tensorflow/labels/TF%202.0","name":"TF 2.0","color":"e79b38","default":false,"description":"Issues relating to TensorFlow 2.0"},{"id":1903591931,"node_id":"MDU6TGFiZWwxOTAzNTkxOTMx","url":"https://api.github.com/repos/tensorflow/tensorflow/labels/TF%202.2","name":"TF 2.2","color":"0052cc","default":false,"description":"Issues related to TF 2.2"}],"state":"closed","locked":false,"assignee":{"login":"pavithrasv","id":13326758,"node_id":"MDQ6VXNlcjEzMzI2NzU4","avatar_url":"https://avatars.githubusercontent.com/u/13326758?v=4","gravatar_id":"","url":"https://api.github.com/users/pavithrasv","html_url":"https://github.com/pavithrasv","followers_url":"https://api.github.com/users/pavithrasv/followers","following_url":"https://api.github.com/users/pavithrasv/following{/other_user}","gists_url":"https://api.github.com/users/pavithrasv/gists{/gist_id}","starred_url":"https://api.github.com/users/pavithrasv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavithrasv/subscriptions","organizations_url":"https://api.github.com/users/pavithrasv/orgs","repos_url":"https://api.github.com/users/pavithrasv/repos","events_url":"https://api.github.com/users/pavithrasv/events{/privacy}","received_events_url":"https://api.github.com/users/pavithrasv/received_events","type":"User","site_admin":false},"assignees":[{"login":"pavithrasv","id":13326758,"node_id":"MDQ6VXNlcjEzMzI2NzU4","avatar_url":"https://avatars.githubusercontent.com/u/13326758?v=4","gravatar_id":"","url":"https://api.github.com/users/pavithrasv","html_url":"https://github.com/pavithrasv","followers_url":"https://api.github.com/users/pavithrasv/followers","following_url":"https://api.github.com/users/pavithrasv/following{/other_user}","gists_url":"https://api.github.com/users/pavithrasv/gists{/gist_id}","starred_url":"https://api.github.com/users/pavithrasv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pavithrasv/subscriptions","organizations_url":"https://api.github.com/users/pavithrasv/orgs","repos_url":"https://api.github.com/users/pavithrasv/repos","events_url":"https://api.github.com/users/pavithrasv/events{/privacy}","received_events_url":"https://api.github.com/users/pavithrasv/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2019-11-06T11:49:17Z","updated_at":"2021-07-10T01:48:02Z","closed_at":"2021-07-10T01:47:50Z","author_association":"NONE","active_lock_reason":null,"repository":{"id":45717250,"node_id":"MDEwOlJlcG9zaXRvcnk0NTcxNzI1MA==","name":"tensorflow","full_name":"tensorflow/tensorflow","private":false,"owner":{"login":"tensorflow","id":15658638,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1NjU4NjM4","avatar_url":"https://avatars.githubusercontent.com/u/15658638?v=4","gravatar_id":"","url":"https://api.github.com/users/tensorflow","html_url":"https://github.com/tensorflow","followers_url":"https://api.github.com/users/tensorflow/followers","following_url":"https://api.github.com/users/tensorflow/following{/other_user}","gists_url":"https://api.github.com/users/tensorflow/gists{/gist_id}","starred_url":"https://api.github.com/users/tensorflow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tensorflow/subscriptions","organizations_url":"https://api.github.com/users/tensorflow/orgs","repos_url":"https://api.github.com/users/tensorflow/repos","events_url":"https://api.github.com/users/tensorflow/events{/privacy}","received_events_url":"https://api.github.com/users/tensorflow/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/tensorflow/tensorflow","description":"An Open Source Machine Learning Framework for Everyone","fork":false,"url":"https://api.github.com/repos/tensorflow/tensorflow","forks_url":"https://api.github.com/repos/tensorflow/tensorflow/forks","keys_url":"https://api.github.com/repos/tensorflow/tensorflow/keys{/key_id}","collaborators_url":"https://api.github.com/repos/tensorflow/tensorflow/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/tensorflow/tensorflow/teams","hooks_url":"https://api.github.com/repos/tensorflow/tensorflow/hooks","issue_events_url":"https://api.github.com/repos/tensorflow/tensorflow/issues/events{/number}","events_url":"https://api.github.com/repos/tensorflow/tensorflow/events","assignees_url":"https://api.github.com/repos/tensorflow/tensorflow/assignees{/user}","branches_url":"https://api.github.com/repos/tensorflow/tensorflow/branches{/branch}","tags_url":"https://api.github.com/repos/tensorflow/tensorflow/tags","blobs_url":"https://api.github.com/repos/tensorflow/tensorflow/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/tensorflow/tensorflow/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/tensorflow/tensorflow/git/refs{/sha}","trees_url":"https://api.github.com/repos/tensorflow/tensorflow/git/trees{/sha}","statuses_url":"https://api.github.com/repos/tensorflow/tensorflow/statuses/{sha}","languages_url":"https://api.github.com/repos/tensorflow/tensorflow/languages","stargazers_url":"https://api.github.com/repos/tensorflow/tensorflow/stargazers","contributors_url":"https://api.github.com/repos/tensorflow/tensorflow/contributors","subscribers_url":"https://api.github.com/repos/tensorflow/tensorflow/subscribers","subscription_url":"https://api.github.com/repos/tensorflow/tensorflow/subscription","commits_url":"https://api.github.com/repos/tensorflow/tensorflow/commits{/sha}","git_commits_url":"https://api.github.com/repos/tensorflow/tensorflow/git/commits{/sha}","comments_url":"https://api.github.com/repos/tensorflow/tensorflow/comments{/number}","issue_comment_url":"https://api.github.com/repos/tensorflow/tensorflow/issues/comments{/number}","contents_url":"https://api.github.com/repos/tensorflow/tensorflow/contents/{+path}","compare_url":"https://api.github.com/repos/tensorflow/tensorflow/compare/{base}...{head}","merges_url":"https://api.github.com/repos/tensorflow/tensorflow/merges","archive_url":"https://api.github.com/repos/tensorflow/tensorflow/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/tensorflow/tensorflow/downloads","issues_url":"https://api.github.com/repos/tensorflow/tensorflow/issues{/number}","pulls_url":"https://api.github.com/repos/tensorflow/tensorflow/pulls{/number}","milestones_url":"https://api.github.com/repos/tensorflow/tensorflow/milestones{/number}","notifications_url":"https://api.github.com/repos/tensorflow/tensorflow/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/tensorflow/tensorflow/labels{/name}","releases_url":"https://api.github.com/repos/tensorflow/tensorflow/releases{/id}","deployments_url":"https://api.github.com/repos/tensorflow/tensorflow/deployments","created_at":"2015-11-07T01:19:20Z","updated_at":"2023-01-19T09:31:50Z","pushed_at":"2023-01-19T09:24:55Z","git_url":"git://github.com/tensorflow/tensorflow.git","ssh_url":"git@github.com:tensorflow/tensorflow.git","clone_url":"https://github.com/tensorflow/tensorflow.git","svn_url":"https://github.com/tensorflow/tensorflow","homepage":"https://tensorflow.org","size":1040588,"stargazers_count":170512,"watchers_count":170512,"language":"C++","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":87656,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2323,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["deep-learning","deep-neural-networks","distributed","machine-learning","ml","neural-network","python","tensorflow"],"visibility":"public","forks":87656,"open_issues":2323,"watchers":170512,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"\r\n**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow): YES\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04): MacOS 10.14.4 \r\n- TensorFlow installed from (source or binary): binary\r\n```\r\nnumpy                              1.17.2     \r\nnumpydoc                           0.9.1      \r\nprotobuf                           3.9.2      \r\ntensorflow                         2.0.0      \r\ntensorflow-addons                  0.6.0      \r\ntensorflow-estimator               2.0.0      \r\ntensorflow-serving-api             2.0.0    \r\npython                             3.7.4\r\n```\r\n**Describe the current behavior**\r\nI am using a custom loss function that requires extra input (the number of words in the sentence). When compiling the model, the InputLayer used in the custom loss function does not get transferred into the new graph. Since the function is stateful, I receive the following error:\r\n```Traceback (most recent call last):\r\n  File \"/src/automated-document-processing/nlp-tfx/bugreport.py\", line 93, in <module>\r\n    estimator = tf.keras.estimator.model_to_estimator(keras_model=model, model_dir=params[\"eval_dir\"])\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_core/python/keras/estimator/__init__.py\", line 166, in model_to_estimator_v2\r\n    use_v2_estimator=True)\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_estimator/python/estimator/keras.py\", line 576, in model_to_estimator\r\n    config, save_object_ckpt)\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_estimator/python/estimator/keras.py\", line 381, in _save_first_checkpoint\r\n    custom_objects)\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_estimator/python/estimator/keras.py\", line 227, in _clone_and_build_model\r\n    optimizer_config=optimizer_config)\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_core/python/keras/models.py\", line 679, in clone_and_build_model\r\n    target_tensors=target_tensors)\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_core/python/training/tracking/base.py\", line 457, in _method_wrapper\r\n    result = method(self, *args, **kwargs)\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_core/python/keras/engine/training.py\", line 373, in compile\r\n    self._compile_weights_loss_and_weighted_metrics()\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_core/python/training/tracking/base.py\", line 457, in _method_wrapper\r\n    result = method(self, *args, **kwargs)\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_core/python/keras/engine/training.py\", line 1653, in _compile_weights_loss_and_weighted_metrics\r\n    self.total_loss = self._prepare_total_loss(masks)\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_core/python/keras/engine/training.py\", line 1713, in _prepare_total_loss\r\n    per_sample_losses = loss_fn.call(y_true, y_pred)\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_core/python/keras/losses.py\", line 221, in call\r\n    return self.fn(y_true, y_pred, **self._fn_kwargs)\r\n  File \"/src/automated-document-processing/nlp-tfx/bugreport.py\", line 80, in CRFLoss\r\n    transition_params=transition_params,\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_addons/text/crf.py\", line 196, in crf_log_likelihood\r\n    transition_params)\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_addons/text/crf.py\", line 68, in crf_sequence_score\r\n    return _multi_seq_fn()\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_addons/text/crf.py\", line 59, in _multi_seq_fn\r\n    unary_scores = crf_unary_score(tag_indices, sequence_lengths, inputs)\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_addons/text/crf.py\", line 232, in crf_unary_score\r\n    sequence_lengths, maxlen=tf.shape(tag_indices)[1], dtype=tf.float32)\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_core/python/ops/array_ops.py\", line 3568, in sequence_mask\r\n    with ops.name_scope(name, \"SequenceMask\", [lengths, maxlen]):\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_core/python/framework/ops.py\", line 6337, in __enter__\r\n    g_from_inputs = _get_graph_from_inputs(self._values)\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_core/python/framework/ops.py\", line 5982, in _get_graph_from_inputs\r\n    _assert_same_graph(original_graph_element, graph_element)\r\n  File \"/src/.anaconda/anaconda3/lib/python3.7/site-packages/tensorflow_core/python/framework/ops.py\", line 5917, in _assert_same_graph\r\n    (item, original_item))\r\nValueError: Tensor(\"loss/myscores_loss/strided_slice_3:0\", shape=(), dtype=int32) must be from the same graph as Tensor(\"nwords:0\", shape=(None,), dtype=int32).\r\n```\r\n\r\n**Describe the expected behavior**\r\nAllow custom stateful loss/metrics functions in `model_to_estimator` or update the documentation that it is not supported. \r\n\r\n**Code to reproduce the issue**\r\n```from typing import Any, Dict\r\n\r\nimport tensorflow as tf\r\n\r\n\r\nfrom typing import Text, Tuple, List, Dict, Any, Union\r\n\r\nimport numpy as np\r\nimport tensorflow as tf\r\nimport tensorflow_addons as tfa\r\nfrom tensorflow.python.ops import math_ops\r\n\r\n\r\ndef _split_iob_tag(tag: Text) -> Tuple[Text, Union[Text, None]]:\r\n    \"\"\"Handle tags <pad>, <unk>, O, B-foo, and I-foo.\"\"\"\r\n    if tag[:2] not in [\"B-\", \"I-\"]:\r\n        return (tag, None)\r\n    return tuple(tag.split(\"-\", maxsplit=2))  # type: ignore\r\n\r\n\r\ndef iob_transition_params(tags: List[Text]) -> tf.constant:\r\n    \"\"\"Return transition matrix suitable for tf.contrib.crf.crf_decode.\"\"\"\r\n    mat = np.zeros((len(tags), len(tags)))\r\n    for i, i_tag in enumerate(tags):\r\n        i_type, i_name = _split_iob_tag(i_tag)\r\n        for j, j_tag in enumerate(tags):\r\n            j_type, j_name = _split_iob_tag(j_tag)\r\n            if (i_type == \"O\" and j_type == \"I\") or (\r\n                i_type in [\"B\", \"I\"] and j_type == \"I\" and i_name != j_name\r\n            ):\r\n                mat[i][j] = -np.inf\r\n    return tf.constant(mat, dtype=tf.float32)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    params: Dict[str, Any] = {\r\n        \"dim\": 300,\r\n        \"dropout\": 0.5,\r\n        \"batch_size\": 3,\r\n        \"buffer\": 15000,\r\n        \"lstm_size\": 10,\r\n        \"eval_dir\": \"../results/\",\r\n        \"saved_model_dir\": \"../final_model/\",\r\n        \"training_data\": \"some_data\",\r\n        \"window_length\": 512,\r\n        \"embedding_dimension\": 300,\r\n    }\r\n\r\n    tags = {'I-tag1', 'B-tag1','I-tag2', 'B-tag2','I-tag3', 'B-tag3', 'O'}\r\n\r\n    dropout = params[\"dropout\"]\r\n\r\n    embeddings = tf.keras.Input(\r\n        shape=(params[\"window_length\"], params[\"embedding_dimension\"],),\r\n        dtype=tf.float32,\r\n        name=\"embedding_sequence\",\r\n    )\r\n    nwords = tf.keras.Input(shape=(), dtype=tf.int32, name=\"nwords\",)\r\n    lstm_cell_fw = tf.keras.layers.LSTM(params[\"lstm_size\"], return_sequences=True)(\r\n        embeddings\r\n    )\r\n    output = tf.keras.layers.Dropout(rate=dropout)(lstm_cell_fw)\r\n    logits = tf.keras.layers.Dense(len(tags), name=\"myscores\")(output)\r\n\r\n    # CRF\r\n    transition_params = iob_transition_params(tags)\r\n\r\n    def custom_loss(seqlen):\r\n        def CRFLoss(y_true, y_pred):\r\n            y_true = math_ops.cast(y_true, tf.int32)\r\n            y_true = tf.reshape(y_true, [-1, 512])\r\n\r\n            log_likelihood, _ = tfa.text.crf.crf_log_likelihood(\r\n                inputs=y_pred,\r\n                tag_indices=y_true,\r\n                sequence_lengths=seqlen,\r\n                transition_params=transition_params,\r\n            )\r\n\r\n            return tf.reduce_mean(-log_likelihood)\r\n\r\n        return CRFLoss\r\n\r\n    model = tf.keras.Model(\r\n        inputs=[embeddings, nwords], outputs=logits, name=\"ner_simple\"\r\n    )\r\n\r\n    model.compile(optimizer=\"adam\", loss=custom_loss(nwords), metrics=[\"accuracy\"])\r\n    estimator = tf.keras.estimator.model_to_estimator(keras_model=model, model_dir=params[\"eval_dir\"])\r\n```\r\n**Other info / logs**\r\nRelated to https://github.com/netrack/keras-metrics/issues/39\r\n","reactions":{"url":"https://api.github.com/repos/tensorflow/tensorflow/issues/34040/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tensorflow/tensorflow/issues/34040/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/638055475","html_url":"https://github.com/netrack/keras-metrics/issues/39#issuecomment-638055475","issue_url":"https://api.github.com/repos/netrack/keras-metrics/issues/39","id":638055475,"node_id":"MDEyOklzc3VlQ29tbWVudDYzODA1NTQ3NQ==","user":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false},"created_at":"2020-06-03T08:47:46Z","updated_at":"2020-06-03T08:47:46Z","author_association":"NONE","body":"I also faced a samliar issue; the Metrics does not work with tf.keras.estimator.model_to_estimator.\r\nif I remove the tf.keras.mertics.AUC the code can work. or else  it has an error like this:\r\n\r\n    return fn(*args, **kwargs)\r\n  File \"/Users/sangyongjia/anaconda3/envs/tf1.x/lib/python3.7/site-packages/tensorflow/python/keras/engine/training_utils.py\", line 873, in call_metric_function\r\n    return metric_fn(y_true, y_pred, sample_weight=weights)\r\n  File \"/Users/sangyongjia/anaconda3/envs/tf1.x/lib/python3.7/site-packages/tensorflow/python/keras/metrics.py\", line 170, in __call__\r\n    update_op = self.update_state(*args, **kwargs)  # pylint: disable=not-callable\r\n  File \"/Users/sangyongjia/anaconda3/envs/tf1.x/lib/python3.7/site-packages/tensorflow/python/keras/utils/metrics_utils.py\", line 73, in decorated\r\n    update_op = update_state_fn(*args, **kwargs)\r\n  File \"/Users/sangyongjia/anaconda3/envs/tf1.x/lib/python3.7/site-packages/tensorflow/python/keras/metrics.py\", line 1715, in update_state\r\n    }, y_true, y_pred, self.thresholds, sample_weight=sample_weight)\r\n  File \"/Users/sangyongjia/anaconda3/envs/tf1.x/lib/python3.7/site-packages/tensorflow/python/keras/utils/metrics_utils.py\", line 268, in update_confusion_matrix_variables\r\n    y_pred.shape.assert_is_compatible_with(y_true.shape)\r\n  File \"/Users/sangyongjia/anaconda3/envs/tf1.x/lib/python3.7/site-packages/tensorflow/python/framework/tensor_shape.py\", line 1103, in assert_is_compatible_with\r\n    raise ValueError(\"Shapes %s and %s are incompatible\" % (self, other))\r\nValueError: Shapes (?, 1) and (?,) are incompatible\r\n\r\n\r\nthe correspond code is :\r\nmodel.compile(\"adam\", \"binary_crossentropy\", metrics=[tf.keras.metrics.BinaryCrossentropy(),tf.keras.metrics.AUC()])\r\n\r\nif I remove   tf.keras.metrics.AUC()\r\nmodel.compile(\"adam\", \"binary_crossentropy\", metrics=[tf.keras.metrics.BinaryCrossentropy()])\r\nit can work\r\n\r\n\r\nanyone has some great idea? thx in advance.","reactions":{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/638055475/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/641251710","html_url":"https://github.com/netrack/keras-metrics/issues/39#issuecomment-641251710","issue_url":"https://api.github.com/repos/netrack/keras-metrics/issues/39","id":641251710,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTI1MTcxMA==","user":{"login":"ybubnov","id":1778407,"node_id":"MDQ6VXNlcjE3Nzg0MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1778407?v=4","gravatar_id":"","url":"https://api.github.com/users/ybubnov","html_url":"https://github.com/ybubnov","followers_url":"https://api.github.com/users/ybubnov/followers","following_url":"https://api.github.com/users/ybubnov/following{/other_user}","gists_url":"https://api.github.com/users/ybubnov/gists{/gist_id}","starred_url":"https://api.github.com/users/ybubnov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ybubnov/subscriptions","organizations_url":"https://api.github.com/users/ybubnov/orgs","repos_url":"https://api.github.com/users/ybubnov/repos","events_url":"https://api.github.com/users/ybubnov/events{/privacy}","received_events_url":"https://api.github.com/users/ybubnov/received_events","type":"User","site_admin":false},"created_at":"2020-06-09T12:18:36Z","updated_at":"2020-06-09T12:18:36Z","author_association":"MEMBER","body":"@sangyongjia, it looks that your problem relates to [TensorFlow](https://github.com/tensorflow/tensorflow) project, not to the `keras-metrics`","reactions":{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/641251710/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ybubnov","id":1778407,"node_id":"MDQ6VXNlcjE3Nzg0MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1778407?v=4","gravatar_id":"","url":"https://api.github.com/users/ybubnov","html_url":"https://github.com/ybubnov","followers_url":"https://api.github.com/users/ybubnov/followers","following_url":"https://api.github.com/users/ybubnov/following{/other_user}","gists_url":"https://api.github.com/users/ybubnov/gists{/gist_id}","starred_url":"https://api.github.com/users/ybubnov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ybubnov/subscriptions","organizations_url":"https://api.github.com/users/ybubnov/orgs","repos_url":"https://api.github.com/users/ybubnov/repos","events_url":"https://api.github.com/users/ybubnov/events{/privacy}","received_events_url":"https://api.github.com/users/ybubnov/received_events","type":"User","site_admin":false}},{"id":3424591342,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzQyNDU5MTM0Mg==","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/3424591342","actor":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-06-09T12:18:36Z","performed_via_github_app":null},{"id":3424591344,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM0MjQ1OTEzNDQ=","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/3424591344","actor":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-06-09T12:18:36Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/642648433","html_url":"https://github.com/netrack/keras-metrics/issues/39#issuecomment-642648433","issue_url":"https://api.github.com/repos/netrack/keras-metrics/issues/39","id":642648433,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MjY0ODQzMw==","user":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false},"created_at":"2020-06-11T13:28:17Z","updated_at":"2020-06-11T13:28:17Z","author_association":"NONE","body":"> @sangyongjia, it looks that your problem relates to [TensorFlow](https://github.com/tensorflow/tensorflow) project, not to the `keras-metrics`\r\n\r\nyou mean I should remove the Tensorflow and install it again or update to higher version of tf ？\r\nNow the version of tf I am using is 1.14。 ","reactions":{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/642648433/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false}},{"id":3434149318,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzQzNDE0OTMxOA==","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/3434149318","actor":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-06-11T13:28:17Z","performed_via_github_app":null},{"id":3434149320,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM0MzQxNDkzMjA=","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/3434149320","actor":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-06-11T13:28:18Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/642648935","html_url":"https://github.com/netrack/keras-metrics/issues/39#issuecomment-642648935","issue_url":"https://api.github.com/repos/netrack/keras-metrics/issues/39","id":642648935,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MjY0ODkzNQ==","user":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false},"created_at":"2020-06-11T13:28:41Z","updated_at":"2020-06-11T13:28:41Z","author_association":"NONE","body":"@ybubnov ","reactions":{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/642648935/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false}},{"id":3434151024,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzQzNDE1MTAyNA==","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/3434151024","actor":{"login":"ybubnov","id":1778407,"node_id":"MDQ6VXNlcjE3Nzg0MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1778407?v=4","gravatar_id":"","url":"https://api.github.com/users/ybubnov","html_url":"https://github.com/ybubnov","followers_url":"https://api.github.com/users/ybubnov/followers","following_url":"https://api.github.com/users/ybubnov/following{/other_user}","gists_url":"https://api.github.com/users/ybubnov/gists{/gist_id}","starred_url":"https://api.github.com/users/ybubnov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ybubnov/subscriptions","organizations_url":"https://api.github.com/users/ybubnov/orgs","repos_url":"https://api.github.com/users/ybubnov/repos","events_url":"https://api.github.com/users/ybubnov/events{/privacy}","received_events_url":"https://api.github.com/users/ybubnov/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-06-11T13:28:41Z","performed_via_github_app":null},{"id":3434151029,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM0MzQxNTEwMjk=","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/3434151029","actor":{"login":"ybubnov","id":1778407,"node_id":"MDQ6VXNlcjE3Nzg0MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1778407?v=4","gravatar_id":"","url":"https://api.github.com/users/ybubnov","html_url":"https://github.com/ybubnov","followers_url":"https://api.github.com/users/ybubnov/followers","following_url":"https://api.github.com/users/ybubnov/following{/other_user}","gists_url":"https://api.github.com/users/ybubnov/gists{/gist_id}","starred_url":"https://api.github.com/users/ybubnov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ybubnov/subscriptions","organizations_url":"https://api.github.com/users/ybubnov/orgs","repos_url":"https://api.github.com/users/ybubnov/repos","events_url":"https://api.github.com/users/ybubnov/events{/privacy}","received_events_url":"https://api.github.com/users/ybubnov/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-06-11T13:28:41Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/642746400","html_url":"https://github.com/netrack/keras-metrics/issues/39#issuecomment-642746400","issue_url":"https://api.github.com/repos/netrack/keras-metrics/issues/39","id":642746400,"node_id":"MDEyOklzc3VlQ29tbWVudDY0Mjc0NjQwMA==","user":{"login":"ybubnov","id":1778407,"node_id":"MDQ6VXNlcjE3Nzg0MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1778407?v=4","gravatar_id":"","url":"https://api.github.com/users/ybubnov","html_url":"https://github.com/ybubnov","followers_url":"https://api.github.com/users/ybubnov/followers","following_url":"https://api.github.com/users/ybubnov/following{/other_user}","gists_url":"https://api.github.com/users/ybubnov/gists{/gist_id}","starred_url":"https://api.github.com/users/ybubnov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ybubnov/subscriptions","organizations_url":"https://api.github.com/users/ybubnov/orgs","repos_url":"https://api.github.com/users/ybubnov/repos","events_url":"https://api.github.com/users/ybubnov/events{/privacy}","received_events_url":"https://api.github.com/users/ybubnov/received_events","type":"User","site_admin":false},"created_at":"2020-06-11T15:39:20Z","updated_at":"2020-06-11T16:05:17Z","author_association":"MEMBER","body":"@sangyongjia, it looks that the problem is in the `TensorFlow` itself, particularly in `to_model_estimator` call, **JosPolfliet** created an issue in that project a long time ago: https://github.com/tensorflow/tensorflow/issues/34040 and it is still unresolved.\r\n\r\nI think one of possible ways to deal with the problem is to enforce issue resolution I've posted above. Alternatively, you could **not** use `model_to_estimator` if that is possible (simply use a model).\r\n\r\nFrom my side, I'll try to relax the TensorFlow restriction in order to allow newer version of TensorFlow be used with `keras-metrics` library.","reactions":{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/642746400/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ybubnov","id":1778407,"node_id":"MDQ6VXNlcjE3Nzg0MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1778407?v=4","gravatar_id":"","url":"https://api.github.com/users/ybubnov","html_url":"https://github.com/ybubnov","followers_url":"https://api.github.com/users/ybubnov/followers","following_url":"https://api.github.com/users/ybubnov/following{/other_user}","gists_url":"https://api.github.com/users/ybubnov/gists{/gist_id}","starred_url":"https://api.github.com/users/ybubnov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ybubnov/subscriptions","organizations_url":"https://api.github.com/users/ybubnov/orgs","repos_url":"https://api.github.com/users/ybubnov/repos","events_url":"https://api.github.com/users/ybubnov/events{/privacy}","received_events_url":"https://api.github.com/users/ybubnov/received_events","type":"User","site_admin":false}},{"id":3434748737,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzQzNDc0ODczNw==","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/3434748737","actor":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-06-11T15:39:20Z","performed_via_github_app":null},{"id":3434748743,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM0MzQ3NDg3NDM=","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/3434748743","actor":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-06-11T15:39:20Z","performed_via_github_app":null},{"id":3464301262,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzQ2NDMwMTI2Mg==","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/3464301262","actor":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-06-20T02:45:01Z","performed_via_github_app":null},{"id":3464301264,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM0NjQzMDEyNjQ=","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/3464301264","actor":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-06-20T02:45:01Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/646925438","html_url":"https://github.com/netrack/keras-metrics/issues/39#issuecomment-646925438","issue_url":"https://api.github.com/repos/netrack/keras-metrics/issues/39","id":646925438,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NjkyNTQzOA==","user":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false},"created_at":"2020-06-20T02:45:36Z","updated_at":"2020-06-20T02:45:36Z","author_association":"NONE","body":"thx so much @ybubnov ","reactions":{"url":"https://api.github.com/repos/netrack/keras-metrics/issues/comments/646925438/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sangyongjia","id":18410982,"node_id":"MDQ6VXNlcjE4NDEwOTgy","avatar_url":"https://avatars.githubusercontent.com/u/18410982?v=4","gravatar_id":"","url":"https://api.github.com/users/sangyongjia","html_url":"https://github.com/sangyongjia","followers_url":"https://api.github.com/users/sangyongjia/followers","following_url":"https://api.github.com/users/sangyongjia/following{/other_user}","gists_url":"https://api.github.com/users/sangyongjia/gists{/gist_id}","starred_url":"https://api.github.com/users/sangyongjia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sangyongjia/subscriptions","organizations_url":"https://api.github.com/users/sangyongjia/orgs","repos_url":"https://api.github.com/users/sangyongjia/repos","events_url":"https://api.github.com/users/sangyongjia/events{/privacy}","received_events_url":"https://api.github.com/users/sangyongjia/received_events","type":"User","site_admin":false}},{"id":3464301670,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzQ2NDMwMTY3MA==","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/3464301670","actor":{"login":"ybubnov","id":1778407,"node_id":"MDQ6VXNlcjE3Nzg0MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1778407?v=4","gravatar_id":"","url":"https://api.github.com/users/ybubnov","html_url":"https://github.com/ybubnov","followers_url":"https://api.github.com/users/ybubnov/followers","following_url":"https://api.github.com/users/ybubnov/following{/other_user}","gists_url":"https://api.github.com/users/ybubnov/gists{/gist_id}","starred_url":"https://api.github.com/users/ybubnov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ybubnov/subscriptions","organizations_url":"https://api.github.com/users/ybubnov/orgs","repos_url":"https://api.github.com/users/ybubnov/repos","events_url":"https://api.github.com/users/ybubnov/events{/privacy}","received_events_url":"https://api.github.com/users/ybubnov/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-06-20T02:45:36Z","performed_via_github_app":null},{"id":3464301671,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM0NjQzMDE2NzE=","url":"https://api.github.com/repos/netrack/keras-metrics/issues/events/3464301671","actor":{"login":"ybubnov","id":1778407,"node_id":"MDQ6VXNlcjE3Nzg0MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1778407?v=4","gravatar_id":"","url":"https://api.github.com/users/ybubnov","html_url":"https://github.com/ybubnov","followers_url":"https://api.github.com/users/ybubnov/followers","following_url":"https://api.github.com/users/ybubnov/following{/other_user}","gists_url":"https://api.github.com/users/ybubnov/gists{/gist_id}","starred_url":"https://api.github.com/users/ybubnov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ybubnov/subscriptions","organizations_url":"https://api.github.com/users/ybubnov/orgs","repos_url":"https://api.github.com/users/ybubnov/repos","events_url":"https://api.github.com/users/ybubnov/events{/privacy}","received_events_url":"https://api.github.com/users/ybubnov/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-06-20T02:45:36Z","performed_via_github_app":null}]