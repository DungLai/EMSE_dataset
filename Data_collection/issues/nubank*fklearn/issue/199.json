{"url":"https://api.github.com/repos/nubank/fklearn/issues/199","repository_url":"https://api.github.com/repos/nubank/fklearn","labels_url":"https://api.github.com/repos/nubank/fklearn/issues/199/labels{/name}","comments_url":"https://api.github.com/repos/nubank/fklearn/issues/199/comments","events_url":"https://api.github.com/repos/nubank/fklearn/issues/199/events","html_url":"https://github.com/nubank/fklearn/issues/199","id":1265470631,"node_id":"I_kwDOCk64ls5LbYyn","number":199,"title":"Pipelines can't be nested as any other learner","user":{"login":"peguerosdc","id":7889726,"node_id":"MDQ6VXNlcjc4ODk3MjY=","avatar_url":"https://avatars.githubusercontent.com/u/7889726?v=4","gravatar_id":"","url":"https://api.github.com/users/peguerosdc","html_url":"https://github.com/peguerosdc","followers_url":"https://api.github.com/users/peguerosdc/followers","following_url":"https://api.github.com/users/peguerosdc/following{/other_user}","gists_url":"https://api.github.com/users/peguerosdc/gists{/gist_id}","starred_url":"https://api.github.com/users/peguerosdc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peguerosdc/subscriptions","organizations_url":"https://api.github.com/users/peguerosdc/orgs","repos_url":"https://api.github.com/users/peguerosdc/repos","events_url":"https://api.github.com/users/peguerosdc/events{/privacy}","received_events_url":"https://api.github.com/users/peguerosdc/received_events","type":"User","site_admin":false},"labels":[{"id":1251232928,"node_id":"MDU6TGFiZWwxMjUxMjMyOTI4","url":"https://api.github.com/repos/nubank/fklearn/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-06-09T01:11:26Z","updated_at":"2022-07-08T16:59:27Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### Code sample\r\n\r\n_This script is complete, it should run \"as is\"_\r\n\r\n```python\r\nfrom fklearn.training.regression import linear_regression_learner\r\nfrom fklearn.training.pipeline import build_pipeline\r\nfrom fklearn.training.imputation import imputer\r\n\r\n# This example will try to create a linear regressor...\r\ndef load_sample_data():\r\n    import pandas as pd\r\n    from sklearn import datasets\r\n    x,y = datasets.load_diabetes(as_frame=True, return_X_y=True)\r\n    return pd.concat([x, y], axis=1)\r\n\r\n# ...but pipelines can't be used as individual learners\r\nnested_learner = build_pipeline(\r\n    build_pipeline(\r\n        imputer(columns_to_impute=[\"age\"], impute_strategy='median'),\r\n    ),\r\n    linear_regression_learner(features=[\"age\"], target=[\"target\"])\r\n)\r\nfn, df_result, logs = nested_learner(load_sample_data())\r\n'''\r\nOutput:\r\nValueError: Predict function of learner pipeline contains variable length arguments: kwargs\r\nMake sure no predict function uses arguments like *args or **kwargs.\r\n'''\r\n```\r\n\r\n### Problem description\r\n\r\nThis is a problem because (taken from the docs) _\"pipelines (should) behave exactly as individual learner functions\"_. That is, pipelines should be consistent with L in SOLID, but that is not happening.\r\n\r\nThe main benefit of supporting nested pipelines is that you can produce more maintainable code as packing complex operations in one big step like:\r\n\r\n```python\r\ndef custom_learner(feature: str, target: str):\r\n    return build_pipeline(\r\n        imputer(columns_to_impute=[feature], impute_strategy='median'),\r\n        linear_regression_learner(features=[feature], target=[target])\r\n    )\r\n```\r\n\r\nIs cleaner and more readable.\r\n\r\n### Expected behavior\r\nThe **\"Code sample\"** should produce the same output as if `nested_learner` was defined as:\r\n\r\n```python\r\nnested_learner = build_pipeline(\r\n    imputer(columns_to_impute=[\"age\"], impute_strategy='median'),\r\n    linear_regression_learner(features=[\"age\"], target=[\"target\"])\r\n)\r\n```\r\n\r\nThat is, if a pipeline is a type of learner, it should be possible to put it in place of any other learner.\r\n\r\n### Possible solutions\r\nA workaround is proposed in #145 , but it only works if you already have a `DataFrame` (which doesn't happen in this scenario). Would like to hear if someone has investigated this or knows what we need to change to support this, but in the meantime I propose adding a note to the docs to prevent someone else from trying to do this.","closed_by":null,"reactions":{"url":"https://api.github.com/repos/nubank/fklearn/issues/199/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nubank/fklearn/issues/199/timeline","performed_via_github_app":null,"state_reason":null}