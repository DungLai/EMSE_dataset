{"url":"https://api.github.com/repos/nubank/fklearn/issues/68","repository_url":"https://api.github.com/repos/nubank/fklearn","labels_url":"https://api.github.com/repos/nubank/fklearn/issues/68/labels{/name}","comments_url":"https://api.github.com/repos/nubank/fklearn/issues/68/comments","events_url":"https://api.github.com/repos/nubank/fklearn/issues/68/events","html_url":"https://github.com/nubank/fklearn/issues/68","id":447355959,"node_id":"MDU6SXNzdWU0NDczNTU5NTk=","number":68,"title":"Keeping track of feature names after applying onehot_categorizer ","user":{"login":"vultor33","id":16596383,"node_id":"MDQ6VXNlcjE2NTk2Mzgz","avatar_url":"https://avatars.githubusercontent.com/u/16596383?v=4","gravatar_id":"","url":"https://api.github.com/users/vultor33","html_url":"https://github.com/vultor33","followers_url":"https://api.github.com/users/vultor33/followers","following_url":"https://api.github.com/users/vultor33/following{/other_user}","gists_url":"https://api.github.com/users/vultor33/gists{/gist_id}","starred_url":"https://api.github.com/users/vultor33/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vultor33/subscriptions","organizations_url":"https://api.github.com/users/vultor33/orgs","repos_url":"https://api.github.com/users/vultor33/repos","events_url":"https://api.github.com/users/vultor33/events{/privacy}","received_events_url":"https://api.github.com/users/vultor33/received_events","type":"User","site_admin":false},"labels":[{"id":1251232930,"node_id":"MDU6TGFiZWwxMjUxMjMyOTMw","url":"https://api.github.com/repos/nubank/fklearn/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-05-22T21:41:18Z","updated_at":"2019-06-05T12:30:24Z","closed_at":"2019-06-05T12:30:24Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"PATH: .\\fklearn\\src\\fklearn\\training\\transformation.py  :  onehot_categorizer\r\n\r\n### Instructions\r\n\r\nWhen onehot_categorizer is applied, some columns are deleted and others are created.\r\nHowever, we need the final column names for machine learning models.\r\nThese names are accessible by hard code, but I think hard code is not fkleonic.\r\n\r\n### Describe the feature and the current state.\r\n\r\nonehot function can be created by the following code:\r\n\r\n```\r\nfrom fklearn.training.transformation import onehot_categorizer\r\nonehot_function = onehot_categorizer(columns_to_categorize = ['categorical_feature'])\r\n```\r\n\r\nInside the pipeline, \"onehot_function\" will be applied to data and new columns will be created.\r\nI couldn't find any simple way to find the new columns, so, I had created a method to address this and it is enough for me, but I think an official one is needed.\r\n\r\n### Proposed solution\r\n\r\nAt \"transformation.py\" file, I had added the following code: \r\n\r\n```\r\ndef update_onehot_feature_names(features: List[str], \r\n                            log: Dict[str,Dict]) -> List[str]:\r\n    \"\"\" Update feature names that were created by onehot_categorizer \r\n\tParameters\r\n        ----------\r\n\tfeatures : list of str\r\n\t\tA list of column names that are used as features for the model. All this names\r\n\t\tshould be in `df`.\r\n\tlog: dict\r\n\t\tLog of onehot_categorizer applied in training data.\r\n\t\tMust be training data, because test data could have categories that aren't previously known.\r\n\r\n\tReturns\r\n        ----------\r\n\tnew_features: list of str\r\n\t\tA list of column names with original categorical features deleted\r\n\t\tand new onehot columnnames added.\r\n    \"\"\"\r\n\r\n    new_features = list(features)\r\n    for feature_updated in log['onehot_categorizer']['mapping']:\r\n        if feature_updated not in new_features:\r\n            raise Exception(str(feature_updated) + ' not found in features list')\r\n\r\n        if log['onehot_categorizer']['hardcode_nans']:\r\n            new_features += [feature_updated + '==nan']\r\n\r\n        new_features.remove(feature_updated)\r\n        for one_hot_column_key in log['onehot_categorizer']['mapping'][feature_updated]:\r\n            new_features += [feature_updated + '==' + one_hot_column_key]\r\n    return new_features\r\n\r\nsetattr(onehot_categorizer,'update_features', update_onehot_feature_names)\r\n\r\n```\r\nTEST CODE\r\n```\r\nimport random\r\nimport pandas as pd\r\nfrom fklearn.training.transformation import onehot_categorizer\r\n\r\n# GENERATE DATA\r\ncolumn1 = [random.choice(['a','b','c']) for x in range(100)]\r\ncolumn2 = [random.random() for x in range(100)]\r\ntraining_data = pd.DataFrame({'categorical_feature' : column1, 'numerical_feature' : column2})\r\nFEATURES = training_data.columns.tolist()\r\nprint(training_data.head(5))\r\n\r\n# NEW FUNCTIONALITY TEST\r\nprint('Initial FEATURES:  ', FEATURES)\r\noneHot = onehot_categorizer(columns_to_categorize = ['categorical_feature'],store_mapping =  True)\r\n_, _, log = oneHot(training_data)  # You can only define extra columns if you 'see' the training_data\r\nNEW_FEATURES = onehot_categorizer.update_features(FEATURES, log)\r\nprint('Final FEATURES:  ', NEW_FEATURES)\r\n```\r\n### Test expected result\r\nInitial FEATURES:   ['categorical_feature', 'numerical_feature']\r\nFinal FEATURES:   ['numerical_feature', 'categorical_feature==a', 'categorical_feature==b', 'categorical_feature==c']\r\n\r\n### Will this change a current behavior? How?\r\n\r\nThis will not change the current behaviour, will just simplify onehot_categorizer use.\r\n","closed_by":{"login":"vultor33","id":16596383,"node_id":"MDQ6VXNlcjE2NTk2Mzgz","avatar_url":"https://avatars.githubusercontent.com/u/16596383?v=4","gravatar_id":"","url":"https://api.github.com/users/vultor33","html_url":"https://github.com/vultor33","followers_url":"https://api.github.com/users/vultor33/followers","following_url":"https://api.github.com/users/vultor33/following{/other_user}","gists_url":"https://api.github.com/users/vultor33/gists{/gist_id}","starred_url":"https://api.github.com/users/vultor33/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vultor33/subscriptions","organizations_url":"https://api.github.com/users/vultor33/orgs","repos_url":"https://api.github.com/users/vultor33/repos","events_url":"https://api.github.com/users/vultor33/events{/privacy}","received_events_url":"https://api.github.com/users/vultor33/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nubank/fklearn/issues/68/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nubank/fklearn/issues/68/timeline","performed_via_github_app":null,"state_reason":"completed"}