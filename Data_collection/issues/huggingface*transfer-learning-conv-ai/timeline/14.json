[{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/547022500","html_url":"https://github.com/huggingface/transfer-learning-conv-ai/issues/14#issuecomment-547022500","issue_url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/14","id":547022500,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzAyMjUwMA==","user":{"login":"martinritchie","id":9074305,"node_id":"MDQ6VXNlcjkwNzQzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/9074305?v=4","gravatar_id":"","url":"https://api.github.com/users/martinritchie","html_url":"https://github.com/martinritchie","followers_url":"https://api.github.com/users/martinritchie/followers","following_url":"https://api.github.com/users/martinritchie/following{/other_user}","gists_url":"https://api.github.com/users/martinritchie/gists{/gist_id}","starred_url":"https://api.github.com/users/martinritchie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinritchie/subscriptions","organizations_url":"https://api.github.com/users/martinritchie/orgs","repos_url":"https://api.github.com/users/martinritchie/repos","events_url":"https://api.github.com/users/martinritchie/events{/privacy}","received_events_url":"https://api.github.com/users/martinritchie/received_events","type":"User","site_admin":false},"created_at":"2019-10-28T16:13:07Z","updated_at":"2019-10-28T16:13:25Z","author_association":"NONE","body":"What batchsize are you using? Also, are you using `--FP16 O1`? \r\n\r\n","reactions":{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/547022500/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"martinritchie","id":9074305,"node_id":"MDQ6VXNlcjkwNzQzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/9074305?v=4","gravatar_id":"","url":"https://api.github.com/users/martinritchie","html_url":"https://github.com/martinritchie","followers_url":"https://api.github.com/users/martinritchie/followers","following_url":"https://api.github.com/users/martinritchie/following{/other_user}","gists_url":"https://api.github.com/users/martinritchie/gists{/gist_id}","starred_url":"https://api.github.com/users/martinritchie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinritchie/subscriptions","organizations_url":"https://api.github.com/users/martinritchie/orgs","repos_url":"https://api.github.com/users/martinritchie/repos","events_url":"https://api.github.com/users/martinritchie/events{/privacy}","received_events_url":"https://api.github.com/users/martinritchie/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/552707116","html_url":"https://github.com/huggingface/transfer-learning-conv-ai/issues/14#issuecomment-552707116","issue_url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/14","id":552707116,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MjcwNzExNg==","user":{"login":"michaelklachko","id":981619,"node_id":"MDQ6VXNlcjk4MTYxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/981619?v=4","gravatar_id":"","url":"https://api.github.com/users/michaelklachko","html_url":"https://github.com/michaelklachko","followers_url":"https://api.github.com/users/michaelklachko/followers","following_url":"https://api.github.com/users/michaelklachko/following{/other_user}","gists_url":"https://api.github.com/users/michaelklachko/gists{/gist_id}","starred_url":"https://api.github.com/users/michaelklachko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/michaelklachko/subscriptions","organizations_url":"https://api.github.com/users/michaelklachko/orgs","repos_url":"https://api.github.com/users/michaelklachko/repos","events_url":"https://api.github.com/users/michaelklachko/events{/privacy}","received_events_url":"https://api.github.com/users/michaelklachko/received_events","type":"User","site_admin":false},"created_at":"2019-11-12T02:35:03Z","updated_at":"2019-11-12T02:35:03Z","author_association":"NONE","body":"https://www.gwern.net/GPT-2#training\r\n\r\nSeems like a single 1080Ti with 11GB should be enough - if you switch to FP16 you wouldn't even need to use gradient checkpointing (Gwern used FP32).\r\n\r\n","reactions":{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/552707116/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"michaelklachko","id":981619,"node_id":"MDQ6VXNlcjk4MTYxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/981619?v=4","gravatar_id":"","url":"https://api.github.com/users/michaelklachko","html_url":"https://github.com/michaelklachko","followers_url":"https://api.github.com/users/michaelklachko/followers","following_url":"https://api.github.com/users/michaelklachko/following{/other_user}","gists_url":"https://api.github.com/users/michaelklachko/gists{/gist_id}","starred_url":"https://api.github.com/users/michaelklachko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/michaelklachko/subscriptions","organizations_url":"https://api.github.com/users/michaelklachko/orgs","repos_url":"https://api.github.com/users/michaelklachko/repos","events_url":"https://api.github.com/users/michaelklachko/events{/privacy}","received_events_url":"https://api.github.com/users/michaelklachko/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/556434252","html_url":"https://github.com/huggingface/transfer-learning-conv-ai/issues/14#issuecomment-556434252","issue_url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/14","id":556434252,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NjQzNDI1Mg==","user":{"login":"gwern","id":352559,"node_id":"MDQ6VXNlcjM1MjU1OQ==","avatar_url":"https://avatars.githubusercontent.com/u/352559?v=4","gravatar_id":"","url":"https://api.github.com/users/gwern","html_url":"https://github.com/gwern","followers_url":"https://api.github.com/users/gwern/followers","following_url":"https://api.github.com/users/gwern/following{/other_user}","gists_url":"https://api.github.com/users/gwern/gists{/gist_id}","starred_url":"https://api.github.com/users/gwern/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwern/subscriptions","organizations_url":"https://api.github.com/users/gwern/orgs","repos_url":"https://api.github.com/users/gwern/repos","events_url":"https://api.github.com/users/gwern/events{/privacy}","received_events_url":"https://api.github.com/users/gwern/received_events","type":"User","site_admin":false},"created_at":"2019-11-20T21:40:40Z","updated_at":"2019-11-20T21:40:40Z","author_association":"NONE","body":"Tweaking the gradient checkpointing was enough to get 774M to work, but not 1.5b. We experimented with FP16 when we were trying to get 1.5b to work a 1080ti. It caused a lot of issues: the codebase multiplies by constants which can't be represented in FP16 (so it wound up generating '!!!!!!' infinitely, because that's the first BPE token or whatever) and once we figured that out and converted the pretrained model over to FP16, the output was completely screwed up, so something slightly more clever obviously was required to make reduced precision work. At which point we switched over to Colab TPUs (which opened up an entirely different kettle of worms relating to TPU iterations randomly freezing, our best guess so far is that some reshape or loop makes the TPU very unhappy).","reactions":{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/556434252/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"gwern","id":352559,"node_id":"MDQ6VXNlcjM1MjU1OQ==","avatar_url":"https://avatars.githubusercontent.com/u/352559?v=4","gravatar_id":"","url":"https://api.github.com/users/gwern","html_url":"https://github.com/gwern","followers_url":"https://api.github.com/users/gwern/followers","following_url":"https://api.github.com/users/gwern/following{/other_user}","gists_url":"https://api.github.com/users/gwern/gists{/gist_id}","starred_url":"https://api.github.com/users/gwern/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwern/subscriptions","organizations_url":"https://api.github.com/users/gwern/orgs","repos_url":"https://api.github.com/users/gwern/repos","events_url":"https://api.github.com/users/gwern/events{/privacy}","received_events_url":"https://api.github.com/users/gwern/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/570919969","html_url":"https://github.com/huggingface/transfer-learning-conv-ai/issues/14#issuecomment-570919969","issue_url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/14","id":570919969,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MDkxOTk2OQ==","user":{"login":"ibzip","id":12831837,"node_id":"MDQ6VXNlcjEyODMxODM3","avatar_url":"https://avatars.githubusercontent.com/u/12831837?v=4","gravatar_id":"","url":"https://api.github.com/users/ibzip","html_url":"https://github.com/ibzip","followers_url":"https://api.github.com/users/ibzip/followers","following_url":"https://api.github.com/users/ibzip/following{/other_user}","gists_url":"https://api.github.com/users/ibzip/gists{/gist_id}","starred_url":"https://api.github.com/users/ibzip/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ibzip/subscriptions","organizations_url":"https://api.github.com/users/ibzip/orgs","repos_url":"https://api.github.com/users/ibzip/repos","events_url":"https://api.github.com/users/ibzip/events{/privacy}","received_events_url":"https://api.github.com/users/ibzip/received_events","type":"User","site_admin":false},"created_at":"2020-01-05T15:01:36Z","updated_at":"2020-01-05T15:01:36Z","author_association":"NONE","body":"> Tweaking the gradient checkpointing was enough to get 774M to work, but not 1.5b. We experimented with FP16 when we were trying to get 1.5b to work a 1080ti. It caused a lot of issues: the codebase multiplies by constants which can't be represented in FP16 (so it wound up generating '!!!!!!' infinitely, because that's the first BPE token or whatever) and once we figured that out and converted the pretrained model over to FP16, the output was completely screwed up, so something slightly more clever obviously was required to make reduced precision work. At which point we switched over to Colab TPUs (which opened up an entirely different kettle of worms relating to TPU iterations randomly freezing, our best guess so far is that some reshape or loop makes the TPU very unhappy).\r\n\r\n@gwern  mind mentioning broadly what you tweaked? I am using checkpointing in pytorch and can't fit even 1 sample into a 12 gb gpu for the 774M version.","reactions":{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/570919969/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ibzip","id":12831837,"node_id":"MDQ6VXNlcjEyODMxODM3","avatar_url":"https://avatars.githubusercontent.com/u/12831837?v=4","gravatar_id":"","url":"https://api.github.com/users/ibzip","html_url":"https://github.com/ibzip","followers_url":"https://api.github.com/users/ibzip/followers","following_url":"https://api.github.com/users/ibzip/following{/other_user}","gists_url":"https://api.github.com/users/ibzip/gists{/gist_id}","starred_url":"https://api.github.com/users/ibzip/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ibzip/subscriptions","organizations_url":"https://api.github.com/users/ibzip/orgs","repos_url":"https://api.github.com/users/ibzip/repos","events_url":"https://api.github.com/users/ibzip/events{/privacy}","received_events_url":"https://api.github.com/users/ibzip/received_events","type":"User","site_admin":false}},{"id":2922516540,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjkyMjUxNjU0MA==","url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/events/2922516540","actor":{"login":"gwern","id":352559,"node_id":"MDQ6VXNlcjM1MjU1OQ==","avatar_url":"https://avatars.githubusercontent.com/u/352559?v=4","gravatar_id":"","url":"https://api.github.com/users/gwern","html_url":"https://github.com/gwern","followers_url":"https://api.github.com/users/gwern/followers","following_url":"https://api.github.com/users/gwern/following{/other_user}","gists_url":"https://api.github.com/users/gwern/gists{/gist_id}","starred_url":"https://api.github.com/users/gwern/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwern/subscriptions","organizations_url":"https://api.github.com/users/gwern/orgs","repos_url":"https://api.github.com/users/gwern/repos","events_url":"https://api.github.com/users/gwern/events{/privacy}","received_events_url":"https://api.github.com/users/gwern/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-05T15:01:37Z","performed_via_github_app":null},{"id":2922516541,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5MjI1MTY1NDE=","url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/events/2922516541","actor":{"login":"gwern","id":352559,"node_id":"MDQ6VXNlcjM1MjU1OQ==","avatar_url":"https://avatars.githubusercontent.com/u/352559?v=4","gravatar_id":"","url":"https://api.github.com/users/gwern","html_url":"https://github.com/gwern","followers_url":"https://api.github.com/users/gwern/followers","following_url":"https://api.github.com/users/gwern/following{/other_user}","gists_url":"https://api.github.com/users/gwern/gists{/gist_id}","starred_url":"https://api.github.com/users/gwern/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwern/subscriptions","organizations_url":"https://api.github.com/users/gwern/orgs","repos_url":"https://api.github.com/users/gwern/repos","events_url":"https://api.github.com/users/gwern/events{/privacy}","received_events_url":"https://api.github.com/users/gwern/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-05T15:01:37Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/570921928","html_url":"https://github.com/huggingface/transfer-learning-conv-ai/issues/14#issuecomment-570921928","issue_url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/14","id":570921928,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MDkyMTkyOA==","user":{"login":"gwern","id":352559,"node_id":"MDQ6VXNlcjM1MjU1OQ==","avatar_url":"https://avatars.githubusercontent.com/u/352559?v=4","gravatar_id":"","url":"https://api.github.com/users/gwern","html_url":"https://github.com/gwern","followers_url":"https://api.github.com/users/gwern/followers","following_url":"https://api.github.com/users/gwern/following{/other_user}","gists_url":"https://api.github.com/users/gwern/gists{/gist_id}","starred_url":"https://api.github.com/users/gwern/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwern/subscriptions","organizations_url":"https://api.github.com/users/gwern/orgs","repos_url":"https://api.github.com/users/gwern/repos","events_url":"https://api.github.com/users/gwern/events{/privacy}","received_events_url":"https://api.github.com/users/gwern/received_events","type":"User","site_admin":false},"created_at":"2020-01-05T15:27:28Z","updated_at":"2020-01-05T15:27:28Z","author_association":"NONE","body":"I believe we needed something like this:\r\n\r\n```Diff\r\ndiff --git a/src/model.py b/src/model.py\r\nindex 4e942d8..71092bc 100644\r\n--- a/src/model.py\r\n+++ b/src/model.py\r\n@@ -124,10 +124,10 @@ def block(x, scope, *, past, hparams):\r\n     with tf.variable_scope(scope):\r\n         nx = x.shape[-1].value\r\n         a, present = attn(norm(x, 'ln_1'), 'attn', nx, past=past, hparams=hparams)\r\n-        x = x + a\r\n+        x = x1 = x + a\r\n         m = mlp(norm(x, 'ln_2'), 'mlp', nx*4, hparams=hparams)\r\n         x = x + m\r\n-        return x, present\r\n+        return x, present, x1\r\n \r\n def past_shape(*, hparams, batch_size=None, sequence=None):\r\n     return [batch_size, hparams.n_layer, 2, hparams.n_head, sequence, hparams.n_embd // hparams.n_head]\r\n@@ -161,9 +161,9 @@ def model(hparams, X, past=None, scope='model', reuse=tf.AUTO_REUSE):\r\n         pasts = tf.unstack(past, axis=1) if past is not None else [None] * hparams.n_layer\r\n         assert len(pasts) == hparams.n_layer\r\n         for layer, past in enumerate(pasts):\r\n-            h, present = block(h, 'h%d' % layer, past=past, hparams=hparams)\r\n-            if layer == 10:\r\n-                tf.add_to_collection('checkpoints', h)\r\n+            h, present, x1 = block(h, 'h%d' % layer, past=past, hparams=hparams)\r\n+            if layer < 48:\r\n+                tf.add_to_collection('checkpoints', x1)\r\n             presents.append(present)\r\n         results['present'] = tf.stack(presents, axis=1)\r\n         h = norm(h, 'ln_f')\r\n```","reactions":{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/570921928/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"gwern","id":352559,"node_id":"MDQ6VXNlcjM1MjU1OQ==","avatar_url":"https://avatars.githubusercontent.com/u/352559?v=4","gravatar_id":"","url":"https://api.github.com/users/gwern","html_url":"https://github.com/gwern","followers_url":"https://api.github.com/users/gwern/followers","following_url":"https://api.github.com/users/gwern/following{/other_user}","gists_url":"https://api.github.com/users/gwern/gists{/gist_id}","starred_url":"https://api.github.com/users/gwern/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwern/subscriptions","organizations_url":"https://api.github.com/users/gwern/orgs","repos_url":"https://api.github.com/users/gwern/repos","events_url":"https://api.github.com/users/gwern/events{/privacy}","received_events_url":"https://api.github.com/users/gwern/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/577053988","html_url":"https://github.com/huggingface/transfer-learning-conv-ai/issues/14#issuecomment-577053988","issue_url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/14","id":577053988,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NzA1Mzk4OA==","user":{"login":"g-karthik","id":3851993,"node_id":"MDQ6VXNlcjM4NTE5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/3851993?v=4","gravatar_id":"","url":"https://api.github.com/users/g-karthik","html_url":"https://github.com/g-karthik","followers_url":"https://api.github.com/users/g-karthik/followers","following_url":"https://api.github.com/users/g-karthik/following{/other_user}","gists_url":"https://api.github.com/users/g-karthik/gists{/gist_id}","starred_url":"https://api.github.com/users/g-karthik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/g-karthik/subscriptions","organizations_url":"https://api.github.com/users/g-karthik/orgs","repos_url":"https://api.github.com/users/g-karthik/repos","events_url":"https://api.github.com/users/g-karthik/events{/privacy}","received_events_url":"https://api.github.com/users/g-karthik/received_events","type":"User","site_admin":false},"created_at":"2020-01-22T07:58:14Z","updated_at":"2020-01-22T07:58:14Z","author_association":"NONE","body":"> What batchsize are you using? Also, are you using `--FP16 O1`?\r\n\r\n@martinritchie I've been using FP16 O3 -- this is giving me a NaN error for the loss computation after like 55% of an epoch of training is done: `WARNING:root:NaN or Inf found in input tensor.`. The training continues after the warning, but it simply continually prints NaN for the loss with the same warning.\r\n\r\nI've also been using a batch size of 2, but I think the NaN error above is specific to FP16.\r\n\r\n@michaelklachko @gwern  I am using FP16 and facing NaN errors.\r\n","reactions":{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/577053988/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"g-karthik","id":3851993,"node_id":"MDQ6VXNlcjM4NTE5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/3851993?v=4","gravatar_id":"","url":"https://api.github.com/users/g-karthik","html_url":"https://github.com/g-karthik","followers_url":"https://api.github.com/users/g-karthik/followers","following_url":"https://api.github.com/users/g-karthik/following{/other_user}","gists_url":"https://api.github.com/users/g-karthik/gists{/gist_id}","starred_url":"https://api.github.com/users/g-karthik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/g-karthik/subscriptions","organizations_url":"https://api.github.com/users/g-karthik/orgs","repos_url":"https://api.github.com/users/g-karthik/repos","events_url":"https://api.github.com/users/g-karthik/events{/privacy}","received_events_url":"https://api.github.com/users/g-karthik/received_events","type":"User","site_admin":false}},{"id":2969023125,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjk2OTAyMzEyNQ==","url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/events/2969023125","actor":{"login":"gwern","id":352559,"node_id":"MDQ6VXNlcjM1MjU1OQ==","avatar_url":"https://avatars.githubusercontent.com/u/352559?v=4","gravatar_id":"","url":"https://api.github.com/users/gwern","html_url":"https://github.com/gwern","followers_url":"https://api.github.com/users/gwern/followers","following_url":"https://api.github.com/users/gwern/following{/other_user}","gists_url":"https://api.github.com/users/gwern/gists{/gist_id}","starred_url":"https://api.github.com/users/gwern/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwern/subscriptions","organizations_url":"https://api.github.com/users/gwern/orgs","repos_url":"https://api.github.com/users/gwern/repos","events_url":"https://api.github.com/users/gwern/events{/privacy}","received_events_url":"https://api.github.com/users/gwern/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-22T07:58:14Z","performed_via_github_app":null},{"id":2969023126,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5NjkwMjMxMjY=","url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/events/2969023126","actor":{"login":"gwern","id":352559,"node_id":"MDQ6VXNlcjM1MjU1OQ==","avatar_url":"https://avatars.githubusercontent.com/u/352559?v=4","gravatar_id":"","url":"https://api.github.com/users/gwern","html_url":"https://github.com/gwern","followers_url":"https://api.github.com/users/gwern/followers","following_url":"https://api.github.com/users/gwern/following{/other_user}","gists_url":"https://api.github.com/users/gwern/gists{/gist_id}","starred_url":"https://api.github.com/users/gwern/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwern/subscriptions","organizations_url":"https://api.github.com/users/gwern/orgs","repos_url":"https://api.github.com/users/gwern/repos","events_url":"https://api.github.com/users/gwern/events{/privacy}","received_events_url":"https://api.github.com/users/gwern/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-22T07:58:15Z","performed_via_github_app":null},{"id":2969023129,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjk2OTAyMzEyOQ==","url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/events/2969023129","actor":{"login":"michaelklachko","id":981619,"node_id":"MDQ6VXNlcjk4MTYxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/981619?v=4","gravatar_id":"","url":"https://api.github.com/users/michaelklachko","html_url":"https://github.com/michaelklachko","followers_url":"https://api.github.com/users/michaelklachko/followers","following_url":"https://api.github.com/users/michaelklachko/following{/other_user}","gists_url":"https://api.github.com/users/michaelklachko/gists{/gist_id}","starred_url":"https://api.github.com/users/michaelklachko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/michaelklachko/subscriptions","organizations_url":"https://api.github.com/users/michaelklachko/orgs","repos_url":"https://api.github.com/users/michaelklachko/repos","events_url":"https://api.github.com/users/michaelklachko/events{/privacy}","received_events_url":"https://api.github.com/users/michaelklachko/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-22T07:58:15Z","performed_via_github_app":null},{"id":2969023130,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5NjkwMjMxMzA=","url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/events/2969023130","actor":{"login":"michaelklachko","id":981619,"node_id":"MDQ6VXNlcjk4MTYxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/981619?v=4","gravatar_id":"","url":"https://api.github.com/users/michaelklachko","html_url":"https://github.com/michaelklachko","followers_url":"https://api.github.com/users/michaelklachko/followers","following_url":"https://api.github.com/users/michaelklachko/following{/other_user}","gists_url":"https://api.github.com/users/michaelklachko/gists{/gist_id}","starred_url":"https://api.github.com/users/michaelklachko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/michaelklachko/subscriptions","organizations_url":"https://api.github.com/users/michaelklachko/orgs","repos_url":"https://api.github.com/users/michaelklachko/repos","events_url":"https://api.github.com/users/michaelklachko/events{/privacy}","received_events_url":"https://api.github.com/users/michaelklachko/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-22T07:58:15Z","performed_via_github_app":null},{"id":2969023134,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjk2OTAyMzEzNA==","url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/events/2969023134","actor":{"login":"martinritchie","id":9074305,"node_id":"MDQ6VXNlcjkwNzQzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/9074305?v=4","gravatar_id":"","url":"https://api.github.com/users/martinritchie","html_url":"https://github.com/martinritchie","followers_url":"https://api.github.com/users/martinritchie/followers","following_url":"https://api.github.com/users/martinritchie/following{/other_user}","gists_url":"https://api.github.com/users/martinritchie/gists{/gist_id}","starred_url":"https://api.github.com/users/martinritchie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinritchie/subscriptions","organizations_url":"https://api.github.com/users/martinritchie/orgs","repos_url":"https://api.github.com/users/martinritchie/repos","events_url":"https://api.github.com/users/martinritchie/events{/privacy}","received_events_url":"https://api.github.com/users/martinritchie/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-22T07:58:15Z","performed_via_github_app":null},{"id":2969023136,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5NjkwMjMxMzY=","url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/events/2969023136","actor":{"login":"martinritchie","id":9074305,"node_id":"MDQ6VXNlcjkwNzQzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/9074305?v=4","gravatar_id":"","url":"https://api.github.com/users/martinritchie","html_url":"https://github.com/martinritchie","followers_url":"https://api.github.com/users/martinritchie/followers","following_url":"https://api.github.com/users/martinritchie/following{/other_user}","gists_url":"https://api.github.com/users/martinritchie/gists{/gist_id}","starred_url":"https://api.github.com/users/martinritchie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinritchie/subscriptions","organizations_url":"https://api.github.com/users/martinritchie/orgs","repos_url":"https://api.github.com/users/martinritchie/repos","events_url":"https://api.github.com/users/martinritchie/events{/privacy}","received_events_url":"https://api.github.com/users/martinritchie/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-22T07:58:15Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/577055226","html_url":"https://github.com/huggingface/transfer-learning-conv-ai/issues/14#issuecomment-577055226","issue_url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/14","id":577055226,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NzA1NTIyNg==","user":{"login":"martinritchie","id":9074305,"node_id":"MDQ6VXNlcjkwNzQzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/9074305?v=4","gravatar_id":"","url":"https://api.github.com/users/martinritchie","html_url":"https://github.com/martinritchie","followers_url":"https://api.github.com/users/martinritchie/followers","following_url":"https://api.github.com/users/martinritchie/following{/other_user}","gists_url":"https://api.github.com/users/martinritchie/gists{/gist_id}","starred_url":"https://api.github.com/users/martinritchie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinritchie/subscriptions","organizations_url":"https://api.github.com/users/martinritchie/orgs","repos_url":"https://api.github.com/users/martinritchie/repos","events_url":"https://api.github.com/users/martinritchie/events{/privacy}","received_events_url":"https://api.github.com/users/martinritchie/received_events","type":"User","site_admin":false},"created_at":"2020-01-22T08:02:22Z","updated_at":"2020-01-22T08:02:22Z","author_association":"NONE","body":"`FP16 O3` can be unstable (check the apex docs), stick to `O1` and this should reduce the chance of it diverging. As Gwern suggested, use gradient checkpointing and reduce the batch size to one if you are still having memory problems. ","reactions":{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/577055226/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"martinritchie","id":9074305,"node_id":"MDQ6VXNlcjkwNzQzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/9074305?v=4","gravatar_id":"","url":"https://api.github.com/users/martinritchie","html_url":"https://github.com/martinritchie","followers_url":"https://api.github.com/users/martinritchie/followers","following_url":"https://api.github.com/users/martinritchie/following{/other_user}","gists_url":"https://api.github.com/users/martinritchie/gists{/gist_id}","starred_url":"https://api.github.com/users/martinritchie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinritchie/subscriptions","organizations_url":"https://api.github.com/users/martinritchie/orgs","repos_url":"https://api.github.com/users/martinritchie/repos","events_url":"https://api.github.com/users/martinritchie/events{/privacy}","received_events_url":"https://api.github.com/users/martinritchie/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/578020619","html_url":"https://github.com/huggingface/transfer-learning-conv-ai/issues/14#issuecomment-578020619","issue_url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/14","id":578020619,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODAyMDYxOQ==","user":{"login":"g-karthik","id":3851993,"node_id":"MDQ6VXNlcjM4NTE5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/3851993?v=4","gravatar_id":"","url":"https://api.github.com/users/g-karthik","html_url":"https://github.com/g-karthik","followers_url":"https://api.github.com/users/g-karthik/followers","following_url":"https://api.github.com/users/g-karthik/following{/other_user}","gists_url":"https://api.github.com/users/g-karthik/gists{/gist_id}","starred_url":"https://api.github.com/users/g-karthik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/g-karthik/subscriptions","organizations_url":"https://api.github.com/users/g-karthik/orgs","repos_url":"https://api.github.com/users/g-karthik/repos","events_url":"https://api.github.com/users/g-karthik/events{/privacy}","received_events_url":"https://api.github.com/users/g-karthik/received_events","type":"User","site_admin":false},"created_at":"2020-01-24T07:22:36Z","updated_at":"2020-01-24T07:22:36Z","author_association":"NONE","body":"@martinritchie do you have any thoughts on how exactly to perform the gradient checkpointing when the underlying modules return variable-number of tensors, like here:\r\n\r\nhttps://github.com/huggingface/transformers/blob/master/src/transformers/modeling_gpt2.py#L478\r\n\r\nI get errors like `CheckpointFunctionBackward.forward: expected Variable (got list) for return value 0.`, and when I looked it up, it seems that variable-number of tensors is not supported.\r\n\r\nPerhaps I could unpack the variable-number of tensors explicitly in every sub-module of the `GPT2Model` and then place checkpoints?","reactions":{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/578020619/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"g-karthik","id":3851993,"node_id":"MDQ6VXNlcjM4NTE5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/3851993?v=4","gravatar_id":"","url":"https://api.github.com/users/g-karthik","html_url":"https://github.com/g-karthik","followers_url":"https://api.github.com/users/g-karthik/followers","following_url":"https://api.github.com/users/g-karthik/following{/other_user}","gists_url":"https://api.github.com/users/g-karthik/gists{/gist_id}","starred_url":"https://api.github.com/users/g-karthik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/g-karthik/subscriptions","organizations_url":"https://api.github.com/users/g-karthik/orgs","repos_url":"https://api.github.com/users/g-karthik/repos","events_url":"https://api.github.com/users/g-karthik/events{/privacy}","received_events_url":"https://api.github.com/users/g-karthik/received_events","type":"User","site_admin":false}},{"id":2976302216,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjk3NjMwMjIxNg==","url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/events/2976302216","actor":{"login":"martinritchie","id":9074305,"node_id":"MDQ6VXNlcjkwNzQzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/9074305?v=4","gravatar_id":"","url":"https://api.github.com/users/martinritchie","html_url":"https://github.com/martinritchie","followers_url":"https://api.github.com/users/martinritchie/followers","following_url":"https://api.github.com/users/martinritchie/following{/other_user}","gists_url":"https://api.github.com/users/martinritchie/gists{/gist_id}","starred_url":"https://api.github.com/users/martinritchie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinritchie/subscriptions","organizations_url":"https://api.github.com/users/martinritchie/orgs","repos_url":"https://api.github.com/users/martinritchie/repos","events_url":"https://api.github.com/users/martinritchie/events{/privacy}","received_events_url":"https://api.github.com/users/martinritchie/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-24T07:22:36Z","performed_via_github_app":null},{"id":2976302219,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5NzYzMDIyMTk=","url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/events/2976302219","actor":{"login":"martinritchie","id":9074305,"node_id":"MDQ6VXNlcjkwNzQzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/9074305?v=4","gravatar_id":"","url":"https://api.github.com/users/martinritchie","html_url":"https://github.com/martinritchie","followers_url":"https://api.github.com/users/martinritchie/followers","following_url":"https://api.github.com/users/martinritchie/following{/other_user}","gists_url":"https://api.github.com/users/martinritchie/gists{/gist_id}","starred_url":"https://api.github.com/users/martinritchie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinritchie/subscriptions","organizations_url":"https://api.github.com/users/martinritchie/orgs","repos_url":"https://api.github.com/users/martinritchie/repos","events_url":"https://api.github.com/users/martinritchie/events{/privacy}","received_events_url":"https://api.github.com/users/martinritchie/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-24T07:22:36Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/578044745","html_url":"https://github.com/huggingface/transfer-learning-conv-ai/issues/14#issuecomment-578044745","issue_url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/14","id":578044745,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODA0NDc0NQ==","user":{"login":"martinritchie","id":9074305,"node_id":"MDQ6VXNlcjkwNzQzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/9074305?v=4","gravatar_id":"","url":"https://api.github.com/users/martinritchie","html_url":"https://github.com/martinritchie","followers_url":"https://api.github.com/users/martinritchie/followers","following_url":"https://api.github.com/users/martinritchie/following{/other_user}","gists_url":"https://api.github.com/users/martinritchie/gists{/gist_id}","starred_url":"https://api.github.com/users/martinritchie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinritchie/subscriptions","organizations_url":"https://api.github.com/users/martinritchie/orgs","repos_url":"https://api.github.com/users/martinritchie/repos","events_url":"https://api.github.com/users/martinritchie/events{/privacy}","received_events_url":"https://api.github.com/users/martinritchie/received_events","type":"User","site_admin":false},"created_at":"2020-01-24T08:54:49Z","updated_at":"2020-01-24T08:54:49Z","author_association":"NONE","body":"That sounds like it would be a little heavy handed. Could you provide a minimal working example or show me how you are using it? ","reactions":{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/578044745/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"martinritchie","id":9074305,"node_id":"MDQ6VXNlcjkwNzQzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/9074305?v=4","gravatar_id":"","url":"https://api.github.com/users/martinritchie","html_url":"https://github.com/martinritchie","followers_url":"https://api.github.com/users/martinritchie/followers","following_url":"https://api.github.com/users/martinritchie/following{/other_user}","gists_url":"https://api.github.com/users/martinritchie/gists{/gist_id}","starred_url":"https://api.github.com/users/martinritchie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinritchie/subscriptions","organizations_url":"https://api.github.com/users/martinritchie/orgs","repos_url":"https://api.github.com/users/martinritchie/repos","events_url":"https://api.github.com/users/martinritchie/events{/privacy}","received_events_url":"https://api.github.com/users/martinritchie/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/578312948","html_url":"https://github.com/huggingface/transfer-learning-conv-ai/issues/14#issuecomment-578312948","issue_url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/14","id":578312948,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODMxMjk0OA==","user":{"login":"g-karthik","id":3851993,"node_id":"MDQ6VXNlcjM4NTE5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/3851993?v=4","gravatar_id":"","url":"https://api.github.com/users/g-karthik","html_url":"https://github.com/g-karthik","followers_url":"https://api.github.com/users/g-karthik/followers","following_url":"https://api.github.com/users/g-karthik/following{/other_user}","gists_url":"https://api.github.com/users/g-karthik/gists{/gist_id}","starred_url":"https://api.github.com/users/g-karthik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/g-karthik/subscriptions","organizations_url":"https://api.github.com/users/g-karthik/orgs","repos_url":"https://api.github.com/users/g-karthik/repos","events_url":"https://api.github.com/users/g-karthik/events{/privacy}","received_events_url":"https://api.github.com/users/g-karthik/received_events","type":"User","site_admin":false},"created_at":"2020-01-24T21:41:29Z","updated_at":"2020-01-24T21:43:58Z","author_association":"NONE","body":"https://github.com/huggingface/transformers/blob/master/src/transformers/modeling_gpt2.py#L478\r\n\r\n@martinritchie So the above line, I basically replaced it with:\r\n\r\n```\r\n            if i == 10:\r\n                outputs = checkpoint(block, hidden_states, layer_past=layer_past, attention_mask=attention_mask,\r\n                                     head_mask=head_mask[i])\r\n            else:\r\n                outputs = block(hidden_states,\r\n                                layer_past=layer_past,\r\n                                attention_mask=attention_mask,\r\n                                head_mask=head_mask[i])\r\n```\r\n\r\nAnd that initially failed saying that `checkpoint.py` does not support keyword arguments. So I removed the keywords from the arguments.\r\n\r\n```\r\n            if i == 10:\r\n                outputs = checkpoint(block, hidden_states, layer_past, attention_mask, head_mask[i])\r\n            else:\r\n                outputs = block(hidden_states,\r\n                                layer_past=layer_past,\r\n                                attention_mask=attention_mask,\r\n                                head_mask=head_mask[i])\r\n```\r\n\r\nAnd with that, the previous error went away and I now have `CheckpointFunctionBackward.forward: expected Variable (got list) for return value 0. `.\r\n\r\nHere's a thread I found about this on the PyTorch forums: https://discuss.pytorch.org/t/checkpoint-didnt-support-list-output/16957/3","reactions":{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/578312948/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"g-karthik","id":3851993,"node_id":"MDQ6VXNlcjM4NTE5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/3851993?v=4","gravatar_id":"","url":"https://api.github.com/users/g-karthik","html_url":"https://github.com/g-karthik","followers_url":"https://api.github.com/users/g-karthik/followers","following_url":"https://api.github.com/users/g-karthik/following{/other_user}","gists_url":"https://api.github.com/users/g-karthik/gists{/gist_id}","starred_url":"https://api.github.com/users/g-karthik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/g-karthik/subscriptions","organizations_url":"https://api.github.com/users/g-karthik/orgs","repos_url":"https://api.github.com/users/g-karthik/repos","events_url":"https://api.github.com/users/g-karthik/events{/privacy}","received_events_url":"https://api.github.com/users/g-karthik/received_events","type":"User","site_admin":false}},{"id":2978680919,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjk3ODY4MDkxOQ==","url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/events/2978680919","actor":{"login":"martinritchie","id":9074305,"node_id":"MDQ6VXNlcjkwNzQzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/9074305?v=4","gravatar_id":"","url":"https://api.github.com/users/martinritchie","html_url":"https://github.com/martinritchie","followers_url":"https://api.github.com/users/martinritchie/followers","following_url":"https://api.github.com/users/martinritchie/following{/other_user}","gists_url":"https://api.github.com/users/martinritchie/gists{/gist_id}","starred_url":"https://api.github.com/users/martinritchie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinritchie/subscriptions","organizations_url":"https://api.github.com/users/martinritchie/orgs","repos_url":"https://api.github.com/users/martinritchie/repos","events_url":"https://api.github.com/users/martinritchie/events{/privacy}","received_events_url":"https://api.github.com/users/martinritchie/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-24T21:41:29Z","performed_via_github_app":null},{"id":2978680923,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5Nzg2ODA5MjM=","url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/events/2978680923","actor":{"login":"martinritchie","id":9074305,"node_id":"MDQ6VXNlcjkwNzQzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/9074305?v=4","gravatar_id":"","url":"https://api.github.com/users/martinritchie","html_url":"https://github.com/martinritchie","followers_url":"https://api.github.com/users/martinritchie/followers","following_url":"https://api.github.com/users/martinritchie/following{/other_user}","gists_url":"https://api.github.com/users/martinritchie/gists{/gist_id}","starred_url":"https://api.github.com/users/martinritchie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinritchie/subscriptions","organizations_url":"https://api.github.com/users/martinritchie/orgs","repos_url":"https://api.github.com/users/martinritchie/repos","events_url":"https://api.github.com/users/martinritchie/events{/privacy}","received_events_url":"https://api.github.com/users/martinritchie/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-24T21:41:29Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/578361894","html_url":"https://github.com/huggingface/transfer-learning-conv-ai/issues/14#issuecomment-578361894","issue_url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/14","id":578361894,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODM2MTg5NA==","user":{"login":"g-karthik","id":3851993,"node_id":"MDQ6VXNlcjM4NTE5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/3851993?v=4","gravatar_id":"","url":"https://api.github.com/users/g-karthik","html_url":"https://github.com/g-karthik","followers_url":"https://api.github.com/users/g-karthik/followers","following_url":"https://api.github.com/users/g-karthik/following{/other_user}","gists_url":"https://api.github.com/users/g-karthik/gists{/gist_id}","starred_url":"https://api.github.com/users/g-karthik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/g-karthik/subscriptions","organizations_url":"https://api.github.com/users/g-karthik/orgs","repos_url":"https://api.github.com/users/g-karthik/repos","events_url":"https://api.github.com/users/g-karthik/events{/privacy}","received_events_url":"https://api.github.com/users/g-karthik/received_events","type":"User","site_admin":false},"created_at":"2020-01-25T01:24:51Z","updated_at":"2020-01-25T01:25:57Z","author_association":"NONE","body":"Update: It looks like in the `transformers` library, I need to simply change the `forward()` in `Block`: specifically, it returns a list of `outputs`, which needs to change to `tuple(outputs)` for checkpointing to work.","reactions":{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/578361894/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"g-karthik","id":3851993,"node_id":"MDQ6VXNlcjM4NTE5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/3851993?v=4","gravatar_id":"","url":"https://api.github.com/users/g-karthik","html_url":"https://github.com/g-karthik","followers_url":"https://api.github.com/users/g-karthik/followers","following_url":"https://api.github.com/users/g-karthik/following{/other_user}","gists_url":"https://api.github.com/users/g-karthik/gists{/gist_id}","starred_url":"https://api.github.com/users/g-karthik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/g-karthik/subscriptions","organizations_url":"https://api.github.com/users/g-karthik/orgs","repos_url":"https://api.github.com/users/g-karthik/repos","events_url":"https://api.github.com/users/g-karthik/events{/privacy}","received_events_url":"https://api.github.com/users/g-karthik/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/578937538","html_url":"https://github.com/huggingface/transfer-learning-conv-ai/issues/14#issuecomment-578937538","issue_url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/14","id":578937538,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODkzNzUzOA==","user":{"login":"g-karthik","id":3851993,"node_id":"MDQ6VXNlcjM4NTE5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/3851993?v=4","gravatar_id":"","url":"https://api.github.com/users/g-karthik","html_url":"https://github.com/g-karthik","followers_url":"https://api.github.com/users/g-karthik/followers","following_url":"https://api.github.com/users/g-karthik/following{/other_user}","gists_url":"https://api.github.com/users/g-karthik/gists{/gist_id}","starred_url":"https://api.github.com/users/g-karthik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/g-karthik/subscriptions","organizations_url":"https://api.github.com/users/g-karthik/orgs","repos_url":"https://api.github.com/users/g-karthik/repos","events_url":"https://api.github.com/users/g-karthik/events{/privacy}","received_events_url":"https://api.github.com/users/g-karthik/received_events","type":"User","site_admin":false},"created_at":"2020-01-27T20:28:46Z","updated_at":"2020-01-27T20:28:46Z","author_association":"NONE","body":"> `FP16 O3` can be unstable (check the apex docs), stick to `O1` and this should reduce the chance of it diverging. As Gwern suggested, use gradient checkpointing and reduce the batch size to one if you are still having memory problems.\r\n\r\n@martinritchie So I'm using gradient checkpointing like above (I changed the if condition to `i <= 12` so all layers are check-pointed) with a batch size of 1, along with fp16 `O1`. I'm still facing CUDA OOM errors. My train dataset tensor is `(Batch, Candidates, Seq length): torch.Size([33410, 3, 150])`.\r\n\r\nAny ideas how to get this to work?","reactions":{"url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/comments/578937538/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"g-karthik","id":3851993,"node_id":"MDQ6VXNlcjM4NTE5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/3851993?v=4","gravatar_id":"","url":"https://api.github.com/users/g-karthik","html_url":"https://github.com/g-karthik","followers_url":"https://api.github.com/users/g-karthik/followers","following_url":"https://api.github.com/users/g-karthik/following{/other_user}","gists_url":"https://api.github.com/users/g-karthik/gists{/gist_id}","starred_url":"https://api.github.com/users/g-karthik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/g-karthik/subscriptions","organizations_url":"https://api.github.com/users/g-karthik/orgs","repos_url":"https://api.github.com/users/g-karthik/repos","events_url":"https://api.github.com/users/g-karthik/events{/privacy}","received_events_url":"https://api.github.com/users/g-karthik/received_events","type":"User","site_admin":false}},{"id":2983283391,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mjk4MzI4MzM5MQ==","url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/events/2983283391","actor":{"login":"martinritchie","id":9074305,"node_id":"MDQ6VXNlcjkwNzQzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/9074305?v=4","gravatar_id":"","url":"https://api.github.com/users/martinritchie","html_url":"https://github.com/martinritchie","followers_url":"https://api.github.com/users/martinritchie/followers","following_url":"https://api.github.com/users/martinritchie/following{/other_user}","gists_url":"https://api.github.com/users/martinritchie/gists{/gist_id}","starred_url":"https://api.github.com/users/martinritchie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinritchie/subscriptions","organizations_url":"https://api.github.com/users/martinritchie/orgs","repos_url":"https://api.github.com/users/martinritchie/repos","events_url":"https://api.github.com/users/martinritchie/events{/privacy}","received_events_url":"https://api.github.com/users/martinritchie/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-01-27T20:28:46Z","performed_via_github_app":null},{"id":2983283394,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5ODMyODMzOTQ=","url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/events/2983283394","actor":{"login":"martinritchie","id":9074305,"node_id":"MDQ6VXNlcjkwNzQzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/9074305?v=4","gravatar_id":"","url":"https://api.github.com/users/martinritchie","html_url":"https://github.com/martinritchie","followers_url":"https://api.github.com/users/martinritchie/followers","following_url":"https://api.github.com/users/martinritchie/following{/other_user}","gists_url":"https://api.github.com/users/martinritchie/gists{/gist_id}","starred_url":"https://api.github.com/users/martinritchie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinritchie/subscriptions","organizations_url":"https://api.github.com/users/martinritchie/orgs","repos_url":"https://api.github.com/users/martinritchie/repos","events_url":"https://api.github.com/users/martinritchie/events{/privacy}","received_events_url":"https://api.github.com/users/martinritchie/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-01-27T20:28:46Z","performed_via_github_app":null},{"id":4166654049,"node_id":"MDExOkNsb3NlZEV2ZW50NDE2NjY1NDA0OQ==","url":"https://api.github.com/repos/huggingface/transfer-learning-conv-ai/issues/events/4166654049","actor":{"login":"g-karthik","id":3851993,"node_id":"MDQ6VXNlcjM4NTE5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/3851993?v=4","gravatar_id":"","url":"https://api.github.com/users/g-karthik","html_url":"https://github.com/g-karthik","followers_url":"https://api.github.com/users/g-karthik/followers","following_url":"https://api.github.com/users/g-karthik/following{/other_user}","gists_url":"https://api.github.com/users/g-karthik/gists{/gist_id}","starred_url":"https://api.github.com/users/g-karthik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/g-karthik/subscriptions","organizations_url":"https://api.github.com/users/g-karthik/orgs","repos_url":"https://api.github.com/users/g-karthik/repos","events_url":"https://api.github.com/users/g-karthik/events{/privacy}","received_events_url":"https://api.github.com/users/g-karthik/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-01-04T20:43:48Z","state_reason":null,"performed_via_github_app":null}]