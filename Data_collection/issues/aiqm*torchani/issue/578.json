{"url":"https://api.github.com/repos/aiqm/torchani/issues/578","repository_url":"https://api.github.com/repos/aiqm/torchani","labels_url":"https://api.github.com/repos/aiqm/torchani/issues/578/labels{/name}","comments_url":"https://api.github.com/repos/aiqm/torchani/issues/578/comments","events_url":"https://api.github.com/repos/aiqm/torchani/issues/578/events","html_url":"https://github.com/aiqm/torchani/issues/578","id":825217590,"node_id":"MDU6SXNzdWU4MjUyMTc1OTA=","number":578,"title":"Question about training/validation split & shuffle","user":{"login":"shubbey","id":24950802,"node_id":"MDQ6VXNlcjI0OTUwODAy","avatar_url":"https://avatars.githubusercontent.com/u/24950802?v=4","gravatar_id":"","url":"https://api.github.com/users/shubbey","html_url":"https://github.com/shubbey","followers_url":"https://api.github.com/users/shubbey/followers","following_url":"https://api.github.com/users/shubbey/following{/other_user}","gists_url":"https://api.github.com/users/shubbey/gists{/gist_id}","starred_url":"https://api.github.com/users/shubbey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shubbey/subscriptions","organizations_url":"https://api.github.com/users/shubbey/orgs","repos_url":"https://api.github.com/users/shubbey/repos","events_url":"https://api.github.com/users/shubbey/events{/privacy}","received_events_url":"https://api.github.com/users/shubbey/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2021-03-09T03:00:58Z","updated_at":"2021-06-03T18:50:38Z","closed_at":"2021-06-03T18:50:38Z","author_association":"NONE","active_lock_reason":null,"body":"Consider two implementations of the training routine:\r\n\r\n```\r\ntraining, validation = \r\n        torchani.data.load('data.h5').subtract_self_energies(...).species_to_indices(...).shuffle().split(0.8,None)\r\n```\r\n\r\nvs\r\n\r\n```\r\ntraining = torchani.data.load('train.h5').subtract_self_energies(...).species_to_indices(...).shuffle()\r\nvalidation = torchani.data.load('validate.h5').subtract_self_energies(...).species_to_indices(...)\r\n# where train.h5 is a random sample of 80% of the molecules in data.h5, and validate.h5 is the remaining 20%)\r\n```\r\n\r\nThe first implementation gives me very good results (converges to an RMSE of 1.6 KJ/mol over my large training set)  The second, much worse (about 10 kJ/mol)  The reason I initially went with the second approach is that I thought it would be better to ensure that the training and validation sets were comprised of unique molecules.  In the first implementation, I don't believe this is the case because the loader routine (in data/__init.py__) returns conformers of molecules before shuffling and splitting, meaning that two different conformers of the same molecule could be present in training and validation sets.\r\n\r\nNow it may be the case that training and validating on different conformers of the same molecule is good and intended.  When I run this fully trained implementation against a test set of independent molecules, it does very well-- the RMSE is worse than the validation set but much better than the second implementation.\r\n\r\nSo I am wondering if I am doing something wrong here or fundamentally misunderstanding how this works.  I'm also a little confused as to how the shuffle() works here.  Is the data only shuffled one time and then kept in that order each epoch, or is there more to it?  Is my second implementation missing something?  Thank you for any help you can provide!\r\n","closed_by":{"login":"IgnacioJPickering","id":34223426,"node_id":"MDQ6VXNlcjM0MjIzNDI2","avatar_url":"https://avatars.githubusercontent.com/u/34223426?v=4","gravatar_id":"","url":"https://api.github.com/users/IgnacioJPickering","html_url":"https://github.com/IgnacioJPickering","followers_url":"https://api.github.com/users/IgnacioJPickering/followers","following_url":"https://api.github.com/users/IgnacioJPickering/following{/other_user}","gists_url":"https://api.github.com/users/IgnacioJPickering/gists{/gist_id}","starred_url":"https://api.github.com/users/IgnacioJPickering/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IgnacioJPickering/subscriptions","organizations_url":"https://api.github.com/users/IgnacioJPickering/orgs","repos_url":"https://api.github.com/users/IgnacioJPickering/repos","events_url":"https://api.github.com/users/IgnacioJPickering/events{/privacy}","received_events_url":"https://api.github.com/users/IgnacioJPickering/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/aiqm/torchani/issues/578/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/aiqm/torchani/issues/578/timeline","performed_via_github_app":null,"state_reason":"completed"}