{"url":"https://api.github.com/repos/aiqm/torchani/issues/595","repository_url":"https://api.github.com/repos/aiqm/torchani","labels_url":"https://api.github.com/repos/aiqm/torchani/issues/595/labels{/name}","comments_url":"https://api.github.com/repos/aiqm/torchani/issues/595/comments","events_url":"https://api.github.com/repos/aiqm/torchani/issues/595/events","html_url":"https://github.com/aiqm/torchani/issues/595","id":940886038,"node_id":"MDU6SXNzdWU5NDA4ODYwMzg=","number":595,"title":"CUAEV RuntimeError: CUDA error: an illegal memory access was encountered","user":{"login":"LiuCMU","id":60156077,"node_id":"MDQ6VXNlcjYwMTU2MDc3","avatar_url":"https://avatars.githubusercontent.com/u/60156077?v=4","gravatar_id":"","url":"https://api.github.com/users/LiuCMU","html_url":"https://github.com/LiuCMU","followers_url":"https://api.github.com/users/LiuCMU/followers","following_url":"https://api.github.com/users/LiuCMU/following{/other_user}","gists_url":"https://api.github.com/users/LiuCMU/gists{/gist_id}","starred_url":"https://api.github.com/users/LiuCMU/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LiuCMU/subscriptions","organizations_url":"https://api.github.com/users/LiuCMU/orgs","repos_url":"https://api.github.com/users/LiuCMU/repos","events_url":"https://api.github.com/users/LiuCMU/events{/privacy}","received_events_url":"https://api.github.com/users/LiuCMU/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-07-09T15:57:10Z","updated_at":"2021-07-19T21:51:47Z","closed_at":"2021-07-19T21:51:47Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, when using CUAEV on <code>torch.device('cuda:1')</code>, it gave me the following error information:\r\n\r\n```bash\r\nTraceback (most recent call last):\r\n  File \"ani_e.py\", line 208, in <module>\r\n    rmse = validate()\r\n  File \"ani_e.py\", line 194, in validate\r\n    _, predicted_energies = model((species, coordinates))\r\n  File \"/home/jack/miniconda3/envs/CUAEV/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 1051, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\n  File \"/home/jack/miniconda3/envs/CUAEV/lib/python3.7/site-packages/torchani-2.3.dev60+ga85e330-py3.7-linux-x86_64.egg/torchani/nn.py\", line 111, in forward\r\n    input_ = module(input_, cell=cell, pbc=pbc)\r\n  File \"/home/jack/miniconda3/envs/CUAEV/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 1051, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\n  File \"/home/jack/miniconda3/envs/CUAEV/lib/python3.7/site-packages/torchani-2.3.dev60+ga85e330-py3.7-linux-x86_64.egg/torchani/nn.py\", line 60, in forward\r\n    atomic_energies = self._atomic_energies((species, aev))\r\n  File \"/home/jack/miniconda3/envs/CUAEV/lib/python3.7/site-packages/torchani-2.3.dev60+ga85e330-py3.7-linux-x86_64.egg/torchani/nn.py\", line 72, in _atomic_energies\r\n    output = aev.new_zeros(species_.shape)\r\n**RuntimeError: CUDA error: an illegal memory access was encountered**\r\nCUDA kernel errors might be asynchronously reported at some other API call,so the stacktrace below might be incorrect.\r\nFor debugging consider passing CUDA_LAUNCH_BLOCKING=1.\r\n```\r\n\r\n\r\nIf I use <code>torch.device('cuda:0')</code> with CUAEV, the the code runs well. Otherwise, using <code>torch.device('cuda:1')</code> without CUAEV also works. This looks like a issue related to CUAEV on a device with multiple GPUs. Could anyone provide some debug tips for that? Thanks!\r\n\r\nTo sum up:\r\n- <code>torch.device('cuda:0')</code>  with CUAEV: runs well\r\n- <code>torch.device('cuda:1')</code> with CUAEV: yields the above error\r\n- <code>torch.device('cuda:1')</code> without CUAEV: runs well","closed_by":{"login":"yueyericardo","id":9999318,"node_id":"MDQ6VXNlcjk5OTkzMTg=","avatar_url":"https://avatars.githubusercontent.com/u/9999318?v=4","gravatar_id":"","url":"https://api.github.com/users/yueyericardo","html_url":"https://github.com/yueyericardo","followers_url":"https://api.github.com/users/yueyericardo/followers","following_url":"https://api.github.com/users/yueyericardo/following{/other_user}","gists_url":"https://api.github.com/users/yueyericardo/gists{/gist_id}","starred_url":"https://api.github.com/users/yueyericardo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yueyericardo/subscriptions","organizations_url":"https://api.github.com/users/yueyericardo/orgs","repos_url":"https://api.github.com/users/yueyericardo/repos","events_url":"https://api.github.com/users/yueyericardo/events{/privacy}","received_events_url":"https://api.github.com/users/yueyericardo/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/aiqm/torchani/issues/595/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/aiqm/torchani/issues/595/timeline","performed_via_github_app":null,"state_reason":"completed"}