{"url":"https://api.github.com/repos/aiqm/torchani/issues/254","repository_url":"https://api.github.com/repos/aiqm/torchani","labels_url":"https://api.github.com/repos/aiqm/torchani/issues/254/labels{/name}","comments_url":"https://api.github.com/repos/aiqm/torchani/issues/254/comments","events_url":"https://api.github.com/repos/aiqm/torchani/issues/254/events","html_url":"https://github.com/aiqm/torchani/issues/254","id":456450098,"node_id":"MDU6SXNzdWU0NTY0NTAwOTg=","number":254,"title":"Questions about methane example","user":{"login":"maxentile","id":5759036,"node_id":"MDQ6VXNlcjU3NTkwMzY=","avatar_url":"https://avatars.githubusercontent.com/u/5759036?v=4","gravatar_id":"","url":"https://api.github.com/users/maxentile","html_url":"https://github.com/maxentile","followers_url":"https://api.github.com/users/maxentile/followers","following_url":"https://api.github.com/users/maxentile/following{/other_user}","gists_url":"https://api.github.com/users/maxentile/gists{/gist_id}","starred_url":"https://api.github.com/users/maxentile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxentile/subscriptions","organizations_url":"https://api.github.com/users/maxentile/orgs","repos_url":"https://api.github.com/users/maxentile/repos","events_url":"https://api.github.com/users/maxentile/events{/privacy}","received_events_url":"https://api.github.com/users/maxentile/received_events","type":"User","site_admin":false},"labels":[{"id":1406935680,"node_id":"MDU6TGFiZWwxNDA2OTM1Njgw","url":"https://api.github.com/repos/aiqm/torchani/labels/high%20priority","name":"high priority","color":"b51020","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2019-06-14T21:41:33Z","updated_at":"2019-06-17T01:24:19Z","closed_at":"2019-06-17T01:24:19Z","author_association":"NONE","active_lock_reason":null,"body":"Hello,\r\n\r\nThank you very much for making this project available!\r\n\r\nWe are excited about the prospect of using ANI-1ccx for tautomer ratio prediction, but have started encountering some surprising behavior when designing and testing Monte Carlo moves for this purpose.\r\n\r\nTagging Marcus Wieder (@wiederm) who helped prepare this Issue with me, and John Chodera (@jchodera) who may be interested in following this thread.\r\n\r\n# 1. Existence and favorability of unphysical local minima on methane example\r\n\r\n## 1.1. Bond-length scan from a tetrahedral geometry\r\n\r\nWe started by inspecting the methane example\r\n```python\r\nimport torchani\r\nimport torch\r\n\r\ndevice = torch.device('cpu')\r\nmodel = torchani.models.ANI1ccx()\r\nspecies = model.species_to_tensor('CHHHH').to(device).unsqueeze(0)\r\n```\r\n\r\nIf we take an ideal tetrahedral geometry and scale all the C-H bond lengths, we obtain the following energy profile:\r\n\r\n![methane_tetrahedral_scan](https://user-images.githubusercontent.com/5759036/59526289-99596a00-8ea6-11e9-8a2a-8c5fa79a173c.png)\r\n\r\nThe minimum-energy tetrahedral geometry of methane along this scan is approximately:\r\n\r\n```python\r\narray([[ 0.        ,  0.        ,  0.        ],\r\n       [ 0.63918859,  0.63918859,  0.63918859],\r\n       [-0.63918859, -0.63918859,  0.63918859],\r\n       [-0.63918859,  0.63918859, -0.63918859],\r\n       [ 0.63918859, -0.63918859, -0.63918859]])\r\n```\r\n![tetrahedron](https://user-images.githubusercontent.com/5759036/59529562-5f409600-8eaf-11e9-94d0-9cdd35f4a5d2.png)\r\n\r\nwith a C-H bond length of 1.107 angstroms, and an energy of -106266.1875 kJ/mol.\r\n\r\n## 1.2. Accessibility of unphysical local minima in room-temperature MD\r\nWe ran 50 picoseconds of constant-temperature MD at 300K starting from the tetrahedral geometry obtained above.\r\n\r\n(Code: https://gist.github.com/maxentile/ac04d1fab8dd4aa217fe224190d06765)\r\n\r\nThe simulation quickly finds many geometries with lower apparent energy than the starting tetrahedral geometry.\r\n\r\n![methane_energy_trace](https://user-images.githubusercontent.com/5759036/59537849-cbc68f80-8ec5-11e9-8473-24a79b4d2ea2.png)\r\n\r\nThe simulation does not retain a tetrahedral geometry. Instead the H-C-H angles appear to be metastable.\r\n\r\n![methane_angle_trace](https://user-images.githubusercontent.com/5759036/59526997-62845380-8ea8-11e9-9c4f-721a543fc1d4.png)\r\n\r\nHere are the histograms of H-C-H angles visited in the trajectory:\r\n\r\n![methane_angle_histogram](https://user-images.githubusercontent.com/5759036/59526290-99596a00-8ea6-11e9-9ef8-9001fccbbc0f.png)\r\n\r\nAlso the C-H distances appear to be bistable:\r\n![methane_distance_trace](https://user-images.githubusercontent.com/5759036/59527141-ce66bc00-8ea8-11e9-9161-75dafdcbcba2.png)\r\n\r\n## 1.3. ANI-1ccx predicts a non-tetrahedral geometry to have nearly 50 kJ/mol lower energy than the minimum-energy tetrahedral geometry\r\n\r\nThe lowest-energy snapshot from this trajectory includes nearly right angles, and is over 40 kJ/mol more favorable than the minimum-energy tetrahedral geometry. We further minimized its energy using gradient descent on the ANI-1ccx potential, obtaining the following:\r\n```python\r\narray([[ 0.        ,  0.        ,  0.        ],\r\n       [ 0.64702535,  0.64647233,  0.8811238 ],\r\n       [-0.64734113, -0.6475463 ,  0.8808765 ],\r\n       [-0.7168874 ,  0.7172707 , -0.33484012],\r\n       [ 0.7182246 , -0.71852016, -0.33497408]])\r\n```\r\n\r\n![global_minimum_structure](https://user-images.githubusercontent.com/5759036/59527504-c2c7c500-8ea9-11e9-96b4-59c68dba02c9.png)\r\n\r\nwith two of the C-H bonds at length 1.27 angstroms and the other two C-H bonds at length 1.07 angstroms.\r\n\r\nThe H-C-H angles at this conformation are 92.2 , 102.5, and 143.5 degrees.\r\n\r\nThe ANI-1ccx energy of this configuration is -106313.8125 kJ/mol.\r\n\r\nThis is ~47 kJ/mol more favorable than the minimum-energy tetrahedral geometry.\r\n\r\nIs there an intuition for this behavior, and is anything similar observed for more complicated molecules?\r\n\r\n## 1.4. Energy scans\r\nWe took the energy-minimized geometry and scaled it up and down, obtaining the following energy profile (in orange):\r\n![methane_tetrahedral_with_uncertainties](https://user-images.githubusercontent.com/5759036/59526288-99596a00-8ea6-11e9-881c-44cf30a3c3c5.png)\r\n\r\nThe x-axis represents the average C-H bond length. The uncertainty bands represent the standard deviation among the 8 models in the ANI-1ccx ensemble.\r\n\r\nFor comparison, in blue is the energy profile we obtained for tetrahedral geometries, the dashed line is the energy obtained when the coordinates are all (0,0,0), and the dotted line at 0 corresponds to the global minimum energy encountered so far.\r\n\r\nWe observe that the energy profiles have many local minima and cusps. Is there an intuition for why the energy profile looks this way, or how it might be corrected?\r\n\r\nAlso, it appears that the ANI-1ccx ensemble has large uncertainty throughout these scans -- is there guidance on how to use this information?\r\n\r\n# 2. Local energy minimum when all coordinates are zero\r\nWe further noticed that for the methane example in the `Computing Energy and Force` tutorial https://aiqm.github.io/torchani/examples/energy_force.html, setting all coordinates to (0,0,0) is ~30kJ/mol more favorable than the the starting geometry (-106221.367 kJ/mol vs -106189.195 kJ/mol).\r\n\r\n## 2.1. Energy scan, scaling all C-H distances\r\nFor illustration, here is the energy profile as we scale the example starting geometry up and down:\r\n![all_bonds_not_minimized_mean](https://user-images.githubusercontent.com/5759036/59526385-cf96e980-8ea6-11e9-891d-3c4cdb035c27.png)\r\n\r\nThe existence of a local minimum with all nuclei on top of each other is concerning in the context of Monte Carlo moves that instantaneously propose to move hydrogens, since they might randomly propose geometries that induce steric clashes, and we would want such proposals to be rejected.\r\n\r\n## 2.2. Comparison: changing only one H position, rather than all H positions\r\nIf we bring only one of the hydrogens closer to the central carbon (rather than all of them), we obtain an energy profile that instead looks like this:\r\n![single_bond_not_minimized_mean](https://user-images.githubusercontent.com/5759036/59526386-cf96e980-8ea6-11e9-98ce-ebcf1cd23a6e.png)\r\n\r\nThe high energy predicted when one hydrogen is placed on top of the central carbon is reassuring, since it suggests instantaneous Monte Carlo proposals that try to place one hydrogen directly on top of a heavy atom will not be accepted with any appreciable probability. However, it is still surprising that the energy does not increase monotonically as the interatomic distance approaches zero from the equilibrium bond length.\r\n\r\nIs there an intuition for how to correct this behavior?\r\n\r\nBest regards,\r\nJosh","closed_by":{"login":"maxentile","id":5759036,"node_id":"MDQ6VXNlcjU3NTkwMzY=","avatar_url":"https://avatars.githubusercontent.com/u/5759036?v=4","gravatar_id":"","url":"https://api.github.com/users/maxentile","html_url":"https://github.com/maxentile","followers_url":"https://api.github.com/users/maxentile/followers","following_url":"https://api.github.com/users/maxentile/following{/other_user}","gists_url":"https://api.github.com/users/maxentile/gists{/gist_id}","starred_url":"https://api.github.com/users/maxentile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxentile/subscriptions","organizations_url":"https://api.github.com/users/maxentile/orgs","repos_url":"https://api.github.com/users/maxentile/repos","events_url":"https://api.github.com/users/maxentile/events{/privacy}","received_events_url":"https://api.github.com/users/maxentile/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/aiqm/torchani/issues/254/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/aiqm/torchani/issues/254/timeline","performed_via_github_app":null,"state_reason":"completed"}