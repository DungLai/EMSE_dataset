[{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/611168233","html_url":"https://github.com/aiqm/torchani/issues/444#issuecomment-611168233","issue_url":"https://api.github.com/repos/aiqm/torchani/issues/444","id":611168233,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMTE2ODIzMw==","user":{"login":"farhadrgh","id":13050245,"node_id":"MDQ6VXNlcjEzMDUwMjQ1","avatar_url":"https://avatars.githubusercontent.com/u/13050245?v=4","gravatar_id":"","url":"https://api.github.com/users/farhadrgh","html_url":"https://github.com/farhadrgh","followers_url":"https://api.github.com/users/farhadrgh/followers","following_url":"https://api.github.com/users/farhadrgh/following{/other_user}","gists_url":"https://api.github.com/users/farhadrgh/gists{/gist_id}","starred_url":"https://api.github.com/users/farhadrgh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farhadrgh/subscriptions","organizations_url":"https://api.github.com/users/farhadrgh/orgs","repos_url":"https://api.github.com/users/farhadrgh/repos","events_url":"https://api.github.com/users/farhadrgh/events{/privacy}","received_events_url":"https://api.github.com/users/farhadrgh/received_events","type":"User","site_admin":false},"created_at":"2020-04-08T20:10:17Z","updated_at":"2020-04-08T20:10:17Z","author_association":"MEMBER","body":"Hi,\r\n\r\nOur data loader is looking for the following keys in HDF5 datasets: `species`, `coordinates`, `energies`, and `forces`. These are the keys that we also have in our ANI1 datasets. \r\n\r\nOne solution is to overwrite the data API to look for the keys in the ANI2x dataset you have. The other solution is to rename the keys in HDF5 to be compatible with the data API. In this case, `numbers` will have to be changed to `species` and species will need to be registered as follows:\r\n\r\n```python\r\nspecies_to_tensor = torchani.utils.ChemicalSymbolsToInts(['H', 'C', 'N', 'O', 'F', 'Cl'])\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/611168233/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"farhadrgh","id":13050245,"node_id":"MDQ6VXNlcjEzMDUwMjQ1","avatar_url":"https://avatars.githubusercontent.com/u/13050245?v=4","gravatar_id":"","url":"https://api.github.com/users/farhadrgh","html_url":"https://github.com/farhadrgh","followers_url":"https://api.github.com/users/farhadrgh/followers","following_url":"https://api.github.com/users/farhadrgh/following{/other_user}","gists_url":"https://api.github.com/users/farhadrgh/gists{/gist_id}","starred_url":"https://api.github.com/users/farhadrgh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farhadrgh/subscriptions","organizations_url":"https://api.github.com/users/farhadrgh/orgs","repos_url":"https://api.github.com/users/farhadrgh/repos","events_url":"https://api.github.com/users/farhadrgh/events{/privacy}","received_events_url":"https://api.github.com/users/farhadrgh/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/611242536","html_url":"https://github.com/aiqm/torchani/issues/444#issuecomment-611242536","issue_url":"https://api.github.com/repos/aiqm/torchani/issues/444","id":611242536,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMTI0MjUzNg==","user":{"login":"muammar","id":954209,"node_id":"MDQ6VXNlcjk1NDIwOQ==","avatar_url":"https://avatars.githubusercontent.com/u/954209?v=4","gravatar_id":"","url":"https://api.github.com/users/muammar","html_url":"https://github.com/muammar","followers_url":"https://api.github.com/users/muammar/followers","following_url":"https://api.github.com/users/muammar/following{/other_user}","gists_url":"https://api.github.com/users/muammar/gists{/gist_id}","starred_url":"https://api.github.com/users/muammar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muammar/subscriptions","organizations_url":"https://api.github.com/users/muammar/orgs","repos_url":"https://api.github.com/users/muammar/repos","events_url":"https://api.github.com/users/muammar/events{/privacy}","received_events_url":"https://api.github.com/users/muammar/received_events","type":"User","site_admin":false},"created_at":"2020-04-08T23:18:57Z","updated_at":"2020-04-08T23:19:55Z","author_association":"NONE","body":"This issue was solved with a script that does the following: \r\n\r\n```\r\nimport pyanitools as pyt\r\nimport numpy as np\r\nimport warnings\r\nimport sys\r\nwarnings.filterwarnings(\"ignore\")\r\n\r\ndataset_in = \"path/origin/data.h5\"\r\ndataset_out = \"path/to/new/data.h5\"\r\nenergy_key = 'wb97x_dz.energy'\r\nforce_key = 'wb97x_dz.forces'\r\nadl = pyt.anidataloader(dataset_in)\r\ndpack = pyt.datapacker(dataset_out)\r\n\r\n\r\ndef num_to_S(nums):\r\n    S = []\r\n    sdict = {'1': 'H', '6': 'C', '7': 'N', '8': 'O', '9': 'F', '16': 'S', '17': 'Cl'}\r\n    for i in nums:\r\n        S.append(sdict[str(i)])\r\n    return(S)\r\n\r\n\r\ndef trunc(array, decs=3):\r\n    \"\"\"Truncate values of an array after a given descimal point\"\"\"\r\n    return np.trunc(array*10**decs)/(10**decs)\r\n\r\n\r\nn_total_data = 0\r\nfor data in adl:\r\n    path = data['path']\r\n    del data['path']\r\n\r\n    n_total_data += data[energy_key].shape[0]\r\n    data['coordinates'] = data['coord']\r\n    data['energies'] = data[energy_key]\r\n    data['species'] = num_to_S(data['numbers'])\r\n    data['forces'] = data[force_key]\r\n\r\n    for key in ['coord', 'numbers', force_key, energy_key]:\r\n        del data[key]\r\n    dpack.store_data(path, **data)\r\n\r\nprint(f'Total number of datapoints in {dataset_in}: {n_total_data}')\r\n\r\ndpack.cleanup()\r\n\r\nadl = pyt.anidataloader(dataset_out)\r\nnum_mol = 0\r\nfor data in adl:\r\n    num_mol += data[\"energies\"].shape[0]\r\nprint(f'Number of molecules written in {dataset_out}: {num_mol}')\r\n```","reactions":{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/611242536/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"muammar","id":954209,"node_id":"MDQ6VXNlcjk1NDIwOQ==","avatar_url":"https://avatars.githubusercontent.com/u/954209?v=4","gravatar_id":"","url":"https://api.github.com/users/muammar","html_url":"https://github.com/muammar","followers_url":"https://api.github.com/users/muammar/followers","following_url":"https://api.github.com/users/muammar/following{/other_user}","gists_url":"https://api.github.com/users/muammar/gists{/gist_id}","starred_url":"https://api.github.com/users/muammar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muammar/subscriptions","organizations_url":"https://api.github.com/users/muammar/orgs","repos_url":"https://api.github.com/users/muammar/repos","events_url":"https://api.github.com/users/muammar/events{/privacy}","received_events_url":"https://api.github.com/users/muammar/received_events","type":"User","site_admin":false}},{"id":3216189232,"node_id":"MDExOkNsb3NlZEV2ZW50MzIxNjE4OTIzMg==","url":"https://api.github.com/repos/aiqm/torchani/issues/events/3216189232","actor":{"login":"muammar","id":954209,"node_id":"MDQ6VXNlcjk1NDIwOQ==","avatar_url":"https://avatars.githubusercontent.com/u/954209?v=4","gravatar_id":"","url":"https://api.github.com/users/muammar","html_url":"https://github.com/muammar","followers_url":"https://api.github.com/users/muammar/followers","following_url":"https://api.github.com/users/muammar/following{/other_user}","gists_url":"https://api.github.com/users/muammar/gists{/gist_id}","starred_url":"https://api.github.com/users/muammar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muammar/subscriptions","organizations_url":"https://api.github.com/users/muammar/orgs","repos_url":"https://api.github.com/users/muammar/repos","events_url":"https://api.github.com/users/muammar/events{/privacy}","received_events_url":"https://api.github.com/users/muammar/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-04-08T23:18:57Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/611258827","html_url":"https://github.com/aiqm/torchani/issues/444#issuecomment-611258827","issue_url":"https://api.github.com/repos/aiqm/torchani/issues/444","id":611258827,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMTI1ODgyNw==","user":{"login":"farhadrgh","id":13050245,"node_id":"MDQ6VXNlcjEzMDUwMjQ1","avatar_url":"https://avatars.githubusercontent.com/u/13050245?v=4","gravatar_id":"","url":"https://api.github.com/users/farhadrgh","html_url":"https://github.com/farhadrgh","followers_url":"https://api.github.com/users/farhadrgh/followers","following_url":"https://api.github.com/users/farhadrgh/following{/other_user}","gists_url":"https://api.github.com/users/farhadrgh/gists{/gist_id}","starred_url":"https://api.github.com/users/farhadrgh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farhadrgh/subscriptions","organizations_url":"https://api.github.com/users/farhadrgh/orgs","repos_url":"https://api.github.com/users/farhadrgh/repos","events_url":"https://api.github.com/users/farhadrgh/events{/privacy}","received_events_url":"https://api.github.com/users/farhadrgh/received_events","type":"User","site_admin":false},"created_at":"2020-04-09T00:17:42Z","updated_at":"2020-04-09T00:17:42Z","author_association":"MEMBER","body":"> This issue was solved with a script that does the following:\r\n> \r\n> ```\r\n> import pyanitools as pyt\r\n> import numpy as np\r\n> import warnings\r\n> import sys\r\n> warnings.filterwarnings(\"ignore\")\r\n> \r\n> dataset_in = \"path/origin/data.h5\"\r\n> dataset_out = \"path/to/new/data.h5\"\r\n> energy_key = 'wb97x_dz.energy'\r\n> force_key = 'wb97x_dz.forces'\r\n> adl = pyt.anidataloader(dataset_in)\r\n> dpack = pyt.datapacker(dataset_out)\r\n> \r\n> \r\n> def num_to_S(nums):\r\n>     S = []\r\n>     sdict = {'1': 'H', '6': 'C', '7': 'N', '8': 'O', '9': 'F', '16': 'S', '17': 'Cl'}\r\n>     for i in nums:\r\n>         S.append(sdict[str(i)])\r\n>     return(S)\r\n> \r\n> \r\n> def trunc(array, decs=3):\r\n>     \"\"\"Truncate values of an array after a given descimal point\"\"\"\r\n>     return np.trunc(array*10**decs)/(10**decs)\r\n> \r\n> \r\n> n_total_data = 0\r\n> for data in adl:\r\n>     path = data['path']\r\n>     del data['path']\r\n> \r\n>     n_total_data += data[energy_key].shape[0]\r\n>     data['coordinates'] = data['coord']\r\n>     data['energies'] = data[energy_key]\r\n>     data['species'] = num_to_S(data['numbers'])\r\n>     data['forces'] = data[force_key]\r\n> \r\n>     for key in ['coord', 'numbers', force_key, energy_key]:\r\n>         del data[key]\r\n>     dpack.store_data(path, **data)\r\n> \r\n> print(f'Total number of datapoints in {dataset_in}: {n_total_data}')\r\n> \r\n> dpack.cleanup()\r\n> \r\n> adl = pyt.anidataloader(dataset_out)\r\n> num_mol = 0\r\n> for data in adl:\r\n>     num_mol += data[\"energies\"].shape[0]\r\n> print(f'Number of molecules written in {dataset_out}: {num_mol}')\r\n> ```\r\n\r\nGreat, I am glad it worked. I just need to mention that this script requires ANITools which can be found from [here](https://github.com/Jussmith01/ANI-Tools/tree/lanl_updated).","reactions":{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/611258827/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"farhadrgh","id":13050245,"node_id":"MDQ6VXNlcjEzMDUwMjQ1","avatar_url":"https://avatars.githubusercontent.com/u/13050245?v=4","gravatar_id":"","url":"https://api.github.com/users/farhadrgh","html_url":"https://github.com/farhadrgh","followers_url":"https://api.github.com/users/farhadrgh/followers","following_url":"https://api.github.com/users/farhadrgh/following{/other_user}","gists_url":"https://api.github.com/users/farhadrgh/gists{/gist_id}","starred_url":"https://api.github.com/users/farhadrgh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farhadrgh/subscriptions","organizations_url":"https://api.github.com/users/farhadrgh/orgs","repos_url":"https://api.github.com/users/farhadrgh/repos","events_url":"https://api.github.com/users/farhadrgh/events{/privacy}","received_events_url":"https://api.github.com/users/farhadrgh/received_events","type":"User","site_admin":false}}]