[{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/1063345990","html_url":"https://github.com/aiqm/torchani/issues/612#issuecomment-1063345990","issue_url":"https://api.github.com/repos/aiqm/torchani/issues/612","id":1063345990,"node_id":"IC_kwDOB5237M4_YV9G","user":{"login":"shubbey","id":24950802,"node_id":"MDQ6VXNlcjI0OTUwODAy","avatar_url":"https://avatars.githubusercontent.com/u/24950802?v=4","gravatar_id":"","url":"https://api.github.com/users/shubbey","html_url":"https://github.com/shubbey","followers_url":"https://api.github.com/users/shubbey/followers","following_url":"https://api.github.com/users/shubbey/following{/other_user}","gists_url":"https://api.github.com/users/shubbey/gists{/gist_id}","starred_url":"https://api.github.com/users/shubbey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shubbey/subscriptions","organizations_url":"https://api.github.com/users/shubbey/orgs","repos_url":"https://api.github.com/users/shubbey/repos","events_url":"https://api.github.com/users/shubbey/events{/privacy}","received_events_url":"https://api.github.com/users/shubbey/received_events","type":"User","site_admin":false},"created_at":"2022-03-09T20:34:39Z","updated_at":"2022-03-09T20:34:39Z","author_association":"NONE","body":"It depends on how you saved the model, but if it's based off the default training script, you just need to load the saved network weights into whatever ANI model you originally used, eg\r\n```\r\nnn = torchani.ANIModel([H_network, C_network, N_network, O_network...])\r\nbest_pt = torch.load('best.pt')\r\nnn.load_state_dict(best_pt)\r\nmodel = torchani.nn.Sequential(aev_computer, nn).to(device)\r\n```","reactions":{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/1063345990/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"shubbey","id":24950802,"node_id":"MDQ6VXNlcjI0OTUwODAy","avatar_url":"https://avatars.githubusercontent.com/u/24950802?v=4","gravatar_id":"","url":"https://api.github.com/users/shubbey","html_url":"https://github.com/shubbey","followers_url":"https://api.github.com/users/shubbey/followers","following_url":"https://api.github.com/users/shubbey/following{/other_user}","gists_url":"https://api.github.com/users/shubbey/gists{/gist_id}","starred_url":"https://api.github.com/users/shubbey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shubbey/subscriptions","organizations_url":"https://api.github.com/users/shubbey/orgs","repos_url":"https://api.github.com/users/shubbey/repos","events_url":"https://api.github.com/users/shubbey/events{/privacy}","received_events_url":"https://api.github.com/users/shubbey/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/1063481119","html_url":"https://github.com/aiqm/torchani/issues/612#issuecomment-1063481119","issue_url":"https://api.github.com/repos/aiqm/torchani/issues/612","id":1063481119,"node_id":"IC_kwDOB5237M4_Y28f","user":{"login":"rschireman","id":41241487,"node_id":"MDQ6VXNlcjQxMjQxNDg3","avatar_url":"https://avatars.githubusercontent.com/u/41241487?v=4","gravatar_id":"","url":"https://api.github.com/users/rschireman","html_url":"https://github.com/rschireman","followers_url":"https://api.github.com/users/rschireman/followers","following_url":"https://api.github.com/users/rschireman/following{/other_user}","gists_url":"https://api.github.com/users/rschireman/gists{/gist_id}","starred_url":"https://api.github.com/users/rschireman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rschireman/subscriptions","organizations_url":"https://api.github.com/users/rschireman/orgs","repos_url":"https://api.github.com/users/rschireman/repos","events_url":"https://api.github.com/users/rschireman/events{/privacy}","received_events_url":"https://api.github.com/users/rschireman/received_events","type":"User","site_admin":false},"created_at":"2022-03-09T23:26:22Z","updated_at":"2022-03-09T23:26:22Z","author_association":"CONTRIBUTOR","body":"Thanks for the quick response! Now, I have an error computing the aev for my target molecule. The error I am obtaining is:\r\n\r\n` radial_aev.index_add_(0, index12[1], radial_terms_)`\r\n`IndexError: index out of range in self`\r\n\r\nMy network is as follows: \r\n\r\n```\r\ndevice = torch.device('cpu')\r\nRcr = 5.2000e+00\r\nRca = 3.5000e+00\r\nEtaR = torch.tensor([1.6000000e+01], device=device)\r\nShfR = torch.tensor([9.0000000e-01, 1.1687500e+00, 1.4375000e+00, 1.7062500e+00, 1.9750000e+00, 2.2437500e+00, 2.5125000e+00, 2.7812500e+00, 3.0500000e+00, 3.3187500e+00, 3.5875000e+00, 3.8562500e+00, 4.1250000e+00, 4.3937500e+00, 4.6625000e+00, 4.9312500e+00], device=device)\r\nZeta = torch.tensor([3.2000000e+01], device=device)\r\nShfZ = torch.tensor([1.9634954e-01, 5.8904862e-01, 9.8174770e-01, 1.3744468e+00, 1.7671459e+00, 2.1598449e+00, 2.5525440e+00, 2.9452431e+00], device=device)\r\nEtaA = torch.tensor([8.0000000e+00], device=device)\r\nShfA = torch.tensor([9.0000000e-01, 1.5500000e+00, 2.2000000e+00, 2.8500000e+00], device=device)\r\nspecies_order = ['S', 'C', 'H']\r\n\r\nnum_species = len(species_order)\r\naev_computer = torchani.AEVComputer(Rcr, Rca, EtaR, ShfR, EtaA, Zeta, ShfA, ShfZ, num_species)\r\nenergy_shifter = torchani.utils.EnergyShifter(None)\r\n###############################################################################\r\n# The code to define networks, optimizers, are mostly the same\r\naev_dim = aev_computer.aev_length\r\n\r\nH_network = torch.nn.Sequential(\r\n    torch.nn.Linear(aev_dim, 160),\r\n    torch.nn.CELU(0.1),\r\n    torch.nn.Linear(160, 128),\r\n    torch.nn.CELU(0.1),\r\n    torch.nn.Linear(128, 96),\r\n    torch.nn.CELU(0.1),\r\n    torch.nn.Linear(96, 1)\r\n)\r\n\r\nC_network = torch.nn.Sequential(\r\n    torch.nn.Linear(aev_dim, 144),\r\n    torch.nn.CELU(0.1),\r\n    torch.nn.Linear(144, 112),\r\n    torch.nn.CELU(0.1),\r\n    torch.nn.Linear(112, 96),\r\n    torch.nn.CELU(0.1),\r\n    torch.nn.Linear(96, 1)\r\n)\r\n\r\nS_network = torch.nn.Sequential(\r\n    torch.nn.Linear(aev_dim, 128),\r\n    torch.nn.CELU(0.1),\r\n    torch.nn.Linear(128, 112),\r\n    torch.nn.CELU(0.1),\r\n    torch.nn.Linear(112, 96),\r\n    torch.nn.CELU(0.1),\r\n    torch.nn.Linear(96, 1)\r\n)\r\n\r\n\r\nnn = torchani.ANIModel([H_network, C_network, S_network])\r\nbest_pt = torch.load('force-training-best.pt')\r\nprint(best_pt)\r\nnn.load_state_dict(best_pt)\r\nmodel = torchani.nn.Sequential(aev_computer, nn).to(device)\r\nprint(model)\r\n\r\nmolecule = ase.io.read(\"BTBT.pdb\")\r\nprint(molecule.get_chemical_symbols())\r\n```\r\n\r\n`BTBT.pdb` is a 24 atom organic molecule and my dataset contains 10,000 off-equilibrium structures of this molecule with accompanying forces and energies. My suspicion is that `species_order` is incorrect, but I have no idea where this error could be coming from.","reactions":{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/1063481119/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rschireman","id":41241487,"node_id":"MDQ6VXNlcjQxMjQxNDg3","avatar_url":"https://avatars.githubusercontent.com/u/41241487?v=4","gravatar_id":"","url":"https://api.github.com/users/rschireman","html_url":"https://github.com/rschireman","followers_url":"https://api.github.com/users/rschireman/followers","following_url":"https://api.github.com/users/rschireman/following{/other_user}","gists_url":"https://api.github.com/users/rschireman/gists{/gist_id}","starred_url":"https://api.github.com/users/rschireman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rschireman/subscriptions","organizations_url":"https://api.github.com/users/rschireman/orgs","repos_url":"https://api.github.com/users/rschireman/repos","events_url":"https://api.github.com/users/rschireman/events{/privacy}","received_events_url":"https://api.github.com/users/rschireman/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/1063486444","html_url":"https://github.com/aiqm/torchani/issues/612#issuecomment-1063486444","issue_url":"https://api.github.com/repos/aiqm/torchani/issues/612","id":1063486444,"node_id":"IC_kwDOB5237M4_Y4Ps","user":{"login":"shubbey","id":24950802,"node_id":"MDQ6VXNlcjI0OTUwODAy","avatar_url":"https://avatars.githubusercontent.com/u/24950802?v=4","gravatar_id":"","url":"https://api.github.com/users/shubbey","html_url":"https://github.com/shubbey","followers_url":"https://api.github.com/users/shubbey/followers","following_url":"https://api.github.com/users/shubbey/following{/other_user}","gists_url":"https://api.github.com/users/shubbey/gists{/gist_id}","starred_url":"https://api.github.com/users/shubbey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shubbey/subscriptions","organizations_url":"https://api.github.com/users/shubbey/orgs","repos_url":"https://api.github.com/users/shubbey/repos","events_url":"https://api.github.com/users/shubbey/events{/privacy}","received_events_url":"https://api.github.com/users/shubbey/received_events","type":"User","site_admin":false},"created_at":"2022-03-09T23:35:03Z","updated_at":"2022-03-09T23:35:03Z","author_association":"NONE","body":"You probably want to make your species_order = ['H','C','S'] to match your ANIModel network order. ","reactions":{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/1063486444/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"shubbey","id":24950802,"node_id":"MDQ6VXNlcjI0OTUwODAy","avatar_url":"https://avatars.githubusercontent.com/u/24950802?v=4","gravatar_id":"","url":"https://api.github.com/users/shubbey","html_url":"https://github.com/shubbey","followers_url":"https://api.github.com/users/shubbey/followers","following_url":"https://api.github.com/users/shubbey/following{/other_user}","gists_url":"https://api.github.com/users/shubbey/gists{/gist_id}","starred_url":"https://api.github.com/users/shubbey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shubbey/subscriptions","organizations_url":"https://api.github.com/users/shubbey/orgs","repos_url":"https://api.github.com/users/shubbey/repos","events_url":"https://api.github.com/users/shubbey/events{/privacy}","received_events_url":"https://api.github.com/users/shubbey/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/1063515209","html_url":"https://github.com/aiqm/torchani/issues/612#issuecomment-1063515209","issue_url":"https://api.github.com/repos/aiqm/torchani/issues/612","id":1063515209,"node_id":"IC_kwDOB5237M4_Y_RJ","user":{"login":"rschireman","id":41241487,"node_id":"MDQ6VXNlcjQxMjQxNDg3","avatar_url":"https://avatars.githubusercontent.com/u/41241487?v=4","gravatar_id":"","url":"https://api.github.com/users/rschireman","html_url":"https://github.com/rschireman","followers_url":"https://api.github.com/users/rschireman/followers","following_url":"https://api.github.com/users/rschireman/following{/other_user}","gists_url":"https://api.github.com/users/rschireman/gists{/gist_id}","starred_url":"https://api.github.com/users/rschireman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rschireman/subscriptions","organizations_url":"https://api.github.com/users/rschireman/orgs","repos_url":"https://api.github.com/users/rschireman/repos","events_url":"https://api.github.com/users/rschireman/events{/privacy}","received_events_url":"https://api.github.com/users/rschireman/received_events","type":"User","site_admin":false},"created_at":"2022-03-10T00:20:01Z","updated_at":"2022-03-10T00:20:01Z","author_association":"CONTRIBUTOR","body":"retrained with `species_order=['H','C','S']` and the same error is still occurring. The error indicates that this line is the culprit:\r\n\r\n`energies = model((species, coordinates)).energies`","reactions":{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/1063515209/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rschireman","id":41241487,"node_id":"MDQ6VXNlcjQxMjQxNDg3","avatar_url":"https://avatars.githubusercontent.com/u/41241487?v=4","gravatar_id":"","url":"https://api.github.com/users/rschireman","html_url":"https://github.com/rschireman","followers_url":"https://api.github.com/users/rschireman/followers","following_url":"https://api.github.com/users/rschireman/following{/other_user}","gists_url":"https://api.github.com/users/rschireman/gists{/gist_id}","starred_url":"https://api.github.com/users/rschireman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rschireman/subscriptions","organizations_url":"https://api.github.com/users/rschireman/orgs","repos_url":"https://api.github.com/users/rschireman/repos","events_url":"https://api.github.com/users/rschireman/events{/privacy}","received_events_url":"https://api.github.com/users/rschireman/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/1063515611","html_url":"https://github.com/aiqm/torchani/issues/612#issuecomment-1063515611","issue_url":"https://api.github.com/repos/aiqm/torchani/issues/612","id":1063515611,"node_id":"IC_kwDOB5237M4_Y_Xb","user":{"login":"rschireman","id":41241487,"node_id":"MDQ6VXNlcjQxMjQxNDg3","avatar_url":"https://avatars.githubusercontent.com/u/41241487?v=4","gravatar_id":"","url":"https://api.github.com/users/rschireman","html_url":"https://github.com/rschireman","followers_url":"https://api.github.com/users/rschireman/followers","following_url":"https://api.github.com/users/rschireman/following{/other_user}","gists_url":"https://api.github.com/users/rschireman/gists{/gist_id}","starred_url":"https://api.github.com/users/rschireman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rschireman/subscriptions","organizations_url":"https://api.github.com/users/rschireman/orgs","repos_url":"https://api.github.com/users/rschireman/repos","events_url":"https://api.github.com/users/rschireman/events{/privacy}","received_events_url":"https://api.github.com/users/rschireman/received_events","type":"User","site_admin":false},"created_at":"2022-03-10T00:20:43Z","updated_at":"2022-03-10T00:20:43Z","author_association":"CONTRIBUTOR","body":"the order of atoms from the pdb file is:\r\n\r\n`['S', 'C', 'C', 'H', 'C', 'H', 'C', 'H', 'C', 'H', 'C', 'C', 'S', 'C', 'C', 'H', 'C', 'H', 'C', 'H', 'C', 'C', 'C', 'H']`","reactions":{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/1063515611/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rschireman","id":41241487,"node_id":"MDQ6VXNlcjQxMjQxNDg3","avatar_url":"https://avatars.githubusercontent.com/u/41241487?v=4","gravatar_id":"","url":"https://api.github.com/users/rschireman","html_url":"https://github.com/rschireman","followers_url":"https://api.github.com/users/rschireman/followers","following_url":"https://api.github.com/users/rschireman/following{/other_user}","gists_url":"https://api.github.com/users/rschireman/gists{/gist_id}","starred_url":"https://api.github.com/users/rschireman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rschireman/subscriptions","organizations_url":"https://api.github.com/users/rschireman/orgs","repos_url":"https://api.github.com/users/rschireman/repos","events_url":"https://api.github.com/users/rschireman/events{/privacy}","received_events_url":"https://api.github.com/users/rschireman/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/1069235170","html_url":"https://github.com/aiqm/torchani/issues/612#issuecomment-1069235170","issue_url":"https://api.github.com/repos/aiqm/torchani/issues/612","id":1069235170,"node_id":"IC_kwDOB5237M4_uzvi","user":{"login":"rschireman","id":41241487,"node_id":"MDQ6VXNlcjQxMjQxNDg3","avatar_url":"https://avatars.githubusercontent.com/u/41241487?v=4","gravatar_id":"","url":"https://api.github.com/users/rschireman","html_url":"https://github.com/rschireman","followers_url":"https://api.github.com/users/rschireman/followers","following_url":"https://api.github.com/users/rschireman/following{/other_user}","gists_url":"https://api.github.com/users/rschireman/gists{/gist_id}","starred_url":"https://api.github.com/users/rschireman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rschireman/subscriptions","organizations_url":"https://api.github.com/users/rschireman/orgs","repos_url":"https://api.github.com/users/rschireman/repos","events_url":"https://api.github.com/users/rschireman/events{/privacy}","received_events_url":"https://api.github.com/users/rschireman/received_events","type":"User","site_admin":false},"created_at":"2022-03-16T15:12:23Z","updated_at":"2022-03-16T15:12:23Z","author_association":"CONTRIBUTOR","body":"The solution was changing the species to torchani's indices:\r\n\r\n`species = torch.tensor([[2,\t1,\t1,\t0,\t1,\t0,\t1,\t0,\t1,\t0,\t1,\t1,\t2,\t1,\t1,\t0,\t1,\t0,\t1,\t0,\t1,\t1,\t1,\t0]],device=device,dtype=torch.long)`","reactions":{"url":"https://api.github.com/repos/aiqm/torchani/issues/comments/1069235170/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rschireman","id":41241487,"node_id":"MDQ6VXNlcjQxMjQxNDg3","avatar_url":"https://avatars.githubusercontent.com/u/41241487?v=4","gravatar_id":"","url":"https://api.github.com/users/rschireman","html_url":"https://github.com/rschireman","followers_url":"https://api.github.com/users/rschireman/followers","following_url":"https://api.github.com/users/rschireman/following{/other_user}","gists_url":"https://api.github.com/users/rschireman/gists{/gist_id}","starred_url":"https://api.github.com/users/rschireman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rschireman/subscriptions","organizations_url":"https://api.github.com/users/rschireman/orgs","repos_url":"https://api.github.com/users/rschireman/repos","events_url":"https://api.github.com/users/rschireman/events{/privacy}","received_events_url":"https://api.github.com/users/rschireman/received_events","type":"User","site_admin":false}},{"id":6251779683,"node_id":"CE_lADOB5237M5FZzaozwAAAAF0opZj","url":"https://api.github.com/repos/aiqm/torchani/issues/events/6251779683","actor":{"login":"rschireman","id":41241487,"node_id":"MDQ6VXNlcjQxMjQxNDg3","avatar_url":"https://avatars.githubusercontent.com/u/41241487?v=4","gravatar_id":"","url":"https://api.github.com/users/rschireman","html_url":"https://github.com/rschireman","followers_url":"https://api.github.com/users/rschireman/followers","following_url":"https://api.github.com/users/rschireman/following{/other_user}","gists_url":"https://api.github.com/users/rschireman/gists{/gist_id}","starred_url":"https://api.github.com/users/rschireman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rschireman/subscriptions","organizations_url":"https://api.github.com/users/rschireman/orgs","repos_url":"https://api.github.com/users/rschireman/repos","events_url":"https://api.github.com/users/rschireman/events{/privacy}","received_events_url":"https://api.github.com/users/rschireman/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-03-16T15:12:24Z","state_reason":null,"performed_via_github_app":null}]