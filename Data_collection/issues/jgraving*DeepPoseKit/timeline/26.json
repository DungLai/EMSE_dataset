[{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/552682854","html_url":"https://github.com/jgraving/DeepPoseKit/issues/26#issuecomment-552682854","issue_url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/26","id":552682854,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MjY4Mjg1NA==","user":{"login":"DenisPolygalov","id":18456799,"node_id":"MDQ6VXNlcjE4NDU2Nzk5","avatar_url":"https://avatars.githubusercontent.com/u/18456799?v=4","gravatar_id":"","url":"https://api.github.com/users/DenisPolygalov","html_url":"https://github.com/DenisPolygalov","followers_url":"https://api.github.com/users/DenisPolygalov/followers","following_url":"https://api.github.com/users/DenisPolygalov/following{/other_user}","gists_url":"https://api.github.com/users/DenisPolygalov/gists{/gist_id}","starred_url":"https://api.github.com/users/DenisPolygalov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DenisPolygalov/subscriptions","organizations_url":"https://api.github.com/users/DenisPolygalov/orgs","repos_url":"https://api.github.com/users/DenisPolygalov/repos","events_url":"https://api.github.com/users/DenisPolygalov/events{/privacy}","received_events_url":"https://api.github.com/users/DenisPolygalov/received_events","type":"User","site_admin":false},"created_at":"2019-11-12T00:47:03Z","updated_at":"2019-11-12T00:47:03Z","author_association":"CONTRIBUTOR","body":"What type of downsampling you talking about? If it is about **raw video** and **spatial** or **temporal** downsampling - then it might be better to use OpenCV for that...","reactions":{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/552682854/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"DenisPolygalov","id":18456799,"node_id":"MDQ6VXNlcjE4NDU2Nzk5","avatar_url":"https://avatars.githubusercontent.com/u/18456799?v=4","gravatar_id":"","url":"https://api.github.com/users/DenisPolygalov","html_url":"https://github.com/DenisPolygalov","followers_url":"https://api.github.com/users/DenisPolygalov/followers","following_url":"https://api.github.com/users/DenisPolygalov/following{/other_user}","gists_url":"https://api.github.com/users/DenisPolygalov/gists{/gist_id}","starred_url":"https://api.github.com/users/DenisPolygalov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DenisPolygalov/subscriptions","organizations_url":"https://api.github.com/users/DenisPolygalov/orgs","repos_url":"https://api.github.com/users/DenisPolygalov/repos","events_url":"https://api.github.com/users/DenisPolygalov/events{/privacy}","received_events_url":"https://api.github.com/users/DenisPolygalov/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/552704246","html_url":"https://github.com/jgraving/DeepPoseKit/issues/26#issuecomment-552704246","issue_url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/26","id":552704246,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MjcwNDI0Ng==","user":{"login":"richard-warren","id":31221441,"node_id":"MDQ6VXNlcjMxMjIxNDQx","avatar_url":"https://avatars.githubusercontent.com/u/31221441?v=4","gravatar_id":"","url":"https://api.github.com/users/richard-warren","html_url":"https://github.com/richard-warren","followers_url":"https://api.github.com/users/richard-warren/followers","following_url":"https://api.github.com/users/richard-warren/following{/other_user}","gists_url":"https://api.github.com/users/richard-warren/gists{/gist_id}","starred_url":"https://api.github.com/users/richard-warren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richard-warren/subscriptions","organizations_url":"https://api.github.com/users/richard-warren/orgs","repos_url":"https://api.github.com/users/richard-warren/repos","events_url":"https://api.github.com/users/richard-warren/events{/privacy}","received_events_url":"https://api.github.com/users/richard-warren/received_events","type":"User","site_admin":false},"created_at":"2019-11-12T02:21:49Z","updated_at":"2019-11-12T02:21:49Z","author_association":"NONE","body":"I'm suggesting spatial downsampling. Yes, it would definitely work with OpenCV, or ffmpeg. A maxpooling layer in the network itself may be faster (is this accurate?) and more convenient, but definitely not the only way to make it happen. Thanks!","reactions":{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/552704246/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"richard-warren","id":31221441,"node_id":"MDQ6VXNlcjMxMjIxNDQx","avatar_url":"https://avatars.githubusercontent.com/u/31221441?v=4","gravatar_id":"","url":"https://api.github.com/users/richard-warren","html_url":"https://github.com/richard-warren","followers_url":"https://api.github.com/users/richard-warren/followers","following_url":"https://api.github.com/users/richard-warren/following{/other_user}","gists_url":"https://api.github.com/users/richard-warren/gists{/gist_id}","starred_url":"https://api.github.com/users/richard-warren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richard-warren/subscriptions","organizations_url":"https://api.github.com/users/richard-warren/orgs","repos_url":"https://api.github.com/users/richard-warren/repos","events_url":"https://api.github.com/users/richard-warren/events{/privacy}","received_events_url":"https://api.github.com/users/richard-warren/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/552874463","html_url":"https://github.com/jgraving/DeepPoseKit/issues/26#issuecomment-552874463","issue_url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/26","id":552874463,"node_id":"MDEyOklzc3VlQ29tbWVudDU1Mjg3NDQ2Mw==","user":{"login":"jgraving","id":5445636,"node_id":"MDQ6VXNlcjU0NDU2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5445636?v=4","gravatar_id":"","url":"https://api.github.com/users/jgraving","html_url":"https://github.com/jgraving","followers_url":"https://api.github.com/users/jgraving/followers","following_url":"https://api.github.com/users/jgraving/following{/other_user}","gists_url":"https://api.github.com/users/jgraving/gists{/gist_id}","starred_url":"https://api.github.com/users/jgraving/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgraving/subscriptions","organizations_url":"https://api.github.com/users/jgraving/orgs","repos_url":"https://api.github.com/users/jgraving/repos","events_url":"https://api.github.com/users/jgraving/events{/privacy}","received_events_url":"https://api.github.com/users/jgraving/received_events","type":"User","site_admin":false},"created_at":"2019-11-12T12:33:23Z","updated_at":"2019-11-12T12:33:23Z","author_association":"OWNER","body":"This is definitely possible but we would want to avoid adding too much complexity to the code. The easiest approach is probably to add an option for the `TrainingGenerator` that tells the model to downsample the input images to some specified resolution or by some factor (with a corresponding adjustment to the confidence maps). \r\n\r\nA lot of the overhead of the processing time during inference is actually transferring the images into GPU memory, so I'm not sure how much faster this would be compared to preprocessing the frames with opencv. However, even if this isn't faster it would make using the code much simpler as everything is self-contained within the model.\r\n\r\nThat being said, `MaxPooling2D` is probably not the best option to accomplish this as it would add local artefactual distortions. Ideally you would want a custom layer `DownSampling2D` or `ResizeImage` similar to [`UpSampling2D`](https://github.com/tensorflow/tensorflow/blob/r1.15/tensorflow/python/keras/layers/convolutional.py#L1917-L1996) that uses [`tf.image.resize`](https://www.tensorflow.org/versions/r2.0/api_docs/python/tf/image/resize), which includes proper image interpolation algorithms like bilinear interpolation.\r\n\r\nThis would also be useful for adjusting image resolution to a power of 2 (for downsampling and upsampling within the model), and could allow for variably sized images. I originally thought zero padding was the best way, but this seems like the better option. \r\n\r\n","reactions":{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/552874463/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jgraving","id":5445636,"node_id":"MDQ6VXNlcjU0NDU2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5445636?v=4","gravatar_id":"","url":"https://api.github.com/users/jgraving","html_url":"https://github.com/jgraving","followers_url":"https://api.github.com/users/jgraving/followers","following_url":"https://api.github.com/users/jgraving/following{/other_user}","gists_url":"https://api.github.com/users/jgraving/gists{/gist_id}","starred_url":"https://api.github.com/users/jgraving/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgraving/subscriptions","organizations_url":"https://api.github.com/users/jgraving/orgs","repos_url":"https://api.github.com/users/jgraving/repos","events_url":"https://api.github.com/users/jgraving/events{/privacy}","received_events_url":"https://api.github.com/users/jgraving/received_events","type":"User","site_admin":false}},{"id":2791296776,"node_id":"MDEyOkxhYmVsZWRFdmVudDI3OTEyOTY3NzY=","url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/events/2791296776","actor":{"login":"jgraving","id":5445636,"node_id":"MDQ6VXNlcjU0NDU2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5445636?v=4","gravatar_id":"","url":"https://api.github.com/users/jgraving","html_url":"https://github.com/jgraving","followers_url":"https://api.github.com/users/jgraving/followers","following_url":"https://api.github.com/users/jgraving/following{/other_user}","gists_url":"https://api.github.com/users/jgraving/gists{/gist_id}","starred_url":"https://api.github.com/users/jgraving/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgraving/subscriptions","organizations_url":"https://api.github.com/users/jgraving/orgs","repos_url":"https://api.github.com/users/jgraving/repos","events_url":"https://api.github.com/users/jgraving/events{/privacy}","received_events_url":"https://api.github.com/users/jgraving/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-11-12T12:35:07Z","label":{"name":"enhancement","color":"a2eeef"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/552974467","html_url":"https://github.com/jgraving/DeepPoseKit/issues/26#issuecomment-552974467","issue_url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/26","id":552974467,"node_id":"MDEyOklzc3VlQ29tbWVudDU1Mjk3NDQ2Nw==","user":{"login":"richard-warren","id":31221441,"node_id":"MDQ6VXNlcjMxMjIxNDQx","avatar_url":"https://avatars.githubusercontent.com/u/31221441?v=4","gravatar_id":"","url":"https://api.github.com/users/richard-warren","html_url":"https://github.com/richard-warren","followers_url":"https://api.github.com/users/richard-warren/followers","following_url":"https://api.github.com/users/richard-warren/following{/other_user}","gists_url":"https://api.github.com/users/richard-warren/gists{/gist_id}","starred_url":"https://api.github.com/users/richard-warren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richard-warren/subscriptions","organizations_url":"https://api.github.com/users/richard-warren/orgs","repos_url":"https://api.github.com/users/richard-warren/repos","events_url":"https://api.github.com/users/richard-warren/events{/privacy}","received_events_url":"https://api.github.com/users/richard-warren/received_events","type":"User","site_admin":false},"created_at":"2019-11-12T16:35:29Z","updated_at":"2019-11-12T16:35:29Z","author_association":"NONE","body":"Thanks Jake. So you prefer incorporating the downsampling in the model? If transferring to GPU is major bottleneck, would downsampling (with opencv) in the generator before transferring to GPU increase the speed?\r\n\r\nOne point on MaxPooling2D vs. more clever layers: those tracking mouse whiskers (or anything approaching 1 pixel thickness) might prefer max pooling, as it is more likely to preserve very thin features. Probably not super important, but perhaps worth considering.\r\n\r\nWould the pooling layer automatically result in power-of-2 dimensions? I implemented zero padding in my branch. It would be nice to get rid of this, as it slows things down a bit.\r\n\r\nThanks again! ","reactions":{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/552974467/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"richard-warren","id":31221441,"node_id":"MDQ6VXNlcjMxMjIxNDQx","avatar_url":"https://avatars.githubusercontent.com/u/31221441?v=4","gravatar_id":"","url":"https://api.github.com/users/richard-warren","html_url":"https://github.com/richard-warren","followers_url":"https://api.github.com/users/richard-warren/followers","following_url":"https://api.github.com/users/richard-warren/following{/other_user}","gists_url":"https://api.github.com/users/richard-warren/gists{/gist_id}","starred_url":"https://api.github.com/users/richard-warren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richard-warren/subscriptions","organizations_url":"https://api.github.com/users/richard-warren/orgs","repos_url":"https://api.github.com/users/richard-warren/repos","events_url":"https://api.github.com/users/richard-warren/events{/privacy}","received_events_url":"https://api.github.com/users/richard-warren/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/553199987","html_url":"https://github.com/jgraving/DeepPoseKit/issues/26#issuecomment-553199987","issue_url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/26","id":553199987,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MzE5OTk4Nw==","user":{"login":"DenisPolygalov","id":18456799,"node_id":"MDQ6VXNlcjE4NDU2Nzk5","avatar_url":"https://avatars.githubusercontent.com/u/18456799?v=4","gravatar_id":"","url":"https://api.github.com/users/DenisPolygalov","html_url":"https://github.com/DenisPolygalov","followers_url":"https://api.github.com/users/DenisPolygalov/followers","following_url":"https://api.github.com/users/DenisPolygalov/following{/other_user}","gists_url":"https://api.github.com/users/DenisPolygalov/gists{/gist_id}","starred_url":"https://api.github.com/users/DenisPolygalov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DenisPolygalov/subscriptions","organizations_url":"https://api.github.com/users/DenisPolygalov/orgs","repos_url":"https://api.github.com/users/DenisPolygalov/repos","events_url":"https://api.github.com/users/DenisPolygalov/events{/privacy}","received_events_url":"https://api.github.com/users/DenisPolygalov/received_events","type":"User","site_admin":false},"created_at":"2019-11-13T01:49:19Z","updated_at":"2019-11-13T01:49:19Z","author_association":"CONTRIBUTOR","body":"(Below is a shameless self-PR)\r\nIf someone want just to reduce resolution of arbitrary length single or multiple video file(s) or stack of puctures and save result into lossless-compressed avi or multi-page tiff file you may consider to try my CaFFlow framework: https://github.com/DenisPolygalov/CaFFlow \r\nIn addition or instead of spatial downsampling one can perform any frame-wise operation available in OpenCV, such as crop, color conversion, flipping, filtering, also PCA removal, etc.","reactions":{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/553199987/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"DenisPolygalov","id":18456799,"node_id":"MDQ6VXNlcjE4NDU2Nzk5","avatar_url":"https://avatars.githubusercontent.com/u/18456799?v=4","gravatar_id":"","url":"https://api.github.com/users/DenisPolygalov","html_url":"https://github.com/DenisPolygalov","followers_url":"https://api.github.com/users/DenisPolygalov/followers","following_url":"https://api.github.com/users/DenisPolygalov/following{/other_user}","gists_url":"https://api.github.com/users/DenisPolygalov/gists{/gist_id}","starred_url":"https://api.github.com/users/DenisPolygalov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DenisPolygalov/subscriptions","organizations_url":"https://api.github.com/users/DenisPolygalov/orgs","repos_url":"https://api.github.com/users/DenisPolygalov/repos","events_url":"https://api.github.com/users/DenisPolygalov/events{/privacy}","received_events_url":"https://api.github.com/users/DenisPolygalov/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/553290787","html_url":"https://github.com/jgraving/DeepPoseKit/issues/26#issuecomment-553290787","issue_url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/26","id":553290787,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MzI5MDc4Nw==","user":{"login":"jgraving","id":5445636,"node_id":"MDQ6VXNlcjU0NDU2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5445636?v=4","gravatar_id":"","url":"https://api.github.com/users/jgraving","html_url":"https://github.com/jgraving","followers_url":"https://api.github.com/users/jgraving/followers","following_url":"https://api.github.com/users/jgraving/following{/other_user}","gists_url":"https://api.github.com/users/jgraving/gists{/gist_id}","starred_url":"https://api.github.com/users/jgraving/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgraving/subscriptions","organizations_url":"https://api.github.com/users/jgraving/orgs","repos_url":"https://api.github.com/users/jgraving/repos","events_url":"https://api.github.com/users/jgraving/events{/privacy}","received_events_url":"https://api.github.com/users/jgraving/received_events","type":"User","site_admin":false},"created_at":"2019-11-13T08:19:48Z","updated_at":"2019-11-13T10:10:28Z","author_association":"OWNER","body":"I ran some tests and it looks like this is probably not worth implementing. The opencv resize function appears to be significantly faster on all counts. There's just a ton of overhead to move the images into GPU memory. Zero padding is cheap, so it's probably best to implement padding as the solution for odd sized images. \r\n\r\n```python\r\nimport cv2\r\ncv2.setNumThreads(1) # test without parallelism\r\nimport tensorflow as tf\r\nimport numpy as np\r\ntfl = tf.keras.layers\r\n```\r\n\r\n\r\n```python\r\nORIGINAL = (1024, 1024)\r\nRESIZED = (512, 512)\r\n```\r\n\r\n\r\n```python\r\nclass CVResize:\r\n    def __init__(self):\r\n        inputs = tfl.Input((None, None, 3), dtype=tf.uint8)\r\n        outputs = inputs[:, :32, :3, 0] # simulate keypoint outputs\r\n        self.tf_model = tf.keras.Model(inputs, outputs)\r\n    def __call__(self, images, size=RESIZED, batch_size=1):\r\n        images = np.stack([cv2.resize(image, size, interpolation=cv2.INTER_NEAREST) for image in images])\r\n        return self.tf_model.predict(images, batch_size=batch_size)\r\n```\r\n\r\n\r\n```python\r\ncv_resize = CVResize()\r\n```\r\n\r\n\r\n```python\r\ninputs = tfl.Input((None, None, 3), dtype=tf.uint8)\r\nresized = tf.image.resize(inputs, RESIZED, method='nearest')\r\noutputs = resized[:, :32, :3, 0] # simulate keypoint outputs\r\n\r\ntf_resize = tf.keras.Model(inputs, outputs)\r\n```\r\n\r\n\r\n```python\r\ninputs = tfl.Input((None, None, 3), dtype=tf.uint8)\r\nresized = tfl.MaxPooling2D(ORIGINAL[0] // RESIZED[0])(inputs)\r\noutputs = resized[:, :32, :3, 0] # simulate keypoint outputs\r\n\r\ntf_maxpool = tf.keras.Model(inputs, outputs)\r\n```\r\n\r\n\r\n```python\r\nimages = np.random.randint(0, 255, (256, ORIGINAL[0], ORIGINAL[1], 3), dtype=np.uint8)\r\n```\r\n\r\n\r\n```python\r\n%timeit cv_resize(images, batch_size=1)\r\n```\r\n\r\n    437 ms ± 15.6 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)\r\n\r\n\r\n\r\n```python\r\n%timeit cv_resize(images, batch_size=128)\r\n```\r\n\r\n    455 ms ± 709 µs per loop (mean ± std. dev. of 7 runs, 1 loop each)\r\n\r\n\r\n\r\n```python\r\n%timeit tf_resize.predict(images, batch_size=1)\r\n```\r\n\r\n    1.36 s ± 27.6 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)\r\n\r\n\r\n\r\n```python\r\n%timeit tf_resize.predict(images, batch_size=128)\r\n```\r\n\r\n    1.27 s ± 13.9 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)\r\n\r\n\r\n\r\n```python\r\n%timeit tf_maxpool.predict(images, batch_size=1)\r\n```\r\n\r\n    5.46 s ± 164 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)\r\n\r\n\r\n\r\n```python\r\n%timeit tf_maxpool.predict(images, batch_size=128)\r\n```\r\n\r\n    1.27 s ± 7.7 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)\r\n\r\n\r\n\r\n```python\r\n\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/553290787/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jgraving","id":5445636,"node_id":"MDQ6VXNlcjU0NDU2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5445636?v=4","gravatar_id":"","url":"https://api.github.com/users/jgraving","html_url":"https://github.com/jgraving","followers_url":"https://api.github.com/users/jgraving/followers","following_url":"https://api.github.com/users/jgraving/following{/other_user}","gists_url":"https://api.github.com/users/jgraving/gists{/gist_id}","starred_url":"https://api.github.com/users/jgraving/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgraving/subscriptions","organizations_url":"https://api.github.com/users/jgraving/orgs","repos_url":"https://api.github.com/users/jgraving/repos","events_url":"https://api.github.com/users/jgraving/events{/privacy}","received_events_url":"https://api.github.com/users/jgraving/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/553475181","html_url":"https://github.com/jgraving/DeepPoseKit/issues/26#issuecomment-553475181","issue_url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/26","id":553475181,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MzQ3NTE4MQ==","user":{"login":"richard-warren","id":31221441,"node_id":"MDQ6VXNlcjMxMjIxNDQx","avatar_url":"https://avatars.githubusercontent.com/u/31221441?v=4","gravatar_id":"","url":"https://api.github.com/users/richard-warren","html_url":"https://github.com/richard-warren","followers_url":"https://api.github.com/users/richard-warren/followers","following_url":"https://api.github.com/users/richard-warren/following{/other_user}","gists_url":"https://api.github.com/users/richard-warren/gists{/gist_id}","starred_url":"https://api.github.com/users/richard-warren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richard-warren/subscriptions","organizations_url":"https://api.github.com/users/richard-warren/orgs","repos_url":"https://api.github.com/users/richard-warren/repos","events_url":"https://api.github.com/users/richard-warren/events{/privacy}","received_events_url":"https://api.github.com/users/richard-warren/received_events","type":"User","site_admin":false},"created_at":"2019-11-13T16:16:59Z","updated_at":"2019-11-13T16:16:59Z","author_association":"NONE","body":"This is great. Thanks for running these tests. Do you have any plans on implementing an opencv resizing option, e.g. in the DataGenerator, along with automatic rescaling of the network outputs? If not I'll hack something together on my end.\r\n\r\nRelatedly, I'm finding that deepposekit underperforms deeplabcut when there are long range spatial contingencies. See the image here, where the left and right paw in the top view get swapped. The bottom view is useful here for resolving ambiguities in the top view; I think the deeper networks may have an easier time with these long range contingencies due to greater receptive field size at the outputs. I'm thinking spatial downsampling of the inputs may actually increase accuracy for deepposekit by effectively increasing receptive field size... Lmk if there are any other parameters I can play with that may help deepposekit perform better under conditions like these. Thanks again!\r\n\r\n![image](https://user-images.githubusercontent.com/31221441/68781969-948c1400-0606-11ea-9552-11ed0550af71.png)\r\n\r\n","reactions":{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/553475181/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"richard-warren","id":31221441,"node_id":"MDQ6VXNlcjMxMjIxNDQx","avatar_url":"https://avatars.githubusercontent.com/u/31221441?v=4","gravatar_id":"","url":"https://api.github.com/users/richard-warren","html_url":"https://github.com/richard-warren","followers_url":"https://api.github.com/users/richard-warren/followers","following_url":"https://api.github.com/users/richard-warren/following{/other_user}","gists_url":"https://api.github.com/users/richard-warren/gists{/gist_id}","starred_url":"https://api.github.com/users/richard-warren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richard-warren/subscriptions","organizations_url":"https://api.github.com/users/richard-warren/orgs","repos_url":"https://api.github.com/users/richard-warren/repos","events_url":"https://api.github.com/users/richard-warren/events{/privacy}","received_events_url":"https://api.github.com/users/richard-warren/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/553487409","html_url":"https://github.com/jgraving/DeepPoseKit/issues/26#issuecomment-553487409","issue_url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/26","id":553487409,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MzQ4NzQwOQ==","user":{"login":"jgraving","id":5445636,"node_id":"MDQ6VXNlcjU0NDU2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5445636?v=4","gravatar_id":"","url":"https://api.github.com/users/jgraving","html_url":"https://github.com/jgraving","followers_url":"https://api.github.com/users/jgraving/followers","following_url":"https://api.github.com/users/jgraving/following{/other_user}","gists_url":"https://api.github.com/users/jgraving/gists{/gist_id}","starred_url":"https://api.github.com/users/jgraving/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgraving/subscriptions","organizations_url":"https://api.github.com/users/jgraving/orgs","repos_url":"https://api.github.com/users/jgraving/repos","events_url":"https://api.github.com/users/jgraving/events{/privacy}","received_events_url":"https://api.github.com/users/jgraving/received_events","type":"User","site_admin":false},"created_at":"2019-11-13T16:44:37Z","updated_at":"2019-11-13T16:44:37Z","author_association":"OWNER","body":"Shouldn't be too difficult to add, but it's not high priority at the moment. I'll need to think about how best to accomplish this. If you want to submit a PR I'm happy to work on it with you. \r\n\r\nDo you mean performance between networks within DPK or between the two software packages? Swapping issues might be due to erroneous or overly-aggressive augmentation, especially if the `FlipAxis` augmenter is being used. If you could open another issue and provide more details such as the augmentation pipeline you're using and the network hyperparameters (i.e. `model.get_config()`) I can help troubleshoot.","reactions":{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/553487409/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jgraving","id":5445636,"node_id":"MDQ6VXNlcjU0NDU2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5445636?v=4","gravatar_id":"","url":"https://api.github.com/users/jgraving","html_url":"https://github.com/jgraving","followers_url":"https://api.github.com/users/jgraving/followers","following_url":"https://api.github.com/users/jgraving/following{/other_user}","gists_url":"https://api.github.com/users/jgraving/gists{/gist_id}","starred_url":"https://api.github.com/users/jgraving/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgraving/subscriptions","organizations_url":"https://api.github.com/users/jgraving/orgs","repos_url":"https://api.github.com/users/jgraving/repos","events_url":"https://api.github.com/users/jgraving/events{/privacy}","received_events_url":"https://api.github.com/users/jgraving/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/553554925","html_url":"https://github.com/jgraving/DeepPoseKit/issues/26#issuecomment-553554925","issue_url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/26","id":553554925,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MzU1NDkyNQ==","user":{"login":"richard-warren","id":31221441,"node_id":"MDQ6VXNlcjMxMjIxNDQx","avatar_url":"https://avatars.githubusercontent.com/u/31221441?v=4","gravatar_id":"","url":"https://api.github.com/users/richard-warren","html_url":"https://github.com/richard-warren","followers_url":"https://api.github.com/users/richard-warren/followers","following_url":"https://api.github.com/users/richard-warren/following{/other_user}","gists_url":"https://api.github.com/users/richard-warren/gists{/gist_id}","starred_url":"https://api.github.com/users/richard-warren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richard-warren/subscriptions","organizations_url":"https://api.github.com/users/richard-warren/orgs","repos_url":"https://api.github.com/users/richard-warren/repos","events_url":"https://api.github.com/users/richard-warren/events{/privacy}","received_events_url":"https://api.github.com/users/richard-warren/received_events","type":"User","site_admin":false},"created_at":"2019-11-13T19:11:34Z","updated_at":"2019-11-13T19:11:34Z","author_association":"NONE","body":"Thanks! I'll open a new issue and let you know if I end up implementing the resizing.","reactions":{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/553554925/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"richard-warren","id":31221441,"node_id":"MDQ6VXNlcjMxMjIxNDQx","avatar_url":"https://avatars.githubusercontent.com/u/31221441?v=4","gravatar_id":"","url":"https://api.github.com/users/richard-warren","html_url":"https://github.com/richard-warren","followers_url":"https://api.github.com/users/richard-warren/followers","following_url":"https://api.github.com/users/richard-warren/following{/other_user}","gists_url":"https://api.github.com/users/richard-warren/gists{/gist_id}","starred_url":"https://api.github.com/users/richard-warren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richard-warren/subscriptions","organizations_url":"https://api.github.com/users/richard-warren/orgs","repos_url":"https://api.github.com/users/richard-warren/repos","events_url":"https://api.github.com/users/richard-warren/events{/privacy}","received_events_url":"https://api.github.com/users/richard-warren/received_events","type":"User","site_admin":false}},{"id":2796482763,"node_id":"MDExOkNsb3NlZEV2ZW50Mjc5NjQ4Mjc2Mw==","url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/events/2796482763","actor":{"login":"richard-warren","id":31221441,"node_id":"MDQ6VXNlcjMxMjIxNDQx","avatar_url":"https://avatars.githubusercontent.com/u/31221441?v=4","gravatar_id":"","url":"https://api.github.com/users/richard-warren","html_url":"https://github.com/richard-warren","followers_url":"https://api.github.com/users/richard-warren/followers","following_url":"https://api.github.com/users/richard-warren/following{/other_user}","gists_url":"https://api.github.com/users/richard-warren/gists{/gist_id}","starred_url":"https://api.github.com/users/richard-warren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richard-warren/subscriptions","organizations_url":"https://api.github.com/users/richard-warren/orgs","repos_url":"https://api.github.com/users/richard-warren/repos","events_url":"https://api.github.com/users/richard-warren/events{/privacy}","received_events_url":"https://api.github.com/users/richard-warren/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-11-13T19:11:35Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/554459780","html_url":"https://github.com/jgraving/DeepPoseKit/issues/26#issuecomment-554459780","issue_url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/26","id":554459780,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NDQ1OTc4MA==","user":{"login":"richard-warren","id":31221441,"node_id":"MDQ6VXNlcjMxMjIxNDQx","avatar_url":"https://avatars.githubusercontent.com/u/31221441?v=4","gravatar_id":"","url":"https://api.github.com/users/richard-warren","html_url":"https://github.com/richard-warren","followers_url":"https://api.github.com/users/richard-warren/followers","following_url":"https://api.github.com/users/richard-warren/following{/other_user}","gists_url":"https://api.github.com/users/richard-warren/gists{/gist_id}","starred_url":"https://api.github.com/users/richard-warren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richard-warren/subscriptions","organizations_url":"https://api.github.com/users/richard-warren/orgs","repos_url":"https://api.github.com/users/richard-warren/repos","events_url":"https://api.github.com/users/richard-warren/events{/privacy}","received_events_url":"https://api.github.com/users/richard-warren/received_events","type":"User","site_admin":false},"created_at":"2019-11-15T17:46:51Z","updated_at":"2019-11-15T17:49:36Z","author_association":"NONE","body":"I may try to implement a re-scaling option. If you have time (this isn't super high priority for me either), can you let me know if the following strategy seems alright?\r\n\r\n- Modify [DataGenerator](https://github.com/jgraving/DeepPoseKit/blob/bdfcd238e2d6171653d2844588bfe02b3406ee37/deepposekit/io/DataGenerator.py#L27) to accept an optional target dimensions parameter. Apply opencv resizing to [get_images](https://github.com/jgraving/DeepPoseKit/blob/bdfcd238e2d6171653d2844588bfe02b3406ee37/deepposekit/io/DataGenerator.py#L115).\r\n- Add a resizing attribute to the [BaseModel](https://github.com/jgraving/DeepPoseKit/blob/bdfcd238e2d6171653d2844588bfe02b3406ee37/deepposekit/models/engine.py#L28), which can be inherited from the DataGenerator.\r\n- Pass this parameter to [Maxima2D](https://github.com/jgraving/DeepPoseKit/blob/bdfcd238e2d6171653d2844588bfe02b3406ee37/deepposekit/models/layers/convolutional.py#L36) and [SubpixelMaxima2D](https://github.com/jgraving/DeepPoseKit/blob/bdfcd238e2d6171653d2844588bfe02b3406ee37/deepposekit/models/layers/subpixel.py#L23), which then passes it along to [find_maxima](https://github.com/jgraving/DeepPoseKit/blob/b817ddfdc56f81145cf1c955953999b49ccdcbab/deepposekit/models/backend/backend.py#L120) and ultimately to [_find_maxima](https://github.com/jgraving/DeepPoseKit/blob/b817ddfdc56f81145cf1c955953999b49ccdcbab/deepposekit/models/backend/backend.py#L100), where it can be incorporated into the actual predictions...","reactions":{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/554459780/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"richard-warren","id":31221441,"node_id":"MDQ6VXNlcjMxMjIxNDQx","avatar_url":"https://avatars.githubusercontent.com/u/31221441?v=4","gravatar_id":"","url":"https://api.github.com/users/richard-warren","html_url":"https://github.com/richard-warren","followers_url":"https://api.github.com/users/richard-warren/followers","following_url":"https://api.github.com/users/richard-warren/following{/other_user}","gists_url":"https://api.github.com/users/richard-warren/gists{/gist_id}","starred_url":"https://api.github.com/users/richard-warren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richard-warren/subscriptions","organizations_url":"https://api.github.com/users/richard-warren/orgs","repos_url":"https://api.github.com/users/richard-warren/repos","events_url":"https://api.github.com/users/richard-warren/events{/privacy}","received_events_url":"https://api.github.com/users/richard-warren/received_events","type":"User","site_admin":false}},{"id":2803469762,"node_id":"MDEzOlJlb3BlbmVkRXZlbnQyODAzNDY5NzYy","url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/events/2803469762","actor":{"login":"richard-warren","id":31221441,"node_id":"MDQ6VXNlcjMxMjIxNDQx","avatar_url":"https://avatars.githubusercontent.com/u/31221441?v=4","gravatar_id":"","url":"https://api.github.com/users/richard-warren","html_url":"https://github.com/richard-warren","followers_url":"https://api.github.com/users/richard-warren/followers","following_url":"https://api.github.com/users/richard-warren/following{/other_user}","gists_url":"https://api.github.com/users/richard-warren/gists{/gist_id}","starred_url":"https://api.github.com/users/richard-warren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richard-warren/subscriptions","organizations_url":"https://api.github.com/users/richard-warren/orgs","repos_url":"https://api.github.com/users/richard-warren/repos","events_url":"https://api.github.com/users/richard-warren/events{/privacy}","received_events_url":"https://api.github.com/users/richard-warren/received_events","type":"User","site_admin":false},"event":"reopened","commit_id":null,"commit_url":null,"created_at":"2019-11-15T17:47:51Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/554950031","html_url":"https://github.com/jgraving/DeepPoseKit/issues/26#issuecomment-554950031","issue_url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/26","id":554950031,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NDk1MDAzMQ==","user":{"login":"jgraving","id":5445636,"node_id":"MDQ6VXNlcjU0NDU2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5445636?v=4","gravatar_id":"","url":"https://api.github.com/users/jgraving","html_url":"https://github.com/jgraving","followers_url":"https://api.github.com/users/jgraving/followers","following_url":"https://api.github.com/users/jgraving/following{/other_user}","gists_url":"https://api.github.com/users/jgraving/gists{/gist_id}","starred_url":"https://api.github.com/users/jgraving/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgraving/subscriptions","organizations_url":"https://api.github.com/users/jgraving/orgs","repos_url":"https://api.github.com/users/jgraving/repos","events_url":"https://api.github.com/users/jgraving/events{/privacy}","received_events_url":"https://api.github.com/users/jgraving/received_events","type":"User","site_admin":false},"created_at":"2019-11-18T10:17:46Z","updated_at":"2019-11-18T10:17:46Z","author_association":"OWNER","body":"Using opencv to resize images doesn't require any interaction with the `BaseModel` or the maxima layers. I would just modify the [`BaseGenerator`](https://github.com/jgraving/DeepPoseKit/blob/master/deepposekit/io/BaseGenerator.py#L125) with a `resize` kwarg (with `resize=None` as a default value). Then resize the images (and rescale the keypoints to match) within the generator methods (and adjust `compute_image_shape`) if the `resize` kwarg is passed. This allows the resize code to be used for any generator that inherits from `BaseGenerator` as long as kwargs are passed using `super()` as they are for `DataGenerator` and `DLCGenerator` with `**kwargs`. It would also be useful to add the same code within the `VideoReader` so it's easy to downscale video frames to the same size when running inference.","reactions":{"url":"https://api.github.com/repos/jgraving/DeepPoseKit/issues/comments/554950031/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jgraving","id":5445636,"node_id":"MDQ6VXNlcjU0NDU2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5445636?v=4","gravatar_id":"","url":"https://api.github.com/users/jgraving","html_url":"https://github.com/jgraving","followers_url":"https://api.github.com/users/jgraving/followers","following_url":"https://api.github.com/users/jgraving/following{/other_user}","gists_url":"https://api.github.com/users/jgraving/gists{/gist_id}","starred_url":"https://api.github.com/users/jgraving/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgraving/subscriptions","organizations_url":"https://api.github.com/users/jgraving/orgs","repos_url":"https://api.github.com/users/jgraving/repos","events_url":"https://api.github.com/users/jgraving/events{/privacy}","received_events_url":"https://api.github.com/users/jgraving/received_events","type":"User","site_admin":false}}]