{"url":"https://api.github.com/repos/xvjiarui/GCNet/issues/16","repository_url":"https://api.github.com/repos/xvjiarui/GCNet","labels_url":"https://api.github.com/repos/xvjiarui/GCNet/issues/16/labels{/name}","comments_url":"https://api.github.com/repos/xvjiarui/GCNet/issues/16/comments","events_url":"https://api.github.com/repos/xvjiarui/GCNet/issues/16/events","html_url":"https://github.com/xvjiarui/GCNet/issues/16","id":454529969,"node_id":"MDU6SXNzdWU0NTQ1Mjk5Njk=","number":16,"title":"runtime inrease about 15ms?","user":{"login":"boundles","id":3818060,"node_id":"MDQ6VXNlcjM4MTgwNjA=","avatar_url":"https://avatars.githubusercontent.com/u/3818060?v=4","gravatar_id":"","url":"https://api.github.com/users/boundles","html_url":"https://github.com/boundles","followers_url":"https://api.github.com/users/boundles/followers","following_url":"https://api.github.com/users/boundles/following{/other_user}","gists_url":"https://api.github.com/users/boundles/gists{/gist_id}","starred_url":"https://api.github.com/users/boundles/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boundles/subscriptions","organizations_url":"https://api.github.com/users/boundles/orgs","repos_url":"https://api.github.com/users/boundles/repos","events_url":"https://api.github.com/users/boundles/events{/privacy}","received_events_url":"https://api.github.com/users/boundles/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-06-11T07:43:41Z","updated_at":"2019-07-03T04:45:18Z","closed_at":"2019-07-03T04:45:18Z","author_association":"NONE","active_lock_reason":null,"body":"hi, I use gcnet with the setting as 'resnet50-fpn+c3~c5 r16', but runtime increases about 15ms, could you tell me the reason?\r\n\r\nimport torch\r\nfrom torch import nn\r\nimport torch.nn.functional as F\r\n\r\ndef kaiming_init(module,\r\n                 a=0,\r\n                 mode='fan_out',\r\n                 nonlinearity='relu',\r\n                 bias=0,\r\n                 distribution='normal'):\r\n    assert distribution in ['uniform', 'normal']\r\n    if distribution == 'uniform':\r\n        nn.init.kaiming_uniform_(\r\n            module.weight, a=a, mode=mode, nonlinearity=nonlinearity)\r\n    else:\r\n        nn.init.kaiming_normal_(\r\n            module.weight, a=a, mode=mode, nonlinearity=nonlinearity)\r\n    if hasattr(module, 'bias') and module.bias is not None:\r\n        nn.init.constant_(module.bias, bias)\r\n\r\ndef constant_init(module, val, bias=0):\r\n    nn.init.constant_(module.weight, val)\r\n    if hasattr(module, 'bias') and module.bias is not None:\r\n        nn.init.constant_(module.bias, bias)\r\n\r\ndef last_zero_init(m):\r\n    if isinstance(m, nn.Sequential):\r\n        constant_init(m[-1], val=0)\r\n        m[-1].inited = True\r\n    else:\r\n        constant_init(m, val=0)\r\n        m.inited = True\r\n\r\nclass ContextBlock2d(nn.Module):\r\n\r\n    def __init__(self, inplanes, ratio = 1./16.):\r\n        super(ContextBlock2d, self).__init__()\r\n\r\n        self.inplanes = inplanes\r\n        self.planes = int(self.inplanes * ratio)\r\n       \r\n        self.channel_add_conv = nn.Sequential(\r\n            nn.Conv2d(self.inplanes, self.planes, kernel_size=1),\r\n            nn.ReLU(inplace=True),\r\n            nn.Conv2d(self.planes, self.inplanes, kernel_size=1)\r\n        )\r\n        \r\n        self.reset_parameters()\r\n\r\n    def reset_parameters(self):\r\n        last_zero_init(self.channel_add_conv)\r\n\r\n    def spatial_pool(self, x):\r\n        batch, channel, height, width = x.size()\r\n        # [N, C, 1, 1]\r\n        context = F.avg_pool2d(x, (height, width))\r\n\r\n        return context\r\n\r\n    def forward(self, x):\r\n        # [N, C, 1, 1]\r\n        context = self.spatial_pool(x)\r\n\r\n        # [N, C, 1, 1]\r\n        channel_add_term = self.channel_add_conv(context)\r\n        out = x + channel_add_term\r\n\r\n        return out","closed_by":{"login":"xvjiarui","id":18479688,"node_id":"MDQ6VXNlcjE4NDc5Njg4","avatar_url":"https://avatars.githubusercontent.com/u/18479688?v=4","gravatar_id":"","url":"https://api.github.com/users/xvjiarui","html_url":"https://github.com/xvjiarui","followers_url":"https://api.github.com/users/xvjiarui/followers","following_url":"https://api.github.com/users/xvjiarui/following{/other_user}","gists_url":"https://api.github.com/users/xvjiarui/gists{/gist_id}","starred_url":"https://api.github.com/users/xvjiarui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xvjiarui/subscriptions","organizations_url":"https://api.github.com/users/xvjiarui/orgs","repos_url":"https://api.github.com/users/xvjiarui/repos","events_url":"https://api.github.com/users/xvjiarui/events{/privacy}","received_events_url":"https://api.github.com/users/xvjiarui/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/xvjiarui/GCNet/issues/16/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/xvjiarui/GCNet/issues/16/timeline","performed_via_github_app":null,"state_reason":"completed"}