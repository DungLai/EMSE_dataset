[{"url":"https://api.github.com/repos/richzhang/PerceptualSimilarity/issues/comments/974769993","html_url":"https://github.com/richzhang/PerceptualSimilarity/issues/87#issuecomment-974769993","issue_url":"https://api.github.com/repos/richzhang/PerceptualSimilarity/issues/87","id":974769993,"node_id":"IC_kwDOBvnN_M46Gc9J","user":{"login":"gulzainali98","id":34415593,"node_id":"MDQ6VXNlcjM0NDE1NTkz","avatar_url":"https://avatars.githubusercontent.com/u/34415593?v=4","gravatar_id":"","url":"https://api.github.com/users/gulzainali98","html_url":"https://github.com/gulzainali98","followers_url":"https://api.github.com/users/gulzainali98/followers","following_url":"https://api.github.com/users/gulzainali98/following{/other_user}","gists_url":"https://api.github.com/users/gulzainali98/gists{/gist_id}","starred_url":"https://api.github.com/users/gulzainali98/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gulzainali98/subscriptions","organizations_url":"https://api.github.com/users/gulzainali98/orgs","repos_url":"https://api.github.com/users/gulzainali98/repos","events_url":"https://api.github.com/users/gulzainali98/events{/privacy}","received_events_url":"https://api.github.com/users/gulzainali98/received_events","type":"User","site_admin":false},"created_at":"2021-11-21T07:43:25Z","updated_at":"2021-11-21T07:43:25Z","author_association":"NONE","body":"When i use GTX2080 with pytorch 1.5 I get following error:\r\n\r\nTraceback (most recent call last):                                                                                    `    File \"eval.py\", line 69, in <module>                                                                                      p= lpips.im2tensor(lpips.load_image(predictions[i]))                                                                  File \"/opt/conda/lib/python3.6/site-packages/lpips/__init__.py\", line 113, in im2tensor                                   [:, :, :, np.newaxis].transpose((3, 2, 0, 1)))                                                                      RuntimeError: unsupported operation: more than one element of the written-to tensor refers to a single memory location. Please clone() the tensor before performing the operation.`","reactions":{"url":"https://api.github.com/repos/richzhang/PerceptualSimilarity/issues/comments/974769993/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"gulzainali98","id":34415593,"node_id":"MDQ6VXNlcjM0NDE1NTkz","avatar_url":"https://avatars.githubusercontent.com/u/34415593?v=4","gravatar_id":"","url":"https://api.github.com/users/gulzainali98","html_url":"https://github.com/gulzainali98","followers_url":"https://api.github.com/users/gulzainali98/followers","following_url":"https://api.github.com/users/gulzainali98/following{/other_user}","gists_url":"https://api.github.com/users/gulzainali98/gists{/gist_id}","starred_url":"https://api.github.com/users/gulzainali98/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gulzainali98/subscriptions","organizations_url":"https://api.github.com/users/gulzainali98/orgs","repos_url":"https://api.github.com/users/gulzainali98/repos","events_url":"https://api.github.com/users/gulzainali98/events{/privacy}","received_events_url":"https://api.github.com/users/gulzainali98/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/richzhang/PerceptualSimilarity/issues/comments/1117800902","html_url":"https://github.com/richzhang/PerceptualSimilarity/issues/87#issuecomment-1117800902","issue_url":"https://api.github.com/repos/richzhang/PerceptualSimilarity/issues/87","id":1117800902,"node_id":"IC_kwDOBvnN_M5CoEnG","user":{"login":"huluwaXYZ","id":91967392,"node_id":"U_kgDOBXtPoA","avatar_url":"https://avatars.githubusercontent.com/u/91967392?v=4","gravatar_id":"","url":"https://api.github.com/users/huluwaXYZ","html_url":"https://github.com/huluwaXYZ","followers_url":"https://api.github.com/users/huluwaXYZ/followers","following_url":"https://api.github.com/users/huluwaXYZ/following{/other_user}","gists_url":"https://api.github.com/users/huluwaXYZ/gists{/gist_id}","starred_url":"https://api.github.com/users/huluwaXYZ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/huluwaXYZ/subscriptions","organizations_url":"https://api.github.com/users/huluwaXYZ/orgs","repos_url":"https://api.github.com/users/huluwaXYZ/repos","events_url":"https://api.github.com/users/huluwaXYZ/events{/privacy}","received_events_url":"https://api.github.com/users/huluwaXYZ/received_events","type":"User","site_admin":false},"created_at":"2022-05-04T19:51:34Z","updated_at":"2022-05-04T19:51:34Z","author_association":"NONE","body":"> I am trying to calculate lpips metric on directory of images. i use following code to load and calculate\r\n> \r\n> ```\r\n> for i in range(len(ground_truth)):\r\n> \r\n>                 p= lpips.im2tensor(lpips.load_image(predictions[i]))\r\n>                 g= lpips.im2tensor(lpips.load_image(ground_truth[i]))\r\n>                 if use_gpu:\r\n>                     p=p.cuda()\r\n>                     g=g.cuda()\r\n>                 mean_total=mean_total+loss_fn.forward(g,p).mean()\r\n>                 im_counter=im_counter+1\r\n>                 del p\r\n>                 del g\r\n>                 torch.cuda.empty_cache()\r\n> ```\r\n> \r\n> However, I am getting cuda out of memory error even with alexnet backbone and A100 40GB GPU!\r\n\r\nTry to replace with\r\nmean_total=mean_total+loss_fn.forward(g,p).mean().cpu().detach().numpy()\r\nin your code","reactions":{"url":"https://api.github.com/repos/richzhang/PerceptualSimilarity/issues/comments/1117800902/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"huluwaXYZ","id":91967392,"node_id":"U_kgDOBXtPoA","avatar_url":"https://avatars.githubusercontent.com/u/91967392?v=4","gravatar_id":"","url":"https://api.github.com/users/huluwaXYZ","html_url":"https://github.com/huluwaXYZ","followers_url":"https://api.github.com/users/huluwaXYZ/followers","following_url":"https://api.github.com/users/huluwaXYZ/following{/other_user}","gists_url":"https://api.github.com/users/huluwaXYZ/gists{/gist_id}","starred_url":"https://api.github.com/users/huluwaXYZ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/huluwaXYZ/subscriptions","organizations_url":"https://api.github.com/users/huluwaXYZ/orgs","repos_url":"https://api.github.com/users/huluwaXYZ/repos","events_url":"https://api.github.com/users/huluwaXYZ/events{/privacy}","received_events_url":"https://api.github.com/users/huluwaXYZ/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/richzhang/PerceptualSimilarity/issues/comments/1203899449","html_url":"https://github.com/richzhang/PerceptualSimilarity/issues/87#issuecomment-1203899449","issue_url":"https://api.github.com/repos/richzhang/PerceptualSimilarity/issues/87","id":1203899449,"node_id":"IC_kwDOBvnN_M5Hwgw5","user":{"login":"piddnad","id":29009293,"node_id":"MDQ6VXNlcjI5MDA5Mjkz","avatar_url":"https://avatars.githubusercontent.com/u/29009293?v=4","gravatar_id":"","url":"https://api.github.com/users/piddnad","html_url":"https://github.com/piddnad","followers_url":"https://api.github.com/users/piddnad/followers","following_url":"https://api.github.com/users/piddnad/following{/other_user}","gists_url":"https://api.github.com/users/piddnad/gists{/gist_id}","starred_url":"https://api.github.com/users/piddnad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/piddnad/subscriptions","organizations_url":"https://api.github.com/users/piddnad/orgs","repos_url":"https://api.github.com/users/piddnad/repos","events_url":"https://api.github.com/users/piddnad/events{/privacy}","received_events_url":"https://api.github.com/users/piddnad/received_events","type":"User","site_admin":false},"created_at":"2022-08-03T12:42:16Z","updated_at":"2022-08-03T12:42:16Z","author_association":"NONE","body":"Hi, I encountered the same question, could you Explain how to solve it?\r\n\r\nMy codes are like this:\r\n```\r\n    total_lpips, total_lpips_convert = 0, 0\r\n    with torch.no_grad():\r\n        loss_fn_vgg = lpips.LPIPS(net='vgg').cuda()\r\n        for img in tqdm(img_names):\r\n            gt_pth = os.path.join(gt_dir, img)\r\n            gt = np.array(Image.open(gt_pth).convert(\"RGB\")).astype(np.uint8)\r\n            gt = transforms.ToTensor()(gt)\r\n            gt = transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))(gt).cuda()\r\n\r\n            pred_pth = os.path.join(predicted_dir, img)\r\n            pred = np.array(Image.open(pred_pth).convert(\"RGB\"))\r\n            pred = transforms.ToTensor()(pred)\r\n            pred = transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))(pred).cuda()\r\n\r\n            lpips_vgg = loss_fn_vgg(gt, pred).detach().cpu().numpy()\r\n            total_lpips += lpips_vgg\r\n\r\n            img_counts += 1\r\n            del gt, pred, lpips_vgg\r\n            torch.cuda.empty_cache()\r\n```","reactions":{"url":"https://api.github.com/repos/richzhang/PerceptualSimilarity/issues/comments/1203899449/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"piddnad","id":29009293,"node_id":"MDQ6VXNlcjI5MDA5Mjkz","avatar_url":"https://avatars.githubusercontent.com/u/29009293?v=4","gravatar_id":"","url":"https://api.github.com/users/piddnad","html_url":"https://github.com/piddnad","followers_url":"https://api.github.com/users/piddnad/followers","following_url":"https://api.github.com/users/piddnad/following{/other_user}","gists_url":"https://api.github.com/users/piddnad/gists{/gist_id}","starred_url":"https://api.github.com/users/piddnad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/piddnad/subscriptions","organizations_url":"https://api.github.com/users/piddnad/orgs","repos_url":"https://api.github.com/users/piddnad/repos","events_url":"https://api.github.com/users/piddnad/events{/privacy}","received_events_url":"https://api.github.com/users/piddnad/received_events","type":"User","site_admin":false}}]