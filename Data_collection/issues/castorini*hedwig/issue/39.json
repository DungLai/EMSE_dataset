{"url":"https://api.github.com/repos/castorini/hedwig/issues/39","repository_url":"https://api.github.com/repos/castorini/hedwig","labels_url":"https://api.github.com/repos/castorini/hedwig/issues/39/labels{/name}","comments_url":"https://api.github.com/repos/castorini/hedwig/issues/39/comments","events_url":"https://api.github.com/repos/castorini/hedwig/issues/39/events","html_url":"https://github.com/castorini/hedwig/issues/39","id":494646059,"node_id":"MDU6SXNzdWU0OTQ2NDYwNTk=","number":39,"title":"Memory error with Reuters and  models.reg_lstm","user":{"login":"PiercarloSlavazza","id":3389306,"node_id":"MDQ6VXNlcjMzODkzMDY=","avatar_url":"https://avatars.githubusercontent.com/u/3389306?v=4","gravatar_id":"","url":"https://api.github.com/users/PiercarloSlavazza","html_url":"https://github.com/PiercarloSlavazza","followers_url":"https://api.github.com/users/PiercarloSlavazza/followers","following_url":"https://api.github.com/users/PiercarloSlavazza/following{/other_user}","gists_url":"https://api.github.com/users/PiercarloSlavazza/gists{/gist_id}","starred_url":"https://api.github.com/users/PiercarloSlavazza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PiercarloSlavazza/subscriptions","organizations_url":"https://api.github.com/users/PiercarloSlavazza/orgs","repos_url":"https://api.github.com/users/PiercarloSlavazza/repos","events_url":"https://api.github.com/users/PiercarloSlavazza/events{/privacy}","received_events_url":"https://api.github.com/users/PiercarloSlavazza/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-09-17T14:05:43Z","updated_at":"2020-01-15T06:14:06Z","closed_at":"2019-09-17T17:46:55Z","author_association":"NONE","active_lock_reason":null,"body":"# Env\r\n\r\n* Ubuntu 18.04.3 (Digital Ocean)\r\n* 32 GB RAM\r\n* no GPU\r\n* Everything installed as per the Readme\r\n\r\n# Memory Error\r\n\r\nCommand executed:\r\n\r\n```bash\r\npython -m models.reg_lstm --dataset Reuters --mode static --batch-size 32 --lr 0.01 --epochs 30 --bidirectional --num-layers 1 --hidden-dim 512 --wdrop 0.1 --embed-droprate 0.2 --dropout 0.5 --beta-ema 0.99 --seed 3435\r\n```\r\n\r\nIt reaches 100% in the progress bar, and then gives \"Memory error\" as follows:\r\n\r\n```\r\n(castor) root@hedwig:~/hedwig# python -m models.reg_lstm --dataset Reuters --mode rand --batch-size 32 --lr 0.01 --epochs 10 --bidirectional --num-layers 1 --hidden-dim 512 --wdrop 0.1 --embed-droprate 0.2 --dropout 0.5 --beta-ema 0.99 --seed 3435\r\n  0%|                                                                                                 | 0/3000001 [00:00<?, ?it/s]Skipping token 3000000 with 1-dimensional vector ['300']; likely a header\r\n100%|█████████████████████████████████████████████████████████████████████████████████| 3000001/3000001 [05:06<00:00, 9782.60it/s]\r\nTraceback (most recent call last):\r\n  File \"/root/anaconda3/envs/castor/lib/python3.6/runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"/root/anaconda3/envs/castor/lib/python3.6/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/root/hedwig/models/reg_lstm/__main__.py\", line 95, in <module>\r\n    unk_init=UnknownWordVecCache.unk)\r\n  File \"/root/hedwig/datasets/reuters.py\", line 92, in iters\r\n    vectors = Vectors(name=vectors_name, cache=vectors_cache, unk_init=unk_init)\r\n  File \"/root/anaconda3/envs/castor/lib/python3.6/site-packages/torchtext/vocab.py\", line 236, in __init__\r\n    self.cache(name, cache, url=url)\r\n  File \"/root/anaconda3/envs/castor/lib/python3.6/site-packages/torchtext/vocab.py\", line 327, in cache\r\n    self.vectors = torch.Tensor(vectors).view(-1, dim)\r\nMemoryError\r\n```\r\n\r\nAre 32GB RAM really not enough for this task? If so, do you have an idea of the minimum RAM requirements?\r\n\r\nNote: before getting the memory error, I was getting _another_ error, explained and solved (?) as follows:\r\n\r\n*TypeError: __init__() got an unexpected keyword argument 'dtype'*\r\n\r\nError log:\r\n\r\n```\r\n(castor) root@hedwig:~/hedwig# python -m models.reg_lstm --dataset Reuters --mode rand --batch-size 32 --lr 0.01 --epochs 10 --bidirectional --num-layers 1 --hidden-dim 512 --wdrop 0.1 --embed-droprate 0.2 --dropout 0.5 --beta-ema 0.99 --seed 3435\r\nTraceback (most recent call last):\r\n  File \"/root/anaconda3/envs/castor/lib/python3.6/runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"/root/anaconda3/envs/castor/lib/python3.6/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/root/hedwig/models/reg_lstm/__main__.py\", line 11, in <module>\r\n    from datasets.aapd import AAPD\r\n  File \"/root/hedwig/datasets/aapd.py\", line 9, in <module>\r\n    from datasets.reuters import clean_string, split_sents\r\n  File \"/root/hedwig/datasets/reuters.py\", line 126, in <module>\r\n    class ReutersTFIDF(Reuters):\r\n  File \"/root/hedwig/datasets/reuters.py\", line 128, in ReutersTFIDF\r\n    TEXT_FIELD = Field(sequential=False, use_vocab=False, batch_first=True, preprocessing=load_json, dtype=torch.float)\r\nTypeError: __init__() got an unexpected keyword argument 'dtype'\r\n```\r\n\r\nI have just removed the `dtype` parameter - no idea whether this might be the cause of the above memory error - or is anyway harming the training.","closed_by":{"login":"PiercarloSlavazza","id":3389306,"node_id":"MDQ6VXNlcjMzODkzMDY=","avatar_url":"https://avatars.githubusercontent.com/u/3389306?v=4","gravatar_id":"","url":"https://api.github.com/users/PiercarloSlavazza","html_url":"https://github.com/PiercarloSlavazza","followers_url":"https://api.github.com/users/PiercarloSlavazza/followers","following_url":"https://api.github.com/users/PiercarloSlavazza/following{/other_user}","gists_url":"https://api.github.com/users/PiercarloSlavazza/gists{/gist_id}","starred_url":"https://api.github.com/users/PiercarloSlavazza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PiercarloSlavazza/subscriptions","organizations_url":"https://api.github.com/users/PiercarloSlavazza/orgs","repos_url":"https://api.github.com/users/PiercarloSlavazza/repos","events_url":"https://api.github.com/users/PiercarloSlavazza/events{/privacy}","received_events_url":"https://api.github.com/users/PiercarloSlavazza/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/castorini/hedwig/issues/39/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/castorini/hedwig/issues/39/timeline","performed_via_github_app":null,"state_reason":"completed"}