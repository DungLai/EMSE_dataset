{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/298","repository_url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark","labels_url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/298/labels{/name}","comments_url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/298/comments","events_url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/298/events","html_url":"https://github.com/clovaai/deep-text-recognition-benchmark/issues/298","id":958779785,"node_id":"MDU6SXNzdWU5NTg3Nzk3ODU=","number":298,"title":"Unable to load the best accuracy model for prediction ","user":{"login":"ashwiniimnair","id":70435682,"node_id":"MDQ6VXNlcjcwNDM1Njgy","avatar_url":"https://avatars.githubusercontent.com/u/70435682?v=4","gravatar_id":"","url":"https://api.github.com/users/ashwiniimnair","html_url":"https://github.com/ashwiniimnair","followers_url":"https://api.github.com/users/ashwiniimnair/followers","following_url":"https://api.github.com/users/ashwiniimnair/following{/other_user}","gists_url":"https://api.github.com/users/ashwiniimnair/gists{/gist_id}","starred_url":"https://api.github.com/users/ashwiniimnair/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ashwiniimnair/subscriptions","organizations_url":"https://api.github.com/users/ashwiniimnair/orgs","repos_url":"https://api.github.com/users/ashwiniimnair/repos","events_url":"https://api.github.com/users/ashwiniimnair/events{/privacy}","received_events_url":"https://api.github.com/users/ashwiniimnair/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2021-08-03T06:36:41Z","updated_at":"2021-08-10T02:43:18Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### Trained the model with custom dataset and when trying to test it with demo.py file, It gives an the below error\r\n#Error\r\n['model input parameters 32 100 20 1 512 256 38 25 TPS ResNet BiLSTM Attn',\r\n 'loading pretrained model from /content/deep-text-recognition-benchmark/best_accuracy.pth',\r\n 'Traceback (most recent call last):',\r\n '  File \"/content/deep-text-recognition-benchmark/demo.py\", line 129, in <module>',\r\n '    demo(opt)',\r\n '  File \"/content/deep-text-recognition-benchmark/demo.py\", line 33, in demo',\r\n '    model.load_state_dict(torch.load(opt.saved_model, map_location=device))',\r\n '  File \"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py\", line 1407, in load_state_dict',\r\n '    self.__class__.__name__, \"\\\\n\\\\t\".join(error_msgs)))',\r\n 'RuntimeError: Error(s) in loading state_dict for DataParallel:',\r\n '\\tMissing key(s) in state_dict: \"module.Transformation.LocalizationNetwork.conv.0.weight\", \"module.Transformation.LocalizationNetwork.conv.1.weight\", \"module.Transformation.LocalizationNetwork.conv.1.bias\", \"module.Transformation.LocalizationNetwork.conv.1.running_mean\", \"module.Transformation.LocalizationNetwork.conv.1.running_var\", \"module.Transformation.LocalizationNetwork.conv.4.weight\", \"module.Transformation.LocalizationNetwork.conv.5.weight\", \"module.Transformation.LocalizationNetwork.conv.5.bias\", \"module.Transformation.LocalizationNetwork.conv.5.running_mean\", \"module.Transformation.LocalizationNetwork.conv.5.running_var\", \"module.Transformation.LocalizationNetwork.conv.8.weight\", \"module.Transformation.LocalizationNetwork.conv.9.weight\", \"module.Transformation.LocalizationNetwork.conv.9.bias\", \"module.Transformation.LocalizationNetwork.conv.9.running_mean\", \"module.Transformation.LocalizationNetwork.conv.9.running_var\", \"module.Transformation.LocalizationNetwork.conv.12.weight\", \"module.Transformation.LocalizationNetwork.conv.13.weight\", \"module.Transformation.LocalizationNetwork.conv.13.bias\", \"module.Transformation.LocalizationNetwork.conv.13.running_mean\", \"module.Transformation.LocalizationNetwork.conv.13.running_var\", \"module.Transformation.LocalizationNetwork.localization_fc1.0.weight\", \"module.Transformation.LocalizationNetwork.localization_fc1.0.bias\", \"module.Transformation.LocalizationNetwork.localization_fc2.weight\", \"module.Transformation.LocalizationNetwork.localization_fc2.bias\", \"module.Transformation.GridGenerator.inv_delta_C\", \"module.Transformation.GridGenerator.P_hat\", \"module.FeatureExtraction.ConvNet.conv0_1.weight\", \"module.FeatureExtraction.ConvNet.bn0_1.weight\", \"module.FeatureExtraction.ConvNet.bn0_1.bias\", \"module.FeatureExtraction.ConvNet.bn0_1.running_mean\", \"module.FeatureExtraction.ConvNet.bn0_1.running_var\", \"module.FeatureExtraction.ConvNet.conv0_2.weight\", \"module.FeatureExtraction.ConvNet.bn0_2.weight\", \"module.FeatureExtraction.ConvNet.bn0_2.bias\", \"module.FeatureExtraction.ConvNet.bn0_2.running_mean\", \"module.FeatureExtraction.ConvNet.bn0_2.running_var\", \"module.FeatureExtraction.ConvNet.layer1.0.conv1.weight\", \"module.FeatureExtraction.ConvNet.layer1.0.bn1.weight\", \"module.FeatureExtraction.ConvNet.layer1.0.bn1.bias\", \"module.FeatureExtraction.ConvNet.layer1.0.bn1.running_mean\", \"module.FeatureExtraction.ConvNet.layer1.0.bn1.running_var\", \"module.FeatureExtraction.ConvNet.layer1.0.conv2.weight\", \"module.FeatureExtraction.ConvNet.layer1.0.bn2.weight\", \"module.FeatureExtraction.ConvNet.layer1.0.bn2.bias\", \"module.FeatureExtraction.ConvNet.layer1.0.bn2.running_mean\", \"module.FeatureExtraction.ConvNet.layer1.0.bn2.running_var\", \"module.FeatureExtraction.ConvNet.layer1.0.downsample.0.weight\", \"module.FeatureExtraction.ConvNet.layer1.0.downsample.1.weight\", \"module.FeatureExtraction.ConvNet.layer1.0.downsample.1.bias\", \"module.FeatureExtraction.ConvNet.layer1.0.downsample.1.running_mean\", \"module.FeatureExtraction.ConvNet.layer1.0.downsample.1.running_var\", \"module.FeatureExtraction.ConvNet.conv1.weight\", \"module.FeatureExtraction.ConvNet.bn1.weight\", \"module.FeatureExtraction.ConvNet.bn1.bias\", \"module.FeatureExtraction.ConvNet.bn1.running_mean\", \"module.FeatureExtraction.ConvNet.bn1.running_var\", \"module.FeatureExtraction.ConvNet.layer2.0.conv1.weight\", \"module.FeatureExtraction.ConvNet.layer2.0.bn1.weight\", \"module.FeatureExtraction.ConvNet.layer2.0.bn1.bias\", \"module.FeatureExtraction.ConvNet.layer2.0.bn1.running_mean\", \"module.FeatureExtraction.ConvNet.layer2.0.bn1.running_var\", \"module.FeatureExtraction.ConvNet.layer2.0.conv2.weight\", \"module.FeatureExtraction.ConvNet.layer2.0.bn2.weight\", \"module.FeatureExtraction.ConvNet.layer2.0.bn2.bias\", \"module.FeatureExtraction.ConvNet.layer2.0.bn2.running_mean\", \"module.FeatureExtraction.ConvNet.layer2.0.bn2.running_var\", \"module.FeatureExtraction.ConvNet.layer2.0.downsample.0.weight\", \"module.FeatureExtraction.ConvNet.layer2.0.downsample.1.weight\", \"module.FeatureExtraction.ConvNet.layer2.0.downsample.1.bias\", \"module.FeatureExtraction.ConvNet.layer2.0.downsample.1.running_mean\", \"module.FeatureExtraction.ConvNet.layer2.0.downsample.1.running_var\", \"module.FeatureExtraction.ConvNet.layer2.1.conv1.weight\", \"module.FeatureExtraction.ConvNet.layer2.1.bn1.weight\", \"module.FeatureExtraction.ConvNet.layer2.1.bn1.bias\", \"module.FeatureExtraction.ConvNet.layer2.1.bn1.running_mean\", \"module.FeatureExtraction.ConvNet.layer2.1.bn1.running_var\", \"module.FeatureExtraction.ConvNet.layer2.1.conv2.weight\", \"module.FeatureExtraction.ConvNet.layer2.1.bn2.weight\", \"module.FeatureExtraction.ConvNet.layer2.1.bn2.bias\", \"module.FeatureExtraction.ConvNet.layer2.1.bn2.running_mean\", \"module.FeatureExtraction.ConvNet.layer2.1.bn2.running_var\", \"module.FeatureExtraction.ConvNet.conv2.weight\", \"module.FeatureExtraction.ConvNet.bn2.weight\", \"module.FeatureExtraction.ConvNet.bn2.bias\", \"module.FeatureExtraction.ConvNet.bn2.running_mean\", \"module.FeatureExtraction.ConvNet.bn2.running_var\", \"module.FeatureExtraction.ConvNet.layer3.0.conv1.weight\", \"module.FeatureExtraction.ConvNet.layer3.0.bn1.weight\", \"module.FeatureExtraction.ConvNet.layer3.0.bn1.bias\", \"module.FeatureExtraction.ConvNet.layer3.0.bn1.running_mean\", \"module.FeatureExtraction.ConvNet.layer3.0.bn1.running_var\", \"module.FeatureExtraction.ConvNet.layer3.0.conv2.weight\", \"module.FeatureExtraction.ConvNet.layer3.0.bn2.weight\", \"module.FeatureExtraction.ConvNet.layer3.0.bn2.bias\", \"module.FeatureExtraction.ConvNet.layer3.0.bn2.running_mean\", \"module.FeatureExtraction.ConvNet.layer3.0.bn2.running_var\", \"module.FeatureExtraction.ConvNet.layer3.0.downsample.0.weight\", \"module.FeatureExtraction.ConvNet.layer3.0.downsample.1.weight\", \"module.FeatureExtraction.ConvNet.layer3.0.downsample.1.bias\", \"module.FeatureExtraction.ConvNet.layer3.0.downsample.1.running_mean\", \"module.FeatureExtraction.ConvNet.layer3.0.downsample.1.running_var\", \"module.FeatureExtraction.ConvNet.layer3.1.conv1.weight\", \"module.FeatureExtraction.ConvNet.layer3.1.bn1.weight\", \"module.FeatureExtraction.ConvNet.layer3.1.bn1.bias\", \"module.FeatureExtraction.ConvNet.layer3.1.bn1.running_mean\", \"module.FeatureExtraction.ConvNet.layer3.1.bn1.running_var\", \"module.FeatureExtraction.ConvNet.layer3.1.conv2.weight\", \"module.FeatureExtraction.ConvNet.layer3.1.bn2.weight\", \"module.FeatureExtraction.ConvNet.layer3.1.bn2.bias\", \"module.FeatureExtraction.ConvNet.layer3.1.bn2.running_mean\", \"module.FeatureExtraction.ConvNet.layer3.1.bn2.running_var\", \"module.FeatureExtraction.ConvNet.layer3.2.conv1.weight\", \"module.FeatureExtraction.ConvNet.layer3.2.bn1.weight\", \"module.FeatureExtraction.ConvNet.layer3.2.bn1.bias\", \"module.FeatureExtraction.ConvNet.layer3.2.bn1.running_mean\", \"module.FeatureExtraction.ConvNet.layer3.2.bn1.running_var\", \"module.FeatureExtraction.ConvNet.layer3.2.conv2.weight\", \"module.FeatureExtraction.ConvNet.layer3.2.bn2.weight\", \"module.FeatureExtraction.ConvNet.layer3.2.bn2.bias\", \"module.FeatureExtraction.ConvNet.layer3.2.bn2.running_mean\", \"module.FeatureExtraction.ConvNet.layer3.2.bn2.running_var\", \"module.FeatureExtraction.ConvNet.layer3.3.conv1.weight\", \"module.FeatureExtraction.ConvNet.layer3.3.bn1.weight\", \"module.FeatureExtraction.ConvNet.layer3.3.bn1.bias\", \"module.FeatureExtraction.ConvNet.layer3.3.bn1.running_mean\", \"module.FeatureExtraction.ConvNet.layer3.3.bn1.running_var\", \"module.FeatureExtraction.ConvNet.layer3.3.conv2.weight\", \"module.FeatureExtraction.ConvNet.layer3.3.bn2.weight\", \"module.FeatureExtraction.ConvNet.layer3.3.bn2.bias\", \"module.FeatureExtraction.ConvNet.layer3.3.bn2.running_mean\", \"module.FeatureExtraction.ConvNet.layer3.3.bn2.running_var\", \"module.FeatureExtraction.ConvNet.layer3.4.conv1.weight\", \"module.FeatureExtraction.ConvNet.layer3.4.bn1.weight\", \"module.FeatureExtraction.ConvNet.layer3.4.bn1.bias\", \"module.FeatureExtraction.ConvNet.layer3.4.bn1.running_mean\", \"module.FeatureExtraction.ConvNet.layer3.4.bn1.running_var\", \"module.FeatureExtraction.ConvNet.layer3.4.conv2.weight\", \"module.FeatureExtraction.ConvNet.layer3.4.bn2.weight\", \"module.FeatureExtraction.ConvNet.layer3.4.bn2.bias\", \"module.FeatureExtraction.ConvNet.layer3.4.bn2.running_mean\", \"module.FeatureExtraction.ConvNet.layer3.4.bn2.running_var\", \"module.FeatureExtraction.ConvNet.conv3.weight\", \"module.FeatureExtraction.ConvNet.bn3.weight\", \"module.FeatureExtraction.ConvNet.bn3.bias\", \"module.FeatureExtraction.ConvNet.bn3.running_mean\", \"module.FeatureExtraction.ConvNet.bn3.running_var\", \"module.FeatureExtraction.ConvNet.layer4.0.conv1.weight\", \"module.FeatureExtraction.ConvNet.layer4.0.bn1.weight\", \"module.FeatureExtraction.ConvNet.layer4.0.bn1.bias\", \"module.FeatureExtraction.ConvNet.layer4.0.bn1.running_mean\", \"module.FeatureExtraction.ConvNet.layer4.0.bn1.running_var\", \"module.FeatureExtraction.ConvNet.layer4.0.conv2.weight\", \"module.FeatureExtraction.ConvNet.layer4.0.bn2.weight\", \"module.FeatureExtraction.ConvNet.layer4.0.bn2.bias\", \"module.FeatureExtraction.ConvNet.layer4.0.bn2.running_mean\", \"module.FeatureExtraction.ConvNet.layer4.0.bn2.running_var\", \"module.FeatureExtraction.ConvNet.layer4.1.conv1.weight\", \"module.FeatureExtraction.ConvNet.layer4.1.bn1.weight\", \"module.FeatureExtraction.ConvNet.layer4.1.bn1.bias\", \"module.FeatureExtraction.ConvNet.layer4.1.bn1.running_mean\", \"module.FeatureExtraction.ConvNet.layer4.1.bn1.running_var\", \"module.FeatureExtraction.ConvNet.layer4.1.conv2.weight\", \"module.FeatureExtraction.ConvNet.layer4.1.bn2.weight\", \"module.FeatureExtraction.ConvNet.layer4.1.bn2.bias\", \"module.FeatureExtraction.ConvNet.layer4.1.bn2.running_mean\", \"module.FeatureExtraction.ConvNet.layer4.1.bn2.running_var\", \"module.FeatureExtraction.ConvNet.layer4.2.conv1.weight\", \"module.FeatureExtraction.ConvNet.layer4.2.bn1.weight\", \"module.FeatureExtraction.ConvNet.layer4.2.bn1.bias\", \"module.FeatureExtraction.ConvNet.layer4.2.bn1.running_mean\", \"module.FeatureExtraction.ConvNet.layer4.2.bn1.running_var\", \"module.FeatureExtraction.ConvNet.layer4.2.conv2.weight\", \"module.FeatureExtraction.ConvNet.layer4.2.bn2.weight\", \"module.FeatureExtraction.ConvNet.layer4.2.bn2.bias\", \"module.FeatureExtraction.ConvNet.layer4.2.bn2.running_mean\", \"module.FeatureExtraction.ConvNet.layer4.2.bn2.running_var\", \"module.FeatureExtraction.ConvNet.conv4_1.weight\", \"module.FeatureExtraction.ConvNet.bn4_1.weight\", \"module.FeatureExtraction.ConvNet.bn4_1.bias\", \"module.FeatureExtraction.ConvNet.bn4_1.running_mean\", \"module.FeatureExtraction.ConvNet.bn4_1.running_var\", \"module.FeatureExtraction.ConvNet.conv4_2.weight\", \"module.FeatureExtraction.ConvNet.bn4_2.weight\", \"module.FeatureExtraction.ConvNet.bn4_2.bias\", \"module.FeatureExtraction.ConvNet.bn4_2.running_mean\", \"module.FeatureExtraction.ConvNet.bn4_2.running_var\", \"module.Prediction.attention_cell.i2h.weight\", \"module.Prediction.attention_cell.h2h.weight\", \"module.Prediction.attention_cell.h2h.bias\", \"module.Prediction.attention_cell.score.weight\", \"module.Prediction.attention_cell.rnn.weight_ih\", \"module.Prediction.attention_cell.rnn.weight_hh\", \"module.Prediction.attention_cell.rnn.bias_ih\", \"module.Prediction.attention_cell.rnn.bias_hh\", \"module.Prediction.generator.weight\", \"module.Prediction.generator.bias\". ',\r\n '\\tUnexpected key(s) in state_dict: \"module.FeatureExtraction.ConvNet.0.weight\", \"module.FeatureExtraction.ConvNet.0.bias\", \"module.FeatureExtraction.ConvNet.3.weight\", \"module.FeatureExtraction.ConvNet.3.bias\", \"module.FeatureExtraction.ConvNet.6.weight\", \"module.FeatureExtraction.ConvNet.6.bias\", \"module.FeatureExtraction.ConvNet.8.weight\", \"module.FeatureExtraction.ConvNet.8.bias\", \"module.FeatureExtraction.ConvNet.11.weight\", \"module.FeatureExtraction.ConvNet.12.weight\", \"module.FeatureExtraction.ConvNet.12.bias\", \"module.FeatureExtraction.ConvNet.12.running_mean\", \"module.FeatureExtraction.ConvNet.12.running_var\", \"module.FeatureExtraction.ConvNet.12.num_batches_tracked\", \"module.FeatureExtraction.ConvNet.14.weight\", \"module.FeatureExtraction.ConvNet.15.weight\", \"module.FeatureExtraction.ConvNet.15.bias\", \"module.FeatureExtraction.ConvNet.15.running_mean\", \"module.FeatureExtraction.ConvNet.15.running_var\", \"module.FeatureExtraction.ConvNet.15.num_batches_tracked\", \"module.FeatureExtraction.ConvNet.18.weight\", \"module.FeatureExtraction.ConvNet.18.bias\", \"module.Prediction.weight\", \"module.Prediction.bias\". ']\r\n\r\nI am able to solve the loading problem by changing the demo.py file with below code\r\n\r\n\r\n     print('loading pretrained model from %s' % opt.saved_model)       \r\n     checkpoint = torch.load(opt.saved_model, map_location=device) # Load the model file, pt, pth file can be;\r\n    \r\n     if torch.cuda.device_count() > 1:\r\n        model = nn.DataParallel(model) \r\n        model.load_state_dict(checkpoint)\r\n\r\nHowever the predictions are going wrong/throwing garbage value after that.\r\nPlease help","closed_by":null,"reactions":{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/298/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/298/timeline","performed_via_github_app":null,"state_reason":null}