[{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/886467185","html_url":"https://github.com/clovaai/deep-text-recognition-benchmark/issues/284#issuecomment-886467185","issue_url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/284","id":886467185,"node_id":"IC_kwDOCq7kDM401mpx","user":{"login":"morkovka1337","id":32310433,"node_id":"MDQ6VXNlcjMyMzEwNDMz","avatar_url":"https://avatars.githubusercontent.com/u/32310433?v=4","gravatar_id":"","url":"https://api.github.com/users/morkovka1337","html_url":"https://github.com/morkovka1337","followers_url":"https://api.github.com/users/morkovka1337/followers","following_url":"https://api.github.com/users/morkovka1337/following{/other_user}","gists_url":"https://api.github.com/users/morkovka1337/gists{/gist_id}","starred_url":"https://api.github.com/users/morkovka1337/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morkovka1337/subscriptions","organizations_url":"https://api.github.com/users/morkovka1337/orgs","repos_url":"https://api.github.com/users/morkovka1337/repos","events_url":"https://api.github.com/users/morkovka1337/events{/privacy}","received_events_url":"https://api.github.com/users/morkovka1337/received_events","type":"User","site_admin":false},"created_at":"2021-07-26T07:57:17Z","updated_at":"2021-07-26T07:57:17Z","author_association":"NONE","body":"Hi,\r\n\r\nThis operation is literally not supported in the pytorch onnx export [for a long time](https://github.com/pytorch/pytorch/issues/27212). But you can mimic this operation by set of other operations, like [here](https://github.com/open-mmlab/mmcv/pull/953/files).\r\nHere is an example of how I did:\r\n\r\n```\r\n            if not torch.onnx.is_in_onnx_export():\r\n                batch_I_r = F.grid_sample(batch_I, build_P_prime_reshape, padding_mode='border', align_corners=True)\r\n            else:\r\n                # workwround for export to onnx\r\n                # see here for details: https://github.com/open-mmlab/mmcv/pull/953/\r\n                n, c, h, w = batch_I.shape\r\n                gn, gh, gw, _ = build_P_prime_reshape.shape\r\n                assert n == gn\r\n\r\n                x = build_P_prime_reshape[:, :, :, 0]\r\n                y = build_P_prime_reshape[:, :, :, 1]\r\n\r\n                x = ((x + 1) / 2) * (w - 1)\r\n                y = ((y + 1) / 2) * (h - 1)\r\n\r\n                x = x.view(n, -1)\r\n                y = y.view(n, -1)\r\n\r\n                x0 = torch.floor(x).long()\r\n                y0 = torch.floor(y).long()\r\n                x1 = x0 + 1\r\n                y1 = y0 + 1\r\n\r\n                wa = ((x1 - x) * (y1 - y)).unsqueeze(1)\r\n                wb = ((x1 - x) * (y - y0)).unsqueeze(1)\r\n                wc = ((x - x0) * (y1 - y)).unsqueeze(1)\r\n                wd = ((x - x0) * (y - y0)).unsqueeze(1)\r\n\r\n                # Apply default for grid_sample function zero padding\r\n                im_padded = F.pad(batch_I, pad=[1, 1, 1, 1], mode='replicate')\r\n                padded_h = h + 2\r\n                padded_w = w + 2\r\n                # save points positions after padding\r\n                x0, x1, y0, y1 = x0 + 1, x1 + 1, y0 + 1, y1 + 1\r\n\r\n                # Clip coordinates to padded image size\r\n                x0 = torch.where(x0 < 0, torch.tensor(0), x0)\r\n                x0 = torch.where(x0 > padded_w - 1, torch.tensor(padded_w - 1), x0)\r\n                x1 = torch.where(x1 < 0, torch.tensor(0), x1)\r\n                x1 = torch.where(x1 > padded_w - 1, torch.tensor(padded_w - 1), x1)\r\n                y0 = torch.where(y0 < 0, torch.tensor(0), y0)\r\n                y0 = torch.where(y0 > padded_h - 1, torch.tensor(padded_h - 1), y0)\r\n                y1 = torch.where(y1 < 0, torch.tensor(0), y1)\r\n                y1 = torch.where(y1 > padded_h - 1, torch.tensor(padded_h - 1), y1)\r\n\r\n                im_padded = im_padded.view(n, c, -1)\r\n\r\n                x0_y0 = (x0 + y0 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n                x0_y1 = (x0 + y1 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n                x1_y0 = (x1 + y0 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n                x1_y1 = (x1 + y1 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n\r\n                Ia = torch.gather(im_padded, 2, x0_y0)\r\n                Ib = torch.gather(im_padded, 2, x0_y1)\r\n                Ic = torch.gather(im_padded, 2, x1_y0)\r\n                Id = torch.gather(im_padded, 2, x1_y1)\r\n\r\n                batch_I_r = (Ia * wa + Ib * wb + Ic * wc + Id * wd).reshape(n, c, gh, gw)\r\n```","reactions":{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/886467185/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"morkovka1337","id":32310433,"node_id":"MDQ6VXNlcjMyMzEwNDMz","avatar_url":"https://avatars.githubusercontent.com/u/32310433?v=4","gravatar_id":"","url":"https://api.github.com/users/morkovka1337","html_url":"https://github.com/morkovka1337","followers_url":"https://api.github.com/users/morkovka1337/followers","following_url":"https://api.github.com/users/morkovka1337/following{/other_user}","gists_url":"https://api.github.com/users/morkovka1337/gists{/gist_id}","starred_url":"https://api.github.com/users/morkovka1337/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morkovka1337/subscriptions","organizations_url":"https://api.github.com/users/morkovka1337/orgs","repos_url":"https://api.github.com/users/morkovka1337/repos","events_url":"https://api.github.com/users/morkovka1337/events{/privacy}","received_events_url":"https://api.github.com/users/morkovka1337/received_events","type":"User","site_admin":false}},{"id":6846013712,"node_id":"MEE_lADOCq7kDM42X9A5zwAAAAGYDeEQ","url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/events/6846013712","actor":{"login":"morkovka1337","id":32310433,"node_id":"MDQ6VXNlcjMyMzEwNDMz","avatar_url":"https://avatars.githubusercontent.com/u/32310433?v=4","gravatar_id":"","url":"https://api.github.com/users/morkovka1337","html_url":"https://github.com/morkovka1337","followers_url":"https://api.github.com/users/morkovka1337/followers","following_url":"https://api.github.com/users/morkovka1337/following{/other_user}","gists_url":"https://api.github.com/users/morkovka1337/gists{/gist_id}","starred_url":"https://api.github.com/users/morkovka1337/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morkovka1337/subscriptions","organizations_url":"https://api.github.com/users/morkovka1337/orgs","repos_url":"https://api.github.com/users/morkovka1337/repos","events_url":"https://api.github.com/users/morkovka1337/events{/privacy}","received_events_url":"https://api.github.com/users/morkovka1337/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-06-21T10:04:56Z","performed_via_github_app":null},{"id":6846013719,"node_id":"SE_lADOCq7kDM42X9A5zwAAAAGYDeEX","url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/events/6846013719","actor":{"login":"morkovka1337","id":32310433,"node_id":"MDQ6VXNlcjMyMzEwNDMz","avatar_url":"https://avatars.githubusercontent.com/u/32310433?v=4","gravatar_id":"","url":"https://api.github.com/users/morkovka1337","html_url":"https://github.com/morkovka1337","followers_url":"https://api.github.com/users/morkovka1337/followers","following_url":"https://api.github.com/users/morkovka1337/following{/other_user}","gists_url":"https://api.github.com/users/morkovka1337/gists{/gist_id}","starred_url":"https://api.github.com/users/morkovka1337/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morkovka1337/subscriptions","organizations_url":"https://api.github.com/users/morkovka1337/orgs","repos_url":"https://api.github.com/users/morkovka1337/repos","events_url":"https://api.github.com/users/morkovka1337/events{/privacy}","received_events_url":"https://api.github.com/users/morkovka1337/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-06-21T10:04:56Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/1161537293","html_url":"https://github.com/clovaai/deep-text-recognition-benchmark/issues/284#issuecomment-1161537293","issue_url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/284","id":1161537293,"node_id":"IC_kwDOCq7kDM5FO6cN","user":{"login":"rafaelagrc","id":78483081,"node_id":"MDQ6VXNlcjc4NDgzMDgx","avatar_url":"https://avatars.githubusercontent.com/u/78483081?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelagrc","html_url":"https://github.com/rafaelagrc","followers_url":"https://api.github.com/users/rafaelagrc/followers","following_url":"https://api.github.com/users/rafaelagrc/following{/other_user}","gists_url":"https://api.github.com/users/rafaelagrc/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelagrc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelagrc/subscriptions","organizations_url":"https://api.github.com/users/rafaelagrc/orgs","repos_url":"https://api.github.com/users/rafaelagrc/repos","events_url":"https://api.github.com/users/rafaelagrc/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelagrc/received_events","type":"User","site_admin":false},"created_at":"2022-06-21T10:05:39Z","updated_at":"2022-06-21T10:05:39Z","author_association":"NONE","body":"> Hi,\r\n> \r\n> This operation is literally not supported in the pytorch onnx export [for a long time](https://github.com/pytorch/pytorch/issues/27212). But you can mimic this operation by set of other operations, like [here](https://github.com/open-mmlab/mmcv/pull/953/files). Here is an example of how I did:\r\n> \r\n> ```\r\n>             if not torch.onnx.is_in_onnx_export():\r\n>                 batch_I_r = F.grid_sample(batch_I, build_P_prime_reshape, padding_mode='border', align_corners=True)\r\n>             else:\r\n>                 # workwround for export to onnx\r\n>                 # see here for details: https://github.com/open-mmlab/mmcv/pull/953/\r\n>                 n, c, h, w = batch_I.shape\r\n>                 gn, gh, gw, _ = build_P_prime_reshape.shape\r\n>                 assert n == gn\r\n> \r\n>                 x = build_P_prime_reshape[:, :, :, 0]\r\n>                 y = build_P_prime_reshape[:, :, :, 1]\r\n> \r\n>                 x = ((x + 1) / 2) * (w - 1)\r\n>                 y = ((y + 1) / 2) * (h - 1)\r\n> \r\n>                 x = x.view(n, -1)\r\n>                 y = y.view(n, -1)\r\n> \r\n>                 x0 = torch.floor(x).long()\r\n>                 y0 = torch.floor(y).long()\r\n>                 x1 = x0 + 1\r\n>                 y1 = y0 + 1\r\n> \r\n>                 wa = ((x1 - x) * (y1 - y)).unsqueeze(1)\r\n>                 wb = ((x1 - x) * (y - y0)).unsqueeze(1)\r\n>                 wc = ((x - x0) * (y1 - y)).unsqueeze(1)\r\n>                 wd = ((x - x0) * (y - y0)).unsqueeze(1)\r\n> \r\n>                 # Apply default for grid_sample function zero padding\r\n>                 im_padded = F.pad(batch_I, pad=[1, 1, 1, 1], mode='replicate')\r\n>                 padded_h = h + 2\r\n>                 padded_w = w + 2\r\n>                 # save points positions after padding\r\n>                 x0, x1, y0, y1 = x0 + 1, x1 + 1, y0 + 1, y1 + 1\r\n> \r\n>                 # Clip coordinates to padded image size\r\n>                 x0 = torch.where(x0 < 0, torch.tensor(0), x0)\r\n>                 x0 = torch.where(x0 > padded_w - 1, torch.tensor(padded_w - 1), x0)\r\n>                 x1 = torch.where(x1 < 0, torch.tensor(0), x1)\r\n>                 x1 = torch.where(x1 > padded_w - 1, torch.tensor(padded_w - 1), x1)\r\n>                 y0 = torch.where(y0 < 0, torch.tensor(0), y0)\r\n>                 y0 = torch.where(y0 > padded_h - 1, torch.tensor(padded_h - 1), y0)\r\n>                 y1 = torch.where(y1 < 0, torch.tensor(0), y1)\r\n>                 y1 = torch.where(y1 > padded_h - 1, torch.tensor(padded_h - 1), y1)\r\n> \r\n>                 im_padded = im_padded.view(n, c, -1)\r\n> \r\n>                 x0_y0 = (x0 + y0 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n>                 x0_y1 = (x0 + y1 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n>                 x1_y0 = (x1 + y0 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n>                 x1_y1 = (x1 + y1 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n> \r\n>                 Ia = torch.gather(im_padded, 2, x0_y0)\r\n>                 Ib = torch.gather(im_padded, 2, x0_y1)\r\n>                 Ic = torch.gather(im_padded, 2, x1_y0)\r\n>                 Id = torch.gather(im_padded, 2, x1_y1)\r\n> \r\n>                 batch_I_r = (Ia * wa + Ib * wb + Ic * wc + Id * wd).reshape(n, c, gh, gw)\r\n> ```\r\n\r\nHello @morkovka1337, where did you insert this?","reactions":{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/1161537293/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rafaelagrc","id":78483081,"node_id":"MDQ6VXNlcjc4NDgzMDgx","avatar_url":"https://avatars.githubusercontent.com/u/78483081?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelagrc","html_url":"https://github.com/rafaelagrc","followers_url":"https://api.github.com/users/rafaelagrc/followers","following_url":"https://api.github.com/users/rafaelagrc/following{/other_user}","gists_url":"https://api.github.com/users/rafaelagrc/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelagrc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelagrc/subscriptions","organizations_url":"https://api.github.com/users/rafaelagrc/orgs","repos_url":"https://api.github.com/users/rafaelagrc/repos","events_url":"https://api.github.com/users/rafaelagrc/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelagrc/received_events","type":"User","site_admin":false}},{"id":6846019356,"node_id":"MEE_lADOCq7kDM42X9A5zwAAAAGYDfcc","url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/events/6846019356","actor":{"login":"morkovka1337","id":32310433,"node_id":"MDQ6VXNlcjMyMzEwNDMz","avatar_url":"https://avatars.githubusercontent.com/u/32310433?v=4","gravatar_id":"","url":"https://api.github.com/users/morkovka1337","html_url":"https://github.com/morkovka1337","followers_url":"https://api.github.com/users/morkovka1337/followers","following_url":"https://api.github.com/users/morkovka1337/following{/other_user}","gists_url":"https://api.github.com/users/morkovka1337/gists{/gist_id}","starred_url":"https://api.github.com/users/morkovka1337/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morkovka1337/subscriptions","organizations_url":"https://api.github.com/users/morkovka1337/orgs","repos_url":"https://api.github.com/users/morkovka1337/repos","events_url":"https://api.github.com/users/morkovka1337/events{/privacy}","received_events_url":"https://api.github.com/users/morkovka1337/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-06-21T10:05:40Z","performed_via_github_app":null},{"id":6846019364,"node_id":"SE_lADOCq7kDM42X9A5zwAAAAGYDfck","url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/events/6846019364","actor":{"login":"morkovka1337","id":32310433,"node_id":"MDQ6VXNlcjMyMzEwNDMz","avatar_url":"https://avatars.githubusercontent.com/u/32310433?v=4","gravatar_id":"","url":"https://api.github.com/users/morkovka1337","html_url":"https://github.com/morkovka1337","followers_url":"https://api.github.com/users/morkovka1337/followers","following_url":"https://api.github.com/users/morkovka1337/following{/other_user}","gists_url":"https://api.github.com/users/morkovka1337/gists{/gist_id}","starred_url":"https://api.github.com/users/morkovka1337/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morkovka1337/subscriptions","organizations_url":"https://api.github.com/users/morkovka1337/orgs","repos_url":"https://api.github.com/users/morkovka1337/repos","events_url":"https://api.github.com/users/morkovka1337/events{/privacy}","received_events_url":"https://api.github.com/users/morkovka1337/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-06-21T10:05:40Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/1169684134","html_url":"https://github.com/clovaai/deep-text-recognition-benchmark/issues/284#issuecomment-1169684134","issue_url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/284","id":1169684134,"node_id":"IC_kwDOCq7kDM5Ft_am","user":{"login":"morkovka1337","id":32310433,"node_id":"MDQ6VXNlcjMyMzEwNDMz","avatar_url":"https://avatars.githubusercontent.com/u/32310433?v=4","gravatar_id":"","url":"https://api.github.com/users/morkovka1337","html_url":"https://github.com/morkovka1337","followers_url":"https://api.github.com/users/morkovka1337/followers","following_url":"https://api.github.com/users/morkovka1337/following{/other_user}","gists_url":"https://api.github.com/users/morkovka1337/gists{/gist_id}","starred_url":"https://api.github.com/users/morkovka1337/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morkovka1337/subscriptions","organizations_url":"https://api.github.com/users/morkovka1337/orgs","repos_url":"https://api.github.com/users/morkovka1337/repos","events_url":"https://api.github.com/users/morkovka1337/events{/privacy}","received_events_url":"https://api.github.com/users/morkovka1337/received_events","type":"User","site_admin":false},"created_at":"2022-06-29T08:26:33Z","updated_at":"2022-06-29T08:26:33Z","author_association":"NONE","body":"> > Hi,\r\n> > This operation is literally not supported in the pytorch onnx export [for a long time](https://github.com/pytorch/pytorch/issues/27212). But you can mimic this operation by set of other operations, like [here](https://github.com/open-mmlab/mmcv/pull/953/files). Here is an example of how I did:\r\n> > ```\r\n> >             if not torch.onnx.is_in_onnx_export():\r\n> >                 batch_I_r = F.grid_sample(batch_I, build_P_prime_reshape, padding_mode='border', align_corners=True)\r\n> >             else:\r\n> >                 # workwround for export to onnx\r\n> >                 # see here for details: https://github.com/open-mmlab/mmcv/pull/953/\r\n> >                 n, c, h, w = batch_I.shape\r\n> >                 gn, gh, gw, _ = build_P_prime_reshape.shape\r\n> >                 assert n == gn\r\n> > \r\n> >                 x = build_P_prime_reshape[:, :, :, 0]\r\n> >                 y = build_P_prime_reshape[:, :, :, 1]\r\n> > \r\n> >                 x = ((x + 1) / 2) * (w - 1)\r\n> >                 y = ((y + 1) / 2) * (h - 1)\r\n> > \r\n> >                 x = x.view(n, -1)\r\n> >                 y = y.view(n, -1)\r\n> > \r\n> >                 x0 = torch.floor(x).long()\r\n> >                 y0 = torch.floor(y).long()\r\n> >                 x1 = x0 + 1\r\n> >                 y1 = y0 + 1\r\n> > \r\n> >                 wa = ((x1 - x) * (y1 - y)).unsqueeze(1)\r\n> >                 wb = ((x1 - x) * (y - y0)).unsqueeze(1)\r\n> >                 wc = ((x - x0) * (y1 - y)).unsqueeze(1)\r\n> >                 wd = ((x - x0) * (y - y0)).unsqueeze(1)\r\n> > \r\n> >                 # Apply default for grid_sample function zero padding\r\n> >                 im_padded = F.pad(batch_I, pad=[1, 1, 1, 1], mode='replicate')\r\n> >                 padded_h = h + 2\r\n> >                 padded_w = w + 2\r\n> >                 # save points positions after padding\r\n> >                 x0, x1, y0, y1 = x0 + 1, x1 + 1, y0 + 1, y1 + 1\r\n> > \r\n> >                 # Clip coordinates to padded image size\r\n> >                 x0 = torch.where(x0 < 0, torch.tensor(0), x0)\r\n> >                 x0 = torch.where(x0 > padded_w - 1, torch.tensor(padded_w - 1), x0)\r\n> >                 x1 = torch.where(x1 < 0, torch.tensor(0), x1)\r\n> >                 x1 = torch.where(x1 > padded_w - 1, torch.tensor(padded_w - 1), x1)\r\n> >                 y0 = torch.where(y0 < 0, torch.tensor(0), y0)\r\n> >                 y0 = torch.where(y0 > padded_h - 1, torch.tensor(padded_h - 1), y0)\r\n> >                 y1 = torch.where(y1 < 0, torch.tensor(0), y1)\r\n> >                 y1 = torch.where(y1 > padded_h - 1, torch.tensor(padded_h - 1), y1)\r\n> > \r\n> >                 im_padded = im_padded.view(n, c, -1)\r\n> > \r\n> >                 x0_y0 = (x0 + y0 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n> >                 x0_y1 = (x0 + y1 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n> >                 x1_y0 = (x1 + y0 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n> >                 x1_y1 = (x1 + y1 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n> > \r\n> >                 Ia = torch.gather(im_padded, 2, x0_y0)\r\n> >                 Ib = torch.gather(im_padded, 2, x0_y1)\r\n> >                 Ic = torch.gather(im_padded, 2, x1_y0)\r\n> >                 Id = torch.gather(im_padded, 2, x1_y1)\r\n> > \r\n> >                 batch_I_r = (Ia * wa + Ib * wb + Ic * wc + Id * wd).reshape(n, c, gh, gw)\r\n> > ```\r\n> \r\n> Hello @morkovka1337, where did you insert this?\r\n\r\nHi, as far as I remember, it was in the forward function of the model","reactions":{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/1169684134/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"morkovka1337","id":32310433,"node_id":"MDQ6VXNlcjMyMzEwNDMz","avatar_url":"https://avatars.githubusercontent.com/u/32310433?v=4","gravatar_id":"","url":"https://api.github.com/users/morkovka1337","html_url":"https://github.com/morkovka1337","followers_url":"https://api.github.com/users/morkovka1337/followers","following_url":"https://api.github.com/users/morkovka1337/following{/other_user}","gists_url":"https://api.github.com/users/morkovka1337/gists{/gist_id}","starred_url":"https://api.github.com/users/morkovka1337/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morkovka1337/subscriptions","organizations_url":"https://api.github.com/users/morkovka1337/orgs","repos_url":"https://api.github.com/users/morkovka1337/repos","events_url":"https://api.github.com/users/morkovka1337/events{/privacy}","received_events_url":"https://api.github.com/users/morkovka1337/received_events","type":"User","site_admin":false}},{"id":6900248122,"node_id":"MEE_lADOCq7kDM42X9A5zwAAAAGbSW46","url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/events/6900248122","actor":{"login":"morkovka1337","id":32310433,"node_id":"MDQ6VXNlcjMyMzEwNDMz","avatar_url":"https://avatars.githubusercontent.com/u/32310433?v=4","gravatar_id":"","url":"https://api.github.com/users/morkovka1337","html_url":"https://github.com/morkovka1337","followers_url":"https://api.github.com/users/morkovka1337/followers","following_url":"https://api.github.com/users/morkovka1337/following{/other_user}","gists_url":"https://api.github.com/users/morkovka1337/gists{/gist_id}","starred_url":"https://api.github.com/users/morkovka1337/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morkovka1337/subscriptions","organizations_url":"https://api.github.com/users/morkovka1337/orgs","repos_url":"https://api.github.com/users/morkovka1337/repos","events_url":"https://api.github.com/users/morkovka1337/events{/privacy}","received_events_url":"https://api.github.com/users/morkovka1337/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-06-29T08:26:33Z","performed_via_github_app":null},{"id":6900248129,"node_id":"SE_lADOCq7kDM42X9A5zwAAAAGbSW5B","url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/events/6900248129","actor":{"login":"morkovka1337","id":32310433,"node_id":"MDQ6VXNlcjMyMzEwNDMz","avatar_url":"https://avatars.githubusercontent.com/u/32310433?v=4","gravatar_id":"","url":"https://api.github.com/users/morkovka1337","html_url":"https://github.com/morkovka1337","followers_url":"https://api.github.com/users/morkovka1337/followers","following_url":"https://api.github.com/users/morkovka1337/following{/other_user}","gists_url":"https://api.github.com/users/morkovka1337/gists{/gist_id}","starred_url":"https://api.github.com/users/morkovka1337/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morkovka1337/subscriptions","organizations_url":"https://api.github.com/users/morkovka1337/orgs","repos_url":"https://api.github.com/users/morkovka1337/repos","events_url":"https://api.github.com/users/morkovka1337/events{/privacy}","received_events_url":"https://api.github.com/users/morkovka1337/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-06-29T08:26:34Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/1203559043","html_url":"https://github.com/clovaai/deep-text-recognition-benchmark/issues/284#issuecomment-1203559043","issue_url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/284","id":1203559043,"node_id":"IC_kwDOCq7kDM5HvNqD","user":{"login":"dingjingzhen","id":21244263,"node_id":"MDQ6VXNlcjIxMjQ0MjYz","avatar_url":"https://avatars.githubusercontent.com/u/21244263?v=4","gravatar_id":"","url":"https://api.github.com/users/dingjingzhen","html_url":"https://github.com/dingjingzhen","followers_url":"https://api.github.com/users/dingjingzhen/followers","following_url":"https://api.github.com/users/dingjingzhen/following{/other_user}","gists_url":"https://api.github.com/users/dingjingzhen/gists{/gist_id}","starred_url":"https://api.github.com/users/dingjingzhen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dingjingzhen/subscriptions","organizations_url":"https://api.github.com/users/dingjingzhen/orgs","repos_url":"https://api.github.com/users/dingjingzhen/repos","events_url":"https://api.github.com/users/dingjingzhen/events{/privacy}","received_events_url":"https://api.github.com/users/dingjingzhen/received_events","type":"User","site_admin":false},"created_at":"2022-08-03T06:56:56Z","updated_at":"2022-08-03T06:56:56Z","author_association":"NONE","body":"> 你好\r\n> \r\n> 在 pytorch onnx 导出中，此操作在[很长一段时间内](https://github.com/pytorch/pytorch/issues/27212)都不受支持。但是，您可以通过一组其他操作来模拟此操作[，如下所示。](https://github.com/open-mmlab/mmcv/pull/953/files)以下是我如何做的一个例子：\r\n> \r\n> ```\r\n>             if not torch.onnx.is_in_onnx_export():\r\n>                 batch_I_r = F.grid_sample(batch_I, build_P_prime_reshape, padding_mode='border', align_corners=True)\r\n>             else:\r\n>                 # workwround for export to onnx\r\n>                 # see here for details: https://github.com/open-mmlab/mmcv/pull/953/\r\n>                 n, c, h, w = batch_I.shape\r\n>                 gn, gh, gw, _ = build_P_prime_reshape.shape\r\n>                 assert n == gn\r\n> \r\n>                 x = build_P_prime_reshape[:, :, :, 0]\r\n>                 y = build_P_prime_reshape[:, :, :, 1]\r\n> \r\n>                 x = ((x + 1) / 2) * (w - 1)\r\n>                 y = ((y + 1) / 2) * (h - 1)\r\n> \r\n>                 x = x.view(n, -1)\r\n>                 y = y.view(n, -1)\r\n> \r\n>                 x0 = torch.floor(x).long()\r\n>                 y0 = torch.floor(y).long()\r\n>                 x1 = x0 + 1\r\n>                 y1 = y0 + 1\r\n> \r\n>                 wa = ((x1 - x) * (y1 - y)).unsqueeze(1)\r\n>                 wb = ((x1 - x) * (y - y0)).unsqueeze(1)\r\n>                 wc = ((x - x0) * (y1 - y)).unsqueeze(1)\r\n>                 wd = ((x - x0) * (y - y0)).unsqueeze(1)\r\n> \r\n>                 # Apply default for grid_sample function zero padding\r\n>                 im_padded = F.pad(batch_I, pad=[1, 1, 1, 1], mode='replicate')\r\n>                 padded_h = h + 2\r\n>                 padded_w = w + 2\r\n>                 # save points positions after padding\r\n>                 x0, x1, y0, y1 = x0 + 1, x1 + 1, y0 + 1, y1 + 1\r\n> \r\n>                 # Clip coordinates to padded image size\r\n>                 x0 = torch.where(x0 < 0, torch.tensor(0), x0)\r\n>                 x0 = torch.where(x0 > padded_w - 1, torch.tensor(padded_w - 1), x0)\r\n>                 x1 = torch.where(x1 < 0, torch.tensor(0), x1)\r\n>                 x1 = torch.where(x1 > padded_w - 1, torch.tensor(padded_w - 1), x1)\r\n>                 y0 = torch.where(y0 < 0, torch.tensor(0), y0)\r\n>                 y0 = torch.where(y0 > padded_h - 1, torch.tensor(padded_h - 1), y0)\r\n>                 y1 = torch.where(y1 < 0, torch.tensor(0), y1)\r\n>                 y1 = torch.where(y1 > padded_h - 1, torch.tensor(padded_h - 1), y1)\r\n> \r\n>                 im_padded = im_padded.view(n, c, -1)\r\n> \r\n>                 x0_y0 = (x0 + y0 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n>                 x0_y1 = (x0 + y1 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n>                 x1_y0 = (x1 + y0 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n>                 x1_y1 = (x1 + y1 * padded_w).unsqueeze(1).expand(-1, c, -1)\r\n> \r\n>                 Ia = torch.gather(im_padded, 2, x0_y0)\r\n>                 Ib = torch.gather(im_padded, 2, x0_y1)\r\n>                 Ic = torch.gather(im_padded, 2, x1_y0)\r\n>                 Id = torch.gather(im_padded, 2, x1_y1)\r\n> \r\n>                 batch_I_r = (Ia * wa + Ib * wb + Ic * wc + Id * wd).reshape(n, c, gh, gw)\r\n> ```\r\n\r\nHi, is there a replacement writeup for 5-D?","reactions":{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/1203559043/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dingjingzhen","id":21244263,"node_id":"MDQ6VXNlcjIxMjQ0MjYz","avatar_url":"https://avatars.githubusercontent.com/u/21244263?v=4","gravatar_id":"","url":"https://api.github.com/users/dingjingzhen","html_url":"https://github.com/dingjingzhen","followers_url":"https://api.github.com/users/dingjingzhen/followers","following_url":"https://api.github.com/users/dingjingzhen/following{/other_user}","gists_url":"https://api.github.com/users/dingjingzhen/gists{/gist_id}","starred_url":"https://api.github.com/users/dingjingzhen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dingjingzhen/subscriptions","organizations_url":"https://api.github.com/users/dingjingzhen/orgs","repos_url":"https://api.github.com/users/dingjingzhen/repos","events_url":"https://api.github.com/users/dingjingzhen/events{/privacy}","received_events_url":"https://api.github.com/users/dingjingzhen/received_events","type":"User","site_admin":false}}]