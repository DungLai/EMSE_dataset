[{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/666305222","html_url":"https://github.com/clovaai/deep-text-recognition-benchmark/issues/200#issuecomment-666305222","issue_url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/200","id":666305222,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NjMwNTIyMg==","user":{"login":"ku21fan","id":7953971,"node_id":"MDQ6VXNlcjc5NTM5NzE=","avatar_url":"https://avatars.githubusercontent.com/u/7953971?v=4","gravatar_id":"","url":"https://api.github.com/users/ku21fan","html_url":"https://github.com/ku21fan","followers_url":"https://api.github.com/users/ku21fan/followers","following_url":"https://api.github.com/users/ku21fan/following{/other_user}","gists_url":"https://api.github.com/users/ku21fan/gists{/gist_id}","starred_url":"https://api.github.com/users/ku21fan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ku21fan/subscriptions","organizations_url":"https://api.github.com/users/ku21fan/orgs","repos_url":"https://api.github.com/users/ku21fan/repos","events_url":"https://api.github.com/users/ku21fan/events{/privacy}","received_events_url":"https://api.github.com/users/ku21fan/received_events","type":"User","site_admin":false},"created_at":"2020-07-30T11:16:32Z","updated_at":"2020-07-30T11:16:32Z","author_association":"CONTRIBUTOR","body":"Hello, \r\n\r\nI have two questions to resolve this problem.\r\n1) Does this error occur when you try with batch_size 192?\r\nEven if you try with batch_size 192, you would divide (odd_number/192) and also cannot be divisible, so I want to check whether batch_size is the cause of the problem or not.\r\n\r\n2) Does this error occur when you use a single GPU?\r\nMaybe a single GPU would not occur this error.\r\n\r\nBest\r\n","reactions":{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/666305222/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ku21fan","id":7953971,"node_id":"MDQ6VXNlcjc5NTM5NzE=","avatar_url":"https://avatars.githubusercontent.com/u/7953971?v=4","gravatar_id":"","url":"https://api.github.com/users/ku21fan","html_url":"https://github.com/ku21fan","followers_url":"https://api.github.com/users/ku21fan/followers","following_url":"https://api.github.com/users/ku21fan/following{/other_user}","gists_url":"https://api.github.com/users/ku21fan/gists{/gist_id}","starred_url":"https://api.github.com/users/ku21fan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ku21fan/subscriptions","organizations_url":"https://api.github.com/users/ku21fan/orgs","repos_url":"https://api.github.com/users/ku21fan/repos","events_url":"https://api.github.com/users/ku21fan/events{/privacy}","received_events_url":"https://api.github.com/users/ku21fan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/742782827","html_url":"https://github.com/clovaai/deep-text-recognition-benchmark/issues/200#issuecomment-742782827","issue_url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/200","id":742782827,"node_id":"MDEyOklzc3VlQ29tbWVudDc0Mjc4MjgyNw==","user":{"login":"JoshuaPlacidi","id":67059996,"node_id":"MDQ6VXNlcjY3MDU5OTk2","avatar_url":"https://avatars.githubusercontent.com/u/67059996?v=4","gravatar_id":"","url":"https://api.github.com/users/JoshuaPlacidi","html_url":"https://github.com/JoshuaPlacidi","followers_url":"https://api.github.com/users/JoshuaPlacidi/followers","following_url":"https://api.github.com/users/JoshuaPlacidi/following{/other_user}","gists_url":"https://api.github.com/users/JoshuaPlacidi/gists{/gist_id}","starred_url":"https://api.github.com/users/JoshuaPlacidi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JoshuaPlacidi/subscriptions","organizations_url":"https://api.github.com/users/JoshuaPlacidi/orgs","repos_url":"https://api.github.com/users/JoshuaPlacidi/repos","events_url":"https://api.github.com/users/JoshuaPlacidi/events{/privacy}","received_events_url":"https://api.github.com/users/JoshuaPlacidi/received_events","type":"User","site_admin":false},"created_at":"2020-12-10T20:35:48Z","updated_at":"2020-12-10T21:33:40Z","author_association":"NONE","body":"> Hi,\r\n> \r\n> I am currently experiencing the same error during training:\r\n> \r\n> ```\r\n> if rgb:\r\n>     input_channel = 3\r\n>     \r\n> model = Model()\r\n> model = torch.nn.DataParallel(model, device_ids = [0])#.to('cuda:0')\r\n> model.load_state_dict(torch.load(saved_model, map_location=device), strict=False)\r\n> \r\n> if 'CTC' in prediction:\r\n>     # Ignoring baiduCTC \r\n>     converter = CTCLabelConverter(character)\r\n>     criterion = CTCLoss()\r\n> else:\r\n>     converter = AttnLabelConverter(character)\r\n>     criterion = torch.nn.CTCLoss(zero_infinity=True).to(device)\r\n> \r\n> num_class = len(converter.character)\r\n> \r\n> loss_avg = Averager()\r\n> \r\n> filtered_parameters = []\r\n> params_num = []\r\n> for p in filter(lambda p: p.requires_grad, model.parameters()):\r\n>     filtered_parameters.append(p)\r\n>     params_num.append(np.prod(p.size()))\r\n> print('Trainable params num : ', sum(params_num))\r\n> \r\n> optimizer = optim.Adam(filtered_parameters, lr=0.001)#, betas=(beta1, 0.999))\r\n> \r\n> start_iter = 0\r\n> start_time = time.time()\r\n> best_accuracy = -1\r\n> best_norm_ED = -1\r\n> iteration = start_iter\r\n> torch.cuda.empty_cache()\r\n> \r\n> # train loop\r\n> for img_path_batch, img_batch, text_batch, objects_batch in tqdm(data_ldr):\r\n>     image = img_batch.to(device)\r\n>     print(text_batch)\r\n>     text, length = converter.encode(text_batch, batch_max_length=batch_max_length)\r\n>     \r\n>     if 'CTC' in prediction:\r\n>         preds = model(image, text)\r\n>         preds_size = torch.IntTensor([preds.size(1) * batch_size])\r\n>         \r\n>         preds = preds.log_softmax(2).permute(1, 0, 2)\r\n>         cost = criterion(preds, text, preds_size, length)\r\n>     else:\r\n>         preds = model(image, text[:, :-1], objects_batch)  # align with Attention.forward\r\n>         target = text[:, 1:]  # without [GO] Symbol\r\n>         cost = criterion(preds.view(-1, preds.shape[-1]), target.contiguous().view(-1))\r\n>         \r\n>         model.zero_grad()\r\n>         cost.backward()\r\n>         torch.nn.utils.clip_grad_norm_(model.parameters(), 5)  # gradient clipping with 5 (Default)\r\n>         optimizer.step()\r\n>         \r\n>         loss_avg.add(cost)\r\n>     iteration += 1\r\n> \r\n> 'finish training'\r\n> ```\r\n> Error:\r\n> ```\r\n> TypeError                                 Traceback (most recent call last)\r\n> <ipython-input-60-2cfde1ea9c69> in <module>\r\n>      22         preds = model(image, text[:, :-1], objects_batch)  # align with Attention.forward\r\n>      23         target = text[:, 1:]  # without [GO] Symbol\r\n> ---> 24         cost = criterion(preds.view(-1, preds.shape[-1]), target.contiguous().view(-1))\r\n>      25 \r\n>      26         model.zero_grad()\r\n> \r\n> ~\\anaconda3\\lib\\site-packages\\torch\\nn\\modules\\module.py in _call_impl(self, *input, **kwargs)\r\n>     720             result = self._slow_forward(*input, **kwargs)\r\n>     721         else:\r\n> --> 722             result = self.forward(*input, **kwargs)\r\n>     723         for hook in itertools.chain(\r\n>     724                 _global_forward_hooks.values(),\r\n> \r\n> TypeError: forward() missing 2 required positional arguments: 'input_lengths' and 'target_lengths'\r\n> ```\r\n> \r\n> I get this error with batch size of 192 and training on 1 GPU\r\n\r\nI have realised I made a mistake when defining my criterion, I was using CTCLoss when I should have been using:\r\n`criterion = torch.nn.CrossEntropyLoss(ignore_index=0).to(device)`","reactions":{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/742782827/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"JoshuaPlacidi","id":67059996,"node_id":"MDQ6VXNlcjY3MDU5OTk2","avatar_url":"https://avatars.githubusercontent.com/u/67059996?v=4","gravatar_id":"","url":"https://api.github.com/users/JoshuaPlacidi","html_url":"https://github.com/JoshuaPlacidi","followers_url":"https://api.github.com/users/JoshuaPlacidi/followers","following_url":"https://api.github.com/users/JoshuaPlacidi/following{/other_user}","gists_url":"https://api.github.com/users/JoshuaPlacidi/gists{/gist_id}","starred_url":"https://api.github.com/users/JoshuaPlacidi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JoshuaPlacidi/subscriptions","organizations_url":"https://api.github.com/users/JoshuaPlacidi/orgs","repos_url":"https://api.github.com/users/JoshuaPlacidi/repos","events_url":"https://api.github.com/users/JoshuaPlacidi/events{/privacy}","received_events_url":"https://api.github.com/users/JoshuaPlacidi/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/844877226","html_url":"https://github.com/clovaai/deep-text-recognition-benchmark/issues/200#issuecomment-844877226","issue_url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/200","id":844877226,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NDg3NzIyNg==","user":{"login":"GraceKafuu","id":38401721,"node_id":"MDQ6VXNlcjM4NDAxNzIx","avatar_url":"https://avatars.githubusercontent.com/u/38401721?v=4","gravatar_id":"","url":"https://api.github.com/users/GraceKafuu","html_url":"https://github.com/GraceKafuu","followers_url":"https://api.github.com/users/GraceKafuu/followers","following_url":"https://api.github.com/users/GraceKafuu/following{/other_user}","gists_url":"https://api.github.com/users/GraceKafuu/gists{/gist_id}","starred_url":"https://api.github.com/users/GraceKafuu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GraceKafuu/subscriptions","organizations_url":"https://api.github.com/users/GraceKafuu/orgs","repos_url":"https://api.github.com/users/GraceKafuu/repos","events_url":"https://api.github.com/users/GraceKafuu/events{/privacy}","received_events_url":"https://api.github.com/users/GraceKafuu/received_events","type":"User","site_admin":false},"created_at":"2021-05-20T08:52:08Z","updated_at":"2021-05-20T08:52:08Z","author_association":"NONE","body":"Facing the same problem.","reactions":{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/844877226/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GraceKafuu","id":38401721,"node_id":"MDQ6VXNlcjM4NDAxNzIx","avatar_url":"https://avatars.githubusercontent.com/u/38401721?v=4","gravatar_id":"","url":"https://api.github.com/users/GraceKafuu","html_url":"https://github.com/GraceKafuu","followers_url":"https://api.github.com/users/GraceKafuu/followers","following_url":"https://api.github.com/users/GraceKafuu/following{/other_user}","gists_url":"https://api.github.com/users/GraceKafuu/gists{/gist_id}","starred_url":"https://api.github.com/users/GraceKafuu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GraceKafuu/subscriptions","organizations_url":"https://api.github.com/users/GraceKafuu/orgs","repos_url":"https://api.github.com/users/GraceKafuu/repos","events_url":"https://api.github.com/users/GraceKafuu/events{/privacy}","received_events_url":"https://api.github.com/users/GraceKafuu/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/900882725","html_url":"https://github.com/clovaai/deep-text-recognition-benchmark/issues/200#issuecomment-900882725","issue_url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/200","id":900882725,"node_id":"IC_kwDOCq7kDM41smEl","user":{"login":"ttxskk","id":24960075,"node_id":"MDQ6VXNlcjI0OTYwMDc1","avatar_url":"https://avatars.githubusercontent.com/u/24960075?v=4","gravatar_id":"","url":"https://api.github.com/users/ttxskk","html_url":"https://github.com/ttxskk","followers_url":"https://api.github.com/users/ttxskk/followers","following_url":"https://api.github.com/users/ttxskk/following{/other_user}","gists_url":"https://api.github.com/users/ttxskk/gists{/gist_id}","starred_url":"https://api.github.com/users/ttxskk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ttxskk/subscriptions","organizations_url":"https://api.github.com/users/ttxskk/orgs","repos_url":"https://api.github.com/users/ttxskk/repos","events_url":"https://api.github.com/users/ttxskk/events{/privacy}","received_events_url":"https://api.github.com/users/ttxskk/received_events","type":"User","site_admin":false},"created_at":"2021-08-18T07:22:31Z","updated_at":"2021-08-18T07:22:31Z","author_association":"NONE","body":"Maybe you just need to set drop_last=True in your DataLoader.","reactions":{"url":"https://api.github.com/repos/clovaai/deep-text-recognition-benchmark/issues/comments/900882725/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ttxskk","id":24960075,"node_id":"MDQ6VXNlcjI0OTYwMDc1","avatar_url":"https://avatars.githubusercontent.com/u/24960075?v=4","gravatar_id":"","url":"https://api.github.com/users/ttxskk","html_url":"https://github.com/ttxskk","followers_url":"https://api.github.com/users/ttxskk/followers","following_url":"https://api.github.com/users/ttxskk/following{/other_user}","gists_url":"https://api.github.com/users/ttxskk/gists{/gist_id}","starred_url":"https://api.github.com/users/ttxskk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ttxskk/subscriptions","organizations_url":"https://api.github.com/users/ttxskk/orgs","repos_url":"https://api.github.com/users/ttxskk/repos","events_url":"https://api.github.com/users/ttxskk/events{/privacy}","received_events_url":"https://api.github.com/users/ttxskk/received_events","type":"User","site_admin":false}}]