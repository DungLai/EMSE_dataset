[{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/comments/632599718","html_url":"https://github.com/blue-oil/blueoil/issues/1043#issuecomment-632599718","issue_url":"https://api.github.com/repos/blue-oil/blueoil/issues/1043","id":632599718,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMjU5OTcxOA==","user":{"login":"joelN123","id":32167300,"node_id":"MDQ6VXNlcjMyMTY3MzAw","avatar_url":"https://avatars.githubusercontent.com/u/32167300?v=4","gravatar_id":"","url":"https://api.github.com/users/joelN123","html_url":"https://github.com/joelN123","followers_url":"https://api.github.com/users/joelN123/followers","following_url":"https://api.github.com/users/joelN123/following{/other_user}","gists_url":"https://api.github.com/users/joelN123/gists{/gist_id}","starred_url":"https://api.github.com/users/joelN123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joelN123/subscriptions","organizations_url":"https://api.github.com/users/joelN123/orgs","repos_url":"https://api.github.com/users/joelN123/repos","events_url":"https://api.github.com/users/joelN123/events{/privacy}","received_events_url":"https://api.github.com/users/joelN123/received_events","type":"User","site_admin":false},"created_at":"2020-05-22T09:39:56Z","updated_at":"2020-05-22T09:39:56Z","author_association":"CONTRIBUTOR","body":"It's an important issue! Thank you for bringing it up.\r\n\r\nYes, no seed is passed, so it will be generated by the system clock maybe? Another reason there is variability between training runs is because the TensorFlow weight initializer's default is to use `None` random seed, which I guess has the same behaviour as `None` random seed for shuffle.\r\n\r\nSpeaking about reproducibility more generally, I think it is safer to generate random numbers by the system clock as much as possible (i.e. not use a fixed seed). For example, let's say I gave you a model definition and I say I got 70% test accuracy on it, for a particular dataset. Then you run training for it (with different seed) and the test accuracy is 65%. The cause of this big difference is something that we need to look into. One possible reason is that the training algorithm for the model has a large variability between runs. So it is important to try to reduce that variability. Or at least do multiple training runs, to get a mean and standard deviation. Another possible reason is that the test dataset is so small, the metric values fluctuate very easily. In either of these cases, we get a false sense of security by using the same fixed seed each time. In this sense, I think it is good to use the system clock for the random seed as default, so that these kinds of problems stay visible to us.\r\n\r\nIn the case where I'd like to give to someone my exact model, then I think it's better to just save the weights of the model, and let that person to load it / retrain it / etc as they like.\r\n\r\nHaving said all this, it would be useful to have an option for supplying a specific random seed for the training algorithm. For example, in debugging, if a bug comes up in a different place each time the training is run, or only comes up 10% of the time, it can be easier to debug by using the same fixed seed.","reactions":{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/comments/632599718/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"joelN123","id":32167300,"node_id":"MDQ6VXNlcjMyMTY3MzAw","avatar_url":"https://avatars.githubusercontent.com/u/32167300?v=4","gravatar_id":"","url":"https://api.github.com/users/joelN123","html_url":"https://github.com/joelN123","followers_url":"https://api.github.com/users/joelN123/followers","following_url":"https://api.github.com/users/joelN123/following{/other_user}","gists_url":"https://api.github.com/users/joelN123/gists{/gist_id}","starred_url":"https://api.github.com/users/joelN123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joelN123/subscriptions","organizations_url":"https://api.github.com/users/joelN123/orgs","repos_url":"https://api.github.com/users/joelN123/repos","events_url":"https://api.github.com/users/joelN123/events{/privacy}","received_events_url":"https://api.github.com/users/joelN123/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/comments/634678058","html_url":"https://github.com/blue-oil/blueoil/issues/1043#issuecomment-634678058","issue_url":"https://api.github.com/repos/blue-oil/blueoil/issues/1043","id":634678058,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNDY3ODA1OA==","user":{"login":"minux302","id":29625948,"node_id":"MDQ6VXNlcjI5NjI1OTQ4","avatar_url":"https://avatars.githubusercontent.com/u/29625948?v=4","gravatar_id":"","url":"https://api.github.com/users/minux302","html_url":"https://github.com/minux302","followers_url":"https://api.github.com/users/minux302/followers","following_url":"https://api.github.com/users/minux302/following{/other_user}","gists_url":"https://api.github.com/users/minux302/gists{/gist_id}","starred_url":"https://api.github.com/users/minux302/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/minux302/subscriptions","organizations_url":"https://api.github.com/users/minux302/orgs","repos_url":"https://api.github.com/users/minux302/repos","events_url":"https://api.github.com/users/minux302/events{/privacy}","received_events_url":"https://api.github.com/users/minux302/received_events","type":"User","site_admin":false},"created_at":"2020-05-27T13:55:48Z","updated_at":"2020-05-27T13:55:48Z","author_association":"NONE","body":"Thank you for detail explanation!!\r\nWhat is the implementation of creating a seed with a system clock  (not using a fixed seed)?\r\nThis is the implementation image. Is it correct?\r\n```python\r\nclass _TFDSReader:\r\n\r\n    def __init__(self, dataset, local_rank):\r\n        tf.set_random_seed(0)\r\n        tf_dataset = dataset.tf_dataset.shuffle(1024).repeat()\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/comments/634678058/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"minux302","id":29625948,"node_id":"MDQ6VXNlcjI5NjI1OTQ4","avatar_url":"https://avatars.githubusercontent.com/u/29625948?v=4","gravatar_id":"","url":"https://api.github.com/users/minux302","html_url":"https://github.com/minux302","followers_url":"https://api.github.com/users/minux302/followers","following_url":"https://api.github.com/users/minux302/following{/other_user}","gists_url":"https://api.github.com/users/minux302/gists{/gist_id}","starred_url":"https://api.github.com/users/minux302/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/minux302/subscriptions","organizations_url":"https://api.github.com/users/minux302/orgs","repos_url":"https://api.github.com/users/minux302/repos","events_url":"https://api.github.com/users/minux302/events{/privacy}","received_events_url":"https://api.github.com/users/minux302/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/comments/635266064","html_url":"https://github.com/blue-oil/blueoil/issues/1043#issuecomment-635266064","issue_url":"https://api.github.com/repos/blue-oil/blueoil/issues/1043","id":635266064,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNTI2NjA2NA==","user":{"login":"joelN123","id":32167300,"node_id":"MDQ6VXNlcjMyMTY3MzAw","avatar_url":"https://avatars.githubusercontent.com/u/32167300?v=4","gravatar_id":"","url":"https://api.github.com/users/joelN123","html_url":"https://github.com/joelN123","followers_url":"https://api.github.com/users/joelN123/followers","following_url":"https://api.github.com/users/joelN123/following{/other_user}","gists_url":"https://api.github.com/users/joelN123/gists{/gist_id}","starred_url":"https://api.github.com/users/joelN123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joelN123/subscriptions","organizations_url":"https://api.github.com/users/joelN123/orgs","repos_url":"https://api.github.com/users/joelN123/repos","events_url":"https://api.github.com/users/joelN123/events{/privacy}","received_events_url":"https://api.github.com/users/joelN123/received_events","type":"User","site_admin":false},"created_at":"2020-05-28T10:49:22Z","updated_at":"2020-05-28T10:49:22Z","author_association":"CONTRIBUTOR","body":"No problem!\r\n- I think the TensorFlow default is to use the system clock as seed. So, simply not setting a seed (or setting as `None`) will cause the system clock to be used. I'm not totally sure how TensorFlow implements this... maybe somewhere inside of [tensorflow/core/lib/random](https://github.com/tensorflow/tensorflow/tree/r1.15/tensorflow/core/lib/random)?\r\n- To use a fixed seed, yes, I think that adding the line `tf.set_random_seed(0)` will work (although I didn't try it out). That might also cause a fixed seed to be used for the weight initialization of the network [tf/random/set_seed](https://www.tensorflow.org/api_docs/python/tf/random/set_seed). To set a fixed seed for just the dataset shuffle (and not for other operations), it is possible to use `dataset.tf_dataset.shuffle(1024, seed=0).repeat()`.\r\n\r\nAfter searching about this, it looks like even if the seed is set, there are some TensorFlow ops that may not give the same result when run on GPU [NVIDIA/tensorflow-determinism](https://github.com/NVIDIA/tensorflow-determinism) and also [Non-Determinism in TensorFlow ResNets](https://arxiv.org/abs/2001.11396)","reactions":{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/comments/635266064/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"joelN123","id":32167300,"node_id":"MDQ6VXNlcjMyMTY3MzAw","avatar_url":"https://avatars.githubusercontent.com/u/32167300?v=4","gravatar_id":"","url":"https://api.github.com/users/joelN123","html_url":"https://github.com/joelN123","followers_url":"https://api.github.com/users/joelN123/followers","following_url":"https://api.github.com/users/joelN123/following{/other_user}","gists_url":"https://api.github.com/users/joelN123/gists{/gist_id}","starred_url":"https://api.github.com/users/joelN123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joelN123/subscriptions","organizations_url":"https://api.github.com/users/joelN123/orgs","repos_url":"https://api.github.com/users/joelN123/repos","events_url":"https://api.github.com/users/joelN123/events{/privacy}","received_events_url":"https://api.github.com/users/joelN123/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/comments/635881242","html_url":"https://github.com/blue-oil/blueoil/issues/1043#issuecomment-635881242","issue_url":"https://api.github.com/repos/blue-oil/blueoil/issues/1043","id":635881242,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNTg4MTI0Mg==","user":{"login":"minux302","id":29625948,"node_id":"MDQ6VXNlcjI5NjI1OTQ4","avatar_url":"https://avatars.githubusercontent.com/u/29625948?v=4","gravatar_id":"","url":"https://api.github.com/users/minux302","html_url":"https://github.com/minux302","followers_url":"https://api.github.com/users/minux302/followers","following_url":"https://api.github.com/users/minux302/following{/other_user}","gists_url":"https://api.github.com/users/minux302/gists{/gist_id}","starred_url":"https://api.github.com/users/minux302/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/minux302/subscriptions","organizations_url":"https://api.github.com/users/minux302/orgs","repos_url":"https://api.github.com/users/minux302/repos","events_url":"https://api.github.com/users/minux302/events{/privacy}","received_events_url":"https://api.github.com/users/minux302/received_events","type":"User","site_admin":false},"created_at":"2020-05-29T09:45:42Z","updated_at":"2020-05-29T09:45:42Z","author_association":"NONE","body":"Thanks!\r\nI want to, and will fix interface like below.\r\n```python\r\nclass _TFDSReader:\r\n\r\n    def __init__(self, dataset, local_rank, shuffle_seed=None):\r\n        tf_dataset = dataset.tf_dataset.shuffle(1024, seed=shuffle_seed).repeat()\r\n```","reactions":{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/comments/635881242/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"minux302","id":29625948,"node_id":"MDQ6VXNlcjI5NjI1OTQ4","avatar_url":"https://avatars.githubusercontent.com/u/29625948?v=4","gravatar_id":"","url":"https://api.github.com/users/minux302","html_url":"https://github.com/minux302","followers_url":"https://api.github.com/users/minux302/followers","following_url":"https://api.github.com/users/minux302/following{/other_user}","gists_url":"https://api.github.com/users/minux302/gists{/gist_id}","starred_url":"https://api.github.com/users/minux302/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/minux302/subscriptions","organizations_url":"https://api.github.com/users/minux302/orgs","repos_url":"https://api.github.com/users/minux302/repos","events_url":"https://api.github.com/users/minux302/events{/privacy}","received_events_url":"https://api.github.com/users/minux302/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/comments/635894948","html_url":"https://github.com/blue-oil/blueoil/issues/1043#issuecomment-635894948","issue_url":"https://api.github.com/repos/blue-oil/blueoil/issues/1043","id":635894948,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNTg5NDk0OA==","user":{"login":"joelN123","id":32167300,"node_id":"MDQ6VXNlcjMyMTY3MzAw","avatar_url":"https://avatars.githubusercontent.com/u/32167300?v=4","gravatar_id":"","url":"https://api.github.com/users/joelN123","html_url":"https://github.com/joelN123","followers_url":"https://api.github.com/users/joelN123/followers","following_url":"https://api.github.com/users/joelN123/following{/other_user}","gists_url":"https://api.github.com/users/joelN123/gists{/gist_id}","starred_url":"https://api.github.com/users/joelN123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joelN123/subscriptions","organizations_url":"https://api.github.com/users/joelN123/orgs","repos_url":"https://api.github.com/users/joelN123/repos","events_url":"https://api.github.com/users/joelN123/events{/privacy}","received_events_url":"https://api.github.com/users/joelN123/received_events","type":"User","site_admin":false},"created_at":"2020-05-29T10:17:34Z","updated_at":"2020-05-29T10:17:34Z","author_association":"CONTRIBUTOR","body":"looks good ! nice and clean.","reactions":{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/comments/635894948/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"joelN123","id":32167300,"node_id":"MDQ6VXNlcjMyMTY3MzAw","avatar_url":"https://avatars.githubusercontent.com/u/32167300?v=4","gravatar_id":"","url":"https://api.github.com/users/joelN123","html_url":"https://github.com/joelN123","followers_url":"https://api.github.com/users/joelN123/followers","following_url":"https://api.github.com/users/joelN123/following{/other_user}","gists_url":"https://api.github.com/users/joelN123/gists{/gist_id}","starred_url":"https://api.github.com/users/joelN123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joelN123/subscriptions","organizations_url":"https://api.github.com/users/joelN123/orgs","repos_url":"https://api.github.com/users/joelN123/repos","events_url":"https://api.github.com/users/joelN123/events{/privacy}","received_events_url":"https://api.github.com/users/joelN123/received_events","type":"User","site_admin":false}}]