{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/173","repository_url":"https://api.github.com/repos/blue-oil/blueoil","labels_url":"https://api.github.com/repos/blue-oil/blueoil/issues/173/labels{/name}","comments_url":"https://api.github.com/repos/blue-oil/blueoil/issues/173/comments","events_url":"https://api.github.com/repos/blue-oil/blueoil/issues/173/events","html_url":"https://github.com/blue-oil/blueoil/issues/173","id":415274242,"node_id":"MDU6SXNzdWU0MTUyNzQyNDI=","number":173,"title":"Concat network compile error by invalid type","user":{"login":"ruimashita","id":138891,"node_id":"MDQ6VXNlcjEzODg5MQ==","avatar_url":"https://avatars.githubusercontent.com/u/138891?v=4","gravatar_id":"","url":"https://api.github.com/users/ruimashita","html_url":"https://github.com/ruimashita","followers_url":"https://api.github.com/users/ruimashita/followers","following_url":"https://api.github.com/users/ruimashita/following{/other_user}","gists_url":"https://api.github.com/users/ruimashita/gists{/gist_id}","starred_url":"https://api.github.com/users/ruimashita/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ruimashita/subscriptions","organizations_url":"https://api.github.com/users/ruimashita/orgs","repos_url":"https://api.github.com/users/ruimashita/repos","events_url":"https://api.github.com/users/ruimashita/events{/privacy}","received_events_url":"https://api.github.com/users/ruimashita/received_events","type":"User","site_admin":false},"labels":[{"id":1095590109,"node_id":"MDU6TGFiZWwxMDk1NTkwMTA5","url":"https://api.github.com/repos/blue-oil/blueoil/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2019-02-27T18:52:07Z","updated_at":"2019-06-13T07:57:04Z","closed_at":"2019-06-13T07:57:04Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"When run `make lm_x86` in generated project with double concat network, the error comes.\r\n\r\n```\r\n...\r\ng++ -I./include -O3 -std=c++0x -DUSE_PNG -pthread -g -c mains/main.cpp -o mains/main.o -DFUNC_TIME_MEASUREMENT\r\nsrc/network.cpp: In member function ‘bool Network::run(float*, float*)’:\r\nsrc/network.cpp:312:106: error: cannot convert ‘float*’ to ‘uint8_t* {aka unsigned char*}’ in initialization\r\n   QUANTIZED_NOT_PACKED *second_concat_inputs[] = { first_QTZ_linear_mid_tread_half, second_conv2d_Conv2D };\r\n                                                                                                          ^\r\nsrc/network.cpp:351:86: error: cannot convert ‘float*’ to ‘uint8_t* {aka unsigned char*}’ in initialization\r\n   QUANTIZED_NOT_PACKED *third_concat_inputs[] = { second_concat, third_conv2d_Conv2D };\r\n                                                                                      ^\r\nsrc/network.cpp:371:96: error: cannot convert ‘uint8_t* {aka unsigned char*}’ to ‘T_FLOAT* {aka float*}’ for argument ‘1’ to ‘void func_Conv2D(T_FLOAT*, T_FLOAT*, T_FLOAT*, convolution_parameters, T_UINT, T_UINT, T_UINT)’\r\n func_Conv2D(third_concat, fourth_conv2d_kernel, fourth_conv2d_Conv2D, Conv2D_struct, 32, 32, 10);\r\n\r\nMakefile:231: recipe for target 'src/network.o' failed\r\nmake: *** [src/network.o] Error 1\r\nmake: *** Waiting for unfinished jobs....\r\n...\r\n```\r\n\r\ngit branch: https://github.com/ruimashita/blueoil/tree/double_concat\r\n\r\nnetwork file: https://github.com/ruimashita/blueoil/blob/double_concat/lmnet/lmnet/networks/classification/double_concat.py\r\nconfig file: https://github.com/ruimashita/blueoil/blob/double_concat/lmnet/configs/double_concat.py\r\n\r\npart of generated network.cpp:\r\n```\r\n  float *second_conv2d_Conv2D = first_conv2d_Conv2D;\r\n\r\n                    Conv2D_struct.input_height = 32;\r\n                    Conv2D_struct.input_width = 32;\r\n                    Conv2D_struct.kernel_height = 3;\r\n                    Conv2D_struct.kernel_width = 3;\r\n                    Conv2D_struct.kernel_depth = 32;\r\n                    Conv2D_struct.kernel_elements = 288;\r\n                    Conv2D_struct.output_channels = 32;\r\n                    Conv2D_struct.output_height = 32;\r\n                    Conv2D_struct.output_width = 32;\r\n                    Conv2D_struct.padding = 1;\r\n                    Conv2D_struct.stride_along_height = 1;\r\n                    Conv2D_struct.stride_along_width = 1;\r\n\r\n                    binConv2D_struct.normal_conv_params = Conv2D_struct;\r\n                    binConv2D_struct.bin_input_extra_bits = 0;\r\n                    binConv2D_struct.bin_input_bitwidth = 2;\r\n                    binConv2D_struct.bin_kernel_ndata = 9;\r\n                    binConv2D_struct.bin_input_nwords = 9;\r\n                    binConv2D_struct.bin_input_ndata = 9*2;\r\n                    binConv2D_struct.device_input_buf = device_input_buf;\r\n                    binConv2D_struct.device_output_buf = device_output_buf;\r\n                    binConv2D_struct.thresholds = second_conv2d_Conv2D_thresholds;\r\n                    binConv2D_struct.n_bit = 2;\r\n                    binConv2D_struct.max_value = 2.0;\r\n\r\n                    func_QuantizedConv2DWithThreshold(first_QTZ_linear_mid_tread_half, second_conv2d_kernel_1_QTZ_binary_channel_wise_mean_scaling_new, second_conv2d_Conv2D, scaling_factors::second_conv2d_Conv2D, binConv2D_struct);\r\n\r\n  \r\n\r\n  \r\n  QUANTIZED_NOT_PACKED *second_concat_inputs[] = { first_QTZ_linear_mid_tread_half, second_conv2d_Conv2D };\r\nT_UINT second_concat_inputs_depth[] = { 32, 32 };\r\nfunc_ConcatOnDepth(second_concat_inputs, second_concat_inputs_depth, 2, second_concat, 32, 32, 64);\r\n```\r\n\r\n\r\npart of double concat network:\r\n```\r\n    def base(self, images, is_training, *args, **kwargs):\r\n        self.images = images\r\n\r\n        with tf.variable_scope(\"first\"):\r\n            x = conv(images, 32, 1)\r\n            x = batch_norm(x, is_training)\r\n            x = self.activation(x)\r\n            stock = x\r\n\r\n        with tf.variable_scope(\"\", custom_getter=self.custom_getter):\r\n            with tf.variable_scope(\"second\"):\r\n                x = conv(x, 32, 3)\r\n                x = batch_norm(x, is_training)\r\n                x = self.activation(x)\r\n\r\n                x = tf.concat([stock, x], axis=3)\r\n\r\n                stock = x\r\n\r\n            with tf.variable_scope(\"third\"):\r\n                x = conv(x, 32, 3)\r\n                x = batch_norm(x, is_training)\r\n                x = self.activation(x)\r\n\r\n                x = tf.concat([stock, x], axis=3)\r\n```\r\n\r\n\r\nThe network.cpp is created by `run_generate_project()` with\r\n```\r\n    activate_hard_quantization = True\r\n    threshold_skipping = True\r\n```","closed_by":{"login":"ruimashita","id":138891,"node_id":"MDQ6VXNlcjEzODg5MQ==","avatar_url":"https://avatars.githubusercontent.com/u/138891?v=4","gravatar_id":"","url":"https://api.github.com/users/ruimashita","html_url":"https://github.com/ruimashita","followers_url":"https://api.github.com/users/ruimashita/followers","following_url":"https://api.github.com/users/ruimashita/following{/other_user}","gists_url":"https://api.github.com/users/ruimashita/gists{/gist_id}","starred_url":"https://api.github.com/users/ruimashita/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ruimashita/subscriptions","organizations_url":"https://api.github.com/users/ruimashita/orgs","repos_url":"https://api.github.com/users/ruimashita/repos","events_url":"https://api.github.com/users/ruimashita/events{/privacy}","received_events_url":"https://api.github.com/users/ruimashita/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/173/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/blue-oil/blueoil/issues/173/timeline","performed_via_github_app":null,"state_reason":"completed"}