{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/109","repository_url":"https://api.github.com/repos/blue-oil/blueoil","labels_url":"https://api.github.com/repos/blue-oil/blueoil/issues/109/labels{/name}","comments_url":"https://api.github.com/repos/blue-oil/blueoil/issues/109/comments","events_url":"https://api.github.com/repos/blue-oil/blueoil/issues/109/events","html_url":"https://github.com/blue-oil/blueoil/issues/109","id":400144063,"node_id":"MDU6SXNzdWU0MDAxNDQwNjM=","number":109,"title":"Copy kernels and thresholds during the init() step","user":{"login":"antonionevado","id":21376077,"node_id":"MDQ6VXNlcjIxMzc2MDc3","avatar_url":"https://avatars.githubusercontent.com/u/21376077?v=4","gravatar_id":"","url":"https://api.github.com/users/antonionevado","html_url":"https://github.com/antonionevado","followers_url":"https://api.github.com/users/antonionevado/followers","following_url":"https://api.github.com/users/antonionevado/following{/other_user}","gists_url":"https://api.github.com/users/antonionevado/gists{/gist_id}","starred_url":"https://api.github.com/users/antonionevado/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antonionevado/subscriptions","organizations_url":"https://api.github.com/users/antonionevado/orgs","repos_url":"https://api.github.com/users/antonionevado/repos","events_url":"https://api.github.com/users/antonionevado/events{/privacy}","received_events_url":"https://api.github.com/users/antonionevado/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-01-17T07:30:32Z","updated_at":"2020-01-16T05:56:16Z","closed_at":"2020-01-16T05:56:15Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"We can improve inference time by copying the kernels and thresholds into the DDR region shared with the FPGA during the init() step.\r\n\r\nProof: if we pre-copy we get:\r\n```\r\nBatchNorm,9674,182,  sum:9.856ms\r\nConvolution,9586,1322,  sum:10.908ms\r\nExtractImagePatches,864,254,122,59,26,10,13,12,  sum:1.36ms\r\nKernel transpose NHWC to HWNoCNi,18,11,20,52,336,541,237,7,6,4,2220,240,234,206,230,  sum:4.362ms\r\nMaximum,139,  sum:0.139ms\r\nMul,71,  sum:0.071ms\r\nPacking input for kn2row,3301,712,238,110,74,39,15,40,108,189,70,23,14,20,14,  sum:4.967ms\r\nQConv2D with kn2row,13963,3364,1458,793,686,415,326,41,66,203,1568,245,326,245,297,  sum:23.996ms\r\nQTZ_linear_mid_tread_half,9677,  sum:9.677ms\r\nQuantizedConv2D,677,  sum:0.677ms\r\nQuantizedConv2D_ApplyScalingFactor,143,  sum:0.143ms\r\nTotalInitTime,33319,  sum:33.319ms\r\n\r\nTotalRunTime,78409,  sum:78.409ms\r\n\r\nfunc_ConcatOnDepth,69,  sum:0.069ms\r\nkn2row-1x1,9575,1315,  sum:10.89ms\r\nmatrix_multiplication,9561,1307,  sum:10.868ms\r\nmatrix_transpose (row_major),59,  sum:0.059ms\r\npack_input_to_qwords,3285,702,228,102,64,33,9,33,99,183,64,16,8,14,8,  sum:4.848ms\r\n```\r\n\r\nOriginally, if we copy each time:\r\n```\r\nBatchNorm,9909,169,  sum:10.078ms\r\nConvolution,9467,1315,  sum:10.782ms\r\nExtractImagePatches,901,275,134,64,27,11,10,12,  sum:1.434ms\r\nKernel transpose NHWC to HWNoCNi,19,10,21,53,288,579,231,6,6,4,2266,223,232,205,224,  sum:4.367ms\r\nMaximum,137,  sum:0.137ms\r\nMul,72,  sum:0.072ms\r\nPacking input for kn2row,3304,753,262,117,76,40,16,46,127,211,72,23,15,22,15,  sum:5.099ms\r\nQConv2D with kn2row,14063,3540,1604,1000,1218,1331,854,136,156,297,4945,744,855,740,720,  sum:32.203ms\r\nQTZ_linear_mid_tread_half,9705,  sum:9.705ms\r\nQuantizedConv2D,1109,  sum:1.109ms\r\nQuantizedConv2D_ApplyScalingFactor,144,  sum:0.144ms\r\nTotalInitTime,33554,  sum:33.554ms\r\n\r\nTotalRunTime,87315,  sum:87.315ms\r\n\r\nfunc_ConcatOnDepth,74,  sum:0.074ms\r\nkn2row-1x1,9457,1308,  sum:10.765ms\r\nmatrix_multiplication,9445,1299,  sum:10.744ms\r\nmatrix_transpose (row_major),59,  sum:0.059ms\r\npack_input_to_qwords,3288,743,250,110,66,34,9,39,117,205,66,15,9,15,8,  sum:4.974ms\r\n```","closed_by":{"login":"primenumber","id":1918373,"node_id":"MDQ6VXNlcjE5MTgzNzM=","avatar_url":"https://avatars.githubusercontent.com/u/1918373?v=4","gravatar_id":"","url":"https://api.github.com/users/primenumber","html_url":"https://github.com/primenumber","followers_url":"https://api.github.com/users/primenumber/followers","following_url":"https://api.github.com/users/primenumber/following{/other_user}","gists_url":"https://api.github.com/users/primenumber/gists{/gist_id}","starred_url":"https://api.github.com/users/primenumber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/primenumber/subscriptions","organizations_url":"https://api.github.com/users/primenumber/orgs","repos_url":"https://api.github.com/users/primenumber/repos","events_url":"https://api.github.com/users/primenumber/events{/privacy}","received_events_url":"https://api.github.com/users/primenumber/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/109/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/blue-oil/blueoil/issues/109/timeline","performed_via_github_app":null,"state_reason":"completed"}