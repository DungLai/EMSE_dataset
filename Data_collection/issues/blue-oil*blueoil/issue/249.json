{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/249","repository_url":"https://api.github.com/repos/blue-oil/blueoil","labels_url":"https://api.github.com/repos/blue-oil/blueoil/issues/249/labels{/name}","comments_url":"https://api.github.com/repos/blue-oil/blueoil/issues/249/comments","events_url":"https://api.github.com/repos/blue-oil/blueoil/issues/249/events","html_url":"https://github.com/blue-oil/blueoil/issues/249","id":437012437,"node_id":"MDU6SXNzdWU0MzcwMTI0Mzc=","number":249,"title":"LMBiSeNet inference test error","user":{"login":"ruimashita","id":138891,"node_id":"MDQ6VXNlcjEzODg5MQ==","avatar_url":"https://avatars.githubusercontent.com/u/138891?v=4","gravatar_id":"","url":"https://api.github.com/users/ruimashita","html_url":"https://github.com/ruimashita","followers_url":"https://api.github.com/users/ruimashita/followers","following_url":"https://api.github.com/users/ruimashita/following{/other_user}","gists_url":"https://api.github.com/users/ruimashita/gists{/gist_id}","starred_url":"https://api.github.com/users/ruimashita/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ruimashita/subscriptions","organizations_url":"https://api.github.com/users/ruimashita/orgs","repos_url":"https://api.github.com/users/ruimashita/repos","events_url":"https://api.github.com/users/ruimashita/events{/privacy}","received_events_url":"https://api.github.com/users/ruimashita/received_events","type":"User","site_admin":false},"labels":[{"id":1095590109,"node_id":"MDU6TGFiZWwxMDk1NTkwMTA5","url":"https://api.github.com/repos/blue-oil/blueoil/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":true,"assignee":{"login":"ruimashita","id":138891,"node_id":"MDQ6VXNlcjEzODg5MQ==","avatar_url":"https://avatars.githubusercontent.com/u/138891?v=4","gravatar_id":"","url":"https://api.github.com/users/ruimashita","html_url":"https://github.com/ruimashita","followers_url":"https://api.github.com/users/ruimashita/followers","following_url":"https://api.github.com/users/ruimashita/following{/other_user}","gists_url":"https://api.github.com/users/ruimashita/gists{/gist_id}","starred_url":"https://api.github.com/users/ruimashita/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ruimashita/subscriptions","organizations_url":"https://api.github.com/users/ruimashita/orgs","repos_url":"https://api.github.com/users/ruimashita/repos","events_url":"https://api.github.com/users/ruimashita/events{/privacy}","received_events_url":"https://api.github.com/users/ruimashita/received_events","type":"User","site_admin":false},"assignees":[{"login":"ruimashita","id":138891,"node_id":"MDQ6VXNlcjEzODg5MQ==","avatar_url":"https://avatars.githubusercontent.com/u/138891?v=4","gravatar_id":"","url":"https://api.github.com/users/ruimashita","html_url":"https://github.com/ruimashita","followers_url":"https://api.github.com/users/ruimashita/followers","following_url":"https://api.github.com/users/ruimashita/following{/other_user}","gists_url":"https://api.github.com/users/ruimashita/gists{/gist_id}","starred_url":"https://api.github.com/users/ruimashita/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ruimashita/subscriptions","organizations_url":"https://api.github.com/users/ruimashita/orgs","repos_url":"https://api.github.com/users/ruimashita/repos","events_url":"https://api.github.com/users/ruimashita/events{/privacy}","received_events_url":"https://api.github.com/users/ruimashita/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2019-04-25T05:14:36Z","updated_at":"2020-03-09T06:19:02Z","closed_at":"2020-03-09T06:19:02Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Error comes when I ran LMBiSeNet inference test on x86 and FPGA (De10-Nano)\r\n\r\n\r\nRun `lm_x86.elf` on x86 server.\r\n\r\n```\r\n$  ./models/lib/lm_x86.elf ../inference_test_data/000_images_placeholder:0.npy ../inference_test_data/731_output:0.npy\r\n-------------------------------------------------------------\r\nComparison: Default network test  failed...\r\nFailed count: 1\r\nFirst failed report\r\nindex: 956 / 29040\r\ninput: -22.6264, expected: -22.6264\r\n\r\n-------------------------------------------------------------\r\nAdd,114,  sum:0.114ms\r\nApplyThresholds,3717,1687,681,1554,605,1391,610,1397,700,224,583,156,760,152,1775,1323,639,285,277,255,301,253,294,623,1240,7828,5789,2925,  sum:38.024ms\r\nAveragePool,444,440,468,  sum:1.352ms\r\nBatchNorm,6792,169,10,10,201,1,1,  sum:7.184ms\r\nConvolution,37422,9,7,2141,  sum:39.579ms\r\nExtractImagePatches,8363,479,176,124,128,77,4639,1245,742,  sum:15.973ms\r\nMulDepthWise,139,136,184,  sum:0.459ms\r\nQTZ_linear_mid_tread_half,15306,84,433,  sum:15.823ms\r\nQuantizedConv2D,14459,492,5574,  sum:20.525ms\r\nQuantizedConv2D_ApplyScalingFactor,234,2,488,  sum:0.724ms\r\nReLu,107,1,103,0,0,  sum:0.211ms\r\nTotalInitTime,34190,  sum:34.19ms\r\nTotalRunTime,650778,  sum:650.778ms\r\nfunc_ConcatOnDepth,672,724,881,289,262,312,151,217,249,448,932,  sum:5.137ms\r\nkn2row-1x1,37420,8,7,2141,  sum:39.576ms\r\nmatrix_multiplication,37417,7,6,2140,  sum:39.57ms\r\nmatrix_shift_add1,174,151,154,133,65,71,194,209,194,623,658,501,  sum:3.127ms\r\nmatrix_shift_add2,513,418,438,201,93,100,87,90,83,5883,2981,955,  sum:11.842ms\r\npack_input_to_qwords,10964,565,253,598,240,677,218,798,229,114,257,96,240,105,287,218,232,105,46,150,46,200,46,231,1,184,92,6098,1481,1105,833,  sum:26.709ms\r\nquantized-kn2row,73338,4649,10166,5326,8029,6875,6595,13503,2929,3711,3468,3696,3388,3400,6802,2894,9418,2262,8196,3844,7550,3779,10506,14443,490,3884,2133,115314,101021,115130,5557,  sum:562.296ms\r\nquantized_matrix_multiplication,58593,2388,7319,3158,5879,4793,5050,11292,1990,2967,2612,3251,2379,2934,4730,1347,8508,1859,7469,3424,6805,3305,9796,14138,413,3069,797,86078,83581,108092,4718,  sum:462.734ms\r\nquantized_ohwi_to_hwoi,16,1,10,8,2,8,2,8,2,10,9,2,2,2,3,1,29,4,23,6,29,10,23,53,49,1,0,2,5,20,1,  sum:0.341ms\r\n```\r\n\r\nI don't know why `input: -22.6264, expected: -22.6264` is fail, It looks same values...\r\n\r\n\r\n\r\nRun on FPGA.\r\n```\r\n$ root@DE10_NANO:~/lm_bisenet_camvid/export/save.ckpt-18350/352x480/output# ./models/lib/lm_fpga.elf ../inference_test_data/000_images_placeholder\\:0.npy ../inference_test_data/731_output\\:0.npy\r\n-------------------------------------------------------------\r\nComparison: Default network test  failed...\r\nFailed count: 29040\r\nFirst failed report\r\nindex: 0 / 29040\r\ninput: -7.08966, expected: -7.80849\r\n\r\n-------------------------------------------------------------\r\nAdd,2436,  sum:2.436ms\r\nAveragePool,7456,7367,6627,  sum:21.45ms\r\nBatchNorm,44120,2242,233,261,1394,68,26,  sum:48.344ms\r\nConvolution,61820,86,81,15997,  sum:77.984ms\r\nExtractImagePatches,20091,2061,557,587,561,326,26626,6741,5247,  sum:62.797ms\r\nMulDepthWise,2249,2175,2202,  sum:6.626ms\r\nPacking input for kn2row,21586,1349,596,1762,598,2042,595,2382,595,246,656,196,710,240,880,594,632,267,112,290,119,519,97,790,16,597,288,21544,5509,4128,3142,  sum:73.077ms\r\nQConv2D kn2row tiling,9363,1028,2008,1361,1961,1260,1963,3126,902,842,1059,803,1111,798,1907,959,3788,1273,4335,1633,4334,1994,4336,8108,6779,1007,965,29860,21581,17550,1584,  sum:139.578ms\r\nQTZ_linear_mid_tread_half,52166,354,2005,  sum:54.525ms\r\nQuantizedConv2D,10901,6917,7025,  sum:24.843ms\r\nQuantizedConv2D_ApplyScalingFactor,4113,35,3701,  sum:7.849ms\r\nReLu,1798,14,1772,4,5,  sum:3.593ms\r\nTotalInitTime,278156,  sum:278.156ms\r\nTotalRunTime,646152,  sum:646.152ms\r\nfunc_ConcatOnDepth,5201,6166,7087,2178,2334,2568,1343,1786,2237,4452,9140,  sum:44.492ms\r\nkn2row-1x1,61808,78,75,15990,  sum:77.951ms\r\nmatrix_multiplication,61795,69,68,15977,  sum:77.909ms\r\nmatrix_transpose (row_major),96,  sum:0.096ms\r\npack_input_to_qwords,21569,1332,582,1750,581,2030,583,2371,577,236,647,186,700,231,870,585,577,257,104,281,110,511,89,781,9,587,279,21530,5495,4116,3128,  sum:72.684ms\r\n```\r\n\r\nThe results are significant difference from expected. Need to fix.\r\n\r\n\r\nMore details are in https://github.com/blue-oil/blueoil/pull/225","closed_by":{"login":"iizukak","id":478824,"node_id":"MDQ6VXNlcjQ3ODgyNA==","avatar_url":"https://avatars.githubusercontent.com/u/478824?v=4","gravatar_id":"","url":"https://api.github.com/users/iizukak","html_url":"https://github.com/iizukak","followers_url":"https://api.github.com/users/iizukak/followers","following_url":"https://api.github.com/users/iizukak/following{/other_user}","gists_url":"https://api.github.com/users/iizukak/gists{/gist_id}","starred_url":"https://api.github.com/users/iizukak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iizukak/subscriptions","organizations_url":"https://api.github.com/users/iizukak/orgs","repos_url":"https://api.github.com/users/iizukak/repos","events_url":"https://api.github.com/users/iizukak/events{/privacy}","received_events_url":"https://api.github.com/users/iizukak/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/249/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/blue-oil/blueoil/issues/249/timeline","performed_via_github_app":null,"state_reason":"completed"}