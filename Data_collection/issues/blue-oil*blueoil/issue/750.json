{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/750","repository_url":"https://api.github.com/repos/blue-oil/blueoil","labels_url":"https://api.github.com/repos/blue-oil/blueoil/issues/750/labels{/name}","comments_url":"https://api.github.com/repos/blue-oil/blueoil/issues/750/comments","events_url":"https://api.github.com/repos/blue-oil/blueoil/issues/750/events","html_url":"https://github.com/blue-oil/blueoil/issues/750","id":554012279,"node_id":"MDU6SXNzdWU1NTQwMTIyNzk=","number":750,"title":"Docker image for CPU","user":{"login":"hadusam","id":12394960,"node_id":"MDQ6VXNlcjEyMzk0OTYw","avatar_url":"https://avatars.githubusercontent.com/u/12394960?v=4","gravatar_id":"","url":"https://api.github.com/users/hadusam","html_url":"https://github.com/hadusam","followers_url":"https://api.github.com/users/hadusam/followers","following_url":"https://api.github.com/users/hadusam/following{/other_user}","gists_url":"https://api.github.com/users/hadusam/gists{/gist_id}","starred_url":"https://api.github.com/users/hadusam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hadusam/subscriptions","organizations_url":"https://api.github.com/users/hadusam/orgs","repos_url":"https://api.github.com/users/hadusam/repos","events_url":"https://api.github.com/users/hadusam/events{/privacy}","received_events_url":"https://api.github.com/users/hadusam/received_events","type":"User","site_admin":false},"labels":[{"id":1095590113,"node_id":"MDU6TGFiZWwxMDk1NTkwMTEz","url":"https://api.github.com/repos/blue-oil/blueoil/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"}],"state":"open","locked":true,"assignee":{"login":"hadusam","id":12394960,"node_id":"MDQ6VXNlcjEyMzk0OTYw","avatar_url":"https://avatars.githubusercontent.com/u/12394960?v=4","gravatar_id":"","url":"https://api.github.com/users/hadusam","html_url":"https://github.com/hadusam","followers_url":"https://api.github.com/users/hadusam/followers","following_url":"https://api.github.com/users/hadusam/following{/other_user}","gists_url":"https://api.github.com/users/hadusam/gists{/gist_id}","starred_url":"https://api.github.com/users/hadusam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hadusam/subscriptions","organizations_url":"https://api.github.com/users/hadusam/orgs","repos_url":"https://api.github.com/users/hadusam/repos","events_url":"https://api.github.com/users/hadusam/events{/privacy}","received_events_url":"https://api.github.com/users/hadusam/received_events","type":"User","site_admin":false},"assignees":[{"login":"hadusam","id":12394960,"node_id":"MDQ6VXNlcjEyMzk0OTYw","avatar_url":"https://avatars.githubusercontent.com/u/12394960?v=4","gravatar_id":"","url":"https://api.github.com/users/hadusam","html_url":"https://github.com/hadusam","followers_url":"https://api.github.com/users/hadusam/followers","following_url":"https://api.github.com/users/hadusam/following{/other_user}","gists_url":"https://api.github.com/users/hadusam/gists{/gist_id}","starred_url":"https://api.github.com/users/hadusam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hadusam/subscriptions","organizations_url":"https://api.github.com/users/hadusam/orgs","repos_url":"https://api.github.com/users/hadusam/repos","events_url":"https://api.github.com/users/hadusam/events{/privacy}","received_events_url":"https://api.github.com/users/hadusam/received_events","type":"User","site_admin":false},{"login":"tk26eng","id":35796618,"node_id":"MDQ6VXNlcjM1Nzk2NjE4","avatar_url":"https://avatars.githubusercontent.com/u/35796618?v=4","gravatar_id":"","url":"https://api.github.com/users/tk26eng","html_url":"https://github.com/tk26eng","followers_url":"https://api.github.com/users/tk26eng/followers","following_url":"https://api.github.com/users/tk26eng/following{/other_user}","gists_url":"https://api.github.com/users/tk26eng/gists{/gist_id}","starred_url":"https://api.github.com/users/tk26eng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tk26eng/subscriptions","organizations_url":"https://api.github.com/users/tk26eng/orgs","repos_url":"https://api.github.com/users/tk26eng/repos","events_url":"https://api.github.com/users/tk26eng/events{/privacy}","received_events_url":"https://api.github.com/users/tk26eng/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2020-01-23T08:34:18Z","updated_at":"2020-06-17T04:10:59Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"## Introduction\r\nWe don't really need GPU for `convert` part, but the current docker image provided by us needs GPU driver to run.\r\nI think it is better to provide a docker image for CPU.\r\n\r\n## What is preventing this?\r\nIf we run `convert` with tensorflow-cpu, following error occurred.\r\n```\r\nself = <tensorflow.python.client.session.Session object at 0x7f26eaf44d30>\r\nfn = <function BaseSession._do_run.<locals>._run_fn at 0x7f26f408abf8>\r\nargs = ({<tensorflow.python.pywrap_tensorflow_internal.TF_Output; proxy of <Swig Object of type 'TF_Output *' at 0x7f26ef166c...ywrap_tensorflow_internal.TF_Output; proxy of <Swig Object of type 'TF_Output *' at 0x7f26ef00be10> >], [], None, None)\r\nmessage = \"Node 'conv1/BatchNorm/FusedBatchNormV3' (type: '_FusedConv2D', num of outputs: 1) does not have output 1\"\r\nm = None\r\n\r\n    def _do_call(self, fn, *args):\r\n      try:\r\n        return fn(*args)\r\n      except errors.OpError as e:\r\n        message = compat.as_text(e.message)\r\n        m = BaseSession._NODEDEF_NAME_RE.search(message)\r\n        node_def = None\r\n        op = None\r\n        if m is not None:\r\n          node_name = m.group(3)\r\n          try:\r\n            op = self._graph.get_operation_by_name(node_name)\r\n            node_def = op.node_def\r\n          except KeyError:\r\n            pass\r\n        message = error_interpolation.interpolate(message, self._graph)\r\n        if 'only supports NHWC tensor format' in message:\r\n          message += ('\\nA possible workaround: Try disabling Grappler optimizer'\r\n                      '\\nby modifying the config for creating the session eg.'\r\n                      '\\nsession_config.graph_options.rewrite_options.'\r\n                      'disable_meta_optimizer = True')\r\n>       raise type(e)(node_def, op, message)\r\nE       tensorflow.python.framework.errors_impl.OutOfRangeError: Node 'conv1/BatchNorm/FusedBatchNormV3' (type: '_FusedConv2D', num of outputs: 1) does not have output 1\r\n\r\n/usr/local/pyenv/versions/3.6.3/envs/python3.6/lib/python3.6/site-packages/tensorflow_core/python/client/session.py:1384: OutOfRangeError\r\n```\r\nThe details of this error can see #106 .\r\nThis error happened in `lmnet/export` and this feature is for debugging and testing. \r\nhttps://github.com/blue-oil/blueoil/blob/4ad07e2ea85b005188f1fa0db1cc1d0daefcc1d1/lmnet/executor/export.py#L112-L137\r\n\r\nAccording to comments, this is for the test or debug. So, we can avoid this error and provide CPU version, I think.\r\nTo avoid this error, we already treat this as using flag(save_npy_for_debug)\r\nhttps://github.com/blue-oil/blueoil/blob/4ad07e2ea85b005188f1fa0db1cc1d0daefcc1d1/blueoil/cmd/convert.py#L160-L164\r\n\r\nSo it's easy to change the default value of `save_npy_for_debug` to `False`.\r\nhttps://github.com/blue-oil/blueoil/blob/4ad07e2ea85b005188f1fa0db1cc1d0daefcc1d1/blueoil/cmd/convert.py#L209\r\n\r\n## Tasks\r\nIf the above change is approved, I will do tasks as following\r\n\r\n- [ ] Change the default value of `save_npy_for_debug` to `False` and enable to change this via CLI option\r\n- [ ] Create Dockerfile for CPU and replace docker image for tests (run all tests on this image)\r\n- [ ] Add test for Dockerfile for GPU (run e2e test once)\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/750/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/blue-oil/blueoil/issues/750/timeline","performed_via_github_app":null,"state_reason":null}