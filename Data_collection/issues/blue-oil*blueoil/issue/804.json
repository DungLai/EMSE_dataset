{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/804","repository_url":"https://api.github.com/repos/blue-oil/blueoil","labels_url":"https://api.github.com/repos/blue-oil/blueoil/issues/804/labels{/name}","comments_url":"https://api.github.com/repos/blue-oil/blueoil/issues/804/comments","events_url":"https://api.github.com/repos/blue-oil/blueoil/issues/804/events","html_url":"https://github.com/blue-oil/blueoil/issues/804","id":561480072,"node_id":"MDU6SXNzdWU1NjE0ODAwNzI=","number":804,"title":"The time measurement results are different between run.py and lm_*.elf","user":{"login":"hadusam","id":12394960,"node_id":"MDQ6VXNlcjEyMzk0OTYw","avatar_url":"https://avatars.githubusercontent.com/u/12394960?v=4","gravatar_id":"","url":"https://api.github.com/users/hadusam","html_url":"https://github.com/hadusam","followers_url":"https://api.github.com/users/hadusam/followers","following_url":"https://api.github.com/users/hadusam/following{/other_user}","gists_url":"https://api.github.com/users/hadusam/gists{/gist_id}","starred_url":"https://api.github.com/users/hadusam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hadusam/subscriptions","organizations_url":"https://api.github.com/users/hadusam/orgs","repos_url":"https://api.github.com/users/hadusam/repos","events_url":"https://api.github.com/users/hadusam/events{/privacy}","received_events_url":"https://api.github.com/users/hadusam/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":{"login":"hadusam","id":12394960,"node_id":"MDQ6VXNlcjEyMzk0OTYw","avatar_url":"https://avatars.githubusercontent.com/u/12394960?v=4","gravatar_id":"","url":"https://api.github.com/users/hadusam","html_url":"https://github.com/hadusam","followers_url":"https://api.github.com/users/hadusam/followers","following_url":"https://api.github.com/users/hadusam/following{/other_user}","gists_url":"https://api.github.com/users/hadusam/gists{/gist_id}","starred_url":"https://api.github.com/users/hadusam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hadusam/subscriptions","organizations_url":"https://api.github.com/users/hadusam/orgs","repos_url":"https://api.github.com/users/hadusam/repos","events_url":"https://api.github.com/users/hadusam/events{/privacy}","received_events_url":"https://api.github.com/users/hadusam/received_events","type":"User","site_admin":false},"assignees":[{"login":"hadusam","id":12394960,"node_id":"MDQ6VXNlcjEyMzk0OTYw","avatar_url":"https://avatars.githubusercontent.com/u/12394960?v=4","gravatar_id":"","url":"https://api.github.com/users/hadusam","html_url":"https://github.com/hadusam","followers_url":"https://api.github.com/users/hadusam/followers","following_url":"https://api.github.com/users/hadusam/following{/other_user}","gists_url":"https://api.github.com/users/hadusam/gists{/gist_id}","starred_url":"https://api.github.com/users/hadusam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hadusam/subscriptions","organizations_url":"https://api.github.com/users/hadusam/orgs","repos_url":"https://api.github.com/users/hadusam/repos","events_url":"https://api.github.com/users/hadusam/events{/privacy}","received_events_url":"https://api.github.com/users/hadusam/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2020-02-07T08:00:03Z","updated_at":"2020-02-13T01:26:07Z","closed_at":"2020-02-13T01:26:07Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"After #803, we can reduce the difference, but there are still gaps between `run.py` and `lm_*elf`.\r\nWe need to discuss and investigate this issue. ðŸ¤” \r\n\r\n## Test case\r\n* Network: `LmnetV1Quantize`\r\n\r\n## Run with FPGA on DE10-Nano\r\n* run.py's inference: 16ms\r\n* elf results: 9ms\r\n```\r\nroot@blueoil-de10nano-04:~/masu_test/argo/export/save.ckpt-156250/32x32/output/python# python run.py --trial 1 -i ../../inference_test_data/raw_image.png -c ../models/meta.yaml -m ../models/lib/lib_fpga.so\r\n...\r\nINFO:__main__:Benchmark avg result(sec) for 1 trials: pre_process: 0.007635  inference: 0.016171 post_process: 0.016254  Total: 0.04006\r\nroot@blueoil-de10nano-04:~/masu_test/argo/export/save.ckpt-156250/32x32/output/python# head output/output.json {\r\n    \"benchmark\": {\r\n        \"inference\": 0.016170999999999935, \r\n        \"post\": 0.01625399999999999, \r\n        \"pre\": 0.007635000000000058, \r\n        \"total\": 0.040059999999999985\r\n    }, \r\n    \"classes\": [\r\n        {\r\n            \"id\": 0, \r\nroot@blueoil-de10nano-04:~/masu_test/argo/export/save.ckpt-156250/32x32/output/python# ../models/lib/lm_fpga.elf ../../inference_test_data/000_images_placeholder\\:0.npy ../../inference_test_data/133_output\\:0.npy \r\n-------------------------------------------------------------\r\nComparison: Default network test  succeeded!!!\r\n-------------------------------------------------------------\r\nTotalInitTime 3068,  sum:3.068ms\r\nTotalRunTime 9425,  sum:9.425ms\r\n...\r\n```\r\n\r\n\r\n## Run without FPGA on DE10-Nano\r\n* run.py's inference: 36ms\r\n* elf results: 19ms\r\n```\r\nroot@blueoil-de10nano-04:~/masu_test/argo/export/save.ckpt-156250/32x32/output/python# python run.py --trial 1 -i ../../inference_test_data/raw_image.png -c ../models/meta.yaml -m ../models/lib/lib_arm.so\r\n...\r\nINFO:__main__:Benchmark avg result(sec) for 1 trials: pre_process: 0.007937  inference: 0.036363 post_process: 0.017636  Total: 0.061936\r\nroot@blueoil-de10nano-04:~/masu_test/argo/export/save.ckpt-156250/32x32/output/python# head output/output.json \r\n{\r\n    \"benchmark\": {\r\n        \"inference\": 0.036363000000000034, \r\n        \"post\": 0.017635999999999985, \r\n        \"pre\": 0.007936999999999972, \r\n        \"total\": 0.06193599999999999\r\n    }, \r\n    \"classes\": [\r\n        {\r\n            \"id\": 0, \r\n\r\nroot@blueoil-de10nano-04:~/masu_test/argo/export/save.ckpt-156250/32x32/output/python# ../models/lib/lm_arm.elf ../../inference_test_data/000_images_placeholder\\:0.npy \r\n../../inference_test_data/133_output\\:0.npy \r\n-------------------------------------------------------------\r\nComparison: Default network test  succeeded!!!\r\n-------------------------------------------------------------\r\nTotalInitTime 1026,  sum:1.026ms\r\nTotalRunTime 19264,  sum:19.264ms\r\n...\r\n```\r\n","closed_by":{"login":"hadusam","id":12394960,"node_id":"MDQ6VXNlcjEyMzk0OTYw","avatar_url":"https://avatars.githubusercontent.com/u/12394960?v=4","gravatar_id":"","url":"https://api.github.com/users/hadusam","html_url":"https://github.com/hadusam","followers_url":"https://api.github.com/users/hadusam/followers","following_url":"https://api.github.com/users/hadusam/following{/other_user}","gists_url":"https://api.github.com/users/hadusam/gists{/gist_id}","starred_url":"https://api.github.com/users/hadusam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hadusam/subscriptions","organizations_url":"https://api.github.com/users/hadusam/orgs","repos_url":"https://api.github.com/users/hadusam/repos","events_url":"https://api.github.com/users/hadusam/events{/privacy}","received_events_url":"https://api.github.com/users/hadusam/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/804/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/blue-oil/blueoil/issues/804/timeline","performed_via_github_app":null,"state_reason":"completed"}