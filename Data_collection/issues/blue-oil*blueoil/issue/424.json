{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/424","repository_url":"https://api.github.com/repos/blue-oil/blueoil","labels_url":"https://api.github.com/repos/blue-oil/blueoil/issues/424/labels{/name}","comments_url":"https://api.github.com/repos/blue-oil/blueoil/issues/424/comments","events_url":"https://api.github.com/repos/blue-oil/blueoil/issues/424/events","html_url":"https://github.com/blue-oil/blueoil/issues/424","id":493229171,"node_id":"MDU6SXNzdWU0OTMyMjkxNzE=","number":424,"title":"Convert failed when GPU driver version is not 410.104.0","user":{"login":"hadusam","id":12394960,"node_id":"MDQ6VXNlcjEyMzk0OTYw","avatar_url":"https://avatars.githubusercontent.com/u/12394960?v=4","gravatar_id":"","url":"https://api.github.com/users/hadusam","html_url":"https://github.com/hadusam","followers_url":"https://api.github.com/users/hadusam/followers","following_url":"https://api.github.com/users/hadusam/following{/other_user}","gists_url":"https://api.github.com/users/hadusam/gists{/gist_id}","starred_url":"https://api.github.com/users/hadusam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hadusam/subscriptions","organizations_url":"https://api.github.com/users/hadusam/orgs","repos_url":"https://api.github.com/users/hadusam/repos","events_url":"https://api.github.com/users/hadusam/events{/privacy}","received_events_url":"https://api.github.com/users/hadusam/received_events","type":"User","site_admin":false},"labels":[{"id":1095590109,"node_id":"MDU6TGFiZWwxMDk1NTkwMTA5","url":"https://api.github.com/repos/blue-oil/blueoil/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":true,"assignee":{"login":"hadusam","id":12394960,"node_id":"MDQ6VXNlcjEyMzk0OTYw","avatar_url":"https://avatars.githubusercontent.com/u/12394960?v=4","gravatar_id":"","url":"https://api.github.com/users/hadusam","html_url":"https://github.com/hadusam","followers_url":"https://api.github.com/users/hadusam/followers","following_url":"https://api.github.com/users/hadusam/following{/other_user}","gists_url":"https://api.github.com/users/hadusam/gists{/gist_id}","starred_url":"https://api.github.com/users/hadusam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hadusam/subscriptions","organizations_url":"https://api.github.com/users/hadusam/orgs","repos_url":"https://api.github.com/users/hadusam/repos","events_url":"https://api.github.com/users/hadusam/events{/privacy}","received_events_url":"https://api.github.com/users/hadusam/received_events","type":"User","site_admin":false},"assignees":[{"login":"hadusam","id":12394960,"node_id":"MDQ6VXNlcjEyMzk0OTYw","avatar_url":"https://avatars.githubusercontent.com/u/12394960?v=4","gravatar_id":"","url":"https://api.github.com/users/hadusam","html_url":"https://github.com/hadusam","followers_url":"https://api.github.com/users/hadusam/followers","following_url":"https://api.github.com/users/hadusam/following{/other_user}","gists_url":"https://api.github.com/users/hadusam/gists{/gist_id}","starred_url":"https://api.github.com/users/hadusam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hadusam/subscriptions","organizations_url":"https://api.github.com/users/hadusam/orgs","repos_url":"https://api.github.com/users/hadusam/repos","events_url":"https://api.github.com/users/hadusam/events{/privacy}","received_events_url":"https://api.github.com/users/hadusam/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2019-09-13T09:36:46Z","updated_at":"2019-09-18T01:12:07Z","closed_at":"2019-09-18T01:12:07Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"## Error logs\r\nThe log of `make test`.\r\n```\r\n# Run Blueoil test of classification\r\nCUDA_VISIBLE_DEVICES=0 bash ./blueoil_test.sh  --task classification\r\nCreating directory for test: ./tmp/tests/20190913175132\r\n\r\n# Basic tests\r\n## Test of caltech101_classification\r\n### ./blueoil.sh init\r\n### ls config/created_by_test_script_caltech101_classification.yml\r\nOK!\r\n### diff ./tmp/tests/20190913175132/created_by_test_script_caltech101_classification.yml ./tests/config/caltech101_classification.yml\r\nOK!\r\n### ./blueoil.sh train ./tmp/tests/20190913175132/created_by_test_script_caltech101_classification.yml\r\nOK!\r\n### ./blueoil.sh convert ./tmp/tests/20190913175132/created_by_test_script_caltech101_classification.yml ./saved/created_by_test_script_caltech101_classification_20190913175136\r\n##############################\r\nERROR result is 1 (expect 0)\r\n##############################\r\n#################################################\r\nErorr log : ./tmp/tests/20190913175132/test_3.log\r\n#################################################\r\n### ./blueoil.sh convert ./tmp/tests/20190913175132/created_by_test_script_caltech101_classification.yml ./saved/created_by_test_script_caltech101_classification_20190913175136\r\n#### Generate output files ####\r\n\r\nWARNING: The TensorFlow contrib module will not be included in TensorFlow 2.0.\r\nFor more information, please see:\r\n  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md\r\n  * https://github.com/tensorflow/addons\r\nIf you depend on functionality not listed there, please file an issue.\r\n\r\nWARNING:tensorflow:From /usr/local/pyenv/versions/python3.6/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py:263: colocate_with (from tensorflow.python.framework.ops) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nColocations handled automatically by placer.\r\n----------------- config value --------------------\r\n{'BATCH_SIZE': 1,\r\n 'CLASSES': ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'],\r\n 'DATASET': {'AUGMENTOR': [Blur({'min_value': 0, 'max_value': 1})],\r\n             'BATCH_SIZE': 1,\r\n             'DATA_FORMAT': 'NHWC',\r\n             'PRE_PROCESSOR': [Resize({'size': [128, 128]}), DivideBy255({})]},\r\n 'DATASET_CLASS': <class 'abc.DATASET_CLASS'>,\r\n 'DATA_FORMAT': 'NHWC',\r\n 'IMAGE_SIZE': [128, 128],\r\n 'IS_DEBUG': False,\r\n 'IS_PRETRAIN': False,\r\n 'KEEP_CHECKPOINT_MAX': 5,\r\n 'MAX_EPOCHS': 1,\r\n 'NETWORK': {'ACTIVATION_QUANTIZER': <function linear_mid_tread_half_quantizer at 0x7f17f9b148c8>,\r\n             'ACTIVATION_QUANTIZER_KWARGS': {'bit': 2, 'max_value': 2},\r\n             'BATCH_SIZE': 1,\r\n             'DATA_FORMAT': 'NHWC',\r\n             'IMAGE_SIZE': [128, 128],\r\n             'LEARNING_RATE_FUNC': None,\r\n             'LEARNING_RATE_KWARGS': None,\r\n             'OPTIMIZER_CLASS': <class 'tensorflow.python.training.adam.AdamOptimizer'>,\r\n             'OPTIMIZER_KWARGS': {'learning_rate': 0.001},\r\n             'WEIGHT_DECAY_RATE': 0.0005,\r\n             'WEIGHT_QUANTIZER': <function binary_mean_scaling_quantizer at 0x7f17f9b149d8>,\r\n             'WEIGHT_QUANTIZER_KWARGS': {}},\r\n 'NETWORK_CLASS': <class 'lmnet.networks.classification.lmnet_v1.LmnetV1Quantize'>,\r\n 'POST_PROCESSOR': None,\r\n 'PRETRAIN_DIR': '',\r\n 'PRETRAIN_FILE': '',\r\n 'PRETRAIN_VARS': [],\r\n 'PRE_PROCESSOR': [Resize({'size': [128, 128]}), DivideBy255({})],\r\n 'SAVE_CHECKPOINT_STEPS': 1000,\r\n 'SUMMARISE_STEPS': 100,\r\n 'TASK': <Tasks.CLASSIFICATION: 'IMAGE.CLASSIFICATION'>,\r\n 'TEST_STEPS': 1000}\r\n----------------- config value --------------------\r\nRestore from /home/blueoil/saved/created_by_test_script_caltech101_classification_20190913175136/checkpoints/save.ckpt-27\r\nWARNING:tensorflow:From /home/blueoil/lmnet/lmnet/blocks.py:92: conv2d (from tensorflow.python.layers.convolutional) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nUse keras.layers.conv2d instead.\r\nWARNING:tensorflow:From /usr/local/pyenv/versions/python3.6/lib/python3.6/site-packages/tensorflow/python/framework/function.py:1007: calling Graph.create_op (from tensorflow.python.framework.ops) with compute_shapes is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nShapes are always computed; don't use the compute_shapes as it has no effect.\r\nWARNING:tensorflow:From /home/blueoil/lmnet/lmnet/networks/classification/lmnet_v1.py:86: dropout (from tensorflow.python.layers.core) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nUse keras.layers.dropout instead.\r\nWARNING:tensorflow:From /home/blueoil/lmnet/lmnet/networks/classification/lmnet_v1.py:107: average_pooling2d (from tensorflow.python.layers.pooling) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nUse keras.layers.average_pooling2d instead.\r\n2019-09-13 08:52:06.740570: E tensorflow/stream_executor/cuda/cuda_driver.cc:300] failed call to cuInit: CUDA_ERROR_SYSTEM_DRIVER_MISMATCH: system has unsupported display driver / cuda driver combination\r\n2019-09-13 08:52:06.740860: E tensorflow/stream_executor/cuda/cuda_diagnostics.cc:306] kernel version 418.67.0 does not match DSO version 410.104.0 -- cannot find working devices in this configuration\r\nWARNING:tensorflow:From /usr/local/pyenv/versions/python3.6/lib/python3.6/site-packages/tensorflow/python/training/saver.py:1266: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nUse standard file APIs to check for files with this prefix.\r\nWARNING:tensorflow:From /home/blueoil/lmnet/lmnet/utils/executor.py:94: convert_variables_to_constants (from tensorflow.python.framework.graph_util_impl) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nUse tf.compat.v1.graph_util.convert_variables_to_constants\r\nWARNING:tensorflow:From /usr/local/pyenv/versions/python3.6/lib/python3.6/site-packages/tensorflow/python/framework/graph_util_impl.py:245: extract_sub_graph (from tensorflow.python.framework.graph_util_impl) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nUse tf.compat.v1.graph_util.extract_sub_graph\r\nTraceback (most recent call last):\r\n  File \"/usr/local/pyenv/versions/python3.6/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1334, in _do_call\r\n    return fn(*args)\r\n  File \"/usr/local/pyenv/versions/python3.6/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1319, in _run_fn\r\n    options, feed_dict, fetch_list, target_list, run_metadata)\r\n  File \"/usr/local/pyenv/versions/python3.6/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1407, in _call_tf_sessionrun\r\n    run_metadata)\r\ntensorflow.python.framework.errors_impl.OutOfRangeError: Node 'conv1/BatchNorm/FusedBatchNorm' (type: '_FusedConv2D', num of outputs: 1) does not have output 1\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"blueoil/blueoil_convert.py\", line 173, in <module>\r\n    main()\r\n  File \"/usr/local/pyenv/versions/python3.6/lib/python3.6/site-packages/click/core.py\", line 722, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/usr/local/pyenv/versions/python3.6/lib/python3.6/site-packages/click/core.py\", line 697, in main\r\n    rv = self.invoke(ctx)\r\n  File \"/usr/local/pyenv/versions/python3.6/lib/python3.6/site-packages/click/core.py\", line 895, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"/usr/local/pyenv/versions/python3.6/lib/python3.6/site-packages/click/core.py\", line 535, in invoke\r\n    return callback(*args, **kwargs)\r\n  File \"blueoil/blueoil_convert.py\", line 169, in main\r\n    run(experiment_id, restore_path)\r\n  File \"blueoil/blueoil_convert.py\", line 118, in run\r\n    export_dir = run_export(experiment_id, restore_path=restore_path)\r\n  File \"/home/blueoil/lmnet/executor/export.py\", line 199, in run\r\n    return _export(config, restore_path, image)\r\n  File \"/home/blueoil/lmnet/executor/export.py\", line 138, in _export\r\n    val = sess.run(op_output.name, feed_dict=feed_dict)\r\n  File \"/usr/local/pyenv/versions/python3.6/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 929, in run\r\n    run_metadata_ptr)\r\n  File \"/usr/local/pyenv/versions/python3.6/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1152, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"/usr/local/pyenv/versions/python3.6/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1328, in _do_run\r\n    run_metadata)\r\n  File \"/usr/local/pyenv/versions/python3.6/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1348, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.OutOfRangeError: Node 'conv1/BatchNorm/FusedBatchNorm' (type: '_FusedConv2D', num of outputs: 1) does not have output 1\r\nERROR: Failed to generate output files\r\n\r\nMove files created by tests to ./tmp/tests/20190913175132\r\nIf you want to clean up files created by tests, you can run 'rm -rf ./tmp/tests/20190913175132'\r\nMakefile:22: recipe for target 'test-classification' failed\r\nmake: *** [test-classification] Interrupt\r\n```\r\n\r\nThis error causes when tensorflow is CPU mode, related #106 \r\nI checked and found the tensorflow on our docker image is not able to use GPU correctly.\r\n```\r\n2019-09-13 09:18:21.430386: E tensorflow/stream_executor/cuda/cuda_driver.cc:300] failed call to cuInit: CUDA_ERROR_UNKNOWN: unknown error\r\n2019-09-13 09:18:21.430567: E tensorflow/stream_executor/cuda/cuda_diagnostics.cc:306] kernel version 410.104.0 does not match DSO version 410.48.0 -- cannot find working devices in this configuration\r\n```\r\n\r\n## Why it occurred?\r\nThis is caused by the following line:\r\nhttps://github.com/blue-oil/blueoil/blob/master/docker/Dockerfile#L126\r\n\r\nWe should not manage cuda driver paths and should entrust them to nvidia-runtime.\r\nI will fix it. ","closed_by":{"login":"iizukak","id":478824,"node_id":"MDQ6VXNlcjQ3ODgyNA==","avatar_url":"https://avatars.githubusercontent.com/u/478824?v=4","gravatar_id":"","url":"https://api.github.com/users/iizukak","html_url":"https://github.com/iizukak","followers_url":"https://api.github.com/users/iizukak/followers","following_url":"https://api.github.com/users/iizukak/following{/other_user}","gists_url":"https://api.github.com/users/iizukak/gists{/gist_id}","starred_url":"https://api.github.com/users/iizukak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iizukak/subscriptions","organizations_url":"https://api.github.com/users/iizukak/orgs","repos_url":"https://api.github.com/users/iizukak/repos","events_url":"https://api.github.com/users/iizukak/events{/privacy}","received_events_url":"https://api.github.com/users/iizukak/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/blue-oil/blueoil/issues/424/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/blue-oil/blueoil/issues/424/timeline","performed_via_github_app":null,"state_reason":"completed"}