[{"url":"https://api.github.com/repos/salesforce/decaNLP/issues/comments/615017512","html_url":"https://github.com/salesforce/decaNLP/issues/51#issuecomment-615017512","issue_url":"https://api.github.com/repos/salesforce/decaNLP/issues/51","id":615017512,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNTAxNzUxMg==","user":{"login":"hot-cheeto","id":20938653,"node_id":"MDQ6VXNlcjIwOTM4NjUz","avatar_url":"https://avatars.githubusercontent.com/u/20938653?v=4","gravatar_id":"","url":"https://api.github.com/users/hot-cheeto","html_url":"https://github.com/hot-cheeto","followers_url":"https://api.github.com/users/hot-cheeto/followers","following_url":"https://api.github.com/users/hot-cheeto/following{/other_user}","gists_url":"https://api.github.com/users/hot-cheeto/gists{/gist_id}","starred_url":"https://api.github.com/users/hot-cheeto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hot-cheeto/subscriptions","organizations_url":"https://api.github.com/users/hot-cheeto/orgs","repos_url":"https://api.github.com/users/hot-cheeto/repos","events_url":"https://api.github.com/users/hot-cheeto/events{/privacy}","received_events_url":"https://api.github.com/users/hot-cheeto/received_events","type":"User","site_admin":false},"created_at":"2020-04-17T03:27:22Z","updated_at":"2020-04-17T03:27:22Z","author_association":"NONE","body":"Hello, \r\nI am having issues with fine-tuning the pretrained model mqan_decanlp_better_sampling_cove_cpu. I give the following command :\r\n\r\npython train.py --name test_run --load /path/to/mqan_decanlp_better_sampling_cove_cpu/iteration_560000.pth --resume --device 0 --cove --train_tasks new_task\r\n\r\nput I received the following error message: ValueError: loaded state dict contains a parameter group that doesn't match the size of optimizer's group\r\n\r\nI have double check the parameters in config.json in mqan_decanlp_better_sampling_cove_cpu.\r\n\r\nWhat could be the problem ? Am I missing something ?\r\n\r\nThank you in advance !","reactions":{"url":"https://api.github.com/repos/salesforce/decaNLP/issues/comments/615017512/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"hot-cheeto","id":20938653,"node_id":"MDQ6VXNlcjIwOTM4NjUz","avatar_url":"https://avatars.githubusercontent.com/u/20938653?v=4","gravatar_id":"","url":"https://api.github.com/users/hot-cheeto","html_url":"https://github.com/hot-cheeto","followers_url":"https://api.github.com/users/hot-cheeto/followers","following_url":"https://api.github.com/users/hot-cheeto/following{/other_user}","gists_url":"https://api.github.com/users/hot-cheeto/gists{/gist_id}","starred_url":"https://api.github.com/users/hot-cheeto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hot-cheeto/subscriptions","organizations_url":"https://api.github.com/users/hot-cheeto/orgs","repos_url":"https://api.github.com/users/hot-cheeto/repos","events_url":"https://api.github.com/users/hot-cheeto/events{/privacy}","received_events_url":"https://api.github.com/users/hot-cheeto/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/salesforce/decaNLP/issues/comments/743777221","html_url":"https://github.com/salesforce/decaNLP/issues/51#issuecomment-743777221","issue_url":"https://api.github.com/repos/salesforce/decaNLP/issues/51","id":743777221,"node_id":"MDEyOklzc3VlQ29tbWVudDc0Mzc3NzIyMQ==","user":{"login":"diarmidmackenzie","id":16045703,"node_id":"MDQ6VXNlcjE2MDQ1NzAz","avatar_url":"https://avatars.githubusercontent.com/u/16045703?v=4","gravatar_id":"","url":"https://api.github.com/users/diarmidmackenzie","html_url":"https://github.com/diarmidmackenzie","followers_url":"https://api.github.com/users/diarmidmackenzie/followers","following_url":"https://api.github.com/users/diarmidmackenzie/following{/other_user}","gists_url":"https://api.github.com/users/diarmidmackenzie/gists{/gist_id}","starred_url":"https://api.github.com/users/diarmidmackenzie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diarmidmackenzie/subscriptions","organizations_url":"https://api.github.com/users/diarmidmackenzie/orgs","repos_url":"https://api.github.com/users/diarmidmackenzie/repos","events_url":"https://api.github.com/users/diarmidmackenzie/events{/privacy}","received_events_url":"https://api.github.com/users/diarmidmackenzie/received_events","type":"User","site_admin":false},"created_at":"2020-12-12T16:05:20Z","updated_at":"2020-12-12T16:05:20Z","author_association":"NONE","body":"These queries are quite old, but I've been hitting the same problems.  Posting some answers in case they might be useful for others.  \r\n\r\n@ashleyyy94 Looks like you were running without the --cove parameter.  The pretrained model you were trying to use had used cove, so you need to also use cove to continue training.\r\n\r\n@hot-cheeto I have been hitting this problem too.  I don't fully understand it, but it seems to be possible to work around this by dropping the \"resume\" parameter.\r\n\r\nThe issue seems to be that the stored state for the optimizer has a mismatching number of parameters.\r\n\r\nIt has 153 parameters.\r\n\r\n```\r\n>>> import torch\r\n>>> a = torch.load(\"/decaNLP/results/checkpoints/iteration_560000_rank_0_optim.pth\", map_location='cpu')\r\n>>> len(a['param_groups'][0]['params'])\r\n153\r\n```\r\n\r\nWhereas if I start training with the same parameters as you, the optimizer state only has 137 parameters (16 fewer).\r\n\r\n```\r\n>>> b = torch.load(\"/decaNLP/diarmid_learning/1/iteration_1000_rank_0_optim.pth\", map_location='cpu')\r\n>>> len(b['param_groups'][0]['params'])\r\n137\r\n```\r\n\r\nI have not yet understood what accounts for these extra 16 optimizer parameters.  So I have no idea how to correct for them.  But I believe it is reasonable to discard the optimizer state and continue training from the model state, and seem to have got some reasonable results doing so.\r\n\r\nYou can do that by dropping the --resume parameter.\r\n\r\nOnce you have a learning checkpoint that you have generated yourself, you can then continue from this checkpoint using the --resume parameter.","reactions":{"url":"https://api.github.com/repos/salesforce/decaNLP/issues/comments/743777221/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"diarmidmackenzie","id":16045703,"node_id":"MDQ6VXNlcjE2MDQ1NzAz","avatar_url":"https://avatars.githubusercontent.com/u/16045703?v=4","gravatar_id":"","url":"https://api.github.com/users/diarmidmackenzie","html_url":"https://github.com/diarmidmackenzie","followers_url":"https://api.github.com/users/diarmidmackenzie/followers","following_url":"https://api.github.com/users/diarmidmackenzie/following{/other_user}","gists_url":"https://api.github.com/users/diarmidmackenzie/gists{/gist_id}","starred_url":"https://api.github.com/users/diarmidmackenzie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diarmidmackenzie/subscriptions","organizations_url":"https://api.github.com/users/diarmidmackenzie/orgs","repos_url":"https://api.github.com/users/diarmidmackenzie/repos","events_url":"https://api.github.com/users/diarmidmackenzie/events{/privacy}","received_events_url":"https://api.github.com/users/diarmidmackenzie/received_events","type":"User","site_admin":false}},{"id":4104427585,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDEwNDQyNzU4NQ==","url":"https://api.github.com/repos/salesforce/decaNLP/issues/events/4104427585","actor":{"login":"ashleyyy94","id":20836965,"node_id":"MDQ6VXNlcjIwODM2OTY1","avatar_url":"https://avatars.githubusercontent.com/u/20836965?v=4","gravatar_id":"","url":"https://api.github.com/users/ashleyyy94","html_url":"https://github.com/ashleyyy94","followers_url":"https://api.github.com/users/ashleyyy94/followers","following_url":"https://api.github.com/users/ashleyyy94/following{/other_user}","gists_url":"https://api.github.com/users/ashleyyy94/gists{/gist_id}","starred_url":"https://api.github.com/users/ashleyyy94/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ashleyyy94/subscriptions","organizations_url":"https://api.github.com/users/ashleyyy94/orgs","repos_url":"https://api.github.com/users/ashleyyy94/repos","events_url":"https://api.github.com/users/ashleyyy94/events{/privacy}","received_events_url":"https://api.github.com/users/ashleyyy94/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-12-12T16:05:20Z","performed_via_github_app":null},{"id":4104427589,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQxMDQ0Mjc1ODk=","url":"https://api.github.com/repos/salesforce/decaNLP/issues/events/4104427589","actor":{"login":"ashleyyy94","id":20836965,"node_id":"MDQ6VXNlcjIwODM2OTY1","avatar_url":"https://avatars.githubusercontent.com/u/20836965?v=4","gravatar_id":"","url":"https://api.github.com/users/ashleyyy94","html_url":"https://github.com/ashleyyy94","followers_url":"https://api.github.com/users/ashleyyy94/followers","following_url":"https://api.github.com/users/ashleyyy94/following{/other_user}","gists_url":"https://api.github.com/users/ashleyyy94/gists{/gist_id}","starred_url":"https://api.github.com/users/ashleyyy94/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ashleyyy94/subscriptions","organizations_url":"https://api.github.com/users/ashleyyy94/orgs","repos_url":"https://api.github.com/users/ashleyyy94/repos","events_url":"https://api.github.com/users/ashleyyy94/events{/privacy}","received_events_url":"https://api.github.com/users/ashleyyy94/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-12-12T16:05:20Z","performed_via_github_app":null},{"id":4104427590,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDEwNDQyNzU5MA==","url":"https://api.github.com/repos/salesforce/decaNLP/issues/events/4104427590","actor":{"login":"hot-cheeto","id":20938653,"node_id":"MDQ6VXNlcjIwOTM4NjUz","avatar_url":"https://avatars.githubusercontent.com/u/20938653?v=4","gravatar_id":"","url":"https://api.github.com/users/hot-cheeto","html_url":"https://github.com/hot-cheeto","followers_url":"https://api.github.com/users/hot-cheeto/followers","following_url":"https://api.github.com/users/hot-cheeto/following{/other_user}","gists_url":"https://api.github.com/users/hot-cheeto/gists{/gist_id}","starred_url":"https://api.github.com/users/hot-cheeto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hot-cheeto/subscriptions","organizations_url":"https://api.github.com/users/hot-cheeto/orgs","repos_url":"https://api.github.com/users/hot-cheeto/repos","events_url":"https://api.github.com/users/hot-cheeto/events{/privacy}","received_events_url":"https://api.github.com/users/hot-cheeto/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-12-12T16:05:20Z","performed_via_github_app":null},{"id":4104427591,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQxMDQ0Mjc1OTE=","url":"https://api.github.com/repos/salesforce/decaNLP/issues/events/4104427591","actor":{"login":"hot-cheeto","id":20938653,"node_id":"MDQ6VXNlcjIwOTM4NjUz","avatar_url":"https://avatars.githubusercontent.com/u/20938653?v=4","gravatar_id":"","url":"https://api.github.com/users/hot-cheeto","html_url":"https://github.com/hot-cheeto","followers_url":"https://api.github.com/users/hot-cheeto/followers","following_url":"https://api.github.com/users/hot-cheeto/following{/other_user}","gists_url":"https://api.github.com/users/hot-cheeto/gists{/gist_id}","starred_url":"https://api.github.com/users/hot-cheeto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hot-cheeto/subscriptions","organizations_url":"https://api.github.com/users/hot-cheeto/orgs","repos_url":"https://api.github.com/users/hot-cheeto/repos","events_url":"https://api.github.com/users/hot-cheeto/events{/privacy}","received_events_url":"https://api.github.com/users/hot-cheeto/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-12-12T16:05:20Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/salesforce/decaNLP/issues/comments/746504543","html_url":"https://github.com/salesforce/decaNLP/issues/51#issuecomment-746504543","issue_url":"https://api.github.com/repos/salesforce/decaNLP/issues/51","id":746504543,"node_id":"MDEyOklzc3VlQ29tbWVudDc0NjUwNDU0Mw==","user":{"login":"diarmidmackenzie","id":16045703,"node_id":"MDQ6VXNlcjE2MDQ1NzAz","avatar_url":"https://avatars.githubusercontent.com/u/16045703?v=4","gravatar_id":"","url":"https://api.github.com/users/diarmidmackenzie","html_url":"https://github.com/diarmidmackenzie","followers_url":"https://api.github.com/users/diarmidmackenzie/followers","following_url":"https://api.github.com/users/diarmidmackenzie/following{/other_user}","gists_url":"https://api.github.com/users/diarmidmackenzie/gists{/gist_id}","starred_url":"https://api.github.com/users/diarmidmackenzie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diarmidmackenzie/subscriptions","organizations_url":"https://api.github.com/users/diarmidmackenzie/orgs","repos_url":"https://api.github.com/users/diarmidmackenzie/repos","events_url":"https://api.github.com/users/diarmidmackenzie/events{/privacy}","received_events_url":"https://api.github.com/users/diarmidmackenzie/received_events","type":"User","site_admin":false},"created_at":"2020-12-16T15:44:55Z","updated_at":"2020-12-16T15:44:55Z","author_association":"NONE","body":"Adding a note that you can't set \"strict=False\" on the call to load_state_dict for the optimizer.  The reason why is explained here: https://github.com/pytorch/pytorch/issues/3852.\r\n\r\nI am suspicious there has been some change to the model since the pre-trained data referenced in the ReadMe was generated.\r\n\r\nThe pre-trained data logs say:\r\n`process_0 - MultitaskQuestionAnsweringNetwork has 18,199,502 parameters`\r\n\r\nWhat I see when training is:\r\n`process_0 - MultitaskQuestionAnsweringNetwork has 14,589,902 trainable parameters`\r\n\r\n`parameters` vs. `trainable parameters` in this log seems to imply that the pre-trained data set was generated from code prior to this commit (26 Oct 2018):\r\nhttps://github.com/salesforce/decaNLP/commit/2c837eaf6ed63ff72110550ce04882d23667355e\r\n(even if the training itself seems to have taken place in December 2018, it seems to have been using older code).\r\n\r\nThe 3.5M difference in the number of trainable parameters seems concerning too, and this doesn't seem to be down to configuration (unless I have missed something)\r\n\r\nThere have been quite a few changes to the repo since 26 Oct 2018 (including a bunch on Oct 26 itself).  I've not analyzed them all, but it seems plausible that one of these changes might have resulted in the incompatibility of the optimizer's stored state, causing this problem.","reactions":{"url":"https://api.github.com/repos/salesforce/decaNLP/issues/comments/746504543/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"diarmidmackenzie","id":16045703,"node_id":"MDQ6VXNlcjE2MDQ1NzAz","avatar_url":"https://avatars.githubusercontent.com/u/16045703?v=4","gravatar_id":"","url":"https://api.github.com/users/diarmidmackenzie","html_url":"https://github.com/diarmidmackenzie","followers_url":"https://api.github.com/users/diarmidmackenzie/followers","following_url":"https://api.github.com/users/diarmidmackenzie/following{/other_user}","gists_url":"https://api.github.com/users/diarmidmackenzie/gists{/gist_id}","starred_url":"https://api.github.com/users/diarmidmackenzie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diarmidmackenzie/subscriptions","organizations_url":"https://api.github.com/users/diarmidmackenzie/orgs","repos_url":"https://api.github.com/users/diarmidmackenzie/repos","events_url":"https://api.github.com/users/diarmidmackenzie/events{/privacy}","received_events_url":"https://api.github.com/users/diarmidmackenzie/received_events","type":"User","site_admin":false}}]