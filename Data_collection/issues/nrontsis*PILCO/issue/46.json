{"url":"https://api.github.com/repos/nrontsis/PILCO/issues/46","repository_url":"https://api.github.com/repos/nrontsis/PILCO","labels_url":"https://api.github.com/repos/nrontsis/PILCO/issues/46/labels{/name}","comments_url":"https://api.github.com/repos/nrontsis/PILCO/issues/46/comments","events_url":"https://api.github.com/repos/nrontsis/PILCO/issues/46/events","html_url":"https://github.com/nrontsis/PILCO/issues/46","id":624581026,"node_id":"MDU6SXNzdWU2MjQ1ODEwMjY=","number":46,"title":"Cholesky decomposition was not successful. The input might not be valid.","user":{"login":"Skylark0924","id":24936522,"node_id":"MDQ6VXNlcjI0OTM2NTIy","avatar_url":"https://avatars.githubusercontent.com/u/24936522?v=4","gravatar_id":"","url":"https://api.github.com/users/Skylark0924","html_url":"https://github.com/Skylark0924","followers_url":"https://api.github.com/users/Skylark0924/followers","following_url":"https://api.github.com/users/Skylark0924/following{/other_user}","gists_url":"https://api.github.com/users/Skylark0924/gists{/gist_id}","starred_url":"https://api.github.com/users/Skylark0924/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Skylark0924/subscriptions","organizations_url":"https://api.github.com/users/Skylark0924/orgs","repos_url":"https://api.github.com/users/Skylark0924/repos","events_url":"https://api.github.com/users/Skylark0924/events{/privacy}","received_events_url":"https://api.github.com/users/Skylark0924/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-05-26T03:43:30Z","updated_at":"2020-06-07T07:24:54Z","closed_at":"2020-05-27T21:26:01Z","author_association":"NONE","active_lock_reason":null,"body":"I am using my own gym env to test PILCO as a baseline, while this problem always occurs after about 2-3 iterations. \r\n```\r\n  File \"/home/lab/Github/PILCO/examples/gym_tracking_tendon.py\", line 196, in <module>\r\n    pilco.optimize_policy()\r\n  File \"/home/lab/Github/PILCO/pilco/models/pilco.py\", line 96, in optimize_policy\r\n    try:\r\n  File \"/home/lab/anaconda3/envs/pilco/lib/python3.7/site-packages/gpflow-2.0.0-py3.7.egg/gpflow/optimizers/scipy.py\", line 73, in minimize\r\n    func, initial_params, jac=True, method=method, **scipy_kwargs\r\n  File \"/home/lab/anaconda3/envs/pilco/lib/python3.7/site-packages/scipy/optimize/_minimize.py\", line 610, in minimize\r\n    callback=callback, **options)\r\n  File \"/home/lab/anaconda3/envs/pilco/lib/python3.7/site-packages/scipy/optimize/lbfgsb.py\", line 345, in _minimize_lbfgsb\r\n    f, g = func_and_grad(x)\r\n  File \"/home/lab/anaconda3/envs/pilco/lib/python3.7/site-packages/scipy/optimize/lbfgsb.py\", line 295, in func_and_grad\r\n    f = fun(x, *args)\r\n  File \"/home/lab/anaconda3/envs/pilco/lib/python3.7/site-packages/scipy/optimize/optimize.py\", line 327, in function_wrapper\r\n    return function(*(wrapper_args + args))\r\n  File \"/home/lab/anaconda3/envs/pilco/lib/python3.7/site-packages/scipy/optimize/optimize.py\", line 65, in __call__\r\n    fg = self.fun(x, *args)\r\n  File \"/home/lab/anaconda3/envs/pilco/lib/python3.7/site-packages/gpflow-2.0.0-py3.7.egg/gpflow/optimizers/scipy.py\", line 95, in _eval\r\n    loss, grad = _tf_eval(tf.convert_to_tensor(x))\r\n  File \"/home/lab/anaconda3/envs/pilco/lib/python3.7/site-packages/tensorflow_core/python/eager/def_function.py\", line 568, in __call__\r\n    result = self._call(*args, **kwds)\r\n  File \"/home/lab/anaconda3/envs/pilco/lib/python3.7/site-packages/tensorflow_core/python/eager/def_function.py\", line 638, in _call\r\n    return self._concrete_stateful_fn._filtered_call(canon_args, canon_kwds)  # pylint: disable=protected-access\r\n  File \"/home/lab/anaconda3/envs/pilco/lib/python3.7/site-packages/tensorflow_core/python/eager/function.py\", line 1611, in _filtered_call\r\n    self.captured_inputs)\r\n  File \"/home/lab/anaconda3/envs/pilco/lib/python3.7/site-packages/tensorflow_core/python/eager/function.py\", line 1692, in _call_flat\r\n    ctx, args, cancellation_manager=cancellation_manager))\r\n  File \"/home/lab/anaconda3/envs/pilco/lib/python3.7/site-packages/tensorflow_core/python/eager/function.py\", line 545, in call\r\n    ctx=ctx)\r\n  File \"/home/lab/anaconda3/envs/pilco/lib/python3.7/site-packages/tensorflow_core/python/eager/execute.py\", line 67, in quick_execute\r\n    six.raise_from(core._status_to_exception(e.code, message), None)\r\n  File \"<string>\", line 3, in raise_from\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError:  Cholesky decomposition was not successful. The input might not be valid.\r\n\t [[{{node while/body/_1/Cholesky}}]] [Op:__inference__tf_eval_1032837]\r\n```\r\nThe main function is just mimic the inv_double_pendulum:\r\n```\r\nif __name__ == '__main__':\r\n    env = TendonGymEnv()\r\n    e = np.array([[1]])   # Max control input. Set too low can lead to Cholesky failures.\r\n\r\n\r\n    X, Y, _, _ = rollout(env=env, pilco=None, random=True, timesteps=40, render=False)\r\n    for i in range(1, 5):\r\n        X_, Y_, _, _ = rollout(env=env, pilco=None, random=True, timesteps=40, render=False)\r\n        X = np.vstack((X, X_))\r\n        Y = np.vstack((Y, Y_))\r\n\r\n    state_dim = Y.shape[1]\r\n    control_dim = X.shape[1] - state_dim\r\n    # controller = RbfController(state_dim=state_dim, control_dim=control_dim, num_basis_functions=10)\r\n    controller = LinearController(state_dim=state_dim, control_dim=control_dim)\r\n\r\n    pilco = PILCO((X, Y), controller=controller, horizon=40)\r\n    pilco.controller.max_action = e\r\n\r\n    # # for numerical stability\r\n    # for model in pilco.mgpr.models:\r\n    #     model.likelihood.variance.assign(0.001)\r\n    #     set_trainable(model.likelihood.variance, False)\r\n    #     model.likelihood.fixed=True\r\n\r\n    return_lst = []\r\n    for rollouts in range(100):\r\n        print(\"**** ITERATION no.\", rollouts, \" ****\")\r\n        try:\r\n            pilco.optimize_models()\r\n        except:\r\n            pdb.set_trace()\r\n\r\n        pilco.optimize_policy()\r\n        # import pdb\r\n\r\n        # pdb.set_trace()\r\n        X_new, Y_new, _, sum_return = rollout(env=env, pilco=pilco, timesteps=300, render=False)\r\n        return_lst.append(sum_return)\r\n        # Update dataset\r\n        X = np.vstack((X, X_new))\r\n        Y = np.vstack((Y, Y_new))\r\n        pilco.mgpr.set_data((X, Y))\r\n```\r\nAnd I debug the input X and Y carefully, there is no NaN in the array. This is bothering me for a long time, so I wonder if you can give me a favor, I will appreciate that very much.","closed_by":{"login":"nrontsis","id":4145552,"node_id":"MDQ6VXNlcjQxNDU1NTI=","avatar_url":"https://avatars.githubusercontent.com/u/4145552?v=4","gravatar_id":"","url":"https://api.github.com/users/nrontsis","html_url":"https://github.com/nrontsis","followers_url":"https://api.github.com/users/nrontsis/followers","following_url":"https://api.github.com/users/nrontsis/following{/other_user}","gists_url":"https://api.github.com/users/nrontsis/gists{/gist_id}","starred_url":"https://api.github.com/users/nrontsis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nrontsis/subscriptions","organizations_url":"https://api.github.com/users/nrontsis/orgs","repos_url":"https://api.github.com/users/nrontsis/repos","events_url":"https://api.github.com/users/nrontsis/events{/privacy}","received_events_url":"https://api.github.com/users/nrontsis/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nrontsis/PILCO/issues/46/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nrontsis/PILCO/issues/46/timeline","performed_via_github_app":null,"state_reason":"completed"}