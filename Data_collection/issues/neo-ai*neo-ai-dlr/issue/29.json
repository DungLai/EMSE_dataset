{"url":"https://api.github.com/repos/neo-ai/neo-ai-dlr/issues/29","repository_url":"https://api.github.com/repos/neo-ai/neo-ai-dlr","labels_url":"https://api.github.com/repos/neo-ai/neo-ai-dlr/issues/29/labels{/name}","comments_url":"https://api.github.com/repos/neo-ai/neo-ai-dlr/issues/29/comments","events_url":"https://api.github.com/repos/neo-ai/neo-ai-dlr/issues/29/events","html_url":"https://github.com/neo-ai/neo-ai-dlr/issues/29","id":414938623,"node_id":"MDU6SXNzdWU0MTQ5Mzg2MjM=","number":29,"title":"slow inference performance on jetson tx2","user":{"login":"amrragab8080","id":38997602,"node_id":"MDQ6VXNlcjM4OTk3NjAy","avatar_url":"https://avatars.githubusercontent.com/u/38997602?v=4","gravatar_id":"","url":"https://api.github.com/users/amrragab8080","html_url":"https://github.com/amrragab8080","followers_url":"https://api.github.com/users/amrragab8080/followers","following_url":"https://api.github.com/users/amrragab8080/following{/other_user}","gists_url":"https://api.github.com/users/amrragab8080/gists{/gist_id}","starred_url":"https://api.github.com/users/amrragab8080/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amrragab8080/subscriptions","organizations_url":"https://api.github.com/users/amrragab8080/orgs","repos_url":"https://api.github.com/users/amrragab8080/repos","events_url":"https://api.github.com/users/amrragab8080/events{/privacy}","received_events_url":"https://api.github.com/users/amrragab8080/received_events","type":"User","site_admin":false},"labels":[{"id":1272420441,"node_id":"MDU6TGFiZWwxMjcyNDIwNDQx","url":"https://api.github.com/repos/neo-ai/neo-ai-dlr/labels/inactvie","name":"inactvie","color":"c19132","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-02-27T04:23:22Z","updated_at":"2019-03-15T14:33:09Z","closed_at":"2019-03-14T06:39:52Z","author_association":"NONE","active_lock_reason":null,"body":"Hello,\r\nOn a Jetson TX2 getting about `1m18.137s` wallclock time running inference of the vgg19 model. confirmed target built against the Jetson TX2 and running on gpu\r\n`\"TargetDevice\": \"jetson_tx2\"`\r\nInference is correctly identifying the image, however some warnings are printed, not sure if it contributes to the slowness.\r\n```\r\n[04:07:24] /root/neo-ai-dlr/3rdparty/tvm/src/contrib/subgraph/tensorrt_executor.cc:608: Tensor flatten0_output0 is an input of FullyConnected layer dense0 in TensorRT. Its ndim is 2, while TensorRT can only accept ndim >= 3. Reset ndim to 4 by expanding two trailing dims with dim size = 1.\r\n[04:07:45] /root/neo-ai-dlr/3rdparty/tvm/src/contrib/subgraph/tensorrt_executor.cc:608: Tensor dropout0_output0 is an input of FullyConnected layer dense1 in TensorRT. Its ndim is 2, while TensorRT can only accept ndim >= 3. Reset ndim to 4 by expanding two trailing dims with dim size = 1.\r\n[04:07:47] /root/neo-ai-dlr/3rdparty/tvm/src/contrib/subgraph/tensorrt_executor.cc:608: Tensor dropout1_output0 is an input of FullyConnected layer dense2 in TensorRT. Its ndim is 2, while TensorRT can only accept ndim >= 3. Reset ndim to 4 by expanding two trailing dims with dim size = 1.\r\nClass: albatross, mollymawk, probability: 0.976578\r\n```\r\n**Environment**\r\nUbuntu 16.04\r\nmodule 'dlr' from '/usr/local/lib/python3.5/dist-packages/dlr-1.0-py3.5.egg/dlr/__init__.py\r\nTensorRT 4.1.3-1+cuda9.0\r\ndlr compile flags: `-DUSE_CUDA=ON -DUSE_CUDNN=ON -DUSE_TENSORRT=/usr/src/tensorrt`\r\nModel: VGG19 (MXNet Model Zoo)\r\nFramework: MXNET\r\n```\r\ninput_shape = {'data': [1, 3, 224, 224]} # A single RGB 224x224 image\r\noutput_shape = [1, 1000]                 # The probability for each one of the 1,000 classes\r\ndevice = 'gpu'                           # Go, Jetson, Go!\r\nmodel = DLRModel('model', device)\r\n```\r\n**Perf monitor**\r\nRan perf on the code and see that 45%+ of the time is spent on the TensorRT 4 libraries\r\n```\r\n# Overhead  Command         Shared Object                        Symbol                                                \r\n# ........  ..............  ...................................  ......................................................\r\n#\r\n    29.01%  python          libnvinfer.so.4.1.3                  [.] 0x000000000044d46c                                \r\n    16.31%  python          libnvinfer.so.4.1.3                  [.] 0x00000000004003f4                                \r\n     4.86%  python          libc-2.23.so                         [.] 0x0000000000078b54                                \r\n     4.23%  python          libc-2.23.so                         [.] 0x0000000000078b6c                                \r\n     3.38%  python          libnvinfer.so.4.1.3                  [.] 0x000000000044d470                                \r\n     2.87%  python          [kernel.kallsyms]                    [k] el0_da                                            \r\n     2.05%  python          [kernel.kallsyms]                    [k] clear_page                                        \r\n     1.85%  python          libc-2.23.so                         [.] 0x0000000000078b58\r\n```","closed_by":{"login":"ziyu-guo","id":40365354,"node_id":"MDQ6VXNlcjQwMzY1MzU0","avatar_url":"https://avatars.githubusercontent.com/u/40365354?v=4","gravatar_id":"","url":"https://api.github.com/users/ziyu-guo","html_url":"https://github.com/ziyu-guo","followers_url":"https://api.github.com/users/ziyu-guo/followers","following_url":"https://api.github.com/users/ziyu-guo/following{/other_user}","gists_url":"https://api.github.com/users/ziyu-guo/gists{/gist_id}","starred_url":"https://api.github.com/users/ziyu-guo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ziyu-guo/subscriptions","organizations_url":"https://api.github.com/users/ziyu-guo/orgs","repos_url":"https://api.github.com/users/ziyu-guo/repos","events_url":"https://api.github.com/users/ziyu-guo/events{/privacy}","received_events_url":"https://api.github.com/users/ziyu-guo/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/neo-ai/neo-ai-dlr/issues/29/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/neo-ai/neo-ai-dlr/issues/29/timeline","performed_via_github_app":null,"state_reason":"completed"}