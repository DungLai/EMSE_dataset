{"url":"https://api.github.com/repos/hudson-and-thames/mlfinlab/issues/341","repository_url":"https://api.github.com/repos/hudson-and-thames/mlfinlab","labels_url":"https://api.github.com/repos/hudson-and-thames/mlfinlab/issues/341/labels{/name}","comments_url":"https://api.github.com/repos/hudson-and-thames/mlfinlab/issues/341/comments","events_url":"https://api.github.com/repos/hudson-and-thames/mlfinlab/issues/341/events","html_url":"https://github.com/hudson-and-thames/mlfinlab/issues/341","id":624383509,"node_id":"MDU6SXNzdWU2MjQzODM1MDk=","number":341,"title":"get_feature_clusters generates ValueError when using mutual_information if feature df contains binary columns","user":{"login":"BlackArbsCEO","id":7452471,"node_id":"MDQ6VXNlcjc0NTI0NzE=","avatar_url":"https://avatars.githubusercontent.com/u/7452471?v=4","gravatar_id":"","url":"https://api.github.com/users/BlackArbsCEO","html_url":"https://github.com/BlackArbsCEO","followers_url":"https://api.github.com/users/BlackArbsCEO/followers","following_url":"https://api.github.com/users/BlackArbsCEO/following{/other_user}","gists_url":"https://api.github.com/users/BlackArbsCEO/gists{/gist_id}","starred_url":"https://api.github.com/users/BlackArbsCEO/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BlackArbsCEO/subscriptions","organizations_url":"https://api.github.com/users/BlackArbsCEO/orgs","repos_url":"https://api.github.com/users/BlackArbsCEO/repos","events_url":"https://api.github.com/users/BlackArbsCEO/events{/privacy}","received_events_url":"https://api.github.com/users/BlackArbsCEO/received_events","type":"User","site_admin":false},"labels":[{"id":1232033387,"node_id":"MDU6TGFiZWwxMjMyMDMzMzg3","url":"https://api.github.com/repos/hudson-and-thames/mlfinlab/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":{"login":"PanPip","id":16906989,"node_id":"MDQ6VXNlcjE2OTA2OTg5","avatar_url":"https://avatars.githubusercontent.com/u/16906989?v=4","gravatar_id":"","url":"https://api.github.com/users/PanPip","html_url":"https://github.com/PanPip","followers_url":"https://api.github.com/users/PanPip/followers","following_url":"https://api.github.com/users/PanPip/following{/other_user}","gists_url":"https://api.github.com/users/PanPip/gists{/gist_id}","starred_url":"https://api.github.com/users/PanPip/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PanPip/subscriptions","organizations_url":"https://api.github.com/users/PanPip/orgs","repos_url":"https://api.github.com/users/PanPip/repos","events_url":"https://api.github.com/users/PanPip/events{/privacy}","received_events_url":"https://api.github.com/users/PanPip/received_events","type":"User","site_admin":false},"assignees":[{"login":"PanPip","id":16906989,"node_id":"MDQ6VXNlcjE2OTA2OTg5","avatar_url":"https://avatars.githubusercontent.com/u/16906989?v=4","gravatar_id":"","url":"https://api.github.com/users/PanPip","html_url":"https://github.com/PanPip","followers_url":"https://api.github.com/users/PanPip/followers","following_url":"https://api.github.com/users/PanPip/following{/other_user}","gists_url":"https://api.github.com/users/PanPip/gists{/gist_id}","starred_url":"https://api.github.com/users/PanPip/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PanPip/subscriptions","organizations_url":"https://api.github.com/users/PanPip/orgs","repos_url":"https://api.github.com/users/PanPip/repos","events_url":"https://api.github.com/users/PanPip/events{/privacy}","received_events_url":"https://api.github.com/users/PanPip/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2020-05-25T16:07:41Z","updated_at":"2020-06-30T10:20:55Z","closed_at":"2020-06-30T10:20:55Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the bug**\r\n`get_feature_clusters` generates ValueError when using `mutual_information` for dependence_metric.\r\n\r\n**To Reproduce**\r\n```\r\nX, y = ml.util.generate_dataset.get_classification_data(\r\n    n_features=40,\r\n    n_informative=5,\r\n    n_redundant=30,\r\n    n_samples=10000,\r\n    sigma=0.1,\r\n    random_state=87,\r\n)\r\n\r\nnp.random.seed(87)\r\nX[\"I_0\"] = np.random.choice([0, 1], size=len(X))\r\nX[\"I_1\"] = np.random.choice([0, 1], size=len(X))\r\n\r\nclusters = get_feature_clusters(\r\n    X,\r\n    dependence_metric=\"mutual_information\",\r\n    distance_metric=None,  # \"angular\",\r\n    linkage_method=None,  # \"average\",\r\n    n_clusters=None,\r\n)\r\n\r\npprint(len(clusters))\r\npprint(clusters)\r\n```\r\n\r\n**Screenshots**\r\n```\r\nNo feature/s found with low silhouette score. All features belongs to its respective clusters\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-260-c27b0f4e0b9e> in <module>\r\n      4     distance_metric=None,  # \"angular\",\r\n      5     linkage_method=None,  # \"average\",\r\n----> 6     n_clusters=None,\r\n      7 )\r\n      8 \r\n\r\n~/anaconda3/envs/mlfinlab/lib/python3.7/site-packages/mlfinlab/clustering/feature_clusters.py in get_feature_clusters(X, dependence_metric, distance_metric, linkage_method, n_clusters, critical_threshold)\r\n     53 \r\n     54     if n_clusters is None and (distance_metric is None or linkage_method is None):\r\n---> 55         return list(get_onc_clusters(dep_matrix.fillna(0))[1].values())  # Get optimal number of clusters\r\n     56     if distance_metric is not None and (linkage_method is not None and n_clusters is None):\r\n     57         n_clusters = len(get_onc_clusters(dep_matrix.fillna(0))[1])\r\n\r\n~/anaconda3/envs/mlfinlab/lib/python3.7/site-packages/mlfinlab/clustering/onc.py in get_onc_clusters(corr_mat, repeat)\r\n    155     \"\"\"\r\n    156 \r\n--> 157     return cluster_kmeans_top(corr_mat, repeat)\r\n\r\n~/anaconda3/envs/mlfinlab/lib/python3.7/site-packages/mlfinlab/clustering/onc.py in cluster_kmeans_top(corr_mat, repeat)\r\n    115 \r\n    116     max_num_clusters = corr_mat.shape[1] - 1\r\n--> 117     corr1, clusters, silh = _cluster_kmeans_base(corr_mat, max_num_clusters=max_num_clusters, repeat=repeat)\r\n    118 \r\n    119     # Get cluster quality scores\r\n\r\n~/anaconda3/envs/mlfinlab/lib/python3.7/site-packages/mlfinlab/clustering/onc.py in _cluster_kmeans_base(corr_mat, max_num_clusters, repeat)\r\n     63         for num_clusters in range(2, max_num_clusters + 1):\r\n     64             kmeans_ = KMeans(n_clusters=num_clusters, n_jobs=1, n_init=1)\r\n---> 65             kmeans_ = kmeans_.fit(distance)\r\n     66             silh_ = silhouette_samples(distance, kmeans_.labels_)\r\n     67             stat = (silh_.mean() / silh_.std(), silh.mean() / silh.std())\r\n\r\n~/anaconda3/envs/mlfinlab/lib/python3.7/site-packages/sklearn/cluster/_kmeans.py in fit(self, X, y, sample_weight)\r\n    992                                 dtype=[np.float64, np.float32],\r\n    993                                 order='C', copy=self.copy_x,\r\n--> 994                                 accept_large_sparse=False)\r\n    995         # verify that the number of samples given is larger than k\r\n    996         if _num_samples(X) < self.n_clusters:\r\n\r\n~/anaconda3/envs/mlfinlab/lib/python3.7/site-packages/sklearn/base.py in _validate_data(self, X, y, reset, validate_separately, **check_params)\r\n    418                     f\"requires y to be passed, but the target y is None.\"\r\n    419                 )\r\n--> 420             X = check_array(X, **check_params)\r\n    421             out = X\r\n    422         else:\r\n\r\n~/anaconda3/envs/mlfinlab/lib/python3.7/site-packages/sklearn/utils/validation.py in inner_f(*args, **kwargs)\r\n     71                           FutureWarning)\r\n     72         kwargs.update({k: arg for k, arg in zip(sig.parameters, args)})\r\n---> 73         return f(**kwargs)\r\n     74     return inner_f\r\n     75 \r\n\r\n~/anaconda3/envs/mlfinlab/lib/python3.7/site-packages/sklearn/utils/validation.py in check_array(array, accept_sparse, accept_large_sparse, dtype, order, copy, force_all_finite, ensure_2d, allow_nd, ensure_min_samples, ensure_min_features, estimator)\r\n    644         if force_all_finite:\r\n    645             _assert_all_finite(array,\r\n--> 646                                allow_nan=force_all_finite == 'allow-nan')\r\n    647 \r\n    648     if ensure_min_samples > 0:\r\n\r\n~/anaconda3/envs/mlfinlab/lib/python3.7/site-packages/sklearn/utils/validation.py in _assert_all_finite(X, allow_nan, msg_dtype)\r\n     98                     msg_err.format\r\n     99                     (type_err,\r\n--> 100                      msg_dtype if msg_dtype is not None else X.dtype)\r\n    101             )\r\n    102     # for object dtype data, we only check for NaNs (GH-13254)\r\n\r\nValueError: Input contains NaN, infinity or a value too large for dtype('float64').\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n```\r\nmlfinlab 0.10.0\r\n\r\ncompiler   : GCC 7.3.0\r\nsystem     : Linux\r\nrelease    : 5.0.0-32-generic\r\nmachine    : x86_64\r\nprocessor  : x86_64\r\nCPU cores  : 12\r\n```\r\n","closed_by":{"login":"PanPip","id":16906989,"node_id":"MDQ6VXNlcjE2OTA2OTg5","avatar_url":"https://avatars.githubusercontent.com/u/16906989?v=4","gravatar_id":"","url":"https://api.github.com/users/PanPip","html_url":"https://github.com/PanPip","followers_url":"https://api.github.com/users/PanPip/followers","following_url":"https://api.github.com/users/PanPip/following{/other_user}","gists_url":"https://api.github.com/users/PanPip/gists{/gist_id}","starred_url":"https://api.github.com/users/PanPip/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PanPip/subscriptions","organizations_url":"https://api.github.com/users/PanPip/orgs","repos_url":"https://api.github.com/users/PanPip/repos","events_url":"https://api.github.com/users/PanPip/events{/privacy}","received_events_url":"https://api.github.com/users/PanPip/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hudson-and-thames/mlfinlab/issues/341/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hudson-and-thames/mlfinlab/issues/341/timeline","performed_via_github_app":null,"state_reason":"completed"}