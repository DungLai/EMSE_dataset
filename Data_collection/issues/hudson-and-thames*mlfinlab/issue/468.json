{"url":"https://api.github.com/repos/hudson-and-thames/mlfinlab/issues/468","repository_url":"https://api.github.com/repos/hudson-and-thames/mlfinlab","labels_url":"https://api.github.com/repos/hudson-and-thames/mlfinlab/issues/468/labels{/name}","comments_url":"https://api.github.com/repos/hudson-and-thames/mlfinlab/issues/468/comments","events_url":"https://api.github.com/repos/hudson-and-thames/mlfinlab/issues/468/events","html_url":"https://github.com/hudson-and-thames/mlfinlab/issues/468","id":738434141,"node_id":"MDU6SXNzdWU3Mzg0MzQxNDE=","number":468,"title":"Trying different covariance matrices error - HERC Portfolio","user":{"login":"andrewcztrack","id":65228188,"node_id":"MDQ6VXNlcjY1MjI4MTg4","avatar_url":"https://avatars.githubusercontent.com/u/65228188?v=4","gravatar_id":"","url":"https://api.github.com/users/andrewcztrack","html_url":"https://github.com/andrewcztrack","followers_url":"https://api.github.com/users/andrewcztrack/followers","following_url":"https://api.github.com/users/andrewcztrack/following{/other_user}","gists_url":"https://api.github.com/users/andrewcztrack/gists{/gist_id}","starred_url":"https://api.github.com/users/andrewcztrack/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrewcztrack/subscriptions","organizations_url":"https://api.github.com/users/andrewcztrack/orgs","repos_url":"https://api.github.com/users/andrewcztrack/repos","events_url":"https://api.github.com/users/andrewcztrack/events{/privacy}","received_events_url":"https://api.github.com/users/andrewcztrack/received_events","type":"User","site_admin":false},"labels":[{"id":1232033405,"node_id":"MDU6TGFiZWwxMjMyMDMzNDA1","url":"https://api.github.com/repos/hudson-and-thames/mlfinlab/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"closed","locked":false,"assignee":{"login":"aditya1702","id":15054664,"node_id":"MDQ6VXNlcjE1MDU0NjY0","avatar_url":"https://avatars.githubusercontent.com/u/15054664?v=4","gravatar_id":"","url":"https://api.github.com/users/aditya1702","html_url":"https://github.com/aditya1702","followers_url":"https://api.github.com/users/aditya1702/followers","following_url":"https://api.github.com/users/aditya1702/following{/other_user}","gists_url":"https://api.github.com/users/aditya1702/gists{/gist_id}","starred_url":"https://api.github.com/users/aditya1702/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aditya1702/subscriptions","organizations_url":"https://api.github.com/users/aditya1702/orgs","repos_url":"https://api.github.com/users/aditya1702/repos","events_url":"https://api.github.com/users/aditya1702/events{/privacy}","received_events_url":"https://api.github.com/users/aditya1702/received_events","type":"User","site_admin":false},"assignees":[{"login":"aditya1702","id":15054664,"node_id":"MDQ6VXNlcjE1MDU0NjY0","avatar_url":"https://avatars.githubusercontent.com/u/15054664?v=4","gravatar_id":"","url":"https://api.github.com/users/aditya1702","html_url":"https://github.com/aditya1702","followers_url":"https://api.github.com/users/aditya1702/followers","following_url":"https://api.github.com/users/aditya1702/following{/other_user}","gists_url":"https://api.github.com/users/aditya1702/gists{/gist_id}","starred_url":"https://api.github.com/users/aditya1702/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aditya1702/subscriptions","organizations_url":"https://api.github.com/users/aditya1702/orgs","repos_url":"https://api.github.com/users/aditya1702/repos","events_url":"https://api.github.com/users/aditya1702/events{/privacy}","received_events_url":"https://api.github.com/users/aditya1702/received_events","type":"User","site_admin":false},{"login":"PanPip","id":16906989,"node_id":"MDQ6VXNlcjE2OTA2OTg5","avatar_url":"https://avatars.githubusercontent.com/u/16906989?v=4","gravatar_id":"","url":"https://api.github.com/users/PanPip","html_url":"https://github.com/PanPip","followers_url":"https://api.github.com/users/PanPip/followers","following_url":"https://api.github.com/users/PanPip/following{/other_user}","gists_url":"https://api.github.com/users/PanPip/gists{/gist_id}","starred_url":"https://api.github.com/users/PanPip/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PanPip/subscriptions","organizations_url":"https://api.github.com/users/PanPip/orgs","repos_url":"https://api.github.com/users/PanPip/repos","events_url":"https://api.github.com/users/PanPip/events{/privacy}","received_events_url":"https://api.github.com/users/PanPip/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2020-11-08T10:17:33Z","updated_at":"2021-04-14T16:58:31Z","closed_at":"2021-04-14T16:58:31Z","author_association":"NONE","active_lock_reason":null,"body":"Hi @Jackal08 \r\n\r\nI hope the team is well.\r\n\r\nI want to try different return estimation and covariance matrices with the above algorithm however  i am getting error.\r\n\r\n```python\r\nSigma_numpy = cov_est(rr, args)\r\nprint(Sigma_numpy)\r\npx = pd.DataFrame(Sigma_numpy).astype(\"float\")\r\npx\r\n\r\n\t0\t1\r\n0\t0.000037\t0.000012\r\n1\t0.000012\t0.000046\r\n\r\n\r\n# from here, we can now create our portfolio\r\nhercCDR_custom = HierarchicalEqualRiskContribution()\r\nhercCDR_custom.allocate(asset_names=stock_prices.columns,\r\n                        asset_returns=returns,\r\n                        covariance_matrix=px,\r\n                        optimal_num_clusters=2,\r\n                        risk_measure='conditional_drawdown_risk')\r\nâ€‹\r\nprint(\"Custom HERC Portfolio - Conditional Drawdown at Risk \\n\", hercCDR_custom.weights)\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-60-634ed571ef8c> in <module>\r\n      1 # from here, we can now create our portfolio\r\n      2 hercCDR_custom = HierarchicalEqualRiskContribution()\r\n----> 3 hercCDR_custom.allocate(asset_names=stock_prices.columns,\r\n      4                         asset_returns=returns,\r\n      5                         covariance_matrix=px,\r\n\r\n~/miniconda3/envs/myenv/lib/python3.8/site-packages/mlfinlab/portfolio_optimization/herc.py in allocate(self, asset_names, asset_prices, asset_returns, covariance_matrix, risk_measure, linkage, optimal_num_clusters)\r\n     98                                                                              asset_returns=asset_returns)\r\n     99         else:\r\n--> 100             self.optimal_num_clusters = self._check_max_number_of_clusters(num_clusters=optimal_num_clusters,\r\n    101                                                                            linkage=linkage,\r\n    102                                                                            correlation=corr)\r\n\r\n~/miniconda3/envs/myenv/lib/python3.8/site-packages/mlfinlab/portfolio_optimization/herc.py in _check_max_number_of_clusters(num_clusters, linkage, correlation)\r\n    166 \r\n    167         distance_matrix = np.sqrt(2 * (1 - correlation).round(5))\r\n--> 168         clusters = scipy_linkage(squareform(distance_matrix.values), method=linkage)\r\n    169         clustering_inds = fcluster(clusters, num_clusters, criterion='maxclust')\r\n    170         max_number_of_clusters_possible = max(clustering_inds)\r\n\r\n~/miniconda3/envs/myenv/lib/python3.8/site-packages/scipy/spatial/distance.py in squareform(X, force, checks)\r\n   2182             raise ValueError('The matrix argument must be square.')\r\n   2183         if checks:\r\n-> 2184             is_valid_dm(X, throw=True, name='X')\r\n   2185 \r\n   2186         # One-side of the dimensions is set here.\r\n\r\n~/miniconda3/envs/myenv/lib/python3.8/site-packages/scipy/spatial/distance.py in is_valid_dm(D, tol, throw, name, warning)\r\n   2257             if not (D == D.T).all():\r\n   2258                 if name:\r\n-> 2259                     raise ValueError(('Distance matrix \\'%s\\' must be '\r\n   2260                                      'symmetric.') % name)\r\n   2261                 else:\r\n\r\nValueError: Distance matrix 'X' must be symmetric\r\n```","closed_by":{"login":"PanPip","id":16906989,"node_id":"MDQ6VXNlcjE2OTA2OTg5","avatar_url":"https://avatars.githubusercontent.com/u/16906989?v=4","gravatar_id":"","url":"https://api.github.com/users/PanPip","html_url":"https://github.com/PanPip","followers_url":"https://api.github.com/users/PanPip/followers","following_url":"https://api.github.com/users/PanPip/following{/other_user}","gists_url":"https://api.github.com/users/PanPip/gists{/gist_id}","starred_url":"https://api.github.com/users/PanPip/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PanPip/subscriptions","organizations_url":"https://api.github.com/users/PanPip/orgs","repos_url":"https://api.github.com/users/PanPip/repos","events_url":"https://api.github.com/users/PanPip/events{/privacy}","received_events_url":"https://api.github.com/users/PanPip/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hudson-and-thames/mlfinlab/issues/468/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hudson-and-thames/mlfinlab/issues/468/timeline","performed_via_github_app":null,"state_reason":"completed"}