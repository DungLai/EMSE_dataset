{"url":"https://api.github.com/repos/tbepler/protein-sequence-embedding-iclr2019/issues/21","repository_url":"https://api.github.com/repos/tbepler/protein-sequence-embedding-iclr2019","labels_url":"https://api.github.com/repos/tbepler/protein-sequence-embedding-iclr2019/issues/21/labels{/name}","comments_url":"https://api.github.com/repos/tbepler/protein-sequence-embedding-iclr2019/issues/21/comments","events_url":"https://api.github.com/repos/tbepler/protein-sequence-embedding-iclr2019/issues/21/events","html_url":"https://github.com/tbepler/protein-sequence-embedding-iclr2019/issues/21","id":738459162,"node_id":"MDU6SXNzdWU3Mzg0NTkxNjI=","number":21,"title":"embed_sequences.py fails: AttributeError: 'LSTM' object has no attribute '_flat_weights'","user":{"login":"konstin","id":6826232,"node_id":"MDQ6VXNlcjY4MjYyMzI=","avatar_url":"https://avatars.githubusercontent.com/u/6826232?v=4","gravatar_id":"","url":"https://api.github.com/users/konstin","html_url":"https://github.com/konstin","followers_url":"https://api.github.com/users/konstin/followers","following_url":"https://api.github.com/users/konstin/following{/other_user}","gists_url":"https://api.github.com/users/konstin/gists{/gist_id}","starred_url":"https://api.github.com/users/konstin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/konstin/subscriptions","organizations_url":"https://api.github.com/users/konstin/orgs","repos_url":"https://api.github.com/users/konstin/repos","events_url":"https://api.github.com/users/konstin/events{/privacy}","received_events_url":"https://api.github.com/users/konstin/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-11-08T12:54:46Z","updated_at":"2020-11-08T16:39:37Z","closed_at":"2020-11-08T16:39:37Z","author_association":"NONE","active_lock_reason":null,"body":"I'm trying to run `embed_sequences.py`, but I get an exception from torch code:\r\n\r\n```\r\n$ python embed_sequences.py seqwence-protein.fasta -m ../pretrained_models/ssa_L1_100d_lstm3x512_lm_i512_mb64_tau0.5_lambda0.1_p0.05_epoch100.sav -o output.h5\r\n/home/konsti/bepler-berger/venv/lib/python3.8/site-packages/torch/serialization.py:657: SourceChangeWarning: source code of class 'torch.nn.modules.sparse.Embedding' has changed. you can retrieve the original source code by accessing the object's source attribute or set `torch.nn.Module.dump_patches = True` and use the patch tool to revert the changes.\r\n  warnings.warn(msg, SourceChangeWarning)\r\n/home/konsti/bepler-berger/venv/lib/python3.8/site-packages/torch/serialization.py:657: SourceChangeWarning: source code of class 'torch.nn.modules.dropout.Dropout' has changed. you can retrieve the original source code by accessing the object's source attribute or set `torch.nn.Module.dump_patches = True` and use the patch tool to revert the changes.\r\n  warnings.warn(msg, SourceChangeWarning)\r\n/home/konsti/bepler-berger/venv/lib/python3.8/site-packages/torch/serialization.py:657: SourceChangeWarning: source code of class 'torch.nn.modules.container.ModuleList' has changed. you can retrieve the original source code by accessing the object's source attribute or set `torch.nn.Module.dump_patches = True` and use the patch tool to revert the changes.\r\n  warnings.warn(msg, SourceChangeWarning)\r\n/home/konsti/bepler-berger/venv/lib/python3.8/site-packages/torch/serialization.py:657: SourceChangeWarning: source code of class 'torch.nn.modules.rnn.LSTM' has changed. you can retrieve the original source code by accessing the object's source attribute or set `torch.nn.Module.dump_patches = True` and use the patch tool to revert the changes.\r\n  warnings.warn(msg, SourceChangeWarning)\r\n/home/konsti/bepler-berger/venv/lib/python3.8/site-packages/torch/serialization.py:657: SourceChangeWarning: source code of class 'torch.nn.modules.linear.Linear' has changed. you can retrieve the original source code by accessing the object's source attribute or set `torch.nn.Module.dump_patches = True` and use the patch tool to revert the changes.\r\n  warnings.warn(msg, SourceChangeWarning)\r\n/home/konsti/bepler-berger/venv/lib/python3.8/site-packages/torch/serialization.py:657: SourceChangeWarning: source code of class 'torch.nn.modules.activation.ReLU' has changed. you can retrieve the original source code by accessing the object's source attribute or set `torch.nn.Module.dump_patches = True` and use the patch tool to revert the changes.\r\n  warnings.warn(msg, SourceChangeWarning)\r\n/home/konsti/bepler-berger/venv/lib/python3.8/site-packages/torch/serialization.py:657: SourceChangeWarning: source code of class 'torch.nn.modules.conv.Conv2d' has changed. you can retrieve the original source code by accessing the object's source attribute or set `torch.nn.Module.dump_patches = True` and use the patch tool to revert the changes.\r\n  warnings.warn(msg, SourceChangeWarning)\r\n# writing: a.h5\r\n# embedding with lm_only=False, no_lm=False, proj_only=False\r\n# pooling: none\r\nTraceback (most recent call last):\r\n  File \"embed_sequences.py\", line 184, in <module>\r\n    main()\r\n  File \"embed_sequences.py\", line 171, in main\r\n    z = embed_sequence(sequence, lm_embed, lstm_stack, proj\r\n  File \"embed_sequences.py\", line 82, in embed_sequence\r\n    z = embed_stack(x, lm_embed, lstm_stack, proj\r\n  File \"embed_sequences.py\", line 49, in embed_stack\r\n    h = lm_embed(x)\r\n  File \"/home/konsti/bepler-berger/venv/lib/python3.8/site-packages/torch/nn/modules/module.py\", line 550, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/home/konsti/bepler-berger/src/models/embedding.py\", line 25, in forward\r\n    h_lm = self.lm.encode(x)\r\n  File \"/home/konsti/bepler-berger/src/models/sequence.py\", line 168, in encode\r\n    h_fwd_layers,h_rvs_layers = self.transform(z_fwd, z_rvs)\r\n  File \"/home/konsti/bepler-berger/src/models/sequence.py\", line 92, in transform\r\n    h,_ = rnn(h)\r\n  File \"/home/konsti/bepler-berger/venv/lib/python3.8/site-packages/torch/nn/modules/module.py\", line 550, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/home/konsti/bepler-berger/venv/lib/python3.8/site-packages/torch/nn/modules/rnn.py\", line 569, in forward\r\n    result = _VF.lstm(input, hx, self._flat_weights, self.bias, self.num_layers,\r\n  File \"/home/konsti/bepler-berger/venv/lib/python3.8/site-packages/torch/nn/modules/module.py\", line 593, in __getattr__\r\n    raise AttributeError(\"'{}' object has no attribute '{}'\".format(\r\nAttributeError: 'LSTM' object has no attribute '_flat_weights'\r\n```\r\n\r\nThese are the versions I installed (from `pip freeze`):\r\n\r\n```\r\nCython==0.29.21\r\ndataclasses==0.6\r\nfuture==0.18.2\r\nh5py==3.1.0\r\nnumpy==1.19.4\r\npkg-resources==0.0.0\r\ntorch==1.5.1\r\ntyping-extensions==3.7.4.3\r\n```\r\n\r\nI suspect that this has something to do with the torch version, so would it be possible to make the model run on more recent pytorch versions?","closed_by":{"login":"konstin","id":6826232,"node_id":"MDQ6VXNlcjY4MjYyMzI=","avatar_url":"https://avatars.githubusercontent.com/u/6826232?v=4","gravatar_id":"","url":"https://api.github.com/users/konstin","html_url":"https://github.com/konstin","followers_url":"https://api.github.com/users/konstin/followers","following_url":"https://api.github.com/users/konstin/following{/other_user}","gists_url":"https://api.github.com/users/konstin/gists{/gist_id}","starred_url":"https://api.github.com/users/konstin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/konstin/subscriptions","organizations_url":"https://api.github.com/users/konstin/orgs","repos_url":"https://api.github.com/users/konstin/repos","events_url":"https://api.github.com/users/konstin/events{/privacy}","received_events_url":"https://api.github.com/users/konstin/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tbepler/protein-sequence-embedding-iclr2019/issues/21/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tbepler/protein-sequence-embedding-iclr2019/issues/21/timeline","performed_via_github_app":null,"state_reason":"completed"}