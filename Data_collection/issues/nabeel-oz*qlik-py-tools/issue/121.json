{"url":"https://api.github.com/repos/nabeel-oz/qlik-py-tools/issues/121","repository_url":"https://api.github.com/repos/nabeel-oz/qlik-py-tools","labels_url":"https://api.github.com/repos/nabeel-oz/qlik-py-tools/issues/121/labels{/name}","comments_url":"https://api.github.com/repos/nabeel-oz/qlik-py-tools/issues/121/comments","events_url":"https://api.github.com/repos/nabeel-oz/qlik-py-tools/issues/121/events","html_url":"https://github.com/nabeel-oz/qlik-py-tools/issues/121","id":794977751,"node_id":"MDU6SXNzdWU3OTQ5Nzc3NTE=","number":121,"title":"Sample app forecasting with keras reload problem","user":{"login":"Marka10","id":78079206,"node_id":"MDQ6VXNlcjc4MDc5MjA2","avatar_url":"https://avatars.githubusercontent.com/u/78079206?v=4","gravatar_id":"","url":"https://api.github.com/users/Marka10","html_url":"https://github.com/Marka10","followers_url":"https://api.github.com/users/Marka10/followers","following_url":"https://api.github.com/users/Marka10/following{/other_user}","gists_url":"https://api.github.com/users/Marka10/gists{/gist_id}","starred_url":"https://api.github.com/users/Marka10/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Marka10/subscriptions","organizations_url":"https://api.github.com/users/Marka10/orgs","repos_url":"https://api.github.com/users/Marka10/repos","events_url":"https://api.github.com/users/Marka10/events{/privacy}","received_events_url":"https://api.github.com/users/Marka10/received_events","type":"User","site_admin":false},"labels":[{"id":1644668256,"node_id":"MDU6TGFiZWwxNjQ0NjY4MjU2","url":"https://api.github.com/repos/nabeel-oz/qlik-py-tools/labels/usage%20exception","name":"usage exception","color":"f9bdc7","default":false,"description":"Exception during a SSE function call from Qlik"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-01-27T10:33:52Z","updated_at":"2021-01-27T10:33:52Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"**Function**\r\nPyTools.sklearn_Calculate_Metrics_Sequence\r\n\r\n**Describe the bug**\r\nConnector reply error: grpc::StatusCode::UNKNOWN: 'Exception iterating responses: 'str' object has no attribute 'decode''\r\n\r\n**Full error message from Python**\r\n2021-01-27 08:36:26,273 - INFO - ExecuteFunction (functionId: 42, _sklearn)\r\n2021-01-27 08:36:26,337 - ERROR - Exception iterating responses: 'str' object has no attribute 'decode'\r\nTraceback (most recent call last):\r\n  File \"C:\\Qlik\\qlik-py-tools-8.0\\qlik-py-env\\lib\\site-packages\\grpc\\_server.py\", line 453, in _take_response_from_response_iterator\r\n    return next(response_iterator), True\r\n  File \"__main__.py\", line 550, in _sklearn\r\n    response = model.calculate_metrics(ordered_data=True)\r\n  File \"C:\\Qlik\\qlik-py-tools-8.0\\qlik-py-env\\core\\_sklearn.py\", line 895, in calculate_metrics\r\n    self.X_test, self.y_test = self._get_model_and_data(target=True, ordered_data=ordered_data)\r\n  File \"C:\\Qlik\\qlik-py-tools-8.0\\qlik-py-env\\core\\_sklearn.py\", line 1927, in _get_model_and_data\r\n    self._get_model()\r\n  File \"C:\\Qlik\\qlik-py-tools-8.0\\qlik-py-env\\core\\_sklearn.py\", line 2459, in _get_model\r\n    self.model = self.model.load(self.model.name, self.path)\r\n  File \"C:\\Qlik\\qlik-py-tools-8.0\\qlik-py-env\\core\\_machine_learning.py\", line 132, in load\r\n    keras_model = keras.models.load_model(path + name + '.h5')\r\n  File \"C:\\Qlik\\qlik-py-tools-8.0\\qlik-py-env\\lib\\site-packages\\keras\\engine\\saving.py\", line 458, in load_wrapper\r\n    return load_function(*args, **kwargs)\r\n  File \"C:\\Qlik\\qlik-py-tools-8.0\\qlik-py-env\\lib\\site-packages\\keras\\engine\\saving.py\", line 550, in load_model\r\n    model = _deserialize_model(h5dict, custom_objects, compile)\r\n  File \"C:\\Qlik\\qlik-py-tools-8.0\\qlik-py-env\\lib\\site-packages\\keras\\engine\\saving.py\", line 242, in _deserialize_model\r\n    model_config = json.loads(model_config.decode('utf-8'))\r\nAttributeError: 'str' object has no attribute 'decode'\r\n\r\n**Error message in Qlik**\r\n![image](https://user-images.githubusercontent.com/78079206/105976093-0d528100-6090-11eb-97a5-4d3f78674785.png)\r\n\r\n\r\n\r\n**Expression or load script used in Qlik**\r\nIts the unaltered app \"Sample-app-forecasting-with-keras\"\r\n...\r\nFor Each vModel in FieldValueList('Model Name')\r\n\t\r\n    If '$(vModel)' <> 'Bikes-CausalConv-7d-v1' Then\r\n    \r\n        // Other than the multi-step model we get evaluation metrics and predictions one month at a time.\r\n        // Since past values are inputs to these models, predicting over long periods will add up the errors from previous predictions.\r\n        // In practice, we can continue to provide actual values to the model\r\n        // So we are going to get predictions one month at a time, supplying actual values for previous periods\r\n        For Each vMonth in 7, 8, 9, 10, 11, 12\r\n\r\n            // Prepare samples table with the current model name and unique keys\r\n            [TEMP_SAMPLES_WITH_KEYS]:\r\n            LOAD\r\n               '$(vModel)' as Model_Name,\r\n               Key,\r\n               N_Features // Including Target for historical data. Target may be Null or zero for the periods to be predicted\r\n            RESIDENT [TEMP_TEST]\r\n            WHERE [Key] >= (MonthStart(MakeDate(2012, $(vMonth), 1))-31) and [Key] <= MonthEnd(MakeDate(2012, $(vMonth), 1)); \r\n\r\n            // Use the LOAD...EXTENSION syntax to call the Get_Metrics function\r\n            [Result-Metrics]:\r\n            LOAD *,\r\n                MonthName(MakeDate(2012, $(vMonth), 1)) as MonthName\r\n            EXTENSION PyTools.sklearn_Calculate_Metrics_Sequence(TEMP_SAMPLES_WITH_KEYS{Model_Name, Key, N_Features});\r\n\r\n\r\n \r\n\r\n**Environment:**\r\n - Windows Server\r\n - Qlik Sense Enterprise november 2020\r\n - SSE Version PY-tools 8.0\r\n\r\n**Additional context**\r\nIn searching the web in general for solutions it seems that h5py needs to be <2.5 and some have had success using a different solver than lbfgs.\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/nabeel-oz/qlik-py-tools/issues/121/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nabeel-oz/qlik-py-tools/issues/121/timeline","performed_via_github_app":null,"state_reason":null}