[{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/498118768","html_url":"https://github.com/experiencor/keras-yolo3/issues/159#issuecomment-498118768","issue_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/159","id":498118768,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODExODc2OA==","user":{"login":"lingshaokun","id":28345084,"node_id":"MDQ6VXNlcjI4MzQ1MDg0","avatar_url":"https://avatars.githubusercontent.com/u/28345084?v=4","gravatar_id":"","url":"https://api.github.com/users/lingshaokun","html_url":"https://github.com/lingshaokun","followers_url":"https://api.github.com/users/lingshaokun/followers","following_url":"https://api.github.com/users/lingshaokun/following{/other_user}","gists_url":"https://api.github.com/users/lingshaokun/gists{/gist_id}","starred_url":"https://api.github.com/users/lingshaokun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lingshaokun/subscriptions","organizations_url":"https://api.github.com/users/lingshaokun/orgs","repos_url":"https://api.github.com/users/lingshaokun/repos","events_url":"https://api.github.com/users/lingshaokun/events{/privacy}","received_events_url":"https://api.github.com/users/lingshaokun/received_events","type":"User","site_admin":false},"created_at":"2019-06-03T05:35:23Z","updated_at":"2019-06-03T05:35:23Z","author_association":"NONE","body":"> Hi,\r\n> I just would like to ask, you used dummy_loss function in model compile function as loss function: **train_model.compile(loss=dummy_loss, optimizer=optimizer)**\r\n> \r\n> But According to dummy loss function , it does not calculate any loss.It directly returns : **tf.sqrt(tf.reduce_sum(y_pred))**\r\n> \r\n> Your actual loss calculation is available in **Call(self,x)** function.But why didn't you use this Call(self,x) function in compile rather than dummy_loss function.\r\n> \r\n> I tried it with pretrained yolo_v3 weights and it worked well with dummy loss function.\r\n> I checked all pages and looked for Call(self,x) function but unfortunately you didn't use this function in anywhere of your code.\r\n> \r\n> But I really didn't understand how it worked without of calculating loss function which is available in **Call(self,x)** .\r\n> \r\n> Could you please explain how dummy_loss worked or why you didn't use Call(self,x) in compile as : **train_model.compile(loss=Call optimizer=optimizer)**\r\ncan you solve this problem？ and i get the loss nan all the time.\r\n","reactions":{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/498118768/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lingshaokun","id":28345084,"node_id":"MDQ6VXNlcjI4MzQ1MDg0","avatar_url":"https://avatars.githubusercontent.com/u/28345084?v=4","gravatar_id":"","url":"https://api.github.com/users/lingshaokun","html_url":"https://github.com/lingshaokun","followers_url":"https://api.github.com/users/lingshaokun/followers","following_url":"https://api.github.com/users/lingshaokun/following{/other_user}","gists_url":"https://api.github.com/users/lingshaokun/gists{/gist_id}","starred_url":"https://api.github.com/users/lingshaokun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lingshaokun/subscriptions","organizations_url":"https://api.github.com/users/lingshaokun/orgs","repos_url":"https://api.github.com/users/lingshaokun/repos","events_url":"https://api.github.com/users/lingshaokun/events{/privacy}","received_events_url":"https://api.github.com/users/lingshaokun/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/502909512","html_url":"https://github.com/experiencor/keras-yolo3/issues/159#issuecomment-502909512","issue_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/159","id":502909512,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMjkwOTUxMg==","user":{"login":"xxzfeng","id":46124999,"node_id":"MDQ6VXNlcjQ2MTI0OTk5","avatar_url":"https://avatars.githubusercontent.com/u/46124999?v=4","gravatar_id":"","url":"https://api.github.com/users/xxzfeng","html_url":"https://github.com/xxzfeng","followers_url":"https://api.github.com/users/xxzfeng/followers","following_url":"https://api.github.com/users/xxzfeng/following{/other_user}","gists_url":"https://api.github.com/users/xxzfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/xxzfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xxzfeng/subscriptions","organizations_url":"https://api.github.com/users/xxzfeng/orgs","repos_url":"https://api.github.com/users/xxzfeng/repos","events_url":"https://api.github.com/users/xxzfeng/events{/privacy}","received_events_url":"https://api.github.com/users/xxzfeng/received_events","type":"User","site_admin":false},"created_at":"2019-06-18T01:29:17Z","updated_at":"2019-06-18T01:29:17Z","author_association":"NONE","body":"Hi,\r\nI just would like to ask, you used dummy_loss function in model compile function as loss function: train_model.compile(loss=dummy_loss, optimizer=optimizer)\r\n\r\nBut According to dummy loss function , it does not calculate any loss.It directly returns : tf.sqrt(tf.reduce_sum(y_pred))\r\n\r\nYour actual loss calculation is available in Call(self,x) function.But why didn't you use this Call(self,x) function in compile rather than dummy_loss function.\r\n\r\nI tried it with pretrained yolo_v3 weights and it worked well with dummy loss function.\r\nI checked all pages and looked for Call(self,x) function but unfortunately you didn't use this function in anywhere of your code.\r\n\r\nBut I really didn't understand how it worked without of calculating loss function which is available in Call(self,x) .\r\n\r\nCould you please explain how dummy_loss worked or why you didn't use Call(self,x) in compile as : train_model.compile(loss=Call optimizer=optimizer)\r\ncan you solve this problem？ and i get the loss nan all the time.","reactions":{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/502909512/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"xxzfeng","id":46124999,"node_id":"MDQ6VXNlcjQ2MTI0OTk5","avatar_url":"https://avatars.githubusercontent.com/u/46124999?v=4","gravatar_id":"","url":"https://api.github.com/users/xxzfeng","html_url":"https://github.com/xxzfeng","followers_url":"https://api.github.com/users/xxzfeng/followers","following_url":"https://api.github.com/users/xxzfeng/following{/other_user}","gists_url":"https://api.github.com/users/xxzfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/xxzfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xxzfeng/subscriptions","organizations_url":"https://api.github.com/users/xxzfeng/orgs","repos_url":"https://api.github.com/users/xxzfeng/repos","events_url":"https://api.github.com/users/xxzfeng/events{/privacy}","received_events_url":"https://api.github.com/users/xxzfeng/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/502927680","html_url":"https://github.com/experiencor/keras-yolo3/issues/159#issuecomment-502927680","issue_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/159","id":502927680,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMjkyNzY4MA==","user":{"login":"kabrau","id":2559616,"node_id":"MDQ6VXNlcjI1NTk2MTY=","avatar_url":"https://avatars.githubusercontent.com/u/2559616?v=4","gravatar_id":"","url":"https://api.github.com/users/kabrau","html_url":"https://github.com/kabrau","followers_url":"https://api.github.com/users/kabrau/followers","following_url":"https://api.github.com/users/kabrau/following{/other_user}","gists_url":"https://api.github.com/users/kabrau/gists{/gist_id}","starred_url":"https://api.github.com/users/kabrau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kabrau/subscriptions","organizations_url":"https://api.github.com/users/kabrau/orgs","repos_url":"https://api.github.com/users/kabrau/repos","events_url":"https://api.github.com/users/kabrau/events{/privacy}","received_events_url":"https://api.github.com/users/kabrau/received_events","type":"User","site_admin":false},"created_at":"2019-06-18T03:07:55Z","updated_at":"2019-06-18T03:07:55Z","author_association":"NONE","body":"I'll try to explain, but it is my understanding, in the training, the last layer is loss only, the detection occurs before.\r\nIf you see the layers, the Ground Truth is inputted almost at the end of the net, and the box extraction and class definition of the prediction occur before the last layer, that is, the comparison between predict and ground truth occur at the penultimate layer.\r\n(See create_yolov3_model and YoloLayer)\r\nI hope I have helped you.","reactions":{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/502927680/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kabrau","id":2559616,"node_id":"MDQ6VXNlcjI1NTk2MTY=","avatar_url":"https://avatars.githubusercontent.com/u/2559616?v=4","gravatar_id":"","url":"https://api.github.com/users/kabrau","html_url":"https://github.com/kabrau","followers_url":"https://api.github.com/users/kabrau/followers","following_url":"https://api.github.com/users/kabrau/following{/other_user}","gists_url":"https://api.github.com/users/kabrau/gists{/gist_id}","starred_url":"https://api.github.com/users/kabrau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kabrau/subscriptions","organizations_url":"https://api.github.com/users/kabrau/orgs","repos_url":"https://api.github.com/users/kabrau/repos","events_url":"https://api.github.com/users/kabrau/events{/privacy}","received_events_url":"https://api.github.com/users/kabrau/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/511144584","html_url":"https://github.com/experiencor/keras-yolo3/issues/159#issuecomment-511144584","issue_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/159","id":511144584,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMTE0NDU4NA==","user":{"login":"paapu88","id":6195764,"node_id":"MDQ6VXNlcjYxOTU3NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/6195764?v=4","gravatar_id":"","url":"https://api.github.com/users/paapu88","html_url":"https://github.com/paapu88","followers_url":"https://api.github.com/users/paapu88/followers","following_url":"https://api.github.com/users/paapu88/following{/other_user}","gists_url":"https://api.github.com/users/paapu88/gists{/gist_id}","starred_url":"https://api.github.com/users/paapu88/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paapu88/subscriptions","organizations_url":"https://api.github.com/users/paapu88/orgs","repos_url":"https://api.github.com/users/paapu88/repos","events_url":"https://api.github.com/users/paapu88/events{/privacy}","received_events_url":"https://api.github.com/users/paapu88/received_events","type":"User","site_admin":false},"created_at":"2019-07-13T18:39:05Z","updated_at":"2019-07-13T18:39:05Z","author_association":"NONE","body":"Hi,\r\nUnfortunately this issue is left pretty un-commented in the code. It has to do the fact that yolo3 neural net has three outputs (one for each grid) and in the training there should be a single loss function based on these three outputs. What I have gathered, standard keras cannot handle this. \r\n\r\nThe way around seems to be in this code:\r\nDuring the training, the three grids are trained independently on each other.\r\nLoss is the 'dummy_loss' (in the end of yolo.py) which drives the fitting to minimize the prediction, which in case of training is sum of losses of those three grids. So minimizing dummy loss is the same as minimising the prediction (the output of the neural net) in the training phase (that is the sum of [loss_yolo_1, loss_yolo_2, loss_yolo_3] ).\r\n\r\nYou can see in the code, that the input and output of the neural net differs in case of training and prediction (in the end of yolo.py)\r\n  \r\n\r\n>   train_model = Model([input_image, true_boxes, true_yolo_1, true_yolo_2, true_yolo_3], [loss_yolo_1, loss_yolo_2, loss_yolo_3])\r\n>     infer_model = Model(input_image, [pred_yolo_1, pred_yolo_2, pred_yolo_3])\r\n> \r\n\r\nTerveisin, Markus\r\n","reactions":{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/511144584/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"paapu88","id":6195764,"node_id":"MDQ6VXNlcjYxOTU3NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/6195764?v=4","gravatar_id":"","url":"https://api.github.com/users/paapu88","html_url":"https://github.com/paapu88","followers_url":"https://api.github.com/users/paapu88/followers","following_url":"https://api.github.com/users/paapu88/following{/other_user}","gists_url":"https://api.github.com/users/paapu88/gists{/gist_id}","starred_url":"https://api.github.com/users/paapu88/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paapu88/subscriptions","organizations_url":"https://api.github.com/users/paapu88/orgs","repos_url":"https://api.github.com/users/paapu88/repos","events_url":"https://api.github.com/users/paapu88/events{/privacy}","received_events_url":"https://api.github.com/users/paapu88/received_events","type":"User","site_admin":false}}]