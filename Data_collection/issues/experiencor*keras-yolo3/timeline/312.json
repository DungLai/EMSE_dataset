[{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/850747203","html_url":"https://github.com/experiencor/keras-yolo3/issues/312#issuecomment-850747203","issue_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/312","id":850747203,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MDc0NzIwMw==","user":{"login":"lexuansanh","id":38468965,"node_id":"MDQ6VXNlcjM4NDY4OTY1","avatar_url":"https://avatars.githubusercontent.com/u/38468965?v=4","gravatar_id":"","url":"https://api.github.com/users/lexuansanh","html_url":"https://github.com/lexuansanh","followers_url":"https://api.github.com/users/lexuansanh/followers","following_url":"https://api.github.com/users/lexuansanh/following{/other_user}","gists_url":"https://api.github.com/users/lexuansanh/gists{/gist_id}","starred_url":"https://api.github.com/users/lexuansanh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexuansanh/subscriptions","organizations_url":"https://api.github.com/users/lexuansanh/orgs","repos_url":"https://api.github.com/users/lexuansanh/repos","events_url":"https://api.github.com/users/lexuansanh/events{/privacy}","received_events_url":"https://api.github.com/users/lexuansanh/received_events","type":"User","site_admin":false},"created_at":"2021-05-29T01:41:34Z","updated_at":"2021-05-29T01:50:48Z","author_association":"NONE","body":"true_boxes = (1, 1, 1, max_box_per_image, 4)\r\n4 is for (center_x, center_y, w,h)) with center_x,center_y are center of object and depend on grid cell. in other word center_x, center_y is in the range (0,13.0) or (0,26.) or(0.52.):\r\nw,h are shape of object which was output of  _aug_image function in BatchGenerator Class\r\ntrue_boxs is reshape to (1,1,1, max_box_per_image,4) to compute broadcasting instead of using multi loops\r\nAnd if you wish add four detection scales instead of 3. You must modify your model. Because yolov3 Model has 3 output with shapes are (None ,13,13, 3*(4+1+ number_class)),  (None, 26,26, 3*(4+1+ number_class)) and (None, 52,52, 3*(4+1+ number_class)). it means you must modify both backbone(Darknet53) and it's output\r\n\r\nYou should check YoloLayer and BatchGenerator Class to have more information","reactions":{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/850747203/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lexuansanh","id":38468965,"node_id":"MDQ6VXNlcjM4NDY4OTY1","avatar_url":"https://avatars.githubusercontent.com/u/38468965?v=4","gravatar_id":"","url":"https://api.github.com/users/lexuansanh","html_url":"https://github.com/lexuansanh","followers_url":"https://api.github.com/users/lexuansanh/followers","following_url":"https://api.github.com/users/lexuansanh/following{/other_user}","gists_url":"https://api.github.com/users/lexuansanh/gists{/gist_id}","starred_url":"https://api.github.com/users/lexuansanh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexuansanh/subscriptions","organizations_url":"https://api.github.com/users/lexuansanh/orgs","repos_url":"https://api.github.com/users/lexuansanh/repos","events_url":"https://api.github.com/users/lexuansanh/events{/privacy}","received_events_url":"https://api.github.com/users/lexuansanh/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/850838456","html_url":"https://github.com/experiencor/keras-yolo3/issues/312#issuecomment-850838456","issue_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/312","id":850838456,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MDgzODQ1Ng==","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false},"created_at":"2021-05-29T14:01:11Z","updated_at":"2021-05-29T14:07:46Z","author_association":"NONE","body":"> true_boxes = (1, 1, 1, max_box_per_image, 4)\r\n> 4 is for (center_x, center_y, w,h)) with center_x,center_y are center of object and depend on grid cell. in other word center_x, center_y is in the range (0,13.0) or (0,26.) or(0.52.):\r\n> w,h are shape of object which was output of _aug_image function in BatchGenerator Class\r\n> true_boxs is reshape to (1,1,1, max_box_per_image,4) to compute broadcasting instead of using multi loops\r\n> And if you wish add four detection scales instead of 3. You must modify your model. Because yolov3 Model has 3 output with shapes are (None ,13,13, 3*(4+1+ number_class)), (None, 26,26, 3*(4+1+ number_class)) and (None, 52,52, 3*(4+1+ number_class)). it means you must modify both backbone(Darknet53) and it's output\r\n> \r\n> You should check YoloLayer and BatchGenerator Class to have more information\r\n\r\nThank you very much for replying so quickly. Just one more question: line 237 in yolo.py.\r\n`true_yolo_1 = Input(shape=(None, None, len(anchors)//6, 4+1+nb_class)) # grid_h, grid_w, nb_anchor, 5+nb_class`\r\nThe original yolov3 model has 9 anchors, and I am assuming it is 3 anchors per detection layer, so I changed generating 9 anchors to 12 in gen_anchors.py. Would that mean, to keep the 3 anchors per detection layer constant, I would have to change the above code to \r\n`true_yolo_1 = Input(shape=(None, None, len(anchors)//8, 4+1+nb_class)) # grid_h, grid_w, nb_anchor, 5+nb_class`?\r\n9 (#  of anchors in original) * 2  / 6 coincidentally equals 3, so following the same pattern,  12 (# of anchors) * 2 / 8 = 3. I tried training it and got 0 map so either using 4 detection layers is really bad or I made some errors in implementing it(more likely reason).","reactions":{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/850838456/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/850872035","html_url":"https://github.com/experiencor/keras-yolo3/issues/312#issuecomment-850872035","issue_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/312","id":850872035,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MDg3MjAzNQ==","user":{"login":"lexuansanh","id":38468965,"node_id":"MDQ6VXNlcjM4NDY4OTY1","avatar_url":"https://avatars.githubusercontent.com/u/38468965?v=4","gravatar_id":"","url":"https://api.github.com/users/lexuansanh","html_url":"https://github.com/lexuansanh","followers_url":"https://api.github.com/users/lexuansanh/followers","following_url":"https://api.github.com/users/lexuansanh/following{/other_user}","gists_url":"https://api.github.com/users/lexuansanh/gists{/gist_id}","starred_url":"https://api.github.com/users/lexuansanh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexuansanh/subscriptions","organizations_url":"https://api.github.com/users/lexuansanh/orgs","repos_url":"https://api.github.com/users/lexuansanh/repos","events_url":"https://api.github.com/users/lexuansanh/events{/privacy}","received_events_url":"https://api.github.com/users/lexuansanh/received_events","type":"User","site_admin":false},"created_at":"2021-05-29T17:48:23Z","updated_at":"2021-05-29T17:49:10Z","author_association":"NONE","body":"You have changed true_yolo_box_1, this is not enough. You need to add  true_yolo_box_4, dummy_loss_4 and modify your model to create pred_yolo_4. They are hard to do. Because backbone of model is Darknet53 with 3 output [13,13], [26,26], [52,52]. If you want add 1 more output, maybe it's shape is [104,104] haha","reactions":{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/850872035/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lexuansanh","id":38468965,"node_id":"MDQ6VXNlcjM4NDY4OTY1","avatar_url":"https://avatars.githubusercontent.com/u/38468965?v=4","gravatar_id":"","url":"https://api.github.com/users/lexuansanh","html_url":"https://github.com/lexuansanh","followers_url":"https://api.github.com/users/lexuansanh/followers","following_url":"https://api.github.com/users/lexuansanh/following{/other_user}","gists_url":"https://api.github.com/users/lexuansanh/gists{/gist_id}","starred_url":"https://api.github.com/users/lexuansanh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexuansanh/subscriptions","organizations_url":"https://api.github.com/users/lexuansanh/orgs","repos_url":"https://api.github.com/users/lexuansanh/repos","events_url":"https://api.github.com/users/lexuansanh/events{/privacy}","received_events_url":"https://api.github.com/users/lexuansanh/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/850932795","html_url":"https://github.com/experiencor/keras-yolo3/issues/312#issuecomment-850932795","issue_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/312","id":850932795,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MDkzMjc5NQ==","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false},"created_at":"2021-05-30T03:15:11Z","updated_at":"2021-05-30T03:17:09Z","author_association":"NONE","body":"yolo.py changes\r\n`true_yolo_4 = Input(shape=(None, None, len(anchors)//8, 4+1+nb_class)) # grid_h, grid_w, nb_anchor, 5+nb_class`\r\n```\r\n# added these on after 3rd yolo detection layer \r\nx = _conv_block(x, [{'filter': 64, 'kernel': 1, 'stride': 1, 'bnorm': True, 'leaky': True, 'layer_idx': 108}], do_skip=False)\r\n    # Upsampling\r\n    x = UpSampling2D(2)(x)\r\n    # concatenate\r\n    x = concatenate([x, skip_11])\r\n\r\n    x = _conv_block(x, [{'filter': 64, 'kernel': 1, 'stride': 1, 'bnorm': True,  'leaky': True,  'layer_idx': 111},\r\n                    {'filter': 128, 'kernel': 3, 'stride': 1, 'bnorm': True,  'leaky': True,  'layer_idx': 112},\r\n                    {'filter': 64, 'kernel': 1, 'stride': 1, 'bnorm': True,  'leaky': True,  'layer_idx': 113},\r\n                    {'filter': 128, 'kernel': 3, 'stride': 1, 'bnorm': True,  'leaky': True,  'layer_idx': 114},\r\n                    {'filter': 64, 'kernel': 1, 'stride': 1, 'bnorm': True,  'leaky': True,  'layer_idx': 115}], do_skip=False)\r\n\r\n    pred_yolo_4 = _conv_block(x, [{'filter': 128, 'kernel': 3, 'stride': 1, 'bnorm': True,  'leaky': True, 'layer_idx': 116}, \r\n                            {'filter': (3*(5+nb_class)), 'kernel': 1, 'stride': 1, 'bnorm': False, 'leaky': False, 'layer_idx': 117}], do_skip=False)\r\n    \r\n    loss_yolo_4 = YoloLayer(anchors[:6], \r\n                            [8*num for num in max_grid], \r\n                            batch_size, \r\n                            warmup_batches, \r\n                            ignore_thresh, \r\n                            grid_scales[3],\r\n                            obj_scale,\r\n                            noobj_scale,\r\n                            xywh_scale,\r\n                            class_scale)([input_image, pred_yolo_4, true_yolo_4, true_boxes]) \r\n```\r\nFor the darknet model, I added these lines and added the skip connection in layer 11. Also, at the end, of course I changed the return model variables to:\r\n```\r\ntrain_model = Model([input_image, true_boxes, true_yolo_1, true_yolo_2, true_yolo_3, true_yolo_4], [loss_yolo_1, loss_yolo_2, loss_yolo_3, loss_yolo_4])\r\ninfer_model = Model(input_image, [pred_yolo_1, pred_yolo_2, pred_yolo_3, pred_yolo_4])\r\n\r\n```\r\nIn generator.py, line 61 - 65, I added \r\n```\r\n`yolo_4 = np.zeros((r_bound - l_bound, 8*base_grid_h,  8*base_grid_w, len(self.anchors)//4, 4+1+len(self.labels))) # desired network output 4`\r\nyolos = [yolo_4, yolo_3, yolo_2, yolo_1]\r\ndummy_yolo_4 = np.zeros((r_bound - l_bound, 1))\r\n```\r\nand on line 95\r\n\r\n```\r\n# determine the yolo to be responsible for this bounding box\r\nyolo = yolos[max_index//4]\r\n```\r\nThese were the extent to my changes, along with generating 12 anchors instead of the original 9, changing grid_scales to [1, 1, 1, 1] in config.json, and fixing anchor slices (like changing to anchors[6:12] for loss_yolo_3 in response to changed anchor count) for other three loss_yolos. Still, I get a rather disgusting low map. There was a paper that discussed using 4 detection layers as optimization, so I am sure I somehow messed up in the implementation. ","reactions":{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/850932795/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/850948035","html_url":"https://github.com/experiencor/keras-yolo3/issues/312#issuecomment-850948035","issue_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/312","id":850948035,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MDk0ODAzNQ==","user":{"login":"lexuansanh","id":38468965,"node_id":"MDQ6VXNlcjM4NDY4OTY1","avatar_url":"https://avatars.githubusercontent.com/u/38468965?v=4","gravatar_id":"","url":"https://api.github.com/users/lexuansanh","html_url":"https://github.com/lexuansanh","followers_url":"https://api.github.com/users/lexuansanh/followers","following_url":"https://api.github.com/users/lexuansanh/following{/other_user}","gists_url":"https://api.github.com/users/lexuansanh/gists{/gist_id}","starred_url":"https://api.github.com/users/lexuansanh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexuansanh/subscriptions","organizations_url":"https://api.github.com/users/lexuansanh/orgs","repos_url":"https://api.github.com/users/lexuansanh/repos","events_url":"https://api.github.com/users/lexuansanh/events{/privacy}","received_events_url":"https://api.github.com/users/lexuansanh/received_events","type":"User","site_admin":false},"created_at":"2021-05-30T06:09:33Z","updated_at":"2021-05-30T06:09:33Z","author_association":"NONE","body":"I see you have reasonable changes. You can Model.Summary() to see the size of pred_yolo_4. The image input size should be divisible by this size. like 416/32=13, 416/16 = 26, 416/8 = 52. That's just my opinion. because I haven't tried adding 1 grid for detecting in my model ^^!","reactions":{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/850948035/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lexuansanh","id":38468965,"node_id":"MDQ6VXNlcjM4NDY4OTY1","avatar_url":"https://avatars.githubusercontent.com/u/38468965?v=4","gravatar_id":"","url":"https://api.github.com/users/lexuansanh","html_url":"https://github.com/lexuansanh","followers_url":"https://api.github.com/users/lexuansanh/followers","following_url":"https://api.github.com/users/lexuansanh/following{/other_user}","gists_url":"https://api.github.com/users/lexuansanh/gists{/gist_id}","starred_url":"https://api.github.com/users/lexuansanh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexuansanh/subscriptions","organizations_url":"https://api.github.com/users/lexuansanh/orgs","repos_url":"https://api.github.com/users/lexuansanh/repos","events_url":"https://api.github.com/users/lexuansanh/events{/privacy}","received_events_url":"https://api.github.com/users/lexuansanh/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/851747701","html_url":"https://github.com/experiencor/keras-yolo3/issues/312#issuecomment-851747701","issue_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/312","id":851747701,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MTc0NzcwMQ==","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false},"created_at":"2021-06-01T01:47:03Z","updated_at":"2021-06-01T02:29:14Z","author_association":"NONE","body":"Should I change \r\n`true_boxes = Input(shape=(1, 1, 1, max_box_per_image, 4))`?\r\nSorry, I still don't really understand the point of those 3 1's and if it needs modifying for 4 detection layers. Is there any other thing could have missed? I am still getting 0 map, although using the default one gives 0.80 map.","reactions":{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/851747701/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/851769188","html_url":"https://github.com/experiencor/keras-yolo3/issues/312#issuecomment-851769188","issue_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/312","id":851769188,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MTc2OTE4OA==","user":{"login":"lexuansanh","id":38468965,"node_id":"MDQ6VXNlcjM4NDY4OTY1","avatar_url":"https://avatars.githubusercontent.com/u/38468965?v=4","gravatar_id":"","url":"https://api.github.com/users/lexuansanh","html_url":"https://github.com/lexuansanh","followers_url":"https://api.github.com/users/lexuansanh/followers","following_url":"https://api.github.com/users/lexuansanh/following{/other_user}","gists_url":"https://api.github.com/users/lexuansanh/gists{/gist_id}","starred_url":"https://api.github.com/users/lexuansanh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexuansanh/subscriptions","organizations_url":"https://api.github.com/users/lexuansanh/orgs","repos_url":"https://api.github.com/users/lexuansanh/repos","events_url":"https://api.github.com/users/lexuansanh/events{/privacy}","received_events_url":"https://api.github.com/users/lexuansanh/received_events","type":"User","site_admin":false},"created_at":"2021-06-01T02:59:35Z","updated_at":"2021-06-01T03:00:35Z","author_association":"NONE","body":"We have:\r\ntrue_boxes = Input(shape=(1, 1, 1, max_box_per_image, 4))\r\ny_pred have shape (grid_h, grid_w, 3*(4+1+num_class))\r\nwhen training:\r\ntrue_boxes shape  = (batch_size, 1, 1, 1, max_box_per_image, 4)\r\ny_pred shape  = (batch_size, grid_h, grid_w, 3*(4+1+num_class))\r\nFirstly, y_pred is reshaped to (batch_size, grid_h, grid_w, 3, (4+1+num_class)). then:\r\nRank of true_boxes is 6\r\nRank of y_pred is 5\r\nCheck from line 57 to line 106 of file yolo.py. you will see: To computer IOU, y_pred is expand_dim 1 rank for equal rank of true_boxes. Purpose to broadcasting\r\nSpecifical:\r\n`line 86: pred_xy = tf.expand_dims(pred_box_xy / grid_factor, 4)`\r\n`line 87: pred_wh = tf.expand_dims(tf.exp(pred_box_wh) * self.anchors / net_factor, 4)`\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/comments/851769188/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lexuansanh","id":38468965,"node_id":"MDQ6VXNlcjM4NDY4OTY1","avatar_url":"https://avatars.githubusercontent.com/u/38468965?v=4","gravatar_id":"","url":"https://api.github.com/users/lexuansanh","html_url":"https://github.com/lexuansanh","followers_url":"https://api.github.com/users/lexuansanh/followers","following_url":"https://api.github.com/users/lexuansanh/following{/other_user}","gists_url":"https://api.github.com/users/lexuansanh/gists{/gist_id}","starred_url":"https://api.github.com/users/lexuansanh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexuansanh/subscriptions","organizations_url":"https://api.github.com/users/lexuansanh/orgs","repos_url":"https://api.github.com/users/lexuansanh/repos","events_url":"https://api.github.com/users/lexuansanh/events{/privacy}","received_events_url":"https://api.github.com/users/lexuansanh/received_events","type":"User","site_admin":false}},{"id":5795714713,"node_id":"CE_lADOB6qiN842BHqRzwAAAAFZc5aZ","url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/events/5795714713","actor":null,"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-12-20T23:21:41Z","state_reason":null,"performed_via_github_app":null}]