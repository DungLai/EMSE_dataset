{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/230","repository_url":"https://api.github.com/repos/experiencor/keras-yolo3","labels_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/230/labels{/name}","comments_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/230/comments","events_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/230/events","html_url":"https://github.com/experiencor/keras-yolo3/issues/230","id":512184968,"node_id":"MDU6SXNzdWU1MTIxODQ5Njg=","number":230,"title":"Increasing number of anchors for training","user":{"login":"AceMcAwesome","id":30783267,"node_id":"MDQ6VXNlcjMwNzgzMjY3","avatar_url":"https://avatars.githubusercontent.com/u/30783267?v=4","gravatar_id":"","url":"https://api.github.com/users/AceMcAwesome","html_url":"https://github.com/AceMcAwesome","followers_url":"https://api.github.com/users/AceMcAwesome/followers","following_url":"https://api.github.com/users/AceMcAwesome/following{/other_user}","gists_url":"https://api.github.com/users/AceMcAwesome/gists{/gist_id}","starred_url":"https://api.github.com/users/AceMcAwesome/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AceMcAwesome/subscriptions","organizations_url":"https://api.github.com/users/AceMcAwesome/orgs","repos_url":"https://api.github.com/users/AceMcAwesome/repos","events_url":"https://api.github.com/users/AceMcAwesome/events{/privacy}","received_events_url":"https://api.github.com/users/AceMcAwesome/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-10-24T21:15:09Z","updated_at":"2020-07-22T08:24:42Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"I would like to increase the number of anchors from 9 to 18 for training, since I read this can improve accuracy (I am not concerned about model runtime, and it is very important for the box to fit tightly to the boundary of the objects for this project).  I used gen_anchors.py to create 18 anchors, and copied these into the config.json file.  I also doubled the anchor values in the YoloLayer definitions within the yolo.py file:\r\n\r\nloss_yolo_1 = YoloLayer(anchors[24:], \r\n                            [1*num for num in max_grid], \r\n                            batch_size, \r\n                            warmup_batches, \r\n                            ignore_thresh, \r\n                            grid_scales[0],\r\n                            obj_scale,\r\n                            noobj_scale,\r\n                            xywh_scale,\r\n                            class_scale)([input_image, pred_yolo_1, true_yolo_1, true_boxes])\r\n\r\n    loss_yolo_2 = YoloLayer(anchors[12:24], \r\n                            [2*num for num in max_grid], \r\n                            batch_size, \r\n                            warmup_batches, \r\n                            ignore_thresh, \r\n                            grid_scales[1],\r\n                            obj_scale,\r\n                            noobj_scale,\r\n                            xywh_scale,\r\n                            class_scale)([input_image, pred_yolo_2, true_yolo_2, true_boxes])\r\n\r\n    loss_yolo_3 = YoloLayer(anchors[:12], \r\n                            [4*num for num in max_grid], \r\n                            batch_size, \r\n                            warmup_batches, \r\n                            ignore_thresh, \r\n                            grid_scales[2],\r\n                            obj_scale,\r\n                            noobj_scale,\r\n                            xywh_scale,\r\n                            class_scale)([input_image, pred_yolo_3, true_yolo_3, true_boxes]) \r\n\r\n(the original values were 12:, 6:12, :6 instead of 24:, 12:24, :12).  I assume this must be done because the anchors vector is twice as long (tell me if I'm wrong).  However, now I get this error:\r\n\r\nTraceback (most recent call last):\r\n  File \"train.py\", line 282, in <module>\r\n    _main_(args)\r\n  File \"train.py\", line 244, in _main_\r\n    class_scale         = config['train']['class_scale'],\r\n  File \"train.py\", line 131, in create_model\r\n    class_scale         = class_scale\r\n  File \"/home/VRC/robert.harris/keras_yolo3_tube_sub/yolo.py\", line 334, in create_yolov3_model\r\n    class_scale)([input_image, pred_yolo_1, true_yolo_1, true_boxes])\r\n  File \"/home/VRC/robert.harris/keras_yolo3_tube_sub/yolo.py\", line 15, in __init__\r\n    self.anchors        = tf.constant(anchors, dtype='float', shape=[1,1,1,3,2])\r\n  File \"/home/VRC/robert.harris/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/constant_op.py\", line 207, in constant\r\n    value, dtype=dtype, shape=shape, verify_shape=verify_shape))\r\n  File \"/home/VRC/robert.harris/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/tensor_util.py\", line 497, in make_tensor_proto\r\n    (shape_size, nparray.size))\r\nValueError: Too many elements provided. Needed at most 6, but received 12\r\n\r\nmainly, it doesn't like this line:\r\nself.anchors        = tf.constant(anchors, dtype='float', shape=[1,1,1,3,2])\r\n\r\nI get that the tensor no longer has only 6 values but I'm not sure what to do to fix this.  I tried playing around with increasing the vector in that line to \r\nself.anchors        = tf.constant(anchors, dtype='float', shape=[1,1,1,6,2])\r\nso that it would have 12 total numbers to fit to, but then I get errors down in this area:\r\n\r\npred_xy = tf.expand_dims(pred_box_xy / grid_factor, 4)\r\n        pred_wh = tf.expand_dims(tf.exp(pred_box_wh) * self.anchors / net_factor, 4)\r\n        \r\n        pred_wh_half = pred_wh / 2.\r\n        pred_mins    = pred_xy - pred_wh_half\r\n        pred_maxes   = pred_xy + pred_wh_half  \r\n\r\n\r\nIn general, what is the proper way to run training with more than 9 anchors?  Thanks!","closed_by":null,"reactions":{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/230/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/230/timeline","performed_via_github_app":null,"state_reason":null}