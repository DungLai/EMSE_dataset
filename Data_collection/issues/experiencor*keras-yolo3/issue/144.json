{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/144","repository_url":"https://api.github.com/repos/experiencor/keras-yolo3","labels_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/144/labels{/name}","comments_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/144/comments","events_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/144/events","html_url":"https://github.com/experiencor/keras-yolo3/issues/144","id":367220717,"node_id":"MDU6SXNzdWUzNjcyMjA3MTc=","number":144,"title":"Different number of anchors","user":{"login":"deraltefritz","id":2559447,"node_id":"MDQ6VXNlcjI1NTk0NDc=","avatar_url":"https://avatars.githubusercontent.com/u/2559447?v=4","gravatar_id":"","url":"https://api.github.com/users/deraltefritz","html_url":"https://github.com/deraltefritz","followers_url":"https://api.github.com/users/deraltefritz/followers","following_url":"https://api.github.com/users/deraltefritz/following{/other_user}","gists_url":"https://api.github.com/users/deraltefritz/gists{/gist_id}","starred_url":"https://api.github.com/users/deraltefritz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deraltefritz/subscriptions","organizations_url":"https://api.github.com/users/deraltefritz/orgs","repos_url":"https://api.github.com/users/deraltefritz/repos","events_url":"https://api.github.com/users/deraltefritz/events{/privacy}","received_events_url":"https://api.github.com/users/deraltefritz/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-10-05T13:50:54Z","updated_at":"2019-07-24T13:57:13Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Hi,\r\n\r\nhas anyone ever tried to use more or less anchors than the default (=9)?\r\n\r\nEven though \"gen_anchors.py\" allows for more anchors to be computed, \"yolo.py\" seems to be hard coded to exactly 9 anchors.\r\n\r\nIt's clear that the number of anchors must be divisible by 3 (each 'YoloLayer' is passed one third of the anchors). So I tried changing the calls to YoloLayer:\r\n``\r\nloss_yolo_1 = YoloLayer(anchors_yolo1, #anchors[12:] ...\r\n``\r\n``\r\nloss_yolo_2 = YoloLayer(anchors_yolo2,#anchors[6:12] ... \r\n``\r\n``\r\nloss_yolo_3 = YoloLayer(anchors_yolo3,#anchors[:6] ...\r\n``\r\nand made sure that \"anchors_yolo1\" etc.  contain one third of the anchors:\r\n``\r\nanchors = [4, 11, 4, 72, 14, 113, 17, 329, 18, 22, 27, 48, 40, 88, 54, 278, 85, 36, 92, 99, 259, 107, 321, 313]\r\n``\r\n``\r\nanchors_yolo1 = [85, 36, 92, 99, 259, 107, 321, 313]\r\n``\r\n``\r\nanchors_yolo2 = [18, 22, 27, 48, 40, 88, 54, 278]\r\n``\r\n``\r\nanchors_yolo3 = [4, 11, 4, 72, 14, 113, 17, 329]\r\n``\r\n\r\nBut then I ran into the following error:\r\n\r\n``\r\nInvalidArgumentError: Dimensions must be equal, but are 3 and 4 for 'yolo_layer_1/mul' (op: 'Mul') with input shapes: [?,?,?,3,?], [1,1,1,4,2].\r\n---> 94         pred_wh = tf.expand_dims(tf.exp(pred_box_wh) * self.anchors / net_factor, 4)\r\n``\r\n\r\nI have a hunch that the 3 in this line \r\n``\r\n\\# adjust the shape of the y_predict [batch, grid_h, grid_w, 3, 4+1+nb_class]\r\n``\r\n``\r\ny_pred = tf.reshape(y_pred, tf.concat([tf.shape(y_pred)[:3], tf.constant([3, -1])], axis=0))\r\n``\r\nrelates to the default 3 anchors per layer, and tried changing it to the number of anchors per layer (4 in the example above). But that just leads to further errors:\r\n\r\n``\r\nInvalidArgumentError: Dimensions must be equal, but are 3 and 4 for 'yolo_layer_1/add' (op: 'Add') with input shapes: [4,?,?,3,2], [?,?,?,18,4,?].\r\n---> 66         pred_box_xy    = (self.cell_grid[:,:grid_h,:grid_w,:,:] + tf.sigmoid(y_pred[..., :2]))  # sigma(t_xy) + c_xy\r\n``\r\n\r\nCould anyone tell me what changes are necessary to have an arbitrary (divisible by 3) number of anchors?\r\n\r\nThank you!\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/144/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/experiencor/keras-yolo3/issues/144/timeline","performed_via_github_app":null,"state_reason":null}