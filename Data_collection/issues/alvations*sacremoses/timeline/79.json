[{"id":2826510486,"node_id":"MDEyOkxhYmVsZWRFdmVudDI4MjY1MTA0ODY=","url":"https://api.github.com/repos/alvations/sacremoses/issues/events/2826510486","actor":{"login":"alvations","id":1050316,"node_id":"MDQ6VXNlcjEwNTAzMTY=","avatar_url":"https://avatars.githubusercontent.com/u/1050316?v=4","gravatar_id":"","url":"https://api.github.com/users/alvations","html_url":"https://github.com/alvations","followers_url":"https://api.github.com/users/alvations/followers","following_url":"https://api.github.com/users/alvations/following{/other_user}","gists_url":"https://api.github.com/users/alvations/gists{/gist_id}","starred_url":"https://api.github.com/users/alvations/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alvations/subscriptions","organizations_url":"https://api.github.com/users/alvations/orgs","repos_url":"https://api.github.com/users/alvations/repos","events_url":"https://api.github.com/users/alvations/events{/privacy}","received_events_url":"https://api.github.com/users/alvations/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-11-25T02:44:26Z","label":{"name":"help wanted","color":"008672"},"performed_via_github_app":null},{"id":2826510487,"node_id":"MDEyOkxhYmVsZWRFdmVudDI4MjY1MTA0ODc=","url":"https://api.github.com/repos/alvations/sacremoses/issues/events/2826510487","actor":{"login":"alvations","id":1050316,"node_id":"MDQ6VXNlcjEwNTAzMTY=","avatar_url":"https://avatars.githubusercontent.com/u/1050316?v=4","gravatar_id":"","url":"https://api.github.com/users/alvations","html_url":"https://github.com/alvations","followers_url":"https://api.github.com/users/alvations/followers","following_url":"https://api.github.com/users/alvations/following{/other_user}","gists_url":"https://api.github.com/users/alvations/gists{/gist_id}","starred_url":"https://api.github.com/users/alvations/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alvations/subscriptions","organizations_url":"https://api.github.com/users/alvations/orgs","repos_url":"https://api.github.com/users/alvations/repos","events_url":"https://api.github.com/users/alvations/events{/privacy}","received_events_url":"https://api.github.com/users/alvations/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-11-25T02:44:26Z","label":{"name":"question","color":"d876e3"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/alvations/sacremoses/issues/comments/607632467","html_url":"https://github.com/alvations/sacremoses/issues/79#issuecomment-607632467","issue_url":"https://api.github.com/repos/alvations/sacremoses/issues/79","id":607632467,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNzYzMjQ2Nw==","user":{"login":"goodmami","id":1428419,"node_id":"MDQ6VXNlcjE0Mjg0MTk=","avatar_url":"https://avatars.githubusercontent.com/u/1428419?v=4","gravatar_id":"","url":"https://api.github.com/users/goodmami","html_url":"https://github.com/goodmami","followers_url":"https://api.github.com/users/goodmami/followers","following_url":"https://api.github.com/users/goodmami/following{/other_user}","gists_url":"https://api.github.com/users/goodmami/gists{/gist_id}","starred_url":"https://api.github.com/users/goodmami/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/goodmami/subscriptions","organizations_url":"https://api.github.com/users/goodmami/orgs","repos_url":"https://api.github.com/users/goodmami/repos","events_url":"https://api.github.com/users/goodmami/events{/privacy}","received_events_url":"https://api.github.com/users/goodmami/received_events","type":"User","site_admin":false},"created_at":"2020-04-02T05:40:24Z","updated_at":"2020-04-02T05:40:24Z","author_association":"NONE","body":"The first issue is whether Python's `str.split()` uses the same definition of a space as `\\s` in Python regular expressions. To test this, I got took the [list of unicode whitespace characters from Wikipedia](https://en.wikipedia.org/wiki/Whitespace_character) and compared `str.split()` with `re.sub()`:\r\n\r\n```python\r\nimport re\r\n\r\nspaces = (\r\n  '\\t',      # tab\r\n  '\\n',      # newline\r\n  '\\v',      # vertical tab\r\n  '\\f',      # form feed\r\n  '\\r',      # carriage return\r\n  '  ',      # space\r\n  '\\u0085',  # next line\r\n  '\\u00a0',  # non-breaking space\r\n  '\\u1680',  # ogham space mark\r\n  '\\u2000',  # en quad\r\n  '\\u2001',  # em quad\r\n  '\\u2002',  # en space\r\n  '\\u2003',  # em space\r\n  '\\u2004',  # three-per-em space\r\n  '\\u2005',  # four-per-em space\r\n  '\\u2006',  # six-per-em space\r\n  '\\u2007',  # figure space\r\n  '\\u2008',  # punctuation space\r\n  '\\u2009',  # thin space\r\n  '\\u200a',  # hair space\r\n  '\\u2028',  # line separator\r\n  '\\u2029',  # paragraph separator\r\n  '\\u202f',  # narrow no-break space\r\n  '\\u205f',  # medium mathematical space\r\n  '\\u3000',  # ideographic space\r\n)\r\n\r\nfor sp in spaces:\r\n    s = f'a{sp}b'\r\n    assert ' '.join(s.split()) == re.sub(r'\\s+', ' ', s)\r\n```\r\n\r\nI get no `AssertionError` when I run this with Python 3.6, so that's good news. Note that this is only the case if the regular expression is compiled in unicode mode, which is the default for Python 3. There may be some implementations or builds of Python that do not consider unicode spaces, but I am ignoring that possibility.\r\n\r\nThe next question is whether `' '.join(s.split())` results in the same output as `re.sub(r'\\s+', ' ', s)`, and this is not always true, particularly when there are leading or trailing spaces:\r\n\r\n```pycon\r\n>>> import re\r\n>>> s = ' a   b '\r\n>>> ' '.join(s.split())\r\n'a b'\r\n>>> re.sub(r'\\s+', ' ', s)\r\n' a b '\r\n```\r\n\r\nAs long as you are currently always doing `s.strip()` before or after the space deduplication, then you should be safe.\r\n\r\nThe final question (that I came up with) is whether doing so has any performance gains. I think in general a simple string operation is faster than invoking the regex engine, and `timeit` confirms it here:\r\n\r\n```console\r\n$ python3 -m timeit -uusec -s 'import re; r = re.compile(r\"\\s+\"); s = \"a \" * 20' '\" \".join(s.split())'\r\n500000 loops, best of 5: 0.521 usec per loop\r\n$ python3 -m timeit -uusec -s 'import re; r = re.compile(r\"\\s+\"); s = \"a \" * 20' 'r.sub(\" \", s)'\r\n100000 loops, best of 5: 3.73 usec per loop\r\n```\r\n\r\nSo assuming you are currently removing leading or trailing spaces, deduplicating spaces with `str.split()` seems like a good idea.","reactions":{"url":"https://api.github.com/repos/alvations/sacremoses/issues/comments/607632467/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"goodmami","id":1428419,"node_id":"MDQ6VXNlcjE0Mjg0MTk=","avatar_url":"https://avatars.githubusercontent.com/u/1428419?v=4","gravatar_id":"","url":"https://api.github.com/users/goodmami","html_url":"https://github.com/goodmami","followers_url":"https://api.github.com/users/goodmami/followers","following_url":"https://api.github.com/users/goodmami/following{/other_user}","gists_url":"https://api.github.com/users/goodmami/gists{/gist_id}","starred_url":"https://api.github.com/users/goodmami/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/goodmami/subscriptions","organizations_url":"https://api.github.com/users/goodmami/orgs","repos_url":"https://api.github.com/users/goodmami/repos","events_url":"https://api.github.com/users/goodmami/events{/privacy}","received_events_url":"https://api.github.com/users/goodmami/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/alvations/sacremoses/issues/comments/612742200","html_url":"https://github.com/alvations/sacremoses/issues/79#issuecomment-612742200","issue_url":"https://api.github.com/repos/alvations/sacremoses/issues/79","id":612742200,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMjc0MjIwMA==","user":{"login":"alvations","id":1050316,"node_id":"MDQ6VXNlcjEwNTAzMTY=","avatar_url":"https://avatars.githubusercontent.com/u/1050316?v=4","gravatar_id":"","url":"https://api.github.com/users/alvations","html_url":"https://github.com/alvations","followers_url":"https://api.github.com/users/alvations/followers","following_url":"https://api.github.com/users/alvations/following{/other_user}","gists_url":"https://api.github.com/users/alvations/gists{/gist_id}","starred_url":"https://api.github.com/users/alvations/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alvations/subscriptions","organizations_url":"https://api.github.com/users/alvations/orgs","repos_url":"https://api.github.com/users/alvations/repos","events_url":"https://api.github.com/users/alvations/events{/privacy}","received_events_url":"https://api.github.com/users/alvations/received_events","type":"User","site_admin":false},"created_at":"2020-04-13T04:16:33Z","updated_at":"2020-04-13T04:16:33Z","author_association":"OWNER","body":"Thanks @goodmami for the analysis!! \r\n\r\nHmmm, seems like considering things like em-space and ideographic space might be problematic because I think it affects other regexes in Moses. Have to take a closer look at other regexes that manipulates/uses these \"alternative\" spaces in the moses' list of regexes.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/alvations/sacremoses/issues/comments/612742200/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"alvations","id":1050316,"node_id":"MDQ6VXNlcjEwNTAzMTY=","avatar_url":"https://avatars.githubusercontent.com/u/1050316?v=4","gravatar_id":"","url":"https://api.github.com/users/alvations","html_url":"https://github.com/alvations","followers_url":"https://api.github.com/users/alvations/followers","following_url":"https://api.github.com/users/alvations/following{/other_user}","gists_url":"https://api.github.com/users/alvations/gists{/gist_id}","starred_url":"https://api.github.com/users/alvations/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alvations/subscriptions","organizations_url":"https://api.github.com/users/alvations/orgs","repos_url":"https://api.github.com/users/alvations/repos","events_url":"https://api.github.com/users/alvations/events{/privacy}","received_events_url":"https://api.github.com/users/alvations/received_events","type":"User","site_admin":false}},{"id":3225880754,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzIyNTg4MDc1NA==","url":"https://api.github.com/repos/alvations/sacremoses/issues/events/3225880754","actor":{"login":"goodmami","id":1428419,"node_id":"MDQ6VXNlcjE0Mjg0MTk=","avatar_url":"https://avatars.githubusercontent.com/u/1428419?v=4","gravatar_id":"","url":"https://api.github.com/users/goodmami","html_url":"https://github.com/goodmami","followers_url":"https://api.github.com/users/goodmami/followers","following_url":"https://api.github.com/users/goodmami/following{/other_user}","gists_url":"https://api.github.com/users/goodmami/gists{/gist_id}","starred_url":"https://api.github.com/users/goodmami/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/goodmami/subscriptions","organizations_url":"https://api.github.com/users/goodmami/orgs","repos_url":"https://api.github.com/users/goodmami/repos","events_url":"https://api.github.com/users/goodmami/events{/privacy}","received_events_url":"https://api.github.com/users/goodmami/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-13T04:16:33Z","performed_via_github_app":null},{"id":3225880755,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyMjU4ODA3NTU=","url":"https://api.github.com/repos/alvations/sacremoses/issues/events/3225880755","actor":{"login":"goodmami","id":1428419,"node_id":"MDQ6VXNlcjE0Mjg0MTk=","avatar_url":"https://avatars.githubusercontent.com/u/1428419?v=4","gravatar_id":"","url":"https://api.github.com/users/goodmami","html_url":"https://github.com/goodmami","followers_url":"https://api.github.com/users/goodmami/followers","following_url":"https://api.github.com/users/goodmami/following{/other_user}","gists_url":"https://api.github.com/users/goodmami/gists{/gist_id}","starred_url":"https://api.github.com/users/goodmami/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/goodmami/subscriptions","organizations_url":"https://api.github.com/users/goodmami/orgs","repos_url":"https://api.github.com/users/goodmami/repos","events_url":"https://api.github.com/users/goodmami/events{/privacy}","received_events_url":"https://api.github.com/users/goodmami/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-13T04:16:33Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/alvations/sacremoses/issues/comments/612744911","html_url":"https://github.com/alvations/sacremoses/issues/79#issuecomment-612744911","issue_url":"https://api.github.com/repos/alvations/sacremoses/issues/79","id":612744911,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMjc0NDkxMQ==","user":{"login":"goodmami","id":1428419,"node_id":"MDQ6VXNlcjE0Mjg0MTk=","avatar_url":"https://avatars.githubusercontent.com/u/1428419?v=4","gravatar_id":"","url":"https://api.github.com/users/goodmami","html_url":"https://github.com/goodmami","followers_url":"https://api.github.com/users/goodmami/followers","following_url":"https://api.github.com/users/goodmami/following{/other_user}","gists_url":"https://api.github.com/users/goodmami/gists{/gist_id}","starred_url":"https://api.github.com/users/goodmami/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/goodmami/subscriptions","organizations_url":"https://api.github.com/users/goodmami/orgs","repos_url":"https://api.github.com/users/goodmami/repos","events_url":"https://api.github.com/users/goodmami/events{/privacy}","received_events_url":"https://api.github.com/users/goodmami/received_events","type":"User","site_admin":false},"created_at":"2020-04-13T04:31:03Z","updated_at":"2020-04-13T04:31:03Z","author_association":"NONE","body":"Yes, all I have shown was that the basic string operations are suitable to replace Python's `re.sub()` if the leading and trailing spaces are accounted for, and I make no claims as to either way's compatibility with Moses. If you're currently using `re.sub()` without trouble, then I don't expect any new issues to arise, but if it differs from Moses in some way, `re.sub()` would be more flexible if you need special-casing.","reactions":{"url":"https://api.github.com/repos/alvations/sacremoses/issues/comments/612744911/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"goodmami","id":1428419,"node_id":"MDQ6VXNlcjE0Mjg0MTk=","avatar_url":"https://avatars.githubusercontent.com/u/1428419?v=4","gravatar_id":"","url":"https://api.github.com/users/goodmami","html_url":"https://github.com/goodmami","followers_url":"https://api.github.com/users/goodmami/followers","following_url":"https://api.github.com/users/goodmami/following{/other_user}","gists_url":"https://api.github.com/users/goodmami/gists{/gist_id}","starred_url":"https://api.github.com/users/goodmami/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/goodmami/subscriptions","organizations_url":"https://api.github.com/users/goodmami/orgs","repos_url":"https://api.github.com/users/goodmami/repos","events_url":"https://api.github.com/users/goodmami/events{/privacy}","received_events_url":"https://api.github.com/users/goodmami/received_events","type":"User","site_admin":false}}]