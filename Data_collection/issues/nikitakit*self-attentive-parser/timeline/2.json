[{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/397160721","html_url":"https://github.com/nikitakit/self-attentive-parser/issues/2#issuecomment-397160721","issue_url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/2","id":397160721,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NzE2MDcyMQ==","user":{"login":"nikitakit","id":252225,"node_id":"MDQ6VXNlcjI1MjIyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/252225?v=4","gravatar_id":"","url":"https://api.github.com/users/nikitakit","html_url":"https://github.com/nikitakit","followers_url":"https://api.github.com/users/nikitakit/followers","following_url":"https://api.github.com/users/nikitakit/following{/other_user}","gists_url":"https://api.github.com/users/nikitakit/gists{/gist_id}","starred_url":"https://api.github.com/users/nikitakit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikitakit/subscriptions","organizations_url":"https://api.github.com/users/nikitakit/orgs","repos_url":"https://api.github.com/users/nikitakit/repos","events_url":"https://api.github.com/users/nikitakit/events{/privacy}","received_events_url":"https://api.github.com/users/nikitakit/received_events","type":"User","site_admin":false},"created_at":"2018-06-14T03:42:23Z","updated_at":"2018-06-14T03:42:23Z","author_association":"OWNER","body":"The `ValueError: No op named ClipByValue in defined operations.` is caused by running an older version of tensorflow. Tensorflow 1.8.0 is required to run the `benepar_en` model. I'm sorry that the tensorflow installation situation is so messy, but it's difficult to solve at the package-manager level because there are separate tensorflow packages for cpu and gpu.\r\n\r\nI can't help about the MemoryError: the parsers are actually quite big when uncompressed. You can download and use `benepar_en_small` instead of `benepar_en` if your machine has insufficient RAM.","reactions":{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/397160721/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nikitakit","id":252225,"node_id":"MDQ6VXNlcjI1MjIyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/252225?v=4","gravatar_id":"","url":"https://api.github.com/users/nikitakit","html_url":"https://github.com/nikitakit","followers_url":"https://api.github.com/users/nikitakit/followers","following_url":"https://api.github.com/users/nikitakit/following{/other_user}","gists_url":"https://api.github.com/users/nikitakit/gists{/gist_id}","starred_url":"https://api.github.com/users/nikitakit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikitakit/subscriptions","organizations_url":"https://api.github.com/users/nikitakit/orgs","repos_url":"https://api.github.com/users/nikitakit/repos","events_url":"https://api.github.com/users/nikitakit/events{/privacy}","received_events_url":"https://api.github.com/users/nikitakit/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/397350910","html_url":"https://github.com/nikitakit/self-attentive-parser/issues/2#issuecomment-397350910","issue_url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/2","id":397350910,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NzM1MDkxMA==","user":{"login":"colingoldberg","id":2991417,"node_id":"MDQ6VXNlcjI5OTE0MTc=","avatar_url":"https://avatars.githubusercontent.com/u/2991417?v=4","gravatar_id":"","url":"https://api.github.com/users/colingoldberg","html_url":"https://github.com/colingoldberg","followers_url":"https://api.github.com/users/colingoldberg/followers","following_url":"https://api.github.com/users/colingoldberg/following{/other_user}","gists_url":"https://api.github.com/users/colingoldberg/gists{/gist_id}","starred_url":"https://api.github.com/users/colingoldberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colingoldberg/subscriptions","organizations_url":"https://api.github.com/users/colingoldberg/orgs","repos_url":"https://api.github.com/users/colingoldberg/repos","events_url":"https://api.github.com/users/colingoldberg/events{/privacy}","received_events_url":"https://api.github.com/users/colingoldberg/received_events","type":"User","site_admin":false},"created_at":"2018-06-14T16:11:02Z","updated_at":"2018-06-14T16:11:02Z","author_association":"NONE","body":"Thank you. Updating tensorflow worked on my mac, and using benepar_en_small on the 2GB EC2 instance worked as well (even as it gave some memory warnings).\r\n\r\nDo you have any recommendations, or experience, for (minimum) memory requirements for benepar_en? \r\n\r\nAs a newcomer to this space, I appreciate any documentation and help, especially examples showing the kinds of things I can do with the results of a parse.\r\n","reactions":{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/397350910/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"colingoldberg","id":2991417,"node_id":"MDQ6VXNlcjI5OTE0MTc=","avatar_url":"https://avatars.githubusercontent.com/u/2991417?v=4","gravatar_id":"","url":"https://api.github.com/users/colingoldberg","html_url":"https://github.com/colingoldberg","followers_url":"https://api.github.com/users/colingoldberg/followers","following_url":"https://api.github.com/users/colingoldberg/following{/other_user}","gists_url":"https://api.github.com/users/colingoldberg/gists{/gist_id}","starred_url":"https://api.github.com/users/colingoldberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colingoldberg/subscriptions","organizations_url":"https://api.github.com/users/colingoldberg/orgs","repos_url":"https://api.github.com/users/colingoldberg/repos","events_url":"https://api.github.com/users/colingoldberg/events{/privacy}","received_events_url":"https://api.github.com/users/colingoldberg/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/397514689","html_url":"https://github.com/nikitakit/self-attentive-parser/issues/2#issuecomment-397514689","issue_url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/2","id":397514689,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NzUxNDY4OQ==","user":{"login":"nikitakit","id":252225,"node_id":"MDQ6VXNlcjI1MjIyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/252225?v=4","gravatar_id":"","url":"https://api.github.com/users/nikitakit","html_url":"https://github.com/nikitakit","followers_url":"https://api.github.com/users/nikitakit/followers","following_url":"https://api.github.com/users/nikitakit/following{/other_user}","gists_url":"https://api.github.com/users/nikitakit/gists{/gist_id}","starred_url":"https://api.github.com/users/nikitakit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikitakit/subscriptions","organizations_url":"https://api.github.com/users/nikitakit/orgs","repos_url":"https://api.github.com/users/nikitakit/repos","events_url":"https://api.github.com/users/nikitakit/events{/privacy}","received_events_url":"https://api.github.com/users/nikitakit/received_events","type":"User","site_admin":false},"created_at":"2018-06-15T05:05:40Z","updated_at":"2018-06-15T05:05:40Z","author_association":"OWNER","body":"Thanks for pointing out the memory situation. The `benepar_en` model is around 430 MB when uncompressed. In theory this should be most of the memory that's needed to run the model, but unfortunately there seems to be quite a bit of overhead inside Tensorflow. Steady-state memory consumption on my machine is around 3GB, though I'm not sure how much of that can be garbage collected. I anticipate that a 1-2 GB of RAM (for the ~430MB parameters plus active computations) plus a generous amount of swap space should suffice to run the model. EC2 instances don't normally have swap enabled, which explains why the full-size model won't run.\r\n\r\nMy recommendation for now is to run `benepar_en_small` if you need to reduce memory consumption.\r\n\r\nAnother thing to note is that if your spaCy documents contain many sentences, or if you're using `parse_sents` from the NLTK integration, benepar will parse a batch of sentences at a time. Both `benepar.Parser` and `BeneparComponent` accept a `batch_size` argument, which can be lowered from the default value of 64 (sentences) to reduce memory usage.","reactions":{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/397514689/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nikitakit","id":252225,"node_id":"MDQ6VXNlcjI1MjIyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/252225?v=4","gravatar_id":"","url":"https://api.github.com/users/nikitakit","html_url":"https://github.com/nikitakit","followers_url":"https://api.github.com/users/nikitakit/followers","following_url":"https://api.github.com/users/nikitakit/following{/other_user}","gists_url":"https://api.github.com/users/nikitakit/gists{/gist_id}","starred_url":"https://api.github.com/users/nikitakit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikitakit/subscriptions","organizations_url":"https://api.github.com/users/nikitakit/orgs","repos_url":"https://api.github.com/users/nikitakit/repos","events_url":"https://api.github.com/users/nikitakit/events{/privacy}","received_events_url":"https://api.github.com/users/nikitakit/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/397656600","html_url":"https://github.com/nikitakit/self-attentive-parser/issues/2#issuecomment-397656600","issue_url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/2","id":397656600,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NzY1NjYwMA==","user":{"login":"colingoldberg","id":2991417,"node_id":"MDQ6VXNlcjI5OTE0MTc=","avatar_url":"https://avatars.githubusercontent.com/u/2991417?v=4","gravatar_id":"","url":"https://api.github.com/users/colingoldberg","html_url":"https://github.com/colingoldberg","followers_url":"https://api.github.com/users/colingoldberg/followers","following_url":"https://api.github.com/users/colingoldberg/following{/other_user}","gists_url":"https://api.github.com/users/colingoldberg/gists{/gist_id}","starred_url":"https://api.github.com/users/colingoldberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colingoldberg/subscriptions","organizations_url":"https://api.github.com/users/colingoldberg/orgs","repos_url":"https://api.github.com/users/colingoldberg/repos","events_url":"https://api.github.com/users/colingoldberg/events{/privacy}","received_events_url":"https://api.github.com/users/colingoldberg/received_events","type":"User","site_admin":false},"created_at":"2018-06-15T15:24:41Z","updated_at":"2018-06-15T15:24:41Z","author_association":"NONE","body":"Thank you. One thing I look to do is to transform the parse tree to a dict. If you have any examples, or something close to this, I will appreciate it.","reactions":{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/397656600/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"colingoldberg","id":2991417,"node_id":"MDQ6VXNlcjI5OTE0MTc=","avatar_url":"https://avatars.githubusercontent.com/u/2991417?v=4","gravatar_id":"","url":"https://api.github.com/users/colingoldberg","html_url":"https://github.com/colingoldberg","followers_url":"https://api.github.com/users/colingoldberg/followers","following_url":"https://api.github.com/users/colingoldberg/following{/other_user}","gists_url":"https://api.github.com/users/colingoldberg/gists{/gist_id}","starred_url":"https://api.github.com/users/colingoldberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colingoldberg/subscriptions","organizations_url":"https://api.github.com/users/colingoldberg/orgs","repos_url":"https://api.github.com/users/colingoldberg/repos","events_url":"https://api.github.com/users/colingoldberg/events{/privacy}","received_events_url":"https://api.github.com/users/colingoldberg/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/397845092","html_url":"https://github.com/nikitakit/self-attentive-parser/issues/2#issuecomment-397845092","issue_url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/2","id":397845092,"node_id":"MDEyOklzc3VlQ29tbWVudDM5Nzg0NTA5Mg==","user":{"login":"nikitakit","id":252225,"node_id":"MDQ6VXNlcjI1MjIyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/252225?v=4","gravatar_id":"","url":"https://api.github.com/users/nikitakit","html_url":"https://github.com/nikitakit","followers_url":"https://api.github.com/users/nikitakit/followers","following_url":"https://api.github.com/users/nikitakit/following{/other_user}","gists_url":"https://api.github.com/users/nikitakit/gists{/gist_id}","starred_url":"https://api.github.com/users/nikitakit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikitakit/subscriptions","organizations_url":"https://api.github.com/users/nikitakit/orgs","repos_url":"https://api.github.com/users/nikitakit/repos","events_url":"https://api.github.com/users/nikitakit/events{/privacy}","received_events_url":"https://api.github.com/users/nikitakit/received_events","type":"User","site_admin":false},"created_at":"2018-06-16T23:48:56Z","updated_at":"2018-06-16T23:48:56Z","author_association":"OWNER","body":"What do you mean by transforming the parse tree to a dict?\r\n\r\nA parse tree is a tree data structure, which has very different properties from a dict. For example, children in a parse tree are ordered (while keys in a dict are not, and also can't repeat).\r\n\r\nHere's one way to convert the parse tree to a dict, but this is mostly just an example of how to navigate the parse tree:\r\n```python\r\nimport spacy\r\nfrom benepar.spacy_plugin import BeneparComponent\r\nnlp = spacy.load('en')\r\nnlp.add_pipe(BeneparComponent(\"benepar_en\"))\r\ndoc = nlp(u\"The time for action is now. It's never too late to do something.\")\r\nsent = list(doc.sents)[0]\r\nprint(sent._.parse_string)\r\n\r\n\r\n# Note: doesn't work for the last sentence in a document.\r\n# The bug will be fixed in a new release of benepar, shortly\r\ndef to_dict(span, idx=0):\r\n    if len(span) == 1:\r\n        res = str(span)\r\n    else:\r\n        res = {}\r\n        for i, child_span in enumerate(span._.children):\r\n            res.update(to_dict(child_span, i))\r\n\r\n    labels = list(span._.labels)\r\n    if len(span) == 1:\r\n        labels.append(span[0].tag_)\r\n\r\n    for label in reversed(labels[1:]):\r\n        res = {\"0/\" + label: res}\r\n\r\n    res = {str(idx) + \"/\" + labels[0]: res}\r\n    return res\r\n\r\nprint(to_dict(list(doc.sents)[0]))\r\n```","reactions":{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/397845092/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nikitakit","id":252225,"node_id":"MDQ6VXNlcjI1MjIyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/252225?v=4","gravatar_id":"","url":"https://api.github.com/users/nikitakit","html_url":"https://github.com/nikitakit","followers_url":"https://api.github.com/users/nikitakit/followers","following_url":"https://api.github.com/users/nikitakit/following{/other_user}","gists_url":"https://api.github.com/users/nikitakit/gists{/gist_id}","starred_url":"https://api.github.com/users/nikitakit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikitakit/subscriptions","organizations_url":"https://api.github.com/users/nikitakit/orgs","repos_url":"https://api.github.com/users/nikitakit/repos","events_url":"https://api.github.com/users/nikitakit/events{/privacy}","received_events_url":"https://api.github.com/users/nikitakit/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/398164140","html_url":"https://github.com/nikitakit/self-attentive-parser/issues/2#issuecomment-398164140","issue_url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/2","id":398164140,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODE2NDE0MA==","user":{"login":"colingoldberg","id":2991417,"node_id":"MDQ6VXNlcjI5OTE0MTc=","avatar_url":"https://avatars.githubusercontent.com/u/2991417?v=4","gravatar_id":"","url":"https://api.github.com/users/colingoldberg","html_url":"https://github.com/colingoldberg","followers_url":"https://api.github.com/users/colingoldberg/followers","following_url":"https://api.github.com/users/colingoldberg/following{/other_user}","gists_url":"https://api.github.com/users/colingoldberg/gists{/gist_id}","starred_url":"https://api.github.com/users/colingoldberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colingoldberg/subscriptions","organizations_url":"https://api.github.com/users/colingoldberg/orgs","repos_url":"https://api.github.com/users/colingoldberg/repos","events_url":"https://api.github.com/users/colingoldberg/events{/privacy}","received_events_url":"https://api.github.com/users/colingoldberg/received_events","type":"User","site_admin":false},"created_at":"2018-06-18T19:14:20Z","updated_at":"2018-06-18T19:14:20Z","author_association":"NONE","body":"I accept the limitations you point out. The reason I want to do this is that I need to report results back to a non-python caller using a json structure, and this is best done via a dict (I believe). As long as I manage what I am submitting to be parsed, this should be ok.","reactions":{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/398164140/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"colingoldberg","id":2991417,"node_id":"MDQ6VXNlcjI5OTE0MTc=","avatar_url":"https://avatars.githubusercontent.com/u/2991417?v=4","gravatar_id":"","url":"https://api.github.com/users/colingoldberg","html_url":"https://github.com/colingoldberg","followers_url":"https://api.github.com/users/colingoldberg/followers","following_url":"https://api.github.com/users/colingoldberg/following{/other_user}","gists_url":"https://api.github.com/users/colingoldberg/gists{/gist_id}","starred_url":"https://api.github.com/users/colingoldberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colingoldberg/subscriptions","organizations_url":"https://api.github.com/users/colingoldberg/orgs","repos_url":"https://api.github.com/users/colingoldberg/repos","events_url":"https://api.github.com/users/colingoldberg/events{/privacy}","received_events_url":"https://api.github.com/users/colingoldberg/received_events","type":"User","site_admin":false}},{"id":1686982929,"node_id":"MDExOkNsb3NlZEV2ZW50MTY4Njk4MjkyOQ==","url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/events/1686982929","actor":{"login":"colingoldberg","id":2991417,"node_id":"MDQ6VXNlcjI5OTE0MTc=","avatar_url":"https://avatars.githubusercontent.com/u/2991417?v=4","gravatar_id":"","url":"https://api.github.com/users/colingoldberg","html_url":"https://github.com/colingoldberg","followers_url":"https://api.github.com/users/colingoldberg/followers","following_url":"https://api.github.com/users/colingoldberg/following{/other_user}","gists_url":"https://api.github.com/users/colingoldberg/gists{/gist_id}","starred_url":"https://api.github.com/users/colingoldberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colingoldberg/subscriptions","organizations_url":"https://api.github.com/users/colingoldberg/orgs","repos_url":"https://api.github.com/users/colingoldberg/repos","events_url":"https://api.github.com/users/colingoldberg/events{/privacy}","received_events_url":"https://api.github.com/users/colingoldberg/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2018-06-18T19:14:21Z","state_reason":null,"performed_via_github_app":null}]