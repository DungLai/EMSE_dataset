[{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/397846018","html_url":"https://github.com/nikitakit/self-attentive-parser/issues/3#issuecomment-397846018","issue_url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/3","id":397846018,"node_id":"MDEyOklzc3VlQ29tbWVudDM5Nzg0NjAxOA==","user":{"login":"nikitakit","id":252225,"node_id":"MDQ6VXNlcjI1MjIyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/252225?v=4","gravatar_id":"","url":"https://api.github.com/users/nikitakit","html_url":"https://github.com/nikitakit","followers_url":"https://api.github.com/users/nikitakit/followers","following_url":"https://api.github.com/users/nikitakit/following{/other_user}","gists_url":"https://api.github.com/users/nikitakit/gists{/gist_id}","starred_url":"https://api.github.com/users/nikitakit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikitakit/subscriptions","organizations_url":"https://api.github.com/users/nikitakit/orgs","repos_url":"https://api.github.com/users/nikitakit/repos","events_url":"https://api.github.com/users/nikitakit/events{/privacy}","received_events_url":"https://api.github.com/users/nikitakit/received_events","type":"User","site_admin":false},"created_at":"2018-06-17T00:13:12Z","updated_at":"2018-06-17T00:13:12Z","author_association":"OWNER","body":"In response to your first point: you're completely right that \"update\" should be a verb; machine learning systems do make mistakes.\r\n\r\nThe situation here is a bit worse than usual because there's a verb phrase (VP) with no verb inside, which makes no sense. The reason this happens is that `benepar` doesn't actually do part-of-speech tagging: all tags come from spaCy (or NLTK).\r\n\r\n`benepar` doesn't do its own tagging because several recent parsing papers have found that neural network parsers can work better if you don't considering part-of-speech tagging at all. I'm thinking about how to address the parser/tagger mismatch, but that's still an area for future research.\r\n\r\n---\r\n\r\nIn response to your edit: the way it's implemented `span._.labels` does not include part-of-speech tags, only span labels. Part-of-speech tags in spaCy are accessible using `token.tag_` (e.g. `if len(span) == 1: tag=span[0].tag_`). You can also look at the code I posted in #2. Also, two children may have the same label, so your tree-to-dict conversion may lose nodes due to key collisions.","reactions":{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/397846018/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nikitakit","id":252225,"node_id":"MDQ6VXNlcjI1MjIyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/252225?v=4","gravatar_id":"","url":"https://api.github.com/users/nikitakit","html_url":"https://github.com/nikitakit","followers_url":"https://api.github.com/users/nikitakit/followers","following_url":"https://api.github.com/users/nikitakit/following{/other_user}","gists_url":"https://api.github.com/users/nikitakit/gists{/gist_id}","starred_url":"https://api.github.com/users/nikitakit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikitakit/subscriptions","organizations_url":"https://api.github.com/users/nikitakit/orgs","repos_url":"https://api.github.com/users/nikitakit/repos","events_url":"https://api.github.com/users/nikitakit/events{/privacy}","received_events_url":"https://api.github.com/users/nikitakit/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/398167213","html_url":"https://github.com/nikitakit/self-attentive-parser/issues/3#issuecomment-398167213","issue_url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/3","id":398167213,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODE2NzIxMw==","user":{"login":"colingoldberg","id":2991417,"node_id":"MDQ6VXNlcjI5OTE0MTc=","avatar_url":"https://avatars.githubusercontent.com/u/2991417?v=4","gravatar_id":"","url":"https://api.github.com/users/colingoldberg","html_url":"https://github.com/colingoldberg","followers_url":"https://api.github.com/users/colingoldberg/followers","following_url":"https://api.github.com/users/colingoldberg/following{/other_user}","gists_url":"https://api.github.com/users/colingoldberg/gists{/gist_id}","starred_url":"https://api.github.com/users/colingoldberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colingoldberg/subscriptions","organizations_url":"https://api.github.com/users/colingoldberg/orgs","repos_url":"https://api.github.com/users/colingoldberg/repos","events_url":"https://api.github.com/users/colingoldberg/events{/privacy}","received_events_url":"https://api.github.com/users/colingoldberg/received_events","type":"User","site_admin":false},"created_at":"2018-06-18T19:25:12Z","updated_at":"2018-06-18T19:25:12Z","author_association":"NONE","body":"Thanks for the clarification, although I am not comfortable that \"[ml] systems do make mistakes\" - I do want to be able to rely on its output. It may be that I will be submitting only parts of sentences, depending on what I have that I can work with.\r\n\r\nI added two tests, which may be source for some insight:\r\n\r\n1) \"update that fact in the database\"\r\nproduced:\r\n`\r\n(S (VP (VB update) (NP (DT that) (NN fact)) (PP (IN in) (NP (DT the) (NN database)))))\r\n`\r\nie. \"update\" seen as a verb\r\n\r\n2) \"when a notification is received that a driver is available, update that fact in the database\"\r\n(ie. replacing the word \"then\" with a comma)\r\nproduced:\r\n`\r\n(S (SBAR (WHADVP (WRB when)) (S (NP (DT a) (NN notification)) (VP (VBZ is) (VP (VBN received) (SBAR (IN that) (S (NP (DT a) (NN driver)) (VP (VBZ is) (ADJP (JJ available))))))))) (, ,) (VP (VBP update) (NP (DT that) (NN fact)) (PP (IN in) (NP (DT the) (NN database)))))\r\n`\r\n- different from the output when \"then\" was used\r\n\r\nDoes this information give you anything to consider regarding this question?\r\n\r\nColin Goldberg","reactions":{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/398167213/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"colingoldberg","id":2991417,"node_id":"MDQ6VXNlcjI5OTE0MTc=","avatar_url":"https://avatars.githubusercontent.com/u/2991417?v=4","gravatar_id":"","url":"https://api.github.com/users/colingoldberg","html_url":"https://github.com/colingoldberg","followers_url":"https://api.github.com/users/colingoldberg/followers","following_url":"https://api.github.com/users/colingoldberg/following{/other_user}","gists_url":"https://api.github.com/users/colingoldberg/gists{/gist_id}","starred_url":"https://api.github.com/users/colingoldberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colingoldberg/subscriptions","organizations_url":"https://api.github.com/users/colingoldberg/orgs","repos_url":"https://api.github.com/users/colingoldberg/repos","events_url":"https://api.github.com/users/colingoldberg/events{/privacy}","received_events_url":"https://api.github.com/users/colingoldberg/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/398274732","html_url":"https://github.com/nikitakit/self-attentive-parser/issues/3#issuecomment-398274732","issue_url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/3","id":398274732,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODI3NDczMg==","user":{"login":"nikitakit","id":252225,"node_id":"MDQ6VXNlcjI1MjIyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/252225?v=4","gravatar_id":"","url":"https://api.github.com/users/nikitakit","html_url":"https://github.com/nikitakit","followers_url":"https://api.github.com/users/nikitakit/followers","following_url":"https://api.github.com/users/nikitakit/following{/other_user}","gists_url":"https://api.github.com/users/nikitakit/gists{/gist_id}","starred_url":"https://api.github.com/users/nikitakit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikitakit/subscriptions","organizations_url":"https://api.github.com/users/nikitakit/orgs","repos_url":"https://api.github.com/users/nikitakit/repos","events_url":"https://api.github.com/users/nikitakit/events{/privacy}","received_events_url":"https://api.github.com/users/nikitakit/received_events","type":"User","site_admin":false},"created_at":"2018-06-19T05:01:34Z","updated_at":"2018-06-19T05:01:34Z","author_association":"OWNER","body":"I completely understand that you're dissatisfied with getting the wrong outputs here.\r\n\r\nLike I said before, the part-of-speech tags are provided entirely by spaCy. You can try for yourself by running the tagger without the constituency parser:\r\n```python\r\nimport spacy\r\nnlp = spacy.load('en')\r\n# Note: no BeneparComponent!\r\ndoc = nlp(\"when a notification is received that a driver is available then update that fact in the database\")\r\nprint(doc[11], doc[11].tag_) # update NN\r\n```\r\n\r\nYour best bet may be to swap to a different part-of-speech tagger. Note that I'm not familiar with any of the code or training procedures for these models, so the spaCy team is likely more knowledgeable on this matter.\r\n\r\nI did find that using the spaCy `en_core_web_lg`  gave the correct tag. To install (~800 MB download):\r\n\r\n```bash\r\npython -m spacy download en_core_web_lg\r\n```\r\n\r\nExample:\r\n```python\r\nimport spacy\r\nfrom benepar.spacy_plugin import BeneparComponent\r\nnlp = spacy.load('en_core_web_lg')\r\nnlp.add_pipe(BeneparComponent(\"benepar_en\"))\r\ndoc = nlp(\"when a notification is received that a driver is available then update that fact in the database\")\r\nprint(doc[11], doc[11].tag_) # update VB\r\n\r\nprint(list(doc.sents)[0]._.parse_string)\r\n# (S (SBAR (WHADVP (WRB when)) (S (NP (DT a) (NN notification)) (VP (VBZ is) (VP (VBN received) (SBAR (IN that) (S (NP (DT a) (NN driver)) (VP (VBZ is) (ADJP (JJ available))))))))) (ADVP (RB then)) (VP (VB update) (NP (DT that) (NN fact)) (PP (IN in) (NP (DT the) (NN database)))))\r\n```\r\n\r\nThere's also a medium-size `en_core_web_md` model  (115 MB download), which should be somewhere halfway between `en` and `en_core_web_lg`. I haven't tested how well its tagger does, though.\r\n\r\n-----\r\n\r\nOther options you can try:\r\n* It may be possible to write a rule-based replacement system: any time you see a verb phrase (VP) with no verb (VB or similar) as a child, if there's a single NN as a child then treat that as a verb. This is equivalent to saying that you trust the parse tree output over the the part-of-speech tagger.\r\n* You can use one of the substitutions (1/2) you suggested above. One more modification that another grad student tried for imperatives is to explicitly insert the implied subject \"you\": \"when a notification is received that a driver is available then **you** update that fact in the database\"\r\n\r\nWriting/training a part-of-speech tagger that works jointly with the parser is definitely something I'm thinking about, but like any research project it will require some time to carry out.","reactions":{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/398274732/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nikitakit","id":252225,"node_id":"MDQ6VXNlcjI1MjIyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/252225?v=4","gravatar_id":"","url":"https://api.github.com/users/nikitakit","html_url":"https://github.com/nikitakit","followers_url":"https://api.github.com/users/nikitakit/followers","following_url":"https://api.github.com/users/nikitakit/following{/other_user}","gists_url":"https://api.github.com/users/nikitakit/gists{/gist_id}","starred_url":"https://api.github.com/users/nikitakit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikitakit/subscriptions","organizations_url":"https://api.github.com/users/nikitakit/orgs","repos_url":"https://api.github.com/users/nikitakit/repos","events_url":"https://api.github.com/users/nikitakit/events{/privacy}","received_events_url":"https://api.github.com/users/nikitakit/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/398398634","html_url":"https://github.com/nikitakit/self-attentive-parser/issues/3#issuecomment-398398634","issue_url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/3","id":398398634,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODM5ODYzNA==","user":{"login":"colingoldberg","id":2991417,"node_id":"MDQ6VXNlcjI5OTE0MTc=","avatar_url":"https://avatars.githubusercontent.com/u/2991417?v=4","gravatar_id":"","url":"https://api.github.com/users/colingoldberg","html_url":"https://github.com/colingoldberg","followers_url":"https://api.github.com/users/colingoldberg/followers","following_url":"https://api.github.com/users/colingoldberg/following{/other_user}","gists_url":"https://api.github.com/users/colingoldberg/gists{/gist_id}","starred_url":"https://api.github.com/users/colingoldberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colingoldberg/subscriptions","organizations_url":"https://api.github.com/users/colingoldberg/orgs","repos_url":"https://api.github.com/users/colingoldberg/repos","events_url":"https://api.github.com/users/colingoldberg/events{/privacy}","received_events_url":"https://api.github.com/users/colingoldberg/received_events","type":"User","site_admin":false},"created_at":"2018-06-19T13:28:01Z","updated_at":"2018-06-19T13:28:01Z","author_association":"NONE","body":"Thank you for your thoughtful response - there's lots to consider. I am glad to see that a constituency parser is available via spaCy - my sense is that it is an important addition to the resources available.","reactions":{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/398398634/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"colingoldberg","id":2991417,"node_id":"MDQ6VXNlcjI5OTE0MTc=","avatar_url":"https://avatars.githubusercontent.com/u/2991417?v=4","gravatar_id":"","url":"https://api.github.com/users/colingoldberg","html_url":"https://github.com/colingoldberg","followers_url":"https://api.github.com/users/colingoldberg/followers","following_url":"https://api.github.com/users/colingoldberg/following{/other_user}","gists_url":"https://api.github.com/users/colingoldberg/gists{/gist_id}","starred_url":"https://api.github.com/users/colingoldberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colingoldberg/subscriptions","organizations_url":"https://api.github.com/users/colingoldberg/orgs","repos_url":"https://api.github.com/users/colingoldberg/repos","events_url":"https://api.github.com/users/colingoldberg/events{/privacy}","received_events_url":"https://api.github.com/users/colingoldberg/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/404709082","html_url":"https://github.com/nikitakit/self-attentive-parser/issues/3#issuecomment-404709082","issue_url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/3","id":404709082,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDcwOTA4Mg==","user":{"login":"nikitakit","id":252225,"node_id":"MDQ6VXNlcjI1MjIyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/252225?v=4","gravatar_id":"","url":"https://api.github.com/users/nikitakit","html_url":"https://github.com/nikitakit","followers_url":"https://api.github.com/users/nikitakit/followers","following_url":"https://api.github.com/users/nikitakit/following{/other_user}","gists_url":"https://api.github.com/users/nikitakit/gists{/gist_id}","starred_url":"https://api.github.com/users/nikitakit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikitakit/subscriptions","organizations_url":"https://api.github.com/users/nikitakit/orgs","repos_url":"https://api.github.com/users/nikitakit/repos","events_url":"https://api.github.com/users/nikitakit/events{/privacy}","received_events_url":"https://api.github.com/users/nikitakit/received_events","type":"User","site_admin":false},"created_at":"2018-07-13T02:44:54Z","updated_at":"2018-07-13T02:44:54Z","author_association":"OWNER","body":"Closing the issue; hopefully my last comments were able to help you get started on addressing the tagging issues you're seeing\r\n\r\nAs a summary: currently the recommended way of getting the best POS tags is to use the largest spaCy model. Larger spaCy models tend to perform better than smaller ones. The ability to swap out taggers also means that spaCy is likely a better option than NLTK: I am aware of cases where spaCy's tagger outperforms the default NLTK tagger, and I'm not familiar with NLTK taggers beyond the default one.\r\n\r\nParser-tagger consistency is a research direction I'll be looking at in the future, but at the moment I don't have anything new on that front.","reactions":{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/404709082/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nikitakit","id":252225,"node_id":"MDQ6VXNlcjI1MjIyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/252225?v=4","gravatar_id":"","url":"https://api.github.com/users/nikitakit","html_url":"https://github.com/nikitakit","followers_url":"https://api.github.com/users/nikitakit/followers","following_url":"https://api.github.com/users/nikitakit/following{/other_user}","gists_url":"https://api.github.com/users/nikitakit/gists{/gist_id}","starred_url":"https://api.github.com/users/nikitakit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikitakit/subscriptions","organizations_url":"https://api.github.com/users/nikitakit/orgs","repos_url":"https://api.github.com/users/nikitakit/repos","events_url":"https://api.github.com/users/nikitakit/events{/privacy}","received_events_url":"https://api.github.com/users/nikitakit/received_events","type":"User","site_admin":false}},{"id":1731667673,"node_id":"MDExOkNsb3NlZEV2ZW50MTczMTY2NzY3Mw==","url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/events/1731667673","actor":{"login":"nikitakit","id":252225,"node_id":"MDQ6VXNlcjI1MjIyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/252225?v=4","gravatar_id":"","url":"https://api.github.com/users/nikitakit","html_url":"https://github.com/nikitakit","followers_url":"https://api.github.com/users/nikitakit/followers","following_url":"https://api.github.com/users/nikitakit/following{/other_user}","gists_url":"https://api.github.com/users/nikitakit/gists{/gist_id}","starred_url":"https://api.github.com/users/nikitakit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikitakit/subscriptions","organizations_url":"https://api.github.com/users/nikitakit/orgs","repos_url":"https://api.github.com/users/nikitakit/repos","events_url":"https://api.github.com/users/nikitakit/events{/privacy}","received_events_url":"https://api.github.com/users/nikitakit/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2018-07-13T02:44:54Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/450686015","html_url":"https://github.com/nikitakit/self-attentive-parser/issues/3#issuecomment-450686015","issue_url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/3","id":450686015,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDY4NjAxNQ==","user":{"login":"nikitakit","id":252225,"node_id":"MDQ6VXNlcjI1MjIyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/252225?v=4","gravatar_id":"","url":"https://api.github.com/users/nikitakit","html_url":"https://github.com/nikitakit","followers_url":"https://api.github.com/users/nikitakit/followers","following_url":"https://api.github.com/users/nikitakit/following{/other_user}","gists_url":"https://api.github.com/users/nikitakit/gists{/gist_id}","starred_url":"https://api.github.com/users/nikitakit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikitakit/subscriptions","organizations_url":"https://api.github.com/users/nikitakit/orgs","repos_url":"https://api.github.com/users/nikitakit/repos","events_url":"https://api.github.com/users/nikitakit/events{/privacy}","received_events_url":"https://api.github.com/users/nikitakit/received_events","type":"User","site_admin":false},"created_at":"2018-12-31T20:05:19Z","updated_at":"2018-12-31T20:05:19Z","author_association":"OWNER","body":"Update as of v0.1.0: newer models such as `benepar_en2` and `benepar_en2_large` now include an integrated part-of-speech tagger, which appears to be higher-accuracy than the current spaCy models and doesn't make a mistake for this particular example.","reactions":{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/450686015/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nikitakit","id":252225,"node_id":"MDQ6VXNlcjI1MjIyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/252225?v=4","gravatar_id":"","url":"https://api.github.com/users/nikitakit","html_url":"https://github.com/nikitakit","followers_url":"https://api.github.com/users/nikitakit/followers","following_url":"https://api.github.com/users/nikitakit/following{/other_user}","gists_url":"https://api.github.com/users/nikitakit/gists{/gist_id}","starred_url":"https://api.github.com/users/nikitakit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikitakit/subscriptions","organizations_url":"https://api.github.com/users/nikitakit/orgs","repos_url":"https://api.github.com/users/nikitakit/repos","events_url":"https://api.github.com/users/nikitakit/events{/privacy}","received_events_url":"https://api.github.com/users/nikitakit/received_events","type":"User","site_admin":false}}]