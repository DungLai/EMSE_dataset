[{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/1223970092","html_url":"https://github.com/nikitakit/self-attentive-parser/issues/91#issuecomment-1223970092","issue_url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/91","id":1223970092,"node_id":"IC_kwDOB9LuEc5I9E0s","user":{"login":"burak0006","id":57944129,"node_id":"MDQ6VXNlcjU3OTQ0MTI5","avatar_url":"https://avatars.githubusercontent.com/u/57944129?v=4","gravatar_id":"","url":"https://api.github.com/users/burak0006","html_url":"https://github.com/burak0006","followers_url":"https://api.github.com/users/burak0006/followers","following_url":"https://api.github.com/users/burak0006/following{/other_user}","gists_url":"https://api.github.com/users/burak0006/gists{/gist_id}","starred_url":"https://api.github.com/users/burak0006/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/burak0006/subscriptions","organizations_url":"https://api.github.com/users/burak0006/orgs","repos_url":"https://api.github.com/users/burak0006/repos","events_url":"https://api.github.com/users/burak0006/events{/privacy}","received_events_url":"https://api.github.com/users/burak0006/received_events","type":"User","site_admin":false},"created_at":"2022-08-23T12:01:38Z","updated_at":"2022-08-23T12:01:38Z","author_association":"NONE","body":"I encountered the same problem. Even couldn't iterate through `._.parse_string` as it is a nested complicated structure with parenthesis","reactions":{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/1223970092/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"burak0006","id":57944129,"node_id":"MDQ6VXNlcjU3OTQ0MTI5","avatar_url":"https://avatars.githubusercontent.com/u/57944129?v=4","gravatar_id":"","url":"https://api.github.com/users/burak0006","html_url":"https://github.com/burak0006","followers_url":"https://api.github.com/users/burak0006/followers","following_url":"https://api.github.com/users/burak0006/following{/other_user}","gists_url":"https://api.github.com/users/burak0006/gists{/gist_id}","starred_url":"https://api.github.com/users/burak0006/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/burak0006/subscriptions","organizations_url":"https://api.github.com/users/burak0006/orgs","repos_url":"https://api.github.com/users/burak0006/repos","events_url":"https://api.github.com/users/burak0006/events{/privacy}","received_events_url":"https://api.github.com/users/burak0006/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/1264686404","html_url":"https://github.com/nikitakit/self-attentive-parser/issues/91#issuecomment-1264686404","issue_url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/91","id":1264686404,"node_id":"IC_kwDOB9LuEc5LYZVE","user":{"login":"anmolagarwal999","id":54059763,"node_id":"MDQ6VXNlcjU0MDU5NzYz","avatar_url":"https://avatars.githubusercontent.com/u/54059763?v=4","gravatar_id":"","url":"https://api.github.com/users/anmolagarwal999","html_url":"https://github.com/anmolagarwal999","followers_url":"https://api.github.com/users/anmolagarwal999/followers","following_url":"https://api.github.com/users/anmolagarwal999/following{/other_user}","gists_url":"https://api.github.com/users/anmolagarwal999/gists{/gist_id}","starred_url":"https://api.github.com/users/anmolagarwal999/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anmolagarwal999/subscriptions","organizations_url":"https://api.github.com/users/anmolagarwal999/orgs","repos_url":"https://api.github.com/users/anmolagarwal999/repos","events_url":"https://api.github.com/users/anmolagarwal999/events{/privacy}","received_events_url":"https://api.github.com/users/anmolagarwal999/received_events","type":"User","site_admin":false},"created_at":"2022-10-02T16:51:03Z","updated_at":"2022-10-02T16:51:03Z","author_association":"NONE","body":"@burak0006 @LawlAoux \r\nYou can make use of the less complicated version of the parsed string at the leaf to solve this issue.\r\n\r\n\r\n\r\n```python\r\nall_tokens = self.span_obj._.parse_string.split(\"(\")\r\nlabel = all_tokens[1].split(\" \")[0]\r\n```\r\nEg:\r\n![image](https://user-images.githubusercontent.com/54059763/193466025-ad7852d3-1a9d-4bdc-a144-a9ae63e4cd50.png)\r\n\r\n\r\nHere, the parsed strings at the leafs are:\r\n\r\n- (NN Stock)\r\n- (NNS prices)\r\n- (VBD soared)\r\n- ........\r\n","reactions":{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/1264686404/reactions","total_count":1,"+1":0,"-1":1,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"anmolagarwal999","id":54059763,"node_id":"MDQ6VXNlcjU0MDU5NzYz","avatar_url":"https://avatars.githubusercontent.com/u/54059763?v=4","gravatar_id":"","url":"https://api.github.com/users/anmolagarwal999","html_url":"https://github.com/anmolagarwal999","followers_url":"https://api.github.com/users/anmolagarwal999/followers","following_url":"https://api.github.com/users/anmolagarwal999/following{/other_user}","gists_url":"https://api.github.com/users/anmolagarwal999/gists{/gist_id}","starred_url":"https://api.github.com/users/anmolagarwal999/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anmolagarwal999/subscriptions","organizations_url":"https://api.github.com/users/anmolagarwal999/orgs","repos_url":"https://api.github.com/users/anmolagarwal999/repos","events_url":"https://api.github.com/users/anmolagarwal999/events{/privacy}","received_events_url":"https://api.github.com/users/anmolagarwal999/received_events","type":"User","site_admin":false}},{"id":7502285212,"node_id":"MEE_lADOB9LuEc5IdpenzwAAAAG_K8mc","url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/events/7502285212","actor":{"login":"burak0006","id":57944129,"node_id":"MDQ6VXNlcjU3OTQ0MTI5","avatar_url":"https://avatars.githubusercontent.com/u/57944129?v=4","gravatar_id":"","url":"https://api.github.com/users/burak0006","html_url":"https://github.com/burak0006","followers_url":"https://api.github.com/users/burak0006/followers","following_url":"https://api.github.com/users/burak0006/following{/other_user}","gists_url":"https://api.github.com/users/burak0006/gists{/gist_id}","starred_url":"https://api.github.com/users/burak0006/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/burak0006/subscriptions","organizations_url":"https://api.github.com/users/burak0006/orgs","repos_url":"https://api.github.com/users/burak0006/repos","events_url":"https://api.github.com/users/burak0006/events{/privacy}","received_events_url":"https://api.github.com/users/burak0006/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-10-02T16:51:04Z","performed_via_github_app":null},{"id":7502285215,"node_id":"SE_lADOB9LuEc5IdpenzwAAAAG_K8mf","url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/events/7502285215","actor":{"login":"burak0006","id":57944129,"node_id":"MDQ6VXNlcjU3OTQ0MTI5","avatar_url":"https://avatars.githubusercontent.com/u/57944129?v=4","gravatar_id":"","url":"https://api.github.com/users/burak0006","html_url":"https://github.com/burak0006","followers_url":"https://api.github.com/users/burak0006/followers","following_url":"https://api.github.com/users/burak0006/following{/other_user}","gists_url":"https://api.github.com/users/burak0006/gists{/gist_id}","starred_url":"https://api.github.com/users/burak0006/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/burak0006/subscriptions","organizations_url":"https://api.github.com/users/burak0006/orgs","repos_url":"https://api.github.com/users/burak0006/repos","events_url":"https://api.github.com/users/burak0006/events{/privacy}","received_events_url":"https://api.github.com/users/burak0006/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-10-02T16:51:04Z","performed_via_github_app":null},{"id":7502285221,"node_id":"MEE_lADOB9LuEc5IdpenzwAAAAG_K8ml","url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/events/7502285221","actor":{"login":"LawlAoux","id":58605454,"node_id":"MDQ6VXNlcjU4NjA1NDU0","avatar_url":"https://avatars.githubusercontent.com/u/58605454?v=4","gravatar_id":"","url":"https://api.github.com/users/LawlAoux","html_url":"https://github.com/LawlAoux","followers_url":"https://api.github.com/users/LawlAoux/followers","following_url":"https://api.github.com/users/LawlAoux/following{/other_user}","gists_url":"https://api.github.com/users/LawlAoux/gists{/gist_id}","starred_url":"https://api.github.com/users/LawlAoux/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LawlAoux/subscriptions","organizations_url":"https://api.github.com/users/LawlAoux/orgs","repos_url":"https://api.github.com/users/LawlAoux/repos","events_url":"https://api.github.com/users/LawlAoux/events{/privacy}","received_events_url":"https://api.github.com/users/LawlAoux/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-10-02T16:51:04Z","performed_via_github_app":null},{"id":7502285225,"node_id":"SE_lADOB9LuEc5IdpenzwAAAAG_K8mp","url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/events/7502285225","actor":{"login":"LawlAoux","id":58605454,"node_id":"MDQ6VXNlcjU4NjA1NDU0","avatar_url":"https://avatars.githubusercontent.com/u/58605454?v=4","gravatar_id":"","url":"https://api.github.com/users/LawlAoux","html_url":"https://github.com/LawlAoux","followers_url":"https://api.github.com/users/LawlAoux/followers","following_url":"https://api.github.com/users/LawlAoux/following{/other_user}","gists_url":"https://api.github.com/users/LawlAoux/gists{/gist_id}","starred_url":"https://api.github.com/users/LawlAoux/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LawlAoux/subscriptions","organizations_url":"https://api.github.com/users/LawlAoux/orgs","repos_url":"https://api.github.com/users/LawlAoux/repos","events_url":"https://api.github.com/users/LawlAoux/events{/privacy}","received_events_url":"https://api.github.com/users/LawlAoux/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-10-02T16:51:04Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/1327635415","html_url":"https://github.com/nikitakit/self-attentive-parser/issues/91#issuecomment-1327635415","issue_url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/91","id":1327635415,"node_id":"IC_kwDOB9LuEc5PIhvX","user":{"login":"badvision","id":5144198,"node_id":"MDQ6VXNlcjUxNDQxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/5144198?v=4","gravatar_id":"","url":"https://api.github.com/users/badvision","html_url":"https://github.com/badvision","followers_url":"https://api.github.com/users/badvision/followers","following_url":"https://api.github.com/users/badvision/following{/other_user}","gists_url":"https://api.github.com/users/badvision/gists{/gist_id}","starred_url":"https://api.github.com/users/badvision/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/badvision/subscriptions","organizations_url":"https://api.github.com/users/badvision/orgs","repos_url":"https://api.github.com/users/badvision/repos","events_url":"https://api.github.com/users/badvision/events{/privacy}","received_events_url":"https://api.github.com/users/badvision/received_events","type":"User","site_admin":false},"created_at":"2022-11-25T15:35:51Z","updated_at":"2022-11-25T15:35:51Z","author_association":"NONE","body":"I also had the same problem.  Is there some kind of conversion to CNF along the way that causes the API to go bonkers?  The only working solution I could come up with is that which @anmolagarwal999 suggested, but it is unfortunate to have to parse a string constructed of a sentence that is already parsed. :/ A better API is warranted in my opinion.\r\n\r\nIf you pass the parsed_sentence string into this function it will give you an appropriate tree structure.\r\n```\r\n# This was adapted from https://stackoverflow.com/questions/54959875/recursive-parentheses-parser-for-expressions-of-strings\r\ndef parse_tree(sentence):\r\n    stack = []  # or a `collections.deque()` object, which is a little faster\r\n    top = items = []\r\n    for token in filter(None, re.compile(r'(?:([()])|\\s+)').split(sentence)):\r\n        if token == '(':\r\n            stack. Append(items)\r\n            items.append([])\r\n            items = items[-1]\r\n        elif token == ')':\r\n            if not stack:\r\n                raise ValueError(\"Unbalanced parentheses\")\r\n            items = stack.pop()  \r\n        else:\r\n            items. Append(token)\r\n    if stack:\r\n        raise ValueError(\"Unbalanced parentheses\")    \r\n    return top\r\n```\r\n\r\nThis is a tree so it's not convenient to get stuff out of it.  Here is an XPath-like function which you can use to query the structure.\r\n\r\n```\r\ndef find_pos(tree, pos):\r\n    result = []\r\n    if not isinstance(tree[0], str):\r\n        result = [find_pos(subtree, pos) for subtree in tree]\r\n    else:\r\n        pos_parts = pos.split(\"/\")\r\n        if re.match(pos_parts[0], tree[0], flags=re.IGNORECASE):\r\n            if len(pos_parts) == 1:\r\n                return tree[1]\r\n            else:\r\n                result =  [find_pos(subtree, \"/\".join(pos_parts[1:])) for subtree in tree[1:]]\r\n    if len(result) == 0:\r\n        return None\r\n    result = [f for f in result if f is not None]\r\n    if len(result) == 0:\r\n        return None\r\n    elif len(result) == 1:\r\n        return result[0]\r\n    else:\r\n        return result\r\n```\r\n\r\nYou provide the (re-)parsed tree and the desired part of speech (as a string, case insensitive), but you have to specify the path from the root.  For example if your sentence is a S > VP  kind of sentence then getting the verb(s) should be like this: `find_pos(command, 'VP/VB')` and if there is a noun associated with that, `find_pos(command, 'VP/NP/NN.*')` should do.  If you want to get prepositional nouns (go to the store) then you can also use `find_pos(command, 'VP/PP/NP/NN.*')`. Slashes separate tree levels you want to iterate through, but the expressions between the slashes can be complex regex expressions too!  This allows some cleverness if you're careful with it.\r\n\r\nSince I use regular expressions you have to `import re` to use this code.  Enjoy!\r\n\r\n","reactions":{"url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/comments/1327635415/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"badvision","id":5144198,"node_id":"MDQ6VXNlcjUxNDQxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/5144198?v=4","gravatar_id":"","url":"https://api.github.com/users/badvision","html_url":"https://github.com/badvision","followers_url":"https://api.github.com/users/badvision/followers","following_url":"https://api.github.com/users/badvision/following{/other_user}","gists_url":"https://api.github.com/users/badvision/gists{/gist_id}","starred_url":"https://api.github.com/users/badvision/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/badvision/subscriptions","organizations_url":"https://api.github.com/users/badvision/orgs","repos_url":"https://api.github.com/users/badvision/repos","events_url":"https://api.github.com/users/badvision/events{/privacy}","received_events_url":"https://api.github.com/users/badvision/received_events","type":"User","site_admin":false}},{"id":7894007042,"node_id":"MEE_lADOB9LuEc5IdpenzwAAAAHWhP0C","url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/events/7894007042","actor":{"login":"anmolagarwal999","id":54059763,"node_id":"MDQ6VXNlcjU0MDU5NzYz","avatar_url":"https://avatars.githubusercontent.com/u/54059763?v=4","gravatar_id":"","url":"https://api.github.com/users/anmolagarwal999","html_url":"https://github.com/anmolagarwal999","followers_url":"https://api.github.com/users/anmolagarwal999/followers","following_url":"https://api.github.com/users/anmolagarwal999/following{/other_user}","gists_url":"https://api.github.com/users/anmolagarwal999/gists{/gist_id}","starred_url":"https://api.github.com/users/anmolagarwal999/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anmolagarwal999/subscriptions","organizations_url":"https://api.github.com/users/anmolagarwal999/orgs","repos_url":"https://api.github.com/users/anmolagarwal999/repos","events_url":"https://api.github.com/users/anmolagarwal999/events{/privacy}","received_events_url":"https://api.github.com/users/anmolagarwal999/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-11-25T15:35:51Z","performed_via_github_app":null},{"id":7894007047,"node_id":"SE_lADOB9LuEc5IdpenzwAAAAHWhP0H","url":"https://api.github.com/repos/nikitakit/self-attentive-parser/issues/events/7894007047","actor":{"login":"anmolagarwal999","id":54059763,"node_id":"MDQ6VXNlcjU0MDU5NzYz","avatar_url":"https://avatars.githubusercontent.com/u/54059763?v=4","gravatar_id":"","url":"https://api.github.com/users/anmolagarwal999","html_url":"https://github.com/anmolagarwal999","followers_url":"https://api.github.com/users/anmolagarwal999/followers","following_url":"https://api.github.com/users/anmolagarwal999/following{/other_user}","gists_url":"https://api.github.com/users/anmolagarwal999/gists{/gist_id}","starred_url":"https://api.github.com/users/anmolagarwal999/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anmolagarwal999/subscriptions","organizations_url":"https://api.github.com/users/anmolagarwal999/orgs","repos_url":"https://api.github.com/users/anmolagarwal999/repos","events_url":"https://api.github.com/users/anmolagarwal999/events{/privacy}","received_events_url":"https://api.github.com/users/anmolagarwal999/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-11-25T15:35:51Z","performed_via_github_app":null}]