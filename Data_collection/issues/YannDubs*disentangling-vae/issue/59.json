{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/59","repository_url":"https://api.github.com/repos/YannDubs/disentangling-vae","labels_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/59/labels{/name}","comments_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/59/comments","events_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/59/events","html_url":"https://github.com/YannDubs/disentangling-vae/issues/59","id":684194578,"node_id":"MDU6SXNzdWU2ODQxOTQ1Nzg=","number":59,"title":"Doubts about the calculation of H_z","user":{"login":"erow","id":7524356,"node_id":"MDQ6VXNlcjc1MjQzNTY=","avatar_url":"https://avatars.githubusercontent.com/u/7524356?v=4","gravatar_id":"","url":"https://api.github.com/users/erow","html_url":"https://github.com/erow","followers_url":"https://api.github.com/users/erow/followers","following_url":"https://api.github.com/users/erow/following{/other_user}","gists_url":"https://api.github.com/users/erow/gists{/gist_id}","starred_url":"https://api.github.com/users/erow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erow/subscriptions","organizations_url":"https://api.github.com/users/erow/orgs","repos_url":"https://api.github.com/users/erow/repos","events_url":"https://api.github.com/users/erow/events{/privacy}","received_events_url":"https://api.github.com/users/erow/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2020-08-23T14:35:11Z","updated_at":"2020-08-25T10:35:26Z","closed_at":"2020-08-23T16:01:57Z","author_association":"NONE","active_lock_reason":null,"body":"The problem is here `log_q_zCx = log_density_gaussian(samples_zCx[..., idcs],\r\n                                                 mean[..., idcs],\r\n                                                 log_var[..., idcs])`.\r\n\r\n`q_zCx` is a density function, which should be integrated.\r\nTherefore, I write a probability implement. `q_zCx` calculates P(a<=z<=b|x).\r\n```\r\ndef erf(x):\r\n    a1 = 0.278393\r\n    a2 = 0.230389\r\n    a3 = 0.000972\r\n    a4 = 0.078108\r\n    s = torch.sign(x)\r\n    x = x.abs()\r\n    e = 1-1/(1 + a1*x + a2*x**2 + a3*x**3 + a4*x**4)**4\r\n    return s*e\r\n\r\n\r\ndef Gab(a,b,mu,sigma):\r\n    '''\r\n    the probability of z belonging to [a,b]\r\n    :param a:\r\n    :param b:\r\n    :param mu:\r\n    :param sigma:\r\n    :return:\r\n    '''\r\n    inverse_sigma = 1/(math.sqrt(2)*sigma)\r\n    return 0.5 * (erf((b-mu)*inverse_sigma)-\r\n                     erf((a-mu)*inverse_sigma))\r\n\r\nsamples,params,recons,labels = evaluator.compute(test_loader)\r\n\r\nN_x_samples = 1000\r\nM_z_samples = 100\r\nmu,logvar = params\r\nmu,logvar = mu[:N_x_samples],logvar[:N_x_samples]\r\n\r\nmu =mu.view(1,N_x_samples,dim).repeat(M_z_samples,1,1)\r\nlogvar =logvar.view(1,N_x_samples,dim).repeat(M_z_samples,1,1)\r\n\r\nl = torch.linspace(-3,3,M_z_samples+1)\r\nd = l[1]-l[0]\r\na = l[:-1].cuda()\r\nb = l[1:].cuda()\r\n\r\na = a.reshape(-1,1,1).expand(M_z_samples,N_x_samples,dim)\r\nb = b.reshape(-1,1,1).expand(M_z_samples,N_x_samples,dim)\r\n\r\n\r\nq_zCx = Gab(a,b,mu,torch.exp(0.5*logvar))\r\nq_z = q_zCx.mean(1)\r\nH_z = (-q_z*(q_z/d).log()).sum(0) ```","closed_by":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/59/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/59/timeline","performed_via_github_app":null,"state_reason":"completed"}