[{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/778604729","html_url":"https://github.com/YannDubs/disentangling-vae/issues/63#issuecomment-778604729","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/63","id":778604729,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODYwNDcyOQ==","user":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false},"created_at":"2021-02-13T11:40:27Z","updated_at":"2021-02-13T11:40:27Z","author_association":"OWNER","body":"Hi Diane,\r\n\r\nSorry, it's been a while so I don't remember all the design choices. \r\n\r\nIt's not clear to me what structure of data you have. Are you saying that you have multiple images for the same latents ? Or that you don't have all combinations of latents ?\r\n\r\nBoth cases would be doable but you'll have to generalize the computation of H[z|v] here:\r\n\r\nhttps://github.com/YannDubs/disentangling-vae/blob/7b8285baa19d591cf34c652049884aca5d8acbca/disvae/evaluate.py#L299\r\n\r\nright now the computation is very simple because it's easy to condition on `v` .","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/778604729/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/778717100","html_url":"https://github.com/YannDubs/disentangling-vae/issues/63#issuecomment-778717100","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/63","id":778717100,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODcxNzEwMA==","user":{"login":"Justin-Tan","id":27450488,"node_id":"MDQ6VXNlcjI3NDUwNDg4","avatar_url":"https://avatars.githubusercontent.com/u/27450488?v=4","gravatar_id":"","url":"https://api.github.com/users/Justin-Tan","html_url":"https://github.com/Justin-Tan","followers_url":"https://api.github.com/users/Justin-Tan/followers","following_url":"https://api.github.com/users/Justin-Tan/following{/other_user}","gists_url":"https://api.github.com/users/Justin-Tan/gists{/gist_id}","starred_url":"https://api.github.com/users/Justin-Tan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Justin-Tan/subscriptions","organizations_url":"https://api.github.com/users/Justin-Tan/orgs","repos_url":"https://api.github.com/users/Justin-Tan/repos","events_url":"https://api.github.com/users/Justin-Tan/events{/privacy}","received_events_url":"https://api.github.com/users/Justin-Tan/received_events","type":"User","site_admin":false},"created_at":"2021-02-14T03:30:04Z","updated_at":"2021-02-14T03:30:32Z","author_association":"NONE","body":"I've done this for a custom dataset. Here's a simplified version of what I used below. I don't remember all the details as well but essentially you discretize samples from the approximate posterior, compute the mutual information between the discretized samples and the generative factors, then do the rest of the calculation as normal. \r\n\r\nYou probably also want to transform your generative factors to a reasonable range by minmaxscaling e.g.\r\n\r\n```python\r\nfrom sklearn.metrics import mutual_info_score\r\n\r\ndef _histogram_discretize(target, num_bins=20):\r\n    \"\"\"Discretization based on histograms.\"\"\"\r\n    discretized = np.zeros_like(target)\r\n    for i in range(target.shape[0]):\r\n        discretized[i, :] = np.digitize(target[i, :], np.histogram(\r\n            target[i, :], num_bins)[1][:-1])\r\n    return discretized\r\n\r\ndef discrete_mutual_info(z, v):\r\n    \"\"\"\r\n    Compute discrete mutual information.\r\n    z: array-like\r\n        Matrix of learned latent codes, shape [LD, B] where LD is the \r\n        latent dimension. z is taken to be the mean value of the latent\r\n        representation.\r\n    \"\"\"\r\n    num_codes = z.shape[0]\r\n    num_factors = v.shape[0]\r\n    mi = np.zeros([num_codes, num_factors])\r\n    for i in range(num_codes):\r\n        for j in range(num_factors):\r\n            mi[i, j] = mutual_info_score(v[j, :], z[i, :])\r\n    return mi\r\n\r\ndef discrete_entropy(v):\r\n    \"\"\"\r\n    Compute discrete mutual information.\r\n    v: array-like\r\n        Matrix of underlying generative factors, shape [N,B]\r\n        for N ground truth factors\r\n    \"\"\"\r\n    num_factors = v.shape[0]\r\n    H = np.zeros(num_factors)\r\n    for j in range(num_factors):\r\n        H[j] = mutual_info_score(v[j, :], v[j, :])\r\n    return H\r\n\r\n\r\ndef estimate_MIG_discrete(qzCx_samples, gen_factors):\r\n    \r\n    z_discrete = _histogram_discretize(qzCx_samples, num_bins=20)\r\n    mi_discrete = discrete_mutual_info(np.transpose(z_discrete), np.transpose(gen_factors))\r\n    H_v = discrete_entropy(np.transpose(gen_factors))\r\n    sorted_mi_discrete = np.sort(mi_discrete, axis=0)[::-1]\r\n    discrete_metric = np.mean(np.divide(sorted_mi_discrete[0, :] - sorted_mi_discrete[1, :],H_v[:]))\r\n    \r\n    top_mi_normed_discrete = np.divide(sorted_mi_discrete[0,:], H_v)\r\n    top_mi_idx_discrete = np.argsort(mi_discrete, axis=0)[::-1][0,:]\r\n    \r\n    return discrete_metric, top_mi_normed_discrete, top_mi_idx_discrete\r\n```","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/778717100/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Justin-Tan","id":27450488,"node_id":"MDQ6VXNlcjI3NDUwNDg4","avatar_url":"https://avatars.githubusercontent.com/u/27450488?v=4","gravatar_id":"","url":"https://api.github.com/users/Justin-Tan","html_url":"https://github.com/Justin-Tan","followers_url":"https://api.github.com/users/Justin-Tan/followers","following_url":"https://api.github.com/users/Justin-Tan/following{/other_user}","gists_url":"https://api.github.com/users/Justin-Tan/gists{/gist_id}","starred_url":"https://api.github.com/users/Justin-Tan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Justin-Tan/subscriptions","organizations_url":"https://api.github.com/users/Justin-Tan/orgs","repos_url":"https://api.github.com/users/Justin-Tan/repos","events_url":"https://api.github.com/users/Justin-Tan/events{/privacy}","received_events_url":"https://api.github.com/users/Justin-Tan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/778757603","html_url":"https://github.com/YannDubs/disentangling-vae/issues/63#issuecomment-778757603","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/63","id":778757603,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODc1NzYwMw==","user":{"login":"DianeBouchacourt","id":13796686,"node_id":"MDQ6VXNlcjEzNzk2Njg2","avatar_url":"https://avatars.githubusercontent.com/u/13796686?v=4","gravatar_id":"","url":"https://api.github.com/users/DianeBouchacourt","html_url":"https://github.com/DianeBouchacourt","followers_url":"https://api.github.com/users/DianeBouchacourt/followers","following_url":"https://api.github.com/users/DianeBouchacourt/following{/other_user}","gists_url":"https://api.github.com/users/DianeBouchacourt/gists{/gist_id}","starred_url":"https://api.github.com/users/DianeBouchacourt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DianeBouchacourt/subscriptions","organizations_url":"https://api.github.com/users/DianeBouchacourt/orgs","repos_url":"https://api.github.com/users/DianeBouchacourt/repos","events_url":"https://api.github.com/users/DianeBouchacourt/events{/privacy}","received_events_url":"https://api.github.com/users/DianeBouchacourt/received_events","type":"User","site_admin":false},"created_at":"2021-02-14T10:24:42Z","updated_at":"2021-02-14T10:24:42Z","author_association":"NONE","body":"I have multiple images of the same latents (other factors are unknown, and can differ between images but I don't have ground-truth for these, e.g. multiple images of the same person wearing glasses where {glasses, identity} are known but the rest differ).\r\n\r\nThanks for the reply I'll have a look at H[z|v] and at Justin's solution, I'll tell you if I am stuck somewhere :)  ","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/778757603/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"DianeBouchacourt","id":13796686,"node_id":"MDQ6VXNlcjEzNzk2Njg2","avatar_url":"https://avatars.githubusercontent.com/u/13796686?v=4","gravatar_id":"","url":"https://api.github.com/users/DianeBouchacourt","html_url":"https://github.com/DianeBouchacourt","followers_url":"https://api.github.com/users/DianeBouchacourt/followers","following_url":"https://api.github.com/users/DianeBouchacourt/following{/other_user}","gists_url":"https://api.github.com/users/DianeBouchacourt/gists{/gist_id}","starred_url":"https://api.github.com/users/DianeBouchacourt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DianeBouchacourt/subscriptions","organizations_url":"https://api.github.com/users/DianeBouchacourt/orgs","repos_url":"https://api.github.com/users/DianeBouchacourt/repos","events_url":"https://api.github.com/users/DianeBouchacourt/events{/privacy}","received_events_url":"https://api.github.com/users/DianeBouchacourt/received_events","type":"User","site_admin":false}}]