[{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/703967646","html_url":"https://github.com/YannDubs/disentangling-vae/issues/60#issuecomment-703967646","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/60","id":703967646,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMzk2NzY0Ng==","user":{"login":"UserName-AnkitSisodia","id":72349806,"node_id":"MDQ6VXNlcjcyMzQ5ODA2","avatar_url":"https://avatars.githubusercontent.com/u/72349806?v=4","gravatar_id":"","url":"https://api.github.com/users/UserName-AnkitSisodia","html_url":"https://github.com/UserName-AnkitSisodia","followers_url":"https://api.github.com/users/UserName-AnkitSisodia/followers","following_url":"https://api.github.com/users/UserName-AnkitSisodia/following{/other_user}","gists_url":"https://api.github.com/users/UserName-AnkitSisodia/gists{/gist_id}","starred_url":"https://api.github.com/users/UserName-AnkitSisodia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/UserName-AnkitSisodia/subscriptions","organizations_url":"https://api.github.com/users/UserName-AnkitSisodia/orgs","repos_url":"https://api.github.com/users/UserName-AnkitSisodia/repos","events_url":"https://api.github.com/users/UserName-AnkitSisodia/events{/privacy}","received_events_url":"https://api.github.com/users/UserName-AnkitSisodia/received_events","type":"User","site_admin":false},"created_at":"2020-10-06T00:57:43Z","updated_at":"2020-10-06T00:57:43Z","author_association":"NONE","body":"https://github.com/rtqichen/beta-tcvae/ calculates\r\nlogqz_prodmarginals = (logsumexp(_logqz, dim=1, keepdim=False) - math.log(batch_size * dataset_size)).sum(1)\r\nlogqz = (logsumexp(_logqz.sum(2), dim=1, keepdim=False) - math.log(batch_size * dataset_size))\r\nin case of # minibatch weighted sampling\r\n\r\nand in case of # minibatch stratified sampling, they do\r\nlogiw_matrix = Variable(self._log_importance_weight_matrix(batch_size, dataset_size).type_as(_logqz.data))\r\nlogqz = logsumexp(logiw_matrix + _logqz.sum(2), dim=1, keepdim=False)\r\nlogqz_prodmarginals = logsumexp(logiw_matrix.view(batch_size, batch_size, 1) + _logqz, dim=1, keepdim=False).sum(1)\r\n\r\nso in this codebase, shouldn't we also do (in case of NOT is_mss)\r\n\r\n    log_qz = (torch.logsumexp(mat_log_qz.sum(2), dim=1, keepdim=False)-math.log(batch_size*n_data))       \r\n    log_prod_qzi = (torch.logsumexp(mat_log_qz, dim=1, keepdim=False)-math.log(batch_size*n_data)).sum(1)\r\n\r\nand in case of (is_mss)\r\n\r\n        log_iw_mat = log_importance_weight_matrix(batch_size, n_data).to(latent_sample.device)                   \r\n        log_qz = torch.logsumexp(log_iw_mat + mat_log_qz.sum(2), dim=1, keepdim=False)                            \r\n        log_prod_qzi = torch.logsumexp(log_iw_mat.view(batch_size,batch_size,1)+mat_log_qz, dim=1, keepdim=False).sum(1)    ","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/703967646/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"UserName-AnkitSisodia","id":72349806,"node_id":"MDQ6VXNlcjcyMzQ5ODA2","avatar_url":"https://avatars.githubusercontent.com/u/72349806?v=4","gravatar_id":"","url":"https://api.github.com/users/UserName-AnkitSisodia","html_url":"https://github.com/UserName-AnkitSisodia","followers_url":"https://api.github.com/users/UserName-AnkitSisodia/followers","following_url":"https://api.github.com/users/UserName-AnkitSisodia/following{/other_user}","gists_url":"https://api.github.com/users/UserName-AnkitSisodia/gists{/gist_id}","starred_url":"https://api.github.com/users/UserName-AnkitSisodia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/UserName-AnkitSisodia/subscriptions","organizations_url":"https://api.github.com/users/UserName-AnkitSisodia/orgs","repos_url":"https://api.github.com/users/UserName-AnkitSisodia/repos","events_url":"https://api.github.com/users/UserName-AnkitSisodia/events{/privacy}","received_events_url":"https://api.github.com/users/UserName-AnkitSisodia/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/705076248","html_url":"https://github.com/YannDubs/disentangling-vae/issues/60#issuecomment-705076248","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/60","id":705076248,"node_id":"MDEyOklzc3VlQ29tbWVudDcwNTA3NjI0OA==","user":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false},"created_at":"2020-10-07T17:13:35Z","updated_at":"2020-10-07T17:13:35Z","author_association":"OWNER","body":"Thanks @UserName-AnkitSisodia!\r\nI think you might be right (I am taking a sum instead of marginalizing in the log space), but It's been a long time so I'll have to double-check this w-e.\r\n\r\nDid you test it with these changes?\r\n","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/705076248/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false}},{"id":3851654747,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mzg1MTY1NDc0Nw==","url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/events/3851654747","actor":{"login":"UserName-AnkitSisodia","id":72349806,"node_id":"MDQ6VXNlcjcyMzQ5ODA2","avatar_url":"https://avatars.githubusercontent.com/u/72349806?v=4","gravatar_id":"","url":"https://api.github.com/users/UserName-AnkitSisodia","html_url":"https://github.com/UserName-AnkitSisodia","followers_url":"https://api.github.com/users/UserName-AnkitSisodia/followers","following_url":"https://api.github.com/users/UserName-AnkitSisodia/following{/other_user}","gists_url":"https://api.github.com/users/UserName-AnkitSisodia/gists{/gist_id}","starred_url":"https://api.github.com/users/UserName-AnkitSisodia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/UserName-AnkitSisodia/subscriptions","organizations_url":"https://api.github.com/users/UserName-AnkitSisodia/orgs","repos_url":"https://api.github.com/users/UserName-AnkitSisodia/repos","events_url":"https://api.github.com/users/UserName-AnkitSisodia/events{/privacy}","received_events_url":"https://api.github.com/users/UserName-AnkitSisodia/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-10-07T17:13:36Z","performed_via_github_app":null},{"id":3851654749,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM4NTE2NTQ3NDk=","url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/events/3851654749","actor":{"login":"UserName-AnkitSisodia","id":72349806,"node_id":"MDQ6VXNlcjcyMzQ5ODA2","avatar_url":"https://avatars.githubusercontent.com/u/72349806?v=4","gravatar_id":"","url":"https://api.github.com/users/UserName-AnkitSisodia","html_url":"https://github.com/UserName-AnkitSisodia","followers_url":"https://api.github.com/users/UserName-AnkitSisodia/followers","following_url":"https://api.github.com/users/UserName-AnkitSisodia/following{/other_user}","gists_url":"https://api.github.com/users/UserName-AnkitSisodia/gists{/gist_id}","starred_url":"https://api.github.com/users/UserName-AnkitSisodia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/UserName-AnkitSisodia/subscriptions","organizations_url":"https://api.github.com/users/UserName-AnkitSisodia/orgs","repos_url":"https://api.github.com/users/UserName-AnkitSisodia/repos","events_url":"https://api.github.com/users/UserName-AnkitSisodia/events{/privacy}","received_events_url":"https://api.github.com/users/UserName-AnkitSisodia/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-10-07T17:13:36Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/705164833","html_url":"https://github.com/YannDubs/disentangling-vae/issues/60#issuecomment-705164833","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/60","id":705164833,"node_id":"MDEyOklzc3VlQ29tbWVudDcwNTE2NDgzMw==","user":{"login":"UserName-AnkitSisodia","id":72349806,"node_id":"MDQ6VXNlcjcyMzQ5ODA2","avatar_url":"https://avatars.githubusercontent.com/u/72349806?v=4","gravatar_id":"","url":"https://api.github.com/users/UserName-AnkitSisodia","html_url":"https://github.com/UserName-AnkitSisodia","followers_url":"https://api.github.com/users/UserName-AnkitSisodia/followers","following_url":"https://api.github.com/users/UserName-AnkitSisodia/following{/other_user}","gists_url":"https://api.github.com/users/UserName-AnkitSisodia/gists{/gist_id}","starred_url":"https://api.github.com/users/UserName-AnkitSisodia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/UserName-AnkitSisodia/subscriptions","organizations_url":"https://api.github.com/users/UserName-AnkitSisodia/orgs","repos_url":"https://api.github.com/users/UserName-AnkitSisodia/repos","events_url":"https://api.github.com/users/UserName-AnkitSisodia/events{/privacy}","received_events_url":"https://api.github.com/users/UserName-AnkitSisodia/received_events","type":"User","site_admin":false},"created_at":"2020-10-07T20:05:49Z","updated_at":"2020-10-07T20:05:49Z","author_association":"NONE","body":"Using some random matrices (code attached\r\n[temp.txt](https://github.com/YannDubs/disentangling-vae/files/5343513/temp.txt)\r\n[temp.txt](https://github.com/YannDubs/disentangling-vae/files/5343515/temp.txt)\r\n\r\n), I used your code as well as Ricky Chen's code to compare what is happening.\r\n\r\nI found \r\n\r\nMWS\r\nlog_qz != logqz_ricky\r\nlog_prod_qzi != logqz_prodmarginals_ricky\r\n\r\nMSS\r\nlogqz_prodmarginals_ricky_mss == log_prod_qzi_mss\r\nlogqz_ricky_mss !=  log_qz_mss\r\n\r\nSo, when I use your code with is_mss=true, then I get -ve tc_loss and with is_mss=false, I get -ve mi_loss and -ve tc_loss.\r\nI ran it on dsprites dataset with batchsize 128.\r\n\r\nThen I changed the _get_log_pz_qz_prodzi_qzCx function in your code to make it similar to Ricky Chen's code.\r\n\r\n    batch_size, hidden_dim = latent_sample.shape\r\n\r\n    # calculate log q(z|x)\r\n    log_q_zCx = log_density_gaussian(latent_sample, *latent_dist).sum(dim=1)\r\n\r\n    # calculate log p(z)\r\n    # mean and log var is 0\r\n    zeros = torch.zeros_like(latent_sample)\r\n    log_pz = log_density_gaussian(latent_sample, zeros, zeros).sum(1)\r\n\r\n    mat_log_qz = matrix_log_density_gaussian(latent_sample, *latent_dist)\r\n\r\n    log_qz = (torch.logsumexp(mat_log_qz.sum(2), dim=1, keepdim=False)-math.log(batch_size * n_data))       ## Ankit - modified\r\n    log_prod_qzi = (torch.logsumexp(mat_log_qz, dim=1, keepdim=False)-math.log(batch_size * n_data)).sum(1) ## Ankit - modified\r\n\r\n    # is_mss=False\r\n    if is_mss:                                                                                                                ## Ankit - modified\r\n        # use stratification                                                                                                  ## Ankit - modifiede\r\n        log_iw_mat = log_importance_weight_matrix(batch_size, n_data).to(latent_sample.device)                                ## Ankit - modified\r\n        log_qz = torch.logsumexp(log_iw_mat + mat_log_qz.sum(2), dim=1, keepdim=False)                                        ## Ankit - modified\r\n        log_prod_qzi = torch.logsumexp(log_iw_mat.view(batch_size,batch_size,1)+mat_log_qz, dim=1, keepdim=False).sum(1)      ## Ankit - modified\r\n\r\n    return log_pz, log_qz, log_prod_qzi, log_q_zCx\r\n\r\nThen I get +ve losses for everything when is_mss=True but then I get -ve dw_kl_loss term.","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/705164833/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"UserName-AnkitSisodia","id":72349806,"node_id":"MDQ6VXNlcjcyMzQ5ODA2","avatar_url":"https://avatars.githubusercontent.com/u/72349806?v=4","gravatar_id":"","url":"https://api.github.com/users/UserName-AnkitSisodia","html_url":"https://github.com/UserName-AnkitSisodia","followers_url":"https://api.github.com/users/UserName-AnkitSisodia/followers","following_url":"https://api.github.com/users/UserName-AnkitSisodia/following{/other_user}","gists_url":"https://api.github.com/users/UserName-AnkitSisodia/gists{/gist_id}","starred_url":"https://api.github.com/users/UserName-AnkitSisodia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/UserName-AnkitSisodia/subscriptions","organizations_url":"https://api.github.com/users/UserName-AnkitSisodia/orgs","repos_url":"https://api.github.com/users/UserName-AnkitSisodia/repos","events_url":"https://api.github.com/users/UserName-AnkitSisodia/events{/privacy}","received_events_url":"https://api.github.com/users/UserName-AnkitSisodia/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/705215069","html_url":"https://github.com/YannDubs/disentangling-vae/issues/60#issuecomment-705215069","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/60","id":705215069,"node_id":"MDEyOklzc3VlQ29tbWVudDcwNTIxNTA2OQ==","user":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false},"created_at":"2020-10-07T21:56:38Z","updated_at":"2020-10-07T22:13:32Z","author_association":"OWNER","body":"Awesome thanks for checking. Few comments:\r\n\r\n1/ What do you mean by \"+ve\" and \"-ve\" ? What is ve ?\r\n\r\n2/ Looking back at it it seems that I actually had the correct code and then incorporated the problem it in a late night push ( #43 )\r\n\r\nHere's what I had before my changes:\r\n\r\n```python\r\ndef _get_log_pz_qz_prodzi_qzCx(latent_sample, latent_dist,n_data, is_mss=False):\r\n    batch_size, hidden_dim = latent_sample.shape\r\n\r\n    # calculate log q(z|x)\r\n    log_q_zCx = log_density_gaussian(latent_sample, *latent_dist).sum(dim=1)\r\n\r\n    # calculate log p(z)\r\n    # mean and log var is 0\r\n    zeros = torch.zeros_like(latent_sample)\r\n    log_pz = log_density_gaussian(latent_sample, zeros, zeros).sum(1)\r\n\r\n    if not self.is_mss:\r\n        log_qz, log_prod_qzi = _minibatch_weighted_sampling(latent_dist,\r\n                                                            latent_sample,\r\n                                                            n_data)\r\n\r\n    else:\r\n        log_qz, log_prod_qzi = _minibatch_stratified_sampling(latent_dist,\r\n                                                              latent_sample,\r\n                                                              n_data)\r\n\r\n    return log_pz, log_qz, log_prod_qzi, log_q_zCx\r\n\r\n\r\ndef _minibatch_weighted_sampling(latent_dist, latent_sample, data_size):\r\n    \"\"\"\r\n    Estimates log q(z) and the log (product of marginals of q(z_j)) with minibatch\r\n    weighted sampling.\r\n\r\n    Parameters\r\n    ----------\r\n    latent_dist : tuple of torch.tensor\r\n        sufficient statistics of the latent dimension. E.g. for gaussian\r\n        (mean, log_var) each of shape : (batch_size, latent_dim).\r\n\r\n    latent_sample: torch.Tensor\r\n        sample from the latent dimension using the reparameterisation trick\r\n        shape : (batch_size, latent_dim).\r\n\r\n    data_size : int\r\n        Number of data in the training set\r\n\r\n    References \r\n    -----------\r\n       [1] Chen, Tian Qi, et al. \"Isolating sources of disentanglement in variational\r\n       autoencoders.\" Advances in Neural Information Processing Systems. 2018.\r\n    \"\"\"\r\n    batch_size = latent_sample.size(0)\r\n\r\n    mat_log_qz = matrix_log_density_gaussian(latent_sample, *latent_dist)\r\n\r\n    log_prod_qzi = (torch.logsumexp(mat_log_qz, dim=1, keepdim=False) -\r\n                    math.log(batch_size * data_size)).sum(dim=1)\r\n    log_qz = torch.logsumexp(mat_log_qz.sum(2), dim=1, keepdim=False\r\n                             ) - math.log(batch_size * data_size)\r\n\r\n    return log_qz, log_prod_qzi\r\n\r\n\r\ndef _minibatch_stratified_sampling(latent_dist, latent_sample, data_size):\r\n    \"\"\"\r\n    Estimates log q(z) and the log (product of marginals of q(z_j)) with minibatch\r\n    stratified sampling.\r\n    \r\n    Parameters\r\n    -----------\r\n    latent_dist : tuple of torch.tensor\r\n        sufficient statistics of the latent dimension. E.g. for gaussian\r\n        (mean, log_var) each of shape : (batch_size, latent_dim).\r\n\r\n    latent_sample: torch.Tensor\r\n        sample from the latent dimension using the reparameterisation trick\r\n        shape : (batch_size, latent_dim).\r\n\r\n    data_size : int\r\n        Number of data in the training set\r\n\r\n    References \r\n    -----------\r\n       [1] Chen, Tian Qi, et al. \"Isolating sources of disentanglement in variational\r\n       autoencoders.\" Advances in Neural Information Processing Systems. 2018.\r\n    \"\"\"\r\n    batch_size = latent_sample.size(0)\r\n\r\n    mat_log_qz = matrix_log_density_gaussian(latent_sample, *latent_dist)\r\n\r\n    log_iw_mat = log_importance_weight_matrix(batch_size, data_size).to(latent_sample.device)\r\n    log_qz = torch.logsumexp(log_iw_mat + mat_log_qz.sum(2), dim=1, keepdim=False)\r\n    log_prod_qzi = torch.logsumexp(log_iw_mat.view(batch_size, batch_size, 1) +\r\n                                   mat_log_qz, dim=1, keepdim=False).sum(1)\r\n\r\n    return log_qz, log_prod_qzi\r\n```","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/705215069/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/705219977","html_url":"https://github.com/YannDubs/disentangling-vae/issues/60#issuecomment-705219977","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/60","id":705219977,"node_id":"MDEyOklzc3VlQ29tbWVudDcwNTIxOTk3Nw==","user":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false},"created_at":"2020-10-07T22:09:30Z","updated_at":"2020-10-07T22:35:30Z","author_association":"OWNER","body":"which is (I believe) exactly what you tested.\r\n\r\n- Does it also work for `is_mss =False`? \r\n\r\n- Just to be sure I understand, are you saying that with MSS this makes `dw_kl_loss` become negative ?\r\n\r\n- did you see any impact on the qualitative samples when training a model that way ?","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/705219977/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/705268889","html_url":"https://github.com/YannDubs/disentangling-vae/issues/60#issuecomment-705268889","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/60","id":705268889,"node_id":"MDEyOklzc3VlQ29tbWVudDcwNTI2ODg4OQ==","user":{"login":"UserName-AnkitSisodia","id":72349806,"node_id":"MDQ6VXNlcjcyMzQ5ODA2","avatar_url":"https://avatars.githubusercontent.com/u/72349806?v=4","gravatar_id":"","url":"https://api.github.com/users/UserName-AnkitSisodia","html_url":"https://github.com/UserName-AnkitSisodia","followers_url":"https://api.github.com/users/UserName-AnkitSisodia/followers","following_url":"https://api.github.com/users/UserName-AnkitSisodia/following{/other_user}","gists_url":"https://api.github.com/users/UserName-AnkitSisodia/gists{/gist_id}","starred_url":"https://api.github.com/users/UserName-AnkitSisodia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/UserName-AnkitSisodia/subscriptions","organizations_url":"https://api.github.com/users/UserName-AnkitSisodia/orgs","repos_url":"https://api.github.com/users/UserName-AnkitSisodia/repos","events_url":"https://api.github.com/users/UserName-AnkitSisodia/events{/privacy}","received_events_url":"https://api.github.com/users/UserName-AnkitSisodia/received_events","type":"User","site_admin":false},"created_at":"2020-10-08T00:53:52Z","updated_at":"2020-10-08T00:53:52Z","author_association":"NONE","body":"Yes, this makes the code exactly same. Once these changes are made, I get negative dw_kl_loss term in case of _minibatch_weighted_sampling. For _minibatch_stratified_sampling, I am getting all loss terms as positive. I tested on dsprites.","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/705268889/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"UserName-AnkitSisodia","id":72349806,"node_id":"MDQ6VXNlcjcyMzQ5ODA2","avatar_url":"https://avatars.githubusercontent.com/u/72349806?v=4","gravatar_id":"","url":"https://api.github.com/users/UserName-AnkitSisodia","html_url":"https://github.com/UserName-AnkitSisodia","followers_url":"https://api.github.com/users/UserName-AnkitSisodia/followers","following_url":"https://api.github.com/users/UserName-AnkitSisodia/following{/other_user}","gists_url":"https://api.github.com/users/UserName-AnkitSisodia/gists{/gist_id}","starred_url":"https://api.github.com/users/UserName-AnkitSisodia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/UserName-AnkitSisodia/subscriptions","organizations_url":"https://api.github.com/users/UserName-AnkitSisodia/orgs","repos_url":"https://api.github.com/users/UserName-AnkitSisodia/repos","events_url":"https://api.github.com/users/UserName-AnkitSisodia/events{/privacy}","received_events_url":"https://api.github.com/users/UserName-AnkitSisodia/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/705269257","html_url":"https://github.com/YannDubs/disentangling-vae/issues/60#issuecomment-705269257","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/60","id":705269257,"node_id":"MDEyOklzc3VlQ29tbWVudDcwNTI2OTI1Nw==","user":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false},"created_at":"2020-10-08T00:55:23Z","updated_at":"2020-10-08T00:55:23Z","author_association":"OWNER","body":"and qualitatively do you see any differences?","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/705269257/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/705269494","html_url":"https://github.com/YannDubs/disentangling-vae/issues/60#issuecomment-705269494","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/60","id":705269494,"node_id":"MDEyOklzc3VlQ29tbWVudDcwNTI2OTQ5NA==","user":{"login":"UserName-AnkitSisodia","id":72349806,"node_id":"MDQ6VXNlcjcyMzQ5ODA2","avatar_url":"https://avatars.githubusercontent.com/u/72349806?v=4","gravatar_id":"","url":"https://api.github.com/users/UserName-AnkitSisodia","html_url":"https://github.com/UserName-AnkitSisodia","followers_url":"https://api.github.com/users/UserName-AnkitSisodia/followers","following_url":"https://api.github.com/users/UserName-AnkitSisodia/following{/other_user}","gists_url":"https://api.github.com/users/UserName-AnkitSisodia/gists{/gist_id}","starred_url":"https://api.github.com/users/UserName-AnkitSisodia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/UserName-AnkitSisodia/subscriptions","organizations_url":"https://api.github.com/users/UserName-AnkitSisodia/orgs","repos_url":"https://api.github.com/users/UserName-AnkitSisodia/repos","events_url":"https://api.github.com/users/UserName-AnkitSisodia/events{/privacy}","received_events_url":"https://api.github.com/users/UserName-AnkitSisodia/received_events","type":"User","site_admin":false},"created_at":"2020-10-08T00:56:24Z","updated_at":"2020-10-08T00:56:24Z","author_association":"NONE","body":"I didn't test that yet. I was just trying to see from the math/code where am I getting the error.","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/705269494/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"UserName-AnkitSisodia","id":72349806,"node_id":"MDQ6VXNlcjcyMzQ5ODA2","avatar_url":"https://avatars.githubusercontent.com/u/72349806?v=4","gravatar_id":"","url":"https://api.github.com/users/UserName-AnkitSisodia","html_url":"https://github.com/UserName-AnkitSisodia","followers_url":"https://api.github.com/users/UserName-AnkitSisodia/followers","following_url":"https://api.github.com/users/UserName-AnkitSisodia/following{/other_user}","gists_url":"https://api.github.com/users/UserName-AnkitSisodia/gists{/gist_id}","starred_url":"https://api.github.com/users/UserName-AnkitSisodia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/UserName-AnkitSisodia/subscriptions","organizations_url":"https://api.github.com/users/UserName-AnkitSisodia/orgs","repos_url":"https://api.github.com/users/UserName-AnkitSisodia/repos","events_url":"https://api.github.com/users/UserName-AnkitSisodia/events{/privacy}","received_events_url":"https://api.github.com/users/UserName-AnkitSisodia/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/785828424","html_url":"https://github.com/YannDubs/disentangling-vae/issues/60#issuecomment-785828424","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/60","id":785828424,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NTgyODQyNA==","user":{"login":"DianeBouchacourt","id":13796686,"node_id":"MDQ6VXNlcjEzNzk2Njg2","avatar_url":"https://avatars.githubusercontent.com/u/13796686?v=4","gravatar_id":"","url":"https://api.github.com/users/DianeBouchacourt","html_url":"https://github.com/DianeBouchacourt","followers_url":"https://api.github.com/users/DianeBouchacourt/followers","following_url":"https://api.github.com/users/DianeBouchacourt/following{/other_user}","gists_url":"https://api.github.com/users/DianeBouchacourt/gists{/gist_id}","starred_url":"https://api.github.com/users/DianeBouchacourt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DianeBouchacourt/subscriptions","organizations_url":"https://api.github.com/users/DianeBouchacourt/orgs","repos_url":"https://api.github.com/users/DianeBouchacourt/repos","events_url":"https://api.github.com/users/DianeBouchacourt/events{/privacy}","received_events_url":"https://api.github.com/users/DianeBouchacourt/received_events","type":"User","site_admin":false},"created_at":"2021-02-25T11:31:13Z","updated_at":"2021-02-25T11:32:27Z","author_association":"NONE","body":"Has this issue been solved ? Training on dSprites, I also get negative tc loss ","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/785828424/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"DianeBouchacourt","id":13796686,"node_id":"MDQ6VXNlcjEzNzk2Njg2","avatar_url":"https://avatars.githubusercontent.com/u/13796686?v=4","gravatar_id":"","url":"https://api.github.com/users/DianeBouchacourt","html_url":"https://github.com/DianeBouchacourt","followers_url":"https://api.github.com/users/DianeBouchacourt/followers","following_url":"https://api.github.com/users/DianeBouchacourt/following{/other_user}","gists_url":"https://api.github.com/users/DianeBouchacourt/gists{/gist_id}","starred_url":"https://api.github.com/users/DianeBouchacourt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DianeBouchacourt/subscriptions","organizations_url":"https://api.github.com/users/DianeBouchacourt/orgs","repos_url":"https://api.github.com/users/DianeBouchacourt/repos","events_url":"https://api.github.com/users/DianeBouchacourt/events{/privacy}","received_events_url":"https://api.github.com/users/DianeBouchacourt/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/1001796161","html_url":"https://github.com/YannDubs/disentangling-vae/issues/60#issuecomment-1001796161","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/60","id":1001796161,"node_id":"IC_kwDOCgn1CM47tjJB","user":{"login":"shi-yu-wang","id":42013343,"node_id":"MDQ6VXNlcjQyMDEzMzQz","avatar_url":"https://avatars.githubusercontent.com/u/42013343?v=4","gravatar_id":"","url":"https://api.github.com/users/shi-yu-wang","html_url":"https://github.com/shi-yu-wang","followers_url":"https://api.github.com/users/shi-yu-wang/followers","following_url":"https://api.github.com/users/shi-yu-wang/following{/other_user}","gists_url":"https://api.github.com/users/shi-yu-wang/gists{/gist_id}","starred_url":"https://api.github.com/users/shi-yu-wang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shi-yu-wang/subscriptions","organizations_url":"https://api.github.com/users/shi-yu-wang/orgs","repos_url":"https://api.github.com/users/shi-yu-wang/repos","events_url":"https://api.github.com/users/shi-yu-wang/events{/privacy}","received_events_url":"https://api.github.com/users/shi-yu-wang/received_events","type":"User","site_admin":false},"created_at":"2021-12-27T23:20:09Z","updated_at":"2021-12-27T23:20:09Z","author_association":"NONE","body":"I also got the negative loss with the DSprites data","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/1001796161/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"shi-yu-wang","id":42013343,"node_id":"MDQ6VXNlcjQyMDEzMzQz","avatar_url":"https://avatars.githubusercontent.com/u/42013343?v=4","gravatar_id":"","url":"https://api.github.com/users/shi-yu-wang","html_url":"https://github.com/shi-yu-wang","followers_url":"https://api.github.com/users/shi-yu-wang/followers","following_url":"https://api.github.com/users/shi-yu-wang/following{/other_user}","gists_url":"https://api.github.com/users/shi-yu-wang/gists{/gist_id}","starred_url":"https://api.github.com/users/shi-yu-wang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shi-yu-wang/subscriptions","organizations_url":"https://api.github.com/users/shi-yu-wang/orgs","repos_url":"https://api.github.com/users/shi-yu-wang/repos","events_url":"https://api.github.com/users/shi-yu-wang/events{/privacy}","received_events_url":"https://api.github.com/users/shi-yu-wang/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/1001796219","html_url":"https://github.com/YannDubs/disentangling-vae/issues/60#issuecomment-1001796219","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/60","id":1001796219,"node_id":"IC_kwDOCgn1CM47tjJ7","user":{"login":"shi-yu-wang","id":42013343,"node_id":"MDQ6VXNlcjQyMDEzMzQz","avatar_url":"https://avatars.githubusercontent.com/u/42013343?v=4","gravatar_id":"","url":"https://api.github.com/users/shi-yu-wang","html_url":"https://github.com/shi-yu-wang","followers_url":"https://api.github.com/users/shi-yu-wang/followers","following_url":"https://api.github.com/users/shi-yu-wang/following{/other_user}","gists_url":"https://api.github.com/users/shi-yu-wang/gists{/gist_id}","starred_url":"https://api.github.com/users/shi-yu-wang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shi-yu-wang/subscriptions","organizations_url":"https://api.github.com/users/shi-yu-wang/orgs","repos_url":"https://api.github.com/users/shi-yu-wang/repos","events_url":"https://api.github.com/users/shi-yu-wang/events{/privacy}","received_events_url":"https://api.github.com/users/shi-yu-wang/received_events","type":"User","site_admin":false},"created_at":"2021-12-27T23:20:24Z","updated_at":"2021-12-27T23:20:24Z","author_association":"NONE","body":"> \r\n\r\ntc loss","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/1001796219/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"shi-yu-wang","id":42013343,"node_id":"MDQ6VXNlcjQyMDEzMzQz","avatar_url":"https://avatars.githubusercontent.com/u/42013343?v=4","gravatar_id":"","url":"https://api.github.com/users/shi-yu-wang","html_url":"https://github.com/shi-yu-wang","followers_url":"https://api.github.com/users/shi-yu-wang/followers","following_url":"https://api.github.com/users/shi-yu-wang/following{/other_user}","gists_url":"https://api.github.com/users/shi-yu-wang/gists{/gist_id}","starred_url":"https://api.github.com/users/shi-yu-wang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shi-yu-wang/subscriptions","organizations_url":"https://api.github.com/users/shi-yu-wang/orgs","repos_url":"https://api.github.com/users/shi-yu-wang/repos","events_url":"https://api.github.com/users/shi-yu-wang/events{/privacy}","received_events_url":"https://api.github.com/users/shi-yu-wang/received_events","type":"User","site_admin":false}}]