[{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/557871301","html_url":"https://github.com/YannDubs/disentangling-vae/issues/52#issuecomment-557871301","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/52","id":557871301,"node_id":"MDEyOklzc3VlQ29tbWVudDU1Nzg3MTMwMQ==","user":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false},"created_at":"2019-11-24T09:21:15Z","updated_at":"2019-11-24T09:21:48Z","author_association":"OWNER","body":"The small MIG is definitely (and unfortunately) something we always had in our experiments. Importantly, I got the same results when using [the author's implementation](https://github.com/rtqichen/beta-tcvae ). This is one of the reason we introduced AAM, which measures only the disentanglement rather than disentanglement + amount of information of **v** about **z**. I am surprised you get small AAM though. \r\n\r\nHere are the results we were getting : \r\n\r\n<img width=\"800\" alt=\"Screen Shot 2019-11-24 at 4 12 12 AM\" src=\"https://user-images.githubusercontent.com/24327668/69492500-a0cb6900-0e71-11ea-9cea-fd7ad8912912.png\">\r\n\r\nWe see that when increasing β by a small amount (from 1 to 4), highly increases axis alignment (from20% to 65%) due to the regularisation of the total correlation, while increasing  β by a large amount (from 4 to 50) decreases axis alignment due to the penalisation of the dimension wise KL. I.e. it is not monotonic. ","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/557871301/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/557893450","html_url":"https://github.com/YannDubs/disentangling-vae/issues/52#issuecomment-557893450","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/52","id":557893450,"node_id":"MDEyOklzc3VlQ29tbWVudDU1Nzg5MzQ1MA==","user":{"login":"Justin-Tan","id":27450488,"node_id":"MDQ6VXNlcjI3NDUwNDg4","avatar_url":"https://avatars.githubusercontent.com/u/27450488?v=4","gravatar_id":"","url":"https://api.github.com/users/Justin-Tan","html_url":"https://github.com/Justin-Tan","followers_url":"https://api.github.com/users/Justin-Tan/followers","following_url":"https://api.github.com/users/Justin-Tan/following{/other_user}","gists_url":"https://api.github.com/users/Justin-Tan/gists{/gist_id}","starred_url":"https://api.github.com/users/Justin-Tan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Justin-Tan/subscriptions","organizations_url":"https://api.github.com/users/Justin-Tan/orgs","repos_url":"https://api.github.com/users/Justin-Tan/repos","events_url":"https://api.github.com/users/Justin-Tan/events{/privacy}","received_events_url":"https://api.github.com/users/Justin-Tan/received_events","type":"User","site_admin":false},"created_at":"2019-11-24T14:24:11Z","updated_at":"2019-11-24T14:25:34Z","author_association":"NONE","body":"Thanks for the confirmation, this is slightly puzzling as the authors of\r\nbeta-TCVAE report MIG scores of O(0.1) in their paper. Other third-party\r\nimplementations also report MIG of O(0.1), e.g. \"Challenging Common\r\nAssumptions in the Unsupervised Learning of Disentangled Representations\".\r\nI might try emailing the authors directly to see how they obtained their\r\nresults.\r\n\r\n![metrics](https://user-images.githubusercontent.com/27450488/69496093-653ca780-0f22-11ea-9406-f7cf369610f1.png)\r\n\r\n\r\nOn Sun, Nov 24, 2019 at 8:21 PM Yann Dubois <notifications@github.com>\r\nwrote:\r\n\r\n> The small MIG is definitely (and unfortunately) something we always had in\r\n> our experiments. Importantly, I got the same results when using (the\r\n> author's implementation)[https://github.com/rtqichen/beta-tcvae]. This is\r\n> one of the reason we introduced AAM, which measures only the\r\n> disentanglement rather than disentanglement + amount of information of *v*\r\n> about *z*. I am surprised you get small AAM though.\r\n>\r\n> Here are the results we were getting :\r\n>\r\n> [image: Screen Shot 2019-11-24 at 4 12 12 AM]\r\n> <https://user-images.githubusercontent.com/24327668/69492500-a0cb6900-0e71-11ea-9cea-fd7ad8912912.png>\r\n>\r\n> We see that when increasing β by a small amount (from 1 to 4), highly\r\n> increases axis alignment (from20% to 65%) due to the regularisation of the\r\n> total correlation, while increasing β by a large amount (from 4 to 50)\r\n> decreases axis alignment due to the penalisation of the dimension wise KL.\r\n> I.e. it is not monotonic.\r\n>\r\n> —\r\n> You are receiving this because you authored the thread.\r\n> Reply to this email directly, view it on GitHub\r\n> <https://github.com/YannDubs/disentangling-vae/issues/52?email_source=notifications&email_token=AGRNY6HZANTIBXI4WQFAQJLQVJBQXA5CNFSM4JLL55R2YY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGOEFAHBRI#issuecomment-557871301>,\r\n> or unsubscribe\r\n> <https://github.com/notifications/unsubscribe-auth/AGRNY6FEEHKLWLYGZSITEGDQVJBQXANCNFSM4JLL55RQ>\r\n> .\r\n>\r\n","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/557893450/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Justin-Tan","id":27450488,"node_id":"MDQ6VXNlcjI3NDUwNDg4","avatar_url":"https://avatars.githubusercontent.com/u/27450488?v=4","gravatar_id":"","url":"https://api.github.com/users/Justin-Tan","html_url":"https://github.com/Justin-Tan","followers_url":"https://api.github.com/users/Justin-Tan/followers","following_url":"https://api.github.com/users/Justin-Tan/following{/other_user}","gists_url":"https://api.github.com/users/Justin-Tan/gists{/gist_id}","starred_url":"https://api.github.com/users/Justin-Tan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Justin-Tan/subscriptions","organizations_url":"https://api.github.com/users/Justin-Tan/orgs","repos_url":"https://api.github.com/users/Justin-Tan/repos","events_url":"https://api.github.com/users/Justin-Tan/events{/privacy}","received_events_url":"https://api.github.com/users/Justin-Tan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/557902777","html_url":"https://github.com/YannDubs/disentangling-vae/issues/52#issuecomment-557902777","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/52","id":557902777,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NzkwMjc3Nw==","user":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false},"created_at":"2019-11-24T16:09:26Z","updated_at":"2019-11-24T16:10:37Z","author_association":"OWNER","body":"Yes it is, if you get an answer / insights please post it here. I would be interested + other people might be. \r\n\r\nAnd just to be clear, I have not tried rerunning the authors code. I only tried using their MIG code to compute the MIG for our results :/ . I.e. it does not seem that the issue comes from the computation of MIG, but to be honest I have not spent too much time on MIG as this was a late addition before a deadline.","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/557902777/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/563047524","html_url":"https://github.com/YannDubs/disentangling-vae/issues/52#issuecomment-563047524","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/52","id":563047524,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MzA0NzUyNA==","user":{"login":"Justin-Tan","id":27450488,"node_id":"MDQ6VXNlcjI3NDUwNDg4","avatar_url":"https://avatars.githubusercontent.com/u/27450488?v=4","gravatar_id":"","url":"https://api.github.com/users/Justin-Tan","html_url":"https://github.com/Justin-Tan","followers_url":"https://api.github.com/users/Justin-Tan/followers","following_url":"https://api.github.com/users/Justin-Tan/following{/other_user}","gists_url":"https://api.github.com/users/Justin-Tan/gists{/gist_id}","starred_url":"https://api.github.com/users/Justin-Tan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Justin-Tan/subscriptions","organizations_url":"https://api.github.com/users/Justin-Tan/orgs","repos_url":"https://api.github.com/users/Justin-Tan/repos","events_url":"https://api.github.com/users/Justin-Tan/events{/privacy}","received_events_url":"https://api.github.com/users/Justin-Tan/received_events","type":"User","site_admin":false},"created_at":"2019-12-09T03:29:12Z","updated_at":"2019-12-09T03:32:29Z","author_association":"NONE","body":"After some digging I am getting better results using the author's MIG calculation code - around 0.3-0.8 for most of my trained models. Perhaps the problem lies in shuffling the dataloader? I notice when I shuffle the dataloader I get a very low MIG (on dSprites).\r\n\r\n\r\n    # Load dataloader\r\n    all_loader = (..., shuffle=False)\r\n\r\n    vae = model\r\n    N = len(all_loader.dataset)     # number of data samples - don't shuffle\r\n    K = vae.latent_dim              # number of latent variables\r\n    nparams = 2\r\n    vae.eval()\r\n\r\n    qzCx_params = torch.Tensor(N, K, nparams)\r\n\r\n    n = 0\r\n    \r\n    with torch.no_grad():\r\n        for x, gen_factors in all_loader:\r\n            batch_size = x.size(0)\r\n            x, gen_factors = x.to(device, dtype=torch.float), gen_factors.to(device)\r\n            qzCx_stats = torch.stack(vae.encoder(x)['continuous'], dim=2)\r\n            qzCx_params[n:n + batch_size] = qzCx_stats.data\r\n            n += batch_size\r\n\r\n    # Reshape to get known generative factors\r\n    qzCx_params = qzCx_params.view(3, 6, 40, 32, 32, K, nparams).to(device)\r\n\r\n    # Sample from diagonal Gaussian posterior q(z|x) using given parameters (mu, logvar)\r\n    qzCx_samples = qzCx_sample(params=qzCx_params)\r\n\r\nI think the reshape on the second last line requires the dataset to be in the native order so that the generative factors are in the correct order - it's not obvious that they should be though, this is a quirk of the dSprites dataset.","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/563047524/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Justin-Tan","id":27450488,"node_id":"MDQ6VXNlcjI3NDUwNDg4","avatar_url":"https://avatars.githubusercontent.com/u/27450488?v=4","gravatar_id":"","url":"https://api.github.com/users/Justin-Tan","html_url":"https://github.com/Justin-Tan","followers_url":"https://api.github.com/users/Justin-Tan/followers","following_url":"https://api.github.com/users/Justin-Tan/following{/other_user}","gists_url":"https://api.github.com/users/Justin-Tan/gists{/gist_id}","starred_url":"https://api.github.com/users/Justin-Tan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Justin-Tan/subscriptions","organizations_url":"https://api.github.com/users/Justin-Tan/orgs","repos_url":"https://api.github.com/users/Justin-Tan/repos","events_url":"https://api.github.com/users/Justin-Tan/events{/privacy}","received_events_url":"https://api.github.com/users/Justin-Tan/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/564244822","html_url":"https://github.com/YannDubs/disentangling-vae/issues/52#issuecomment-564244822","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/52","id":564244822,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NDI0NDgyMg==","user":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false},"created_at":"2019-12-10T20:31:44Z","updated_at":"2019-12-10T20:33:06Z","author_association":"OWNER","body":"Thanks for digging into it. What exactly do you mean by shuffling ? We do no shuffle the test loader ( https://github.com/YannDubs/disentangling-vae/blob/a54b794dcf816a3892a1960b2aa1c9900cb09a16/main.py#L235 ) if that's your point.\r\n\r\nBTW : I'm more than happy to accept PRs","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/564244822/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"YannDubs","id":24327668,"node_id":"MDQ6VXNlcjI0MzI3NjY4","avatar_url":"https://avatars.githubusercontent.com/u/24327668?v=4","gravatar_id":"","url":"https://api.github.com/users/YannDubs","html_url":"https://github.com/YannDubs","followers_url":"https://api.github.com/users/YannDubs/followers","following_url":"https://api.github.com/users/YannDubs/following{/other_user}","gists_url":"https://api.github.com/users/YannDubs/gists{/gist_id}","starred_url":"https://api.github.com/users/YannDubs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YannDubs/subscriptions","organizations_url":"https://api.github.com/users/YannDubs/orgs","repos_url":"https://api.github.com/users/YannDubs/repos","events_url":"https://api.github.com/users/YannDubs/events{/privacy}","received_events_url":"https://api.github.com/users/YannDubs/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/564413001","html_url":"https://github.com/YannDubs/disentangling-vae/issues/52#issuecomment-564413001","issue_url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/52","id":564413001,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NDQxMzAwMQ==","user":{"login":"Justin-Tan","id":27450488,"node_id":"MDQ6VXNlcjI3NDUwNDg4","avatar_url":"https://avatars.githubusercontent.com/u/27450488?v=4","gravatar_id":"","url":"https://api.github.com/users/Justin-Tan","html_url":"https://github.com/Justin-Tan","followers_url":"https://api.github.com/users/Justin-Tan/followers","following_url":"https://api.github.com/users/Justin-Tan/following{/other_user}","gists_url":"https://api.github.com/users/Justin-Tan/gists{/gist_id}","starred_url":"https://api.github.com/users/Justin-Tan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Justin-Tan/subscriptions","organizations_url":"https://api.github.com/users/Justin-Tan/orgs","repos_url":"https://api.github.com/users/Justin-Tan/repos","events_url":"https://api.github.com/users/Justin-Tan/events{/privacy}","received_events_url":"https://api.github.com/users/Justin-Tan/received_events","type":"User","site_admin":false},"created_at":"2019-12-11T07:19:40Z","updated_at":"2019-12-11T07:49:23Z","author_association":"NONE","body":"Yeah, that's what I mean about the shuffling, thanks for confirming, so that is not the cause of it. I am still confused because AFAIK this repository and the author's code appear to be doing the exact same thing when calculating MIG (on dSprites at least) but this repository is giving much lower MIG when loading the same models. I'll look more into it over this weekend.\r\n\r\nI also looked into the discrete estimation of MIG used in [1], appendix C. (Essentially discretize samples from z in ~20 bins and use sklearn to estimate the discrete MI b/w latents z and generative factors v.) Unfortunately it does not agree with the MIG computed using this sampling-based estimation (consistently lower, reasonably insensitive to number of bins) irrespective of whether we use the mean of the latent representation or we sample from q(z|x), so the jury is still out on how to best estimate MIG I suppose. \r\n\r\nEdit: It seems like the MIG scores reported in [1] are consistently lower anyway around 0.2 for the best models, so perhaps this is expected.\r\n'\r\n[1]: https://arxiv.org/abs/1811.12359","reactions":{"url":"https://api.github.com/repos/YannDubs/disentangling-vae/issues/comments/564413001/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Justin-Tan","id":27450488,"node_id":"MDQ6VXNlcjI3NDUwNDg4","avatar_url":"https://avatars.githubusercontent.com/u/27450488?v=4","gravatar_id":"","url":"https://api.github.com/users/Justin-Tan","html_url":"https://github.com/Justin-Tan","followers_url":"https://api.github.com/users/Justin-Tan/followers","following_url":"https://api.github.com/users/Justin-Tan/following{/other_user}","gists_url":"https://api.github.com/users/Justin-Tan/gists{/gist_id}","starred_url":"https://api.github.com/users/Justin-Tan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Justin-Tan/subscriptions","organizations_url":"https://api.github.com/users/Justin-Tan/orgs","repos_url":"https://api.github.com/users/Justin-Tan/repos","events_url":"https://api.github.com/users/Justin-Tan/events{/privacy}","received_events_url":"https://api.github.com/users/Justin-Tan/received_events","type":"User","site_admin":false}}]