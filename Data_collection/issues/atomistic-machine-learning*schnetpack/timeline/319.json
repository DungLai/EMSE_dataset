[{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/902665394","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/319#issuecomment-902665394","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/319","id":902665394,"node_id":"IC_kwDOCMZ5Ls41zZSy","user":{"login":"mgastegger","id":36198330,"node_id":"MDQ6VXNlcjM2MTk4MzMw","avatar_url":"https://avatars.githubusercontent.com/u/36198330?v=4","gravatar_id":"","url":"https://api.github.com/users/mgastegger","html_url":"https://github.com/mgastegger","followers_url":"https://api.github.com/users/mgastegger/followers","following_url":"https://api.github.com/users/mgastegger/following{/other_user}","gists_url":"https://api.github.com/users/mgastegger/gists{/gist_id}","starred_url":"https://api.github.com/users/mgastegger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mgastegger/subscriptions","organizations_url":"https://api.github.com/users/mgastegger/orgs","repos_url":"https://api.github.com/users/mgastegger/repos","events_url":"https://api.github.com/users/mgastegger/events{/privacy}","received_events_url":"https://api.github.com/users/mgastegger/received_events","type":"User","site_admin":false},"created_at":"2021-08-20T12:45:26Z","updated_at":"2021-08-20T12:45:26Z","author_association":"COLLABORATOR","body":"It is possible to run NPT simulations with the master branch, although this is not documented yet.\r\n\r\nTo do so, you have to specify a barostat in the dynamics section of the input, for example:\r\n```\r\ndynamics:\r\n  n_steps: 100000\r\n  integrator:\r\n    type: verlet \r\n    time_step: 0.50\r\n  barostat:\r\n    type: nhc_iso\r\n    target_pressure: 1.0 # bar\r\n    temperature: 300 # K\r\n    time_constant: 100 # fs\r\n    time_constant_cell: 1000 # fs\r\n    time_constant_barostat: 500 # fs\r\n   massive: true\r\n```\r\nThis would use a Martyna-Tobias-Klein barostat for isotropic cell fluctuations. In this case, no additional thermostat needs to be specified, since particle and cell temperatures are controlled via NHC thermostats.\r\n\r\nIn addition to the barostat, the calculator used for the MD also needs to compute the stress tensors, e.g. with the SchNetPack calculator, this can be done via:\r\n```\r\ncalculator:\r\n  type: schnet\r\n  model_file: <PATH/TO/MODEL>\r\n  required_properties:\r\n  - energy\r\n  - forces\r\n  - stress  # < for stress\r\n  cutoff: <MODEL CUTOFF>\r\n  force_handle: forces\r\n  stress_handle: stress # < for stress\r\n  position_conversion: Angstrom\r\n  force_conversion: eV/Angstrom\r\n  stress_conversion: eV/A/A/A # < for stress\r\n  neighbor_list: ase\r\n```\r\nFinally, a simulation cell  and PBC need to be provided in the structure input, this means the comment line of the extended XYZ file would read something like this:\r\n```\r\nLattice=\"34.982601165771484 0.0 0.0 0.0 34.982601165771484 0.0 0.0 0.0 4.982601165771484\" Properties=species:S:1:pos:R:3 pbc=\"T T T\"\r\n```","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/902665394/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mgastegger","id":36198330,"node_id":"MDQ6VXNlcjM2MTk4MzMw","avatar_url":"https://avatars.githubusercontent.com/u/36198330?v=4","gravatar_id":"","url":"https://api.github.com/users/mgastegger","html_url":"https://github.com/mgastegger","followers_url":"https://api.github.com/users/mgastegger/followers","following_url":"https://api.github.com/users/mgastegger/following{/other_user}","gists_url":"https://api.github.com/users/mgastegger/gists{/gist_id}","starred_url":"https://api.github.com/users/mgastegger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mgastegger/subscriptions","organizations_url":"https://api.github.com/users/mgastegger/orgs","repos_url":"https://api.github.com/users/mgastegger/repos","events_url":"https://api.github.com/users/mgastegger/events{/privacy}","received_events_url":"https://api.github.com/users/mgastegger/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/903026279","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/319#issuecomment-903026279","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/319","id":903026279,"node_id":"IC_kwDOCMZ5Ls410xZn","user":{"login":"siddharth-ncl-work","id":43916742,"node_id":"MDQ6VXNlcjQzOTE2NzQy","avatar_url":"https://avatars.githubusercontent.com/u/43916742?v=4","gravatar_id":"","url":"https://api.github.com/users/siddharth-ncl-work","html_url":"https://github.com/siddharth-ncl-work","followers_url":"https://api.github.com/users/siddharth-ncl-work/followers","following_url":"https://api.github.com/users/siddharth-ncl-work/following{/other_user}","gists_url":"https://api.github.com/users/siddharth-ncl-work/gists{/gist_id}","starred_url":"https://api.github.com/users/siddharth-ncl-work/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/siddharth-ncl-work/subscriptions","organizations_url":"https://api.github.com/users/siddharth-ncl-work/orgs","repos_url":"https://api.github.com/users/siddharth-ncl-work/repos","events_url":"https://api.github.com/users/siddharth-ncl-work/events{/privacy}","received_events_url":"https://api.github.com/users/siddharth-ncl-work/received_events","type":"User","site_admin":false},"created_at":"2021-08-21T00:54:52Z","updated_at":"2021-08-22T00:54:18Z","author_association":"NONE","body":"@mgastegger thanks a lot for getting back to me. I will give it a try on ethanol and update you on the results. \r\n\r\nI have a few doubts regarding simulation setup:\r\n\r\n1. For NPT, do we also need a model trained on stress tensors along with the energy and forces? I followed [this tutorial](https://schnetpack.readthedocs.io/en/stable/tutorials/tutorial_03_force_models.html) and have a trained model for ethanol that gives energy and forces....will that work?\r\n\r\n2. I am working on molecular system of benzene and methanol (will be trying on ethanol as well), I think simulation cell (ie. box) would be required but do I also need to specify PBC (ie. lattice vectors)? \r\n\r\n3. Is `massive: true` part of `barostat:` or `calculator:` block? I think there is some issue with its indentation.\r\n\r\n4. How to monitor pressure and volume of the system?","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/903026279/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"siddharth-ncl-work","id":43916742,"node_id":"MDQ6VXNlcjQzOTE2NzQy","avatar_url":"https://avatars.githubusercontent.com/u/43916742?v=4","gravatar_id":"","url":"https://api.github.com/users/siddharth-ncl-work","html_url":"https://github.com/siddharth-ncl-work","followers_url":"https://api.github.com/users/siddharth-ncl-work/followers","following_url":"https://api.github.com/users/siddharth-ncl-work/following{/other_user}","gists_url":"https://api.github.com/users/siddharth-ncl-work/gists{/gist_id}","starred_url":"https://api.github.com/users/siddharth-ncl-work/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/siddharth-ncl-work/subscriptions","organizations_url":"https://api.github.com/users/siddharth-ncl-work/orgs","repos_url":"https://api.github.com/users/siddharth-ncl-work/repos","events_url":"https://api.github.com/users/siddharth-ncl-work/events{/privacy}","received_events_url":"https://api.github.com/users/siddharth-ncl-work/received_events","type":"User","site_admin":false}},{"id":5189185141,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NTE4OTE4NTE0MQ==","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/5189185141","actor":{"login":"mgastegger","id":36198330,"node_id":"MDQ6VXNlcjM2MTk4MzMw","avatar_url":"https://avatars.githubusercontent.com/u/36198330?v=4","gravatar_id":"","url":"https://api.github.com/users/mgastegger","html_url":"https://github.com/mgastegger","followers_url":"https://api.github.com/users/mgastegger/followers","following_url":"https://api.github.com/users/mgastegger/following{/other_user}","gists_url":"https://api.github.com/users/mgastegger/gists{/gist_id}","starred_url":"https://api.github.com/users/mgastegger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mgastegger/subscriptions","organizations_url":"https://api.github.com/users/mgastegger/orgs","repos_url":"https://api.github.com/users/mgastegger/repos","events_url":"https://api.github.com/users/mgastegger/events{/privacy}","received_events_url":"https://api.github.com/users/mgastegger/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-08-21T00:54:52Z","performed_via_github_app":null},{"id":5189185143,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDUxODkxODUxNDM=","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/5189185143","actor":{"login":"mgastegger","id":36198330,"node_id":"MDQ6VXNlcjM2MTk4MzMw","avatar_url":"https://avatars.githubusercontent.com/u/36198330?v=4","gravatar_id":"","url":"https://api.github.com/users/mgastegger","html_url":"https://github.com/mgastegger","followers_url":"https://api.github.com/users/mgastegger/followers","following_url":"https://api.github.com/users/mgastegger/following{/other_user}","gists_url":"https://api.github.com/users/mgastegger/gists{/gist_id}","starred_url":"https://api.github.com/users/mgastegger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mgastegger/subscriptions","organizations_url":"https://api.github.com/users/mgastegger/orgs","repos_url":"https://api.github.com/users/mgastegger/repos","events_url":"https://api.github.com/users/mgastegger/events{/privacy}","received_events_url":"https://api.github.com/users/mgastegger/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-08-21T00:54:52Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/903082018","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/319#issuecomment-903082018","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/319","id":903082018,"node_id":"IC_kwDOCMZ5Ls410_Ai","user":{"login":"siddharth-ncl-work","id":43916742,"node_id":"MDQ6VXNlcjQzOTE2NzQy","avatar_url":"https://avatars.githubusercontent.com/u/43916742?v=4","gravatar_id":"","url":"https://api.github.com/users/siddharth-ncl-work","html_url":"https://github.com/siddharth-ncl-work","followers_url":"https://api.github.com/users/siddharth-ncl-work/followers","following_url":"https://api.github.com/users/siddharth-ncl-work/following{/other_user}","gists_url":"https://api.github.com/users/siddharth-ncl-work/gists{/gist_id}","starred_url":"https://api.github.com/users/siddharth-ncl-work/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/siddharth-ncl-work/subscriptions","organizations_url":"https://api.github.com/users/siddharth-ncl-work/orgs","repos_url":"https://api.github.com/users/siddharth-ncl-work/repos","events_url":"https://api.github.com/users/siddharth-ncl-work/events{/privacy}","received_events_url":"https://api.github.com/users/siddharth-ncl-work/received_events","type":"User","site_admin":false},"created_at":"2021-08-21T08:28:10Z","updated_at":"2021-08-21T09:02:00Z","author_association":"NONE","body":"[UPDATE]\r\n**I was able to fix the following error by reinstalling SchNetPack from the cloned repo. I don't need help with this error but I would appreciate if you could clarify the doubts from earlier comment**\r\n\r\nI tried running NPT simulation on ethanol as per the instructions but got following error. I used `spk_md.py` file for the simulation. The repo was cloned again to make sure I was on the latest commit of the master branch. SchNet model was obtained by following [this tutorial](https://schnetpack.readthedocs.io/en/stable/tutorials/tutorial_03_force_models.html).\r\n\r\n```\r\n../../../src/scripts/spk_md.py:14: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please read https://msg.pyyaml.org/load for full details.\r\n  tradoffs = yaml.load(tf)\r\nINFO:root:Read options from input_script_NPT.\r\nINFO:root:Random state initialized with seed 2752731239\r\nINFO:root:Create model directory\r\n/home/vanka/anaconda3/envs/torchmd/lib/python3.8/site-packages/ase/atoms.py:967: VisibleDeprecationWarning: Use get_global_number_of_atoms() instead\r\n  warnings.warn('Use get_global_number_of_atoms() instead',\r\nINFO:root:Loaded model from best_model\r\nTraceback (most recent call last):\r\n  File \"../../../src/scripts/spk_md.py\", line 27, in <module>\r\n    md = MDSimulation(config)\r\n  File \"/home/vanka/anaconda3/envs/torchmd/lib/python3.8/site-packages/schnetpack/md/parsers/md_setup.py\", line 59, in __init__\r\n    SetupCalculator(self)\r\n  File \"/home/vanka/anaconda3/envs/torchmd/lib/python3.8/site-packages/schnetpack/md/parsers/md_setup.py\", line 127, in __init__\r\n    self._setup(md_initializer)\r\n  File \"/home/vanka/anaconda3/envs/torchmd/lib/python3.8/site-packages/schnetpack/md/parsers/md_setup.py\", line 355, in _setup\r\n    calculator = CalculatorInit(calculator_dict).initialized\r\n  File \"/home/vanka/anaconda3/envs/torchmd/lib/python3.8/site-packages/schnetpack/md/parsers/md_options.py\", line 181, in __init__\r\n    self.initialized = target_class(*inputs, **extra_kwargs)\r\nTypeError: __init__() got an unexpected keyword argument 'stress_handle'\r\n```\r\n\r\n**Input xyz file (ethanol_with_pbc.xyz)**\r\n```\r\n9\r\nLattice=\"10.0 0.0 0.0 0.0 10.0 0.0 0.0 0.0 10.0\" Properties=species:S:1:pos:R:3 pbc=\"T T T\"\r\nO        3.36190000       5.44035000       5.00300000\r\nC        4.48680000       4.57415000       5.00300000\r\nC        5.75060000       5.40745000       5.00300000\r\nH        4.43730000       3.92865000       5.88490000\r\nH        4.43790000       3.94685000       4.10840000\r\nH        6.63810000       4.76865000       4.98530000\r\nH        5.77570000       6.07135000       4.13260000\r\nH        5.79470000       6.04585000       5.89160000\r\nH        3.40400000       5.97705000       5.81290000\r\n```\r\n\r\n**Input Script**\r\n```\r\ndevice: cuda\r\nsimulation_dir: test_output\r\noverwrite: True\r\ndynamics:\r\n  n_steps: 100000\r\n  integrator:\r\n    type: verlet\r\n    time_step: 0.50\r\n  barostat:\r\n    type: nhc_iso\r\n    target_pressure: 1.0 # bar\r\n    temperature: 300 # K\r\n    time_constant: 100 # fs\r\n    time_constant_cell: 1000 # fs\r\n    time_constant_barostat: 500 # fs\r\n    massive: true\r\ncalculator:\r\n  type: schnet\r\n  model_file: best_model #model from tutorial\r\n  required_properties:\r\n  - energy\r\n  - forces\r\n  - stress # < for stress\r\n  force_handle: forces\r\n  stress_handle: stress # < for stress\r\n  position_conversion: Angstrom\r\n  force_conversion: kcal/mol/Angstrom\r\n  stress_conversion: kcal/mol/A/A/A\r\nsystem:\r\n  molecule_file: ethanol_with_pbc.xyz\r\n  n_replicas: 1\r\n  initializer:\r\n    type: maxwell-boltzmann\r\n    temperature: 300\r\n    remove_translation: true\r\n    remove_rotation: true\r\nlogging:\r\n  file_logger:\r\n    buffer_size: 100\r\n    streams:\r\n    - molecules\r\n    - properties\r\n  write_checkpoints: 100\r\n```\r\n\r\nCould you please have look at this?\r\n\r\nThank you\r\n","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/903082018/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"siddharth-ncl-work","id":43916742,"node_id":"MDQ6VXNlcjQzOTE2NzQy","avatar_url":"https://avatars.githubusercontent.com/u/43916742?v=4","gravatar_id":"","url":"https://api.github.com/users/siddharth-ncl-work","html_url":"https://github.com/siddharth-ncl-work","followers_url":"https://api.github.com/users/siddharth-ncl-work/followers","following_url":"https://api.github.com/users/siddharth-ncl-work/following{/other_user}","gists_url":"https://api.github.com/users/siddharth-ncl-work/gists{/gist_id}","starred_url":"https://api.github.com/users/siddharth-ncl-work/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/siddharth-ncl-work/subscriptions","organizations_url":"https://api.github.com/users/siddharth-ncl-work/orgs","repos_url":"https://api.github.com/users/siddharth-ncl-work/repos","events_url":"https://api.github.com/users/siddharth-ncl-work/events{/privacy}","received_events_url":"https://api.github.com/users/siddharth-ncl-work/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/912467065","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/319#issuecomment-912467065","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/319","id":912467065,"node_id":"IC_kwDOCMZ5Ls42YyR5","user":{"login":"mgastegger","id":36198330,"node_id":"MDQ6VXNlcjM2MTk4MzMw","avatar_url":"https://avatars.githubusercontent.com/u/36198330?v=4","gravatar_id":"","url":"https://api.github.com/users/mgastegger","html_url":"https://github.com/mgastegger","followers_url":"https://api.github.com/users/mgastegger/followers","following_url":"https://api.github.com/users/mgastegger/following{/other_user}","gists_url":"https://api.github.com/users/mgastegger/gists{/gist_id}","starred_url":"https://api.github.com/users/mgastegger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mgastegger/subscriptions","organizations_url":"https://api.github.com/users/mgastegger/orgs","repos_url":"https://api.github.com/users/mgastegger/repos","events_url":"https://api.github.com/users/mgastegger/events{/privacy}","received_events_url":"https://api.github.com/users/mgastegger/received_events","type":"User","site_admin":false},"created_at":"2021-09-03T11:27:33Z","updated_at":"2021-09-03T11:27:33Z","author_association":"COLLABORATOR","body":"Once again sorry for the late reply. I am glad to hear you could solve the `stress_handle` error.\r\n\r\nRegarding your questions:\r\n\r\n1. We are currently testing this ourselves. So far it seems that including the energies and forces is enough to also get sufficiently accurate stress tensor predictions.\r\n2. The periodic boundaries need to be specified in the extended XYZ file as well. For example `pbc=\"T T T` means that PBCs are applied in x, y and z directions.\r\n3. There was an indentation missing. `massive: true` should be part of the barostat block.\r\n4. In the current schnetpack version, is should be possible to monitor the pressure by adding `pressure_logger: 1` to the logging block. Unfortunately, the volume needs to be extracted from the HDF5 file. We are, however. currently finalizing a new version of SchNetPack with better support for NPT simulations.\r\n","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/912467065/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mgastegger","id":36198330,"node_id":"MDQ6VXNlcjM2MTk4MzMw","avatar_url":"https://avatars.githubusercontent.com/u/36198330?v=4","gravatar_id":"","url":"https://api.github.com/users/mgastegger","html_url":"https://github.com/mgastegger","followers_url":"https://api.github.com/users/mgastegger/followers","following_url":"https://api.github.com/users/mgastegger/following{/other_user}","gists_url":"https://api.github.com/users/mgastegger/gists{/gist_id}","starred_url":"https://api.github.com/users/mgastegger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mgastegger/subscriptions","organizations_url":"https://api.github.com/users/mgastegger/orgs","repos_url":"https://api.github.com/users/mgastegger/repos","events_url":"https://api.github.com/users/mgastegger/events{/privacy}","received_events_url":"https://api.github.com/users/mgastegger/received_events","type":"User","site_admin":false}},{"id":5252953967,"node_id":"CE_lADOCMZ5Ls46DOhJzwAAAAE5Gbdv","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/5252953967","actor":{"login":"mgastegger","id":36198330,"node_id":"MDQ6VXNlcjM2MTk4MzMw","avatar_url":"https://avatars.githubusercontent.com/u/36198330?v=4","gravatar_id":"","url":"https://api.github.com/users/mgastegger","html_url":"https://github.com/mgastegger","followers_url":"https://api.github.com/users/mgastegger/followers","following_url":"https://api.github.com/users/mgastegger/following{/other_user}","gists_url":"https://api.github.com/users/mgastegger/gists{/gist_id}","starred_url":"https://api.github.com/users/mgastegger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mgastegger/subscriptions","organizations_url":"https://api.github.com/users/mgastegger/orgs","repos_url":"https://api.github.com/users/mgastegger/repos","events_url":"https://api.github.com/users/mgastegger/events{/privacy}","received_events_url":"https://api.github.com/users/mgastegger/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-09-03T11:27:33Z","state_reason":null,"performed_via_github_app":null}]