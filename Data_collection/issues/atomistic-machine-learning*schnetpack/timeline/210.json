[{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/588929825","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/210#issuecomment-588929825","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/210","id":588929825,"node_id":"MDEyOklzc3VlQ29tbWVudDU4ODkyOTgyNQ==","user":{"login":"mgastegger","id":36198330,"node_id":"MDQ6VXNlcjM2MTk4MzMw","avatar_url":"https://avatars.githubusercontent.com/u/36198330?v=4","gravatar_id":"","url":"https://api.github.com/users/mgastegger","html_url":"https://github.com/mgastegger","followers_url":"https://api.github.com/users/mgastegger/followers","following_url":"https://api.github.com/users/mgastegger/following{/other_user}","gists_url":"https://api.github.com/users/mgastegger/gists{/gist_id}","starred_url":"https://api.github.com/users/mgastegger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mgastegger/subscriptions","organizations_url":"https://api.github.com/users/mgastegger/orgs","repos_url":"https://api.github.com/users/mgastegger/repos","events_url":"https://api.github.com/users/mgastegger/events{/privacy}","received_events_url":"https://api.github.com/users/mgastegger/received_events","type":"User","site_admin":false},"created_at":"2020-02-20T10:36:33Z","updated_at":"2020-02-20T10:36:33Z","author_association":"COLLABORATOR","body":"The problem are the `n_features` you pass to ` spk.atomistic.Atomwise`. Behler symmetry functions are special, as the number of features is predetermined based on the number of radial and angular functions given. This means unless you are lucky the given `n_features` will mismatch with the one built in the `SFBlock`. An easy way around this is to use the `n_symfuncs` attribute, which contains the number of features generated by the requested configuration (in this example 12) e.g:\r\n\r\n```\r\nenergy_model = spk.atomistic.Atomwise(\r\n    n_in=reps.n_symfuncs,\r\n    property=MD17.energy,\r\n    mean=means[MD17.energy],\r\n    stddev=stddevs[MD17.energy],\r\n    derivative=MD17.forces,\r\n    negative_dr=True\r\n)\r\n```\r\nI would also recommend to move\r\n```\r\nif torch.cuda.is_available():\r\n    device = \"cuda\"\r\nelse:\r\n    device = \"cpu\"\r\n```\r\nto before the `get_statistics` call, so that the GPU can be used at this point already.\r\nIn addition, I would switch the `spk.atomistic.Atomwise` layer to `spk.atomistic.ElementalAtomwise`. Standard symmetry functions give the same features for different central atoms. `ElementalAtomwise` uses different energy networks for the different elements, as in the original Behler implementations.\r\n","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/588929825/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mgastegger","id":36198330,"node_id":"MDQ6VXNlcjM2MTk4MzMw","avatar_url":"https://avatars.githubusercontent.com/u/36198330?v=4","gravatar_id":"","url":"https://api.github.com/users/mgastegger","html_url":"https://github.com/mgastegger","followers_url":"https://api.github.com/users/mgastegger/followers","following_url":"https://api.github.com/users/mgastegger/following{/other_user}","gists_url":"https://api.github.com/users/mgastegger/gists{/gist_id}","starred_url":"https://api.github.com/users/mgastegger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mgastegger/subscriptions","organizations_url":"https://api.github.com/users/mgastegger/orgs","repos_url":"https://api.github.com/users/mgastegger/repos","events_url":"https://api.github.com/users/mgastegger/events{/privacy}","received_events_url":"https://api.github.com/users/mgastegger/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/589517678","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/210#issuecomment-589517678","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/210","id":589517678,"node_id":"MDEyOklzc3VlQ29tbWVudDU4OTUxNzY3OA==","user":{"login":"neojie","id":44279474,"node_id":"MDQ6VXNlcjQ0Mjc5NDc0","avatar_url":"https://avatars.githubusercontent.com/u/44279474?v=4","gravatar_id":"","url":"https://api.github.com/users/neojie","html_url":"https://github.com/neojie","followers_url":"https://api.github.com/users/neojie/followers","following_url":"https://api.github.com/users/neojie/following{/other_user}","gists_url":"https://api.github.com/users/neojie/gists{/gist_id}","starred_url":"https://api.github.com/users/neojie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/neojie/subscriptions","organizations_url":"https://api.github.com/users/neojie/orgs","repos_url":"https://api.github.com/users/neojie/repos","events_url":"https://api.github.com/users/neojie/events{/privacy}","received_events_url":"https://api.github.com/users/neojie/received_events","type":"User","site_admin":false},"created_at":"2020-02-21T06:27:19Z","updated_at":"2020-02-21T06:27:19Z","author_association":"NONE","body":"Thank you. It solved the problem and runs smoothly if I use `spk.atomistic.Atomwise`. However, if I switch to  `spk.atomistic.ElementalAtomwise`,  I got the following error message. \r\n```\r\nTraceback (most recent call last):\r\n  File \"spk_train_bp.py\", line 138, in <module>\r\n    trainer.train(device=device, n_epochs=n_epochs)\r\n  File \"/gpfs/loomis/project/kklee/jd848/conda_envs/jd37/lib/python3.7/site-packages/schnetpack/train/trainer.py\", line 263, in train\r\n    raise e\r\n  File \"/gpfs/loomis/project/kklee/jd848/conda_envs/jd37/lib/python3.7/site-packages/schnetpack/train/trainer.py\", line 190, in train\r\n    result = self._model(train_batch)\r\n  File \"/gpfs/loomis/project/kklee/jd848/conda_envs/jd37/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 541, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/gpfs/loomis/project/kklee/jd848/conda_envs/jd37/lib/python3.7/site-packages/schnetpack/atomistic/model.py\", line 64, in forward\r\n    outs.update(output_model(inputs))\r\n  File \"/gpfs/loomis/project/kklee/jd848/conda_envs/jd37/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 541, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/gpfs/loomis/project/kklee/jd848/conda_envs/jd37/lib/python3.7/site-packages/schnetpack/atomistic/output_modules.py\", line 138, in forward\r\n    yi = self.out_net(inputs)\r\n  File \"/gpfs/loomis/project/kklee/jd848/conda_envs/jd37/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 541, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/gpfs/loomis/project/kklee/jd848/conda_envs/jd37/lib/python3.7/site-packages/schnetpack/nn/blocks.py\", line 215, in forward\r\n    gated_network = self.gate(atomic_numbers) * self.network(representation)\r\n  File \"/gpfs/loomis/project/kklee/jd848/conda_envs/jd37/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 541, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/gpfs/loomis/project/kklee/jd848/conda_envs/jd37/lib/python3.7/site-packages/schnetpack/nn/blocks.py\", line 110, in forward\r\n    return torch.cat([net(inputs) for net in self.mlps], 2)\r\nRuntimeError: cuda runtime error (710) : device-side assert triggered at /pytorch/aten/src/THC/THCCachingHostAllocator.cpp:278\r\n```\r\nIt seems that this error is due to the size mismatch [https://discuss.pytorch.org/t/runtimeerror-cuda-runtime-error-710/61751/11](url) . \r\n","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/589517678/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"neojie","id":44279474,"node_id":"MDQ6VXNlcjQ0Mjc5NDc0","avatar_url":"https://avatars.githubusercontent.com/u/44279474?v=4","gravatar_id":"","url":"https://api.github.com/users/neojie","html_url":"https://github.com/neojie","followers_url":"https://api.github.com/users/neojie/followers","following_url":"https://api.github.com/users/neojie/following{/other_user}","gists_url":"https://api.github.com/users/neojie/gists{/gist_id}","starred_url":"https://api.github.com/users/neojie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/neojie/subscriptions","organizations_url":"https://api.github.com/users/neojie/orgs","repos_url":"https://api.github.com/users/neojie/repos","events_url":"https://api.github.com/users/neojie/events{/privacy}","received_events_url":"https://api.github.com/users/neojie/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/589679636","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/210#issuecomment-589679636","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/210","id":589679636,"node_id":"MDEyOklzc3VlQ29tbWVudDU4OTY3OTYzNg==","user":{"login":"mgastegger","id":36198330,"node_id":"MDQ6VXNlcjM2MTk4MzMw","avatar_url":"https://avatars.githubusercontent.com/u/36198330?v=4","gravatar_id":"","url":"https://api.github.com/users/mgastegger","html_url":"https://github.com/mgastegger","followers_url":"https://api.github.com/users/mgastegger/followers","following_url":"https://api.github.com/users/mgastegger/following{/other_user}","gists_url":"https://api.github.com/users/mgastegger/gists{/gist_id}","starred_url":"https://api.github.com/users/mgastegger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mgastegger/subscriptions","organizations_url":"https://api.github.com/users/mgastegger/orgs","repos_url":"https://api.github.com/users/mgastegger/repos","events_url":"https://api.github.com/users/mgastegger/events{/privacy}","received_events_url":"https://api.github.com/users/mgastegger/received_events","type":"User","site_admin":false},"created_at":"2020-02-21T14:36:04Z","updated_at":"2020-02-21T14:36:04Z","author_association":"COLLABORATOR","body":"This is strange, for me it seemed to work. Did you delete the old model directory before restarting the training with the `spk.atomistic.ElementalAtomwise` block?","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/589679636/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mgastegger","id":36198330,"node_id":"MDQ6VXNlcjM2MTk4MzMw","avatar_url":"https://avatars.githubusercontent.com/u/36198330?v=4","gravatar_id":"","url":"https://api.github.com/users/mgastegger","html_url":"https://github.com/mgastegger","followers_url":"https://api.github.com/users/mgastegger/followers","following_url":"https://api.github.com/users/mgastegger/following{/other_user}","gists_url":"https://api.github.com/users/mgastegger/gists{/gist_id}","starred_url":"https://api.github.com/users/mgastegger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mgastegger/subscriptions","organizations_url":"https://api.github.com/users/mgastegger/orgs","repos_url":"https://api.github.com/users/mgastegger/repos","events_url":"https://api.github.com/users/mgastegger/events{/privacy}","received_events_url":"https://api.github.com/users/mgastegger/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/589766437","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/210#issuecomment-589766437","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/210","id":589766437,"node_id":"MDEyOklzc3VlQ29tbWVudDU4OTc2NjQzNw==","user":{"login":"neojie","id":44279474,"node_id":"MDQ6VXNlcjQ0Mjc5NDc0","avatar_url":"https://avatars.githubusercontent.com/u/44279474?v=4","gravatar_id":"","url":"https://api.github.com/users/neojie","html_url":"https://github.com/neojie","followers_url":"https://api.github.com/users/neojie/followers","following_url":"https://api.github.com/users/neojie/following{/other_user}","gists_url":"https://api.github.com/users/neojie/gists{/gist_id}","starred_url":"https://api.github.com/users/neojie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/neojie/subscriptions","organizations_url":"https://api.github.com/users/neojie/orgs","repos_url":"https://api.github.com/users/neojie/repos","events_url":"https://api.github.com/users/neojie/events{/privacy}","received_events_url":"https://api.github.com/users/neojie/received_events","type":"User","site_admin":false},"created_at":"2020-02-21T18:03:38Z","updated_at":"2020-02-21T18:03:38Z","author_association":"NONE","body":"Yes, I have deleted the `train` folder. Anyway, `spk.atomistic.Atomwise` works and I will stick to it in this case. Thank you!","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/589766437/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"neojie","id":44279474,"node_id":"MDQ6VXNlcjQ0Mjc5NDc0","avatar_url":"https://avatars.githubusercontent.com/u/44279474?v=4","gravatar_id":"","url":"https://api.github.com/users/neojie","html_url":"https://github.com/neojie","followers_url":"https://api.github.com/users/neojie/followers","following_url":"https://api.github.com/users/neojie/following{/other_user}","gists_url":"https://api.github.com/users/neojie/gists{/gist_id}","starred_url":"https://api.github.com/users/neojie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/neojie/subscriptions","organizations_url":"https://api.github.com/users/neojie/orgs","repos_url":"https://api.github.com/users/neojie/repos","events_url":"https://api.github.com/users/neojie/events{/privacy}","received_events_url":"https://api.github.com/users/neojie/received_events","type":"User","site_admin":false}},{"id":3061404217,"node_id":"MDExOkNsb3NlZEV2ZW50MzA2MTQwNDIxNw==","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/3061404217","actor":{"login":"neojie","id":44279474,"node_id":"MDQ6VXNlcjQ0Mjc5NDc0","avatar_url":"https://avatars.githubusercontent.com/u/44279474?v=4","gravatar_id":"","url":"https://api.github.com/users/neojie","html_url":"https://github.com/neojie","followers_url":"https://api.github.com/users/neojie/followers","following_url":"https://api.github.com/users/neojie/following{/other_user}","gists_url":"https://api.github.com/users/neojie/gists{/gist_id}","starred_url":"https://api.github.com/users/neojie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/neojie/subscriptions","organizations_url":"https://api.github.com/users/neojie/orgs","repos_url":"https://api.github.com/users/neojie/repos","events_url":"https://api.github.com/users/neojie/events{/privacy}","received_events_url":"https://api.github.com/users/neojie/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-02-21T18:03:38Z","state_reason":null,"performed_via_github_app":null}]