[{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/593397896","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/215#issuecomment-593397896","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/215","id":593397896,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MzM5Nzg5Ng==","user":{"login":"mgastegger","id":36198330,"node_id":"MDQ6VXNlcjM2MTk4MzMw","avatar_url":"https://avatars.githubusercontent.com/u/36198330?v=4","gravatar_id":"","url":"https://api.github.com/users/mgastegger","html_url":"https://github.com/mgastegger","followers_url":"https://api.github.com/users/mgastegger/followers","following_url":"https://api.github.com/users/mgastegger/following{/other_user}","gists_url":"https://api.github.com/users/mgastegger/gists{/gist_id}","starred_url":"https://api.github.com/users/mgastegger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mgastegger/subscriptions","organizations_url":"https://api.github.com/users/mgastegger/orgs","repos_url":"https://api.github.com/users/mgastegger/repos","events_url":"https://api.github.com/users/mgastegger/events{/privacy}","received_events_url":"https://api.github.com/users/mgastegger/received_events","type":"User","site_admin":false},"created_at":"2020-03-02T13:20:27Z","updated_at":"2020-03-02T13:20:27Z","author_association":"COLLABORATOR","body":"I am happy to hear that you like the SchNetPack training framework!\r\n\r\nUnfortunately, I'm afraid, there is no quick way to incorporate the forces in the above setup. The problem is, as you described, the derivative with respect to the positions. If descriptors are used, the force is computed via the chain rule\r\n<a href=\"https://www.codecogs.com/eqnedit.php?latex=\\mathbf{F}_\\alpha&space;=&space;-\\sum_i^{N_\\mathrm{Atoms}}&space;\\sum_d^{N_\\mathrm{Desc.}}&space;\\frac{\\partial&space;E_i}{\\partial&space;D_d}&space;\\frac{\\partial&space;D_d}{\\partial&space;\\mathbf{R}_\\alpha}\" target=\"_blank\"><img src=\"https://latex.codecogs.com/gif.latex?\\mathbf{F}_\\alpha&space;=&space;-\\sum_i^{N_\\mathrm{Atoms}}&space;\\sum_d^{N_\\mathrm{Desc.}}&space;\\frac{\\partial&space;E_i}{\\partial&space;D_d}&space;\\frac{\\partial&space;D_d}{\\partial&space;\\mathbf{R}_\\alpha}\" title=\"\\mathbf{F}_\\alpha = -\\sum_i^{N_\\mathrm{Atoms}} \\sum_d^{N_\\mathrm{Desc.}} \\frac{\\partial E_i}{\\partial D_d} \\frac{\\partial D_d}{\\partial \\mathbf{R}_\\alpha}\" /></a>, \r\nwhere <a href=\"https://www.codecogs.com/eqnedit.php?latex=\\frac{\\partial&space;E_i}{\\partial&space;D_d}\" target=\"_blank\"><img src=\"https://latex.codecogs.com/gif.latex?\\frac{\\partial&space;E_i}{\\partial&space;D_d}\" title=\"\\frac{\\partial E_i}{\\partial D_d}\" /></a> is the derivative of the energy network (here in an atomistic setup) wrt. its inputs (the descriptor) and <a href=\"https://www.codecogs.com/eqnedit.php?latex=\\frac{\\partial&space;D_d}{\\partial&space;\\mathbf{R}_\\alpha}\" target=\"_blank\"><img src=\"https://latex.codecogs.com/gif.latex?\\frac{\\partial&space;D_d}{\\partial&space;\\mathbf{R}_\\alpha}\" title=\"\\frac{\\partial D_d}{\\partial \\mathbf{R}_\\alpha}\" /></a> is the derivative of the descriptor wrt. to the positions. Both terms are needed. If SchNetPack is coupled with external descriptors, you would only be able to obtain the first term, since the positions are not part of the computational graph.\r\n\r\nThere are in principle 2 ways to solve this:\r\n-) Implement the descriptors as a torch module, where grad is enabled for the positions. In this manner, one could propagate through the whole model. This has the huge disadvantage that the descriptors in `Dscribe` would have to be implemented as torch code.\r\n\r\n-) Make use of the chain rule. The first term can be obtained with autograd in SchNetPack, the second term you would have to compute in the descriptor package. Having these two quantities, one could modify a SchNet model class to compute the total force using the chain rule above. This is the more realistic approach, although it is still a significant effort. In theory, it should be possible to get these terms via the numpy autograd package.","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/593397896/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mgastegger","id":36198330,"node_id":"MDQ6VXNlcjM2MTk4MzMw","avatar_url":"https://avatars.githubusercontent.com/u/36198330?v=4","gravatar_id":"","url":"https://api.github.com/users/mgastegger","html_url":"https://github.com/mgastegger","followers_url":"https://api.github.com/users/mgastegger/followers","following_url":"https://api.github.com/users/mgastegger/following{/other_user}","gists_url":"https://api.github.com/users/mgastegger/gists{/gist_id}","starred_url":"https://api.github.com/users/mgastegger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mgastegger/subscriptions","organizations_url":"https://api.github.com/users/mgastegger/orgs","repos_url":"https://api.github.com/users/mgastegger/repos","events_url":"https://api.github.com/users/mgastegger/events{/privacy}","received_events_url":"https://api.github.com/users/mgastegger/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/594200512","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/215#issuecomment-594200512","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/215","id":594200512,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NDIwMDUxMg==","user":{"login":"neojie","id":44279474,"node_id":"MDQ6VXNlcjQ0Mjc5NDc0","avatar_url":"https://avatars.githubusercontent.com/u/44279474?v=4","gravatar_id":"","url":"https://api.github.com/users/neojie","html_url":"https://github.com/neojie","followers_url":"https://api.github.com/users/neojie/followers","following_url":"https://api.github.com/users/neojie/following{/other_user}","gists_url":"https://api.github.com/users/neojie/gists{/gist_id}","starred_url":"https://api.github.com/users/neojie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/neojie/subscriptions","organizations_url":"https://api.github.com/users/neojie/orgs","repos_url":"https://api.github.com/users/neojie/repos","events_url":"https://api.github.com/users/neojie/events{/privacy}","received_events_url":"https://api.github.com/users/neojie/received_events","type":"User","site_admin":false},"created_at":"2020-03-03T22:19:53Z","updated_at":"2020-03-03T22:19:53Z","author_association":"NONE","body":"I see. Do you have any plans to incorporate more descriptors in Schnetpack in the near future?","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/594200512/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"neojie","id":44279474,"node_id":"MDQ6VXNlcjQ0Mjc5NDc0","avatar_url":"https://avatars.githubusercontent.com/u/44279474?v=4","gravatar_id":"","url":"https://api.github.com/users/neojie","html_url":"https://github.com/neojie","followers_url":"https://api.github.com/users/neojie/followers","following_url":"https://api.github.com/users/neojie/following{/other_user}","gists_url":"https://api.github.com/users/neojie/gists{/gist_id}","starred_url":"https://api.github.com/users/neojie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/neojie/subscriptions","organizations_url":"https://api.github.com/users/neojie/orgs","repos_url":"https://api.github.com/users/neojie/repos","events_url":"https://api.github.com/users/neojie/events{/privacy}","received_events_url":"https://api.github.com/users/neojie/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/691160670","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/215#issuecomment-691160670","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/215","id":691160670,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MTE2MDY3MA==","user":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"created_at":"2020-09-11T15:24:34Z","updated_at":"2020-09-11T15:24:34Z","author_association":"COLLABORATOR","body":"@neojie, we are planning to implement different representation modules for future versions.","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/691160670/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false}},{"id":3756778525,"node_id":"MDExOkNsb3NlZEV2ZW50Mzc1Njc3ODUyNQ==","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/3756778525","actor":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-09-11T15:24:34Z","state_reason":null,"performed_via_github_app":null},{"id":3756778559,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mzc1Njc3ODU1OQ==","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/3756778559","actor":{"login":"neojie","id":44279474,"node_id":"MDQ6VXNlcjQ0Mjc5NDc0","avatar_url":"https://avatars.githubusercontent.com/u/44279474?v=4","gravatar_id":"","url":"https://api.github.com/users/neojie","html_url":"https://github.com/neojie","followers_url":"https://api.github.com/users/neojie/followers","following_url":"https://api.github.com/users/neojie/following{/other_user}","gists_url":"https://api.github.com/users/neojie/gists{/gist_id}","starred_url":"https://api.github.com/users/neojie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/neojie/subscriptions","organizations_url":"https://api.github.com/users/neojie/orgs","repos_url":"https://api.github.com/users/neojie/repos","events_url":"https://api.github.com/users/neojie/events{/privacy}","received_events_url":"https://api.github.com/users/neojie/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-09-11T15:24:35Z","performed_via_github_app":null},{"id":3756778564,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM3NTY3Nzg1NjQ=","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/3756778564","actor":{"login":"neojie","id":44279474,"node_id":"MDQ6VXNlcjQ0Mjc5NDc0","avatar_url":"https://avatars.githubusercontent.com/u/44279474?v=4","gravatar_id":"","url":"https://api.github.com/users/neojie","html_url":"https://github.com/neojie","followers_url":"https://api.github.com/users/neojie/followers","following_url":"https://api.github.com/users/neojie/following{/other_user}","gists_url":"https://api.github.com/users/neojie/gists{/gist_id}","starred_url":"https://api.github.com/users/neojie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/neojie/subscriptions","organizations_url":"https://api.github.com/users/neojie/orgs","repos_url":"https://api.github.com/users/neojie/repos","events_url":"https://api.github.com/users/neojie/events{/privacy}","received_events_url":"https://api.github.com/users/neojie/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-09-11T15:24:35Z","performed_via_github_app":null}]