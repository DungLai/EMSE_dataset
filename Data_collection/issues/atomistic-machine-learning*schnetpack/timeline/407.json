[{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1121268133","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/407#issuecomment-1121268133","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407","id":1121268133,"node_id":"IC_kwDOCMZ5Ls5C1TGl","user":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"created_at":"2022-05-09T15:42:54Z","updated_at":"2022-05-09T15:42:54Z","author_association":"COLLABORATOR","body":"Hey @JordD04 ,\r\nnormally the force predictions should also work well for periodic boundary conditions.\r\nDid you check if the datapoints in the db have the `pbc=True` flag? It also seems like big batches can cause problems with training on forces. Could you rerun the training with a batchsize of 10?","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1121268133/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false}},{"id":6574304708,"node_id":"MEE_lADOCMZ5Ls5JLdewzwAAAAGH2-3E","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/6574304708","actor":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-05-09T15:42:54Z","performed_via_github_app":null},{"id":6574304718,"node_id":"SE_lADOCMZ5Ls5JLdewzwAAAAGH2-3O","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/6574304718","actor":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-05-09T15:42:54Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1122355712","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/407#issuecomment-1122355712","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407","id":1122355712,"node_id":"IC_kwDOCMZ5Ls5C5coA","user":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false},"created_at":"2022-05-10T12:57:31Z","updated_at":"2022-05-10T12:57:31Z","author_association":"NONE","body":"Hello @Stefaanhess ,\r\nThanks for getting back to me.\r\nI've checked my database and the atoms objects all include `pbc=True`.\r\nI've done some testing on batch size but I've been unable to see any real difference. (These tests were performed on a smaller training set than in my original post: 6000 vs 12,000 structures).\r\nBS = 150\r\n![150_loss](https://user-images.githubusercontent.com/1126249/167632647-692fa7d5-7412-4c8e-b874-54fd181e1f8b.png)\r\nBS = 50\r\n![50_loss](https://user-images.githubusercontent.com/1126249/167632681-53de8acd-3445-4c0c-8757-42295dd5fa0a.png)\r\nBS = 10\r\n![10_loss](https://user-images.githubusercontent.com/1126249/167632716-dc90eea5-7adf-4968-baf5-e118a96c4b03.png)\r\nBS = 1\r\n![1_loss](https://user-images.githubusercontent.com/1126249/167632746-a8eea84c-86db-459c-ad33-fc18360924cd.png)\r\n\r\n\r\nFor most of these NN's, the MAE error of the validation set only increases from initialisation.\r\n![10_error](https://user-images.githubusercontent.com/1126249/167632989-35f35d14-1607-4a66-8bb1-db80802f8d6c.png)\r\n\r\n","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1122355712/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false}},{"id":6581721422,"node_id":"MEE_lADOCMZ5Ls5JLdewzwAAAAGITRlO","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/6581721422","actor":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-05-10T12:57:32Z","performed_via_github_app":null},{"id":6581721432,"node_id":"SE_lADOCMZ5Ls5JLdewzwAAAAGITRlY","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/6581721432","actor":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-05-10T12:57:32Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1122511979","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/407#issuecomment-1122511979","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407","id":1122511979,"node_id":"IC_kwDOCMZ5Ls5C6Cxr","user":{"login":"smausenberger","id":102220700,"node_id":"U_kgDOBhfDnA","avatar_url":"https://avatars.githubusercontent.com/u/102220700?v=4","gravatar_id":"","url":"https://api.github.com/users/smausenberger","html_url":"https://github.com/smausenberger","followers_url":"https://api.github.com/users/smausenberger/followers","following_url":"https://api.github.com/users/smausenberger/following{/other_user}","gists_url":"https://api.github.com/users/smausenberger/gists{/gist_id}","starred_url":"https://api.github.com/users/smausenberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smausenberger/subscriptions","organizations_url":"https://api.github.com/users/smausenberger/orgs","repos_url":"https://api.github.com/users/smausenberger/repos","events_url":"https://api.github.com/users/smausenberger/events{/privacy}","received_events_url":"https://api.github.com/users/smausenberger/received_events","type":"User","site_admin":false},"created_at":"2022-05-10T15:00:27Z","updated_at":"2022-05-10T15:00:27Z","author_association":"NONE","body":"When you only train energies, does it overfit too?\r\nIf the energies train well and the forces overfit there might be a problem with your database. Check if the data is in the right order.","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1122511979/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"smausenberger","id":102220700,"node_id":"U_kgDOBhfDnA","avatar_url":"https://avatars.githubusercontent.com/u/102220700?v=4","gravatar_id":"","url":"https://api.github.com/users/smausenberger","html_url":"https://github.com/smausenberger","followers_url":"https://api.github.com/users/smausenberger/followers","following_url":"https://api.github.com/users/smausenberger/following{/other_user}","gists_url":"https://api.github.com/users/smausenberger/gists{/gist_id}","starred_url":"https://api.github.com/users/smausenberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smausenberger/subscriptions","organizations_url":"https://api.github.com/users/smausenberger/orgs","repos_url":"https://api.github.com/users/smausenberger/repos","events_url":"https://api.github.com/users/smausenberger/events{/privacy}","received_events_url":"https://api.github.com/users/smausenberger/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1122689574","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/407#issuecomment-1122689574","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407","id":1122689574,"node_id":"IC_kwDOCMZ5Ls5C6uIm","user":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false},"created_at":"2022-05-10T17:43:28Z","updated_at":"2022-05-10T17:43:28Z","author_association":"NONE","body":"Hey @smausenberger .\r\nI don't have an energy-only NN to hand atm but I trained a potential a little while back that had a Rho of 0.7 for forces and 0.1 for energies.\r\n![R0_7_error](https://user-images.githubusercontent.com/1126249/167688538-6aaf23c3-062a-4486-a607-9bda01e71749.png)\r\n![R0_7_loss](https://user-images.githubusercontent.com/1126249/167688541-64eece0c-0040-4e61-8d31-9c53d3e7b2da.png)\r\nThis bottom picture shows a comparison of the training and validation energies and forces. But this is a query by committee implementation so the errors are smaller here than the errors of the individual NNs.\r\n![ml_plotter](https://user-images.githubusercontent.com/1126249/167688590-11bea2fd-0b0d-46cd-a849-c811a6a796d0.png)\r\nIt looks like the energies are being learned just fine here.\r\nIn my experiments with Rho, i've found that favouring energies makes quite a considerable improvement to the energy error but favouring forces makes only a very small improvement to forces.\r\n\r\nWhat do you mean when you say \"check the data is in the right order?\". If you're just talking about matching the right energies/forces to their respective atoms object, I'm fairly confident that that is all OK. My cells have different numbers of atoms and if things weren't matching up properly, I imagine SchNetPack would be returning lots of 'list index out of range' errors. \r\nI *think* I'm saving my forces in the correct way.\r\nIf I do:\r\n```\r\ndataset = AtomsData(database_file)\r\natoms, properties = dataset.get_properties(0)\r\nprint(properties['forces'])\r\n```\r\nI receive something like this, which I believe is a numpy array of floats:\r\n```\r\n[[-0.00251  0.00327  0.00196]\r\n [-0.00251 -0.00327  0.00196]\r\n [ 0.00886 -0.00202  0.00848]\r\n [ 0.00886  0.00202  0.00848]\r\n [ 0.00403 -0.00076 -0.00332]\r\n [ 0.00403  0.00076 -0.00332]\r\n [-0.00387 -0.00578  0.00726]\r\n [-0.00387  0.00578  0.00726]\r\n [-0.00392 -0.00012 -0.00257]\r\n [-0.00392  0.00012 -0.00257]\r\n [ 0.00367  0.00787  0.0089 ]\r\n [ 0.00367 -0.00787  0.0089 ]\r\n [-0.00446 -0.03232 -0.02316]\r\n [-0.00446  0.03232 -0.02316]\r\n [ 0.00933  0.00384  0.00322]\r\n [ 0.00933 -0.00384  0.00322]\r\n [-0.01113 -0.01258 -0.00078]\r\n [-0.01113  0.01258 -0.00078]]\r\n```","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1122689574/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false}},{"id":6583992582,"node_id":"MEE_lADOCMZ5Ls5JLdewzwAAAAGIb8EG","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/6583992582","actor":{"login":"smausenberger","id":102220700,"node_id":"U_kgDOBhfDnA","avatar_url":"https://avatars.githubusercontent.com/u/102220700?v=4","gravatar_id":"","url":"https://api.github.com/users/smausenberger","html_url":"https://github.com/smausenberger","followers_url":"https://api.github.com/users/smausenberger/followers","following_url":"https://api.github.com/users/smausenberger/following{/other_user}","gists_url":"https://api.github.com/users/smausenberger/gists{/gist_id}","starred_url":"https://api.github.com/users/smausenberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smausenberger/subscriptions","organizations_url":"https://api.github.com/users/smausenberger/orgs","repos_url":"https://api.github.com/users/smausenberger/repos","events_url":"https://api.github.com/users/smausenberger/events{/privacy}","received_events_url":"https://api.github.com/users/smausenberger/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-05-10T17:43:29Z","performed_via_github_app":null},{"id":6583992591,"node_id":"SE_lADOCMZ5Ls5JLdewzwAAAAGIb8EP","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/6583992591","actor":{"login":"smausenberger","id":102220700,"node_id":"U_kgDOBhfDnA","avatar_url":"https://avatars.githubusercontent.com/u/102220700?v=4","gravatar_id":"","url":"https://api.github.com/users/smausenberger","html_url":"https://github.com/smausenberger","followers_url":"https://api.github.com/users/smausenberger/followers","following_url":"https://api.github.com/users/smausenberger/following{/other_user}","gists_url":"https://api.github.com/users/smausenberger/gists{/gist_id}","starred_url":"https://api.github.com/users/smausenberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smausenberger/subscriptions","organizations_url":"https://api.github.com/users/smausenberger/orgs","repos_url":"https://api.github.com/users/smausenberger/repos","events_url":"https://api.github.com/users/smausenberger/events{/privacy}","received_events_url":"https://api.github.com/users/smausenberger/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-05-10T17:43:29Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1122789909","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/407#issuecomment-1122789909","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407","id":1122789909,"node_id":"IC_kwDOCMZ5Ls5C7GoV","user":{"login":"smausenberger","id":102220700,"node_id":"U_kgDOBhfDnA","avatar_url":"https://avatars.githubusercontent.com/u/102220700?v=4","gravatar_id":"","url":"https://api.github.com/users/smausenberger","html_url":"https://github.com/smausenberger","followers_url":"https://api.github.com/users/smausenberger/followers","following_url":"https://api.github.com/users/smausenberger/following{/other_user}","gists_url":"https://api.github.com/users/smausenberger/gists{/gist_id}","starred_url":"https://api.github.com/users/smausenberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smausenberger/subscriptions","organizations_url":"https://api.github.com/users/smausenberger/orgs","repos_url":"https://api.github.com/users/smausenberger/repos","events_url":"https://api.github.com/users/smausenberger/events{/privacy}","received_events_url":"https://api.github.com/users/smausenberger/received_events","type":"User","site_admin":false},"created_at":"2022-05-10T19:40:07Z","updated_at":"2022-05-10T19:40:07Z","author_association":"NONE","body":"Your energies don't look **that** bad. I assume you train the forces as derivatives from energy? \r\nIf so, the forces should improve with better energies except your reference data is wrong.\r\n\r\nWith right order I meant to check if the coordinate axes are switched or if the order of atoms in the force data differs from the order of atoms in the input data. That would explain the overfitting. I recently had a similar issue and the problem was that I messed up the reshaping of my force data.","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1122789909/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"smausenberger","id":102220700,"node_id":"U_kgDOBhfDnA","avatar_url":"https://avatars.githubusercontent.com/u/102220700?v=4","gravatar_id":"","url":"https://api.github.com/users/smausenberger","html_url":"https://github.com/smausenberger","followers_url":"https://api.github.com/users/smausenberger/followers","following_url":"https://api.github.com/users/smausenberger/following{/other_user}","gists_url":"https://api.github.com/users/smausenberger/gists{/gist_id}","starred_url":"https://api.github.com/users/smausenberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smausenberger/subscriptions","organizations_url":"https://api.github.com/users/smausenberger/orgs","repos_url":"https://api.github.com/users/smausenberger/repos","events_url":"https://api.github.com/users/smausenberger/events{/privacy}","received_events_url":"https://api.github.com/users/smausenberger/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1123545989","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/407#issuecomment-1123545989","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407","id":1123545989,"node_id":"IC_kwDOCMZ5Ls5C9_OF","user":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false},"created_at":"2022-05-11T10:30:43Z","updated_at":"2022-05-11T10:30:43Z","author_association":"NONE","body":"I've just made a database from the output of a single CASTEP singlepoint calculation.\r\nEnergy is fine\r\nForces look totally fine (assuming SchNetPack wants them in the format I've listed in my last comment).\r\nCell parameters look fine.\r\nI have the positions in my atoms object in absolute coordinates. Should I be using fractional/scaled coordinates?\r\n","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1123545989/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1123572226","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/407#issuecomment-1123572226","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407","id":1123572226,"node_id":"IC_kwDOCMZ5Ls5C-FoC","user":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"created_at":"2022-05-11T10:54:22Z","updated_at":"2022-05-11T10:54:22Z","author_association":"COLLABORATOR","body":"The positions should be in absolute coordinates, so that is not the problem.\r\nI just started a model on some Si structures with energy+forces and will get you updated when I have the results!","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1123572226/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1123935468","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/407#issuecomment-1123935468","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407","id":1123935468,"node_id":"IC_kwDOCMZ5Ls5C_eTs","user":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"created_at":"2022-05-11T15:32:01Z","updated_at":"2022-05-11T15:32:01Z","author_association":"COLLABORATOR","body":"The first epochs of my training are done and the results do already look very different from yours:\r\n![image](https://user-images.githubusercontent.com/23171261/167881666-303d39b6-89f9-4898-9e43-d29bd74dfb3d.png)\r\n\r\nThe units are eV/Ang.\r\nI trained my model on Si structures with PBC and energy+forces+stress and I use the current dev-branch for training. From your args-file I assume, that you use the current master branch. Although I do not think this makes any difference, you could try to use the current dev branch.\r\n\r\nI have some ideas, that you could still try:\r\n- For some edge cases the torch provider can cause problems (e.g. pbc structures with atoms outside of the cell). I would try to use ase instead.\r\n- Could you also try to use `aggregation_mode=\"sum\"`? Since you train without energies this should work out well.\r\n- Also try `normalize_filters=False`. I am not sure if that makes a huge difference, but you could try.\r\n- Do you use any special split?\r\n\r\nIf these things do not work, I would suggest to use try the dev branch. This should reproduce my results if your data is ok. I am currently working on a tutorial for the usage of forces+PBC with our new dev branch. I hope to finish it by the end of the week. If the dev branch still produces bad results, the issue could be related to the data. Since you generate the data yourself, you could try to use parameters with higher accuracy.\r\n","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1123935468/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1123944780","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/407#issuecomment-1123944780","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407","id":1123944780,"node_id":"IC_kwDOCMZ5Ls5C_glM","user":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false},"created_at":"2022-05-11T15:41:06Z","updated_at":"2022-05-11T15:42:54Z","author_association":"NONE","body":"Thanks for getting back so soon, @Stefaanhess .\r\nMy GPU cluster is being a bit unresponsive today but I will try everything you suggest and report back ASAP.\r\nThe one point I can report back on right now is my split file. I generate my split files randomly but in such a way that one geometry optimisation is never divided between the training set and the validation set (i.e. one geom walk can only end up in the training set or the validation set).","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1123944780/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false}},{"id":6591626020,"node_id":"MEE_lADOCMZ5Ls5JLdewzwAAAAGI5Dsk","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/6591626020","actor":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-05-11T15:41:07Z","performed_via_github_app":null},{"id":6591626031,"node_id":"SE_lADOCMZ5Ls5JLdewzwAAAAGI5Dsv","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/6591626031","actor":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-05-11T15:41:07Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1127812625","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/407#issuecomment-1127812625","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407","id":1127812625,"node_id":"IC_kwDOCMZ5Ls5DOQ4R","user":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false},"created_at":"2022-05-16T15:24:32Z","updated_at":"2022-05-16T15:24:51Z","author_association":"NONE","body":"Sorry for the long wait. Apparently many of my cluster's GPUs were being reserved for an event.\r\nI reran the training with: `\"aggregation_mode\": \"sum\"`, `\"environment_provider\": \"ase\"`, and `\"normalize_filter\": true`, both individually and together. Unfortunately I get the same results.\r\n\r\nMy group is using a slightly older version of SchNetPack because we've had trouble getting the newer version to work.\r\nI *think*\r\n```\r\n    ep_device = torch.device(args.environment_provider_device)\r\nAttributeError: 'Namespace' object has no attribute 'environment_provider_device'\r\n```\r\nwas the error people were reporting to me.\r\n\r\nI've attempted to train using the Dev branch but it's causing me a little bother.\r\nI generally train with spk_run.py which seems to be absent on the Dev branch. I've been using https://github.com/atomistic-machine-learning/schnetpack/blob/master/src/examples/ethanol_script.py and the ReadTheDocs to aid in writing a script but it looks like a lot has changed in the Dev branch.\r\nThe AtomsData class has been removed, but I think I can replace that with ASEAtomsData (?). However, schnetpack.atomistic seems to be completely different now. Is there any documentation for this? \r\n\r\nIn any case, these differences in the code may explain why force training is working for you but not me.","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1127812625/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1139583038","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/407#issuecomment-1139583038","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407","id":1139583038,"node_id":"IC_kwDOCMZ5Ls5D7Kg-","user":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false},"created_at":"2022-05-27T12:42:21Z","updated_at":"2022-05-27T12:42:21Z","author_association":"NONE","body":"Hey @Stefaanhess \r\nI've been playing around with the dev branch with training from both the CLI and directly by writing scripts (i've found some relevant tutorials).\r\nI had a little trouble getting it running.\r\nWith the CLI I had a problem with self.trainer missing the _device_type attribute and self.trainer.training_type_plugin missing the should_rank_save_checkpoint attribute. I implemented a hacky fix for both to get it running.\r\nI also tried running through a script (via this tutorial https://github.com/atomistic-machine-learning/schnetpack/blob/dev/docs/tutorials/tutorial_03_force_models.ipynb) and again had issues with rank_save_checkpoint, which stopped the best model ever being saved. I just changed the statement to `if 1 == 1:` as a quick \"fix\" to get it to run.\r\nLogging to csv files is not working as intended either.  The data looks like this:\r\n```\r\n0.008915147,0.206631914,0.040407341,0,39,,,\r\n,,,1,39,0.731627464,0.057642017,\r\n,,,1,49,,,0.016790237\r\n0.008443713,0.184204191,0.037232045,1,79,,,\r\n,,,2,79,0.156106502,0.036610086,\r\n,,,2,99,,,0.005108949\r\n```\r\nIts all there but its split over multiple files.\r\n\r\nThat aside: I trained a model and got pretty much the same results that I got when training on the master branch.My input file is here: [jord-schnet-dev.txt](https://github.com/atomistic-machine-learning/schnetpack/files/8786710/jord-schnet-dev.txt) (it's a .txt because github didn't like my .py), and the force errors are shown below.\r\n![schnetpack-dev-branch-error](https://user-images.githubusercontent.com/1126249/170698335-81c51414-d987-42f0-b1e7-3f3f20a372af.png)\r\n\r\nI intend to try again with some slightly different hyperparameters and a slightly different data set but I'm not hopeful that that will be fruitful.\r\n\r\nIs there any chance you could share your Si database and your python input file?\r\nIf I can run that and reproduce your results, I can be satisfied that it's an issue with the data and not a code issue.\r\n\r\nAlternatively, maybe I could share my data with you and you could try to train it?\r\nEither would be greatly appreciated.","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1139583038/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false}},{"id":6692324805,"node_id":"MEE_lADOCMZ5Ls5JLdewzwAAAAGO5MXF","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/6692324805","actor":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-05-27T12:42:21Z","performed_via_github_app":null},{"id":6692324811,"node_id":"SE_lADOCMZ5Ls5JLdewzwAAAAGO5MXL","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/6692324811","actor":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-05-27T12:42:21Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1143847846","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/407#issuecomment-1143847846","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407","id":1143847846,"node_id":"IC_kwDOCMZ5Ls5ELbum","user":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"created_at":"2022-06-01T16:32:35Z","updated_at":"2022-06-01T16:32:35Z","author_association":"COLLABORATOR","body":"Hey @JordD04 ,\r\nsorry for the late reply. Unfortunately I will not be able to share my dataset since it is related to current research or train any models on your data. I hope you can understand this.\r\nI am currently looking to find a good benchmark dataset for PBC structures with forces. Also we are currently working on a collection of example models, which will include the settings for training on forces with PBC structures.\r\nI already uploaded my config file for you in this [gist](https://gist.github.com/Stefaanhess/a66b4536488194da7a160e0d1d129421). You can just create a folder `configs/experiment` and save this as `<experiment_name>.yaml`. Afterwards you should be able to run in on your own data by using `spktrain --config-name=configs experiment=<experiment_name> data.datapath=<dataset_path>.db data.num_train=0.8 data.num_val=0.1`. I just tried it with the current dev branch and it runs fine.\r\nI hope this can somehow help to solve your problem. Let me know if you run into any problems with this gist. I will also give an update here when we find a suitable dataset for PBC with forces.\r\n","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1143847846/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false}},{"id":6720830367,"node_id":"MEE_lADOCMZ5Ls5JLdewzwAAAAGQl7uf","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/6720830367","actor":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-06-01T16:32:35Z","performed_via_github_app":null},{"id":6720830374,"node_id":"SE_lADOCMZ5Ls5JLdewzwAAAAGQl7um","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/6720830374","actor":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-06-01T16:32:35Z","performed_via_github_app":null},{"actor":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false},"created_at":"2022-06-06T10:24:11Z","updated_at":"2022-06-06T10:24:11Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/416","repository_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack","labels_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/416/labels{/name}","comments_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/416/comments","events_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/416/events","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/416","id":1260091186,"node_id":"I_kwDOCMZ5Ls5LG3cy","number":416,"title":"[Usage Question] How to improve (reduce) the evaluation metrics when training complex system (Zeolites) MD data with forces?","user":{"login":"Chenghan-Sun","id":43866006,"node_id":"MDQ6VXNlcjQzODY2MDA2","avatar_url":"https://avatars.githubusercontent.com/u/43866006?v=4","gravatar_id":"","url":"https://api.github.com/users/Chenghan-Sun","html_url":"https://github.com/Chenghan-Sun","followers_url":"https://api.github.com/users/Chenghan-Sun/followers","following_url":"https://api.github.com/users/Chenghan-Sun/following{/other_user}","gists_url":"https://api.github.com/users/Chenghan-Sun/gists{/gist_id}","starred_url":"https://api.github.com/users/Chenghan-Sun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Chenghan-Sun/subscriptions","organizations_url":"https://api.github.com/users/Chenghan-Sun/orgs","repos_url":"https://api.github.com/users/Chenghan-Sun/repos","events_url":"https://api.github.com/users/Chenghan-Sun/events{/privacy}","received_events_url":"https://api.github.com/users/Chenghan-Sun/received_events","type":"User","site_admin":false},"labels":[{"id":1044272344,"node_id":"MDU6TGFiZWwxMDQ0MjcyMzQ0","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/labels/question","name":"question","color":"d876e3","default":true,"description":"Not a bug report, but a question or other problem"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2022-06-03T16:04:22Z","updated_at":"2022-06-17T21:41:39Z","closed_at":"2022-06-17T12:28:00Z","author_association":"NONE","active_lock_reason":null,"repository":{"id":147224878,"node_id":"MDEwOlJlcG9zaXRvcnkxNDcyMjQ4Nzg=","name":"schnetpack","full_name":"atomistic-machine-learning/schnetpack","private":false,"owner":{"login":"atomistic-machine-learning","id":26488588,"node_id":"MDEyOk9yZ2FuaXphdGlvbjI2NDg4NTg4","avatar_url":"https://avatars.githubusercontent.com/u/26488588?v=4","gravatar_id":"","url":"https://api.github.com/users/atomistic-machine-learning","html_url":"https://github.com/atomistic-machine-learning","followers_url":"https://api.github.com/users/atomistic-machine-learning/followers","following_url":"https://api.github.com/users/atomistic-machine-learning/following{/other_user}","gists_url":"https://api.github.com/users/atomistic-machine-learning/gists{/gist_id}","starred_url":"https://api.github.com/users/atomistic-machine-learning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atomistic-machine-learning/subscriptions","organizations_url":"https://api.github.com/users/atomistic-machine-learning/orgs","repos_url":"https://api.github.com/users/atomistic-machine-learning/repos","events_url":"https://api.github.com/users/atomistic-machine-learning/events{/privacy}","received_events_url":"https://api.github.com/users/atomistic-machine-learning/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/atomistic-machine-learning/schnetpack","description":"SchNetPack - Deep Neural Networks for Atomistic Systems","fork":false,"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack","forks_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/forks","keys_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/keys{/key_id}","collaborators_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/teams","hooks_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/hooks","issue_events_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events{/number}","events_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/events","assignees_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/assignees{/user}","branches_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/branches{/branch}","tags_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/tags","blobs_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/git/refs{/sha}","trees_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/git/trees{/sha}","statuses_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/statuses/{sha}","languages_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/languages","stargazers_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/stargazers","contributors_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/contributors","subscribers_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/subscribers","subscription_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/subscription","commits_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/commits{/sha}","git_commits_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/git/commits{/sha}","comments_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/comments{/number}","issue_comment_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments{/number}","contents_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/contents/{+path}","compare_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/compare/{base}...{head}","merges_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/merges","archive_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/downloads","issues_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues{/number}","pulls_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/pulls{/number}","milestones_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/milestones{/number}","notifications_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/labels{/name}","releases_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/releases{/id}","deployments_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/deployments","created_at":"2018-09-03T15:44:35Z","updated_at":"2023-01-19T06:30:46Z","pushed_at":"2023-01-11T14:21:06Z","git_url":"git://github.com/atomistic-machine-learning/schnetpack.git","ssh_url":"git@github.com:atomistic-machine-learning/schnetpack.git","clone_url":"https://github.com/atomistic-machine-learning/schnetpack.git","svn_url":"https://github.com/atomistic-machine-learning/schnetpack","homepage":null,"size":33470,"stargazers_count":557,"watchers_count":557,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":167,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["condensed-matter","machine-learning","molecular-dynamics","neural-network","quantum-chemistry"],"visibility":"public","forks":167,"open_issues":2,"watchers":557,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Hi SchNetPack development team,\r\n\r\nI've been using SchNetPack as an alternative approach to the traditional descriptor-based molecular representations for a while, and I also did some research on the original published papers of SchNet as well as some recent applications of SchNet in various molecular prediction tasks. \r\n\r\nRecently, I'm trying to use SchNet representation to train on about 10K (specifically, 10344 images) MD data with both energies and forces on Chabazite Zeolite system (108 atoms per image, with 72O and 36Si). In this dataset, PBC is guaranteed, so even if the number of atoms per image is relatively large, that should be the only resource of complexity regarding to the relatively simple local environments. However, with a very finely tuned hyper-parameters searching procedure, I'm still very struggled with training with forces (i.e., to achieve a low MAEs for decomposed forces in x-y-z directions). \r\n\r\nThe finalized parameters and partitions I used is listed as:\r\n```\r\nData Settings:\r\n num_train: 100 / 1000 / 10000 \r\n num_val: 20 / 100 / 344 \r\n num_test: the remaining dataset\r\n batch_size: 8\r\n\r\nModel Settings:\r\n n_features: 128\r\n n_atom_basis: 128\r\n n_filters: 128\r\n n_gaussians: 60\r\n n_interactions: 6\r\n cutoff: 6.0\r\n force option: yes \r\n\r\nTraining Settings:\r\n Device: cuda\r\n rho_tradeoff: 0.01\r\n learning rate: 0.001\r\n Patience: 5\r\n n_epochs: 300 \r\n```\r\n\r\nHere is some of my SchNetPack training results: \r\n- Task 1: randomly select 100 images as training set and 20 images as validation set:\r\n```\r\nMAE train = 0.365 eV; MAE validation = 0.356 eV (energy)\r\nMAE train = 0.333 eV/A; MAE validation = 0.324  eV/A (forces at x axis )\r\nMAE train = 0.340 eV/A; MAE validation = 0.306 eV/A (forces at y axis)\r\nMAE train = 0.363 eV/A; MAE validation = 0.339 eV/A (forces at z axis)\r\n```\r\n- Task 2: randomly select 1000 images as training set and 100 images as validation set:\r\n```\r\nMAE train = 0.186 eV; MAE validation = 0.239 eV (energy)\r\nMAE train = 0.283 eV/A; MAE validation = 0.298  eV/A (forces at x axis )\r\nMAE train = 0.290 eV/A; MAE validation = 0.309 eV/A (forces at y axis)\r\nMAE train = 0.318 eV/A; MAE validation = 0.334 eV/A (forces at z axis)\r\n```\r\n- Task 3: randomly select 10000 images as training set and the remaining 344 images as validation set:\r\n```\r\nMAE train = 0.067 eV; MAE validation = 0.112 eV (energy)\r\nMAE train = 0.212 eV/A; MAE validation = 0.248  eV/A (forces at x axis )\r\nMAE train = 0.218 eV/A; MAE validation = 0.248 eV/A (forces at y axis)\r\nMAE train = 0.241 eV/A; MAE validation = 0.275 eV/A (forces at z axis)\r\n```\r\nAll the training and validation loss functions plotted in scenarios above looks fairly smooth. So in summary, as I increase the size of training set, I do see improvements of MAEs for both energies and forces. The MAE of energies can be improved to between 0.1 eV and 0..15 eV, which is very acceptable considering the typical error of ab-Initio method (e.g. DFT) with +- 0.15 eV error. However, regarding the forces, the MAEs are generally too large. \r\n\r\nWith the same setting of hyper-parameters, I finally did a full train-validation-test splits on my CHA database, following with 80-10-10 percent rule. Here is some more specific parity plots I obtained after reloaded the model on the test set: \r\n- Task 4: randomly select 8344 images as training set 1000 images as validation set, and the remaining 1000 images as test set:\r\n```\r\nMAE train = 0.079 eV; MAE validation = 0.119 eV; MAE test = 0.132 eV (energy)\r\nMAE train = 0.218 eV/A; MAE validation = 0.256 eV/A; MAE test = 0.256 eV/A (forces at x axis )\r\nMAE train = 0.224 eV/A; MAE validation = 0.262 eV/A; MAE test = 0.262 eV/A (forces at y axis)\r\nMAE train = 0.246 eV/A; MAE validation = 0.285 eV/A; MAE test = 0.284 eV/A (forces at z axis)\r\n```\r\nParity plots:\r\n![energy_parity_plots_sns_ver](https://user-images.githubusercontent.com/43866006/171902522-0acc973f-e318-43f4-a2cb-3e5be8c651f4.png)\r\n![force_x_parity_plots_sns_ver_mixedCHA_8344train_batch4](https://user-images.githubusercontent.com/43866006/171925637-60fc8174-3b32-4457-9444-7877c2f4620c.png)\r\n![force_y_parity_plots_sns_ver_mixedCHA_8344train_batch4](https://user-images.githubusercontent.com/43866006/171925658-fe62dba8-601c-424f-9782-34fc79483074.png)\r\n![force_z_parity_plots_sns_ver_mixedCHA_8344train_batch4](https://user-images.githubusercontent.com/43866006/171925676-6f1cb0a7-1908-412b-b82a-eeef9cf6cc90.png)\r\n\r\nLoss functions: \r\n![loss_mixedCHA_model_v4_8344train](https://user-images.githubusercontent.com/43866006/171902999-92480e22-d496-4060-a20e-2bf9112c5204.png)\r\n\r\nThat's all my current progress now. One of my colleague used another ML package called DeepMDkit to train the same dataset, and been able to reduct the force MAEs to the 10^-2 scale. As I have been played with SchNetPack for a while, I hope to get some suggestions from the developer team regarding to making the forces training better. Any idea or suggestions will be appreciate! \r\n\r\nBest regards,\r\nChenghan Sun\r\n","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/416/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/416/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":6760378270,"node_id":"LE_lADOCMZ5Ls5JLdewzwAAAAGS8y-e","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/6760378270","actor":{"login":"ktschuett","id":6585114,"node_id":"MDQ6VXNlcjY1ODUxMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/6585114?v=4","gravatar_id":"","url":"https://api.github.com/users/ktschuett","html_url":"https://github.com/ktschuett","followers_url":"https://api.github.com/users/ktschuett/followers","following_url":"https://api.github.com/users/ktschuett/following{/other_user}","gists_url":"https://api.github.com/users/ktschuett/gists{/gist_id}","starred_url":"https://api.github.com/users/ktschuett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ktschuett/subscriptions","organizations_url":"https://api.github.com/users/ktschuett/orgs","repos_url":"https://api.github.com/users/ktschuett/repos","events_url":"https://api.github.com/users/ktschuett/events{/privacy}","received_events_url":"https://api.github.com/users/ktschuett/received_events","type":"User","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-06-07T11:23:54Z","label":{"name":"question","color":"d876e3"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1148539438","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/407#issuecomment-1148539438","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407","id":1148539438,"node_id":"IC_kwDOCMZ5Ls5EdVIu","user":{"login":"ktschuett","id":6585114,"node_id":"MDQ6VXNlcjY1ODUxMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/6585114?v=4","gravatar_id":"","url":"https://api.github.com/users/ktschuett","html_url":"https://github.com/ktschuett","followers_url":"https://api.github.com/users/ktschuett/followers","following_url":"https://api.github.com/users/ktschuett/following{/other_user}","gists_url":"https://api.github.com/users/ktschuett/gists{/gist_id}","starred_url":"https://api.github.com/users/ktschuett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ktschuett/subscriptions","organizations_url":"https://api.github.com/users/ktschuett/orgs","repos_url":"https://api.github.com/users/ktschuett/repos","events_url":"https://api.github.com/users/ktschuett/events{/privacy}","received_events_url":"https://api.github.com/users/ktschuett/received_events","type":"User","site_admin":false},"created_at":"2022-06-07T11:27:27Z","updated_at":"2022-06-07T11:27:27Z","author_association":"CONTRIBUTOR","body":"> [...] it looks like a lot has changed in the Dev branch. The AtomsData class has been removed, but I think I can replace that with ASEAtomsData (?). However, schnetpack.atomistic seems to be completely different now. Is there any documentation for this?\r\n\r\nYou can find the documentation here: https://schnetpack.readthedocs.io/en/dev/\r\n","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1148539438/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ktschuett","id":6585114,"node_id":"MDQ6VXNlcjY1ODUxMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/6585114?v=4","gravatar_id":"","url":"https://api.github.com/users/ktschuett","html_url":"https://github.com/ktschuett","followers_url":"https://api.github.com/users/ktschuett/followers","following_url":"https://api.github.com/users/ktschuett/following{/other_user}","gists_url":"https://api.github.com/users/ktschuett/gists{/gist_id}","starred_url":"https://api.github.com/users/ktschuett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ktschuett/subscriptions","organizations_url":"https://api.github.com/users/ktschuett/orgs","repos_url":"https://api.github.com/users/ktschuett/repos","events_url":"https://api.github.com/users/ktschuett/events{/privacy}","received_events_url":"https://api.github.com/users/ktschuett/received_events","type":"User","site_admin":false}},{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1148990011","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/407#issuecomment-1148990011","issue_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407","id":1148990011,"node_id":"IC_kwDOCMZ5Ls5EfDI7","user":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"created_at":"2022-06-07T17:51:50Z","updated_at":"2022-06-07T17:51:50Z","author_association":"COLLABORATOR","body":"Hey @JordD04 ,\r\nI have been looking for an available dataset with pbc + forces and found one for Li4P2O7, that is also used [here](https://arxiv.org/pdf/2101.03164.pdf) and [here](https://arxiv.org/pdf/1905.02791.pdf). Although the full tutorial is not ready yet, I will already share my files so you can try to reproduce the results on the same dataset.\r\n\r\n**Preparing the Dataset**\r\n\r\n- Since the data is not included as a benchmark in spk yet, you will need to download the dataset manually and use my parser to get a valid ase-db. The dataset is available in this [capsule](https://codeocean.com/capsule/7471908/tree/v1) and located at: `/data/Structure_Database/SystemB_Li4P2O7/RAW_VASP_Structures`. Please download all parts of the dataset and extract them to a single folder called `data`. The names of the different parts have to start with `part_` and end with `.pkl`.\r\n\r\n- After downloading the data you can use this [parser](https://gist.github.com/Stefaanhess/22d93b5cbe740c22bc161e9c3e977e3d) to generate the ase-db. After running the script, you should have a spk-compatible database at `data/li4p2o7.db`.\r\n\r\n**Training the Model**\r\n- In order to train the model on the example data, please make sure to use the current dev-branch.\r\n- I updated the config file from my previous comment to match the new dataset. I also did only train on forces without regarding the energy values in the loss function. The updated config file can be downloaded from [here](https://gist.github.com/Stefaanhess/ee63b033bc7e8ece7eae405340981e88). Please download the file to some location with the following folder structure: `<path to configs>/config/experiments/li4p2o7.yaml`.\r\n- After downloading the config file, you should be able to run it with `spktrain --config-dir=<path to configs>/config experiment=li4p2o7 data.datapath=<path to data>/li4p2o7.db data.num_train=1000 data.num_val=250`. For my testrun I used 1000 training and 250 validation points.\r\n\r\n**Evaluation**\r\n- I also made a small evaluation script to test the performance of the trained model. You find the evaluation script in this [gist](https://gist.github.com/Stefaanhess/057456d5ecafc57679572c0eca768a4f). Just set a valid `model_dir` and `db_path` to run it. By changing split to \"train_idx\" or \"val_idx\" you can select the other splits.\r\n- The evaluation is not very efficient, so i added a `n_structures=50` argument to speed it up.\r\n\r\n**Results**\r\n- I just ran the training for some epochs with mostly default settings and the loss errors of train and validation look normal to me: \r\n![image](https://user-images.githubusercontent.com/23171261/172447941-bde0b057-9b36-43b4-8a6f-56436d180672.png)\r\n\r\n- I also evaluated the prediction vs target plots and got these results:\r\n![image](https://user-images.githubusercontent.com/23171261/172448437-a273287b-d087-4bdb-8c29-7f25cc23ee00.png)\r\n![image](https://user-images.githubusercontent.com/23171261/172448367-877c0a32-718f-4a73-b456-830333cb8066.png)\r\n\r\nI hope this small tutorial helps to reproduce my results. If the tutorial does not work at some point please let me know. We will soon discuss about benchmark datasets for pbc + forces and afterwards add this tutorial with more details to the project.\r\nAfter testing the results for Li4P2O7 you could rerun the training with my config file and your own data. If there still is a big difference in performance, I assume it must be related to your data.","reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/comments/1148990011/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false}},{"id":6763549020,"node_id":"MEE_lADOCMZ5Ls5JLdewzwAAAAGTI5Fc","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/6763549020","actor":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-06-07T17:51:50Z","performed_via_github_app":null},{"id":6763549026,"node_id":"SE_lADOCMZ5Ls5JLdewzwAAAAGTI5Fi","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/events/6763549026","actor":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-06-07T17:51:50Z","performed_via_github_app":null}]