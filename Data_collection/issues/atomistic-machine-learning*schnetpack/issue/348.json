{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/348","repository_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack","labels_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/348/labels{/name}","comments_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/348/comments","events_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/348/events","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/348","id":1018744385,"node_id":"I_kwDOCMZ5Ls48uM5B","number":348,"title":"SchNetPack assumes forces are 0 when using PBCs","user":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-10-06T16:49:22Z","updated_at":"2021-10-14T13:41:55Z","closed_at":"2021-10-12T14:16:04Z","author_association":"NONE","active_lock_reason":null,"body":"I'm trying to get SchNetPack to learn energies and forces for periodic systems. I've gotten the energy to a \"reasonable\" error (MAE = 60 meV / atom) but the model always wants to assume that forces are about 0.\r\n\r\nI was able to get the MD17 dataset to work fine with ethanol so I used that as a starting point and then began making the hyperparameters more similar to my own until SchNetPack stopped learning forces.\r\nThe below plot shows the performance of two different potentials. Both were trained on energy per atom and both with PBCs switched on. The only difference is that one model used `num_gaussians : 20` and the other `num_gaussians: 50`.\r\n(I've only trained on 10 structures to keep training time short. Forces are in kcal / mol / Å)\r\n![MD17_forces_both](https://user-images.githubusercontent.com/1126249/136245375-07b6b0b2-1f8e-4c46-89c9-48297ccf26f1.png)\r\n\r\nUnfortunately, using 50 gaussians on my own dataset doesn't improve the forces and has a negligible impact on energies. See below:\r\n(Here I've trained on 100 structures. Energies are in eV and Forces in eV / Å)\r\n![Custom_100_forces](https://user-images.githubusercontent.com/1126249/136246238-471942d7-649c-43d7-baff-c0f3d7dd3b4a.png)\r\n![Custom_100_formE](https://user-images.githubusercontent.com/1126249/136246244-8b89be06-2d42-4b69-9174-c262e1a9113b.png)\r\n\r\nNote that all of the data above is training data, not validation.\r\n\r\nI'm training via the spk_run.py script using the following args with the only real difference being the datapath and the trained property (energy_per_atom vs formation_energy_per_atom):\r\n```\r\n{\r\n    \"aggregation_mode\": \"avg\",\r\n    \"batch_size\": 30,\r\n    \"checkpoint_interval\": 1,\r\n    \"contributions\": null,\r\n    \"cuda\": true,\r\n    \"cutoff\": 5.0,\r\n    \"cutoff_function\": \"cosine\",\r\n    \"datapath\": \"Fourth_early2.db\",\r\n    \"dataset\": \"custom\",\r\n    \"derivative\": \"forces\",\r\n    \"environment_provider\": \"torch\",\r\n    \"features\": 128,\r\n    \"force\": null,\r\n    \"interactions\": 3,\r\n    \"keep_n_checkpoints\": 3,\r\n    \"log_every_n_epochs\": 1,\r\n    \"logger\": \"csv\",\r\n    \"lr\": 0.0001,\r\n    \"lr_decay\": 0.08,\r\n    \"lr_min\": 1e-06,\r\n    \"lr_patience\": 25,\r\n    \"max_epochs\": 5000,\r\n    \"max_steps\": null,\r\n    \"mode\": \"train\",\r\n    \"model\": \"schnet\",\r\n    \"modelpath\": \"model/\",\r\n    \"n_epochs\": 1000,\r\n    \"negative_dr\": true,\r\n    \"normalize_filter\": true,\r\n    \"num_gaussians\": 50,\r\n    \"output_module\": \"atomwise\",\r\n    \"overwrite\": false,\r\n    \"parallel\": true,\r\n    \"property\": \"formation_energy_per_atom\",\r\n    \"rho\": {},\r\n    \"seed\": null,\r\n    \"split\": [\r\n        null,\r\n        null\r\n    ],\r\n    \"split_path\": \"model/split.npz\",\r\n    \"stress\": null\r\n}\r\n```\r\n\r\nI've included a small sample of my training structures (20) as an example of what I am training on. Though, I've found that SchNetPack often struggles to learn the training set when it is small, to the point of overestimating energies by a factor of 10.\r\n[JDorrell_20_structures.zip](https://github.com/atomistic-machine-learning/schnetpack/files/7295764/JDorrell_20_structures.zip)\r\n\r\nAm I doing something wrong or have I reached a limitation of SchNetPack?\r\n\r\nThankyou.\r\n\r\nJordan\r\n\r\n","closed_by":{"login":"ktschuett","id":6585114,"node_id":"MDQ6VXNlcjY1ODUxMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/6585114?v=4","gravatar_id":"","url":"https://api.github.com/users/ktschuett","html_url":"https://github.com/ktschuett","followers_url":"https://api.github.com/users/ktschuett/followers","following_url":"https://api.github.com/users/ktschuett/following{/other_user}","gists_url":"https://api.github.com/users/ktschuett/gists{/gist_id}","starred_url":"https://api.github.com/users/ktschuett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ktschuett/subscriptions","organizations_url":"https://api.github.com/users/ktschuett/orgs","repos_url":"https://api.github.com/users/ktschuett/repos","events_url":"https://api.github.com/users/ktschuett/events{/privacy}","received_events_url":"https://api.github.com/users/ktschuett/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/348/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/348/timeline","performed_via_github_app":null,"state_reason":"completed"}