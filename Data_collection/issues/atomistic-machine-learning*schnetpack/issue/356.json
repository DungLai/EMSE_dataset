{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/356","repository_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack","labels_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/356/labels{/name}","comments_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/356/comments","events_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/356/events","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/356","id":1038389529,"node_id":"I_kwDOCMZ5Ls495JEZ","number":356,"title":"Bug in ConcatAtomsData if it contains AtomsDataSubsets","user":{"login":"chgaul","id":10855969,"node_id":"MDQ6VXNlcjEwODU1OTY5","avatar_url":"https://avatars.githubusercontent.com/u/10855969?v=4","gravatar_id":"","url":"https://api.github.com/users/chgaul","html_url":"https://github.com/chgaul","followers_url":"https://api.github.com/users/chgaul/followers","following_url":"https://api.github.com/users/chgaul/following{/other_user}","gists_url":"https://api.github.com/users/chgaul/gists{/gist_id}","starred_url":"https://api.github.com/users/chgaul/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chgaul/subscriptions","organizations_url":"https://api.github.com/users/chgaul/orgs","repos_url":"https://api.github.com/users/chgaul/repos","events_url":"https://api.github.com/users/chgaul/events{/privacy}","received_events_url":"https://api.github.com/users/chgaul/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-10-28T11:12:35Z","updated_at":"2021-10-29T15:31:24Z","closed_at":"2021-10-29T15:21:18Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Hi!\r\n\r\nI noticed that AtomsDataSubsets are not treated properly when included into a ConcatAtomsData. The indices list of the AtomsDataSubset is ignored, and the elements of the underlying dataset are delivered.\r\n\r\nI believe that in the following code, none of the assert statements should throw, but they do:\r\n\r\n```\r\nfrom schnetpack.datasets import QM9\r\nfrom schnetpack.data.partitioning import train_test_split\r\nfrom schnetpack.data.atoms import ConcatAtomsData\r\n# prepare some example data\r\nprop = QM9.homo\r\ndataset = QM9(\"qm9.db\", load_only=[prop])\r\n_, subset0, subset1 = train_test_split(\r\n    data=dataset, num_train=100000, num_val=10000)\r\n# concatenate two subsets\r\nconcatenated = ConcatAtomsData([subset0, subset1])\r\n# make some plausibility checks: Does the concatenated dataset deliver the expected elements?\r\nidx = 0\r\nassert concatenated[idx][prop] == subset0[idx][prop], \"\"\"Case 1:\r\n    Concatenated DB does not start with the same element as its\r\n    first member!\"\"\"\r\nassert concatenated[idx][prop] != dataset[idx][prop], \"\"\"Case 2:\r\n    DB of concatenated subsets should not start with the same \r\n    element as the underlying dataset!\"\"\"\r\nassert concatenated[idx][prop] == dataset[subset0.indices[idx]][prop], \"\"\"Case 3:\r\n    Concatenated DB does not start with the expected element of the underlying dataset!\"\"\"\r\nassert concatenated[len(subset0) + idx][prop] == subset1[idx][prop], \"\"\"Case 4:\r\n    Second part of concatenated DB does not start with the first\r\n    element of its second member!\"\"\"\r\n```\r\nI think I know how to fix this and I will create a respective pull request.","closed_by":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/356/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/356/timeline","performed_via_github_app":null,"state_reason":"completed"}