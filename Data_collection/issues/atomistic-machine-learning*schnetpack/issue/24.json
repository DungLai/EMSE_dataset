{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/24","repository_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack","labels_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/24/labels{/name}","comments_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/24/comments","events_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/24/events","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/24","id":376334184,"node_id":"MDU6SXNzdWUzNzYzMzQxODQ=","number":24,"title":"RMSE logging when training data contains molecules of varying sizes","user":{"login":"ojaace","id":44668428,"node_id":"MDQ6VXNlcjQ0NjY4NDI4","avatar_url":"https://avatars.githubusercontent.com/u/44668428?v=4","gravatar_id":"","url":"https://api.github.com/users/ojaace","html_url":"https://github.com/ojaace","followers_url":"https://api.github.com/users/ojaace/followers","following_url":"https://api.github.com/users/ojaace/following{/other_user}","gists_url":"https://api.github.com/users/ojaace/gists{/gist_id}","starred_url":"https://api.github.com/users/ojaace/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ojaace/subscriptions","organizations_url":"https://api.github.com/users/ojaace/orgs","repos_url":"https://api.github.com/users/ojaace/repos","events_url":"https://api.github.com/users/ojaace/events{/privacy}","received_events_url":"https://api.github.com/users/ojaace/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"assignees":[{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2018-11-01T10:24:17Z","updated_at":"2018-11-26T11:12:09Z","closed_at":"2018-11-26T11:12:09Z","author_association":"NONE","active_lock_reason":null,"body":"I'm unsure whether or not I'm getting representative RMSE logging when training on a data set that contains molecules of varying sizes (from 55 atoms to 190 atoms).\r\n\r\nIf I'm not mistaken, the following piece of code is run (per batch?) when logging the RMSE of a target:\r\n\r\nhttps://github.com/atomistic-machine-learning/schnetpack/blob/master/src/schnetpack/metrics.py#L68\r\n\r\n```python\r\n    def add_batch(self, batch, result):\r\n        y = batch[self.target]\r\n        if self.model_output is None:\r\n            yp = result\r\n        else:\r\n            yp = result[self.model_output]\r\n\r\n        diff = self._get_diff(y, yp)\r\n        self.l2loss += torch.sum(diff.view(-1)).detach().cpu().data.numpy()\r\n        self.n_entries += np.prod(y.shape)\r\n```\r\n\r\nhttps://github.com/atomistic-machine-learning/schnetpack/blob/master/src/schnetpack/metrics.py#L132\r\n\r\n```python\r\n    def aggregate(self):\r\n        return np.sqrt(self.l2loss / self.n_entries)\r\n```\r\nAs far as I understand, there's some zero padding happening in the background when the training batch contains molecules of varying sizes. Am I correct in assuming that this zero padding increases the number ``self.n_entries`` (when using ``np.prod(y.shape)``) such that my mean (for the smaller molecules) becomes a lot smaller than it should be?","closed_by":{"login":"ktschuett","id":6585114,"node_id":"MDQ6VXNlcjY1ODUxMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/6585114?v=4","gravatar_id":"","url":"https://api.github.com/users/ktschuett","html_url":"https://github.com/ktschuett","followers_url":"https://api.github.com/users/ktschuett/followers","following_url":"https://api.github.com/users/ktschuett/following{/other_user}","gists_url":"https://api.github.com/users/ktschuett/gists{/gist_id}","starred_url":"https://api.github.com/users/ktschuett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ktschuett/subscriptions","organizations_url":"https://api.github.com/users/ktschuett/orgs","repos_url":"https://api.github.com/users/ktschuett/repos","events_url":"https://api.github.com/users/ktschuett/events{/privacy}","received_events_url":"https://api.github.com/users/ktschuett/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/24/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/24/timeline","performed_via_github_app":null,"state_reason":"completed"}