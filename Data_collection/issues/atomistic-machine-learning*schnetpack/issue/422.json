{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/422","repository_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack","labels_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/422/labels{/name}","comments_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/422/comments","events_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/422/events","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/422","id":1339608321,"node_id":"I_kwDOCMZ5Ls5P2M0B","number":422,"title":"CUDA out of memory problem","user":{"login":"luckyjackluo","id":22425236,"node_id":"MDQ6VXNlcjIyNDI1MjM2","avatar_url":"https://avatars.githubusercontent.com/u/22425236?v=4","gravatar_id":"","url":"https://api.github.com/users/luckyjackluo","html_url":"https://github.com/luckyjackluo","followers_url":"https://api.github.com/users/luckyjackluo/followers","following_url":"https://api.github.com/users/luckyjackluo/following{/other_user}","gists_url":"https://api.github.com/users/luckyjackluo/gists{/gist_id}","starred_url":"https://api.github.com/users/luckyjackluo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/luckyjackluo/subscriptions","organizations_url":"https://api.github.com/users/luckyjackluo/orgs","repos_url":"https://api.github.com/users/luckyjackluo/repos","events_url":"https://api.github.com/users/luckyjackluo/events{/privacy}","received_events_url":"https://api.github.com/users/luckyjackluo/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-08-15T22:51:50Z","updated_at":"2022-08-17T18:03:32Z","closed_at":"2022-08-17T18:03:31Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, \r\n\r\nI am trying to train the model on a training set with about 20000 samples, each sample contains 256 water molecules (or 768 atoms) with periodic boundary condition. I built the dataset based on the instruction in the documentation and here is the information of it: \r\n\r\nNumber of reference calculations: 21297\r\nAvailable properties:\r\n- energy\r\n- force\r\n\r\nProperties of molecule with id 0:\r\n- energy : torch.Size([1])\r\n- force : torch.Size([768, 3])\r\n- _atomic_numbers : torch.Size([768])\r\n- _positions : torch.Size([768, 3])\r\n- _neighbors : torch.Size([768, 767])\r\n- _cell : torch.Size([3, 3])\r\n- _cell_offset : torch.Size([768, 767, 3])\r\n- _idx : torch.Size([1])\r\n\r\nI am using CentOS7 and the following is my gpu information:\r\n`Mon Aug 15 15:47:46 2022\r\n+-----------------------------------------------------------------------------+\r\n| NVIDIA-SMI 510.39.01    Driver Version: 510.39.01    CUDA Version: 11.6     |\r\n|-------------------------------+----------------------+----------------------+\r\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\r\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\r\n|                               |                      |               MIG M. |\r\n|===============================+======================+======================|\r\n|   0  Tesla V100-SXM2...  On   | 00000000:18:00.0 Off |                    0 |\r\n| N/A   34C    P0    40W / 300W |      3MiB / 32768MiB |      0%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n|   1  Tesla V100-SXM2...  On   | 00000000:3B:00.0 Off |                    0 |\r\n| N/A   33C    P0    40W / 300W |      0MiB / 32768MiB |      0%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n|   2  Tesla V100-SXM2...  On   | 00000000:86:00.0 Off |                    0 |\r\n| N/A   39C    P0    41W / 300W |      0MiB / 32768MiB |      0%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n|   3  Tesla V100-SXM2...  On   | 00000000:AF:00.0 Off |                    0 |\r\n| N/A   41C    P0    41W / 300W |      0MiB / 32768MiB |      0%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n\r\n+-----------------------------------------------------------------------------+\r\n| Processes:                                                                  |\r\n|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\r\n|        ID   ID                                                   Usage      |\r\n|=============================================================================|\r\n|  No running processes found                                                 |\r\n+-----------------------------------------------------------------------------+\r\n`\r\n\r\nAnd I am getting CUDA out of memory error:\r\n`RuntimeError: CUDA out of memory. Tried to allocate 1.41 GiB (GPU 0; 31.75 GiB total capacity; 29.21 GiB already allocated; 436.19 MiB free; 30.36 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF`\r\n\r\nI am not sure if this means I should increase my gpu memory even more because this amount is probably all I got. I tried to reduce the batch size to even 1 but this problem still exists. Do you have any idea how to solve it?\r\n\r\nThank you!\r\nJack","closed_by":{"login":"mgastegger","id":36198330,"node_id":"MDQ6VXNlcjM2MTk4MzMw","avatar_url":"https://avatars.githubusercontent.com/u/36198330?v=4","gravatar_id":"","url":"https://api.github.com/users/mgastegger","html_url":"https://github.com/mgastegger","followers_url":"https://api.github.com/users/mgastegger/followers","following_url":"https://api.github.com/users/mgastegger/following{/other_user}","gists_url":"https://api.github.com/users/mgastegger/gists{/gist_id}","starred_url":"https://api.github.com/users/mgastegger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mgastegger/subscriptions","organizations_url":"https://api.github.com/users/mgastegger/orgs","repos_url":"https://api.github.com/users/mgastegger/repos","events_url":"https://api.github.com/users/mgastegger/events{/privacy}","received_events_url":"https://api.github.com/users/mgastegger/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/422/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/422/timeline","performed_via_github_app":null,"state_reason":"completed"}