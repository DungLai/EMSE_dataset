{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/61","repository_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack","labels_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/61/labels{/name}","comments_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/61/comments","events_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/61/events","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/61","id":418023663,"node_id":"MDU6SXNzdWU0MTgwMjM2NjM=","number":61,"title":"KeyError: '_neighbor_pairs_j'","user":{"login":"lmj1029123","id":34913961,"node_id":"MDQ6VXNlcjM0OTEzOTYx","avatar_url":"https://avatars.githubusercontent.com/u/34913961?v=4","gravatar_id":"","url":"https://api.github.com/users/lmj1029123","html_url":"https://github.com/lmj1029123","followers_url":"https://api.github.com/users/lmj1029123/followers","following_url":"https://api.github.com/users/lmj1029123/following{/other_user}","gists_url":"https://api.github.com/users/lmj1029123/gists{/gist_id}","starred_url":"https://api.github.com/users/lmj1029123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lmj1029123/subscriptions","organizations_url":"https://api.github.com/users/lmj1029123/orgs","repos_url":"https://api.github.com/users/lmj1029123/repos","events_url":"https://api.github.com/users/lmj1029123/events{/privacy}","received_events_url":"https://api.github.com/users/lmj1029123/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"assignees":[{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false}],"milestone":null,"comments":12,"created_at":"2019-03-06T21:45:15Z","updated_at":"2019-03-19T12:23:11Z","closed_at":"2019-03-19T12:23:11Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Hi, I was trying to run the hdnn model with my own ase database but it is giving me an error.\r\n\r\n`-------------------------------------------------------------------------\r\nKeyError                                  Traceback (most recent call last)\r\n<ipython-input-5-4f137f9701fd> in <module>()\r\n     32 \r\n     33 # start training\r\n---> 34 trainer.train(torch.device(\"cpu\"))\r\n\r\n~\\Anaconda3\\lib\\site-packages\\schnetpack\\train\\trainer.py in train(self, device)\r\n    214                 h.on_train_failed(self)\r\n    215 \r\n--> 216             raise e\r\n\r\n~\\Anaconda3\\lib\\site-packages\\schnetpack\\train\\trainer.py in train(self, device)\r\n    142                     }\r\n    143 \r\n--> 144                     result = self._model(train_batch)\r\n    145                     loss = self.loss_fn(train_batch, result)\r\n    146 \r\n\r\n~\\Anaconda3\\lib\\site-packages\\torch\\nn\\modules\\module.py in __call__(self, *input, **kwargs)\r\n    487             result = self._slow_forward(*input, **kwargs)\r\n    488         else:\r\n--> 489             result = self.forward(*input, **kwargs)\r\n    490         for hook in self._forward_hooks.values():\r\n    491             hook_result = hook(self, input, result)\r\n\r\n~\\Anaconda3\\lib\\site-packages\\schnetpack\\atomistic.py in forward(self, inputs)\r\n     53         if self.requires_dr:\r\n     54             inputs[Structure.R].requires_grad_()\r\n---> 55         inputs['representation'] = self.representation(inputs)\r\n     56 \r\n     57         if isinstance(self.output_modules, nn.ModuleList):\r\n\r\n~\\Anaconda3\\lib\\site-packages\\torch\\nn\\modules\\module.py in __call__(self, *input, **kwargs)\r\n    487             result = self._slow_forward(*input, **kwargs)\r\n    488         else:\r\n--> 489             result = self.forward(*input, **kwargs)\r\n    490         for hook in self._forward_hooks.values():\r\n    491             hook_result = hook(self, input, result)\r\n\r\n~\\Anaconda3\\lib\\site-packages\\schnetpack\\representation\\hdnn.py in forward(self, inputs)\r\n    195         if self.ADF is not None:\r\n    196             # Get pair indices\r\n--> 197             idx_j = inputs[Structure.neighbor_pairs_j]\r\n    198             idx_k = inputs[Structure.neighbor_pairs_k]\r\n    199             neighbor_pairs_mask = inputs[Structure.neighbor_pairs_mask]\r\n\r\nKeyError: '_neighbor_pairs_j'`\r\n\r\nThe database I use is a ase db with 50 Au-Pd clusters with 13 atoms. \r\n\r\n```from schnetpack.data import AtomsData\r\nimport torch\r\nimport torch.nn.functional as F\r\nfrom torch.optim import Adam\r\n\r\nimport schnetpack as spk\r\nimport schnetpack.atomistic as atm\r\nimport schnetpack.representation as rep\r\nfrom schnetpack.datasets import *\r\n\r\ndata = AtomsData('./db/Icosahedron-2-large-unique-50-test.db', properties=['energy'])\r\n# split in train and val\r\ntrain, val, test = data.create_splits(10, 10)\r\nloader = spk.data.AtomsLoader(train, batch_size=2, num_workers=1)\r\nval_loader = spk.data.AtomsLoader(val)\r\n\r\n# create model\r\nreps = rep.BehlerSFBlock(n_radial=22, n_angular=5, elements=frozenset([46,79]))\r\noutput = atm.ElementalAtomwise(reps.n_symfuncs)\r\nmodel = atm.AtomisticModel(reps, output)\r\n\r\n# filter for trainable parameters (https://github.com/pytorch/pytorch/issues/679)\r\ntrainable_params = filter(lambda p: p.requires_grad, model.parameters())\r\n\r\n# create trainer\r\nopt = Adam(trainable_params, lr=1e-4)\r\nloss = lambda b, p: F.mse_loss(p[\"y\"], b['energy'])\r\ntrainer = spk.train.Trainer(\"wacsf/\", model, loss,\r\n                      opt, loader, val_loader)\r\n\r\n# start training\r\ntrainer.train(torch.device(\"cpu\"))```\r\n\r\nDid I do something wrong in the code? Thanks! \r\n","closed_by":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/61/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/61/timeline","performed_via_github_app":null,"state_reason":"completed"}