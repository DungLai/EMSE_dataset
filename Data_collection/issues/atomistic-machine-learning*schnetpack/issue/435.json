{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/435","repository_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack","labels_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/435/labels{/name}","comments_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/435/comments","events_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/435/events","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/435","id":1383447767,"node_id":"I_kwDOCMZ5Ls5SdbzX","number":435,"title":"[Questions] How to set atomref using my own data, and how to use remove_atomrefs.","user":{"login":"yuchanpei","id":45443179,"node_id":"MDQ6VXNlcjQ1NDQzMTc5","avatar_url":"https://avatars.githubusercontent.com/u/45443179?v=4","gravatar_id":"","url":"https://api.github.com/users/yuchanpei","html_url":"https://github.com/yuchanpei","followers_url":"https://api.github.com/users/yuchanpei/followers","following_url":"https://api.github.com/users/yuchanpei/following{/other_user}","gists_url":"https://api.github.com/users/yuchanpei/gists{/gist_id}","starred_url":"https://api.github.com/users/yuchanpei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yuchanpei/subscriptions","organizations_url":"https://api.github.com/users/yuchanpei/orgs","repos_url":"https://api.github.com/users/yuchanpei/repos","events_url":"https://api.github.com/users/yuchanpei/events{/privacy}","received_events_url":"https://api.github.com/users/yuchanpei/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-09-23T08:13:09Z","updated_at":"2022-09-29T15:18:45Z","closed_at":"2022-09-29T15:18:45Z","author_association":"NONE","active_lock_reason":null,"body":"Dear developers,\r\n    I am trying to train a schnetpack model using my own data in npz format.  I use the following code to convert the dataset from npz format to db format in jupyter notebookï¼š\r\n```python\r\nfrom ase import Atoms\r\nimport numpy as np   \r\nfrom schnetpack.data import *\r\n\r\ndata = np.load('./test.npz')\r\natoms_list = []\r\nproperty_list = []\r\nfor numbers, positions, energies in zip(data[\"Z\"], data[\"R\"], data[\"E\"]):\r\n    ats = Atoms(positions=positions, numbers=numbers)\r\n    energy_in_np = np.array([energies])\r\n    properties = {'energy': energy_in_np}\r\n    property_list.append(properties)\r\n    atoms_list.append(ats)\r\ndataset = ASEAtomsData.create(\r\n    './test.db',\r\n    distance_unit='Ang',\r\n    property_unit_dict={'energy':'kcal/mol'}\r\n)\r\ndataset.add_systems(property_list, atoms_list)\r\n```   \r\n\r\n\r\nSince molecules in my data have different compositions, I need to use remove_atomrefs when I load it using the following code:  \r\n\r\n \r\n```python\r\ndata_module = AtomsDataModule(datapath=\"./test.db'\",\r\n                                format=AtomsDataFormat.ASE,\r\n                                batch_size=10,\r\n                                num_train=1000,\r\n                                num_val=100,\r\n                                transforms=[\r\n                                    trn.ASENeighborList(cutoff=5.),\r\n                                    trn.RemoveOffsets(\"energy\", remove_mean=True, remove_atomrefs=True),\r\n                                    trn.CastTo32()\r\n                                ],\r\n                                num_workers=1,\r\n                                pin_memory=True,\r\n                                property_units={'energy':'kcal/mol'},\r\n                                distance_unit=\"Ang\",\r\n                                load_properties=[\"energy\"],\r\n                                )\r\ndata_module.prepare_data()\r\ndata_module.setup()\r\n```\r\nThen, a KeyError occurred. I know this is because I didn't set atomref when I construct my data in db format. But I do not how to generate atomref when I convert my dataset. I wonder if you could help me with this?\r\n![image](https://user-images.githubusercontent.com/45443179/191918451-9fae068d-fbf6-4158-9a76-e5e28c27865c.png)\r\n\r\nThank you in advance for any help you might be able to provide.\r\n\r\nBest regards,\r\nCristina\r\n","closed_by":{"login":"ktschuett","id":6585114,"node_id":"MDQ6VXNlcjY1ODUxMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/6585114?v=4","gravatar_id":"","url":"https://api.github.com/users/ktschuett","html_url":"https://github.com/ktschuett","followers_url":"https://api.github.com/users/ktschuett/followers","following_url":"https://api.github.com/users/ktschuett/following{/other_user}","gists_url":"https://api.github.com/users/ktschuett/gists{/gist_id}","starred_url":"https://api.github.com/users/ktschuett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ktschuett/subscriptions","organizations_url":"https://api.github.com/users/ktschuett/orgs","repos_url":"https://api.github.com/users/ktschuett/repos","events_url":"https://api.github.com/users/ktschuett/events{/privacy}","received_events_url":"https://api.github.com/users/ktschuett/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/435/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/435/timeline","performed_via_github_app":null,"state_reason":"completed"}