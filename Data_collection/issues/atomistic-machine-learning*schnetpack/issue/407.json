{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407","repository_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack","labels_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407/labels{/name}","comments_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407/comments","events_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407/events","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/407","id":1227741104,"node_id":"I_kwDOCMZ5Ls5JLdew","number":407,"title":"Failing to learn forces for periodic system even when energies are ignored in loss","user":{"login":"JordD04","id":1126249,"node_id":"MDQ6VXNlcjExMjYyNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1126249?v=4","gravatar_id":"","url":"https://api.github.com/users/JordD04","html_url":"https://github.com/JordD04","followers_url":"https://api.github.com/users/JordD04/followers","following_url":"https://api.github.com/users/JordD04/following{/other_user}","gists_url":"https://api.github.com/users/JordD04/gists{/gist_id}","starred_url":"https://api.github.com/users/JordD04/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JordD04/subscriptions","organizations_url":"https://api.github.com/users/JordD04/orgs","repos_url":"https://api.github.com/users/JordD04/repos","events_url":"https://api.github.com/users/JordD04/events{/privacy}","received_events_url":"https://api.github.com/users/JordD04/received_events","type":"User","site_admin":false},"labels":[{"id":1044272344,"node_id":"MDU6TGFiZWwxMDQ0MjcyMzQ0","url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/labels/question","name":"question","color":"d876e3","default":true,"description":"Not a bug report, but a question or other problem"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":17,"created_at":"2022-05-06T11:25:13Z","updated_at":"2022-06-17T22:20:51Z","closed_at":"2022-06-17T12:38:23Z","author_association":"NONE","active_lock_reason":null,"body":"I've been using SchNetPack for a while now and I've continued to struggle to get force predictions to perform well. The forces are consistently underestimated. I've recently tried training *only* on forces and although this improves predictions, it's still pretty bad.\r\nMy understanding is that on initialisation, my NN's always predict forces as ≈0 eV / Å and this improves a little bit during training but the validation loss increases after only a few training iterations.\r\nHere's an example:\r\n![loss_binned](https://user-images.githubusercontent.com/1126249/167121270-5b2b27aa-c7fe-4f33-ab4e-750824877c02.png)\r\n![forces_binned](https://user-images.githubusercontent.com/1126249/167121286-f33fdae4-964f-47cc-8246-45ad1599e9d6.png)\r\nChanging the size of the training set has a near-zero impact and simplifying the NNs doesn't seem to really mitigate the over-fitting. I've experimented with the learning rate parameters and it's unclear if that's helpful.\r\nMost of my forces are very low (90% ≈ 0.01 eV / Å) so I thought that may be the issue but removing most of the low force structures doesn't make as much of an improvement as I would like (this data is shown above).\r\nHere's my args.json. I've been able to get reasonably good energies with the same hyperparameters:\r\n```\r\n{\r\n    \"aggregation_mode\": \"avg\",\r\n    \"batch_size\": 300,\r\n    \"checkpoint_interval\": 1,\r\n    \"contributions\": null,\r\n    \"cuda\": true,\r\n    \"cutoff\": 5.0,\r\n    \"cutoff_function\": \"cosine\",\r\n    \"datapath\": \"../../database.db\",\r\n    \"dataset\": \"custom\",\r\n    \"derivative\": \"forces\",\r\n    \"environment_provider\": \"torch\",\r\n    \"features\": 64,\r\n    \"force\": null,\r\n    \"interactions\": 4,\r\n    \"keep_n_checkpoints\": 3,\r\n    \"log_every_n_epochs\": 1,\r\n    \"logger\": \"csv\",\r\n    \"lr\": 0.001,\r\n    \"lr_decay\": 0.8,\r\n    \"lr_min\": 1e-06,\r\n    \"lr_patience\": 25,\r\n    \"max_epochs\": 5000,\r\n    \"max_steps\": null,\r\n    \"mode\": \"train\",\r\n    \"model\": \"schnet\",\r\n    \"modelpath\": \"model/\",\r\n    \"n_epochs\": 10000,\r\n    \"negative_dr\": true,\r\n    \"normalize_filter\": true,\r\n    \"num_gaussians\": 30,\r\n    \"output_module\": \"atomwise\",\r\n    \"overwrite\": false,\r\n    \"parallel\": true,\r\n    \"property\": \"formation_energy_per_atom\",\r\n    \"rho\": {\r\n        \"derivative\": 1.0,\r\n        \"property\": 0.0\r\n    },\r\n    \"seed\": null,\r\n    \"split\": [\r\n        null,\r\n        null\r\n    ],\r\n    \"split_path\": \"model/split.npz\",\r\n    \"stress\": null\r\n}\r\n```\r\nI'm training on CASTEP Geometry Optimisation on a periodic ternary system. \r\nA colleague is training on VASP MD data (again periodic), for which the forces are higher (~2.5 Å) and is getting better force performance but still not ideal.\r\n\r\nDoes anyone have an idea on what I'm doing wrong or am I reaching a limitation on SchNetPack?","closed_by":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/407/timeline","performed_via_github_app":null,"state_reason":"completed"}