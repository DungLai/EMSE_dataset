{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/8","repository_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack","labels_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/8/labels{/name}","comments_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/8/comments","events_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/8/events","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/8","id":364189208,"node_id":"MDU6SXNzdWUzNjQxODkyMDg=","number":8,"title":"Using trained model as ASE calculator","user":{"login":"Dankomaister","id":14222532,"node_id":"MDQ6VXNlcjE0MjIyNTMy","avatar_url":"https://avatars.githubusercontent.com/u/14222532?v=4","gravatar_id":"","url":"https://api.github.com/users/Dankomaister","html_url":"https://github.com/Dankomaister","followers_url":"https://api.github.com/users/Dankomaister/followers","following_url":"https://api.github.com/users/Dankomaister/following{/other_user}","gists_url":"https://api.github.com/users/Dankomaister/gists{/gist_id}","starred_url":"https://api.github.com/users/Dankomaister/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Dankomaister/subscriptions","organizations_url":"https://api.github.com/users/Dankomaister/orgs","repos_url":"https://api.github.com/users/Dankomaister/repos","events_url":"https://api.github.com/users/Dankomaister/events{/privacy}","received_events_url":"https://api.github.com/users/Dankomaister/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-09-26T20:07:47Z","updated_at":"2018-09-29T07:24:02Z","closed_at":"2018-09-29T07:24:02Z","author_association":"NONE","active_lock_reason":null,"body":"I'm trying to used a trained model as an calculator object in ASE, however i get an error.\r\n```\r\nTraceback (most recent call last):\r\n  File \"opti.py\", line 30, in <module>\r\n    dyn.run(fmax=0.01)\r\n  File \"/usr/local/lib/python3.6/dist-packages/ase/optimize/optimize.py\", line 174, in run\r\n    f = self.atoms.get_forces()\r\n  File \"/usr/local/lib/python3.6/dist-packages/ase/atoms.py\", line 735, in get_forces\r\n    forces = self._calc.get_forces(self)\r\n  File \"/usr/local/lib/python3.6/dist-packages/ase/calculators/calculator.py\", line 460, in get_forces\r\n    return self.get_property('forces', atoms)\r\n  File \"/usr/local/lib/python3.6/dist-packages/ase/calculators/calculator.py\", line 493, in get_property\r\n    self.calculate(atoms, [name], system_changes)\r\n  File \"/usr/local/lib/python3.6/dist-packages/schnetpack/md.py\", line 94, in calculate\r\n    model_results = self.model(model_inputs)\r\n  File \"/usr/local/lib/python3.6/dist-packages/torch/nn/modules/module.py\", line 477, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/usr/local/lib/python3.6/dist-packages/schnetpack/atomistic.py\", line 55, in forward\r\n    inputs['representation'] = self.representation(inputs)\r\n  File \"/usr/local/lib/python3.6/dist-packages/torch/nn/modules/module.py\", line 477, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/usr/local/lib/python3.6/dist-packages/schnetpack/representation/schnet.py\", line 199, in forward\r\n    v = interaction(x, r_ij, neighbors, neighbor_mask, f_ij=f_ij)\r\n  File \"/usr/local/lib/python3.6/dist-packages/torch/nn/modules/module.py\", line 477, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/usr/local/lib/python3.6/dist-packages/schnetpack/representation/schnet.py\", line 52, in forward\r\n    v = self.cfconv.forward(x, r_ij, neighbors, neighbor_mask, f_ij=f_ij)\r\n  File \"/usr/local/lib/python3.6/dist-packages/schnetpack/nn/cfconv.py\", line 67, in forward\r\n    y = torch.gather(y, 1, nbh)\r\nRuntimeError: Invalid index in gather at /pytorch/aten/src/TH/generic/THTensorMath.cpp:620\r\n```\r\nHave been trying with different ASE scripts, geometry optimization, phonon dispersion calculation etc, but getting similar errors. Attached are the files for a geometry optimization of a 6,0 SWCNT with the trained model.\r\n\r\nAny tips on how to fix this?\r\n\r\n\r\n[6,0_opti.zip](https://github.com/atomistic-machine-learning/schnetpack/files/2421389/6.0_opti.zip)\r\n\r\n\r\n","closed_by":{"login":"ktschuett","id":6585114,"node_id":"MDQ6VXNlcjY1ODUxMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/6585114?v=4","gravatar_id":"","url":"https://api.github.com/users/ktschuett","html_url":"https://github.com/ktschuett","followers_url":"https://api.github.com/users/ktschuett/followers","following_url":"https://api.github.com/users/ktschuett/following{/other_user}","gists_url":"https://api.github.com/users/ktschuett/gists{/gist_id}","starred_url":"https://api.github.com/users/ktschuett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ktschuett/subscriptions","organizations_url":"https://api.github.com/users/ktschuett/orgs","repos_url":"https://api.github.com/users/ktschuett/repos","events_url":"https://api.github.com/users/ktschuett/events{/privacy}","received_events_url":"https://api.github.com/users/ktschuett/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/8/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/8/timeline","performed_via_github_app":null,"state_reason":"completed"}