{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/178","repository_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack","labels_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/178/labels{/name}","comments_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/178/comments","events_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/178/events","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/178","id":500885654,"node_id":"MDU6SXNzdWU1MDA4ODU2NTQ=","number":178,"title":"any documents about the output module of Polarizability","user":{"login":"lixinyuu","id":33710988,"node_id":"MDQ6VXNlcjMzNzEwOTg4","avatar_url":"https://avatars.githubusercontent.com/u/33710988?v=4","gravatar_id":"","url":"https://api.github.com/users/lixinyuu","html_url":"https://github.com/lixinyuu","followers_url":"https://api.github.com/users/lixinyuu/followers","following_url":"https://api.github.com/users/lixinyuu/following{/other_user}","gists_url":"https://api.github.com/users/lixinyuu/gists{/gist_id}","starred_url":"https://api.github.com/users/lixinyuu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lixinyuu/subscriptions","organizations_url":"https://api.github.com/users/lixinyuu/orgs","repos_url":"https://api.github.com/users/lixinyuu/repos","events_url":"https://api.github.com/users/lixinyuu/events{/privacy}","received_events_url":"https://api.github.com/users/lixinyuu/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-10-01T13:10:53Z","updated_at":"2020-09-11T15:22:12Z","closed_at":"2020-09-11T15:22:12Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\r\n\r\nThe output module of Polarizability looks very interesting. However, I cannot get this run with the following code.\r\n```\r\nimport os\r\nimport logging\r\nimport torch\r\nfrom torch.optim import Adam\r\nimport schnetpack as spk\r\nimport schnetpack.representation as rep\r\nfrom schnetpack.train import Trainer, CSVHook, ReduceLROnPlateauHook\r\nfrom schnetpack.train.metrics import MeanAbsoluteError\r\nfrom schnetpack.train import build_mse_loss\r\nimport torch\r\nimport torch.nn as nn\r\nimport torch.nn.functional as F\r\nfrom schnetpack.nn.base import Dense\r\nfrom schnetpack.nn.cfconv import CFConv\r\nfrom schnetpack.nn.cutoff import HardCutoff\r\nfrom schnetpack.nn.neighbors import AtomDistances\r\nfrom schnetpack.nn.activations import shifted_softplus\r\nfrom schnetpack.representation.schnet import SchNetInteraction\r\nimport shutil\r\nfrom schnetpack.nn.base import Aggregate\r\nmodel_dir = \"schnet_polar\"\r\nif torch.cuda.is_available():\r\n    print(\"running on GPU\")\r\n    \r\nos.makedirs(model_dir)\r\nproperties = [\"isotropic_polarizability\"]\r\nlogging.info(\"the available properties are {}\".format(properties[0]))\r\nlogging.info(\"get dataset\")\r\n\r\ndataset = spk.AtomsData(\"/tmp/qm9-10-6.db\", load_only=properties)\r\ntrain, val, test = spk.train_test_split(\r\n    dataset, 100000, 10000, os.path.join(model_dir, \"split.npz\")\r\n)\r\ntrain_loader = spk.AtomsLoader(train, batch_size=64, shuffle=True)\r\nval_loader = spk.AtomsLoader(val, batch_size=64)\r\nmeans, stddevs = train_loader.get_statistics(properties)\r\nprint(means, stddevs)\r\n\r\n# model build\r\nlogging.info(\"build model\")\r\nrepresentation = rep.SchNet(n_interactions=6, cutoff = 10)\r\noutput_modules = [spk.atomistic.Polarizability(n_in = 128, isotropic=True, property=n) for n in properties ]\r\nmodel = spk.atomistic.AtomisticModel(representation, output_modules)\r\n\r\n# build optimizer\r\noptimizer = Adam(model.parameters(), lr=1e-4)\r\n\r\n# hooks\r\nlogging.info(\"build trainer\")\r\nmetrics = [MeanAbsoluteError(p, p) for p in properties]\r\nhooks = [CSVHook(log_path=model_dir, metrics=metrics), ReduceLROnPlateauHook(optimizer)]\r\n\r\n# trainer\r\nloss = build_mse_loss(properties)\r\ntrainer = Trainer(\r\n    model_dir,\r\n    model=model,\r\n    hooks=hooks,\r\n    loss_fn=loss,\r\n    optimizer=optimizer,\r\n    train_loader=train_loader,\r\n    validation_loader=val_loader,\r\n)\r\n\r\n# run training\r\nlogging.info(\"training\")\r\ntrainer.train(device='cuda')\r\n```\r\nThe error message as follows\r\n```\r\nTraceback (most recent call last):\r\n  File \"sch-polar.py\", line 79, in <module>\r\n    trainer.train(device='cpu')\r\n  File \"/users/pythonenv/pytorch/lib/python3.6/site-packages/schnetpack-0.3-py3.6.egg/schnetpack/train/trainer.py\", line 263, in train\r\n  File \"/users/pythonenv/pytorch/lib/python3.6/site-packages/schnetpack-0.3-py3.6.egg/schnetpack/train/trainer.py\", line 190, in train\r\n  File \"/users/pythonenv/pytorch/lib/python3.6/site-packages/torch/nn/modules/module.py\", line 493, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/users/pythonenv/pytorch/lib/python3.6/site-packages/schnetpack-0.3-py3.6.egg/schnetpack/atomistic/model.py\", line 44, in forward\r\n  File \"/users/pythonenv/pytorch/lib/python3.6/site-packages/torch/nn/modules/module.py\", line 493, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/users/pythonenv/pytorch/lib/python3.6/site-packages/schnetpack-0.3-py3.6.egg/schnetpack/atomistic/output_modules.py\", line 467, in forward\r\nIndexError: index 1 is out of bounds for dimension 3 with size 1\r\n```\r\nCould you please give me some suggestions about this? By the way, is there any reference about this Polarizability? Sorry I can not understand what this is trying to do, thus have no idea how to debug this.\r\nThanks.","closed_by":{"login":"Stefaanhess","id":23171261,"node_id":"MDQ6VXNlcjIzMTcxMjYx","avatar_url":"https://avatars.githubusercontent.com/u/23171261?v=4","gravatar_id":"","url":"https://api.github.com/users/Stefaanhess","html_url":"https://github.com/Stefaanhess","followers_url":"https://api.github.com/users/Stefaanhess/followers","following_url":"https://api.github.com/users/Stefaanhess/following{/other_user}","gists_url":"https://api.github.com/users/Stefaanhess/gists{/gist_id}","starred_url":"https://api.github.com/users/Stefaanhess/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stefaanhess/subscriptions","organizations_url":"https://api.github.com/users/Stefaanhess/orgs","repos_url":"https://api.github.com/users/Stefaanhess/repos","events_url":"https://api.github.com/users/Stefaanhess/events{/privacy}","received_events_url":"https://api.github.com/users/Stefaanhess/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/178/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/178/timeline","performed_via_github_app":null,"state_reason":"completed"}