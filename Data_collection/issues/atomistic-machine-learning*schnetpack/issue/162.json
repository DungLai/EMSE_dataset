{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/162","repository_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack","labels_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/162/labels{/name}","comments_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/162/comments","events_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/162/events","html_url":"https://github.com/atomistic-machine-learning/schnetpack/issues/162","id":483404030,"node_id":"MDU6SXNzdWU0ODM0MDQwMzA=","number":162,"title":"gaussian_smearing out of memory","user":{"login":"BioFreak95","id":32635839,"node_id":"MDQ6VXNlcjMyNjM1ODM5","avatar_url":"https://avatars.githubusercontent.com/u/32635839?v=4","gravatar_id":"","url":"https://api.github.com/users/BioFreak95","html_url":"https://github.com/BioFreak95","followers_url":"https://api.github.com/users/BioFreak95/followers","following_url":"https://api.github.com/users/BioFreak95/following{/other_user}","gists_url":"https://api.github.com/users/BioFreak95/gists{/gist_id}","starred_url":"https://api.github.com/users/BioFreak95/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BioFreak95/subscriptions","organizations_url":"https://api.github.com/users/BioFreak95/orgs","repos_url":"https://api.github.com/users/BioFreak95/repos","events_url":"https://api.github.com/users/BioFreak95/events{/privacy}","received_events_url":"https://api.github.com/users/BioFreak95/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2019-08-21T12:55:09Z","updated_at":"2019-09-02T13:12:56Z","closed_at":"2019-09-02T13:12:56Z","author_association":"NONE","active_lock_reason":null,"body":"Hey Guys,\r\nI know that in Issue #99 a similar problem was mentioned.\r\nI try to make some calculations with proteins. I use a cutoff of 5a with the pytorch-neighborlist. \r\nIn average I get 1000 atoms with maximum neighbors of 60-70. So the matrix is 1000x65 in avg.\r\n\r\nWell. In the gaussian smearing (ascf.py line 197) a diff-matrix is created. If one has a batch-size of 128 and 64 gaussians than this tensor has a shape of 128x1000x65x64 which can grow to 2-3GB memory usage for this tensor and i got matrices over 500kk entries.\r\nThan the gauss matrix is created with the similar shape. Then this two matrices fill our GTX1080 with 8GB memory. \r\n\r\nMaybe you have an idea, how this can be done with less memory. For example do not safe the diff matrix, create the gauss matrix directly. \r\n\r\nEven for small networks, this restricts the batchsize to be <= 32.\r\n\r\nMy tested networks have 20k-100k parameters. (With coupled_interactions) So not really big. I build a CNN for a similar task with over 2kk parameters and had less then 2GB memory consumption.\r\n\r\nMaybe you have some ideas, which we can discuss. Maybe this could help also other people.\r\n\r\n\r\nBTW. I have no problem to do the changes and make a PR. Just want do discuss this before.","closed_by":{"login":"ktschuett","id":6585114,"node_id":"MDQ6VXNlcjY1ODUxMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/6585114?v=4","gravatar_id":"","url":"https://api.github.com/users/ktschuett","html_url":"https://github.com/ktschuett","followers_url":"https://api.github.com/users/ktschuett/followers","following_url":"https://api.github.com/users/ktschuett/following{/other_user}","gists_url":"https://api.github.com/users/ktschuett/gists{/gist_id}","starred_url":"https://api.github.com/users/ktschuett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ktschuett/subscriptions","organizations_url":"https://api.github.com/users/ktschuett/orgs","repos_url":"https://api.github.com/users/ktschuett/repos","events_url":"https://api.github.com/users/ktschuett/events{/privacy}","received_events_url":"https://api.github.com/users/ktschuett/received_events","type":"User","site_admin":false},"reactions":{"url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/162/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/atomistic-machine-learning/schnetpack/issues/162/timeline","performed_via_github_app":null,"state_reason":"completed"}